
const peerjsString = `/* needle: injected fix for peerjs */
window.global = window;
var parcelRequire;`

/**
 * @param {import('../types').userSettings} userSettings
 */
export const needlePeerjs = (command, config, userSettings) => {

    if (userSettings.noPeer === true) return;

    return {
        name: 'needle:peerjs',
        transformIndexHtml: {
            order: 'pre',
            handler(html, _ctx) {
                return {
                    html,
                    tags: [
                        {
                            tag: 'script',
                            children: peerjsString,
                            injectTo: 'body-prepend',
                        },
                    ]
                }
            }
        }
    }
}
