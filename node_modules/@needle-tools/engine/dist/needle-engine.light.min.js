var lce=Object.defineProperty,cce=(n,e,i)=>e in n?lce(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,m=(n,e,i)=>(cce(n,typeof e!="symbol"?e+"":e,i),i),eG=(n,e,i)=>{if(!e.has(n))throw TypeError("Cannot "+i)},Hi=(n,e,i)=>(eG(n,e,"read from private field"),i?i.call(n):e.get(n)),mc=(n,e,i)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,i)},td=(n,e,i,s)=>(eG(n,e,"write to private field"),s?s.call(n,i):e.set(n,i),i),FA=(n,e,i)=>(eG(n,e,"access private method"),i);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const fa="169",nf={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},sf={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},KZ=0,tG=1,YZ=2,hce=3,dce=0,iG=1,nG=2,Ha=3,ms=0,wn=1,Qi=2,Pn=0,Au=1,Wp=2,sG=3,rG=4,oG=5,Hp=100,jZ=101,JZ=102,qZ=103,aG=104,$Z=200,eW=201,tW=202,iW=203,VM=204,XM=205,nW=206,sW=207,rW=208,oW=209,aW=210,lW=211,cW=212,hW=213,dW=214,Ex=0,UA=1,rf=2,yu=3,Qp=4,OA=5,ZA=6,of=7,WA=0,lG=1,cG=2,kr=0,af=1,HA=2,hG=3,QA=4,uW=5,lf=6,Kp=7,dG="attached",pW="detached",DM=300,bl=301,gc=302,ao=303,Yp=304,cf=306,lo=1e3,Wo=1001,bu=1002,si=1003,Rx=1004,uce=1004,id=1005,pce=1005,Wt=1006,vu=1007,mce=1007,Ar=1008,mW=1008,Xi=1009,Lx=1010,zM=1011,hf=1012,nd=1013,Gr=1014,en=1015,Ki=1016,FM=1017,UM=1018,jp=1020,uG=35902,pG=1021,mG=1022,_i=1023,Bx=1024,gG=1025,df=1026,Jp=1027,vl=1028,KA=1029,fc=1030,YA=1031,gce=1032,uf=1033,kx=33776,jA=33777,Gx=33778,JA=33779,Px=35840,OM=35841,Nx=35842,ZM=35843,Vx=36196,Xx=37492,Dx=37496,qA=37808,WM=37809,HM=37810,QM=37811,$A=37812,KM=37813,YM=37814,jM=37815,JM=37816,qM=37817,$M=37818,eI=37819,tI=37820,iI=37821,ey=36492,nI=36494,sI=36495,fG=36283,rI=36284,oI=36285,aI=36286,zx=2200,AG=2201,gW=2202,qp=2300,xu=2301,lI=2302,pf=2400,mf=2401,Fx=2402,cI=2500,yG=2501,fW=0,bG=1,hI=2,co=3200,dI=3201,fce=3202,Ace=3203,sd=0,vG=1,ho="",ut="srgb",qi="srgb-linear",Ux="display-p3",ty="display-p3-linear",Ox="linear",Nn="srgb",Zx="rec709",Wx="p3",AW=0,$p=7680,yW=7681,bW=7682,vW=7683,xW=34055,wW=34056,CW=5386,xG=512,SW=513,_W=514,MW=515,IW=516,TW=517,EW=518,uI=519,RW=512,wG=513,LW=514,CG=515,BW=516,kW=517,GW=518,PW=519,iy=35044,Fs=35048,yce=35040,bce=35045,vce=35049,xce=35041,wce=35046,Cce=35050,Sce=35042,_ce="100",pI="300 es",Ac=2e3,gf=2001;let yr=class{addEventListener(n,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[n]===void 0&&(i[n]=[]),i[n].indexOf(e)===-1&&i[n].push(e)}hasEventListener(n,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[n]!==void 0&&i[n].indexOf(e)!==-1}removeEventListener(n,e){if(this._listeners===void 0)return;const i=this._listeners[n];if(i!==void 0){const s=i.indexOf(e);s!==-1&&i.splice(s,1)}}dispatchEvent(n){if(this._listeners===void 0)return;const e=this._listeners[n.type];if(e!==void 0){n.target=this;const i=e.slice(0);for(let s=0,r=i.length;s<r;s++)i[s].call(this,n);n.target=null}}};const Ho=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let NW=1234567;const ff=Math.PI/180,ny=180/Math.PI;function xl(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(Ho[n&255]+Ho[n>>8&255]+Ho[n>>16&255]+Ho[n>>24&255]+"-"+Ho[e&255]+Ho[e>>8&255]+"-"+Ho[e>>16&15|64]+Ho[e>>24&255]+"-"+Ho[i&63|128]+Ho[i>>8&255]+"-"+Ho[i>>16&255]+Ho[i>>24&255]+Ho[s&255]+Ho[s>>8&255]+Ho[s>>16&255]+Ho[s>>24&255]).toLowerCase()}function Ts(n,e,i){return Math.max(e,Math.min(i,n))}function SG(n,e){return(n%e+e)%e}function Mce(n,e,i,s,r){return s+(n-e)*(r-s)/(i-e)}function Ice(n,e,i){return n!==e?(i-n)/(e-n):0}function Hx(n,e,i){return(1-i)*n+i*e}function Tce(n,e,i,s){return Hx(n,e,1-Math.exp(-i*s))}function Ece(n,e=1){return e-Math.abs(SG(n,e*2)-e)}function Rce(n,e,i){return n<=e?0:n>=i?1:(n=(n-e)/(i-e),n*n*(3-2*n))}function Lce(n,e,i){return n<=e?0:n>=i?1:(n=(n-e)/(i-e),n*n*n*(n*(n*6-15)+10))}function Bce(n,e){return n+Math.floor(Math.random()*(e-n+1))}function kce(n,e){return n+Math.random()*(e-n)}function Gce(n){return n*(.5-Math.random())}function Pce(n){n!==void 0&&(NW=n);let e=NW+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Nce(n){return n*ff}function Vce(n){return n*ny}function Xce(n){return(n&n-1)===0&&n!==0}function Dce(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function zce(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function Fce(n,e,i,s,r){const o=Math.cos,a=Math.sin,l=o(i/2),c=a(i/2),h=o((e+s)/2),d=a((e+s)/2),u=o((e-s)/2),p=a((e-s)/2),g=o((s-e)/2),f=a((s-e)/2);switch(r){case"XYX":n.set(l*d,c*u,c*p,l*h);break;case"YZY":n.set(c*p,l*d,c*u,l*h);break;case"ZXZ":n.set(c*u,c*p,l*d,l*h);break;case"XZX":n.set(l*d,c*f,c*g,l*h);break;case"YXY":n.set(c*g,l*d,c*f,l*h);break;case"ZYZ":n.set(c*f,c*g,l*d,l*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function Aa(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Si(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const Di={DEG2RAD:ff,RAD2DEG:ny,generateUUID:xl,clamp:Ts,euclideanModulo:SG,mapLinear:Mce,inverseLerp:Ice,lerp:Hx,damp:Tce,pingpong:Ece,smoothstep:Rce,smootherstep:Lce,randInt:Bce,randFloat:kce,randFloatSpread:Gce,seededRandom:Pce,degToRad:Nce,radToDeg:Vce,isPowerOfTwo:Xce,ceilPowerOfTwo:Dce,floorPowerOfTwo:zce,setQuaternionFromProperEuler:Fce,normalize:Si,denormalize:Aa};let Q=class Hle{constructor(e=0,i=0){Hle.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,s=this.y,r=e.elements;return this.x=r[0]*i+r[3]*s+r[6],this.y=r[1]*i+r[4]*s+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const s=this.dot(e)/i;return Math.acos(Ts(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y;return i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const s=Math.cos(i),r=Math.sin(i),o=this.x-e.x,a=this.y-e.y;return this.x=o*s-a*r+e.x,this.y=o*r+a*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},oi=class Qle{constructor(e,i,s,r,o,a,l,c,h){Qle.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,s,r,o,a,l,c,h)}set(e,i,s,r,o,a,l,c,h){const d=this.elements;return d[0]=e,d[1]=r,d[2]=l,d[3]=i,d[4]=o,d[5]=c,d[6]=s,d[7]=a,d[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],this}extractBasis(e,i,s){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,r=i.elements,o=this.elements,a=s[0],l=s[3],c=s[6],h=s[1],d=s[4],u=s[7],p=s[2],g=s[5],f=s[8],A=r[0],y=r[3],b=r[6],v=r[1],x=r[4],w=r[7],C=r[2],S=r[5],_=r[8];return o[0]=a*A+l*v+c*C,o[3]=a*y+l*x+c*S,o[6]=a*b+l*w+c*_,o[1]=h*A+d*v+u*C,o[4]=h*y+d*x+u*S,o[7]=h*b+d*w+u*_,o[2]=p*A+g*v+f*C,o[5]=p*y+g*x+f*S,o[8]=p*b+g*w+f*_,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8];return i*a*d-i*l*h-s*o*d+s*l*c+r*o*h-r*a*c}invert(){const e=this.elements,i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],u=d*a-l*h,p=l*c-d*o,g=h*o-a*c,f=i*u+s*p+r*g;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const A=1/f;return e[0]=u*A,e[1]=(r*h-d*s)*A,e[2]=(l*s-r*a)*A,e[3]=p*A,e[4]=(d*i-r*c)*A,e[5]=(r*o-l*i)*A,e[6]=g*A,e[7]=(s*c-h*i)*A,e[8]=(a*i-s*o)*A,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,s,r,o,a,l){const c=Math.cos(o),h=Math.sin(o);return this.set(s*c,s*h,-s*(c*a+h*l)+a+e,-r*h,r*c,-r*(-h*a+c*l)+l+i,0,0,1),this}scale(e,i){return this.premultiply(_G.makeScale(e,i)),this}rotate(e){return this.premultiply(_G.makeRotation(-e)),this}translate(e,i){return this.premultiply(_G.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,-s,0,s,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,s=e.elements;for(let r=0;r<9;r++)if(i[r]!==s[r])return!1;return!0}fromArray(e,i=0){for(let s=0;s<9;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const _G=new oi;function VW(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const Uce={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function sy(n,e){return new Uce[n](e)}function Qx(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function XW(){const n=Qx("canvas");return n.style.display="block",n}const DW={};function mI(n){n in DW||(DW[n]=!0,console.warn(n))}function Oce(n,e,i){return new Promise(function(s,r){function o(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:r();break;case n.TIMEOUT_EXPIRED:setTimeout(o,i);break;default:s()}}setTimeout(o,i)})}function Zce(n){const e=n.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function Wce(n){const e=n.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const zW=new oi().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),FW=new oi().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Kx={[qi]:{transfer:Ox,primaries:Zx,luminanceCoefficients:[.2126,.7152,.0722],toReference:n=>n,fromReference:n=>n},[ut]:{transfer:Nn,primaries:Zx,luminanceCoefficients:[.2126,.7152,.0722],toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[ty]:{transfer:Ox,primaries:Wx,luminanceCoefficients:[.2289,.6917,.0793],toReference:n=>n.applyMatrix3(FW),fromReference:n=>n.applyMatrix3(zW)},[Ux]:{transfer:Nn,primaries:Wx,luminanceCoefficients:[.2289,.6917,.0793],toReference:n=>n.convertSRGBToLinear().applyMatrix3(FW),fromReference:n=>n.applyMatrix3(zW).convertLinearToSRGB()}},Hce=new Set([qi,ty]),hi={enabled:!0,_workingColorSpace:qi,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!Hce.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,i){if(this.enabled===!1||e===i||!e||!i)return n;const s=Kx[e].toReference,r=Kx[i].fromReference;return r(s(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return Kx[n].primaries},getTransfer:function(n){return n===ho?Ox:Kx[n].transfer},getLuminanceCoefficients:function(n,e=this._workingColorSpace){return n.fromArray(Kx[e].luminanceCoefficients)}};function ry(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function MG(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let oy,UW=class{static getDataURL(n){if(/^data:/i.test(n.src)||typeof HTMLCanvasElement>"u")return n.src;let e;if(n instanceof HTMLCanvasElement)e=n;else{oy===void 0&&(oy=Qx("canvas")),oy.width=n.width,oy.height=n.height;const i=oy.getContext("2d");n instanceof ImageData?i.putImageData(n,0,0):i.drawImage(n,0,0,n.width,n.height),e=oy}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",n),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(n){if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap){const e=Qx("canvas");e.width=n.width,e.height=n.height;const i=e.getContext("2d");i.drawImage(n,0,0,n.width,n.height);const s=i.getImageData(0,0,n.width,n.height),r=s.data;for(let o=0;o<r.length;o++)r[o]=ry(r[o]/255)*255;return i.putImageData(s,0,0),e}else if(n.data){const e=n.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(ry(e[i]/255)*255):e[i]=ry(e[i]);return{data:e,width:n.width,height:n.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),n}},Qce=0,wu=class{constructor(n=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Qce++}),this.uuid=xl(),this.data=n,this.dataReady=!0,this.version=0}set needsUpdate(n){n===!0&&this.version++}toJSON(n){const e=n===void 0||typeof n=="string";if(!e&&n.images[this.uuid]!==void 0)return n.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let o=0,a=s.length;o<a;o++)s[o].isDataTexture?r.push(IG(s[o].image)):r.push(IG(s[o]))}else r=IG(s);i.url=r}return e||(n.images[this.uuid]=i),i}};function IG(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?UW.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Kce=0,di=class Bk extends yr{constructor(e=Bk.DEFAULT_IMAGE,i=Bk.DEFAULT_MAPPING,s=Wo,r=Wo,o=Wt,a=Ar,l=_i,c=Xi,h=Bk.DEFAULT_ANISOTROPY,d=ho){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Kce++}),this.uuid=xl(),this.name="",this.source=new wu(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=s,this.wrapT=r,this.magFilter=o,this.minFilter=a,this.anisotropy=h,this.format=l,this.internalFormat=null,this.type=c,this.offset=new Q(0,0),this.repeat=new Q(1,1),this.center=new Q(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new oi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=d,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),i||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==DM)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case lo:e.x=e.x-Math.floor(e.x);break;case Wo:e.x=e.x<0?0:1;break;case bu:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case lo:e.y=e.y-Math.floor(e.y);break;case Wo:e.y=e.y<0?0:1;break;case bu:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}};di.DEFAULT_IMAGE=null,di.DEFAULT_MAPPING=DM,di.DEFAULT_ANISOTROPY=4;let $e=class Kle{constructor(e=0,i=0,s=0,r=1){Kle.prototype.isVector4=!0,this.x=e,this.y=i,this.z=s,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,s,r){return this.x=e,this.y=i,this.z=s,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,s=this.y,r=this.z,o=this.w,a=e.elements;return this.x=a[0]*i+a[4]*s+a[8]*r+a[12]*o,this.y=a[1]*i+a[5]*s+a[9]*r+a[13]*o,this.z=a[2]*i+a[6]*s+a[10]*r+a[14]*o,this.w=a[3]*i+a[7]*s+a[11]*r+a[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,s,r,o;const a=e.elements,l=a[0],c=a[4],h=a[8],d=a[1],u=a[5],p=a[9],g=a[2],f=a[6],A=a[10];if(Math.abs(c-d)<.01&&Math.abs(h-g)<.01&&Math.abs(p-f)<.01){if(Math.abs(c+d)<.1&&Math.abs(h+g)<.1&&Math.abs(p+f)<.1&&Math.abs(l+u+A-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const b=(l+1)/2,v=(u+1)/2,x=(A+1)/2,w=(c+d)/4,C=(h+g)/4,S=(p+f)/4;return b>v&&b>x?b<.01?(s=0,r=.707106781,o=.707106781):(s=Math.sqrt(b),r=w/s,o=C/s):v>x?v<.01?(s=.707106781,r=0,o=.707106781):(r=Math.sqrt(v),s=w/r,o=S/r):x<.01?(s=.707106781,r=.707106781,o=0):(o=Math.sqrt(x),s=C/o,r=S/o),this.set(s,r,o,i),this}let y=Math.sqrt((f-p)*(f-p)+(h-g)*(h-g)+(d-c)*(d-c));return Math.abs(y)<.001&&(y=1),this.x=(f-p)/y,this.y=(h-g)/y,this.z=(d-c)/y,this.w=Math.acos((l+u+A-1)/2),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this.z=e.z+(i.z-e.z)*s,this.w=e.w+(i.w-e.w)*s,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};class br extends yr{constructor(e=1,i=1,s={}){super(),this.isRenderTarget=!0,this.width=e,this.height=i,this.depth=1,this.scissor=new $e(0,0,e,i),this.scissorTest=!1,this.viewport=new $e(0,0,e,i);const r={width:e,height:i,depth:1};s=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Wt,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},s);const o=new di(r,s.mapping,s.wrapS,s.wrapT,s.magFilter,s.minFilter,s.format,s.type,s.anisotropy,s.colorSpace);o.flipY=!1,o.generateMipmaps=s.generateMipmaps,o.internalFormat=s.internalFormat,this.textures=[];const a=s.count;for(let l=0;l<a;l++)this.textures[l]=o.clone(),this.textures[l].isRenderTargetTexture=!0;this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,this.resolveDepthBuffer=s.resolveDepthBuffer,this.resolveStencilBuffer=s.resolveStencilBuffer,this.depthTexture=s.depthTexture,this.samples=s.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,i,s=1){if(this.width!==e||this.height!==i||this.depth!==s){this.width=e,this.height=i,this.depth=s;for(let r=0,o=this.textures.length;r<o;r++)this.textures[r].image.width=e,this.textures[r].image.height=i,this.textures[r].image.depth=s;this.dispose()}this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let s=0,r=e.textures.length;s<r;s++)this.textures[s]=e.textures[s].clone(),this.textures[s].isRenderTargetTexture=!0;const i=Object.assign({},e.texture.image);return this.texture.source=new wu(i),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class fi extends br{constructor(e=1,i=1,s={}){super(e,i,s),this.isWebGLRenderTarget=!0}}class Yx extends di{constructor(e=null,i=1,s=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:s,depth:r},this.magFilter=si,this.minFilter=si,this.wrapR=Wo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Yce extends fi{constructor(e=1,i=1,s=1,r={}){super(e,i,r),this.isWebGLArrayRenderTarget=!0,this.depth=s,this.texture=new Yx(null,e,i,s),this.texture.isRenderTargetTexture=!0}}let gI=class extends di{constructor(n=null,e=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:n,width:e,height:i,depth:s},this.magFilter=si,this.minFilter=si,this.wrapR=Wo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};class jce extends fi{constructor(e=1,i=1,s=1,r={}){super(e,i,r),this.isWebGL3DRenderTarget=!0,this.depth=s,this.texture=new gI(null,e,i,s),this.texture.isRenderTargetTexture=!0}}let Fe=class{constructor(n=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=n,this._y=e,this._z=i,this._w=s}static slerpFlat(n,e,i,s,r,o,a){let l=i[s+0],c=i[s+1],h=i[s+2],d=i[s+3];const u=r[o+0],p=r[o+1],g=r[o+2],f=r[o+3];if(a===0){n[e+0]=l,n[e+1]=c,n[e+2]=h,n[e+3]=d;return}if(a===1){n[e+0]=u,n[e+1]=p,n[e+2]=g,n[e+3]=f;return}if(d!==f||l!==u||c!==p||h!==g){let A=1-a;const y=l*u+c*p+h*g+d*f,b=y>=0?1:-1,v=1-y*y;if(v>Number.EPSILON){const w=Math.sqrt(v),C=Math.atan2(w,y*b);A=Math.sin(A*C)/w,a=Math.sin(a*C)/w}const x=a*b;if(l=l*A+u*x,c=c*A+p*x,h=h*A+g*x,d=d*A+f*x,A===1-a){const w=1/Math.sqrt(l*l+c*c+h*h+d*d);l*=w,c*=w,h*=w,d*=w}}n[e]=l,n[e+1]=c,n[e+2]=h,n[e+3]=d}static multiplyQuaternionsFlat(n,e,i,s,r,o){const a=i[s],l=i[s+1],c=i[s+2],h=i[s+3],d=r[o],u=r[o+1],p=r[o+2],g=r[o+3];return n[e]=a*g+h*d+l*p-c*u,n[e+1]=l*g+h*u+c*d-a*p,n[e+2]=c*g+h*p+a*u-l*d,n[e+3]=h*g-a*d-l*u-c*p,n}get x(){return this._x}set x(n){this._x=n,this._onChangeCallback()}get y(){return this._y}set y(n){this._y=n,this._onChangeCallback()}get z(){return this._z}set z(n){this._z=n,this._onChangeCallback()}get w(){return this._w}set w(n){this._w=n,this._onChangeCallback()}set(n,e,i,s){return this._x=n,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(n){return this._x=n.x,this._y=n.y,this._z=n.z,this._w=n.w,this._onChangeCallback(),this}setFromEuler(n,e=!0){const i=n._x,s=n._y,r=n._z,o=n._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(s/2),d=a(r/2),u=l(i/2),p=l(s/2),g=l(r/2);switch(o){case"XYZ":this._x=u*h*d+c*p*g,this._y=c*p*d-u*h*g,this._z=c*h*g+u*p*d,this._w=c*h*d-u*p*g;break;case"YXZ":this._x=u*h*d+c*p*g,this._y=c*p*d-u*h*g,this._z=c*h*g-u*p*d,this._w=c*h*d+u*p*g;break;case"ZXY":this._x=u*h*d-c*p*g,this._y=c*p*d+u*h*g,this._z=c*h*g+u*p*d,this._w=c*h*d-u*p*g;break;case"ZYX":this._x=u*h*d-c*p*g,this._y=c*p*d+u*h*g,this._z=c*h*g-u*p*d,this._w=c*h*d+u*p*g;break;case"YZX":this._x=u*h*d+c*p*g,this._y=c*p*d+u*h*g,this._z=c*h*g-u*p*d,this._w=c*h*d-u*p*g;break;case"XZY":this._x=u*h*d-c*p*g,this._y=c*p*d-u*h*g,this._z=c*h*g+u*p*d,this._w=c*h*d+u*p*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(n,e){const i=e/2,s=Math.sin(i);return this._x=n.x*s,this._y=n.y*s,this._z=n.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(n){const e=n.elements,i=e[0],s=e[4],r=e[8],o=e[1],a=e[5],l=e[9],c=e[2],h=e[6],d=e[10],u=i+a+d;if(u>0){const p=.5/Math.sqrt(u+1);this._w=.25/p,this._x=(h-l)*p,this._y=(r-c)*p,this._z=(o-s)*p}else if(i>a&&i>d){const p=2*Math.sqrt(1+i-a-d);this._w=(h-l)/p,this._x=.25*p,this._y=(s+o)/p,this._z=(r+c)/p}else if(a>d){const p=2*Math.sqrt(1+a-i-d);this._w=(r-c)/p,this._x=(s+o)/p,this._y=.25*p,this._z=(l+h)/p}else{const p=2*Math.sqrt(1+d-i-a);this._w=(o-s)/p,this._x=(r+c)/p,this._y=(l+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(n,e){let i=n.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(n.x)>Math.abs(n.z)?(this._x=-n.y,this._y=n.x,this._z=0,this._w=i):(this._x=0,this._y=-n.z,this._z=n.y,this._w=i)):(this._x=n.y*e.z-n.z*e.y,this._y=n.z*e.x-n.x*e.z,this._z=n.x*e.y-n.y*e.x,this._w=i),this.normalize()}angleTo(n){return 2*Math.acos(Math.abs(Ts(this.dot(n),-1,1)))}rotateTowards(n,e){const i=this.angleTo(n);if(i===0)return this;const s=Math.min(1,e/i);return this.slerp(n,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(n){return this._x*n._x+this._y*n._y+this._z*n._z+this._w*n._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let n=this.length();return n===0?(this._x=0,this._y=0,this._z=0,this._w=1):(n=1/n,this._x=this._x*n,this._y=this._y*n,this._z=this._z*n,this._w=this._w*n),this._onChangeCallback(),this}multiply(n){return this.multiplyQuaternions(this,n)}premultiply(n){return this.multiplyQuaternions(n,this)}multiplyQuaternions(n,e){const i=n._x,s=n._y,r=n._z,o=n._w,a=e._x,l=e._y,c=e._z,h=e._w;return this._x=i*h+o*a+s*c-r*l,this._y=s*h+o*l+r*a-i*c,this._z=r*h+o*c+i*l-s*a,this._w=o*h-i*a-s*l-r*c,this._onChangeCallback(),this}slerp(n,e){if(e===0)return this;if(e===1)return this.copy(n);const i=this._x,s=this._y,r=this._z,o=this._w;let a=o*n._w+i*n._x+s*n._y+r*n._z;if(a<0?(this._w=-n._w,this._x=-n._x,this._y=-n._y,this._z=-n._z,a=-a):this.copy(n),a>=1)return this._w=o,this._x=i,this._y=s,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const p=1-e;return this._w=p*o+e*this._w,this._x=p*i+e*this._x,this._y=p*s+e*this._y,this._z=p*r+e*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),d=Math.sin((1-e)*h)/c,u=Math.sin(e*h)/c;return this._w=o*d+this._w*u,this._x=i*d+this._x*u,this._y=s*d+this._y*u,this._z=r*d+this._z*u,this._onChangeCallback(),this}slerpQuaternions(n,e,i){return this.copy(n).slerp(e,i)}random(){const n=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(s*Math.sin(n),s*Math.cos(n),r*Math.sin(e),r*Math.cos(e))}equals(n){return n._x===this._x&&n._y===this._y&&n._z===this._z&&n._w===this._w}fromArray(n,e=0){return this._x=n[e],this._y=n[e+1],this._z=n[e+2],this._w=n[e+3],this._onChangeCallback(),this}toArray(n=[],e=0){return n[e]=this._x,n[e+1]=this._y,n[e+2]=this._z,n[e+3]=this._w,n}fromBufferAttribute(n,e){return this._x=n.getX(e),this._y=n.getY(e),this._z=n.getZ(e),this._w=n.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(n){return this._onChangeCallback=n,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},E=class Yle{constructor(e=0,i=0,s=0){Yle.prototype.isVector3=!0,this.x=e,this.y=i,this.z=s}set(e,i,s){return s===void 0&&(s=this.z),this.x=e,this.y=i,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(OW.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(OW.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,s=this.y,r=this.z,o=e.elements;return this.x=o[0]*i+o[3]*s+o[6]*r,this.y=o[1]*i+o[4]*s+o[7]*r,this.z=o[2]*i+o[5]*s+o[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,s=this.y,r=this.z,o=e.elements,a=1/(o[3]*i+o[7]*s+o[11]*r+o[15]);return this.x=(o[0]*i+o[4]*s+o[8]*r+o[12])*a,this.y=(o[1]*i+o[5]*s+o[9]*r+o[13])*a,this.z=(o[2]*i+o[6]*s+o[10]*r+o[14])*a,this}applyQuaternion(e){const i=this.x,s=this.y,r=this.z,o=e.x,a=e.y,l=e.z,c=e.w,h=2*(a*r-l*s),d=2*(l*i-o*r),u=2*(o*s-a*i);return this.x=i+c*h+a*u-l*d,this.y=s+c*d+l*h-o*u,this.z=r+c*u+o*d-a*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,s=this.y,r=this.z,o=e.elements;return this.x=o[0]*i+o[4]*s+o[8]*r,this.y=o[1]*i+o[5]*s+o[9]*r,this.z=o[2]*i+o[6]*s+o[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this.z=e.z+(i.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const s=e.x,r=e.y,o=e.z,a=i.x,l=i.y,c=i.z;return this.x=r*c-o*l,this.y=o*a-s*c,this.z=s*l-r*a,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const s=e.dot(this)/i;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return TG.copy(this).projectOnVector(e),this.sub(TG)}reflect(e){return this.sub(TG.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const s=this.dot(e)/i;return Math.acos(Ts(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y,r=this.z-e.z;return i*i+s*s+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,s){const r=Math.sin(i)*e;return this.x=r*Math.sin(s),this.y=Math.cos(i)*e,this.z=r*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,s){return this.x=e*Math.sin(i),this.y=s,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=s,this.z=r,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,s=Math.sqrt(1-i*i);return this.x=s*Math.cos(e),this.y=i,this.z=s*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const TG=new E,OW=new Fe;let gi=class{constructor(n=new E(1/0,1/0,1/0),e=new E(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=n,this.max=e}set(n,e){return this.min.copy(n),this.max.copy(e),this}setFromArray(n){this.makeEmpty();for(let e=0,i=n.length;e<i;e+=3)this.expandByPoint(rh.fromArray(n,e));return this}setFromBufferAttribute(n){this.makeEmpty();for(let e=0,i=n.count;e<i;e++)this.expandByPoint(rh.fromBufferAttribute(n,e));return this}setFromPoints(n){this.makeEmpty();for(let e=0,i=n.length;e<i;e++)this.expandByPoint(n[e]);return this}setFromCenterAndSize(n,e){const i=rh.copy(e).multiplyScalar(.5);return this.min.copy(n).sub(i),this.max.copy(n).add(i),this}setFromObject(n,e=!1){return this.makeEmpty(),this.expandByObject(n,e)}clone(){return new this.constructor().copy(this)}copy(n){return this.min.copy(n.min),this.max.copy(n.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(n){return this.isEmpty()?n.set(0,0,0):n.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(n){return this.isEmpty()?n.set(0,0,0):n.subVectors(this.max,this.min)}expandByPoint(n){return this.min.min(n),this.max.max(n),this}expandByVector(n){return this.min.sub(n),this.max.add(n),this}expandByScalar(n){return this.min.addScalar(-n),this.max.addScalar(n),this}expandByObject(n,e=!1){n.updateWorldMatrix(!1,!1);const i=n.geometry;if(i!==void 0){const r=i.getAttribute("position");if(e===!0&&r!==void 0&&n.isInstancedMesh!==!0)for(let o=0,a=r.count;o<a;o++)n.isMesh===!0?n.getVertexPosition(o,rh):rh.fromBufferAttribute(r,o),rh.applyMatrix4(n.matrixWorld),this.expandByPoint(rh);else n.boundingBox!==void 0?(n.boundingBox===null&&n.computeBoundingBox(),fI.copy(n.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),fI.copy(i.boundingBox)),fI.applyMatrix4(n.matrixWorld),this.union(fI)}const s=n.children;for(let r=0,o=s.length;r<o;r++)this.expandByObject(s[r],e);return this}containsPoint(n){return n.x>=this.min.x&&n.x<=this.max.x&&n.y>=this.min.y&&n.y<=this.max.y&&n.z>=this.min.z&&n.z<=this.max.z}containsBox(n){return this.min.x<=n.min.x&&n.max.x<=this.max.x&&this.min.y<=n.min.y&&n.max.y<=this.max.y&&this.min.z<=n.min.z&&n.max.z<=this.max.z}getParameter(n,e){return e.set((n.x-this.min.x)/(this.max.x-this.min.x),(n.y-this.min.y)/(this.max.y-this.min.y),(n.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(n){return n.max.x>=this.min.x&&n.min.x<=this.max.x&&n.max.y>=this.min.y&&n.min.y<=this.max.y&&n.max.z>=this.min.z&&n.min.z<=this.max.z}intersectsSphere(n){return this.clampPoint(n.center,rh),rh.distanceToSquared(n.center)<=n.radius*n.radius}intersectsPlane(n){let e,i;return n.normal.x>0?(e=n.normal.x*this.min.x,i=n.normal.x*this.max.x):(e=n.normal.x*this.max.x,i=n.normal.x*this.min.x),n.normal.y>0?(e+=n.normal.y*this.min.y,i+=n.normal.y*this.max.y):(e+=n.normal.y*this.max.y,i+=n.normal.y*this.min.y),n.normal.z>0?(e+=n.normal.z*this.min.z,i+=n.normal.z*this.max.z):(e+=n.normal.z*this.max.z,i+=n.normal.z*this.min.z),e<=-n.constant&&i>=-n.constant}intersectsTriangle(n){if(this.isEmpty())return!1;this.getCenter(jx),AI.subVectors(this.max,jx),ay.subVectors(n.a,jx),ly.subVectors(n.b,jx),cy.subVectors(n.c,jx),em.subVectors(ly,ay),tm.subVectors(cy,ly),Af.subVectors(ay,cy);let e=[0,-em.z,em.y,0,-tm.z,tm.y,0,-Af.z,Af.y,em.z,0,-em.x,tm.z,0,-tm.x,Af.z,0,-Af.x,-em.y,em.x,0,-tm.y,tm.x,0,-Af.y,Af.x,0];return!EG(e,ay,ly,cy,AI)||(e=[1,0,0,0,1,0,0,0,1],!EG(e,ay,ly,cy,AI))?!1:(yI.crossVectors(em,tm),e=[yI.x,yI.y,yI.z],EG(e,ay,ly,cy,AI))}clampPoint(n,e){return e.copy(n).clamp(this.min,this.max)}distanceToPoint(n){return this.clampPoint(n,rh).distanceTo(n)}getBoundingSphere(n){return this.isEmpty()?n.makeEmpty():(this.getCenter(n.center),n.radius=this.getSize(rh).length()*.5),n}intersect(n){return this.min.max(n.min),this.max.min(n.max),this.isEmpty()&&this.makeEmpty(),this}union(n){return this.min.min(n.min),this.max.max(n.max),this}applyMatrix4(n){return this.isEmpty()?this:(Cu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(n),Cu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(n),Cu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(n),Cu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(n),Cu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(n),Cu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(n),Cu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(n),Cu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(n),this.setFromPoints(Cu),this)}translate(n){return this.min.add(n),this.max.add(n),this}equals(n){return n.min.equals(this.min)&&n.max.equals(this.max)}};const Cu=[new E,new E,new E,new E,new E,new E,new E,new E],rh=new E,fI=new gi,ay=new E,ly=new E,cy=new E,em=new E,tm=new E,Af=new E,jx=new E,AI=new E,yI=new E,yf=new E;function EG(n,e,i,s,r){for(let o=0,a=n.length-3;o<=a;o+=3){yf.fromArray(n,o);const l=r.x*Math.abs(yf.x)+r.y*Math.abs(yf.y)+r.z*Math.abs(yf.z),c=e.dot(yf),h=i.dot(yf),d=s.dot(yf);if(Math.max(-Math.max(c,h,d),Math.min(c,h,d))>l)return!1}return!0}const Jce=new gi,Jx=new E,RG=new E;let Vn=class{constructor(n=new E,e=-1){this.isSphere=!0,this.center=n,this.radius=e}set(n,e){return this.center.copy(n),this.radius=e,this}setFromPoints(n,e){const i=this.center;e!==void 0?i.copy(e):Jce.setFromPoints(n).getCenter(i);let s=0;for(let r=0,o=n.length;r<o;r++)s=Math.max(s,i.distanceToSquared(n[r]));return this.radius=Math.sqrt(s),this}copy(n){return this.center.copy(n.center),this.radius=n.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(n){return n.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(n){return n.distanceTo(this.center)-this.radius}intersectsSphere(n){const e=this.radius+n.radius;return n.center.distanceToSquared(this.center)<=e*e}intersectsBox(n){return n.intersectsSphere(this)}intersectsPlane(n){return Math.abs(n.distanceToPoint(this.center))<=this.radius}clampPoint(n,e){const i=this.center.distanceToSquared(n);return e.copy(n),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(n){return this.isEmpty()?(n.makeEmpty(),n):(n.set(this.center,this.center),n.expandByScalar(this.radius),n)}applyMatrix4(n){return this.center.applyMatrix4(n),this.radius=this.radius*n.getMaxScaleOnAxis(),this}translate(n){return this.center.add(n),this}expandByPoint(n){if(this.isEmpty())return this.center.copy(n),this.radius=0,this;Jx.subVectors(n,this.center);const e=Jx.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),s=(i-this.radius)*.5;this.center.addScaledVector(Jx,s/i),this.radius+=s}return this}union(n){return n.isEmpty()?this:this.isEmpty()?(this.copy(n),this):(this.center.equals(n.center)===!0?this.radius=Math.max(this.radius,n.radius):(RG.subVectors(n.center,this.center).setLength(n.radius),this.expandByPoint(Jx.copy(n.center).add(RG)),this.expandByPoint(Jx.copy(n.center).sub(RG))),this)}equals(n){return n.center.equals(this.center)&&n.radius===this.radius}clone(){return new this.constructor().copy(this)}};const Su=new E,LG=new E,bI=new E,im=new E,BG=new E,vI=new E,kG=new E;let ya=class{constructor(n=new E,e=new E(0,0,-1)){this.origin=n,this.direction=e}set(n,e){return this.origin.copy(n),this.direction.copy(e),this}copy(n){return this.origin.copy(n.origin),this.direction.copy(n.direction),this}at(n,e){return e.copy(this.origin).addScaledVector(this.direction,n)}lookAt(n){return this.direction.copy(n).sub(this.origin).normalize(),this}recast(n){return this.origin.copy(this.at(n,Su)),this}closestPointToPoint(n,e){e.subVectors(n,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(n){return Math.sqrt(this.distanceSqToPoint(n))}distanceSqToPoint(n){const e=Su.subVectors(n,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(n):(Su.copy(this.origin).addScaledVector(this.direction,e),Su.distanceToSquared(n))}distanceSqToSegment(n,e,i,s){LG.copy(n).add(e).multiplyScalar(.5),bI.copy(e).sub(n).normalize(),im.copy(this.origin).sub(LG);const r=n.distanceTo(e)*.5,o=-this.direction.dot(bI),a=im.dot(this.direction),l=-im.dot(bI),c=im.lengthSq(),h=Math.abs(1-o*o);let d,u,p,g;if(h>0)if(d=o*l-a,u=o*a-l,g=r*h,d>=0)if(u>=-g)if(u<=g){const f=1/h;d*=f,u*=f,p=d*(d+o*u+2*a)+u*(o*d+u+2*l)+c}else u=r,d=Math.max(0,-(o*u+a)),p=-d*d+u*(u+2*l)+c;else u=-r,d=Math.max(0,-(o*u+a)),p=-d*d+u*(u+2*l)+c;else u<=-g?(d=Math.max(0,-(-o*r+a)),u=d>0?-r:Math.min(Math.max(-r,-l),r),p=-d*d+u*(u+2*l)+c):u<=g?(d=0,u=Math.min(Math.max(-r,-l),r),p=u*(u+2*l)+c):(d=Math.max(0,-(o*r+a)),u=d>0?r:Math.min(Math.max(-r,-l),r),p=-d*d+u*(u+2*l)+c);else u=o>0?-r:r,d=Math.max(0,-(o*u+a)),p=-d*d+u*(u+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,d),s&&s.copy(LG).addScaledVector(bI,u),p}intersectSphere(n,e){Su.subVectors(n.center,this.origin);const i=Su.dot(this.direction),s=Su.dot(Su)-i*i,r=n.radius*n.radius;if(s>r)return null;const o=Math.sqrt(r-s),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,e):this.at(a,e)}intersectsSphere(n){return this.distanceSqToPoint(n.center)<=n.radius*n.radius}distanceToPlane(n){const e=n.normal.dot(this.direction);if(e===0)return n.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(n.normal)+n.constant)/e;return i>=0?i:null}intersectPlane(n,e){const i=this.distanceToPlane(n);return i===null?null:this.at(i,e)}intersectsPlane(n){const e=n.distanceToPoint(this.origin);return e===0||n.normal.dot(this.direction)*e<0}intersectBox(n,e){let i,s,r,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,d=1/this.direction.z,u=this.origin;return c>=0?(i=(n.min.x-u.x)*c,s=(n.max.x-u.x)*c):(i=(n.max.x-u.x)*c,s=(n.min.x-u.x)*c),h>=0?(r=(n.min.y-u.y)*h,o=(n.max.y-u.y)*h):(r=(n.max.y-u.y)*h,o=(n.min.y-u.y)*h),i>o||r>s||((r>i||isNaN(i))&&(i=r),(o<s||isNaN(s))&&(s=o),d>=0?(a=(n.min.z-u.z)*d,l=(n.max.z-u.z)*d):(a=(n.max.z-u.z)*d,l=(n.min.z-u.z)*d),i>l||a>s)||((a>i||i!==i)&&(i=a),(l<s||s!==s)&&(s=l),s<0)?null:this.at(i>=0?i:s,e)}intersectsBox(n){return this.intersectBox(n,Su)!==null}intersectTriangle(n,e,i,s,r){BG.subVectors(e,n),vI.subVectors(i,n),kG.crossVectors(BG,vI);let o=this.direction.dot(kG),a;if(o>0){if(s)return null;a=1}else if(o<0)a=-1,o=-o;else return null;im.subVectors(this.origin,n);const l=a*this.direction.dot(vI.crossVectors(im,vI));if(l<0)return null;const c=a*this.direction.dot(BG.cross(im));if(c<0||l+c>o)return null;const h=-a*im.dot(kG);return h<0?null:this.at(h/o,r)}applyMatrix4(n){return this.origin.applyMatrix4(n),this.direction.transformDirection(n),this}equals(n){return n.origin.equals(this.origin)&&n.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},de=class BZ{constructor(e,i,s,r,o,a,l,c,h,d,u,p,g,f,A,y){BZ.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,s,r,o,a,l,c,h,d,u,p,g,f,A,y)}set(e,i,s,r,o,a,l,c,h,d,u,p,g,f,A,y){const b=this.elements;return b[0]=e,b[4]=i,b[8]=s,b[12]=r,b[1]=o,b[5]=a,b[9]=l,b[13]=c,b[2]=h,b[6]=d,b[10]=u,b[14]=p,b[3]=g,b[7]=f,b[11]=A,b[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new BZ().fromArray(this.elements)}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],this}copyPosition(e){const i=this.elements,s=e.elements;return i[12]=s[12],i[13]=s[13],i[14]=s[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,s){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,i,s){return this.set(e.x,i.x,s.x,0,e.y,i.y,s.y,0,e.z,i.z,s.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,s=e.elements,r=1/hy.setFromMatrixColumn(e,0).length(),o=1/hy.setFromMatrixColumn(e,1).length(),a=1/hy.setFromMatrixColumn(e,2).length();return i[0]=s[0]*r,i[1]=s[1]*r,i[2]=s[2]*r,i[3]=0,i[4]=s[4]*o,i[5]=s[5]*o,i[6]=s[6]*o,i[7]=0,i[8]=s[8]*a,i[9]=s[9]*a,i[10]=s[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,s=e.x,r=e.y,o=e.z,a=Math.cos(s),l=Math.sin(s),c=Math.cos(r),h=Math.sin(r),d=Math.cos(o),u=Math.sin(o);if(e.order==="XYZ"){const p=a*d,g=a*u,f=l*d,A=l*u;i[0]=c*d,i[4]=-c*u,i[8]=h,i[1]=g+f*h,i[5]=p-A*h,i[9]=-l*c,i[2]=A-p*h,i[6]=f+g*h,i[10]=a*c}else if(e.order==="YXZ"){const p=c*d,g=c*u,f=h*d,A=h*u;i[0]=p+A*l,i[4]=f*l-g,i[8]=a*h,i[1]=a*u,i[5]=a*d,i[9]=-l,i[2]=g*l-f,i[6]=A+p*l,i[10]=a*c}else if(e.order==="ZXY"){const p=c*d,g=c*u,f=h*d,A=h*u;i[0]=p-A*l,i[4]=-a*u,i[8]=f+g*l,i[1]=g+f*l,i[5]=a*d,i[9]=A-p*l,i[2]=-a*h,i[6]=l,i[10]=a*c}else if(e.order==="ZYX"){const p=a*d,g=a*u,f=l*d,A=l*u;i[0]=c*d,i[4]=f*h-g,i[8]=p*h+A,i[1]=c*u,i[5]=A*h+p,i[9]=g*h-f,i[2]=-h,i[6]=l*c,i[10]=a*c}else if(e.order==="YZX"){const p=a*c,g=a*h,f=l*c,A=l*h;i[0]=c*d,i[4]=A-p*u,i[8]=f*u+g,i[1]=u,i[5]=a*d,i[9]=-l*d,i[2]=-h*d,i[6]=g*u+f,i[10]=p-A*u}else if(e.order==="XZY"){const p=a*c,g=a*h,f=l*c,A=l*h;i[0]=c*d,i[4]=-u,i[8]=h*d,i[1]=p*u+A,i[5]=a*d,i[9]=g*u-f,i[2]=f*u-g,i[6]=l*d,i[10]=A*u+p}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(qce,e,$ce)}lookAt(e,i,s){const r=this.elements;return wl.subVectors(e,i),wl.lengthSq()===0&&(wl.z=1),wl.normalize(),nm.crossVectors(s,wl),nm.lengthSq()===0&&(Math.abs(s.z)===1?wl.x+=1e-4:wl.z+=1e-4,wl.normalize(),nm.crossVectors(s,wl)),nm.normalize(),xI.crossVectors(wl,nm),r[0]=nm.x,r[4]=xI.x,r[8]=wl.x,r[1]=nm.y,r[5]=xI.y,r[9]=wl.y,r[2]=nm.z,r[6]=xI.z,r[10]=wl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,r=i.elements,o=this.elements,a=s[0],l=s[4],c=s[8],h=s[12],d=s[1],u=s[5],p=s[9],g=s[13],f=s[2],A=s[6],y=s[10],b=s[14],v=s[3],x=s[7],w=s[11],C=s[15],S=r[0],_=r[4],I=r[8],B=r[12],M=r[1],R=r[5],k=r[9],G=r[13],X=r[2],F=r[6],z=r[10],H=r[14],Z=r[3],he=r[7],be=r[11],_e=r[15];return o[0]=a*S+l*M+c*X+h*Z,o[4]=a*_+l*R+c*F+h*he,o[8]=a*I+l*k+c*z+h*be,o[12]=a*B+l*G+c*H+h*_e,o[1]=d*S+u*M+p*X+g*Z,o[5]=d*_+u*R+p*F+g*he,o[9]=d*I+u*k+p*z+g*be,o[13]=d*B+u*G+p*H+g*_e,o[2]=f*S+A*M+y*X+b*Z,o[6]=f*_+A*R+y*F+b*he,o[10]=f*I+A*k+y*z+b*be,o[14]=f*B+A*G+y*H+b*_e,o[3]=v*S+x*M+w*X+C*Z,o[7]=v*_+x*R+w*F+C*he,o[11]=v*I+x*k+w*z+C*be,o[15]=v*B+x*G+w*H+C*_e,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[4],r=e[8],o=e[12],a=e[1],l=e[5],c=e[9],h=e[13],d=e[2],u=e[6],p=e[10],g=e[14],f=e[3],A=e[7],y=e[11],b=e[15];return f*(+o*c*u-r*h*u-o*l*p+s*h*p+r*l*g-s*c*g)+A*(+i*c*g-i*h*p+o*a*p-r*a*g+r*h*d-o*c*d)+y*(+i*h*u-i*l*g-o*a*u+s*a*g+o*l*d-s*h*d)+b*(-r*l*d-i*c*u+i*l*p+r*a*u-s*a*p+s*c*d)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,s){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=i,r[14]=s),this}invert(){const e=this.elements,i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],u=e[9],p=e[10],g=e[11],f=e[12],A=e[13],y=e[14],b=e[15],v=u*y*h-A*p*h+A*c*g-l*y*g-u*c*b+l*p*b,x=f*p*h-d*y*h-f*c*g+a*y*g+d*c*b-a*p*b,w=d*A*h-f*u*h+f*l*g-a*A*g-d*l*b+a*u*b,C=f*u*c-d*A*c-f*l*p+a*A*p+d*l*y-a*u*y,S=i*v+s*x+r*w+o*C;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _=1/S;return e[0]=v*_,e[1]=(A*p*o-u*y*o-A*r*g+s*y*g+u*r*b-s*p*b)*_,e[2]=(l*y*o-A*c*o+A*r*h-s*y*h-l*r*b+s*c*b)*_,e[3]=(u*c*o-l*p*o-u*r*h+s*p*h+l*r*g-s*c*g)*_,e[4]=x*_,e[5]=(d*y*o-f*p*o+f*r*g-i*y*g-d*r*b+i*p*b)*_,e[6]=(f*c*o-a*y*o-f*r*h+i*y*h+a*r*b-i*c*b)*_,e[7]=(a*p*o-d*c*o+d*r*h-i*p*h-a*r*g+i*c*g)*_,e[8]=w*_,e[9]=(f*u*o-d*A*o-f*s*g+i*A*g+d*s*b-i*u*b)*_,e[10]=(a*A*o-f*l*o+f*s*h-i*A*h-a*s*b+i*l*b)*_,e[11]=(d*l*o-a*u*o-d*s*h+i*u*h+a*s*g-i*l*g)*_,e[12]=C*_,e[13]=(d*A*r-f*u*r+f*s*p-i*A*p-d*s*y+i*u*y)*_,e[14]=(f*l*r-a*A*r-f*s*c+i*A*c+a*s*y-i*l*y)*_,e[15]=(a*u*r-d*l*r+d*s*c-i*u*c-a*s*p+i*l*p)*_,this}scale(e){const i=this.elements,s=e.x,r=e.y,o=e.z;return i[0]*=s,i[4]*=r,i[8]*=o,i[1]*=s,i[5]*=r,i[9]*=o,i[2]*=s,i[6]*=r,i[10]*=o,i[3]*=s,i[7]*=r,i[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,s,r))}makeTranslation(e,i,s){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,s,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,i,-s,0,0,s,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,0,s,0,0,1,0,0,-s,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,-s,0,0,s,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const s=Math.cos(i),r=Math.sin(i),o=1-s,a=e.x,l=e.y,c=e.z,h=o*a,d=o*l;return this.set(h*a+s,h*l-r*c,h*c+r*l,0,h*l+r*c,d*l+s,d*c-r*a,0,h*c-r*l,d*c+r*a,o*c*c+s,0,0,0,0,1),this}makeScale(e,i,s){return this.set(e,0,0,0,0,i,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,i,s,r,o,a){return this.set(1,s,o,0,e,1,a,0,i,r,1,0,0,0,0,1),this}compose(e,i,s){const r=this.elements,o=i._x,a=i._y,l=i._z,c=i._w,h=o+o,d=a+a,u=l+l,p=o*h,g=o*d,f=o*u,A=a*d,y=a*u,b=l*u,v=c*h,x=c*d,w=c*u,C=s.x,S=s.y,_=s.z;return r[0]=(1-(A+b))*C,r[1]=(g+w)*C,r[2]=(f-x)*C,r[3]=0,r[4]=(g-w)*S,r[5]=(1-(p+b))*S,r[6]=(y+v)*S,r[7]=0,r[8]=(f+x)*_,r[9]=(y-v)*_,r[10]=(1-(p+A))*_,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,i,s){const r=this.elements;let o=hy.set(r[0],r[1],r[2]).length();const a=hy.set(r[4],r[5],r[6]).length(),l=hy.set(r[8],r[9],r[10]).length();this.determinant()<0&&(o=-o),e.x=r[12],e.y=r[13],e.z=r[14],oh.copy(this);const c=1/o,h=1/a,d=1/l;return oh.elements[0]*=c,oh.elements[1]*=c,oh.elements[2]*=c,oh.elements[4]*=h,oh.elements[5]*=h,oh.elements[6]*=h,oh.elements[8]*=d,oh.elements[9]*=d,oh.elements[10]*=d,i.setFromRotationMatrix(oh),s.x=o,s.y=a,s.z=l,this}makePerspective(e,i,s,r,o,a,l=Ac){const c=this.elements,h=2*o/(i-e),d=2*o/(s-r),u=(i+e)/(i-e),p=(s+r)/(s-r);let g,f;if(l===Ac)g=-(a+o)/(a-o),f=-2*a*o/(a-o);else if(l===gf)g=-a/(a-o),f=-a*o/(a-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return c[0]=h,c[4]=0,c[8]=u,c[12]=0,c[1]=0,c[5]=d,c[9]=p,c[13]=0,c[2]=0,c[6]=0,c[10]=g,c[14]=f,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,s,r,o,a,l=Ac){const c=this.elements,h=1/(i-e),d=1/(s-r),u=1/(a-o),p=(i+e)*h,g=(s+r)*d;let f,A;if(l===Ac)f=(a+o)*u,A=-2*u;else if(l===gf)f=o*u,A=-1*u;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-p,c[1]=0,c[5]=2*d,c[9]=0,c[13]=-g,c[2]=0,c[6]=0,c[10]=A,c[14]=-f,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,s=e.elements;for(let r=0;r<16;r++)if(i[r]!==s[r])return!1;return!0}fromArray(e,i=0){for(let s=0;s<16;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e[i+9]=s[9],e[i+10]=s[10],e[i+11]=s[11],e[i+12]=s[12],e[i+13]=s[13],e[i+14]=s[14],e[i+15]=s[15],e}};const hy=new E,oh=new de,qce=new E(0,0,0),$ce=new E(1,1,1),nm=new E,xI=new E,wl=new E,ZW=new de,WW=new Fe;let Oi=class jle{constructor(e=0,i=0,s=0,r=jle.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=s,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,s,r=this._order){return this._x=e,this._y=i,this._z=s,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,s=!0){const r=e.elements,o=r[0],a=r[4],l=r[8],c=r[1],h=r[5],d=r[9],u=r[2],p=r[6],g=r[10];switch(i){case"XYZ":this._y=Math.asin(Ts(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,g),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(p,h),this._z=0);break;case"YXZ":this._x=Math.asin(-Ts(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(l,g),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-u,o),this._z=0);break;case"ZXY":this._x=Math.asin(Ts(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-u,g),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-Ts(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(p,g),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-a,h));break;case"YZX":this._z=Math.asin(Ts(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-d,h),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(l,g));break;case"XZY":this._z=Math.asin(-Ts(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(p,h),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-d,g),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,s===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,s){return ZW.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ZW,i,s)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return WW.setFromEuler(this),this.setFromQuaternion(WW,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Oi.DEFAULT_ORDER="XYZ";let Qo=class{constructor(){this.mask=1}set(n){this.mask=(1<<n|0)>>>0}enable(n){this.mask|=1<<n|0}enableAll(){this.mask=-1}toggle(n){this.mask^=1<<n|0}disable(n){this.mask&=~(1<<n|0)}disableAll(){this.mask=0}test(n){return(this.mask&n.mask)!==0}isEnabled(n){return(this.mask&(1<<n|0))!==0}},ehe=0;const HW=new E,dy=new Fe,_u=new de,wI=new E,qx=new E,the=new E,ihe=new Fe,QW=new E(1,0,0),KW=new E(0,1,0),YW=new E(0,0,1),jW={type:"added"},nhe={type:"removed"},uy={type:"childadded",child:null},GG={type:"childremoved",child:null};let Ae=class kk extends yr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ehe++}),this.uuid=xl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=kk.DEFAULT_UP.clone();const e=new E,i=new Oi,s=new Fe,r=new E(1,1,1);function o(){s.setFromEuler(i,!1)}function a(){i.setFromQuaternion(s,void 0,!1)}i._onChange(o),s._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new de},normalMatrix:{value:new oi}}),this.matrix=new de,this.matrixWorld=new de,this.matrixAutoUpdate=kk.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=kk.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Qo,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return dy.setFromAxisAngle(e,i),this.quaternion.multiply(dy),this}rotateOnWorldAxis(e,i){return dy.setFromAxisAngle(e,i),this.quaternion.premultiply(dy),this}rotateX(e){return this.rotateOnAxis(QW,e)}rotateY(e){return this.rotateOnAxis(KW,e)}rotateZ(e){return this.rotateOnAxis(YW,e)}translateOnAxis(e,i){return HW.copy(e).applyQuaternion(this.quaternion),this.position.add(HW.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(QW,e)}translateY(e){return this.translateOnAxis(KW,e)}translateZ(e){return this.translateOnAxis(YW,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(_u.copy(this.matrixWorld).invert())}lookAt(e,i,s){e.isVector3?wI.copy(e):wI.set(e,i,s);const r=this.parent;this.updateWorldMatrix(!0,!1),qx.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_u.lookAt(qx,wI,this.up):_u.lookAt(wI,qx,this.up),this.quaternion.setFromRotationMatrix(_u),r&&(_u.extractRotation(r.matrixWorld),dy.setFromRotationMatrix(_u),this.quaternion.premultiply(dy.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(jW),uy.child=e,this.dispatchEvent(uy),uy.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(nhe),GG.child=e,this.dispatchEvent(GG),GG.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),_u.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),_u.multiply(e.parent.matrixWorld)),e.applyMatrix4(_u),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(jW),uy.child=e,this.dispatchEvent(uy),uy.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let s=0,r=this.children.length;s<r;s++){const o=this.children[s].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,s=[]){this[e]===i&&s.push(this);const r=this.children;for(let o=0,a=r.length;o<a;o++)r[o].getObjectsByProperty(e,i,s);return s}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qx,e,the),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qx,ihe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].updateMatrixWorld(e)}updateWorldMatrix(e,i){const s=this.parent;if(e===!0&&s!==null&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const r=this.children;for(let o=0,a=r.length;o<a;o++)r[o].updateWorldMatrix(!1,!0)}}toJSON(e){const i=e===void 0||typeof e=="string",s={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(l=>({boxInitialized:l.boxInitialized,boxMin:l.box.min.toArray(),boxMax:l.box.max.toArray(),sphereInitialized:l.sphereInitialized,sphereRadius:l.sphere.radius,sphereCenter:l.sphere.center.toArray()})),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function o(l,c){return l[c.uuid]===void 0&&(l[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=o(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const c=l.shapes;if(Array.isArray(c))for(let h=0,d=c.length;h<d;h++){const u=c[h];o(e.shapes,u)}else o(e.shapes,c)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let c=0,h=this.material.length;c<h;c++)l.push(o(e.materials,this.material[c]));r.material=l}else r.material=o(e.materials,this.material);if(this.children.length>0){r.children=[];for(let l=0;l<this.children.length;l++)r.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let l=0;l<this.animations.length;l++){const c=this.animations[l];r.animations.push(o(e.animations,c))}}if(i){const l=a(e.geometries),c=a(e.materials),h=a(e.textures),d=a(e.images),u=a(e.shapes),p=a(e.skeletons),g=a(e.animations),f=a(e.nodes);l.length>0&&(s.geometries=l),c.length>0&&(s.materials=c),h.length>0&&(s.textures=h),d.length>0&&(s.images=d),u.length>0&&(s.shapes=u),p.length>0&&(s.skeletons=p),g.length>0&&(s.animations=g),f.length>0&&(s.nodes=f)}return s.object=r,s;function a(l){const c=[];for(const h in l){const d=l[h];delete d.metadata,c.push(d)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let s=0;s<e.children.length;s++){const r=e.children[s];this.add(r.clone())}return this}};Ae.DEFAULT_UP=new E(0,1,0),Ae.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ae.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ah=new E,Mu=new E,PG=new E,Iu=new E,py=new E,my=new E,JW=new E,NG=new E,VG=new E,XG=new E,DG=new $e,zG=new $e,FG=new $e;let $s=class yx{constructor(e=new E,i=new E,s=new E){this.a=e,this.b=i,this.c=s}static getNormal(e,i,s,r){r.subVectors(s,i),ah.subVectors(e,i),r.cross(ah);const o=r.lengthSq();return o>0?r.multiplyScalar(1/Math.sqrt(o)):r.set(0,0,0)}static getBarycoord(e,i,s,r,o){ah.subVectors(r,i),Mu.subVectors(s,i),PG.subVectors(e,i);const a=ah.dot(ah),l=ah.dot(Mu),c=ah.dot(PG),h=Mu.dot(Mu),d=Mu.dot(PG),u=a*h-l*l;if(u===0)return o.set(0,0,0),null;const p=1/u,g=(h*c-l*d)*p,f=(a*d-l*c)*p;return o.set(1-g-f,f,g)}static containsPoint(e,i,s,r){return this.getBarycoord(e,i,s,r,Iu)===null?!1:Iu.x>=0&&Iu.y>=0&&Iu.x+Iu.y<=1}static getInterpolation(e,i,s,r,o,a,l,c){return this.getBarycoord(e,i,s,r,Iu)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(o,Iu.x),c.addScaledVector(a,Iu.y),c.addScaledVector(l,Iu.z),c)}static getInterpolatedAttribute(e,i,s,r,o,a){return DG.setScalar(0),zG.setScalar(0),FG.setScalar(0),DG.fromBufferAttribute(e,i),zG.fromBufferAttribute(e,s),FG.fromBufferAttribute(e,r),a.setScalar(0),a.addScaledVector(DG,o.x),a.addScaledVector(zG,o.y),a.addScaledVector(FG,o.z),a}static isFrontFacing(e,i,s,r){return ah.subVectors(s,i),Mu.subVectors(e,i),ah.cross(Mu).dot(r)<0}set(e,i,s){return this.a.copy(e),this.b.copy(i),this.c.copy(s),this}setFromPointsAndIndices(e,i,s,r){return this.a.copy(e[i]),this.b.copy(e[s]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,i,s,r){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,s),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ah.subVectors(this.c,this.b),Mu.subVectors(this.a,this.b),ah.cross(Mu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return yx.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return yx.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,s,r,o){return yx.getInterpolation(e,this.a,this.b,this.c,i,s,r,o)}containsPoint(e){return yx.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return yx.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const s=this.a,r=this.b,o=this.c;let a,l;py.subVectors(r,s),my.subVectors(o,s),NG.subVectors(e,s);const c=py.dot(NG),h=my.dot(NG);if(c<=0&&h<=0)return i.copy(s);VG.subVectors(e,r);const d=py.dot(VG),u=my.dot(VG);if(d>=0&&u<=d)return i.copy(r);const p=c*u-d*h;if(p<=0&&c>=0&&d<=0)return a=c/(c-d),i.copy(s).addScaledVector(py,a);XG.subVectors(e,o);const g=py.dot(XG),f=my.dot(XG);if(f>=0&&g<=f)return i.copy(o);const A=g*h-c*f;if(A<=0&&h>=0&&f<=0)return l=h/(h-f),i.copy(s).addScaledVector(my,l);const y=d*f-g*u;if(y<=0&&u-d>=0&&g-f>=0)return JW.subVectors(o,r),l=(u-d)/(u-d+(g-f)),i.copy(r).addScaledVector(JW,l);const b=1/(y+A+p);return a=A*b,l=p*b,i.copy(s).addScaledVector(py,a).addScaledVector(my,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};const qW={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},sm={h:0,s:0,l:0},CI={h:0,s:0,l:0};function UG(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*6*(2/3-i):n}let fe=class{constructor(n,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(n,e,i)}set(n,e,i){if(e===void 0&&i===void 0){const s=n;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(n,e,i);return this}setScalar(n){return this.r=n,this.g=n,this.b=n,this}setHex(n,e=ut){return n=Math.floor(n),this.r=(n>>16&255)/255,this.g=(n>>8&255)/255,this.b=(n&255)/255,hi.toWorkingColorSpace(this,e),this}setRGB(n,e,i,s=hi.workingColorSpace){return this.r=n,this.g=e,this.b=i,hi.toWorkingColorSpace(this,s),this}setHSL(n,e,i,s=hi.workingColorSpace){if(n=SG(n,1),e=Ts(e,0,1),i=Ts(i,0,1),e===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+e):i+e-i*e,o=2*i-r;this.r=UG(o,r,n+1/3),this.g=UG(o,r,n),this.b=UG(o,r,n-1/3)}return hi.toWorkingColorSpace(this,s),this}setStyle(n,e=ut){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+n+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(n)){let r;const o=s[1],a=s[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,e);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+n)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(n)){const r=s[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(r,16),e);console.warn("THREE.Color: Invalid hex color "+n)}else if(n&&n.length>0)return this.setColorName(n,e);return this}setColorName(n,e=ut){const i=qW[n.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+n),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(n){return this.r=n.r,this.g=n.g,this.b=n.b,this}copySRGBToLinear(n){return this.r=ry(n.r),this.g=ry(n.g),this.b=ry(n.b),this}copyLinearToSRGB(n){return this.r=MG(n.r),this.g=MG(n.g),this.b=MG(n.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(n=ut){return hi.fromWorkingColorSpace(Ko.copy(this),n),Math.round(Ts(Ko.r*255,0,255))*65536+Math.round(Ts(Ko.g*255,0,255))*256+Math.round(Ts(Ko.b*255,0,255))}getHexString(n=ut){return("000000"+this.getHex(n).toString(16)).slice(-6)}getHSL(n,e=hi.workingColorSpace){hi.fromWorkingColorSpace(Ko.copy(this),e);const i=Ko.r,s=Ko.g,r=Ko.b,o=Math.max(i,s,r),a=Math.min(i,s,r);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const d=o-a;switch(c=h<=.5?d/(o+a):d/(2-o-a),o){case i:l=(s-r)/d+(s<r?6:0);break;case s:l=(r-i)/d+2;break;case r:l=(i-s)/d+4;break}l/=6}return n.h=l,n.s=c,n.l=h,n}getRGB(n,e=hi.workingColorSpace){return hi.fromWorkingColorSpace(Ko.copy(this),e),n.r=Ko.r,n.g=Ko.g,n.b=Ko.b,n}getStyle(n=ut){hi.fromWorkingColorSpace(Ko.copy(this),n);const e=Ko.r,i=Ko.g,s=Ko.b;return n!==ut?`color(${n} ${e.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(n,e,i){return this.getHSL(sm),this.setHSL(sm.h+n,sm.s+e,sm.l+i)}add(n){return this.r+=n.r,this.g+=n.g,this.b+=n.b,this}addColors(n,e){return this.r=n.r+e.r,this.g=n.g+e.g,this.b=n.b+e.b,this}addScalar(n){return this.r+=n,this.g+=n,this.b+=n,this}sub(n){return this.r=Math.max(0,this.r-n.r),this.g=Math.max(0,this.g-n.g),this.b=Math.max(0,this.b-n.b),this}multiply(n){return this.r*=n.r,this.g*=n.g,this.b*=n.b,this}multiplyScalar(n){return this.r*=n,this.g*=n,this.b*=n,this}lerp(n,e){return this.r+=(n.r-this.r)*e,this.g+=(n.g-this.g)*e,this.b+=(n.b-this.b)*e,this}lerpColors(n,e,i){return this.r=n.r+(e.r-n.r)*i,this.g=n.g+(e.g-n.g)*i,this.b=n.b+(e.b-n.b)*i,this}lerpHSL(n,e){this.getHSL(sm),n.getHSL(CI);const i=Hx(sm.h,CI.h,e),s=Hx(sm.s,CI.s,e),r=Hx(sm.l,CI.l,e);return this.setHSL(i,s,r),this}setFromVector3(n){return this.r=n.x,this.g=n.y,this.b=n.z,this}applyMatrix3(n){const e=this.r,i=this.g,s=this.b,r=n.elements;return this.r=r[0]*e+r[3]*i+r[6]*s,this.g=r[1]*e+r[4]*i+r[7]*s,this.b=r[2]*e+r[5]*i+r[8]*s,this}equals(n){return n.r===this.r&&n.g===this.g&&n.b===this.b}fromArray(n,e=0){return this.r=n[e],this.g=n[e+1],this.b=n[e+2],this}toArray(n=[],e=0){return n[e]=this.r,n[e+1]=this.g,n[e+2]=this.b,n}fromBufferAttribute(n,e){return this.r=n.getX(e),this.g=n.getY(e),this.b=n.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Ko=new fe;fe.NAMES=qW;let she=0,ti=class extends yr{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:she++}),this.uuid=xl(),this.name="",this.type="Material",this.blending=Au,this.side=ms,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=VM,this.blendDst=XM,this.blendEquation=Hp,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new fe(0,0,0),this.blendAlpha=0,this.depthFunc=yu,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=uI,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=$p,this.stencilZFail=$p,this.stencilZPass=$p,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(n){this._alphaTest>0!=n>0&&this.version++,this._alphaTest=n}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(n){if(n!==void 0)for(const e in n){const i=n[e];if(i===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const s=this[e];if(s===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[e]=i}}toJSON(n){const e=n===void 0||typeof n=="string";e&&(n={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(n).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(n).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(n).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(n).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(n).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(n).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(n).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(n).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(n).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(n).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(n).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(n).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(n).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(n).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(n).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(n).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(n).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(n).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(n).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(n).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(n).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(n).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(n).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(n).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Au&&(i.blending=this.blending),this.side!==ms&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==VM&&(i.blendSrc=this.blendSrc),this.blendDst!==XM&&(i.blendDst=this.blendDst),this.blendEquation!==Hp&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==yu&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==uI&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==$p&&(i.stencilFail=this.stencilFail),this.stencilZFail!==$p&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==$p&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(e){const r=s(n.textures),o=s(n.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(n){this.name=n.name,this.blending=n.blending,this.side=n.side,this.vertexColors=n.vertexColors,this.opacity=n.opacity,this.transparent=n.transparent,this.blendSrc=n.blendSrc,this.blendDst=n.blendDst,this.blendEquation=n.blendEquation,this.blendSrcAlpha=n.blendSrcAlpha,this.blendDstAlpha=n.blendDstAlpha,this.blendEquationAlpha=n.blendEquationAlpha,this.blendColor.copy(n.blendColor),this.blendAlpha=n.blendAlpha,this.depthFunc=n.depthFunc,this.depthTest=n.depthTest,this.depthWrite=n.depthWrite,this.stencilWriteMask=n.stencilWriteMask,this.stencilFunc=n.stencilFunc,this.stencilRef=n.stencilRef,this.stencilFuncMask=n.stencilFuncMask,this.stencilFail=n.stencilFail,this.stencilZFail=n.stencilZFail,this.stencilZPass=n.stencilZPass,this.stencilWrite=n.stencilWrite;const e=n.clippingPlanes;let i=null;if(e!==null){const s=e.length;i=new Array(s);for(let r=0;r!==s;++r)i[r]=e[r].clone()}return this.clippingPlanes=i,this.clipIntersection=n.clipIntersection,this.clipShadows=n.clipShadows,this.shadowSide=n.shadowSide,this.colorWrite=n.colorWrite,this.precision=n.precision,this.polygonOffset=n.polygonOffset,this.polygonOffsetFactor=n.polygonOffsetFactor,this.polygonOffsetUnits=n.polygonOffsetUnits,this.dithering=n.dithering,this.alphaTest=n.alphaTest,this.alphaHash=n.alphaHash,this.alphaToCoverage=n.alphaToCoverage,this.premultipliedAlpha=n.premultipliedAlpha,this.forceSinglePass=n.forceSinglePass,this.visible=n.visible,this.toneMapped=n.toneMapped,this.userData=JSON.parse(JSON.stringify(n.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(n){n===!0&&this.version++}},ai=class extends ti{constructor(n){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new fe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Oi,this.combine=WA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.envMapRotation.copy(n.envMapRotation),this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.fog=n.fog,this}};const Tu=rhe();function rhe(){const n=new ArrayBuffer(4),e=new Float32Array(n),i=new Uint32Array(n),s=new Uint32Array(512),r=new Uint32Array(512);for(let c=0;c<256;++c){const h=c-127;h<-27?(s[c]=0,s[c|256]=32768,r[c]=24,r[c|256]=24):h<-14?(s[c]=1024>>-h-14,s[c|256]=1024>>-h-14|32768,r[c]=-h-1,r[c|256]=-h-1):h<=15?(s[c]=h+15<<10,s[c|256]=h+15<<10|32768,r[c]=13,r[c|256]=13):h<128?(s[c]=31744,s[c|256]=64512,r[c]=24,r[c|256]=24):(s[c]=31744,s[c|256]=64512,r[c]=13,r[c|256]=13)}const o=new Uint32Array(2048),a=new Uint32Array(64),l=new Uint32Array(64);for(let c=1;c<1024;++c){let h=c<<13,d=0;for(;!(h&8388608);)h<<=1,d-=8388608;h&=-8388609,d+=947912704,o[c]=h|d}for(let c=1024;c<2048;++c)o[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)a[c]=c<<23;a[31]=1199570944,a[32]=2147483648;for(let c=33;c<63;++c)a[c]=2147483648+(c-32<<23);a[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(l[c]=1024);return{floatView:e,uint32View:i,baseTable:s,shiftTable:r,mantissaTable:o,exponentTable:a,offsetTable:l}}function Qa(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=Ts(n,-65504,65504),Tu.floatView[0]=n;const e=Tu.uint32View[0],i=e>>23&511;return Tu.baseTable[i]+((e&8388607)>>Tu.shiftTable[i])}function $x(n){const e=n>>10;return Tu.uint32View[0]=Tu.mantissaTable[Tu.offsetTable[e]+(n&1023)]+Tu.exponentTable[e],Tu.floatView[0]}const bf={toHalfFloat:Qa,fromHalfFloat:$x},er=new E,SI=new Q;let ct=class{constructor(n,e,i=!1){if(Array.isArray(n))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=n,this.itemSize=e,this.count=n!==void 0?n.length/e:0,this.normalized=i,this.usage=iy,this.updateRanges=[],this.gpuType=en,this.version=0}onUploadCallback(){}set needsUpdate(n){n===!0&&this.version++}setUsage(n){return this.usage=n,this}addUpdateRange(n,e){this.updateRanges.push({start:n,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(n){return this.name=n.name,this.array=new n.array.constructor(n.array),this.itemSize=n.itemSize,this.count=n.count,this.normalized=n.normalized,this.usage=n.usage,this.gpuType=n.gpuType,this}copyAt(n,e,i){n*=this.itemSize,i*=e.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[n+s]=e.array[i+s];return this}copyArray(n){return this.array.set(n),this}applyMatrix3(n){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)SI.fromBufferAttribute(this,e),SI.applyMatrix3(n),this.setXY(e,SI.x,SI.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)er.fromBufferAttribute(this,e),er.applyMatrix3(n),this.setXYZ(e,er.x,er.y,er.z);return this}applyMatrix4(n){for(let e=0,i=this.count;e<i;e++)er.fromBufferAttribute(this,e),er.applyMatrix4(n),this.setXYZ(e,er.x,er.y,er.z);return this}applyNormalMatrix(n){for(let e=0,i=this.count;e<i;e++)er.fromBufferAttribute(this,e),er.applyNormalMatrix(n),this.setXYZ(e,er.x,er.y,er.z);return this}transformDirection(n){for(let e=0,i=this.count;e<i;e++)er.fromBufferAttribute(this,e),er.transformDirection(n),this.setXYZ(e,er.x,er.y,er.z);return this}set(n,e=0){return this.array.set(n,e),this}getComponent(n,e){let i=this.array[n*this.itemSize+e];return this.normalized&&(i=Aa(i,this.array)),i}setComponent(n,e,i){return this.normalized&&(i=Si(i,this.array)),this.array[n*this.itemSize+e]=i,this}getX(n){let e=this.array[n*this.itemSize];return this.normalized&&(e=Aa(e,this.array)),e}setX(n,e){return this.normalized&&(e=Si(e,this.array)),this.array[n*this.itemSize]=e,this}getY(n){let e=this.array[n*this.itemSize+1];return this.normalized&&(e=Aa(e,this.array)),e}setY(n,e){return this.normalized&&(e=Si(e,this.array)),this.array[n*this.itemSize+1]=e,this}getZ(n){let e=this.array[n*this.itemSize+2];return this.normalized&&(e=Aa(e,this.array)),e}setZ(n,e){return this.normalized&&(e=Si(e,this.array)),this.array[n*this.itemSize+2]=e,this}getW(n){let e=this.array[n*this.itemSize+3];return this.normalized&&(e=Aa(e,this.array)),e}setW(n,e){return this.normalized&&(e=Si(e,this.array)),this.array[n*this.itemSize+3]=e,this}setXY(n,e,i){return n*=this.itemSize,this.normalized&&(e=Si(e,this.array),i=Si(i,this.array)),this.array[n+0]=e,this.array[n+1]=i,this}setXYZ(n,e,i,s){return n*=this.itemSize,this.normalized&&(e=Si(e,this.array),i=Si(i,this.array),s=Si(s,this.array)),this.array[n+0]=e,this.array[n+1]=i,this.array[n+2]=s,this}setXYZW(n,e,i,s,r){return n*=this.itemSize,this.normalized&&(e=Si(e,this.array),i=Si(i,this.array),s=Si(s,this.array),r=Si(r,this.array)),this.array[n+0]=e,this.array[n+1]=i,this.array[n+2]=s,this.array[n+3]=r,this}onUpload(n){return this.onUploadCallback=n,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const n={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(n.name=this.name),this.usage!==iy&&(n.usage=this.usage),n}};class ohe extends ct{constructor(e,i,s){super(new Int8Array(e),i,s)}}class ahe extends ct{constructor(e,i,s){super(new Uint8Array(e),i,s)}}class lhe extends ct{constructor(e,i,s){super(new Uint8ClampedArray(e),i,s)}}class che extends ct{constructor(e,i,s){super(new Int16Array(e),i,s)}}let _I=class extends ct{constructor(n,e,i){super(new Uint16Array(n),e,i)}};class hhe extends ct{constructor(e,i,s){super(new Int32Array(e),i,s)}}let OG=class extends ct{constructor(n,e,i){super(new Uint32Array(n),e,i)}};class $W extends ct{constructor(e,i,s){super(new Uint16Array(e),i,s),this.isFloat16BufferAttribute=!0}getX(e){let i=$x(this.array[e*this.itemSize]);return this.normalized&&(i=Aa(i,this.array)),i}setX(e,i){return this.normalized&&(i=Si(i,this.array)),this.array[e*this.itemSize]=Qa(i),this}getY(e){let i=$x(this.array[e*this.itemSize+1]);return this.normalized&&(i=Aa(i,this.array)),i}setY(e,i){return this.normalized&&(i=Si(i,this.array)),this.array[e*this.itemSize+1]=Qa(i),this}getZ(e){let i=$x(this.array[e*this.itemSize+2]);return this.normalized&&(i=Aa(i,this.array)),i}setZ(e,i){return this.normalized&&(i=Si(i,this.array)),this.array[e*this.itemSize+2]=Qa(i),this}getW(e){let i=$x(this.array[e*this.itemSize+3]);return this.normalized&&(i=Aa(i,this.array)),i}setW(e,i){return this.normalized&&(i=Si(i,this.array)),this.array[e*this.itemSize+3]=Qa(i),this}setXY(e,i,s){return e*=this.itemSize,this.normalized&&(i=Si(i,this.array),s=Si(s,this.array)),this.array[e+0]=Qa(i),this.array[e+1]=Qa(s),this}setXYZ(e,i,s,r){return e*=this.itemSize,this.normalized&&(i=Si(i,this.array),s=Si(s,this.array),r=Si(r,this.array)),this.array[e+0]=Qa(i),this.array[e+1]=Qa(s),this.array[e+2]=Qa(r),this}setXYZW(e,i,s,r,o){return e*=this.itemSize,this.normalized&&(i=Si(i,this.array),s=Si(s,this.array),r=Si(r,this.array),o=Si(o,this.array)),this.array[e+0]=Qa(i),this.array[e+1]=Qa(s),this.array[e+2]=Qa(r),this.array[e+3]=Qa(o),this}}let dt=class extends ct{constructor(n,e,i){super(new Float32Array(n),e,i)}},dhe=0;const yc=new de,ZG=new Ae,gy=new E,Cl=new gi,e1=new gi,Pr=new E;let Rt=class Jle extends yr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:dhe++}),this.uuid=xl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(VW(e)?OG:_I)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,s=0){this.groups.push({start:e,count:i,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const o=new oi().getNormalMatrix(e);s.applyNormalMatrix(o),s.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return yc.makeRotationFromQuaternion(e),this.applyMatrix4(yc),this}rotateX(e){return yc.makeRotationX(e),this.applyMatrix4(yc),this}rotateY(e){return yc.makeRotationY(e),this.applyMatrix4(yc),this}rotateZ(e){return yc.makeRotationZ(e),this.applyMatrix4(yc),this}translate(e,i,s){return yc.makeTranslation(e,i,s),this.applyMatrix4(yc),this}scale(e,i,s){return yc.makeScale(e,i,s),this.applyMatrix4(yc),this}lookAt(e){return ZG.lookAt(e),ZG.updateMatrix(),this.applyMatrix4(ZG.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(gy).negate(),this.translate(gy.x,gy.y,gy.z),this}setFromPoints(e){const i=[];for(let s=0,r=e.length;s<r;s++){const o=e[s];i.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new dt(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new gi);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new E(-1/0,-1/0,-1/0),new E(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let s=0,r=i.length;s<r;s++){const o=i[s];Cl.setFromBufferAttribute(o),this.morphTargetsRelative?(Pr.addVectors(this.boundingBox.min,Cl.min),this.boundingBox.expandByPoint(Pr),Pr.addVectors(this.boundingBox.max,Cl.max),this.boundingBox.expandByPoint(Pr)):(this.boundingBox.expandByPoint(Cl.min),this.boundingBox.expandByPoint(Cl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Vn);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new E,1/0);return}if(e){const s=this.boundingSphere.center;if(Cl.setFromBufferAttribute(e),i)for(let o=0,a=i.length;o<a;o++){const l=i[o];e1.setFromBufferAttribute(l),this.morphTargetsRelative?(Pr.addVectors(Cl.min,e1.min),Cl.expandByPoint(Pr),Pr.addVectors(Cl.max,e1.max),Cl.expandByPoint(Pr)):(Cl.expandByPoint(e1.min),Cl.expandByPoint(e1.max))}Cl.getCenter(s);let r=0;for(let o=0,a=e.count;o<a;o++)Pr.fromBufferAttribute(e,o),r=Math.max(r,s.distanceToSquared(Pr));if(i)for(let o=0,a=i.length;o<a;o++){const l=i[o],c=this.morphTargetsRelative;for(let h=0,d=l.count;h<d;h++)Pr.fromBufferAttribute(l,h),c&&(gy.fromBufferAttribute(e,h),Pr.add(gy)),r=Math.max(r,s.distanceToSquared(Pr))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const s=i.position,r=i.normal,o=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ct(new Float32Array(4*s.count),4));const a=this.getAttribute("tangent"),l=[],c=[];for(let I=0;I<s.count;I++)l[I]=new E,c[I]=new E;const h=new E,d=new E,u=new E,p=new Q,g=new Q,f=new Q,A=new E,y=new E;function b(I,B,M){h.fromBufferAttribute(s,I),d.fromBufferAttribute(s,B),u.fromBufferAttribute(s,M),p.fromBufferAttribute(o,I),g.fromBufferAttribute(o,B),f.fromBufferAttribute(o,M),d.sub(h),u.sub(h),g.sub(p),f.sub(p);const R=1/(g.x*f.y-f.x*g.y);isFinite(R)&&(A.copy(d).multiplyScalar(f.y).addScaledVector(u,-g.y).multiplyScalar(R),y.copy(u).multiplyScalar(g.x).addScaledVector(d,-f.x).multiplyScalar(R),l[I].add(A),l[B].add(A),l[M].add(A),c[I].add(y),c[B].add(y),c[M].add(y))}let v=this.groups;v.length===0&&(v=[{start:0,count:e.count}]);for(let I=0,B=v.length;I<B;++I){const M=v[I],R=M.start,k=M.count;for(let G=R,X=R+k;G<X;G+=3)b(e.getX(G+0),e.getX(G+1),e.getX(G+2))}const x=new E,w=new E,C=new E,S=new E;function _(I){C.fromBufferAttribute(r,I),S.copy(C);const B=l[I];x.copy(B),x.sub(C.multiplyScalar(C.dot(B))).normalize(),w.crossVectors(S,B);const M=w.dot(c[I])<0?-1:1;a.setXYZW(I,x.x,x.y,x.z,M)}for(let I=0,B=v.length;I<B;++I){const M=v[I],R=M.start,k=M.count;for(let G=R,X=R+k;G<X;G+=3)_(e.getX(G+0)),_(e.getX(G+1)),_(e.getX(G+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new ct(new Float32Array(i.count*3),3),this.setAttribute("normal",s);else for(let p=0,g=s.count;p<g;p++)s.setXYZ(p,0,0,0);const r=new E,o=new E,a=new E,l=new E,c=new E,h=new E,d=new E,u=new E;if(e)for(let p=0,g=e.count;p<g;p+=3){const f=e.getX(p+0),A=e.getX(p+1),y=e.getX(p+2);r.fromBufferAttribute(i,f),o.fromBufferAttribute(i,A),a.fromBufferAttribute(i,y),d.subVectors(a,o),u.subVectors(r,o),d.cross(u),l.fromBufferAttribute(s,f),c.fromBufferAttribute(s,A),h.fromBufferAttribute(s,y),l.add(d),c.add(d),h.add(d),s.setXYZ(f,l.x,l.y,l.z),s.setXYZ(A,c.x,c.y,c.z),s.setXYZ(y,h.x,h.y,h.z)}else for(let p=0,g=i.count;p<g;p+=3)r.fromBufferAttribute(i,p+0),o.fromBufferAttribute(i,p+1),a.fromBufferAttribute(i,p+2),d.subVectors(a,o),u.subVectors(r,o),d.cross(u),s.setXYZ(p+0,d.x,d.y,d.z),s.setXYZ(p+1,d.x,d.y,d.z),s.setXYZ(p+2,d.x,d.y,d.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,s=e.count;i<s;i++)Pr.fromBufferAttribute(e,i),Pr.normalize(),e.setXYZ(i,Pr.x,Pr.y,Pr.z)}toNonIndexed(){function e(l,c){const h=l.array,d=l.itemSize,u=l.normalized,p=new h.constructor(c.length*d);let g=0,f=0;for(let A=0,y=c.length;A<y;A++){l.isInterleavedBufferAttribute?g=c[A]*l.data.stride+l.offset:g=c[A]*d;for(let b=0;b<d;b++)p[f++]=h[g++]}return new ct(p,d,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Jle,s=this.index.array,r=this.attributes;for(const l in r){const c=r[l],h=e(c,s);i.setAttribute(l,h)}const o=this.morphAttributes;for(const l in o){const c=[],h=o[l];for(let d=0,u=h.length;d<u;d++){const p=h[d],g=e(p,s);c.push(g)}i.morphAttributes[l]=c}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let l=0,c=a.length;l<c;l++){const h=a[l];i.addGroup(h.start,h.count,h.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const h in c)c[h]!==void 0&&(e[h]=c[h]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const s=this.attributes;for(const c in s){const h=s[c];e.data.attributes[c]=h.toJSON(e.data)}const r={};let o=!1;for(const c in this.morphAttributes){const h=this.morphAttributes[c],d=[];for(let u=0,p=h.length;u<p;u++){const g=h[u];d.push(g.toJSON(e.data))}d.length>0&&(r[c]=d,o=!0)}o&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const s=e.index;s!==null&&this.setIndex(s.clone(i));const r=e.attributes;for(const h in r){const d=r[h];this.setAttribute(h,d.clone(i))}const o=e.morphAttributes;for(const h in o){const d=[],u=o[h];for(let p=0,g=u.length;p<g;p++)d.push(u[p].clone(i));this.morphAttributes[h]=d}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let h=0,d=a.length;h<d;h++){const u=a[h];this.addGroup(u.start,u.count,u.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const e9=new de,vf=new ya,MI=new Vn,t9=new E,II=new E,TI=new E,EI=new E,WG=new E,RI=new E,i9=new E,LI=new E;let pe=class extends Ae{constructor(n=new Rt,e=new ai){super(),this.isMesh=!0,this.type="Mesh",this.geometry=n,this.material=e,this.updateMorphTargets()}copy(n,e){return super.copy(n,e),n.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=n.morphTargetInfluences.slice()),n.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},n.morphTargetDictionary)),this.material=Array.isArray(n.material)?n.material.slice():n.material,this.geometry=n.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,e=Object.keys(n);if(e.length>0){const i=n[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=i.length;s<r;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(n,e){const i=this.geometry,s=i.attributes.position,r=i.morphAttributes.position,o=i.morphTargetsRelative;e.fromBufferAttribute(s,n);const a=this.morphTargetInfluences;if(r&&a){RI.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const h=a[l],d=r[l];h!==0&&(WG.fromBufferAttribute(d,n),o?RI.addScaledVector(WG,h):RI.addScaledVector(WG.sub(e),h))}e.add(RI)}return e}raycast(n,e){const i=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),MI.copy(i.boundingSphere),MI.applyMatrix4(r),vf.copy(n.ray).recast(n.near),!(MI.containsPoint(vf.origin)===!1&&(vf.intersectSphere(MI,t9)===null||vf.origin.distanceToSquared(t9)>(n.far-n.near)**2))&&(e9.copy(r).invert(),vf.copy(n.ray).applyMatrix4(e9),!(i.boundingBox!==null&&vf.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(n,e,vf)))}_computeIntersections(n,e,i){let s;const r=this.geometry,o=this.material,a=r.index,l=r.attributes.position,c=r.attributes.uv,h=r.attributes.uv1,d=r.attributes.normal,u=r.groups,p=r.drawRange;if(a!==null)if(Array.isArray(o))for(let g=0,f=u.length;g<f;g++){const A=u[g],y=o[A.materialIndex],b=Math.max(A.start,p.start),v=Math.min(a.count,Math.min(A.start+A.count,p.start+p.count));for(let x=b,w=v;x<w;x+=3){const C=a.getX(x),S=a.getX(x+1),_=a.getX(x+2);s=BI(this,y,n,i,c,h,d,C,S,_),s&&(s.faceIndex=Math.floor(x/3),s.face.materialIndex=A.materialIndex,e.push(s))}}else{const g=Math.max(0,p.start),f=Math.min(a.count,p.start+p.count);for(let A=g,y=f;A<y;A+=3){const b=a.getX(A),v=a.getX(A+1),x=a.getX(A+2);s=BI(this,o,n,i,c,h,d,b,v,x),s&&(s.faceIndex=Math.floor(A/3),e.push(s))}}else if(l!==void 0)if(Array.isArray(o))for(let g=0,f=u.length;g<f;g++){const A=u[g],y=o[A.materialIndex],b=Math.max(A.start,p.start),v=Math.min(l.count,Math.min(A.start+A.count,p.start+p.count));for(let x=b,w=v;x<w;x+=3){const C=x,S=x+1,_=x+2;s=BI(this,y,n,i,c,h,d,C,S,_),s&&(s.faceIndex=Math.floor(x/3),s.face.materialIndex=A.materialIndex,e.push(s))}}else{const g=Math.max(0,p.start),f=Math.min(l.count,p.start+p.count);for(let A=g,y=f;A<y;A+=3){const b=A,v=A+1,x=A+2;s=BI(this,o,n,i,c,h,d,b,v,x),s&&(s.faceIndex=Math.floor(A/3),e.push(s))}}}};function uhe(n,e,i,s,r,o,a,l){let c;if(e.side===wn?c=s.intersectTriangle(a,o,r,!0,l):c=s.intersectTriangle(r,o,a,e.side===ms,l),c===null)return null;LI.copy(l),LI.applyMatrix4(n.matrixWorld);const h=i.ray.origin.distanceTo(LI);return h<i.near||h>i.far?null:{distance:h,point:LI.clone(),object:n}}function BI(n,e,i,s,r,o,a,l,c,h){n.getVertexPosition(l,II),n.getVertexPosition(c,TI),n.getVertexPosition(h,EI);const d=uhe(n,e,i,s,II,TI,EI,i9);if(d){const u=new E;$s.getBarycoord(i9,II,TI,EI,u),r&&(d.uv=$s.getInterpolatedAttribute(r,l,c,h,u,new Q)),o&&(d.uv1=$s.getInterpolatedAttribute(o,l,c,h,u,new Q)),a&&(d.normal=$s.getInterpolatedAttribute(a,l,c,h,u,new E),d.normal.dot(s.direction)>0&&d.normal.multiplyScalar(-1));const p={a:l,b:c,c:h,normal:new E,materialIndex:0};$s.getNormal(II,TI,EI,p.normal),d.face=p,d.barycoord=u}return d}class bn extends Rt{constructor(e=1,i=1,s=1,r=1,o=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:s,widthSegments:r,heightSegments:o,depthSegments:a};const l=this;r=Math.floor(r),o=Math.floor(o),a=Math.floor(a);const c=[],h=[],d=[],u=[];let p=0,g=0;f("z","y","x",-1,-1,s,i,e,a,o,0),f("z","y","x",1,-1,s,i,-e,a,o,1),f("x","z","y",1,1,e,s,i,r,a,2),f("x","z","y",1,-1,e,s,-i,r,a,3),f("x","y","z",1,-1,e,i,s,r,o,4),f("x","y","z",-1,-1,e,i,-s,r,o,5),this.setIndex(c),this.setAttribute("position",new dt(h,3)),this.setAttribute("normal",new dt(d,3)),this.setAttribute("uv",new dt(u,2));function f(A,y,b,v,x,w,C,S,_,I,B){const M=w/_,R=C/I,k=w/2,G=C/2,X=S/2,F=_+1,z=I+1;let H=0,Z=0;const he=new E;for(let be=0;be<z;be++){const _e=be*R-G;for(let Ye=0;Ye<F;Ye++){const je=Ye*M-k;he[A]=je*v,he[y]=_e*x,he[b]=X,h.push(he.x,he.y,he.z),he[A]=0,he[y]=0,he[b]=S>0?1:-1,d.push(he.x,he.y,he.z),u.push(Ye/_),u.push(1-be/I),H+=1}}for(let be=0;be<I;be++)for(let _e=0;_e<_;_e++){const Ye=p+_e+F*be,je=p+_e+F*(be+1),le=p+(_e+1)+F*(be+1),ve=p+(_e+1)+F*be;c.push(Ye,je,ve),c.push(je,le,ve),Z+=6}l.addGroup(g,Z,B),g+=Z,p+=H}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bn(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function fy(n){const e={};for(const i in n){e[i]={};for(const s in n[i]){const r=n[i][s];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][s]=null):e[i][s]=r.clone():Array.isArray(r)?e[i][s]=r.slice():e[i][s]=r}}return e}function ba(n){const e={};for(let i=0;i<n.length;i++){const s=fy(n[i]);for(const r in s)e[r]=s[r]}return e}function phe(n){const e=[];for(let i=0;i<n.length;i++)e.push(n[i].clone());return e}function n9(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:hi.workingColorSpace}const Ay={clone:fy,merge:ba};var mhe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,ghe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class jt extends ti{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=mhe,this.fragmentShader=ghe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=fy(e.uniforms),this.uniformsGroups=phe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?i.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?i.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?i.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?i.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?i.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?i.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?i.uniforms[r]={type:"m4",value:o.toArray()}:i.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const s={};for(const r in this.extensions)this.extensions[r]===!0&&(s[r]=!0);return Object.keys(s).length>0&&(i.extensions=s),i}}let t1=class extends Ae{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new de,this.projectionMatrix=new de,this.projectionMatrixInverse=new de,this.coordinateSystem=Ac}copy(n,e){return super.copy(n,e),this.matrixWorldInverse.copy(n.matrixWorldInverse),this.projectionMatrix.copy(n.projectionMatrix),this.projectionMatrixInverse.copy(n.projectionMatrixInverse),this.coordinateSystem=n.coordinateSystem,this}getWorldDirection(n){return super.getWorldDirection(n).negate()}updateMatrixWorld(n){super.updateMatrixWorld(n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(n,e){super.updateWorldMatrix(n,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const rm=new E,s9=new Q,r9=new Q;let Ot=class extends t1{constructor(n=50,e=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=n,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(n,e){return super.copy(n,e),this.fov=n.fov,this.zoom=n.zoom,this.near=n.near,this.far=n.far,this.focus=n.focus,this.aspect=n.aspect,this.view=n.view===null?null:Object.assign({},n.view),this.filmGauge=n.filmGauge,this.filmOffset=n.filmOffset,this}setFocalLength(n){const e=.5*this.getFilmHeight()/n;this.fov=ny*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const n=Math.tan(ff*.5*this.fov);return .5*this.getFilmHeight()/n}getEffectiveFOV(){return ny*2*Math.atan(Math.tan(ff*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(n,e,i){rm.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(rm.x,rm.y).multiplyScalar(-n/rm.z),rm.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(rm.x,rm.y).multiplyScalar(-n/rm.z)}getViewSize(n,e){return this.getViewBounds(n,s9,r9),e.subVectors(r9,s9)}setViewOffset(n,e,i,s,r,o){this.aspect=n/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=this.near;let e=n*Math.tan(ff*.5*this.fov)/this.zoom,i=2*e,s=this.aspect*i,r=-.5*s;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*s/l,e-=o.offsetY*i/c,s*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(r+=n*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,e,e-i,n,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(n){const e=super.toJSON(n);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}};const yy=-90,by=1;class kI extends Ae{constructor(e,i,s){super(),this.type="CubeCamera",this.renderTarget=s,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Ot(yy,by,e,i);r.layers=this.layers,this.add(r);const o=new Ot(yy,by,e,i);o.layers=this.layers,this.add(o);const a=new Ot(yy,by,e,i);a.layers=this.layers,this.add(a);const l=new Ot(yy,by,e,i);l.layers=this.layers,this.add(l);const c=new Ot(yy,by,e,i);c.layers=this.layers,this.add(c);const h=new Ot(yy,by,e,i);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const e=this.coordinateSystem,i=this.children.concat(),[s,r,o,a,l,c]=i;for(const h of i)this.remove(h);if(e===Ac)s.up.set(0,1,0),s.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===gf)s.up.set(0,-1,0),s.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const h of i)this.add(h),h.updateMatrixWorld()}update(e,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:s,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,a,l,c,h,d]=this.children,u=e.getRenderTarget(),p=e.getActiveCubeFace(),g=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;const A=s.texture.generateMipmaps;s.texture.generateMipmaps=!1,e.setRenderTarget(s,0,r),e.render(i,o),e.setRenderTarget(s,1,r),e.render(i,a),e.setRenderTarget(s,2,r),e.render(i,l),e.setRenderTarget(s,3,r),e.render(i,c),e.setRenderTarget(s,4,r),e.render(i,h),s.texture.generateMipmaps=A,e.setRenderTarget(s,5,r),e.render(i,d),e.setRenderTarget(u,p,g),e.xr.enabled=f,s.texture.needsPMREMUpdate=!0}}class xf extends di{constructor(e,i,s,r,o,a,l,c,h,d){e=e!==void 0?e:[],i=i!==void 0?i:bl,super(e,i,s,r,o,a,l,c,h,d),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class GI extends fi{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;const s={width:e,height:e,depth:1},r=[s,s,s,s,s,s];this.texture=new xf(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Wt}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const s={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new bn(5,5,5),o=new jt({name:"CubemapFromEquirect",uniforms:fy(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,side:wn,blending:Pn});o.uniforms.tEquirect.value=i;const a=new pe(r,o),l=i.minFilter;return i.minFilter===Ar&&(i.minFilter=Wt),new kI(1,10,this).update(e,a),i.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,i,s,r){const o=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(i,s,r);e.setRenderTarget(o)}}const HG=new E,fhe=new E,Ahe=new oi;let tr=class{constructor(n=new E(1,0,0),e=0){this.isPlane=!0,this.normal=n,this.constant=e}set(n,e){return this.normal.copy(n),this.constant=e,this}setComponents(n,e,i,s){return this.normal.set(n,e,i),this.constant=s,this}setFromNormalAndCoplanarPoint(n,e){return this.normal.copy(n),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(n,e,i){const s=HG.subVectors(i,e).cross(fhe.subVectors(n,e)).normalize();return this.setFromNormalAndCoplanarPoint(s,n),this}copy(n){return this.normal.copy(n.normal),this.constant=n.constant,this}normalize(){const n=1/this.normal.length();return this.normal.multiplyScalar(n),this.constant*=n,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(n){return this.normal.dot(n)+this.constant}distanceToSphere(n){return this.distanceToPoint(n.center)-n.radius}projectPoint(n,e){return e.copy(n).addScaledVector(this.normal,-this.distanceToPoint(n))}intersectLine(n,e){const i=n.delta(HG),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(n.start)===0?e.copy(n.start):null;const r=-(n.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:e.copy(n.start).addScaledVector(i,r)}intersectsLine(n){const e=this.distanceToPoint(n.start),i=this.distanceToPoint(n.end);return e<0&&i>0||i<0&&e>0}intersectsBox(n){return n.intersectsPlane(this)}intersectsSphere(n){return n.intersectsPlane(this)}coplanarPoint(n){return n.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(n,e){const i=e||Ahe.getNormalMatrix(n),s=this.coplanarPoint(HG).applyMatrix4(n),r=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(r),this}translate(n){return this.constant-=n.dot(this.normal),this}equals(n){return n.normal.equals(this.normal)&&n.constant===this.constant}clone(){return new this.constructor().copy(this)}};const wf=new Vn,PI=new E;let Cf=class{constructor(n=new tr,e=new tr,i=new tr,s=new tr,r=new tr,o=new tr){this.planes=[n,e,i,s,r,o]}set(n,e,i,s,r,o){const a=this.planes;return a[0].copy(n),a[1].copy(e),a[2].copy(i),a[3].copy(s),a[4].copy(r),a[5].copy(o),this}copy(n){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(n.planes[i]);return this}setFromProjectionMatrix(n,e=Ac){const i=this.planes,s=n.elements,r=s[0],o=s[1],a=s[2],l=s[3],c=s[4],h=s[5],d=s[6],u=s[7],p=s[8],g=s[9],f=s[10],A=s[11],y=s[12],b=s[13],v=s[14],x=s[15];if(i[0].setComponents(l-r,u-c,A-p,x-y).normalize(),i[1].setComponents(l+r,u+c,A+p,x+y).normalize(),i[2].setComponents(l+o,u+h,A+g,x+b).normalize(),i[3].setComponents(l-o,u-h,A-g,x-b).normalize(),i[4].setComponents(l-a,u-d,A-f,x-v).normalize(),e===Ac)i[5].setComponents(l+a,u+d,A+f,x+v).normalize();else if(e===gf)i[5].setComponents(a,d,f,v).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(n){if(n.boundingSphere!==void 0)n.boundingSphere===null&&n.computeBoundingSphere(),wf.copy(n.boundingSphere).applyMatrix4(n.matrixWorld);else{const e=n.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),wf.copy(e.boundingSphere).applyMatrix4(n.matrixWorld)}return this.intersectsSphere(wf)}intersectsSprite(n){return wf.center.set(0,0,0),wf.radius=.7071067811865476,wf.applyMatrix4(n.matrixWorld),this.intersectsSphere(wf)}intersectsSphere(n){const e=this.planes,i=n.center,s=-n.radius;for(let r=0;r<6;r++)if(e[r].distanceToPoint(i)<s)return!1;return!0}intersectsBox(n){const e=this.planes;for(let i=0;i<6;i++){const s=e[i];if(PI.x=s.normal.x>0?n.max.x:n.min.x,PI.y=s.normal.y>0?n.max.y:n.min.y,PI.z=s.normal.z>0?n.max.z:n.min.z,s.distanceToPoint(PI)<0)return!1}return!0}containsPoint(n){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(n)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function o9(){let n=null,e=!1,i=null,s=null;function r(o,a){i(o,a),s=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&i!==null&&(s=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(s),e=!1},setAnimationLoop:function(o){i=o},setContext:function(o){n=o}}}function yhe(n){const e=new WeakMap;function i(l,c){const h=l.array,d=l.usage,u=h.byteLength,p=n.createBuffer();n.bindBuffer(c,p),n.bufferData(c,h,d),l.onUploadCallback();let g;if(h instanceof Float32Array)g=n.FLOAT;else if(h instanceof Uint16Array)l.isFloat16BufferAttribute?g=n.HALF_FLOAT:g=n.UNSIGNED_SHORT;else if(h instanceof Int16Array)g=n.SHORT;else if(h instanceof Uint32Array)g=n.UNSIGNED_INT;else if(h instanceof Int32Array)g=n.INT;else if(h instanceof Int8Array)g=n.BYTE;else if(h instanceof Uint8Array)g=n.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)g=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:p,type:g,bytesPerElement:h.BYTES_PER_ELEMENT,version:l.version,size:u}}function s(l,c,h){const d=c.array,u=c.updateRanges;if(n.bindBuffer(h,l),u.length===0)n.bufferSubData(h,0,d);else{u.sort((g,f)=>g.start-f.start);let p=0;for(let g=1;g<u.length;g++){const f=u[p],A=u[g];A.start<=f.start+f.count+1?f.count=Math.max(f.count,A.start+A.count-f.start):(++p,u[p]=A)}u.length=p+1;for(let g=0,f=u.length;g<f;g++){const A=u[g];n.bufferSubData(h,A.start*d.BYTES_PER_ELEMENT,d,A.start,A.count)}c.clearUpdateRanges()}c.onUploadCallback()}function r(l){return l.isInterleavedBufferAttribute&&(l=l.data),e.get(l)}function o(l){l.isInterleavedBufferAttribute&&(l=l.data);const c=e.get(l);c&&(n.deleteBuffer(c.buffer),e.delete(l))}function a(l,c){if(l.isInterleavedBufferAttribute&&(l=l.data),l.isGLBufferAttribute){const d=e.get(l);(!d||d.version<l.version)&&e.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}const h=e.get(l);if(h===void 0)e.set(l,i(l,c));else if(h.version<l.version){if(h.size!==l.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");s(h.buffer,l,c),h.version=l.version}}return{get:r,remove:o,update:a}}class Xs extends Rt{constructor(e=1,i=1,s=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:s,heightSegments:r};const o=e/2,a=i/2,l=Math.floor(s),c=Math.floor(r),h=l+1,d=c+1,u=e/l,p=i/c,g=[],f=[],A=[],y=[];for(let b=0;b<d;b++){const v=b*p-a;for(let x=0;x<h;x++){const w=x*u-o;f.push(w,-v,0),A.push(0,0,1),y.push(x/l),y.push(1-b/c)}}for(let b=0;b<c;b++)for(let v=0;v<l;v++){const x=v+h*b,w=v+h*(b+1),C=v+1+h*(b+1),S=v+1+h*b;g.push(x,w,S),g.push(w,C,S)}this.setIndex(g),this.setAttribute("position",new dt(f,3)),this.setAttribute("normal",new dt(A,3)),this.setAttribute("uv",new dt(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xs(e.width,e.height,e.widthSegments,e.heightSegments)}}var bhe=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,vhe=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,xhe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,whe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Che=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,She=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,_he=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Mhe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Ihe=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,The=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,Ehe=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Rhe=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Lhe=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Bhe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,khe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Ghe=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,Phe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Nhe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Vhe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Xhe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Dhe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,zhe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,Fhe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,Uhe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Ohe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Zhe=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Whe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Hhe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Qhe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Khe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Yhe="gl_FragColor = linearToOutputTexel( gl_FragColor );",jhe=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Jhe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,qhe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,$he=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,ede=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,tde=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,ide=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,nde=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,sde=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,rde=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,ode=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,ade=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lde=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,cde=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,hde=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,dde=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,ude=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,pde=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,mde=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,gde=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,fde=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,Ade=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,yde=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,bde=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,vde=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,xde=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,wde=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Cde=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Sde=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,_de=`#ifdef USE_MAP
#ifdef USE_MIPMAP_BIAS
    vec4 sampledDiffuseColor = texture2D( map, vMapUv, mipmapBias );
#else
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
#endif
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Mde=`#ifdef USE_MAP
	uniform sampler2D map;
        
#ifdef USE_MIPMAP_BIAS
    uniform float mipmapBias;
#endif
#endif`,Ide=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Tde=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Ede=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Rde=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Lde=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,Bde=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,kde=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Gde=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,Pde=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Nde=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Vde=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Xde=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Dde=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,zde=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Fde=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Ude=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Ode=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Zde=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Wde=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Hde=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Qde=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Kde=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Yde=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,jde=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Jde=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,qde=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,$de=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,eue=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,tue=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,iue=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,nue=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,sue=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,rue=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,oue=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,aue=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,lue=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,cue=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,hue=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,due=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,uue=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,pue=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,mue=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,gue=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,fue=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Aue=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const yue=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,bue=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vue=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,xue=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,wue=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Cue=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Sue=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,_ue=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,Mue=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Iue=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Tue=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Eue=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Rue=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Lue=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Bue=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,kue=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Gue=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Pue=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Nue=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Vue=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Xue=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Due=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,zue=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Fue=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Uue=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Oue=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Zue=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Wue=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Hue=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Que=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Kue=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Yue=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,jue=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Jue=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Zt={alphahash_fragment:bhe,alphahash_pars_fragment:vhe,alphamap_fragment:xhe,alphamap_pars_fragment:whe,alphatest_fragment:Che,alphatest_pars_fragment:She,aomap_fragment:_he,aomap_pars_fragment:Mhe,batching_pars_vertex:Ihe,batching_vertex:The,begin_vertex:Ehe,beginnormal_vertex:Rhe,bsdfs:Lhe,iridescence_fragment:Bhe,bumpmap_pars_fragment:khe,clipping_planes_fragment:Ghe,clipping_planes_pars_fragment:Phe,clipping_planes_pars_vertex:Nhe,clipping_planes_vertex:Vhe,color_fragment:Xhe,color_pars_fragment:Dhe,color_pars_vertex:zhe,color_vertex:Fhe,common:Uhe,cube_uv_reflection_fragment:Ohe,defaultnormal_vertex:Zhe,displacementmap_pars_vertex:Whe,displacementmap_vertex:Hhe,emissivemap_fragment:Qhe,emissivemap_pars_fragment:Khe,colorspace_fragment:Yhe,colorspace_pars_fragment:jhe,envmap_fragment:Jhe,envmap_common_pars_fragment:qhe,envmap_pars_fragment:$he,envmap_pars_vertex:ede,envmap_physical_pars_fragment:dde,envmap_vertex:tde,fog_vertex:ide,fog_pars_vertex:nde,fog_fragment:sde,fog_pars_fragment:rde,gradientmap_pars_fragment:ode,lightmap_pars_fragment:ade,lights_lambert_fragment:lde,lights_lambert_pars_fragment:cde,lights_pars_begin:hde,lights_toon_fragment:ude,lights_toon_pars_fragment:pde,lights_phong_fragment:mde,lights_phong_pars_fragment:gde,lights_physical_fragment:fde,lights_physical_pars_fragment:Ade,lights_fragment_begin:yde,lights_fragment_maps:bde,lights_fragment_end:vde,logdepthbuf_fragment:xde,logdepthbuf_pars_fragment:wde,logdepthbuf_pars_vertex:Cde,logdepthbuf_vertex:Sde,map_fragment:_de,map_pars_fragment:Mde,map_particle_fragment:Ide,map_particle_pars_fragment:Tde,metalnessmap_fragment:Ede,metalnessmap_pars_fragment:Rde,morphinstance_vertex:Lde,morphcolor_vertex:Bde,morphnormal_vertex:kde,morphtarget_pars_vertex:Gde,morphtarget_vertex:Pde,normal_fragment_begin:Nde,normal_fragment_maps:Vde,normal_pars_fragment:Xde,normal_pars_vertex:Dde,normal_vertex:zde,normalmap_pars_fragment:Fde,clearcoat_normal_fragment_begin:Ude,clearcoat_normal_fragment_maps:Ode,clearcoat_pars_fragment:Zde,iridescence_pars_fragment:Wde,opaque_fragment:Hde,packing:Qde,premultiplied_alpha_fragment:Kde,project_vertex:Yde,dithering_fragment:jde,dithering_pars_fragment:Jde,roughnessmap_fragment:qde,roughnessmap_pars_fragment:$de,shadowmap_pars_fragment:eue,shadowmap_pars_vertex:tue,shadowmap_vertex:iue,shadowmask_pars_fragment:nue,skinbase_vertex:sue,skinning_pars_vertex:rue,skinning_vertex:oue,skinnormal_vertex:aue,specularmap_fragment:lue,specularmap_pars_fragment:cue,tonemapping_fragment:hue,tonemapping_pars_fragment:due,transmission_fragment:uue,transmission_pars_fragment:pue,uv_pars_fragment:mue,uv_pars_vertex:gue,uv_vertex:fue,worldpos_vertex:Aue,background_vert:yue,background_frag:bue,backgroundCube_vert:vue,backgroundCube_frag:xue,cube_vert:wue,cube_frag:Cue,depth_vert:Sue,depth_frag:_ue,distanceRGBA_vert:Mue,distanceRGBA_frag:Iue,equirect_vert:Tue,equirect_frag:Eue,linedashed_vert:Rue,linedashed_frag:Lue,meshbasic_vert:Bue,meshbasic_frag:kue,meshlambert_vert:Gue,meshlambert_frag:Pue,meshmatcap_vert:Nue,meshmatcap_frag:Vue,meshnormal_vert:Xue,meshnormal_frag:Due,meshphong_vert:zue,meshphong_frag:Fue,meshphysical_vert:Uue,meshphysical_frag:Oue,meshtoon_vert:Zue,meshtoon_frag:Wue,points_vert:Hue,points_frag:Que,shadow_vert:Kue,shadow_frag:Yue,sprite_vert:jue,sprite_frag:Jue},ht={common:{diffuse:{value:new fe(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new oi},alphaMap:{value:null},alphaMapTransform:{value:new oi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new oi}},envmap:{envMap:{value:null},envMapRotation:{value:new oi},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new oi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new oi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new oi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new oi},normalScale:{value:new Q(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new oi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new oi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new oi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new oi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new fe(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new fe(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new oi},alphaTest:{value:0},uvTransform:{value:new oi}},sprite:{diffuse:{value:new fe(16777215)},opacity:{value:1},center:{value:new Q(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new oi},alphaMap:{value:null},alphaMapTransform:{value:new oi},alphaTest:{value:0}}},Wn={basic:{uniforms:ba([ht.common,ht.specularmap,ht.envmap,ht.aomap,ht.lightmap,ht.fog]),vertexShader:Zt.meshbasic_vert,fragmentShader:Zt.meshbasic_frag},lambert:{uniforms:ba([ht.common,ht.specularmap,ht.envmap,ht.aomap,ht.lightmap,ht.emissivemap,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.fog,ht.lights,{emissive:{value:new fe(0)}}]),vertexShader:Zt.meshlambert_vert,fragmentShader:Zt.meshlambert_frag},phong:{uniforms:ba([ht.common,ht.specularmap,ht.envmap,ht.aomap,ht.lightmap,ht.emissivemap,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.fog,ht.lights,{emissive:{value:new fe(0)},specular:{value:new fe(1118481)},shininess:{value:30}}]),vertexShader:Zt.meshphong_vert,fragmentShader:Zt.meshphong_frag},standard:{uniforms:ba([ht.common,ht.envmap,ht.aomap,ht.lightmap,ht.emissivemap,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.roughnessmap,ht.metalnessmap,ht.fog,ht.lights,{emissive:{value:new fe(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Zt.meshphysical_vert,fragmentShader:Zt.meshphysical_frag},toon:{uniforms:ba([ht.common,ht.aomap,ht.lightmap,ht.emissivemap,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.gradientmap,ht.fog,ht.lights,{emissive:{value:new fe(0)}}]),vertexShader:Zt.meshtoon_vert,fragmentShader:Zt.meshtoon_frag},matcap:{uniforms:ba([ht.common,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.fog,{matcap:{value:null}}]),vertexShader:Zt.meshmatcap_vert,fragmentShader:Zt.meshmatcap_frag},points:{uniforms:ba([ht.points,ht.fog]),vertexShader:Zt.points_vert,fragmentShader:Zt.points_frag},dashed:{uniforms:ba([ht.common,ht.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Zt.linedashed_vert,fragmentShader:Zt.linedashed_frag},depth:{uniforms:ba([ht.common,ht.displacementmap]),vertexShader:Zt.depth_vert,fragmentShader:Zt.depth_frag},normal:{uniforms:ba([ht.common,ht.bumpmap,ht.normalmap,ht.displacementmap,{opacity:{value:1}}]),vertexShader:Zt.meshnormal_vert,fragmentShader:Zt.meshnormal_frag},sprite:{uniforms:ba([ht.sprite,ht.fog]),vertexShader:Zt.sprite_vert,fragmentShader:Zt.sprite_frag},background:{uniforms:{uvTransform:{value:new oi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Zt.background_vert,fragmentShader:Zt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new oi}},vertexShader:Zt.backgroundCube_vert,fragmentShader:Zt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Zt.cube_vert,fragmentShader:Zt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Zt.equirect_vert,fragmentShader:Zt.equirect_frag},distanceRGBA:{uniforms:ba([ht.common,ht.displacementmap,{referencePosition:{value:new E},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Zt.distanceRGBA_vert,fragmentShader:Zt.distanceRGBA_frag},shadow:{uniforms:ba([ht.lights,ht.fog,{color:{value:new fe(0)},opacity:{value:1}}]),vertexShader:Zt.shadow_vert,fragmentShader:Zt.shadow_frag}};Wn.physical={uniforms:ba([Wn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new oi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new oi},clearcoatNormalScale:{value:new Q(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new oi},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new oi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new oi},sheen:{value:0},sheenColor:{value:new fe(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new oi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new oi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new oi},transmissionSamplerSize:{value:new Q},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new oi},attenuationDistance:{value:0},attenuationColor:{value:new fe(0)},specularColor:{value:new fe(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new oi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new oi},anisotropyVector:{value:new Q},anisotropyMap:{value:null},anisotropyMapTransform:{value:new oi}}]),vertexShader:Zt.meshphysical_vert,fragmentShader:Zt.meshphysical_frag};const NI={r:0,b:0,g:0},Sf=new Oi,que=new de;function $ue(n,e,i,s,r,o,a){const l=new fe(0);let c=o===!0?0:1,h,d,u=null,p=0,g=null;function f(v){let x=v.isScene===!0?v.background:null;return x&&x.isTexture&&(x=(v.backgroundBlurriness>0?i:e).get(x)),x}function A(v){let x=!1;const w=f(v);w===null?b(l,c):w&&w.isColor&&(b(w,1),x=!0);const C=n.xr.getEnvironmentBlendMode();C==="additive"?s.buffers.color.setClear(0,0,0,1,a):C==="alpha-blend"&&s.buffers.color.setClear(0,0,0,0,a),(n.autoClear||x)&&(s.buffers.depth.setTest(!0),s.buffers.depth.setMask(!0),s.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function y(v,x){const w=f(x);w&&(w.isCubeTexture||w.mapping===cf)?(d===void 0&&(d=new pe(new bn(1,1,1),new jt({name:"BackgroundCubeMaterial",uniforms:fy(Wn.backgroundCube.uniforms),vertexShader:Wn.backgroundCube.vertexShader,fragmentShader:Wn.backgroundCube.fragmentShader,side:wn,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),d.geometry.deleteAttribute("uv"),d.onBeforeRender=function(C,S,_){this.matrixWorld.copyPosition(_.matrixWorld)},Object.defineProperty(d.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(d)),Sf.copy(x.backgroundRotation),Sf.x*=-1,Sf.y*=-1,Sf.z*=-1,w.isCubeTexture&&w.isRenderTargetTexture===!1&&(Sf.y*=-1,Sf.z*=-1),d.material.uniforms.envMap.value=w,d.material.uniforms.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,d.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,d.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,d.material.uniforms.backgroundRotation.value.setFromMatrix4(que.makeRotationFromEuler(Sf)),d.material.toneMapped=hi.getTransfer(w.colorSpace)!==Nn,(u!==w||p!==w.version||g!==n.toneMapping)&&(d.material.needsUpdate=!0,u=w,p=w.version,g=n.toneMapping),d.layers.enableAll(),v.unshift(d,d.geometry,d.material,0,0,null)):w&&w.isTexture&&(h===void 0&&(h=new pe(new Xs(2,2),new jt({name:"BackgroundMaterial",uniforms:fy(Wn.background.uniforms),vertexShader:Wn.background.vertexShader,fragmentShader:Wn.background.fragmentShader,side:ms,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(h)),h.material.uniforms.t2D.value=w,h.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,h.material.toneMapped=hi.getTransfer(w.colorSpace)!==Nn,w.matrixAutoUpdate===!0&&w.updateMatrix(),h.material.uniforms.uvTransform.value.copy(w.matrix),(u!==w||p!==w.version||g!==n.toneMapping)&&(h.material.needsUpdate=!0,u=w,p=w.version,g=n.toneMapping),h.layers.enableAll(),v.unshift(h,h.geometry,h.material,0,0,null))}function b(v,x){v.getRGB(NI,n9(n)),s.buffers.color.setClear(NI.r,NI.g,NI.b,x,a)}return{getClearColor:function(){return l},setClearColor:function(v,x=1){l.set(v),c=x,b(l,c)},getClearAlpha:function(){return c},setClearAlpha:function(v){c=v,b(l,c)},render:A,addToRenderList:y}}function epe(n,e){const i=n.getParameter(n.MAX_VERTEX_ATTRIBS),s={},r=p(null);let o=r,a=!1;function l(M,R,k,G,X){let F=!1;const z=u(G,k,R);o!==z&&(o=z,h(o.object)),F=g(M,G,k,X),F&&f(M,G,k,X),X!==null&&e.update(X,n.ELEMENT_ARRAY_BUFFER),(F||a)&&(a=!1,w(M,R,k,G),X!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(X).buffer))}function c(){return n.createVertexArray()}function h(M){return n.bindVertexArray(M)}function d(M){return n.deleteVertexArray(M)}function u(M,R,k){const G=k.wireframe===!0;let X=s[M.id];X===void 0&&(X={},s[M.id]=X);let F=X[R.id];F===void 0&&(F={},X[R.id]=F);let z=F[G];return z===void 0&&(z=p(c()),F[G]=z),z}function p(M){const R=[],k=[],G=[];for(let X=0;X<i;X++)R[X]=0,k[X]=0,G[X]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:R,enabledAttributes:k,attributeDivisors:G,object:M,attributes:{},index:null}}function g(M,R,k,G){const X=o.attributes,F=R.attributes;let z=0;const H=k.getAttributes();for(const Z in H)if(H[Z].location>=0){const he=X[Z];let be=F[Z];if(be===void 0&&(Z==="instanceMatrix"&&M.instanceMatrix&&(be=M.instanceMatrix),Z==="instanceColor"&&M.instanceColor&&(be=M.instanceColor)),he===void 0||he.attribute!==be||be&&he.data!==be.data)return!0;z++}return o.attributesNum!==z||o.index!==G}function f(M,R,k,G){const X={},F=R.attributes;let z=0;const H=k.getAttributes();for(const Z in H)if(H[Z].location>=0){let he=F[Z];he===void 0&&(Z==="instanceMatrix"&&M.instanceMatrix&&(he=M.instanceMatrix),Z==="instanceColor"&&M.instanceColor&&(he=M.instanceColor));const be={};be.attribute=he,he&&he.data&&(be.data=he.data),X[Z]=be,z++}o.attributes=X,o.attributesNum=z,o.index=G}function A(){const M=o.newAttributes;for(let R=0,k=M.length;R<k;R++)M[R]=0}function y(M){b(M,0)}function b(M,R){const k=o.newAttributes,G=o.enabledAttributes,X=o.attributeDivisors;k[M]=1,G[M]===0&&(n.enableVertexAttribArray(M),G[M]=1),X[M]!==R&&(n.vertexAttribDivisor(M,R),X[M]=R)}function v(){const M=o.newAttributes,R=o.enabledAttributes;for(let k=0,G=R.length;k<G;k++)R[k]!==M[k]&&(n.disableVertexAttribArray(k),R[k]=0)}function x(M,R,k,G,X,F,z){z===!0?n.vertexAttribIPointer(M,R,k,X,F):n.vertexAttribPointer(M,R,k,G,X,F)}function w(M,R,k,G){A();const X=G.attributes,F=k.getAttributes(),z=R.defaultAttributeValues;for(const H in F){const Z=F[H];if(Z.location>=0){let he=X[H];if(he===void 0&&(H==="instanceMatrix"&&M.instanceMatrix&&(he=M.instanceMatrix),H==="instanceColor"&&M.instanceColor&&(he=M.instanceColor)),he!==void 0){const be=he.normalized,_e=he.itemSize,Ye=e.get(he);if(Ye===void 0)continue;const je=Ye.buffer,le=Ye.type,ve=Ye.bytesPerElement,Pe=le===n.INT||le===n.UNSIGNED_INT||he.gpuType===nd;if(he.isInterleavedBufferAttribute){const ke=he.data,_t=ke.stride,rt=he.offset;if(ke.isInstancedInterleavedBuffer){for(let xt=0;xt<Z.locationSize;xt++)b(Z.location+xt,ke.meshPerAttribute);M.isInstancedMesh!==!0&&G._maxInstanceCount===void 0&&(G._maxInstanceCount=ke.meshPerAttribute*ke.count)}else for(let xt=0;xt<Z.locationSize;xt++)y(Z.location+xt);n.bindBuffer(n.ARRAY_BUFFER,je);for(let xt=0;xt<Z.locationSize;xt++)x(Z.location+xt,_e/Z.locationSize,le,be,_t*ve,(rt+_e/Z.locationSize*xt)*ve,Pe)}else{if(he.isInstancedBufferAttribute){for(let ke=0;ke<Z.locationSize;ke++)b(Z.location+ke,he.meshPerAttribute);M.isInstancedMesh!==!0&&G._maxInstanceCount===void 0&&(G._maxInstanceCount=he.meshPerAttribute*he.count)}else for(let ke=0;ke<Z.locationSize;ke++)y(Z.location+ke);n.bindBuffer(n.ARRAY_BUFFER,je);for(let ke=0;ke<Z.locationSize;ke++)x(Z.location+ke,_e/Z.locationSize,le,be,_e*ve,_e/Z.locationSize*ke*ve,Pe)}}else if(z!==void 0){const be=z[H];if(be!==void 0)switch(be.length){case 2:n.vertexAttrib2fv(Z.location,be);break;case 3:n.vertexAttrib3fv(Z.location,be);break;case 4:n.vertexAttrib4fv(Z.location,be);break;default:n.vertexAttrib1fv(Z.location,be)}}}}v()}function C(){I();for(const M in s){const R=s[M];for(const k in R){const G=R[k];for(const X in G)d(G[X].object),delete G[X];delete R[k]}delete s[M]}}function S(M){if(s[M.id]===void 0)return;const R=s[M.id];for(const k in R){const G=R[k];for(const X in G)d(G[X].object),delete G[X];delete R[k]}delete s[M.id]}function _(M){for(const R in s){const k=s[R];if(k[M.id]===void 0)continue;const G=k[M.id];for(const X in G)d(G[X].object),delete G[X];delete k[M.id]}}function I(){B(),a=!0,o!==r&&(o=r,h(o.object))}function B(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:l,reset:I,resetDefaultState:B,dispose:C,releaseStatesOfGeometry:S,releaseStatesOfProgram:_,initAttributes:A,enableAttribute:y,disableUnusedAttributes:v}}function tpe(n,e,i){let s;function r(h){s=h}function o(h,d){n.drawArrays(s,h,d),i.update(d,s,1)}function a(h,d,u){u!==0&&(n.drawArraysInstanced(s,h,d,u),i.update(d,s,u))}function l(h,d,u){if(u===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(s,h,0,d,0,u);let p=0;for(let g=0;g<u;g++)p+=d[g];i.update(p,s,1)}function c(h,d,u,p){if(u===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let f=0;f<h.length;f++)a(h[f],d[f],p[f]);else{g.multiDrawArraysInstancedWEBGL(s,h,0,d,0,p,0,u);let f=0;for(let A=0;A<u;A++)f+=d[A];for(let A=0;A<p.length;A++)i.update(f,s,p[A])}}this.setMode=r,this.render=o,this.renderInstances=a,this.renderMultiDraw=l,this.renderMultiDrawInstances=c}function ipe(n,e,i,s){let r;function o(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const _=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(_.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function a(_){return!(_!==_i&&s.convert(_)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function l(_){const I=_===Ki&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(_!==Xi&&s.convert(_)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&_!==en&&!I)}function c(_){if(_==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";_="mediump"}return _==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let h=i.precision!==void 0?i.precision:"highp";const d=c(h);d!==h&&(console.warn("THREE.WebGLRenderer:",h,"not supported, using",d,"instead."),h=d);const u=i.logarithmicDepthBuffer===!0,p=i.reverseDepthBuffer===!0&&e.has("EXT_clip_control");if(p===!0){const _=e.get("EXT_clip_control");_.clipControlEXT(_.LOWER_LEFT_EXT,_.ZERO_TO_ONE_EXT)}const g=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),f=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),A=n.getParameter(n.MAX_TEXTURE_SIZE),y=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),b=n.getParameter(n.MAX_VERTEX_ATTRIBS),v=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),x=n.getParameter(n.MAX_VARYING_VECTORS),w=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),C=f>0,S=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:o,getMaxPrecision:c,textureFormatReadable:a,textureTypeReadable:l,precision:h,logarithmicDepthBuffer:u,reverseDepthBuffer:p,maxTextures:g,maxVertexTextures:f,maxTextureSize:A,maxCubemapSize:y,maxAttributes:b,maxVertexUniforms:v,maxVaryings:x,maxFragmentUniforms:w,vertexTextures:C,maxSamples:S}}function npe(n){const e=this;let i=null,s=0,r=!1,o=!1;const a=new tr,l=new oi,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(u,p){const g=u.length!==0||p||s!==0||r;return r=p,s=u.length,g},this.beginShadows=function(){o=!0,d(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(u,p){i=d(u,p,0)},this.setState=function(u,p,g){const f=u.clippingPlanes,A=u.clipIntersection,y=u.clipShadows,b=n.get(u);if(!r||f===null||f.length===0||o&&!y)o?d(null):h();else{const v=o?0:s,x=v*4;let w=b.clippingState||null;c.value=w,w=d(f,p,x,g);for(let C=0;C!==x;++C)w[C]=i[C];b.clippingState=w,this.numIntersection=A?this.numPlanes:0,this.numPlanes+=v}};function h(){c.value!==i&&(c.value=i,c.needsUpdate=s>0),e.numPlanes=s,e.numIntersection=0}function d(u,p,g,f){const A=u!==null?u.length:0;let y=null;if(A!==0){if(y=c.value,f!==!0||y===null){const b=g+A*4,v=p.matrixWorldInverse;l.getNormalMatrix(v),(y===null||y.length<b)&&(y=new Float32Array(b));for(let x=0,w=g;x!==A;++x,w+=4)a.copy(u[x]).applyMatrix4(v,l),a.normal.toArray(y,w),y[w+3]=a.constant}c.value=y,c.needsUpdate=!0}return e.numPlanes=A,e.numIntersection=0,y}}function spe(n){let e=new WeakMap;function i(a,l){return l===ao?a.mapping=bl:l===Yp&&(a.mapping=gc),a}function s(a){if(a&&a.isTexture){const l=a.mapping;if(l===ao||l===Yp)if(e.has(a)){const c=e.get(a).texture;return i(c,a.mapping)}else{const c=a.image;if(c&&c.height>0){const h=new GI(c.height);return h.fromEquirectangularTexture(n,a),e.set(a,h),a.addEventListener("dispose",r),i(h.texture,a.mapping)}else return null}}return a}function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap}return{get:s,dispose:o}}let lh=class extends t1{constructor(n=-1,e=1,i=1,s=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=n,this.right=e,this.top=i,this.bottom=s,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(n,e){return super.copy(n,e),this.left=n.left,this.right=n.right,this.top=n.top,this.bottom=n.bottom,this.near=n.near,this.far=n.far,this.zoom=n.zoom,this.view=n.view===null?null:Object.assign({},n.view),this}setViewOffset(n,e,i,s,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-n,o=i+n,a=s+e,l=s-e;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(n){const e=super.toJSON(n);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}};const vy=4,a9=[.125,.215,.35,.446,.526,.582],_f=20,QG=new lh,l9=new fe;let KG=null,YG=0,jG=0,JG=!1;const Mf=(1+Math.sqrt(5))/2,xy=1/Mf,c9=[new E(-Mf,xy,0),new E(Mf,xy,0),new E(-xy,0,Mf),new E(xy,0,Mf),new E(0,Mf,-xy),new E(0,Mf,xy),new E(-1,1,-1),new E(1,1,-1),new E(-1,1,1),new E(1,1,1)];let qG=class{constructor(n){this._renderer=n,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(n,e=0,i=.1,s=100){KG=this._renderer.getRenderTarget(),YG=this._renderer.getActiveCubeFace(),jG=this._renderer.getActiveMipmapLevel(),JG=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(n,i,s,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(n,e=null){return this._fromTexture(n,e)}fromCubemap(n,e=null){return this._fromTexture(n,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=p9(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=u9(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(n){this._lodMax=Math.floor(Math.log2(n)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let n=0;n<this._lodPlanes.length;n++)this._lodPlanes[n].dispose()}_cleanup(n){this._renderer.setRenderTarget(KG,YG,jG),this._renderer.xr.enabled=JG,n.scissorTest=!1,VI(n,0,0,n.width,n.height)}_fromTexture(n,e){n.mapping===bl||n.mapping===gc?this._setSize(n.image.length===0?16:n.image[0].width||n.image[0].image.width):this._setSize(n.image.width/4),KG=this._renderer.getRenderTarget(),YG=this._renderer.getActiveCubeFace(),jG=this._renderer.getActiveMipmapLevel(),JG=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=e||this._allocateTargets();return this._textureToCubeUV(n,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const n=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:Wt,minFilter:Wt,generateMipmaps:!1,type:Ki,format:_i,colorSpace:qi,depthBuffer:!1},s=d9(n,e,i),{_lodMax:r}=this;if({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=h9(r),this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==n||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=d9(n,e,i);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=h9(o)),this._blurMaterial=rpe(o,n,e)}return s}_compileMaterial(n){const e=new pe(this._lodPlanes[0],n);this._renderer.compile(e,QG)}_sceneToCubeUV(n,e,i,s){const r=new Ot(90,1,e,i),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,h=l.toneMapping;l.getClearColor(l9),l.toneMapping=kr,l.autoClear=!1;const d=new ai({name:"PMREM.Background",side:wn,depthWrite:!1,depthTest:!1}),u=new pe(new bn,d);let p=!1;const g=n.background;g?g.isColor&&(d.color.copy(g),n.background=null,p=!0):(d.color.copy(l9),p=!0);for(let f=0;f<6;f++){const A=f%3;A===0?(r.up.set(0,o[f],0),r.lookAt(a[f],0,0)):A===1?(r.up.set(0,0,o[f]),r.lookAt(0,a[f],0)):(r.up.set(0,o[f],0),r.lookAt(0,0,a[f]));const y=this._cubeSize;VI(s,A*y,f>2?y:0,y,y),l.setRenderTarget(s),p&&l.render(u,r),l.render(n,r)}u.geometry.dispose(),u.material.dispose(),l.toneMapping=h,l.autoClear=c,n.background=g}_textureToCubeUV(n,e){const i=this._renderer,s=n.mapping===bl||n.mapping===gc;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=p9()),this._cubemapMaterial.uniforms.flipEnvMap.value=n.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=u9());const r=s?this._cubemapMaterial:this._equirectMaterial,o=new pe(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=n;const l=this._cubeSize;VI(e,0,0,3*l,2*l),i.setRenderTarget(e),i.render(o,QG)}_applyPMREM(n){const e=this._renderer,i=e.autoClear;e.autoClear=!1;const s=this._lodPlanes.length;for(let r=1;r<s;r++){const o=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),a=c9[(s-r-1)%c9.length];this._blur(n,r-1,r,o,a)}e.autoClear=i}_blur(n,e,i,s,r){const o=this._pingPongRenderTarget;this._halfBlur(n,o,e,i,s,"latitudinal",r),this._halfBlur(o,n,i,i,s,"longitudinal",r)}_halfBlur(n,e,i,s,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,d=new pe(this._lodPlanes[s],c),u=c.uniforms,p=this._sizeLods[i]-1,g=isFinite(r)?Math.PI/(2*p):2*Math.PI/(2*_f-1),f=r/g,A=isFinite(r)?1+Math.floor(h*f):_f;A>_f&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${A} samples when the maximum is set to ${_f}`);const y=[];let b=0;for(let S=0;S<_f;++S){const _=S/f,I=Math.exp(-_*_/2);y.push(I),S===0?b+=I:S<A&&(b+=2*I)}for(let S=0;S<y.length;S++)y[S]=y[S]/b;u.envMap.value=n.texture,u.samples.value=A,u.weights.value=y,u.latitudinal.value=o==="latitudinal",a&&(u.poleAxis.value=a);const{_lodMax:v}=this;u.dTheta.value=g,u.mipInt.value=v-i;const x=this._sizeLods[s],w=3*x*(s>v-vy?s-v+vy:0),C=4*(this._cubeSize-x);VI(e,w,C,3*x,2*x),l.setRenderTarget(e),l.render(d,QG)}};function h9(n){const e=[],i=[],s=[];let r=n;const o=n-vy+1+a9.length;for(let a=0;a<o;a++){const l=Math.pow(2,r);i.push(l);let c=1/l;a>n-vy?c=a9[a-n+vy-1]:a===0&&(c=0),s.push(c);const h=1/(l-2),d=-h,u=1+h,p=[d,d,u,d,u,u,d,d,u,u,d,u],g=6,f=6,A=3,y=2,b=1,v=new Float32Array(A*f*g),x=new Float32Array(y*f*g),w=new Float32Array(b*f*g);for(let S=0;S<g;S++){const _=S%3*2/3-1,I=S>2?0:-1,B=[_,I,0,_+2/3,I,0,_+2/3,I+1,0,_,I,0,_+2/3,I+1,0,_,I+1,0];v.set(B,A*f*S),x.set(p,y*f*S);const M=[S,S,S,S,S,S];w.set(M,b*f*S)}const C=new Rt;C.setAttribute("position",new ct(v,A)),C.setAttribute("uv",new ct(x,y)),C.setAttribute("faceIndex",new ct(w,b)),e.push(C),r>vy&&r--}return{lodPlanes:e,sizeLods:i,sigmas:s}}function d9(n,e,i){const s=new fi(n,e,i);return s.texture.mapping=cf,s.texture.name="PMREM.cubeUv",s.scissorTest=!0,s}function VI(n,e,i,s,r){n.viewport.set(e,i,s,r),n.scissor.set(e,i,s,r)}function rpe(n,e,i){const s=new Float32Array(_f),r=new E(0,1,0);return new jt({name:"SphericalGaussianBlur",defines:{n:_f,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:s},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:$G(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Pn,depthTest:!1,depthWrite:!1})}function u9(){return new jt({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:$G(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Pn,depthTest:!1,depthWrite:!1})}function p9(){return new jt({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:$G(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Pn,depthTest:!1,depthWrite:!1})}function $G(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function ope(n){let e=new WeakMap,i=null;function s(l){if(l&&l.isTexture){const c=l.mapping,h=c===ao||c===Yp,d=c===bl||c===gc;if(h||d){let u=e.get(l);const p=u!==void 0?u.texture.pmremVersion:0;if(l.isRenderTargetTexture&&l.pmremVersion!==p)return i===null&&(i=new qG(n)),u=h?i.fromEquirectangular(l,u):i.fromCubemap(l,u),u.texture.pmremVersion=l.pmremVersion,e.set(l,u),u.texture;if(u!==void 0)return u.texture;{const g=l.image;return h&&g&&g.height>0||d&&g&&r(g)?(i=new qG(n),u=h?i.fromEquirectangular(l):i.fromCubemap(l),u.texture.pmremVersion=l.pmremVersion,e.set(l,u),l.addEventListener("dispose",o),u.texture):null}}}return l}function r(l){let c=0;const h=6;for(let d=0;d<h;d++)l[d]!==void 0&&c++;return c===h}function o(l){const c=l.target;c.removeEventListener("dispose",o);const h=e.get(c);h!==void 0&&(e.delete(c),h.dispose())}function a(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:s,dispose:a}}function ape(n){const e={};function i(s){if(e[s]!==void 0)return e[s];let r;switch(s){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(s)}return e[s]=r,r}return{has:function(s){return i(s)!==null},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(s){const r=i(s);return r===null&&mI("THREE.WebGLRenderer: "+s+" extension not supported."),r}}}function lpe(n,e,i,s){const r={},o=new WeakMap;function a(u){const p=u.target;p.index!==null&&e.remove(p.index);for(const f in p.attributes)e.remove(p.attributes[f]);for(const f in p.morphAttributes){const A=p.morphAttributes[f];for(let y=0,b=A.length;y<b;y++)e.remove(A[y])}p.removeEventListener("dispose",a),delete r[p.id];const g=o.get(p);g&&(e.remove(g),o.delete(p)),s.releaseStatesOfGeometry(p),p.isInstancedBufferGeometry===!0&&delete p._maxInstanceCount,i.memory.geometries--}function l(u,p){return r[p.id]===!0||(p.addEventListener("dispose",a),r[p.id]=!0,i.memory.geometries++),p}function c(u){const p=u.attributes;for(const f in p)e.update(p[f],n.ARRAY_BUFFER);const g=u.morphAttributes;for(const f in g){const A=g[f];for(let y=0,b=A.length;y<b;y++)e.update(A[y],n.ARRAY_BUFFER)}}function h(u){const p=[],g=u.index,f=u.attributes.position;let A=0;if(g!==null){const v=g.array;A=g.version;for(let x=0,w=v.length;x<w;x+=3){const C=v[x+0],S=v[x+1],_=v[x+2];p.push(C,S,S,_,_,C)}}else if(f!==void 0){const v=f.array;A=f.version;for(let x=0,w=v.length/3-1;x<w;x+=3){const C=x+0,S=x+1,_=x+2;p.push(C,S,S,_,_,C)}}else return;const y=new(VW(p)?OG:_I)(p,1);y.version=A;const b=o.get(u);b&&e.remove(b),o.set(u,y)}function d(u){const p=o.get(u);if(p){const g=u.index;g!==null&&p.version<g.version&&h(u)}else h(u);return o.get(u)}return{get:l,update:c,getWireframeAttribute:d}}function cpe(n,e,i){let s;function r(p){s=p}let o,a;function l(p){o=p.type,a=p.bytesPerElement}function c(p,g){n.drawElements(s,g,o,p*a),i.update(g,s,1)}function h(p,g,f){f!==0&&(n.drawElementsInstanced(s,g,o,p*a,f),i.update(g,s,f))}function d(p,g,f){if(f===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(s,g,0,o,p,0,f);let A=0;for(let y=0;y<f;y++)A+=g[y];i.update(A,s,1)}function u(p,g,f,A){if(f===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let b=0;b<p.length;b++)h(p[b]/a,g[b],A[b]);else{y.multiDrawElementsInstancedWEBGL(s,g,0,o,p,0,A,0,f);let b=0;for(let v=0;v<f;v++)b+=g[v];for(let v=0;v<A.length;v++)i.update(b,s,A[v])}}this.setMode=r,this.setIndex=l,this.render=c,this.renderInstances=h,this.renderMultiDraw=d,this.renderMultiDrawInstances=u}function hpe(n){const e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function s(o,a,l){switch(i.calls++,a){case n.TRIANGLES:i.triangles+=l*(o/3);break;case n.LINES:i.lines+=l*(o/2);break;case n.LINE_STRIP:i.lines+=l*(o-1);break;case n.LINE_LOOP:i.lines+=l*o;break;case n.POINTS:i.points+=l*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function r(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:r,update:s}}function dpe(n,e,i){const s=new WeakMap,r=new $e;function o(a,l,c){const h=a.morphTargetInfluences,d=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,u=d!==void 0?d.length:0;let p=s.get(l);if(p===void 0||p.count!==u){let g=function(){I.dispose(),s.delete(l),l.removeEventListener("dispose",g)};p!==void 0&&p.texture.dispose();const f=l.morphAttributes.position!==void 0,A=l.morphAttributes.normal!==void 0,y=l.morphAttributes.color!==void 0,b=l.morphAttributes.position||[],v=l.morphAttributes.normal||[],x=l.morphAttributes.color||[];let w=0;f===!0&&(w=1),A===!0&&(w=2),y===!0&&(w=3);let C=l.attributes.position.count*w,S=1;C>e.maxTextureSize&&(S=Math.ceil(C/e.maxTextureSize),C=e.maxTextureSize);const _=new Float32Array(C*S*4*u),I=new Yx(_,C,S,u);I.type=en,I.needsUpdate=!0;const B=w*4;for(let M=0;M<u;M++){const R=b[M],k=v[M],G=x[M],X=C*S*4*M;for(let F=0;F<R.count;F++){const z=F*B;f===!0&&(r.fromBufferAttribute(R,F),_[X+z+0]=r.x,_[X+z+1]=r.y,_[X+z+2]=r.z,_[X+z+3]=0),A===!0&&(r.fromBufferAttribute(k,F),_[X+z+4]=r.x,_[X+z+5]=r.y,_[X+z+6]=r.z,_[X+z+7]=0),y===!0&&(r.fromBufferAttribute(G,F),_[X+z+8]=r.x,_[X+z+9]=r.y,_[X+z+10]=r.z,_[X+z+11]=G.itemSize===4?r.w:1)}}p={count:u,texture:I,size:new Q(C,S)},s.set(l,p),l.addEventListener("dispose",g)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)c.getUniforms().setValue(n,"morphTexture",a.morphTexture,i);else{let g=0;for(let A=0;A<h.length;A++)g+=h[A];const f=l.morphTargetsRelative?1:1-g;c.getUniforms().setValue(n,"morphTargetBaseInfluence",f),c.getUniforms().setValue(n,"morphTargetInfluences",h)}c.getUniforms().setValue(n,"morphTargetsTexture",p.texture,i),c.getUniforms().setValue(n,"morphTargetsTextureSize",p.size)}return{update:o}}function upe(n,e,i,s){let r=new WeakMap;function o(c){const h=s.render.frame,d=c.geometry,u=e.get(c,d);if(r.get(u)!==h&&(e.update(u),r.set(u,h)),c.isInstancedMesh&&(c.hasEventListener("dispose",l)===!1&&c.addEventListener("dispose",l),r.get(c)!==h&&(i.update(c.instanceMatrix,n.ARRAY_BUFFER),c.instanceColor!==null&&i.update(c.instanceColor,n.ARRAY_BUFFER),r.set(c,h))),c.isSkinnedMesh){const p=c.skeleton;r.get(p)!==h&&(p.update(),r.set(p,h))}return u}function a(){r=new WeakMap}function l(c){const h=c.target;h.removeEventListener("dispose",l),i.remove(h.instanceMatrix),h.instanceColor!==null&&i.remove(h.instanceColor)}return{update:o,dispose:a}}class Eu extends di{constructor(e,i,s,r,o,a,l,c,h,d=df){if(d!==df&&d!==Jp)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");s===void 0&&d===df&&(s=Gr),s===void 0&&d===Jp&&(s=jp),super(null,r,o,a,l,c,d,s,h),this.isDepthTexture=!0,this.image={width:e,height:i},this.magFilter=l!==void 0?l:si,this.minFilter=c!==void 0?c:si,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const i=super.toJSON(e);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}const m9=new di,g9=new Eu(1,1),f9=new Yx,A9=new gI,y9=new xf,b9=[],v9=[],x9=new Float32Array(16),w9=new Float32Array(9),C9=new Float32Array(4);function wy(n,e,i){const s=n[0];if(s<=0||s>0)return n;const r=e*i;let o=b9[r];if(o===void 0&&(o=new Float32Array(r),b9[r]=o),e!==0){s.toArray(o,0);for(let a=1,l=0;a!==e;++a)l+=i,n[a].toArray(o,l)}return o}function vr(n,e){if(n.length!==e.length)return!1;for(let i=0,s=n.length;i<s;i++)if(n[i]!==e[i])return!1;return!0}function xr(n,e){for(let i=0,s=e.length;i<s;i++)n[i]=e[i]}function XI(n,e){let i=v9[e];i===void 0&&(i=new Int32Array(e),v9[e]=i);for(let s=0;s!==e;++s)i[s]=n.allocateTextureUnit();return i}function ppe(n,e){const i=this.cache;i[0]!==e&&(n.uniform1f(this.addr,e),i[0]=e)}function mpe(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(vr(i,e))return;n.uniform2fv(this.addr,e),xr(i,e)}}function gpe(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(vr(i,e))return;n.uniform3fv(this.addr,e),xr(i,e)}}function fpe(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(vr(i,e))return;n.uniform4fv(this.addr,e),xr(i,e)}}function Ape(n,e){const i=this.cache,s=e.elements;if(s===void 0){if(vr(i,e))return;n.uniformMatrix2fv(this.addr,!1,e),xr(i,e)}else{if(vr(i,s))return;C9.set(s),n.uniformMatrix2fv(this.addr,!1,C9),xr(i,s)}}function ype(n,e){const i=this.cache,s=e.elements;if(s===void 0){if(vr(i,e))return;n.uniformMatrix3fv(this.addr,!1,e),xr(i,e)}else{if(vr(i,s))return;w9.set(s),n.uniformMatrix3fv(this.addr,!1,w9),xr(i,s)}}function bpe(n,e){const i=this.cache,s=e.elements;if(s===void 0){if(vr(i,e))return;n.uniformMatrix4fv(this.addr,!1,e),xr(i,e)}else{if(vr(i,s))return;x9.set(s),n.uniformMatrix4fv(this.addr,!1,x9),xr(i,s)}}function vpe(n,e){const i=this.cache;i[0]!==e&&(n.uniform1i(this.addr,e),i[0]=e)}function xpe(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(vr(i,e))return;n.uniform2iv(this.addr,e),xr(i,e)}}function wpe(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(vr(i,e))return;n.uniform3iv(this.addr,e),xr(i,e)}}function Cpe(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(vr(i,e))return;n.uniform4iv(this.addr,e),xr(i,e)}}function Spe(n,e){const i=this.cache;i[0]!==e&&(n.uniform1ui(this.addr,e),i[0]=e)}function _pe(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(vr(i,e))return;n.uniform2uiv(this.addr,e),xr(i,e)}}function Mpe(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(vr(i,e))return;n.uniform3uiv(this.addr,e),xr(i,e)}}function Ipe(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(vr(i,e))return;n.uniform4uiv(this.addr,e),xr(i,e)}}function Tpe(n,e,i){const s=this.cache,r=i.allocateTextureUnit();s[0]!==r&&(n.uniform1i(this.addr,r),s[0]=r);let o;this.type===n.SAMPLER_2D_SHADOW?(g9.compareFunction=CG,o=g9):o=m9,i.setTexture2D(e||o,r)}function Epe(n,e,i){const s=this.cache,r=i.allocateTextureUnit();s[0]!==r&&(n.uniform1i(this.addr,r),s[0]=r),i.setTexture3D(e||A9,r)}function Rpe(n,e,i){const s=this.cache,r=i.allocateTextureUnit();s[0]!==r&&(n.uniform1i(this.addr,r),s[0]=r),i.setTextureCube(e||y9,r)}function Lpe(n,e,i){const s=this.cache,r=i.allocateTextureUnit();s[0]!==r&&(n.uniform1i(this.addr,r),s[0]=r),i.setTexture2DArray(e||f9,r)}function Bpe(n){switch(n){case 5126:return ppe;case 35664:return mpe;case 35665:return gpe;case 35666:return fpe;case 35674:return Ape;case 35675:return ype;case 35676:return bpe;case 5124:case 35670:return vpe;case 35667:case 35671:return xpe;case 35668:case 35672:return wpe;case 35669:case 35673:return Cpe;case 5125:return Spe;case 36294:return _pe;case 36295:return Mpe;case 36296:return Ipe;case 35678:case 36198:case 36298:case 36306:case 35682:return Tpe;case 35679:case 36299:case 36307:return Epe;case 35680:case 36300:case 36308:case 36293:return Rpe;case 36289:case 36303:case 36311:case 36292:return Lpe}}function kpe(n,e){n.uniform1fv(this.addr,e)}function Gpe(n,e){const i=wy(e,this.size,2);n.uniform2fv(this.addr,i)}function Ppe(n,e){const i=wy(e,this.size,3);n.uniform3fv(this.addr,i)}function Npe(n,e){const i=wy(e,this.size,4);n.uniform4fv(this.addr,i)}function Vpe(n,e){const i=wy(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,i)}function Xpe(n,e){const i=wy(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,i)}function Dpe(n,e){const i=wy(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,i)}function zpe(n,e){n.uniform1iv(this.addr,e)}function Fpe(n,e){n.uniform2iv(this.addr,e)}function Upe(n,e){n.uniform3iv(this.addr,e)}function Ope(n,e){n.uniform4iv(this.addr,e)}function Zpe(n,e){n.uniform1uiv(this.addr,e)}function Wpe(n,e){n.uniform2uiv(this.addr,e)}function Hpe(n,e){n.uniform3uiv(this.addr,e)}function Qpe(n,e){n.uniform4uiv(this.addr,e)}function Kpe(n,e,i){const s=this.cache,r=e.length,o=XI(i,r);vr(s,o)||(n.uniform1iv(this.addr,o),xr(s,o));for(let a=0;a!==r;++a)i.setTexture2D(e[a]||m9,o[a])}function Ype(n,e,i){const s=this.cache,r=e.length,o=XI(i,r);vr(s,o)||(n.uniform1iv(this.addr,o),xr(s,o));for(let a=0;a!==r;++a)i.setTexture3D(e[a]||A9,o[a])}function jpe(n,e,i){const s=this.cache,r=e.length,o=XI(i,r);vr(s,o)||(n.uniform1iv(this.addr,o),xr(s,o));for(let a=0;a!==r;++a)i.setTextureCube(e[a]||y9,o[a])}function Jpe(n,e,i){const s=this.cache,r=e.length,o=XI(i,r);vr(s,o)||(n.uniform1iv(this.addr,o),xr(s,o));for(let a=0;a!==r;++a)i.setTexture2DArray(e[a]||f9,o[a])}function qpe(n){switch(n){case 5126:return kpe;case 35664:return Gpe;case 35665:return Ppe;case 35666:return Npe;case 35674:return Vpe;case 35675:return Xpe;case 35676:return Dpe;case 5124:case 35670:return zpe;case 35667:case 35671:return Fpe;case 35668:case 35672:return Upe;case 35669:case 35673:return Ope;case 5125:return Zpe;case 36294:return Wpe;case 36295:return Hpe;case 36296:return Qpe;case 35678:case 36198:case 36298:case 36306:case 35682:return Kpe;case 35679:case 36299:case 36307:return Ype;case 35680:case 36300:case 36308:case 36293:return jpe;case 36289:case 36303:case 36311:case 36292:return Jpe}}class $pe{constructor(e,i,s){this.id=e,this.addr=s,this.cache=[],this.type=i.type,this.setValue=Bpe(i.type)}}class eme{constructor(e,i,s){this.id=e,this.addr=s,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=qpe(i.type)}}class tme{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,i,s){const r=this.seq;for(let o=0,a=r.length;o!==a;++o){const l=r[o];l.setValue(e,i[l.id],s)}}}const eP=/(\w+)(\])?(\[|\.)?/g;function S9(n,e){n.seq.push(e),n.map[e.id]=e}function ime(n,e,i){const s=n.name,r=s.length;for(eP.lastIndex=0;;){const o=eP.exec(s),a=eP.lastIndex;let l=o[1];const c=o[2]==="]",h=o[3];if(c&&(l=l|0),h===void 0||h==="["&&a+2===r){S9(i,h===void 0?new $pe(l,n,e):new eme(l,n,e));break}else{let d=i.map[l];d===void 0&&(d=new tme(l),S9(i,d)),i=d}}}class DI{constructor(e,i){this.seq=[],this.map={};const s=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let r=0;r<s;++r){const o=e.getActiveUniform(i,r),a=e.getUniformLocation(i,o.name);ime(o,a,this)}}setValue(e,i,s,r){const o=this.map[i];o!==void 0&&o.setValue(e,s,r)}setOptional(e,i,s){const r=i[s];r!==void 0&&this.setValue(e,s,r)}static upload(e,i,s,r){for(let o=0,a=i.length;o!==a;++o){const l=i[o],c=s[l.id];c.needsUpdate!==!1&&l.setValue(e,c.value,r)}}static seqWithValue(e,i){const s=[];for(let r=0,o=e.length;r!==o;++r){const a=e[r];a.id in i&&s.push(a)}return s}}function _9(n,e,i){const s=n.createShader(e);return n.shaderSource(s,i),n.compileShader(s),s}const nme=37297;let sme=0;function rme(n,e){const i=n.split(`
`),s=[],r=Math.max(e-6,0),o=Math.min(e+6,i.length);for(let a=r;a<o;a++){const l=a+1;s.push(`${l===e?">":" "} ${l}: ${i[a]}`)}return s.join(`
`)}function ome(n){const e=hi.getPrimaries(hi.workingColorSpace),i=hi.getPrimaries(n);let s;switch(e===i?s="":e===Wx&&i===Zx?s="LinearDisplayP3ToLinearSRGB":e===Zx&&i===Wx&&(s="LinearSRGBToLinearDisplayP3"),n){case qi:case ty:return[s,"LinearTransferOETF"];case ut:case Ux:return[s,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[s,"LinearTransferOETF"]}}function M9(n,e,i){const s=n.getShaderParameter(e,n.COMPILE_STATUS),r=n.getShaderInfoLog(e).trim();if(s&&r==="")return"";const o=/ERROR: 0:(\d+)/.exec(r);if(o){const a=parseInt(o[1]);return i.toUpperCase()+`

`+r+`

`+rme(n.getShaderSource(e),a)}else return r}function ame(n,e){const i=ome(e);return`vec4 ${n}( vec4 value ) { return ${i[0]}( ${i[1]}( value ) ); }`}function lme(n,e){let i;switch(e){case af:i="Linear";break;case HA:i="Reinhard";break;case hG:i="Cineon";break;case QA:i="ACESFilmic";break;case lf:i="AgX";break;case Kp:i="Neutral";break;case uW:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+n+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}const zI=new E;function cme(){hi.getLuminanceCoefficients(zI);const n=zI.x.toFixed(4),e=zI.y.toFixed(4),i=zI.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${i} );`,"	return dot( weights, rgb );","}"].join(`
`)}function hme(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(i1).join(`
`)}function dme(n){const e=[];for(const i in n){const s=n[i];s!==!1&&e.push("#define "+i+" "+s)}return e.join(`
`)}function ume(n,e){const i={},s=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<s;r++){const o=n.getActiveAttrib(e,r),a=o.name;let l=1;o.type===n.FLOAT_MAT2&&(l=2),o.type===n.FLOAT_MAT3&&(l=3),o.type===n.FLOAT_MAT4&&(l=4),i[a]={type:o.type,location:n.getAttribLocation(e,a),locationSize:l}}return i}function i1(n){return n!==""}function I9(n,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function T9(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const pme=/^[ \t]*#include +<([\w\d./]+)>/gm;function tP(n){return n.replace(pme,gme)}const mme=new Map;function gme(n,e){let i=Zt[e];if(i===void 0){const s=mme.get(e);if(s!==void 0)i=Zt[s],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,s);else throw new Error("Can not resolve #include <"+e+">")}return tP(i)}const fme=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function E9(n){return n.replace(fme,Ame)}function Ame(n,e,i,s){let r="";for(let o=parseInt(e);o<parseInt(i);o++)r+=s.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function R9(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function yme(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===iG?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===nG?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Ha&&(e="SHADOWMAP_TYPE_VSM"),e}function bme(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case bl:case gc:e="ENVMAP_TYPE_CUBE";break;case cf:e="ENVMAP_TYPE_CUBE_UV";break}return e}function vme(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case gc:e="ENVMAP_MODE_REFRACTION";break}return e}function xme(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case WA:e="ENVMAP_BLENDING_MULTIPLY";break;case lG:e="ENVMAP_BLENDING_MIX";break;case cG:e="ENVMAP_BLENDING_ADD";break}return e}function wme(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const i=Math.log2(e)-2,s=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:s,maxMip:i}}function Cme(n,e,i,s){const r=n.getContext(),o=i.defines;let a=i.vertexShader,l=i.fragmentShader;const c=yme(i),h=bme(i),d=vme(i),u=xme(i),p=wme(i),g=hme(i),f=dme(o),A=r.createProgram();let y,b,v=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(y=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(i1).join(`
`),y.length>0&&(y+=`
`),b=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(i1).join(`
`),b.length>0&&(b+=`
`)):(y=[R9(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.batchingColor?"#define USE_BATCHING_COLOR":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+d:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(i1).join(`
`),b=[R9(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.envMap?"#define "+d:"",i.envMap?"#define "+u:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.dispersion?"#define USE_DISPERSION":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor||i.batchingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==kr?"#define TONE_MAPPING":"",i.toneMapping!==kr?Zt.tonemapping_pars_fragment:"",i.toneMapping!==kr?lme("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Zt.colorspace_pars_fragment,ame("linearToOutputTexel",i.outputColorSpace),cme(),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(i1).join(`
`)),a=tP(a),a=I9(a,i),a=T9(a,i),l=tP(l),l=I9(l,i),l=T9(l,i),a=E9(a),l=E9(l),i.isRawShaderMaterial!==!0&&(v=`#version 300 es
`,y=[g,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,b=["#define varying in",i.glslVersion===pI?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===pI?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+b);const x=v+y+a,w=v+b+l,C=_9(r,r.VERTEX_SHADER,x),S=_9(r,r.FRAGMENT_SHADER,w);r.attachShader(A,C),r.attachShader(A,S),i.index0AttributeName!==void 0?r.bindAttribLocation(A,0,i.index0AttributeName):i.morphTargets===!0&&r.bindAttribLocation(A,0,"position"),r.linkProgram(A);function _(R){if(n.debug.checkShaderErrors){const k=r.getProgramInfoLog(A).trim(),G=r.getShaderInfoLog(C).trim(),X=r.getShaderInfoLog(S).trim();let F=!0,z=!0;if(r.getProgramParameter(A,r.LINK_STATUS)===!1)if(F=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(r,A,C,S);else{const H=M9(r,C,"vertex"),Z=M9(r,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(A,r.VALIDATE_STATUS)+`

Material Name: `+R.name+`
Material Type: `+R.type+`

Program Info Log: `+k+`
`+H+`
`+Z)}else k!==""?console.warn("THREE.WebGLProgram: Program Info Log:",k):(G===""||X==="")&&(z=!1);z&&(R.diagnostics={runnable:F,programLog:k,vertexShader:{log:G,prefix:y},fragmentShader:{log:X,prefix:b}})}r.deleteShader(C),r.deleteShader(S),I=new DI(r,A),B=ume(r,A)}let I;this.getUniforms=function(){return I===void 0&&_(this),I};let B;this.getAttributes=function(){return B===void 0&&_(this),B};let M=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return M===!1&&(M=r.getProgramParameter(A,nme)),M},this.destroy=function(){s.releaseStatesOfProgram(this),r.deleteProgram(A),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=sme++,this.cacheKey=e,this.usedTimes=1,this.program=A,this.vertexShader=C,this.fragmentShader=S,this}let Sme=0;class _me{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.vertexShader,s=e.fragmentShader,r=this._getShaderStage(i),o=this._getShaderStage(s),a=this._getShaderCacheForMaterial(e);return a.has(r)===!1&&(a.add(r),r.usedTimes++),a.has(o)===!1&&(a.add(o),o.usedTimes++),this}remove(e){const i=this.materialCache.get(e);for(const s of i)s.usedTimes--,s.usedTimes===0&&this.shaderCache.delete(s.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const i=this.materialCache;let s=i.get(e);return s===void 0&&(s=new Set,i.set(e,s)),s}_getShaderStage(e){const i=this.shaderCache;let s=i.get(e);return s===void 0&&(s=new Mme(e),i.set(e,s)),s}}class Mme{constructor(e){this.id=Sme++,this.code=e,this.usedTimes=0}}function Ime(n,e,i,s,r,o,a){const l=new Qo,c=new _me,h=new Set,d=[],u=r.logarithmicDepthBuffer,p=r.reverseDepthBuffer,g=r.vertexTextures;let f=r.precision;const A={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function y(M){return h.add(M),M===0?"uv":`uv${M}`}function b(M,R,k,G,X){const F=G.fog,z=X.geometry,H=M.isMeshStandardMaterial?G.environment:null,Z=(M.isMeshStandardMaterial?i:e).get(M.envMap||H),he=Z&&Z.mapping===cf?Z.image.height:null,be=A[M.type];M.precision!==null&&(f=r.getMaxPrecision(M.precision),f!==M.precision&&console.warn("THREE.WebGLProgram.getParameters:",M.precision,"not supported, using",f,"instead."));const _e=z.morphAttributes.position||z.morphAttributes.normal||z.morphAttributes.color,Ye=_e!==void 0?_e.length:0;let je=0;z.morphAttributes.position!==void 0&&(je=1),z.morphAttributes.normal!==void 0&&(je=2),z.morphAttributes.color!==void 0&&(je=3);let le,ve,Pe,ke;if(be){const Ve=Wn[be];le=Ve.vertexShader,ve=Ve.fragmentShader}else le=M.vertexShader,ve=M.fragmentShader,c.update(M),Pe=c.getVertexShaderID(M),ke=c.getFragmentShaderID(M);const _t=n.getRenderTarget(),rt=X.isInstancedMesh===!0,xt=X.isBatchedMesh===!0,Re=!!M.map,ze=!!M.matcap,U=!!Z,ot=!!M.aoMap,Ne=!!M.lightMap,yt=!!M.bumpMap,ye=!!M.normalMap,zt=!!M.displacementMap,Ct=!!M.emissiveMap,O=!!M.metalnessMap,N=!!M.roughnessMap,ce=M.anisotropy>0,Ee=M.clearcoat>0,He=M.dispersion>0,Le=M.iridescence>0,bt=M.sheen>0,nt=M.transmission>0,mt=ce&&!!M.anisotropyMap,ii=Ee&&!!M.clearcoatMap,Ge=Ee&&!!M.clearcoatNormalMap,Mt=Ee&&!!M.clearcoatRoughnessMap,Yt=Le&&!!M.iridescenceMap,qt=Le&&!!M.iridescenceThicknessMap,et=bt&&!!M.sheenColorMap,Vi=bt&&!!M.sheenRoughnessMap,vi=!!M.specularMap,gn=!!M.specularColorMap,se=!!M.specularIntensityMap,St=nt&&!!M.transmissionMap,we=nt&&!!M.thicknessMap,Ze=!!M.gradientMap,L=!!M.alphaMap,P=M.alphaTest>0,W=!!M.alphaHash,te=!!M.extensions;let Se=kr;M.toneMapped&&(_t===null||_t.isXRRenderTarget===!0)&&(Se=n.toneMapping);const re={shaderID:be,shaderType:M.type,shaderName:M.name,vertexShader:le,fragmentShader:ve,defines:M.defines,customVertexShaderID:Pe,customFragmentShaderID:ke,isRawShaderMaterial:M.isRawShaderMaterial===!0,glslVersion:M.glslVersion,precision:f,batching:xt,batchingColor:xt&&X._colorsTexture!==null,instancing:rt,instancingColor:rt&&X.instanceColor!==null,instancingMorph:rt&&X.morphTexture!==null,supportsVertexTextures:g,outputColorSpace:_t===null?n.outputColorSpace:_t.isXRRenderTarget===!0?_t.texture.colorSpace:qi,alphaToCoverage:!!M.alphaToCoverage,map:Re,matcap:ze,envMap:U,envMapMode:U&&Z.mapping,envMapCubeUVHeight:he,aoMap:ot,lightMap:Ne,bumpMap:yt,normalMap:ye,displacementMap:g&&zt,emissiveMap:Ct,normalMapObjectSpace:ye&&M.normalMapType===vG,normalMapTangentSpace:ye&&M.normalMapType===sd,metalnessMap:O,roughnessMap:N,anisotropy:ce,anisotropyMap:mt,clearcoat:Ee,clearcoatMap:ii,clearcoatNormalMap:Ge,clearcoatRoughnessMap:Mt,dispersion:He,iridescence:Le,iridescenceMap:Yt,iridescenceThicknessMap:qt,sheen:bt,sheenColorMap:et,sheenRoughnessMap:Vi,specularMap:vi,specularColorMap:gn,specularIntensityMap:se,transmission:nt,transmissionMap:St,thicknessMap:we,gradientMap:Ze,opaque:M.transparent===!1&&M.blending===Au&&M.alphaToCoverage===!1,alphaMap:L,alphaTest:P,alphaHash:W,combine:M.combine,mapUv:Re&&y(M.map.channel),aoMapUv:ot&&y(M.aoMap.channel),lightMapUv:Ne&&y(M.lightMap.channel),bumpMapUv:yt&&y(M.bumpMap.channel),normalMapUv:ye&&y(M.normalMap.channel),displacementMapUv:zt&&y(M.displacementMap.channel),emissiveMapUv:Ct&&y(M.emissiveMap.channel),metalnessMapUv:O&&y(M.metalnessMap.channel),roughnessMapUv:N&&y(M.roughnessMap.channel),anisotropyMapUv:mt&&y(M.anisotropyMap.channel),clearcoatMapUv:ii&&y(M.clearcoatMap.channel),clearcoatNormalMapUv:Ge&&y(M.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Mt&&y(M.clearcoatRoughnessMap.channel),iridescenceMapUv:Yt&&y(M.iridescenceMap.channel),iridescenceThicknessMapUv:qt&&y(M.iridescenceThicknessMap.channel),sheenColorMapUv:et&&y(M.sheenColorMap.channel),sheenRoughnessMapUv:Vi&&y(M.sheenRoughnessMap.channel),specularMapUv:vi&&y(M.specularMap.channel),specularColorMapUv:gn&&y(M.specularColorMap.channel),specularIntensityMapUv:se&&y(M.specularIntensityMap.channel),transmissionMapUv:St&&y(M.transmissionMap.channel),thicknessMapUv:we&&y(M.thicknessMap.channel),alphaMapUv:L&&y(M.alphaMap.channel),vertexTangents:!!z.attributes.tangent&&(ye||ce),vertexColors:M.vertexColors,vertexAlphas:M.vertexColors===!0&&!!z.attributes.color&&z.attributes.color.itemSize===4,pointsUvs:X.isPoints===!0&&!!z.attributes.uv&&(Re||L),fog:!!F,useFog:M.fog===!0,fogExp2:!!F&&F.isFogExp2,flatShading:M.flatShading===!0,sizeAttenuation:M.sizeAttenuation===!0,logarithmicDepthBuffer:u,reverseDepthBuffer:p,skinning:X.isSkinnedMesh===!0,morphTargets:z.morphAttributes.position!==void 0,morphNormals:z.morphAttributes.normal!==void 0,morphColors:z.morphAttributes.color!==void 0,morphTargetsCount:Ye,morphTextureStride:je,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numSpotLightMaps:R.spotLightMap.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numSpotLightShadowsWithMaps:R.numSpotLightShadowsWithMaps,numLightProbes:R.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:M.dithering,shadowMapEnabled:n.shadowMap.enabled&&k.length>0,shadowMapType:n.shadowMap.type,toneMapping:Se,decodeVideoTexture:Re&&M.map.isVideoTexture===!0&&hi.getTransfer(M.map.colorSpace)===Nn,premultipliedAlpha:M.premultipliedAlpha,doubleSided:M.side===Qi,flipSided:M.side===wn,useDepthPacking:M.depthPacking>=0,depthPacking:M.depthPacking||0,index0AttributeName:M.index0AttributeName,extensionClipCullDistance:te&&M.extensions.clipCullDistance===!0&&s.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(te&&M.extensions.multiDraw===!0||xt)&&s.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:s.has("KHR_parallel_shader_compile"),customProgramCacheKey:M.customProgramCacheKey()};return re.vertexUv1s=h.has(1),re.vertexUv2s=h.has(2),re.vertexUv3s=h.has(3),h.clear(),re}function v(M){const R=[];if(M.shaderID?R.push(M.shaderID):(R.push(M.customVertexShaderID),R.push(M.customFragmentShaderID)),M.defines!==void 0)for(const k in M.defines)R.push(k),R.push(M.defines[k]);return M.isRawShaderMaterial===!1&&(x(R,M),w(R,M),R.push(n.outputColorSpace)),R.push(M.customProgramCacheKey),R.join()}function x(M,R){M.push(R.precision),M.push(R.outputColorSpace),M.push(R.envMapMode),M.push(R.envMapCubeUVHeight),M.push(R.mapUv),M.push(R.alphaMapUv),M.push(R.lightMapUv),M.push(R.aoMapUv),M.push(R.bumpMapUv),M.push(R.normalMapUv),M.push(R.displacementMapUv),M.push(R.emissiveMapUv),M.push(R.metalnessMapUv),M.push(R.roughnessMapUv),M.push(R.anisotropyMapUv),M.push(R.clearcoatMapUv),M.push(R.clearcoatNormalMapUv),M.push(R.clearcoatRoughnessMapUv),M.push(R.iridescenceMapUv),M.push(R.iridescenceThicknessMapUv),M.push(R.sheenColorMapUv),M.push(R.sheenRoughnessMapUv),M.push(R.specularMapUv),M.push(R.specularColorMapUv),M.push(R.specularIntensityMapUv),M.push(R.transmissionMapUv),M.push(R.thicknessMapUv),M.push(R.combine),M.push(R.fogExp2),M.push(R.sizeAttenuation),M.push(R.morphTargetsCount),M.push(R.morphAttributeCount),M.push(R.numDirLights),M.push(R.numPointLights),M.push(R.numSpotLights),M.push(R.numSpotLightMaps),M.push(R.numHemiLights),M.push(R.numRectAreaLights),M.push(R.numDirLightShadows),M.push(R.numPointLightShadows),M.push(R.numSpotLightShadows),M.push(R.numSpotLightShadowsWithMaps),M.push(R.numLightProbes),M.push(R.shadowMapType),M.push(R.toneMapping),M.push(R.numClippingPlanes),M.push(R.numClipIntersection),M.push(R.depthPacking)}function w(M,R){l.disableAll(),R.supportsVertexTextures&&l.enable(0),R.instancing&&l.enable(1),R.instancingColor&&l.enable(2),R.instancingMorph&&l.enable(3),R.matcap&&l.enable(4),R.envMap&&l.enable(5),R.normalMapObjectSpace&&l.enable(6),R.normalMapTangentSpace&&l.enable(7),R.clearcoat&&l.enable(8),R.iridescence&&l.enable(9),R.alphaTest&&l.enable(10),R.vertexColors&&l.enable(11),R.vertexAlphas&&l.enable(12),R.vertexUv1s&&l.enable(13),R.vertexUv2s&&l.enable(14),R.vertexUv3s&&l.enable(15),R.vertexTangents&&l.enable(16),R.anisotropy&&l.enable(17),R.alphaHash&&l.enable(18),R.batching&&l.enable(19),R.dispersion&&l.enable(20),R.batchingColor&&l.enable(21),M.push(l.mask),l.disableAll(),R.fog&&l.enable(0),R.useFog&&l.enable(1),R.flatShading&&l.enable(2),R.logarithmicDepthBuffer&&l.enable(3),R.reverseDepthBuffer&&l.enable(4),R.skinning&&l.enable(5),R.morphTargets&&l.enable(6),R.morphNormals&&l.enable(7),R.morphColors&&l.enable(8),R.premultipliedAlpha&&l.enable(9),R.shadowMapEnabled&&l.enable(10),R.doubleSided&&l.enable(11),R.flipSided&&l.enable(12),R.useDepthPacking&&l.enable(13),R.dithering&&l.enable(14),R.transmission&&l.enable(15),R.sheen&&l.enable(16),R.opaque&&l.enable(17),R.pointsUvs&&l.enable(18),R.decodeVideoTexture&&l.enable(19),R.alphaToCoverage&&l.enable(20),M.push(l.mask)}function C(M){const R=A[M.type];let k;if(R){const G=Wn[R];k=Ay.clone(G.uniforms)}else k=M.uniforms;return k}function S(M,R){let k;for(let G=0,X=d.length;G<X;G++){const F=d[G];if(F.cacheKey===R){k=F,++k.usedTimes;break}}return k===void 0&&(k=new Cme(n,R,M,o),d.push(k)),k}function _(M){if(--M.usedTimes===0){const R=d.indexOf(M);d[R]=d[d.length-1],d.pop(),M.destroy()}}function I(M){c.remove(M)}function B(){c.dispose()}return{getParameters:b,getProgramCacheKey:v,getUniforms:C,acquireProgram:S,releaseProgram:_,releaseShaderCache:I,programs:d,dispose:B}}function Tme(){let n=new WeakMap;function e(a){return n.has(a)}function i(a){let l=n.get(a);return l===void 0&&(l={},n.set(a,l)),l}function s(a){n.delete(a)}function r(a,l,c){n.get(a)[l]=c}function o(){n=new WeakMap}return{has:e,get:i,remove:s,update:r,dispose:o}}function Eme(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function L9(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function B9(){const n=[];let e=0;const i=[],s=[],r=[];function o(){e=0,i.length=0,s.length=0,r.length=0}function a(u,p,g,f,A,y){let b=n[e];return b===void 0?(b={id:u.id,object:u,geometry:p,material:g,groupOrder:f,renderOrder:u.renderOrder,z:A,group:y},n[e]=b):(b.id=u.id,b.object=u,b.geometry=p,b.material=g,b.groupOrder=f,b.renderOrder=u.renderOrder,b.z=A,b.group=y),e++,b}function l(u,p,g,f,A,y){const b=a(u,p,g,f,A,y);g.transmission>0?s.push(b):g.transparent===!0?r.push(b):i.push(b)}function c(u,p,g,f,A,y){const b=a(u,p,g,f,A,y);g.transmission>0?s.unshift(b):g.transparent===!0?r.unshift(b):i.unshift(b)}function h(u,p){i.length>1&&i.sort(u||Eme),s.length>1&&s.sort(p||L9),r.length>1&&r.sort(p||L9)}function d(){for(let u=e,p=n.length;u<p;u++){const g=n[u];if(g.id===null)break;g.id=null,g.object=null,g.geometry=null,g.material=null,g.group=null}}return{opaque:i,transmissive:s,transparent:r,init:o,push:l,unshift:c,finish:d,sort:h}}function Rme(){let n=new WeakMap;function e(s,r){const o=n.get(s);let a;return o===void 0?(a=new B9,n.set(s,[a])):r>=o.length?(a=new B9,o.push(a)):a=o[r],a}function i(){n=new WeakMap}return{get:e,dispose:i}}function Lme(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new E,color:new fe};break;case"SpotLight":i={position:new E,direction:new E,color:new fe,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new E,color:new fe,distance:0,decay:0};break;case"HemisphereLight":i={direction:new E,skyColor:new fe,groundColor:new fe};break;case"RectAreaLight":i={color:new fe,position:new E,halfWidth:new E,halfHeight:new E};break}return n[e.id]=i,i}}}function Bme(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Q};break;case"SpotLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Q};break;case"PointLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Q,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=i,i}}}let kme=0;function Gme(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function Pme(n){const e=new Lme,i=Bme(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let h=0;h<9;h++)s.probe.push(new E);const r=new E,o=new de,a=new de;function l(h){let d=0,u=0,p=0;for(let B=0;B<9;B++)s.probe[B].set(0,0,0);let g=0,f=0,A=0,y=0,b=0,v=0,x=0,w=0,C=0,S=0,_=0;h.sort(Gme);for(let B=0,M=h.length;B<M;B++){const R=h[B],k=R.color,G=R.intensity,X=R.distance,F=R.shadow&&R.shadow.map?R.shadow.map.texture:null;if(R.isAmbientLight)d+=k.r*G,u+=k.g*G,p+=k.b*G;else if(R.isLightProbe){for(let z=0;z<9;z++)s.probe[z].addScaledVector(R.sh.coefficients[z],G);_++}else if(R.isDirectionalLight){const z=e.get(R);if(z.color.copy(R.color).multiplyScalar(R.intensity),R.castShadow){const H=R.shadow,Z=i.get(R);Z.shadowIntensity=H.intensity,Z.shadowBias=H.bias,Z.shadowNormalBias=H.normalBias,Z.shadowRadius=H.radius,Z.shadowMapSize=H.mapSize,s.directionalShadow[g]=Z,s.directionalShadowMap[g]=F,s.directionalShadowMatrix[g]=R.shadow.matrix,v++}s.directional[g]=z,g++}else if(R.isSpotLight){const z=e.get(R);z.position.setFromMatrixPosition(R.matrixWorld),z.color.copy(k).multiplyScalar(G),z.distance=X,z.coneCos=Math.cos(R.angle),z.penumbraCos=Math.cos(R.angle*(1-R.penumbra)),z.decay=R.decay,s.spot[A]=z;const H=R.shadow;if(R.map&&(s.spotLightMap[C]=R.map,C++,H.updateMatrices(R),R.castShadow&&S++),s.spotLightMatrix[A]=H.matrix,R.castShadow){const Z=i.get(R);Z.shadowIntensity=H.intensity,Z.shadowBias=H.bias,Z.shadowNormalBias=H.normalBias,Z.shadowRadius=H.radius,Z.shadowMapSize=H.mapSize,s.spotShadow[A]=Z,s.spotShadowMap[A]=F,w++}A++}else if(R.isRectAreaLight){const z=e.get(R);z.color.copy(k).multiplyScalar(G),z.halfWidth.set(R.width*.5,0,0),z.halfHeight.set(0,R.height*.5,0),s.rectArea[y]=z,y++}else if(R.isPointLight){const z=e.get(R);if(z.color.copy(R.color).multiplyScalar(R.intensity),z.distance=R.distance,z.decay=R.decay,R.castShadow){const H=R.shadow,Z=i.get(R);Z.shadowIntensity=H.intensity,Z.shadowBias=H.bias,Z.shadowNormalBias=H.normalBias,Z.shadowRadius=H.radius,Z.shadowMapSize=H.mapSize,Z.shadowCameraNear=H.camera.near,Z.shadowCameraFar=H.camera.far,s.pointShadow[f]=Z,s.pointShadowMap[f]=F,s.pointShadowMatrix[f]=R.shadow.matrix,x++}s.point[f]=z,f++}else if(R.isHemisphereLight){const z=e.get(R);z.skyColor.copy(R.color).multiplyScalar(G),z.groundColor.copy(R.groundColor).multiplyScalar(G),s.hemi[b]=z,b++}}y>0&&(n.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=ht.LTC_FLOAT_1,s.rectAreaLTC2=ht.LTC_FLOAT_2):(s.rectAreaLTC1=ht.LTC_HALF_1,s.rectAreaLTC2=ht.LTC_HALF_2)),s.ambient[0]=d,s.ambient[1]=u,s.ambient[2]=p;const I=s.hash;(I.directionalLength!==g||I.pointLength!==f||I.spotLength!==A||I.rectAreaLength!==y||I.hemiLength!==b||I.numDirectionalShadows!==v||I.numPointShadows!==x||I.numSpotShadows!==w||I.numSpotMaps!==C||I.numLightProbes!==_)&&(s.directional.length=g,s.spot.length=A,s.rectArea.length=y,s.point.length=f,s.hemi.length=b,s.directionalShadow.length=v,s.directionalShadowMap.length=v,s.pointShadow.length=x,s.pointShadowMap.length=x,s.spotShadow.length=w,s.spotShadowMap.length=w,s.directionalShadowMatrix.length=v,s.pointShadowMatrix.length=x,s.spotLightMatrix.length=w+C-S,s.spotLightMap.length=C,s.numSpotLightShadowsWithMaps=S,s.numLightProbes=_,I.directionalLength=g,I.pointLength=f,I.spotLength=A,I.rectAreaLength=y,I.hemiLength=b,I.numDirectionalShadows=v,I.numPointShadows=x,I.numSpotShadows=w,I.numSpotMaps=C,I.numLightProbes=_,s.version=kme++)}function c(h,d){let u=0,p=0,g=0,f=0,A=0;const y=d.matrixWorldInverse;for(let b=0,v=h.length;b<v;b++){const x=h[b];if(x.isDirectionalLight){const w=s.directional[u];w.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(y),u++}else if(x.isSpotLight){const w=s.spot[g];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(y),w.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(y),g++}else if(x.isRectAreaLight){const w=s.rectArea[f];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(y),a.identity(),o.copy(x.matrixWorld),o.premultiply(y),a.extractRotation(o),w.halfWidth.set(x.width*.5,0,0),w.halfHeight.set(0,x.height*.5,0),w.halfWidth.applyMatrix4(a),w.halfHeight.applyMatrix4(a),f++}else if(x.isPointLight){const w=s.point[p];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(y),p++}else if(x.isHemisphereLight){const w=s.hemi[A];w.direction.setFromMatrixPosition(x.matrixWorld),w.direction.transformDirection(y),A++}}}return{setup:l,setupView:c,state:s}}function k9(n){const e=new Pme(n),i=[],s=[];function r(d){h.camera=d,i.length=0,s.length=0}function o(d){i.push(d)}function a(d){s.push(d)}function l(){e.setup(i)}function c(d){e.setupView(i,d)}const h={lightsArray:i,shadowsArray:s,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:h,setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function Nme(n){let e=new WeakMap;function i(r,o=0){const a=e.get(r);let l;return a===void 0?(l=new k9(n),e.set(r,[l])):o>=a.length?(l=new k9(n),a.push(l)):l=a[o],l}function s(){e=new WeakMap}return{get:i,dispose:s}}class n1 extends ti{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=co,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class iP extends ti{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Vme=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Xme=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Dme(n,e,i){let s=new Cf;const r=new Q,o=new Q,a=new $e,l=new n1({depthPacking:dI}),c=new iP,h={},d=i.maxTextureSize,u={[ms]:wn,[wn]:ms,[Qi]:Qi},p=new jt({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Q},radius:{value:4}},vertexShader:Vme,fragmentShader:Xme}),g=p.clone();g.defines.HORIZONTAL_PASS=1;const f=new Rt;f.setAttribute("position",new ct(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const A=new pe(f,p),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=iG;let b=this.type;this.render=function(S,_,I){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||S.length===0)return;const B=n.getRenderTarget(),M=n.getActiveCubeFace(),R=n.getActiveMipmapLevel(),k=n.state;k.setBlending(Pn),k.buffers.color.setClear(1,1,1,1),k.buffers.depth.setTest(!0),k.setScissorTest(!1);const G=b!==Ha&&this.type===Ha,X=b===Ha&&this.type!==Ha;for(let F=0,z=S.length;F<z;F++){const H=S[F],Z=H.shadow;if(Z===void 0){console.warn("THREE.WebGLShadowMap:",H,"has no shadow.");continue}if(Z.autoUpdate===!1&&Z.needsUpdate===!1)continue;r.copy(Z.mapSize);const he=Z.getFrameExtents();if(r.multiply(he),o.copy(Z.mapSize),(r.x>d||r.y>d)&&(r.x>d&&(o.x=Math.floor(d/he.x),r.x=o.x*he.x,Z.mapSize.x=o.x),r.y>d&&(o.y=Math.floor(d/he.y),r.y=o.y*he.y,Z.mapSize.y=o.y)),Z.map===null||G===!0||X===!0){const _e=this.type!==Ha?{minFilter:si,magFilter:si}:{};Z.map!==null&&Z.map.dispose(),Z.map=new fi(r.x,r.y,_e),Z.map.texture.name=H.name+".shadowMap",Z.camera.updateProjectionMatrix()}n.setRenderTarget(Z.map),n.clear();const be=Z.getViewportCount();for(let _e=0;_e<be;_e++){const Ye=Z.getViewport(_e);a.set(o.x*Ye.x,o.y*Ye.y,o.x*Ye.z,o.y*Ye.w),k.viewport(a),Z.updateMatrices(H,_e),s=Z.getFrustum(),w(_,I,Z.camera,H,this.type)}Z.isPointLightShadow!==!0&&this.type===Ha&&v(Z,I),Z.needsUpdate=!1}b=this.type,y.needsUpdate=!1,n.setRenderTarget(B,M,R)};function v(S,_){const I=e.update(A);p.defines.VSM_SAMPLES!==S.blurSamples&&(p.defines.VSM_SAMPLES=S.blurSamples,g.defines.VSM_SAMPLES=S.blurSamples,p.needsUpdate=!0,g.needsUpdate=!0),S.mapPass===null&&(S.mapPass=new fi(r.x,r.y)),p.uniforms.shadow_pass.value=S.map.texture,p.uniforms.resolution.value=S.mapSize,p.uniforms.radius.value=S.radius,n.setRenderTarget(S.mapPass),n.clear(),n.renderBufferDirect(_,null,I,p,A,null),g.uniforms.shadow_pass.value=S.mapPass.texture,g.uniforms.resolution.value=S.mapSize,g.uniforms.radius.value=S.radius,n.setRenderTarget(S.map),n.clear(),n.renderBufferDirect(_,null,I,g,A,null)}function x(S,_,I,B){let M=null;const R=I.isPointLight===!0?S.customDistanceMaterial:S.customDepthMaterial;if(R!==void 0)M=R;else if(M=I.isPointLight===!0?c:l,n.localClippingEnabled&&_.clipShadows===!0&&Array.isArray(_.clippingPlanes)&&_.clippingPlanes.length!==0||_.displacementMap&&_.displacementScale!==0||_.alphaMap&&_.alphaTest>0||_.map&&_.alphaTest>0){const k=M.uuid,G=_.uuid;let X=h[k];X===void 0&&(X={},h[k]=X);let F=X[G];F===void 0&&(F=M.clone(),X[G]=F,_.addEventListener("dispose",C)),M=F}if(M.visible=_.visible,M.wireframe=_.wireframe,B===Ha?M.side=_.shadowSide!==null?_.shadowSide:_.side:M.side=_.shadowSide!==null?_.shadowSide:u[_.side],M.alphaMap=_.alphaMap,M.alphaTest=_.alphaTest,M.map=_.map,M.clipShadows=_.clipShadows,M.clippingPlanes=_.clippingPlanes,M.clipIntersection=_.clipIntersection,M.displacementMap=_.displacementMap,M.displacementScale=_.displacementScale,M.displacementBias=_.displacementBias,M.wireframeLinewidth=_.wireframeLinewidth,M.linewidth=_.linewidth,I.isPointLight===!0&&M.isMeshDistanceMaterial===!0){const k=n.properties.get(M);k.light=I}return M}function w(S,_,I,B,M){if(S.visible===!1)return;if(S.layers.test(_.layers)&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&M===Ha)&&(!S.frustumCulled||s.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices(I.matrixWorldInverse,S.matrixWorld);const k=e.update(S),G=S.material;if(Array.isArray(G)){const X=k.groups;for(let F=0,z=X.length;F<z;F++){const H=X[F],Z=G[H.materialIndex];if(Z&&Z.visible){const he=x(S,Z,B,M);S.onBeforeShadow(n,S,_,I,k,he,H),n.renderBufferDirect(I,null,k,he,S,H),S.onAfterShadow(n,S,_,I,k,he,H)}}}else if(G.visible){const X=x(S,G,B,M);S.onBeforeShadow(n,S,_,I,k,X,null),n.renderBufferDirect(I,null,k,X,S,null),S.onAfterShadow(n,S,_,I,k,X,null)}}const R=S.children;for(let k=0,G=R.length;k<G;k++)w(R[k],_,I,B,M)}function C(S){S.target.removeEventListener("dispose",C);for(const _ in h){const I=h[_],B=S.target.uuid;B in I&&(I[B].dispose(),delete I[B])}}}const zme={[Ex]:UA,[rf]:ZA,[Qp]:of,[yu]:OA,[UA]:Ex,[ZA]:rf,[of]:Qp,[OA]:yu};function Fme(n){function e(){let se=!1;const St=new $e;let we=null;const Ze=new $e(0,0,0,0);return{setMask:function(L){we!==L&&!se&&(n.colorMask(L,L,L,L),we=L)},setLocked:function(L){se=L},setClear:function(L,P,W,te,Se){Se===!0&&(L*=te,P*=te,W*=te),St.set(L,P,W,te),Ze.equals(St)===!1&&(n.clearColor(L,P,W,te),Ze.copy(St))},reset:function(){se=!1,we=null,Ze.set(-1,0,0,0)}}}function i(){let se=!1,St=!1,we=null,Ze=null,L=null;return{setReversed:function(P){St=P},setTest:function(P){P?Pe(n.DEPTH_TEST):ke(n.DEPTH_TEST)},setMask:function(P){we!==P&&!se&&(n.depthMask(P),we=P)},setFunc:function(P){if(St&&(P=zme[P]),Ze!==P){switch(P){case Ex:n.depthFunc(n.NEVER);break;case UA:n.depthFunc(n.ALWAYS);break;case rf:n.depthFunc(n.LESS);break;case yu:n.depthFunc(n.LEQUAL);break;case Qp:n.depthFunc(n.EQUAL);break;case OA:n.depthFunc(n.GEQUAL);break;case ZA:n.depthFunc(n.GREATER);break;case of:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}Ze=P}},setLocked:function(P){se=P},setClear:function(P){L!==P&&(n.clearDepth(P),L=P)},reset:function(){se=!1,we=null,Ze=null,L=null}}}function s(){let se=!1,St=null,we=null,Ze=null,L=null,P=null,W=null,te=null,Se=null;return{setTest:function(re){se||(re?Pe(n.STENCIL_TEST):ke(n.STENCIL_TEST))},setMask:function(re){St!==re&&!se&&(n.stencilMask(re),St=re)},setFunc:function(re,Ve,qe){(we!==re||Ze!==Ve||L!==qe)&&(n.stencilFunc(re,Ve,qe),we=re,Ze=Ve,L=qe)},setOp:function(re,Ve,qe){(P!==re||W!==Ve||te!==qe)&&(n.stencilOp(re,Ve,qe),P=re,W=Ve,te=qe)},setLocked:function(re){se=re},setClear:function(re){Se!==re&&(n.clearStencil(re),Se=re)},reset:function(){se=!1,St=null,we=null,Ze=null,L=null,P=null,W=null,te=null,Se=null}}}const r=new e,o=new i,a=new s,l=new WeakMap,c=new WeakMap;let h={},d={},u=new WeakMap,p=[],g=null,f=!1,A=null,y=null,b=null,v=null,x=null,w=null,C=null,S=new fe(0,0,0),_=0,I=!1,B=null,M=null,R=null,k=null,G=null;const X=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let F=!1,z=0;const H=n.getParameter(n.VERSION);H.indexOf("WebGL")!==-1?(z=parseFloat(/^WebGL (\d)/.exec(H)[1]),F=z>=1):H.indexOf("OpenGL ES")!==-1&&(z=parseFloat(/^OpenGL ES (\d)/.exec(H)[1]),F=z>=2);let Z=null,he={};const be=n.getParameter(n.SCISSOR_BOX),_e=n.getParameter(n.VIEWPORT),Ye=new $e().fromArray(be),je=new $e().fromArray(_e);function le(se,St,we,Ze){const L=new Uint8Array(4),P=n.createTexture();n.bindTexture(se,P),n.texParameteri(se,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(se,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let W=0;W<we;W++)se===n.TEXTURE_3D||se===n.TEXTURE_2D_ARRAY?n.texImage3D(St,0,n.RGBA,1,1,Ze,0,n.RGBA,n.UNSIGNED_BYTE,L):n.texImage2D(St+W,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,L);return P}const ve={};ve[n.TEXTURE_2D]=le(n.TEXTURE_2D,n.TEXTURE_2D,1),ve[n.TEXTURE_CUBE_MAP]=le(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),ve[n.TEXTURE_2D_ARRAY]=le(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),ve[n.TEXTURE_3D]=le(n.TEXTURE_3D,n.TEXTURE_3D,1,1),r.setClear(0,0,0,1),o.setClear(1),a.setClear(0),Pe(n.DEPTH_TEST),o.setFunc(yu),Ne(!1),yt(tG),Pe(n.CULL_FACE),U(Pn);function Pe(se){h[se]!==!0&&(n.enable(se),h[se]=!0)}function ke(se){h[se]!==!1&&(n.disable(se),h[se]=!1)}function _t(se,St){return d[se]!==St?(n.bindFramebuffer(se,St),d[se]=St,se===n.DRAW_FRAMEBUFFER&&(d[n.FRAMEBUFFER]=St),se===n.FRAMEBUFFER&&(d[n.DRAW_FRAMEBUFFER]=St),!0):!1}function rt(se,St){let we=p,Ze=!1;if(se){we=u.get(St),we===void 0&&(we=[],u.set(St,we));const L=se.textures;if(we.length!==L.length||we[0]!==n.COLOR_ATTACHMENT0){for(let P=0,W=L.length;P<W;P++)we[P]=n.COLOR_ATTACHMENT0+P;we.length=L.length,Ze=!0}}else we[0]!==n.BACK&&(we[0]=n.BACK,Ze=!0);Ze&&n.drawBuffers(we)}function xt(se){return g!==se?(n.useProgram(se),g=se,!0):!1}const Re={[Hp]:n.FUNC_ADD,[jZ]:n.FUNC_SUBTRACT,[JZ]:n.FUNC_REVERSE_SUBTRACT};Re[qZ]=n.MIN,Re[aG]=n.MAX;const ze={[$Z]:n.ZERO,[eW]:n.ONE,[tW]:n.SRC_COLOR,[VM]:n.SRC_ALPHA,[aW]:n.SRC_ALPHA_SATURATE,[rW]:n.DST_COLOR,[nW]:n.DST_ALPHA,[iW]:n.ONE_MINUS_SRC_COLOR,[XM]:n.ONE_MINUS_SRC_ALPHA,[oW]:n.ONE_MINUS_DST_COLOR,[sW]:n.ONE_MINUS_DST_ALPHA,[lW]:n.CONSTANT_COLOR,[cW]:n.ONE_MINUS_CONSTANT_COLOR,[hW]:n.CONSTANT_ALPHA,[dW]:n.ONE_MINUS_CONSTANT_ALPHA};function U(se,St,we,Ze,L,P,W,te,Se,re){if(se===Pn){f===!0&&(ke(n.BLEND),f=!1);return}if(f===!1&&(Pe(n.BLEND),f=!0),se!==oG){if(se!==A||re!==I){if((y!==Hp||x!==Hp)&&(n.blendEquation(n.FUNC_ADD),y=Hp,x=Hp),re)switch(se){case Au:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Wp:n.blendFunc(n.ONE,n.ONE);break;case sG:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case rG:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",se);break}else switch(se){case Au:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Wp:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case sG:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case rG:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",se);break}b=null,v=null,w=null,C=null,S.set(0,0,0),_=0,A=se,I=re}return}L=L||St,P=P||we,W=W||Ze,(St!==y||L!==x)&&(n.blendEquationSeparate(Re[St],Re[L]),y=St,x=L),(we!==b||Ze!==v||P!==w||W!==C)&&(n.blendFuncSeparate(ze[we],ze[Ze],ze[P],ze[W]),b=we,v=Ze,w=P,C=W),(te.equals(S)===!1||Se!==_)&&(n.blendColor(te.r,te.g,te.b,Se),S.copy(te),_=Se),A=se,I=!1}function ot(se,St){se.side===Qi?ke(n.CULL_FACE):Pe(n.CULL_FACE);let we=se.side===wn;St&&(we=!we),Ne(we),se.blending===Au&&se.transparent===!1?U(Pn):U(se.blending,se.blendEquation,se.blendSrc,se.blendDst,se.blendEquationAlpha,se.blendSrcAlpha,se.blendDstAlpha,se.blendColor,se.blendAlpha,se.premultipliedAlpha),o.setFunc(se.depthFunc),o.setTest(se.depthTest),o.setMask(se.depthWrite),r.setMask(se.colorWrite);const Ze=se.stencilWrite;a.setTest(Ze),Ze&&(a.setMask(se.stencilWriteMask),a.setFunc(se.stencilFunc,se.stencilRef,se.stencilFuncMask),a.setOp(se.stencilFail,se.stencilZFail,se.stencilZPass)),zt(se.polygonOffset,se.polygonOffsetFactor,se.polygonOffsetUnits),se.alphaToCoverage===!0?Pe(n.SAMPLE_ALPHA_TO_COVERAGE):ke(n.SAMPLE_ALPHA_TO_COVERAGE)}function Ne(se){B!==se&&(se?n.frontFace(n.CW):n.frontFace(n.CCW),B=se)}function yt(se){se!==KZ?(Pe(n.CULL_FACE),se!==M&&(se===tG?n.cullFace(n.BACK):se===YZ?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):ke(n.CULL_FACE),M=se}function ye(se){se!==R&&(F&&n.lineWidth(se),R=se)}function zt(se,St,we){se?(Pe(n.POLYGON_OFFSET_FILL),(k!==St||G!==we)&&(n.polygonOffset(St,we),k=St,G=we)):ke(n.POLYGON_OFFSET_FILL)}function Ct(se){se?Pe(n.SCISSOR_TEST):ke(n.SCISSOR_TEST)}function O(se){se===void 0&&(se=n.TEXTURE0+X-1),Z!==se&&(n.activeTexture(se),Z=se)}function N(se,St,we){we===void 0&&(Z===null?we=n.TEXTURE0+X-1:we=Z);let Ze=he[we];Ze===void 0&&(Ze={type:void 0,texture:void 0},he[we]=Ze),(Ze.type!==se||Ze.texture!==St)&&(Z!==we&&(n.activeTexture(we),Z=we),n.bindTexture(se,St||ve[se]),Ze.type=se,Ze.texture=St)}function ce(){const se=he[Z];se!==void 0&&se.type!==void 0&&(n.bindTexture(se.type,null),se.type=void 0,se.texture=void 0)}function Ee(){try{n.compressedTexImage2D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function He(){try{n.compressedTexImage3D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Le(){try{n.texSubImage2D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function bt(){try{n.texSubImage3D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function nt(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function mt(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function ii(){try{n.texStorage2D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Ge(){try{n.texStorage3D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Mt(){try{n.texImage2D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Yt(){try{n.texImage3D.apply(n,arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function qt(se){Ye.equals(se)===!1&&(n.scissor(se.x,se.y,se.z,se.w),Ye.copy(se))}function et(se){je.equals(se)===!1&&(n.viewport(se.x,se.y,se.z,se.w),je.copy(se))}function Vi(se,St){let we=c.get(St);we===void 0&&(we=new WeakMap,c.set(St,we));let Ze=we.get(se);Ze===void 0&&(Ze=n.getUniformBlockIndex(St,se.name),we.set(se,Ze))}function vi(se,St){const we=c.get(St).get(se);l.get(St)!==we&&(n.uniformBlockBinding(St,we,se.__bindingPointIndex),l.set(St,we))}function gn(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),h={},Z=null,he={},d={},u=new WeakMap,p=[],g=null,f=!1,A=null,y=null,b=null,v=null,x=null,w=null,C=null,S=new fe(0,0,0),_=0,I=!1,B=null,M=null,R=null,k=null,G=null,Ye.set(0,0,n.canvas.width,n.canvas.height),je.set(0,0,n.canvas.width,n.canvas.height),r.reset(),o.reset(),a.reset()}return{buffers:{color:r,depth:o,stencil:a},enable:Pe,disable:ke,bindFramebuffer:_t,drawBuffers:rt,useProgram:xt,setBlending:U,setMaterial:ot,setFlipSided:Ne,setCullFace:yt,setLineWidth:ye,setPolygonOffset:zt,setScissorTest:Ct,activeTexture:O,bindTexture:N,unbindTexture:ce,compressedTexImage2D:Ee,compressedTexImage3D:He,texImage2D:Mt,texImage3D:Yt,updateUBOMapping:Vi,uniformBlockBinding:vi,texStorage2D:ii,texStorage3D:Ge,texSubImage2D:Le,texSubImage3D:bt,compressedTexSubImage2D:nt,compressedTexSubImage3D:mt,scissor:qt,viewport:et,reset:gn}}function Ume(n,e){const i=n.image&&n.image.width?n.image.width/n.image.height:1;return i>e?(n.repeat.x=1,n.repeat.y=i/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2):(n.repeat.x=e/i,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0),n}function Ome(n,e){const i=n.image&&n.image.width?n.image.width/n.image.height:1;return i>e?(n.repeat.x=e/i,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0):(n.repeat.x=1,n.repeat.y=i/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2),n}function Zme(n){return n.repeat.x=1,n.repeat.y=1,n.offset.x=0,n.offset.y=0,n}function nP(n,e,i,s){const r=Wme(s);switch(i){case pG:return n*e;case Bx:return n*e;case gG:return n*e*2;case vl:return n*e/r.components*r.byteLength;case KA:return n*e/r.components*r.byteLength;case fc:return n*e*2/r.components*r.byteLength;case YA:return n*e*2/r.components*r.byteLength;case mG:return n*e*3/r.components*r.byteLength;case _i:return n*e*4/r.components*r.byteLength;case uf:return n*e*4/r.components*r.byteLength;case kx:case jA:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Gx:case JA:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case OM:case ZM:return Math.max(n,16)*Math.max(e,8)/4;case Px:case Nx:return Math.max(n,8)*Math.max(e,8)/2;case Vx:case Xx:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Dx:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case qA:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case WM:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case HM:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case QM:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case $A:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case KM:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case YM:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case jM:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case JM:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case qM:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case $M:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case eI:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case tI:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case iI:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case ey:case nI:case sI:return Math.ceil(n/4)*Math.ceil(e/4)*16;case fG:case rI:return Math.ceil(n/4)*Math.ceil(e/4)*8;case oI:case aI:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${i} format.`)}function Wme(n){switch(n){case Xi:case Lx:return{byteLength:1,components:1};case hf:case zM:case Ki:return{byteLength:2,components:1};case FM:case UM:return{byteLength:2,components:4};case Gr:case nd:case en:return{byteLength:4,components:1};case uG:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}const Hme={contain:Ume,cover:Ome,fill:Zme,getByteLength:nP};function Qme(n,e,i,s,r,o,a){const l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),h=new Q,d=new WeakMap;let u;const p=new WeakMap;let g=!1;try{g=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function f(O,N){return g?new OffscreenCanvas(O,N):Qx("canvas")}function A(O,N,ce){let Ee=1;const He=Ct(O);if((He.width>ce||He.height>ce)&&(Ee=ce/Math.max(He.width,He.height)),Ee<1)if(typeof HTMLImageElement<"u"&&O instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&O instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&O instanceof ImageBitmap||typeof VideoFrame<"u"&&O instanceof VideoFrame){const Le=Math.floor(Ee*He.width),bt=Math.floor(Ee*He.height);u===void 0&&(u=f(Le,bt));const nt=N?f(Le,bt):u;return nt.width=Le,nt.height=bt,nt.getContext("2d").drawImage(O,0,0,Le,bt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+He.width+"x"+He.height+") to ("+Le+"x"+bt+")."),nt}else return"data"in O&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+He.width+"x"+He.height+")."),O;return O}function y(O){return O.generateMipmaps&&O.minFilter!==si&&O.minFilter!==Wt}function b(O){n.generateMipmap(O)}function v(O,N,ce,Ee,He=!1){if(O!==null){if(n[O]!==void 0)return n[O];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+O+"'")}let Le=N;if(N===n.RED&&(ce===n.FLOAT&&(Le=n.R32F),ce===n.HALF_FLOAT&&(Le=n.R16F),ce===n.UNSIGNED_BYTE&&(Le=n.R8)),N===n.RED_INTEGER&&(ce===n.UNSIGNED_BYTE&&(Le=n.R8UI),ce===n.UNSIGNED_SHORT&&(Le=n.R16UI),ce===n.UNSIGNED_INT&&(Le=n.R32UI),ce===n.BYTE&&(Le=n.R8I),ce===n.SHORT&&(Le=n.R16I),ce===n.INT&&(Le=n.R32I)),N===n.RG&&(ce===n.FLOAT&&(Le=n.RG32F),ce===n.HALF_FLOAT&&(Le=n.RG16F),ce===n.UNSIGNED_BYTE&&(Le=n.RG8)),N===n.RG_INTEGER&&(ce===n.UNSIGNED_BYTE&&(Le=n.RG8UI),ce===n.UNSIGNED_SHORT&&(Le=n.RG16UI),ce===n.UNSIGNED_INT&&(Le=n.RG32UI),ce===n.BYTE&&(Le=n.RG8I),ce===n.SHORT&&(Le=n.RG16I),ce===n.INT&&(Le=n.RG32I)),N===n.RGB_INTEGER&&(ce===n.UNSIGNED_BYTE&&(Le=n.RGB8UI),ce===n.UNSIGNED_SHORT&&(Le=n.RGB16UI),ce===n.UNSIGNED_INT&&(Le=n.RGB32UI),ce===n.BYTE&&(Le=n.RGB8I),ce===n.SHORT&&(Le=n.RGB16I),ce===n.INT&&(Le=n.RGB32I)),N===n.RGBA_INTEGER&&(ce===n.UNSIGNED_BYTE&&(Le=n.RGBA8UI),ce===n.UNSIGNED_SHORT&&(Le=n.RGBA16UI),ce===n.UNSIGNED_INT&&(Le=n.RGBA32UI),ce===n.BYTE&&(Le=n.RGBA8I),ce===n.SHORT&&(Le=n.RGBA16I),ce===n.INT&&(Le=n.RGBA32I)),N===n.RGB&&ce===n.UNSIGNED_INT_5_9_9_9_REV&&(Le=n.RGB9_E5),N===n.RGBA){const bt=He?Ox:hi.getTransfer(Ee);ce===n.FLOAT&&(Le=n.RGBA32F),ce===n.HALF_FLOAT&&(Le=n.RGBA16F),ce===n.UNSIGNED_BYTE&&(Le=bt===Nn?n.SRGB8_ALPHA8:n.RGBA8),ce===n.UNSIGNED_SHORT_4_4_4_4&&(Le=n.RGBA4),ce===n.UNSIGNED_SHORT_5_5_5_1&&(Le=n.RGB5_A1)}return(Le===n.R16F||Le===n.R32F||Le===n.RG16F||Le===n.RG32F||Le===n.RGBA16F||Le===n.RGBA32F)&&e.get("EXT_color_buffer_float"),Le}function x(O,N){let ce;return O?N===null||N===Gr||N===jp?ce=n.DEPTH24_STENCIL8:N===en?ce=n.DEPTH32F_STENCIL8:N===hf&&(ce=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):N===null||N===Gr||N===jp?ce=n.DEPTH_COMPONENT24:N===en?ce=n.DEPTH_COMPONENT32F:N===hf&&(ce=n.DEPTH_COMPONENT16),ce}function w(O,N){return y(O)===!0||O.isFramebufferTexture&&O.minFilter!==si&&O.minFilter!==Wt?Math.log2(Math.max(N.width,N.height))+1:O.mipmaps!==void 0&&O.mipmaps.length>0?O.mipmaps.length:O.isCompressedTexture&&Array.isArray(O.image)?N.mipmaps.length:1}function C(O){const N=O.target;N.removeEventListener("dispose",C),_(N),N.isVideoTexture&&d.delete(N)}function S(O){const N=O.target;N.removeEventListener("dispose",S),B(N)}function _(O){const N=s.get(O);if(N.__webglInit===void 0)return;const ce=O.source,Ee=p.get(ce);if(Ee){const He=Ee[N.__cacheKey];He.usedTimes--,He.usedTimes===0&&I(O),Object.keys(Ee).length===0&&p.delete(ce)}s.remove(O)}function I(O){const N=s.get(O);n.deleteTexture(N.__webglTexture);const ce=O.source,Ee=p.get(ce);delete Ee[N.__cacheKey],a.memory.textures--}function B(O){const N=s.get(O);if(O.depthTexture&&O.depthTexture.dispose(),O.isWebGLCubeRenderTarget)for(let Ee=0;Ee<6;Ee++){if(Array.isArray(N.__webglFramebuffer[Ee]))for(let He=0;He<N.__webglFramebuffer[Ee].length;He++)n.deleteFramebuffer(N.__webglFramebuffer[Ee][He]);else n.deleteFramebuffer(N.__webglFramebuffer[Ee]);N.__webglDepthbuffer&&n.deleteRenderbuffer(N.__webglDepthbuffer[Ee])}else{if(Array.isArray(N.__webglFramebuffer))for(let Ee=0;Ee<N.__webglFramebuffer.length;Ee++)n.deleteFramebuffer(N.__webglFramebuffer[Ee]);else n.deleteFramebuffer(N.__webglFramebuffer);if(N.__webglDepthbuffer&&n.deleteRenderbuffer(N.__webglDepthbuffer),N.__webglMultisampledFramebuffer&&n.deleteFramebuffer(N.__webglMultisampledFramebuffer),N.__webglColorRenderbuffer)for(let Ee=0;Ee<N.__webglColorRenderbuffer.length;Ee++)N.__webglColorRenderbuffer[Ee]&&n.deleteRenderbuffer(N.__webglColorRenderbuffer[Ee]);N.__webglDepthRenderbuffer&&n.deleteRenderbuffer(N.__webglDepthRenderbuffer)}const ce=O.textures;for(let Ee=0,He=ce.length;Ee<He;Ee++){const Le=s.get(ce[Ee]);Le.__webglTexture&&(n.deleteTexture(Le.__webglTexture),a.memory.textures--),s.remove(ce[Ee])}s.remove(O)}let M=0;function R(){M=0}function k(){const O=M;return O>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+O+" texture units while this GPU supports only "+r.maxTextures),M+=1,O}function G(O){const N=[];return N.push(O.wrapS),N.push(O.wrapT),N.push(O.wrapR||0),N.push(O.magFilter),N.push(O.minFilter),N.push(O.anisotropy),N.push(O.internalFormat),N.push(O.format),N.push(O.type),N.push(O.generateMipmaps),N.push(O.premultiplyAlpha),N.push(O.flipY),N.push(O.unpackAlignment),N.push(O.colorSpace),N.join()}function X(O,N){const ce=s.get(O);if(O.isVideoTexture&&ye(O),O.isRenderTargetTexture===!1&&O.version>0&&ce.__version!==O.version){const Ee=O.image;if(Ee===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ee.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{je(ce,O,N);return}}i.bindTexture(n.TEXTURE_2D,ce.__webglTexture,n.TEXTURE0+N)}function F(O,N){const ce=s.get(O);if(O.version>0&&ce.__version!==O.version){je(ce,O,N);return}i.bindTexture(n.TEXTURE_2D_ARRAY,ce.__webglTexture,n.TEXTURE0+N)}function z(O,N){const ce=s.get(O);if(O.version>0&&ce.__version!==O.version){je(ce,O,N);return}i.bindTexture(n.TEXTURE_3D,ce.__webglTexture,n.TEXTURE0+N)}function H(O,N){const ce=s.get(O);if(O.version>0&&ce.__version!==O.version){le(ce,O,N);return}i.bindTexture(n.TEXTURE_CUBE_MAP,ce.__webglTexture,n.TEXTURE0+N)}const Z={[lo]:n.REPEAT,[Wo]:n.CLAMP_TO_EDGE,[bu]:n.MIRRORED_REPEAT},he={[si]:n.NEAREST,[Rx]:n.NEAREST_MIPMAP_NEAREST,[id]:n.NEAREST_MIPMAP_LINEAR,[Wt]:n.LINEAR,[vu]:n.LINEAR_MIPMAP_NEAREST,[Ar]:n.LINEAR_MIPMAP_LINEAR},be={[RW]:n.NEVER,[PW]:n.ALWAYS,[wG]:n.LESS,[CG]:n.LEQUAL,[LW]:n.EQUAL,[GW]:n.GEQUAL,[BW]:n.GREATER,[kW]:n.NOTEQUAL};function _e(O,N){if(N.type===en&&e.has("OES_texture_float_linear")===!1&&(N.magFilter===Wt||N.magFilter===vu||N.magFilter===id||N.magFilter===Ar||N.minFilter===Wt||N.minFilter===vu||N.minFilter===id||N.minFilter===Ar)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(O,n.TEXTURE_WRAP_S,Z[N.wrapS]),n.texParameteri(O,n.TEXTURE_WRAP_T,Z[N.wrapT]),(O===n.TEXTURE_3D||O===n.TEXTURE_2D_ARRAY)&&n.texParameteri(O,n.TEXTURE_WRAP_R,Z[N.wrapR]),n.texParameteri(O,n.TEXTURE_MAG_FILTER,he[N.magFilter]),n.texParameteri(O,n.TEXTURE_MIN_FILTER,he[N.minFilter]),N.compareFunction&&(n.texParameteri(O,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(O,n.TEXTURE_COMPARE_FUNC,be[N.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(N.magFilter===si||N.minFilter!==id&&N.minFilter!==Ar||N.type===en&&e.has("OES_texture_float_linear")===!1)return;if(N.anisotropy>1||s.get(N).__currentAnisotropy){const ce=e.get("EXT_texture_filter_anisotropic");n.texParameterf(O,ce.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(N.anisotropy,r.getMaxAnisotropy())),s.get(N).__currentAnisotropy=N.anisotropy}}}function Ye(O,N){let ce=!1;O.__webglInit===void 0&&(O.__webglInit=!0,N.addEventListener("dispose",C));const Ee=N.source;let He=p.get(Ee);He===void 0&&(He={},p.set(Ee,He));const Le=G(N);if(Le!==O.__cacheKey){He[Le]===void 0&&(He[Le]={texture:n.createTexture(),usedTimes:0},a.memory.textures++,ce=!0),He[Le].usedTimes++;const bt=He[O.__cacheKey];bt!==void 0&&(He[O.__cacheKey].usedTimes--,bt.usedTimes===0&&I(N)),O.__cacheKey=Le,O.__webglTexture=He[Le].texture}return ce}function je(O,N,ce){let Ee=n.TEXTURE_2D;(N.isDataArrayTexture||N.isCompressedArrayTexture)&&(Ee=n.TEXTURE_2D_ARRAY),N.isData3DTexture&&(Ee=n.TEXTURE_3D);const He=Ye(O,N),Le=N.source;i.bindTexture(Ee,O.__webglTexture,n.TEXTURE0+ce);const bt=s.get(Le);if(Le.version!==bt.__version||He===!0){i.activeTexture(n.TEXTURE0+ce);const nt=hi.getPrimaries(hi.workingColorSpace),mt=N.colorSpace===ho?null:hi.getPrimaries(N.colorSpace),ii=N.colorSpace===ho||nt===mt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,N.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,N.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,N.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,ii);let Ge=A(N.image,!1,r.maxTextureSize);Ge=zt(N,Ge);const Mt=o.convert(N.format,N.colorSpace),Yt=o.convert(N.type);let qt=v(N.internalFormat,Mt,Yt,N.colorSpace,N.isVideoTexture);_e(Ee,N);let et;const Vi=N.mipmaps,vi=N.isVideoTexture!==!0,gn=bt.__version===void 0||He===!0,se=Le.dataReady,St=w(N,Ge);if(N.isDepthTexture)qt=x(N.format===Jp,N.type),gn&&(vi?i.texStorage2D(n.TEXTURE_2D,1,qt,Ge.width,Ge.height):i.texImage2D(n.TEXTURE_2D,0,qt,Ge.width,Ge.height,0,Mt,Yt,null));else if(N.isDataTexture)if(Vi.length>0){vi&&gn&&i.texStorage2D(n.TEXTURE_2D,St,qt,Vi[0].width,Vi[0].height);for(let we=0,Ze=Vi.length;we<Ze;we++)et=Vi[we],vi?se&&i.texSubImage2D(n.TEXTURE_2D,we,0,0,et.width,et.height,Mt,Yt,et.data):i.texImage2D(n.TEXTURE_2D,we,qt,et.width,et.height,0,Mt,Yt,et.data);N.generateMipmaps=!1}else vi?(gn&&i.texStorage2D(n.TEXTURE_2D,St,qt,Ge.width,Ge.height),se&&i.texSubImage2D(n.TEXTURE_2D,0,0,0,Ge.width,Ge.height,Mt,Yt,Ge.data)):i.texImage2D(n.TEXTURE_2D,0,qt,Ge.width,Ge.height,0,Mt,Yt,Ge.data);else if(N.isCompressedTexture)if(N.isCompressedArrayTexture){vi&&gn&&i.texStorage3D(n.TEXTURE_2D_ARRAY,St,qt,Vi[0].width,Vi[0].height,Ge.depth);for(let we=0,Ze=Vi.length;we<Ze;we++)if(et=Vi[we],N.format!==_i)if(Mt!==null)if(vi){if(se)if(N.layerUpdates.size>0){const L=nP(et.width,et.height,N.format,N.type);for(const P of N.layerUpdates){const W=et.data.subarray(P*L/et.data.BYTES_PER_ELEMENT,(P+1)*L/et.data.BYTES_PER_ELEMENT);i.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,we,0,0,P,et.width,et.height,1,Mt,W,0,0)}N.clearLayerUpdates()}else i.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,we,0,0,0,et.width,et.height,Ge.depth,Mt,et.data,0,0)}else i.compressedTexImage3D(n.TEXTURE_2D_ARRAY,we,qt,et.width,et.height,Ge.depth,0,et.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else vi?se&&i.texSubImage3D(n.TEXTURE_2D_ARRAY,we,0,0,0,et.width,et.height,Ge.depth,Mt,Yt,et.data):i.texImage3D(n.TEXTURE_2D_ARRAY,we,qt,et.width,et.height,Ge.depth,0,Mt,Yt,et.data)}else{vi&&gn&&i.texStorage2D(n.TEXTURE_2D,St,qt,Vi[0].width,Vi[0].height);for(let we=0,Ze=Vi.length;we<Ze;we++)et=Vi[we],N.format!==_i?Mt!==null?vi?se&&i.compressedTexSubImage2D(n.TEXTURE_2D,we,0,0,et.width,et.height,Mt,et.data):i.compressedTexImage2D(n.TEXTURE_2D,we,qt,et.width,et.height,0,et.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):vi?se&&i.texSubImage2D(n.TEXTURE_2D,we,0,0,et.width,et.height,Mt,Yt,et.data):i.texImage2D(n.TEXTURE_2D,we,qt,et.width,et.height,0,Mt,Yt,et.data)}else if(N.isDataArrayTexture)if(vi){if(gn&&i.texStorage3D(n.TEXTURE_2D_ARRAY,St,qt,Ge.width,Ge.height,Ge.depth),se)if(N.layerUpdates.size>0){const we=nP(Ge.width,Ge.height,N.format,N.type);for(const Ze of N.layerUpdates){const L=Ge.data.subarray(Ze*we/Ge.data.BYTES_PER_ELEMENT,(Ze+1)*we/Ge.data.BYTES_PER_ELEMENT);i.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,Ze,Ge.width,Ge.height,1,Mt,Yt,L)}N.clearLayerUpdates()}else i.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Ge.width,Ge.height,Ge.depth,Mt,Yt,Ge.data)}else i.texImage3D(n.TEXTURE_2D_ARRAY,0,qt,Ge.width,Ge.height,Ge.depth,0,Mt,Yt,Ge.data);else if(N.isData3DTexture)vi?(gn&&i.texStorage3D(n.TEXTURE_3D,St,qt,Ge.width,Ge.height,Ge.depth),se&&i.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Ge.width,Ge.height,Ge.depth,Mt,Yt,Ge.data)):i.texImage3D(n.TEXTURE_3D,0,qt,Ge.width,Ge.height,Ge.depth,0,Mt,Yt,Ge.data);else if(N.isFramebufferTexture){if(gn)if(vi)i.texStorage2D(n.TEXTURE_2D,St,qt,Ge.width,Ge.height);else{let we=Ge.width,Ze=Ge.height;for(let L=0;L<St;L++)i.texImage2D(n.TEXTURE_2D,L,qt,we,Ze,0,Mt,Yt,null),we>>=1,Ze>>=1}}else if(Vi.length>0){if(vi&&gn){const we=Ct(Vi[0]);i.texStorage2D(n.TEXTURE_2D,St,qt,we.width,we.height)}for(let we=0,Ze=Vi.length;we<Ze;we++)et=Vi[we],vi?se&&i.texSubImage2D(n.TEXTURE_2D,we,0,0,Mt,Yt,et):i.texImage2D(n.TEXTURE_2D,we,qt,Mt,Yt,et);N.generateMipmaps=!1}else if(vi){if(gn){const we=Ct(Ge);i.texStorage2D(n.TEXTURE_2D,St,qt,we.width,we.height)}se&&i.texSubImage2D(n.TEXTURE_2D,0,0,0,Mt,Yt,Ge)}else i.texImage2D(n.TEXTURE_2D,0,qt,Mt,Yt,Ge);y(N)&&b(Ee),bt.__version=Le.version,N.onUpdate&&N.onUpdate(N)}O.__version=N.version}function le(O,N,ce){if(N.image.length!==6)return;const Ee=Ye(O,N),He=N.source;i.bindTexture(n.TEXTURE_CUBE_MAP,O.__webglTexture,n.TEXTURE0+ce);const Le=s.get(He);if(He.version!==Le.__version||Ee===!0){i.activeTexture(n.TEXTURE0+ce);const bt=hi.getPrimaries(hi.workingColorSpace),nt=N.colorSpace===ho?null:hi.getPrimaries(N.colorSpace),mt=N.colorSpace===ho||bt===nt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,N.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,N.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,N.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,mt);const ii=N.isCompressedTexture||N.image[0].isCompressedTexture,Ge=N.image[0]&&N.image[0].isDataTexture,Mt=[];for(let Ze=0;Ze<6;Ze++)!ii&&!Ge?Mt[Ze]=A(N.image[Ze],!0,r.maxCubemapSize):Mt[Ze]=Ge?N.image[Ze].image:N.image[Ze],Mt[Ze]=zt(N,Mt[Ze]);const Yt=Mt[0],qt=o.convert(N.format,N.colorSpace),et=o.convert(N.type),Vi=v(N.internalFormat,qt,et,N.colorSpace),vi=N.isVideoTexture!==!0,gn=Le.__version===void 0||Ee===!0,se=He.dataReady;let St=w(N,Yt);_e(n.TEXTURE_CUBE_MAP,N);let we;if(ii){vi&&gn&&i.texStorage2D(n.TEXTURE_CUBE_MAP,St,Vi,Yt.width,Yt.height);for(let Ze=0;Ze<6;Ze++){we=Mt[Ze].mipmaps;for(let L=0;L<we.length;L++){const P=we[L];N.format!==_i?qt!==null?vi?se&&i.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,L,0,0,P.width,P.height,qt,P.data):i.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,L,Vi,P.width,P.height,0,P.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):vi?se&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,L,0,0,P.width,P.height,qt,et,P.data):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,L,Vi,P.width,P.height,0,qt,et,P.data)}}}else{if(we=N.mipmaps,vi&&gn){we.length>0&&St++;const Ze=Ct(Mt[0]);i.texStorage2D(n.TEXTURE_CUBE_MAP,St,Vi,Ze.width,Ze.height)}for(let Ze=0;Ze<6;Ze++)if(Ge){vi?se&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,0,0,0,Mt[Ze].width,Mt[Ze].height,qt,et,Mt[Ze].data):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,0,Vi,Mt[Ze].width,Mt[Ze].height,0,qt,et,Mt[Ze].data);for(let L=0;L<we.length;L++){const P=we[L].image[Ze].image;vi?se&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,L+1,0,0,P.width,P.height,qt,et,P.data):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,L+1,Vi,P.width,P.height,0,qt,et,P.data)}}else{vi?se&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,0,0,0,qt,et,Mt[Ze]):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,0,Vi,qt,et,Mt[Ze]);for(let L=0;L<we.length;L++){const P=we[L];vi?se&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,L+1,0,0,qt,et,P.image[Ze]):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,L+1,Vi,qt,et,P.image[Ze])}}}y(N)&&b(n.TEXTURE_CUBE_MAP),Le.__version=He.version,N.onUpdate&&N.onUpdate(N)}O.__version=N.version}function ve(O,N,ce,Ee,He,Le){const bt=o.convert(ce.format,ce.colorSpace),nt=o.convert(ce.type),mt=v(ce.internalFormat,bt,nt,ce.colorSpace);if(!s.get(N).__hasExternalTextures){const ii=Math.max(1,N.width>>Le),Ge=Math.max(1,N.height>>Le);He===n.TEXTURE_3D||He===n.TEXTURE_2D_ARRAY?i.texImage3D(He,Le,mt,ii,Ge,N.depth,0,bt,nt,null):i.texImage2D(He,Le,mt,ii,Ge,0,bt,nt,null)}i.bindFramebuffer(n.FRAMEBUFFER,O),yt(N)?l.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Ee,He,s.get(ce).__webglTexture,0,Ne(N)):(He===n.TEXTURE_2D||He>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&He<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,Ee,He,s.get(ce).__webglTexture,Le),i.bindFramebuffer(n.FRAMEBUFFER,null)}function Pe(O,N,ce){if(n.bindRenderbuffer(n.RENDERBUFFER,O),N.depthBuffer){const Ee=N.depthTexture,He=Ee&&Ee.isDepthTexture?Ee.type:null,Le=x(N.stencilBuffer,He),bt=N.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,nt=Ne(N);yt(N)?l.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,nt,Le,N.width,N.height):ce?n.renderbufferStorageMultisample(n.RENDERBUFFER,nt,Le,N.width,N.height):n.renderbufferStorage(n.RENDERBUFFER,Le,N.width,N.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,bt,n.RENDERBUFFER,O)}else{const Ee=N.textures;for(let He=0;He<Ee.length;He++){const Le=Ee[He],bt=o.convert(Le.format,Le.colorSpace),nt=o.convert(Le.type),mt=v(Le.internalFormat,bt,nt,Le.colorSpace),ii=Ne(N);ce&&yt(N)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,ii,mt,N.width,N.height):yt(N)?l.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,ii,mt,N.width,N.height):n.renderbufferStorage(n.RENDERBUFFER,mt,N.width,N.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function ke(O,N){if(N&&N.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(n.FRAMEBUFFER,O),!(N.depthTexture&&N.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!s.get(N.depthTexture).__webglTexture||N.depthTexture.image.width!==N.width||N.depthTexture.image.height!==N.height)&&(N.depthTexture.image.width=N.width,N.depthTexture.image.height=N.height,N.depthTexture.needsUpdate=!0),X(N.depthTexture,0);const ce=s.get(N.depthTexture).__webglTexture,Ee=Ne(N);if(N.depthTexture.format===df)yt(N)?l.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ce,0,Ee):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ce,0);else if(N.depthTexture.format===Jp)yt(N)?l.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ce,0,Ee):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ce,0);else throw new Error("Unknown depthTexture format")}function _t(O){const N=s.get(O),ce=O.isWebGLCubeRenderTarget===!0;if(N.__boundDepthTexture!==O.depthTexture){const Ee=O.depthTexture;if(N.__depthDisposeCallback&&N.__depthDisposeCallback(),Ee){const He=()=>{delete N.__boundDepthTexture,delete N.__depthDisposeCallback,Ee.removeEventListener("dispose",He)};Ee.addEventListener("dispose",He),N.__depthDisposeCallback=He}N.__boundDepthTexture=Ee}if(O.depthTexture&&!N.__autoAllocateDepthBuffer){if(ce)throw new Error("target.depthTexture not supported in Cube render targets");ke(N.__webglFramebuffer,O)}else if(ce){N.__webglDepthbuffer=[];for(let Ee=0;Ee<6;Ee++)if(i.bindFramebuffer(n.FRAMEBUFFER,N.__webglFramebuffer[Ee]),N.__webglDepthbuffer[Ee]===void 0)N.__webglDepthbuffer[Ee]=n.createRenderbuffer(),Pe(N.__webglDepthbuffer[Ee],O,!1);else{const He=O.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Le=N.__webglDepthbuffer[Ee];n.bindRenderbuffer(n.RENDERBUFFER,Le),n.framebufferRenderbuffer(n.FRAMEBUFFER,He,n.RENDERBUFFER,Le)}}else if(i.bindFramebuffer(n.FRAMEBUFFER,N.__webglFramebuffer),N.__webglDepthbuffer===void 0)N.__webglDepthbuffer=n.createRenderbuffer(),Pe(N.__webglDepthbuffer,O,!1);else{const Ee=O.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,He=N.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,He),n.framebufferRenderbuffer(n.FRAMEBUFFER,Ee,n.RENDERBUFFER,He)}i.bindFramebuffer(n.FRAMEBUFFER,null)}function rt(O,N,ce){const Ee=s.get(O);N!==void 0&&ve(Ee.__webglFramebuffer,O,O.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),ce!==void 0&&_t(O)}function xt(O){const N=O.texture,ce=s.get(O),Ee=s.get(N);O.addEventListener("dispose",S);const He=O.textures,Le=O.isWebGLCubeRenderTarget===!0,bt=He.length>1;if(bt||(Ee.__webglTexture===void 0&&(Ee.__webglTexture=n.createTexture()),Ee.__version=N.version,a.memory.textures++),Le){ce.__webglFramebuffer=[];for(let nt=0;nt<6;nt++)if(N.mipmaps&&N.mipmaps.length>0){ce.__webglFramebuffer[nt]=[];for(let mt=0;mt<N.mipmaps.length;mt++)ce.__webglFramebuffer[nt][mt]=n.createFramebuffer()}else ce.__webglFramebuffer[nt]=n.createFramebuffer()}else{if(N.mipmaps&&N.mipmaps.length>0){ce.__webglFramebuffer=[];for(let nt=0;nt<N.mipmaps.length;nt++)ce.__webglFramebuffer[nt]=n.createFramebuffer()}else ce.__webglFramebuffer=n.createFramebuffer();if(bt)for(let nt=0,mt=He.length;nt<mt;nt++){const ii=s.get(He[nt]);ii.__webglTexture===void 0&&(ii.__webglTexture=n.createTexture(),a.memory.textures++)}if(O.samples>0&&yt(O)===!1){ce.__webglMultisampledFramebuffer=n.createFramebuffer(),ce.__webglColorRenderbuffer=[],i.bindFramebuffer(n.FRAMEBUFFER,ce.__webglMultisampledFramebuffer);for(let nt=0;nt<He.length;nt++){const mt=He[nt];ce.__webglColorRenderbuffer[nt]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,ce.__webglColorRenderbuffer[nt]);const ii=o.convert(mt.format,mt.colorSpace),Ge=o.convert(mt.type),Mt=v(mt.internalFormat,ii,Ge,mt.colorSpace,O.isXRRenderTarget===!0),Yt=Ne(O);n.renderbufferStorageMultisample(n.RENDERBUFFER,Yt,Mt,O.width,O.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+nt,n.RENDERBUFFER,ce.__webglColorRenderbuffer[nt])}n.bindRenderbuffer(n.RENDERBUFFER,null),O.depthBuffer&&(ce.__webglDepthRenderbuffer=n.createRenderbuffer(),Pe(ce.__webglDepthRenderbuffer,O,!0)),i.bindFramebuffer(n.FRAMEBUFFER,null)}}if(Le){i.bindTexture(n.TEXTURE_CUBE_MAP,Ee.__webglTexture),_e(n.TEXTURE_CUBE_MAP,N);for(let nt=0;nt<6;nt++)if(N.mipmaps&&N.mipmaps.length>0)for(let mt=0;mt<N.mipmaps.length;mt++)ve(ce.__webglFramebuffer[nt][mt],O,N,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+nt,mt);else ve(ce.__webglFramebuffer[nt],O,N,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+nt,0);y(N)&&b(n.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(bt){for(let nt=0,mt=He.length;nt<mt;nt++){const ii=He[nt],Ge=s.get(ii);i.bindTexture(n.TEXTURE_2D,Ge.__webglTexture),_e(n.TEXTURE_2D,ii),ve(ce.__webglFramebuffer,O,ii,n.COLOR_ATTACHMENT0+nt,n.TEXTURE_2D,0),y(ii)&&b(n.TEXTURE_2D)}i.unbindTexture()}else{let nt=n.TEXTURE_2D;if((O.isWebGL3DRenderTarget||O.isWebGLArrayRenderTarget)&&(nt=O.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),i.bindTexture(nt,Ee.__webglTexture),_e(nt,N),N.mipmaps&&N.mipmaps.length>0)for(let mt=0;mt<N.mipmaps.length;mt++)ve(ce.__webglFramebuffer[mt],O,N,n.COLOR_ATTACHMENT0,nt,mt);else ve(ce.__webglFramebuffer,O,N,n.COLOR_ATTACHMENT0,nt,0);y(N)&&b(nt),i.unbindTexture()}O.depthBuffer&&_t(O)}function Re(O){const N=O.textures;for(let ce=0,Ee=N.length;ce<Ee;ce++){const He=N[ce];if(y(He)){const Le=O.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,bt=s.get(He).__webglTexture;i.bindTexture(Le,bt),b(Le),i.unbindTexture()}}}const ze=[],U=[];function ot(O){if(O.samples>0){if(yt(O)===!1){const N=O.textures,ce=O.width,Ee=O.height;let He=n.COLOR_BUFFER_BIT;const Le=O.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,bt=s.get(O),nt=N.length>1;if(nt)for(let mt=0;mt<N.length;mt++)i.bindFramebuffer(n.FRAMEBUFFER,bt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+mt,n.RENDERBUFFER,null),i.bindFramebuffer(n.FRAMEBUFFER,bt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+mt,n.TEXTURE_2D,null,0);i.bindFramebuffer(n.READ_FRAMEBUFFER,bt.__webglMultisampledFramebuffer),i.bindFramebuffer(n.DRAW_FRAMEBUFFER,bt.__webglFramebuffer);for(let mt=0;mt<N.length;mt++){if(O.resolveDepthBuffer&&(O.depthBuffer&&(He|=n.DEPTH_BUFFER_BIT),O.stencilBuffer&&O.resolveStencilBuffer&&(He|=n.STENCIL_BUFFER_BIT)),nt){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,bt.__webglColorRenderbuffer[mt]);const ii=s.get(N[mt]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,ii,0)}n.blitFramebuffer(0,0,ce,Ee,0,0,ce,Ee,He,n.NEAREST),c===!0&&(ze.length=0,U.length=0,ze.push(n.COLOR_ATTACHMENT0+mt),O.depthBuffer&&O.resolveDepthBuffer===!1&&(ze.push(Le),U.push(Le),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,U)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,ze))}if(i.bindFramebuffer(n.READ_FRAMEBUFFER,null),i.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),nt)for(let mt=0;mt<N.length;mt++){i.bindFramebuffer(n.FRAMEBUFFER,bt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+mt,n.RENDERBUFFER,bt.__webglColorRenderbuffer[mt]);const ii=s.get(N[mt]).__webglTexture;i.bindFramebuffer(n.FRAMEBUFFER,bt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+mt,n.TEXTURE_2D,ii,0)}i.bindFramebuffer(n.DRAW_FRAMEBUFFER,bt.__webglMultisampledFramebuffer)}else if(O.depthBuffer&&O.resolveDepthBuffer===!1&&c){const N=O.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[N])}}}function Ne(O){return Math.min(r.maxSamples,O.samples)}function yt(O){const N=s.get(O);return O.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&N.__useRenderToTexture!==!1}function ye(O){const N=a.render.frame;d.get(O)!==N&&(d.set(O,N),O.update())}function zt(O,N){const ce=O.colorSpace,Ee=O.format,He=O.type;return O.isCompressedTexture===!0||O.isVideoTexture===!0||ce!==qi&&ce!==ho&&(hi.getTransfer(ce)===Nn?(Ee!==_i||He!==Xi)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ce)),N}function Ct(O){return typeof HTMLImageElement<"u"&&O instanceof HTMLImageElement?(h.width=O.naturalWidth||O.width,h.height=O.naturalHeight||O.height):typeof VideoFrame<"u"&&O instanceof VideoFrame?(h.width=O.displayWidth,h.height=O.displayHeight):(h.width=O.width,h.height=O.height),h}this.allocateTextureUnit=k,this.resetTextureUnits=R,this.setTexture2D=X,this.setTexture2DArray=F,this.setTexture3D=z,this.setTextureCube=H,this.rebindTextures=rt,this.setupRenderTarget=xt,this.updateRenderTargetMipmap=Re,this.updateMultisampleRenderTarget=ot,this.setupDepthRenderbuffer=_t,this.setupFrameBufferTexture=ve,this.useMultisampledRTT=yt}function G9(n,e){function i(s,r=ho){let o;const a=hi.getTransfer(r);if(s===Xi)return n.UNSIGNED_BYTE;if(s===FM)return n.UNSIGNED_SHORT_4_4_4_4;if(s===UM)return n.UNSIGNED_SHORT_5_5_5_1;if(s===uG)return n.UNSIGNED_INT_5_9_9_9_REV;if(s===Lx)return n.BYTE;if(s===zM)return n.SHORT;if(s===hf)return n.UNSIGNED_SHORT;if(s===nd)return n.INT;if(s===Gr)return n.UNSIGNED_INT;if(s===en)return n.FLOAT;if(s===Ki)return n.HALF_FLOAT;if(s===pG)return n.ALPHA;if(s===mG)return n.RGB;if(s===_i)return n.RGBA;if(s===Bx)return n.LUMINANCE;if(s===gG)return n.LUMINANCE_ALPHA;if(s===df)return n.DEPTH_COMPONENT;if(s===Jp)return n.DEPTH_STENCIL;if(s===vl)return n.RED;if(s===KA)return n.RED_INTEGER;if(s===fc)return n.RG;if(s===YA)return n.RG_INTEGER;if(s===uf)return n.RGBA_INTEGER;if(s===kx||s===jA||s===Gx||s===JA)if(a===Nn)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===kx)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===jA)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===Gx)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===JA)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===kx)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===jA)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===Gx)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===JA)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===Px||s===OM||s===Nx||s===ZM)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===Px)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===OM)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===Nx)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===ZM)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===Vx||s===Xx||s===Dx)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(s===Vx||s===Xx)return a===Nn?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===Dx)return a===Nn?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===qA||s===WM||s===HM||s===QM||s===$A||s===KM||s===YM||s===jM||s===JM||s===qM||s===$M||s===eI||s===tI||s===iI)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(s===qA)return a===Nn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===WM)return a===Nn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===HM)return a===Nn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===QM)return a===Nn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===$A)return a===Nn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===KM)return a===Nn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===YM)return a===Nn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===jM)return a===Nn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===JM)return a===Nn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===qM)return a===Nn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===$M)return a===Nn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===eI)return a===Nn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===tI)return a===Nn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===iI)return a===Nn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===ey||s===nI||s===sI)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(s===ey)return a===Nn?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(s===nI)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(s===sI)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(s===fG||s===rI||s===oI||s===aI)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(s===ey)return o.COMPRESSED_RED_RGTC1_EXT;if(s===rI)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===oI)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===aI)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===jp?n.UNSIGNED_INT_24_8:n[s]!==void 0?n[s]:null}return{convert:i}}class sP extends Ot{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}let Es=class extends Ae{constructor(){super(),this.isGroup=!0,this.type="Group"}};const Kme={type:"move"};class rP{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Es,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Es,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new E,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new E),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Es,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new E,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new E),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const i=this._hand;if(i)for(const s of e.hand.values())this._getHandJoint(i,s)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,i,s){let r=null,o=null,a=null;const l=this._targetRay,c=this._grip,h=this._hand;if(e&&i.session.visibilityState!=="visible-blurred"){if(h&&e.hand){a=!0;for(const A of e.hand.values()){const y=i.getJointPose(A,s),b=this._getHandJoint(h,A);y!==null&&(b.matrix.fromArray(y.transform.matrix),b.matrix.decompose(b.position,b.rotation,b.scale),b.matrixWorldNeedsUpdate=!0,b.jointRadius=y.radius),b.visible=y!==null}const d=h.joints["index-finger-tip"],u=h.joints["thumb-tip"],p=d.position.distanceTo(u.position),g=.02,f=.005;h.inputState.pinching&&p>g+f?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!h.inputState.pinching&&p<=g-f&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(o=i.getPose(e.gripSpace,s),o!==null&&(c.matrix.fromArray(o.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,o.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(o.linearVelocity)):c.hasLinearVelocity=!1,o.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(o.angularVelocity)):c.hasAngularVelocity=!1));l!==null&&(r=i.getPose(e.targetRaySpace,s),r===null&&o!==null&&(r=o),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(Kme)))}return l!==null&&(l.visible=r!==null),c!==null&&(c.visible=o!==null),h!==null&&(h.visible=a!==null),this}_getHandJoint(e,i){if(e.joints[i.jointName]===void 0){const s=new Es;s.matrixAutoUpdate=!1,s.visible=!1,e.joints[i.jointName]=s,e.add(s)}return e.joints[i.jointName]}}const Yme=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,jme=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Jme{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,i,s){if(this.texture===null){const r=new di,o=e.properties.get(r);o.__webglTexture=i.texture,(i.depthNear!=s.depthNear||i.depthFar!=s.depthFar)&&(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const i=e.cameras[0].viewport,s=new jt({vertexShader:Yme,fragmentShader:jme,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new pe(new Xs(20,20),s)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class qme extends yr{constructor(e,i){super();const s=this;let r=null,o=1,a=null,l="local-floor",c=1,h=null,d=null,u=null,p=null,g=null,f=null;const A=new Jme,y=i.getContextAttributes();let b=null,v=null;const x=[],w=[],C=new Q;let S=null;const _=new Ot;_.layers.enable(1),_.viewport=new $e;const I=new Ot;I.layers.enable(2),I.viewport=new $e;const B=[_,I],M=new sP;M.layers.enable(1),M.layers.enable(2);let R=null,k=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.controllerAutoUpdate=!0,this.getController=function(le){let ve=x[le];return ve===void 0&&(ve=new rP,x[le]=ve),ve.getTargetRaySpace()},this.getControllerGrip=function(le){let ve=x[le];return ve===void 0&&(ve=new rP,x[le]=ve),ve.getGripSpace()},this.getHand=function(le){let ve=x[le];return ve===void 0&&(ve=new rP,x[le]=ve),ve.getHandSpace()};function G(le){const ve=w.indexOf(le.inputSource);if(ve===-1)return;const Pe=x[ve];Pe!==void 0&&(Pe.update(le.inputSource,le.frame,h||a),Pe.dispatchEvent({type:le.type,data:le.inputSource}))}function X(){r.removeEventListener("select",G),r.removeEventListener("selectstart",G),r.removeEventListener("selectend",G),r.removeEventListener("squeeze",G),r.removeEventListener("squeezestart",G),r.removeEventListener("squeezeend",G),r.removeEventListener("end",X),r.removeEventListener("inputsourceschange",F);for(let le=0;le<x.length;le++){const ve=w[le];ve!==null&&(w[le]=null,x[le]&&x[le].disconnect(ve))}R=null,k=null,A.reset(),e.setRenderTarget(b),g=null,p=null,u=null,r=null,v=null,je.stop(),s.isPresenting=!1,e.setPixelRatio(S),e.setSize(C.width,C.height,!1),s.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(le){o=le,s.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(le){l=le,s.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||a},this.setReferenceSpace=function(le){h=le},this.getBaseLayer=function(){return p!==null?p:g},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return r},this.setSession=async function(le){if(r=le,r!==null){if(b=e.getRenderTarget(),r.addEventListener("select",G),r.addEventListener("selectstart",G),r.addEventListener("selectend",G),r.addEventListener("squeeze",G),r.addEventListener("squeezestart",G),r.addEventListener("squeezeend",G),r.addEventListener("end",X),r.addEventListener("inputsourceschange",F),y.xrCompatible!==!0&&await i.makeXRCompatible(),S=e.getPixelRatio(),e.getSize(C),r.renderState.layers===void 0){const ve={antialias:y.antialias,alpha:!0,depth:y.depth,stencil:y.stencil,framebufferScaleFactor:o};g=new XRWebGLLayer(r,i,ve),r.updateRenderState({baseLayer:g}),e.setPixelRatio(1),e.setSize(g.framebufferWidth,g.framebufferHeight,!1),v=new fi(g.framebufferWidth,g.framebufferHeight,{format:_i,type:Xi,colorSpace:e.outputColorSpace,stencilBuffer:y.stencil})}else{let ve=null,Pe=null,ke=null;y.depth&&(ke=y.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,ve=y.stencil?Jp:df,Pe=y.stencil?jp:Gr);const _t={colorFormat:i.RGBA8,depthFormat:ke,scaleFactor:o};u=new XRWebGLBinding(r,i),p=u.createProjectionLayer(_t),r.updateRenderState({layers:[p]}),e.setPixelRatio(1),e.setSize(p.textureWidth,p.textureHeight,!1),v=new fi(p.textureWidth,p.textureHeight,{format:_i,type:Xi,depthTexture:new Eu(p.textureWidth,p.textureHeight,Pe,void 0,void 0,void 0,void 0,void 0,void 0,ve),stencilBuffer:y.stencil,colorSpace:e.outputColorSpace,samples:y.antialias?4:0,resolveDepthBuffer:p.ignoreDepthValues===!1})}v.isXRRenderTarget=!0,this.setFoveation(c),h=null,a=await r.requestReferenceSpace(l),je.setContext(r),je.start(),s.isPresenting=!0,s.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return A.getDepthTexture()};function F(le){for(let ve=0;ve<le.removed.length;ve++){const Pe=le.removed[ve],ke=w.indexOf(Pe);ke>=0&&(w[ke]=null,x[ke]&&x[ke].disconnect(Pe))}for(let ve=0;ve<le.added.length;ve++){const Pe=le.added[ve];let ke=w.indexOf(Pe);if(ke===-1){for(let rt=0;rt<x.length;rt++)if(rt>=w.length){w.push(Pe),ke=rt;break}else if(w[rt]===null){w[rt]=Pe,ke=rt;break}if(ke===-1)break}const _t=x[ke];_t&&_t.connect(Pe)}}const z=new E,H=new E;function Z(le,ve,Pe){z.setFromMatrixPosition(ve.matrixWorld),H.setFromMatrixPosition(Pe.matrixWorld);const ke=z.distanceTo(H),_t=ve.projectionMatrix.elements,rt=Pe.projectionMatrix.elements,xt=_t[14]/(_t[10]-1),Re=_t[14]/(_t[10]+1),ze=(_t[9]+1)/_t[5],U=(_t[9]-1)/_t[5],ot=(_t[8]-1)/_t[0],Ne=(rt[8]+1)/rt[0],yt=xt*ot,ye=xt*Ne,zt=ke/(-ot+Ne),Ct=zt*-ot;if(ve.matrixWorld.decompose(le.position,le.quaternion,le.scale),le.translateX(Ct),le.translateZ(zt),le.matrixWorld.compose(le.position,le.quaternion,le.scale),le.matrixWorldInverse.copy(le.matrixWorld).invert(),_t[10]===-1)le.projectionMatrix.copy(ve.projectionMatrix),le.projectionMatrixInverse.copy(ve.projectionMatrixInverse);else{const O=xt+zt,N=Re+zt,ce=yt-Ct,Ee=ye+(ke-Ct),He=ze*Re/N*O,Le=U*Re/N*O;le.projectionMatrix.makePerspective(ce,Ee,He,Le,O,N),le.projectionMatrixInverse.copy(le.projectionMatrix).invert()}}function he(le,ve){ve===null?le.matrixWorld.copy(le.matrix):le.matrixWorld.multiplyMatrices(ve.matrixWorld,le.matrix),le.matrixWorldInverse.copy(le.matrixWorld).invert()}this.updateCamera=function(le){if(r===null)return;let ve=le.near,Pe=le.far;A.texture!==null&&(A.depthNear>0&&(ve=A.depthNear),A.depthFar>0&&(Pe=A.depthFar)),M.near=I.near=_.near=ve,M.far=I.far=_.far=Pe,(R!==M.near||k!==M.far)&&(r.updateRenderState({depthNear:M.near,depthFar:M.far}),R=M.near,k=M.far);const ke=le.parent,_t=M.cameras;he(M,ke);for(let rt=0;rt<_t.length;rt++)he(_t[rt],ke);_t.length===2?Z(M,_,I):M.projectionMatrix.copy(_.projectionMatrix),be(le,M,ke)};function be(le,ve,Pe){Pe===null?le.matrix.copy(ve.matrixWorld):(le.matrix.copy(Pe.matrixWorld),le.matrix.invert(),le.matrix.multiply(ve.matrixWorld)),le.matrix.decompose(le.position,le.quaternion,le.scale),le.updateMatrixWorld(!0),le.projectionMatrix.copy(ve.projectionMatrix),le.projectionMatrixInverse.copy(ve.projectionMatrixInverse),le.isPerspectiveCamera&&(le.fov=ny*2*Math.atan(1/le.projectionMatrix.elements[5]),le.zoom=1)}this.getCamera=function(){return M},this.getFoveation=function(){if(!(p===null&&g===null))return c},this.setFoveation=function(le){c=le,p!==null&&(p.fixedFoveation=le),g!==null&&g.fixedFoveation!==void 0&&(g.fixedFoveation=le)},this.hasDepthSensing=function(){return A.texture!==null},this.getDepthSensingMesh=function(){return A.getMesh(M)};let _e=null;function Ye(le,ve){if(d=ve.getViewerPose(h||a),f=ve,d!==null){const Pe=d.views;g!==null&&(e.setRenderTargetFramebuffer(v,g.framebuffer),e.setRenderTarget(v));let ke=!1;Pe.length!==M.cameras.length&&(M.cameras.length=0,ke=!0);for(let rt=0;rt<Pe.length;rt++){const xt=Pe[rt];let Re=null;if(g!==null)Re=g.getViewport(xt);else{const U=u.getViewSubImage(p,xt);Re=U.viewport,rt===0&&(e.setRenderTargetTextures(v,U.colorTexture,p.ignoreDepthValues?void 0:U.depthStencilTexture),e.setRenderTarget(v))}let ze=B[rt];ze===void 0&&(ze=new Ot,ze.layers.enable(rt),ze.viewport=new $e,B[rt]=ze),ze.matrix.fromArray(xt.transform.matrix),ze.matrix.decompose(ze.position,ze.quaternion,ze.scale),ze.projectionMatrix.fromArray(xt.projectionMatrix),ze.projectionMatrixInverse.copy(ze.projectionMatrix).invert(),ze.viewport.set(Re.x,Re.y,Re.width,Re.height),rt===0&&(M.matrix.copy(ze.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)),ke===!0&&M.cameras.push(ze)}const _t=r.enabledFeatures;if(_t&&_t.includes("depth-sensing")){const rt=u.getDepthInformation(Pe[0]);rt&&rt.isValid&&rt.texture&&A.init(e,rt,r.renderState)}}if(s.controllerAutoUpdate)for(let Pe=0;Pe<x.length;Pe++){const ke=w[Pe],_t=x[Pe];ke!==null&&_t!==void 0&&_t.update(ke,ve,h||a)}_e&&_e(le,ve),ve.detectedPlanes&&s.dispatchEvent({type:"planesdetected",data:ve}),f=null}const je=new o9;je.setAnimationLoop(Ye),this.setAnimationLoop=function(le){_e=le},this.dispose=function(){}}}const If=new Oi,$me=new de;function ege(n,e){function i(y,b){y.matrixAutoUpdate===!0&&y.updateMatrix(),b.value.copy(y.matrix)}function s(y,b){b.color.getRGB(y.fogColor.value,n9(n)),b.isFog?(y.fogNear.value=b.near,y.fogFar.value=b.far):b.isFogExp2&&(y.fogDensity.value=b.density)}function r(y,b,v,x,w){b.isMeshBasicMaterial||b.isMeshLambertMaterial?o(y,b):b.isMeshToonMaterial?(o(y,b),u(y,b)):b.isMeshPhongMaterial?(o(y,b),d(y,b)):b.isMeshStandardMaterial?(o(y,b),p(y,b),b.isMeshPhysicalMaterial&&g(y,b,w)):b.isMeshMatcapMaterial?(o(y,b),f(y,b)):b.isMeshDepthMaterial?o(y,b):b.isMeshDistanceMaterial?(o(y,b),A(y,b)):b.isMeshNormalMaterial?o(y,b):b.isLineBasicMaterial?(a(y,b),b.isLineDashedMaterial&&l(y,b)):b.isPointsMaterial?c(y,b,v,x):b.isSpriteMaterial?h(y,b):b.isShadowMaterial?(y.color.value.copy(b.color),y.opacity.value=b.opacity):b.isShaderMaterial&&(b.uniformsNeedUpdate=!1)}function o(y,b){y.opacity.value=b.opacity,b.color&&y.diffuse.value.copy(b.color),b.emissive&&y.emissive.value.copy(b.emissive).multiplyScalar(b.emissiveIntensity),b.map&&(y.map.value=b.map,i(b.map,y.mapTransform)),b.alphaMap&&(y.alphaMap.value=b.alphaMap,i(b.alphaMap,y.alphaMapTransform)),b.bumpMap&&(y.bumpMap.value=b.bumpMap,i(b.bumpMap,y.bumpMapTransform),y.bumpScale.value=b.bumpScale,b.side===wn&&(y.bumpScale.value*=-1)),b.normalMap&&(y.normalMap.value=b.normalMap,i(b.normalMap,y.normalMapTransform),y.normalScale.value.copy(b.normalScale),b.side===wn&&y.normalScale.value.negate()),b.displacementMap&&(y.displacementMap.value=b.displacementMap,i(b.displacementMap,y.displacementMapTransform),y.displacementScale.value=b.displacementScale,y.displacementBias.value=b.displacementBias),b.emissiveMap&&(y.emissiveMap.value=b.emissiveMap,i(b.emissiveMap,y.emissiveMapTransform)),b.specularMap&&(y.specularMap.value=b.specularMap,i(b.specularMap,y.specularMapTransform)),b.alphaTest>0&&(y.alphaTest.value=b.alphaTest);const v=e.get(b),x=v.envMap,w=v.envMapRotation;x&&(y.envMap.value=x,If.copy(w),If.x*=-1,If.y*=-1,If.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(If.y*=-1,If.z*=-1),y.envMapRotation.value.setFromMatrix4($me.makeRotationFromEuler(If)),y.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,y.reflectivity.value=b.reflectivity,y.ior.value=b.ior,y.refractionRatio.value=b.refractionRatio),b.lightMap&&(y.lightMap.value=b.lightMap,y.lightMapIntensity.value=b.lightMapIntensity,i(b.lightMap,y.lightMapTransform)),b.aoMap&&(y.aoMap.value=b.aoMap,y.aoMapIntensity.value=b.aoMapIntensity,i(b.aoMap,y.aoMapTransform))}function a(y,b){y.diffuse.value.copy(b.color),y.opacity.value=b.opacity,b.map&&(y.map.value=b.map,i(b.map,y.mapTransform))}function l(y,b){y.dashSize.value=b.dashSize,y.totalSize.value=b.dashSize+b.gapSize,y.scale.value=b.scale}function c(y,b,v,x){y.diffuse.value.copy(b.color),y.opacity.value=b.opacity,y.size.value=b.size*v,y.scale.value=x*.5,b.map&&(y.map.value=b.map,i(b.map,y.uvTransform)),b.alphaMap&&(y.alphaMap.value=b.alphaMap,i(b.alphaMap,y.alphaMapTransform)),b.alphaTest>0&&(y.alphaTest.value=b.alphaTest)}function h(y,b){y.diffuse.value.copy(b.color),y.opacity.value=b.opacity,y.rotation.value=b.rotation,b.map&&(y.map.value=b.map,i(b.map,y.mapTransform)),b.alphaMap&&(y.alphaMap.value=b.alphaMap,i(b.alphaMap,y.alphaMapTransform)),b.alphaTest>0&&(y.alphaTest.value=b.alphaTest)}function d(y,b){y.specular.value.copy(b.specular),y.shininess.value=Math.max(b.shininess,1e-4)}function u(y,b){b.gradientMap&&(y.gradientMap.value=b.gradientMap)}function p(y,b){y.metalness.value=b.metalness,b.metalnessMap&&(y.metalnessMap.value=b.metalnessMap,i(b.metalnessMap,y.metalnessMapTransform)),y.roughness.value=b.roughness,b.roughnessMap&&(y.roughnessMap.value=b.roughnessMap,i(b.roughnessMap,y.roughnessMapTransform)),b.envMap&&(y.envMapIntensity.value=b.envMapIntensity)}function g(y,b,v){y.ior.value=b.ior,b.sheen>0&&(y.sheenColor.value.copy(b.sheenColor).multiplyScalar(b.sheen),y.sheenRoughness.value=b.sheenRoughness,b.sheenColorMap&&(y.sheenColorMap.value=b.sheenColorMap,i(b.sheenColorMap,y.sheenColorMapTransform)),b.sheenRoughnessMap&&(y.sheenRoughnessMap.value=b.sheenRoughnessMap,i(b.sheenRoughnessMap,y.sheenRoughnessMapTransform))),b.clearcoat>0&&(y.clearcoat.value=b.clearcoat,y.clearcoatRoughness.value=b.clearcoatRoughness,b.clearcoatMap&&(y.clearcoatMap.value=b.clearcoatMap,i(b.clearcoatMap,y.clearcoatMapTransform)),b.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=b.clearcoatRoughnessMap,i(b.clearcoatRoughnessMap,y.clearcoatRoughnessMapTransform)),b.clearcoatNormalMap&&(y.clearcoatNormalMap.value=b.clearcoatNormalMap,i(b.clearcoatNormalMap,y.clearcoatNormalMapTransform),y.clearcoatNormalScale.value.copy(b.clearcoatNormalScale),b.side===wn&&y.clearcoatNormalScale.value.negate())),b.dispersion>0&&(y.dispersion.value=b.dispersion),b.iridescence>0&&(y.iridescence.value=b.iridescence,y.iridescenceIOR.value=b.iridescenceIOR,y.iridescenceThicknessMinimum.value=b.iridescenceThicknessRange[0],y.iridescenceThicknessMaximum.value=b.iridescenceThicknessRange[1],b.iridescenceMap&&(y.iridescenceMap.value=b.iridescenceMap,i(b.iridescenceMap,y.iridescenceMapTransform)),b.iridescenceThicknessMap&&(y.iridescenceThicknessMap.value=b.iridescenceThicknessMap,i(b.iridescenceThicknessMap,y.iridescenceThicknessMapTransform))),b.transmission>0&&(y.transmission.value=b.transmission,y.transmissionSamplerMap.value=v.texture,y.transmissionSamplerSize.value.set(v.width,v.height),b.transmissionMap&&(y.transmissionMap.value=b.transmissionMap,i(b.transmissionMap,y.transmissionMapTransform)),y.thickness.value=b.thickness,b.thicknessMap&&(y.thicknessMap.value=b.thicknessMap,i(b.thicknessMap,y.thicknessMapTransform)),y.attenuationDistance.value=b.attenuationDistance,y.attenuationColor.value.copy(b.attenuationColor)),b.anisotropy>0&&(y.anisotropyVector.value.set(b.anisotropy*Math.cos(b.anisotropyRotation),b.anisotropy*Math.sin(b.anisotropyRotation)),b.anisotropyMap&&(y.anisotropyMap.value=b.anisotropyMap,i(b.anisotropyMap,y.anisotropyMapTransform))),y.specularIntensity.value=b.specularIntensity,y.specularColor.value.copy(b.specularColor),b.specularColorMap&&(y.specularColorMap.value=b.specularColorMap,i(b.specularColorMap,y.specularColorMapTransform)),b.specularIntensityMap&&(y.specularIntensityMap.value=b.specularIntensityMap,i(b.specularIntensityMap,y.specularIntensityMapTransform))}function f(y,b){b.matcap&&(y.matcap.value=b.matcap)}function A(y,b){const v=e.get(b).light;y.referencePosition.value.setFromMatrixPosition(v.matrixWorld),y.nearDistance.value=v.shadow.camera.near,y.farDistance.value=v.shadow.camera.far}return{refreshFogUniforms:s,refreshMaterialUniforms:r}}function tge(n,e,i,s){let r={},o={},a=[];const l=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function c(v,x){const w=x.program;s.uniformBlockBinding(v,w)}function h(v,x){let w=r[v.id];w===void 0&&(f(v),w=d(v),r[v.id]=w,v.addEventListener("dispose",y));const C=x.program;s.updateUBOMapping(v,C);const S=e.render.frame;o[v.id]!==S&&(p(v),o[v.id]=S)}function d(v){const x=u();v.__bindingPointIndex=x;const w=n.createBuffer(),C=v.__size,S=v.usage;return n.bindBuffer(n.UNIFORM_BUFFER,w),n.bufferData(n.UNIFORM_BUFFER,C,S),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,x,w),w}function u(){for(let v=0;v<l;v++)if(a.indexOf(v)===-1)return a.push(v),v;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function p(v){const x=r[v.id],w=v.uniforms,C=v.__cache;n.bindBuffer(n.UNIFORM_BUFFER,x);for(let S=0,_=w.length;S<_;S++){const I=Array.isArray(w[S])?w[S]:[w[S]];for(let B=0,M=I.length;B<M;B++){const R=I[B];if(g(R,S,B,C)===!0){const k=R.__offset,G=Array.isArray(R.value)?R.value:[R.value];let X=0;for(let F=0;F<G.length;F++){const z=G[F],H=A(z);typeof z=="number"||typeof z=="boolean"?(R.__data[0]=z,n.bufferSubData(n.UNIFORM_BUFFER,k+X,R.__data)):z.isMatrix3?(R.__data[0]=z.elements[0],R.__data[1]=z.elements[1],R.__data[2]=z.elements[2],R.__data[3]=0,R.__data[4]=z.elements[3],R.__data[5]=z.elements[4],R.__data[6]=z.elements[5],R.__data[7]=0,R.__data[8]=z.elements[6],R.__data[9]=z.elements[7],R.__data[10]=z.elements[8],R.__data[11]=0):(z.toArray(R.__data,X),X+=H.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,k,R.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function g(v,x,w,C){const S=v.value,_=x+"_"+w;if(C[_]===void 0)return typeof S=="number"||typeof S=="boolean"?C[_]=S:C[_]=S.clone(),!0;{const I=C[_];if(typeof S=="number"||typeof S=="boolean"){if(I!==S)return C[_]=S,!0}else if(I.equals(S)===!1)return I.copy(S),!0}return!1}function f(v){const x=v.uniforms;let w=0;const C=16;for(let _=0,I=x.length;_<I;_++){const B=Array.isArray(x[_])?x[_]:[x[_]];for(let M=0,R=B.length;M<R;M++){const k=B[M],G=Array.isArray(k.value)?k.value:[k.value];for(let X=0,F=G.length;X<F;X++){const z=G[X],H=A(z),Z=w%C,he=Z%H.boundary,be=Z+he;w+=he,be!==0&&C-be<H.storage&&(w+=C-be),k.__data=new Float32Array(H.storage/Float32Array.BYTES_PER_ELEMENT),k.__offset=w,w+=H.storage}}}const S=w%C;return S>0&&(w+=C-S),v.__size=w,v.__cache={},this}function A(v){const x={boundary:0,storage:0};return typeof v=="number"||typeof v=="boolean"?(x.boundary=4,x.storage=4):v.isVector2?(x.boundary=8,x.storage=8):v.isVector3||v.isColor?(x.boundary=16,x.storage=12):v.isVector4?(x.boundary=16,x.storage=16):v.isMatrix3?(x.boundary=48,x.storage=48):v.isMatrix4?(x.boundary=64,x.storage=64):v.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",v),x}function y(v){const x=v.target;x.removeEventListener("dispose",y);const w=a.indexOf(x.__bindingPointIndex);a.splice(w,1),n.deleteBuffer(r[x.id]),delete r[x.id],delete o[x.id]}function b(){for(const v in r)n.deleteBuffer(r[v]);a=[],r={},o={}}return{bind:c,update:h,dispose:b}}class om{constructor(e={}){const{canvas:i=XW(),context:s=null,depth:r=!0,stencil:o=!1,alpha:a=!1,antialias:l=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:h=!1,powerPreference:d="default",failIfMajorPerformanceCaveat:u=!1}=e;this.isWebGLRenderer=!0;let p;if(s!==null){if(typeof WebGLRenderingContext<"u"&&s instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=s.getContextAttributes().alpha}else p=a;const g=new Uint32Array(4),f=new Int32Array(4);let A=null,y=null;const b=[],v=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=ut,this.toneMapping=kr,this.toneMappingExposure=1;const x=this;let w=!1,C=0,S=0,_=null,I=-1,B=null;const M=new $e,R=new $e;let k=null;const G=new fe(0);let X=0,F=i.width,z=i.height,H=1,Z=null,he=null;const be=new $e(0,0,F,z),_e=new $e(0,0,F,z);let Ye=!1;const je=new Cf;let le=!1,ve=!1;const Pe=new de,ke=new de,_t=new E,rt=new $e,xt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Re=!1;function ze(){return _===null?H:1}let U=s;function ot(V,ee){return i.getContext(V,ee)}try{const V={alpha:!0,depth:r,stencil:o,antialias:l,premultipliedAlpha:c,preserveDrawingBuffer:h,powerPreference:d,failIfMajorPerformanceCaveat:u};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${fa}`),i.addEventListener("webglcontextlost",Ze,!1),i.addEventListener("webglcontextrestored",L,!1),i.addEventListener("webglcontextcreationerror",P,!1),U===null){const ee="webgl2";if(U=ot(ee,V),U===null)throw ot(ee)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(V){throw console.error("THREE.WebGLRenderer: "+V.message),V}let Ne,yt,ye,zt,Ct,O,N,ce,Ee,He,Le,bt,nt,mt,ii,Ge,Mt,Yt,qt,et,Vi,vi,gn,se;function St(){Ne=new ape(U),Ne.init(),vi=new G9(U,Ne),yt=new ipe(U,Ne,e,vi),ye=new Fme(U),yt.reverseDepthBuffer&&ye.buffers.depth.setReversed(!0),zt=new hpe(U),Ct=new Tme,O=new Qme(U,Ne,ye,Ct,yt,vi,zt),N=new spe(x),ce=new ope(x),Ee=new yhe(U),gn=new epe(U,Ee),He=new lpe(U,Ee,zt,gn),Le=new upe(U,He,Ee,zt),qt=new dpe(U,yt,O),Ge=new npe(Ct),bt=new Ime(x,N,ce,Ne,yt,gn,Ge),nt=new ege(x,Ct),mt=new Rme,ii=new Nme(Ne),Yt=new $ue(x,N,ce,ye,Le,p,c),Mt=new Dme(x,Le,yt),se=new tge(U,zt,yt,ye),et=new tpe(U,Ne,zt),Vi=new cpe(U,Ne,zt),zt.programs=bt.programs,x.capabilities=yt,x.extensions=Ne,x.properties=Ct,x.renderLists=mt,x.shadowMap=Mt,x.state=ye,x.info=zt}St();const we=new qme(x,U);this.xr=we,this.getContext=function(){return U},this.getContextAttributes=function(){return U.getContextAttributes()},this.forceContextLoss=function(){const V=Ne.get("WEBGL_lose_context");V&&V.loseContext()},this.forceContextRestore=function(){const V=Ne.get("WEBGL_lose_context");V&&V.restoreContext()},this.getPixelRatio=function(){return H},this.setPixelRatio=function(V){V!==void 0&&(H=V,this.setSize(F,z,!1))},this.getSize=function(V){return V.set(F,z)},this.setSize=function(V,ee,me=!0){if(we.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}F=V,z=ee,i.width=Math.floor(V*H),i.height=Math.floor(ee*H),me===!0&&(i.style.width=V+"px",i.style.height=ee+"px"),this.setViewport(0,0,V,ee)},this.getDrawingBufferSize=function(V){return V.set(F*H,z*H).floor()},this.setDrawingBufferSize=function(V,ee,me){F=V,z=ee,H=me,i.width=Math.floor(V*me),i.height=Math.floor(ee*me),this.setViewport(0,0,V,ee)},this.getCurrentViewport=function(V){return V.copy(M)},this.getViewport=function(V){return V.copy(be)},this.setViewport=function(V,ee,me,ue){V.isVector4?be.set(V.x,V.y,V.z,V.w):be.set(V,ee,me,ue),ye.viewport(M.copy(be).multiplyScalar(H).round())},this.getScissor=function(V){return V.copy(_e)},this.setScissor=function(V,ee,me,ue){V.isVector4?_e.set(V.x,V.y,V.z,V.w):_e.set(V,ee,me,ue),ye.scissor(R.copy(_e).multiplyScalar(H).round())},this.getScissorTest=function(){return Ye},this.setScissorTest=function(V){ye.setScissorTest(Ye=V)},this.setOpaqueSort=function(V){Z=V},this.setTransparentSort=function(V){he=V},this.getClearColor=function(V){return V.copy(Yt.getClearColor())},this.setClearColor=function(){Yt.setClearColor.apply(Yt,arguments)},this.getClearAlpha=function(){return Yt.getClearAlpha()},this.setClearAlpha=function(){Yt.setClearAlpha.apply(Yt,arguments)},this.clear=function(V=!0,ee=!0,me=!0){let ue=0;if(V){let J=!1;if(_!==null){const Xe=_.texture.format;J=Xe===uf||Xe===YA||Xe===KA}if(J){const Xe=_.texture.type,At=Xe===Xi||Xe===Gr||Xe===hf||Xe===jp||Xe===FM||Xe===UM,It=Yt.getClearColor(),Tt=Yt.getClearAlpha(),ni=It.r,ui=It.g,ci=It.b;At?(g[0]=ni,g[1]=ui,g[2]=ci,g[3]=Tt,U.clearBufferuiv(U.COLOR,0,g)):(f[0]=ni,f[1]=ui,f[2]=ci,f[3]=Tt,U.clearBufferiv(U.COLOR,0,f))}else ue|=U.COLOR_BUFFER_BIT}ee&&(ue|=U.DEPTH_BUFFER_BIT,U.clearDepth(this.capabilities.reverseDepthBuffer?0:1)),me&&(ue|=U.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),U.clear(ue)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",Ze,!1),i.removeEventListener("webglcontextrestored",L,!1),i.removeEventListener("webglcontextcreationerror",P,!1),mt.dispose(),ii.dispose(),Ct.dispose(),N.dispose(),ce.dispose(),Le.dispose(),gn.dispose(),se.dispose(),bt.dispose(),we.dispose(),we.removeEventListener("sessionstart",Ke),we.removeEventListener("sessionend",We),De.stop()};function Ze(V){V.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),w=!0}function L(){console.log("THREE.WebGLRenderer: Context Restored."),w=!1;const V=zt.autoReset,ee=Mt.enabled,me=Mt.autoUpdate,ue=Mt.needsUpdate,J=Mt.type;St(),zt.autoReset=V,Mt.enabled=ee,Mt.autoUpdate=me,Mt.needsUpdate=ue,Mt.type=J}function P(V){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",V.statusMessage)}function W(V){const ee=V.target;ee.removeEventListener("dispose",W),te(ee)}function te(V){Se(V),Ct.remove(V)}function Se(V){const ee=Ct.get(V).programs;ee!==void 0&&(ee.forEach(function(me){bt.releaseProgram(me)}),V.isShaderMaterial&&bt.releaseShaderCache(V))}this.renderBufferDirect=function(V,ee,me,ue,J,Xe){ee===null&&(ee=xt);const At=J.isMesh&&J.matrixWorld.determinant()<0,It=us(V,ee,me,ue,J);ye.setMaterial(ue,At);let Tt=me.index,ni=1;if(ue.wireframe===!0){if(Tt=He.getWireframeAttribute(me),Tt===void 0)return;ni=2}const ui=me.drawRange,ci=me.attributes.position;let xn=ui.start*ni,ps=(ui.start+ui.count)*ni;Xe!==null&&(xn=Math.max(xn,Xe.start*ni),ps=Math.min(ps,(Xe.start+Xe.count)*ni)),Tt!==null?(xn=Math.max(xn,0),ps=Math.min(ps,Tt.count)):ci!=null&&(xn=Math.max(xn,0),ps=Math.min(ps,ci.count));const Ds=ps-xn;if(Ds<0||Ds===1/0)return;gn.setup(J,ue,It,me,Tt);let fr,ts=et;if(Tt!==null&&(fr=Ee.get(Tt),ts=Vi,ts.setIndex(fr)),J.isMesh)ue.wireframe===!0?(ye.setLineWidth(ue.wireframeLinewidth*ze()),ts.setMode(U.LINES)):ts.setMode(U.TRIANGLES);else if(J.isLine){let Kt=ue.linewidth;Kt===void 0&&(Kt=1),ye.setLineWidth(Kt*ze()),J.isLineSegments?ts.setMode(U.LINES):J.isLineLoop?ts.setMode(U.LINE_LOOP):ts.setMode(U.LINE_STRIP)}else J.isPoints?ts.setMode(U.POINTS):J.isSprite&&ts.setMode(U.TRIANGLES);if(J.isBatchedMesh)if(J._multiDrawInstances!==null)ts.renderMultiDrawInstances(J._multiDrawStarts,J._multiDrawCounts,J._multiDrawCount,J._multiDrawInstances);else if(Ne.get("WEBGL_multi_draw"))ts.renderMultiDraw(J._multiDrawStarts,J._multiDrawCounts,J._multiDrawCount);else{const Kt=J._multiDrawStarts,ga=J._multiDrawCounts,tf=J._multiDrawCount,sh=Tt?Ee.get(Tt).bytesPerElement:1,zA=Ct.get(ue).currentProgram.getUniforms();for(let yl=0;yl<tf;yl++)zA.setValue(U,"_gl_DrawID",yl),ts.render(Kt[yl]/sh,ga[yl])}else if(J.isInstancedMesh)ts.renderInstances(xn,Ds,J.count);else if(me.isInstancedBufferGeometry){const Kt=me._maxInstanceCount!==void 0?me._maxInstanceCount:1/0,ga=Math.min(me.instanceCount,Kt);ts.renderInstances(xn,Ds,ga)}else ts.render(xn,Ds)};function re(V,ee,me){V.transparent===!0&&V.side===Qi&&V.forceSinglePass===!1?(V.side=wn,V.needsUpdate=!0,kt(V,ee,me),V.side=ms,V.needsUpdate=!0,kt(V,ee,me),V.side=Qi):kt(V,ee,me)}this.compile=function(V,ee,me=null){me===null&&(me=V),y=ii.get(me),y.init(ee),v.push(y),me.traverseVisible(function(J){J.isLight&&J.layers.test(ee.layers)&&(y.pushLight(J),J.castShadow&&y.pushShadow(J))}),V!==me&&V.traverseVisible(function(J){J.isLight&&J.layers.test(ee.layers)&&(y.pushLight(J),J.castShadow&&y.pushShadow(J))}),y.setupLights();const ue=new Set;return V.traverse(function(J){if(!(J.isMesh||J.isPoints||J.isLine||J.isSprite))return;const Xe=J.material;if(Xe)if(Array.isArray(Xe))for(let At=0;At<Xe.length;At++){const It=Xe[At];re(It,me,J),ue.add(It)}else re(Xe,me,J),ue.add(Xe)}),v.pop(),y=null,ue},this.compileAsync=function(V,ee,me=null){const ue=this.compile(V,ee,me);return new Promise(J=>{function Xe(){if(ue.forEach(function(At){Ct.get(At).currentProgram.isReady()&&ue.delete(At)}),ue.size===0){J(V);return}setTimeout(Xe,10)}Ne.get("KHR_parallel_shader_compile")!==null?Xe():setTimeout(Xe,10)})};let Ve=null;function qe(V){Ve&&Ve(V)}function Ke(){De.stop()}function We(){De.start()}const De=new o9;De.setAnimationLoop(qe),typeof self<"u"&&De.setContext(self),this.setAnimationLoop=function(V){Ve=V,we.setAnimationLoop(V),V===null?De.stop():De.start()},we.addEventListener("sessionstart",Ke),we.addEventListener("sessionend",We),this.render=function(V,ee){if(ee!==void 0&&ee.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(w===!0)return;if(V.matrixWorldAutoUpdate===!0&&V.updateMatrixWorld(),ee.parent===null&&ee.matrixWorldAutoUpdate===!0&&ee.updateMatrixWorld(),we.enabled===!0&&we.isPresenting===!0&&(we.cameraAutoUpdate===!0&&we.updateCamera(ee),ee=we.getCamera()),V.isScene===!0&&V.onBeforeRender(x,V,ee,_),y=ii.get(V,v.length),y.init(ee),v.push(y),ke.multiplyMatrices(ee.projectionMatrix,ee.matrixWorldInverse),je.setFromProjectionMatrix(ke),ve=this.localClippingEnabled,le=Ge.init(this.clippingPlanes,ve),A=mt.get(V,b.length),A.init(),b.push(A),we.enabled===!0&&we.isPresenting===!0){const Xe=x.xr.getDepthSensingMesh();Xe!==null&&vt(Xe,ee,-1/0,x.sortObjects)}vt(V,ee,0,x.sortObjects),A.finish(),x.sortObjects===!0&&A.sort(Z,he),Re=we.enabled===!1||we.isPresenting===!1||we.hasDepthSensing()===!1,Re&&Yt.addToRenderList(A,V),this.info.render.frame++,le===!0&&Ge.beginShadows();const me=y.state.shadowsArray;Mt.render(me,V,ee),le===!0&&Ge.endShadows(),this.info.autoReset===!0&&this.info.reset();const ue=A.opaque,J=A.transmissive;if(y.setupLights(),ee.isArrayCamera){const Xe=ee.cameras;if(J.length>0)for(let At=0,It=Xe.length;At<It;At++){const Tt=Xe[At];Bt(ue,J,V,Tt)}Re&&Yt.render(V);for(let At=0,It=Xe.length;At<It;At++){const Tt=Xe[At];gt(A,V,Tt,Tt.viewport)}}else J.length>0&&Bt(ue,J,V,ee),Re&&Yt.render(V),gt(A,V,ee);_!==null&&(O.updateMultisampleRenderTarget(_),O.updateRenderTargetMipmap(_)),V.isScene===!0&&V.onAfterRender(x,V,ee),gn.resetDefaultState(),I=-1,B=null,v.pop(),v.length>0?(y=v[v.length-1],le===!0&&Ge.setGlobalState(x.clippingPlanes,y.state.camera)):y=null,b.pop(),b.length>0?A=b[b.length-1]:A=null};function vt(V,ee,me,ue){if(V.visible===!1)return;if(V.layers.test(ee.layers)){if(V.isGroup)me=V.renderOrder;else if(V.isLOD)V.autoUpdate===!0&&V.update(ee);else if(V.isLight)y.pushLight(V),V.castShadow&&y.pushShadow(V);else if(V.isSprite){if(!V.frustumCulled||je.intersectsSprite(V)){ue&&rt.setFromMatrixPosition(V.matrixWorld).applyMatrix4(ke);const Xe=Le.update(V),At=V.material;At.visible&&A.push(V,Xe,At,me,rt.z,null)}}else if((V.isMesh||V.isLine||V.isPoints)&&(!V.frustumCulled||je.intersectsObject(V))){const Xe=Le.update(V),At=V.material;if(ue&&(V.boundingSphere!==void 0?(V.boundingSphere===null&&V.computeBoundingSphere(),rt.copy(V.boundingSphere.center)):(Xe.boundingSphere===null&&Xe.computeBoundingSphere(),rt.copy(Xe.boundingSphere.center)),rt.applyMatrix4(V.matrixWorld).applyMatrix4(ke)),Array.isArray(At)){const It=Xe.groups;for(let Tt=0,ni=It.length;Tt<ni;Tt++){const ui=It[Tt],ci=At[ui.materialIndex];ci&&ci.visible&&A.push(V,Xe,ci,me,rt.z,ui)}}else At.visible&&A.push(V,Xe,At,me,rt.z,null)}}const J=V.children;for(let Xe=0,At=J.length;Xe<At;Xe++)vt(J[Xe],ee,me,ue)}function gt(V,ee,me,ue){const J=V.opaque,Xe=V.transmissive,At=V.transparent;y.setupLightsView(me),le===!0&&Ge.setGlobalState(x.clippingPlanes,me),ue&&ye.viewport(M.copy(ue)),J.length>0&&ei(J,ee,me),Xe.length>0&&ei(Xe,ee,me),At.length>0&&ei(At,ee,me),ye.buffers.depth.setTest(!0),ye.buffers.depth.setMask(!0),ye.buffers.color.setMask(!0),ye.setPolygonOffset(!1)}function Bt(V,ee,me,ue){if((me.isScene===!0?me.overrideMaterial:null)!==null)return;y.state.transmissionRenderTarget[ue.id]===void 0&&(y.state.transmissionRenderTarget[ue.id]=new fi(1,1,{generateMipmaps:!0,type:Ne.has("EXT_color_buffer_half_float")||Ne.has("EXT_color_buffer_float")?Ki:Xi,minFilter:Ar,samples:4,stencilBuffer:o,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:hi.workingColorSpace}));const J=y.state.transmissionRenderTarget[ue.id],Xe=ue.viewport||M;J.setSize(Xe.z,Xe.w);const At=x.getRenderTarget();x.setRenderTarget(J),x.getClearColor(G),X=x.getClearAlpha(),X<1&&x.setClearColor(16777215,.5),x.clear(),Re&&Yt.render(me);const It=x.toneMapping;x.toneMapping=kr;const Tt=ue.viewport;if(ue.viewport!==void 0&&(ue.viewport=void 0),y.setupLightsView(ue),le===!0&&Ge.setGlobalState(x.clippingPlanes,ue),ei(V,me,ue),O.updateMultisampleRenderTarget(J),O.updateRenderTargetMipmap(J),Ne.has("WEBGL_multisampled_render_to_texture")===!1){let ni=!1;for(let ui=0,ci=ee.length;ui<ci;ui++){const xn=ee[ui],ps=xn.object,Ds=xn.geometry,fr=xn.material,ts=xn.group;if(fr.side===Qi&&ps.layers.test(ue.layers)){const Kt=fr.side;fr.side=wn,fr.needsUpdate=!0,wt(ps,me,ue,Ds,fr,ts),fr.side=Kt,fr.needsUpdate=!0,ni=!0}}ni===!0&&(O.updateMultisampleRenderTarget(J),O.updateRenderTargetMipmap(J))}x.setRenderTarget(At),x.setClearColor(G,X),Tt!==void 0&&(ue.viewport=Tt),x.toneMapping=It}function ei(V,ee,me){const ue=ee.isScene===!0?ee.overrideMaterial:null;for(let J=0,Xe=V.length;J<Xe;J++){const At=V[J],It=At.object,Tt=At.geometry,ni=ue===null?At.material:ue,ui=At.group;It.layers.test(me.layers)&&wt(It,ee,me,Tt,ni,ui)}}function wt(V,ee,me,ue,J,Xe){V.onBeforeRender(x,ee,me,ue,J,Xe),V.modelViewMatrix.multiplyMatrices(me.matrixWorldInverse,V.matrixWorld),V.normalMatrix.getNormalMatrix(V.modelViewMatrix),J.onBeforeRender(x,ee,me,ue,V,Xe),J.transparent===!0&&J.side===Qi&&J.forceSinglePass===!1?(J.side=wn,J.needsUpdate=!0,x.renderBufferDirect(me,ee,ue,J,V,Xe),J.side=ms,J.needsUpdate=!0,x.renderBufferDirect(me,ee,ue,J,V,Xe),J.side=Qi):x.renderBufferDirect(me,ee,ue,J,V,Xe),V.onAfterRender(x,ee,me,ue,J,Xe)}function kt(V,ee,me){ee.isScene!==!0&&(ee=xt);const ue=Ct.get(V),J=y.state.lights,Xe=y.state.shadowsArray,At=J.state.version,It=bt.getParameters(V,J.state,Xe,ee,me),Tt=bt.getProgramCacheKey(It);let ni=ue.programs;ue.environment=V.isMeshStandardMaterial?ee.environment:null,ue.fog=ee.fog,ue.envMap=(V.isMeshStandardMaterial?ce:N).get(V.envMap||ue.environment),ue.envMapRotation=ue.environment!==null&&V.envMap===null?ee.environmentRotation:V.envMapRotation,ni===void 0&&(V.addEventListener("dispose",W),ni=new Map,ue.programs=ni);let ui=ni.get(Tt);if(ui!==void 0){if(ue.currentProgram===ui&&ue.lightsStateVersion===At)return En(V,It),ui}else It.uniforms=bt.getUniforms(V),V.onBuild(me,It,x),V.onBeforeCompile(It,x),ui=bt.acquireProgram(It,Tt),ni.set(Tt,ui),ue.uniforms=It.uniforms;const ci=ue.uniforms;return(!V.isShaderMaterial&&!V.isRawShaderMaterial||V.clipping===!0)&&(ci.clippingPlanes=Ge.uniform),En(V,It),ue.needsLights=Rn(V),ue.lightsStateVersion=At,ue.needsLights&&(ci.ambientLightColor.value=J.state.ambient,ci.lightProbe.value=J.state.probe,ci.directionalLights.value=J.state.directional,ci.directionalLightShadows.value=J.state.directionalShadow,ci.spotLights.value=J.state.spot,ci.spotLightShadows.value=J.state.spotShadow,ci.rectAreaLights.value=J.state.rectArea,ci.ltc_1.value=J.state.rectAreaLTC1,ci.ltc_2.value=J.state.rectAreaLTC2,ci.pointLights.value=J.state.point,ci.pointLightShadows.value=J.state.pointShadow,ci.hemisphereLights.value=J.state.hemi,ci.directionalShadowMap.value=J.state.directionalShadowMap,ci.directionalShadowMatrix.value=J.state.directionalShadowMatrix,ci.spotShadowMap.value=J.state.spotShadowMap,ci.spotLightMatrix.value=J.state.spotLightMatrix,ci.spotLightMap.value=J.state.spotLightMap,ci.pointShadowMap.value=J.state.pointShadowMap,ci.pointShadowMatrix.value=J.state.pointShadowMatrix),ue.currentProgram=ui,ue.uniformsList=null,ui}function mi(V){if(V.uniformsList===null){const ee=V.currentProgram.getUniforms();V.uniformsList=DI.seqWithValue(ee.seq,V.uniforms)}return V.uniformsList}function En(V,ee){const me=Ct.get(V);me.outputColorSpace=ee.outputColorSpace,me.batching=ee.batching,me.batchingColor=ee.batchingColor,me.instancing=ee.instancing,me.instancingColor=ee.instancingColor,me.instancingMorph=ee.instancingMorph,me.skinning=ee.skinning,me.morphTargets=ee.morphTargets,me.morphNormals=ee.morphNormals,me.morphColors=ee.morphColors,me.morphTargetsCount=ee.morphTargetsCount,me.numClippingPlanes=ee.numClippingPlanes,me.numIntersection=ee.numClipIntersection,me.vertexAlphas=ee.vertexAlphas,me.vertexTangents=ee.vertexTangents,me.toneMapping=ee.toneMapping}function us(V,ee,me,ue,J){ee.isScene!==!0&&(ee=xt),O.resetTextureUnits();const Xe=ee.fog,At=ue.isMeshStandardMaterial?ee.environment:null,It=_===null?x.outputColorSpace:_.isXRRenderTarget===!0?_.texture.colorSpace:qi,Tt=(ue.isMeshStandardMaterial?ce:N).get(ue.envMap||At),ni=ue.vertexColors===!0&&!!me.attributes.color&&me.attributes.color.itemSize===4,ui=!!me.attributes.tangent&&(!!ue.normalMap||ue.anisotropy>0),ci=!!me.morphAttributes.position,xn=!!me.morphAttributes.normal,ps=!!me.morphAttributes.color;let Ds=kr;ue.toneMapped&&(_===null||_.isXRRenderTarget===!0)&&(Ds=x.toneMapping);const fr=me.morphAttributes.position||me.morphAttributes.normal||me.morphAttributes.color,ts=fr!==void 0?fr.length:0,Kt=Ct.get(ue),ga=y.state.lights;if(le===!0&&(ve===!0||V!==B)){const pc=V===B&&ue.id===I;Ge.setState(ue,V,pc)}let tf=!1;ue.version===Kt.__version?(Kt.needsLights&&Kt.lightsStateVersion!==ga.state.version||Kt.outputColorSpace!==It||J.isBatchedMesh&&Kt.batching===!1||!J.isBatchedMesh&&Kt.batching===!0||J.isBatchedMesh&&Kt.batchingColor===!0&&J.colorTexture===null||J.isBatchedMesh&&Kt.batchingColor===!1&&J.colorTexture!==null||J.isInstancedMesh&&Kt.instancing===!1||!J.isInstancedMesh&&Kt.instancing===!0||J.isSkinnedMesh&&Kt.skinning===!1||!J.isSkinnedMesh&&Kt.skinning===!0||J.isInstancedMesh&&Kt.instancingColor===!0&&J.instanceColor===null||J.isInstancedMesh&&Kt.instancingColor===!1&&J.instanceColor!==null||J.isInstancedMesh&&Kt.instancingMorph===!0&&J.morphTexture===null||J.isInstancedMesh&&Kt.instancingMorph===!1&&J.morphTexture!==null||Kt.envMap!==Tt||ue.fog===!0&&Kt.fog!==Xe||Kt.numClippingPlanes!==void 0&&(Kt.numClippingPlanes!==Ge.numPlanes||Kt.numIntersection!==Ge.numIntersection)||Kt.vertexAlphas!==ni||Kt.vertexTangents!==ui||Kt.morphTargets!==ci||Kt.morphNormals!==xn||Kt.morphColors!==ps||Kt.toneMapping!==Ds||Kt.morphTargetsCount!==ts)&&(tf=!0):(tf=!0,Kt.__version=ue.version);let sh=Kt.currentProgram;tf===!0&&(sh=kt(ue,ee,J));let zA=!1,yl=!1,Jk=!1;const zs=sh.getUniforms(),Zp=Kt.uniforms;if(ye.useProgram(sh.program)&&(zA=!0,yl=!0,Jk=!0),ue.id!==I&&(I=ue.id,yl=!0),zA||B!==V){yt.reverseDepthBuffer?(Pe.copy(V.projectionMatrix),Zce(Pe),Wce(Pe),zs.setValue(U,"projectionMatrix",Pe)):zs.setValue(U,"projectionMatrix",V.projectionMatrix),zs.setValue(U,"viewMatrix",V.matrixWorldInverse);const pc=zs.map.cameraPosition;pc!==void 0&&pc.setValue(U,_t.setFromMatrixPosition(V.matrixWorld)),yt.logarithmicDepthBuffer&&zs.setValue(U,"logDepthBufFC",2/(Math.log(V.far+1)/Math.LN2)),(ue.isMeshPhongMaterial||ue.isMeshToonMaterial||ue.isMeshLambertMaterial||ue.isMeshBasicMaterial||ue.isMeshStandardMaterial||ue.isShaderMaterial)&&zs.setValue(U,"isOrthographic",V.isOrthographicCamera===!0),B!==V&&(B=V,yl=!0,Jk=!0)}if(J.isSkinnedMesh){zs.setOptional(U,J,"bindMatrix"),zs.setOptional(U,J,"bindMatrixInverse");const pc=J.skeleton;pc&&(pc.boneTexture===null&&pc.computeBoneTexture(),zs.setValue(U,"boneTexture",pc.boneTexture,O))}J.isBatchedMesh&&(zs.setOptional(U,J,"batchingTexture"),zs.setValue(U,"batchingTexture",J._matricesTexture,O),zs.setOptional(U,J,"batchingIdTexture"),zs.setValue(U,"batchingIdTexture",J._indirectTexture,O),zs.setOptional(U,J,"batchingColorTexture"),J._colorsTexture!==null&&zs.setValue(U,"batchingColorTexture",J._colorsTexture,O));const qk=me.morphAttributes;if((qk.position!==void 0||qk.normal!==void 0||qk.color!==void 0)&&qt.update(J,me,sh),(yl||Kt.receiveShadow!==J.receiveShadow)&&(Kt.receiveShadow=J.receiveShadow,zs.setValue(U,"receiveShadow",J.receiveShadow)),ue.isMeshGouraudMaterial&&ue.envMap!==null&&(Zp.envMap.value=Tt,Zp.flipEnvMap.value=Tt.isCubeTexture&&Tt.isRenderTargetTexture===!1?-1:1),ue.isMeshStandardMaterial&&ue.envMap===null&&ee.environment!==null&&(Zp.envMapIntensity.value=ee.environmentIntensity),yl&&(zs.setValue(U,"toneMappingExposure",x.toneMappingExposure),Kt.needsLights&&ma(Zp,Jk),Xe&&ue.fog===!0&&nt.refreshFogUniforms(Zp,Xe),nt.refreshMaterialUniforms(Zp,ue,H,z,y.state.transmissionRenderTarget[V.id]),DI.upload(U,mi(Kt),Zp,O)),ue.isShaderMaterial&&ue.uniformsNeedUpdate===!0&&(DI.upload(U,mi(Kt),Zp,O),ue.uniformsNeedUpdate=!1),ue.isSpriteMaterial&&zs.setValue(U,"center",J.center),zs.setValue(U,"modelViewMatrix",J.modelViewMatrix),zs.setValue(U,"normalMatrix",J.normalMatrix),zs.setValue(U,"modelMatrix",J.matrixWorld),ue.isShaderMaterial||ue.isRawShaderMaterial){const pc=ue.uniformsGroups;for(let $k=0,ace=pc.length;$k<ace;$k++){const QZ=pc[$k];se.update(QZ,sh),se.bind(QZ,sh)}}return sh}function ma(V,ee){V.ambientLightColor.needsUpdate=ee,V.lightProbe.needsUpdate=ee,V.directionalLights.needsUpdate=ee,V.directionalLightShadows.needsUpdate=ee,V.pointLights.needsUpdate=ee,V.pointLightShadows.needsUpdate=ee,V.spotLights.needsUpdate=ee,V.spotLightShadows.needsUpdate=ee,V.rectAreaLights.needsUpdate=ee,V.hemisphereLights.needsUpdate=ee}function Rn(V){return V.isMeshLambertMaterial||V.isMeshToonMaterial||V.isMeshPhongMaterial||V.isMeshStandardMaterial||V.isShadowMaterial||V.isShaderMaterial&&V.lights===!0}this.getActiveCubeFace=function(){return C},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(V,ee,me){Ct.get(V.texture).__webglTexture=ee,Ct.get(V.depthTexture).__webglTexture=me;const ue=Ct.get(V);ue.__hasExternalTextures=!0,ue.__autoAllocateDepthBuffer=me===void 0,ue.__autoAllocateDepthBuffer||Ne.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ue.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(V,ee){const me=Ct.get(V);me.__webglFramebuffer=ee,me.__useDefaultFramebuffer=ee===void 0},this.setRenderTarget=function(V,ee=0,me=0){_=V,C=ee,S=me;let ue=!0,J=null,Xe=!1,At=!1;if(V){const It=Ct.get(V);if(It.__useDefaultFramebuffer!==void 0)ye.bindFramebuffer(U.FRAMEBUFFER,null),ue=!1;else if(It.__webglFramebuffer===void 0)O.setupRenderTarget(V);else if(It.__hasExternalTextures)O.rebindTextures(V,Ct.get(V.texture).__webglTexture,Ct.get(V.depthTexture).__webglTexture);else if(V.depthBuffer){const ui=V.depthTexture;if(It.__boundDepthTexture!==ui){if(ui!==null&&Ct.has(ui)&&(V.width!==ui.image.width||V.height!==ui.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");O.setupDepthRenderbuffer(V)}}const Tt=V.texture;(Tt.isData3DTexture||Tt.isDataArrayTexture||Tt.isCompressedArrayTexture)&&(At=!0);const ni=Ct.get(V).__webglFramebuffer;V.isWebGLCubeRenderTarget?(Array.isArray(ni[ee])?J=ni[ee][me]:J=ni[ee],Xe=!0):V.samples>0&&O.useMultisampledRTT(V)===!1?J=Ct.get(V).__webglMultisampledFramebuffer:Array.isArray(ni)?J=ni[me]:J=ni,M.copy(V.viewport),R.copy(V.scissor),k=V.scissorTest}else M.copy(be).multiplyScalar(H).floor(),R.copy(_e).multiplyScalar(H).floor(),k=Ye;if(ye.bindFramebuffer(U.FRAMEBUFFER,J)&&ue&&ye.drawBuffers(V,J),ye.viewport(M),ye.scissor(R),ye.setScissorTest(k),Xe){const It=Ct.get(V.texture);U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_CUBE_MAP_POSITIVE_X+ee,It.__webglTexture,me)}else if(At){const It=Ct.get(V.texture),Tt=ee||0;U.framebufferTextureLayer(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,It.__webglTexture,me||0,Tt)}I=-1},this.readRenderTargetPixels=function(V,ee,me,ue,J,Xe,At){if(!(V&&V.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let It=Ct.get(V).__webglFramebuffer;if(V.isWebGLCubeRenderTarget&&At!==void 0&&(It=It[At]),It){ye.bindFramebuffer(U.FRAMEBUFFER,It);try{const Tt=V.texture,ni=Tt.format,ui=Tt.type;if(!yt.textureFormatReadable(ni)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!yt.textureTypeReadable(ui)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ee>=0&&ee<=V.width-ue&&me>=0&&me<=V.height-J&&U.readPixels(ee,me,ue,J,vi.convert(ni),vi.convert(ui),Xe)}finally{const Tt=_!==null?Ct.get(_).__webglFramebuffer:null;ye.bindFramebuffer(U.FRAMEBUFFER,Tt)}}},this.readRenderTargetPixelsAsync=async function(V,ee,me,ue,J,Xe,At){if(!(V&&V.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let It=Ct.get(V).__webglFramebuffer;if(V.isWebGLCubeRenderTarget&&At!==void 0&&(It=It[At]),It){const Tt=V.texture,ni=Tt.format,ui=Tt.type;if(!yt.textureFormatReadable(ni))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!yt.textureTypeReadable(ui))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(ee>=0&&ee<=V.width-ue&&me>=0&&me<=V.height-J){ye.bindFramebuffer(U.FRAMEBUFFER,It);const ci=U.createBuffer();U.bindBuffer(U.PIXEL_PACK_BUFFER,ci),U.bufferData(U.PIXEL_PACK_BUFFER,Xe.byteLength,U.STREAM_READ),U.readPixels(ee,me,ue,J,vi.convert(ni),vi.convert(ui),0);const xn=_!==null?Ct.get(_).__webglFramebuffer:null;ye.bindFramebuffer(U.FRAMEBUFFER,xn);const ps=U.fenceSync(U.SYNC_GPU_COMMANDS_COMPLETE,0);return U.flush(),await Oce(U,ps,4),U.bindBuffer(U.PIXEL_PACK_BUFFER,ci),U.getBufferSubData(U.PIXEL_PACK_BUFFER,0,Xe),U.deleteBuffer(ci),U.deleteSync(ps),Xe}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(V,ee=null,me=0){V.isTexture!==!0&&(mI("WebGLRenderer: copyFramebufferToTexture function signature has changed."),ee=arguments[0]||null,V=arguments[1]);const ue=Math.pow(2,-me),J=Math.floor(V.image.width*ue),Xe=Math.floor(V.image.height*ue),At=ee!==null?ee.x:0,It=ee!==null?ee.y:0;O.setTexture2D(V,0),U.copyTexSubImage2D(U.TEXTURE_2D,me,0,0,At,It,J,Xe),ye.unbindTexture()},this.copyTextureToTexture=function(V,ee,me=null,ue=null,J=0){V.isTexture!==!0&&(mI("WebGLRenderer: copyTextureToTexture function signature has changed."),ue=arguments[0]||null,V=arguments[1],ee=arguments[2],J=arguments[3]||0,me=null);let Xe,At,It,Tt,ni,ui;me!==null?(Xe=me.max.x-me.min.x,At=me.max.y-me.min.y,It=me.min.x,Tt=me.min.y):(Xe=V.image.width,At=V.image.height,It=0,Tt=0),ue!==null?(ni=ue.x,ui=ue.y):(ni=0,ui=0);const ci=vi.convert(ee.format),xn=vi.convert(ee.type);O.setTexture2D(ee,0),U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,ee.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ee.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,ee.unpackAlignment);const ps=U.getParameter(U.UNPACK_ROW_LENGTH),Ds=U.getParameter(U.UNPACK_IMAGE_HEIGHT),fr=U.getParameter(U.UNPACK_SKIP_PIXELS),ts=U.getParameter(U.UNPACK_SKIP_ROWS),Kt=U.getParameter(U.UNPACK_SKIP_IMAGES),ga=V.isCompressedTexture?V.mipmaps[J]:V.image;U.pixelStorei(U.UNPACK_ROW_LENGTH,ga.width),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,ga.height),U.pixelStorei(U.UNPACK_SKIP_PIXELS,It),U.pixelStorei(U.UNPACK_SKIP_ROWS,Tt),V.isDataTexture?U.texSubImage2D(U.TEXTURE_2D,J,ni,ui,Xe,At,ci,xn,ga.data):V.isCompressedTexture?U.compressedTexSubImage2D(U.TEXTURE_2D,J,ni,ui,ga.width,ga.height,ci,ga.data):U.texSubImage2D(U.TEXTURE_2D,J,ni,ui,Xe,At,ci,xn,ga),U.pixelStorei(U.UNPACK_ROW_LENGTH,ps),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,Ds),U.pixelStorei(U.UNPACK_SKIP_PIXELS,fr),U.pixelStorei(U.UNPACK_SKIP_ROWS,ts),U.pixelStorei(U.UNPACK_SKIP_IMAGES,Kt),J===0&&ee.generateMipmaps&&U.generateMipmap(U.TEXTURE_2D),ye.unbindTexture()},this.copyTextureToTexture3D=function(V,ee,me=null,ue=null,J=0){V.isTexture!==!0&&(mI("WebGLRenderer: copyTextureToTexture3D function signature has changed."),me=arguments[0]||null,ue=arguments[1]||null,V=arguments[2],ee=arguments[3],J=arguments[4]||0);let Xe,At,It,Tt,ni,ui,ci,xn,ps;const Ds=V.isCompressedTexture?V.mipmaps[J]:V.image;me!==null?(Xe=me.max.x-me.min.x,At=me.max.y-me.min.y,It=me.max.z-me.min.z,Tt=me.min.x,ni=me.min.y,ui=me.min.z):(Xe=Ds.width,At=Ds.height,It=Ds.depth,Tt=0,ni=0,ui=0),ue!==null?(ci=ue.x,xn=ue.y,ps=ue.z):(ci=0,xn=0,ps=0);const fr=vi.convert(ee.format),ts=vi.convert(ee.type);let Kt;if(ee.isData3DTexture)O.setTexture3D(ee,0),Kt=U.TEXTURE_3D;else if(ee.isDataArrayTexture||ee.isCompressedArrayTexture)O.setTexture2DArray(ee,0),Kt=U.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,ee.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ee.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,ee.unpackAlignment);const ga=U.getParameter(U.UNPACK_ROW_LENGTH),tf=U.getParameter(U.UNPACK_IMAGE_HEIGHT),sh=U.getParameter(U.UNPACK_SKIP_PIXELS),zA=U.getParameter(U.UNPACK_SKIP_ROWS),yl=U.getParameter(U.UNPACK_SKIP_IMAGES);U.pixelStorei(U.UNPACK_ROW_LENGTH,Ds.width),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,Ds.height),U.pixelStorei(U.UNPACK_SKIP_PIXELS,Tt),U.pixelStorei(U.UNPACK_SKIP_ROWS,ni),U.pixelStorei(U.UNPACK_SKIP_IMAGES,ui),V.isDataTexture||V.isData3DTexture?U.texSubImage3D(Kt,J,ci,xn,ps,Xe,At,It,fr,ts,Ds.data):ee.isCompressedArrayTexture?U.compressedTexSubImage3D(Kt,J,ci,xn,ps,Xe,At,It,fr,Ds.data):U.texSubImage3D(Kt,J,ci,xn,ps,Xe,At,It,fr,ts,Ds),U.pixelStorei(U.UNPACK_ROW_LENGTH,ga),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,tf),U.pixelStorei(U.UNPACK_SKIP_PIXELS,sh),U.pixelStorei(U.UNPACK_SKIP_ROWS,zA),U.pixelStorei(U.UNPACK_SKIP_IMAGES,yl),J===0&&ee.generateMipmaps&&U.generateMipmap(Kt),ye.unbindTexture()},this.initRenderTarget=function(V){Ct.get(V).__webglFramebuffer===void 0&&O.setupRenderTarget(V)},this.initTexture=function(V){V.isCubeTexture?O.setTextureCube(V,0):V.isData3DTexture?O.setTexture3D(V,0):V.isDataArrayTexture||V.isCompressedArrayTexture?O.setTexture2DArray(V,0):O.setTexture2D(V,0),ye.unbindTexture()},this.resetState=function(){C=0,S=0,_=null,ye.reset(),gn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ac}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const i=this.getContext();i.drawingBufferColorSpace=e===Ux?"display-p3":"srgb",i.unpackColorSpace=hi.workingColorSpace===ty?"display-p3":"srgb"}}class Gk{constructor(e,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new fe(e),this.density=i}clone(){return new Gk(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}let FI=class qle{constructor(e,i=1,s=1e3){this.isFog=!0,this.name="",this.color=new fe(e),this.near=i,this.far=s}clone(){return new qle(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}};class ir extends Ae{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Oi,this.environmentIntensity=1,this.environmentRotation=new Oi,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}}let Cy=class{constructor(n,e){this.isInterleavedBuffer=!0,this.array=n,this.stride=e,this.count=n!==void 0?n.length/e:0,this.usage=iy,this.updateRanges=[],this.version=0,this.uuid=xl()}onUploadCallback(){}set needsUpdate(n){n===!0&&this.version++}setUsage(n){return this.usage=n,this}addUpdateRange(n,e){this.updateRanges.push({start:n,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(n){return this.array=new n.array.constructor(n.array),this.count=n.count,this.stride=n.stride,this.usage=n.usage,this}copyAt(n,e,i){n*=this.stride,i*=e.stride;for(let s=0,r=this.stride;s<r;s++)this.array[n+s]=e.array[i+s];return this}set(n,e=0){return this.array.set(n,e),this}clone(n){n.arrayBuffers===void 0&&(n.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=xl()),n.arrayBuffers[this.array.buffer._uuid]===void 0&&(n.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(n.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(n){return this.onUploadCallback=n,this}toJSON(n){return n.arrayBuffers===void 0&&(n.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=xl()),n.arrayBuffers[this.array.buffer._uuid]===void 0&&(n.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};const va=new E;let xa=class $le{constructor(e,i,s,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=s,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,s=this.data.count;i<s;i++)va.fromBufferAttribute(this,i),va.applyMatrix4(e),this.setXYZ(i,va.x,va.y,va.z);return this}applyNormalMatrix(e){for(let i=0,s=this.count;i<s;i++)va.fromBufferAttribute(this,i),va.applyNormalMatrix(e),this.setXYZ(i,va.x,va.y,va.z);return this}transformDirection(e){for(let i=0,s=this.count;i<s;i++)va.fromBufferAttribute(this,i),va.transformDirection(e),this.setXYZ(i,va.x,va.y,va.z);return this}getComponent(e,i){let s=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(s=Aa(s,this.array)),s}setComponent(e,i,s){return this.normalized&&(s=Si(s,this.array)),this.data.array[e*this.data.stride+this.offset+i]=s,this}setX(e,i){return this.normalized&&(i=Si(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=Si(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=Si(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=Si(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=Aa(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=Aa(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=Aa(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=Aa(i,this.array)),i}setXY(e,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=Si(i,this.array),s=Si(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=s,this}setXYZ(e,i,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(i=Si(i,this.array),s=Si(s,this.array),r=Si(r,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=s,this.data.array[e+2]=r,this}setXYZW(e,i,s,r,o){return e=e*this.data.stride+this.offset,this.normalized&&(i=Si(i,this.array),s=Si(s,this.array),r=Si(r,this.array),o=Si(o,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=s,this.data.array[e+2]=r,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let s=0;s<this.count;s++){const r=s*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[r+o])}return new ct(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new $le(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let s=0;s<this.count;s++){const r=s*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[r+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};class s1 extends ti{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new fe(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Sy;const r1=new E,_y=new E,My=new E,Iy=new Q,o1=new Q,P9=new de,UI=new E,a1=new E,OI=new E,N9=new Q,oP=new Q,V9=new Q;let aP=class extends Ae{constructor(n=new s1){if(super(),this.isSprite=!0,this.type="Sprite",Sy===void 0){Sy=new Rt;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Cy(e,5);Sy.setIndex([0,1,2,0,2,3]),Sy.setAttribute("position",new xa(i,3,0,!1)),Sy.setAttribute("uv",new xa(i,2,3,!1))}this.geometry=Sy,this.material=n,this.center=new Q(.5,.5)}raycast(n,e){n.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_y.setFromMatrixScale(this.matrixWorld),P9.copy(n.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(n.camera.matrixWorldInverse,this.matrixWorld),My.setFromMatrixPosition(this.modelViewMatrix),n.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_y.multiplyScalar(-My.z);const i=this.material.rotation;let s,r;i!==0&&(r=Math.cos(i),s=Math.sin(i));const o=this.center;ZI(UI.set(-.5,-.5,0),My,o,_y,s,r),ZI(a1.set(.5,-.5,0),My,o,_y,s,r),ZI(OI.set(.5,.5,0),My,o,_y,s,r),N9.set(0,0),oP.set(1,0),V9.set(1,1);let a=n.ray.intersectTriangle(UI,a1,OI,!1,r1);if(a===null&&(ZI(a1.set(-.5,.5,0),My,o,_y,s,r),oP.set(0,1),a=n.ray.intersectTriangle(UI,OI,a1,!1,r1),a===null))return;const l=n.ray.origin.distanceTo(r1);l<n.near||l>n.far||e.push({distance:l,point:r1.clone(),uv:$s.getInterpolation(r1,UI,a1,OI,N9,oP,V9,new Q),face:null,object:this})}copy(n,e){return super.copy(n,e),n.center!==void 0&&this.center.copy(n.center),this.material=n.material,this}};function ZI(n,e,i,s,r,o){Iy.subVectors(n,i).addScalar(.5).multiply(s),r!==void 0?(o1.x=o*Iy.x-r*Iy.y,o1.y=r*Iy.x+o*Iy.y):o1.copy(Iy),n.copy(e),n.x+=o1.x,n.y+=o1.y,n.applyMatrix4(P9)}const WI=new E,X9=new E;let lP=class extends Ae{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(n){super.copy(n,!1);const e=n.levels;for(let i=0,s=e.length;i<s;i++){const r=e[i];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=n.autoUpdate,this}addLevel(n,e=0,i=0){e=Math.abs(e);const s=this.levels;let r;for(r=0;r<s.length&&!(e<s[r].distance);r++);return s.splice(r,0,{distance:e,hysteresis:i,object:n}),this.add(n),this}removeLevel(n){const e=this.levels;for(let i=0;i<e.length;i++)if(e[i].distance===n){const s=e.splice(i,1);return this.remove(s[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(n){const e=this.levels;if(e.length>0){let i,s;for(i=1,s=e.length;i<s;i++){let r=e[i].distance;if(e[i].object.visible&&(r-=r*e[i].hysteresis),n<r)break}return e[i-1].object}return null}raycast(n,e){if(this.levels.length>0){WI.setFromMatrixPosition(this.matrixWorld);const i=n.ray.origin.distanceTo(WI);this.getObjectForDistance(i).raycast(n,e)}}update(n){const e=this.levels;if(e.length>1){WI.setFromMatrixPosition(n.matrixWorld),X9.setFromMatrixPosition(this.matrixWorld);const i=WI.distanceTo(X9)/n.zoom;e[0].object.visible=!0;let s,r;for(s=1,r=e.length;s<r;s++){let o=e[s].distance;if(e[s].object.visible&&(o-=o*e[s].hysteresis),i>=o)e[s-1].object.visible=!1,e[s].object.visible=!0;else break}for(this._currentLevel=s-1;s<r;s++)e[s].object.visible=!1}}toJSON(n){const e=super.toJSON(n);this.autoUpdate===!1&&(e.object.autoUpdate=!1),e.object.levels=[];const i=this.levels;for(let s=0,r=i.length;s<r;s++){const o=i[s];e.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return e}};const D9=new E,z9=new $e,F9=new $e,ige=new E,U9=new de,HI=new E,cP=new Vn,O9=new de,hP=new ya;let Ka=class extends pe{constructor(n,e){super(n,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=dG,this.bindMatrix=new de,this.bindMatrixInverse=new de,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const n=this.geometry;this.boundingBox===null&&(this.boundingBox=new gi),this.boundingBox.makeEmpty();const e=n.getAttribute("position");for(let i=0;i<e.count;i++)this.getVertexPosition(i,HI),this.boundingBox.expandByPoint(HI)}computeBoundingSphere(){const n=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Vn),this.boundingSphere.makeEmpty();const e=n.getAttribute("position");for(let i=0;i<e.count;i++)this.getVertexPosition(i,HI),this.boundingSphere.expandByPoint(HI)}copy(n,e){return super.copy(n,e),this.bindMode=n.bindMode,this.bindMatrix.copy(n.bindMatrix),this.bindMatrixInverse.copy(n.bindMatrixInverse),this.skeleton=n.skeleton,n.boundingBox!==null&&(this.boundingBox=n.boundingBox.clone()),n.boundingSphere!==null&&(this.boundingSphere=n.boundingSphere.clone()),this}raycast(n,e){const i=this.material,s=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),cP.copy(this.boundingSphere),cP.applyMatrix4(s),n.ray.intersectsSphere(cP)!==!1&&(O9.copy(s).invert(),hP.copy(n.ray).applyMatrix4(O9),!(this.boundingBox!==null&&hP.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(n,e,hP)))}getVertexPosition(n,e){return super.getVertexPosition(n,e),this.applyBoneTransform(n,e),e}bind(n,e){this.skeleton=n,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const n=new $e,e=this.geometry.attributes.skinWeight;for(let i=0,s=e.count;i<s;i++){n.fromBufferAttribute(e,i);const r=1/n.manhattanLength();r!==1/0?n.multiplyScalar(r):n.set(1,0,0,0),e.setXYZW(i,n.x,n.y,n.z,n.w)}}updateMatrixWorld(n){super.updateMatrixWorld(n),this.bindMode===dG?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===pW?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(n,e){const i=this.skeleton,s=this.geometry;z9.fromBufferAttribute(s.attributes.skinIndex,n),F9.fromBufferAttribute(s.attributes.skinWeight,n),D9.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let r=0;r<4;r++){const o=F9.getComponent(r);if(o!==0){const a=z9.getComponent(r);U9.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),e.addScaledVector(ige.copy(D9).applyMatrix4(U9),o)}}return e.applyMatrix4(this.bindMatrixInverse)}},Tf=class extends Ae{constructor(){super(),this.isBone=!0,this.type="Bone"}},nr=class extends di{constructor(n=null,e=1,i=1,s,r,o,a,l,c=si,h=si,d,u){super(null,o,a,l,c,h,s,r,d,u),this.isDataTexture=!0,this.image={data:n,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};const Z9=new de,nge=new de;let l1=class ece{constructor(e=[],i=[]){this.uuid=xl(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),i.length===0)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let s=0,r=this.bones.length;s<r;s++)this.boneInverses.push(new de)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){const s=new de;this.bones[e]&&s.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(s)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){const s=this.bones[e];s&&s.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){const s=this.bones[e];s&&(s.parent&&s.parent.isBone?(s.matrix.copy(s.parent.matrixWorld).invert(),s.matrix.multiply(s.matrixWorld)):s.matrix.copy(s.matrixWorld),s.matrix.decompose(s.position,s.quaternion,s.scale))}}update(){const e=this.bones,i=this.boneInverses,s=this.boneMatrices,r=this.boneTexture;for(let o=0,a=e.length;o<a;o++){const l=e[o]?e[o].matrixWorld:nge;Z9.multiplyMatrices(l,i[o]),Z9.toArray(s,o*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new ece(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4);i.set(this.boneMatrices);const s=new nr(i,e,e,_i,en);return s.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=s,this}getBoneByName(e){for(let i=0,s=this.bones.length;i<s;i++){const r=this.bones[i];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let s=0,r=e.bones.length;s<r;s++){const o=e.bones[s];let a=i[o];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),a=new Tf),this.bones.push(a),this.boneInverses.push(new de().fromArray(e.boneInverses[s]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const i=this.bones,s=this.boneInverses;for(let r=0,o=i.length;r<o;r++){const a=i[r];e.bones.push(a.uuid);const l=s[r];e.boneInverses.push(l.toArray())}return e}},Yo=class extends ct{constructor(n,e,i,s=1){super(n,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(n){return super.copy(n),this.meshPerAttribute=n.meshPerAttribute,this}toJSON(){const n=super.toJSON();return n.meshPerAttribute=this.meshPerAttribute,n.isInstancedBufferAttribute=!0,n}};const Ty=new de,W9=new de,QI=[],H9=new gi,sge=new de,c1=new pe,h1=new Vn;let dP=class extends pe{constructor(n,e,i){super(n,e),this.isInstancedMesh=!0,this.instanceMatrix=new Yo(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<i;s++)this.setMatrixAt(s,sge)}computeBoundingBox(){const n=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new gi),n.boundingBox===null&&n.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,Ty),H9.copy(n.boundingBox).applyMatrix4(Ty),this.boundingBox.union(H9)}computeBoundingSphere(){const n=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new Vn),n.boundingSphere===null&&n.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,Ty),h1.copy(n.boundingSphere).applyMatrix4(Ty),this.boundingSphere.union(h1)}copy(n,e){return super.copy(n,e),this.instanceMatrix.copy(n.instanceMatrix),n.morphTexture!==null&&(this.morphTexture=n.morphTexture.clone()),n.instanceColor!==null&&(this.instanceColor=n.instanceColor.clone()),this.count=n.count,n.boundingBox!==null&&(this.boundingBox=n.boundingBox.clone()),n.boundingSphere!==null&&(this.boundingSphere=n.boundingSphere.clone()),this}getColorAt(n,e){e.fromArray(this.instanceColor.array,n*3)}getMatrixAt(n,e){e.fromArray(this.instanceMatrix.array,n*16)}getMorphAt(n,e){const i=e.morphTargetInfluences,s=this.morphTexture.source.data.data,r=i.length+1,o=n*r+1;for(let a=0;a<i.length;a++)i[a]=s[o+a]}raycast(n,e){const i=this.matrixWorld,s=this.count;if(c1.geometry=this.geometry,c1.material=this.material,c1.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),h1.copy(this.boundingSphere),h1.applyMatrix4(i),n.ray.intersectsSphere(h1)!==!1))for(let r=0;r<s;r++){this.getMatrixAt(r,Ty),W9.multiplyMatrices(i,Ty),c1.matrixWorld=W9,c1.raycast(n,QI);for(let o=0,a=QI.length;o<a;o++){const l=QI[o];l.instanceId=r,l.object=this,e.push(l)}QI.length=0}}setColorAt(n,e){this.instanceColor===null&&(this.instanceColor=new Yo(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),e.toArray(this.instanceColor.array,n*3)}setMatrixAt(n,e){e.toArray(this.instanceMatrix.array,n*16)}setMorphAt(n,e){const i=e.morphTargetInfluences,s=i.length+1;this.morphTexture===null&&(this.morphTexture=new nr(new Float32Array(s*this.count),s,this.count,vl,en));const r=this.morphTexture.source.data.data;let o=0;for(let c=0;c<i.length;c++)o+=i[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=s*n;r[l]=a,r.set(i,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}};function rge(n,e){return n.z-e.z}function oge(n,e){return e.z-n.z}class age{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,i,s){const r=this.pool,o=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1,index:-1});const a=r[this.index];o.push(a),this.index++,a.start=e.start,a.count=e.count,a.z=i,a.index=s}reset(){this.list.length=0,this.index=0}}const am=new de,uP=new de,lge=new de,cge=new fe(1,1,1),Q9=new de,pP=new Cf,KI=new gi,Ef=new Vn,d1=new E,K9=new E,hge=new E,mP=new age,jo=new pe,YI=[];function dge(n,e,i=0){const s=e.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==e.array.constructor){const r=n.count;for(let o=0;o<r;o++)for(let a=0;a<s;a++)e.setComponent(o+i,a,n.getComponent(o,a))}else e.array.set(n.array,i*s);e.needsUpdate=!0}class u1 extends pe{get maxInstanceCount(){return this._maxInstanceCount}constructor(e,i,s=i*2,r){super(new Rt,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawInfo=[],this._availableInstanceIds=[],this._drawRanges=[],this._reservedRanges=[],this._bounds=[],this._maxInstanceCount=e,this._maxVertexCount=i,this._maxIndexCount=s,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4),s=new nr(i,e,e,_i,en);this._matricesTexture=s}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const i=new Uint32Array(e*e),s=new nr(i,e,e,KA,Gr);this._indirectTexture=s}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const i=new Float32Array(e*e*4).fill(1),s=new nr(i,e,e,_i,en);s.colorSpace=hi.workingColorSpace,this._colorsTexture=s}_initializeGeometry(e){const i=this.geometry,s=this._maxVertexCount,r=this._maxIndexCount;if(this._geometryInitialized===!1){for(const o in e.attributes){const a=e.getAttribute(o),{array:l,itemSize:c,normalized:h}=a,d=new l.constructor(s*c),u=new ct(d,c,h);i.setAttribute(o,u)}if(e.getIndex()!==null){const o=s>65535?new Uint32Array(r):new Uint16Array(r);i.setIndex(new ct(o,1))}this._geometryInitialized=!0}}_validateGeometry(e){const i=this.geometry;if(!!e.getIndex()!=!!i.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const s in i.attributes){if(!e.hasAttribute(s))throw new Error(`BatchedMesh: Added geometry missing "${s}". All geometries must have consistent attributes.`);const r=e.getAttribute(s),o=i.getAttribute(s);if(r.itemSize!==o.itemSize||r.normalized!==o.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new gi);const e=this.boundingBox,i=this._drawInfo;e.makeEmpty();for(let s=0,r=i.length;s<r;s++){if(i[s].active===!1)continue;const o=i[s].geometryIndex;this.getMatrixAt(s,am),this.getBoundingBoxAt(o,KI).applyMatrix4(am),e.union(KI)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Vn);const e=this.boundingSphere,i=this._drawInfo;e.makeEmpty();for(let s=0,r=i.length;s<r;s++){if(i[s].active===!1)continue;const o=i[s].geometryIndex;this.getMatrixAt(s,am),this.getBoundingSphereAt(o,Ef).applyMatrix4(am),e.union(Ef)}}addInstance(e){if(this._drawInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("BatchedMesh: Maximum item count reached.");const i={visible:!0,active:!0,geometryIndex:e};let s=null;this._availableInstanceIds.length>0?(s=this._availableInstanceIds.pop(),this._drawInfo[s]=i):(s=this._drawInfo.length,this._drawInfo.push(i));const r=this._matricesTexture,o=r.image.data;lge.toArray(o,s*16),r.needsUpdate=!0;const a=this._colorsTexture;return a&&(cge.toArray(a.image.data,s*4),a.needsUpdate=!0),s}addGeometry(e,i=-1,s=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._drawInfo.length>=this._maxInstanceCount)throw new Error("BatchedMesh: Maximum item count reached.");const r={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let o=null;const a=this._reservedRanges,l=this._drawRanges,c=this._bounds;this._geometryCount!==0&&(o=a[a.length-1]),i===-1?r.vertexCount=e.getAttribute("position").count:r.vertexCount=i,o===null?r.vertexStart=0:r.vertexStart=o.vertexStart+o.vertexCount;const h=e.getIndex(),d=h!==null;if(d&&(s===-1?r.indexCount=h.count:r.indexCount=s,o===null?r.indexStart=0:r.indexStart=o.indexStart+o.indexCount),r.indexStart!==-1&&r.indexStart+r.indexCount>this._maxIndexCount||r.vertexStart+r.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const u=this._geometryCount;return this._geometryCount++,a.push(r),l.push({start:d?r.indexStart:r.vertexStart,count:-1}),c.push({boxInitialized:!1,box:new gi,sphereInitialized:!1,sphere:new Vn}),this.setGeometryAt(u,e),u}setGeometryAt(e,i){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(i);const s=this.geometry,r=s.getIndex()!==null,o=s.getIndex(),a=i.getIndex(),l=this._reservedRanges[e];if(r&&a.count>l.indexCount||i.attributes.position.count>l.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const c=l.vertexStart,h=l.vertexCount;for(const g in s.attributes){const f=i.getAttribute(g),A=s.getAttribute(g);dge(f,A,c);const y=f.itemSize;for(let b=f.count,v=h;b<v;b++){const x=c+b;for(let w=0;w<y;w++)A.setComponent(x,w,0)}A.needsUpdate=!0,A.addUpdateRange(c*y,h*y)}if(r){const g=l.indexStart;for(let f=0;f<a.count;f++)o.setX(g+f,c+a.getX(f));for(let f=a.count,A=l.indexCount;f<A;f++)o.setX(g+f,c);o.needsUpdate=!0,o.addUpdateRange(g,l.indexCount)}const d=this._bounds[e];i.boundingBox!==null?(d.box.copy(i.boundingBox),d.boxInitialized=!0):d.boxInitialized=!1,i.boundingSphere!==null?(d.sphere.copy(i.boundingSphere),d.sphereInitialized=!0):d.sphereInitialized=!1;const u=this._drawRanges[e],p=i.getAttribute("position");return u.count=r?a.count:p.count,this._visibilityChanged=!0,e}deleteInstance(e){const i=this._drawInfo;return e>=i.length||i[e].active===!1?this:(i[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this)}getBoundingBoxAt(e,i){if(e>=this._geometryCount)return null;const s=this._bounds[e],r=s.box,o=this.geometry;if(s.boxInitialized===!1){r.makeEmpty();const a=o.index,l=o.attributes.position,c=this._drawRanges[e];for(let h=c.start,d=c.start+c.count;h<d;h++){let u=h;a&&(u=a.getX(u)),r.expandByPoint(d1.fromBufferAttribute(l,u))}s.boxInitialized=!0}return i.copy(r),i}getBoundingSphereAt(e,i){if(e>=this._geometryCount)return null;const s=this._bounds[e],r=s.sphere,o=this.geometry;if(s.sphereInitialized===!1){r.makeEmpty(),this.getBoundingBoxAt(e,KI),KI.getCenter(r.center);const a=o.index,l=o.attributes.position,c=this._drawRanges[e];let h=0;for(let d=c.start,u=c.start+c.count;d<u;d++){let p=d;a&&(p=a.getX(p)),d1.fromBufferAttribute(l,p),h=Math.max(h,r.center.distanceToSquared(d1))}r.radius=Math.sqrt(h),s.sphereInitialized=!0}return i.copy(r),i}setMatrixAt(e,i){const s=this._drawInfo,r=this._matricesTexture,o=this._matricesTexture.image.data;return e>=s.length||s[e].active===!1?this:(i.toArray(o,e*16),r.needsUpdate=!0,this)}getMatrixAt(e,i){const s=this._drawInfo,r=this._matricesTexture.image.data;return e>=s.length||s[e].active===!1?null:i.fromArray(r,e*16)}setColorAt(e,i){this._colorsTexture===null&&this._initColorsTexture();const s=this._colorsTexture,r=this._colorsTexture.image.data,o=this._drawInfo;return e>=o.length||o[e].active===!1?this:(i.toArray(r,e*4),s.needsUpdate=!0,this)}getColorAt(e,i){const s=this._colorsTexture.image.data,r=this._drawInfo;return e>=r.length||r[e].active===!1?null:i.fromArray(s,e*4)}setVisibleAt(e,i){const s=this._drawInfo;return e>=s.length||s[e].active===!1||s[e].visible===i?this:(s[e].visible=i,this._visibilityChanged=!0,this)}getVisibleAt(e){const i=this._drawInfo;return e>=i.length||i[e].active===!1?!1:i[e].visible}setGeometryIdAt(e,i){const s=this._drawInfo;return e>=s.length||s[e].active===!1||i<0||i>=this._geometryCount?null:(s[e].geometryIndex=i,this)}getGeometryIdAt(e){const i=this._drawInfo;return e>=i.length||i[e].active===!1?-1:i[e].geometryIndex}getGeometryRangeAt(e,i={}){if(e<0||e>=this._geometryCount)return null;const s=this._drawRanges[e];return i.start=s.start,i.count=s.count,i}raycast(e,i){const s=this._drawInfo,r=this._drawRanges,o=this.matrixWorld,a=this.geometry;jo.material=this.material,jo.geometry.index=a.index,jo.geometry.attributes=a.attributes,jo.geometry.boundingBox===null&&(jo.geometry.boundingBox=new gi),jo.geometry.boundingSphere===null&&(jo.geometry.boundingSphere=new Vn);for(let l=0,c=s.length;l<c;l++){if(!s[l].visible||!s[l].active)continue;const h=s[l].geometryIndex,d=r[h];jo.geometry.setDrawRange(d.start,d.count),this.getMatrixAt(l,jo.matrixWorld).premultiply(o),this.getBoundingBoxAt(h,jo.geometry.boundingBox),this.getBoundingSphereAt(h,jo.geometry.boundingSphere),jo.raycast(e,YI);for(let u=0,p=YI.length;u<p;u++){const g=YI[u];g.object=this,g.batchId=l,i.push(g)}YI.length=0}jo.material=null,jo.geometry.index=null,jo.geometry.attributes={},jo.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(i=>({...i})),this._reservedRanges=e._reservedRanges.map(i=>({...i})),this._drawInfo=e._drawInfo.map(i=>({...i})),this._bounds=e._bounds.map(i=>({boxInitialized:i.boxInitialized,box:i.box.clone(),sphereInitialized:i.sphereInitialized,sphere:i.sphere.clone()})),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,i,s,r,o){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=r.getIndex(),l=a===null?1:a.array.BYTES_PER_ELEMENT,c=this._drawInfo,h=this._multiDrawStarts,d=this._multiDrawCounts,u=this._drawRanges,p=this.perObjectFrustumCulled,g=this._indirectTexture,f=g.image.data;p&&(Q9.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse).multiply(this.matrixWorld),pP.setFromProjectionMatrix(Q9,e.coordinateSystem));let A=0;if(this.sortObjects){uP.copy(this.matrixWorld).invert(),d1.setFromMatrixPosition(s.matrixWorld).applyMatrix4(uP),K9.set(0,0,-1).transformDirection(s.matrixWorld).transformDirection(uP);for(let v=0,x=c.length;v<x;v++)if(c[v].visible&&c[v].active){const w=c[v].geometryIndex;this.getMatrixAt(v,am),this.getBoundingSphereAt(w,Ef).applyMatrix4(am);let C=!1;if(p&&(C=!pP.intersectsSphere(Ef)),!C){const S=hge.subVectors(Ef.center,d1).dot(K9);mP.push(u[w],S,v)}}const y=mP.list,b=this.customSort;b===null?y.sort(o.transparent?oge:rge):b.call(this,y,s);for(let v=0,x=y.length;v<x;v++){const w=y[v];h[A]=w.start*l,d[A]=w.count,f[A]=w.index,A++}mP.reset()}else for(let y=0,b=c.length;y<b;y++)if(c[y].visible&&c[y].active){const v=c[y].geometryIndex;let x=!1;if(p&&(this.getMatrixAt(y,am),this.getBoundingSphereAt(v,Ef).applyMatrix4(am),x=!pP.intersectsSphere(Ef)),!x){const w=u[v];h[A]=w.start*l,d[A]=w.count,f[A]=y,A++}}g.needsUpdate=!0,this._multiDrawCount=A,this._visibilityChanged=!1}onBeforeShadow(e,i,s,r,o,a){this.onBeforeRender(e,null,r,o,a)}}let Cn=class extends ti{constructor(n){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new fe(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.linewidth=n.linewidth,this.linecap=n.linecap,this.linejoin=n.linejoin,this.fog=n.fog,this}};const jI=new E,JI=new E,Y9=new de,p1=new ya,qI=new Vn,gP=new E,j9=new E;let is=class extends Ae{constructor(n=new Rt,e=new Cn){super(),this.isLine=!0,this.type="Line",this.geometry=n,this.material=e,this.updateMorphTargets()}copy(n,e){return super.copy(n,e),this.material=Array.isArray(n.material)?n.material.slice():n.material,this.geometry=n.geometry,this}computeLineDistances(){const n=this.geometry;if(n.index===null){const e=n.attributes.position,i=[0];for(let s=1,r=e.count;s<r;s++)jI.fromBufferAttribute(e,s-1),JI.fromBufferAttribute(e,s),i[s]=i[s-1],i[s]+=jI.distanceTo(JI);n.setAttribute("lineDistance",new dt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(n,e){const i=this.geometry,s=this.matrixWorld,r=n.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),qI.copy(i.boundingSphere),qI.applyMatrix4(s),qI.radius+=r,n.ray.intersectsSphere(qI)===!1)return;Y9.copy(s).invert(),p1.copy(n.ray).applyMatrix4(Y9);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=this.isLineSegments?2:1,h=i.index,d=i.attributes.position;if(h!==null){const u=Math.max(0,o.start),p=Math.min(h.count,o.start+o.count);for(let g=u,f=p-1;g<f;g+=c){const A=h.getX(g),y=h.getX(g+1),b=$I(this,n,p1,l,A,y);b&&e.push(b)}if(this.isLineLoop){const g=h.getX(p-1),f=h.getX(u),A=$I(this,n,p1,l,g,f);A&&e.push(A)}}else{const u=Math.max(0,o.start),p=Math.min(d.count,o.start+o.count);for(let g=u,f=p-1;g<f;g+=c){const A=$I(this,n,p1,l,g,g+1);A&&e.push(A)}if(this.isLineLoop){const g=$I(this,n,p1,l,p-1,u);g&&e.push(g)}}}updateMorphTargets(){const n=this.geometry.morphAttributes,e=Object.keys(n);if(e.length>0){const i=n[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=i.length;s<r;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}};function $I(n,e,i,s,r,o){const a=n.geometry.attributes.position;if(jI.fromBufferAttribute(a,r),JI.fromBufferAttribute(a,o),i.distanceSqToSegment(jI,JI,gP,j9)>s)return;gP.applyMatrix4(n.matrixWorld);const l=e.ray.origin.distanceTo(gP);if(!(l<e.near||l>e.far))return{distance:l,point:j9.clone().applyMatrix4(n.matrixWorld),index:r,face:null,faceIndex:null,barycoord:null,object:n}}const J9=new E,q9=new E;let Jo=class extends is{constructor(n,e){super(n,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const n=this.geometry;if(n.index===null){const e=n.attributes.position,i=[];for(let s=0,r=e.count;s<r;s+=2)J9.fromBufferAttribute(e,s),q9.fromBufferAttribute(e,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+J9.distanceTo(q9);n.setAttribute("lineDistance",new dt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},fP=class extends is{constructor(n,e){super(n,e),this.isLineLoop=!0,this.type="LineLoop"}},rd=class extends ti{constructor(n){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new fe(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.alphaMap=n.alphaMap,this.size=n.size,this.sizeAttenuation=n.sizeAttenuation,this.fog=n.fog,this}};const $9=new de,AP=new ya,eT=new Vn,tT=new E;let Ey=class extends Ae{constructor(n=new Rt,e=new rd){super(),this.isPoints=!0,this.type="Points",this.geometry=n,this.material=e,this.updateMorphTargets()}copy(n,e){return super.copy(n,e),this.material=Array.isArray(n.material)?n.material.slice():n.material,this.geometry=n.geometry,this}raycast(n,e){const i=this.geometry,s=this.matrixWorld,r=n.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),eT.copy(i.boundingSphere),eT.applyMatrix4(s),eT.radius+=r,n.ray.intersectsSphere(eT)===!1)return;$9.copy(s).invert(),AP.copy(n.ray).applyMatrix4($9);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,h=i.attributes.position;if(c!==null){const d=Math.max(0,o.start),u=Math.min(c.count,o.start+o.count);for(let p=d,g=u;p<g;p++){const f=c.getX(p);tT.fromBufferAttribute(h,f),eH(tT,f,l,s,n,e,this)}}else{const d=Math.max(0,o.start),u=Math.min(h.count,o.start+o.count);for(let p=d,g=u;p<g;p++)tT.fromBufferAttribute(h,p),eH(tT,p,l,s,n,e,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,e=Object.keys(n);if(e.length>0){const i=n[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=i.length;s<r;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}};function eH(n,e,i,s,r,o,a){const l=AP.distanceSqToPoint(n);if(l<i){const c=new E;AP.closestPointToPoint(n,c),c.applyMatrix4(s);const h=r.ray.origin.distanceTo(c);if(h<r.near||h>r.far)return;o.push({distance:h,distanceToRay:Math.sqrt(l),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:a})}}class tH extends di{constructor(e,i,s,r,o,a,l,c,h){super(e,i,s,r,o,a,l,c,h),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:Wt,this.magFilter=o!==void 0?o:Wt,this.generateMipmaps=!1;const d=this;function u(){d.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class yP extends di{constructor(e,i){super({width:e,height:i}),this.isFramebufferTexture=!0,this.magFilter=si,this.minFilter=si,this.generateMipmaps=!1,this.needsUpdate=!0}}let od=class extends di{constructor(n,e,i,s,r,o,a,l,c,h,d,u){super(null,o,a,l,c,h,s,r,d,u),this.isCompressedTexture=!0,this.image={width:e,height:i},this.mipmaps=n,this.flipY=!1,this.generateMipmaps=!1}},iH=class extends od{constructor(n,e,i,s,r,o){super(n,e,i,r,o),this.isCompressedArrayTexture=!0,this.image.depth=s,this.wrapR=Wo,this.layerUpdates=new Set}addLayerUpdate(n){this.layerUpdates.add(n)}clearLayerUpdates(){this.layerUpdates.clear()}},bP=class extends od{constructor(n,e,i){super(void 0,n[0].width,n[0].height,e,i,bl),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=n}};class vP extends di{constructor(e,i,s,r,o,a,l,c,h){super(e,i,s,r,o,a,l,c,h),this.isCanvasTexture=!0,this.needsUpdate=!0}}class bc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,i){const s=this.getUtoTmapping(e);return this.getPoint(s,i)}getPoints(e=5){const i=[];for(let s=0;s<=e;s++)i.push(this.getPoint(s/e));return i}getSpacedPoints(e=5){const i=[];for(let s=0;s<=e;s++)i.push(this.getPointAt(s/e));return i}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let s,r=this.getPoint(0),o=0;i.push(0);for(let a=1;a<=e;a++)s=this.getPoint(a/e),o+=s.distanceTo(r),i.push(o),r=s;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,i){const s=this.getLengths();let r=0;const o=s.length;let a;i?a=i:a=e*s[o-1];let l=0,c=o-1,h;for(;l<=c;)if(r=Math.floor(l+(c-l)/2),h=s[r]-a,h<0)l=r+1;else if(h>0)c=r-1;else{c=r;break}if(r=c,s[r]===a)return r/(o-1);const d=s[r],u=s[r+1]-d,p=(a-d)/u;return(r+p)/(o-1)}getTangent(e,i){let s=e-1e-4,r=e+1e-4;s<0&&(s=0),r>1&&(r=1);const o=this.getPoint(s),a=this.getPoint(r),l=i||(o.isVector2?new Q:new E);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,i){const s=this.getUtoTmapping(e);return this.getTangent(s,i)}computeFrenetFrames(e,i){const s=new E,r=[],o=[],a=[],l=new E,c=new de;for(let g=0;g<=e;g++){const f=g/e;r[g]=this.getTangentAt(f,new E)}o[0]=new E,a[0]=new E;let h=Number.MAX_VALUE;const d=Math.abs(r[0].x),u=Math.abs(r[0].y),p=Math.abs(r[0].z);d<=h&&(h=d,s.set(1,0,0)),u<=h&&(h=u,s.set(0,1,0)),p<=h&&s.set(0,0,1),l.crossVectors(r[0],s).normalize(),o[0].crossVectors(r[0],l),a[0].crossVectors(r[0],o[0]);for(let g=1;g<=e;g++){if(o[g]=o[g-1].clone(),a[g]=a[g-1].clone(),l.crossVectors(r[g-1],r[g]),l.length()>Number.EPSILON){l.normalize();const f=Math.acos(Ts(r[g-1].dot(r[g]),-1,1));o[g].applyMatrix4(c.makeRotationAxis(l,f))}a[g].crossVectors(r[g],o[g])}if(i===!0){let g=Math.acos(Ts(o[0].dot(o[e]),-1,1));g/=e,r[0].dot(l.crossVectors(o[0],o[e]))>0&&(g=-g);for(let f=1;f<=e;f++)o[f].applyMatrix4(c.makeRotationAxis(r[f],g*f)),a[f].crossVectors(r[f],o[f])}return{tangents:r,normals:o,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class iT extends bc{constructor(e=0,i=0,s=1,r=1,o=0,a=Math.PI*2,l=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=i,this.xRadius=s,this.yRadius=r,this.aStartAngle=o,this.aEndAngle=a,this.aClockwise=l,this.aRotation=c}getPoint(e,i=new Q){const s=i,r=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const a=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=r;for(;o>r;)o-=r;o<Number.EPSILON&&(a?o=0:o=r),this.aClockwise===!0&&!a&&(o===r?o=-r:o=o-r);const l=this.aStartAngle+e*o;let c=this.aX+this.xRadius*Math.cos(l),h=this.aY+this.yRadius*Math.sin(l);if(this.aRotation!==0){const d=Math.cos(this.aRotation),u=Math.sin(this.aRotation),p=c-this.aX,g=h-this.aY;c=p*d-g*u+this.aX,h=p*u+g*d+this.aY}return s.set(c,h)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class nH extends iT{constructor(e,i,s,r,o,a){super(e,i,s,s,r,o,a),this.isArcCurve=!0,this.type="ArcCurve"}}function xP(){let n=0,e=0,i=0,s=0;function r(o,a,l,c){n=o,e=l,i=-3*o+3*a-2*l-c,s=2*o-2*a+l+c}return{initCatmullRom:function(o,a,l,c,h){r(a,l,h*(l-o),h*(c-a))},initNonuniformCatmullRom:function(o,a,l,c,h,d,u){let p=(a-o)/h-(l-o)/(h+d)+(l-a)/d,g=(l-a)/d-(c-a)/(d+u)+(c-l)/u;p*=d,g*=d,r(a,l,p,g)},calc:function(o){const a=o*o,l=a*o;return n+e*o+i*a+s*l}}}const nT=new E,wP=new xP,CP=new xP,SP=new xP;class sH extends bc{constructor(e=[],i=!1,s="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=i,this.curveType=s,this.tension=r}getPoint(e,i=new E){const s=i,r=this.points,o=r.length,a=(o-(this.closed?0:1))*e;let l=Math.floor(a),c=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/o)+1)*o:c===0&&l===o-1&&(l=o-2,c=1);let h,d;this.closed||l>0?h=r[(l-1)%o]:(nT.subVectors(r[0],r[1]).add(r[0]),h=nT);const u=r[l%o],p=r[(l+1)%o];if(this.closed||l+2<o?d=r[(l+2)%o]:(nT.subVectors(r[o-1],r[o-2]).add(r[o-1]),d=nT),this.curveType==="centripetal"||this.curveType==="chordal"){const g=this.curveType==="chordal"?.5:.25;let f=Math.pow(h.distanceToSquared(u),g),A=Math.pow(u.distanceToSquared(p),g),y=Math.pow(p.distanceToSquared(d),g);A<1e-4&&(A=1),f<1e-4&&(f=A),y<1e-4&&(y=A),wP.initNonuniformCatmullRom(h.x,u.x,p.x,d.x,f,A,y),CP.initNonuniformCatmullRom(h.y,u.y,p.y,d.y,f,A,y),SP.initNonuniformCatmullRom(h.z,u.z,p.z,d.z,f,A,y)}else this.curveType==="catmullrom"&&(wP.initCatmullRom(h.x,u.x,p.x,d.x,this.tension),CP.initCatmullRom(h.y,u.y,p.y,d.y,this.tension),SP.initCatmullRom(h.z,u.z,p.z,d.z,this.tension));return s.set(wP.calc(c),CP.calc(c),SP.calc(c)),s}copy(e){super.copy(e),this.points=[];for(let i=0,s=e.points.length;i<s;i++){const r=e.points[i];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,s=this.points.length;i<s;i++){const r=this.points[i];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,s=e.points.length;i<s;i++){const r=e.points[i];this.points.push(new E().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function rH(n,e,i,s,r){const o=(s-e)*.5,a=(r-i)*.5,l=n*n,c=n*l;return(2*i-2*s+o+a)*c+(-3*i+3*s-2*o-a)*l+o*n+i}function uge(n,e){const i=1-n;return i*i*e}function pge(n,e){return 2*(1-n)*n*e}function mge(n,e){return n*n*e}function m1(n,e,i,s){return uge(n,e)+pge(n,i)+mge(n,s)}function gge(n,e){const i=1-n;return i*i*i*e}function fge(n,e){const i=1-n;return 3*i*i*n*e}function Age(n,e){return 3*(1-n)*n*n*e}function yge(n,e){return n*n*n*e}function g1(n,e,i,s,r){return gge(n,e)+fge(n,i)+Age(n,s)+yge(n,r)}class _P extends bc{constructor(e=new Q,i=new Q,s=new Q,r=new Q){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=i,this.v2=s,this.v3=r}getPoint(e,i=new Q){const s=i,r=this.v0,o=this.v1,a=this.v2,l=this.v3;return s.set(g1(e,r.x,o.x,a.x,l.x),g1(e,r.y,o.y,a.y,l.y)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class oH extends bc{constructor(e=new E,i=new E,s=new E,r=new E){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=i,this.v2=s,this.v3=r}getPoint(e,i=new E){const s=i,r=this.v0,o=this.v1,a=this.v2,l=this.v3;return s.set(g1(e,r.x,o.x,a.x,l.x),g1(e,r.y,o.y,a.y,l.y),g1(e,r.z,o.z,a.z,l.z)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class MP extends bc{constructor(e=new Q,i=new Q){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=i}getPoint(e,i=new Q){const s=i;return e===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(e).add(this.v1)),s}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new Q){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class aH extends bc{constructor(e=new E,i=new E){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=i}getPoint(e,i=new E){const s=i;return e===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(e).add(this.v1)),s}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new E){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class IP extends bc{constructor(e=new Q,i=new Q,s=new Q){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=i,this.v2=s}getPoint(e,i=new Q){const s=i,r=this.v0,o=this.v1,a=this.v2;return s.set(m1(e,r.x,o.x,a.x),m1(e,r.y,o.y,a.y)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class TP extends bc{constructor(e=new E,i=new E,s=new E){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=i,this.v2=s}getPoint(e,i=new E){const s=i,r=this.v0,o=this.v1,a=this.v2;return s.set(m1(e,r.x,o.x,a.x),m1(e,r.y,o.y,a.y),m1(e,r.z,o.z,a.z)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class EP extends bc{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,i=new Q){const s=i,r=this.points,o=(r.length-1)*e,a=Math.floor(o),l=o-a,c=r[a===0?a:a-1],h=r[a],d=r[a>r.length-2?r.length-1:a+1],u=r[a>r.length-3?r.length-1:a+2];return s.set(rH(l,c.x,h.x,d.x,u.x),rH(l,c.y,h.y,d.y,u.y)),s}copy(e){super.copy(e),this.points=[];for(let i=0,s=e.points.length;i<s;i++){const r=e.points[i];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,s=this.points.length;i<s;i++){const r=this.points[i];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,s=e.points.length;i<s;i++){const r=e.points[i];this.points.push(new Q().fromArray(r))}return this}}var sT=Object.freeze({__proto__:null,ArcCurve:nH,CatmullRomCurve3:sH,CubicBezierCurve:_P,CubicBezierCurve3:oH,EllipseCurve:iT,LineCurve:MP,LineCurve3:aH,QuadraticBezierCurve:IP,QuadraticBezierCurve3:TP,SplineCurve:EP});class lH extends bc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(i)){const s=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new sT[s](i,e))}return this}getPoint(e,i){const s=e*this.getLength(),r=this.getCurveLengths();let o=0;for(;o<r.length;){if(r[o]>=s){const a=r[o]-s,l=this.curves[o],c=l.getLength(),h=c===0?0:1-a/c;return l.getPointAt(h,i)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let i=0;for(let s=0,r=this.curves.length;s<r;s++)i+=this.curves[s].getLength(),e.push(i);return this.cacheLengths=e,e}getSpacedPoints(e=40){const i=[];for(let s=0;s<=e;s++)i.push(this.getPoint(s/e));return this.autoClose&&i.push(i[0]),i}getPoints(e=12){const i=[];let s;for(let r=0,o=this.curves;r<o.length;r++){const a=o[r],l=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,c=a.getPoints(l);for(let h=0;h<c.length;h++){const d=c[h];s&&s.equals(d)||(i.push(d),s=d)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(e){super.copy(e),this.curves=[];for(let i=0,s=e.curves.length;i<s;i++){const r=e.curves[i];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let i=0,s=this.curves.length;i<s;i++){const r=this.curves[i];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let i=0,s=e.curves.length;i<s;i++){const r=e.curves[i];this.curves.push(new sT[r.type]().fromJSON(r))}return this}}class f1 extends lH{constructor(e){super(),this.type="Path",this.currentPoint=new Q,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let i=1,s=e.length;i<s;i++)this.lineTo(e[i].x,e[i].y);return this}moveTo(e,i){return this.currentPoint.set(e,i),this}lineTo(e,i){const s=new MP(this.currentPoint.clone(),new Q(e,i));return this.curves.push(s),this.currentPoint.set(e,i),this}quadraticCurveTo(e,i,s,r){const o=new IP(this.currentPoint.clone(),new Q(e,i),new Q(s,r));return this.curves.push(o),this.currentPoint.set(s,r),this}bezierCurveTo(e,i,s,r,o,a){const l=new _P(this.currentPoint.clone(),new Q(e,i),new Q(s,r),new Q(o,a));return this.curves.push(l),this.currentPoint.set(o,a),this}splineThru(e){const i=[this.currentPoint.clone()].concat(e),s=new EP(i);return this.curves.push(s),this.currentPoint.copy(e[e.length-1]),this}arc(e,i,s,r,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absarc(e+l,i+c,s,r,o,a),this}absarc(e,i,s,r,o,a){return this.absellipse(e,i,s,s,r,o,a),this}ellipse(e,i,s,r,o,a,l,c){const h=this.currentPoint.x,d=this.currentPoint.y;return this.absellipse(e+h,i+d,s,r,o,a,l,c),this}absellipse(e,i,s,r,o,a,l,c){const h=new iT(e,i,s,r,o,a,l,c);if(this.curves.length>0){const u=h.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(h);const d=h.getPoint(1);return this.currentPoint.copy(d),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Y_ extends Rt{constructor(e=[new Q(0,-.5),new Q(.5,0),new Q(0,.5)],i=12,s=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:i,phiStart:s,phiLength:r},i=Math.floor(i),r=Ts(r,0,Math.PI*2);const o=[],a=[],l=[],c=[],h=[],d=1/i,u=new E,p=new Q,g=new E,f=new E,A=new E;let y=0,b=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:y=e[v+1].x-e[v].x,b=e[v+1].y-e[v].y,g.x=b*1,g.y=-y,g.z=b*0,A.copy(g),g.normalize(),c.push(g.x,g.y,g.z);break;case e.length-1:c.push(A.x,A.y,A.z);break;default:y=e[v+1].x-e[v].x,b=e[v+1].y-e[v].y,g.x=b*1,g.y=-y,g.z=b*0,f.copy(g),g.x+=A.x,g.y+=A.y,g.z+=A.z,g.normalize(),c.push(g.x,g.y,g.z),A.copy(f)}for(let v=0;v<=i;v++){const x=s+v*d*r,w=Math.sin(x),C=Math.cos(x);for(let S=0;S<=e.length-1;S++){u.x=e[S].x*w,u.y=e[S].y,u.z=e[S].x*C,a.push(u.x,u.y,u.z),p.x=v/i,p.y=S/(e.length-1),l.push(p.x,p.y);const _=c[3*S+0]*w,I=c[3*S+1],B=c[3*S+0]*C;h.push(_,I,B)}}for(let v=0;v<i;v++)for(let x=0;x<e.length-1;x++){const w=x+v*e.length,C=w,S=w+e.length,_=w+e.length+1,I=w+1;o.push(C,S,I),o.push(_,I,S)}this.setIndex(o),this.setAttribute("position",new dt(a,3)),this.setAttribute("uv",new dt(l,2)),this.setAttribute("normal",new dt(h,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Y_(e.points,e.segments,e.phiStart,e.phiLength)}}class Pk extends Y_{constructor(e=1,i=1,s=4,r=8){const o=new f1;o.absarc(0,-i/2,e,Math.PI*1.5,0),o.absarc(0,i/2,e,0,Math.PI*.5),super(o.getPoints(s),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:i,capSegments:s,radialSegments:r}}static fromJSON(e){return new Pk(e.radius,e.length,e.capSegments,e.radialSegments)}}class Nk extends Rt{constructor(e=1,i=32,s=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:i,thetaStart:s,thetaLength:r},i=Math.max(3,i);const o=[],a=[],l=[],c=[],h=new E,d=new Q;a.push(0,0,0),l.push(0,0,1),c.push(.5,.5);for(let u=0,p=3;u<=i;u++,p+=3){const g=s+u/i*r;h.x=e*Math.cos(g),h.y=e*Math.sin(g),a.push(h.x,h.y,h.z),l.push(0,0,1),d.x=(a[p]/e+1)/2,d.y=(a[p+1]/e+1)/2,c.push(d.x,d.y)}for(let u=1;u<=i;u++)o.push(u,u+1,0);this.setIndex(o),this.setAttribute("position",new dt(a,3)),this.setAttribute("normal",new dt(l,3)),this.setAttribute("uv",new dt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Nk(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class js extends Rt{constructor(e=1,i=1,s=1,r=32,o=1,a=!1,l=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:i,height:s,radialSegments:r,heightSegments:o,openEnded:a,thetaStart:l,thetaLength:c};const h=this;r=Math.floor(r),o=Math.floor(o);const d=[],u=[],p=[],g=[];let f=0;const A=[],y=s/2;let b=0;v(),a===!1&&(e>0&&x(!0),i>0&&x(!1)),this.setIndex(d),this.setAttribute("position",new dt(u,3)),this.setAttribute("normal",new dt(p,3)),this.setAttribute("uv",new dt(g,2));function v(){const w=new E,C=new E;let S=0;const _=(i-e)/s;for(let I=0;I<=o;I++){const B=[],M=I/o,R=M*(i-e)+e;for(let k=0;k<=r;k++){const G=k/r,X=G*c+l,F=Math.sin(X),z=Math.cos(X);C.x=R*F,C.y=-M*s+y,C.z=R*z,u.push(C.x,C.y,C.z),w.set(F,_,z).normalize(),p.push(w.x,w.y,w.z),g.push(G,1-M),B.push(f++)}A.push(B)}for(let I=0;I<r;I++)for(let B=0;B<o;B++){const M=A[B][I],R=A[B+1][I],k=A[B+1][I+1],G=A[B][I+1];e>0&&(d.push(M,R,G),S+=3),i>0&&(d.push(R,k,G),S+=3)}h.addGroup(b,S,0),b+=S}function x(w){const C=f,S=new Q,_=new E;let I=0;const B=w===!0?e:i,M=w===!0?1:-1;for(let k=1;k<=r;k++)u.push(0,y*M,0),p.push(0,M,0),g.push(.5,.5),f++;const R=f;for(let k=0;k<=r;k++){const G=k/r*c+l,X=Math.cos(G),F=Math.sin(G);_.x=B*F,_.y=y*M,_.z=B*X,u.push(_.x,_.y,_.z),p.push(0,M,0),S.x=X*.5+.5,S.y=F*.5*M+.5,g.push(S.x,S.y),f++}for(let k=0;k<r;k++){const G=C+k,X=R+k;w===!0?d.push(X,X+1,G):d.push(X+1,X,G),I+=3}h.addGroup(b,I,w===!0?1:2),b+=I}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new js(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Vk extends js{constructor(e=1,i=1,s=32,r=1,o=!1,a=0,l=Math.PI*2){super(0,e,i,s,r,o,a,l),this.type="ConeGeometry",this.parameters={radius:e,height:i,radialSegments:s,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l}}static fromJSON(e){return new Vk(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class jg extends Rt{constructor(e=[],i=[],s=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:i,radius:s,detail:r};const o=[],a=[];l(r),h(s),d(),this.setAttribute("position",new dt(o,3)),this.setAttribute("normal",new dt(o.slice(),3)),this.setAttribute("uv",new dt(a,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function l(v){const x=new E,w=new E,C=new E;for(let S=0;S<i.length;S+=3)g(i[S+0],x),g(i[S+1],w),g(i[S+2],C),c(x,w,C,v)}function c(v,x,w,C){const S=C+1,_=[];for(let I=0;I<=S;I++){_[I]=[];const B=v.clone().lerp(w,I/S),M=x.clone().lerp(w,I/S),R=S-I;for(let k=0;k<=R;k++)k===0&&I===S?_[I][k]=B:_[I][k]=B.clone().lerp(M,k/R)}for(let I=0;I<S;I++)for(let B=0;B<2*(S-I)-1;B++){const M=Math.floor(B/2);B%2===0?(p(_[I][M+1]),p(_[I+1][M]),p(_[I][M])):(p(_[I][M+1]),p(_[I+1][M+1]),p(_[I+1][M]))}}function h(v){const x=new E;for(let w=0;w<o.length;w+=3)x.x=o[w+0],x.y=o[w+1],x.z=o[w+2],x.normalize().multiplyScalar(v),o[w+0]=x.x,o[w+1]=x.y,o[w+2]=x.z}function d(){const v=new E;for(let x=0;x<o.length;x+=3){v.x=o[x+0],v.y=o[x+1],v.z=o[x+2];const w=y(v)/2/Math.PI+.5,C=b(v)/Math.PI+.5;a.push(w,1-C)}f(),u()}function u(){for(let v=0;v<a.length;v+=6){const x=a[v+0],w=a[v+2],C=a[v+4],S=Math.max(x,w,C),_=Math.min(x,w,C);S>.9&&_<.1&&(x<.2&&(a[v+0]+=1),w<.2&&(a[v+2]+=1),C<.2&&(a[v+4]+=1))}}function p(v){o.push(v.x,v.y,v.z)}function g(v,x){const w=v*3;x.x=e[w+0],x.y=e[w+1],x.z=e[w+2]}function f(){const v=new E,x=new E,w=new E,C=new E,S=new Q,_=new Q,I=new Q;for(let B=0,M=0;B<o.length;B+=9,M+=6){v.set(o[B+0],o[B+1],o[B+2]),x.set(o[B+3],o[B+4],o[B+5]),w.set(o[B+6],o[B+7],o[B+8]),S.set(a[M+0],a[M+1]),_.set(a[M+2],a[M+3]),I.set(a[M+4],a[M+5]),C.copy(v).add(x).add(w).divideScalar(3);const R=y(C);A(S,M+0,v,R),A(_,M+2,x,R),A(I,M+4,w,R)}}function A(v,x,w,C){C<0&&v.x===1&&(a[x]=v.x-1),w.x===0&&w.z===0&&(a[x]=C/2/Math.PI+.5)}function y(v){return Math.atan2(v.z,-v.x)}function b(v){return Math.atan2(-v.y,Math.sqrt(v.x*v.x+v.z*v.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new jg(e.vertices,e.indices,e.radius,e.details)}}class Xk extends jg{constructor(e=1,i=0){const s=(1+Math.sqrt(5))/2,r=1/s,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-s,0,-r,s,0,r,-s,0,r,s,-r,-s,0,-r,s,0,r,-s,0,r,s,0,-s,0,-r,s,0,-r,-s,0,r,s,0,r],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(o,a,e,i),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new Xk(e.radius,e.detail)}}const rT=new E,oT=new E,RP=new E,aT=new $s;class LP extends Rt{constructor(e=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:i},e!==null){const s=Math.pow(10,4),r=Math.cos(ff*i),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],h=["a","b","c"],d=new Array(3),u={},p=[];for(let g=0;g<l;g+=3){o?(c[0]=o.getX(g),c[1]=o.getX(g+1),c[2]=o.getX(g+2)):(c[0]=g,c[1]=g+1,c[2]=g+2);const{a:f,b:A,c:y}=aT;if(f.fromBufferAttribute(a,c[0]),A.fromBufferAttribute(a,c[1]),y.fromBufferAttribute(a,c[2]),aT.getNormal(RP),d[0]=`${Math.round(f.x*s)},${Math.round(f.y*s)},${Math.round(f.z*s)}`,d[1]=`${Math.round(A.x*s)},${Math.round(A.y*s)},${Math.round(A.z*s)}`,d[2]=`${Math.round(y.x*s)},${Math.round(y.y*s)},${Math.round(y.z*s)}`,!(d[0]===d[1]||d[1]===d[2]||d[2]===d[0]))for(let b=0;b<3;b++){const v=(b+1)%3,x=d[b],w=d[v],C=aT[h[b]],S=aT[h[v]],_=`${x}_${w}`,I=`${w}_${x}`;I in u&&u[I]?(RP.dot(u[I].normal)<=r&&(p.push(C.x,C.y,C.z),p.push(S.x,S.y,S.z)),u[I]=null):_ in u||(u[_]={index0:c[b],index1:c[v],normal:RP.clone()})}}for(const g in u)if(u[g]){const{index0:f,index1:A}=u[g];rT.fromBufferAttribute(a,f),oT.fromBufferAttribute(a,A),p.push(rT.x,rT.y,rT.z),p.push(oT.x,oT.y,oT.z)}this.setAttribute("position",new dt(p,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class lm extends f1{constructor(e){super(e),this.uuid=xl(),this.type="Shape",this.holes=[]}getPointsHoles(e){const i=[];for(let s=0,r=this.holes.length;s<r;s++)i[s]=this.holes[s].getPoints(e);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let i=0,s=e.holes.length;i<s;i++){const r=e.holes[i];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let i=0,s=this.holes.length;i<s;i++){const r=this.holes[i];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let i=0,s=e.holes.length;i<s;i++){const r=e.holes[i];this.holes.push(new f1().fromJSON(r))}return this}}const bge={triangulate:function(n,e,i=2){const s=e&&e.length,r=s?e[0]*i:n.length;let o=cH(n,0,r,i,!0);const a=[];if(!o||o.next===o.prev)return a;let l,c,h,d,u,p,g;if(s&&(o=Sge(n,e,o,i)),n.length>80*i){l=h=n[0],c=d=n[1];for(let f=i;f<r;f+=i)u=n[f],p=n[f+1],u<l&&(l=u),p<c&&(c=p),u>h&&(h=u),p>d&&(d=p);g=Math.max(h-l,d-c),g=g!==0?32767/g:0}return A1(o,a,i,l,c,g,0),a}};function cH(n,e,i,s,r){let o,a;if(r===Pge(n,e,i,s)>0)for(o=e;o<i;o+=s)a=uH(o,n[o],n[o+1],a);else for(o=i-s;o>=e;o-=s)a=uH(o,n[o],n[o+1],a);return a&&lT(a,a.next)&&(b1(a),a=a.next),a}function Rf(n,e){if(!n)return n;e||(e=n);let i=n,s;do if(s=!1,!i.steiner&&(lT(i,i.next)||gs(i.prev,i,i.next)===0)){if(b1(i),i=e=i.prev,i===i.next)break;s=!0}else i=i.next;while(s||i!==e);return e}function A1(n,e,i,s,r,o,a){if(!n)return;!a&&o&&Ege(n,s,r,o);let l=n,c,h;for(;n.prev!==n.next;){if(c=n.prev,h=n.next,o?xge(n,s,r,o):vge(n)){e.push(c.i/i|0),e.push(n.i/i|0),e.push(h.i/i|0),b1(n),n=h.next,l=h.next;continue}if(n=h,n===l){a?a===1?(n=wge(Rf(n),e,i),A1(n,e,i,s,r,o,2)):a===2&&Cge(n,e,i,s,r,o):A1(Rf(n),e,i,s,r,o,1);break}}}function vge(n){const e=n.prev,i=n,s=n.next;if(gs(e,i,s)>=0)return!1;const r=e.x,o=i.x,a=s.x,l=e.y,c=i.y,h=s.y,d=r<o?r<a?r:a:o<a?o:a,u=l<c?l<h?l:h:c<h?c:h,p=r>o?r>a?r:a:o>a?o:a,g=l>c?l>h?l:h:c>h?c:h;let f=s.next;for(;f!==e;){if(f.x>=d&&f.x<=p&&f.y>=u&&f.y<=g&&Ry(r,l,o,c,a,h,f.x,f.y)&&gs(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function xge(n,e,i,s){const r=n.prev,o=n,a=n.next;if(gs(r,o,a)>=0)return!1;const l=r.x,c=o.x,h=a.x,d=r.y,u=o.y,p=a.y,g=l<c?l<h?l:h:c<h?c:h,f=d<u?d<p?d:p:u<p?u:p,A=l>c?l>h?l:h:c>h?c:h,y=d>u?d>p?d:p:u>p?u:p,b=BP(g,f,e,i,s),v=BP(A,y,e,i,s);let x=n.prevZ,w=n.nextZ;for(;x&&x.z>=b&&w&&w.z<=v;){if(x.x>=g&&x.x<=A&&x.y>=f&&x.y<=y&&x!==r&&x!==a&&Ry(l,d,c,u,h,p,x.x,x.y)&&gs(x.prev,x,x.next)>=0||(x=x.prevZ,w.x>=g&&w.x<=A&&w.y>=f&&w.y<=y&&w!==r&&w!==a&&Ry(l,d,c,u,h,p,w.x,w.y)&&gs(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;x&&x.z>=b;){if(x.x>=g&&x.x<=A&&x.y>=f&&x.y<=y&&x!==r&&x!==a&&Ry(l,d,c,u,h,p,x.x,x.y)&&gs(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;w&&w.z<=v;){if(w.x>=g&&w.x<=A&&w.y>=f&&w.y<=y&&w!==r&&w!==a&&Ry(l,d,c,u,h,p,w.x,w.y)&&gs(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function wge(n,e,i){let s=n;do{const r=s.prev,o=s.next.next;!lT(r,o)&&hH(r,s,s.next,o)&&y1(r,o)&&y1(o,r)&&(e.push(r.i/i|0),e.push(s.i/i|0),e.push(o.i/i|0),b1(s),b1(s.next),s=n=o),s=s.next}while(s!==n);return Rf(s)}function Cge(n,e,i,s,r,o){let a=n;do{let l=a.next.next;for(;l!==a.prev;){if(a.i!==l.i&&Bge(a,l)){let c=dH(a,l);a=Rf(a,a.next),c=Rf(c,c.next),A1(a,e,i,s,r,o,0),A1(c,e,i,s,r,o,0);return}l=l.next}a=a.next}while(a!==n)}function Sge(n,e,i,s){const r=[];let o,a,l,c,h;for(o=0,a=e.length;o<a;o++)l=e[o]*s,c=o<a-1?e[o+1]*s:n.length,h=cH(n,l,c,s,!1),h===h.next&&(h.steiner=!0),r.push(Lge(h));for(r.sort(_ge),o=0;o<r.length;o++)i=Mge(r[o],i);return i}function _ge(n,e){return n.x-e.x}function Mge(n,e){const i=Ige(n,e);if(!i)return e;const s=dH(i,n);return Rf(s,s.next),Rf(i,i.next)}function Ige(n,e){let i=e,s=-1/0,r;const o=n.x,a=n.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const p=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(p<=o&&p>s&&(s=p,r=i.x<i.next.x?i:i.next,p===o))return r}i=i.next}while(i!==e);if(!r)return null;const l=r,c=r.x,h=r.y;let d=1/0,u;i=r;do o>=i.x&&i.x>=c&&o!==i.x&&Ry(a<h?o:s,a,c,h,a<h?s:o,a,i.x,i.y)&&(u=Math.abs(a-i.y)/(o-i.x),y1(i,n)&&(u<d||u===d&&(i.x>r.x||i.x===r.x&&Tge(r,i)))&&(r=i,d=u)),i=i.next;while(i!==l);return r}function Tge(n,e){return gs(n.prev,n,e.prev)<0&&gs(e.next,n,n.next)<0}function Ege(n,e,i,s){let r=n;do r.z===0&&(r.z=BP(r.x,r.y,e,i,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,Rge(r)}function Rge(n){let e,i,s,r,o,a,l,c,h=1;do{for(i=n,n=null,o=null,a=0;i;){for(a++,s=i,l=0,e=0;e<h&&(l++,s=s.nextZ,!!s);e++);for(c=h;l>0||c>0&&s;)l!==0&&(c===0||!s||i.z<=s.z)?(r=i,i=i.nextZ,l--):(r=s,s=s.nextZ,c--),o?o.nextZ=r:n=r,r.prevZ=o,o=r;i=s}o.nextZ=null,h*=2}while(a>1);return n}function BP(n,e,i,s,r){return n=(n-i)*r|0,e=(e-s)*r|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function Lge(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function Ry(n,e,i,s,r,o,a,l){return(r-a)*(e-l)>=(n-a)*(o-l)&&(n-a)*(s-l)>=(i-a)*(e-l)&&(i-a)*(o-l)>=(r-a)*(s-l)}function Bge(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!kge(n,e)&&(y1(n,e)&&y1(e,n)&&Gge(n,e)&&(gs(n.prev,n,e.prev)||gs(n,e.prev,e))||lT(n,e)&&gs(n.prev,n,n.next)>0&&gs(e.prev,e,e.next)>0)}function gs(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function lT(n,e){return n.x===e.x&&n.y===e.y}function hH(n,e,i,s){const r=hT(gs(n,e,i)),o=hT(gs(n,e,s)),a=hT(gs(i,s,n)),l=hT(gs(i,s,e));return!!(r!==o&&a!==l||r===0&&cT(n,i,e)||o===0&&cT(n,s,e)||a===0&&cT(i,n,s)||l===0&&cT(i,e,s))}function cT(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function hT(n){return n>0?1:n<0?-1:0}function kge(n,e){let i=n;do{if(i.i!==n.i&&i.next.i!==n.i&&i.i!==e.i&&i.next.i!==e.i&&hH(i,i.next,n,e))return!0;i=i.next}while(i!==n);return!1}function y1(n,e){return gs(n.prev,n,n.next)<0?gs(n,e,n.next)>=0&&gs(n,n.prev,e)>=0:gs(n,e,n.prev)<0||gs(n,n.next,e)<0}function Gge(n,e){let i=n,s=!1;const r=(n.x+e.x)/2,o=(n.y+e.y)/2;do i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next;while(i!==n);return s}function dH(n,e){const i=new kP(n.i,n.x,n.y),s=new kP(e.i,e.x,e.y),r=n.next,o=e.prev;return n.next=e,e.prev=n,i.next=r,r.prev=i,s.next=i,i.prev=s,o.next=s,s.prev=o,s}function uH(n,e,i,s){const r=new kP(n,e,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function b1(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function kP(n,e,i){this.i=n,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Pge(n,e,i,s){let r=0;for(let o=e,a=i-s;o<i;o+=s)r+=(n[a]-n[o])*(n[o+1]+n[a+1]),a=o;return r}class jh{static area(e){const i=e.length;let s=0;for(let r=i-1,o=0;o<i;r=o++)s+=e[r].x*e[o].y-e[o].x*e[r].y;return s*.5}static isClockWise(e){return jh.area(e)<0}static triangulateShape(e,i){const s=[],r=[],o=[];pH(e),mH(s,e);let a=e.length;i.forEach(pH);for(let c=0;c<i.length;c++)r.push(a),a+=i[c].length,mH(s,i[c]);const l=bge.triangulate(s,r);for(let c=0;c<l.length;c+=3)o.push(l.slice(c,c+3));return o}}function pH(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function mH(n,e){for(let i=0;i<e.length;i++)n.push(e[i].x),n.push(e[i].y)}class wx extends Rt{constructor(e=new lm([new Q(.5,.5),new Q(-.5,.5),new Q(-.5,-.5),new Q(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:i},e=Array.isArray(e)?e:[e];const s=this,r=[],o=[];for(let l=0,c=e.length;l<c;l++){const h=e[l];a(h)}this.setAttribute("position",new dt(r,3)),this.setAttribute("uv",new dt(o,2)),this.computeVertexNormals();function a(l){const c=[],h=i.curveSegments!==void 0?i.curveSegments:12,d=i.steps!==void 0?i.steps:1,u=i.depth!==void 0?i.depth:1;let p=i.bevelEnabled!==void 0?i.bevelEnabled:!0,g=i.bevelThickness!==void 0?i.bevelThickness:.2,f=i.bevelSize!==void 0?i.bevelSize:g-.1,A=i.bevelOffset!==void 0?i.bevelOffset:0,y=i.bevelSegments!==void 0?i.bevelSegments:3;const b=i.extrudePath,v=i.UVGenerator!==void 0?i.UVGenerator:Nge;let x,w=!1,C,S,_,I;b&&(x=b.getSpacedPoints(d),w=!0,p=!1,C=b.computeFrenetFrames(d,!1),S=new E,_=new E,I=new E),p||(y=0,g=0,f=0,A=0);const B=l.extractPoints(h);let M=B.shape;const R=B.holes;if(!jh.isClockWise(M)){M=M.reverse();for(let Re=0,ze=R.length;Re<ze;Re++){const U=R[Re];jh.isClockWise(U)&&(R[Re]=U.reverse())}}const k=jh.triangulateShape(M,R),G=M;for(let Re=0,ze=R.length;Re<ze;Re++){const U=R[Re];M=M.concat(U)}function X(Re,ze,U){return ze||console.error("THREE.ExtrudeGeometry: vec does not exist"),Re.clone().addScaledVector(ze,U)}const F=M.length,z=k.length;function H(Re,ze,U){let ot,Ne,yt;const ye=Re.x-ze.x,zt=Re.y-ze.y,Ct=U.x-Re.x,O=U.y-Re.y,N=ye*ye+zt*zt,ce=ye*O-zt*Ct;if(Math.abs(ce)>Number.EPSILON){const Ee=Math.sqrt(N),He=Math.sqrt(Ct*Ct+O*O),Le=ze.x-zt/Ee,bt=ze.y+ye/Ee,nt=U.x-O/He,mt=U.y+Ct/He,ii=((nt-Le)*O-(mt-bt)*Ct)/(ye*O-zt*Ct);ot=Le+ye*ii-Re.x,Ne=bt+zt*ii-Re.y;const Ge=ot*ot+Ne*Ne;if(Ge<=2)return new Q(ot,Ne);yt=Math.sqrt(Ge/2)}else{let Ee=!1;ye>Number.EPSILON?Ct>Number.EPSILON&&(Ee=!0):ye<-Number.EPSILON?Ct<-Number.EPSILON&&(Ee=!0):Math.sign(zt)===Math.sign(O)&&(Ee=!0),Ee?(ot=-zt,Ne=ye,yt=Math.sqrt(N)):(ot=ye,Ne=zt,yt=Math.sqrt(N/2))}return new Q(ot/yt,Ne/yt)}const Z=[];for(let Re=0,ze=G.length,U=ze-1,ot=Re+1;Re<ze;Re++,U++,ot++)U===ze&&(U=0),ot===ze&&(ot=0),Z[Re]=H(G[Re],G[U],G[ot]);const he=[];let be,_e=Z.concat();for(let Re=0,ze=R.length;Re<ze;Re++){const U=R[Re];be=[];for(let ot=0,Ne=U.length,yt=Ne-1,ye=ot+1;ot<Ne;ot++,yt++,ye++)yt===Ne&&(yt=0),ye===Ne&&(ye=0),be[ot]=H(U[ot],U[yt],U[ye]);he.push(be),_e=_e.concat(be)}for(let Re=0;Re<y;Re++){const ze=Re/y,U=g*Math.cos(ze*Math.PI/2),ot=f*Math.sin(ze*Math.PI/2)+A;for(let Ne=0,yt=G.length;Ne<yt;Ne++){const ye=X(G[Ne],Z[Ne],ot);Pe(ye.x,ye.y,-U)}for(let Ne=0,yt=R.length;Ne<yt;Ne++){const ye=R[Ne];be=he[Ne];for(let zt=0,Ct=ye.length;zt<Ct;zt++){const O=X(ye[zt],be[zt],ot);Pe(O.x,O.y,-U)}}}const Ye=f+A;for(let Re=0;Re<F;Re++){const ze=p?X(M[Re],_e[Re],Ye):M[Re];w?(_.copy(C.normals[0]).multiplyScalar(ze.x),S.copy(C.binormals[0]).multiplyScalar(ze.y),I.copy(x[0]).add(_).add(S),Pe(I.x,I.y,I.z)):Pe(ze.x,ze.y,0)}for(let Re=1;Re<=d;Re++)for(let ze=0;ze<F;ze++){const U=p?X(M[ze],_e[ze],Ye):M[ze];w?(_.copy(C.normals[Re]).multiplyScalar(U.x),S.copy(C.binormals[Re]).multiplyScalar(U.y),I.copy(x[Re]).add(_).add(S),Pe(I.x,I.y,I.z)):Pe(U.x,U.y,u/d*Re)}for(let Re=y-1;Re>=0;Re--){const ze=Re/y,U=g*Math.cos(ze*Math.PI/2),ot=f*Math.sin(ze*Math.PI/2)+A;for(let Ne=0,yt=G.length;Ne<yt;Ne++){const ye=X(G[Ne],Z[Ne],ot);Pe(ye.x,ye.y,u+U)}for(let Ne=0,yt=R.length;Ne<yt;Ne++){const ye=R[Ne];be=he[Ne];for(let zt=0,Ct=ye.length;zt<Ct;zt++){const O=X(ye[zt],be[zt],ot);w?Pe(O.x,O.y+x[d-1].y,x[d-1].x+U):Pe(O.x,O.y,u+U)}}}je(),le();function je(){const Re=r.length/3;if(p){let ze=0,U=F*ze;for(let ot=0;ot<z;ot++){const Ne=k[ot];ke(Ne[2]+U,Ne[1]+U,Ne[0]+U)}ze=d+y*2,U=F*ze;for(let ot=0;ot<z;ot++){const Ne=k[ot];ke(Ne[0]+U,Ne[1]+U,Ne[2]+U)}}else{for(let ze=0;ze<z;ze++){const U=k[ze];ke(U[2],U[1],U[0])}for(let ze=0;ze<z;ze++){const U=k[ze];ke(U[0]+F*d,U[1]+F*d,U[2]+F*d)}}s.addGroup(Re,r.length/3-Re,0)}function le(){const Re=r.length/3;let ze=0;ve(G,ze),ze+=G.length;for(let U=0,ot=R.length;U<ot;U++){const Ne=R[U];ve(Ne,ze),ze+=Ne.length}s.addGroup(Re,r.length/3-Re,1)}function ve(Re,ze){let U=Re.length;for(;--U>=0;){const ot=U;let Ne=U-1;Ne<0&&(Ne=Re.length-1);for(let yt=0,ye=d+y*2;yt<ye;yt++){const zt=F*yt,Ct=F*(yt+1),O=ze+ot+zt,N=ze+Ne+zt,ce=ze+Ne+Ct,Ee=ze+ot+Ct;_t(O,N,ce,Ee)}}}function Pe(Re,ze,U){c.push(Re),c.push(ze),c.push(U)}function ke(Re,ze,U){rt(Re),rt(ze),rt(U);const ot=r.length/3,Ne=v.generateTopUV(s,r,ot-3,ot-2,ot-1);xt(Ne[0]),xt(Ne[1]),xt(Ne[2])}function _t(Re,ze,U,ot){rt(Re),rt(ze),rt(ot),rt(ze),rt(U),rt(ot);const Ne=r.length/3,yt=v.generateSideWallUV(s,r,Ne-6,Ne-3,Ne-2,Ne-1);xt(yt[0]),xt(yt[1]),xt(yt[3]),xt(yt[1]),xt(yt[2]),xt(yt[3])}function rt(Re){r.push(c[Re*3+0]),r.push(c[Re*3+1]),r.push(c[Re*3+2])}function xt(Re){o.push(Re.x),o.push(Re.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),i=this.parameters.shapes,s=this.parameters.options;return Vge(i,s,e)}static fromJSON(e,i){const s=[];for(let o=0,a=e.shapes.length;o<a;o++){const l=i[e.shapes[o]];s.push(l)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new sT[r.type]().fromJSON(r)),new wx(s,e.options)}}const Nge={generateTopUV:function(n,e,i,s,r){const o=e[i*3],a=e[i*3+1],l=e[s*3],c=e[s*3+1],h=e[r*3],d=e[r*3+1];return[new Q(o,a),new Q(l,c),new Q(h,d)]},generateSideWallUV:function(n,e,i,s,r,o){const a=e[i*3],l=e[i*3+1],c=e[i*3+2],h=e[s*3],d=e[s*3+1],u=e[s*3+2],p=e[r*3],g=e[r*3+1],f=e[r*3+2],A=e[o*3],y=e[o*3+1],b=e[o*3+2];return Math.abs(l-d)<Math.abs(a-h)?[new Q(a,1-c),new Q(h,1-u),new Q(p,1-f),new Q(A,1-b)]:[new Q(l,1-c),new Q(d,1-u),new Q(g,1-f),new Q(y,1-b)]}};function Vge(n,e,i){if(i.shapes=[],Array.isArray(n))for(let s=0,r=n.length;s<r;s++){const o=n[s];i.shapes.push(o.uuid)}else i.shapes.push(n.uuid);return i.options=Object.assign({},e),e.extrudePath!==void 0&&(i.options.extrudePath=e.extrudePath.toJSON()),i}class Dk extends jg{constructor(e=1,i=0){const s=(1+Math.sqrt(5))/2,r=[-1,s,0,1,s,0,-1,-s,0,1,-s,0,0,-1,s,0,1,s,0,-1,-s,0,1,-s,s,0,-1,s,0,1,-s,0,-1,-s,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,o,e,i),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new Dk(e.radius,e.detail)}}class Np extends jg{constructor(e=1,i=0){const s=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(s,r,e,i),this.type="OctahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new Np(e.radius,e.detail)}}class j_ extends Rt{constructor(e=.5,i=1,s=32,r=1,o=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:i,thetaSegments:s,phiSegments:r,thetaStart:o,thetaLength:a},s=Math.max(3,s),r=Math.max(1,r);const l=[],c=[],h=[],d=[];let u=e;const p=(i-e)/r,g=new E,f=new Q;for(let A=0;A<=r;A++){for(let y=0;y<=s;y++){const b=o+y/s*a;g.x=u*Math.cos(b),g.y=u*Math.sin(b),c.push(g.x,g.y,g.z),h.push(0,0,1),f.x=(g.x/i+1)/2,f.y=(g.y/i+1)/2,d.push(f.x,f.y)}u+=p}for(let A=0;A<r;A++){const y=A*(s+1);for(let b=0;b<s;b++){const v=b+y,x=v,w=v+s+1,C=v+s+2,S=v+1;l.push(x,w,S),l.push(w,C,S)}}this.setIndex(l),this.setAttribute("position",new dt(c,3)),this.setAttribute("normal",new dt(h,3)),this.setAttribute("uv",new dt(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new j_(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class zk extends Rt{constructor(e=new lm([new Q(0,.5),new Q(-.5,-.5),new Q(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:i};const s=[],r=[],o=[],a=[];let l=0,c=0;if(Array.isArray(e)===!1)h(e);else for(let d=0;d<e.length;d++)h(e[d]),this.addGroup(l,c,d),l+=c,c=0;this.setIndex(s),this.setAttribute("position",new dt(r,3)),this.setAttribute("normal",new dt(o,3)),this.setAttribute("uv",new dt(a,2));function h(d){const u=r.length/3,p=d.extractPoints(i);let g=p.shape;const f=p.holes;jh.isClockWise(g)===!1&&(g=g.reverse());for(let y=0,b=f.length;y<b;y++){const v=f[y];jh.isClockWise(v)===!0&&(f[y]=v.reverse())}const A=jh.triangulateShape(g,f);for(let y=0,b=f.length;y<b;y++){const v=f[y];g=g.concat(v)}for(let y=0,b=g.length;y<b;y++){const v=g[y];r.push(v.x,v.y,0),o.push(0,0,1),a.push(v.x,v.y)}for(let y=0,b=A.length;y<b;y++){const v=A[y],x=v[0]+u,w=v[1]+u,C=v[2]+u;s.push(x,w,C),c+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),i=this.parameters.shapes;return Xge(i,e)}static fromJSON(e,i){const s=[];for(let r=0,o=e.shapes.length;r<o;r++){const a=i[e.shapes[r]];s.push(a)}return new zk(s,e.curveSegments)}}function Xge(n,e){if(e.shapes=[],Array.isArray(n))for(let i=0,s=n.length;i<s;i++){const r=n[i];e.shapes.push(r.uuid)}else e.shapes.push(n.uuid);return e}class eh extends Rt{constructor(e=1,i=32,s=16,r=0,o=Math.PI*2,a=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:s,phiStart:r,phiLength:o,thetaStart:a,thetaLength:l},i=Math.max(3,Math.floor(i)),s=Math.max(2,Math.floor(s));const c=Math.min(a+l,Math.PI);let h=0;const d=[],u=new E,p=new E,g=[],f=[],A=[],y=[];for(let b=0;b<=s;b++){const v=[],x=b/s;let w=0;b===0&&a===0?w=.5/i:b===s&&c===Math.PI&&(w=-.5/i);for(let C=0;C<=i;C++){const S=C/i;u.x=-e*Math.cos(r+S*o)*Math.sin(a+x*l),u.y=e*Math.cos(a+x*l),u.z=e*Math.sin(r+S*o)*Math.sin(a+x*l),f.push(u.x,u.y,u.z),p.copy(u).normalize(),A.push(p.x,p.y,p.z),y.push(S+w,1-x),v.push(h++)}d.push(v)}for(let b=0;b<s;b++)for(let v=0;v<i;v++){const x=d[b][v+1],w=d[b][v],C=d[b+1][v],S=d[b+1][v+1];(b!==0||a>0)&&g.push(x,w,S),(b!==s-1||c<Math.PI)&&g.push(w,C,S)}this.setIndex(g),this.setAttribute("position",new dt(f,3)),this.setAttribute("normal",new dt(A,3)),this.setAttribute("uv",new dt(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new eh(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Fk extends jg{constructor(e=1,i=0){const s=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(s,r,e,i),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new Fk(e.radius,e.detail)}}class Vp extends Rt{constructor(e=1,i=.4,s=12,r=48,o=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:i,radialSegments:s,tubularSegments:r,arc:o},s=Math.floor(s),r=Math.floor(r);const a=[],l=[],c=[],h=[],d=new E,u=new E,p=new E;for(let g=0;g<=s;g++)for(let f=0;f<=r;f++){const A=f/r*o,y=g/s*Math.PI*2;u.x=(e+i*Math.cos(y))*Math.cos(A),u.y=(e+i*Math.cos(y))*Math.sin(A),u.z=i*Math.sin(y),l.push(u.x,u.y,u.z),d.x=e*Math.cos(A),d.y=e*Math.sin(A),p.subVectors(u,d).normalize(),c.push(p.x,p.y,p.z),h.push(f/r),h.push(g/s)}for(let g=1;g<=s;g++)for(let f=1;f<=r;f++){const A=(r+1)*g+f-1,y=(r+1)*(g-1)+f-1,b=(r+1)*(g-1)+f,v=(r+1)*g+f;a.push(A,y,v),a.push(y,b,v)}this.setIndex(a),this.setAttribute("position",new dt(l,3)),this.setAttribute("normal",new dt(c,3)),this.setAttribute("uv",new dt(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Vp(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Uk extends Rt{constructor(e=1,i=.4,s=64,r=8,o=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:i,tubularSegments:s,radialSegments:r,p:o,q:a},s=Math.floor(s),r=Math.floor(r);const l=[],c=[],h=[],d=[],u=new E,p=new E,g=new E,f=new E,A=new E,y=new E,b=new E;for(let x=0;x<=s;++x){const w=x/s*o*Math.PI*2;v(w,o,a,e,g),v(w+.01,o,a,e,f),y.subVectors(f,g),b.addVectors(f,g),A.crossVectors(y,b),b.crossVectors(A,y),A.normalize(),b.normalize();for(let C=0;C<=r;++C){const S=C/r*Math.PI*2,_=-i*Math.cos(S),I=i*Math.sin(S);u.x=g.x+(_*b.x+I*A.x),u.y=g.y+(_*b.y+I*A.y),u.z=g.z+(_*b.z+I*A.z),c.push(u.x,u.y,u.z),p.subVectors(u,g).normalize(),h.push(p.x,p.y,p.z),d.push(x/s),d.push(C/r)}}for(let x=1;x<=s;x++)for(let w=1;w<=r;w++){const C=(r+1)*(x-1)+(w-1),S=(r+1)*x+(w-1),_=(r+1)*x+w,I=(r+1)*(x-1)+w;l.push(C,S,I),l.push(S,_,I)}this.setIndex(l),this.setAttribute("position",new dt(c,3)),this.setAttribute("normal",new dt(h,3)),this.setAttribute("uv",new dt(d,2));function v(x,w,C,S,_){const I=Math.cos(x),B=Math.sin(x),M=C/w*x,R=Math.cos(M);_.x=S*(2+R)*.5*I,_.y=S*(2+R)*B*.5,_.z=S*Math.sin(M)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Uk(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Ok extends Rt{constructor(e=new TP(new E(-1,-1,0),new E(-1,1,0),new E(1,1,0)),i=64,s=1,r=8,o=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:i,radius:s,radialSegments:r,closed:o};const a=e.computeFrenetFrames(i,o);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const l=new E,c=new E,h=new Q;let d=new E;const u=[],p=[],g=[],f=[];A(),this.setIndex(f),this.setAttribute("position",new dt(u,3)),this.setAttribute("normal",new dt(p,3)),this.setAttribute("uv",new dt(g,2));function A(){for(let x=0;x<i;x++)y(x);y(o===!1?i:0),v(),b()}function y(x){d=e.getPointAt(x/i,d);const w=a.normals[x],C=a.binormals[x];for(let S=0;S<=r;S++){const _=S/r*Math.PI*2,I=Math.sin(_),B=-Math.cos(_);c.x=B*w.x+I*C.x,c.y=B*w.y+I*C.y,c.z=B*w.z+I*C.z,c.normalize(),p.push(c.x,c.y,c.z),l.x=d.x+s*c.x,l.y=d.y+s*c.y,l.z=d.z+s*c.z,u.push(l.x,l.y,l.z)}}function b(){for(let x=1;x<=i;x++)for(let w=1;w<=r;w++){const C=(r+1)*(x-1)+(w-1),S=(r+1)*x+(w-1),_=(r+1)*x+w,I=(r+1)*(x-1)+w;f.push(C,S,I),f.push(S,_,I)}}function v(){for(let x=0;x<=i;x++)for(let w=0;w<=r;w++)h.x=x/i,h.y=w/r,g.push(h.x,h.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Ok(new sT[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class GP extends Rt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const i=[],s=new Set,r=new E,o=new E;if(e.index!==null){const a=e.attributes.position,l=e.index;let c=e.groups;c.length===0&&(c=[{start:0,count:l.count,materialIndex:0}]);for(let h=0,d=c.length;h<d;++h){const u=c[h],p=u.start,g=u.count;for(let f=p,A=p+g;f<A;f+=3)for(let y=0;y<3;y++){const b=l.getX(f+y),v=l.getX(f+(y+1)%3);r.fromBufferAttribute(a,b),o.fromBufferAttribute(a,v),gH(r,o,s)===!0&&(i.push(r.x,r.y,r.z),i.push(o.x,o.y,o.z))}}}else{const a=e.attributes.position;for(let l=0,c=a.count/3;l<c;l++)for(let h=0;h<3;h++){const d=3*l+h,u=3*l+(h+1)%3;r.fromBufferAttribute(a,d),o.fromBufferAttribute(a,u),gH(r,o,s)===!0&&(i.push(r.x,r.y,r.z),i.push(o.x,o.y,o.z))}}this.setAttribute("position",new dt(i,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function gH(n,e,i){const s=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return i.has(s)===!0||i.has(r)===!0?!1:(i.add(s),i.add(r),!0)}var fH=Object.freeze({__proto__:null,BoxGeometry:bn,CapsuleGeometry:Pk,CircleGeometry:Nk,ConeGeometry:Vk,CylinderGeometry:js,DodecahedronGeometry:Xk,EdgesGeometry:LP,ExtrudeGeometry:wx,IcosahedronGeometry:Dk,LatheGeometry:Y_,OctahedronGeometry:Np,PlaneGeometry:Xs,PolyhedronGeometry:jg,RingGeometry:j_,ShapeGeometry:zk,SphereGeometry:eh,TetrahedronGeometry:Fk,TorusGeometry:Vp,TorusKnotGeometry:Uk,TubeGeometry:Ok,WireframeGeometry:GP});class v1 extends ti{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new fe(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class dT extends jt{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}let Us=class extends ti{constructor(n){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new fe(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sd,this.normalScale=new Q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Oi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.defines={STANDARD:""},this.color.copy(n.color),this.roughness=n.roughness,this.metalness=n.metalness,this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.roughnessMap=n.roughnessMap,this.metalnessMap=n.metalnessMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.envMapRotation.copy(n.envMapRotation),this.envMapIntensity=n.envMapIntensity,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.flatShading=n.flatShading,this.fog=n.fog,this}},uo=class extends Us{constructor(n){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Q(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ts(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new fe(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new fe(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new fe(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(n)}get anisotropy(){return this._anisotropy}set anisotropy(n){this._anisotropy>0!=n>0&&this.version++,this._anisotropy=n}get clearcoat(){return this._clearcoat}set clearcoat(n){this._clearcoat>0!=n>0&&this.version++,this._clearcoat=n}get iridescence(){return this._iridescence}set iridescence(n){this._iridescence>0!=n>0&&this.version++,this._iridescence=n}get dispersion(){return this._dispersion}set dispersion(n){this._dispersion>0!=n>0&&this.version++,this._dispersion=n}get sheen(){return this._sheen}set sheen(n){this._sheen>0!=n>0&&this.version++,this._sheen=n}get transmission(){return this._transmission}set transmission(n){this._transmission>0!=n>0&&this.version++,this._transmission=n}copy(n){return super.copy(n),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=n.anisotropy,this.anisotropyRotation=n.anisotropyRotation,this.anisotropyMap=n.anisotropyMap,this.clearcoat=n.clearcoat,this.clearcoatMap=n.clearcoatMap,this.clearcoatRoughness=n.clearcoatRoughness,this.clearcoatRoughnessMap=n.clearcoatRoughnessMap,this.clearcoatNormalMap=n.clearcoatNormalMap,this.clearcoatNormalScale.copy(n.clearcoatNormalScale),this.dispersion=n.dispersion,this.ior=n.ior,this.iridescence=n.iridescence,this.iridescenceMap=n.iridescenceMap,this.iridescenceIOR=n.iridescenceIOR,this.iridescenceThicknessRange=[...n.iridescenceThicknessRange],this.iridescenceThicknessMap=n.iridescenceThicknessMap,this.sheen=n.sheen,this.sheenColor.copy(n.sheenColor),this.sheenColorMap=n.sheenColorMap,this.sheenRoughness=n.sheenRoughness,this.sheenRoughnessMap=n.sheenRoughnessMap,this.transmission=n.transmission,this.transmissionMap=n.transmissionMap,this.thickness=n.thickness,this.thicknessMap=n.thicknessMap,this.attenuationDistance=n.attenuationDistance,this.attenuationColor.copy(n.attenuationColor),this.specularIntensity=n.specularIntensity,this.specularIntensityMap=n.specularIntensityMap,this.specularColor.copy(n.specularColor),this.specularColorMap=n.specularColorMap,this}};class cm extends ti{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new fe(16777215),this.specular=new fe(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sd,this.normalScale=new Q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Oi,this.combine=WA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class PP extends ti{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new fe(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sd,this.normalScale=new Q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class x1 extends ti{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sd,this.normalScale=new Q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class uT extends ti{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new fe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sd,this.normalScale=new Q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Oi,this.combine=WA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class NP extends ti{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new fe(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sd,this.normalScale=new Q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class pT extends Cn{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Lf(n,e,i){return!n||!i&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function AH(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function yH(n){function e(r,o){return n[r]-n[o]}const i=n.length,s=new Array(i);for(let r=0;r!==i;++r)s[r]=r;return s.sort(e),s}function VP(n,e,i){const s=n.length,r=new n.constructor(s);for(let o=0,a=0;a!==s;++o){const l=i[o]*e;for(let c=0;c!==e;++c)r[a++]=n[l+c]}return r}function XP(n,e,i,s){let r=1,o=n[0];for(;o!==void 0&&o[s]===void 0;)o=n[r++];if(o===void 0)return;let a=o[s];if(a!==void 0)if(Array.isArray(a))do a=o[s],a!==void 0&&(e.push(o.time),i.push.apply(i,a)),o=n[r++];while(o!==void 0);else if(a.toArray!==void 0)do a=o[s],a!==void 0&&(e.push(o.time),a.toArray(i,i.length)),o=n[r++];while(o!==void 0);else do a=o[s],a!==void 0&&(e.push(o.time),i.push(a)),o=n[r++];while(o!==void 0)}function Dge(n,e,i,s,r=30){const o=n.clone();o.name=e;const a=[];for(let c=0;c<o.tracks.length;++c){const h=o.tracks[c],d=h.getValueSize(),u=[],p=[];for(let g=0;g<h.times.length;++g){const f=h.times[g]*r;if(!(f<i||f>=s)){u.push(h.times[g]);for(let A=0;A<d;++A)p.push(h.values[g*d+A])}}u.length!==0&&(h.times=Lf(u,h.times.constructor),h.values=Lf(p,h.values.constructor),a.push(h))}o.tracks=a;let l=1/0;for(let c=0;c<o.tracks.length;++c)l>o.tracks[c].times[0]&&(l=o.tracks[c].times[0]);for(let c=0;c<o.tracks.length;++c)o.tracks[c].shift(-1*l);return o.resetDuration(),o}function zge(n,e=0,i=n,s=30){s<=0&&(s=30);const r=i.tracks.length,o=e/s;for(let a=0;a<r;++a){const l=i.tracks[a],c=l.ValueTypeName;if(c==="bool"||c==="string")continue;const h=n.tracks.find(function(b){return b.name===l.name&&b.ValueTypeName===c});if(h===void 0)continue;let d=0;const u=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=u/3);let p=0;const g=h.getValueSize();h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(p=g/3);const f=l.times.length-1;let A;if(o<=l.times[0]){const b=d,v=u-d;A=l.values.slice(b,v)}else if(o>=l.times[f]){const b=f*u+d,v=b+u-d;A=l.values.slice(b,v)}else{const b=l.createInterpolant(),v=d,x=u-d;b.evaluate(o),A=b.resultBuffer.slice(v,x)}c==="quaternion"&&new Fe().fromArray(A).normalize().conjugate().toArray(A);const y=h.times.length;for(let b=0;b<y;++b){const v=b*g+p;if(c==="quaternion")Fe.multiplyQuaternionsFlat(h.values,v,A,0,h.values,v);else{const x=g-p*2;for(let w=0;w<x;++w)h.values[v+w]-=A[w]}}}return n.blendMode=yG,n}const Fge={convertArray:Lf,isTypedArray:AH,getKeyframeOrder:yH,sortedArray:VP,flattenJSON:XP,subclip:Dge,makeClipAdditive:zge};let Ly=class{constructor(n,e,i,s){this.parameterPositions=n,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(n){const e=this.parameterPositions;let i=this._cachedIndex,s=e[i],r=e[i-1];e:{t:{let o;i:{n:if(!(n<s)){for(let a=i+2;;){if(s===void 0){if(n<r)break n;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=s,s=e[++i],n<s)break t}o=e.length;break i}if(!(n>=r)){const a=e[1];n<a&&(i=2,r=a);for(let l=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(s=r,r=e[--i-1],n>=r)break t}o=i,i=0;break i}break e}for(;i<o;){const a=i+o>>>1;n<e[a]?o=a:i=a+1}if(s=e[i],r=e[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,s)}return this.interpolate_(i,r,n,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(n){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=n*s;for(let o=0;o!==s;++o)e[o]=i[r+o];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},bH=class extends Ly{constructor(n,e,i,s){super(n,e,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:pf,endingEnd:pf}}intervalChanged_(n,e,i){const s=this.parameterPositions;let r=n-2,o=n+1,a=s[r],l=s[o];if(a===void 0)switch(this.getSettings_().endingStart){case mf:r=n,a=2*e-i;break;case Fx:r=s.length-2,a=e+s[r]-s[r+1];break;default:r=n,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case mf:o=n,l=2*i-e;break;case Fx:o=1,l=i+s[1]-s[0];break;default:o=n-1,l=e}const c=(i-e)*.5,h=this.valueSize;this._weightPrev=c/(e-a),this._weightNext=c/(l-i),this._offsetPrev=r*h,this._offsetNext=o*h}interpolate_(n,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=n*a,c=l-a,h=this._offsetPrev,d=this._offsetNext,u=this._weightPrev,p=this._weightNext,g=(i-e)/(s-e),f=g*g,A=f*g,y=-u*A+2*u*f-u*g,b=(1+u)*A+(-1.5-2*u)*f+(-.5+u)*g+1,v=(-1-p)*A+(1.5+p)*f+.5*g,x=p*A-p*f;for(let w=0;w!==a;++w)r[w]=y*o[h+w]+b*o[c+w]+v*o[l+w]+x*o[d+w];return r}},DP=class extends Ly{constructor(n,e,i,s){super(n,e,i,s)}interpolate_(n,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=n*a,c=l-a,h=(i-e)/(s-e),d=1-h;for(let u=0;u!==a;++u)r[u]=o[c+u]*d+o[l+u]*h;return r}},vH=class extends Ly{constructor(n,e,i,s){super(n,e,i,s)}interpolate_(n){return this.copySampleValue_(n-1)}},ch=class{constructor(n,e,i,s){if(n===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+n);this.name=n,this.times=Lf(e,this.TimeBufferType),this.values=Lf(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(n){const e=n.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(n);else{i={name:n.name,times:Lf(n.times,Array),values:Lf(n.values,Array)};const s=n.getInterpolation();s!==n.DefaultInterpolation&&(i.interpolation=s)}return i.type=n.ValueTypeName,i}InterpolantFactoryMethodDiscrete(n){return new vH(this.times,this.values,this.getValueSize(),n)}InterpolantFactoryMethodLinear(n){return new DP(this.times,this.values,this.getValueSize(),n)}InterpolantFactoryMethodSmooth(n){return new bH(this.times,this.values,this.getValueSize(),n)}setInterpolation(n){let e;switch(n){case qp:e=this.InterpolantFactoryMethodDiscrete;break;case xu:e=this.InterpolantFactoryMethodLinear;break;case lI:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(n!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return qp;case this.InterpolantFactoryMethodLinear:return xu;case this.InterpolantFactoryMethodSmooth:return lI}}getValueSize(){return this.values.length/this.times.length}shift(n){if(n!==0){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]+=n}return this}scale(n){if(n!==1){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]*=n}return this}trim(n,e){const i=this.times,s=i.length;let r=0,o=s-1;for(;r!==s&&i[r]<n;)++r;for(;o!==-1&&i[o]>e;)--o;if(++o,r!==0||o!==s){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=i.slice(r,o),this.values=this.values.slice(r*a,o*a)}return this}validate(){let n=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),n=!1);const i=this.times,s=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),n=!1);let o=null;for(let a=0;a!==r;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),n=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),n=!1;break}o=l}if(s!==void 0&&AH(s))for(let a=0,l=s.length;a!==l;++a){const c=s[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),n=!1;break}}return n}optimize(){const n=this.times.slice(),e=this.values.slice(),i=this.getValueSize(),s=this.getInterpolation()===lI,r=n.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=n[a],h=n[a+1];if(c!==h&&(a!==1||c!==n[0]))if(s)l=!0;else{const d=a*i,u=d-i,p=d+i;for(let g=0;g!==i;++g){const f=e[d+g];if(f!==e[u+g]||f!==e[p+g]){l=!0;break}}}if(l){if(a!==o){n[o]=n[a];const d=a*i,u=o*i;for(let p=0;p!==i;++p)e[u+p]=e[d+p]}++o}}if(r>0){n[o]=n[r];for(let a=r*i,l=o*i,c=0;c!==i;++c)e[l+c]=e[a+c];++o}return o!==n.length?(this.times=n.slice(0,o),this.values=e.slice(0,o*i)):(this.times=n,this.values=e),this}clone(){const n=this.times.slice(),e=this.values.slice(),i=this.constructor,s=new i(this.name,n,e);return s.createInterpolant=this.createInterpolant,s}};ch.prototype.TimeBufferType=Float32Array,ch.prototype.ValueBufferType=Float32Array,ch.prototype.DefaultInterpolation=xu;let Bf=class extends ch{constructor(n,e,i){super(n,e,i)}};Bf.prototype.ValueTypeName="bool",Bf.prototype.ValueBufferType=Array,Bf.prototype.DefaultInterpolation=qp,Bf.prototype.InterpolantFactoryMethodLinear=void 0,Bf.prototype.InterpolantFactoryMethodSmooth=void 0;let mT=class extends ch{};mT.prototype.ValueTypeName="color";let Ru=class extends ch{};Ru.prototype.ValueTypeName="number";let xH=class extends Ly{constructor(n,e,i,s){super(n,e,i,s)}interpolate_(n,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-e)/(s-e);let c=n*a;for(let h=c+a;c!==h;c+=4)Fe.slerpFlat(r,0,o,c-a,o,c,l);return r}},ad=class extends ch{InterpolantFactoryMethodLinear(n){return new xH(this.times,this.values,this.getValueSize(),n)}};ad.prototype.ValueTypeName="quaternion",ad.prototype.InterpolantFactoryMethodSmooth=void 0;let kf=class extends ch{constructor(n,e,i){super(n,e,i)}};kf.prototype.ValueTypeName="string",kf.prototype.ValueBufferType=Array,kf.prototype.DefaultInterpolation=qp,kf.prototype.InterpolantFactoryMethodLinear=void 0,kf.prototype.InterpolantFactoryMethodSmooth=void 0;let ld=class extends ch{};ld.prototype.ValueTypeName="vector";let wa=class{constructor(n="",e=-1,i=[],s=cI){this.name=n,this.tracks=i,this.duration=e,this.blendMode=s,this.uuid=xl(),this.duration<0&&this.resetDuration()}static parse(n){const e=[],i=n.tracks,s=1/(n.fps||1);for(let o=0,a=i.length;o!==a;++o)e.push(Oge(i[o]).scale(s));const r=new this(n.name,n.duration,e,n.blendMode);return r.uuid=n.uuid,r}static toJSON(n){const e=[],i=n.tracks,s={name:n.name,duration:n.duration,tracks:e,uuid:n.uuid,blendMode:n.blendMode};for(let r=0,o=i.length;r!==o;++r)e.push(ch.toJSON(i[r]));return s}static CreateFromMorphTargetSequence(n,e,i,s){const r=e.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const h=yH(l);l=VP(l,1,h),c=VP(c,1,h),!s&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new Ru(".morphTargetInfluences["+e[a].name+"]",l,c).scale(1/i))}return new this(n,-1,o)}static findByName(n,e){let i=n;if(!Array.isArray(n)){const s=n;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===e)return i[s];return null}static CreateClipsFromMorphTargetSequences(n,e,i){const s={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=n.length;a<l;a++){const c=n[a],h=c.name.match(r);if(h&&h.length>1){const d=h[1];let u=s[d];u||(s[d]=u=[]),u.push(c)}}const o=[];for(const a in s)o.push(this.CreateFromMorphTargetSequence(a,s[a],e,i));return o}static parseAnimation(n,e){if(!n)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(h,d,u,p,g){if(u.length!==0){const f=[],A=[];XP(u,f,A,p),f.length!==0&&g.push(new h(d,f,A))}},s=[],r=n.name||"default",o=n.fps||30,a=n.blendMode;let l=n.length||-1;const c=n.hierarchy||[];for(let h=0;h<c.length;h++){const d=c[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const u={};let p;for(p=0;p<d.length;p++)if(d[p].morphTargets)for(let g=0;g<d[p].morphTargets.length;g++)u[d[p].morphTargets[g]]=-1;for(const g in u){const f=[],A=[];for(let y=0;y!==d[p].morphTargets.length;++y){const b=d[p];f.push(b.time),A.push(b.morphTarget===g?1:0)}s.push(new Ru(".morphTargetInfluence["+g+"]",f,A))}l=u.length*o}else{const u=".bones["+e[h].name+"]";i(ld,u+".position",d,"pos",s),i(ad,u+".quaternion",d,"rot",s),i(ld,u+".scale",d,"scl",s)}}return s.length===0?null:new this(r,l,s,a)}resetDuration(){const n=this.tracks;let e=0;for(let i=0,s=n.length;i!==s;++i){const r=this.tracks[i];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}trim(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].trim(0,this.duration);return this}validate(){let n=!0;for(let e=0;e<this.tracks.length;e++)n=n&&this.tracks[e].validate();return n}optimize(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].optimize();return this}clone(){const n=[];for(let e=0;e<this.tracks.length;e++)n.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,n,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function Uge(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ru;case"vector":case"vector2":case"vector3":case"vector4":return ld;case"color":return mT;case"quaternion":return ad;case"bool":case"boolean":return Bf;case"string":return kf}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function Oge(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=Uge(n.type);if(n.times===void 0){const i=[],s=[];XP(n.keys,i,s,"value"),n.times=i,n.values=s}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Lu={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};let gT=class{constructor(n,e,i){const s=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=n,this.onProgress=e,this.onError=i,this.itemStart=function(h){a++,r===!1&&s.onStart!==void 0&&s.onStart(h,o,a),r=!0},this.itemEnd=function(h){o++,s.onProgress!==void 0&&s.onProgress(h,o,a),o===a&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(h){s.onError!==void 0&&s.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,d){return c.push(h,d),this},this.removeHandler=function(h){const d=c.indexOf(h);return d!==-1&&c.splice(d,2),this},this.getHandler=function(h){for(let d=0,u=c.length;d<u;d+=2){const p=c[d],g=c[d+1];if(p.global&&(p.lastIndex=0),p.test(h))return g}return null}}};const zP=new gT;let fs=class{constructor(n){this.manager=n!==void 0?n:zP,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(n,e){const i=this;return new Promise(function(s,r){i.load(n,s,e,r)})}parse(){}setCrossOrigin(n){return this.crossOrigin=n,this}setWithCredentials(n){return this.withCredentials=n,this}setPath(n){return this.path=n,this}setResourcePath(n){return this.resourcePath=n,this}setRequestHeader(n){return this.requestHeader=n,this}};fs.DEFAULT_MATERIAL_NAME="__DEFAULT";const Bu={};let Zge=class extends Error{constructor(n,e){super(n),this.response=e}},Rs=class extends fs{constructor(n){super(n)}load(n,e,i,s){n===void 0&&(n=""),this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const r=Lu.get(n);if(r!==void 0)return this.manager.itemStart(n),setTimeout(()=>{e&&e(r),this.manager.itemEnd(n)},0),r;if(Bu[n]!==void 0){Bu[n].push({onLoad:e,onProgress:i,onError:s});return}Bu[n]=[],Bu[n].push({onLoad:e,onProgress:i,onError:s});const o=new Request(n,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=Bu[n],d=c.body.getReader(),u=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),p=u?parseInt(u):0,g=p!==0;let f=0;const A=new ReadableStream({start(y){b();function b(){d.read().then(({done:v,value:x})=>{if(v)y.close();else{f+=x.byteLength;const w=new ProgressEvent("progress",{lengthComputable:g,loaded:f,total:p});for(let C=0,S=h.length;C<S;C++){const _=h[C];_.onProgress&&_.onProgress(w)}y.enqueue(x),b()}},v=>{y.error(v)})}}});return new Response(A)}else throw new Zge(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return c.json();default:if(a===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(a),d=h&&h[1]?h[1].toLowerCase():void 0,u=new TextDecoder(d);return c.arrayBuffer().then(p=>u.decode(p))}}}).then(c=>{Lu.add(n,c);const h=Bu[n];delete Bu[n];for(let d=0,u=h.length;d<u;d++){const p=h[d];p.onLoad&&p.onLoad(c)}}).catch(c=>{const h=Bu[n];if(h===void 0)throw this.manager.itemError(n),c;delete Bu[n];for(let d=0,u=h.length;d<u;d++){const p=h[d];p.onError&&p.onError(c)}this.manager.itemError(n)}).finally(()=>{this.manager.itemEnd(n)}),this.manager.itemStart(n)}setResponseType(n){return this.responseType=n,this}setMimeType(n){return this.mimeType=n,this}};class Wge extends fs{constructor(e){super(e)}load(e,i,s,r){const o=this,a=new Rs(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{i(o.parse(JSON.parse(l)))}catch(c){r?r(c):console.error(c),o.manager.itemError(e)}},s,r)}parse(e){const i=[];for(let s=0;s<e.length;s++){const r=wa.parse(e[s]);i.push(r)}return i}}class Hge extends fs{constructor(e){super(e)}load(e,i,s,r){const o=this,a=[],l=new od,c=new Rs(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(o.withCredentials);let h=0;function d(u){c.load(e[u],function(p){const g=o.parse(p,!0);a[u]={width:g.width,height:g.height,format:g.format,mipmaps:g.mipmaps},h+=1,h===6&&(g.mipmapCount===1&&(l.minFilter=Wt),l.image=a,l.format=g.format,l.needsUpdate=!0,i&&i(l))},s,r)}if(Array.isArray(e))for(let u=0,p=e.length;u<p;++u)d(u);else c.load(e,function(u){const p=o.parse(u,!0);if(p.isCubemap){const g=p.mipmaps.length/p.mipmapCount;for(let f=0;f<g;f++){a[f]={mipmaps:[]};for(let A=0;A<p.mipmapCount;A++)a[f].mipmaps.push(p.mipmaps[f*p.mipmapCount+A]),a[f].format=p.format,a[f].width=p.width,a[f].height=p.height}l.image=a}else l.image.width=p.width,l.image.height=p.height,l.mipmaps=p.mipmaps;p.mipmapCount===1&&(l.minFilter=Wt),l.format=p.format,l.needsUpdate=!0,i&&i(l)},s,r);return l}}let w1=class extends fs{constructor(n){super(n)}load(n,e,i,s){this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const r=this,o=Lu.get(n);if(o!==void 0)return r.manager.itemStart(n),setTimeout(function(){e&&e(o),r.manager.itemEnd(n)},0),o;const a=Qx("img");function l(){h(),Lu.add(n,this),e&&e(this),r.manager.itemEnd(n)}function c(d){h(),s&&s(d),r.manager.itemError(n),r.manager.itemEnd(n)}function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),n.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(n),a.src=n,a}};class Qge extends fs{constructor(e){super(e)}load(e,i,s,r){const o=new xf;o.colorSpace=ut;const a=new w1(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let l=0;function c(h){a.load(e[h],function(d){o.images[h]=d,l++,l===6&&(o.needsUpdate=!0,i&&i(o))},void 0,r)}for(let h=0;h<e.length;++h)c(h);return o}}class FP extends fs{constructor(e){super(e)}load(e,i,s,r){const o=this,a=new nr,l=new Rs(this.manager);return l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setPath(this.path),l.setWithCredentials(o.withCredentials),l.load(e,function(c){let h;try{h=o.parse(c)}catch(d){if(r!==void 0)r(d);else{console.error(d);return}}h.image!==void 0?a.image=h.image:h.data!==void 0&&(a.image.width=h.width,a.image.height=h.height,a.image.data=h.data),a.wrapS=h.wrapS!==void 0?h.wrapS:Wo,a.wrapT=h.wrapT!==void 0?h.wrapT:Wo,a.magFilter=h.magFilter!==void 0?h.magFilter:Wt,a.minFilter=h.minFilter!==void 0?h.minFilter:Wt,a.anisotropy=h.anisotropy!==void 0?h.anisotropy:1,h.colorSpace!==void 0&&(a.colorSpace=h.colorSpace),h.flipY!==void 0&&(a.flipY=h.flipY),h.format!==void 0&&(a.format=h.format),h.type!==void 0&&(a.type=h.type),h.mipmaps!==void 0&&(a.mipmaps=h.mipmaps,a.minFilter=Ar),h.mipmapCount===1&&(a.minFilter=Wt),h.generateMipmaps!==void 0&&(a.generateMipmaps=h.generateMipmaps),a.needsUpdate=!0,i&&i(a,h)},s,r),a}}let hh=class extends fs{constructor(n){super(n)}load(n,e,i,s){const r=new di,o=new w1(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(n,function(a){r.image=a,r.needsUpdate=!0,e!==void 0&&e(r)},i,s),r}},hm=class extends Ae{constructor(n,e=1){super(),this.isLight=!0,this.type="Light",this.color=new fe(n),this.intensity=e}dispose(){}copy(n,e){return super.copy(n,e),this.color.copy(n.color),this.intensity=n.intensity,this}toJSON(n){const e=super.toJSON(n);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}};class fT extends hm{constructor(e,i,s){super(e,s),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ae.DEFAULT_UP),this.updateMatrix(),this.groundColor=new fe(i)}copy(e,i){return super.copy(e,i),this.groundColor.copy(e.groundColor),this}}const UP=new de,wH=new E,CH=new E;let OP=class{constructor(n){this.camera=n,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Q(512,512),this.map=null,this.mapPass=null,this.matrix=new de,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Cf,this._frameExtents=new Q(1,1),this._viewportCount=1,this._viewports=[new $e(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(n){const e=this.camera,i=this.matrix;wH.setFromMatrixPosition(n.matrixWorld),e.position.copy(wH),CH.setFromMatrixPosition(n.target.matrixWorld),e.lookAt(CH),e.updateMatrixWorld(),UP.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(UP),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(UP)}getViewport(n){return this._viewports[n]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(n){return this.camera=n.camera.clone(),this.intensity=n.intensity,this.bias=n.bias,this.radius=n.radius,this.mapSize.copy(n.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const n={};return this.intensity!==1&&(n.intensity=this.intensity),this.bias!==0&&(n.bias=this.bias),this.normalBias!==0&&(n.normalBias=this.normalBias),this.radius!==1&&(n.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(n.mapSize=this.mapSize.toArray()),n.camera=this.camera.toJSON(!1).object,delete n.camera.matrix,n}},Kge=class extends OP{constructor(){super(new Ot(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(n){const e=this.camera,i=ny*2*n.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=n.distance||e.far;(i!==e.fov||s!==e.aspect||r!==e.far)&&(e.fov=i,e.aspect=s,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(n)}copy(n){return super.copy(n),this.focus=n.focus,this}},Gf=class extends hm{constructor(n,e,i=0,s=Math.PI/3,r=0,o=2){super(n,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ae.DEFAULT_UP),this.updateMatrix(),this.target=new Ae,this.distance=i,this.angle=s,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new Kge}get power(){return this.intensity*Math.PI}set power(n){this.intensity=n/Math.PI}dispose(){this.shadow.dispose()}copy(n,e){return super.copy(n,e),this.distance=n.distance,this.angle=n.angle,this.penumbra=n.penumbra,this.decay=n.decay,this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}};const SH=new de,C1=new E,ZP=new E;let Yge=class extends OP{constructor(){super(new Ot(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Q(4,2),this._viewportCount=6,this._viewports=[new $e(2,1,1,1),new $e(0,1,1,1),new $e(3,1,1,1),new $e(1,1,1,1),new $e(3,0,1,1),new $e(1,0,1,1)],this._cubeDirections=[new E(1,0,0),new E(-1,0,0),new E(0,0,1),new E(0,0,-1),new E(0,1,0),new E(0,-1,0)],this._cubeUps=[new E(0,1,0),new E(0,1,0),new E(0,1,0),new E(0,1,0),new E(0,0,1),new E(0,0,-1)]}updateMatrices(n,e=0){const i=this.camera,s=this.matrix,r=n.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),C1.setFromMatrixPosition(n.matrixWorld),i.position.copy(C1),ZP.copy(i.position),ZP.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(ZP),i.updateMatrixWorld(),s.makeTranslation(-C1.x,-C1.y,-C1.z),SH.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(SH)}},dm=class extends hm{constructor(n,e,i=0,s=2){super(n,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new Yge}get power(){return this.intensity*4*Math.PI}set power(n){this.intensity=n/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(n,e){return super.copy(n,e),this.distance=n.distance,this.decay=n.decay,this.shadow=n.shadow.clone(),this}},jge=class extends OP{constructor(){super(new lh(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},um=class extends hm{constructor(n,e){super(n,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ae.DEFAULT_UP),this.updateMatrix(),this.target=new Ae,this.shadow=new jge}dispose(){this.shadow.dispose()}copy(n){return super.copy(n),this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}};class S1 extends hm{constructor(e,i){super(e,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class WP extends hm{constructor(e,i,s=10,r=10){super(e,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=s,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const i=super.toJSON(e);return i.object.width=this.width,i.object.height=this.height,i}}class _H{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new E)}set(e){for(let i=0;i<9;i++)this.coefficients[i].copy(e[i]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,i){const s=e.x,r=e.y,o=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.282095),i.addScaledVector(a[1],.488603*r),i.addScaledVector(a[2],.488603*o),i.addScaledVector(a[3],.488603*s),i.addScaledVector(a[4],1.092548*(s*r)),i.addScaledVector(a[5],1.092548*(r*o)),i.addScaledVector(a[6],.315392*(3*o*o-1)),i.addScaledVector(a[7],1.092548*(s*o)),i.addScaledVector(a[8],.546274*(s*s-r*r)),i}getIrradianceAt(e,i){const s=e.x,r=e.y,o=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.886227),i.addScaledVector(a[1],2*.511664*r),i.addScaledVector(a[2],2*.511664*o),i.addScaledVector(a[3],2*.511664*s),i.addScaledVector(a[4],2*.429043*s*r),i.addScaledVector(a[5],2*.429043*r*o),i.addScaledVector(a[6],.743125*o*o-.247708),i.addScaledVector(a[7],2*.429043*s*o),i.addScaledVector(a[8],.429043*(s*s-r*r)),i}add(e){for(let i=0;i<9;i++)this.coefficients[i].add(e.coefficients[i]);return this}addScaledSH(e,i){for(let s=0;s<9;s++)this.coefficients[s].addScaledVector(e.coefficients[s],i);return this}scale(e){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(e);return this}lerp(e,i){for(let s=0;s<9;s++)this.coefficients[s].lerp(e.coefficients[s],i);return this}equals(e){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(e.coefficients[i]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,i=0){const s=this.coefficients;for(let r=0;r<9;r++)s[r].fromArray(e,i+r*3);return this}toArray(e=[],i=0){const s=this.coefficients;for(let r=0;r<9;r++)s[r].toArray(e,i+r*3);return e}static getBasisAt(e,i){const s=e.x,r=e.y,o=e.z;i[0]=.282095,i[1]=.488603*r,i[2]=.488603*o,i[3]=.488603*s,i[4]=1.092548*s*r,i[5]=1.092548*r*o,i[6]=.315392*(3*o*o-1),i[7]=1.092548*s*o,i[8]=.546274*(s*s-r*r)}}class HP extends hm{constructor(e=new _H,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const i=super.toJSON(e);return i.object.sh=this.sh.toArray(),i}}class J_ extends fs{constructor(e){super(e),this.textures={}}load(e,i,s,r){const o=this,a=new Rs(o.manager);a.setPath(o.path),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,function(l){try{i(o.parse(JSON.parse(l)))}catch(c){r?r(c):console.error(c),o.manager.itemError(e)}},s,r)}parse(e){const i=this.textures;function s(o){return i[o]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",o),i[o]}const r=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=e.sheen),e.sheenColor!==void 0&&(r.sheenColor=new fe().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(r.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.specularIntensity!==void 0&&(r.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(r.dispersion=e.dispersion),e.iridescence!==void 0&&(r.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(r.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(r.transmission=e.transmission),e.thickness!==void 0&&(r.thickness=e.thickness),e.attenuationDistance!==void 0&&(r.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(r.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(r.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(r.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(r.depthFunc=e.depthFunc),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(r.blendSrc=e.blendSrc),e.blendDst!==void 0&&(r.blendDst=e.blendDst),e.blendEquation!==void 0&&(r.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(r.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(r.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(r.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&r.blendColor!==void 0&&r.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(r.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==void 0&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(r.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const o in e.uniforms){const a=e.uniforms[o];switch(r.uniforms[o]={},a.type){case"t":r.uniforms[o].value=s(a.value);break;case"c":r.uniforms[o].value=new fe().setHex(a.value);break;case"v2":r.uniforms[o].value=new Q().fromArray(a.value);break;case"v3":r.uniforms[o].value=new E().fromArray(a.value);break;case"v4":r.uniforms[o].value=new $e().fromArray(a.value);break;case"m3":r.uniforms[o].value=new oi().fromArray(a.value);break;case"m4":r.uniforms[o].value=new de().fromArray(a.value);break;default:r.uniforms[o].value=a.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(r.glslVersion=e.glslVersion),e.extensions!==void 0)for(const o in e.extensions)r.extensions[o]=e.extensions[o];if(e.lights!==void 0&&(r.lights=e.lights),e.clipping!==void 0&&(r.clipping=e.clipping),e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=s(e.map)),e.matcap!==void 0&&(r.matcap=s(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=s(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=s(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=s(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let o=e.normalScale;Array.isArray(o)===!1&&(o=[o,o]),r.normalScale=new Q().fromArray(o)}return e.displacementMap!==void 0&&(r.displacementMap=s(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=s(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=s(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=s(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=s(e.specularMap)),e.specularIntensityMap!==void 0&&(r.specularIntensityMap=s(e.specularIntensityMap)),e.specularColorMap!==void 0&&(r.specularColorMap=s(e.specularColorMap)),e.envMap!==void 0&&(r.envMap=s(e.envMap)),e.envMapRotation!==void 0&&r.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=s(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=s(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=s(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=s(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=s(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=s(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new Q().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(r.iridescenceMap=s(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(r.iridescenceThicknessMap=s(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(r.transmissionMap=s(e.transmissionMap)),e.thicknessMap!==void 0&&(r.thicknessMap=s(e.thicknessMap)),e.anisotropyMap!==void 0&&(r.anisotropyMap=s(e.anisotropyMap)),e.sheenColorMap!==void 0&&(r.sheenColorMap=s(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=s(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return J_.createMaterialFromType(e)}static createMaterialFromType(e){const i={ShadowMaterial:v1,SpriteMaterial:s1,RawShaderMaterial:dT,ShaderMaterial:jt,PointsMaterial:rd,MeshPhysicalMaterial:uo,MeshStandardMaterial:Us,MeshPhongMaterial:cm,MeshToonMaterial:PP,MeshNormalMaterial:x1,MeshLambertMaterial:uT,MeshDepthMaterial:n1,MeshDistanceMaterial:iP,MeshBasicMaterial:ai,MeshMatcapMaterial:NP,LineDashedMaterial:pT,LineBasicMaterial:Cn,Material:ti};return new i[e]}}let cd=class{static decodeText(n){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(n);let e="";for(let i=0,s=n.length;i<s;i++)e+=String.fromCharCode(n[i]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(n){const e=n.lastIndexOf("/");return e===-1?"./":n.slice(0,e+1)}static resolveURL(n,e){return typeof n!="string"||n===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(n)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(n)||/^data:.*,.*$/i.test(n)||/^blob:.*$/i.test(n)?n:e+n)}};class AT extends Rt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class MH extends fs{constructor(e){super(e)}load(e,i,s,r){const o=this,a=new Rs(o.manager);a.setPath(o.path),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,function(l){try{i(o.parse(JSON.parse(l)))}catch(c){r?r(c):console.error(c),o.manager.itemError(e)}},s,r)}parse(e){const i={},s={};function r(p,g){if(i[g]!==void 0)return i[g];const f=p.interleavedBuffers[g],A=o(p,f.buffer),y=sy(f.type,A),b=new Cy(y,f.stride);return b.uuid=f.uuid,i[g]=b,b}function o(p,g){if(s[g]!==void 0)return s[g];const f=p.arrayBuffers[g],A=new Uint32Array(f).buffer;return s[g]=A,A}const a=e.isInstancedBufferGeometry?new AT:new Rt,l=e.data.index;if(l!==void 0){const p=sy(l.type,l.array);a.setIndex(new ct(p,1))}const c=e.data.attributes;for(const p in c){const g=c[p];let f;if(g.isInterleavedBufferAttribute){const A=r(e.data,g.data);f=new xa(A,g.itemSize,g.offset,g.normalized)}else{const A=sy(g.type,g.array),y=g.isInstancedBufferAttribute?Yo:ct;f=new y(A,g.itemSize,g.normalized)}g.name!==void 0&&(f.name=g.name),g.usage!==void 0&&f.setUsage(g.usage),a.setAttribute(p,f)}const h=e.data.morphAttributes;if(h)for(const p in h){const g=h[p],f=[];for(let A=0,y=g.length;A<y;A++){const b=g[A];let v;if(b.isInterleavedBufferAttribute){const x=r(e.data,b.data);v=new xa(x,b.itemSize,b.offset,b.normalized)}else{const x=sy(b.type,b.array);v=new ct(x,b.itemSize,b.normalized)}b.name!==void 0&&(v.name=b.name),f.push(v)}a.morphAttributes[p]=f}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const d=e.data.groups||e.data.drawcalls||e.data.offsets;if(d!==void 0)for(let p=0,g=d.length;p!==g;++p){const f=d[p];a.addGroup(f.start,f.count,f.materialIndex)}const u=e.data.boundingSphere;if(u!==void 0){const p=new E;u.center!==void 0&&p.fromArray(u.center),a.boundingSphere=new Vn(p,u.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class IH extends fs{constructor(e){super(e)}load(e,i,s,r){const o=this,a=this.path===""?cd.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const l=new Rs(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){let h=null;try{h=JSON.parse(c)}catch(u){r!==void 0&&r(u),console.error("THREE:ObjectLoader: Can't parse "+e+".",u.message);return}const d=h.metadata;if(d===void 0||d.type===void 0||d.type.toLowerCase()==="geometry"){r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}o.parse(h,i)},s,r)}async loadAsync(e,i){const s=this,r=this.path===""?cd.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const o=new Rs(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials);const a=await o.loadAsync(e,i),l=JSON.parse(a),c=l.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await s.parseAsync(l)}parse(e,i){const s=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),o=this.parseGeometries(e.geometries,r),a=this.parseImages(e.images,function(){i!==void 0&&i(h)}),l=this.parseTextures(e.textures,a),c=this.parseMaterials(e.materials,l),h=this.parseObject(e.object,o,c,l,s),d=this.parseSkeletons(e.skeletons,h);if(this.bindSkeletons(h,d),this.bindLightTargets(h),i!==void 0){let u=!1;for(const p in a)if(a[p].data instanceof HTMLImageElement){u=!0;break}u===!1&&i(h)}return h}async parseAsync(e){const i=this.parseAnimations(e.animations),s=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,s),o=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,r,l,a,i),h=this.parseSkeletons(e.skeletons,c);return this.bindSkeletons(c,h),this.bindLightTargets(c),c}parseShapes(e){const i={};if(e!==void 0)for(let s=0,r=e.length;s<r;s++){const o=new lm().fromJSON(e[s]);i[o.uuid]=o}return i}parseSkeletons(e,i){const s={},r={};if(i.traverse(function(o){o.isBone&&(r[o.uuid]=o)}),e!==void 0)for(let o=0,a=e.length;o<a;o++){const l=new l1().fromJSON(e[o],r);s[l.uuid]=l}return s}parseGeometries(e,i){const s={};if(e!==void 0){const r=new MH;for(let o=0,a=e.length;o<a;o++){let l;const c=e[o];switch(c.type){case"BufferGeometry":case"InstancedBufferGeometry":l=r.parse(c);break;default:c.type in fH?l=fH[c.type].fromJSON(c,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${c.type}"`)}l.uuid=c.uuid,c.name!==void 0&&(l.name=c.name),c.userData!==void 0&&(l.userData=c.userData),s[c.uuid]=l}}return s}parseMaterials(e,i){const s={},r={};if(e!==void 0){const o=new J_;o.setTextures(i);for(let a=0,l=e.length;a<l;a++){const c=e[a];s[c.uuid]===void 0&&(s[c.uuid]=o.parse(c)),r[c.uuid]=s[c.uuid]}}return r}parseAnimations(e){const i={};if(e!==void 0)for(let s=0;s<e.length;s++){const r=e[s],o=wa.parse(r);i[o.uuid]=o}return i}parseImages(e,i){const s=this,r={};let o;function a(c){return s.manager.itemStart(c),o.load(c,function(){s.manager.itemEnd(c)},void 0,function(){s.manager.itemError(c),s.manager.itemEnd(c)})}function l(c){if(typeof c=="string"){const h=c,d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h)?h:s.resourcePath+h;return a(d)}else return c.data?{data:sy(c.type,c.data),width:c.width,height:c.height}:null}if(e!==void 0&&e.length>0){const c=new gT(i);o=new w1(c),o.setCrossOrigin(this.crossOrigin);for(let h=0,d=e.length;h<d;h++){const u=e[h],p=u.url;if(Array.isArray(p)){const g=[];for(let f=0,A=p.length;f<A;f++){const y=p[f],b=l(y);b!==null&&(b instanceof HTMLImageElement?g.push(b):g.push(new nr(b.data,b.width,b.height)))}r[u.uuid]=new wu(g)}else{const g=l(u.url);r[u.uuid]=new wu(g)}}}return r}async parseImagesAsync(e){const i=this,s={};let r;async function o(a){if(typeof a=="string"){const l=a,c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:i.resourcePath+l;return await r.loadAsync(c)}else return a.data?{data:sy(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){r=new w1(this.manager),r.setCrossOrigin(this.crossOrigin);for(let a=0,l=e.length;a<l;a++){const c=e[a],h=c.url;if(Array.isArray(h)){const d=[];for(let u=0,p=h.length;u<p;u++){const g=h[u],f=await o(g);f!==null&&(f instanceof HTMLImageElement?d.push(f):d.push(new nr(f.data,f.width,f.height)))}s[c.uuid]=new wu(d)}else{const d=await o(c.url);s[c.uuid]=new wu(d)}}}return s}parseTextures(e,i){function s(o,a){return typeof o=="number"?o:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",o),a[o])}const r={};if(e!==void 0)for(let o=0,a=e.length;o<a;o++){const l=e[o];l.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',l.uuid),i[l.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",l.image);const c=i[l.image],h=c.data;let d;Array.isArray(h)?(d=new xf,h.length===6&&(d.needsUpdate=!0)):(h&&h.data?d=new nr:d=new di,h&&(d.needsUpdate=!0)),d.source=c,d.uuid=l.uuid,l.name!==void 0&&(d.name=l.name),l.mapping!==void 0&&(d.mapping=s(l.mapping,Jge)),l.channel!==void 0&&(d.channel=l.channel),l.offset!==void 0&&d.offset.fromArray(l.offset),l.repeat!==void 0&&d.repeat.fromArray(l.repeat),l.center!==void 0&&d.center.fromArray(l.center),l.rotation!==void 0&&(d.rotation=l.rotation),l.wrap!==void 0&&(d.wrapS=s(l.wrap[0],TH),d.wrapT=s(l.wrap[1],TH)),l.format!==void 0&&(d.format=l.format),l.internalFormat!==void 0&&(d.internalFormat=l.internalFormat),l.type!==void 0&&(d.type=l.type),l.colorSpace!==void 0&&(d.colorSpace=l.colorSpace),l.minFilter!==void 0&&(d.minFilter=s(l.minFilter,EH)),l.magFilter!==void 0&&(d.magFilter=s(l.magFilter,EH)),l.anisotropy!==void 0&&(d.anisotropy=l.anisotropy),l.flipY!==void 0&&(d.flipY=l.flipY),l.generateMipmaps!==void 0&&(d.generateMipmaps=l.generateMipmaps),l.premultiplyAlpha!==void 0&&(d.premultiplyAlpha=l.premultiplyAlpha),l.unpackAlignment!==void 0&&(d.unpackAlignment=l.unpackAlignment),l.compareFunction!==void 0&&(d.compareFunction=l.compareFunction),l.userData!==void 0&&(d.userData=l.userData),r[l.uuid]=d}return r}parseObject(e,i,s,r,o){let a;function l(p){return i[p]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",p),i[p]}function c(p){if(p!==void 0){if(Array.isArray(p)){const g=[];for(let f=0,A=p.length;f<A;f++){const y=p[f];s[y]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",y),g.push(s[y])}return g}return s[p]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",p),s[p]}}function h(p){return r[p]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",p),r[p]}let d,u;switch(e.type){case"Scene":a=new ir,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new fe(e.background):a.background=h(e.background)),e.environment!==void 0&&(a.environment=h(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new FI(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new Gk(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(a.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new Ot(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new lh(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new S1(e.color,e.intensity);break;case"DirectionalLight":a=new um(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new dm(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new WP(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new Gf(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new fT(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new HP().fromJSON(e);break;case"SkinnedMesh":d=l(e.geometry),u=c(e.material),a=new Ka(d,u),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":d=l(e.geometry),u=c(e.material),a=new pe(d,u);break;case"InstancedMesh":d=l(e.geometry),u=c(e.material);const p=e.count,g=e.instanceMatrix,f=e.instanceColor;a=new dP(d,u,p),a.instanceMatrix=new Yo(new Float32Array(g.array),16),f!==void 0&&(a.instanceColor=new Yo(new Float32Array(f.array),f.itemSize));break;case"BatchedMesh":d=l(e.geometry),u=c(e.material),a=new u1(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,u),a.geometry=d,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._visibility=e.visibility,a._active=e.active,a._bounds=e.bounds.map(A=>{const y=new gi;y.min.fromArray(A.boxMin),y.max.fromArray(A.boxMax);const b=new Vn;return b.radius=A.sphereRadius,b.center.fromArray(A.sphereCenter),{boxInitialized:A.boxInitialized,box:y,sphereInitialized:A.sphereInitialized,sphere:b}}),a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._geometryCount=e.geometryCount,a._matricesTexture=h(e.matricesTexture.uuid),e.colorsTexture!==void 0&&(a._colorsTexture=h(e.colorsTexture.uuid));break;case"LOD":a=new lP;break;case"Line":a=new is(l(e.geometry),c(e.material));break;case"LineLoop":a=new fP(l(e.geometry),c(e.material));break;case"LineSegments":a=new Jo(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":a=new Ey(l(e.geometry),c(e.material));break;case"Sprite":a=new aP(c(e.material));break;case"Group":a=new Es;break;case"Bone":a=new Tf;break;default:a=new Ae}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(a.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const p=e.children;for(let g=0;g<p.length;g++)a.add(this.parseObject(p[g],i,s,r,o))}if(e.animations!==void 0){const p=e.animations;for(let g=0;g<p.length;g++){const f=p[g];a.animations.push(o[f])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const p=e.levels;for(let g=0;g<p.length;g++){const f=p[g],A=a.getObjectByProperty("uuid",f.object);A!==void 0&&a.addLevel(A,f.distance,f.hysteresis)}}return a}bindSkeletons(e,i){Object.keys(i).length!==0&&e.traverse(function(s){if(s.isSkinnedMesh===!0&&s.skeleton!==void 0){const r=i[s.skeleton];r===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",s.skeleton):s.bind(r,s.bindMatrix)}})}bindLightTargets(e){e.traverse(function(i){if(i.isDirectionalLight||i.isSpotLight){const s=i.target,r=e.getObjectByProperty("uuid",s);r!==void 0?i.target=r:i.target=new Ae}})}}const Jge={UVMapping:DM,CubeReflectionMapping:bl,CubeRefractionMapping:gc,EquirectangularReflectionMapping:ao,EquirectangularRefractionMapping:Yp,CubeUVReflectionMapping:cf},TH={RepeatWrapping:lo,ClampToEdgeWrapping:Wo,MirroredRepeatWrapping:bu},EH={NearestFilter:si,NearestMipmapNearestFilter:Rx,NearestMipmapLinearFilter:id,LinearFilter:Wt,LinearMipmapNearestFilter:vu,LinearMipmapLinearFilter:Ar};let RH=class extends fs{constructor(n){super(n),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(n){return this.options=n,this}load(n,e,i,s){n===void 0&&(n=""),this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const r=this,o=Lu.get(n);if(o!==void 0){if(r.manager.itemStart(n),o.then){o.then(c=>{e&&e(c),r.manager.itemEnd(n)}).catch(c=>{s&&s(c)});return}return setTimeout(function(){e&&e(o),r.manager.itemEnd(n)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(n,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(c){return Lu.add(n,c),e&&e(c),r.manager.itemEnd(n),c}).catch(function(c){s&&s(c),Lu.remove(n),r.manager.itemError(n),r.manager.itemEnd(n)});Lu.add(n,l),r.manager.itemStart(n)}},yT;class bT{static getContext(){return yT===void 0&&(yT=new(window.AudioContext||window.webkitAudioContext)),yT}static setContext(e){yT=e}}class vT extends fs{constructor(e){super(e)}load(e,i,s,r){const o=this,a=new Rs(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{const h=c.slice(0);bT.getContext().decodeAudioData(h,function(d){i(d)}).catch(l)}catch(h){l(h)}},s,r);function l(c){r?r(c):console.error(c),o.manager.itemError(e)}}}const LH=new de,BH=new de,Pf=new de;class QP{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ot,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ot,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const i=this._cache;if(i.focus!==e.focus||i.fov!==e.fov||i.aspect!==e.aspect*this.aspect||i.near!==e.near||i.far!==e.far||i.zoom!==e.zoom||i.eyeSep!==this.eyeSep){i.focus=e.focus,i.fov=e.fov,i.aspect=e.aspect*this.aspect,i.near=e.near,i.far=e.far,i.zoom=e.zoom,i.eyeSep=this.eyeSep,Pf.copy(e.projectionMatrix);const s=i.eyeSep/2,r=s*i.near/i.focus,o=i.near*Math.tan(ff*i.fov*.5)/i.zoom;let a,l;BH.elements[12]=-s,LH.elements[12]=s,a=-o*i.aspect+r,l=o*i.aspect+r,Pf.elements[0]=2*i.near/(l-a),Pf.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(Pf),a=-o*i.aspect-r,l=o*i.aspect-r,Pf.elements[0]=2*i.near/(l-a),Pf.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(Pf)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(BH),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(LH)}}let KP=class{constructor(n=!0){this.autoStart=n,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=kH(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let n=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=kH();n=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=n}return n}};function kH(){return performance.now()}const hd=new E,GH=new Fe,qge=new E,Nf=new E;let PH=class extends Ae{constructor(){super(),this.type="AudioListener",this.context=bT.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new KP}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(n){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=n,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(n){return this.gain.gain.setTargetAtTime(n,this.context.currentTime,.01),this}updateMatrixWorld(n){super.updateMatrixWorld(n);const e=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(hd,GH,qge),!(!Number.isFinite(hd.x)||!Number.isFinite(hd.y)||!Number.isFinite(hd.z)))if(Nf.set(0,0,-1).applyQuaternion(GH),e.positionX){const s=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(hd.x,s),e.positionY.linearRampToValueAtTime(hd.y,s),e.positionZ.linearRampToValueAtTime(hd.z,s),e.forwardX.linearRampToValueAtTime(Nf.x,s),e.forwardY.linearRampToValueAtTime(Nf.y,s),e.forwardZ.linearRampToValueAtTime(Nf.z,s),e.upX.linearRampToValueAtTime(i.x,s),e.upY.linearRampToValueAtTime(i.y,s),e.upZ.linearRampToValueAtTime(i.z,s)}else e.setPosition(hd.x,hd.y,hd.z),e.setOrientation(Nf.x,Nf.y,Nf.z,i.x,i.y,i.z)}},YP=class extends Ae{constructor(n){super(),this.type="Audio",this.listener=n,this.context=n.context,this.gain=this.context.createGain(),this.gain.connect(n.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(n){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=n,this.connect(),this}setMediaElementSource(n){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(n),this.connect(),this}setMediaStreamSource(n){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(n),this.connect(),this}setBuffer(n){return this.buffer=n,this.sourceType="buffer",this.autoplay&&this.play(),this}play(n=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+n;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||(this.buffer?this.buffer.duration:Number.MAX_VALUE))),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(n=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+n),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let n=1,e=this.filters.length;n<e;n++)this.filters[n-1].connect(this.filters[n]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let n=1,e=this.filters.length;n<e;n++)this.filters[n-1].disconnect(this.filters[n]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(n){return n||(n=[]),this._connected===!0?(this.disconnect(),this.filters=n.slice(),this.connect()):this.filters=n.slice(),this}setDetune(n){return this.detune=n,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(n){return this.setFilters(n?[n]:[])}setPlaybackRate(n){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=n,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(n){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=n,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(n){return this.loopStart=n,this}setLoopEnd(n){return this.loopEnd=n,this}getVolume(){return this.gain.gain.value}setVolume(n){return this.gain.gain.setTargetAtTime(n,this.context.currentTime,.01),this}};const Vf=new E,NH=new Fe,$ge=new E,Xf=new E;class VH extends YP{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,i,s){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=s,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Vf,NH,$ge),Xf.set(0,0,1).applyQuaternion(NH);const i=this.panner;if(i.positionX){const s=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(Vf.x,s),i.positionY.linearRampToValueAtTime(Vf.y,s),i.positionZ.linearRampToValueAtTime(Vf.z,s),i.orientationX.linearRampToValueAtTime(Xf.x,s),i.orientationY.linearRampToValueAtTime(Xf.y,s),i.orientationZ.linearRampToValueAtTime(Xf.z,s)}else i.setPosition(Vf.x,Vf.y,Vf.z),i.setOrientation(Xf.x,Xf.y,Xf.z)}}class efe{constructor(e,i=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const i=this.getFrequencyData();for(let s=0;s<i.length;s++)e+=i[s];return e/i.length}}class XH{constructor(e,i,s){this.binding=e,this.valueSize=s;let r,o,a;switch(i){case"quaternion":r=this._slerp,o=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(s*6),this._workIndex=5;break;case"string":case"bool":r=this._select,o=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(s*5);break;default:r=this._lerp,o=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(s*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=o,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,i){const s=this.buffer,r=this.valueSize,o=e*r+r;let a=this.cumulativeWeight;if(a===0){for(let l=0;l!==r;++l)s[o+l]=s[l];a=i}else{a+=i;const l=i/a;this._mixBufferRegion(s,o,0,l,r)}this.cumulativeWeight=a}accumulateAdditive(e){const i=this.buffer,s=this.valueSize,r=s*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,r,0,e,s),this.cumulativeWeightAdditive+=e}apply(e){const i=this.valueSize,s=this.buffer,r=e*i+i,o=this.cumulativeWeight,a=this.cumulativeWeightAdditive,l=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const c=i*this._origIndex;this._mixBufferRegion(s,r,c,1-o,i)}a>0&&this._mixBufferRegionAdditive(s,r,this._addIndex*i,1,i);for(let c=i,h=i+i;c!==h;++c)if(s[c]!==s[c+i]){l.setValue(s,r);break}}saveOriginalState(){const e=this.binding,i=this.buffer,s=this.valueSize,r=s*this._origIndex;e.getValue(i,r);for(let o=s,a=r;o!==a;++o)i[o]=i[r+o%s];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,i=e+this.valueSize;for(let s=e;s<i;s++)this.buffer[s]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let s=0;s<this.valueSize;s++)this.buffer[i+s]=this.buffer[e+s]}_select(e,i,s,r,o){if(r>=.5)for(let a=0;a!==o;++a)e[i+a]=e[s+a]}_slerp(e,i,s,r){Fe.slerpFlat(e,i,e,i,e,s,r)}_slerpAdditive(e,i,s,r,o){const a=this._workIndex*o;Fe.multiplyQuaternionsFlat(e,a,e,i,e,s),Fe.slerpFlat(e,i,e,i,e,a,r)}_lerp(e,i,s,r,o){const a=1-r;for(let l=0;l!==o;++l){const c=i+l;e[c]=e[c]*a+e[s+l]*r}}_lerpAdditive(e,i,s,r,o){for(let a=0;a!==o;++a){const l=i+a;e[l]=e[l]+e[s+a]*r}}}const jP="\\[\\]\\.:\\/",tfe=new RegExp("["+jP+"]","g"),JP="[^"+jP+"]",ife="[^"+jP.replace("\\.","")+"]",nfe=/((?:WC+[\/:])*)/.source.replace("WC",JP),sfe=/(WCOD+)?/.source.replace("WCOD",ife),rfe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",JP),ofe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",JP),afe=new RegExp("^"+nfe+sfe+rfe+ofe+"$"),lfe=["material","materials","bones","map"];let cfe=class{constructor(n,e,i){const s=i||xi.parseTrackName(e);this._targetGroup=n,this._bindings=n.subscribe_(e,s)}getValue(n,e){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];s!==void 0&&s.getValue(n,e)}setValue(n,e){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=i.length;s!==r;++s)i[s].setValue(n,e)}bind(){const n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=n.length;e!==i;++e)n[e].bind()}unbind(){const n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=n.length;e!==i;++e)n[e].unbind()}},xi=class bx{constructor(e,i,s){this.path=i,this.parsedPath=s||bx.parseTrackName(i),this.node=bx.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,s){return e&&e.isAnimationObjectGroup?new bx.Composite(e,i,s):new bx(e,i,s)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(tfe,"")}static parseTrackName(e){const i=afe.exec(e);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const s={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},r=s.nodeName&&s.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const o=s.nodeName.substring(r+1);lfe.indexOf(o)!==-1&&(s.nodeName=s.nodeName.substring(0,r),s.objectName=o)}if(s.propertyName===null||s.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return s}static findNode(e,i){if(i===void 0||i===""||i==="."||i===-1||i===e.name||i===e.uuid)return e;if(e.skeleton){const s=e.skeleton.getBoneByName(i);if(s!==void 0)return s}if(e.children){const s=function(o,a){for(let l=0;l<o.length;l++){const c=o[l];if(!a&&(c.name===i||c.uuid===i)||a&&c.userData&&c.userData.name===i)return c;const h=s(c.children,a);if(h)return h}return null},r=s(e.children);if(r)return r;{const o=s(e.children,!0);if(o)return o}}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)e[i++]=s[r]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)s[r]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)s[r]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)s[r]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,s=i.objectName,r=i.propertyName;let o=i.propertyIndex;if(e||(e=bx.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(s){let h=i.objectIndex;switch(s){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let d=0;d<e.length;d++)if(e[d].name===h){h=d;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[s]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[s]}if(h!==void 0){if(e[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[h]}}const a=e[r];if(a===void 0){const h=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+r+" but it wasn't found.",e);return}let l=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?l=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(l=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(o!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else a.fromArray!==void 0&&a.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};xi.Composite=cfe,xi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},xi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},xi.prototype.GetterByBindingType=[xi.prototype._getValue_direct,xi.prototype._getValue_array,xi.prototype._getValue_arrayElement,xi.prototype._getValue_toArray],xi.prototype.SetterByBindingTypeAndVersioning=[[xi.prototype._setValue_direct,xi.prototype._setValue_direct_setNeedsUpdate,xi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[xi.prototype._setValue_array,xi.prototype._setValue_array_setNeedsUpdate,xi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[xi.prototype._setValue_arrayElement,xi.prototype._setValue_arrayElement_setNeedsUpdate,xi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[xi.prototype._setValue_fromArray,xi.prototype._setValue_fromArray_setNeedsUpdate,xi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class hfe{constructor(){this.isAnimationObjectGroup=!0,this.uuid=xl(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let s=0,r=arguments.length;s!==r;++s)e[arguments[s].uuid]=s;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){const e=this._objects,i=this._indicesByUUID,s=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length;let l,c=e.length,h=this.nCachedObjects_;for(let d=0,u=arguments.length;d!==u;++d){const p=arguments[d],g=p.uuid;let f=i[g];if(f===void 0){f=c++,i[g]=f,e.push(p);for(let A=0,y=a;A!==y;++A)o[A].push(new xi(p,s[A],r[A]))}else if(f<h){l=e[f];const A=--h,y=e[A];i[y.uuid]=f,e[f]=y,i[g]=A,e[A]=p;for(let b=0,v=a;b!==v;++b){const x=o[b],w=x[A];let C=x[f];x[f]=w,C===void 0&&(C=new xi(p,s[b],r[b])),x[A]=C}}else e[f]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=h}remove(){const e=this._objects,i=this._indicesByUUID,s=this._bindings,r=s.length;let o=this.nCachedObjects_;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],h=c.uuid,d=i[h];if(d!==void 0&&d>=o){const u=o++,p=e[u];i[p.uuid]=d,e[d]=p,i[h]=u,e[u]=c;for(let g=0,f=r;g!==f;++g){const A=s[g],y=A[u],b=A[d];A[d]=y,A[u]=b}}}this.nCachedObjects_=o}uncache(){const e=this._objects,i=this._indicesByUUID,s=this._bindings,r=s.length;let o=this.nCachedObjects_,a=e.length;for(let l=0,c=arguments.length;l!==c;++l){const h=arguments[l],d=h.uuid,u=i[d];if(u!==void 0)if(delete i[d],u<o){const p=--o,g=e[p],f=--a,A=e[f];i[g.uuid]=u,e[u]=g,i[A.uuid]=p,e[p]=A,e.pop();for(let y=0,b=r;y!==b;++y){const v=s[y],x=v[p],w=v[f];v[u]=x,v[p]=w,v.pop()}}else{const p=--a,g=e[p];p>0&&(i[g.uuid]=u),e[u]=g,e.pop();for(let f=0,A=r;f!==A;++f){const y=s[f];y[u]=y[p],y.pop()}}}this.nCachedObjects_=o}subscribe_(e,i){const s=this._bindingsIndicesByPath;let r=s[e];const o=this._bindings;if(r!==void 0)return o[r];const a=this._paths,l=this._parsedPaths,c=this._objects,h=c.length,d=this.nCachedObjects_,u=new Array(h);r=o.length,s[e]=r,a.push(e),l.push(i),o.push(u);for(let p=d,g=c.length;p!==g;++p){const f=c[p];u[p]=new xi(f,e,i)}return u}unsubscribe_(e){const i=this._bindingsIndicesByPath,s=i[e];if(s!==void 0){const r=this._paths,o=this._parsedPaths,a=this._bindings,l=a.length-1,c=a[l],h=e[l];i[h]=s,a[s]=c,a.pop(),o[s]=o[l],o.pop(),r[s]=r[l],r.pop()}}}class DH{constructor(e,i,s=null,r=i.blendMode){this._mixer=e,this._clip=i,this._localRoot=s,this.blendMode=r;const o=i.tracks,a=o.length,l=new Array(a),c={endingStart:pf,endingEnd:pf};for(let h=0;h!==a;++h){const d=o[h].createInterpolant(null);l[h]=d,d.settings=c}this._interpolantSettings=c,this._interpolants=l,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=AG,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,i){return this.loop=e,this.repetitions=i,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,i,s){if(e.fadeOut(i),this.fadeIn(i),s){const r=this._clip.duration,o=e._clip.duration,a=o/r,l=r/o;e.warp(1,a,i),this.warp(l,1,i)}return this}crossFadeTo(e,i,s){return e.crossFadeFrom(this,i,s)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,i,s){const r=this._mixer,o=r.time,a=this.timeScale;let l=this._timeScaleInterpolant;l===null&&(l=r._lendControlInterpolant(),this._timeScaleInterpolant=l);const c=l.parameterPositions,h=l.sampleValues;return c[0]=o,c[1]=o+s,h[0]=e/a,h[1]=i/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,i,s,r){if(!this.enabled){this._updateWeight(e);return}const o=this._startTime;if(o!==null){const c=(e-o)*s;c<0||s===0?i=0:(this._startTime=null,i=s*c)}i*=this._updateTimeScale(e);const a=this._updateTime(i),l=this._updateWeight(e);if(l>0){const c=this._interpolants,h=this._propertyBindings;switch(this.blendMode){case yG:for(let d=0,u=c.length;d!==u;++d)c[d].evaluate(a),h[d].accumulateAdditive(l);break;case cI:default:for(let d=0,u=c.length;d!==u;++d)c[d].evaluate(a),h[d].accumulate(r,l)}}}_updateWeight(e){let i=0;if(this.enabled){i=this.weight;const s=this._weightInterpolant;if(s!==null){const r=s.evaluate(e)[0];i*=r,e>s.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(e){let i=0;if(!this.paused){i=this.timeScale;const s=this._timeScaleInterpolant;if(s!==null){const r=s.evaluate(e)[0];i*=r,e>s.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(e){const i=this._clip.duration,s=this.loop;let r=this.time+e,o=this._loopCount;const a=s===gW;if(e===0)return o===-1?r:a&&(o&1)===1?i-r:r;if(s===zx){o===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=i)r=i;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(o===-1&&(e>=0?(o=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),r>=i||r<0){const l=Math.floor(r/i);r-=i*l,o+=Math.abs(l);const c=this.repetitions-o;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?i:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(c===1){const h=e<0;this._setEndings(h,!h,a)}else this._setEndings(!1,!1,a);this._loopCount=o,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:l})}}else this.time=r;if(a&&(o&1)===1)return i-r}return r}_setEndings(e,i,s){const r=this._interpolantSettings;s?(r.endingStart=mf,r.endingEnd=mf):(e?r.endingStart=this.zeroSlopeAtStart?mf:pf:r.endingStart=Fx,i?r.endingEnd=this.zeroSlopeAtEnd?mf:pf:r.endingEnd=Fx)}_scheduleFading(e,i,s){const r=this._mixer,o=r.time;let a=this._weightInterpolant;a===null&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=o,c[0]=i,l[1]=o+e,c[1]=s,this}}const dfe=new Float32Array(1);class xT extends yr{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,i){const s=e._localRoot||this._root,r=e._clip.tracks,o=r.length,a=e._propertyBindings,l=e._interpolants,c=s.uuid,h=this._bindingsByRootAndName;let d=h[c];d===void 0&&(d={},h[c]=d);for(let u=0;u!==o;++u){const p=r[u],g=p.name;let f=d[g];if(f!==void 0)++f.referenceCount,a[u]=f;else{if(f=a[u],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,c,g));continue}const A=i&&i._propertyBindings[u].binding.parsedPath;f=new XH(xi.create(s,g,A),p.ValueTypeName,p.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,c,g),a[u]=f}l[u].resultBuffer=f.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const s=(e._localRoot||this._root).uuid,r=e._clip.uuid,o=this._actionsByClip[r];this._bindAction(e,o&&o.knownActions[0]),this._addInactiveAction(e,r,s)}const i=e._propertyBindings;for(let s=0,r=i.length;s!==r;++s){const o=i[s];o.useCount++===0&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const i=e._propertyBindings;for(let s=0,r=i.length;s!==r;++s){const o=i[s];--o.useCount===0&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const i=e._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(e,i,s){const r=this._actions,o=this._actionsByClip;let a=o[i];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[i]=a;else{const l=a.knownActions;e._byClipCacheIndex=l.length,l.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[s]=e}_removeInactiveAction(e){const i=this._actions,s=i[i.length-1],r=e._cacheIndex;s._cacheIndex=r,i[r]=s,i.pop(),e._cacheIndex=null;const o=e._clip.uuid,a=this._actionsByClip,l=a[o],c=l.knownActions,h=c[c.length-1],d=e._byClipCacheIndex;h._byClipCacheIndex=d,c[d]=h,c.pop(),e._byClipCacheIndex=null;const u=l.actionByRoot,p=(e._localRoot||this._root).uuid;delete u[p],c.length===0&&delete a[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const i=e._propertyBindings;for(let s=0,r=i.length;s!==r;++s){const o=i[s];--o.referenceCount===0&&this._removeInactiveBinding(o)}}_lendAction(e){const i=this._actions,s=e._cacheIndex,r=this._nActiveActions++,o=i[r];e._cacheIndex=r,i[r]=e,o._cacheIndex=s,i[s]=o}_takeBackAction(e){const i=this._actions,s=e._cacheIndex,r=--this._nActiveActions,o=i[r];e._cacheIndex=r,i[r]=e,o._cacheIndex=s,i[s]=o}_addInactiveBinding(e,i,s){const r=this._bindingsByRootAndName,o=this._bindings;let a=r[i];a===void 0&&(a={},r[i]=a),a[s]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const i=this._bindings,s=e.binding,r=s.rootNode.uuid,o=s.path,a=this._bindingsByRootAndName,l=a[r],c=i[i.length-1],h=e._cacheIndex;c._cacheIndex=h,i[h]=c,i.pop(),delete l[o],Object.keys(l).length===0&&delete a[r]}_lendBinding(e){const i=this._bindings,s=e._cacheIndex,r=this._nActiveBindings++,o=i[r];e._cacheIndex=r,i[r]=e,o._cacheIndex=s,i[s]=o}_takeBackBinding(e){const i=this._bindings,s=e._cacheIndex,r=--this._nActiveBindings,o=i[r];e._cacheIndex=r,i[r]=e,o._cacheIndex=s,i[s]=o}_lendControlInterpolant(){const e=this._controlInterpolants,i=this._nActiveControlInterpolants++;let s=e[i];return s===void 0&&(s=new DP(new Float32Array(2),new Float32Array(2),1,dfe),s.__cacheIndex=i,e[i]=s),s}_takeBackControlInterpolant(e){const i=this._controlInterpolants,s=e.__cacheIndex,r=--this._nActiveControlInterpolants,o=i[r];e.__cacheIndex=r,i[r]=e,o.__cacheIndex=s,i[s]=o}clipAction(e,i,s){const r=i||this._root,o=r.uuid;let a=typeof e=="string"?wa.findByName(r,e):e;const l=a!==null?a.uuid:e,c=this._actionsByClip[l];let h=null;if(s===void 0&&(a!==null?s=a.blendMode:s=cI),c!==void 0){const u=c.actionByRoot[o];if(u!==void 0&&u.blendMode===s)return u;h=c.knownActions[0],a===null&&(a=h._clip)}if(a===null)return null;const d=new DH(this,a,i,s);return this._bindAction(d,h),this._addInactiveAction(d,l,o),d}existingAction(e,i){const s=i||this._root,r=s.uuid,o=typeof e=="string"?wa.findByName(s,e):e,a=o?o.uuid:e,l=this._actionsByClip[a];return l!==void 0&&l.actionByRoot[r]||null}stopAllAction(){const e=this._actions,i=this._nActiveActions;for(let s=i-1;s>=0;--s)e[s].stop();return this}update(e){e*=this.timeScale;const i=this._actions,s=this._nActiveActions,r=this.time+=e,o=Math.sign(e),a=this._accuIndex^=1;for(let h=0;h!==s;++h)i[h]._update(r,e,o,a);const l=this._bindings,c=this._nActiveBindings;for(let h=0;h!==c;++h)l[h].apply(a);return this}setTime(e){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const i=this._actions,s=e.uuid,r=this._actionsByClip,o=r[s];if(o!==void 0){const a=o.knownActions;for(let l=0,c=a.length;l!==c;++l){const h=a[l];this._deactivateAction(h);const d=h._cacheIndex,u=i[i.length-1];h._cacheIndex=null,h._byClipCacheIndex=null,u._cacheIndex=d,i[d]=u,i.pop(),this._removeInactiveBindingsForAction(h)}delete r[s]}}uncacheRoot(e){const i=e.uuid,s=this._actionsByClip;for(const a in s){const l=s[a].actionByRoot,c=l[i];c!==void 0&&(this._deactivateAction(c),this._removeInactiveAction(c))}const r=this._bindingsByRootAndName,o=r[i];if(o!==void 0)for(const a in o){const l=o[a];l.restoreOriginalState(),this._removeInactiveBinding(l)}}uncacheAction(e,i){const s=this.existingAction(e,i);s!==null&&(this._deactivateAction(s),this._removeInactiveAction(s))}}let Te=class tce{constructor(e){this.value=e}clone(){return new tce(this.value.clone===void 0?this.value:this.value.clone())}},ufe=0;class pfe extends yr{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:ufe++}),this.name="",this.usage=iy,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const i=this.uniforms.indexOf(e);return i!==-1&&this.uniforms.splice(i,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const i=e.uniforms;this.uniforms.length=0;for(let s=0,r=i.length;s<r;s++){const o=Array.isArray(i[s])?i[s]:[i[s]];for(let a=0;a<o.length;a++)this.uniforms.push(o[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class _1 extends Cy{constructor(e,i,s=1){super(e,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const i=super.clone(e);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(e){const i=super.toJSON(e);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class mfe{constructor(e,i,s,r,o){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=i,this.itemSize=s,this.elementSize=r,this.count=o,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,i){return this.type=e,this.elementSize=i,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const zH=new de;let pm=class{constructor(n,e,i=0,s=1/0){this.ray=new ya(n,e),this.near=i,this.far=s,this.camera=null,this.layers=new Qo,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(n,e){this.ray.set(n,e)}setFromCamera(n,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(n.x,n.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(n.x,n.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(n){return zH.identity().extractRotation(n.matrixWorld),this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(zH),this}intersectObject(n,e=!0,i=[]){return qP(n,this,i,e),i.sort(FH),i}intersectObjects(n,e=!0,i=[]){for(let s=0,r=n.length;s<r;s++)qP(n[s],this,i,e);return i.sort(FH),i}};function FH(n,e){return n.distance-e.distance}function qP(n,e,i,s){let r=!0;if(n.layers.test(e.layers)&&n.raycast(e,i)===!1&&(r=!1),r===!0&&s===!0){const o=n.children;for(let a=0,l=o.length;a<l;a++)qP(o[a],e,i,!0)}}class $P{constructor(e=1,i=0,s=0){return this.radius=e,this.phi=i,this.theta=s,this}set(e,i,s){return this.radius=e,this.phi=i,this.theta=s,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,s){return this.radius=Math.sqrt(e*e+i*i+s*s),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,s),this.phi=Math.acos(Ts(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class gfe{constructor(e=1,i=0,s=0){return this.radius=e,this.theta=i,this.y=s,this}set(e,i,s){return this.radius=e,this.theta=i,this.y=s,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,s){return this.radius=Math.sqrt(e*e+s*s),this.theta=Math.atan2(e,s),this.y=i,this}clone(){return new this.constructor().copy(this)}}class NZ{constructor(e,i,s,r){NZ.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,i,s,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,i=0){for(let s=0;s<4;s++)this.elements[s]=e[s+i];return this}set(e,i,s,r){const o=this.elements;return o[0]=e,o[2]=i,o[1]=s,o[3]=r,this}}const UH=new Q;class ffe{constructor(e=new Q(1/0,1/0),i=new Q(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromPoints(e){this.makeEmpty();for(let i=0,s=e.length;i<s;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const s=UH.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(s),this.max.copy(e).add(s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,UH).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const OH=new E,wT=new E;class vc{constructor(e=new E,i=new E){this.start=e,this.end=i}set(e,i){return this.start.copy(e),this.end.copy(i),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,i){return this.delta(i).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,i){OH.subVectors(e,this.start),wT.subVectors(this.end,this.start);const s=wT.dot(wT);let r=wT.dot(OH)/s;return i&&(r=Ts(r,0,1)),r}closestPointToPoint(e,i,s){const r=this.closestPointToPointParameter(e,i);return this.delta(s).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const ZH=new E;class Afe extends Ae{constructor(e,i){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";const s=new Rt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,l=1,c=32;a<c;a++,l++){const h=a/c*Math.PI*2,d=l/c*Math.PI*2;r.push(Math.cos(h),Math.sin(h),1,Math.cos(d),Math.sin(d),1)}s.setAttribute("position",new dt(r,3));const o=new Cn({fog:!1,toneMapped:!1});this.cone=new Jo(s,o),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,i=e*Math.tan(this.light.angle);this.cone.scale.set(i,i,e),ZH.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ZH),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const mm=new E,CT=new de,eN=new de;class yfe extends Jo{constructor(e){const i=WH(e),s=new Rt,r=[],o=[],a=new fe(0,0,1),l=new fe(0,1,0);for(let h=0;h<i.length;h++){const d=i[h];d.parent&&d.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),o.push(a.r,a.g,a.b),o.push(l.r,l.g,l.b))}s.setAttribute("position",new dt(r,3)),s.setAttribute("color",new dt(o,3));const c=new Cn({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(s,c),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=i,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const i=this.bones,s=this.geometry,r=s.getAttribute("position");eN.copy(this.root.matrixWorld).invert();for(let o=0,a=0;o<i.length;o++){const l=i[o];l.parent&&l.parent.isBone&&(CT.multiplyMatrices(eN,l.matrixWorld),mm.setFromMatrixPosition(CT),r.setXYZ(a,mm.x,mm.y,mm.z),CT.multiplyMatrices(eN,l.parent.matrixWorld),mm.setFromMatrixPosition(CT),r.setXYZ(a+1,mm.x,mm.y,mm.z),a+=2)}s.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function WH(n){const e=[];n.isBone===!0&&e.push(n);for(let i=0;i<n.children.length;i++)e.push.apply(e,WH(n.children[i]));return e}class bfe extends pe{constructor(e,i,s){const r=new eh(i,4,2),o=new ai({wireframe:!0,fog:!1,toneMapped:!1});super(r,o),this.light=e,this.color=s,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const vfe=new E,HH=new fe,QH=new fe;class xfe extends Ae{constructor(e,i,s){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=s,this.type="HemisphereLightHelper";const r=new Np(i);r.rotateY(Math.PI*.5),this.material=new ai({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const o=r.getAttribute("position"),a=new Float32Array(o.count*3);r.setAttribute("color",new ct(a,3)),this.add(new pe(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const i=e.geometry.getAttribute("color");HH.copy(this.light.color),QH.copy(this.light.groundColor);for(let s=0,r=i.count;s<r;s++){const o=s<r/2?HH:QH;i.setXYZ(s,o.r,o.g,o.b)}i.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(vfe.setFromMatrixPosition(this.light.matrixWorld).negate())}}let ST=class extends Jo{constructor(n=10,e=10,i=4473924,s=8947848){i=new fe(i),s=new fe(s);const r=e/2,o=n/e,a=n/2,l=[],c=[];for(let u=0,p=0,g=-a;u<=e;u++,g+=o){l.push(-a,0,g,a,0,g),l.push(g,0,-a,g,0,a);const f=u===r?i:s;f.toArray(c,p),p+=3,f.toArray(c,p),p+=3,f.toArray(c,p),p+=3,f.toArray(c,p),p+=3}const h=new Rt;h.setAttribute("position",new dt(l,3)),h.setAttribute("color",new dt(c,3));const d=new Cn({vertexColors:!0,toneMapped:!1});super(h,d),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}};class wfe extends Jo{constructor(e=10,i=16,s=8,r=64,o=4473924,a=8947848){o=new fe(o),a=new fe(a);const l=[],c=[];if(i>1)for(let u=0;u<i;u++){const p=u/i*(Math.PI*2),g=Math.sin(p)*e,f=Math.cos(p)*e;l.push(0,0,0),l.push(g,0,f);const A=u&1?o:a;c.push(A.r,A.g,A.b),c.push(A.r,A.g,A.b)}for(let u=0;u<s;u++){const p=u&1?o:a,g=e-e/s*u;for(let f=0;f<r;f++){let A=f/r*(Math.PI*2),y=Math.sin(A)*g,b=Math.cos(A)*g;l.push(y,0,b),c.push(p.r,p.g,p.b),A=(f+1)/r*(Math.PI*2),y=Math.sin(A)*g,b=Math.cos(A)*g,l.push(y,0,b),c.push(p.r,p.g,p.b)}}const h=new Rt;h.setAttribute("position",new dt(l,3)),h.setAttribute("color",new dt(c,3));const d=new Cn({vertexColors:!0,toneMapped:!1});super(h,d),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const KH=new E,_T=new E,YH=new E;class jH extends Ae{constructor(e,i,s){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=s,this.type="DirectionalLightHelper",i===void 0&&(i=1);let r=new Rt;r.setAttribute("position",new dt([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));const o=new Cn({fog:!1,toneMapped:!1});this.lightPlane=new is(r,o),this.add(this.lightPlane),r=new Rt,r.setAttribute("position",new dt([0,0,0,0,0,1],3)),this.targetLine=new is(r,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),KH.setFromMatrixPosition(this.light.matrixWorld),_T.setFromMatrixPosition(this.light.target.matrixWorld),YH.subVectors(_T,KH),this.lightPlane.lookAt(_T),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_T),this.targetLine.scale.z=YH.length()}}const MT=new E,Ls=new t1;class JH extends Jo{constructor(e){const i=new Rt,s=new Cn({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],o=[],a={};l("n1","n2"),l("n2","n4"),l("n4","n3"),l("n3","n1"),l("f1","f2"),l("f2","f4"),l("f4","f3"),l("f3","f1"),l("n1","f1"),l("n2","f2"),l("n3","f3"),l("n4","f4"),l("p","n1"),l("p","n2"),l("p","n3"),l("p","n4"),l("u1","u2"),l("u2","u3"),l("u3","u1"),l("c","t"),l("p","c"),l("cn1","cn2"),l("cn3","cn4"),l("cf1","cf2"),l("cf3","cf4");function l(f,A){c(f),c(A)}function c(f){r.push(0,0,0),o.push(0,0,0),a[f]===void 0&&(a[f]=[]),a[f].push(r.length/3-1)}i.setAttribute("position",new dt(r,3)),i.setAttribute("color",new dt(o,3)),super(i,s),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const h=new fe(16755200),d=new fe(16711680),u=new fe(43775),p=new fe(16777215),g=new fe(3355443);this.setColors(h,d,u,p,g)}setColors(e,i,s,r,o){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,i.r,i.g,i.b),a.setXYZ(25,i.r,i.g,i.b),a.setXYZ(26,i.r,i.g,i.b),a.setXYZ(27,i.r,i.g,i.b),a.setXYZ(28,i.r,i.g,i.b),a.setXYZ(29,i.r,i.g,i.b),a.setXYZ(30,i.r,i.g,i.b),a.setXYZ(31,i.r,i.g,i.b),a.setXYZ(32,s.r,s.g,s.b),a.setXYZ(33,s.r,s.g,s.b),a.setXYZ(34,s.r,s.g,s.b),a.setXYZ(35,s.r,s.g,s.b),a.setXYZ(36,s.r,s.g,s.b),a.setXYZ(37,s.r,s.g,s.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,o.r,o.g,o.b),a.setXYZ(41,o.r,o.g,o.b),a.setXYZ(42,o.r,o.g,o.b),a.setXYZ(43,o.r,o.g,o.b),a.setXYZ(44,o.r,o.g,o.b),a.setXYZ(45,o.r,o.g,o.b),a.setXYZ(46,o.r,o.g,o.b),a.setXYZ(47,o.r,o.g,o.b),a.setXYZ(48,o.r,o.g,o.b),a.setXYZ(49,o.r,o.g,o.b),a.needsUpdate=!0}update(){const e=this.geometry,i=this.pointMap,s=1,r=1;Ls.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Os("c",i,e,Ls,0,0,-1),Os("t",i,e,Ls,0,0,1),Os("n1",i,e,Ls,-s,-r,-1),Os("n2",i,e,Ls,s,-r,-1),Os("n3",i,e,Ls,-s,r,-1),Os("n4",i,e,Ls,s,r,-1),Os("f1",i,e,Ls,-s,-r,1),Os("f2",i,e,Ls,s,-r,1),Os("f3",i,e,Ls,-s,r,1),Os("f4",i,e,Ls,s,r,1),Os("u1",i,e,Ls,s*.7,r*1.1,-1),Os("u2",i,e,Ls,-s*.7,r*1.1,-1),Os("u3",i,e,Ls,0,r*2,-1),Os("cf1",i,e,Ls,-s,0,1),Os("cf2",i,e,Ls,s,0,1),Os("cf3",i,e,Ls,0,-r,1),Os("cf4",i,e,Ls,0,r,1),Os("cn1",i,e,Ls,-s,0,-1),Os("cn2",i,e,Ls,s,0,-1),Os("cn3",i,e,Ls,0,-r,-1),Os("cn4",i,e,Ls,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Os(n,e,i,s,r,o,a){MT.set(r,o,a).unproject(s);const l=e[n];if(l!==void 0){const c=i.getAttribute("position");for(let h=0,d=l.length;h<d;h++)c.setXYZ(l[h],MT.x,MT.y,MT.z)}}const IT=new gi;class qH extends Jo{constructor(e,i=16776960){const s=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),o=new Rt;o.setIndex(new ct(s,1)),o.setAttribute("position",new ct(r,3)),super(o,new Cn({color:i,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&IT.setFromObject(this.object),IT.isEmpty())return;const i=IT.min,s=IT.max,r=this.geometry.attributes.position,o=r.array;o[0]=s.x,o[1]=s.y,o[2]=s.z,o[3]=i.x,o[4]=s.y,o[5]=s.z,o[6]=i.x,o[7]=i.y,o[8]=s.z,o[9]=s.x,o[10]=i.y,o[11]=s.z,o[12]=s.x,o[13]=s.y,o[14]=i.z,o[15]=i.x,o[16]=s.y,o[17]=i.z,o[18]=i.x,o[19]=i.y,o[20]=i.z,o[21]=s.x,o[22]=i.y,o[23]=i.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,i){return super.copy(e,i),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class tN extends Jo{constructor(e,i=16776960){const s=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],o=new Rt;o.setIndex(new ct(s,1)),o.setAttribute("position",new dt(r,3)),super(o,new Cn({color:i,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Cfe extends is{constructor(e,i=1,s=16776960){const r=s,o=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new Rt;a.setAttribute("position",new dt(o,3)),a.computeBoundingSphere(),super(a,new Cn({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=i;const l=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],c=new Rt;c.setAttribute("position",new dt(l,3)),c.computeBoundingSphere(),this.add(new pe(c,new ai({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const $H=new E;let TT,iN;class Sfe extends Ae{constructor(e=new E(0,0,1),i=new E(0,0,0),s=1,r=16776960,o=s*.2,a=o*.2){super(),this.type="ArrowHelper",TT===void 0&&(TT=new Rt,TT.setAttribute("position",new dt([0,0,0,0,1,0],3)),iN=new js(0,.5,1,5,1),iN.translate(0,-.5,0)),this.position.copy(i),this.line=new is(TT,new Cn({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new pe(iN,new ai({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(s,o,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{$H.set(e.z,0,-e.x).normalize();const i=Math.acos(e.y);this.quaternion.setFromAxisAngle($H,i)}}setLength(e,i=e*.2,s=i*.2){this.line.scale.set(1,Math.max(1e-4,e-i),1),this.line.updateMatrix(),this.cone.scale.set(s,i,s),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}let Ya=class extends Jo{constructor(n=1){const e=[0,0,0,n,0,0,0,0,0,0,n,0,0,0,0,0,0,n],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new Rt;s.setAttribute("position",new dt(e,3)),s.setAttribute("color",new dt(i,3));const r=new Cn({vertexColors:!0,toneMapped:!1});super(s,r),this.type="AxesHelper"}setColors(n,e,i){const s=new fe,r=this.geometry.attributes.color.array;return s.set(n),s.toArray(r,0),s.toArray(r,3),s.set(e),s.toArray(r,6),s.toArray(r,9),s.set(i),s.toArray(r,12),s.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}};class eQ{constructor(){this.type="ShapePath",this.color=new fe,this.subPaths=[],this.currentPath=null}moveTo(e,i){return this.currentPath=new f1,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,i),this}lineTo(e,i){return this.currentPath.lineTo(e,i),this}quadraticCurveTo(e,i,s,r){return this.currentPath.quadraticCurveTo(e,i,s,r),this}bezierCurveTo(e,i,s,r,o,a){return this.currentPath.bezierCurveTo(e,i,s,r,o,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function i(b){const v=[];for(let x=0,w=b.length;x<w;x++){const C=b[x],S=new lm;S.curves=C.curves,v.push(S)}return v}function s(b,v){const x=v.length;let w=!1;for(let C=x-1,S=0;S<x;C=S++){let _=v[C],I=v[S],B=I.x-_.x,M=I.y-_.y;if(Math.abs(M)>Number.EPSILON){if(M<0&&(_=v[S],B=-B,I=v[C],M=-M),b.y<_.y||b.y>I.y)continue;if(b.y===_.y){if(b.x===_.x)return!0}else{const R=M*(b.x-_.x)-B*(b.y-_.y);if(R===0)return!0;if(R<0)continue;w=!w}}else{if(b.y!==_.y)continue;if(I.x<=b.x&&b.x<=_.x||_.x<=b.x&&b.x<=I.x)return!0}}return w}const r=jh.isClockWise,o=this.subPaths;if(o.length===0)return[];let a,l,c;const h=[];if(o.length===1)return l=o[0],c=new lm,c.curves=l.curves,h.push(c),h;let d=!r(o[0].getPoints());d=e?!d:d;const u=[],p=[];let g=[],f=0,A;p[f]=void 0,g[f]=[];for(let b=0,v=o.length;b<v;b++)l=o[b],A=l.getPoints(),a=r(A),a=e?!a:a,a?(!d&&p[f]&&f++,p[f]={s:new lm,p:A},p[f].s.curves=l.curves,d&&f++,g[f]=[]):g[f].push({h:l,p:A[0]});if(!p[0])return i(o);if(p.length>1){let b=!1,v=0;for(let x=0,w=p.length;x<w;x++)u[x]=[];for(let x=0,w=p.length;x<w;x++){const C=g[x];for(let S=0;S<C.length;S++){const _=C[S];let I=!0;for(let B=0;B<p.length;B++)s(_.p,p[B].p)&&(x!==B&&v++,I?(I=!1,u[B].push(_)):b=!0);I&&u[x].push(_)}}v>0&&b===!1&&(g=u)}let y;for(let b=0,v=p.length;b<v;b++){c=p[b].s,h.push(c),y=g[b];for(let x=0,w=y.length;x<w;x++)c.holes.push(y[x].h)}return h}}class ET extends yr{constructor(e,i=null){super(),this.object=e,this.domElement=i,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}class _fe extends fi{constructor(e=1,i=1,s=1,r={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(e,i,{...r,count:s}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}const Mfe=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class tQ{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=Mfe,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}getRenderObjectData(e){let i=this.renderObjects.get(e);return i===void 0&&(i={material:this.getMaterialData(e.material),worldMatrix:e.object.matrixWorld.clone()},e.object.center&&(i.center=e.object.center.clone()),e.object.morphTargetInfluences&&(i.morphTargetInfluences=e.object.morphTargetInfluences.slice()),e.bundle!==null&&(i.version=e.bundle.version),this.renderObjects.set(e,i)),i}containsNode(e){const i=e.material;for(const s in i)if(i[s]&&i[s].isNode)return!0;return e.renderer.nodes.modelViewMatrix!==null||e.renderer.nodes.modelNormalViewMatrix!==null}getMaterialData(e){const i={};for(const s of this.refreshUniforms){const r=e[s];r!=null&&(typeof r=="object"&&r.clone!==void 0?r.isTexture===!0?i[s]={id:r.id,version:r.version}:i[s]=r.clone():i[s]=r)}return i}equals(e){const{object:i,material:s}=e,r=this.getRenderObjectData(e);if(r.worldMatrix.equals(i.matrixWorld)!==!0)return r.worldMatrix.copy(i.matrixWorld),!1;const o=r.material;for(const a in o){const l=o[a],c=s[a];if(l.equals!==void 0){if(l.equals(c)===!1)return l.copy(c),!1}else if(c.isTexture===!0){if(l.id!==c.id||l.version!==c.version)return l.id=c.id,l.version=c.version,!1}else if(l!==c)return o[a]=c,!1}if(r.morphTargetInfluences){let a=!1;for(let l=0;l<r.morphTargetInfluences.length;l++)r.morphTargetInfluences[l]!==i.morphTargetInfluences[l]&&(a=!0);if(a)return!0}return r.center&&r.center.equals(i.center)===!1?(r.center.copy(i.center),!0):(e.bundle!==null&&(r.version=e.bundle.version),!0)}needsRefresh(e,i){if(this.hasNode||this.hasAnimation||this.firstInitialization(e))return!0;const{renderId:s}=i;if(this.renderId!==s)return this.renderId=s,!0;const r=e.object.static===!0,o=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;return r||o?!1:this.equals(e)!==!0}}function M1(n,e=0){let i=3735928559^e,s=1103547991^e;if(n instanceof Array)for(let r=0,o;r<n.length;r++)o=n[r],i=Math.imul(i^o,2654435761),s=Math.imul(s^o,1597334677);else for(let r=0,o;r<n.length;r++)o=n.charCodeAt(r),i=Math.imul(i^o,2654435761),s=Math.imul(s^o,1597334677);return i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(s^s>>>13,3266489909),s=Math.imul(s^s>>>16,2246822507),s^=Math.imul(i^i>>>13,3266489909),4294967296*(2097151&s)+(i>>>0)}const iQ=n=>M1(n),nQ=n=>M1(n),nN=(...n)=>M1(n);function sN(n,e=!1){const i=[];n.isNode===!0&&(i.push(n.id),n=n.getSelf());for(const{property:s,childNode:r}of I1(n))i.push(i,M1(s.slice(0,-4)),r.getCacheKey(e));return M1(i)}function*I1(n,e=!1){for(const i in n){if(i.startsWith("_")===!0)continue;const s=n[i];if(Array.isArray(s)===!0)for(let r=0;r<s.length;r++){const o=s[r];o&&(o.isNode===!0||e&&typeof o.toJSON=="function")&&(yield{property:i,index:r,childNode:o})}else if(s&&s.isNode===!0)yield{property:i,childNode:s};else if(typeof s=="object")for(const r in s){const o=s[r];o&&(o.isNode===!0||e&&typeof o.toJSON=="function")&&(yield{property:i,index:r,childNode:o})}}}function ku(n){if(n==null)return null;const e=typeof n;return n.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function rN(n,...e){const i=n?n.slice(-4):void 0;return e.length===1&&(i==="vec2"?e=[e[0],e[0]]:i==="vec3"?e=[e[0],e[0],e[0]]:i==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),n==="color"?new fe(...e):i==="vec2"?new Q(...e):i==="vec3"?new E(...e):i==="vec4"?new $e(...e):i==="mat3"?new oi(...e):i==="mat4"?new de(...e):n==="bool"?e[0]||!1:n==="float"||n==="int"||n==="uint"?e[0]||0:n==="string"?e[0]||"":n==="ArrayBuffer"?aN(e[0]):null}function oN(n){let e="";const i=new Uint8Array(n);for(let s=0;s<i.length;s++)e+=String.fromCharCode(i[s]);return btoa(e)}function aN(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer}var Ife=Object.freeze({__proto__:null,arrayBufferToBase64:oN,base64ToArrayBuffer:aN,getCacheKey:sN,getNodeChildren:I1,getValueFromType:rN,getValueType:ku,hash:nN,hashArray:nQ,hashString:iQ});const lN={VERTEX:"vertex",FRAGMENT:"fragment"},Ht={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Tfe={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},sQ=["fragment","vertex"],cN=["setup","analyze","generate"],hN=[...sQ,"compute"],By=["x","y","z","w"];let Efe=0,Jt=class extends yr{static get type(){return"Node"}constructor(n=null){super(),this.nodeType=n,this.updateType=Ht.NONE,this.updateBeforeType=Ht.NONE,this.updateAfterType=Ht.NONE,this.uuid=Di.generateUUID(),this.version=0,this._cacheKey=null,this._cacheKeyVersion=0,this.global=!1,this.isNode=!0,Object.defineProperty(this,"id",{value:Efe++})}set needsUpdate(n){n===!0&&this.version++}get type(){return this.constructor.type}onUpdate(n,e){return this.updateType=e,this.update=n.bind(this.getSelf()),this}onFrameUpdate(n){return this.onUpdate(n,Ht.FRAME)}onRenderUpdate(n){return this.onUpdate(n,Ht.RENDER)}onObjectUpdate(n){return this.onUpdate(n,Ht.OBJECT)}onReference(n){return this.updateReference=n.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:n}of I1(this))yield n}dispose(){this.dispatchEvent({type:"dispose"})}traverse(n){n(this);for(const e of this.getChildren())e.traverse(n)}getCacheKey(n=!1){return n=n||this.version!==this._cacheKeyVersion,(n===!0||this._cacheKey===null)&&(this._cacheKey=sN(this,n),this._cacheKeyVersion=this.version),this._cacheKey}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(n){const e=this.getNodeType(n);return n.getElementType(e)}getNodeType(n){const e=n.getNodeProperties(this);return e.outputNode?e.outputNode.getNodeType(n):this.nodeType}getShared(n){const e=this.getHash(n);return n.getNodeFromHash(e)||this}setup(n){const e=n.getNodeProperties(this);let i=0;for(const s of this.getChildren())e["node"+i++]=s;return null}analyze(n){if(n.increaseUsage(this)===1){const e=n.getNodeProperties(this);for(const i of Object.values(e))i&&i.isNode===!0&&i.build(n)}}generate(n,e){const{outputNode:i}=n.getNodeProperties(this);if(i&&i.isNode===!0)return i.build(n,e)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(n,e=null){const i=this.getShared(n);if(this!==i)return i.build(n,e);n.addNode(this),n.addChain(this);let s=null;const r=n.getBuildStage();if(r==="setup"){this.updateReference(n);const o=n.getNodeProperties(this);if(o.initialized!==!0){const a=n.stack.nodes.length;o.initialized=!0,o.outputNode=this.setup(n),o.outputNode!==null&&n.stack.nodes.length;for(const l of Object.values(o))l&&l.isNode===!0&&l.build(n)}}else if(r==="analyze")this.analyze(n);else if(r==="generate")if(this.generate.length===1){const o=this.getNodeType(n),a=n.getDataFromNode(this);s=a.snippet,s===void 0?(s=this.generate(n)||"",a.snippet=s):a.flowCodes!==void 0&&n.context.nodeBlock!==void 0&&n.addFlowCodeHierarchy(this,n.context.nodeBlock),s=n.format(s,o,e)}else s=this.generate(n,e)||"";return n.removeChain(this),s}getSerializeChildren(){return I1(this)}serialize(n){const e=this.getSerializeChildren(),i={};for(const{property:s,index:r,childNode:o}of e)r!==void 0?(i[s]===void 0&&(i[s]=Number.isInteger(r)?[]:{}),i[s][r]=o.toJSON(n.meta).uuid):i[s]=o.toJSON(n.meta).uuid;Object.keys(i).length>0&&(n.inputNodes=i)}deserialize(n){if(n.inputNodes!==void 0){const e=n.meta.nodes;for(const i in n.inputNodes)if(Array.isArray(n.inputNodes[i])){const s=[];for(const r of n.inputNodes[i])s.push(e[r]);this[i]=s}else if(typeof n.inputNodes[i]=="object"){const s={};for(const r in n.inputNodes[i]){const o=n.inputNodes[i][r];s[r]=e[o]}this[i]=s}else{const s=n.inputNodes[i];this[i]=e[s]}}}toJSON(n){const{uuid:e,type:i}=this,s=n===void 0||typeof n=="string";s&&(n={textures:{},images:{},nodes:{}});let r=n.nodes[e];r===void 0&&(r={uuid:e,type:i,meta:n,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},s!==!0&&(n.nodes[r.uuid]=r),this.serialize(r),delete r.meta);function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}if(s){const a=o(n.textures),l=o(n.images),c=o(n.nodes);a.length>0&&(r.textures=a),l.length>0&&(r.images=l),c.length>0&&(r.nodes=c)}return r}};class gm extends Jt{static get type(){return"ArrayElementNode"}constructor(e,i){super(),this.node=e,this.indexNode=i,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const i=this.node.build(e),s=this.indexNode.build(e,"uint");return`${i}[ ${s} ]`}}class dN extends Jt{static get type(){return"ConvertNode"}constructor(e,i){super(),this.node=e,this.convertTo=i}getNodeType(e){const i=this.node.getNodeType(e);let s=null;for(const r of this.convertTo.split("|"))(s===null||e.getTypeLength(i)===e.getTypeLength(r))&&(s=r);return s}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,i){const s=this.node,r=this.getNodeType(e),o=s.build(e,r);return e.format(o,r,i)}}class Ti extends Jt{static get type(){return"TempNode"}constructor(e){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,i){if(e.getBuildStage()==="generate"){const s=e.getVectorType(this.getNodeType(e,i)),r=e.getDataFromNode(this);if(r.propertyName!==void 0)return e.format(r.propertyName,s,i);if(s!=="void"&&i!=="void"&&this.hasDependencies(e)){const o=super.build(e,s),a=e.getVarFromNode(this,null,s),l=e.getPropertyName(a);return e.addLineFlowCode(`${l} = ${o}`,this),r.snippet=o,r.propertyName=l,e.format(r.propertyName,s,i)}}return super.build(e,i)}}class rQ extends Ti{static get type(){return"JoinNode"}constructor(e=[],i=null){super(i),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((i,s)=>i+e.getTypeLength(s.getNodeType(e)),0))}generate(e,i){const s=this.getNodeType(e),r=this.nodes,o=e.getComponentType(s),a=[];for(const c of r){let h=c.build(e);const d=e.getComponentType(c.getNodeType(e));d!==o&&(h=e.format(h,d,o)),a.push(h)}const l=`${e.getType(s)}( ${a.join(", ")} )`;return e.format(l,s,i)}}const Rfe=By.join("");class RT extends Jt{static get type(){return"SplitNode"}constructor(e,i="x"){super(),this.node=e,this.components=i,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const i of this.components)e=Math.max(By.indexOf(i)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,i){const s=this.node,r=e.getTypeLength(s.getNodeType(e));let o=null;if(r>1){let a=null;this.getVectorLength()>=r&&(a=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const l=s.build(e,a);this.components.length===r&&this.components===Rfe.slice(0,this.components.length)?o=e.format(l,a,i):o=e.format(`${l}.${this.components}`,this.getNodeType(e),i)}else o=s.build(e,i);return o}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class oQ extends Ti{static get type(){return"SetNode"}constructor(e,i,s){super(),this.sourceNode=e,this.components=i,this.targetNode=s}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:i,components:s,targetNode:r}=this,o=this.getNodeType(e),a=e.getTypeFromLength(s.length,r.getNodeType(e)),l=r.build(e,a),c=i.build(e,o),h=e.getTypeLength(o),d=[];for(let u=0;u<h;u++){const p=By[u];p===s[0]?(d.push(l),u+=s.length-1):d.push(c+"."+p)}return`${e.getType(o)}( ${d.join(", ")} )`}}class Lfe extends Ti{static get type(){return"FlipNode"}constructor(e,i){super(),this.sourceNode=e,this.components=i}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:i,sourceNode:s}=this,r=this.getNodeType(e),o=s.build(e),a=e.getVarFromNode(this),l=e.getPropertyName(a);e.addLineFlowCode(l+" = "+o,this);const c=e.getTypeLength(r),h=[];let d=0;for(let u=0;u<c;u++){const p=By[u];p===i[d]?(h.push("1.0 - "+(l+"."+p)),d++):h.push(l+"."+p)}return`${e.getType(r)}( ${h.join(", ")} )`}}class uN extends Jt{static get type(){return"InputNode"}constructor(e,i=null){super(i),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?ku(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=ku(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=oN(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?rN(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}class xc extends uN{static get type(){return"ConstNode"}constructor(e,i=null){super(e,i),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,i){const s=this.getNodeType(e);return e.format(this.generateConst(e),s,i)}}let ky=null;const Gy=new Map;function Be(n,e){if(Gy.has(n)){console.warn(`Redefinition of method chaining ${n}`);return}if(typeof e!="function")throw new Error(`Node element ${n} is not a function`);Gy.set(n,e)}const aQ=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),lQ=n=>aQ(n).split("").sort().join(""),cQ={setup(n,e){const i=e.shift();return n(R1(i),...e)},get(n,e,i){if(typeof e=="string"&&n[e]===void 0){if(n.isStackNode!==!0&&e==="assign")return(...s)=>(ky.assign(i,...s),i);if(Gy.has(e)){const s=Gy.get(e);return n.isStackNode?(...r)=>i.add(s(...r)):(...r)=>s(i,...r)}else{if(e==="self")return n;if(e.endsWith("Assign")&&Gy.has(e.slice(0,e.length-6))){const s=Gy.get(e.slice(0,e.length-6));return n.isStackNode?(...r)=>i.assign(r[0],s(...r)):(...r)=>i.assign(s(i,...r))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=aQ(e),ge(new RT(i,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=lQ(e.slice(3).toLowerCase()),s=>ge(new oQ(n,e,s));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=lQ(e.slice(4).toLowerCase()),()=>ge(new Lfe(ge(n),e));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),ge(new RT(n,e));if(/^\d+$/.test(e)===!0)return ge(new gm(i,new xc(Number(e),"uint")))}}}return Reflect.get(n,e,i)},set(n,e,i,s){return typeof e=="string"&&n[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(s[e].assign(i),!0):Reflect.set(n,e,i,s)}},pN=new WeakMap,hQ=new WeakMap,Bfe=function(n,e=null){const i=ku(n);if(i==="node"){let s=pN.get(n);return s===void 0&&(s=new Proxy(n,cQ),pN.set(n,s),pN.set(s,s)),s}else{if(e===null&&(i==="float"||i==="boolean")||i&&i!=="shader"&&i!=="string")return ge(AN(n,e));if(i==="shader")return ie(n)}return n},kfe=function(n,e=null){for(const i in n)n[i]=ge(n[i],e);return n},Gfe=function(n,e=null){const i=n.length;for(let s=0;s<i;s++)n[s]=ge(n[s],e);return n},Pfe=function(n,e=null,i=null,s=null){const r=o=>ge(s!==null?Object.assign(o,s):o);return e===null?(...o)=>r(new n(...Df(o))):i!==null?(i=ge(i),(...o)=>r(new n(e,...Df(o),i))):(...o)=>r(new n(e,...Df(o)))},Nfe=function(n,...e){return ge(new n(...Df(e)))};class Vfe extends Jt{constructor(e,i){super(),this.shaderNode=e,this.inputNodes=i}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}call(e){const{shaderNode:i,inputNodes:s}=this,r=e.getNodeProperties(i);if(r.onceOutput)return r.onceOutput;let o=null;if(i.layout){let a=hQ.get(e.constructor);a===void 0&&(a=new WeakMap,hQ.set(e.constructor,a));let l=a.get(i);l===void 0&&(l=ge(e.buildFunctionNode(i)),a.set(i,l)),e.currentFunctionNode!==null&&e.currentFunctionNode.includes.push(l),o=ge(l.call(s))}else{const a=i.jsFunc,l=s!==null?a(s,e):a(e);o=ge(l)}return i.once&&(r.onceOutput=o),o}getOutputNode(e){const i=e.getNodeProperties(this);return i.outputNode===null&&(i.outputNode=this.setupOutput(e)),i.outputNode}setup(e){return this.getOutputNode(e)}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,i){return this.getOutputNode(e).build(e,i)}}class Xfe extends Jt{constructor(e,i){super(i),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(e=null){return R1(e),ge(new Vfe(this,e))}setup(){return this.call()}}const Dfe=[!1,!0],zfe=[0,1,2,3],Ffe=[-1,-2],dQ=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],mN=new Map;for(const n of Dfe)mN.set(n,new xc(n));const gN=new Map;for(const n of zfe)gN.set(n,new xc(n,"uint"));const fN=new Map([...gN].map(n=>new xc(n.value,"int")));for(const n of Ffe)fN.set(n,new xc(n,"int"));const LT=new Map([...fN].map(n=>new xc(n.value)));for(const n of dQ)LT.set(n,new xc(n));for(const n of dQ)LT.set(-n,new xc(-n));const BT={bool:mN,uint:gN,ints:fN,float:LT},uQ=new Map([...mN,...LT]),AN=(n,e)=>uQ.has(n)?uQ.get(n):n.isNode===!0?n:new xc(n,e),Ufe=n=>{try{return n.getNodeType()}catch{return}},sr=function(n,e=null){return(...i)=>{if((i.length===0||!["bool","float","int","uint"].includes(n)&&i.every(r=>typeof r!="object"))&&(i=[rN(n,...i)]),i.length===1&&e!==null&&e.has(i[0]))return ge(e.get(i[0]));if(i.length===1){const r=AN(i[0],n);return Ufe(r)===n?ge(r):ge(new dN(r,n))}const s=i.map(r=>AN(r));return ge(new rQ(s,n))}},T1=n=>typeof n=="object"&&n!==null?n.value:n,pQ=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function E1(n,e){return new Proxy(new Xfe(n,e),cQ)}const ge=(n,e=null)=>Bfe(n,e),R1=(n,e=null)=>new kfe(n,e),Df=(n,e=null)=>new Gfe(n,e),Ce=(...n)=>new Pfe(...n),it=(...n)=>new Nfe(...n),ie=(n,e)=>{const i=new E1(n,e),s=(...r)=>{let o;return R1(r),r[0]&&r[0].isNode?o=[...r]:o=r[0],i.call(o)};return s.shaderNode=i,s.setLayout=r=>(i.setLayout(r),s),s.once=()=>(i.once=!0,s),s},Ofe=(...n)=>(console.warn("TSL.ShaderNode: tslFn() has been renamed to Fn()."),ie(...n));Be("toGlobal",n=>(n.global=!0,n));const L1=n=>{ky=n},yN=()=>ky,Gt=(...n)=>ky.If(...n);function mQ(n){return ky&&ky.add(n),n}Be("append",mQ);const gQ=new sr("color"),D=new sr("float",BT.float),K=new sr("int",BT.ints),pt=new sr("uint",BT.uint),fm=new sr("bool",BT.bool),ae=new sr("vec2"),dd=new sr("ivec2"),fQ=new sr("uvec2"),AQ=new sr("bvec2"),j=new sr("vec3"),yQ=new sr("ivec3"),Py=new sr("uvec3"),bN=new sr("bvec3"),Qe=new sr("vec4"),bQ=new sr("ivec4"),vQ=new sr("uvec4"),xQ=new sr("bvec4"),B1=new sr("mat2"),Nr=new sr("mat3"),zf=new sr("mat4"),Zfe=(n="")=>ge(new xc(n,"string")),Wfe=n=>ge(new xc(n,"ArrayBuffer"));Be("toColor",gQ),Be("toFloat",D),Be("toInt",K),Be("toUint",pt),Be("toBool",fm),Be("toVec2",ae),Be("toIVec2",dd),Be("toUVec2",fQ),Be("toBVec2",AQ),Be("toVec3",j),Be("toIVec3",yQ),Be("toUVec3",Py),Be("toBVec3",bN),Be("toVec4",Qe),Be("toIVec4",bQ),Be("toUVec4",vQ),Be("toBVec4",xQ),Be("toMat2",B1),Be("toMat3",Nr),Be("toMat4",zf);const wQ=Ce(gm),CQ=(n,e)=>ge(new dN(ge(n),e)),Hfe=(n,e)=>ge(new RT(ge(n),e));Be("element",wQ),Be("convert",CQ);class vN extends Jt{static get type(){return"UniformGroupNode"}constructor(e,i=!1,s=1){super("string"),this.name=e,this.version=0,this.shared=i,this.order=s,this.isUniformGroup=!0}set needsUpdate(e){e===!0&&this.version++}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const SQ=n=>new vN(n),xN=(n,e=0)=>new vN(n,!0,e),Qfe=xN("frame"),Zi=xN("render"),_Q=SQ("object");class Ff extends uN{static get type(){return"UniformNode"}constructor(e,i=null){super(e,i),this.isUniformNode=!0,this.name="",this.groupNode=_Q}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,i){const s=this.getSelf();return e=e.bind(s),super.onUpdate(r=>{const o=e(r,s);o!==void 0&&(this.value=o)},i)}generate(e,i){const s=this.getNodeType(e),r=this.getUniformHash(e);let o=e.getNodeFromHash(r);o===void 0&&(e.setHashNode(this,r),o=this);const a=o.getInputType(e),l=e.getUniformFromNode(o,a,e.shaderStage,this.name||e.context.label),c=e.getPropertyName(l);return e.context.label!==void 0&&delete e.context.label,e.format(c,s,i)}}const tt=(n,e)=>{const i=pQ(e||n),s=n&&n.isNode===!0?n.node&&n.node.value||n.value:n;return ge(new Ff(s,i))};class tn extends Jt{static get type(){return"PropertyNode"}constructor(e,i=null,s=!1){super(e),this.name=i,this.varying=s,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let i;return this.varying===!0?(i=e.getVaryingFromNode(this,this.name),i.needsInterpolation=!0):i=e.getVarFromNode(this,this.name),e.getPropertyName(i)}}const ja=(n,e)=>ge(new tn(n,e)),dh=(n,e)=>ge(new tn(n,e,!0)),on=it(tn,"vec4","DiffuseColor"),wN=it(tn,"vec3","EmissiveColor"),ud=it(tn,"float","Roughness"),k1=it(tn,"float","Metalness"),kT=it(tn,"float","Clearcoat"),G1=it(tn,"float","ClearcoatRoughness"),Uf=it(tn,"vec3","Sheen"),GT=it(tn,"float","SheenRoughness"),PT=it(tn,"float","Iridescence"),CN=it(tn,"float","IridescenceIOR"),SN=it(tn,"float","IridescenceThickness"),NT=it(tn,"float","AlphaT"),Am=it(tn,"float","Anisotropy"),P1=it(tn,"vec3","AnisotropyT"),Of=it(tn,"vec3","AnisotropyB"),Ja=it(tn,"color","SpecularColor"),N1=it(tn,"float","SpecularF90"),VT=it(tn,"float","Shininess"),_N=it(tn,"vec4","Output"),Zf=it(tn,"float","dashSize"),V1=it(tn,"float","gapSize"),Kfe=it(tn,"float","pointWidth"),X1=it(tn,"float","IOR"),XT=it(tn,"float","Transmission"),MN=it(tn,"float","Thickness"),IN=it(tn,"float","AttenuationDistance"),TN=it(tn,"color","AttenuationColor"),EN=it(tn,"float","Dispersion");class MQ extends Ti{static get type(){return"AssignNode"}constructor(e,i){super(),this.targetNode=e,this.sourceNode=i}hasDependencies(){return!1}getNodeType(e,i){return i!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:i}=this;if(e.isAvailable("swizzleAssign")===!1&&i.isSplitNode&&i.components.length>1){const s=e.getTypeLength(i.node.getNodeType(e));return By.join("").slice(0,s)!==i.components}return!1}generate(e,i){const{targetNode:s,sourceNode:r}=this,o=this.needsSplitAssign(e),a=s.getNodeType(e),l=s.context({assign:!0}).build(e),c=r.build(e,a),h=r.getNodeType(e),d=e.getDataFromNode(this);let u;if(d.initialized===!0)i!=="void"&&(u=l);else if(o){const p=e.getVarFromNode(this,null,a),g=e.getPropertyName(p);e.addLineFlowCode(`${g} = ${c}`,this);const f=s.node.context({assign:!0}).build(e);for(let A=0;A<s.components.length;A++){const y=s.components[A];e.addLineFlowCode(`${f}.${y} = ${g}[ ${A} ]`,this)}i!=="void"&&(u=l)}else u=`${l} = ${c}`,(i==="void"||h==="void")&&(e.addLineFlowCode(u,this),i!=="void"&&(u=l));return d.initialized=!0,e.format(u,a,i)}}const IQ=Ce(MQ);Be("assign",IQ);class TQ extends Ti{static get type(){return"FunctionCallNode"}constructor(e=null,i={}){super(),this.functionNode=e,this.parameters=i}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const i=[],s=this.functionNode,r=s.getInputs(e),o=this.parameters;if(Array.isArray(o))for(let a=0;a<o.length;a++){const l=r[a],c=o[a];i.push(c.build(e,l.type))}else for(const a of r){const l=o[a.name];if(l!==void 0)i.push(l.build(e,a.type));else throw new Error(`FunctionCallNode: Input '${a.name}' not found in FunctionNode.`)}return`${s.build(e,"property")}( ${i.join(", ")} )`}}const EQ=(n,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Df(e):R1(e[0]),ge(new TQ(ge(n),e)));Be("call",EQ);class hs extends Ti{static get type(){return"OperatorNode"}constructor(e,i,s,...r){if(super(),r.length>0){let o=new hs(e,i,s);for(let a=0;a<r.length-1;a++)o=new hs(e,o,r[a]);i=o,s=r[r.length-1]}this.op=e,this.aNode=i,this.bNode=s}getNodeType(e,i){const s=this.op,r=this.aNode,o=this.bNode,a=r.getNodeType(e),l=typeof o<"u"?o.getNodeType(e):null;if(a==="void"||l==="void")return"void";if(s==="%")return a;if(s==="~"||s==="&"||s==="|"||s==="^"||s===">>"||s==="<<")return e.getIntegerType(a);if(s==="!"||s==="=="||s==="&&"||s==="||"||s==="^^")return"bool";if(s==="<"||s===">"||s==="<="||s===">="){const c=i?e.getTypeLength(i):Math.max(e.getTypeLength(a),e.getTypeLength(l));return c>1?`bvec${c}`:"bool"}else return a==="float"&&e.isMatrix(l)?l:e.isMatrix(a)&&e.isVector(l)?e.getVectorFromMatrix(a):e.isVector(a)&&e.isMatrix(l)?e.getVectorFromMatrix(l):e.getTypeLength(l)>e.getTypeLength(a)?l:a}generate(e,i){const s=this.op,r=this.aNode,o=this.bNode,a=this.getNodeType(e,i);let l=null,c=null;a!=="void"?(l=r.getNodeType(e),c=typeof o<"u"?o.getNodeType(e):null,s==="<"||s===">"||s==="<="||s===">="||s==="=="?e.isVector(l)?c=l:l!==c&&(l=c="float"):s===">>"||s==="<<"?(l=a,c=e.changeComponentType(c,"uint")):e.isMatrix(l)&&e.isVector(c)?c=e.getVectorFromMatrix(l):e.isVector(l)&&e.isMatrix(c)?l=e.getVectorFromMatrix(c):l=c=a):l=c=a;const h=r.build(e,l),d=typeof o<"u"?o.build(e,c):null,u=e.getTypeLength(i),p=e.getFunctionOperator(s);if(i!=="void")return s==="<"&&u>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThan",i)}( ${h}, ${d} )`,a,i):e.format(`( ${h} < ${d} )`,a,i):s==="<="&&u>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThanEqual",i)}( ${h}, ${d} )`,a,i):e.format(`( ${h} <= ${d} )`,a,i):s===">"&&u>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThan",i)}( ${h}, ${d} )`,a,i):e.format(`( ${h} > ${d} )`,a,i):s===">="&&u>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThanEqual",i)}( ${h}, ${d} )`,a,i):e.format(`( ${h} >= ${d} )`,a,i):s==="!"||s==="~"?e.format(`(${s}${h})`,l,i):p?e.format(`${p}( ${h}, ${d} )`,a,i):e.format(`( ${h} ${s} ${d} )`,a,i);if(l!=="void")return p?e.format(`${p}( ${h}, ${d} )`,a,i):e.format(`${h} ${s} ${d}`,a,i)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Hn=Ce(hs,"+"),Ln=Ce(hs,"-"),wi=Ce(hs,"*"),uh=Ce(hs,"/"),RN=Ce(hs,"%"),RQ=Ce(hs,"=="),LQ=Ce(hs,"!="),BQ=Ce(hs,"<"),LN=Ce(hs,">"),kQ=Ce(hs,"<="),GQ=Ce(hs,">="),PQ=Ce(hs,"&&"),NQ=Ce(hs,"||"),VQ=Ce(hs,"!"),XQ=Ce(hs,"^^"),DQ=Ce(hs,"&"),zQ=Ce(hs,"~"),FQ=Ce(hs,"|"),UQ=Ce(hs,"^"),OQ=Ce(hs,"<<"),ZQ=Ce(hs,">>");Be("add",Hn),Be("sub",Ln),Be("mul",wi),Be("div",uh),Be("modInt",RN),Be("equal",RQ),Be("notEqual",LQ),Be("lessThan",BQ),Be("greaterThan",LN),Be("lessThanEqual",kQ),Be("greaterThanEqual",GQ),Be("and",PQ),Be("or",NQ),Be("not",VQ),Be("xor",XQ),Be("bitAnd",DQ),Be("bitNot",zQ),Be("bitOr",FQ),Be("bitXor",UQ),Be("shiftLeft",OQ),Be("shiftRight",ZQ);const WQ=(...n)=>(console.warn("TSL.OperatorNode: .remainder() has been renamed to .modInt()."),RN(...n));Be("remainder",WQ);class oe extends Ti{static get type(){return"MathNode"}constructor(e,i,s=null,r=null){super(),this.method=e,this.aNode=i,this.bNode=s,this.cNode=r}getInputType(e){const i=this.aNode.getNodeType(e),s=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,o=e.isMatrix(i)?0:e.getTypeLength(i),a=e.isMatrix(s)?0:e.getTypeLength(s),l=e.isMatrix(r)?0:e.getTypeLength(r);return o>a&&o>l?i:a>l?s:l>o?r:i}getNodeType(e){const i=this.method;return i===oe.LENGTH||i===oe.DISTANCE||i===oe.DOT?"float":i===oe.CROSS?"vec3":i===oe.ALL?"bool":i===oe.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):i===oe.MOD?this.aNode.getNodeType(e):this.getInputType(e)}generate(e,i){const s=this.method,r=this.getNodeType(e),o=this.getInputType(e),a=this.aNode,l=this.bNode,c=this.cNode,h=e.renderer.isWebGLRenderer===!0;if(s===oe.TRANSFORM_DIRECTION){let d=a,u=l;e.isMatrix(d.getNodeType(e))?u=Qe(j(u),0):d=Qe(j(d),0);const p=wi(d,u).xyz;return Sl(p).build(e,i)}else{if(s===oe.NEGATE)return e.format("( - "+a.build(e,o)+" )",r,i);if(s===oe.ONE_MINUS)return Ln(1,a).build(e,i);if(s===oe.RECIPROCAL)return uh(1,a).build(e,i);if(s===oe.DIFFERENCE)return Sn(Ln(a,l)).build(e,i);{const d=[];return s===oe.CROSS||s===oe.MOD?d.push(a.build(e,r),l.build(e,r)):h&&s===oe.STEP?d.push(a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":o),l.build(e,o)):h&&(s===oe.MIN||s===oe.MAX)||s===oe.MOD?d.push(a.build(e,o),l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":o)):s===oe.REFRACT?d.push(a.build(e,o),l.build(e,o),c.build(e,"float")):s===oe.MIX?d.push(a.build(e,o),l.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):(d.push(a.build(e,o)),l!==null&&d.push(l.build(e,o)),c!==null&&d.push(c.build(e,o))),e.format(`${e.getMethod(s,r)}( ${d.join(", ")} )`,r,i)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}oe.ALL="all",oe.ANY="any",oe.EQUALS="equals",oe.RADIANS="radians",oe.DEGREES="degrees",oe.EXP="exp",oe.EXP2="exp2",oe.LOG="log",oe.LOG2="log2",oe.SQRT="sqrt",oe.INVERSE_SQRT="inversesqrt",oe.FLOOR="floor",oe.CEIL="ceil",oe.NORMALIZE="normalize",oe.FRACT="fract",oe.SIN="sin",oe.COS="cos",oe.TAN="tan",oe.ASIN="asin",oe.ACOS="acos",oe.ATAN="atan",oe.ABS="abs",oe.SIGN="sign",oe.LENGTH="length",oe.NEGATE="negate",oe.ONE_MINUS="oneMinus",oe.DFDX="dFdx",oe.DFDY="dFdy",oe.ROUND="round",oe.RECIPROCAL="reciprocal",oe.TRUNC="trunc",oe.FWIDTH="fwidth",oe.BITCAST="bitcast",oe.TRANSPOSE="transpose",oe.ATAN2="atan2",oe.MIN="min",oe.MAX="max",oe.MOD="mod",oe.STEP="step",oe.REFLECT="reflect",oe.DISTANCE="distance",oe.DIFFERENCE="difference",oe.DOT="dot",oe.CROSS="cross",oe.POW="pow",oe.TRANSFORM_DIRECTION="transformDirection",oe.MIX="mix",oe.CLAMP="clamp",oe.REFRACT="refract",oe.SMOOTHSTEP="smoothstep",oe.FACEFORWARD="faceforward";const HQ=D(1e-6),Yfe=D(1e6),Wf=D(Math.PI),jfe=D(Math.PI*2),BN=Ce(oe,oe.ALL),QQ=Ce(oe,oe.ANY),KQ=Ce(oe,oe.EQUALS),YQ=Ce(oe,oe.RADIANS),jQ=Ce(oe,oe.DEGREES),kN=Ce(oe,oe.EXP),DT=Ce(oe,oe.EXP2),GN=Ce(oe,oe.LOG),D1=Ce(oe,oe.LOG2),ph=Ce(oe,oe.SQRT),JQ=Ce(oe,oe.INVERSE_SQRT),ym=Ce(oe,oe.FLOOR),PN=Ce(oe,oe.CEIL),Sl=Ce(oe,oe.NORMALIZE),bm=Ce(oe,oe.FRACT),po=Ce(oe,oe.SIN),_l=Ce(oe,oe.COS),qQ=Ce(oe,oe.TAN),$Q=Ce(oe,oe.ASIN),zT=Ce(oe,oe.ACOS),e4=Ce(oe,oe.ATAN),Sn=Ce(oe,oe.ABS),z1=Ce(oe,oe.SIGN),Hf=Ce(oe,oe.LENGTH),t4=Ce(oe,oe.NEGATE),i4=Ce(oe,oe.ONE_MINUS),n4=Ce(oe,oe.DFDX),s4=Ce(oe,oe.DFDY),r4=Ce(oe,oe.ROUND),o4=Ce(oe,oe.RECIPROCAL),NN=Ce(oe,oe.TRUNC),a4=Ce(oe,oe.FWIDTH),Jfe=Ce(oe,oe.BITCAST),l4=Ce(oe,oe.TRANSPOSE),c4=Ce(oe,oe.ATAN2),Vr=Ce(oe,oe.MIN),Li=Ce(oe,oe.MAX),FT=Ce(oe,oe.MOD),F1=Ce(oe,oe.STEP),h4=Ce(oe,oe.REFLECT),d4=Ce(oe,oe.DISTANCE),u4=Ce(oe,oe.DIFFERENCE),As=Ce(oe,oe.DOT),Ny=Ce(oe,oe.CROSS),Ca=Ce(oe,oe.POW),VN=Ce(oe,oe.POW,2),p4=Ce(oe,oe.POW,3),m4=Ce(oe,oe.POW,4),g4=Ce(oe,oe.TRANSFORM_DIRECTION),f4=n=>wi(z1(n),Ca(Sn(n),1/3)),XN=n=>As(n,n),Ai=Ce(oe,oe.MIX),rr=(n,e=0,i=1)=>ge(new oe(oe.CLAMP,ge(n),ge(e),ge(i))),A4=n=>rr(n),DN=Ce(oe,oe.REFRACT),Sa=Ce(oe,oe.SMOOTHSTEP),y4=Ce(oe,oe.FACEFORWARD),zN=ie(([n])=>{const e=43758.5453,i=As(n.xy,ae(12.9898,78.233)),s=FT(i,Wf);return bm(po(s).mul(e))}),b4=(n,e,i)=>Ai(e,i,n),v4=(n,e,i)=>Sa(e,i,n);Be("all",BN),Be("any",QQ),Be("equals",KQ),Be("radians",YQ),Be("degrees",jQ),Be("exp",kN),Be("exp2",DT),Be("log",GN),Be("log2",D1),Be("sqrt",ph),Be("inverseSqrt",JQ),Be("floor",ym),Be("ceil",PN),Be("normalize",Sl),Be("fract",bm),Be("sin",po),Be("cos",_l),Be("tan",qQ),Be("asin",$Q),Be("acos",zT),Be("atan",e4),Be("abs",Sn),Be("sign",z1),Be("length",Hf),Be("lengthSq",XN),Be("negate",t4),Be("oneMinus",i4),Be("dFdx",n4),Be("dFdy",s4),Be("round",r4),Be("reciprocal",o4),Be("trunc",NN),Be("fwidth",a4),Be("atan2",c4),Be("min",Vr),Be("max",Li),Be("mod",FT),Be("step",F1),Be("reflect",h4),Be("distance",d4),Be("dot",As),Be("cross",Ny),Be("pow",Ca),Be("pow2",VN),Be("pow3",p4),Be("pow4",m4),Be("transformDirection",g4),Be("mix",b4),Be("clamp",rr),Be("refract",DN),Be("smoothstep",v4),Be("faceForward",y4),Be("difference",u4),Be("saturate",A4),Be("cbrt",f4),Be("transpose",l4),Be("rand",zN);class qfe extends Jt{static get type(){return"ConditionalNode"}constructor(e,i,s=null){super(),this.condNode=e,this.ifNode=i,this.elseNode=s}getNodeType(e){const i=this.ifNode.getNodeType(e);if(this.elseNode!==null){const s=this.elseNode.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(i))return s}return i}setup(e){const i=this.condNode.cache(),s=this.ifNode.cache(),r=this.elseNode?this.elseNode.cache():null,o=e.context.nodeBlock;e.getDataFromNode(s).parentNodeBlock=o,r!==null&&(e.getDataFromNode(r).parentNodeBlock=o);const a=e.getNodeProperties(this);a.condNode=i,a.ifNode=s.context({nodeBlock:s}),a.elseNode=r?r.context({nodeBlock:r}):null}generate(e,i){const s=this.getNodeType(e),r=e.getDataFromNode(this);if(r.nodeProperty!==void 0)return r.nodeProperty;const{condNode:o,ifNode:a,elseNode:l}=e.getNodeProperties(this),c=i!=="void",h=c?ja(s).build(e):"";r.nodeProperty=h;const d=o.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${d} ) {

`).addFlowTab();let u=a.build(e,s);if(u&&(c?u=h+" = "+u+";":u="return "+u+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+u+`

`+e.tab+"}"),l!==null){e.addFlowCode(` else {

`).addFlowTab();let p=l.build(e,s);p&&(c?p=h+" = "+p+";":p="return "+p+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+p+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(h,s,i)}}const mo=Ce(qfe);Be("select",mo);const x4=(...n)=>(console.warn("TSL.ConditionalNode: cond() has been renamed to select()."),mo(...n));Be("cond",x4);class FN extends Jt{static get type(){return"ContextNode"}constructor(e,i={}){super(),this.isContextNode=!0,this.node=e,this.value=i}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){this.node.build(e)}setup(e){const i=e.getContext();e.setContext({...e.context,...this.value});const s=this.node.build(e);return e.setContext(i),s}generate(e,i){const s=e.getContext();e.setContext({...e.context,...this.value});const r=this.node.build(e,i);return e.setContext(s),r}}const UN=Ce(FN),w4=(n,e)=>UN(n,{label:e});Be("context",UN),Be("label",w4);class C4 extends Jt{static get type(){return"VarNode"}constructor(e,i=null){super(),this.node=e,this.name=i,this.global=!0,this.isVarNode=!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:i,name:s}=this,r=e.getVarFromNode(this,s,e.getVectorType(this.getNodeType(e))),o=e.getPropertyName(r),a=i.build(e,r.type);return e.addLineFlowCode(`${o} = ${a}`,this),o}}const ON=Ce(C4);Be("temp",ON),Be("toVar",(...n)=>ON(...n).append());class S4 extends Jt{static get type(){return"VaryingNode"}constructor(e,i=null){super(),this.node=e,this.name=i,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const i=e.getNodeProperties(this);let s=i.varying;if(s===void 0){const r=this.name,o=this.getNodeType(e);i.varying=s=e.getVaryingFromNode(this,r,o),i.node=this.node}return s.needsInterpolation||(s.needsInterpolation=e.shaderStage==="fragment"),s}setup(e){this.setupVarying(e)}analyze(e){return this.setupVarying(e),this.node.analyze(e)}generate(e){const i=e.getNodeProperties(this),s=this.setupVarying(e);if(i.propertyName===void 0){const r=this.getNodeType(e),o=e.getPropertyName(s,lN.VERTEX);e.flowNodeFromShaderStage(lN.VERTEX,this.node,r,o),i.propertyName=o}return e.getPropertyName(s)}}const go=Ce(S4);Be("varying",go);const U1="WorkingColorSpace",ZN="OutputColorSpace";function _4(n){let e=null;return n===qi?e="Linear":n===ut&&(e="sRGB"),e}function UT(n,e){return _4(n)+"To"+_4(e)}class O1 extends Ti{static get type(){return"ColorSpaceNode"}constructor(e,i,s){super("vec4"),this.colorNode=e,this.source=i,this.target=s}getColorSpace(e,i){return i===U1?hi.workingColorSpace:i===ZN?e.context.outputColorSpace||e.renderer.outputColorSpace:i}setup(e){const{renderer:i}=e,{colorNode:s}=this,r=this.getColorSpace(e,this.source),o=this.getColorSpace(e,this.target);if(r===o)return s;const a=UT(r,o);let l=null;const c=i.nodes.library.getColorSpaceFunction(a);return c!==null?l=Qe(c(s.rgb),s.a):(console.error("ColorSpaceNode: Unsupported Color Space configuration.",a),l=s),l}}const M4=n=>ge(new O1(ge(n),U1,ZN)),I4=n=>ge(new O1(ge(n),ZN,U1)),T4=(n,e)=>ge(new O1(ge(n),U1,e)),WN=(n,e)=>ge(new O1(ge(n),e,U1));Be("toOutputColorSpace",M4),Be("toWorkingColorSpace",I4),Be("workingToColorSpace",T4),Be("colorSpaceToWorking",WN);let $fe=class extends gm{static get type(){return"ReferenceElementNode"}constructor(n,e){super(n,e),this.referenceNode=n,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(n){const e=super.generate(n),i=this.referenceNode.getNodeType(),s=this.getNodeType();return n.format(e,i,s)}};class E4 extends Jt{static get type(){return"ReferenceBaseNode"}constructor(e,i,s=null,r=null){super(),this.property=e,this.uniformType=i,this.object=s,this.count=r,this.properties=e.split("."),this.reference=s,this.node=null,this.group=null,this.updateType=Ht.OBJECT}setGroup(e){return this.group=e,this}element(e){return ge(new $fe(this,ge(e)))}setNodeType(e){const i=tt(null,e).getSelf();this.group!==null&&i.setGroup(this.group),this.node=i}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:i}=this;let s=e[i[0]];for(let r=1;r<i.length;r++)s=s[i[r]];return s}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const e0e=(n,e,i)=>ge(new E4(n,e,i));class R4 extends E4{static get type(){return"RendererReferenceNode"}constructor(e,i,s=null){super(e,i,s),this.renderer=s,this.setGroup(Zi)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const L4=(n,e,i)=>ge(new R4(n,e,i));class B4 extends Ti{static get type(){return"ToneMappingNode"}constructor(e,i=G4,s=null){super("vec3"),this.toneMapping=e,this.exposureNode=i,this.colorNode=s}getCacheKey(){return nN(super.getCacheKey(),this.toneMapping)}setup(e){const i=this.colorNode||e.context.color,s=this.toneMapping;if(s===kr)return i;let r=null;const o=e.renderer.nodes.library.getToneMappingFunction(s);return o!==null?r=Qe(o(i.rgb,this.exposureNode),i.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",s),r=i),r}}const k4=(n,e,i)=>ge(new B4(n,ge(e),ge(i))),G4=L4("toneMappingExposure","float");Be("toneMapping",(n,e,i)=>k4(e,i,n));class P4 extends uN{static get type(){return"BufferAttributeNode"}constructor(e,i=null,s=0,r=0){super(e,i),this.isBufferNode=!0,this.bufferType=i,this.bufferStride=s,this.bufferOffset=r,this.usage=iy,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let i=e.globalCache.getData(this.value);return i===void 0&&(i={node:this},e.globalCache.setData(this.value,i)),i.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const i=this.getNodeType(e),s=this.value,r=e.getTypeLength(i),o=this.bufferStride||r,a=this.bufferOffset,l=s.isInterleavedBuffer===!0?s:new Cy(s,o),c=new xa(l,r,a);l.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const i=this.getNodeType(e),s=e.getBufferAttributeFromNode(this,i),r=e.getPropertyName(s);let o=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=r,o=r):o=go(this).build(e,i),o}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const Z1=(n,e,i,s)=>ge(new P4(n,e,i,s)),N4=(n,e,i,s)=>Z1(n,e,i,s).setUsage(Fs),OT=(n,e,i,s)=>Z1(n,e,i,s).setInstanced(!0),HN=(n,e,i,s)=>N4(n,e,i,s).setInstanced(!0);Be("toAttribute",n=>Z1(n.value));class V4 extends Jt{static get type(){return"ComputeNode"}constructor(e,i,s=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=i,this.workgroupSize=s,this.dispatchCount=0,this.version=1,this.updateBeforeType=Ht.OBJECT,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}updateDispatchCount(){const{count:e,workgroupSize:i}=this;let s=i[0];for(let r=1;r<i.length;r++)s*=i[r];this.dispatchCount=Math.ceil(e/s)}onInit(){}updateBefore({renderer:e}){e.compute(this)}generate(e){const{shaderStage:i}=e;if(i==="compute"){const s=this.computeNode.build(e,"void");s!==""&&e.addLineFlowCode(s,this)}}}const X4=(n,e,i)=>ge(new V4(ge(n),e,i));Be("compute",X4);class D4 extends Jt{static get type(){return"CacheNode"}constructor(e,i=!0){super(),this.node=e,this.parent=i,this.isCacheNode=!0}getNodeType(e){return this.node.getNodeType(e)}build(e,...i){const s=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const o=this.node.build(e,...i);return e.setCache(s),o}}const W1=(n,...e)=>ge(new D4(ge(n),...e));Be("cache",W1);class z4 extends Jt{static get type(){return"BypassNode"}constructor(e,i){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=i}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const i=this.callNode.build(e,"void");return i!==""&&e.addLineFlowCode(i,this),this.outputNode.build(e)}}const F4=Ce(z4);Be("bypass",F4);class QN extends Jt{static get type(){return"RemapNode"}constructor(e,i,s,r=D(0),o=D(1)){super(),this.node=e,this.inLowNode=i,this.inHighNode=s,this.outLowNode=r,this.outHighNode=o,this.doClamp=!0}setup(){const{node:e,inLowNode:i,inHighNode:s,outLowNode:r,outHighNode:o,doClamp:a}=this;let l=e.sub(i).div(s.sub(i));return a===!0&&(l=l.clamp()),l.mul(o.sub(r)).add(r)}}const U4=Ce(QN,null,null,{doClamp:!1}),O4=Ce(QN);Be("remap",U4),Be("remapClamp",O4);class Z4 extends Jt{static get type(){return"ExpressionNode"}constructor(e="",i="void"){super(i),this.snippet=e}generate(e,i){const s=this.getNodeType(e),r=this.snippet;if(s==="void")e.addLineFlowCode(r,this);else return e.format(`( ${r} )`,s,i)}}const vm=Ce(Z4),W4=n=>(n?mo(n,vm("discard")):vm("discard")).append(),t0e=()=>vm("return").append();Be("discard",W4);class H4 extends Ti{static get type(){return"RenderOutputNode"}constructor(e,i,s){super("vec4"),this.colorNode=e,this.toneMapping=i,this.outputColorSpace=s,this.isRenderOutput=!0}setup({context:e}){let i=this.colorNode||e.color;const s=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||kr,r=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||ho;return s!==kr&&(i=i.toneMapping(s)),r!==ho&&r!==hi.workingColorSpace&&(i=i.workingToColorSpace(r)),i}}const Q4=(n,e=null,i=null)=>ge(new H4(ge(n),e,i));Be("renderOutput",Q4);function i0e(n){console.warn("THREE.TSLBase: AddNodeElement has been removed in favor of tree-shaking. Trying add",n)}class KN extends Jt{static get type(){return"AttributeNode"}constructor(e,i=null){super(i),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let i=this.nodeType;if(i===null){const s=this.getAttributeName(e);if(e.hasGeometryAttribute(s)){const r=e.geometry.getAttribute(s);i=e.getTypeFromAttribute(r)}else i="float"}return i}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const i=this.getAttributeName(e),s=this.getNodeType(e);if(e.hasGeometryAttribute(i)===!0){const r=e.geometry.getAttribute(i),o=e.getTypeFromAttribute(r),a=e.getAttribute(i,o);return e.shaderStage==="vertex"?e.format(a.name,o,s):go(this).build(e,s)}else return console.warn(`AttributeNode: Vertex attribute "${i}" not found on geometry.`),e.generateConst(s)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const Xr=(n,e)=>ge(new KN(n,e)),yi=n=>Xr("uv"+(n>0?n:""),"vec2");class K4 extends Jt{static get type(){return"TextureSizeNode"}constructor(e,i=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=i}generate(e,i){const s=this.textureNode.build(e,"property"),r=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${s}, ${r} )`,this.getNodeType(e),i)}}const xm=Ce(K4);class Y4 extends Ff{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=Ht.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,i=e.images,s=i&&i.length>0?i[0]&&i[0].image||i[0]:e.image;if(s&&s.width!==void 0){const{width:r,height:o}=s;this.value=Math.log2(Math.max(r,o))}}}const j4=Ce(Y4);class pd extends Ff{static get type(){return"TextureNode"}constructor(e,i=null,s=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=i,this.levelNode=s,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Ht.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(i===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Gr?"uvec4":this.value.type===nd?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return yi(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=tt(this.value.matrix)),this._matrixUniform.mul(j(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?Ht.FRAME:Ht.NONE,this}setupUV(e,i){const s=this.value;return e.isFlipY()&&(s.isRenderTargetTexture===!0||s.isFramebufferTexture===!0||s.isDepthTexture===!0)&&(this.sampler?i=i.flipY():i=i.setY(K(xm(this,this.levelNode).y).sub(i.y).sub(1))),i}setup(e){const i=e.getNodeProperties(this);i.referenceNode=this.referenceNode;let s=this.uvNode;(s===null||e.context.forceUVContext===!0)&&e.context.getUV&&(s=e.context.getUV(this)),s||(s=this.getDefaultUV()),this.updateMatrix===!0&&(s=this.getTransformedUV(s)),s=this.setupUV(e,s);let r=this.levelNode;r===null&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),i.uvNode=s,i.levelNode=r,i.biasNode=this.biasNode,i.compareNode=this.compareNode,i.gradNode=this.gradNode,i.depthNode=this.depthNode}generateUV(e,i){return i.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,i,s,r,o,a,l,c){const h=this.value;let d;return r?d=e.generateTextureLevel(h,i,s,r,a):o?d=e.generateTextureBias(h,i,s,o,a):c?d=e.generateTextureGrad(h,i,s,c,a):l?d=e.generateTextureCompare(h,i,s,l,a):this.sampler===!1?d=e.generateTextureLoad(h,i,s,a):d=e.generateTexture(h,i,s,a),d}generate(e,i){const s=e.getNodeProperties(this),r=this.value;if(!r||r.isTexture!==!0)throw new Error("TextureNode: Need a three.js texture.");const o=super.generate(e,"property");if(i==="sampler")return o+"_sampler";if(e.isReference(i))return o;{const a=e.getDataFromNode(this);let l=a.propertyName;if(l===void 0){const{uvNode:d,levelNode:u,biasNode:p,compareNode:g,depthNode:f,gradNode:A}=s,y=this.generateUV(e,d),b=u?u.build(e,"float"):null,v=p?p.build(e,"float"):null,x=f?f.build(e,"int"):null,w=g?g.build(e,"float"):null,C=A?[A[0].build(e,"vec2"),A[1].build(e,"vec2")]:null,S=e.getVarFromNode(this);l=e.getPropertyName(S);const _=this.generateSnippet(e,o,y,b,v,x,w,C);e.addLineFlowCode(`${l} = ${_}`,this),a.snippet=_,a.propertyName=l}let c=l;const h=this.getNodeType(e);return e.needsToWorkingColorSpace(r)&&(c=WN(vm(c,h),r.colorSpace).setup(e).build(e,h)),e.format(c,h,i)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){const i=this.clone();return i.uvNode=ge(e),i.referenceNode=this.getSelf(),ge(i)}blur(e){const i=this.clone();return i.biasNode=ge(e).mul(j4(i)),i.referenceNode=this.getSelf(),ge(i)}level(e){const i=this.clone();return i.levelNode=ge(e),i.referenceNode=this.getSelf(),ge(i)}size(e){return xm(this,e)}bias(e){const i=this.clone();return i.biasNode=ge(e),i.referenceNode=this.getSelf(),ge(i)}compare(e){const i=this.clone();return i.compareNode=ge(e),i.referenceNode=this.getSelf(),ge(i)}grad(e,i){const s=this.clone();return s.gradNode=[ge(e),ge(i)],s.referenceNode=this.getSelf(),ge(s)}depth(e){const i=this.clone();return i.depthNode=ge(e),i.referenceNode=this.getSelf(),ge(i)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,i=this._matrixUniform;i!==null&&(i.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e}}const zi=Ce(pd),wc=(...n)=>zi(...n).setSampler(!1),n0e=n=>(n.isNode===!0?n:zi(n)).convert("sampler"),Vy=tt("float").label("cameraNear").setGroup(Zi).onRenderUpdate(({camera:n})=>n.near),Xy=tt("float").label("cameraFar").setGroup(Zi).onRenderUpdate(({camera:n})=>n.far),J4=tt("float").label("cameraLogDepth").setGroup(Zi).onRenderUpdate(({camera:n})=>2/(Math.log(n.far+1)/Math.LN2)),qa=tt("mat4").label("cameraProjectionMatrix").setGroup(Zi).onRenderUpdate(({camera:n})=>n.projectionMatrix),s0e=tt("mat4").label("cameraProjectionMatrixInverse").setGroup(Zi).onRenderUpdate(({camera:n})=>n.projectionMatrixInverse),$a=tt("mat4").label("cameraViewMatrix").setGroup(Zi).onRenderUpdate(({camera:n})=>n.matrixWorldInverse),r0e=tt("mat4").label("cameraWorldMatrix").setGroup(Zi).onRenderUpdate(({camera:n})=>n.matrixWorld),o0e=tt("mat3").label("cameraNormalMatrix").setGroup(Zi).onRenderUpdate(({camera:n})=>n.normalMatrix),YN=tt(new E).label("cameraPosition").setGroup(Zi).onRenderUpdate(({camera:n},e)=>e.value.setFromMatrixPosition(n.matrixWorld));class $i extends Jt{static get type(){return"Object3DNode"}constructor(e,i=null){super(),this.scope=e,this.object3d=i,this.updateType=Ht.OBJECT,this._uniformNode=new Ff(null)}getNodeType(){const e=this.scope;if(e===$i.WORLD_MATRIX)return"mat4";if(e===$i.POSITION||e===$i.VIEW_POSITION||e===$i.DIRECTION||e===$i.SCALE)return"vec3"}update(e){const i=this.object3d,s=this._uniformNode,r=this.scope;if(r===$i.WORLD_MATRIX)s.value=i.matrixWorld;else if(r===$i.POSITION)s.value=s.value||new E,s.value.setFromMatrixPosition(i.matrixWorld);else if(r===$i.SCALE)s.value=s.value||new E,s.value.setFromMatrixScale(i.matrixWorld);else if(r===$i.DIRECTION)s.value=s.value||new E,i.getWorldDirection(s.value);else if(r===$i.VIEW_POSITION){const o=e.camera;s.value=s.value||new E,s.value.setFromMatrixPosition(i.matrixWorld),s.value.applyMatrix4(o.matrixWorldInverse)}}generate(e){const i=this.scope;return i===$i.WORLD_MATRIX?this._uniformNode.nodeType="mat4":(i===$i.POSITION||i===$i.VIEW_POSITION||i===$i.DIRECTION||i===$i.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}$i.WORLD_MATRIX="worldMatrix",$i.POSITION="position",$i.SCALE="scale",$i.VIEW_POSITION="viewPosition",$i.DIRECTION="direction";const a0e=Ce($i,$i.DIRECTION),l0e=Ce($i,$i.WORLD_MATRIX),c0e=Ce($i,$i.POSITION),h0e=Ce($i,$i.SCALE),d0e=Ce($i,$i.VIEW_POSITION);class mh extends $i{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const u0e=it(mh,mh.DIRECTION),Cc=it(mh,mh.WORLD_MATRIX),p0e=it(mh,mh.POSITION),m0e=it(mh,mh.SCALE),g0e=it(mh,mh.VIEW_POSITION),q4=tt(new oi).onObjectUpdate(({object:n},e)=>e.value.getNormalMatrix(n.matrixWorld)),$4=tt(new de).onObjectUpdate(({object:n},e)=>e.value.copy(n.matrixWorld).invert()),md=$a.mul(Cc).toVar("modelViewMatrix_2"),f0e=ie(n=>(n.context.isHighPrecisionModelViewMatrix=!0,tt("mat4").onObjectUpdate(({object:e,camera:i})=>e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highPrecisionModelViewMatrix"),A0e=ie(n=>{const e=n.context.isHighPrecisionModelViewMatrix;return tt("mat3").onObjectUpdate(({object:i,camera:s})=>(e!==!0&&i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld),i.normalMatrix.getNormalMatrix(i.modelViewMatrix)))}).once()().toVar("highPrecisionModelNormalMatrix"),fo=Xr("position","vec3"),Bs=fo.varying("positionLocal"),ZT=fo.varying("positionPrevious"),WT=Cc.mul(Bs).xyz.varying("v_positionWorld"),jN=Bs.transformDirection(Cc).varying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),Ao=md.mul(Bs).xyz.varying("v_positionView"),Xn=Ao.negate().varying("v_positionViewDirection").normalize().toVar("positionViewDirection");class eK extends Jt{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:i,material:s}=e;return i.coordinateSystem===Ac&&s.side===wn?"false":e.getFrontFacing()}}const tK=it(eK),H1=D(tK).mul(2).sub(1),HT=Xr("normal","vec3"),el=ie(n=>n.geometry.hasAttribute("normal")===!1?(console.warn('TSL.NormalNode: Vertex attribute "normal" not found on geometry.'),j(0,1,0)):HT,"vec3").once()().toVar("normalLocal"),iK=Ao.dFdx().cross(Ao.dFdy()).normalize().toVar("normalFlat"),Ml=ie(n=>{let e;return n.material.flatShading===!0?e=iK:e=go(qN(el),"v_normalView").normalize(),e},"vec3").once()().toVar("normalView"),QT=go(Ml.transformDirection($a),"v_normalWorld").normalize().toVar("normalWorld"),ys=ie(n=>n.context.setupNormal(),"vec3").once()().mul(H1).toVar("transformedNormalView"),JN=ys.transformDirection($a).toVar("transformedNormalWorld"),Dy=ie(n=>n.context.setupClearcoatNormal(),"vec3").once()().mul(H1).toVar("transformedClearcoatNormalView"),nK=ie(([n,e=Cc])=>{const i=Nr(e),s=n.div(j(i[0].dot(i[0]),i[1].dot(i[1]),i[2].dot(i[2])));return i.mul(s).xyz}),qN=ie(([n],e)=>{const i=e.renderer.nodes.modelNormalViewMatrix;if(i!==null)return i.transformDirection(n);const s=q4.mul(n);return $a.transformDirection(s)}),sK=tt(0).onReference(({material:n})=>n).onRenderUpdate(({material:n})=>n.refractionRatio),rK=Xn.negate().reflect(ys),oK=Xn.negate().refract(ys,sK),aK=rK.transformDirection($a).toVar("reflectVector"),lK=oK.transformDirection($a).toVar("reflectVector");class cK extends pd{static get type(){return"CubeTextureNode"}constructor(e,i=null,s=null,r=null){super(e,i,s,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===bl?aK:e.mapping===gc?lK:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),j(0,0,0))}setUpdateMatrix(){}setupUV(e,i){const s=this.value;return e.renderer.coordinateSystem===gf||!s.isRenderTargetTexture?j(i.x.negate(),i.yz):i}generateUV(e,i){return i.build(e,"vec3")}}const KT=Ce(cK);class YT extends Ff{static get type(){return"BufferNode"}constructor(e,i,s=0){super(e,i),this.isBufferNode=!0,this.bufferType=i,this.bufferCount=s}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const Q1=(n,e,i)=>ge(new YT(n,e,i));class y0e extends gm{static get type(){return"UniformArrayElementNode"}constructor(e,i){super(e,i),this.isArrayBufferElementNode=!0}generate(e){const i=super.generate(e),s=this.getNodeType();return e.format(i,"vec4",s)}}class $N extends YT{static get type(){return"UniformArrayNode"}constructor(e,i=null){super(null,"vec4"),this.array=e,this.elementType=i,this._elementType=null,this._elementLength=0,this.updateType=Ht.RENDER,this.isArrayBufferNode=!0}getElementType(){return this.elementType||this._elementType}getElementLength(){return this._elementLength}update(){const{array:e,value:i}=this,s=this.getElementLength(),r=this.getElementType();if(s===1)for(let o=0;o<e.length;o++){const a=o*4;i[a]=e[o]}else if(r==="color")for(let o=0;o<e.length;o++){const a=o*4,l=e[o];i[a]=l.r,i[a+1]=l.g,i[a+2]=l.b||0}else for(let o=0;o<e.length;o++){const a=o*4,l=e[o];i[a]=l.x,i[a+1]=l.y,i[a+2]=l.z||0,i[a+3]=l.w||0}}setup(e){const i=this.array.length;this._elementType=this.elementType===null?ku(this.array[0]):this.elementType,this._elementLength=e.getTypeLength(this._elementType);let s=Float32Array;return this._elementType.charAt(0)==="i"?s=Int32Array:this._elementType.charAt(0)==="u"&&(s=Uint32Array),this.value=new s(i*4),this.bufferCount=i,this.bufferType=e.changeComponentType("vec4",e.getComponentType(this._elementType)),super.setup(e)}element(e){return ge(new y0e(this,ge(e)))}}const gd=(n,e)=>ge(new $N(n,e)),b0e=(n,e)=>(console.warn("TSL.UniformArrayNode: uniforms() has been renamed to uniformArray()."),ge(new $N(n,e)));class v0e extends gm{static get type(){return"ReferenceElementNode"}constructor(e,i){super(e,i),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const i=super.generate(e),s=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(i,s,r)}}class K1 extends Jt{static get type(){return"ReferenceNode"}constructor(e,i,s=null,r=null){super(),this.property=e,this.uniformType=i,this.object=s,this.count=r,this.properties=e.split("."),this.reference=s,this.node=null,this.group=null,this.name=null,this.updateType=Ht.OBJECT}element(e){return ge(new v0e(this,ge(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let i=null;this.count!==null?i=Q1(null,e,this.count):Array.isArray(this.getValueFromReference())?i=gd(null,e):e==="texture"?i=zi(null):e==="cubeTexture"?i=KT(null):i=tt(null,e),this.group!==null&&i.setGroup(this.group),this.name!==null&&i.label(this.name),this.node=i.getSelf()}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:i}=this;let s=e[i[0]];for(let r=1;r<i.length;r++)s=s[i[r]];return s}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const wr=(n,e,i)=>ge(new K1(n,e,i)),eV=(n,e,i,s)=>ge(new K1(n,e,s,i));class hK extends K1{static get type(){return"MaterialReferenceNode"}constructor(e,i,s=null){super(e,i,s),this.material=s,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const gh=(n,e,i)=>ge(new hK(n,e,i)),jT=ie(n=>(n.geometry.hasAttribute("tangent")===!1&&n.geometry.computeTangents(),Xr("tangent","vec4")))(),Y1=jT.xyz.toVar("tangentLocal"),j1=md.mul(Qe(Y1,0)).xyz.varying("v_tangentView").normalize().toVar("tangentView"),dK=j1.transformDirection($a).varying("v_tangentWorld").normalize().toVar("tangentWorld"),tV=j1.toVar("transformedTangentView"),x0e=tV.transformDirection($a).normalize().toVar("transformedTangentWorld"),J1=n=>n.mul(jT.w).xyz,w0e=go(J1(HT.cross(jT)),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),C0e=go(J1(el.cross(Y1)),"v_bitangentLocal").normalize().toVar("bitangentLocal"),uK=go(J1(Ml.cross(j1)),"v_bitangentView").normalize().toVar("bitangentView"),S0e=go(J1(QT.cross(dK)),"v_bitangentWorld").normalize().toVar("bitangentWorld"),pK=J1(ys.cross(tV)).normalize().toVar("transformedBitangentView"),_0e=pK.transformDirection($a).normalize().toVar("transformedBitangentWorld"),Qf=Nr(j1,uK,Ml),mK=Xn.mul(Qf),M0e=(n,e)=>n.sub(mK.mul(e)),gK=(()=>{let n=Of.cross(Xn);return n=n.cross(Of).normalize(),n=Ai(n,ys,Am.mul(ud.oneMinus()).oneMinus().pow2().pow2()).normalize(),n})(),I0e=ie(n=>{const{eye_pos:e,surf_norm:i,mapN:s,uv:r}=n,o=e.dFdx(),a=e.dFdy(),l=r.dFdx(),c=r.dFdy(),h=i,d=a.cross(h),u=h.cross(o),p=d.mul(l.x).add(u.mul(c.x)),g=d.mul(l.y).add(u.mul(c.y)),f=p.dot(p).max(g.dot(g)),A=H1.mul(f.inverseSqrt());return Hn(p.mul(s.x,A),g.mul(s.y,A),h.mul(s.z)).normalize()});class fK extends Ti{static get type(){return"NormalMapNode"}constructor(e,i=null){super("vec3"),this.node=e,this.scaleNode=i,this.normalMapType=sd}setup(e){const{normalMapType:i,scaleNode:s}=this;let r=this.node.mul(2).sub(1);s!==null&&(r=j(r.xy.mul(s),r.z));let o=null;return i===vG?o=qN(r):i===sd&&(e.hasGeometryAttribute("tangent")===!0?o=Qf.mul(r).normalize():o=I0e({eye_pos:Ao,surf_norm:Ml,mapN:r,uv:yi()})),o}}const iV=Ce(fK),T0e=ie(({textureNode:n,bumpScale:e})=>{const i=r=>n.cache().context({getUV:o=>r(o.uvNode||yi()),forceUVContext:!0}),s=D(i(r=>r));return ae(D(i(r=>r.add(r.dFdx()))).sub(s),D(i(r=>r.add(r.dFdy()))).sub(s)).mul(e)}),E0e=ie(n=>{const{surf_pos:e,surf_norm:i,dHdxy:s}=n,r=e.dFdx().normalize(),o=e.dFdy().normalize(),a=i,l=o.cross(a),c=a.cross(r),h=r.dot(l).mul(H1),d=h.sign().mul(s.x.mul(l).add(s.y.mul(c)));return h.abs().mul(i).sub(d).normalize()});class AK extends Ti{static get type(){return"BumpMapNode"}constructor(e,i=null){super("vec3"),this.textureNode=e,this.scaleNode=i}setup(){const e=this.scaleNode!==null?this.scaleNode:1,i=T0e({textureNode:this.textureNode,bumpScale:e});return E0e({surf_pos:Ao,surf_norm:Ml,dHdxy:i})}}const yK=Ce(AK),bK=new Map;class Me extends Jt{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,i){let s=bK.get(e);return s===void 0&&(s=gh(e,i),bK.set(e,s)),s}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const i=e.context.material,s=this.scope;let r=null;if(s===Me.COLOR){const o=i.color!==void 0?this.getColor(s):j();i.map&&i.map.isTexture===!0?r=o.mul(this.getTexture("map")):r=o}else if(s===Me.OPACITY){const o=this.getFloat(s);i.alphaMap&&i.alphaMap.isTexture===!0?r=o.mul(this.getTexture("alpha")):r=o}else if(s===Me.SPECULAR_STRENGTH)i.specularMap&&i.specularMap.isTexture===!0?r=this.getTexture("specular").r:r=D(1);else if(s===Me.SPECULAR_INTENSITY){const o=this.getFloat(s);i.specularMap?r=o.mul(this.getTexture(s).a):r=o}else if(s===Me.SPECULAR_COLOR){const o=this.getColor(s);i.specularColorMap&&i.specularColorMap.isTexture===!0?r=o.mul(this.getTexture(s).rgb):r=o}else if(s===Me.ROUGHNESS){const o=this.getFloat(s);i.roughnessMap&&i.roughnessMap.isTexture===!0?r=o.mul(this.getTexture(s).g):r=o}else if(s===Me.METALNESS){const o=this.getFloat(s);i.metalnessMap&&i.metalnessMap.isTexture===!0?r=o.mul(this.getTexture(s).b):r=o}else if(s===Me.EMISSIVE){const o=this.getFloat("emissiveIntensity"),a=this.getColor(s).mul(o);i.emissiveMap&&i.emissiveMap.isTexture===!0?r=a.mul(this.getTexture(s)):r=a}else if(s===Me.NORMAL)i.normalMap?(r=iV(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=i.normalMapType):i.bumpMap?r=yK(this.getTexture("bump").r,this.getFloat("bumpScale")):r=Ml;else if(s===Me.CLEARCOAT){const o=this.getFloat(s);i.clearcoatMap&&i.clearcoatMap.isTexture===!0?r=o.mul(this.getTexture(s).r):r=o}else if(s===Me.CLEARCOAT_ROUGHNESS){const o=this.getFloat(s);i.clearcoatRoughnessMap&&i.clearcoatRoughnessMap.isTexture===!0?r=o.mul(this.getTexture(s).r):r=o}else if(s===Me.CLEARCOAT_NORMAL)i.clearcoatNormalMap?r=iV(this.getTexture(s),this.getCache(s+"Scale","vec2")):r=Ml;else if(s===Me.SHEEN){const o=this.getColor("sheenColor").mul(this.getFloat("sheen"));i.sheenColorMap&&i.sheenColorMap.isTexture===!0?r=o.mul(this.getTexture("sheenColor").rgb):r=o}else if(s===Me.SHEEN_ROUGHNESS){const o=this.getFloat(s);i.sheenRoughnessMap&&i.sheenRoughnessMap.isTexture===!0?r=o.mul(this.getTexture(s).a):r=o,r=r.clamp(.07,1)}else if(s===Me.ANISOTROPY)if(i.anisotropyMap&&i.anisotropyMap.isTexture===!0){const o=this.getTexture(s);r=B1(Fy.x,Fy.y,Fy.y.negate(),Fy.x).mul(o.rg.mul(2).sub(ae(1)).normalize().mul(o.b))}else r=Fy;else if(s===Me.IRIDESCENCE_THICKNESS){const o=wr("1","float",i.iridescenceThicknessRange);if(i.iridescenceThicknessMap){const a=wr("0","float",i.iridescenceThicknessRange);r=o.sub(a).mul(this.getTexture(s).g).add(a)}else r=o}else if(s===Me.TRANSMISSION){const o=this.getFloat(s);i.transmissionMap?r=o.mul(this.getTexture(s).r):r=o}else if(s===Me.THICKNESS){const o=this.getFloat(s);i.thicknessMap?r=o.mul(this.getTexture(s).g):r=o}else if(s===Me.IOR)r=this.getFloat(s);else if(s===Me.LIGHT_MAP)r=this.getTexture(s).rgb.mul(this.getFloat("lightMapIntensity"));else if(s===Me.AO_MAP)r=this.getTexture(s).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const o=this.getNodeType(e);r=this.getCache(s,o)}return r}}Me.ALPHA_TEST="alphaTest",Me.COLOR="color",Me.OPACITY="opacity",Me.SHININESS="shininess",Me.SPECULAR="specular",Me.SPECULAR_STRENGTH="specularStrength",Me.SPECULAR_INTENSITY="specularIntensity",Me.SPECULAR_COLOR="specularColor",Me.REFLECTIVITY="reflectivity",Me.ROUGHNESS="roughness",Me.METALNESS="metalness",Me.NORMAL="normal",Me.CLEARCOAT="clearcoat",Me.CLEARCOAT_ROUGHNESS="clearcoatRoughness",Me.CLEARCOAT_NORMAL="clearcoatNormal",Me.EMISSIVE="emissive",Me.ROTATION="rotation",Me.SHEEN="sheen",Me.SHEEN_ROUGHNESS="sheenRoughness",Me.ANISOTROPY="anisotropy",Me.IRIDESCENCE="iridescence",Me.IRIDESCENCE_IOR="iridescenceIOR",Me.IRIDESCENCE_THICKNESS="iridescenceThickness",Me.IOR="ior",Me.TRANSMISSION="transmission",Me.THICKNESS="thickness",Me.ATTENUATION_DISTANCE="attenuationDistance",Me.ATTENUATION_COLOR="attenuationColor",Me.LINE_SCALE="scale",Me.LINE_DASH_SIZE="dashSize",Me.LINE_GAP_SIZE="gapSize",Me.LINE_WIDTH="linewidth",Me.LINE_DASH_OFFSET="dashOffset",Me.POINT_WIDTH="pointWidth",Me.DISPERSION="dispersion",Me.LIGHT_MAP="light",Me.AO_MAP="ao";const vK=it(Me,Me.ALPHA_TEST),zy=it(Me,Me.COLOR),xK=it(Me,Me.SHININESS),wK=it(Me,Me.EMISSIVE),JT=it(Me,Me.OPACITY),CK=it(Me,Me.SPECULAR),nV=it(Me,Me.SPECULAR_INTENSITY),SK=it(Me,Me.SPECULAR_COLOR),q1=it(Me,Me.SPECULAR_STRENGTH),qT=it(Me,Me.REFLECTIVITY),_K=it(Me,Me.ROUGHNESS),MK=it(Me,Me.METALNESS),IK=it(Me,Me.NORMAL).context({getUV:null}),TK=it(Me,Me.CLEARCOAT),EK=it(Me,Me.CLEARCOAT_ROUGHNESS),RK=it(Me,Me.CLEARCOAT_NORMAL).context({getUV:null}),LK=it(Me,Me.ROTATION),BK=it(Me,Me.SHEEN),kK=it(Me,Me.SHEEN_ROUGHNESS),GK=it(Me,Me.ANISOTROPY),PK=it(Me,Me.IRIDESCENCE),NK=it(Me,Me.IRIDESCENCE_IOR),VK=it(Me,Me.IRIDESCENCE_THICKNESS),XK=it(Me,Me.TRANSMISSION),DK=it(Me,Me.THICKNESS),zK=it(Me,Me.IOR),FK=it(Me,Me.ATTENUATION_DISTANCE),UK=it(Me,Me.ATTENUATION_COLOR),$T=it(Me,Me.LINE_SCALE),sV=it(Me,Me.LINE_DASH_SIZE),rV=it(Me,Me.LINE_GAP_SIZE),eE=it(Me,Me.LINE_WIDTH),oV=it(Me,Me.LINE_DASH_OFFSET),OK=it(Me,Me.POINT_WIDTH),ZK=it(Me,Me.DISPERSION),aV=it(Me,Me.LIGHT_MAP),WK=it(Me,Me.AO_MAP),Fy=tt(new Q).onReference(function(n){return n.material}).onRenderUpdate(function({material:n}){this.value.set(n.anisotropy*Math.cos(n.anisotropyRotation),n.anisotropy*Math.sin(n.anisotropyRotation))});class HK extends Ti{static get type(){return"ModelViewProjectionNode"}constructor(e=null){super("vec4"),this.positionNode=e}setup(e){if(e.shaderStage==="fragment")return go(e.context.mvp);const i=this.positionNode||Bs,s=e.renderer.nodes.modelViewMatrix||md;return qa.mul(s).mul(i)}}const lV=Ce(HK);class Zn extends Jt{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isInstanceIndexNode=!0}generate(e){const i=this.getNodeType(e),s=this.scope;let r;if(s===Zn.VERTEX)r=e.getVertexIndex();else if(s===Zn.INSTANCE)r=e.getInstanceIndex();else if(s===Zn.DRAW)r=e.getDrawIndex();else if(s===Zn.INVOCATION_LOCAL)r=e.getInvocationLocalIndex();else if(s===Zn.INVOCATION_SUBGROUP)r=e.getInvocationSubgroupIndex();else if(s===Zn.SUBGROUP)r=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+s);let o;return e.shaderStage==="vertex"||e.shaderStage==="compute"?o=r:o=go(this).build(e,i),o}}Zn.VERTEX="vertex",Zn.INSTANCE="instance",Zn.SUBGROUP="subgroup",Zn.INVOCATION_LOCAL="invocationLocal",Zn.INVOCATION_SUBGROUP="invocationSubgroup",Zn.DRAW="draw";const QK=it(Zn,Zn.VERTEX),$1=it(Zn,Zn.INSTANCE),R0e=it(Zn,Zn.SUBGROUP),L0e=it(Zn,Zn.INVOCATION_SUBGROUP),B0e=it(Zn,Zn.INVOCATION_LOCAL),KK=it(Zn,Zn.DRAW);class YK extends Jt{static get type(){return"InstanceNode"}constructor(e){super("void"),this.instanceMesh=e,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Ht.FRAME,this.buffer=null,this.bufferColor=null}setup(e){let i=this.instanceMatrixNode,s=this.instanceColorNode;const r=this.instanceMesh;if(i===null){const l=r.instanceMatrix;if(r.count<=1e3)i=Q1(l.array,"mat4",Math.max(r.count,1)).element($1);else{const c=new _1(l.array,16,1);this.buffer=c;const h=l.usage===Fs?HN:OT,d=[h(c,"vec4",16,0),h(c,"vec4",16,4),h(c,"vec4",16,8),h(c,"vec4",16,12)];i=zf(...d)}this.instanceMatrixNode=i}const o=r.instanceColor;if(o&&s===null){const l=new Yo(o.array,3),c=o.usage===Fs?HN:OT;this.bufferColor=l,s=j(c(l,"vec3",3,0)),this.instanceColorNode=s}const a=i.mul(Bs).xyz;if(Bs.assign(a),e.hasGeometryAttribute("normal")){const l=nK(el,i);el.assign(l)}this.instanceColorNode!==null&&dh("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMesh.instanceMatrix.usage!==Fs&&this.buffer!=null&&this.instanceMesh.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMesh.instanceMatrix.version),this.instanceMesh.instanceColor&&this.instanceMesh.instanceColor.usage!==Fs&&this.bufferColor!=null&&this.instanceMesh.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceMesh.instanceColor.version)}}const jK=Ce(YK);class JK extends Jt{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=$1:this.batchingIdNode=KK);const i=ie(([g])=>{const f=xm(wc(this.batchMesh._indirectTexture),0),A=K(g).modInt(K(f)),y=K(g).div(K(f));return wc(this.batchMesh._indirectTexture,dd(A,y)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(K(this.batchingIdNode)),s=this.batchMesh._matricesTexture,r=xm(wc(s),0),o=D(i).mul(4).toInt().toVar(),a=o.modInt(r),l=o.div(K(r)),c=zf(wc(s,dd(a,l)),wc(s,dd(a.add(1),l)),wc(s,dd(a.add(2),l)),wc(s,dd(a.add(3),l))),h=this.batchMesh._colorsTexture;if(h!==null){const g=ie(([f])=>{const A=xm(wc(h),0).x,y=f,b=y.modInt(A),v=y.div(A);return wc(h,dd(b,v)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(i);dh("vec3","vBatchColor").assign(g)}const d=Nr(c);Bs.assign(c.mul(Bs));const u=el.div(j(d[0].dot(d[0]),d[1].dot(d[1]),d[2].dot(d[2]))),p=d.mul(u).xyz;el.assign(p),e.hasGeometryAttribute("tangent")&&Y1.mulAssign(d)}}const qK=Ce(JK),$K=new WeakMap;class cV extends Jt{static get type(){return"SkinningNode"}constructor(e,i=!1){super("void"),this.skinnedMesh=e,this.useReference=i,this.updateType=Ht.OBJECT,this.skinIndexNode=Xr("skinIndex","uvec4"),this.skinWeightNode=Xr("skinWeight","vec4");let s,r,o;i?(s=wr("bindMatrix","mat4"),r=wr("bindMatrixInverse","mat4"),o=eV("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(s=tt(e.bindMatrix,"mat4"),r=tt(e.bindMatrixInverse,"mat4"),o=Q1(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=s,this.bindMatrixInverseNode=r,this.boneMatricesNode=o,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,i=Bs){const{skinIndexNode:s,skinWeightNode:r,bindMatrixNode:o,bindMatrixInverseNode:a}=this,l=e.element(s.x),c=e.element(s.y),h=e.element(s.z),d=e.element(s.w),u=o.mul(i),p=Hn(l.mul(r.x).mul(u),c.mul(r.y).mul(u),h.mul(r.z).mul(u),d.mul(r.w).mul(u));return a.mul(p).xyz}getSkinnedNormal(e=this.boneMatricesNode,i=el){const{skinIndexNode:s,skinWeightNode:r,bindMatrixNode:o,bindMatrixInverseNode:a}=this,l=e.element(s.x),c=e.element(s.y),h=e.element(s.z),d=e.element(s.w);let u=Hn(r.x.mul(l),r.y.mul(c),r.z.mul(h),r.w.mul(d));return u=a.mul(u).mul(o),u.transformDirection(i).xyz}getPreviousSkinnedPosition(e){const i=e.object;return this.previousBoneMatricesNode===null&&(i.skeleton.previousBoneMatrices=new Float32Array(i.skeleton.boneMatrices),this.previousBoneMatricesNode=eV("skeleton.previousBoneMatrices","mat4",i.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,ZT)}needsPreviousBoneMatrices(e){const i=e.renderer.getMRT();return i&&i.has("velocity")}setup(e){this.needsPreviousBoneMatrices(e)&&ZT.assign(this.getPreviousSkinnedPosition(e));const i=this.getSkinnedPosition();if(Bs.assign(i),e.hasGeometryAttribute("normal")){const s=this.getSkinnedNormal();el.assign(s),e.hasGeometryAttribute("tangent")&&Y1.assign(s)}}generate(e,i){if(i!=="void")return Bs.build(e,i)}update(e){const i=(this.useReference?e.object:this.skinnedMesh).skeleton;$K.get(i)!==e.frameId&&($K.set(i,e.frameId),this.previousBoneMatricesNode!==null&&i.previousBoneMatrices.set(i.boneMatrices),i.update())}}const k0e=n=>ge(new cV(n)),eY=n=>ge(new cV(n,!0));class tY extends Jt{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode("i".charCodeAt()+e)}getProperties(e){const i=e.getNodeProperties(this);if(i.stackNode!==void 0)return i;const s={};for(let o=0,a=this.params.length-1;o<a;o++){const l=this.params[o],c=l.isNode!==!0&&l.name||this.getVarName(o),h=l.isNode!==!0&&l.type||"int";s[c]=vm(c,h)}const r=e.addStack();return i.returnsNode=this.params[this.params.length-1](s,r,e),i.stackNode=r,e.removeStack(),i}getNodeType(e){const{returnsNode:i}=this.getProperties(e);return i?i.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const i=this.getProperties(e),s=this.params,r=i.stackNode;for(let l=0,c=s.length-1;l<c;l++){const h=s[l];let d=null,u=null,p=null,g=null,f=null,A=null;h.isNode?(g="int",p=this.getVarName(l),d="0",u=h.build(e,g),f="<"):(g=h.type||"int",p=h.name||this.getVarName(l),d=h.start,u=h.end,f=h.condition,A=h.update,typeof d=="number"?d=d.toString():d&&d.isNode&&(d=d.build(e,g)),typeof u=="number"?u=u.toString():u&&u.isNode&&(u=u.build(e,g)),d!==void 0&&u===void 0?(d=d+" - 1",u="0",f=">="):u!==void 0&&d===void 0&&(d="0",f="<"),f===void 0&&(Number(d)>Number(u)?f=">=":f="<"));const y={start:d,end:u,condition:f},b=y.start,v=y.end;let x="",w="",C="";A||(g==="int"||g==="uint"?f.includes("<")?A="++":A="--":f.includes("<")?A="+= 1.":A="-= 1."),x+=e.getVar(g,p)+" = "+b,w+=p+" "+f+" "+v,C+=p+" "+A;const S=`for ( ${x}; ${w}; ${C} )`;e.addFlowCode((l===0?`
`:"")+e.tab+S+` {

`).addFlowTab()}const o=r.build(e,"void"),a=i.returnsNode?i.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+o);for(let l=0,c=this.params.length-1;l<c;l++)e.addFlowCode((l===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),a}}const Bi=(...n)=>ge(new tY(Df(n,"int"))).append(),G0e=()=>vm("continue").append(),tE=()=>vm("break").append(),P0e=(...n)=>(console.warn("TSL.LoopNode: loop() has been renamed to Loop()."),Bi(...n)),hV=new WeakMap,Il=new $e,iY=ie(({bufferMap:n,influence:e,stride:i,width:s,depth:r,offset:o})=>{const a=K(QK).mul(i).add(o),l=a.div(s),c=a.sub(l.mul(s));return wc(n,dd(c,l)).depth(r).mul(e)});function N0e(n){const e=n.morphAttributes.position!==void 0,i=n.morphAttributes.normal!==void 0,s=n.morphAttributes.color!==void 0,r=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,o=r!==void 0?r.length:0;let a=hV.get(n);if(a===void 0||a.count!==o){let l=function(){y.dispose(),hV.delete(n),n.removeEventListener("dispose",l)};a!==void 0&&a.texture.dispose();const c=n.morphAttributes.position||[],h=n.morphAttributes.normal||[],d=n.morphAttributes.color||[];let u=0;e===!0&&(u=1),i===!0&&(u=2),s===!0&&(u=3);let p=n.attributes.position.count*u,g=1;const f=4096;p>f&&(g=Math.ceil(p/f),p=f);const A=new Float32Array(p*g*4*o),y=new Yx(A,p,g,o);y.type=en,y.needsUpdate=!0;const b=u*4;for(let v=0;v<o;v++){const x=c[v],w=h[v],C=d[v],S=p*g*4*v;for(let _=0;_<x.count;_++){const I=_*b;e===!0&&(Il.fromBufferAttribute(x,_),A[S+I+0]=Il.x,A[S+I+1]=Il.y,A[S+I+2]=Il.z,A[S+I+3]=0),i===!0&&(Il.fromBufferAttribute(w,_),A[S+I+4]=Il.x,A[S+I+5]=Il.y,A[S+I+6]=Il.z,A[S+I+7]=0),s===!0&&(Il.fromBufferAttribute(C,_),A[S+I+8]=Il.x,A[S+I+9]=Il.y,A[S+I+10]=Il.z,A[S+I+11]=C.itemSize===4?Il.w:1)}}a={count:o,texture:y,stride:u,size:new Q(p,g)},hV.set(n,a),n.addEventListener("dispose",l)}return a}class nY extends Jt{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=tt(1),this.updateType=Ht.OBJECT}setup(e){const{geometry:i}=e,s=i.morphAttributes.position!==void 0,r=i.hasAttribute("normal")&&i.morphAttributes.normal!==void 0,o=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,a=o!==void 0?o.length:0,{texture:l,stride:c,size:h}=N0e(i);s===!0&&Bs.mulAssign(this.morphBaseInfluence),r===!0&&el.mulAssign(this.morphBaseInfluence);const d=K(h.width);Bi(a,({i:u})=>{const p=D(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?p.assign(wc(this.mesh.morphTexture,dd(K(u).add(1),K($1))).r):p.assign(wr("morphTargetInfluences","float").element(u).toVar()),s===!0&&Bs.addAssign(iY({bufferMap:l,influence:p,stride:c,width:d,depth:u,offset:K(0)})),r===!0&&el.addAssign(iY({bufferMap:l,influence:p,stride:c,width:d,depth:u,offset:K(1)}))})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((i,s)=>i+s,0)}}const sY=Ce(nY),V0e=n=>n.sort((e,i)=>e.id-i.id),X0e=(n,e)=>{for(const i of e)if(i.isAnalyticLightNode&&i.light.id===n)return i;return null},dV=new WeakMap;class rY extends Jt{static get type(){return"LightsNode"}constructor(e=[]){super("vec3"),this.totalDiffuseNode=j().toVar("totalDiffuse"),this.totalSpecularNode=j().toVar("totalSpecular"),this.outgoingLightNode=j().toVar("outgoingLight"),this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this.global=!0}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const i=[];for(const s of this._lightNodes)i.push(s.getHash());this._lightNodesHash="lights-"+i.join(",")}return this._lightNodesHash}analyze(e){const i=e.getDataFromNode(this);for(const s of i.nodes)s.build(e)}setupLightsNode(e){const i=[],s=this._lightNodes,r=V0e(this._lights),o=e.renderer.nodes.library;for(const a of r)if(a.isNode)i.push(ge(a));else{let l=null;if(s!==null&&(l=X0e(a.id,s)),l===null){const c=o.getLightNodeClass(a.constructor);if(c===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${a.constructor.name}`);continue}let h=null;dV.has(a)?h=dV.get(a):(h=new c(a),dV.set(a,h)),i.push(h)}}this._lightNodes=i}setup(e){this._lightNodes===null&&this.setupLightsNode(e);const i=e.context,s=i.lightingModel;let r=this.outgoingLightNode;if(s){const{_lightNodes:o,totalDiffuseNode:a,totalSpecularNode:l}=this;i.outgoingLight=r;const c=e.addStack(),h=e.getDataFromNode(this);h.nodes=c.nodes,s.start(i,c,e);for(const b of o)b.build(e);s.indirect(i,c,e);const{backdrop:d,backdropAlpha:u}=i,{directDiffuse:p,directSpecular:g,indirectDiffuse:f,indirectSpecular:A}=i.reflectedLight;let y=p.add(f);d!==null&&(u!==null?y=j(u.mix(y,d)):y=j(d),i.material.transparent=!0),a.assign(y),l.assign(g.add(A)),r.assign(a.add(l)),s.finish(i,c,e),r=r.bypass(e.removeStack())}return r}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}}const oY=Ce(rY);class Kf extends Jt{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}generate(){console.warn("Abstract function.")}}class aY extends Kf{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class lY extends FN{static get type(){return"LightingContextNode"}constructor(e,i=null,s=null,r=null){super(e),this.lightingModel=i,this.backdropNode=s,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:i}=this,s=j().toVar("directDiffuse"),r=j().toVar("directSpecular"),o=j().toVar("indirectDiffuse"),a=j().toVar("indirectSpecular"),l={directDiffuse:s,directSpecular:r,indirectDiffuse:o,indirectSpecular:a};return{radiance:j().toVar("radiance"),irradiance:j().toVar("irradiance"),iblIrradiance:j().toVar("iblIrradiance"),ambientOcclusion:D(1).toVar("ambientOcclusion"),reflectedLight:l,backdrop:e,backdropAlpha:i}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const cY=Ce(lY);class hY extends Kf{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let ew,tw;class qs extends Jt{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===qs.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Ht.NONE;return(this.scope===qs.SIZE||this.scope===qs.VIEWPORT)&&(e=Ht.RENDER),this.updateType=e,e}update({renderer:e}){const i=e.getRenderTarget();this.scope===qs.VIEWPORT?i!==null?tw.copy(i.viewport):(e.getViewport(tw),tw.multiplyScalar(e.getPixelRatio())):i!==null?(ew.width=i.width,ew.height=i.height):e.getDrawingBufferSize(ew)}setup(){const e=this.scope;let i=null;return e===qs.SIZE?i=tt(ew||(ew=new Q)):e===qs.VIEWPORT?i=tt(tw||(tw=new $e)):i=ae(Oy.div(Uy)),i}generate(e){if(this.scope===qs.COORDINATE){let i=e.getFragCoord();if(e.isFlipY()){const s=e.getNodeProperties(Uy).outputNode.build(e);i=`${e.getType("vec2")}( ${i}.x, ${s}.y - ${i}.y )`}return i}return super.generate(e)}}qs.COORDINATE="coordinate",qs.VIEWPORT="viewport",qs.SIZE="size",qs.UV="uv";const wm=it(qs,qs.UV),Uy=it(qs,qs.SIZE),Oy=it(qs,qs.COORDINATE),Gu=it(qs,qs.VIEWPORT),dY=Gu.zw,uY=Oy.sub(Gu.xy),D0e=uY.div(dY),z0e=ie(()=>(console.warn('TSL.ViewportNode: "viewportResolution" is deprecated. Use "screenSize" instead.'),Uy),"vec2").once()(),F0e=ie(()=>(console.warn('TSL.ViewportNode: "viewportTopLeft" is deprecated. Use "screenUV" instead.'),wm),"vec2").once()(),U0e=ie(()=>(console.warn('TSL.ViewportNode: "viewportBottomLeft" is deprecated. Use "screenUV.flipY()" instead.'),wm.flipY()),"vec2").once()(),iw=new Q;class nw extends pd{static get type(){return"ViewportTextureNode"}constructor(e=wm,i=null,s=null){s===null&&(s=new yP,s.minFilter=Ar),super(s,e,i),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=Ht.FRAME}updateBefore(e){const i=e.renderer;i.getDrawingBufferSize(iw);const s=this.value;(s.image.width!==iw.width||s.image.height!==iw.height)&&(s.image.width=iw.width,s.image.height=iw.height,s.needsUpdate=!0);const r=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,i.copyFramebufferToTexture(s),s.generateMipmaps=r}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const O0e=Ce(nw),pY=Ce(nw,null,null,{generateMipmaps:!0});let uV=null;class mY extends nw{static get type(){return"ViewportDepthTextureNode"}constructor(e=wm,i=null){uV===null&&(uV=new Eu),super(e,i,uV)}}const pV=Ce(mY);class Wa extends Jt{static get type(){return"ViewportDepthNode"}constructor(e,i=null){super("float"),this.scope=e,this.valueNode=i,this.isViewportDepthNode=!0}generate(e){const{scope:i}=this;return i===Wa.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:i}=this,s=this.valueNode;let r=null;if(i===Wa.DEPTH_BASE)s!==null&&(r=fY().assign(s));else if(i===Wa.DEPTH)e.isPerspectiveCamera?r=gY(Ao.z,Vy,Xy):r=sw(Ao.z,Vy,Xy);else if(i===Wa.LINEAR_DEPTH)if(s!==null)if(e.isPerspectiveCamera){const o=mV(s,Vy,Xy);r=sw(o,Vy,Xy)}else r=s;else r=sw(Ao.z,Vy,Xy);return r}}Wa.DEPTH_BASE="depthBase",Wa.DEPTH="depth",Wa.LINEAR_DEPTH="linearDepth";const sw=(n,e,i)=>n.add(e).div(e.sub(i)),Z0e=(n,e,i)=>e.sub(i).mul(n).sub(e),gY=(n,e,i)=>e.add(n).mul(i).div(i.sub(e).mul(n)),mV=(n,e,i)=>e.mul(i).div(i.sub(e).mul(n).sub(i)),fY=Ce(Wa,Wa.DEPTH_BASE),gV=it(Wa,Wa.DEPTH),iE=Ce(Wa,Wa.LINEAR_DEPTH),W0e=iE(pV());gV.assign=n=>fY(n);class $g extends Jt{static get type(){return"ClippingNode"}constructor(e=$g.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const i=e.clippingContext,{localClipIntersection:s,localClippingCount:r,globalClippingCount:o}=i,a=o+r,l=s?a-r:a;return this.scope===$g.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(i.planes,a,l):this.setupDefault(i.planes,a,l)}setupAlphaToCoverage(e,i,s){return ie(()=>{const r=gd(e),o=ja("float","distanceToPlane"),a=ja("float","distanceToGradient"),l=ja("float","clipOpacity");l.assign(1);let c;if(Bi(s,({i:h})=>{c=r.element(h),o.assign(Ao.dot(c.xyz).negate().add(c.w)),a.assign(o.fwidth().div(2)),l.mulAssign(Sa(a.negate(),a,o)),l.equal(0).discard()}),s<i){const h=ja("float","unionclipOpacity");h.assign(1),Bi({start:s,end:i},({i:d})=>{c=r.element(d),o.assign(Ao.dot(c.xyz).negate().add(c.w)),a.assign(o.fwidth().div(2)),h.mulAssign(Sa(a.negate(),a,o).oneMinus())}),l.mulAssign(h.oneMinus())}on.a.mulAssign(l),on.a.equal(0).discard()})()}setupDefault(e,i,s){return ie(()=>{const r=gd(e);let o;if(Bi(s,({i:a})=>{o=r.element(a),Ao.dot(o.xyz).greaterThan(o.w).discard()}),s<i){const a=ja("bool","clipped");a.assign(!0),Bi({start:s,end:i},({i:l})=>{o=r.element(l),a.assign(Ao.dot(o.xyz).greaterThan(o.w).and(a))}),a.discard()}})()}}$g.ALPHA_TO_COVERAGE="alphaToCoverage",$g.DEFAULT="default";const H0e=()=>ge(new $g),Q0e=()=>ge(new $g($g.ALPHA_TO_COVERAGE));class Yi extends ti{static get type(){return"NodeMaterial"}constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.type,this.forceSinglePass=!1,this.fog=!0,this.lights=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.depthNode=null,this.shadowNode=null,this.shadowPositionNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+sN(this)}build(e){this.setup(e)}setupObserver(e){return new tQ(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.addStack(),e.stack.outputNode=this.vertexNode||this.setupPosition(e),e.addFlow("vertex",e.removeStack()),e.addStack();let i;const s=this.setupClipping(e);if(this.depthWrite===!0&&this.setupDepth(e),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const r=this.setupLighting(e);s!==null&&e.stack.add(s);const o=Qe(r,on.a).max(0);if(i=this.setupOutput(e,o),_N.assign(i),this.outputNode!==null&&(i=this.outputNode),e.renderer.getRenderTarget()!==null){const a=e.renderer.getMRT(),l=this.mrtNode;a!==null?(i=a,l!==null&&(i=a.merge(l))):l!==null&&(i=l)}}else{let r=this.fragmentNode;r.isOutputStructNode!==!0&&(r=Qe(r)),i=this.setupOutput(e,r)}e.stack.outputNode=i,e.addFlow("fragment",e.removeStack()),e.monitor=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{globalClippingCount:i,localClippingCount:s}=e.clippingContext;let r=null;if(i||s){const o=e.renderer.samples;this.alphaToCoverage&&o>1?r=Q0e():e.stack.add(H0e())}return r}setupDepth(e){const{renderer:i}=e;let s=this.depthNode;if(s===null){const r="getMRT"in i&&i.getMRT();r&&r.has("depth")?s=r.get("depth"):i.logarithmicDepthBuffer===!0&&(s=lV().w.add(1).log2().mul(J4).mul(.5))}s!==null&&gV.assign(s).append()}setupPosition(e){const{object:i}=e,s=i.geometry;if(e.addStack(),(s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color)&&sY(i).append(),i.isSkinnedMesh===!0&&eY(i).append(),this.displacementMap){const o=gh("displacementMap","texture"),a=gh("displacementScale","float"),l=gh("displacementBias","float");Bs.addAssign(el.normalize().mul(o.x.mul(a).add(l)))}i.isBatchedMesh&&qK(i).append(),i.instanceMatrix&&i.instanceMatrix.isInstancedBufferAttribute===!0&&jK(i).append(),this.positionNode!==null&&Bs.assign(this.positionNode);const r=lV();return e.context.vertex=e.removeStack(),e.context.mvp=r,r}setupDiffuseColor({object:e,geometry:i}){let s=this.colorNode?Qe(this.colorNode):zy;this.vertexColors===!0&&i.hasAttribute("color")&&(s=Qe(s.xyz.mul(Xr("color","vec3")),s.a)),e.instanceColor&&(s=dh("vec3","vInstanceColor").mul(s)),e.isBatchedMesh&&e._colorsTexture&&(s=dh("vec3","vBatchColor").mul(s)),on.assign(s);const r=this.opacityNode?D(this.opacityNode):JT;if(on.a.assign(on.a.mul(r)),this.alphaTestNode!==null||this.alphaTest>0){const o=this.alphaTestNode!==null?D(this.alphaTestNode):vK;on.a.lessThanEqual(o).discard()}this.transparent===!1&&this.blending===Au&&this.alphaToCoverage===!1&&on.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?j(0):on.rgb}setupNormal(){return this.normalNode?j(this.normalNode):IK}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?gh("envMap","cubeTexture"):gh("envMap","texture")),e}setupLightMap(e){let i=null;return e.material.lightMap&&(i=new hY(aV)),i}setupLights(e){const i=[],s=this.setupEnvironment(e);s&&s.isLightingNode&&i.push(s);const r=this.setupLightMap(e);if(r&&r.isLightingNode&&i.push(r),this.aoNode!==null||e.material.aoMap){const a=this.aoNode!==null?this.aoNode:WK;i.push(new aY(a))}let o=this.lightsNode||e.lightsNode;return i.length>0&&(o=oY([...o.getLights(),...i])),o}setupLightingModel(){}setupLighting(e){const{material:i}=e,{backdropNode:s,backdropAlphaNode:r,emissiveNode:o}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let l=this.setupOutgoingLight(e);if(a&&a.getScope().getLights().length>0){const c=this.setupLightingModel(e);l=cY(a,c,s,r)}else s!==null&&(l=j(r!==null?Ai(l,s,r):s));return(o&&o.isNode===!0||i.emissive&&i.emissive.isColor===!0)&&(wN.assign(j(o||wK)),l=l.add(wN)),l}setupOutput(e,i){if(this.fog===!0){const s=e.fogNode;s&&(i=Qe(s.mix(i.rgb,s.colorNode),i.a))}return i}setDefaultValues(e){for(const s in e){const r=e[s];this[s]===void 0&&(this[s]=r,r&&r.clone&&(this[s]=r.clone()))}const i=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const s in i)Object.getOwnPropertyDescriptor(this.constructor.prototype,s)===void 0&&i[s].get!==void 0&&Object.defineProperty(this.constructor.prototype,s,i[s])}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{},nodes:{}});const s=ti.prototype.toJSON.call(this,e),r=I1(this);s.inputNodes={};for(const{property:a,childNode:l}of r)s.inputNodes[a]=l.toJSON(e).uuid;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}if(i){const a=o(e.textures),l=o(e.images),c=o(e.nodes);a.length>0&&(s.textures=a),l.length>0&&(s.images=l),c.length>0&&(s.nodes=c)}return s}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.depthNode=e.depthNode,this.shadowNode=e.shadowNode,this.shadowPositionNode=e.shadowPositionNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const K0e=new rd;class Y0e extends Yi{static get type(){return"InstancedPointsNodeMaterial"}constructor(e={}){super(),this.lights=!1,this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.pointWidth=1,this.pointColorNode=null,this.pointWidthNode=null,this.setDefaultValues(K0e),this.setValues(e)}setup(e){this.setupShaders(e),super.setup(e)}setupShaders({renderer:e}){const i=this.alphaToCoverage,s=this.useColor;this.vertexNode=ie(()=>{const r=Xr("instancePosition").xyz,o=Qe(md.mul(Qe(r,1))),a=Gu.z.div(Gu.w),l=qa.mul(o),c=fo.xy.toVar();return c.mulAssign(this.pointWidthNode?this.pointWidthNode:OK),c.assign(c.div(Gu.z)),c.y.assign(c.y.mul(a)),c.assign(c.mul(l.w)),l.addAssign(Qe(c,0,0)),l})(),this.fragmentNode=ie(()=>{const r=D(1).toVar(),o=XN(yi().mul(2).sub(1));if(i&&e.samples>1){const l=D(o.fwidth()).toVar();r.assign(Sa(l.oneMinus(),l.add(1),o).oneMinus())}else o.greaterThan(1).discard();let a;return this.pointColorNode?a=this.pointColorNode:s?a=Xr("instanceColor").mul(zy):a=zy,r.mulAssign(JT),Qe(a,r)})()}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.needsUpdate=!0)}}const j0e=new Cn;class J0e extends Yi{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(j0e),this.setValues(e)}}const q0e=new pT;class $0e extends Yi{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.setDefaultValues(q0e),this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode,i=this.dashScaleNode?D(this.dashScaleNode):$T,s=this.dashSizeNode?D(this.dashSizeNode):sV,r=this.dashSizeNode?D(this.dashGapNode):rV;Zf.assign(s),V1.assign(r);const o=go(Xr("lineDistance").mul(i));(e?o.add(e):o).mod(Zf.add(V1)).greaterThan(Zf).discard()}}const eAe=new pT;class tAe extends Yi{static get type(){return"Line2NodeMaterial"}constructor(e={}){super(),this.lights=!1,this.setDefaultValues(eAe),this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.useDash=e.dashed,this.useWorldUnits=!1,this.dashOffset=0,this.lineWidth=1,this.lineColorNode=null,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setup(e){this.setupShaders(e),super.setup(e)}setupShaders({renderer:e}){const i=this.alphaToCoverage,s=this.useColor,r=this.dashed,o=this.worldUnits,a=ie(({start:c,end:h})=>{const d=qa.element(2).element(2),u=qa.element(3).element(2).mul(-.5).div(d).sub(c.z).div(h.z.sub(c.z));return Qe(Ai(c.xyz,h.xyz,u),h.w)}).setLayout({name:"trimSegment",type:"vec4",inputs:[{name:"start",type:"vec4"},{name:"end",type:"vec4"}]});this.vertexNode=ie(()=>{const c=Xr("instanceStart"),h=Xr("instanceEnd"),d=Qe(md.mul(Qe(c,1))).toVar("start"),u=Qe(md.mul(Qe(h,1))).toVar("end");o&&(dh("vec3","worldStart").assign(d.xyz),dh("vec3","worldEnd").assign(u.xyz));const p=Gu.z.div(Gu.w),g=qa.element(2).element(3).equal(-1);Gt(g,()=>{Gt(d.z.lessThan(0).and(u.z.greaterThan(0)),()=>{u.assign(a({start:d,end:u}))}).ElseIf(u.z.lessThan(0).and(d.z.greaterThanEqual(0)),()=>{d.assign(a({start:u,end:d}))})});const f=qa.mul(d),A=qa.mul(u),y=f.xyz.div(f.w),b=A.xyz.div(A.w),v=b.xy.sub(y.xy).toVar();v.x.assign(v.x.mul(p)),v.assign(v.normalize());const x=Qe().toVar();if(o){const w=u.xyz.sub(d.xyz).normalize(),C=Ai(d.xyz,u.xyz,.5).normalize(),S=w.cross(C).normalize(),_=w.cross(S),I=dh("vec4","worldPos");I.assign(fo.y.lessThan(.5).select(d,u));const B=eE.mul(.5);I.addAssign(Qe(fo.x.lessThan(0).select(S.mul(B),S.mul(B).negate()),0)),r||(I.addAssign(Qe(fo.y.lessThan(.5).select(w.mul(B).negate(),w.mul(B)),0)),I.addAssign(Qe(_.mul(B),0)),Gt(fo.y.greaterThan(1).or(fo.y.lessThan(0)),()=>{I.subAssign(Qe(_.mul(2).mul(B),0))})),x.assign(qa.mul(I));const M=j().toVar();M.assign(fo.y.lessThan(.5).select(y,b)),x.z.assign(M.z.mul(x.w))}else{const w=ae(v.y,v.x.negate()).toVar("offset");v.x.assign(v.x.div(p)),w.x.assign(w.x.div(p)),w.assign(fo.x.lessThan(0).select(w.negate(),w)),Gt(fo.y.lessThan(0),()=>{w.assign(w.sub(v))}).ElseIf(fo.y.greaterThan(1),()=>{w.assign(w.add(v))}),w.assign(w.mul(eE)),w.assign(w.div(Gu.w)),x.assign(fo.y.lessThan(.5).select(f,A)),w.assign(w.mul(x.w)),x.assign(x.add(Qe(w,0,0)))}return x})();const l=ie(({p1:c,p2:h,p3:d,p4:u})=>{const p=c.sub(d),g=u.sub(d),f=h.sub(c),A=p.dot(g),y=g.dot(f),b=p.dot(f),v=g.dot(g),x=f.dot(f).mul(v).sub(y.mul(y)),w=A.mul(y).sub(b.mul(v)).div(x).clamp(),C=A.add(y.mul(w)).div(v).clamp();return ae(w,C)});this.fragmentNode=ie(()=>{const c=yi();if(r){const u=this.offsetNode?D(this.offsetNodeNode):oV,p=this.dashScaleNode?D(this.dashScaleNode):$T,g=this.dashSizeNode?D(this.dashSizeNode):sV,f=this.dashSizeNode?D(this.dashGapNode):rV;Zf.assign(g),V1.assign(f);const A=Xr("instanceDistanceStart"),y=Xr("instanceDistanceEnd"),b=fo.y.lessThan(.5).select(p.mul(A),$T.mul(y)),v=go(b.add(oV)),x=u?v.add(u):v;c.y.lessThan(-1).or(c.y.greaterThan(1)).discard(),x.mod(Zf.add(V1)).greaterThan(Zf).discard()}const h=D(1).toVar("alpha");if(o){const u=dh("vec3","worldStart"),p=dh("vec3","worldEnd"),g=dh("vec4","worldPos").xyz.normalize().mul(1e5),f=p.sub(u),A=l({p1:u,p2:p,p3:j(0,0,0),p4:g}),y=u.add(f.mul(A.x)),b=g.mul(A.y),v=y.sub(b).length().div(eE);if(!r)if(i&&e.samples>1){const x=v.fwidth();h.assign(Sa(x.negate().add(.5),x.add(.5),v).oneMinus())}else v.greaterThan(.5).discard()}else if(i&&e.samples>1){const u=c.x,p=c.y.greaterThan(0).select(c.y.sub(1),c.y.add(1)),g=u.mul(u).add(p.mul(p)),f=D(g.fwidth()).toVar("dlen");Gt(c.y.abs().greaterThan(1),()=>{h.assign(Sa(f.oneMinus(),f.add(1),g).oneMinus())})}else Gt(c.y.abs().greaterThan(1),()=>{const u=c.x,p=c.y.greaterThan(0).select(c.y.sub(1),c.y.add(1));u.mul(u).add(p.mul(p)).greaterThan(1).discard()});let d;if(this.lineColorNode)d=this.lineColorNode;else if(s){const u=Xr("instanceColorStart"),p=Xr("instanceColorEnd");d=fo.y.lessThan(.5).select(u,p).mul(zy)}else d=zy;return Qe(d,h)})()}get worldUnits(){return this.useWorldUnits}set worldUnits(e){this.useWorldUnits!==e&&(this.useWorldUnits=e,this.needsUpdate=!0)}get dashed(){return this.useDash}set dashed(e){this.useDash!==e&&(this.useDash=e,this.needsUpdate=!0)}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.needsUpdate=!0)}}const AY=n=>ge(n).mul(.5).add(.5),iAe=n=>ge(n).mul(2).sub(1),nAe=new x1;class sAe extends Yi{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.lights=!1,this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(nAe),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?D(this.opacityNode):JT;on.assign(Qe(AY(ys),e))}}class yY extends Ti{static get type(){return"EquirectUVNode"}constructor(e=jN){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,i=e.z.atan2(e.x).mul(1/(Math.PI*2)).add(.5),s=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return ae(i,s)}}const fV=Ce(yY);class bY extends GI{constructor(e=1,i={}){super(e,i),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,i){const s=i.minFilter,r=i.generateMipmaps;i.generateMipmaps=!0,this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const o=new bn(5,5,5),a=fV(jN),l=new Yi;l.colorNode=zi(i,a,0),l.side=wn,l.blending=Pn;const c=new pe(o,l),h=new ir;h.add(c),i.minFilter===Ar&&(i.minFilter=Wt);const d=new kI(1,10,this),u=e.getMRT();return e.setMRT(null),d.update(e,h),e.setMRT(u),i.minFilter=s,i.currentGenerateMipmaps=r,c.geometry.dispose(),c.material.dispose(),this}}const rw=new WeakMap;class rAe extends Ti{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=KT();const i=new xf;i.isRenderTargetTexture=!0,this._defaultTexture=i,this.updateBeforeType=Ht.RENDER}updateBefore(e){const{renderer:i,material:s}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const o=r.isTextureNode?r.value:s[r.property];if(o&&o.isTexture){const a=o.mapping;if(a===ao||a===Yp){if(rw.has(o)){const l=rw.get(o);xY(l,o.mapping),this._cubeTexture=l}else{const l=o.image;if(oAe(l)){const c=new bY(l.height);c.fromEquirectangularTexture(i,o),xY(c.texture,o.mapping),this._cubeTexture=c.texture,rw.set(o,c.texture),o.addEventListener("dispose",vY)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function oAe(n){return n==null?!1:n.height>0}function vY(n){const e=n.target;e.removeEventListener("dispose",vY);const i=rw.get(e);i!==void 0&&(rw.delete(e),i.dispose())}function xY(n,e){e===ao?n.mapping=bl:e===Yp&&(n.mapping=gc)}const aAe=Ce(rAe);class nE extends Kf{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=aAe(this.envNode)}}class lAe extends Kf{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const i=D(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(i)}}class ow{start(){}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class wY extends ow{constructor(){super()}indirect(e,i,s){const r=e.ambientOcclusion,o=e.reflectedLight,a=s.context.irradianceLightMap;o.indirectDiffuse.assign(Qe(0)),a?o.indirectDiffuse.addAssign(a):o.indirectDiffuse.addAssign(Qe(1,1,1,0)),o.indirectDiffuse.mulAssign(r),o.indirectDiffuse.mulAssign(on.rgb)}finish(e,i,s){const r=s.material,o=e.outgoingLight,a=s.context.environment;if(a)switch(r.combine){case WA:o.rgb.assign(Ai(o.rgb,o.rgb.mul(a.rgb),q1.mul(qT)));break;case lG:o.rgb.assign(Ai(o.rgb,a.rgb,q1.mul(qT)));break;case cG:o.rgb.addAssign(a.rgb.mul(q1.mul(qT)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",r.combine);break}}}const cAe=new ai;class hAe extends Yi{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(cAe),this.setValues(e)}setupNormal(){return Ml}setupEnvironment(e){const i=super.setupEnvironment(e);return i?new nE(i):null}setupLightMap(e){let i=null;return e.material.lightMap&&(i=new lAe(aV)),i}setupOutgoingLight(){return on.rgb}setupLightingModel(){return new wY}}const Zy=ie(({f0:n,f90:e,dotVH:i})=>{const s=i.mul(-5.55473).sub(6.98316).mul(i).exp2();return n.mul(s.oneMinus()).add(e.mul(s))}),Yf=ie(n=>n.diffuseColor.mul(1/Math.PI)),dAe=()=>D(.25),uAe=ie(({dotNH:n})=>VT.mul(D(.5)).add(1).mul(D(1/Math.PI)).mul(n.pow(VT))),pAe=ie(({lightDirection:n})=>{const e=n.add(Xn).normalize(),i=ys.dot(e).clamp(),s=Xn.dot(e).clamp(),r=Zy({f0:Ja,f90:1,dotVH:s}),o=dAe(),a=uAe({dotNH:i});return r.mul(o).mul(a)});class AV extends wY{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:i,reflectedLight:s}){const r=ys.dot(e).clamp().mul(i);s.directDiffuse.addAssign(r.mul(Yf({diffuseColor:on.rgb}))),this.specular===!0&&s.directSpecular.addAssign(r.mul(pAe({lightDirection:e})).mul(q1))}indirect({ambientOcclusion:e,irradiance:i,reflectedLight:s}){s.indirectDiffuse.addAssign(i.mul(Yf({diffuseColor:on}))),s.indirectDiffuse.mulAssign(e)}}const mAe=new uT;class gAe extends Yi{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(mAe),this.setValues(e)}setupEnvironment(e){const i=super.setupEnvironment(e);return i?new nE(i):null}setupLightingModel(){return new AV(!1)}}const fAe=new cm;class AAe extends Yi{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(fAe),this.setValues(e)}setupEnvironment(e){const i=super.setupEnvironment(e);return i?new nE(i):null}setupLightingModel(){return new AV}setupVariants(){const e=(this.shininessNode?D(this.shininessNode):xK).max(1e-4);VT.assign(e);const i=this.specularNode||CK;Ja.assign(i)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const CY=ie(()=>{const n=Ml.dFdx().abs().max(Ml.dFdy().abs());return n.x.max(n.y).max(n.z)}),yV=ie(n=>{const{roughness:e}=n,i=CY();let s=e.max(.0525);return s=s.add(i),s=s.min(1),s}),SY=ie(({alpha:n,dotNL:e,dotNV:i})=>{const s=n.pow2(),r=e.mul(s.add(s.oneMinus().mul(i.pow2())).sqrt()),o=i.mul(s.add(s.oneMinus().mul(e.pow2())).sqrt());return uh(.5,r.add(o).max(HQ))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),yAe=ie(({alphaT:n,alphaB:e,dotTV:i,dotBV:s,dotTL:r,dotBL:o,dotNV:a,dotNL:l})=>{const c=l.mul(j(n.mul(i),e.mul(s),a).length()),h=a.mul(j(n.mul(r),e.mul(o),l).length());return uh(.5,c.add(h)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),_Y=ie(({alpha:n,dotNH:e})=>{const i=n.pow2(),s=e.pow2().mul(i.oneMinus()).oneMinus();return i.div(s.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),bAe=D(1/Math.PI),vAe=ie(({alphaT:n,alphaB:e,dotNH:i,dotTH:s,dotBH:r})=>{const o=n.mul(e),a=j(e.mul(s),n.mul(r),o.mul(i)),l=a.dot(a),c=o.div(l);return bAe.mul(o.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),bV=ie(n=>{const{lightDirection:e,f0:i,f90:s,roughness:r,f:o,USE_IRIDESCENCE:a,USE_ANISOTROPY:l}=n,c=n.normalView||ys,h=r.pow2(),d=e.add(Xn).normalize(),u=c.dot(e).clamp(),p=c.dot(Xn).clamp(),g=c.dot(d).clamp(),f=Xn.dot(d).clamp();let A=Zy({f0:i,f90:s,dotVH:f}),y,b;if(T1(a)&&(A=PT.mix(A,o)),T1(l)){const v=P1.dot(e),x=P1.dot(Xn),w=P1.dot(d),C=Of.dot(e),S=Of.dot(Xn),_=Of.dot(d);y=yAe({alphaT:NT,alphaB:h,dotTV:x,dotBV:S,dotTL:v,dotBL:C,dotNV:p,dotNL:u}),b=vAe({alphaT:NT,alphaB:h,dotNH:g,dotTH:w,dotBH:_})}else y=SY({alpha:h,dotNL:u,dotNV:p}),b=_Y({alpha:h,dotNH:g});return A.mul(y).mul(b)}),vV=ie(({roughness:n,dotNV:e})=>{const i=Qe(-1,-.0275,-.572,.022),s=Qe(1,.0425,1.04,-.04),r=n.mul(i).add(s),o=r.x.mul(r.x).min(e.mul(-9.28).exp2()).mul(r.x).add(r.y);return ae(-1.04,1.04).mul(o).add(r.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),MY=ie(n=>{const{dotNV:e,specularColor:i,specularF90:s,roughness:r}=n,o=vV({dotNV:e,roughness:r});return i.mul(o.x).add(s.mul(o.y))}),IY=ie(({f:n,f90:e,dotVH:i})=>{const s=i.oneMinus().saturate(),r=s.mul(s),o=s.mul(r,r).clamp(0,.9999);return n.sub(j(e).mul(o)).div(o.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),xAe=ie(({roughness:n,dotNH:e})=>{const i=n.pow2(),s=D(1).div(i),r=e.pow2().oneMinus().max(.0078125);return D(2).add(s).mul(r.pow(s.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),wAe=ie(({dotNV:n,dotNL:e})=>D(1).div(D(4).mul(e.add(n).sub(e.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),CAe=ie(({lightDirection:n})=>{const e=n.add(Xn).normalize(),i=ys.dot(n).clamp(),s=ys.dot(Xn).clamp(),r=ys.dot(e).clamp(),o=xAe({roughness:GT,dotNH:r}),a=wAe({dotNV:s,dotNL:i});return Uf.mul(o).mul(a)}),SAe=ie(({N:n,V:e,roughness:i})=>{const s=.0078125,r=n.dot(e).saturate(),o=ae(i,r.oneMinus().sqrt());return o.assign(o.mul(.984375).add(s)),o}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),_Ae=ie(({f:n})=>{const e=n.length();return Li(e.mul(e).add(n.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),sE=ie(({v1:n,v2:e})=>{const i=n.dot(e),s=i.abs().toVar(),r=s.mul(.0145206).add(.4965155).mul(s).add(.8543985).toVar(),o=s.add(4.1616724).mul(s).add(3.417594).toVar(),a=r.div(o),l=i.greaterThan(0).select(a,Li(i.mul(i).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(a));return n.cross(e).mul(l)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),TY=ie(({N:n,V:e,P:i,mInv:s,p0:r,p1:o,p2:a,p3:l})=>{const c=o.sub(r).toVar(),h=l.sub(r).toVar(),d=c.cross(h),u=j().toVar();return Gt(d.dot(i.sub(r)).greaterThanEqual(0),()=>{const p=e.sub(n.mul(e.dot(n))).normalize(),g=n.cross(p).negate(),f=s.mul(Nr(p,g,n).transpose()).toVar(),A=f.mul(r.sub(i)).normalize().toVar(),y=f.mul(o.sub(i)).normalize().toVar(),b=f.mul(a.sub(i)).normalize().toVar(),v=f.mul(l.sub(i)).normalize().toVar(),x=j(0).toVar();x.addAssign(sE({v1:A,v2:y})),x.addAssign(sE({v1:y,v2:b})),x.addAssign(sE({v1:b,v2:v})),x.addAssign(sE({v1:v,v2:A})),u.assign(j(_Ae({f:x})))}),u}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),rE=1/6,EY=n=>wi(rE,wi(n,wi(n,n.negate().add(3)).sub(3)).add(1)),xV=n=>wi(rE,wi(n,wi(n,wi(3,n).sub(6))).add(4)),RY=n=>wi(rE,wi(n,wi(n,wi(-3,n).add(3)).add(3)).add(1)),wV=n=>wi(rE,Ca(n,3)),LY=n=>EY(n).add(xV(n)),BY=n=>RY(n).add(wV(n)),kY=n=>Hn(-1,xV(n).div(EY(n).add(xV(n)))),GY=n=>Hn(1,wV(n).div(RY(n).add(wV(n)))),PY=(n,e,i)=>{const s=n.uvNode,r=wi(s,e.zw).add(.5),o=ym(r),a=bm(r),l=LY(a.x),c=BY(a.x),h=kY(a.x),d=GY(a.x),u=kY(a.y),p=GY(a.y),g=ae(o.x.add(h),o.y.add(u)).sub(.5).mul(e.xy),f=ae(o.x.add(d),o.y.add(u)).sub(.5).mul(e.xy),A=ae(o.x.add(h),o.y.add(p)).sub(.5).mul(e.xy),y=ae(o.x.add(d),o.y.add(p)).sub(.5).mul(e.xy),b=LY(a.y).mul(Hn(l.mul(n.uv(g).level(i)),c.mul(n.uv(f).level(i)))),v=BY(a.y).mul(Hn(l.mul(n.uv(A).level(i)),c.mul(n.uv(y).level(i))));return b.add(v)},NY=ie(([n,e=D(3)])=>{const i=ae(n.size(K(e))),s=ae(n.size(K(e.add(1)))),r=uh(1,i),o=uh(1,s),a=PY(n,Qe(r,i),ym(e)),l=PY(n,Qe(o,s),PN(e));return bm(e).mix(a,l)}),VY=ie(([n,e,i,s,r])=>{const o=j(DN(e.negate(),Sl(n),uh(1,s))),a=j(Hf(r[0].xyz),Hf(r[1].xyz),Hf(r[2].xyz));return Sl(o).mul(i.mul(a))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),MAe=ie(([n,e])=>n.mul(rr(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),IAe=pY(),XY=ie(([n,e,i])=>{const s=IAe.uv(n),r=D1(D(Uy.x)).mul(MAe(e,i));return NY(s,r)}),DY=ie(([n,e,i])=>(Gt(i.notEqual(0),()=>{const s=GN(e).negate().div(i);return kN(s.negate().mul(n))}),j(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),TAe=ie(([n,e,i,s,r,o,a,l,c,h,d,u,p,g,f])=>{let A,y;if(f){A=Qe().toVar(),y=j().toVar();const C=d.sub(1).mul(f.mul(.025)),S=j(d.sub(C),d,d.add(C));Bi({start:0,end:3},({i:_})=>{const I=S.element(_),B=VY(n,e,u,I,l),M=a.add(B),R=h.mul(c.mul(Qe(M,1))),k=ae(R.xy.div(R.w)).toVar();k.addAssign(1),k.divAssign(2),k.assign(ae(k.x,k.y.oneMinus()));const G=XY(k,i,I);A.element(_).assign(G.element(_)),A.a.addAssign(G.a),y.element(_).assign(s.element(_).mul(DY(Hf(B),p,g).element(_)))}),A.a.divAssign(3)}else{const C=VY(n,e,u,d,l),S=a.add(C),_=h.mul(c.mul(Qe(S,1))),I=ae(_.xy.div(_.w)).toVar();I.addAssign(1),I.divAssign(2),I.assign(ae(I.x,I.y.oneMinus())),A=XY(I,i,d),y=s.mul(DY(Hf(C),p,g))}const b=y.rgb.mul(A.rgb),v=n.dot(e).clamp(),x=j(MY({dotNV:v,specularColor:r,specularF90:o,roughness:i})),w=y.r.add(y.g,y.b).div(3);return Qe(x.oneMinus().mul(b),A.a.oneMinus().mul(w).oneMinus())}),EAe=Nr(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),RAe=n=>{const e=n.sqrt();return j(1).add(e).div(j(1).sub(e))},zY=(n,e)=>n.sub(e).div(n.add(e)).pow2(),LAe=(n,e)=>{const i=n.mul(2*Math.PI*1e-9),s=j(54856e-17,44201e-17,52481e-17),r=j(1681e3,1795300,2208400),o=j(43278e5,93046e5,66121e5),a=D(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(i.mul(2239900).add(e.x).cos()).mul(i.pow2().mul(-45282e5).exp());let l=s.mul(o.mul(2*Math.PI).sqrt()).mul(r.mul(i).add(e).cos()).mul(i.pow2().negate().mul(o).exp());return l=j(l.x.add(a),l.y,l.z).div(10685e-11),EAe.mul(l)},BAe=ie(({outsideIOR:n,eta2:e,cosTheta1:i,thinFilmThickness:s,baseF0:r})=>{const o=Ai(n,e,Sa(0,.03,s)),a=n.div(o).pow2().mul(D(1).sub(i.pow2())),l=D(1).sub(a).sqrt(),c=zY(o,n),h=Zy({f0:c,f90:1,dotVH:i}),d=h.oneMinus(),u=o.lessThan(n).select(Math.PI,0),p=D(Math.PI).sub(u),g=RAe(r.clamp(0,.9999)),f=zY(g,o.toVec3()),A=Zy({f0:f,f90:1,dotVH:l}),y=j(g.x.lessThan(o).select(Math.PI,0),g.y.lessThan(o).select(Math.PI,0),g.z.lessThan(o).select(Math.PI,0)),b=o.mul(s,l,2),v=j(p).add(y),x=h.mul(A).clamp(1e-5,.9999),w=x.sqrt(),C=d.pow2().mul(A).div(j(1).sub(x));let S=h.add(C),_=C.sub(d);for(let I=1;I<=2;++I){_=_.mul(w);const B=LAe(D(I).mul(b),D(I).mul(v)).mul(2);S=S.add(_.mul(B))}return S.max(j(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),kAe=ie(({normal:n,viewDir:e,roughness:i})=>{const s=n.dot(e).saturate(),r=i.pow2(),o=mo(i.lessThan(.25),D(-339.2).mul(r).add(D(161.4).mul(i)).sub(25.9),D(-8.48).mul(r).add(D(14.3).mul(i)).sub(9.95)),a=mo(i.lessThan(.25),D(44).mul(r).sub(D(23.7).mul(i)).add(3.26),D(1.97).mul(r).sub(D(3.27).mul(i)).add(.72));return mo(i.lessThan(.25),0,D(.1).mul(i).sub(.025)).add(o.mul(s).add(a).exp()).mul(1/Math.PI).saturate()}),CV=j(.04),SV=D(1);class oE extends ow{constructor(e=!1,i=!1,s=!1,r=!1,o=!1,a=!1){super(),this.clearcoat=e,this.sheen=i,this.iridescence=s,this.anisotropy=r,this.transmission=o,this.dispersion=a,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=j().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=j().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=j().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=j().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=j().toVar("sheenSpecularIndirect")),this.iridescence===!0){const i=ys.dot(Xn).clamp();this.iridescenceFresnel=BAe({outsideIOR:D(1),eta2:CN,cosTheta1:i,thinFilmThickness:SN,baseF0:Ja}),this.iridescenceF0=IY({f:this.iridescenceFresnel,f90:1,dotVH:i})}if(this.transmission===!0){const i=WT,s=YN.sub(WT).normalize(),r=JN;e.backdrop=TAe(r,s,ud,on,Ja,N1,i,Cc,$a,qa,X1,MN,TN,IN,this.dispersion?EN:null),e.backdropAlpha=XT,on.a.mulAssign(Ai(1,e.backdrop.a,XT))}}computeMultiscattering(e,i,s){const r=ys.dot(Xn).clamp(),o=vV({roughness:ud,dotNV:r}),a=(this.iridescenceF0?PT.mix(Ja,this.iridescenceF0):Ja).mul(o.x).add(s.mul(o.y)),l=o.x.add(o.y).oneMinus(),c=Ja.add(Ja.oneMinus().mul(.047619)),h=a.mul(c).div(l.mul(c).oneMinus());e.addAssign(a),i.addAssign(h.mul(l))}direct({lightDirection:e,lightColor:i,reflectedLight:s}){const r=ys.dot(e).clamp().mul(i);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(r.mul(CAe({lightDirection:e}))),this.clearcoat===!0){const o=Dy.dot(e).clamp().mul(i);this.clearcoatSpecularDirect.addAssign(o.mul(bV({lightDirection:e,f0:CV,f90:SV,roughness:G1,normalView:Dy})))}s.directDiffuse.addAssign(r.mul(Yf({diffuseColor:on.rgb}))),s.directSpecular.addAssign(r.mul(bV({lightDirection:e,f0:Ja,f90:1,roughness:ud,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:i,halfWidth:s,halfHeight:r,reflectedLight:o,ltc_1:a,ltc_2:l}){const c=i.add(s).sub(r),h=i.sub(s).sub(r),d=i.sub(s).add(r),u=i.add(s).add(r),p=ys,g=Xn,f=Ao.toVar(),A=SAe({N:p,V:g,roughness:ud}),y=a.uv(A).toVar(),b=l.uv(A).toVar(),v=Nr(j(y.x,0,y.y),j(0,1,0),j(y.z,0,y.w)).toVar(),x=Ja.mul(b.x).add(Ja.oneMinus().mul(b.y)).toVar();o.directSpecular.addAssign(e.mul(x).mul(TY({N:p,V:g,P:f,mInv:v,p0:c,p1:h,p2:d,p3:u}))),o.directDiffuse.addAssign(e.mul(on).mul(TY({N:p,V:g,P:f,mInv:Nr(1,0,0,0,1,0,0,0,1),p0:c,p1:h,p2:d,p3:u})))}indirect(e,i,s){this.indirectDiffuse(e,i,s),this.indirectSpecular(e,i,s),this.ambientOcclusion(e,i,s)}indirectDiffuse({irradiance:e,reflectedLight:i}){i.indirectDiffuse.addAssign(e.mul(Yf({diffuseColor:on})))}indirectSpecular({radiance:e,iblIrradiance:i,reflectedLight:s}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(i.mul(Uf,kAe({normal:ys,viewDir:Xn,roughness:GT}))),this.clearcoat===!0){const h=Dy.dot(Xn).clamp(),d=MY({dotNV:h,specularColor:CV,specularF90:SV,roughness:G1});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(d))}const r=j().toVar("singleScattering"),o=j().toVar("multiScattering"),a=i.mul(1/Math.PI);this.computeMultiscattering(r,o,N1);const l=r.add(o),c=on.mul(l.r.max(l.g).max(l.b).oneMinus());s.indirectSpecular.addAssign(e.mul(r)),s.indirectSpecular.addAssign(o.mul(a)),s.indirectDiffuse.addAssign(c.mul(a))}ambientOcclusion({ambientOcclusion:e,reflectedLight:i}){const s=ys.dot(Xn).clamp().add(e),r=ud.mul(-16).oneMinus().negate().exp2(),o=e.sub(s.pow(r).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(e),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(e),i.indirectDiffuse.mulAssign(e),i.indirectSpecular.mulAssign(o)}finish(e){const{outgoingLight:i}=e;if(this.clearcoat===!0){const s=Dy.dot(Xn).clamp(),r=Zy({dotVH:s,f0:CV,f90:SV}),o=i.mul(kT.mul(r).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(kT));i.assign(o)}if(this.sheen===!0){const s=Uf.r.max(Uf.g).max(Uf.b).mul(.157).oneMinus(),r=i.mul(s).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);i.assign(r)}}}const FY=D(1),_V=D(-2),aE=D(.8),MV=D(-1),lE=D(.4),IV=D(2),cE=D(.305),TV=D(3),UY=D(.21),GAe=D(4),OY=D(4),PAe=D(16),NAe=ie(([n])=>{const e=j(Sn(n)).toVar(),i=D(-1).toVar();return Gt(e.x.greaterThan(e.z),()=>{Gt(e.x.greaterThan(e.y),()=>{i.assign(mo(n.x.greaterThan(0),0,3))}).Else(()=>{i.assign(mo(n.y.greaterThan(0),1,4))})}).Else(()=>{Gt(e.z.greaterThan(e.y),()=>{i.assign(mo(n.z.greaterThan(0),2,5))}).Else(()=>{i.assign(mo(n.y.greaterThan(0),1,4))})}),i}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),VAe=ie(([n,e])=>{const i=ae().toVar();return Gt(e.equal(0),()=>{i.assign(ae(n.z,n.y).div(Sn(n.x)))}).ElseIf(e.equal(1),()=>{i.assign(ae(n.x.negate(),n.z.negate()).div(Sn(n.y)))}).ElseIf(e.equal(2),()=>{i.assign(ae(n.x.negate(),n.y).div(Sn(n.z)))}).ElseIf(e.equal(3),()=>{i.assign(ae(n.z.negate(),n.y).div(Sn(n.x)))}).ElseIf(e.equal(4),()=>{i.assign(ae(n.x.negate(),n.z).div(Sn(n.y)))}).Else(()=>{i.assign(ae(n.x,n.y).div(Sn(n.z)))}),wi(.5,i.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),XAe=ie(([n])=>{const e=D(0).toVar();return Gt(n.greaterThanEqual(aE),()=>{e.assign(FY.sub(n).mul(MV.sub(_V)).div(FY.sub(aE)).add(_V))}).ElseIf(n.greaterThanEqual(lE),()=>{e.assign(aE.sub(n).mul(IV.sub(MV)).div(aE.sub(lE)).add(MV))}).ElseIf(n.greaterThanEqual(cE),()=>{e.assign(lE.sub(n).mul(TV.sub(IV)).div(lE.sub(cE)).add(IV))}).ElseIf(n.greaterThanEqual(UY),()=>{e.assign(cE.sub(n).mul(GAe.sub(TV)).div(cE.sub(UY)).add(TV))}).Else(()=>{e.assign(D(-2).mul(D1(wi(1.16,n))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),ZY=ie(([n,e])=>{const i=n.toVar();i.assign(wi(2,i).sub(1));const s=j(i,1).toVar();return Gt(e.equal(0),()=>{s.assign(s.zyx)}).ElseIf(e.equal(1),()=>{s.assign(s.xzy),s.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{s.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{s.assign(s.zyx),s.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{s.assign(s.xzy),s.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{s.z.mulAssign(-1)}),s}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),WY=ie(([n,e,i,s,r,o])=>{const a=D(i),l=j(e),c=rr(XAe(a),_V,o),h=bm(c),d=ym(c),u=j(EV(n,l,d,s,r,o)).toVar();return Gt(h.notEqual(0),()=>{const p=j(EV(n,l,d.add(1),s,r,o)).toVar();u.assign(Ai(u,p,h))}),u}),EV=ie(([n,e,i,s,r,o])=>{const a=D(i).toVar(),l=j(e),c=D(NAe(l)).toVar(),h=D(Li(OY.sub(a),0)).toVar();a.assign(Li(a,OY));const d=D(DT(a)).toVar(),u=ae(VAe(l,c).mul(d.sub(2)).add(1)).toVar();return Gt(c.greaterThan(2),()=>{u.y.addAssign(d),c.subAssign(3)}),u.x.addAssign(c.mul(d)),u.x.addAssign(h.mul(wi(3,PAe))),u.y.addAssign(wi(4,DT(o).sub(d))),u.x.mulAssign(s),u.y.mulAssign(r),n.uv(u).grad(ae(),ae())}),RV=ie(({envMap:n,mipInt:e,outputDirection:i,theta:s,axis:r,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:l})=>{const c=_l(s),h=i.mul(c).add(r.cross(i).mul(po(s))).add(r.mul(r.dot(i).mul(c.oneMinus())));return EV(n,h,e,o,a,l)}),HY=ie(({n,latitudinal:e,poleAxis:i,outputDirection:s,weights:r,samples:o,dTheta:a,mipInt:l,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:u})=>{const p=j(mo(e,i,Ny(i,s))).toVar();Gt(BN(p.equals(j(0))),()=>{p.assign(j(s.z,0,s.x.negate()))}),p.assign(Sl(p));const g=j().toVar();return g.addAssign(r.element(K(0)).mul(RV({theta:0,axis:p,outputDirection:s,mipInt:l,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:u}))),Bi({start:K(1),end:n},({i:f})=>{Gt(f.greaterThanEqual(o),()=>{tE()});const A=D(a.mul(D(f))).toVar();g.addAssign(r.element(f).mul(RV({theta:A.mul(-1),axis:p,outputDirection:s,mipInt:l,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:u}))),g.addAssign(r.element(f).mul(RV({theta:A,axis:p,outputDirection:s,mipInt:l,envMap:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:u})))}),Qe(g,1)});let hE=null;const QY=new WeakMap;function DAe(n){const e=Math.log2(n)-2,i=1/n;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:i,maxMip:e}}function zAe(n){let e=QY.get(n);if((e!==void 0?e.pmremVersion:-1)!==n.pmremVersion){const i=n.image;if(n.isCubeTexture)if(FAe(i))e=hE.fromCubemap(n,e);else return null;else if(UAe(i))e=hE.fromEquirectangular(n,e);else return null;e.pmremVersion=n.pmremVersion,QY.set(n,e)}return e.texture}class KY extends Ti{static get type(){return"PMREMNode"}constructor(e,i=null,s=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=i,this.levelNode=s,this._generator=null;const r=new di;r.isRenderTargetTexture=!0,this._texture=zi(r),this._width=tt(0),this._height=tt(0),this._maxMip=tt(0),this.updateBeforeType=Ht.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const i=DAe(e.image.height);this._texture.value=e,this._width.value=i.texelWidth,this._height.value=i.texelHeight,this._maxMip.value=i.maxMip}updateBefore(){let e=this._pmrem;const i=e?e.pmremVersion:-1,s=this._value;i!==s.pmremVersion&&(s.isPMREMTexture===!0?e=s:e=zAe(s),e!==null&&(this._pmrem=e,this.updateFromTexture(e)))}setup(e){hE===null&&(hE=e.createPMREMGenerator()),this.updateBefore(e);let i=this.uvNode;i===null&&e.context.getUV&&(i=e.context.getUV(this));const s=this.value;e.renderer.coordinateSystem===Ac&&s.isPMREMTexture!==!0&&s.isRenderTargetTexture===!0&&(i=j(i.x.negate(),i.yz));let r=this.levelNode;return r===null&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),WY(this._texture,i,r,this._width,this._height,this._maxMip)}}function FAe(n){if(n==null)return!1;let e=0;const i=6;for(let s=0;s<i;s++)n[s]!==void 0&&e++;return e===i}function UAe(n){return n==null?!1:n.height>0}const YY=Ce(KY),jY=new WeakMap;class JY extends Kf{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:i}=e;let s=this.envNode;if(s.isTextureNode||s.isMaterialReferenceNode){const u=s.isTextureNode?s.value:i[s.property];let p=jY.get(u);p===void 0&&(p=YY(u),jY.set(u,p)),s=p}const r=i.envMap?wr("envMapIntensity","float",e.material):wr("environmentIntensity","float",e.scene),o=i.useAnisotropy===!0||i.anisotropy>0?gK:ys,a=s.context(qY(ud,o)).mul(r),l=s.context(OAe(JN)).mul(Math.PI).mul(r),c=W1(a),h=W1(l);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(h);const d=e.context.lightingModel.clearcoatRadiance;if(d){const u=s.context(qY(G1,Dy)).mul(r),p=W1(u);d.addAssign(p)}}}const qY=(n,e)=>{let i=null;return{getUV:()=>(i===null&&(i=Xn.negate().reflect(e),i=n.mul(n).mix(i,e).normalize(),i=i.transformDirection($a)),i),getTextureLevel:()=>n}},OAe=n=>({getUV:()=>n,getTextureLevel:()=>D(1)}),ZAe=new Us;class $Y extends Yi{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(ZAe),this.setValues(e)}setupEnvironment(e){let i=super.setupEnvironment(e);return i===null&&e.environmentNode&&(i=e.environmentNode),i?new JY(i):null}setupLightingModel(){return new oE}setupSpecular(){const e=Ai(j(.04),on.rgb,k1);Ja.assign(e),N1.assign(1)}setupVariants(){const e=this.metalnessNode?D(this.metalnessNode):MK;k1.assign(e);let i=this.roughnessNode?D(this.roughnessNode):_K;i=yV({roughness:i}),ud.assign(i),this.setupSpecular(),on.assign(Qe(on.rgb.mul(e.oneMinus()),on.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const WAe=new uo;class ej extends $Y{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(WAe),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?D(this.iorNode):zK;X1.assign(e),Ja.assign(Ai(Vr(VN(X1.sub(1).div(X1.add(1))).mul(SK),j(1)).mul(nV),on.rgb,k1)),N1.assign(Ai(nV,1,k1))}setupLightingModel(){return new oE(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const i=this.clearcoatNode?D(this.clearcoatNode):TK,s=this.clearcoatRoughnessNode?D(this.clearcoatRoughnessNode):EK;kT.assign(i),G1.assign(yV({roughness:s}))}if(this.useSheen){const i=this.sheenNode?j(this.sheenNode):BK,s=this.sheenRoughnessNode?D(this.sheenRoughnessNode):kK;Uf.assign(i),GT.assign(s)}if(this.useIridescence){const i=this.iridescenceNode?D(this.iridescenceNode):PK,s=this.iridescenceIORNode?D(this.iridescenceIORNode):NK,r=this.iridescenceThicknessNode?D(this.iridescenceThicknessNode):VK;PT.assign(i),CN.assign(s),SN.assign(r)}if(this.useAnisotropy){const i=(this.anisotropyNode?ae(this.anisotropyNode):GK).toVar();Am.assign(i.length()),Gt(Am.equal(0),()=>{i.assign(ae(1,0))}).Else(()=>{i.divAssign(ae(Am)),Am.assign(Am.saturate())}),NT.assign(Am.pow2().mix(ud.pow2(),1)),P1.assign(Qf[0].mul(i.x).add(Qf[1].mul(i.y))),Of.assign(Qf[1].mul(i.x).sub(Qf[0].mul(i.y)))}if(this.useTransmission){const i=this.transmissionNode?D(this.transmissionNode):XK,s=this.thicknessNode?D(this.thicknessNode):DK,r=this.attenuationDistanceNode?D(this.attenuationDistanceNode):FK,o=this.attenuationColorNode?j(this.attenuationColorNode):UK;if(XT.assign(i),MN.assign(s),IN.assign(r),TN.assign(o),this.useDispersion){const a=this.dispersionNode?D(this.dispersionNode):ZK;EN.assign(a)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?j(this.clearcoatNormalNode):RK}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}class HAe extends oE{constructor(e,i,s,r){super(e,i,s),this.useSSS=r}direct({lightDirection:e,lightColor:i,reflectedLight:s},r,o){if(this.useSSS===!0){const a=o.material,{thicknessColorNode:l,thicknessDistortionNode:c,thicknessAmbientNode:h,thicknessAttenuationNode:d,thicknessPowerNode:u,thicknessScaleNode:p}=a,g=e.add(ys.mul(c)).normalize(),f=D(Xn.dot(g.negate()).saturate().pow(u).mul(p)),A=j(f.add(h).mul(l));s.directDiffuse.addAssign(A.mul(d.mul(i)))}super.direct({lightDirection:e,lightColor:i,reflectedLight:s},r,o)}}class QAe extends ej{static get type(){return"MeshSSSNodeMaterial"}constructor(e){super(e),this.thicknessColorNode=null,this.thicknessDistortionNode=D(.1),this.thicknessAmbientNode=D(0),this.thicknessAttenuationNode=D(.1),this.thicknessPowerNode=D(2),this.thicknessScaleNode=D(10)}get useSSS(){return this.thicknessColorNode!==null}setupLightingModel(){return new HAe(this.useClearcoat,this.useSheen,this.useIridescence,this.useSSS)}copy(e){return this.thicknessColorNode=e.thicknessColorNode,this.thicknessDistortionNode=e.thicknessDistortionNode,this.thicknessAmbientNode=e.thicknessAmbientNode,this.thicknessAttenuationNode=e.thicknessAttenuationNode,this.thicknessPowerNode=e.thicknessPowerNode,this.thicknessScaleNode=e.thicknessScaleNode,super.copy(e)}}const KAe=ie(({normal:n,lightDirection:e,builder:i})=>{const s=n.dot(e),r=ae(s.mul(.5).add(.5),0);if(i.material.gradientMap){const o=gh("gradientMap","texture").context({getUV:()=>r});return j(o.r)}else{const o=r.fwidth().mul(.5);return Ai(j(.7),j(1),Sa(D(.7).sub(o.x),D(.7).add(o.x),r.x))}});class YAe extends ow{direct({lightDirection:e,lightColor:i,reflectedLight:s},r,o){const a=KAe({normal:HT,lightDirection:e,builder:o}).mul(i);s.directDiffuse.addAssign(a.mul(Yf({diffuseColor:on.rgb})))}indirect({ambientOcclusion:e,irradiance:i,reflectedLight:s}){s.indirectDiffuse.addAssign(i.mul(Yf({diffuseColor:on}))),s.indirectDiffuse.mulAssign(e)}}const jAe=new PP;class JAe extends Yi{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(jAe),this.setValues(e)}setupLightingModel(){return new YAe}}class tj extends Ti{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=j(Xn.z,0,Xn.x.negate()).normalize(),i=Xn.cross(e);return ae(e.dot(ys),i.dot(ys)).mul(.495).add(.5)}}const ij=it(tj),qAe=new NP;class $Ae extends Yi{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.lights=!1,this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(qAe),this.setValues(e)}setupVariants(e){const i=ij;let s;e.material.matcap?s=gh("matcap","texture").context({getUV:()=>i}):s=j(Ai(.2,.8,i.y)),on.rgb.mulAssign(s.rgb)}}const eye=new rd;class tye extends Yi{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(eye),this.setValues(e)}copy(e){return this.sizeNode=e.sizeNode,super.copy(e)}}class nj extends Ti{static get type(){return"RotateNode"}constructor(e,i){super(),this.positionNode=e,this.rotationNode=i}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:i,positionNode:s}=this;if(this.getNodeType(e)==="vec2"){const r=i.cos(),o=i.sin();return B1(r,o,o.negate(),r).mul(s)}else{const r=i,o=zf(Qe(1,0,0,0),Qe(0,_l(r.x),po(r.x).negate(),0),Qe(0,po(r.x),_l(r.x),0),Qe(0,0,0,1)),a=zf(Qe(_l(r.y),0,po(r.y),0),Qe(0,1,0,0),Qe(po(r.y).negate(),0,_l(r.y),0),Qe(0,0,0,1)),l=zf(Qe(_l(r.z),po(r.z).negate(),0,0),Qe(po(r.z),_l(r.z),0,0),Qe(0,0,1,0),Qe(0,0,0,1));return o.mul(a).mul(l).mul(Qe(s,1)).xyz}}}const LV=Ce(nj),iye=new s1;class nye extends Yi{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(iye),this.setValues(e)}setupPosition({object:e,camera:i,context:s}){const r=this.sizeAttenuation,{positionNode:o,rotationNode:a,scaleNode:l}=this,c=Bs;let h=md.mul(j(o||0)),d=ae(Cc[0].xyz.length(),Cc[1].xyz.length());l!==null&&(d=d.mul(l)),!r&&i.isPerspectiveCamera&&(d=d.mul(h.z.negate()));let u=c.xy;if(e.center&&e.center.isVector2===!0){const A=e0e("center","vec2");u=u.sub(A.sub(.5))}u=u.mul(d);const p=D(a||LK),g=LV(u,p);h=Qe(h.xy.add(g),h.zw);const f=qa.mul(h);return s.vertex=c,f}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}class sye extends ow{constructor(){super(),this.shadowNode=D(1).toVar("shadowMask")}direct({shadowMask:e}){this.shadowNode.mulAssign(e)}finish(e){on.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(on.rgb)}}const rye=new v1;class oye extends Yi{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(rye),this.setValues(e)}setupLightingModel(){return new sye}}const aye=ie(({texture:n,uv:e})=>{const i=j().toVar();return Gt(e.x.lessThan(1e-4),()=>{i.assign(j(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{i.assign(j(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{i.assign(j(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{i.assign(j(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{i.assign(j(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{i.assign(j(0,0,-1))}).Else(()=>{const s=n.uv(e.add(j(-.01,0,0))).r.sub(n.uv(e.add(j(.01,0,0))).r),r=n.uv(e.add(j(0,-.01,0))).r.sub(n.uv(e.add(j(0,.01,0))).r),o=n.uv(e.add(j(0,0,-.01))).r.sub(n.uv(e.add(j(0,0,.01))).r);i.assign(j(s,r,o))}),i.normalize()});class sj extends pd{static get type(){return"Texture3DNode"}constructor(e,i=null,s=null){super(e,i,s),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return j(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,i){return i}generateUV(e,i){return i.build(e,"vec3")}normal(e){return aye({texture:this,uv:e})}}const rj=Ce(sj);class lye extends Yi{static get type(){return"VolumeNodeMaterial"}constructor(e={}){super(),this.lights=!1,this.isVolumeNodeMaterial=!0,this.testNode=null,this.setValues(e)}setup(e){const i=rj(this.map,null,0),s=ie(({orig:r,dir:o})=>{const a=j(-.5),l=j(.5),c=o.reciprocal(),h=a.sub(r).mul(c),d=l.sub(r).mul(c),u=Vr(h,d),p=Li(h,d),g=Li(u.x,Li(u.y,u.z)),f=Vr(p.x,Vr(p.y,p.z));return ae(g,f)});this.fragmentNode=ie(()=>{const r=go(j($4.mul(Qe(YN,1)))),o=go(fo.sub(r)).normalize(),a=ae(s({orig:r,dir:o})).toVar();a.x.greaterThan(a.y).discard(),a.assign(ae(Li(a.x,0),a.y));const l=j(r.add(a.x.mul(o))).toVar(),c=j(o.abs().reciprocal()).toVar(),h=D(Vr(c.x,Vr(c.y,c.z))).toVar("delta");h.divAssign(gh("steps","float"));const d=Qe(gh("base","color"),0).toVar();return Bi({type:"float",start:a.x,end:a.y,update:"+= delta"},()=>{const u=ja("float","d").assign(i.uv(l.add(.5)).r);this.testNode!==null?this.testNode({map:i,mapValue:u,probe:l,finalColor:d}).append():(d.a.assign(1),tE()),l.addAssign(o.mul(h))}),d.a.equal(0).discard(),Qe(d)})(),super.setup(e)}}class oj extends fs{constructor(e){super(e),this.textures={},this.nodes={}}load(e,i,s,r){const o=new Rs(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,a=>{try{i(this.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),this.manager.itemError(e)}},s,r)}parseNodes(e){const i={};if(e!==void 0){for(const r of e){const{uuid:o,type:a}=r;i[o]=this.createNodeFromType(a),i[o].uuid=o}const s={nodes:i,textures:this.textures};for(const r of e)r.meta=s,i[r.uuid].deserialize(r),delete r.meta}return i}parse(e){const i=this.createNodeFromType(e.type);i.uuid=e.uuid;const s={nodes:this.parseNodes(e.nodes),textures:this.textures};return e.meta=s,i.deserialize(e),delete e.meta,i}setTextures(e){return this.textures=e,this}setNodes(e){return this.nodes=e,this}createNodeFromType(e){return this.nodes[e]===void 0?(console.error("THREE.NodeLoader: Node type not found:",e),D()):ge(new this.nodes[e])}}class aj extends J_{constructor(e){super(e),this.nodes={},this.nodeMaterials={}}parse(e){const i=super.parse(e),s=this.nodes,r=e.inputNodes;for(const o in r){const a=r[o];i[o]=s[a]}return i}setNodes(e){return this.nodes=e,this}setNodeMaterials(e){return this.nodeMaterials=e,this}createMaterialFromType(e){const i=this.nodeMaterials[e];return i!==void 0?new i:super.createMaterialFromType(e)}}class cye extends IH{constructor(e){super(e),this.nodes={},this.nodeMaterials={},this._nodesJSON=null}setNodes(e){return this.nodes=e,this}setNodeMaterials(e){return this.nodeMaterials=e,this}parse(e,i){this._nodesJSON=e.nodes;const s=super.parse(e,i);return this._nodesJSON=null,s}parseNodes(e,i){if(e!==void 0){const s=new oj;return s.setNodes(this.nodes),s.setTextures(i),s.parseNodes(e)}return{}}parseMaterials(e,i){const s={};if(e!==void 0){const r=this.parseNodes(this._nodesJSON,i),o=new aj;o.setTextures(i),o.setNodes(r),o.setNodeMaterials(this.nodeMaterials);for(let a=0,l=e.length;a<l;a++){const c=e[a];s[c.uuid]=o.parse(c)}}return s}}class BV{constructor(e,i,s=null){this.isNodeAttribute=!0,this.name=e,this.type=i,this.node=s}}class lj{constructor(e,i,s){this.isNodeUniform=!0,this.name=e,this.type=i,this.node=s.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class kV{constructor(e,i){this.isNodeVar=!0,this.name=e,this.type=i}}class cj extends kV{constructor(e,i){super(e,i),this.needsInterpolation=!1,this.isNodeVarying=!0}}class hj{constructor(e,i,s=""){this.name=e,this.type=i,this.code=s,Object.defineProperty(this,"isNodeCode",{value:!0})}}let hye=0;class dE{constructor(e=null){this.id=hye++,this.nodesData=new WeakMap,this.parent=e}getData(e){let i=this.nodesData.get(e);return i===void 0&&this.parent!==null&&(i=this.parent.getData(e)),i}setData(e,i){this.nodesData.set(e,i)}}class GV extends tn{static get type(){return"ParameterNode"}constructor(e,i=null){super(e,i),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}const dye=(n,e)=>ge(new GV(n,e));class PV extends Jt{static get type(){return"CodeNode"}constructor(e="",i=[],s=""){super("code"),this.isCodeNode=!0,this.code=e,this.language=s,this.includes=i}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const i=this.getIncludes(e);for(const r of i)r.build(e);const s=e.getCodeFromNode(this,this.getNodeType(e));return s.code=this.code,s.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}const uE=Ce(PV),uye=(n,e)=>uE(n,e,"js"),pye=(n,e)=>uE(n,e,"wgsl"),mye=(n,e)=>uE(n,e,"glsl");class NV extends PV{static get type(){return"FunctionNode"}constructor(e="",i=[],s=""){super(e,i,s)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const i=e.getDataFromNode(this);let s=i.nodeFunction;return s===void 0&&(s=e.parser.parseFunction(this.code),i.nodeFunction=s),s}generate(e,i){super.generate(e);const s=this.getNodeFunction(e),r=s.name,o=s.type,a=e.getCodeFromNode(this,o);r!==""&&(a.name=r);const l=e.getPropertyName(a),c=this.getNodeFunction(e).getCode(l);return a.code=c+`
`,i==="property"?l:e.format(`${l}()`,o,i)}}const dj=(n,e=[],i="")=>{for(let o=0;o<e.length;o++){const a=e[o];typeof a=="function"&&(e[o]=a.functionNode)}const s=ge(new NV(n,e,i)),r=(...o)=>s.call(...o);return r.functionNode=s,r},gye=(n,e)=>dj(n,e,"glsl"),fye=(n,e)=>dj(n,e,"wgsl");class jf{constructor(e,i){this.name=e,this.value=i,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class Aye extends jf{constructor(e,i=0){super(e,i),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class yye extends jf{constructor(e,i=new Q){super(e,i),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class bye extends jf{constructor(e,i=new E){super(e,i),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class vye extends jf{constructor(e,i=new $e){super(e,i),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class xye extends jf{constructor(e,i=new fe){super(e,i),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class wye extends jf{constructor(e,i=new oi){super(e,i),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class Cye extends jf{constructor(e,i=new de){super(e,i),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class Sye extends Aye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class _ye extends yye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Mye extends bye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Iye extends vye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Tye extends xye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Eye extends wye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Rye extends Cye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class uj extends Jt{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}If(e,i){const s=new E1(i);return this._currentCond=mo(e,s),this.add(this._currentCond)}ElseIf(e,i){const s=new E1(i),r=mo(e,s);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(e){return this._currentCond.elseNode=new E1(e),this}build(e,...i){const s=yN();L1(this);for(const r of this.nodes)r.build(e,"void");return L1(s),this.outputNode?this.outputNode.build(e,...i):super.build(e,...i)}else(...e){return console.warn("TSL.StackNode: .else() has been renamed to .Else()."),this.Else(...e)}elseif(...e){return console.warn("TSL.StackNode: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...e)}}const pE=Ce(uj);class Lye{constructor(){this.weakMap=new WeakMap}get(e){let i=this.weakMap;for(let s=0;s<e.length;s++)if(i=i.get(e[s]),i===void 0)return;return i.get(e[e.length-1])}set(e,i){let s=this.weakMap;for(let r=0;r<e.length;r++){const o=e[r];s.has(o)===!1&&s.set(o,new WeakMap),s=s.get(o)}return s.set(e[e.length-1],i)}delete(e){let i=this.weakMap;for(let s=0;s<e.length;s++)if(i=i.get(e[s]),i===void 0)return!1;return i.delete(e[e.length-1])}}const Wy=4,pj=[.125,.215,.35,.446,.526,.582],Jf=20,VV=new lh(-1,1,1,-1,0,1),Bye=new Ot(90,1),mj=new fe;let XV=null,DV=0,zV=0;const qf=(1+Math.sqrt(5))/2,Hy=1/qf,gj=[new E(-qf,Hy,0),new E(qf,Hy,0),new E(-Hy,0,qf),new E(Hy,0,qf),new E(0,qf,-Hy),new E(0,qf,Hy),new E(-1,1,-1),new E(1,1,-1),new E(-1,1,1),new E(1,1,1)],kye=[3,1,5,0,4,2],FV=ZY(yi(),Xr("faceIndex")).normalize(),UV=j(FV.x,FV.y.negate(),FV.z);class Gye{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}fromScene(e,i=0,s=.1,r=100){XV=this._renderer.getRenderTarget(),DV=this._renderer.getActiveCubeFace(),zV=this._renderer.getActiveMipmapLevel(),this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,s,r,o),i>0&&this._blur(o,0,0,i),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Aj(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=yj(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(XV,DV,zV),e.scissorTest=!1,mE(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===bl||e.mapping===gc?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),XV=this._renderer.getRenderTarget(),DV=this._renderer.getActiveCubeFace(),zV=this._renderer.getActiveMipmapLevel();const s=i||this._allocateTargets();return this._textureToCubeUV(e,s),this._applyPMREM(s),this._cleanup(s),s}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,s={magFilter:Wt,minFilter:Wt,generateMipmaps:!1,type:Ki,format:_i,colorSpace:qi},r=fj(e,i,s);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=fj(e,i,s);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=Pye(o)),this._blurMaterial=Nye(o,e,i)}return r}async _compileMaterial(e){const i=new pe(this._lodPlanes[0],e);await this._renderer.compile(i,VV)}_sceneToCubeUV(e,i,s,r){const o=Bye;o.near=i,o.far=s;const a=[-1,1,-1,-1,-1,-1],l=[1,1,1,-1,-1,-1],c=this._renderer,h=c.autoClear;c.getClearColor(mj),c.autoClear=!1;let d=this._backgroundBox;if(d===null){const g=new ai({name:"PMREM.Background",side:wn,depthWrite:!1,depthTest:!1});d=new pe(new bn,g)}let u=!1;const p=e.background;p?p.isColor&&(d.material.color.copy(p),e.background=null,u=!0):(d.material.color.copy(mj),u=!0),c.setRenderTarget(r),c.clear(),u&&c.render(d,o);for(let g=0;g<6;g++){const f=g%3;f===0?(o.up.set(0,a[g],0),o.lookAt(l[g],0,0)):f===1?(o.up.set(0,0,a[g]),o.lookAt(0,l[g],0)):(o.up.set(0,a[g],0),o.lookAt(0,0,l[g]));const A=this._cubeSize;mE(r,f*A,g>2?A:0,A,A),c.render(e,o)}c.autoClear=h,e.background=p}_textureToCubeUV(e,i){const s=this._renderer,r=e.mapping===bl||e.mapping===gc;r?this._cubemapMaterial===null&&(this._cubemapMaterial=Aj(e)):this._equirectMaterial===null&&(this._equirectMaterial=yj(e));const o=r?this._cubemapMaterial:this._equirectMaterial;o.fragmentNode.value=e;const a=this._lodMeshes[0];a.material=o;const l=this._cubeSize;mE(i,0,0,3*l,2*l),s.setRenderTarget(i),s.render(a,VV)}_applyPMREM(e){const i=this._renderer,s=i.autoClear;i.autoClear=!1;const r=this._lodPlanes.length;for(let o=1;o<r;o++){const a=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),l=gj[(r-o-1)%gj.length];this._blur(e,o-1,o,a,l)}i.autoClear=s}_blur(e,i,s,r,o){const a=this._pingPongRenderTarget;this._halfBlur(e,a,i,s,r,"latitudinal",o),this._halfBlur(a,e,s,s,r,"longitudinal",o)}_halfBlur(e,i,s,r,o,a,l){const c=this._renderer,h=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const d=3,u=this._lodMeshes[r];u.material=h;const p=h.uniforms,g=this._sizeLods[s]-1,f=isFinite(o)?Math.PI/(2*g):2*Math.PI/(2*Jf-1),A=o/f,y=isFinite(o)?1+Math.floor(d*A):Jf;y>Jf&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${Jf}`);const b=[];let v=0;for(let _=0;_<Jf;++_){const I=_/A,B=Math.exp(-I*I/2);b.push(B),_===0?v+=B:_<y&&(v+=2*B)}for(let _=0;_<b.length;_++)b[_]=b[_]/v;e.texture.frame=(e.texture.frame||0)+1,p.envMap.value=e.texture,p.samples.value=y,p.weights.array=b,p.latitudinal.value=a==="latitudinal"?1:0,l&&(p.poleAxis.value=l);const{_lodMax:x}=this;p.dTheta.value=f,p.mipInt.value=x-s;const w=this._sizeLods[r],C=3*w*(r>x-Wy?r-x+Wy:0),S=4*(this._cubeSize-w);mE(i,C,S,3*w,2*w),c.setRenderTarget(i),c.render(u,VV)}}function Pye(n){const e=[],i=[],s=[],r=[];let o=n;const a=n-Wy+1+pj.length;for(let l=0;l<a;l++){const c=Math.pow(2,o);i.push(c);let h=1/c;l>n-Wy?h=pj[l-n+Wy-1]:l===0&&(h=0),s.push(h);const d=1/(c-2),u=-d,p=1+d,g=[u,u,p,u,p,p,u,u,p,p,u,p],f=6,A=6,y=3,b=2,v=1,x=new Float32Array(y*A*f),w=new Float32Array(b*A*f),C=new Float32Array(v*A*f);for(let _=0;_<f;_++){const I=_%3*2/3-1,B=_>2?0:-1,M=[I,B,0,I+2/3,B,0,I+2/3,B+1,0,I,B,0,I+2/3,B+1,0,I,B+1,0],R=kye[_];x.set(M,y*A*R),w.set(g,b*A*R);const k=[R,R,R,R,R,R];C.set(k,v*A*R)}const S=new Rt;S.setAttribute("position",new ct(x,y)),S.setAttribute("uv",new ct(w,b)),S.setAttribute("faceIndex",new ct(C,v)),e.push(S),r.push(new pe(S,null)),o>Wy&&o--}return{lodPlanes:e,sizeLods:i,sigmas:s,lodMeshes:r}}function fj(n,e,i){const s=new br(n,e,i);return s.texture.mapping=cf,s.texture.name="PMREM.cubeUv",s.texture.isPMREMTexture=!0,s.scissorTest=!0,s}function mE(n,e,i,s,r){n.viewport.set(e,i,s,r),n.scissor.set(e,i,s,r)}function OV(n){const e=new Yi;return e.depthTest=!1,e.depthWrite=!1,e.blending=Pn,e.name=`PMREM_${n}`,e}function Nye(n,e,i){const s=gd(new Array(Jf).fill(0)),r=tt(new E(0,1,0)),o=tt(0),a=D(Jf),l=tt(0),c=tt(1),h=zi(null),d=tt(0),u=D(1/e),p=D(1/i),g=D(n),f={n:a,latitudinal:l,weights:s,poleAxis:r,outputDirection:UV,dTheta:o,samples:c,envMap:h,mipInt:d,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:g},A=OV("blur");return A.uniforms=f,A.fragmentNode=HY({...f,latitudinal:l.equal(1)}),A}function Aj(n){const e=OV("cubemap");return e.fragmentNode=KT(n,UV),e}function yj(n){const e=OV("equirect");return e.fragmentNode=zi(n,fV(UV),0),e}let Vye=0;class bj{constructor(e="",i=[],s=0,r=[]){this.name=e,this.bindings=i,this.index=s,this.bindingsReference=r,this.id=Vye++}}const vj=new WeakMap,Xye=new Map([[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),Dye=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),gE=n=>(n=Number(n),n+(n%1?"":".0"));class zye{constructor(e,i,s){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=i,this.parser=s,this.scene=null,this.camera=null,this.nodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.monitor=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.flow={code:""},this.chaining=[],this.stack=pE(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new dE,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.useComparisonMethod=!1}getBindGroupsCache(){let e=vj.get(this.renderer);return e===void 0&&(e=new Lye,vj.set(this.renderer,e)),e}createRenderTarget(e,i,s){return new br(e,i,s)}createCubeRenderTarget(e,i){return new bY(e,i)}createPMREMGenerator(){return new Gye(this.renderer)}includes(e){return this.nodes.includes(e)}_getBindGroup(e,i){const s=this.getBindGroupsCache(),r=[];let o=!0;for(const l of i)r.push(l),o=o&&l.groupNode.shared!==!0;let a;return o?(a=s.get(r),a===void 0&&(a=new bj(e,r,this.bindingsIndexes[e].group,r),s.set(r,a))):a=new bj(e,r,this.bindingsIndexes[e].group,r),a}getBindGroupArray(e,i){const s=this.bindings[i];let r=s[e];return r===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),s[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(e===null){const i={},s=this.bindings;for(const r of hN)for(const o in s[r]){const a=s[r][o];(i[o]||(i[o]=[])).push(...a)}e=[];for(const r in i){const o=i[r],a=this._getBindGroup(r,o);e.push(a)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((i,s)=>i.bindings[0].groupNode.order-s.bindings[0].groupNode.order);for(let i=0;i<e.length;i++){const s=e[i];this.bindingsIndexes[s.name].group=i,s.index=i}}setHashNode(e,i){this.hashNodes[i]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}buildUpdateNodes(){for(const e of this.nodes){const i=e.getUpdateType(),s=e.getUpdateBeforeType(),r=e.getUpdateAfterType();i!==Ht.NONE&&this.updateNodes.push(e.getSelf()),s!==Ht.NONE&&this.updateBeforeNodes.push(e.getSelf()),r!==Ht.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Wt||e.magFilter===vu||e.magFilter===id||e.magFilter===Ar||e.minFilter===Wt||e.minFilter===vu||e.minFilter===id||e.minFilter===Ar}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,i){return this.flowNodes[e].push(i),i}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,i=!0){const s=this.getDataFromNode(e);return s.cache===void 0&&(s.cache=new dE(i?this.getCache():null)),s.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const i=this.getDataFromNode(e);return i.usageCount=i.usageCount===void 0?1:i.usageCount+1,i.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateConst(e,i=null){if(i===null&&(e==="float"||e==="int"||e==="uint"?i=0:e==="bool"?i=!1:e==="color"?i=new fe:e==="vec2"?i=new Q:e==="vec3"?i=new E:e==="vec4"&&(i=new $e)),e==="float")return gE(i);if(e==="int")return`${Math.round(i)}`;if(e==="uint")return i>=0?`${Math.round(i)}u`:"0u";if(e==="bool")return i?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${gE(i.r)}, ${gE(i.g)}, ${gE(i.b)} )`;const s=this.getTypeLength(e),r=this.getComponentType(e),o=a=>this.generateConst(r,a);if(s===2)return`${this.getType(e)}( ${o(i.x)}, ${o(i.y)} )`;if(s===3)return`${this.getType(e)}( ${o(i.x)}, ${o(i.y)}, ${o(i.z)} )`;if(s===4)return`${this.getType(e)}( ${o(i.x)}, ${o(i.y)}, ${o(i.z)}, ${o(i.w)} )`;if(s>4&&i&&(i.isMatrix3||i.isMatrix4))return`${this.getType(e)}( ${i.elements.map(o).join(", ")} )`;if(s>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,i){const s=this.attributes;for(const o of s)if(o.name===e)return o;const r=new BV(e,i);return s.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const i=e.type;if(e.isDataTexture){if(i===nd)return"int";if(i===Gr)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const i=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return i===null?null:i[1]==="b"?"bool":i[1]==="i"?"int":i[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,i="float"){if(e===1)return i;const s=Xye.get(e);return(i==="float"?"":i[0])+s}getTypeFromArray(e){return Dye.get(e.constructor)}getTypeFromAttribute(e){let i=e;e.isInterleavedBufferAttribute&&(i=e.data);const s=i.array,r=e.itemSize,o=e.normalized;let a;return!(e instanceof $W)&&o!==!0&&(a=this.getTypeFromArray(s)),this.getTypeFromLength(r,a)}getTypeLength(e){const i=this.getVectorType(e),s=/vec([2-4])/.exec(i);return s!==null?Number(s[1]):i==="float"||i==="bool"||i==="int"||i==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,i){return this.getTypeFromLength(this.getTypeLength(e),i)}getIntegerType(e){const i=this.getComponentType(e);return i==="int"||i==="uint"?e:this.changeComponentType(e,"int")}addStack(){return this.stack=pE(this.stack),this.stacks.push(yN()||this.stack),L1(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,L1(this.stacks.pop()),e}getDataFromNode(e,i=this.shaderStage,s=null){s=s===null?e.isGlobal(this)?this.globalCache:this.cache:s;let r=s.getData(e);return r===void 0&&(r={},s.setData(e,r)),r[i]===void 0&&(r[i]={}),r[i]}getNodeProperties(e,i="any"){const s=this.getDataFromNode(e,i);return s.properties||(s.properties={outputNode:null})}getBufferAttributeFromNode(e,i){const s=this.getDataFromNode(e);let r=s.bufferAttribute;if(r===void 0){const o=this.uniforms.index++;r=new BV("nodeAttribute"+o,i,e),this.bufferAttributes.push(r),s.bufferAttribute=r}return r}getStructTypeFromNode(e,i=this.shaderStage){const s=this.getDataFromNode(e,i);if(s.structType===void 0){const r=this.structs.index++;e.name=`StructType${r}`,this.structs[i].push(e),s.structType=e}return e}getUniformFromNode(e,i,s=this.shaderStage,r=null){r==="in"&&(console.warn('NodeBuilder: "in" is a reserved word, using "inValue" instead.',e,r),e.name="inValue",r=e.name);const o=this.getDataFromNode(e,s,this.globalCache);let a=o.uniform;if(a===void 0){const l=this.uniforms.index++;a=new lj(r||"nodeUniform"+l,i,e),this.uniforms[s].push(a),o.uniform=a}return a}getVarFromNode(e,i=null,s=e.getNodeType(this),r=this.shaderStage){const o=this.getDataFromNode(e,r);let a=o.variable;if(a===void 0){const l=this.vars[r]||(this.vars[r]=[]);i===null&&(i="nodeVar"+l.length),a=new kV(i,s),l.push(a),o.variable=a}return a}getVaryingFromNode(e,i=null,s=e.getNodeType(this)){const r=this.getDataFromNode(e,"any");let o=r.varying;if(o===void 0){const a=this.varyings,l=a.length;i===null&&(i="nodeVarying"+l),o=new cj(i,s),a.push(o),r.varying=o}return o}getCodeFromNode(e,i,s=this.shaderStage){const r=this.getDataFromNode(e);let o=r.code;if(o===void 0){const a=this.codes[s]||(this.codes[s]=[]),l=a.length;o=new hj("nodeCode"+l,i),a.push(o),r.code=o}return o}addFlowCodeHierarchy(e,i){const{flowCodes:s,flowCodeBlock:r}=this.getDataFromNode(e);let o=!0,a=i;for(;a;){if(r.get(a)===!0){o=!1;break}a=this.getDataFromNode(a).parentNodeBlock}if(o)for(const l of s)this.addLineFlowCode(l)}addLineFlowCodeBlock(e,i,s){const r=this.getDataFromNode(e),o=r.flowCodes||(r.flowCodes=[]),a=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);o.push(i),a.set(s,!0)}addLineFlowCode(e,i=null){return e===""?this:(i!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(i,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const i=e.getNodeType(this),s=this.flowChildNode(e,i);return this.flowsData.set(e,s),s}buildFunctionNode(e){const i=new NV,s=this.currentFunctionNode;return this.currentFunctionNode=i,i.code=this.buildFunctionCode(e),this.currentFunctionNode=s,i}flowShaderNode(e){const i=e.layout,s={[Symbol.iterator](){let a=0;const l=Object.values(this);return{next:()=>({value:l[a],done:a++>=l.length})}}};for(const a of i.inputs)s[a.name]=new GV(a.type,a.name);e.layout=null;const r=e.call(s),o=this.flowStagesNode(r,i.type);return e.layout=i,o}flowStagesNode(e,i=null){const s=this.flow,r=this.vars,o=this.cache,a=this.buildStage,l=this.stack,c={code:""};this.flow=c,this.vars={},this.cache=new dE,this.stack=pE();for(const h of cN)this.setBuildStage(h),c.result=e.build(this,i);return c.vars=this.getVars(this.shaderStage),this.flow=s,this.vars=r,this.cache=o,this.stack=l,this.setBuildStage(a),c}getFunctionOperator(){return null}flowChildNode(e,i=null){const s=this.flow,r={code:""};return this.flow=r,r.result=e.build(this,i),this.flow=s,r}flowNodeFromShaderStage(e,i,s=null,r=null){const o=this.shaderStage;this.setShaderStage(e);const a=this.flowChildNode(i,s);return r!==null&&(a.code+=`${this.tab+r} = ${a.result};
`),this.flowCode[e]=this.flowCode[e]+a.code,this.setShaderStage(o),a}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,i){return`${this.getType(e)} ${i}`}getVars(e){let i="";const s=this.vars[e];if(s!==void 0)for(const r of s)i+=`${this.getVar(r.type,r.name)}; `;return i}getUniforms(){console.warn("Abstract function.")}getCodes(e){const i=this.codes[e];let s="";if(i!==void 0)for(const r of i)s+=r.code+`
`;return s}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:i,renderer:s}=this;if(i!==null){let r=s.nodes.library.fromMaterial(i);r===null&&(console.error(`NodeMaterial: Material "${i.type}" is not compatible.`),r=new Yi),r.build(this)}else this.addFlow("compute",e);for(const r of cN){this.setBuildStage(r),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const o of hN){this.setShaderStage(o);const a=this.flowNodes[o];for(const l of a)r==="generate"?this.flowNode(l):l.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,i){if(i==="float"||i==="int"||i==="uint")return new Sye(e);if(i==="vec2"||i==="ivec2"||i==="uvec2")return new _ye(e);if(i==="vec3"||i==="ivec3"||i==="uvec3")return new Mye(e);if(i==="vec4"||i==="ivec4"||i==="uvec4")return new Iye(e);if(i==="color")return new Tye(e);if(i==="mat3")return new Eye(e);if(i==="mat4")return new Rye(e);throw new Error(`Uniform "${i}" not declared.`)}createNodeMaterial(e="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${e}() instead.`)}format(e,i,s){if(i=this.getVectorType(i),s=this.getVectorType(s),i===s||s===null||this.isReference(s))return e;const r=this.getTypeLength(i),o=this.getTypeLength(s);return r===16&&o===9?`${this.getType(s)}(${e}[0].xyz, ${e}[1].xyz, ${e}[2].xyz)`:r===9&&o===4?`${this.getType(s)}(${e}[0].xy, ${e}[1].xy)`:r>4||o>4||o===0?e:r===o?`${this.getType(s)}( ${e} )`:r>o?this.format(`${e}.${"xyz".slice(0,o)}`,this.getTypeFromLength(o,this.getComponentType(i)),s):o===4&&r>1?`${this.getType(s)}( ${this.format(e,i,"vec3")}, 1.0 )`:r===2?`${this.getType(s)}( ${this.format(e,i,"vec2")}, 0.0 )`:(r===1&&o>1&&i!==this.getComponentType(s)&&(e=`${this.getType(this.getComponentType(s))}( ${e} )`),`${this.getType(s)}( ${e} )`)}getSignature(){return`// Three.js r${fa} - Node System
`}}class xj{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.startTime=null,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,i){let s=e.get(i);return s===void 0&&(s={renderMap:new WeakMap,frameMap:new WeakMap},e.set(i,s)),s}updateBeforeNode(e){const i=e.getUpdateBeforeType(),s=e.updateReference(this);if(i===Ht.FRAME){const{frameMap:r}=this._getMaps(this.updateBeforeMap,s);r.get(s)!==this.frameId&&e.updateBefore(this)!==!1&&r.set(s,this.frameId)}else if(i===Ht.RENDER){const{renderMap:r}=this._getMaps(this.updateBeforeMap,s);r.get(s)!==this.renderId&&e.updateBefore(this)!==!1&&r.set(s,this.renderId)}else i===Ht.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const i=e.getUpdateAfterType(),s=e.updateReference(this);if(i===Ht.FRAME){const{frameMap:r}=this._getMaps(this.updateAfterMap,s);r.get(s)!==this.frameId&&e.updateAfter(this)!==!1&&r.set(s,this.frameId)}else if(i===Ht.RENDER){const{renderMap:r}=this._getMaps(this.updateAfterMap,s);r.get(s)!==this.renderId&&e.updateAfter(this)!==!1&&r.set(s,this.renderId)}else i===Ht.OBJECT&&e.updateAfter(this)}updateNode(e){const i=e.getUpdateType(),s=e.updateReference(this);if(i===Ht.FRAME){const{frameMap:r}=this._getMaps(this.updateMap,s);r.get(s)!==this.frameId&&e.update(this)!==!1&&r.set(s,this.frameId)}else if(i===Ht.RENDER){const{renderMap:r}=this._getMaps(this.updateMap,s);r.get(s)!==this.renderId&&e.update(this)!==!1&&r.set(s,this.renderId)}else i===Ht.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class ZV{constructor(e,i,s=null,r="",o=!1){this.type=e,this.name=i,this.count=s,this.qualifier=r,this.isConst=o}}ZV.isNodeFunctionInput=!0;class Fye extends Jt{static get type(){return"StructTypeNode"}constructor(e){super(),this.types=e,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}class WV extends Jt{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}setup(e){super.setup(e);const i=this.members,s=[];for(let r=0;r<i.length;r++)s.push(i[r].getNodeType(e));this.nodeType=e.getStructTypeFromNode(new Fye(s)).name}generate(e,i){const s=e.getOutputStructName(),r=this.members,o=s!==""?s+".":"";for(let a=0;a<r.length;a++){const l=r[a].build(e,i);e.addLineFlowCode(`${o}m${a} = ${l}`,this)}return s}}const Uye=Ce(WV);function HV(n,e){for(let i=0;i<n.length;i++)if(n[i].name===e)return i;return-1}class wj extends WV{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.isMRTNode=!0}has(e){return this.outputNodes[e]!==void 0}get(e){return this.outputNodes[e]}merge(e){const i={...this.outputNodes,...e.outputNodes};return fE(i)}setup(e){const i=this.outputNodes,s=e.renderer.getRenderTarget(),r=[],o=s.textures;for(const a in i){const l=HV(o,a);r[l]=Qe(i[a])}return this.members=r,super.setup(e)}}const fE=Ce(wj);class Cj extends Jt{static get type(){return"FunctionOverloadingNode"}constructor(e=[],...i){super(),this.functionNodes=e,this.parametersNodes=i,this._candidateFnCall=null,this.global=!0}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(e){const i=this.parametersNodes;let s=this._candidateFnCall;if(s===null){let r=null,o=-1;for(const a of this.functionNodes){const l=a.shaderNode.layout;if(l===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const c=l.inputs;if(i.length===c.length){let h=0;for(let d=0;d<i.length;d++){const u=i[d],p=c[d];u.getNodeType(e)===p.type?h++:h=0}h>o&&(r=a,o=h)}}this._candidateFnCall=s=r(...i)}return s}}const Oye=Ce(Cj),yo=n=>(...e)=>Oye(n,...e);class oo extends Ff{static get type(){return"TimerNode"}constructor(e=oo.LOCAL,i=1,s=0){super(s),this.scope=e,this.scale=i,this.updateType=Ht.FRAME}update(e){const i=this.scope,s=this.scale;i===oo.LOCAL?this.value+=e.deltaTime*s:i===oo.DELTA?this.value=e.deltaTime*s:i===oo.FRAME?this.value=e.frameId:this.value=e.time*s}serialize(e){super.serialize(e),e.scope=this.scope,e.scale=this.scale}deserialize(e){super.deserialize(e),this.scope=e.scope,this.scale=e.scale}}oo.LOCAL="local",oo.GLOBAL="global",oo.DELTA="delta",oo.FRAME="frame";const QV=(n,e=0)=>ge(new oo(oo.LOCAL,n,e)),Zye=(n,e=0)=>ge(new oo(oo.GLOBAL,n,e)),Wye=(n,e=0)=>ge(new oo(oo.DELTA,n,e)),Hye=it(oo,oo.FRAME).toUint();class Br extends Jt{static get type(){return"OscNode"}constructor(e=Br.SINE,i=QV()){super(),this.method=e,this.timeNode=i}getNodeType(e){return this.timeNode.getNodeType(e)}setup(){const e=this.method,i=ge(this.timeNode);let s=null;return e===Br.SINE?s=i.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5):e===Br.SQUARE?s=i.fract().round():e===Br.TRIANGLE?s=i.add(.5).fract().mul(2).sub(1).abs():e===Br.SAWTOOTH&&(s=i.fract()),s}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}Br.SINE="sine",Br.SQUARE="square",Br.TRIANGLE="triangle",Br.SAWTOOTH="sawtooth";const Qye=Ce(Br,Br.SINE),Kye=Ce(Br,Br.SQUARE),Yye=Ce(Br,Br.TRIANGLE),jye=Ce(Br,Br.SAWTOOTH);class Sj extends Jt{static get type(){return"SpriteSheetUVNode"}constructor(e,i=yi(),s=D(0)){super("vec2"),this.countNode=e,this.uvNode=i,this.frameNode=s}setup(){const{frameNode:e,uvNode:i,countNode:s}=this,{width:r,height:o}=s,a=e.mod(r.mul(o)).floor(),l=a.mod(r),c=o.sub(a.add(1).div(r).ceil()),h=s.reciprocal(),d=ae(l,c);return i.add(d).mul(h)}}const Jye=Ce(Sj);class _j extends gm{static get type(){return"StorageArrayElementNode"}constructor(e,i){super(e,i),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}setup(e){return e.isAvailable("storageBuffer")===!1&&this.node.bufferObject===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,i){let s;const r=e.context.assign;if(e.isAvailable("storageBuffer")===!1?this.node.bufferObject===!0&&r!==!0?s=e.generatePBO(this):s=this.node.build(e):s=super.generate(e),r!==!0){const o=this.getNodeType(e);s=e.format(s,o,i)}return s}}const qye=Ce(_j);class Mj extends Jt{static get type(){return"TriplanarTexturesNode"}constructor(e,i=null,s=null,r=D(1),o=Bs,a=el){super("vec4"),this.textureXNode=e,this.textureYNode=i,this.textureZNode=s,this.scaleNode=r,this.positionNode=o,this.normalNode=a}setup(){const{textureXNode:e,textureYNode:i,textureZNode:s,scaleNode:r,positionNode:o,normalNode:a}=this;let l=a.abs().normalize();l=l.div(l.dot(j(1)));const c=o.yz.mul(r),h=o.zx.mul(r),d=o.xy.mul(r),u=e.value,p=i!==null?i.value:u,g=s!==null?s.value:u,f=zi(u,c).mul(l.x),A=zi(p,h).mul(l.y),y=zi(g,d).mul(l.z);return Hn(f,A,y)}}const Ij=Ce(Mj),$ye=(...n)=>Ij(...n),Qy=new tr,$f=new E,Ky=new E,KV=new E,aw=new de,AE=new E(0,0,-1),Pu=new $e,lw=new E,yE=new E,cw=new $e,bE=new Q,Tj=new br,ebe=wm.flipX();let YV=!1;class Ej extends pd{static get type(){return"ReflectorNode"}constructor(e={}){super(Tj.texture,ebe);const{target:i=new Ae,resolution:s=1,generateMipmaps:r=!1,bounces:o=!0}=e;this.target=i,this.resolution=s,this.generateMipmaps=r,this.bounces=o,this.updateBeforeType=o?Ht.RENDER:Ht.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new WeakMap}_updateResolution(e,i){const s=this.resolution;i.getDrawingBufferSize(bE),e.setSize(Math.round(bE.width*s),Math.round(bE.height*s))}setup(e){return this._updateResolution(Tj,e.renderer),super.setup(e)}getTextureNode(){return this.textureNode}getVirtualCamera(e){let i=this.virtualCameras.get(e);return i===void 0&&(i=e.clone(),this.virtualCameras.set(e,i)),i}getRenderTarget(e){let i=this.renderTargets.get(e);return i===void 0&&(i=new br(0,0,{type:Ki}),this.generateMipmaps===!0&&(i.texture.minFilter=mW,i.texture.generateMipmaps=!0),this.renderTargets.set(e,i)),i}updateBefore(e){if(this.bounces===!1&&YV)return!1;YV=!0;const{scene:i,camera:s,renderer:r,material:o}=e,{target:a}=this,l=this.getVirtualCamera(s),c=this.getRenderTarget(l);if(r.getDrawingBufferSize(bE),this._updateResolution(c,r),Ky.setFromMatrixPosition(a.matrixWorld),KV.setFromMatrixPosition(s.matrixWorld),aw.extractRotation(a.matrixWorld),$f.set(0,0,1),$f.applyMatrix4(aw),lw.subVectors(Ky,KV),lw.dot($f)>0)return;lw.reflect($f).negate(),lw.add(Ky),aw.extractRotation(s.matrixWorld),AE.set(0,0,-1),AE.applyMatrix4(aw),AE.add(KV),yE.subVectors(Ky,AE),yE.reflect($f).negate(),yE.add(Ky),l.coordinateSystem=s.coordinateSystem,l.position.copy(lw),l.up.set(0,1,0),l.up.applyMatrix4(aw),l.up.reflect($f),l.lookAt(yE),l.near=s.near,l.far=s.far,l.updateMatrixWorld(),l.projectionMatrix.copy(s.projectionMatrix),Qy.setFromNormalAndCoplanarPoint($f,Ky),Qy.applyMatrix4(l.matrixWorldInverse),Pu.set(Qy.normal.x,Qy.normal.y,Qy.normal.z,Qy.constant);const h=l.projectionMatrix;cw.x=(Math.sign(Pu.x)+h.elements[8])/h.elements[0],cw.y=(Math.sign(Pu.y)+h.elements[9])/h.elements[5],cw.z=-1,cw.w=(1+h.elements[10])/h.elements[14],Pu.multiplyScalar(1/Pu.dot(cw));const d=0;h.elements[2]=Pu.x,h.elements[6]=Pu.y,h.elements[10]=Pu.z-d,h.elements[14]=Pu.w,this.value=c.texture,o.visible=!1;const u=r.getRenderTarget(),p=r.getMRT();r.setMRT(null),r.setRenderTarget(c),r.render(i,l),r.setMRT(p),r.setRenderTarget(u),o.visible=!0,YV=!1}}const tbe=n=>ge(new Ej(n)),jV=new lh(-1,1,1,-1,0,1);class ibe extends Rt{constructor(e=!1){super();const i=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new dt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new dt(i,2))}}const nbe=new ibe;class fd extends pe{constructor(e=null){super(nbe,e),this.camera=jV,this.isQuadMesh=!0}renderAsync(e){return e.renderAsync(this,jV)}render(e){e.render(this,jV)}}const sbe=new Q;class Rj extends pd{static get type(){return"RTTNode"}constructor(e,i=null,s=null,r={type:Ki}){const o=new br(i,s,r);super(o.texture,yi()),this.node=e,this.width=i,this.height=s,this.renderTarget=o,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this.updateMap=new WeakMap,this._rttNode=null,this._quadMesh=new fd(new Yi),this.updateBeforeType=Ht.RENDER}get autoSize(){return this.width===null}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,i){this.width=e,this.height=i;const s=e*this.pixelRatio,r=i*this.pixelRatio;this.renderTarget.setSize(s,r),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoSize===!0){this.pixelRatio=e.getPixelRatio();const s=e.getSize(sbe);this.setSize(s.width,s.height)}this._quadMesh.material.fragmentNode=this._rttNode;const i=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(i)}clone(){const e=new pd(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}}const Lj=(n,...e)=>ge(new Rj(ge(n),...e)),_a=(n,...e)=>n.isTextureNode?n:Lj(n,...e);class Bj extends KN{static get type(){return"VertexColorNode"}constructor(e=0){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const i=this.getAttributeName(e),s=e.hasGeometryAttribute(i);let r;return s===!0?r=super.generate(e):r=e.generateConst(this.nodeType,new $e(1,1,1,1)),r}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const rbe=(...n)=>ge(new Bj(...n));class kj extends Jt{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const obe=it(kj);class $h extends Jt{static get type(){return"SceneNode"}constructor(e=$h.BACKGROUND_BLURRINESS,i=null){super(),this.scope=e,this.scene=i}setup(e){const i=this.scope,s=this.scene!==null?this.scene:e.scene;let r;return i===$h.BACKGROUND_BLURRINESS?r=wr("backgroundBlurriness","float",s):i===$h.BACKGROUND_INTENSITY?r=wr("backgroundIntensity","float",s):console.error("THREE.SceneNode: Unknown scope:",i),r}}$h.BACKGROUND_BLURRINESS="backgroundBlurriness",$h.BACKGROUND_INTENSITY="backgroundIntensity";const abe=it($h,$h.BACKGROUND_BLURRINESS),lbe=it($h,$h.BACKGROUND_INTENSITY),Gj={Uniform:"uniform",Storage:"storage",ReadOnlyStorage:"read-only-storage"},JV={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"};class qV extends YT{static get type(){return"StorageBufferNode"}constructor(e,i,s=0){super(e,i,s),this.isStorageBufferNode=!0,this.access=Gj.Storage,this.isAtomic=!1,this.bufferObject=!1,this.bufferCount=s,this._attribute=null,this._varying=null,this.global=!0,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(this.bufferCount===0){let i=e.globalCache.getData(this.value);return i===void 0&&(i={node:this},e.globalCache.setData(this.value,i)),i.node.uuid}return this.uuid}getInputType(){return"storageBuffer"}element(e){return qye(this,e)}setBufferObject(e){return this.bufferObject=e,this}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(Gj.ReadOnlyStorage)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}generate(e){if(e.isAvailable("storageBuffer"))return super.generate(e);const i=this.getNodeType(e);this._attribute===null&&(this._attribute=Z1(this.value),this._varying=go(this._attribute));const s=this._varying.build(e,i);return e.registerTransform(s,this._attribute),s}}const cbe=(n,e,i)=>ge(new qV(n,e,i)),hbe=(n,e,i)=>ge(new qV(n,e,i).setBufferObject(!0));class Pj extends pd{static get type(){return"StorageTextureNode"}constructor(e,i,s=null){super(e,i),this.storeNode=s,this.isStorageTextureNode=!0,this.access=JV.WriteOnly}getInputType(){return"storageTexture"}setup(e){super.setup(e);const i=e.getNodeProperties(this);i.storeNode=this.storeNode}setAccess(e){return this.access=e,this}generate(e,i){let s;return this.storeNode!==null?s=this.generateStore(e):s=super.generate(e,i),s}toReadOnly(){return this.setAccess(JV.ReadOnly)}toWriteOnly(){return this.setAccess(JV.WriteOnly)}generateStore(e){const i=e.getNodeProperties(this),{uvNode:s,storeNode:r}=i,o=super.generate(e,"property"),a=s.build(e,"uvec2"),l=r.build(e,"vec4"),c=e.generateTextureStore(e,o,a,l);e.addLineFlowCode(c,this)}}const Nj=Ce(Pj),dbe=(n,e,i)=>{const s=Nj(n,e,i);return i!==null&&s.append(),s};class Vj extends K1{static get type(){return"UserDataNode"}constructor(e,i,s=null){super(e,i,s),this.userData=s}updateReference(e){return this.reference=this.userData!==null?this.userData:e.object.userData,this.reference}}const ube=(n,e,i)=>ge(new Vj(n,e,i));class Xj extends Ti{static get type(){return"PosterizeNode"}constructor(e,i){super(),this.sourceNode=e,this.stepsNode=i}setup(){const{sourceNode:e,stepsNode:i}=this;return e.mul(i).floor().div(i)}}const pbe=Ce(Xj);let $V=null;class Dj extends nw{static get type(){return"ViewportSharedTextureNode"}constructor(e=wm,i=null){$V===null&&($V=new yP),super(e,i,$V)}updateReference(){return this}}const mbe=Ce(Dj),gbe=new Q;class zj extends pd{static get type(){return"PassTextureNode"}constructor(e,i){super(i),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class Fj extends zj{static get type(){return"PassMultipleTextureNode"}constructor(e,i,s=!1){super(e,null),this.textureName=i,this.previousTexture=s}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class so extends Ti{static get type(){return"PassNode"}constructor(e,i,s,r={}){super("vec4"),this.scope=e,this.scene=i,this.camera=s,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const o=new Eu;o.isRenderTargetTexture=!0,o.name="depth";const a=new br(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Ki,...r});a.texture.name="output",a.depthTexture=o,this.renderTarget=a,this.updateBeforeType=Ht.FRAME,this._textures={output:a.texture,depth:o},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=tt(0),this._cameraFar=tt(0),this._mrt=null,this.isPassNode=!0}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(e){let i=this._textures[e];return i===void 0&&(i=this.renderTarget.texture.clone(),i.isRenderTargetTexture=!0,i.name=e,this._textures[e]=i,this.renderTarget.textures.push(i)),i}getPreviousTexture(e){let i=this._previousTextures[e];return i===void 0&&(i=this.getTexture(e).clone(),i.isRenderTargetTexture=!0,this._previousTextures[e]=i),i}toggleTexture(e){const i=this._previousTextures[e];if(i!==void 0){const s=this._textures[e],r=this.renderTarget.textures.indexOf(s);this.renderTarget.textures[r]=i,this._textures[e]=i,this._previousTextures[e]=s,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let i=this._textureNodes[e];return i===void 0&&(this._textureNodes[e]=i=ge(new Fj(this,e)),this._textureNodes[e].updateTexture()),i}getPreviousTextureNode(e="output"){let i=this._previousTextureNodes[e];return i===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),this._previousTextureNodes[e]=i=ge(new Fj(this,e,!0)),this._previousTextureNodes[e].updateTexture()),i}getViewZNode(e="depth"){let i=this._viewZNodes[e];if(i===void 0){const s=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=i=mV(this.getTextureNode(e),s,r)}return i}getLinearDepthNode(e="depth"){let i=this._linearDepthNodes[e];if(i===void 0){const s=this._cameraNear,r=this._cameraFar,o=this.getViewZNode(e);this._linearDepthNodes[e]=i=sw(o,s,r)}return i}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,e.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.renderTarget.depthTexture.isMultisampleRenderTargetTexture=this.renderTarget.samples>1,this.scope===so.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:i}=e,{scene:s,camera:r}=this;this._pixelRatio=i.getPixelRatio();const o=i.getSize(gbe);this.setSize(o.width,o.height);const a=i.getRenderTarget(),l=i.getMRT();this._cameraNear.value=r.near,this._cameraFar.value=r.far;for(const c in this._previousTextures)this.toggleTexture(c);i.setRenderTarget(this.renderTarget),i.setMRT(this._mrt),i.render(s,r),i.setRenderTarget(a),i.setMRT(l)}setSize(e,i){this._width=e,this._height=i;const s=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget.setSize(s,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}so.COLOR="color",so.DEPTH="depth";const fbe=(n,e,i)=>ge(new so(so.COLOR,n,e,i)),Yy=(n,e)=>ge(new zj(n,e)),Abe=(n,e)=>ge(new so(so.DEPTH,n,e)),Uj=new fd,Oj=new fd;class Zj extends Ti{static get type(){return"GaussianBlurNode"}constructor(e,i=null,s=2){super("vec4"),this.textureNode=e,this.directionNode=i,this.sigma=s,this._invSize=tt(new Q),this._passDirection=tt(new Q),this._horizontalRT=new br,this._horizontalRT.texture.name="GaussianBlurNode.horizontal",this._verticalRT=new br,this._verticalRT.texture.name="GaussianBlurNode.vertical",this._textureNode=Yy(this,this._verticalRT.texture),this.updateBeforeType=Ht.RENDER,this.resolution=new Q(1,1)}setSize(e,i){e=Math.max(Math.round(e*this.resolution.x),1),i=Math.max(Math.round(i*this.resolution.y),1),this._invSize.value.set(1/e,1/i),this._horizontalRT.setSize(e,i),this._verticalRT.setSize(e,i)}updateBefore(e){const{renderer:i}=e,s=this.textureNode,r=s.value,o=i.getRenderTarget(),a=i.getMRT(),l=s.value;Uj.material=this._material,Oj.material=this._material,this.setSize(r.image.width,r.image.height);const c=r.type;this._horizontalRT.texture.type=c,this._verticalRT.texture.type=c,i.setMRT(null),i.setRenderTarget(this._horizontalRT),this._passDirection.value.set(1,0),Uj.render(i),s.value=this._horizontalRT.texture,i.setRenderTarget(this._verticalRT),this._passDirection.value.set(0,1),Oj.render(i),i.setRenderTarget(o),i.setMRT(a),s.value=l}getTextureNode(){return this._textureNode}setup(e){const i=this.textureNode;if(i.isTextureNode!==!0)return console.error("GaussianBlurNode requires a TextureNode."),Qe();const s=i.uvNode||yi(),r=ae(this.directionNode||1),o=h=>i.uv(h),a=ie(()=>{const h=3+2*this.sigma,d=this._getCoefficients(h),u=this._invSize,p=r.mul(this._passDirection),g=D(d[0]).toVar(),f=Qe(o(s).mul(g)).toVar();for(let A=1;A<h;A++){const y=D(A),b=D(d[A]),v=ae(p.mul(u.mul(y))).toVar(),x=Qe(o(s.add(v))),w=Qe(o(s.sub(v)));f.addAssign(x.add(w).mul(b)),g.addAssign(wi(2,b))}return f.div(g)}),l=this._material||(this._material=new Yi);l.fragmentNode=a().context(e.getSharedContext()),l.name="Gaussian_blur",l.needsUpdate=!0;const c=e.getNodeProperties(this);return c.textureNode=i,this._textureNode}dispose(){this._horizontalRT.dispose(),this._verticalRT.dispose()}_getCoefficients(e){const i=[];for(let s=0;s<e;s++)i.push(.39894*Math.exp(-.5*s*s/(e*e))/e);return i}}const ybe=(n,e,i)=>ge(new Zj(_a(n),e,i)),eX=new Q,Wj=new fd;class Hj extends Ti{static get type(){return"AfterImageNode"}constructor(e,i=.96){super(e),this.textureNode=e,this.textureNodeOld=zi(),this.damp=tt(i),this._compRT=new br,this._compRT.texture.name="AfterImageNode.comp",this._oldRT=new br,this._oldRT.texture.name="AfterImageNode.old",this._textureNode=Yy(this,this._compRT.texture),this.updateBeforeType=Ht.RENDER}getTextureNode(){return this._textureNode}setSize(e,i){this._compRT.setSize(e,i),this._oldRT.setSize(e,i)}updateBefore(e){const{renderer:i}=e,s=this.textureNode,r=s.value.type;this._compRT.texture.type=r,this._oldRT.texture.type=r,i.getDrawingBufferSize(eX),this.setSize(eX.x,eX.y);const o=i.getRenderTarget(),a=s.value;this.textureNodeOld.value=this._oldRT.texture,i.setRenderTarget(this._compRT),Wj.render(i);const l=this._oldRT;this._oldRT=this._compRT,this._compRT=l,i.setRenderTarget(o),s.value=a}setup(e){const i=this.textureNode,s=this.textureNodeOld,r=i.uvNode||yi();s.uvNode=r;const o=d=>i.uv(d),a=ie(([d,u])=>{const p=D(u).toVar(),g=Qe(d).toVar();return Li(z1(g.sub(p)),0)}),l=ie(()=>{const d=Qe(s),u=Qe(o(r));return d.mulAssign(this.damp.mul(a(d,.1))),Li(u,d)}),c=this._materialComposed||(this._materialComposed=new Yi);c.name="AfterImage",c.fragmentNode=l(),Wj.material=c;const h=e.getNodeProperties(this);return h.textureNode=i,this._textureNode}dispose(){this._compRT.dispose(),this._oldRT.dispose()}}const bbe=(n,e)=>ge(new Hj(_a(n),e)),vbe=ie(([n])=>bo(n.rgb)),xbe=ie(([n,e=D(1)])=>e.mix(bo(n.rgb),n.rgb)),wbe=ie(([n,e=D(1)])=>{const i=Hn(n.r,n.g,n.b).div(3),s=n.r.max(n.g.max(n.b)),r=s.sub(i).mul(e).mul(-3);return Ai(n.rgb,s,r)}),Cbe=ie(([n,e=D(1)])=>{const i=j(.57735,.57735,.57735),s=e.cos();return j(n.rgb.mul(s).add(i.cross(n.rgb).mul(e.sin()).add(i.mul(As(i,n.rgb).mul(s.oneMinus())))))}),Sbe=new E,bo=(n,e=j(...hi.getLuminanceCoefficients(Sbe)))=>As(n,e),Qj=(n,e)=>Ai(j(0),n,bo(n).sub(e).max(0)),Kj=new fd;class Yj extends Ti{static get type(){return"AnamorphicNode"}constructor(e,i,s,r){super("vec4"),this.textureNode=e,this.tresholdNode=i,this.scaleNode=s,this.colorNode=j(.1,0,1),this.samples=r,this.resolution=new Q(1,1),this._renderTarget=new br,this._renderTarget.texture.name="anamorphic",this._invSize=tt(new Q),this._textureNode=Yy(this,this._renderTarget.texture),this.updateBeforeType=Ht.RENDER}getTextureNode(){return this._textureNode}setSize(e,i){this._invSize.value.set(1/e,1/i),e=Math.max(Math.round(e*this.resolution.x),1),i=Math.max(Math.round(i*this.resolution.y),1),this._renderTarget.setSize(e,i)}updateBefore(e){const{renderer:i}=e,s=this.textureNode,r=s.value;this._renderTarget.texture.type=r.type;const o=i.getRenderTarget(),a=s.value;Kj.material=this._material,this.setSize(r.image.width,r.image.height),i.setRenderTarget(this._renderTarget),Kj.render(i),i.setRenderTarget(o),s.value=a}setup(e){const i=this.textureNode,s=i.uvNode||yi(),r=c=>i.uv(c),o=ie(()=>{const c=this.samples,h=Math.floor(c/2),d=j(0).toVar();return Bi({start:-h,end:h},({i:u})=>{const p=D(u).abs().div(h).oneMinus(),g=ae(s.x.add(this._invSize.x.mul(u).mul(this.scaleNode)),s.y),f=r(g),A=Qj(f,this.tresholdNode).mul(p);d.addAssign(A)}),d.mul(this.colorNode)}),a=this._material||(this._material=new Yi);a.name="Anamorphic",a.fragmentNode=o();const l=e.getNodeProperties(this);return l.textureNode=i,this._textureNode}dispose(){this._renderTarget.dispose()}}const _be=(n,e=.9,i=3,s=32)=>ge(new Yj(_a(n),ge(e),ge(i),s));class jj extends Ti{static get type(){return"SobelOperatorNode"}constructor(e){super(),this.textureNode=e,this.updateBeforeType=Ht.RENDER,this._invSize=tt(new Q)}updateBefore(){const e=this.textureNode.value;this._invSize.value.set(1/e.image.width,1/e.image.height)}setup(){const{textureNode:e}=this,i=e.uvNode||yi(),s=r=>e.uv(r);return ie(()=>{const r=this._invSize,o=Nr(-1,-2,-1,0,0,0,1,2,1),a=Nr(-1,0,1,-2,0,2,-1,0,1),l=bo(s(i.add(r.mul(ae(-1,-1)))).xyz),c=bo(s(i.add(r.mul(ae(-1,0)))).xyz),h=bo(s(i.add(r.mul(ae(-1,1)))).xyz),d=bo(s(i.add(r.mul(ae(0,-1)))).xyz),u=bo(s(i.add(r.mul(ae(0,0)))).xyz),p=bo(s(i.add(r.mul(ae(0,1)))).xyz),g=bo(s(i.add(r.mul(ae(1,-1)))).xyz),f=bo(s(i.add(r.mul(ae(1,0)))).xyz),A=bo(s(i.add(r.mul(ae(1,1)))).xyz),y=Hn(o[0][0].mul(l),o[1][0].mul(d),o[2][0].mul(g),o[0][1].mul(c),o[1][1].mul(u),o[2][1].mul(f),o[0][2].mul(h),o[1][2].mul(p),o[2][2].mul(A)),b=Hn(a[0][0].mul(l),a[1][0].mul(d),a[2][0].mul(g),a[0][1].mul(c),a[1][1].mul(u),a[2][1].mul(f),a[0][2].mul(h),a[1][2].mul(p),a[2][2].mul(A)),v=y.mul(y).add(b.mul(b)).sqrt();return Qe(j(v),1)})()}}const Mbe=n=>ge(new jj(_a(n)));class Jj extends Ti{static get type(){return"DepthOfFieldNode"}constructor(e,i,s,r,o){super(),this.textureNode=e,this.viewZNode=i,this.focusNode=s,this.apertureNode=r,this.maxblurNode=o,this._aspect=tt(0),this.updateBeforeType=Ht.RENDER}updateBefore(){const e=this.textureNode.value;this._aspect.value=e.image.width/e.image.height}setup(){const e=this.textureNode,i=e.uvNode||yi(),s=r=>e.uv(r);return ie(()=>{const r=ae(1,this._aspect),o=this.focusNode.add(this.viewZNode),a=ae(rr(o.mul(this.apertureNode),this.maxblurNode.negate(),this.maxblurNode)),l=a.mul(.9),c=a.mul(.7),h=a.mul(.4);let d=Qe(0);return d=d.add(s(i)),d=d.add(s(i.add(ae(0,.4).mul(r).mul(a)))),d=d.add(s(i.add(ae(.15,.37).mul(r).mul(a)))),d=d.add(s(i.add(ae(.29,.29).mul(r).mul(a)))),d=d.add(s(i.add(ae(-.37,.15).mul(r).mul(a)))),d=d.add(s(i.add(ae(.4,0).mul(r).mul(a)))),d=d.add(s(i.add(ae(.37,-.15).mul(r).mul(a)))),d=d.add(s(i.add(ae(.29,-.29).mul(r).mul(a)))),d=d.add(s(i.add(ae(-.15,-.37).mul(r).mul(a)))),d=d.add(s(i.add(ae(0,-.4).mul(r).mul(a)))),d=d.add(s(i.add(ae(-.15,.37).mul(r).mul(a)))),d=d.add(s(i.add(ae(-.29,.29).mul(r).mul(a)))),d=d.add(s(i.add(ae(.37,.15).mul(r).mul(a)))),d=d.add(s(i.add(ae(-.4,0).mul(r).mul(a)))),d=d.add(s(i.add(ae(-.37,-.15).mul(r).mul(a)))),d=d.add(s(i.add(ae(-.29,-.29).mul(r).mul(a)))),d=d.add(s(i.add(ae(.15,-.37).mul(r).mul(a)))),d=d.add(s(i.add(ae(.15,.37).mul(r).mul(l)))),d=d.add(s(i.add(ae(-.37,.15).mul(r).mul(l)))),d=d.add(s(i.add(ae(.37,-.15).mul(r).mul(l)))),d=d.add(s(i.add(ae(-.15,-.37).mul(r).mul(l)))),d=d.add(s(i.add(ae(-.15,.37).mul(r).mul(l)))),d=d.add(s(i.add(ae(.37,.15).mul(r).mul(l)))),d=d.add(s(i.add(ae(-.37,-.15).mul(r).mul(l)))),d=d.add(s(i.add(ae(.15,-.37).mul(r).mul(l)))),d=d.add(s(i.add(ae(.29,.29).mul(r).mul(c)))),d=d.add(s(i.add(ae(.4,0).mul(r).mul(c)))),d=d.add(s(i.add(ae(.29,-.29).mul(r).mul(c)))),d=d.add(s(i.add(ae(0,-.4).mul(r).mul(c)))),d=d.add(s(i.add(ae(-.29,.29).mul(r).mul(c)))),d=d.add(s(i.add(ae(-.4,0).mul(r).mul(c)))),d=d.add(s(i.add(ae(-.29,-.29).mul(r).mul(c)))),d=d.add(s(i.add(ae(0,.4).mul(r).mul(c)))),d=d.add(s(i.add(ae(.29,.29).mul(r).mul(h)))),d=d.add(s(i.add(ae(.4,0).mul(r).mul(h)))),d=d.add(s(i.add(ae(.29,-.29).mul(r).mul(h)))),d=d.add(s(i.add(ae(0,-.4).mul(r).mul(h)))),d=d.add(s(i.add(ae(-.29,.29).mul(r).mul(h)))),d=d.add(s(i.add(ae(-.4,0).mul(r).mul(h)))),d=d.add(s(i.add(ae(-.29,-.29).mul(r).mul(h)))),d=d.add(s(i.add(ae(0,.4).mul(r).mul(h)))),d=d.div(41),d.a=1,Qe(d)})()}}const Ibe=(n,e,i=1,s=.025,r=1)=>ge(new Jj(_a(n),ge(e),ge(i),ge(s),ge(r)));class qj extends Ti{static get type(){return"DotScreenNode"}constructor(e,i=new Q(.5,.5),s=1.57,r=1){super("vec4"),this.inputNode=e,this.center=tt(i),this.angle=tt(s),this.scale=tt(r)}setup(){const e=this.inputNode,i=ie(()=>{const s=po(this.angle),r=_l(this.angle),o=yi().mul(Uy).sub(this.center),a=ae(r.mul(o.x).sub(s.mul(o.y)),s.mul(o.x).add(r.mul(o.y))).mul(this.scale);return po(a.x).mul(po(a.y)).mul(4)});return ie(()=>{const s=e,r=Hn(s.r,s.g,s.b).div(3);return Qe(j(r.mul(10).sub(5).add(i())),s.a)})()}}const Tbe=(n,e,i,s)=>ge(new qj(ge(n),e,i,s));class $j extends Ti{static get type(){return"RGBShiftNode"}constructor(e,i=.005,s=0){super("vec4"),this.textureNode=e,this.amount=tt(i),this.angle=tt(s)}setup(){const{textureNode:e}=this,i=e.uvNode||yi(),s=r=>e.uv(r);return ie(()=>{const r=ae(_l(this.angle),po(this.angle)).mul(this.amount),o=s(i.add(r)),a=s(i),l=s(i.sub(r));return Qe(o.r,a.g,l.b,a.a)})()}}const Ebe=(n,e,i)=>ge(new $j(_a(n),e,i));class eJ extends Ti{static get type(){return"FilmNode"}constructor(e,i=null,s=null){super(),this.inputNode=e,this.intensityNode=i,this.uvNode=s}setup(){const e=this.uvNode||yi();return ie(()=>{const i=this.inputNode.rgb,s=zN(bm(e.add(QV())));let r=i.add(i.mul(rr(s.add(.1),0,1)));return this.intensityNode!==null&&(r=Ai(i,r,this.intensityNode)),Qe(r,this.inputNode.a)})()}}const Rbe=Ce(eJ);class tJ extends Ti{static get type(){return"Lut3DNode"}constructor(e,i,s,r){super(),this.inputNode=e,this.lutNode=i,this.size=tt(s),this.intensityNode=r}setup(){const{inputNode:e,lutNode:i}=this,s=r=>i.uv(r);return ie(()=>{const r=e,o=D(1).div(this.size),a=D(.5).div(this.size),l=j(a).add(r.rgb.mul(D(1).sub(o))),c=Qe(s(l).rgb,r.a);return Qe(Ai(r,c,this.intensityNode))})()}}const Lbe=(n,e,i,s)=>ge(new tJ(ge(n),ge(e),i,ge(s))),iJ=new fd,nJ=new fe,Bbe=new Q;class sJ extends Ti{static get type(){return"GTAONode"}constructor(e,i,s){super(),this.depthNode=e,this.normalNode=i,this.radius=tt(.25),this.resolution=tt(new Q),this.thickness=tt(1),this.distanceExponent=tt(1),this.distanceFallOff=tt(1),this.scale=tt(1),this.noiseNode=zi(kbe()),this.cameraProjectionMatrix=tt(s.projectionMatrix),this.cameraProjectionMatrixInverse=tt(s.projectionMatrixInverse),this.SAMPLES=tt(16),this._aoRenderTarget=new br,this._aoRenderTarget.texture.name="GTAONode.AO",this._material=null,this._textureNode=Yy(this,this._aoRenderTarget.texture),this.updateBeforeType=Ht.FRAME}getTextureNode(){return this._textureNode}setSize(e,i){this.resolution.value.set(e,i),this._aoRenderTarget.setSize(e,i)}updateBefore(e){const{renderer:i}=e,s=i.getDrawingBufferSize(Bbe),r=i.getRenderTarget(),o=i.getMRT();i.getClearColor(nJ);const a=i.getClearAlpha();iJ.material=this._material,this.setSize(s.width,s.height),i.setMRT(null),i.setClearColor(16777215,1),i.setRenderTarget(this._aoRenderTarget),iJ.render(i),i.setRenderTarget(r),i.setMRT(o),i.setClearColor(nJ,a)}setup(e){const i=yi(),s=h=>this.depthNode.uv(h).x,r=h=>this.noiseNode.uv(h),o=ie(([h])=>{const d=this.cameraProjectionMatrix.mul(Qe(h,1));let u=d.xy.div(d.w).mul(.5).add(.5).toVar();u=ae(u.x,u.y.oneMinus());const p=s(u);return j(u,p)}),a=ie(([h,d])=>{h=ae(h.x,h.y.oneMinus()).mul(2).sub(1);const u=Qe(j(h,d),1),p=Qe(this.cameraProjectionMatrixInverse.mul(u));return p.xyz.div(p.w)}),l=ie(()=>{const h=s(i);h.greaterThanEqual(1).discard();const d=a(i,h),u=this.normalNode.rgb.normalize(),p=this.radius,g=xm(this.noiseNode,0);let f=ae(i.x,i.y.oneMinus());f=f.mul(this.resolution.div(g));const A=r(f),y=A.xyz.mul(2).sub(1),b=j(y.xy,0).normalize(),v=j(b.y.mul(-1),b.x,0),x=Nr(b,v,j(0,0,1)),w=this.SAMPLES.lessThan(30).select(3,5),C=Hn(this.SAMPLES,w.sub(1)).div(w),S=D(0).toVar();return Bi({start:K(0),end:w,type:"int",condition:"<"},({i:_})=>{const I=D(_).div(D(w)).mul(Wf),B=Qe(_l(I),po(I),0,Hn(.5,wi(.5,A.w)));B.xyz=Sl(x.mul(B.xyz));const M=Sl(d.xyz.negate()),R=Sl(Ny(B.xyz,M)),k=Ny(R,M),G=Sl(u.sub(R.mul(As(u,R)))),X=Ny(G,R),F=ae(As(M,X),As(M,X.negate())).toVar();Bi({end:C,type:"int",name:"j",condition:"<"},({j:Ye})=>{const je=B.xyz.mul(p).mul(B.w).mul(Ca(uh(D(Ye).add(1),D(C)),this.distanceExponent)),le=o(d.add(je)),ve=a(le.xy,le.z).sub(d);Gt(Sn(ve.z).lessThan(this.thickness),()=>{const _t=As(M,Sl(ve));F.x.addAssign(Li(0,wi(_t.sub(F.x),Ai(1,D(2).div(D(Ye).add(2)),this.distanceFallOff))))});const Pe=o(d.sub(je)),ke=a(Pe.xy,Pe.z).sub(d);Gt(Sn(ke.z).lessThan(this.thickness),()=>{const _t=As(M,Sl(ke));F.y.addAssign(Li(0,wi(_t.sub(F.y),Ai(1,D(2).div(D(Ye).add(2)),this.distanceFallOff))))})});const z=ph(Ln(1,F.mul(F))),H=As(G,k),Z=As(G,M),he=wi(.5,zT(F.y).sub(zT(F.x)).add(z.x.mul(F.x).sub(z.y.mul(F.y)))),be=wi(.5,Ln(2,F.x.mul(F.x)).sub(F.y.mul(F.y))),_e=H.mul(he).add(Z.mul(be));S.addAssign(_e)}),S.assign(rr(S.div(w),0,1)),S.assign(Ca(S,this.scale)),Qe(j(S),1)}),c=this._material||(this._material=new Yi);return c.fragmentNode=l().context(e.getSharedContext()),c.name="GTAO",c.needsUpdate=!0,this._textureNode}dispose(){this._aoRenderTarget.dispose()}}function kbe(n=5){const e=Math.floor(n)%2===0?Math.floor(n)+1:Math.floor(n),i=Gbe(e),s=i.length,r=new Uint8Array(s*4);for(let a=0;a<s;++a){const l=i[a],c=2*Math.PI*l/s,h=new E(Math.cos(c),Math.sin(c),0).normalize();r[a*4]=(h.x*.5+.5)*255,r[a*4+1]=(h.y*.5+.5)*255,r[a*4+2]=127,r[a*4+3]=255}const o=new nr(r,e,e);return o.wrapS=lo,o.wrapT=lo,o.needsUpdate=!0,o}function Gbe(n){const e=Math.floor(n)%2===0?Math.floor(n)+1:Math.floor(n),i=e*e,s=Array(i).fill(0);let r=Math.floor(e/2),o=e-1;for(let a=1;a<=i;){if(r===-1&&o===e?(o=e-2,r=0):(o===e&&(o=0),r<0&&(r=e-1)),s[r*e+o]!==0){o-=2,r++;continue}else s[r*e+o]=a++;o++,r--}return s}const Pbe=(n,e,i)=>ge(new sJ(ge(n),ge(e),i));class rJ extends Ti{static get type(){return"DenoiseNode"}constructor(e,i,s,r,o){super(),this.textureNode=e,this.depthNode=i,this.normalNode=s,this.noiseNode=r,this.cameraProjectionMatrixInverse=tt(o.projectionMatrixInverse),this.lumaPhi=tt(5),this.depthPhi=tt(5),this.normalPhi=tt(5),this.radius=tt(5),this.index=tt(0),this._resolution=tt(new Q),this._sampleVectors=gd(Nbe(16,2,1)),this.updateBeforeType=Ht.RENDER}updateBefore(){const e=this.textureNode.value;this._resolution.value.set(e.image.width,e.image.height)}setup(){const e=yi(),i=h=>this.textureNode.uv(h),s=h=>this.depthNode.uv(h).x,r=h=>this.normalNode.uv(h),o=h=>this.noiseNode.uv(h),a=ie(([h,d])=>{h=ae(h.x,h.y.oneMinus()).mul(2).sub(1);const u=Qe(j(h,d),1),p=Qe(this.cameraProjectionMatrixInverse.mul(u));return p.xyz.div(p.w)}),l=ie(([h,d,u,p])=>{const g=i(p),f=s(p),A=r(p).rgb.normalize(),y=g.rgb,b=a(p,f),v=As(d,A).toVar(),x=Ca(Li(v,0),this.normalPhi).toVar(),w=Sn(bo(y).sub(bo(h))).toVar(),C=Li(D(1).sub(w.div(this.lumaPhi)),0).toVar(),S=Sn(As(u.sub(b),d)).toVar(),_=Li(D(1).sub(S.div(this.depthPhi)),0),I=C.mul(_).mul(x);return Qe(y.mul(I),I)}),c=ie(([h])=>{const d=s(h),u=r(h).rgb.normalize(),p=i(h);Gt(d.greaterThanEqual(1).or(As(u,u).equal(0)),()=>p);const g=j(p.rgb),f=a(h,d),A=xm(this.noiseNode,0);let y=ae(h.x,h.y.oneMinus());y=y.mul(this._resolution.div(A));const b=o(y),v=po(b.element(this.index.mod(4).mul(2).mul(Wf))),x=_l(b.element(this.index.mod(4).mul(2).mul(Wf))),w=ae(v,x),C=B1(w.x,w.y.negate(),w.x,w.y),S=D(1).toVar(),_=j(p.rgb).toVar();return Bi({start:K(0),end:K(16),type:"int",condition:"<"},({i:I})=>{const B=this._sampleVectors.element(I).toVar(),M=C.mul(B.xy.mul(D(1).add(B.z.mul(this.radius.sub(1))))).div(this._resolution).toVar(),R=h.add(M).toVar(),k=l(g,u,f,R);_.addAssign(k.xyz),S.addAssign(k.w)}),Gt(S.greaterThan(D(0)),()=>{_.divAssign(S)}),Qe(_,p.a)}).setLayout({name:"denoise",type:"vec4",inputs:[{name:"uv",type:"vec2"}]});return ie(()=>c(e))()}}function Nbe(n,e,i){const s=Vbe(n,e,i),r=[];for(let o=0;o<n;o++){const a=s[o];r.push(a)}return r}function Vbe(n,e,i){const s=[];for(let r=0;r<n;r++){const o=2*Math.PI*e*r/n,a=Math.pow(r/(n-1),i);s.push(new E(Math.cos(o),Math.sin(o),a))}return s}const Xbe=(n,e,i,s,r)=>ge(new rJ(_a(n),ge(e),ge(i),ge(s),r));class oJ extends Ti{static get type(){return"FXAANode"}constructor(e){super(),this.textureNode=e,this.updateBeforeType=Ht.RENDER,this._invSize=tt(new Q)}updateBefore(){const e=this.textureNode.value;this._invSize.value.set(1/e.image.width,1/e.image.height)}setup(){const e=this.textureNode.bias(-100),i=e.uvNode||yi(),s=c=>e.uv(c),r=(c,h,d)=>e.uv(c.add(h.mul(d))),o=K(5),a=ie(([c,h])=>{const d=Qe(h).toVar(),u=Qe(c).toVar(),p=Qe(Sn(u.sub(d))).toVar();return Li(Li(Li(p.r,p.g),p.b),p.a)}),l=ie(([c,h,d,u])=>{const p=s(c).toVar(),g=r(c,ae(0,-1),h.xy).toVar(),f=r(c,ae(1,0),h.xy).toVar(),A=r(c,ae(0,1),h.xy).toVar(),y=r(c,ae(-1,0),h.xy).toVar(),b=a(p,A).toVar(),v=a(p,g).toVar(),x=a(p,f).toVar(),w=a(p,y).toVar(),C=Li(b,Li(v,Li(x,w))).toVar();Gt(C.lessThan(d),()=>p);const S=Ln(b.add(v),x.add(w)).toVar();S.mulAssign(u),Gt(Sn(S).lessThan(.3),()=>{const _e=x.greaterThan(w).select(1,-1).toVar(),Ye=v.greaterThan(b).select(1,-1).toVar(),je=ae(_e,Ye).toVar(),le=r(c,ae(je.x,je.y),h.xy),ve=a(p,le).toVar(),Pe=r(c,ae(je.x.negate(),je.y.negate()),h.xy),ke=a(p,Pe).toVar();S.assign(ke.sub(ve)),S.mulAssign(u),Gt(Sn(S).lessThan(.3),()=>{const _t=A.add(g).add(f).add(y);return Ai(p,_t.mul(.25),.4)})});const _=ae().toVar();Gt(S.lessThanEqual(0),()=>{A.assign(y),g.assign(f),_.x.assign(0),_.y.assign(h.y)}).Else(()=>{_.x.assign(h.x),_.y.assign(0)});const I=a(p,A).toVar(),B=a(p,g).toVar();Gt(I.lessThanEqual(B),()=>{A.assign(g)});const M=K(0).toVar(),R=K(0).toVar(),k=D(0).toVar(),G=D(0).toVar(),X=ae(c).toVar(),F=ae(c).toVar(),z=K(0).toVar(),H=K(0).toVar();Bi(o,({i:_e})=>{const Ye=_e.add(1).toVar();Gt(M.equal(0),()=>{k.addAssign(Ye),X.assign(c.add(_.mul(k)));const je=s(X.xy),le=a(je,p).toVar(),ve=a(je,A).toVar();Gt(le.greaterThan(ve),()=>{M.assign(1)}),z.assign(_e)}),Gt(R.equal(0),()=>{G.addAssign(Ye),F.assign(c.sub(_.mul(G)));const je=s(F.xy),le=a(je,p).toVar(),ve=a(je,A).toVar();Gt(le.greaterThan(ve),()=>{R.assign(1)}),H.assign(_e)}),Gt(M.equal(1).or(R.equal(1)),()=>{tE()})}),Gt(M.equal(0).and(R.equal(0)),()=>p);const Z=D(1).toVar(),he=D(1).toVar();Gt(M.equal(1),()=>{Z.assign(D(z).div(D(o.sub(1))))}),Gt(R.equal(1),()=>{he.assign(D(H).div(D(o.sub(1))))});const be=Vr(Z,he);return be.assign(Ca(be,.5)),be.assign(D(1).sub(be)),Ai(p,A,be.mul(.5))}).setLayout({name:"FxaaPixelShader",type:"vec4",inputs:[{name:"uv",type:"vec2"},{name:"fxaaQualityRcpFrame",type:"vec2"},{name:"fxaaQualityEdgeThreshold",type:"float"},{name:"fxaaQualityinvEdgeThreshold",type:"float"}]});return ie(()=>{const c=D(.2),h=D(1).div(c);return l(i,this._invSize,c,h)})()}}const Dbe=n=>ge(new oJ(_a(n))),e0=new fd,zbe=new fe(0,0,0),aJ=new fe,Fbe=new Q,Ube=new Q(1,0),Obe=new Q(0,1);class lJ extends Ti{static get type(){return"BloomNode"}constructor(e,i=1,s=0,r=0){super(),this.inputNode=e,this.strength=tt(i),this.radius=tt(s),this.threshold=tt(r),this.smoothWidth=tt(.01),this._renderTargetsHorizontal=[],this._renderTargetsVertical=[],this._nMips=5,this._renderTargetBright=new br(1,1,{type:Ki}),this._renderTargetBright.texture.name="UnrealBloomPass.bright",this._renderTargetBright.texture.generateMipmaps=!1;for(let o=0;o<this._nMips;o++){const a=new br(1,1,{type:Ki});a.texture.name="UnrealBloomPass.h"+o,a.texture.generateMipmaps=!1,this._renderTargetsHorizontal.push(a);const l=new br(1,1,{type:Ki});l.texture.name="UnrealBloomPass.v"+o,l.texture.generateMipmaps=!1,this._renderTargetsVertical.push(l)}this._compositeMaterial=null,this._highPassFilterMaterial=null,this._separableBlurMaterials=[],this._textureNodeBright=zi(this._renderTargetBright.texture),this._textureNodeBlur0=zi(this._renderTargetsVertical[0].texture),this._textureNodeBlur1=zi(this._renderTargetsVertical[1].texture),this._textureNodeBlur2=zi(this._renderTargetsVertical[2].texture),this._textureNodeBlur3=zi(this._renderTargetsVertical[3].texture),this._textureNodeBlur4=zi(this._renderTargetsVertical[4].texture),this._textureOutput=Yy(this,this._renderTargetsHorizontal[0].texture),this.updateBeforeType=Ht.FRAME}getTextureNode(){return this._textureOutput}setSize(e,i){let s=Math.round(e/2),r=Math.round(i/2);this._renderTargetBright.setSize(s,r);for(let o=0;o<this._nMips;o++)this._renderTargetsHorizontal[o].setSize(s,r),this._renderTargetsVertical[o].setSize(s,r),this._separableBlurMaterials[o].invSize.value.set(1/s,1/r),s=Math.round(s/2),r=Math.round(r/2)}updateBefore(e){const{renderer:i}=e,s=i.getDrawingBufferSize(Fbe);this.setSize(s.width,s.height);const r=i.getRenderTarget(),o=i.getMRT();i.getClearColor(aJ);const a=i.getClearAlpha();this.setSize(s.width,s.height),i.setMRT(null),i.setClearColor(zbe,0),i.setRenderTarget(this._renderTargetBright),e0.material=this._highPassFilterMaterial,e0.render(i);let l=this._renderTargetBright;for(let c=0;c<this._nMips;c++)e0.material=this._separableBlurMaterials[c],this._separableBlurMaterials[c].colorTexture.value=l.texture,this._separableBlurMaterials[c].direction.value=Ube,i.setRenderTarget(this._renderTargetsHorizontal[c]),i.clear(),e0.render(i),this._separableBlurMaterials[c].colorTexture.value=this._renderTargetsHorizontal[c].texture,this._separableBlurMaterials[c].direction.value=Obe,i.setRenderTarget(this._renderTargetsVertical[c]),i.clear(),e0.render(i),l=this._renderTargetsVertical[c];i.setRenderTarget(this._renderTargetsHorizontal[0]),i.clear(),e0.material=this._compositeMaterial,e0.render(i),i.setRenderTarget(r),i.setMRT(o),i.setClearColor(aJ,a)}setup(e){const i=ie(()=>{const c=this.inputNode,h=bo(c.rgb),d=Sa(this.threshold,this.threshold.add(this.smoothWidth),h);return Ai(Qe(0),c,d)});this._highPassFilterMaterial=this._highPassFilterMaterial||new Yi,this._highPassFilterMaterial.fragmentNode=i().context(e.getSharedContext()),this._highPassFilterMaterial.name="Bloom_highPass",this._highPassFilterMaterial.needsUpdate=!0;const s=[3,5,7,9,11];for(let c=0;c<this._nMips;c++)this._separableBlurMaterials.push(this._getSeperableBlurMaterial(e,s[c]));const r=gd([1,.8,.6,.4,.2]),o=gd([new E(1,1,1),new E(1,1,1),new E(1,1,1),new E(1,1,1),new E(1,1,1)]),a=ie(([c,h])=>{const d=D(1.2).sub(c);return Ai(c,d,h)}).setLayout({name:"lerpBloomFactor",type:"float",inputs:[{name:"factor",type:"float"},{name:"radius",type:"float"}]}),l=ie(()=>{const c=a(r.element(0),this.radius).mul(Qe(o.element(0),1)).mul(this._textureNodeBlur0),h=a(r.element(1),this.radius).mul(Qe(o.element(1),1)).mul(this._textureNodeBlur1),d=a(r.element(2),this.radius).mul(Qe(o.element(2),1)).mul(this._textureNodeBlur2),u=a(r.element(3),this.radius).mul(Qe(o.element(3),1)).mul(this._textureNodeBlur3),p=a(r.element(4),this.radius).mul(Qe(o.element(4),1)).mul(this._textureNodeBlur4);return c.add(h).add(d).add(u).add(p).mul(this.strength)});return this._compositeMaterial=this._compositeMaterial||new Yi,this._compositeMaterial.fragmentNode=l().context(e.getSharedContext()),this._compositeMaterial.name="Bloom_comp",this._compositeMaterial.needsUpdate=!0,this._textureOutput}dispose(){for(let e=0;e<this._renderTargetsHorizontal.length;e++)this._renderTargetsHorizontal[e].dispose();for(let e=0;e<this._renderTargetsVertical.length;e++)this._renderTargetsVertical[e].dispose();this._renderTargetBright.dispose()}_getSeperableBlurMaterial(e,i){const s=[];for(let p=0;p<i;p++)s.push(.39894*Math.exp(-.5*p*p/(i*i))/i);const r=zi(),o=gd(s),a=tt(new Q),l=tt(new Q(.5,.5)),c=yi(),h=p=>r.uv(p),d=ie(()=>{const p=o.element(0).toVar(),g=h(c).rgb.mul(p).toVar();return Bi({start:K(1),end:K(i),type:"int",condition:"<"},({i:f})=>{const A=D(f),y=o.element(f),b=l.mul(a).mul(A),v=h(c.add(b)).rgb,x=h(c.sub(b)).rgb;g.addAssign(Hn(v,x).mul(y)),p.addAssign(D(2).mul(y))}),Qe(g.div(p),1)}),u=new Yi;return u.fragmentNode=d().context(e.getSharedContext()),u.name="Bloom_seperable",u.needsUpdate=!0,u.colorTexture=r,u.direction=l,u.invSize=a,u}}const Zbe=(n,e,i,s)=>ge(new lJ(ge(n),e,i,s));class cJ extends Ti{static get type(){return"TransitionNode"}constructor(e,i,s,r,o,a){super(),this.textureNodeA=e,this.textureNodeB=i,this.mixTextureNode=s,this.mixRatioNode=r,this.thresholdNode=o,this.useTextureNode=a}setup(){const{textureNodeA:e,textureNodeB:i,mixTextureNode:s,mixRatioNode:r,thresholdNode:o,useTextureNode:a}=this,l=c=>{const h=c.uvNode||yi();return c.uv(h)};return ie(()=>{const c=l(e),h=l(i),d=Qe().toVar();return Gt(a.equal(K(1)),()=>{const u=l(s),p=r.mul(o.mul(2).add(1)).sub(o),g=rr(Ln(u.r,p).mul(D(1).div(o)),0,1);d.assign(Ai(c,h,g))}).Else(()=>{d.assign(Ai(h,c,r))}),d})()}}const Wbe=(n,e,i,s=0,r=.1,o=0)=>ge(new cJ(_a(n),_a(e),_a(i),ge(s),ge(r),ge(o)));class Hbe extends Ti{static get type(){return"PixelationNode"}constructor(e,i,s,r,o,a){super(),this.textureNode=e,this.depthNode=i,this.normalNode=s,this.pixelSize=r,this.normalEdgeStrength=o,this.depthEdgeStrength=a,this._resolution=tt(new $e),this.updateBeforeType=Ht.RENDER}updateBefore(){const e=this.textureNode.value,i=e.image.width,s=e.image.height;this._resolution.value.set(i,s,1/i,1/s)}setup(){const{textureNode:e,depthNode:i,normalNode:s}=this,r=e.uvNode||yi(),o=i.uvNode||yi(),a=s.uvNode||yi(),l=()=>e.uv(r),c=(g,f)=>i.uv(o.add(ae(g,f).mul(this._resolution.zw))).r,h=(g,f)=>s.uv(a.add(ae(g,f).mul(this._resolution.zw))).rgb.normalize(),d=g=>{const f=ja("float","diff");return f.addAssign(rr(c(1,0).sub(g))),f.addAssign(rr(c(-1,0).sub(g))),f.addAssign(rr(c(0,1).sub(g))),f.addAssign(rr(c(0,-1).sub(g))),ym(Sa(.01,.02,f).mul(2)).div(2)},u=(g,f,A,y)=>{const b=c(g,f).sub(A),v=h(g,f),x=j(1,1,1),w=As(y.sub(v),x),C=rr(Sa(-.01,.01,w),0,1),S=rr(z1(b.mul(.25).add(.0025)),0,1);return D(1).sub(As(y,v)).mul(S).mul(C)},p=(g,f)=>{const A=ja("float","indicator");return A.addAssign(u(0,-1,g,f)),A.addAssign(u(0,1,g,f)),A.addAssign(u(-1,0,g,f)),A.addAssign(u(1,0,g,f)),F1(.1,A)};return ie(()=>{const g=l(),f=ja("float","depth"),A=ja("vec3","normal");Gt(this.depthEdgeStrength.greaterThan(0).or(this.normalEdgeStrength.greaterThan(0)),()=>{f.assign(c(0,0)),A.assign(h(0,0))});const y=ja("float","dei");Gt(this.depthEdgeStrength.greaterThan(0),()=>{y.assign(d(f))});const b=ja("float","nei");Gt(this.normalEdgeStrength.greaterThan(0),()=>{b.assign(p(f,A))});const v=y.greaterThan(0).select(D(1).sub(y.mul(this.depthEdgeStrength)),b.mul(this.normalEdgeStrength).add(1));return g.mul(v)})()}}const Qbe=(n,e,i,s=6,r=.3,o=.4)=>ge(new Hbe(_a(n),_a(e),_a(i),ge(s),ge(r),ge(o)));class hJ extends so{static get type(){return"PixelationPassNode"}constructor(e,i,s=6,r=.3,o=.4){super("color",e,i,{minFilter:si,magFilter:si}),this.pixelSize=s,this.normalEdgeStrength=r,this.depthEdgeStrength=o,this.isPixelationPassNode=!0,this._mrt=fE({output:_N,normal:Ml})}setSize(e,i){const s=this.pixelSize.value?this.pixelSize.value:this.pixelSize,r=Math.floor(e/s),o=Math.floor(i/s);super.setSize(r,o)}setup(){const e=super.getTextureNode("output"),i=super.getTextureNode("depth"),s=super.getTextureNode("normal");return Qbe(e,i,s,this.pixelSize,this.normalEdgeStrength,this.depthEdgeStrength)}}const Kbe=(n,e,i,s,r)=>ge(new hJ(n,e,i,s,r)),Ybe=new Q;class dJ extends so{static get type(){return"SSAAPassNode"}constructor(e,i){super(so.COLOR,e,i),this.isSSAAPassNode=!0,this.sampleLevel=4,this.unbiased=!0,this.clearColor=new fe(0),this.clearAlpha=0,this._currentClearColor=new fe,this.sampleWeight=tt(1),this.sampleRenderTarget=null,this._quadMesh=new fd}updateBefore(e){const{renderer:i}=e,{scene:s,camera:r}=this;this._pixelRatio=i.getPixelRatio();const o=i.getSize(Ybe);this.setSize(o.width,o.height),this.sampleRenderTarget.setSize(this.renderTarget.width,this.renderTarget.height),i.getClearColor(this._currentClearColor);const a=i.getClearAlpha(),l=i.getRenderTarget(),c=i.getMRT(),h=i.autoClear;this._cameraNear.value=r.near,this._cameraFar.value=r.far,i.setMRT(this.getMRT()),i.autoClear=!1;const d=jbe[Math.max(0,Math.min(this.sampleLevel,5))],u=1/d.length,p=1/32,g={fullWidth:this.renderTarget.width,fullHeight:this.renderTarget.height,offsetX:0,offsetY:0,width:this.renderTarget.width,height:this.renderTarget.height},f=Object.assign({},r.view);f.enabled&&Object.assign(g,f);for(let A=0;A<d.length;A++){const y=d[A];if(r.setViewOffset&&r.setViewOffset(g.fullWidth,g.fullHeight,g.offsetX+y[0]*.0625,g.offsetY+y[1]*.0625,g.width,g.height),this.sampleWeight.value=u,this.unbiased){const b=-.5+(A+.5)/d.length;this.sampleWeight.value+=p*b}i.setClearColor(this.clearColor,this.clearAlpha),i.setRenderTarget(this.sampleRenderTarget),i.clear(),i.render(s,r),i.setRenderTarget(this.renderTarget),A===0&&(i.setClearColor(0,0),i.clear()),this._quadMesh.render(i)}i.copyTextureToTexture(this.sampleRenderTarget.depthTexture,this.renderTarget.depthTexture),r.setViewOffset&&f.enabled?r.setViewOffset(f.fullWidth,f.fullHeight,f.offsetX,f.offsetY,f.width,f.height):r.clearViewOffset&&r.clearViewOffset(),i.setRenderTarget(l),i.setMRT(c),i.autoClear=h,i.setClearColor(this._currentClearColor,a)}setup(e){this.sampleRenderTarget===null&&(this.sampleRenderTarget=this.renderTarget.clone());let i;const s=this.getMRT();if(s!==null){const r={};for(const o in s.outputNodes){const a=HV(this.sampleRenderTarget.textures,o);a>=0&&(r[o]=zi(this.sampleRenderTarget.textures[a]).mul(this.sampleWeight))}i=fE(r)}else i=zi(this.sampleRenderTarget.texture).mul(this.sampleWeight);return this._quadMesh.material=new Yi,this._quadMesh.material.fragmentNode=i,this._quadMesh.material.transparent=!0,this._quadMesh.material.depthTest=!1,this._quadMesh.material.depthWrite=!1,this._quadMesh.material.premultipliedAlpha=!0,this._quadMesh.material.blending=Wp,this._quadMesh.material.normals=!1,this._quadMesh.material.name="SSAA",super.setup(e)}dispose(){super.dispose(),this.sampleRenderTarget!==null&&this.sampleRenderTarget.dispose()}}const jbe=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]],Jbe=(n,e)=>ge(new dJ(n,e)),qbe=new Q;class uJ extends so{static get type(){return"StereoPassNode"}constructor(e,i){super(so.COLOR,e,i),this.isStereoPassNode=!0,this.stereo=new QP,this.stereo.aspect=.5}updateBefore(e){const{renderer:i}=e,{scene:s,camera:r,stereo:o,renderTarget:a}=this;this._pixelRatio=i.getPixelRatio(),o.cameraL.coordinateSystem=i.coordinateSystem,o.cameraR.coordinateSystem=i.coordinateSystem,o.update(r);const l=i.getSize(qbe);this.setSize(l.width,l.height);const c=i.autoClear;i.autoClear=!1;const h=i.getRenderTarget(),d=i.getMRT();this._cameraNear.value=r.near,this._cameraFar.value=r.far;for(const u in this._previousTextures)this.toggleTexture(u);i.setRenderTarget(a),i.setMRT(this._mrt),i.clear(),a.scissorTest=!0,a.scissor.set(0,0,a.width/2,a.height),a.viewport.set(0,0,a.width/2,a.height),i.render(s,o.cameraL),a.scissor.set(a.width/2,0,a.width/2,a.height),a.viewport.set(a.width/2,0,a.width/2,a.height),i.render(s,o.cameraR),a.scissorTest=!1,i.setRenderTarget(h),i.setMRT(d),i.autoClear=c}}const $be=(n,e)=>ge(new uJ(n,e)),eve=new Q,pJ=new fd;class mJ extends so{static get type(){return"StereoCompositePassNode"}constructor(e,i){super(so.COLOR,e,i),this.isStereoCompositePassNode=!0,this.stereo=new QP;const s={minFilter:Wt,magFilter:si,type:Ki};this._renderTargetL=new br(1,1,s),this._renderTargetR=new br(1,1,s),this._mapLeft=zi(this._renderTargetL.texture),this._mapRight=zi(this._renderTargetR.texture),this._material=null}updateStereoCamera(e){this.stereo.cameraL.coordinateSystem=e,this.stereo.cameraR.coordinateSystem=e,this.stereo.update(this.camera)}setSize(e,i){super.setSize(e,i),this._renderTargetL.setSize(this.renderTarget.width,this.renderTarget.height),this._renderTargetR.setSize(this.renderTarget.width,this.renderTarget.height)}updateBefore(e){const{renderer:i}=e,{scene:s,stereo:r,renderTarget:o}=this;this._pixelRatio=i.getPixelRatio(),this.updateStereoCamera(i.coordinateSystem);const a=i.getSize(eve);this.setSize(a.width,a.height);const l=i.getRenderTarget();i.setRenderTarget(this._renderTargetL),i.render(s,r.cameraL),i.setRenderTarget(this._renderTargetR),i.render(s,r.cameraR),i.setRenderTarget(o),pJ.material=this._material,pJ.render(i),i.setRenderTarget(l)}dispose(){super.dispose(),this._renderTargetL.dispose(),this._renderTargetR.dispose(),this._material!==null&&this._material.dispose()}}class gJ extends mJ{static get type(){return"AnaglyphPassNode"}constructor(e,i){super(e,i),this.isAnaglyphPassNode=!0,this._colorMatrixLeft=tt(new oi().fromArray([.4561,-.0400822,-.0152161,.500484,-.0378246,-.0205971,.176381,-.0157589,-.00546856])),this._colorMatrixRight=tt(new oi().fromArray([-.0434706,.378476,-.0721527,-.0879388,.73364,-.112961,-.00155529,-.0184503,1.2264]))}setup(e){const i=yi(),s=ie(()=>{const o=this._mapLeft.uv(i),a=this._mapRight.uv(i),l=rr(this._colorMatrixLeft.mul(o.rgb).add(this._colorMatrixRight.mul(a.rgb)));return Qe(l.rgb,Li(o.a,a.a))}),r=this._material||(this._material=new Yi);return r.fragmentNode=s().context(e.getSharedContext()),r.name="Anaglyph",r.needsUpdate=!0,super.setup(e)}}const tve=(n,e)=>ge(new gJ(n,e));class fJ extends mJ{static get type(){return"ParallaxBarrierPassNode"}constructor(e,i){super(e,i),this.isParallaxBarrierPassNode=!0}setup(e){const i=yi(),s=ie(()=>{const o=Qe().toVar();return Gt(FT(Oy.y,2).greaterThan(1),()=>{o.assign(this._mapLeft.uv(i))}).Else(()=>{o.assign(this._mapRight.uv(i))}),o}),r=this._material||(this._material=new Yi);return r.fragmentNode=s().context(e.getSharedContext()),r.needsUpdate=!0,super.setup(e)}}const ive=(n,e)=>ge(new fJ(n,e));class AJ extends so{static get type(){return"ToonOutlinePassNode"}constructor(e,i,s,r,o){super(so.COLOR,e,i),this.colorNode=s,this.thicknessNode=r,this.alphaNode=o,this._materialCache=new WeakMap}updateBefore(e){const{renderer:i}=e,s=i.getRenderObjectFunction();i.setRenderObjectFunction((r,o,a,l,c,h,d)=>{if((c.isMeshToonMaterial||c.isMeshToonNodeMaterial)&&c.wireframe===!1){const u=this._getOutlineMaterial(c);i.renderObject(r,o,a,l,u,h,d)}i.renderObject(r,o,a,l,c,h,d)}),super.updateBefore(e),i.setRenderObjectFunction(s)}_createMaterial(){const e=new Yi;e.isMeshToonOutlineMaterial=!0,e.name="Toon_Outline",e.side=wn;const i=el.negate(),s=qa.mul(md),r=D(1),o=s.mul(Qe(Bs,1)),a=s.mul(Qe(Bs.add(i),1)),l=Sl(o.sub(a));return e.vertexNode=o.add(l.mul(this.thicknessNode).mul(o.w).mul(r)),e.colorNode=Qe(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let i=this._materialCache.get(e);return i===void 0&&(i=this._createMaterial(),this._materialCache.set(e,i)),i}}const nve=(n,e,i=new fe(0,0,0),s=.003,r=1)=>ge(new AJ(n,e,ge(i),ge(s),ge(r)));class yJ extends Jt{static get type(){return"ScriptableValueNode"}constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outpuType=null,this.events=new yr,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:D()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=oN(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let i=null;e.value!==null&&(e.inputType==="ArrayBuffer"?i=aN(e.value):e.inputType==="Texture"?i=e.meta.textures[e.value]:i=e.meta.nodes[e.value]||null),this.value=i,this.inputType=e.inputType,this.outputType=e.outputType}}const vE=Ce(yJ);class bJ extends Map{get(e,i=null,...s){if(this.has(e))return super.get(e);if(i!==null){const r=i(...s);return this.set(e,r),r}}}class sve{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const i=this.parameters[e];return i?i.getValue():null}}const xE=new bJ;class vJ extends Jt{static get type(){return"ScriptableNode"}constructor(e=null,i={}){super(),this.codeNode=e,this.parameters=i,this._local=new bJ,this._output=vE(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,i){return this._local.set(e,i)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const i of this.getLayout())if(i.inputType&&(i.id===e||i.name===e))return i}getOutputLayout(e){for(const i of this.getLayout())if(i.outputType&&(i.id===e||i.name===e))return i}setOutput(e,i){const s=this._outputs;return s[e]===void 0?s[e]=vE(i):s[e].value=i,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,i){const s=this.parameters;return i&&i.isScriptableNode?(this.deleteParameter(e),s[e]=i,s[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):i&&i.isScriptableValueNode?(this.deleteParameter(e),s[e]=i,s[e].events.addEventListener("refresh",this.onRefresh)):s[e]===void 0?(s[e]=vE(i),s[e].events.addEventListener("refresh",this.onRefresh)):s[e].value=i,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let i=this.parameters[e];return i&&(i.isScriptableNode&&(i=i.getDefaultOutput()),i.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...i){const s=this.getObject()[e];if(typeof s=="function")return s(...i)}async callAsync(e,...i){const s=this.getObject()[e];if(typeof s=="function")return s.constructor.name==="AsyncFunction"?await s(...i):s(...i)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),i=(h,d)=>this.setOutput(h,d),s=new sve(this),r=xE.get("THREE"),o=xE.get("TSL"),a=this.getMethod(this.codeNode),l=[s,this._local,xE,e,i,r,o];this._object=a(...l);const c=this._object.layout;if(c&&(c.cache===!1&&this._local.clear(),this._output.outputType=c.outputType||null,Array.isArray(c.elements)))for(const h of c.elements){const d=h.id||h.name;h.inputType&&(this.getParameter(d)===void 0&&this.setParameter(d,null),this.getParameter(d).inputType=h.inputType),h.outputType&&(this.getOutput(d)===void 0&&this.setOutput(d,null),this.getOutput(d).outputType=h.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const i in this.parameters){let s=this.parameters[i];s.isScriptableNode&&(s=s.getDefaultOutput()),s.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:D()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],i=["layout","init","main","dispose"].join(", "),s="var "+i+`; var output = {};
`,r=`
return { ...output, `+i+" };",o=s+this.codeNode.code+r;return this._method=new Function(...e,o),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(e){const i=[iQ(this.source),this.getDefaultOutputNode().getCacheKey(e)];for(const s in this.parameters)i.push(this.parameters[s].getCacheKey(e));return nQ(i)}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const rve=Ce(vJ);class wE extends Jt{static get type(){return"FogNode"}constructor(e,i){super("float"),this.isFogNode=!0,this.colorNode=e,this.factorNode=i}getViewZNode(e){let i;const s=e.context.getViewZ;return s!==void 0&&(i=s(this)),(i||Ao.z).negate()}setup(){return this.factorNode}}const ove=Ce(wE);class xJ extends wE{static get type(){return"FogRangeNode"}constructor(e,i,s){super(e),this.isFogRangeNode=!0,this.nearNode=i,this.farNode=s}setup(e){const i=this.getViewZNode(e);return Sa(this.nearNode,this.farNode,i)}}const ave=Ce(xJ);class wJ extends wE{static get type(){return"FogExp2Node"}constructor(e,i){super(e),this.isFogExp2Node=!0,this.densityNode=i}setup(e){const i=this.getViewZNode(e),s=this.densityNode;return s.mul(s,i,i).negate().exp().oneMinus()}}const lve=Ce(wJ);let t0=null,i0=null;class CJ extends Jt{static get type(){return"RangeNode"}constructor(e=D(),i=D()){super(),this.minNode=e,this.maxNode=i}getVectorLength(e){const i=e.getTypeLength(ku(this.minNode.value)),s=e.getTypeLength(ku(this.maxNode.value));return i>s?i:s}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}setup(e){const i=e.object;let s=null;if(i.count>1){const r=this.minNode.value,o=this.maxNode.value,a=e.getTypeLength(ku(r)),l=e.getTypeLength(ku(o));t0=t0||new $e,i0=i0||new $e,t0.setScalar(0),i0.setScalar(0),a===1?t0.setScalar(r):r.isColor?t0.set(r.r,r.g,r.b):t0.set(r.x,r.y,r.z||0,r.w||0),l===1?i0.setScalar(o):o.isColor?i0.set(o.r,o.g,o.b):i0.set(o.x,o.y,o.z||0,o.w||0);const c=4,h=c*i.count,d=new Float32Array(h);for(let p=0;p<h;p++){const g=p%c,f=t0.getComponent(g),A=i0.getComponent(g);d[p]=Di.lerp(f,A,Math.random())}const u=this.getNodeType(e);if(i.count<=4096)s=Q1(d,"vec4",i.count).element($1).convert(u);else{const p=new Yo(d,4);e.geometry.setAttribute("__range"+this.id,p),s=OT(p).convert(u)}}else s=D(0);return s}}const cve=Ce(CJ),hve=ie(({depthTexture:n,shadowCoord:e})=>zi(n,e.xy).compare(e.z)),dve=ie(({depthTexture:n,shadowCoord:e,shadow:i})=>{const s=(A,y)=>zi(n,A).compare(y),r=wr("mapSize","vec2",i).setGroup(Zi),o=wr("radius","float",i).setGroup(Zi),a=ae(1).div(r),l=a.x.negate().mul(o),c=a.y.negate().mul(o),h=a.x.mul(o),d=a.y.mul(o),u=l.div(2),p=c.div(2),g=h.div(2),f=d.div(2);return Hn(s(e.xy.add(ae(l,c)),e.z),s(e.xy.add(ae(0,c)),e.z),s(e.xy.add(ae(h,c)),e.z),s(e.xy.add(ae(u,p)),e.z),s(e.xy.add(ae(0,p)),e.z),s(e.xy.add(ae(g,p)),e.z),s(e.xy.add(ae(l,0)),e.z),s(e.xy.add(ae(u,0)),e.z),s(e.xy,e.z),s(e.xy.add(ae(g,0)),e.z),s(e.xy.add(ae(h,0)),e.z),s(e.xy.add(ae(u,f)),e.z),s(e.xy.add(ae(0,f)),e.z),s(e.xy.add(ae(g,f)),e.z),s(e.xy.add(ae(l,d)),e.z),s(e.xy.add(ae(0,d)),e.z),s(e.xy.add(ae(h,d)),e.z)).mul(1/17)}),uve=ie(({depthTexture:n,shadowCoord:e,shadow:i})=>{const s=(d,u)=>zi(n,d).compare(u),r=wr("mapSize","vec2",i).setGroup(Zi),o=ae(1).div(r),a=o.x,l=o.y,c=e.xy,h=bm(c.mul(r).add(.5));return c.subAssign(h.mul(o)),Hn(s(c,e.z),s(c.add(ae(a,0)),e.z),s(c.add(ae(0,l)),e.z),s(c.add(o),e.z),Ai(s(c.add(ae(a.negate(),0)),e.z),s(c.add(ae(a.mul(2),0)),e.z),h.x),Ai(s(c.add(ae(a.negate(),l)),e.z),s(c.add(ae(a.mul(2),l)),e.z),h.x),Ai(s(c.add(ae(0,l.negate())),e.z),s(c.add(ae(0,l.mul(2))),e.z),h.y),Ai(s(c.add(ae(a,l.negate())),e.z),s(c.add(ae(a,l.mul(2))),e.z),h.y),Ai(Ai(s(c.add(ae(a.negate(),l.negate())),e.z),s(c.add(ae(a.mul(2),l.negate())),e.z),h.x),Ai(s(c.add(ae(a.negate(),l.mul(2))),e.z),s(c.add(ae(a.mul(2),l.mul(2))),e.z),h.x),h.y)).mul(1/9)}),pve=ie(({depthTexture:n,shadowCoord:e})=>{const i=D(1).toVar(),s=zi(n).uv(e.xy).rg,r=F1(e.z,s.x);return Gt(r.notEqual(D(1)),()=>{const o=e.z.sub(s.x),a=Li(0,s.y.mul(s.y));let l=a.div(a.add(o.mul(o)));l=rr(Ln(l,.3).div(.95-.3)),i.assign(rr(Li(r,l)))}),i}),mve=ie(({samples:n,radius:e,size:i,shadowPass:s})=>{const r=D(0).toVar(),o=D(0).toVar(),a=n.lessThanEqual(D(1)).select(D(0),D(2).div(n.sub(1))),l=n.lessThanEqual(D(1)).select(D(0),D(-1));Bi({start:K(0),end:K(n),type:"int",condition:"<"},({i:h})=>{const d=l.add(D(h).mul(a)),u=s.uv(Hn(Oy.xy,ae(0,d).mul(e)).div(i)).x;r.addAssign(u),o.addAssign(u.mul(u))}),r.divAssign(n),o.divAssign(n);const c=ph(o.sub(r.mul(r)));return ae(r,c)}),gve=ie(({samples:n,radius:e,size:i,shadowPass:s})=>{const r=D(0).toVar(),o=D(0).toVar(),a=n.lessThanEqual(D(1)).select(D(0),D(2).div(n.sub(1))),l=n.lessThanEqual(D(1)).select(D(0),D(-1));Bi({start:K(0),end:K(n),type:"int",condition:"<"},({i:h})=>{const d=l.add(D(h).mul(a)),u=s.uv(Hn(Oy.xy,ae(d,0).mul(e)).div(i));r.addAssign(u.x),o.addAssign(Hn(u.y.mul(u.y),u.x.mul(u.x)))}),r.divAssign(n),o.divAssign(n);const c=ph(o.sub(r.mul(r)));return ae(r,c)}),fve=[hve,dve,uve,pve];let jy=null;const CE=new fd;class Cm extends Kf{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.updateType=Ht.FRAME,this.light=e,this.color=new fe,this.colorNode=tt(this.color).setGroup(Zi),this.baseColorNode=null,this.shadowMap=null,this.shadowNode=null,this.shadowColorNode=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this.isAnalyticLightNode=!0}getCacheKey(){return nN(super.getCacheKey(),this.light.id,this.light.castShadow?1:0)}getHash(){return this.light.uuid}setupShadow(e){const{object:i,renderer:s}=e;if(s.shadowMap.enabled===!1)return;let r=this.shadowColorNode;if(r===null){jy===null&&(jy=new Yi,jy.fragmentNode=Qe(0,0,0,1),jy.isShadowNodeMaterial=!0,jy.name="ShadowMaterial");const o=s.shadowMap.type,a=this.light.shadow,l=new Eu;l.compareFunction=wG;const c=e.createRenderTarget(a.mapSize.width,a.mapSize.height);if(c.depthTexture=l,a.camera.updateProjectionMatrix(),o===Ha){l.compareFunction=null,this.vsmShadowMapVertical=e.createRenderTarget(a.mapSize.width,a.mapSize.height,{format:fc,type:Ki}),this.vsmShadowMapHorizontal=e.createRenderTarget(a.mapSize.width,a.mapSize.height,{format:fc,type:Ki});const x=zi(l),w=zi(this.vsmShadowMapVertical.texture),C=wr("blurSamples","float",a).setGroup(Zi),S=wr("radius","float",a).setGroup(Zi),_=wr("mapSize","vec2",a).setGroup(Zi);let I=this.vsmMaterialVertical||(this.vsmMaterialVertical=new Yi);I.fragmentNode=mve({samples:C,radius:S,size:_,shadowPass:x}).context(e.getSharedContext()),I.name="VSMVertical",I=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new Yi),I.fragmentNode=gve({samples:C,radius:S,size:_,shadowPass:w}).context(e.getSharedContext()),I.name="VSMHorizontal"}const h=wr("intensity","float",a).setGroup(Zi),d=wr("bias","float",a).setGroup(Zi),u=wr("normalBias","float",a).setGroup(Zi),p=i.material.shadowPositionNode||WT;let g=tt(a.matrix).setGroup(Zi).mul(p.add(QT.mul(u)));g=g.xyz.div(g.w);let f=g.z.add(d);s.coordinateSystem===gf&&(f=f.mul(2).sub(1)),g=j(g.x,g.y.oneMinus(),f);const A=g.x.greaterThanEqual(0).and(g.x.lessThanEqual(1)).and(g.y.greaterThanEqual(0)).and(g.y.lessThanEqual(1)).and(g.z.lessThanEqual(1)),y=a.filterNode||fve[s.shadowMap.type]||null;if(y===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const b=zi(c.texture,g),v=A.select(y({depthTexture:o===Ha?this.vsmShadowMapHorizontal.texture:l,shadowCoord:g,shadow:a}),D(1));this.shadowMap=c,this.light.shadow.map=c,this.shadowNode=v,this.shadowColorNode=r=this.colorNode.mul(Ai(1,v.rgb.mix(b,1),h.mul(b.a))),this.baseColorNode=this.colorNode}this.colorNode=r,this.updateBeforeType=Ht.RENDER}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&this.disposeShadow()}updateShadow(e){const{shadowMap:i,light:s}=this,{renderer:r,scene:o,camera:a}=e,l=r.shadowMap.type,c=i.depthTexture.version;this._depthVersionCached=c;const h=o.overrideMaterial;o.overrideMaterial=jy,i.setSize(s.shadow.mapSize.width,s.shadow.mapSize.height),s.shadow.updateMatrices(s),s.shadow.camera.layers.mask=a.layers.mask;const d=r.getRenderTarget(),u=r.getRenderObjectFunction();r.setRenderObjectFunction((p,...g)=>{(p.castShadow===!0||p.receiveShadow&&l===Ha)&&r.renderObject(p,...g)}),r.setRenderTarget(i),r.render(o,s.shadow.camera),r.setRenderObjectFunction(u),s.isPointLight!==!0&&l===Ha&&this.vsmPass(e,s),r.setRenderTarget(d),o.overrideMaterial=h}vsmPass(e,i){const{renderer:s}=e;this.vsmShadowMapVertical.setSize(i.shadow.mapSize.width,i.shadow.mapSize.height),this.vsmShadowMapHorizontal.setSize(i.shadow.mapSize.width,i.shadow.mapSize.height),s.setRenderTarget(this.vsmShadowMapVertical),CE.material=this.vsmMaterialVertical,CE.render(s),s.setRenderTarget(this.vsmShadowMapHorizontal),CE.material=this.vsmMaterialHorizontal,CE.render(s)}disposeShadow(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),this.shadowNode=null,this.shadowColorNode=null,this.baseColorNode=null,this.updateBeforeType=Ht.NONE}updateBefore(e){const i=this.light.shadow;(i.needsUpdate||i.autoUpdate)&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(i.needsUpdate=!1))}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const tX=ie(n=>{const{lightDistance:e,cutoffDistance:i,decayExponent:s}=n,r=e.pow(s).max(.01).reciprocal();return i.greaterThan(0).select(r.mul(e.div(i).pow4().oneMinus().clamp().pow2()),r)});let SE;function iX(n){SE=SE||new WeakMap;let e=SE.get(n);return e===void 0&&SE.set(n,e={}),e}function nX(n){const e=iX(n);return e.position||(e.position=tt(new E).setGroup(Zi).onRenderUpdate((i,s)=>s.value.setFromMatrixPosition(n.matrixWorld)))}function SJ(n){const e=iX(n);return e.targetPosition||(e.targetPosition=tt(new E).setGroup(Zi).onRenderUpdate((i,s)=>s.value.setFromMatrixPosition(n.target.matrixWorld)))}function _E(n){const e=iX(n);return e.viewPosition||(e.viewPosition=tt(new E).setGroup(Zi).onRenderUpdate(({camera:i},s)=>{s.value=s.value||new E,s.value.setFromMatrixPosition(n.matrixWorld),s.value.applyMatrix4(i.matrixWorldInverse)}))}const sX=n=>$a.transformDirection(nX(n).sub(SJ(n))),Ave=ie(([n])=>{const e=n.toUint().mul(747796405).add(2891336453),i=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return i.shiftRight(22).bitXor(i).toFloat().mul(1/2**32)}),rX=(n,e)=>Ca(wi(4,n.mul(Ln(1,n))),e),yve=(n,e)=>n.lessThan(.5)?rX(n.mul(2),e).div(2):Ln(1,rX(wi(Ln(1,n),2),e).div(2)),bve=(n,e,i)=>Ca(uh(Ca(n,e),Hn(Ca(n,e),Ca(Ln(1,n),i))),1/e),vve=(n,e)=>po(Wf.mul(e.mul(n).sub(1))).div(Wf.mul(e.mul(n).sub(1))),Ad=ie(([n])=>n.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),_J=ie(([n])=>j(Ad(n.z.add(Ad(n.y.mul(1)))),Ad(n.z.add(Ad(n.x.mul(1)))),Ad(n.y.add(Ad(n.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),xve=ie(([n,e,i])=>{const s=j(n).toVar(),r=D(1.4).toVar(),o=D(0).toVar(),a=j(s).toVar();return Bi({start:D(0),end:D(3),type:"float",condition:"<="},()=>{const l=j(_J(a.mul(2))).toVar();s.addAssign(l.add(i.mul(D(.1).mul(e)))),a.mulAssign(1.8),r.mulAssign(1.5),s.mulAssign(1.2);const c=D(Ad(s.z.add(Ad(s.x.add(Ad(s.y)))))).toVar();o.addAssign(c.div(r)),a.addAssign(.14)}),o}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"p",type:"vec3"},{name:"spd",type:"float"},{name:"time",type:"float"}]}),wve=ie(([n,e,i=ae(.5)])=>LV(n.sub(i),e).add(i)),Cve=ie(([n,e,i=ae(.5)])=>{const s=n.sub(i),r=s.dot(s),o=r.mul(r).mul(e);return n.add(s.mul(o))}),Sve=ie(({position:n=null,horizontal:e=!0,vertical:i=!1})=>{let s;n!==null?(s=Cc.toVar(),s[3][0]=n.x,s[3][1]=n.y,s[3][2]=n.z):s=Cc;const r=$a.mul(s);return T1(e)&&(r[0][0]=Cc[0].length(),r[0][1]=0,r[0][2]=0),T1(i)&&(r[1][0]=0,r[1][1]=Cc[1].length(),r[1][2]=0),r[2][0]=0,r[2][1]=0,r[2][2]=1,qa.mul(r).mul(Bs)}),_ve=ie(([n=null])=>{const e=iE();return iE(pV(n)).sub(e).lessThan(0).select(wm,n)}),MJ=new WeakMap;class Mve extends Ti{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.updateType=Ht.OBJECT,this.updateAfterType=Ht.OBJECT,this.previousModelWorldMatrix=tt(new de),this.previousProjectionMatrix=tt(new de).setGroup(Zi),this.previousCameraViewMatrix=tt(new de)}update({frameId:e,camera:i,object:s}){const r=TJ(s);this.previousModelWorldMatrix.value.copy(r);const o=IJ(i);o.frameId!==e&&(o.frameId=e,o.previousProjectionMatrix===void 0?(o.previousProjectionMatrix=new de,o.previousCameraViewMatrix=new de,o.currentProjectionMatrix=new de,o.currentCameraViewMatrix=new de,o.previousProjectionMatrix.copy(i.projectionMatrix),o.previousCameraViewMatrix.copy(i.matrixWorldInverse)):(o.previousProjectionMatrix.copy(o.currentProjectionMatrix),o.previousCameraViewMatrix.copy(o.currentCameraViewMatrix)),o.currentProjectionMatrix.copy(i.projectionMatrix),o.currentCameraViewMatrix.copy(i.matrixWorldInverse),this.previousProjectionMatrix.value.copy(o.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(o.previousCameraViewMatrix))}updateAfter({object:e}){TJ(e).copy(e.matrixWorld)}setup(){const e=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),i=qa.mul(md).mul(Bs),s=this.previousProjectionMatrix.mul(e).mul(ZT),r=i.xy.div(i.w),o=s.xy.div(s.w);return Ln(r,o)}}function IJ(n){let e=MJ.get(n);return e===void 0&&(e={},MJ.set(n,e)),e}function TJ(n,e=0){const i=IJ(n);let s=i[e];return s===void 0&&(i[e]=s=new de),s}const Ive=it(Mve),Tve=ie(([n,e])=>Vr(1,n.oneMinus().div(e)).oneMinus()).setLayout({name:"burnBlend",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Eve=ie(([n,e])=>Vr(n.div(e.oneMinus()),1)).setLayout({name:"dodgeBlend",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Rve=ie(([n,e])=>n.oneMinus().mul(e.oneMinus()).oneMinus()).setLayout({name:"screenBlend",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Lve=ie(([n,e])=>Ai(n.mul(2).mul(e),n.oneMinus().mul(2).mul(e.oneMinus()).oneMinus(),F1(.5,n))).setLayout({name:"overlayBlend",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Bve=ie(([n,e,i=K(16)])=>{const s=l=>n.uv(l),r=yi(),o=s(r).toVar(),a=D(i);return Bi({start:K(1),end:i,type:"int",condition:"<="},({i:l})=>{const c=e.mul(D(l).div(a.sub(1)).sub(.5));o.addAssign(s(r.add(c)))}),o.divAssign(a),o}),kve=ie(([n,e=1])=>{const i=n,s=bo(i.rgb),r=j(s),o=Vr(1,Li(0,D(10).mul(s.sub(.45)))),a=r.mul(i.rgb).mul(2),l=D(2).mul(r.oneMinus()).mul(i.rgb.oneMinus()).oneMinus(),c=Ai(a,l,o),h=i.a.mul(e),d=h.mul(c.rgb);return d.addAssign(i.rgb.mul(h.oneMinus())),Qe(d,i.a)}),Gve=ie(([n])=>{const e=j(n);return Qe(As(e,j(.393,.769,.189)),As(e,j(.349,.686,.168)),As(e,j(.272,.534,.131)),n.a)}),EJ=ie(([n])=>{const e=n.mul(.9478672986).add(.0521327014).pow(2.4),i=n.mul(.0773993808),s=n.lessThanEqual(.04045);return Ai(e,i,s)}).setLayout({name:"sRGBToLinearSRGB",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),RJ=ie(([n])=>{const e=n.pow(.41666).mul(1.055).sub(.055),i=n.mul(12.92),s=n.lessThanEqual(.0031308);return Ai(e,i,s)}).setLayout({name:"linearSRGBTosRGB",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),LJ=ie(([n,e])=>n.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),BJ=ie(([n,e])=>(n=n.mul(e),n.div(n.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),kJ=ie(([n,e])=>{n=n.mul(e),n=n.sub(.004).max(0);const i=n.mul(n.mul(6.2).add(.5)),s=n.mul(n.mul(6.2).add(1.7)).add(.06);return i.div(s).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Pve=ie(([n])=>{const e=n.mul(n.add(.0245786)).sub(90537e-9),i=n.mul(n.add(.432951).mul(.983729)).add(.238081);return e.div(i)}),GJ=ie(([n,e])=>{const i=Nr(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),s=Nr(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(e).div(.6),n=i.mul(n),n=Pve(n),n=s.mul(n),n.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Nve=Nr(j(1.6605,-.1246,-.0182),j(-.5876,1.1329,-.1006),j(-.0728,-.0083,1.1187)),Vve=Nr(j(.6274,.0691,.0164),j(.3293,.9195,.088),j(.0433,.0113,.8956)),Xve=ie(([n])=>{const e=j(n).toVar(),i=j(e.mul(e)).toVar(),s=j(i.mul(i)).toVar();return D(15.5).mul(s.mul(i)).sub(wi(40.14,s.mul(e))).add(wi(31.96,s).sub(wi(6.868,i.mul(e))).add(wi(.4298,i).add(wi(.1191,e).sub(.00232))))}),PJ=ie(([n,e])=>{const i=j(n).toVar(),s=Nr(j(.856627153315983,.137318972929847,.11189821299995),j(.0951212405381588,.761241990602591,.0767994186031903),j(.0482516061458583,.101439036467562,.811302368396859)),r=Nr(j(1.1271005818144368,-.1413297634984383,-.14132976349843826),j(-.11060664309660323,1.157823702216272,-.11060664309660294),j(-.016493938717834573,-.016493938717834257,1.2519364065950405)),o=D(-12.47393),a=D(4.026069);return i.mulAssign(e),i.assign(Vve.mul(i)),i.assign(s.mul(i)),i.assign(Li(i,1e-10)),i.assign(D1(i)),i.assign(i.sub(o).div(a.sub(o))),i.assign(rr(i,0,1)),i.assign(Xve(i)),i.assign(r.mul(i)),i.assign(Ca(Li(j(0),i),j(2.2))),i.assign(Nve.mul(i)),i.assign(rr(i,0,1)),i}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),NJ=ie(([n,e])=>{const i=D(.76),s=D(.15);n=n.mul(e);const r=Vr(n.r,Vr(n.g,n.b)),o=mo(r.lessThan(.08),r.sub(wi(6.25,r.mul(r))),.04);n.subAssign(o);const a=Li(n.r,Li(n.g,n.b));Gt(a.lessThan(i),()=>n);const l=Ln(1,i),c=Ln(1,l.mul(l).div(a.add(l.sub(i))));n.mulAssign(c.div(a));const h=Ln(1,uh(1,s.mul(a.sub(c)).add(1)));return Ai(n,j(c),h)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Dve extends Jt{static get type(){return"ComputeBuiltinNode"}constructor(e,i){super(i),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){e.hasBuiltin(this._builtinName)}generate(e,i){const s=this.getBuiltinName(e),r=this.getNodeType(e);return e.shaderStage==="compute"?e.format(s,r,i):(console.warn(`ComputeBuiltinNode: Compute built-in value ${s} can not be accessed in the ${e.shaderStage} stage`),e.generateConst(r))}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}}const ME=(n,e)=>ge(new Dve(n,e)),zve=ME("numWorkgroups","uvec3"),Fve=ME("workgroupId","uvec3"),Uve=ME("localId","uvec3"),Ove=ME("subgroupSize","uint");class Zve extends Jt{constructor(e){super(),this.scope=e}generate(e){const{scope:i}=this,{renderer:s}=e;s.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${i}Barrier 
`):e.addLineFlowCode(`${i}Barrier()`,this)}}const oX=Ce(Zve),Wve=()=>oX("workgroup").append(),Hve=()=>oX("storage").append(),Qve=()=>oX("texture").append();class Kve extends gm{constructor(e,i){super(e,i),this.isWorkgroupInfoElementNode=!0}generate(e,i){let s;const r=e.context.assign;if(s=super.generate(e),r!==!0){const o=this.getNodeType(e);s=e.format(s,o,i)}return s}}class Yve extends Jt{constructor(e,i,s=0){super(i),this.bufferType=i,this.bufferCount=s,this.isWorkgroupInfoNode=!0,this.scope=e}label(e){return this.name=e,this}getHash(){return this.uuid}setScope(e){return this.scope=e,this}getInputType(){return`${this.scope}Array`}element(e){return ge(new Kve(this,e))}generate(e){return e.getScopedArray(this.name||`${this.scope}Array_${this.id}`,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}const jve=(n,e)=>ge(new Yve("Workgroup",n,e));class Dr extends Ti{static get type(){return"AtomicFunctionNode"}constructor(e,i,s,r=null){super("uint"),this.method=e,this.pointerNode=i,this.valueNode=s,this.storeNode=r}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const i=this.method,s=this.getNodeType(e),r=this.getInputType(e),o=this.pointerNode,a=this.valueNode,l=[];l.push(`&${o.build(e,r)}`),l.push(a.build(e,r));const c=`${e.getMethod(i,s)}( ${l.join(", ")} )`;if(this.storeNode!==null){const h=this.storeNode.build(e,r);e.addLineFlowCode(`${h} = ${c}`,this)}else e.addLineFlowCode(c,this)}}Dr.ATOMIC_LOAD="atomicLoad",Dr.ATOMIC_STORE="atomicStore",Dr.ATOMIC_ADD="atomicAdd",Dr.ATOMIC_SUB="atomicSub",Dr.ATOMIC_MAX="atomicMax",Dr.ATOMIC_MIN="atomicMin",Dr.ATOMIC_AND="atomicAnd",Dr.ATOMIC_OR="atomicOr",Dr.ATOMIC_XOR="atomicXor";const Jve=Ce(Dr),Nu=(n,e,i,s)=>{const r=Jve(n,e,i,s);return r.append(),r},qve=(n,e,i=null)=>Nu(Dr.ATOMIC_STORE,n,e,i),$ve=(n,e,i=null)=>Nu(Dr.ATOMIC_ADD,n,e,i),exe=(n,e,i=null)=>Nu(Dr.ATOMIC_SUB,n,e,i),txe=(n,e,i=null)=>Nu(Dr.ATOMIC_MAX,n,e,i),ixe=(n,e,i=null)=>Nu(Dr.ATOMIC_MIN,n,e,i),nxe=(n,e,i=null)=>Nu(Dr.ATOMIC_AND,n,e,i),sxe=(n,e,i=null)=>Nu(Dr.ATOMIC_OR,n,e,i),rxe=(n,e,i=null)=>Nu(Dr.ATOMIC_XOR,n,e,i),oxe=ie(([n=yi()])=>{const e=n.mul(2),i=e.x.floor(),s=e.y.floor();return i.add(s).mod(2).sign()}),hw=ie(([n,e,i])=>{const s=D(i).toVar(),r=D(e).toVar(),o=fm(n).toVar();return mo(o,r,s)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),IE=ie(([n,e])=>{const i=fm(e).toVar(),s=D(n).toVar();return mo(i,s.negate(),s)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),Zs=ie(([n])=>{const e=D(n).toVar();return K(ym(e))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),Qn=ie(([n,e])=>{const i=D(n).toVar();return e.assign(Zs(i)),i.sub(D(e))}),axe=ie(([n,e,i,s,r,o])=>{const a=D(o).toVar(),l=D(r).toVar(),c=D(s).toVar(),h=D(i).toVar(),d=D(e).toVar(),u=D(n).toVar(),p=D(Ln(1,l)).toVar();return Ln(1,a).mul(u.mul(p).add(d.mul(l))).add(a.mul(h.mul(p).add(c.mul(l))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),lxe=ie(([n,e,i,s,r,o])=>{const a=D(o).toVar(),l=D(r).toVar(),c=j(s).toVar(),h=j(i).toVar(),d=j(e).toVar(),u=j(n).toVar(),p=D(Ln(1,l)).toVar();return Ln(1,a).mul(u.mul(p).add(d.mul(l))).add(a.mul(h.mul(p).add(c.mul(l))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),VJ=yo([axe,lxe]),cxe=ie(([n,e,i,s,r,o,a,l,c,h,d])=>{const u=D(d).toVar(),p=D(h).toVar(),g=D(c).toVar(),f=D(l).toVar(),A=D(a).toVar(),y=D(o).toVar(),b=D(r).toVar(),v=D(s).toVar(),x=D(i).toVar(),w=D(e).toVar(),C=D(n).toVar(),S=D(Ln(1,g)).toVar(),_=D(Ln(1,p)).toVar();return D(Ln(1,u)).toVar().mul(_.mul(C.mul(S).add(w.mul(g))).add(p.mul(x.mul(S).add(v.mul(g))))).add(u.mul(_.mul(b.mul(S).add(y.mul(g))).add(p.mul(A.mul(S).add(f.mul(g))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),hxe=ie(([n,e,i,s,r,o,a,l,c,h,d])=>{const u=D(d).toVar(),p=D(h).toVar(),g=D(c).toVar(),f=j(l).toVar(),A=j(a).toVar(),y=j(o).toVar(),b=j(r).toVar(),v=j(s).toVar(),x=j(i).toVar(),w=j(e).toVar(),C=j(n).toVar(),S=D(Ln(1,g)).toVar(),_=D(Ln(1,p)).toVar();return D(Ln(1,u)).toVar().mul(_.mul(C.mul(S).add(w.mul(g))).add(p.mul(x.mul(S).add(v.mul(g))))).add(u.mul(_.mul(b.mul(S).add(y.mul(g))).add(p.mul(A.mul(S).add(f.mul(g))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),XJ=yo([cxe,hxe]),dxe=ie(([n,e,i])=>{const s=D(i).toVar(),r=D(e).toVar(),o=pt(n).toVar(),a=pt(o.bitAnd(pt(7))).toVar(),l=D(hw(a.lessThan(pt(4)),r,s)).toVar(),c=D(wi(2,hw(a.lessThan(pt(4)),s,r))).toVar();return IE(l,fm(a.bitAnd(pt(1)))).add(IE(c,fm(a.bitAnd(pt(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),uxe=ie(([n,e,i,s])=>{const r=D(s).toVar(),o=D(i).toVar(),a=D(e).toVar(),l=pt(n).toVar(),c=pt(l.bitAnd(pt(15))).toVar(),h=D(hw(c.lessThan(pt(8)),a,o)).toVar(),d=D(hw(c.lessThan(pt(4)),o,hw(c.equal(pt(12)).or(c.equal(pt(14))),a,r))).toVar();return IE(h,fm(c.bitAnd(pt(1)))).add(IE(d,fm(c.bitAnd(pt(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),zr=yo([dxe,uxe]),pxe=ie(([n,e,i])=>{const s=D(i).toVar(),r=D(e).toVar(),o=Py(n).toVar();return j(zr(o.x,r,s),zr(o.y,r,s),zr(o.z,r,s))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),mxe=ie(([n,e,i,s])=>{const r=D(s).toVar(),o=D(i).toVar(),a=D(e).toVar(),l=Py(n).toVar();return j(zr(l.x,a,o,r),zr(l.y,a,o,r),zr(l.z,a,o,r))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),Sc=yo([pxe,mxe]),gxe=ie(([n])=>{const e=D(n).toVar();return wi(.6616,e)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),fxe=ie(([n])=>{const e=D(n).toVar();return wi(.982,e)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),Axe=ie(([n])=>{const e=j(n).toVar();return wi(.6616,e)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),DJ=yo([gxe,Axe]),yxe=ie(([n])=>{const e=j(n).toVar();return wi(.982,e)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),zJ=yo([fxe,yxe]),Tl=ie(([n,e])=>{const i=K(e).toVar(),s=pt(n).toVar();return s.shiftLeft(i).bitOr(s.shiftRight(K(32).sub(i)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),FJ=ie(([n,e,i])=>{n.subAssign(i),n.bitXorAssign(Tl(i,K(4))),i.addAssign(e),e.subAssign(n),e.bitXorAssign(Tl(n,K(6))),n.addAssign(i),i.subAssign(e),i.bitXorAssign(Tl(e,K(8))),e.addAssign(n),n.subAssign(i),n.bitXorAssign(Tl(i,K(16))),i.addAssign(e),e.subAssign(n),e.bitXorAssign(Tl(n,K(19))),n.addAssign(i),i.subAssign(e),i.bitXorAssign(Tl(e,K(4))),e.addAssign(n)}),dw=ie(([n,e,i])=>{const s=pt(i).toVar(),r=pt(e).toVar(),o=pt(n).toVar();return s.bitXorAssign(r),s.subAssign(Tl(r,K(14))),o.bitXorAssign(s),o.subAssign(Tl(s,K(11))),r.bitXorAssign(o),r.subAssign(Tl(o,K(25))),s.bitXorAssign(r),s.subAssign(Tl(r,K(16))),o.bitXorAssign(s),o.subAssign(Tl(s,K(4))),r.bitXorAssign(o),r.subAssign(Tl(o,K(14))),s.bitXorAssign(r),s.subAssign(Tl(r,K(24))),s}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),qo=ie(([n])=>{const e=pt(n).toVar();return D(e).div(D(pt(K(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),yd=ie(([n])=>{const e=D(n).toVar();return e.mul(e).mul(e).mul(e.mul(e.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),bxe=ie(([n])=>{const e=K(n).toVar(),i=pt(pt(1)).toVar(),s=pt(pt(K(3735928559)).add(i.shiftLeft(pt(2))).add(pt(13))).toVar();return dw(s.add(pt(e)),s,s)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),vxe=ie(([n,e])=>{const i=K(e).toVar(),s=K(n).toVar(),r=pt(pt(2)).toVar(),o=pt().toVar(),a=pt().toVar(),l=pt().toVar();return o.assign(a.assign(l.assign(pt(K(3735928559)).add(r.shiftLeft(pt(2))).add(pt(13))))),o.addAssign(pt(s)),a.addAssign(pt(i)),dw(o,a,l)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),xxe=ie(([n,e,i])=>{const s=K(i).toVar(),r=K(e).toVar(),o=K(n).toVar(),a=pt(pt(3)).toVar(),l=pt().toVar(),c=pt().toVar(),h=pt().toVar();return l.assign(c.assign(h.assign(pt(K(3735928559)).add(a.shiftLeft(pt(2))).add(pt(13))))),l.addAssign(pt(o)),c.addAssign(pt(r)),h.addAssign(pt(s)),dw(l,c,h)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),wxe=ie(([n,e,i,s])=>{const r=K(s).toVar(),o=K(i).toVar(),a=K(e).toVar(),l=K(n).toVar(),c=pt(pt(4)).toVar(),h=pt().toVar(),d=pt().toVar(),u=pt().toVar();return h.assign(d.assign(u.assign(pt(K(3735928559)).add(c.shiftLeft(pt(2))).add(pt(13))))),h.addAssign(pt(l)),d.addAssign(pt(a)),u.addAssign(pt(o)),FJ(h,d,u),h.addAssign(pt(r)),dw(h,d,u)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),Cxe=ie(([n,e,i,s,r])=>{const o=K(r).toVar(),a=K(s).toVar(),l=K(i).toVar(),c=K(e).toVar(),h=K(n).toVar(),d=pt(pt(5)).toVar(),u=pt().toVar(),p=pt().toVar(),g=pt().toVar();return u.assign(p.assign(g.assign(pt(K(3735928559)).add(d.shiftLeft(pt(2))).add(pt(13))))),u.addAssign(pt(h)),p.addAssign(pt(c)),g.addAssign(pt(l)),FJ(u,p,g),u.addAssign(pt(a)),p.addAssign(pt(o)),dw(u,p,g)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),hn=yo([bxe,vxe,xxe,wxe,Cxe]),Sxe=ie(([n,e])=>{const i=K(e).toVar(),s=K(n).toVar(),r=pt(hn(s,i)).toVar(),o=Py().toVar();return o.x.assign(r.bitAnd(K(255))),o.y.assign(r.shiftRight(K(8)).bitAnd(K(255))),o.z.assign(r.shiftRight(K(16)).bitAnd(K(255))),o}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),_xe=ie(([n,e,i])=>{const s=K(i).toVar(),r=K(e).toVar(),o=K(n).toVar(),a=pt(hn(o,r,s)).toVar(),l=Py().toVar();return l.x.assign(a.bitAnd(K(255))),l.y.assign(a.shiftRight(K(8)).bitAnd(K(255))),l.z.assign(a.shiftRight(K(16)).bitAnd(K(255))),l}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),_c=yo([Sxe,_xe]),Mxe=ie(([n])=>{const e=ae(n).toVar(),i=K().toVar(),s=K().toVar(),r=D(Qn(e.x,i)).toVar(),o=D(Qn(e.y,s)).toVar(),a=D(yd(r)).toVar(),l=D(yd(o)).toVar(),c=D(VJ(zr(hn(i,s),r,o),zr(hn(i.add(K(1)),s),r.sub(1),o),zr(hn(i,s.add(K(1))),r,o.sub(1)),zr(hn(i.add(K(1)),s.add(K(1))),r.sub(1),o.sub(1)),a,l)).toVar();return DJ(c)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),Ixe=ie(([n])=>{const e=j(n).toVar(),i=K().toVar(),s=K().toVar(),r=K().toVar(),o=D(Qn(e.x,i)).toVar(),a=D(Qn(e.y,s)).toVar(),l=D(Qn(e.z,r)).toVar(),c=D(yd(o)).toVar(),h=D(yd(a)).toVar(),d=D(yd(l)).toVar(),u=D(XJ(zr(hn(i,s,r),o,a,l),zr(hn(i.add(K(1)),s,r),o.sub(1),a,l),zr(hn(i,s.add(K(1)),r),o,a.sub(1),l),zr(hn(i.add(K(1)),s.add(K(1)),r),o.sub(1),a.sub(1),l),zr(hn(i,s,r.add(K(1))),o,a,l.sub(1)),zr(hn(i.add(K(1)),s,r.add(K(1))),o.sub(1),a,l.sub(1)),zr(hn(i,s.add(K(1)),r.add(K(1))),o,a.sub(1),l.sub(1)),zr(hn(i.add(K(1)),s.add(K(1)),r.add(K(1))),o.sub(1),a.sub(1),l.sub(1)),c,h,d)).toVar();return zJ(u)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),aX=yo([Mxe,Ixe]),Txe=ie(([n])=>{const e=ae(n).toVar(),i=K().toVar(),s=K().toVar(),r=D(Qn(e.x,i)).toVar(),o=D(Qn(e.y,s)).toVar(),a=D(yd(r)).toVar(),l=D(yd(o)).toVar(),c=j(VJ(Sc(_c(i,s),r,o),Sc(_c(i.add(K(1)),s),r.sub(1),o),Sc(_c(i,s.add(K(1))),r,o.sub(1)),Sc(_c(i.add(K(1)),s.add(K(1))),r.sub(1),o.sub(1)),a,l)).toVar();return DJ(c)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),Exe=ie(([n])=>{const e=j(n).toVar(),i=K().toVar(),s=K().toVar(),r=K().toVar(),o=D(Qn(e.x,i)).toVar(),a=D(Qn(e.y,s)).toVar(),l=D(Qn(e.z,r)).toVar(),c=D(yd(o)).toVar(),h=D(yd(a)).toVar(),d=D(yd(l)).toVar(),u=j(XJ(Sc(_c(i,s,r),o,a,l),Sc(_c(i.add(K(1)),s,r),o.sub(1),a,l),Sc(_c(i,s.add(K(1)),r),o,a.sub(1),l),Sc(_c(i.add(K(1)),s.add(K(1)),r),o.sub(1),a.sub(1),l),Sc(_c(i,s,r.add(K(1))),o,a,l.sub(1)),Sc(_c(i.add(K(1)),s,r.add(K(1))),o.sub(1),a,l.sub(1)),Sc(_c(i,s.add(K(1)),r.add(K(1))),o,a.sub(1),l.sub(1)),Sc(_c(i.add(K(1)),s.add(K(1)),r.add(K(1))),o.sub(1),a.sub(1),l.sub(1)),c,h,d)).toVar();return zJ(u)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),lX=yo([Txe,Exe]),Rxe=ie(([n])=>{const e=D(n).toVar(),i=K(Zs(e)).toVar();return qo(hn(i))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),Lxe=ie(([n])=>{const e=ae(n).toVar(),i=K(Zs(e.x)).toVar(),s=K(Zs(e.y)).toVar();return qo(hn(i,s))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),Bxe=ie(([n])=>{const e=j(n).toVar(),i=K(Zs(e.x)).toVar(),s=K(Zs(e.y)).toVar(),r=K(Zs(e.z)).toVar();return qo(hn(i,s,r))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),kxe=ie(([n])=>{const e=Qe(n).toVar(),i=K(Zs(e.x)).toVar(),s=K(Zs(e.y)).toVar(),r=K(Zs(e.z)).toVar(),o=K(Zs(e.w)).toVar();return qo(hn(i,s,r,o))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),Gxe=yo([Rxe,Lxe,Bxe,kxe]),Pxe=ie(([n])=>{const e=D(n).toVar(),i=K(Zs(e)).toVar();return j(qo(hn(i,K(0))),qo(hn(i,K(1))),qo(hn(i,K(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),Nxe=ie(([n])=>{const e=ae(n).toVar(),i=K(Zs(e.x)).toVar(),s=K(Zs(e.y)).toVar();return j(qo(hn(i,s,K(0))),qo(hn(i,s,K(1))),qo(hn(i,s,K(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),Vxe=ie(([n])=>{const e=j(n).toVar(),i=K(Zs(e.x)).toVar(),s=K(Zs(e.y)).toVar(),r=K(Zs(e.z)).toVar();return j(qo(hn(i,s,r,K(0))),qo(hn(i,s,r,K(1))),qo(hn(i,s,r,K(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),Xxe=ie(([n])=>{const e=Qe(n).toVar(),i=K(Zs(e.x)).toVar(),s=K(Zs(e.y)).toVar(),r=K(Zs(e.z)).toVar(),o=K(Zs(e.w)).toVar();return j(qo(hn(i,s,r,o,K(0))),qo(hn(i,s,r,o,K(1))),qo(hn(i,s,r,o,K(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),UJ=yo([Pxe,Nxe,Vxe,Xxe]),TE=ie(([n,e,i,s])=>{const r=D(s).toVar(),o=D(i).toVar(),a=K(e).toVar(),l=j(n).toVar(),c=D(0).toVar(),h=D(1).toVar();return Bi(a,()=>{c.addAssign(h.mul(aX(l))),h.mulAssign(r),l.mulAssign(o)}),c}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),OJ=ie(([n,e,i,s])=>{const r=D(s).toVar(),o=D(i).toVar(),a=K(e).toVar(),l=j(n).toVar(),c=j(0).toVar(),h=D(1).toVar();return Bi(a,()=>{c.addAssign(h.mul(lX(l))),h.mulAssign(r),l.mulAssign(o)}),c}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Dxe=ie(([n,e,i,s])=>{const r=D(s).toVar(),o=D(i).toVar(),a=K(e).toVar(),l=j(n).toVar();return ae(TE(l,a,o,r),TE(l.add(j(K(19),K(193),K(17))),a,o,r))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),zxe=ie(([n,e,i,s])=>{const r=D(s).toVar(),o=D(i).toVar(),a=K(e).toVar(),l=j(n).toVar(),c=j(OJ(l,a,o,r)).toVar(),h=D(TE(l.add(j(K(19),K(193),K(17))),a,o,r)).toVar();return Qe(c,h)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Fxe=ie(([n,e,i,s,r,o,a])=>{const l=K(a).toVar(),c=D(o).toVar(),h=K(r).toVar(),d=K(s).toVar(),u=K(i).toVar(),p=K(e).toVar(),g=ae(n).toVar(),f=j(UJ(ae(p.add(d),u.add(h)))).toVar(),A=ae(f.x,f.y).toVar();A.subAssign(.5),A.mulAssign(c),A.addAssign(.5);const y=ae(ae(D(p),D(u)).add(A)).toVar(),b=ae(y.sub(g)).toVar();return Gt(l.equal(K(2)),()=>Sn(b.x).add(Sn(b.y))),Gt(l.equal(K(3)),()=>Li(Sn(b.x),Sn(b.y))),As(b,b)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Uxe=ie(([n,e,i,s,r,o,a,l,c])=>{const h=K(c).toVar(),d=D(l).toVar(),u=K(a).toVar(),p=K(o).toVar(),g=K(r).toVar(),f=K(s).toVar(),A=K(i).toVar(),y=K(e).toVar(),b=j(n).toVar(),v=j(UJ(j(y.add(g),A.add(p),f.add(u)))).toVar();v.subAssign(.5),v.mulAssign(d),v.addAssign(.5);const x=j(j(D(y),D(A),D(f)).add(v)).toVar(),w=j(x.sub(b)).toVar();return Gt(h.equal(K(2)),()=>Sn(w.x).add(Sn(w.y)).add(Sn(w.z))),Gt(h.equal(K(3)),()=>Li(Li(Sn(w.x),Sn(w.y)),Sn(w.z))),As(w,w)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Jy=yo([Fxe,Uxe]),Oxe=ie(([n,e,i])=>{const s=K(i).toVar(),r=D(e).toVar(),o=ae(n).toVar(),a=K().toVar(),l=K().toVar(),c=ae(Qn(o.x,a),Qn(o.y,l)).toVar(),h=D(1e6).toVar();return Bi({start:-1,end:K(1),name:"x",condition:"<="},({x:d})=>{Bi({start:-1,end:K(1),name:"y",condition:"<="},({y:u})=>{const p=D(Jy(c,d,u,a,l,r,s)).toVar();h.assign(Vr(h,p))})}),Gt(s.equal(K(0)),()=>{h.assign(ph(h))}),h}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Zxe=ie(([n,e,i])=>{const s=K(i).toVar(),r=D(e).toVar(),o=ae(n).toVar(),a=K().toVar(),l=K().toVar(),c=ae(Qn(o.x,a),Qn(o.y,l)).toVar(),h=ae(1e6,1e6).toVar();return Bi({start:-1,end:K(1),name:"x",condition:"<="},({x:d})=>{Bi({start:-1,end:K(1),name:"y",condition:"<="},({y:u})=>{const p=D(Jy(c,d,u,a,l,r,s)).toVar();Gt(p.lessThan(h.x),()=>{h.y.assign(h.x),h.x.assign(p)}).ElseIf(p.lessThan(h.y),()=>{h.y.assign(p)})})}),Gt(s.equal(K(0)),()=>{h.assign(ph(h))}),h}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Wxe=ie(([n,e,i])=>{const s=K(i).toVar(),r=D(e).toVar(),o=ae(n).toVar(),a=K().toVar(),l=K().toVar(),c=ae(Qn(o.x,a),Qn(o.y,l)).toVar(),h=j(1e6,1e6,1e6).toVar();return Bi({start:-1,end:K(1),name:"x",condition:"<="},({x:d})=>{Bi({start:-1,end:K(1),name:"y",condition:"<="},({y:u})=>{const p=D(Jy(c,d,u,a,l,r,s)).toVar();Gt(p.lessThan(h.x),()=>{h.z.assign(h.y),h.y.assign(h.x),h.x.assign(p)}).ElseIf(p.lessThan(h.y),()=>{h.z.assign(h.y),h.y.assign(p)}).ElseIf(p.lessThan(h.z),()=>{h.z.assign(p)})})}),Gt(s.equal(K(0)),()=>{h.assign(ph(h))}),h}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Hxe=ie(([n,e,i])=>{const s=K(i).toVar(),r=D(e).toVar(),o=j(n).toVar(),a=K().toVar(),l=K().toVar(),c=K().toVar(),h=j(Qn(o.x,a),Qn(o.y,l),Qn(o.z,c)).toVar(),d=D(1e6).toVar();return Bi({start:-1,end:K(1),name:"x",condition:"<="},({x:u})=>{Bi({start:-1,end:K(1),name:"y",condition:"<="},({y:p})=>{Bi({start:-1,end:K(1),name:"z",condition:"<="},({z:g})=>{const f=D(Jy(h,u,p,g,a,l,c,r,s)).toVar();d.assign(Vr(d,f))})})}),Gt(s.equal(K(0)),()=>{d.assign(ph(d))}),d}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Qxe=yo([Oxe,Hxe]),Kxe=ie(([n,e,i])=>{const s=K(i).toVar(),r=D(e).toVar(),o=j(n).toVar(),a=K().toVar(),l=K().toVar(),c=K().toVar(),h=j(Qn(o.x,a),Qn(o.y,l),Qn(o.z,c)).toVar(),d=ae(1e6,1e6).toVar();return Bi({start:-1,end:K(1),name:"x",condition:"<="},({x:u})=>{Bi({start:-1,end:K(1),name:"y",condition:"<="},({y:p})=>{Bi({start:-1,end:K(1),name:"z",condition:"<="},({z:g})=>{const f=D(Jy(h,u,p,g,a,l,c,r,s)).toVar();Gt(f.lessThan(d.x),()=>{d.y.assign(d.x),d.x.assign(f)}).ElseIf(f.lessThan(d.y),()=>{d.y.assign(f)})})})}),Gt(s.equal(K(0)),()=>{d.assign(ph(d))}),d}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Yxe=yo([Zxe,Kxe]),jxe=ie(([n,e,i])=>{const s=K(i).toVar(),r=D(e).toVar(),o=j(n).toVar(),a=K().toVar(),l=K().toVar(),c=K().toVar(),h=j(Qn(o.x,a),Qn(o.y,l),Qn(o.z,c)).toVar(),d=j(1e6,1e6,1e6).toVar();return Bi({start:-1,end:K(1),name:"x",condition:"<="},({x:u})=>{Bi({start:-1,end:K(1),name:"y",condition:"<="},({y:p})=>{Bi({start:-1,end:K(1),name:"z",condition:"<="},({z:g})=>{const f=D(Jy(h,u,p,g,a,l,c,r,s)).toVar();Gt(f.lessThan(d.x),()=>{d.z.assign(d.y),d.y.assign(d.x),d.x.assign(f)}).ElseIf(f.lessThan(d.y),()=>{d.z.assign(d.y),d.y.assign(f)}).ElseIf(f.lessThan(d.z),()=>{d.z.assign(f)})})})}),Gt(s.equal(K(0)),()=>{d.assign(ph(d))}),d}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Jxe=yo([Wxe,jxe]),qxe=ie(([n])=>{const e=n.y,i=n.z,s=j().toVar();return Gt(e.lessThan(1e-4),()=>{s.assign(j(i,i,i))}).Else(()=>{let r=n.x;r=r.sub(ym(r)).mul(6).toVar();const o=K(NN(r)),a=r.sub(D(o)),l=i.mul(e.oneMinus()),c=i.mul(e.mul(a).oneMinus()),h=i.mul(e.mul(a.oneMinus()).oneMinus());Gt(o.equal(K(0)),()=>{s.assign(j(i,h,l))}).ElseIf(o.equal(K(1)),()=>{s.assign(j(c,i,l))}).ElseIf(o.equal(K(2)),()=>{s.assign(j(l,i,h))}).ElseIf(o.equal(K(3)),()=>{s.assign(j(l,c,i))}).ElseIf(o.equal(K(4)),()=>{s.assign(j(h,l,i))}).Else(()=>{s.assign(j(i,l,c))})}),s}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),$xe=ie(([n])=>{const e=j(n).toVar(),i=D(e.x).toVar(),s=D(e.y).toVar(),r=D(e.z).toVar(),o=D(Vr(i,Vr(s,r))).toVar(),a=D(Li(i,Li(s,r))).toVar(),l=D(a.sub(o)).toVar(),c=D().toVar(),h=D().toVar(),d=D().toVar();return d.assign(a),Gt(a.greaterThan(0),()=>{h.assign(l.div(a))}).Else(()=>{h.assign(0)}),Gt(h.lessThanEqual(0),()=>{c.assign(0)}).Else(()=>{Gt(i.greaterThanEqual(a),()=>{c.assign(s.sub(r).div(l))}).ElseIf(s.greaterThanEqual(a),()=>{c.assign(Hn(2,r.sub(i).div(l)))}).Else(()=>{c.assign(Hn(4,i.sub(s).div(l)))}),c.mulAssign(1/6),Gt(c.lessThan(0),()=>{c.addAssign(1)})}),j(c,h,d)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),e1e=ie(([n])=>{const e=j(n).toVar(),i=bN(LN(e,j(.04045))).toVar(),s=j(e.div(12.92)).toVar(),r=j(Ca(Li(e.add(j(.055)),j(0)).div(1.055),j(2.4))).toVar();return Ai(s,r,i)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),ZJ=(n,e)=>{n=D(n),e=D(e);const i=ae(e.dFdx(),e.dFdy()).length().mul(.7071067811865476);return Sa(n.sub(i),n.add(i),e)},WJ=(n,e,i,s)=>Ai(n,e,i[s].clamp()),t1e=(n,e,i=yi())=>WJ(n,e,i,"x"),i1e=(n,e,i=yi())=>WJ(n,e,i,"y"),HJ=(n,e,i,s,r)=>Ai(n,e,ZJ(i,s[r])),n1e=(n,e,i,s=yi())=>HJ(n,e,i,s,"x"),s1e=(n,e,i,s=yi())=>HJ(n,e,i,s,"y"),r1e=(n=1,e=0,i=yi())=>i.mul(n).add(e),o1e=(n,e=1)=>(n=D(n),n.abs().pow(e).mul(n.sign())),a1e=(n,e=1,i=.5)=>D(n).sub(i).mul(e).add(i),l1e=(n=yi(),e=1,i=0)=>aX(n.convert("vec2|vec3")).mul(e).add(i),c1e=(n=yi(),e=1,i=0)=>lX(n.convert("vec2|vec3")).mul(e).add(i),h1e=(n=yi(),e=1,i=0)=>(n=n.convert("vec2|vec3"),Qe(lX(n),aX(n.add(ae(19,73)))).mul(e).add(i)),d1e=(n=yi(),e=1)=>Qxe(n.convert("vec2|vec3"),e,K(1)),u1e=(n=yi(),e=1)=>Yxe(n.convert("vec2|vec3"),e,K(1)),p1e=(n=yi(),e=1)=>Jxe(n.convert("vec2|vec3"),e,K(1)),m1e=(n=yi())=>Gxe(n.convert("vec2|vec3")),g1e=(n=yi(),e=3,i=2,s=.5,r=1)=>TE(n,K(e),i,s).mul(r),f1e=(n=yi(),e=3,i=2,s=.5,r=1)=>Dxe(n,K(e),i,s).mul(r),A1e=(n=yi(),e=3,i=2,s=.5,r=1)=>OJ(n,K(e),i,s).mul(r),y1e=(n=yi(),e=3,i=2,s=.5,r=1)=>zxe(n,K(e),i,s).mul(r),QJ=ie(([n,e])=>{const i=n.x,s=n.y,r=n.z;let o=e.element(0).mul(.886227);return o=o.add(e.element(1).mul(2*.511664).mul(s)),o=o.add(e.element(2).mul(2*.511664).mul(r)),o=o.add(e.element(3).mul(2*.511664).mul(i)),o=o.add(e.element(4).mul(2*.429043).mul(i).mul(s)),o=o.add(e.element(5).mul(2*.429043).mul(s).mul(r)),o=o.add(e.element(6).mul(r.mul(r).mul(.743125).sub(.247708))),o=o.add(e.element(7).mul(2*.429043).mul(i).mul(r)),o=o.add(e.element(8).mul(.429043).mul(wi(i,i).sub(wi(s,s)))),o});class KJ extends Cm{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=tt(0).setGroup(Zi),this.decayExponentNode=tt(0).setGroup(Zi)}update(e){const{light:i}=this;super.update(e),this.cutoffDistanceNode.value=i.distance,this.decayExponentNode.value=i.decay}setup(e){const{colorNode:i,cutoffDistanceNode:s,decayExponentNode:r,light:o}=this,a=e.context.lightingModel,l=_E(o).sub(Ao),c=l.normalize(),h=l.length(),d=tX({lightDistance:h,cutoffDistance:s,decayExponent:r}),u=i.mul(d),p=e.context.reflectedLight;a.direct({lightDirection:c,lightColor:u,reflectedLight:p},e.stack,e)}}class YJ extends Cm{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setup(e){super.setup(e);const i=e.context.lightingModel,s=this.colorNode,r=sX(this.light),o=e.context.reflectedLight;i.direct({lightDirection:r,lightColor:s,reflectedLight:o},e.stack,e)}}const cX=new de,EE=new de;let uw=null;class jJ extends Cm{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=tt(new E).setGroup(Zi),this.halfWidth=tt(new E).setGroup(Zi)}update(e){super.update(e);const{light:i}=this,s=e.camera.matrixWorldInverse;EE.identity(),cX.copy(i.matrixWorld),cX.premultiply(s),EE.extractRotation(cX),this.halfWidth.value.set(i.width*.5,0,0),this.halfHeight.value.set(0,i.height*.5,0),this.halfWidth.value.applyMatrix4(EE),this.halfHeight.value.applyMatrix4(EE)}setup(e){super.setup(e);let i,s;e.isAvailable("float32Filterable")?(i=zi(uw.LTC_FLOAT_1),s=zi(uw.LTC_FLOAT_2)):(i=zi(uw.LTC_HALF_1),s=zi(uw.LTC_HALF_2));const{colorNode:r,light:o}=this,a=e.context.lightingModel,l=_E(o),c=e.context.reflectedLight;a.directRectArea({lightColor:r,lightPosition:l,halfWidth:this.halfWidth,halfHeight:this.halfHeight,reflectedLight:c,ltc_1:i,ltc_2:s},e.stack,e)}static setLTC(e){uw=e}}class hX extends Cm{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=tt(0).setGroup(Zi),this.penumbraCosNode=tt(0).setGroup(Zi),this.cutoffDistanceNode=tt(0).setGroup(Zi),this.decayExponentNode=tt(0).setGroup(Zi)}update(e){super.update(e);const{light:i}=this;this.coneCosNode.value=Math.cos(i.angle),this.penumbraCosNode.value=Math.cos(i.angle*(1-i.penumbra)),this.cutoffDistanceNode.value=i.distance,this.decayExponentNode.value=i.decay}getSpotAttenuation(e){const{coneCosNode:i,penumbraCosNode:s}=this;return Sa(i,s,e)}setup(e){super.setup(e);const i=e.context.lightingModel,{colorNode:s,cutoffDistanceNode:r,decayExponentNode:o,light:a}=this,l=_E(a).sub(Ao),c=l.normalize(),h=c.dot(sX(a)),d=this.getSpotAttenuation(h),u=l.length(),p=tX({lightDistance:u,cutoffDistance:r,decayExponent:o}),g=s.mul(d).mul(p),f=e.context.reflectedLight;i.direct({lightDirection:c,lightColor:g,reflectedLight:f},e.stack,e)}}class JJ extends hX{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e){const i=this.light.iesMap;let s=null;if(i&&i.isTexture===!0){const r=e.acos().mul(1/Math.PI);s=zi(i,ae(r,0),0).r}else s=super.getSpotAttenuation(e);return s}}class qJ extends Cm{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class $J extends Cm{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=nX(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=tt(new fe).setGroup(Zi)}update(e){const{light:i}=this;super.update(e),this.lightPositionNode.object3d=i,this.groundColorNode.value.copy(i.groundColor).multiplyScalar(i.intensity)}setup(e){const{colorNode:i,groundColorNode:s,lightDirectionNode:r}=this,o=Ml.dot(r).mul(.5).add(.5),a=Ai(s,i,o);e.context.irradiance.addAssign(a)}}class e6 extends Cm{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const i=[];for(let s=0;s<9;s++)i.push(new E);this.lightProbe=gd(i)}update(e){const{light:i}=this;super.update(e);for(let s=0;s<9;s++)this.lightProbe.array[s].copy(i.sh.coefficients[s]).multiplyScalar(i.intensity)}setup(e){const i=QJ(QT,this.lightProbe);e.context.irradiance.addAssign(i)}}class b1e{parseFunction(){console.warn("Abstract function.")}}class t6{constructor(e,i,s="",r=""){this.type=e,this.inputs=i,this.name=s,this.precision=r}getCode(){console.warn("Abstract function.")}}t6.isNodeFunction=!0;const v1e=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,x1e=/[a-z_0-9]+/ig,i6="#pragma main",w1e=n=>{n=n.trim();const e=n.indexOf(i6),i=e!==-1?n.slice(e+i6.length):n,s=i.match(v1e);if(s!==null&&s.length===5){const r=s[4],o=[];let a=null;for(;(a=x1e.exec(r))!==null;)o.push(a);const l=[];let c=0;for(;c<o.length;){const f=o[c][0]==="const";f===!0&&c++;let A=o[c][0];A==="in"||A==="out"||A==="inout"?c++:A="";const y=o[c++][0];let b=Number.parseInt(o[c][0]);Number.isNaN(b)===!1?c++:b=null;const v=o[c++][0];l.push(new ZV(y,v,b,A,f))}const h=i.substring(s[0].length),d=s[3]!==void 0?s[3]:"",u=s[2],p=s[1]!==void 0?s[1]:"",g=e!==-1?n.slice(0,e):"";return{type:u,inputs:l,name:d,precision:p,inputsCode:r,blockCode:h,headerCode:g}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class C1e extends t6{constructor(e){const{type:i,inputs:s,name:r,precision:o,inputsCode:a,blockCode:l,headerCode:c}=w1e(e);super(i,s,r,o),this.inputsCode=a,this.blockCode=l,this.headerCode=c}getCode(e=this.name){let i;const s=this.blockCode;if(s!==""){const{type:r,inputsCode:o,headerCode:a,precision:l}=this;let c=`${r} ${e} ( ${o.trim()} )`;l!==""&&(c=`${l} ${c}`),i=a+c+s}else i="";return i}}class S1e extends b1e{parseFunction(e){return new C1e(e)}}class _1e{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map,this.colorSpaceNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let i=null;const s=this.getMaterialNodeClass(e.type);if(s!==null){i=new s;for(const r in e)i[r]=e[r]}return i}addColorSpace(e,i){this.addType(e,i,this.colorSpaceNodes)}getColorSpaceFunction(e){return this.colorSpaceNodes.get(e)||null}addToneMapping(e,i){this.addType(e,i,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,i){this.addType(e,i.name,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,i){this.addClass(e,i,this.lightNodes)}addType(e,i,s){if(s.has(i)){console.warn(`Redefinition of node ${i}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof i=="function"||typeof i=="object")throw new Error(`Base class ${i} is not a class.`);s.set(i,e)}addClass(e,i,s){if(s.has(i)){console.warn(`Redefinition of node ${i.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof i!="function")throw new Error(`Base class ${i.name} is not a class.`);s.set(i,e)}}class M1e extends Gf{constructor(e,i,s,r,o,a){super(e,i,s,r,o,a),this.iesMap=null}copy(e,i){return super.copy(e,i),this.iesMap=e.iesMap,this}}class n6 extends _1e{constructor(){super(),this.addLight(KJ,dm),this.addLight(YJ,um),this.addLight(jJ,WP),this.addLight(hX,Gf),this.addLight(qJ,S1),this.addLight($J,fT),this.addLight(e6,HP),this.addLight(JJ,M1e),this.addToneMapping(LJ,af),this.addToneMapping(BJ,HA),this.addToneMapping(kJ,hG),this.addToneMapping(GJ,QA),this.addToneMapping(PJ,lf),this.addToneMapping(NJ,Kp),this.addColorSpace(RJ,UT(qi,ut)),this.addColorSpace(EJ,UT(ut,qi))}}if(typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:fa}})),typeof window<"u"){try{import.meta&&(window.__THREE__IMPORTS__||(window.__THREE__IMPORTS__=[]),window.__THREE__IMPORTS__.push({url:import.meta.url,revision:fa}))}catch{}window.__THREE__?(console.warn("WARNING: Multiple instances of Three.js being imported. Existing: "+window.__THREE__+", new: "+fa),console.warn(window.__THREE__IMPORTS__)):window.__THREE__=fa}const I1e=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:QA,AONode:aY,AddEquation:Hp,AddOperation:cG,AdditiveAnimationBlendMode:yG,AdditiveBlending:Wp,AfterImageNode:Hj,AgXToneMapping:lf,AlphaFormat:pG,AlwaysCompare:PW,AlwaysDepth:UA,AlwaysStencilFunc:uI,AmbientLight:S1,AmbientLightNode:qJ,AnaglyphPassNode:gJ,AnalyticLightNode:Cm,AnamorphicNode:Yj,AnimationAction:DH,AnimationClip:wa,AnimationLoader:Wge,AnimationMixer:xT,AnimationObjectGroup:hfe,AnimationUtils:Fge,ArcCurve:nH,ArrayCamera:sP,ArrayElementNode:gm,ArrowHelper:Sfe,AssignNode:MQ,AttachedBindMode:dG,AttributeNode:KN,Audio:YP,AudioAnalyser:efe,AudioContext:bT,AudioListener:PH,AudioLoader:vT,AxesHelper:Ya,BRDF_GGX:bV,BRDF_Lambert:Yf,BackSide:wn,BasicDepthPacking:co,BasicEnvironmentNode:nE,BasicNodeLibrary:n6,BasicShadowMap:dce,BatchNode:JK,BatchedMesh:u1,BloomNode:lJ,Bone:Tf,BooleanKeyframeTrack:Bf,Box2:ffe,Box3:gi,Box3Helper:tN,BoxGeometry:bn,BoxHelper:qH,Break:tE,BufferAttribute:ct,BufferAttributeNode:P4,BufferGeometry:Rt,BufferGeometryLoader:MH,BufferNode:YT,BumpMapNode:AK,BypassNode:z4,ByteType:Lx,Cache:Lu,CacheNode:D4,Camera:t1,CameraHelper:JH,CanvasTexture:vP,CapsuleGeometry:Pk,CatmullRomCurve3:sH,CineonToneMapping:hG,CircleGeometry:Nk,ClampToEdgeWrapping:Wo,Clock:KP,CodeNode:PV,Color:fe,ColorKeyframeTrack:mT,ColorManagement:hi,ColorSpaceNode:O1,CompressedArrayTexture:iH,CompressedCubeTexture:bP,CompressedTexture:od,CompressedTextureLoader:Hge,ComputeNode:V4,ConeGeometry:Vk,ConstNode:xc,ConstantAlphaFactor:hW,ConstantColorFactor:lW,ContextNode:FN,Continue:G0e,Controls:ET,ConvertNode:dN,CubeCamera:kI,CubeReflectionMapping:bl,CubeRefractionMapping:gc,CubeTexture:xf,CubeTextureLoader:Qge,CubeTextureNode:cK,CubeUVReflectionMapping:cf,CubicBezierCurve:_P,CubicBezierCurve3:oH,CubicInterpolant:bH,CullFaceBack:tG,CullFaceFront:YZ,CullFaceFrontBack:hce,CullFaceNone:KZ,Curve:bc,CurvePath:lH,CustomBlending:oG,CustomToneMapping:uW,CylinderGeometry:js,Cylindrical:gfe,DFGApprox:vV,D_GGX:_Y,Data3DTexture:gI,DataArrayTexture:Yx,DataTexture:nr,DataTextureLoader:FP,DataUtils:bf,DecrementStencilOp:vW,DecrementWrapStencilOp:wW,DefaultLoadingManager:zP,DenoiseNode:rJ,DepthFormat:df,DepthOfFieldNode:Jj,DepthStencilFormat:Jp,DepthTexture:Eu,DetachedBindMode:pW,DirectionalLight:um,DirectionalLightHelper:jH,DirectionalLightNode:YJ,Discard:W4,DiscreteInterpolant:vH,DisplayP3ColorSpace:Ux,DodecahedronGeometry:Xk,DotScreenNode:qj,DoubleSide:Qi,DstAlphaFactor:nW,DstColorFactor:rW,DynamicCopyUsage:Cce,DynamicDrawUsage:Fs,DynamicReadUsage:vce,EPSILON:HQ,EdgesGeometry:LP,EllipseCurve:iT,EnvironmentNode:JY,EqualCompare:LW,EqualDepth:Qp,EqualStencilFunc:_W,EquirectUVNode:yY,EquirectangularReflectionMapping:ao,EquirectangularRefractionMapping:Yp,Euler:Oi,EventDispatcher:yr,ExpressionNode:Z4,ExtrudeGeometry:wx,FXAANode:oJ,F_Schlick:Zy,FileLoader:Rs,FilmNode:eJ,Float16BufferAttribute:$W,Float32BufferAttribute:dt,FloatType:en,Fn:ie,Fog:FI,FogExp2:Gk,FogExp2Node:wJ,FogNode:wE,FogRangeNode:xJ,FramebufferTexture:yP,FrontFacingNode:eK,FrontSide:ms,Frustum:Cf,FunctionCallNode:TQ,FunctionNode:NV,FunctionOverloadingNode:Cj,GLBufferAttribute:mfe,GLSL1:_ce,GLSL3:pI,GLSLNodeParser:S1e,GTAONode:sJ,GaussianBlurNode:Zj,GreaterCompare:BW,GreaterDepth:ZA,GreaterEqualCompare:GW,GreaterEqualDepth:OA,GreaterEqualStencilFunc:EW,GreaterStencilFunc:IW,GridHelper:ST,Group:Es,HalfFloatType:Ki,HemisphereLight:fT,HemisphereLightHelper:xfe,HemisphereLightNode:$J,IESSpotLightNode:JJ,INFINITY:Yfe,IcosahedronGeometry:Dk,If:Gt,ImageBitmapLoader:RH,ImageLoader:w1,ImageUtils:UW,IncrementStencilOp:bW,IncrementWrapStencilOp:xW,IndexNode:Zn,InstanceNode:YK,InstancedBufferAttribute:Yo,InstancedBufferGeometry:AT,InstancedInterleavedBuffer:_1,InstancedMesh:dP,InstancedPointsNodeMaterial:Y0e,Int16BufferAttribute:che,Int32BufferAttribute:hhe,Int8BufferAttribute:ohe,IntType:nd,InterleavedBuffer:Cy,InterleavedBufferAttribute:xa,Interpolant:Ly,InterpolateDiscrete:qp,InterpolateLinear:xu,InterpolateSmooth:lI,InvertStencilOp:CW,IrradianceNode:hY,JoinNode:rQ,KeepStencilOp:$p,KeyframeTrack:ch,LOD:lP,LatheGeometry:Y_,Layers:Qo,LessCompare:wG,LessDepth:rf,LessEqualCompare:CG,LessEqualDepth:yu,LessEqualStencilFunc:MW,LessStencilFunc:SW,Light:hm,LightProbe:HP,LightProbeNode:e6,LightingContextNode:lY,LightingModel:ow,LightingNode:Kf,LightsNode:rY,Line:is,Line2NodeMaterial:tAe,Line3:vc,LineBasicMaterial:Cn,LineBasicNodeMaterial:J0e,LineCurve:MP,LineCurve3:aH,LineDashedMaterial:pT,LineDashedNodeMaterial:$0e,LineLoop:fP,LineSegments:Jo,LinearDisplayP3ColorSpace:ty,LinearFilter:Wt,LinearInterpolant:DP,LinearMipMapLinearFilter:mW,LinearMipMapNearestFilter:mce,LinearMipmapLinearFilter:Ar,LinearMipmapNearestFilter:vu,LinearSRGBColorSpace:qi,LinearToneMapping:af,LinearTransfer:Ox,Loader:fs,LoaderUtils:cd,LoadingManager:gT,Loop:Bi,LoopNode:tY,LoopOnce:zx,LoopPingPong:gW,LoopRepeat:AG,LuminanceAlphaFormat:gG,LuminanceFormat:Bx,Lut3DNode:tJ,MOUSE:nf,MRTNode:wj,MatcapUVNode:tj,Material:ti,MaterialLoader:J_,MaterialNode:Me,MaterialReferenceNode:hK,MathUtils:Di,Matrix2:NZ,Matrix3:oi,Matrix4:de,MaxEquation:aG,MaxMipLevelNode:Y4,Mesh:pe,MeshBasicMaterial:ai,MeshBasicNodeMaterial:hAe,MeshDepthMaterial:n1,MeshDistanceMaterial:iP,MeshLambertMaterial:uT,MeshLambertNodeMaterial:gAe,MeshMatcapMaterial:NP,MeshMatcapNodeMaterial:$Ae,MeshNormalMaterial:x1,MeshNormalNodeMaterial:sAe,MeshPhongMaterial:cm,MeshPhongNodeMaterial:AAe,MeshPhysicalMaterial:uo,MeshPhysicalNodeMaterial:ej,MeshSSSNodeMaterial:QAe,MeshStandardMaterial:Us,MeshStandardNodeMaterial:$Y,MeshToonMaterial:PP,MeshToonNodeMaterial:JAe,MinEquation:qZ,MirroredRepeatWrapping:bu,MixOperation:lG,ModelNode:mh,ModelViewProjectionNode:HK,MorphNode:nY,MultiplyBlending:rG,MultiplyOperation:WA,NearestFilter:si,NearestMipMapLinearFilter:pce,NearestMipMapNearestFilter:uce,NearestMipmapLinearFilter:id,NearestMipmapNearestFilter:Rx,NeutralToneMapping:Kp,NeverCompare:RW,NeverDepth:Ex,NeverStencilFunc:xG,NoBlending:Pn,NoColorSpace:ho,NoToneMapping:kr,Node:Jt,NodeAttribute:BV,NodeBuilder:zye,NodeCache:dE,NodeCode:hj,NodeFrame:xj,NodeFunctionInput:ZV,NodeLoader:oj,NodeMaterial:Yi,NodeMaterialLoader:aj,NodeMaterialObserver:tQ,NodeObjectLoader:cye,NodeShaderStage:lN,NodeType:Tfe,NodeUniform:lj,NodeUpdateType:Ht,NodeUtils:Ife,NodeVar:kV,NodeVarying:cj,NormalAnimationBlendMode:cI,NormalBlending:Au,NormalMapNode:fK,NotEqualCompare:kW,NotEqualDepth:of,NotEqualStencilFunc:TW,NumberKeyframeTrack:Ru,Object3D:Ae,Object3DNode:$i,ObjectLoader:IH,ObjectSpaceNormalMap:vG,OctahedronGeometry:Np,OneFactor:eW,OneMinusConstantAlphaFactor:dW,OneMinusConstantColorFactor:cW,OneMinusDstAlphaFactor:sW,OneMinusDstColorFactor:oW,OneMinusSrcAlphaFactor:XM,OneMinusSrcColorFactor:iW,OrthographicCamera:lh,OscNode:Br,OutputStructNode:WV,P3Primaries:Wx,PCFShadowMap:iG,PCFSoftShadowMap:nG,PI:Wf,PI2:jfe,PMREMGenerator:qG,PMREMNode:KY,ParallaxBarrierPassNode:fJ,ParameterNode:GV,PassNode:so,Path:f1,PerspectiveCamera:Ot,PhongLightingModel:AV,PhysicalLightingModel:oE,PixelationPassNode:hJ,Plane:tr,PlaneGeometry:Xs,PlaneHelper:Cfe,PointLight:dm,PointLightHelper:bfe,PointLightNode:KJ,PointUVNode:kj,Points:Ey,PointsMaterial:rd,PointsNodeMaterial:tye,PolarGridHelper:wfe,PolyhedronGeometry:jg,PositionalAudio:VH,PosterizeNode:Xj,PropertyBinding:xi,PropertyMixer:XH,PropertyNode:tn,QuadraticBezierCurve:IP,QuadraticBezierCurve3:TP,Quaternion:Fe,QuaternionKeyframeTrack:ad,QuaternionLinearInterpolant:xH,RED_GREEN_RGTC2_Format:oI,RED_RGTC1_Format:fG,REVISION:fa,RGBADepthPacking:dI,RGBAFormat:_i,RGBAIntegerFormat:uf,RGBA_ASTC_10x10_Format:eI,RGBA_ASTC_10x5_Format:JM,RGBA_ASTC_10x6_Format:qM,RGBA_ASTC_10x8_Format:$M,RGBA_ASTC_12x10_Format:tI,RGBA_ASTC_12x12_Format:iI,RGBA_ASTC_4x4_Format:qA,RGBA_ASTC_5x4_Format:WM,RGBA_ASTC_5x5_Format:HM,RGBA_ASTC_6x5_Format:QM,RGBA_ASTC_6x6_Format:$A,RGBA_ASTC_8x5_Format:KM,RGBA_ASTC_8x6_Format:YM,RGBA_ASTC_8x8_Format:jM,RGBA_BPTC_Format:ey,RGBA_ETC2_EAC_Format:Dx,RGBA_PVRTC_2BPPV1_Format:ZM,RGBA_PVRTC_4BPPV1_Format:Nx,RGBA_S3TC_DXT1_Format:jA,RGBA_S3TC_DXT3_Format:Gx,RGBA_S3TC_DXT5_Format:JA,RGBDepthPacking:fce,RGBFormat:mG,RGBIntegerFormat:gce,RGBShiftNode:$j,RGB_BPTC_SIGNED_Format:nI,RGB_BPTC_UNSIGNED_Format:sI,RGB_ETC1_Format:Vx,RGB_ETC2_Format:Xx,RGB_PVRTC_2BPPV1_Format:OM,RGB_PVRTC_4BPPV1_Format:Px,RGB_S3TC_DXT1_Format:kx,RGDepthPacking:Ace,RGFormat:fc,RGIntegerFormat:YA,RTTNode:Rj,RangeNode:CJ,RawShaderMaterial:dT,Ray:ya,Raycaster:pm,Rec709Primaries:Zx,RectAreaLight:WP,RectAreaLightNode:jJ,RedFormat:vl,RedIntegerFormat:KA,ReferenceNode:K1,ReflectorNode:Ej,ReinhardToneMapping:HA,RemapNode:QN,RenderOutputNode:H4,RenderTarget:br,RendererReferenceNode:R4,RepeatWrapping:lo,ReplaceStencilOp:yW,Return:t0e,ReverseSubtractEquation:JZ,RingGeometry:j_,RotateNode:nj,SIGNED_RED_GREEN_RGTC2_Format:aI,SIGNED_RED_RGTC1_Format:rI,SRGBColorSpace:ut,SRGBTransfer:Nn,SSAAPassNode:dJ,Scene:ir,SceneNode:$h,Schlick_to_F0:IY,ScreenNode:qs,ScriptableNode:vJ,ScriptableValueNode:yJ,SetNode:oQ,ShaderChunk:Zt,ShaderLib:Wn,ShaderMaterial:jt,ShaderNode:E1,ShadowMaterial:v1,ShadowNodeMaterial:oye,Shape:lm,ShapeGeometry:zk,ShapePath:eQ,ShapeUtils:jh,ShortType:zM,Skeleton:l1,SkeletonHelper:yfe,SkinnedMesh:Ka,SkinningNode:cV,SobelOperatorNode:jj,Source:wu,Sphere:Vn,SphereGeometry:eh,Spherical:$P,SphericalHarmonics3:_H,SplineCurve:EP,SplitNode:RT,SpotLight:Gf,SpotLightHelper:Afe,SpotLightNode:hX,Sprite:aP,SpriteMaterial:s1,SpriteNodeMaterial:nye,SpriteSheetUVNode:Sj,SrcAlphaFactor:VM,SrcAlphaSaturateFactor:aW,SrcColorFactor:tW,StackNode:uj,StaticCopyUsage:wce,StaticDrawUsage:iy,StaticReadUsage:bce,StereoCamera:QP,StereoPassNode:uJ,StorageArrayElementNode:_j,StorageBufferNode:qV,StorageTextureNode:Pj,StreamCopyUsage:Sce,StreamDrawUsage:yce,StreamReadUsage:xce,StringKeyframeTrack:kf,SubtractEquation:jZ,SubtractiveBlending:sG,TBNViewMatrix:Qf,TOUCH:sf,TangentSpaceNormalMap:sd,TempNode:Ti,TetrahedronGeometry:Fk,Texture:di,Texture3DNode:sj,TextureLoader:hh,TextureNode:pd,TextureSizeNode:K4,TextureUtils:Hme,TimerNode:oo,ToneMappingNode:B4,ToonOutlinePassNode:AJ,TorusGeometry:Vp,TorusKnotGeometry:Uk,TransitionNode:cJ,Triangle:$s,TriangleFanDrawMode:hI,TriangleStripDrawMode:bG,TrianglesDrawMode:fW,TriplanarTexturesNode:Mj,TubeGeometry:Ok,UVMapping:DM,Uint16BufferAttribute:_I,Uint32BufferAttribute:OG,Uint8BufferAttribute:ahe,Uint8ClampedBufferAttribute:lhe,Uniform:Te,UniformArrayNode:$N,UniformGroupNode:vN,UniformNode:Ff,UniformsGroup:pfe,UniformsLib:ht,UniformsUtils:Ay,UnsignedByteType:Xi,UnsignedInt248Type:jp,UnsignedInt5999Type:uG,UnsignedIntType:Gr,UnsignedShort4444Type:FM,UnsignedShort5551Type:UM,UnsignedShortType:hf,UserDataNode:Vj,VSMShadowMap:Ha,V_GGX_SmithCorrelated:SY,VarNode:C4,VaryingNode:S4,Vector2:Q,Vector3:E,Vector4:$e,VectorKeyframeTrack:ld,VertexColorNode:Bj,VideoTexture:tH,ViewportDepthNode:Wa,ViewportDepthTextureNode:mY,ViewportSharedTextureNode:Dj,ViewportTextureNode:nw,VolumeNodeMaterial:lye,WebGL3DRenderTarget:jce,WebGLArrayRenderTarget:Yce,WebGLCoordinateSystem:Ac,WebGLCubeRenderTarget:GI,WebGLMultipleRenderTargets:_fe,WebGLRenderTarget:fi,WebGLRenderer:om,WebGLUtils:G9,WebGPUCoordinateSystem:gf,WireframeGeometry:GP,WrapAroundEnding:Fx,ZeroCurvatureEnding:pf,ZeroFactor:$Z,ZeroSlopeEnding:mf,ZeroStencilOp:AW,abs:Sn,acesFilmicToneMapping:GJ,acos:zT,add:Hn,addMethodChaining:Be,addNodeElement:i0e,afterImage:bbe,agxToneMapping:PJ,all:BN,alphaT:NT,anaglyphPass:tve,anamorphic:_be,and:PQ,anisotropy:Am,anisotropyB:Of,anisotropyT:P1,any:QQ,ao:Pbe,append:mQ,arrayBuffer:Wfe,asin:$Q,assign:IQ,atan:e4,atan2:c4,atomicAdd:$ve,atomicAnd:nxe,atomicFunc:Nu,atomicMax:txe,atomicMin:ixe,atomicOr:sxe,atomicStore:qve,atomicSub:exe,atomicXor:rxe,attenuationColor:TN,attenuationDistance:IN,attribute:Xr,backgroundBlurriness:abe,backgroundIntensity:lbe,batch:qK,billboarding:Sve,bitAnd:DQ,bitNot:zQ,bitOr:FQ,bitXor:UQ,bitangentGeometry:w0e,bitangentLocal:C0e,bitangentView:uK,bitangentWorld:S0e,bitcast:Jfe,bleach:kve,bloom:Zbe,blur:HY,bool:fm,buffer:Q1,bufferAttribute:Z1,bumpMap:yK,burn:Tve,bvec2:AQ,bvec3:bN,bvec4:xQ,bypass:F4,cache:W1,call:EQ,cameraFar:Xy,cameraLogDepth:J4,cameraNear:Vy,cameraNormalMatrix:o0e,cameraPosition:YN,cameraProjectionMatrix:qa,cameraProjectionMatrixInverse:s0e,cameraViewMatrix:$a,cameraWorldMatrix:r0e,cbrt:f4,ceil:PN,checker:oxe,cineonToneMapping:kJ,clamp:rr,clearcoat:kT,clearcoatRoughness:G1,code:uE,color:gQ,colorSpaceToWorking:WN,colorToDirection:iAe,compute:X4,cond:x4,context:UN,convert:CQ,convertToTexture:_a,cos:_l,createCanvasElement:XW,cross:Ny,cubeTexture:KT,dFdx:n4,dFdy:s4,dashSize:Zf,defaultBuildStages:cN,defaultShaderStages:sQ,defined:T1,degrees:jQ,denoise:Xbe,densityFog:lve,depth:gV,depthPass:Abe,difference:u4,diffuseColor:on,directionToColor:AY,dispersion:EN,distance:d4,div:uh,dodge:Eve,dof:Ibe,dot:As,dotScreen:Tbe,drawIndex:KK,dynamicBufferAttribute:N4,element:wQ,emissive:wN,equal:RQ,equals:KQ,equirectUV:fV,exp:kN,exp2:DT,expression:vm,faceDirection:H1,faceForward:y4,film:Rbe,float:D,floor:ym,fog:ove,fract:bm,frameGroup:Qfe,frameId:Hye,frontFacing:tK,fwidth:a4,fxaa:Dbe,gain:yve,gapSize:V1,gaussianBlur:ybe,getColorSpaceMethod:UT,getConstNodeType:pQ,getCurrentStack:yN,getDirection:ZY,getDistanceAttenuation:tX,getGeometryRoughness:CY,getRoughness:yV,getShIrradianceAt:QJ,getTextureIndex:HV,global:xE,glsl:mye,glslFn:gye,grayscale:vbe,greaterThan:LN,greaterThanEqual:GQ,hash:Ave,highPrecisionModelNormalViewMatrix:A0e,highPrecisionModelViewMatrix:f0e,hue:Cbe,instance:jK,instanceIndex:$1,instancedBufferAttribute:OT,instancedDynamicBufferAttribute:HN,int:K,inverseSqrt:JQ,invocationLocalIndex:B0e,invocationSubgroupIndex:L0e,ior:X1,iridescence:PT,iridescenceIOR:CN,iridescenceThickness:SN,ivec2:dd,ivec3:yQ,ivec4:bQ,js:uye,label:w4,length:Hf,lengthSq:XN,lessThan:BQ,lessThanEqual:kQ,lightPosition:nX,lightTargetDirection:sX,lightTargetPosition:SJ,lightViewPosition:_E,lightingContext:cY,lights:oY,linearDepth:iE,linearSRGBTosRGB:RJ,linearToneMapping:LJ,localId:Uve,log:GN,log2:D1,loop:P0e,luminance:bo,lut3D:Lbe,mat2:B1,mat3:Nr,mat4:zf,matcapUV:ij,materialAOMap:WK,materialAlphaTest:vK,materialAnisotropy:GK,materialAnisotropyVector:Fy,materialAttenuationColor:UK,materialAttenuationDistance:FK,materialClearcoat:TK,materialClearcoatNormal:RK,materialClearcoatRoughness:EK,materialColor:zy,materialDispersion:ZK,materialEmissive:wK,materialIOR:zK,materialIridescence:PK,materialIridescenceIOR:NK,materialIridescenceThickness:VK,materialLightMap:aV,materialLineDashOffset:oV,materialLineDashSize:sV,materialLineGapSize:rV,materialLineScale:$T,materialLineWidth:eE,materialMetalness:MK,materialNormal:IK,materialOpacity:JT,materialPointWidth:OK,materialReference:gh,materialReflectivity:qT,materialRefractionRatio:sK,materialRotation:LK,materialRoughness:_K,materialSheen:BK,materialSheenRoughness:kK,materialShininess:xK,materialSpecular:CK,materialSpecularColor:SK,materialSpecularIntensity:nV,materialSpecularStrength:q1,materialThickness:DK,materialTransmission:XK,max:Li,maxMipLevel:j4,metalness:k1,min:Vr,mix:Ai,mixElement:b4,mod:FT,modInt:RN,modelDirection:u0e,modelNormalMatrix:q4,modelPosition:p0e,modelScale:m0e,modelViewMatrix:md,modelViewPosition:g0e,modelViewProjection:lV,modelWorldMatrix:Cc,modelWorldMatrixInverse:$4,morphReference:sY,motionBlur:Bve,mrt:fE,mul:wi,mx_aastep:ZJ,mx_cell_noise_float:m1e,mx_contrast:a1e,mx_fractal_noise_float:g1e,mx_fractal_noise_vec2:f1e,mx_fractal_noise_vec3:A1e,mx_fractal_noise_vec4:y1e,mx_hsvtorgb:qxe,mx_noise_float:l1e,mx_noise_vec3:c1e,mx_noise_vec4:h1e,mx_ramplr:t1e,mx_ramptb:i1e,mx_rgbtohsv:$xe,mx_safepower:o1e,mx_splitlr:n1e,mx_splittb:s1e,mx_srgb_texture_to_lin_rec709:e1e,mx_transform_uv:r1e,mx_worley_noise_float:d1e,mx_worley_noise_vec2:u1e,mx_worley_noise_vec3:p1e,negate:t4,neutralToneMapping:NJ,nodeArray:Df,nodeImmutable:it,nodeObject:ge,nodeObjects:R1,nodeProxy:Ce,normalFlat:iK,normalGeometry:HT,normalLocal:el,normalMap:iV,normalView:Ml,normalWorld:QT,normalize:Sl,not:VQ,notEqual:LQ,numWorkgroups:zve,objectDirection:a0e,objectGroup:_Q,objectPosition:c0e,objectScale:h0e,objectViewPosition:d0e,objectWorldMatrix:l0e,oneMinus:i4,or:NQ,orthographicDepthToViewZ:Z0e,oscSawtooth:jye,oscSine:Qye,oscSquare:Kye,oscTriangle:Yye,output:_N,outputStruct:Uye,overlay:Lve,overloadingFn:yo,parabola:rX,parallaxBarrierPass:ive,parallaxDirection:mK,parallaxUV:M0e,parameter:dye,pass:fbe,passTexture:Yy,pcurve:bve,perspectiveDepthToViewZ:mV,pixelationPass:Kbe,pmremTexture:YY,pointUV:obe,pointWidth:Kfe,positionGeometry:fo,positionLocal:Bs,positionPrevious:ZT,positionView:Ao,positionViewDirection:Xn,positionWorld:WT,positionWorldDirection:jN,posterize:pbe,pow:Ca,pow2:VN,pow3:p4,pow4:m4,property:ja,radians:YQ,rand:zN,range:cve,rangeFog:ave,reciprocal:o4,reference:wr,referenceBuffer:eV,reflect:h4,reflectVector:aK,reflectView:rK,reflector:tbe,refract:DN,refractVector:lK,refractView:oK,reinhardToneMapping:BJ,remainder:WQ,remap:U4,remapClamp:O4,renderGroup:Zi,renderOutput:Q4,rendererReference:L4,rgbShift:Ebe,rotate:LV,rotateUV:wve,roughness:ud,round:r4,rtt:Lj,sRGBToLinearSRGB:EJ,sampler:n0e,saturate:A4,saturation:xbe,screen:Rve,screenCoordinate:Oy,screenSize:Uy,screenUV:wm,scriptable:rve,scriptableValue:vE,select:mo,sepia:Gve,setCurrentStack:L1,shaderStages:hN,sharedUniformGroup:xN,sheen:Uf,sheenRoughness:GT,shiftLeft:OQ,shiftRight:ZQ,shininess:VT,sign:z1,sin:po,sinc:vve,skinning:k0e,skinningReference:eY,smoothstep:Sa,smoothstepElement:v4,sobel:Mbe,specularColor:Ja,specularF90:N1,spherizeUV:Cve,split:Hfe,spritesheetUV:Jye,sqrt:ph,ssaaPass:Jbe,stack:pE,step:F1,stereoPass:$be,storage:cbe,storageBarrier:Hve,storageObject:hbe,storageTexture:Nj,string:Zfe,sub:Ln,subgroupIndex:R0e,subgroupSize:Ove,tan:qQ,tangentGeometry:jT,tangentLocal:Y1,tangentView:j1,tangentWorld:dK,temp:ON,texture:zi,texture3D:rj,textureBarrier:Qve,textureBicubic:NY,textureCubeUV:WY,textureLoad:wc,textureSize:xm,textureStore:dbe,thickness:MN,threshold:Qj,timerDelta:Wye,timerGlobal:Zye,timerLocal:QV,toOutputColorSpace:M4,toWorkingColorSpace:I4,toneMapping:k4,toneMappingExposure:G4,toonOutlinePass:nve,transformDirection:g4,transformNormal:nK,transformNormalToView:qN,transformedBentNormalView:gK,transformedBitangentView:pK,transformedBitangentWorld:_0e,transformedClearcoatNormalView:Dy,transformedNormalView:ys,transformedNormalWorld:JN,transformedTangentView:tV,transformedTangentWorld:x0e,transition:Wbe,transmission:XT,transpose:l4,tri:Ad,tri3:_J,triNoise3D:xve,triplanarTexture:$ye,triplanarTextures:Ij,trunc:NN,tslFn:Ofe,uint:pt,uniform:tt,uniformArray:gd,uniformGroup:SQ,uniforms:b0e,userData:ube,uv:yi,uvec2:fQ,uvec3:Py,uvec4:vQ,varying:go,varyingProperty:dh,vec2:ae,vec3:j,vec4:Qe,vectorComponents:By,velocity:Ive,vertexColor:rbe,vertexIndex:QK,vibrance:wbe,viewZToOrthographicDepth:sw,viewZToPerspectiveDepth:gY,viewport:Gu,viewportBottomLeft:U0e,viewportCoordinate:uY,viewportDepthTexture:pV,viewportLinearDepth:W0e,viewportMipTexture:pY,viewportResolution:z0e,viewportSafeUV:_ve,viewportSharedTexture:mbe,viewportSize:dY,viewportTexture:O0e,viewportTopLeft:F0e,viewportUV:D0e,wgsl:pye,wgslFn:fye,workgroupArray:jve,workgroupBarrier:Wve,workgroupId:Fve,workingToColorSpace:T4,xor:XQ},Symbol.toStringTag,{value:"Module"}));let s6,r6=null;function fh(){return s6}function dX(n){if(n==null){console.warn("Oh no: someone tried registering a non-existend gltf-loader. When you see this log it might mean that needle-engine is being imported multiple times. Please check your project setup.");return}r6!==n&&(r6=n,s6=new n)}const uX=new Map;function Ma(n=(e=>(e=globalThis.location)==null?void 0:e.hostname)()){if(uX.has(n))return uX.get(n);const e=/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|localhost/.test(n);return uX.set(n,e),e===!0}function o6(){return window.location.hostname.includes("glitch.me")}var nn=(n=>(n.ContextRegistered="ContextRegistered",n.ContextCreationStart="ContextCreationStart",n.ContextCreated="ContextCreated",n.ContextFirstFrameRendered="ContextFirstFrameRendered",n.ContextDestroying="ContextDestroying",n.ContextDestroyed="ContextDestroyed",n.MissingCamera="MissingCamera",n.ContextClearing="ContextClearing",n.ContextCleared="ContextCleared",n))(nn||{});class ji{static get Current(){return globalThis["NeedleEngine.Context.Current"]}static set Current(e){globalThis["NeedleEngine.Context.Current"]=e}static get All(){return this.Registered}static register(e){this.Registered.push(e),this.dispatchCallback("ContextRegistered",e)}static unregister(e){const i=this.Registered.indexOf(e);i!==-1&&this.Registered.splice(i,1)}static registerCallback(e,i){this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(i)}static unregisterCallback(e,i){if(!this._callbacks[e])return;const s=this._callbacks[e].indexOf(i);s!==-1&&this._callbacks[e].splice(s,1)}static dispatchCallback(e,i,s){if(!this._callbacks[e])return!0;const r={event:e,context:i};if(s)for(const a in s)r[a]=s[a];const o=new Array;return this._callbacks[e].forEach(a=>{const l=a(r);l instanceof Promise&&o.push(l)}),Promise.all(o)}static addContextCreatedCallback(e){this.registerCallback("ContextCreated",e)}static addContextDestroyedCallback(e){this.registerCallback("ContextDestroyed",e)}}m(ji,"Registered",[]),m(ji,"_callbacks",{});const a6=()=>n=>n;function T1e(n){return a6()(n)}function E1e(){return!!q("debug")}class El{constructor(e,i){m(this,"_factory"),m(this,"_cache",[]),m(this,"_maxSize"),m(this,"_index",0),this._factory=e,this._maxSize=i}get(){const e=this._index%this._maxSize;return this._index++,this._cache.length<=e&&(this._cache[e]=this._factory()),this._cache[e]}}let n0=!1;const pX=new Array;typeof window<"u"&&setTimeout(()=>{if(n0){const n={},e=new URL(window.location.href),i=new URL(e);i.searchParams.append("console","");const s=i.toString().replace(/=$|=(?=&)/g,"");for(const o of pX){const a=new URL(e);a.searchParams.append(o,""),n[o]=a.toString().replace(/=$|=(?=&)/g,"")}console.log(`\u{1F335} ?help: Debug Options for Needle Engine.
Append any of these parameters to the URL to enable specific debug options.
Example: ${s} will show an onscreen console window.`);const r=n0===!0?"":` (containing "${n0}")`;console.group("Available URL parameters:"+r);for(const o of Object.keys(n).sort())typeof n0=="string"&&!o.toLowerCase().includes(n0.toLowerCase())||(console.groupCollapsed(o),console.log("Reload with this flag enabled:"),console.log(n[o]),console.groupEnd());console.groupEnd()}},100);function pw(){var n;return new URLSearchParams((n=globalThis.location)==null?void 0:n.search)}function q(n){n0&&!pX.includes(n)&&pX.push(n);const e=pw();if(e.has(n)){const i=e.get(n);if(i){const s=Number(i);return isNaN(s)?i:s}else return!0}return!1}n0=q("help");function R1e(n,e){const i=pw();i.has(n)?i.set(n,e):i.append(n,e),document.location.search=i.toString()}function mw(n,e,i=!0){const s=pw();s.has(n)?e===null?s.delete(n):s.set(n,e):e!==null&&s.append(n,e),i?l6(n,s):gX(n,s)}function mX(n,e,i){n.has(e)?n.set(e,i.toString()):n.append(e,i.toString())}function l6(n,e,i){window.history.pushState(i,n,"?"+e.toString())}function gX(n,e,i){window.history.replaceState(i,n,"?"+e.toString())}function L1e(n){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=i.length,r=0;r<n;r++)e+=i.charAt(Math.floor(Math.random()*s));return e}function B1e(n,e){return Math.floor(Math.random()*(e-n+1))+n}const c6=["smol","tiny","giant","interesting","smart","bright","dull","extreme","beautiful","pretty","dark","epic","salty","silly","funny","lame","lazy","loud","lucky","mad","mean","mighty","mysterious","nasty","odd","old","powerful","quiet","rapid","scary","shiny","shy","silly","smooth","sour","spicy","stupid","sweet","tasty","terrible","ugly","unusual","vast","wet","wild","witty","wrong","zany","zealous","zippy","zombie","zorro"],h6=["cat","dog","mouse","pig","cow","horse","sheep","chicken","duck","goat","panda","tiger","lion","elephant","monkey","bird","fish","snake","frog","turtle","hamster","penguin","kangaroo","whale","dolphin","crocodile","snail","ant","bee","beetle","butterfly","dragon","eagle","fish","giraffe","lizard","panda","penguin","rabbit","snake","spider","tiger","zebra"];function d6(){const n=c6[Math.floor(Math.random()*c6.length)],e=h6[Math.floor(Math.random()*h6.length)];return n+"_"+e}function u6(n){return n=n.replace(/[^a-z0-9áéíóúñü \.,_-]/gim,""),n.trim()}function qy(n,e,i=!0,s=!1){var r;if(e==null)return null;if(e.userData&&e.userData.guid===n||e.guid==n)return e;if(s&&(r=e.userData)!=null&&r.components){for(const o of e.userData.components)if(o.guid===n)return o}if(i){if(e.scenes)for(const o in e.scenes){const a=e.scenes[o],l=qy(n,a,i,s);if(l)return l}if(e.children)for(const o in e.children){const a=e.children[o],l=qy(n,a,i,s);if(l)return l}}}function gw(n,e){if(n!=null&&typeof n=="object"){let i;Array.isArray(n)?i=[]:(i=Object.create(n),Object.assign(i,n));for(const s of Object.keys(n)){const r=n[s];e&&!e(n,s,r)?i[s]=r:r?.clone!==void 0&&typeof r.clone=="function"?i[s]=r.clone():i[s]=gw(r,e)}return i}return n}function Ah(n){return new Promise((e,i)=>{setTimeout(e,n)})}function RE(n,e){if(n<=0)return Promise.resolve();if(e||(e=ji.Current),!e)return Promise.reject("No context");const i=e.time.frameCount+n;return new Promise((s,r)=>{if(!e)return r("No context");const o=()=>{e.time.frameCount>=i&&(e.pre_update_callbacks.splice(e.pre_update_callbacks.indexOf(o),1),s())};e.pre_update_callbacks.push(o)})}const LE=q("debugresolveurl"),p6="rel:";function k1e(n,e){return Sm(n,e)}function Sm(n,e){if(e===void 0)return LE&&console.warn("getPath: uri is undefined, returning uri",e),e;if(e.startsWith("./"))return e;if(e.startsWith("http"))return LE&&console.warn("getPath: uri is absolute, returning uri",e),e;if(n===void 0)return LE&&console.warn("getPath: source is undefined, returning uri",e),e;e.startsWith(p6)&&(e=e.substring(4));const i=n.lastIndexOf("/");if(i>=0){const s=n.substring(0,i+1);for(;s.endsWith("/")&&e.startsWith("/");)e=e.substring(1);const r=s+e;return LE&&console.log("source:",n,`changed uri 
from`,e,`
to `,r,`
basePath: `+s),r}return e}class G1e{constructor(e,i){m(this,"writeCallbacks",[]),m(this,"_applied",!1),m(this,"_object"),m(this,"_prop"),m(this,"_wrapperProp"),this._object=e,this._prop=i,this._wrapperProp=Symbol("$"+i),this.apply()}subscribeWrite(e){this.writeCallbacks.push(e)}unsubscribeWrite(e){const i=this.writeCallbacks.indexOf(e);i!==-1&&this.writeCallbacks.splice(i,1)}apply(){if(this._applied||!this._object)return;const e=this._object,i=this._prop;if(e[i]===void 0)return;this._applied=!0,e[this._wrapperProp]!==void 0&&console.warn("Watcher is being applied to an object that already has a wrapper property. This is not (yet) supported");const s=e[i];e[this._wrapperProp]=s,Object.defineProperty(e,i,{get:()=>e[this._wrapperProp],set:r=>{e[this._wrapperProp]=r;for(const o of this.writeCallbacks)o(r,this._prop)}})}revoke(){if(!this._applied||!this._object)return;this._applied=!1;const e=this._object,i=this._prop;Reflect.deleteProperty(e,i);const s=e[this._wrapperProp];e[i]=s,Reflect.deleteProperty(e,this._wrapperProp)}dispose(){this.revoke(),this.writeCallbacks.length=0,this._object=null}}class Xp{constructor(e,i){if(m(this,"_watches",[]),Array.isArray(i))for(const s of i)this._watches.push(new Xp(e,s));else this._watches.push(new G1e(e,i))}subscribeWrite(e){for(const i of this._watches)i.subscribeWrite(e)}unsubscribeWrite(e){for(const i of this._watches)i.unsubscribeWrite(e)}apply(){for(const e of this._watches)e.apply()}revoke(){for(const e of this._watches)e.revoke()}dispose(){for(const e of this._watches)e.dispose();this._watches.length=0}}const $y=Symbol("needle:watches");function BE(n,e){if(!n[$y])if(n instanceof Q)n[$y]=new Xp(n,["x","y"]);else if(n instanceof E)n[$y]=new Xp(n,["x","y","z"]);else if(n instanceof $e||n instanceof Fe)n[$y]=new Xp(n,["x","y","z","w"]);else return!1;return n[$y].subscribeWrite(e),!0}function fX(n,e){if(!n)return;const i=n[$y];i&&i.unsubscribeWrite(e)}var Ft;(n=>{let e;function i(){if(e!==void 0)return e;const k=window.navigator.userAgent,G=/Windows|MacOS|Mac OS/.test(k),X=/Windows NT/.test(k)&&/Edg/.test(k)&&!/Win64/.test(k);return e=G&&!X&&!y()}n.isDesktop=i;let s;function r(){return s!==void 0?s:typeof window.orientation<"u"||navigator.userAgent.indexOf("IEMobile")!==-1?s=!0:s=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent)}n.isMobileDevice=r;function o(){return l()}n.isIPad=o;let a;function l(){return a!==void 0?a:a=/iPad/.test(navigator.userAgent)}n.isiPad=l;let c;function h(){return c!==void 0?c:c=/Android/.test(navigator.userAgent)}n.isAndroidDevice=h;let d;function u(){return d!==void 0?d:d=/WebXRViewer\//i.test(navigator.userAgent)}n.isMozillaXR=u;let p;function g(){if(p!==void 0)return p;if(navigator.userAgentData)return p=navigator.userAgentData.platform==="macOS";{const k=navigator.userAgent.toLowerCase();return p=k.includes("mac os x")||k.includes("macintosh")}}n.isMacOS=g;let f;const A=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];function y(){return f!==void 0?f:f=A.includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}n.isiOS=y;let b;function v(){return b!==void 0||(b=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),b}n.isSafari=v;let x;function w(){return x!==void 0?x:x=navigator.userAgent.includes("OculusBrowser")}n.isQuest=w;let C;function S(){return C!==void 0||(C=document.createElement("a").relList.supports("ar")),C}n.supportsQuickLookAR=S;async function _(){try{return(await navigator.permissions.query({name:"microphone"})).state!=="denied"}catch(k){return console.error("Error querying `microphone` permissions.",k),!1}}n.microphonePermissionsGranted=_;let I;function B(){if(I!==void 0)return I;const k=navigator.userAgent.match(/iPhone OS (\d+_\d+)/);if(k&&(I=k[1].replace("_",".")),!I){const G=navigator.userAgent.match(/(?:\(Macintosh;|iPhone;|iPad;).*Version\/(\d+\.\d+)/);G&&(I=G[1])}return I||(I=null),I}n.getiOSVersion=B;let M;function R(){if(M!==void 0)return M;const k=navigator.userAgent.match(/(?:CriOS|Chrome)\/(\d+\.\d+\.\d+\.\d+)/);return k?M=k[1].replace("_","."):M=null,M}n.getChromeVersion=R})(Ft||(Ft={}));function P1e(){return Ft.isDesktop()}function N1e(){return Ft.isMobileDevice()}function V1e(){return Ft.isiPad()}function X1e(){return Ft.isiPad()}function D1e(){return Ft.isAndroidDevice()}function z1e(){return Ft.isMozillaXR()}function F1e(){return Ft.isMacOS()}function U1e(){return Ft.isiOS()}function O1e(){return Ft.isSafari()}function Z1e(){return Ft.isQuest()}async function W1e(){return Ft.microphonePermissionsGranted()}const H1e=/ip=(?<ip>.+?)\n/s;async function Q1e(){const n=await(await fetch("https://www.cloudflare.com/cdn-cgi/trace")).text(),e=H1e.exec(n);return e?e[1]:null}async function K1e(){const n=await fetch("https://api.db-ip.com/v2/free/self").catch(()=>null);return n?(await n.json()).ipAddress:void 0}async function Y1e(){const n=await fetch("https://api.db-ip.com/v2/free/self").catch(()=>null);return n?await n.json():void 0}const _m=new WeakMap;function m6(n,e,i){if(!_m.get(n)){const r=new MutationObserver(o=>{j1e(n,o)});_m.set(n,{observer:r,attributeChangedListeners:new Map}),r.observe(n,{attributes:!0})}const s=_m.get(n).attributeChangedListeners;s.has(e)||s.set(e,[]),s.get(e).push(i)}function g6(n,e,i){if(!_m.get(n))return;const s=_m.get(n).attributeChangedListeners;if(!s.has(e))return;const r=s.get(e),o=r.indexOf(i);if(o!==-1&&(r.splice(o,1),r.length<=0)){s.delete(e);const a=_m.get(n);a?.observer.disconnect(),_m.delete(n)}}function j1e(n,e){const i=_m.get(n).attributeChangedListeners;for(const s of e)if(s.type==="attributes"){const r=s.attributeName,o=n.getAttribute(r);if(i.has(r))for(const a of i.get(r))a(o)}}class AX{constructor(e){m(this,"reason"),this.reason=e}}async function kE(n){const e=await Promise.allSettled(n).catch(r=>[new AX(r.message)]);let i=!1;const s=e.map(r=>"value"in r?r.value:(i=!0,new AX(r.reason)));return{anyFailed:i,results:s}}async function f6(n){if(!globalThis.QRCode){const s="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js";let r=document.head.querySelector(`script[src="${s}"]`);r||(r=document.createElement("script"),r.src=s,document.head.appendChild(r)),await new Promise((o,a)=>{r.addEventListener("load",()=>{o(!0)})})}const e=globalThis.QRCode,i=n.domElement??document.createElement("div");return new e(i,{width:n.width??256,height:n.height??256,colorDark:"#000000",colorLight:"#ffffff",correctLevel:e.CorrectLevel.M,...n}),i}const A6=q("debugdebug");let fw=!1;(q("noerrors")||q("nooverlaymessages"))&&(fw=!0);const yX="needle_engine_global_error_container";var Rl=(n=>(n[n.Log=0]="Log",n[n.Warn=1]="Warn",n[n.Error=2]="Error",n))(Rl||{});function bX(){return x6}const vX=new Array;function J1e(n){vX.push(n)}let xX=!1;function q1e(...n){if(!xX){xX=!0;try{for(let e=0;e<vX.length;e++)vX[e](...n)}catch(e){console.error(e)}xX=!1}}const y6=console.error,b6=function(...n){y6.apply(console,n),twe(n),bd(2,n),wX(...n)};function v6(n){fw=!n,n?console.error=b6:console.error=y6}function $1e(n){return v6(n)}function ewe(){fw||(A6&&console.warn("Patch console",window.location.hostname),console.error=b6,window.addEventListener("error",n=>{if(!n)return;const e=n.error;if(e===void 0){Ma()&&console.warn("Received unknown error",n,n.target);return}bd(2,e,n.filename,n.lineno),wX(n)},!0),window.addEventListener("unhandledrejection",n=>{fw||n&&(n.reason?bd(2,n.reason.message,n.reason.stack):bd(2,"unhandled rejection"),wX(n))}))}let x6=0;function wX(...n){x6+=1,q1e(...n)}function twe(n){if(Array.isArray(n))for(let e=0;e<n.length;e++){const i=n[e];typeof i=="string"&&i.startsWith("THREE.PropertyBinding: Trying to update node for track:")&&(n[e]="Some animated objects couldn't be found: see console for details")}}function bd(n,e,i,s){if(fw)return;const r=ji.Current,o=r?.domElement??document.querySelector("needle-engine");if(o){if(Array.isArray(e)){let a="";for(let l=0;l<e.length;l++){let c=e[l];c instanceof Error&&(c=c.message),typeof c!="object"&&(l>0&&(a+=" "),a+=c)}e=a}!e||e.length<=0||iwe(n,o,e)}}const Aw=new Map;function iwe(n,e,i){if(i==null)return;const s=swe(e);if(s.childElementCount>=20){const l=s.lastElementChild;S6(l)}i.length>400&&(i=i.substring(0,400)+"...");const r=i;if(Aw.has(r))return;const o=rwe(n,i);s.prepend(o);const a=()=>{Aw.delete(r),S6(o)};Aw.set(r,a),setTimeout(a,1e4)}function w6(){A6&&console.log("Clearing messages");for(const n of Aw.values())n?.call(n);Aw.clear()}const nwe=`

@import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

div[data-needle_engine_debug_overlay] {
    font-family: 'Roboto Flex', sans-serif;
    font-weight: 400;
    font-size: 16px;
}

div[data-needle_engine_debug_overlay] strong {
    font-weight: 700;
}

div[data-needle_engine_debug_overlay] a {
    color: white;
    text-decoration: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
}

div[data-needle_engine_debug_overlay] a:hover {
    text-decoration: none;
    border: none;
}

div[data-needle_engine_debug_overlay] .log strong {
    color: rgba(200,200,200,.9);
}

div[data-needle_engine_debug_overlay] .warn strong {
    color: rgba(255,255,230, 1);
}

div[data-needle_engine_debug_overlay] .error strong {
    color: rgba(255,100,120, 1);
}
`;function swe(n){globalThis[yX]||(globalThis[yX]=new Map);const e=globalThis[yX];if(e.has(n))return e.get(n);{const i=document.createElement("div");e.set(n,i),i.setAttribute("data-needle_engine_debug_overlay",""),i.classList.add("debug-container"),i.style.cssText=`
            position: absolute;
            top: 0;
            right: 5px;
            padding-top: 0px;
            max-width: 70%;
            max-height: calc(100% - 5px);
            z-index: 9999999999;
            pointer-events: scroll;
            display: flex;
            align-items: end;
            flex-direction: column;
            color: white;
            overflow: auto;
            word-break: break-word;
        `,n.shadowRoot?n.shadowRoot.appendChild(i):n.appendChild(i);const s=document.createElement("style");return s.innerHTML=nwe,i.appendChild(s),i}}const C6=Symbol("logtype"),GE=new Map;function S6(n){n.remove();const e=n[C6],i=GE.get(e)??[];i.push(n),GE.set(e,i)}function rwe(n,e){if(GE.has(n)){const s=GE.get(n);if(s.length>0){const r=s.pop();return r.innerHTML=e,r}}const i=document.createElement("div");switch(i.setAttribute("data-id","__needle_engine_debug_overlay"),i.style.marginRight="5px",i.style.padding=".5em",i.style.backgroundColor="rgba(0,0,0,.9)",i.style.marginTop="5px",i.style.marginBottom="3px",i.style.borderRadius="8px",i.style.pointerEvents="all",i.style.userSelect="text",i.style.maxWidth="250px",i.style.whiteSpace="pre-wrap",i.style["backdrop-filter"]="blur(10px)",i.style["-webkit-backdrop-filter"]="blur(10px)",i.style.backgroundColor="rgba(20,20,20,.8)",i.style.boxShadow="inset 0 0 80px rgba(0,0,0,.2), 0 0 5px rgba(0,0,0,.2)",i.style.border="1px solid rgba(160,160,160,.2)",i[C6]=n,n){case 0:i.classList.add("log"),i.style.color="rgba(200,200,200,.7)",i.style.backgroundColor="rgba(40,40,40,.7)";break;case 1:i.classList.add("warn"),i.style.color="rgb(255, 255, 150)",i.style.backgroundColor="rgba(50,50,20,.8)";break;case 2:i.classList.add("error"),i.style.color="rgb(255, 50, 50",i.style.backgroundColor="rgba(50,20,20,.8)";break}return i.title="Open the browser console (F12) for more information",i.innerHTML=e,i}var yh={};yh.d=(n,e)=>{for(var i in e)yh.o(e,i)&&!yh.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:e[i]})},yh.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),yh.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var or={};yh.d(or,{ti:()=>dn,nS:()=>A8,eB:()=>sM,Yp:()=>CX,VB:()=>r0,BC:()=>yw,zN:()=>s0,cV:()=>_x,hW:()=>oM,k2:()=>L6,K6:()=>nh,M7:()=>SX,ls:()=>vw,Hi:()=>Y6,EY:()=>rM,MR:()=>z6,zf:()=>R6,Ay:()=>v_e,yo:()=>y8});var CX={};yh.r(CX),yh.d(CX,{get:()=>_6,set:()=>owe});var SX={};yh.r(SX),yh.d(SX,{alphaTestTransformer:()=>DE,asPreprocessorValueTransformer:()=>F6,toPreprocessorTriggerTransformer:()=>XX,toUserDataTransformer:()=>ACe,uniformOrUserDataTransformer:()=>Mc});const _X={fontFamily:null,fontSize:.05,fontKerning:"auto",fontStyle:"normal",fontWeight:"normal",offset:.005,lineHeight:1.2,lineBreak:`- ,.:?!
`,whiteSpace:"pre-line",flexDirection:"column",justifyContent:"start",alignItems:"start",backgroundImage:null,textAlign:"left",boxSizing:"content-box",position:"static",color:16777215,fontColor:16777215,fontOpacity:1,opacity:1,fontPXRange:4,fontSupersampling:!0,fontSmooth:"antialiased",borderRadius:0,borderWidth:0,borderColor:"black",borderOpacity:1,backgroundSize:"cover",backgroundColor:0,backgroundOpacity:0,overflow:"visible",letterSpacing:0,invertAlpha:!1,segments:1},owe=function(n){for(const e in n)_X[e]=n[e]},_6=function(n){return Object.prototype.hasOwnProperty.call(_X,n)||console.warn(`ThreeMeshUI::DefaultValues is trying to retrieve non-existing property '${n}'`),_X[n]};class dn{constructor(e,i=null,s=!0){this._id=e,this._value=i,this._needsUpdate=!0,this._needsProcess=!1,this._needsRender=!1,this._isPrimitive=s}get id(){return this._id}get value(){return this._value}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}update(e,i){this.output(i)}output(e){}_outputValue(e){e[this._id]=this._value}process(e){}render(e){}getInheritedInput(e){if(this._value!=="inherit")return this._value;const i=e._parent._value;return i&&i[`_${this._id}`]?i[`_${this._id}`].getInheritedInput(i):this.getDefaultValue()}getDefaultValue(){return _6(this._id)}isValid(e){return!0}emptyStrategyLogic(){throw new Error(`ThreeMeshUI::${this.constructor.name} has empty strategy. Update has not been processed.`)}requestUpdate(){this._needsUpdate=!0}requestProcess(){this._needsProcess=!1}requestRender(){this._needsRender=!1}}class awe extends dn{constructor(){super("renderOrder","auto",!0),this.output=this._outputValue,this._actualValue=0}set value(e){this.isValid(e)&&(this._value=e,this._needsUpdate=!0)}update(e,i){if(this._value!=="auto")this._actualValue=this._value;else{const s=e._parent._value;if(s!==null){const r=s._renderOrder._actualValue,o=1+s._children._uis.indexOf(e);this._actualValue=r+o}}for(const s of e._children._uis)s._renderOrder._value==="auto"&&(s._renderOrder._needsUpdate=!0);this._outputValue(i)}_outputValue(e){e[this._id]=this._actualValue}get value(){return this._value}}class s0 extends dn{constructor(e,i=null,s=!0){super(e,i,s),this.output=this._outputValue,this._notInheritedValue=null}update(e,i){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(e)),this.propagate(e),this._outputValue(i)}propagate(e){for(const i of e._children._uis){const s=i[`_${this._id}`];s!==void 0&&s._value==="inherit"&&(i[`_${this._id}`]._needsUpdate=!0)}}_outputValue(e){e[this._id]=this._notInheritedValue}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class lwe extends s0{constructor(){super("offset","inherit",!1)}update(e,i){super.update(e,i),e._parent._value!==null&&(e.position.z=this._notInheritedValue)}}class cwe extends s0{constructor(){super("fontSmooth","inherit",!0),this._needsUpdate=!1,this.isValid=dwe,this.output=this._outputValue}}const hwe=["inherit","none","antialiased"];function dwe(n){return hwe.indexOf(n)===-1?(console.warn(`.fontSmoothing value '${n}' is not valid. Aborted`),!1):!0}var uwe=n=>{var e={};return yh.d(e,n),e};const st=uwe({BackSide:()=>wn,BufferAttribute:()=>ct,BufferGeometry:()=>Rt,Color:()=>fe,DoubleSide:()=>Qi,EventDispatcher:()=>yr,FileLoader:()=>Rs,FrontSide:()=>ms,LinearFilter:()=>Wt,Mesh:()=>pe,MeshBasicMaterial:()=>ai,Object3D:()=>Ae,Plane:()=>tr,PlaneGeometry:()=>Xs,ShaderMaterial:()=>jt,Texture:()=>di,TextureLoader:()=>hh,Vector2:()=>Q,Vector3:()=>E,Vector4:()=>$e});class ns extends dn{constructor(e,i,s=!0){super(e,"unset",s),this._input="inherit",this._allowsInherit=!0,this._inheritedInput=void 0,this._inline=void 0}update(e,i){this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const s of e._children._uis){const r=s[`_${this._id}`];(r._input?r._input:r._value)==="inherit"&&(s[`_${this._id}`]._needsUpdate=!0)}this.output(i)}computeOutputValue(e){this._value=this._input}_computeFromInherited(e){this._value=this._inheritedInput}set value(e){console.warn(".(style) sub-property cannot be directly set. It must comes from inline or computed setter.")}set inline(e){this.isValidValue(e)&&e!==this._inline&&(this._input=this._inline=e,this._needsUpdate=!0)}get inline(){return this._inline}isValidValue(e){return!0}getInheritedInput(e){if(this._input!=="inherit")return this._input;const i=e._parent._value;return i?i[`_${this._id}`].getInheritedInput(i):this.getDefaultValue()}}class PE extends ns{constructor(e,i){super(e,i,!1),this._input=new st.Vector4(0,0,0,0),this._inline=null,this._value=new st.Vector4(0,0,0,0)}get value(){return this._value}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input)}set inline(e){this._vector4ValueSetter(this._input,e),!this._input.equals(this._value)&&(this._needsUpdate=!0)}set top(e){this._input.x!==e&&(this._input.x=e,this._needsUpdate=!0)}get top(){return this._input.x}set right(e){this._input.y!==e&&(this._input.y=e,this._needsUpdate=!0)}get right(){return this._input.y}set bottom(e){this._input.z!==e&&(this._input.z=e,this._needsUpdate=!0)}get bottom(){return this._input.z}set left(e){this._input.w!==e&&(this._input.w=e,this._needsUpdate=!0)}get left(){return this._input.w}dispose(){this._computed=null,this._inline=null,this._input=null,this._output=null}_vector4ValueSetter(e,i){if(i instanceof st.Vector4){e.copy(i);return}if((typeof i=="string"||i instanceof String)&&(i=i.split(" ")),Array.isArray(i))switch(i=i.map(s=>parseFloat(s)),i.length){case 1:e.setScalar(i[0]);return;case 2:e.x=e.z=i[0],e.y=e.w=i[1];return;case 3:e.x=i[0],e.y=i[1],e.z=i[2];return;case 4:e.x=i[0],e.y=i[1],e.z=i[2],e.w=i[3];return;default:console.error("StyleVector4Property::set() Four Dimension property had more than four values");return}isNaN(i)||e.setScalar(i)}}class pwe extends PE{constructor(){super("padding",new st.Vector4(0,0,0,0))}computeOutputValue(e){super.computeOutputValue(e),e._bounds._needsUpdate=!0,e._bounds._needsRender=!0,e._layouter._needsProcess=!0,e._renderer._needsRender=!0,e._parent._value&&(e._parent._value._layouter._needsProcess=!0)}}class mwe extends PE{constructor(){super("margin",new st.Vector4(0,0,0,0))}computeOutputValue(e){super.computeOutputValue(e),e._renderer._needsRender=!0,e._parent._value&&(e._parent._value._flexDirection._needsProcess=!0)}}const M6=function(n,e,i){n[e]=i},gwe=function(n,e,i){i!==null&&(n[e]=i)};class NE{constructor(e){this._definition=e}set definition(e){this._definition=e}mediate(e,i,s,r=null){for(const o in this._definition){const a=this._definition[o];if(s[o]!==void 0){const l=a.t?a.t:M6;l(i,a.m,s[o]),r&&l(r,a.m,s[o])}}}static mediate(e,i,s,r,o=null){if(i)for(const a in r){const l=r[a];if(s[a]!==void 0){const c=l.t?l.t:M6;c(i,l.m,s[a]),o&&c(o,l.m,s[a])}}}}class fwe extends dn{constructor(){super("parent",null,!1)}update(e,i){e.parent&&e.parent.isUI?this._value=e.parent:this._value=null}set value(e){console.warn("ParentProperty is readonly")}get value(){return this._value}find(e){return this._value?e(this._value)?this._value:this._value._parent.find(e):null}dispose(){this._value=null}}const MX=function(n,e,i=6){return n.toFixed(i)===e.toFixed(i)};class I6 extends dn{constructor(e,i){super(e,i,!0),this.output=this._outputValue}set value(e){this.isValid(e)&&(MX(this._value,e)||(this._value=e,this._needsUpdate=!0))}get value(){return this._value}}class T6 extends s0{constructor(e){super(e,"inherit",!0),this.isValid=ywe}}const Awe=[st.FrontSide,st.BackSide,st.DoubleSide];function ywe(n){return Awe.indexOf(n)===-1?(console.warn(`SideProperty value '${n}' is not valid. Abort`),!1):!0}class E6{constructor(){this._offsetX=0,this._offsetY=0,this._lineBreak=null,this._kerning=0,this._fontFactor=1,this._fontSize=0,this._cumulativeWidth=0,this._paddingLeft=0,this._paddingRight=0,this._marginLeft=0,this._marginRight=0}resetOffsets(){this._offsetX=this._offsetY=0,this._cumulativeWidth=0}get xadvance(){return 0}get xoffset(){return 0}get yoffset(){return 0}get width(){return 0}get height(){return 0}set lineBreak(e){this._lineBreak=e}get lineBreak(){return this._lineBreak}get anchor(){return 0}get kerning(){return this._kerning*this._fontFactor}set kerning(e){this._kerning=e}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e}get lineHeight(){return 0}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e}get cumulativeWidth(){return this._cumulativeWidth}set cumulativeWidth(e){this._cumulativeWidth=e}get marginLeft(){return this._marginLeft}set marginLeft(e){this._marginLeft=e}get marginRight(){return this._marginRight}set marginRight(e){this._marginRight=e}get paddingLeft(){return this._paddingLeft}set paddingLeft(e){this._paddingLeft=e}get paddingRight(){return this._paddingRight}set paddingRight(e){this._paddingRight=e}get lineBase(){return 0}set fontFactor(e){this._fontFactor=e}get fontFactor(){return this._fontFactor}}class R6{constructor(e){this._char="",this._width=1,this._heigth=1,this._xadvance=1,this._xoffset=0,this._yoffset=0,this._font=e}get font(){return this._font}get char(){return this._char}get width(){return this._width}get height(){return this._heigth}get xadvance(){return this._xadvance}get xoffset(){return this._xoffset}get yoffset(){return this._yoffset}set yoffset(e){this._yoffset=e}clone(e){throw new Error("Abstract... Need to be implemented")}asInlineGlyph(){throw new Error("Abstract... Need to be implemented")}}class L6 extends E6{constructor(e){super(),this._typographic=e}get typographic(){return this._typographic}get xadvance(){return this._typographic.xadvance*this._fontFactor}get xoffset(){return this._typographic.xoffset*this._fontFactor}get yoffset(){return this._typographic.yoffset*this._fontFactor}get width(){return this._typographic.width*this._fontFactor}get height(){return this._typographic.height*this._fontFactor}get char(){return this._typographic.char}get anchor(){return this.yoffset}get lineHeight(){return this._typographic.font.lineHeight*this._fontFactor}get lineBase(){return this._typographic.font.lineBase*this._fontFactor}}const bwe={light:"100",normal:"400",bold:"700",bolder:"900"};function IX(n){return isNaN(n)?bwe[n]||n:n.toString()}class vwe extends st.EventDispatcher{constructor(e,i){super(),this._isReady=!1,this._weight=IX(e),this._style=i,this._size=42,this._lineHeight=42,this._lineBase=42,this._font=null}get typographic(){return this._font}get isReady(){return this._isReady}get weight(){return this._weight}get style(){return this._style}get texture(){return this._texture}set fontMaterial(e){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get fontMaterial(){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get id(){return`${this._name}(w:${this.weight},s:${this.style})`}getTypographicGlyph(e){let i=this._chars[e];if(i)return i;if(e.match(/\s/))return this._chars[" "];const s=this._getFallbackCharacter(e);if(s&&(i=this._chars[s],i))return i;throw Error(`FontVariant('${this.id}')::getTypographicGlyph() - character('${e}') and/or fallback character were not found in provided msdf charset.`)}_getFallbackCharacter(e){throw new Error(`FontVariant(${typeof this})::_getFallbackCharacter() is abstract and should therefore be overridden.`)}getGeometricGlyph(e,i){throw new Error(`FontVariant(${typeof this})::getGeometryCharacter() is abstract and should therefore be overridden.`)}getKerningAmount(e){return this._kernings[e]?this._kernings[e]:0}adjustTypographicGlyphs(e){for(const i in e){const s=this.getTypographicGlyph(i),r=e[i];for(const o in r)s["_"+o]=e[i][o]}}_checkReadiness(){this._readyCondition()&&wwe(this)}_alterElementProperties(e){throw new Error(`FontVariant(${typeof this})::_alterElementProperties() is abstract and should therefore be overridden.`)}_readyCondition(){throw new Error(`FontVariant(${typeof this})::_readyCondition() is abstract and should therefore be overridden.`)}}const xwe={type:"ready"};function wwe(n){n._isReady=!0,n.dispatchEvent(xwe)}const yw=vwe;class Cwe extends dn{constructor(e=null){super("font",e,!1),this._needsUpdate=!1,this._fontVariant=null,this._handleFontReadyClosure=null,this.isValid=Swe}output(e){e[this._id]=this._fontVariant}update(e,i){if(this._fontVariant&&!this._fontVariant.isReady&&this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._value&&this._value instanceof yw)this._fontVariant=this._value;else{const s=e._fontFamily._value;s&&(this._fontVariant=s.getVariant(e._fontWeight._value,e._fontStyle._value))}this._fontVariant&&(this._fontVariant._alterElementProperties(e),this._handleFontReadyClosure=_we(e,this),this._fontVariant.isReady?this._handleFontReadyClosure():this._fontVariant.addEventListener("ready",this._handleFontReadyClosure),(!e._fontMaterial._defaultMaterial||!(e._fontMaterial._defaultMaterial instanceof this._fontVariant.fontMaterial))&&(e._fontMaterial._defaultMaterial=new this._fontVariant.fontMaterial,e._fontMaterial._needsUpdate=!0))}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value}get fontVariant(){return this._fontVariant}dispose(){this._handleFontReadyClosure&&(this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._handleFontReadyClosure=null),this._value=null,this._fontVariant=null}}function Swe(n){return n instanceof yw?!0:(console.warn(`.font value '${n}' is not valid. It requires a FontVariant instance. Aborted`),!1)}function _we(n,e){return function(){e._needsUpdate=!0,n._glyphs._needsProcess=!0,e._fontVariant.removeEventListener("ready",e._handleFontReadyClosure),e._handleFontReadyClosure=null}}class Mwe extends ns{constructor(e){super("display",e),this._value="flex",this._allowsInherit=!1,this._needsUpdate=!1,this.isValidValue=Twe}computeOutputValue(e){e._visible._value=this._output!=="none"}}const Iwe=["none","flex"];function Twe(n){return Iwe.indexOf(n)===-1?(console.warn(`(.style) display value '${n}' is not valid. Aborted`),!1):!0}class Ewe extends ns{constructor(e){super("boxSizing",e),this._allowsInherit=!1,this.isValidValue=Lwe}computeOutputValue(e){this._value=this._inheritedInput,e._bounds._needsUpdate=!0}}const Rwe=["border-box","content-box"];function Lwe(n){return Rwe.indexOf(n)===-1?(console.warn(`(.style) boxSizing value '${n}' is not valid. Aborted`),!1):!0}class bw extends ns{constructor(e,i){super(e,i,!1),this._value=new st.Color,this.output=this._outputValue}computeOutputValue(e){this._input!=="inherit"&&this._value.set(this._input)}set inline(e){this._input=this._inline=e,this._needsUpdate=!0}}class TX extends ns{constructor(e,i){super(e,i,!0),this.isValidValue=Bwe,this._allowsInherit=!1,this._input=i,this._value=i,this.output=this._outputValue,this.computeOutputValue=this._computeFromInherited}_outputValue(e){e[this._id]=this._inheritedInput}}function Bwe(n){return n<0&&n>1?(console.warn(`(.style) styleFactorProperty('${this.id}') value '${n}' is not valid)`),!1):!0}class kwe extends ns{constructor(e){super("backgroundImage",e,!0),this._input=null,this._allowsInherit=!1,this._textureSize=new st.Vector2(1,1),this.isValidValue=Gwe}get value(){return this._value}output(e){e[this._id]=this._value,e.tSize=this._textureSize}computeOutputValue(e){if(this._value=this._inheritedInput,this._value instanceof st.Texture&&!this._value.image){console.warn("ThreeMeshUI - .backgroundImage :: Please provide preloaded texture in order to have accurate sizing.");return}this._needsProcess=!0}process(e){this._value?this._textureSize.set(this._value.image.width,this._value.image.height):this._textureSize.set(1,1)}}function Gwe(n){return!0}class Pwe extends ns{constructor(e){super("backgroundSize",e,!0),this.isValidValue=Vwe,this.output=this._outputValue}}const Nwe=["cover","contain","stretch"];function Vwe(n){return Nwe.indexOf(n)===-1?(console.warn(`(.style) backgroundSize value '${n}' is not valid. Aborted`),!1):!0}class Xwe extends ns{constructor(e){super("overflow",e,!0),this.isValidValue=zwe,this._clippingPlanes=null,this._renderStrategy=this._emptyRender}update(e,i){this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0&&(this._input=this._computed),this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const s of e._children._uis)s._overflow._needsUpdate=!0;this.output(i)}output(e){e.clippingPlanes=this._clippingPlanes}computeOutputValue(e){super.computeOutputValue(e),this._value==="hidden"?this._renderStrategy=this._propagateRender:(this._renderStrategy=this._emptyRender,this._clippingPlanes=null);const i=e._parent._value;if(i!==null){const s=i._overflow;if((s._value==="hidden"||s._clippingPlanes!==null)&&!this._clippingPlanes){this._clippingPlanes=[new st.Plane(new st.Vector3(0,-1,0),1),new st.Plane(new st.Vector3(-1,0,0),1),new st.Plane(new st.Vector3(0,1,0),1),new st.Plane(new st.Vector3(1,0,0),1)];for(let r=0;r<this._clippingPlanes.length;r++)this._clippingPlanes[r].parent=i;s._clippingPlanes!==null&&this._clippingPlanes.push(...s._clippingPlanes),this._renderStrategy=this._hiddenRender,this._needsRender=!0}else(s._value==="visible"||s._clippingPlanes===null)&&this._clippingPlanes!==null&&(this._clippingPlanes=null,this._renderStrategy=this._emptyRender,this._needsRender=!0)}}render(e){this._renderStrategy(e)}_emptyRender(e){}_hiddenRender(e){const i=e._parent._value,s=i._bounds._offsetHeight,r=i._bounds._offsetWidth,o=i._padding._value,a=i._borderWidth._value;for(let l=0;l<4&&l<this._clippingPlanes.length;l++){const c=this._clippingPlanes[l];switch(l%4){case 0:c.constant=s/2-(o.x+a.x);break;case 1:c.constant=r/2-(o.y+a.y);break;case 2:c.constant=s/2-(o.z+a.z);break;case 3:c.constant=r/2-(o.w+a.w);break}c.applyMatrix4(i.matrixWorld)}for(let l=0;l<e._children._uis.length;l++){const c=e._children._uis[l];c._overflow._needsRender=!0}}_propagateRender(e){for(let i=0;i<e._children._uis.length;i++){const s=e._children._uis[i];s._overflow._needsRender=!0}}}const Dwe=["visible","hidden"];function zwe(n){return Dwe.indexOf(n)===-1?(console.warn(`(.style) overflow value '${n}' is not valid. Aborted`),!1):!0}const eb="rem",B6="em",VE="%",Fwe=[eb,B6,VE],k6=function(n){return Fwe.indexOf(n)===-1?eb:n};class Uwe extends PE{constructor(e){super("borderRadius",e),this._valueUV=this._value.clone(),this._input=new st.Vector4(0,0,0,0),this._mediation=!0,this._cornerTL=new st.Vector2(0,1),this._cornerTR=new st.Vector2(1,1),this._cornerBR=new st.Vector2(1,0),this._cornerBL=new st.Vector2(0,0);const i=new XE(this._valueUV,["x","y"]),s=new XE(this._valueUV,["z","w"]),r=new XE(this._valueUV,["x","w"]),o=new XE(this._valueUV,["y","z"]);i.complementaryMediation=s,s.complementaryMediation=i,r.complementaryMediation=o,o.complementaryMediation=r,this._sideMediators=[i,s,r,o],this._units=eb}set units(e){this._units=k6(e),this._needsProcess=!0}get units(){return this._units}set mediation(e){e!==this._mediation&&(this._mediation=e,this._needsUpdate=!0)}get mediation(){return this._mediation}output(e){e.cornerTL=this._cornerTL,e.cornerTR=this._cornerTR,e.cornerBR=this._cornerBR,e.cornerBL=this._cornerBL}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0}process(e){this._needsRender=!0}render(e){this._valueUV.copy(this._value);const i=e._bounds._offsetWidth,s=e._bounds._offsetHeight;if(this._units===VE&&this._valueUV.divideScalar(100),this._units===eb&&this._valueUV.divideScalar(Math.min(i,s)),this._mediation)do this._sideMediators.forEach(a=>a.computeValue()),this._sideMediators.sort((a,l)=>a.value<l.value?1:-1),this._sideMediators[0].value>1&&this._sideMediators[0].mediate();while(this._sideMediators[0].value>1);let r=i>s?s/i:1,o=i<s?i/s:1;this._units===VE&&(r=o=1),this._cornerTL.x=this._valueUV.x*r,this._cornerTL.y=1-this._valueUV.x*o,this._cornerTR.x=1-this._valueUV.y*r,this._cornerTR.y=1-this._valueUV.y*o,this._cornerBR.x=1-this._valueUV.z*r,this._cornerBR.y=this._valueUV.z*o,this._cornerBL.x=this._valueUV.w*r,this._cornerBL.y=this._valueUV.w*o}dispose(){for(const e of this._sideMediators)e.dispose();this._sideMediators=null,this._cornerTL=null,this._cornerTR=null,this._cornerBR=null,this._cornerBL=null,super.dispose()}set topLeft(e){this._input.x!==e&&(this._input.x=e,this._needsUpdate=!0)}get topLeft(){return this._input.x}set topRight(e){this._input.y!==e&&(this._input.y=e,this._needsUpdate=!0)}get topRight(){return this._input.y}set bottomRight(e){this._input.z!==e&&(this._input.z=e,this._needsUpdate=!0)}get bottomRight(){return this._input.z}set bottomLeft(e){this._input.w!==e&&(this._input.w=e,this._needsUpdate=!0)}get bottomLeft(){return this._input.w}set top(e){this._input.x===e&&this._input.y===e||(this._input.x=this._input.y=e,this._needsUpdate=!0)}get top(){return(this._input.x+this._input.y)/2}set right(e){this._input.y===e&&this._input.z===e||(this._input.y=this._input.z=e,this._needsUpdate=!0)}get right(){return(this._input.y+this._input.z)/2}set bottom(e){this._input.z===e&&this._input.w===e||(this._input.z=this._input.w=e,this._needsUpdate=!0)}get bottom(){return(this._input.z+this._input.w)/2}set left(e){this._input.w===e&&this._input.x===e||(this._input.w=this._input.x=e,this._needsUpdate=!0)}get left(){return(this._input.w+this._input.x)/2}}class XE{constructor(e,i){this._borderRadiuses=e,this._sideProperties=i,this._complementaryMediation=null,this._value=0}get value(){return this._value}set complementaryMediation(e){this._complementaryMediation=e}computeValue(){let e=0;for(const i of this._sideProperties)e+=this._borderRadiuses[i];this._value=e}mediate(e=!0){if(!(this._value<1)){for(const i of this._sideProperties)this._borderRadiuses[i]/=this._value;e&&this._complementaryMediation.mediate(!1)}}dispose(){this._complementaryMediation=null,this._borderRadiuses=null}}class Owe extends PE{constructor(e){super("borderWidth",e,!1),this._valueUV=this._value.clone(),this.output=this._outputValue,this._units=eb}set units(e){this._units=k6(e),this._needsUpdate=!0}get units(){return this._units}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0,e._bounds._needsUpdate=!0,e._layouter._needsUpdate=!0}_outputValue(e){e[this._id]=this._valueUV}process(e){this._needsRender=!0,e._borderRadius._needsRender=!0}render(e){this._valueUV.copy(this._value);const i=e._bounds._offsetWidth,s=e._bounds._offsetHeight;if(this._units===VE&&(console.log("Percent"),console.log(this._valueUV)),this._units===eb)i!==0&&(this._valueUV.w/=i,this._valueUV.y/=i),s!==0&&(this._valueUV.x/=s,this._valueUV.z/=s);else if(this._units===B6){if(i!==0){const r=i>s?s/i:1;this._valueUV.y*=r,this._valueUV.w*=r}if(s!==0){const r=i<s?i/s:1;this._valueUV.x*=r,this._valueUV.z*=r}}}}class Zwe extends dn{constructor(e,i=!0){super("visible",i,!0),this._needsUpdate=!1}update(e,i){e.visible=this._value,e._parent._value&&(e._parent._value._children._needsUpdate=!0)}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value}}class G6 extends bw{constructor(e){super("backgroundColor",e,!1),this._input="transparent",this._allowsInherit=!1}computeOutputValue(e){e._backgroundMesh.visible=!(this._input==="none"||this._input==="transparent"),this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._input==="transparent"||this._input==="none"||this._value.set(this._input)}}class Vu extends dn{constructor(e="untitled"){super(e,void 0,!1)}update(e,i){}output(e){}}class Wwe extends dn{constructor(){super("inlineJustificator",null,!1),this._value=null}update(e,i){}process(e){const i=e._bounds._innerHeight,s=e._layouter._value,r=Math.abs(s.height);let o=(()=>{switch(e._alignItems._value){case"inherit":case"start":return i/2;case"end":return r-i/2;case"stretch":case"center":return r/2}})();const a=e._padding._value,l=e._borderWidth._value;o+=(-a.x+a.z)/2+(-l.x+l.z)/2,s.forEach(c=>{c.y+=o,c.forEach(h=>{h.offsetY+=o})})}}const Hwe=["start","center","end","stretch"],Qwe=function(n){return Hwe.indexOf(n)===-1?(console.warn(`(.style) alignItems value '${n}' is not valid. Aborted`),!1):!0};class EX extends ns{constructor(){super("alignItems","inherit",!0),this.isValidValue=Qwe}}class RX extends ns{constructor(){super("textAlign","inherit",!0),this.isValidValue=Ywe}}const Kwe=["left","right","center","justify","justify-left","justify-right","justify-center"],Ywe=function(n){return Kwe.indexOf(n)===-1?(console.warn(`(.style) textAlign value '${n}' is not valid. Aborted`),!1):!0};class LX extends ns{constructor(){super("flexDirection","inherit",!0),this.isValid=Jwe}}const jwe=["row","row-reverse","column","column-reverse"];function Jwe(n){return jwe.indexOf(n)===-1?(console.warn(`(.style) flexDirection value '${n}' is not valid. Aborted`),!1):!0}class BX extends ns{constructor(){super("justifyContent","inherit",!0),this.isValidValue=$we}}const qwe=["start","center","end","space-between","space-around","space-evenly"];function $we(n){return qwe.indexOf(n)===-1?(console.warn(`(.style) justifyContent value '${n}' is not valid. Aborted`),!1):!0}class eCe extends ns{constructor(){super("order",0,!0),this._value=0,this._input=0,this._allowsInherit=!1}computeOutputValue(e){this._value=this._inheritedInput,e._parent._value&&(e._parent._value._children._needsProcess=!0)}}class P6 extends ns{constructor(){super("position","static",!0),this._allowsInherit=!1,this._value="static",this._needsUpdate=!1,this.computeOutputValue=this._computeFromInherited,this.isValidValue=iCe}_computeFromInherited(e){super._computeFromInherited(e),e._parent._value&&(e._parent._value._children._needsProcess=!0)}}const tCe=["static","absolute"];function iCe(n){return tCe.indexOf(n)===-1?(console.warn(`(.style) position value '${n}' is not valid. Aborted`),!1):!0}class N6 extends ns{constructor(e,i=null){super(e,i,!0),this._input="auto",this._auto=!0,this._relative=!1,this._updateRequired=!0}set inline(e){this.isValidValue(e)&&e!==this._inline&&(this._inline=e,this._input!==this._inline&&this._parseInput())}get inline(){return this._inline}_parseInput(){let e=!0;if(this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0?(this._computed===this._input&&(e=!1),this._input=this._computed):e=this._input==="inherit",e){if(this._auto=!this._input||this._input==="auto",this._auto)this._relative=!1;else if((typeof this._input=="string"||this._input instanceof String)&&this._input.endsWith("%")){this._relative=!0,this._value=0;const i=parseFloat(this._input.replace("%","").trim());isNaN(i)||(this._value=i/100)}else this._relative=!1,this._value=this._input;this._needsUpdate=this._updateRequired=e}}update(e,i){if(this._updateRequired){this._updateRequired=!1,this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const s of e._children._uis)s[`_${this._id}`]._needsUpdate=!0;this.output(i),e._parent._value&&(e._parent._value._layouter._needsProcess=!0)}}computeOutputValue(e){e._bounds._needsUpdate=!0,e._renderer._needsRender=!0}getInheritedInput(e){if(this._input!=="inherit"&&!this._auto)return this._input;const i=e._parent._value;return i?i[`_${this._id}`].getInheritedInput(i):this.getDefaultValue()}getDefaultValue(){return 0}get value(){return this._value}}class nCe extends N6{constructor(){super("width")}}class sCe extends N6{constructor(){super("height")}computeOutputValue(e){super.computeOutputValue(e)}}class V6 extends Vu{constructor(){super("textContent"),this._needsUpdate=!1}set value(e){}process(e){let i="";for(let s=0;s<e.children.length;s++){const r=e.children[s];r.isUI&&(i+=r.textContent)}this._value=i}}class X6 extends ns{constructor(e){super("fontStyle",e,!0),this.isValidValue=oCe}}const rCe=["normal","italic"];function oCe(n){return rCe.indexOf(n)===-1?(console.warn(`(.style) fontStyle value '${n}' is not valid. Aborted`),!1):!0}class D6 extends ns{constructor(){super("fontWeight","inherit",!0),this.isValid=lCe}}const aCe=["100","200","300","400","500","600","700","800","900","light","normal","bold","bolder"];function lCe(n){return aCe.indexOf(n.toString())===-1?(console.warn(`(.style) fontWeight value '${n}' is not valid. Aborted`),!1):!0}class z6{constructor(){this._size=42,this._lineHeight=42,this._lineBase=38,this._name="-",this._charset=""}get size(){return this._size}get lineHeight(){return this._lineHeight}get lineBase(){return this._lineBase}get name(){return this._name}get charset(){return this._charset}}class cCe extends z6{constructor(e){super(),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._name=e.info.face,this._textureWidth=e.common.scaleW,this._textureHeight=e.common.scaleH,this._charset=e.chars.map(i=>i.char).join("")}get textureWidth(){return this._textureWidth}get textureHeight(){return this._textureHeight}}class hCe extends L6{constructor(e){super(e)}get uv(){return this.typographic.uv}}class Zk extends R6{constructor(e,i){super(e),this._char=i.char,this._width=i.width,this._heigth=i.height,this._xadvance=i.xadvance?i.xadvance:this._width,this._xoffset=i.xoffset?i.xoffset:0,this._yoffset=i.yoffset?i.yoffset:0,this._uv=i.uv?i.uv:null,isNaN(i.x)||(this._uv={left:i.x/e.textureWidth,right:(i.x+i.width)/e.textureWidth,top:1-(i.y+i.height)/e.textureHeight,bottom:1-i.y/e.textureHeight})}get uv(){return this._uv}clone(e){return new Zk(this._font,{char:e,width:this._width,height:this._heigth,xadvance:this._xadvance,xoffset:this._xoffset,yoffset:this._yoffset,uv:null})}asInlineGlyph(){return new hCe(this)}}class dCe extends st.PlaneGeometry{constructor(e,i){let s=1,r=1;const o=e.typographic.font.size,a=i._segments.value;s=Math.ceil(e.typographic.width/o*a),r=Math.ceil(e.typographic.height/o*a),super(e.width,e.height,s,r),e.uv?(this._mapUVs(e),this._transformGeometry(e)):(this._nullifyUVs(),this.scale(0,0,1),this.translate(0,e.fontSize/2,0)),this.name="GlyphGeometry"}_mapUVs(e){const i=e.uv.right-e.uv.left,s=e.uv.bottom-e.uv.top,r=this.getAttribute("uv").array.slice(),o=[];for(let a=0;a<r.length;a+=2){const l=r[a],c=r[a+1];o.push(e.uv.left+i*l),o.push(e.uv.top+s*c)}this.setAttribute("uvG",new st.BufferAttribute(new Float32Array(o),2))}_nullifyUVs(){const e=[],i=this.getAttribute("uv").array.length;for(let s=0;s<i;s++)e.push(0);this.setAttribute("uvG",new st.BufferAttribute(new Float32Array(e),2))}_transformGeometry(e){this.translate(e.width/2,-e.height/2,0)}}const uCe=`
attribute vec2 uvG;
varying vec2 vUvG;
`,kX=uCe,pCe=`
vUvG = uvG;
`,GX=pCe,mCe=`
gl_Position.z -= 0.00001;
`,PX=mCe,gCe=`
varying vec2 vUvG;
uniform sampler2D glyphMap;
uniform vec2 unitRange;
// functions from the original msdf repo:
// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field
float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}
float screenPxRange() {

	// precomputed unitRange as recommended by Chlumsky
	// vec2 unitRange = vec2(pxRange)/vec2(textureSize(glyphMap, 0));
	vec2 screenTexSize = vec2(1.0)/fwidth(vUvG);
	return max(0.5*dot(unitRange, screenTexSize), 1.0);
}
float tap(vec2 offsetUV) {
	vec3 msd = texture( glyphMap, offsetUV ).rgb;
	float sd = median(msd.r, msd.g, msd.b);
	float screenPxDistance = screenPxRange() * (sd - 0.5);
	float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
	return alpha;
}
`,NX=gCe,fCe=`
	float alpha;
#ifdef NO_RGSS

	alpha = tap( vUvG );

#else

	// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec
	// per pixel partial derivatives
	vec2 dx = dFdx(vUvG);
	vec2 dy = dFdy(vUvG);
	// rotated grid uv offsets
	vec2 uvOffsets = vec2(0.125, 0.375);
	vec2 offsetUV = vec2(0.0, 0.0);
	// supersampled using 2x2 rotated grid
	alpha = 0.0;
	offsetUV.xy = vUvG + uvOffsets.x * dx + uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.x * dx - uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG + uvOffsets.y * dx - uvOffsets.x * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.y * dx + uvOffsets.x * dy;
	alpha += tap(offsetUV);
	alpha *= 0.25;

#endif

	alpha = clamp( alpha, 0.0, 1.0 );

#ifdef INVERT_ALPHA

	alpha = 1.0 - alpha;

#endif

	diffuseColor.a *= alpha;
`,VX=fCe,DE=function(n,e,i){n.alphaTest=i,XX(n,"USE_ALPHATEST",i>0)},XX=function(n,e,i){n.defines&&(i?n.defines[e]===void 0&&(n.defines[e]="",n.needsUpdate=!0):n.defines[e]!==void 0&&(delete n.defines[e],n.needsUpdate=!0))},F6=function(n,e,i){n.defines[e]&&n.defines[e]===i||(n.defines[e]=i,n.needsUpdate=!0)},Mc=function(n,e,i){n.userData[e]?n.userData[e].value=i:n.uniforms[e].value=i},ACe=function(n,e,i){n.userData[e].value=i};class nh{static ensureMaterialOptions(e){e.transparent=!0,e.alphaTest=e.alphaTest||.02}static ensureDefines(e){e.defines||(e.defines={})}static ensureUserData(e,i){e.userData.glyphMap={value:i.glyphMap},e.userData.unitRange={value:new st.Vector2}}static bindUniformsWithUserData(e,i){e.uniforms.glyphMap=i.userData.glyphMap,e.uniforms.unitRange=i.userData.unitRange}static injectShaderChunks(e){nh.injectVertexShaderChunks(e),nh.injectFragmentShaderChunks(e)}static injectVertexShaderChunks(e){e.vertexShader=e.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+kX),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+GX),e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
`+PX)}static injectFragmentShaderChunks(e){e.fragmentShader=e.fragmentShader.replace("#include <uv_pars_fragment>",`#include <uv_pars_fragment>
`+NX),e.fragmentShader=e.fragmentShader.replace("#include <alphamap_fragment>",`#include <alphamap_fragment>
`+VX)}static from(e){return class extends e{constructor(i={}){nh.ensureMaterialOptions(i),super(i),m(this,"_cumulativeOnBeforeCompile",s=>{nh.bindUniformsWithUserData(s,this),nh.injectShaderChunks(s),this._userDefinedOnBeforeCompile(s)}),nh.ensureDefines(this),nh.ensureUserData(this,i),this._userDefinedOnBeforeCompile=s=>{},this._onBeforeCompile=this._cumulativeOnBeforeCompile}static get fontMaterialProperties(){return nh.mediation}set onBeforeCompile(i){this._userDefinedOnBeforeCompile=i}get onBeforeCompile(){return this._onBeforeCompile}}}static get mediation(){return vCe}}const yCe=function(n,e,i){const s=i?i.texture:null,r=i?i.unitRange:new st.Vector2;if(n[e]!==void 0){n.glyphMap=s,n.unitRange=r;return}n.userData&&n.userData.glyphMap&&(n.userData.glyphMap.value=s,n.userData.unitRange.value=r)},bCe=function(n,e,i){i&&i!=="antialiased"?n.defines.NO_RGSS="":delete n.defines.NO_RGSS,n.needsUpdate=!0},vCe={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:DE},fontSide:{m:"side"},font:{m:"glyphMap",t:yCe},color:{m:"color"},fontOpacity:{m:"opacity"},fontSmooth:{m:"NO_RGSS",t:bCe},invertAlpha:{m:"INVERT_ALPHA",t:XX}},xCe=`
${kX}
#include <clipping_planes_pars_vertex>
void main() {
	${GX}
	#include <begin_vertex>
	#include <project_vertex>
	${PX}
	#include <clipping_planes_vertex>
}
`,wCe=`
uniform vec3 diffuse;
uniform float opacity;
${NX}
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	// instead of <color_fragment> : vec4 diffuseColor
	vec4 diffuseColor = vec4( diffuse, opacity );
	${VX}
	#include <alphatest_fragment>
	// instead of <output_fragment>
	gl_FragColor = diffuseColor;
	#include <clipping_planes_fragment>
}
`,CCe=.02;class VZ extends st.ShaderMaterial{static get mediation(){return nh.mediation}constructor(e={}){super({uniforms:{glyphMap:{value:null},diffuse:{value:null},opacity:{value:1},unitRange:{value:new st.Vector2(0,0)},alphaTest:{value:CCe}},transparent:!0,clipping:!0,vertexShader:xCe,fragmentShader:wCe,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0,this.noRGSS=e.noRGSS||!1}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get opacity(){return this.uniforms.opacity.value}get unitRange(){return this.uniforms.unitRange.value}set unitRange(e){this.uniforms.unitRange.value.copy(e)}get glyphMap(){return this.uniforms.glyphMap.value}set glyphMap(e){this.uniforms.glyphMap.value=e}get isDefault(){return this.constructor===VZ}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(e){this.uniforms.alphaTest.value=e}}class SCe extends yw{constructor(e,i,s,r){if(super(e,i),this._unitRange=new st.Vector2(1,1),s.pages?this._buildData(s):_Ce(this,s),r instanceof st.Texture)this._texture=r,this._buildTexture(r);else if(typeof r=="string"||r instanceof String)MCe(this,r);else throw new Error(`ThreeMeshUI::MSDFVariant provided 'texture' parameter is '${typeof r}'. Only Texture and String allowed.`);this._defaultMaterialClass=VZ,this._checkReadiness()}get texture(){return this._texture}get unitRange(){return this._unitRange}set fontMaterial(e){this._defaultMaterialClass=e}get fontMaterial(){return this._defaultMaterialClass}_buildData(e){this._font=new cCe(e),this._kernings=this._buildKerningPairs(e),this._chars=this._buildCharacters(e),this._chars[" "]=this._buildCharacterWhite(e),this._chars[`
`]=this._buildCharacterWhite(e,`
`,.001,1),this._chars["	"]=this._buildCharacterWhite(e,"	",4,1),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._distanceRange=e.distanceField.distanceRange,this._unitRange=new st.Vector2(this._distanceRange,this._distanceRange).divide(new st.Vector2(e.common.scaleW,e.common.scaleH))}_buildTexture(e){e.generateMipmaps=!1,e.minFilter=st.LinearFilter,e.magFilter=st.LinearFilter,e.needsUpdate=!0}_getFallbackCharacter(e){return r0.missingCharacter(this,e)}getGeometricGlyph(e,i){return new dCe(e,i)}_readyCondition(){return this._chars&&this._texture&&this._texture.image}_buildKerningPairs(e){const i={};for(let s=0;s<e.kernings.length;s++){const r=e.kernings[s];if(r.amount===0)continue;const o=String.fromCharCode(r.first,r.second);i[o]=r.amount}return i}_buildCharacters(e){const i={};for(let s=0;s<e.chars.length;s++){const r=e.chars[s];i[r.char]=new Zk(this._font,r)}return i}_buildCharacterWhite(e,i=" ",s=1,r=1){return new Zk(this._font,{char:i,width:e.info.size/3*s,height:e.info.size*.7*r})}_alterElementProperties(e){}}function _Ce(n,e){new st.FileLoader().setResponseType("json").load(e,i=>{n._buildData(i),n._checkReadiness()})}function MCe(n,e){n._texture=new st.TextureLoader().load(e,i=>{n._buildTexture(i),n._checkReadiness()})}class zE extends st.EventDispatcher{constructor(e){super(),m(this,"_checkReadiness",()=>{this._variants.every(i=>i.isReady)&&TCe(this)}),this._name=e,this._variants=[],this._isReady=!1}get isReady(){return this._isReady}addVariant(e,i,s,r,o=!1){if(o||!this.getVariant(e,i)){this._isReady=!1;const a=new SCe(e,i,s,r);this._variants.push(a),a.isReady?this._checkReadiness():a.addEventListener("ready",this._checkReadiness)}else console.warn(`FontFamily('${this._name}')::addVariant() - Variant(${e}, ${i}) already exists.`);return this}addCustomImplementationVariant(e,i=!1){return i||!this.getVariant(e.weight,e.style)?(this._isReady=!1,this._variants.push(e),e.isReady?this._checkReadiness():e.addEventListener("ready",this._checkReadiness)):console.warn(`FontFamily('${this._name}')::addCustomImplementationVariant() - Variant(${e.weight}, ${e.style}) already exists.`),this}getVariant(e,i){return e=IX(e),this._variants.find(s=>s.weight===e&&s.style===i)}get name(){return this._name}}const ICe={type:"ready"};function TCe(n){n._isReady=!0,n.dispatchEvent(ICe)}const FE={},ECe=function(n){const e=[...arguments];e.forEach(s=>{if(!(s instanceof zE))throw new Error(`FontLibrary::prepare() - One of the provided parameter is not a FontFamily. Instead ${typeof s} given.`)});const i=function(){return e.every(s=>s.isReady)};return new Promise((s,r)=>{if(i())s();else for(let o=0;o<e.length;o++){const a=e[o];a.isReady||a.addEventListener("ready",()=>{i()&&s()})}})},RCe=function(n){return FE[n]&&console.error(`FontLibrary::addFontFamily - Font('${n}') is already registered`),FE[n]=new zE(n),FE[n]},LCe=function(n){return FE[n]},BCe=function(n){U6=n};let U6=function(n,e){return console.error(`The character '${e}' is not included in the font characters set.`)," "};function kCe(n,e){return U6(n,e)}const GCe={addFontFamily:RCe,getFontFamily:LCe,prepare:ECe,setMissingCharacterHandler:BCe,missingCharacter:kCe},r0=GCe;class O6 extends ns{constructor(){super("fontFamily","inherit",!0)}computeOutputValue(e){if(this._input instanceof zE)this._value=this._input;else if(this._input!=="inherit")if(typeof this._input=="string"){const i=r0.getFontFamily(this._input);i?this._value=i:console.warn(`(.style) fontFamily, the font '${this._input}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}getInheritedInput(e){if(this._input!=="inherit")return this._input;const i=e._parent._value;return i?i[`_${this._id}`].getInheritedInput(i):this.getDefaultValue()}}class Z6 extends ns{constructor(){super("lineHeight","inherit",!0)}update(e,i){super.update(e,i),e._layouter._needsProcess=!0}}class W6 extends ns{constructor(){super("whiteSpace","inherit"),this.isValidValue=NCe}}const PCe=["normal","nowrap","pre","pre-line","pre-wrap"];function NCe(n){return PCe.indexOf(n)===-1?(console.warn(`(.style) whiteSpace value '${n}' is not valid. Aborted`),!1):!0}class H6 extends ns{constructor(){super("letterSpacing","inherit",!0)}}class VCe extends ns{constructor(){super("fontSize","inherit",!0)}}class Q6 extends dn{constructor(){super("segments",1,!1)}}class XCe extends s0{constructor(){super("invertAlpha","inherit")}}class UE extends ns{constructor(){super("fontKerning","inherit"),this.isValidValue=zCe}}const DCe=["normal","none","inherit"];function zCe(n){return DCe.indexOf(n)===-1?(console.warn(`(.style) fontKerning value '${n}' is not valid. Aborted`),!1):!0}class OE extends s0{constructor(e){super(e,"inherit",!0)}}class K6 extends s0{constructor(e){super(e,"inherit",!1),this._mediation={},this._defaultMaterial=null}update(e,i){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"?this._notInheritedValue=this.getInheritedInput(e):this.propagate(e),this._notInheritedValue?this._notInheritedValue.constructor.mediation?this._mediation={...this._notInheritedValue.constructor.mediation}:this._mediation={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:DE},fontSide:{m:"side"},color:{m:"color"},fontOpacity:{m:"opacity"}}:this._mediation={},e._transferToFontMaterial(),this._outputValue(i)}getInheritedInput(e){if(this._value!=="inherit")return this._value;let i=e,s=null;for(;i._parent._value;)if(i=i._parent._value,i[`_${this._id}`]._value!=="inherit"){s=i[`_${this._id}`]._value;break}return s!==null?s:this.getDefaultValue()}getDefaultValue(){return this._defaultMaterial}}const FCe=function(n,e,i){n.traverse(s=>{s.renderOrder=i})};class vw extends st.Object3D{constructor(e,i){super(),m(this,"_rebuildParentUI",()=>{this._parent._needsUpdate=!0,this.parent&&!this.parent.isUI?(ZE.register(this),this.activatePseudoState("root")):(ZE.remove(this),this.deactivatePseudoState("root"))}),Object.defineProperties(this,{isUI:{configurable:!1,enumerable:!0,value:!0}}),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundCustomDepthMaterial=null,this._backgroundMaterialMediation={},this._backgroundMeshMediation={backgroundCastShadow:{m:"castShadow"},backgroundReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder",t:FCe}},this._fontMesh=null,this._fontMaterial=new K6("fontMaterial"),this._fontCustomDepthMaterial=new K6("fontCustomDepthMaterial"),this._fontMeshMediation={fontMaterial:{m:"material"},fontCustomDepthMaterial:{m:"customDepthMaterial",t:gwe},fontCastShadow:{m:"castShadow"},fontReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder"}},this._children=e.children?new e.children:new Vu("children"),this._parent=new fwe,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI),this._backgroundSide=new T6("backgroundSide"),this._fontSide=new T6("fontSide"),this._backgroundAlphaTest=new I6("backgroundAlphaTest",.02),this._fontAlphaTest=new I6("fontAlphaTest",.02),this._visible=new Zwe("visible",!0),this._backgroundCastShadow=new OE("backgroundCastShadow"),this._fontCastShadow=new OE("fontCastShadow"),this._backgroundReceiveShadow=new OE("backgroundReceiveShadow"),this._fontReceiveShadow=new OE("fontReceiveShadow"),this._renderOrder=new awe,this._segments=e.segments?new e.segments:new Q6,this._bounds=e.bounds?new e.bounds:new Vu("bounds"),this._order=new eCe,this._padding=new pwe,this._margin=new mwe,this._position=new P6,this._flexDirection=e.flexDirection?new e.flexDirection:new LX,this._justifyContent=e.justifyContent?new e.justifyContent:new BX,this._alignItems=e.alignItems?new e.alignItems:new EX,this._display=new Mwe("flex"),this._boxSizing=new Ewe("border-box"),this._width=new nCe,this._height=new sCe,this._backgroundColor=e.backgroundColor?new e.backgroundColor:new G6,this._backgroundOpacity=new TX("backgroundOpacity",.5),this._backgroundImage=new kwe,this._backgroundSize=new Pwe("cover"),this._color=e.color?new e.color:new bw("color","inherit"),this._fontOpacity=new TX("fontOpacity","inherit"),this._whiteSpace=e.whiteSpace?new e.whiteSpace:new W6,this._fontFamily=e.fontFamily?new e.fontFamily:new O6,this._fontStyle=e.fontStyle?new e.fontStyle:new X6("normal"),this._fontWeight=e.fontWeight?new e.fontWeight:new D6,this._fontSize=e.fontSize?new e.fontSize:new VCe,this._lineHeight=e.lineHeight?new e.lineHeight:new Z6,this._fontKerning=e.fontKerning?new e.fontKerning:new UE,this._letterSpacing=e.letterSpacing?new e.letterSpacing:new H6,this._overflow=new Xwe("visible"),this._borderRadius=new Uwe(0),this._borderWidth=new Owe(0),this._borderColor=new bw("borderColor",16711935),this._borderOpacity=new TX("borderOpacity",1),this._font=new Cwe,this._lineBreak=e.lineBreak?new e.lineBreak:new Vu("lineBreak"),this._textContent=e.textContent?new e.textContent:new V6,this._glyphs=e.glyphs?new e.glyphs:new Vu("glyphs"),this._inlines=e.inlines?new e.inlines:new Vu("inlines"),this._layouter=e.layouter?new e.layouter:new Vu("layouter"),this._inlineJustificator=new Wwe,this._textAlign=e.textAlign?new e.textAlign:new RX,this._autoSize=e.autoSize?new e.autoSize:new Vu("autoSize"),this._renderer=e.renderer?new e.renderer:new Vu("renderer"),this._offset=new lwe,this._invertAlpha=new XCe,this._fontSmooth=e.fontSmooth?new e.fontSmooth:new cwe,this._components=[this._textContent,this._children,this._parent,this._autoSize,this._fontFamily,this._fontStyle,this._fontWeight,this._font,this._whiteSpace,this._glyphs,this._inlines,this._visible,this._backgroundSide,this._fontSide,this._backgroundAlphaTest,this._fontAlphaTest,this._backgroundCastShadow,this._fontCastShadow,this._backgroundReceiveShadow,this._fontReceiveShadow,this._renderOrder,this._segments,this._padding,this._margin,this._width,this._height,this._borderWidth,this._boxSizing,this._bounds,this._position,this._flexDirection,this._justifyContent,this._alignItems,this._order,this._display,this._backgroundColor,this._backgroundOpacity,this._backgroundImage,this._backgroundSize,this._fontOpacity,this._color,this._fontSize,this._lineHeight,this._fontKerning,this._letterSpacing,this._borderRadius,this._borderColor,this._borderOpacity,this._lineBreak,this._offset,this._layouter,this._inlineJustificator,this._textAlign,this._invertAlpha,this._fontSmooth,this._fontMaterial,this._fontCustomDepthMaterial,this._overflow,this._renderer],this._onAfterUpdates=[],i.backgroundSide||(i.backgroundSide=0),i&&this.set(i)}update(){const e={};for(const i of this._components)i._needsUpdate&&(i.update(this,e),i._needsUpdate=!1);this._transferToBackgroundMesh(e),this._transferToFontMesh(e),this._transferToBackgroundMaterial(e),this._transferToFontMaterial(e);for(const i of this._children._uis)i.update()}process(){for(const e of this._children._uis)e.process();for(const e of this._components)e._needsProcess&&(e.process(this),e._needsProcess=!1)}render(){for(let e=0;e<this._components.length;e++){const i=this._components[e];i._needsRender&&(i.render(this),i._needsRender=!1)}for(const e of this._children._uis)e.render()}set(e){if(e.fontTexture&&(console.warn("ThreeMeshUI::set( {fontTexture} ) is deprecated. Please use fontLibrary to register font families and variants."),e.fontFamily)){const i=e.fontFamily.pages?e.fontFamily.info.face:e.fontFamily;let s=r0.getFontFamily(i);if(!s){const r=e.fontStyle?e.fontStyle:"normal",o=e.fontWeight?e.fontWeight:"400";s=r0.addFontFamily(i).addVariant(o,r,e.fontFamily,e.fontTexture)}e.fontFamily=s,delete e.fontTexture}for(let i of Object.keys(e)){const s=e[i];switch(i){case"contentDirection":console.warn("ThreeMeshUI v7xx: property `contentDirection` is deprecated and has been renamed as `flexDirection`"),i="flexDirection";break;case"interLine":console.warn("ThreeMeshUI v7xx: property `interLine` is deprecated and has been renamed as `lineHeight`"),i="lineHeight";break;case"content":console.warn("ThreeMeshUI v7xx: property `content` is deprecated and has been renamed as `textContent`"),i="textContent";break;case"fontColor":console.warn("ThreeMeshUI v7xx: property `fontColor` is deprecated and has been renamed as `color`"),i="color";break;case"hiddenOverflow":console.warn("ThreeMeshUI v7xx: property `hiddenOverflow` is deprecated and has been renamed as `overflow`"),i="overflow";break;case"backgroundTexture":console.warn("ThreeMeshUI v7xx: property `backgroundTexture` is deprecated and has been renamed as `backgroundImage`"),i="backgroundImage";break;case"alignContent":console.warn("ThreeMeshUI v7xx: property `alignContent` is deprecated and has been renamed as `alignItems`"),i="alignItems";break;case"borderTopColor":case"borderBottomColor":case"borderLeftColor":case"borderRightColor":i="borderColor";break}switch(i){case"fontSmooth":case"renderOrder":case"segments":case"visible":case"offset":this[`_${i}`].value=s;break;case"flexDirection":case"justifyContent":case"alignItems":case"color":case"fontFamily":case"fontOpacity":case"fontKerning":case"fontSize":case"fontStyle":case"fontWeight":case"textAlign":case"letterSpacing":case"lineHeight":case"whiteSpace":case"breakOn":case"width":case"height":case"padding":case"margin":case"backgroundColor":case"backgroundOpacity":case"backgroundImage":case"backgroundSize":case"borderColor":case"borderOpacity":case"borderRadius":case"borderWidth":case"overflow":case"order":case"boxSizing":this[`_${i}`]&&(this[`_${i}`].inline=s);break;case"paddingTop":this._padding.top=s;break;case"paddingRight":this._padding.right=s;break;case"paddingBottom":this._padding.bottom=s;break;case"paddingLeft":this._padding.left=s;break;case"marginTop":this._margin.top=s;break;case"marginRight":this._margin.right=s;break;case"marginBottom":this._margin.bottom=s;break;case"marginLeft":this._margin.left=s;break;case"borderTopWidth":this._borderWidth.top=s;break;case"borderRightWidth":this._borderWidth.right=s;break;case"borderBottomWidth":this._borderWidth.bottom=s;break;case"borderLeftWidth":this._borderWidth.left=s;break;case"borderTopLeftRadius":this._borderRadius.topLeft=s;break;case"borderTopRightRadius":this._borderRadius.topRight=s;break;case"borderBottomRightRadius":this._borderRadius.bottomRight=s;break;case"borderBottomLeftRadius":this._borderRadius.bottomLeft=s;break;case"side":case"castShadow":case"receiveShadow":const r=i.charAt(0).toUpperCase()+i.substr(1);this[`_background${r}`].value=s,this[`_font${r}`].value=s;break;case"fontSide":case"backgroundSide":case"fontCastShadow":case"backgroundCastShadow":case"fontReceiveShadow":case"backgroundReceiveShadow":case"fontMaterial":case"fontCustomDepthMaterial":this[`_${i}`].value=s;break;default:this[`_${i}`]!==void 0?this[`_${i}`].value=s:this[i]=s}}}get(e){switch(e){case"overflow":case"width":case"height":return this[`_${e}`].inline}}_rebuildChildrenLists(){this._children._needsUpdate=!0}add(e){let i=!1;for(let s=0;s<arguments.length;s++)super.add(arguments[s]),arguments[s].isUI&&(i=!0);return i&&this._rebuildChildrenLists(),this}remove(e){for(const i of Object.keys(arguments))arguments[i].isInline&&this.update(null,!0);return super.remove(...arguments),this._rebuildChildrenLists(),this}clear(){return this.removeFromParent(),this.traverse(e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose()}),super.clear(),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundMaterialMediation=null,this._backgroundMeshMediation=null,this._children.dispose(),this._children=null,this._parent.dispose(),this._parent=null,this._backgroundSide=null,this._backgroundAlphaTest=null,this._visible=null,this._backgroundCastShadow=null,this._backgroundReceiveShadow=null,this._renderOrder=null,this._segments=null,this._bounds=null,this._boxSizing=null,this._padding=null,this._margin=null,this._position=null,this._flexDirection=null,this._justifyContent=null,this._alignItems=null,this._display=null,this._backgroundColor=null,this._backgroundOpacity=null,this._backgroundSize=null,this._fontOpacity=null,this._color=null,this._whiteSpace=null,this._fontFamily=null,this._fontStyle=null,this._fontWeight=null,this._lineHeight=null,this._fontKerning=null,this._letterSpacing=null,this._overflow=null,this._textAlign=null,this._font=null,this._lineBreak=null,this._layouter=null,this}get textContent(){return this._textContent.process(this),this._textContent._value}get backgroundMaterial(){return this._backgroundMaterial}set backgroundMaterial(e){this._backgroundMaterial=e,this._backgroundMaterialMediation={...e.constructor.mediation},this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.material=this._backgroundMaterial,Mc(e,"frameSize",this._backgroundMesh.scale))}set backgroundCustomDepthMaterial(e){this._backgroundCustomDepthMaterial=e,this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial)}get backgroundCustomDepthMaterial(){return this._backgroundCustomDepthMaterial}_transferToBackgroundMaterial(e=null){if(!e){e={};for(const i of this._components)i.output(e)}NE.mediate(this,this._backgroundMaterial,e,this._backgroundMaterialMediation,this._backgroundCustomDepthMaterial)}set backgroundSide(e){this._backgroundSide.value=e,this._backgroundMaterial&&(this._backgroundMaterial.side=e)}get backgroundSide(){return this._backgroundSide.value}set backgroundAlphaTest(e){this._backgroundAlphaTest.value=e,this._backgroundMaterial&&(this._backgroundMaterial.alphaTest=e)}get backgroundAlphaTest(){return this._backgroundAlphaTest.value}get fontMaterial(){return this._fontMaterial.value}set fontMaterial(e){this._fontMaterial.value=e}set fontCustomDepthMaterial(e){this._fontCustomDepthMaterial.value=e}get fontCustomDepthMaterial(){return this._fontCustomDepthMaterial.value}_transferToFontMaterial(e=null){const i=this._fontMaterial.value;if(i){if(!e){e={};for(const s of this._components)s.output(e)}NE.mediate(this,i,e,this._fontMaterial._mediation,this._fontCustomDepthMaterial.value)}}set fontSide(e){this._fontSide.value=e}get fontSide(){return this._fontSide.value}set fontAlphaTest(e){this._fontAlphaTest.value=e}get fontAlphaTest(){return this._fontAlphaTest.value}_transferToBackgroundMesh(e=null){if(!e){e={};for(const i of this._components)i.output(e)}NE.mediate(this,this._backgroundMesh,e,this._backgroundMeshMediation)}setBackgroundMesh(e){this._backgroundMesh&&(this.remove(this._backgroundMesh),this.unbindBackgroundMeshProperties()),this._backgroundMesh=e,this._backgroundMesh&&(this.bindBackgroundMeshProperties(),this._backgroundCustomDepthMaterial&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial),this._backgroundMaterial&&Mc(this._backgroundMaterial,"frameSize",this._backgroundMesh.scale),this._transferToBackgroundMesh(),this.add(this._backgroundMesh))}bindBackgroundMeshProperties(){}unbindBackgroundMeshProperties(){}activatePseudoState(e){}deactivatePseudoState(e){}togglePseudoState(e){}hasPseudoState(e){return!1}set borderRadiusMediation(e){this._borderRadius.mediation=e}set backgroundCastShadow(e){this._backgroundCastShadow&&(this._backgroundCastShadow.value=e)}get backgroundCastShadow(){return this._backgroundCastShadow}set backgroundReceiveShadow(e){this._backgroundReceiveShadow&&(this._backgroundReceiveShadow.value=e)}get backgroundReceiveShadow(){return this._backgroundReceiveShadow}set renderOrder(e){this._renderOrder&&(this._renderOrder.value=e)}get renderOrder(){return this._renderOrder.value}_transferToFontMesh(e=null){if(this._fontMesh){if(!e){e={};for(const i of this._components)i.output(e)}NE.mediate(this,this._fontMesh,e,this._fontMeshMediation)}}setFontMesh(e){this._fontMesh&&(this.remove(this._fontMesh),this._fontMesh.material&&this._fontMesh.material.dispose(),this._fontMesh.geometry&&this._fontMesh.geometry.dispose(),this._fontMesh=null,this.unbindFontMeshProperties()),this._fontMesh=e,this._fontMesh&&(this._fontMesh.raycast=()=>{},this.bindFontMeshProperties(),this._transferToFontMaterial(),this._transferToFontMesh(),this.add(this._fontMesh))}bindFontMeshProperties(){}unbindFontMeshProperties(){}set fontCastShadow(e){this._fontCastShadow&&(this._fontCastShadow.value=e)}get fontCastShadow(){return this._fontCastShadow}set fontReceiveShadow(e){this._fontReceiveShadow&&(this._fontReceiveShadow.value=e)}get fontReceiveShadow(){return this._fontReceiveShadow}set segments(e){this._segments.value=e}get segments(){return this._segments.value}set onAfterUpdate(e){console.warn("ThreeMeshUI v7xx : `onAfterUpdate()` property has been deprecated, please rely on `addAfterUpdate` instead."),this.addAfterUpdate(e)}addAfterUpdate(e){this._onAfterUpdates.push(e)}removeAfterUpdate(e){const i=this._onAfterUpdates.indexOf(e);i!==-1&&this._onAfterUpdates.splice(i,1)}performAfterUpdate(){for(let e=0;e<this._onAfterUpdates.length;e++)this._onAfterUpdates[e]()}getProperty(e){return this[`_${e}`]?this[`_${e}`]:null}appendProperty(e,i){this[`_${e}`]=i,this._components.push(i)}replaceProperty(e,i){const s=this[`_${e}`],r=this._components.indexOf(s);return this._components[r]=this[`_${e}`]=i,i.needsUpdate=!0,s}}class ZE{static register(e){this.elements.includes(e)||this.elements.push(e)}static remove(e){const i=this.elements.indexOf(e);i!==-1&&this.elements.splice(i,1)}static update(){for(const e of this.elements)e.update(),e.process(),e.process(),e.render()}}ZE.elements=[];const UCe=`

// FrameBorder vertex pars
attribute vec2 uvB;
varying vec2 vUvB;

`,DX=UCe,OCe=`

	// FrameBorder vertex shader
	vUvB = uvB;

`,zX=OCe,ZCe=`

// borders sequences are : x:TOP, y:RIGHT, z:BOTTOM, w:LEFT
uniform vec4 borderWidth;
uniform vec3 borderColor;
uniform float borderOpacity;
uniform vec4 borderRadius;

uniform vec2 cornerTL;
uniform vec2 cornerTR;
uniform vec2 cornerBR;
uniform vec2 cornerBL;

varying vec2 vUvB;

float getEllipticFactor( vec2 uv, vec2 center, float radiusX, float radiusY )
{

		float edx = uv.x - center.x;
		float edy = uv.y - center.y;

		float ddx = (edx * edx) / (radiusX * radiusX);
		float ddy = (edy * edy) / (radiusY * radiusY);

		return ddx + ddy;

}

`,FX=ZCe,WCe=`

vec4 borderColor = vec4( borderColor, borderOpacity );

// This could be tweak to produce more smoothing
float mult = 1.0;

// Step 1 ----------------------------------------------
// Draw the four borders ( top - right - bottom - left )
// Without worrying about radiuses ( Straight boorders )

// Top
float topBorderUVy = 1.0 - borderWidth.x;
if( borderWidth.x > 0.0 && vUvB.y > topBorderUVy )
{

	float w = fwidth( 1.0 - vUvB.y ) * mult;
	float step = smoothstep( topBorderUVy , topBorderUVy + w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Left
float leftBorderUVx = borderWidth.w;
if( borderWidth.w > 0.0 && vUvB.x < leftBorderUVx )
{

	float w = fwidth( vUvB.x ) * mult ;
	float step = smoothstep( leftBorderUVx , leftBorderUVx - w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Bottom
float bottomBorderUVy = borderWidth.z;
if( borderWidth.z > 0.0 && vUvB.y < bottomBorderUVy )
{
	float w = fwidth( vUvB.y ) * mult;
	float step = smoothstep( bottomBorderUVy , bottomBorderUVy - w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );
}

// Right
float rightBorderUVx = 1.0 - borderWidth.y;
if( borderWidth.y > 0.0 && vUvB.x > rightBorderUVx )
{
	float w = fwidth( 1.0 - vUvB.x ) * mult;
	float step = smoothstep( rightBorderUVx , rightBorderUVx + w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );
}


// Step 2 ----------------------------------------------
// Process each corners ( topLeft, topRight, bottomRight, bottomLeft )
// To transparentize outside radiuses
// To draw ellipse border on the corner


// Top Left corner
if( vUvB.x < cornerTL.x && vUvB.y > cornerTL.y ) {

		// Only draw border if width is set
		if( borderWidth.w + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x - borderWidth.w,  ( 1.0 - cornerTL.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		// Then then radius
		float radiusFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x, 1.0 - cornerTL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Left
if( vUvB.x < cornerBL.x && vUvB.y < cornerBL.y ) {

		if( borderWidth.w + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x - borderWidth.w,  cornerBL.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}


		float radiusFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x, cornerBL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Top Right
if( vUvB.x > cornerTR.x && vUvB.y > cornerTR.y ) {

		if( borderWidth.y + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTR, ( 1.0 - cornerTR.x ) - borderWidth.y,  ( 1.0 - cornerTR.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerTR, 1.0 - cornerTR.x, 1.0 - cornerTR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Right
if( vUvB.x > cornerBR.x && vUvB.y < cornerBR.y ) {

		if( borderWidth.y + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBR, ( 1.0 - cornerBR.x ) - borderWidth.y,  cornerBR.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerBR, 1.0 - cornerBR.x, cornerBR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}

`,UX=WCe,HCe=`

// To be removed - required for both border and background
uniform vec3 frameSize;
uniform vec2 textureSize;

`,OX=HCe,QCe=`

#ifdef USE_MAP

vec4 sampleTexture() {

	vec2 uv = vUv;

	// default stretch
	#if BACKGROUND_MAPPING != 0

	float textureRatio = textureSize.x / textureSize.y;
	float panelRatio = frameSize.x / frameSize.y;
	float ratio = panelRatio / textureRatio;
	float ratio2 = textureRatio / panelRatio;

		// contain
		#if BACKGROUND_MAPPING == 1
		if ( textureRatio < panelRatio ) { // repeat on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		} else { // repeat on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		}
		#else
		// cover
		if ( textureRatio < panelRatio ) { // stretch on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		} else { // stretch on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		}

		#endif

	#endif

	return texture2D( map, uv );

}
#endif
`,ZX=QCe,KCe=`
#ifdef USE_MAP

	vec4 textureSample = sampleTexture();
	diffuseColor *= textureSample;

#endif
`,WX=KCe,Y6={msdfAlphaglyphParsVertexGlsl:kX,msdfAlphaglyphVertexGlsl:GX,msdfOffsetglyphVertexGlsl:PX,msdfAlphaglyphParsFragmentGlsl:NX,msdfAlphaglyphFragmentGlsl:VX,frameBorderParsVertexGlsl:DX,frameBorderVertexGlsl:zX,frameCommonParsFragmentGlsl:OX,frameBorderParsFragmentGlsl:FX,frameBorderFragmentGlsl:UX,frameBackgroundParsFragmentGlsl:ZX,frameBackgroundFragmentGlsl:WX},YCe=`
// Would be automatic on three materials and from USE_UV
#ifdef USE_MAP
varying vec2 vUv;
#endif

${DX}

#include <clipping_planes_pars_vertex>

void main() {

	#ifdef USE_MAP
	vUv = uv;
	#endif

	${zX}

	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;

	#include <clipping_planes_vertex>

}
`,jCe=`

// Basic
uniform vec3 diffuse;
uniform float opacity;

#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif

${OX}

${FX}


#ifdef USE_MAP
varying vec2 vUv;
uniform sampler2D map;
#endif

${ZX}

#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );

	// map
	${WX}

	${UX}

	#ifdef USE_ALPHATEST

	if ( diffuseColor.a < alphaTest ) discard;

	#endif

	// output
	gl_FragColor = diffuseColor;


	#include <clipping_planes_fragment>
}
`;class Wk{static get mediation(){return qCe}static ensureMaterialOptions(e){e.transparent=!0,e.alphaTest=e.alphaTest||.02}static ensureDefines(e){e.defines||(e.defines={})}static ensureUserData(e,i){e.userData.borderColor={value:null},e.userData.borderRadius={value:new st.Vector4(0,0,0,0)},e.userData.cornerTL={value:new st.Vector2(0,1)},e.userData.cornerTR={value:new st.Vector2(1,1)},e.userData.cornerBR={value:new st.Vector2(1,0)},e.userData.cornerBL={value:new st.Vector2(0,0)},e.userData.borderWidth={value:new st.Vector4(0,0,0,0)},e.userData.borderOpacity={value:null},e.userData.frameSize={value:new st.Vector3(1,1,1)},e.userData.textureSize={value:new st.Vector2(1,1)}}static bindUniformsWithUserData(e,i){e.uniforms.borderColor=i.userData.borderColor,e.uniforms.borderRadius=i.userData.borderRadius,e.uniforms.cornerTL=i.userData.cornerTL,e.uniforms.cornerTR=i.userData.cornerTR,e.uniforms.cornerBR=i.userData.cornerBR,e.uniforms.cornerBL=i.userData.cornerBL,e.uniforms.borderWidth=i.userData.borderWidth,e.uniforms.borderOpacity=i.userData.borderOpacity,e.uniforms.frameSize=i.userData.frameSize,e.uniforms.textureSize=i.userData.textureSize}static injectShaderChunks(e){Wk.injectVertexShaderChunks(e),Wk.injectFragmentShaderChunks(e)}static injectVertexShaderChunks(e){e.vertexShader=e.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+DX),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+zX)}static injectFragmentShaderChunks(e){e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+ZX),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+FX),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+OX),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",WX),e.fragmentShader=e.fragmentShader.replace("#include <alphamap_fragment>",UX+`
#include <alphamap_fragment>`)}}const JCe=function(n,e,i){i=["stretch","contain","cover"].indexOf(i),F6(n,"BACKGROUND_MAPPING",i)},qCe={clippingPlanes:{m:"clippingPlanes"},backgroundAlphaTest:{m:"alphaTest",t:DE},backgroundSide:{m:"side"},backgroundImage:{m:"map"},backgroundColor:{m:"color"},backgroundOpacity:{m:"opacity"},backgroundSize:{m:"computedBackgroundSize",t:JCe},borderWidth:{m:"borderWidth",t:Mc},borderColor:{m:"borderColor",t:Mc},cornerTL:{m:"cornerTL",t:Mc},cornerTR:{m:"cornerTR",t:Mc},cornerBR:{m:"cornerBR",t:Mc},cornerBL:{m:"cornerBL",t:Mc},borderOpacity:{m:"borderOpacity",t:Mc},size:{m:"frameSize",t:Mc},tSize:{m:"textureSize",t:Mc}};class j6 extends st.ShaderMaterial{static get mediation(){return Wk.mediation}constructor(){super({uniforms:{alphaTest:{value:.02},map:{value:null},diffuse:{value:new st.Color(16777215)},opacity:{value:1},borderColor:{value:new st.Color(0)},borderOpacity:{value:0},borderRadius:{value:new st.Vector4(0,0,0,0)},cornerTL:{value:new st.Vector2(0,1)},cornerTR:{value:new st.Vector2(1,1)},cornerBR:{value:new st.Vector2(1,0)},cornerBL:{value:new st.Vector2(0,0)},borderWidth:{value:new st.Vector4(0,0,0,0)},frameSize:{value:new st.Vector3(1,1,1)},textureSize:{value:new st.Vector2(1,1)}},side:st.FrontSide,transparent:!0,clipping:!0,vertexShader:YCe,fragmentShader:jCe,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0}set map(e){this.uniforms.map.value=e,e?this.defines.USE_UV===void 0&&(this.defines.USE_UV="",this.needsUpdate=!0):this.defines.USE_UV!==void 0&&(delete this.defines.USE_UV,this.needsUpdate=!0),this.needsUpdate=!0}get map(){return this.uniforms.map.value}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(e){this.uniforms.alphaTest.value=e}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get opacity(){return this.uniforms.opacity.value}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}}class $Ce extends dn{constructor(){super("children",null,!1),m(this,"_sortOrder",(e,i)=>e._order._value<i._order._value?-1:e._order._value>i._order._value?1:this._uis.indexOf(e)<this._uis.indexOf(i)?-1:1),this._uis=[],this._boxes=[]}update(e,i){this._compute(e),e._layouter._needsUpdate=!0,e._renderOrder._needsUpdate=!0}process(e){this._compute(e),e._flexDirection._needsProcess=!0,e._layouter._needsProcess=!0,e._overflow._needsRender=!0}_compute(e){this._uis=e.children.filter(i=>i.visible&&i.isUI),this._boxes=this._uis.filter(i=>i.isBox).sort(this._sortOrder)}dispose(){this._uis=null,this._boxes=null}}class J6 extends dn{constructor(){super("bounds",null,!1),this._size=new st.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0,this._centerX=.5,this._centerY=.5,this._needsProcess=!0}setReferenceWidth(e,i){const s=e._width,r=e._padding._value,o=e._borderWidth._value,a=e._margin._value,l=s._auto?1:s._value,c=i*l-(a.y+a.w);MX(c,this._offsetWidth)||(this._offsetWidth=c,this._innerWidth=this._offsetWidth-(r.y+r.w+o.y+o.w),this._centerX=HX(e),this._propagateWidth(e),this._triggerCascadingDependencies(e))}setReferenceHeight(e,i){const s=e._height,r=e._padding._value,o=e._borderWidth._value,a=e._margin._value,l=s._auto?1:s._value,c=i*l-(a.x+a.z);MX(c,this._offsetHeight)||(this._offsetHeight=c,this._innerHeight=this._offsetHeight-(r.x+r.z+o.x+o.z),this._centerY=QX(e),this._propagateHeight(e),this._triggerCascadingDependencies(e))}setChildrenWidth(e,i){const s=e._padding._value,r=e._borderWidth._value;this._innerWidth=i,this._offsetWidth=this._innerWidth+(s.y+s.w+r.y+r.w),this._centerX=HX(e),this._propagateWidth(e),this._triggerCascadingDependencies(e)}setChildrenHeight(e,i){const s=e._padding._value,r=e._borderWidth._value;this._innerHeight=i,this._offsetHeight=this._innerHeight+(s.x+s.z+r.x+r.z),this._centerY=QX(e),this._propagateHeight(e),this._triggerCascadingDependencies(e)}update(e,i){const s=e._padding._value,r=e._borderWidth._value,o=e._width;!o._auto&&!o._relative&&(e._boxSizing._value==="content-box"?(this._innerWidth=o._value,this._offsetWidth=this._innerWidth+s.y+s.w+r.y+r.w):(this._offsetWidth=o._value,this._innerWidth=this._offsetWidth-(s.y+s.w+r.y+r.w)),this._centerX=HX(e),this._needsProcess=!0,this._propagateWidth(e),this._triggerCascadingDependencies(e));const a=e._height;!a._auto&&!a._relative&&(e._boxSizing._value==="content-box"?(this._innerHeight=a._value,this._offsetHeight=this._innerHeight+s.x+s.z+r.x+r.z):(this._offsetHeight=a._value,this._innerHeight=this._offsetHeight-(s.x+s.z+r.x+r.z)),this._centerY=QX(e),this._needsProcess=!0,this._propagateHeight(e),this._triggerCascadingDependencies(e))}render(e){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight,e._backgroundMesh&&e._backgroundMesh.updateScale(),e._renderer._needsRender=!0}output(e){e.size=this._size}process(e){e._overflow._needsRender=!0}_computeChildrenSideWidth(e){return eSe(e)}_computeChildrenSideHeight(e){return tSe(e)}_propagateWidth(e){for(let i=0;i<e._children._boxes.length;i++){const s=e._children._boxes[i];s._width._relative&&s._bounds.setReferenceWidth(s,this._innerWidth)}}_propagateHeight(e){for(let i=0;i<e._children._boxes.length;i++){const s=e._children._boxes[i];s._height._relative&&s._bounds.setReferenceHeight(s,this._innerHeight)}}_triggerCascadingDependencies(e){e._parent._value&&(e._parent._value._autoSize._needsProcess=!0),e._flexDirection._needsProcess=!0,e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0,this._needsRender=!0,e._borderWidth._needsRender=!0,e._borderRadius._needsRender=!0,e._overflow._needsRender=!0}}function HX(n){const e=n._padding._value,i=n._borderWidth._value,s=e.w+i.w,r=e.y+i.y;return(s-r)/2}function QX(n){const e=n._padding._value,i=n._borderWidth._value,s=e.x+i.x;return(e.z+i.z-s)/2}function eSe(n){return n._children._boxes.reduce((e,i)=>{const s=i._margin._value,r=i._bounds._offsetWidth+s.y+s.w;return e+r},0)}function tSe(n){return n._children._boxes.reduce((e,i)=>{const s=i._margin._value,r=i._bounds._offsetHeight+s.x+s.z;return e+r},0)}class iSe extends EX{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._process=this.emptyStrategyLogic,this._childAlign=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,e._flexDirection._value){case"row":case"row-reverse":switch(this._process=lSe,this._value){case"start":this._childAlign=sSe;break;case"end":this._childAlign=nSe;break;default:this._childAlign=q6}break;case"column":case"column-reverse":switch(this._process=aSe,this._value){case"start":this._childAlign=oSe;break;case"end":this._childAlign=rSe;break;default:this._childAlign=q6}break}this._needsProcess=!0,e._autoSize._needsProcess=!0,e._flexDirection._needsProcess=!0,e._justifyContent._needsProcess=!0,this._needsProcess=!0,e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0}process(e){this._process(e,this._childAlign);let i="center",s="center",r="center";const o=e._padding._value,a=e._borderWidth._value;e._flexDirection._value.indexOf("column")!==-1?this._value==="start"?i=s="left":this._value==="end"?i=s="right":i="centerX":this._value==="start"?i=r="top":this._value==="end"?i=r="bottom":i="centerY";let l=-(o.x-o.z)/2-(a.x-a.z)/2,c=-(o.y-o.w)/2-(a.y-a.w)/2;s==="left"?c=(o.w-o.y)/2+(a.w-a.y)/2:s==="right"&&(c=-(o.y-o.w)/2-(a.y-a.w)/2),r==="top"?l=-(o.x-o.z)/2-(a.x-a.z)/2:r==="bottom"&&(l=(o.z-o.x)/2+(a.z-a.x)/2),e._children._boxes.forEach(h=>{let d=0,u=0;i==="top"?u=-h._margin._value.x:i==="bottom"?u=h._margin._value.z:i==="left"?d=h._margin._value.w:i==="right"?d=-h._margin._value.y:i==="centerX"?d=(h._margin._value.w-h._margin._value.y)/2:i==="centerY"&&(u=(-h._margin._value.x+h._margin._value.z)/2),e._layouter._childrenPos[h.id].x+=c+d,e._layouter._childrenPos[h.id].y+=l+u})}}function q6(){return 0}function nSe(n,e){return-e+n._bounds._offsetHeight/2}function sSe(n,e){return e-n._bounds._offsetHeight/2}function rSe(n,e){return e-n._bounds._offsetWidth/2}function oSe(n,e){return-e+n._bounds._offsetWidth/2}function aSe(n,e){const i=n._bounds._innerWidth/2;n._children._boxes.forEach(s=>{n._layouter._childrenPos[s.id].x=e(s,i)})}function lSe(n,e){const i=n._bounds._innerHeight/2;n._children._boxes.forEach(s=>{n._layouter._childrenPos[s.id].y=e(s,i)})}class cSe extends LX{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._offset=0,this._reverse=1,this._process=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,this._value){case"row":this._process=hSe;break;case"row-reverse":this._process=dSe;break;case"column":this._process=uSe;break;case"column-reverse":this._process=pSe;break}e._justifyContent._needsUpdate||e._justifyContent.computeOutputValue(e),e._alignItems._needsUpdate||e._alignItems.computeOutputValue(e),this._needsProcess=!0}process(e){switch(this._value){case"row":this._offset=-e._bounds._innerWidth/2;break;case"row-reverse":this._offset=e._bounds._innerWidth/2;break;case"column":this._offset=e._bounds._innerHeight/2;break;case"column-reverse":this._offset=-e._bounds._innerHeight/2;break}this._reverse=-Math.sign(this._offset),this._reverse===0&&(this._reverse=1),this._process(e),e._justifyContent._needsProcess=!0,e._layouter._needsProcess=!0}}function hSe(n){let e=n._flexDirection._offset;const i=n._flexDirection._reverse,s=n._children._boxes;for(let r=0;r<s.length;r++){const o=s[r],a=o.id,l=o._bounds._offsetWidth;e+=o._margin._value.w*i;const c=n._layouter._childrenPos[a];c.x=e+l/2*i,c.y=0,e+=i*(l+o._margin._value.y)}}function dSe(n){let e=n._flexDirection._offset;const i=n._flexDirection._reverse,s=n._children._boxes;for(let r=0;r<s.length;r++){const o=s[r],a=o.id,l=o._bounds._offsetWidth;e+=o._margin._value.y*i;const c=n._layouter._childrenPos[a];c.x=e+l/2*i,c.y=0,e+=(l+o._margin._value.w)*i}}function uSe(n){let e=n._flexDirection._offset;const i=n._flexDirection._reverse,s=n._children._boxes;for(let r=0;r<s.length;r++){const o=s[r],a=o.id,l=o._bounds._offsetHeight;e+=o._margin._value.x*i;const c=n._layouter._childrenPos[a];c.x=0,c.y=e+l/2*i,e+=(l+o._margin._value.z)*i}}function pSe(n){let e=n._flexDirection._offset;const i=n._flexDirection._reverse,s=n._children._boxes;for(let r=0;r<s.length;r++){const o=s[r],a=o.id,l=o._bounds._offsetHeight;e+=o._margin._value.z*i;const c=n._layouter._childrenPos[a];c.x=0,c.y=e+l/2*i,e+=(l+o._margin._value.x)*i}}class mSe extends BX{constructor(e){super("justifyContent",e,!0),this._allowsInherit=!1,this._needsUpdate=!0,this._computeOffset=this.emptyStrategyLogic,this._computeMargin=this.emptyStrategyLogic,this._process=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,e._flexDirection._value){case"column-reverse":case"column":this._process=fSe.bind(this);break;case"row-reverse":case"row":this._process=gSe.bind(this);break}switch(this._value){case"end":this._computeOffset=bSe,this._computeMargin=KX;break;case"center":this._computeOffset=vSe,this._computeMargin=KX;break;case"start":this._computeOffset=WE,this._computeMargin=KX;break;case"space-between":this._computeOffset=WE,this._computeMargin=xSe;break;case"space-around":this._computeOffset=WE,this._computeMargin=CSe;break;case"space-evenly":this._computeOffset=WE,this._computeMargin=wSe;break}e._flexDirection._needsProcess=!0}process(e){this._process(e),e._alignItems._needsProcess=!0}}function gSe(n){const e=n._flexDirection._offset,{usedDirectionSpace:i,remainingSpace:s}=ASe(n),r=e*2-i*Math.sign(e),o=this._computeOffset(r),a=this._computeMargin(n,s,n._flexDirection._reverse);n._children._boxes.forEach((l,c)=>{n._layouter._childrenPos[l.id].x-=o-a[c]})}function fSe(n){const e=n._flexDirection._offset,{usedDirectionSpace:i,remainingSpace:s}=ySe(n),r=e*2-i*Math.sign(e),o=this._computeOffset(r),a=this._computeMargin(n,s,n._flexDirection._reverse);n._children._boxes.forEach((l,c)=>{n._layouter._childrenPos[l.id].y-=o-a[c]})}function ASe(n){const e=n._bounds._computeChildrenSideWidth(n);return{usedDirectionSpace:e,remainingSpace:n._bounds._innerWidth-e}}function ySe(n){const e=n._bounds._computeChildrenSideHeight(n);return{usedDirectionSpace:e,remainingSpace:n._bounds._innerHeight-e}}function WE(n){return 0}function bSe(n){return n}function vSe(n){return n/2}function KX(n,e=0,i=1){return Array(n._children._boxes.length).fill(0)}function xSe(n,e=0,i=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(e>0&&s>1){const o=e/(s-1)*i;r[0]=0;for(let a=1;a<s;a++)r[a]=o*a}return r}function wSe(n,e=0,i=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(e>0){const o=e/(s+1)*i;for(let a=0;a<s;a++)r[a]=o*(a+1)}return r}function CSe(n,e=0,i=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(e>0){const o=e/s*i,a=o/2;r[0]=a;for(let l=1;l<s;l++)r[l]=a+o*l}return r}let YX;class $6 extends st.Mesh{constructor(e){const i=e.slice,s={};let r=1,o=1;if(i){if(r=i.width?i.width:1,o=i.height?i.height:1,i.top){if(i.left){const u=new st.PlaneGeometry(i.left*r,i.top*o,1,1);Xu(u,0,i.left,1-i.top,1),u.translate(i.left*r/2,-i.top*o/2,0),s.topLeft=u}const d=new st.PlaneGeometry(1,i.top*o,1,1);if(Xu(d,i.left,1-i.right,1-i.top,1),d.translate(0,-i.top*o/2,0),s.top=d,i.right){const u=new st.PlaneGeometry(i.right*r,i.top*o,1,1);Xu(u,1-i.right,1,1-i.top,1),u.translate(-i.right*r/2,-i.top*o/2,0),s.topRight=u}}if(i.left){const d=new st.PlaneGeometry(i.left*r,1,1,1);Xu(d,0,i.left,i.bottom,1-i.top),d.translate(i.left*r/2,0,0),s.left=d}const h=new st.PlaneGeometry(1,1,1,1);if(Xu(h,i.left,1-i.right,i.bottom,1-i.top),s.middle=h,i.right){const d=new st.PlaneGeometry(i.right*r,1,1,1);Xu(d,1-i.right,1,i.bottom,1-i.top),d.translate(-i.right*r/2,0,0),s.right=d}if(i.bottom){if(i.left){const u=new st.PlaneGeometry(i.left*r,i.bottom*o,1,1);Xu(u,0,i.left,0,i.bottom),u.translate(i.left*r/2,i.bottom*o/2,0),s.bottomLeft=u}const d=new st.PlaneGeometry(1,i.bottom*o,1,1);if(Xu(d,i.left,1-i.right,0,i.bottom),d.translate(0,i.bottom*o/2,0),s.bottom=d,i.right){const u=new st.PlaneGeometry(i.right*r,i.bottom*o,1,1);Xu(u,1-i.right,1,0,i.bottom),u.translate(-i.right*r/2,i.bottom*o/2,0),s.bottomRight=u}}}let a=e.backgroundMaterial;i&&(YX||(YX=new st.MeshBasicMaterial({alphaTest:1.1})),a=YX);const l=new st.PlaneGeometry(1,1,e._segments.value,e._segments.value),c=new st.BufferAttribute(new Float32Array(l.getAttribute("uv").array),2);if(l.setAttribute("uvB",c).name="uvB",super(l,a),this.name="UIBackgroundBox",i){this.slice=i,this.sliceSize=new st.Vector3(1-(i.left+i.right),1-(i.bottom+i.top),1),this.sliceScale=new st.Vector3(r,o,1);for(const h in s){const d=new st.Mesh(s[h],e.backgroundMaterial);this.add(d),s[h]=d}this.updateScale=this.updateScaleSlice,this.slices=s}}updateScale(){}updateScaleSlice(){const e=new st.Vector3(1,1,1);this.scale.x<(this.slice.left+this.slice.right)*this.sliceScale.x&&(e.x=this.scale.x/((this.slice.left+this.slice.right)*this.sliceScale.x)),this.scale.y<(this.slice.bottom+this.slice.top)*this.sliceScale.y&&(e.y=this.scale.y/((this.slice.bottom+this.slice.top)*this.sliceScale.y));for(const i in this.slices){const s=this.slices[i];s.scale.set(1/this.scale.x,1/this.scale.y,this.scale.y);const r=SSe[i];for(const a in r)s.position[a]=this.scale[a]*r[a]*s.scale[a];const o=_Se[i];if(o){o.x&&(s.position.x=this.sliceScale.x*.5*(this.slice.left-this.slice.right)*(1/this.scale.x)),o.y&&(s.position.y=this.sliceScale.y*.5*(this.slice.bottom-this.slice.top)*(1/this.scale.y));for(const a in o){const l=this.scale[a]-(1-this.sliceSize[a])*this.sliceScale[a];s.scale[a]=Math.max(0,l*(1/this.scale[a]))}}}e.x!==1&&(this.slices.left.scale.x*=e.x,this.slices.topLeft.scale.x*=e.x,this.slices.bottomLeft.scale.x*=e.x,this.slices.right.scale.x*=e.x,this.slices.topRight.scale.x*=e.x,this.slices.bottomRight.scale.x*=e.x),e.y!==1&&(this.slices.top.scale.y*=e.y,this.slices.topLeft.scale.y*=e.y,this.slices.topRight.scale.y*=e.y,this.slices.bottom.scale.y*=e.y,this.slices.bottomLeft.scale.y*=e.y,this.slices.bottomRight.scale.y*=e.y)}}const SSe={topLeft:{x:-.5,y:.5},top:{y:.5},topRight:{x:.5,y:.5},left:{x:-.5},right:{x:.5},bottomLeft:{x:-.5,y:-.5},bottom:{y:-.5},bottomRight:{x:.5,y:-.5}},_Se={top:{x:1},left:{y:1},right:{y:1},bottom:{x:1},middle:{x:1,y:1}};function Xu(n,e,i,s,r){const o=i-e,a=r-s,l=n.attributes.uv;for(let h=0;h<l.count;h++){const d=l.getX(h),u=l.getY(h);l.setXY(h,e+d*o,s+u*a)}const c=new st.BufferAttribute(new Float32Array(n.getAttribute("uv").array),2);n.setAttribute("uvB",c).name="uvB"}class e8 extends dn{constructor(){super("renderer")}render(e){e._backgroundMesh||e.setBackgroundMesh(new $6(e)),e.performAfterUpdate()}}class MSe extends P6{constructor(){super("position")}update(e,i){super.update(e,i),this._needsProcess=!0}}class ISe extends dn{constructor(){super("autosize"),this._needsProcess=!0}process(e){e._width._auto&&TSe(e),e._height._auto&&ESe(e);const i=e._alignItems._value==="stretch",s=i&&e._flexDirection._value.indexOf("column")!==-1,r=i&&!s;for(const o of e._children._boxes)(o._width._auto&&s||o._width._relative)&&o._bounds.setReferenceWidth(o,e._bounds._innerWidth),(o._height._auto&&r||o._height._relative)&&o._bounds.setReferenceHeight(o,e._bounds._innerHeight)}}function TSe(n){n._bounds.setChildrenWidth(n,LSe(n))}function ESe(n){n._bounds.setChildrenHeight(n,RSe(n))}function RSe(n){switch(n._flexDirection._value){case"row":case"row-reverse":return PSe(n);case"column":case"column-reverse":return kSe(n)}}function LSe(n){switch(n._flexDirection._value){case"row":case"row-reverse":return BSe(n);case"column":case"column-reverse":return GSe(n)}}function BSe(n){let e=0;for(const i of n._children._boxes){if(i._position._value!=="static")continue;const s=i._margin._value,r=i._bounds._offsetWidth+s.y+s.w;e+=r}return e}function kSe(n){let e=0;for(const i of n._children._boxes){if(i._position._value!=="static")continue;const s=i._margin._value,r=i._bounds._offsetHeight+s.x+s.z;e+=r}return e}function GSe(n){let e=0;for(const i of n._children._boxes){if(i._position._value!=="static")continue;const s=i._margin._value,r=i._bounds._offsetWidth+s.y+s.w;r>e&&(e=r)}return e}function PSe(n){let e=0;for(const i of n._children._boxes){if(i._position._value!=="static")continue;const s=i._margin._value,r=i._bounds._offsetHeight+s.x+s.z;r>e&&(e=r)}return e}class nM extends vw{constructor(e,i){nM.definePropertiesValues(e,i),super(e,i),nM.init(this)}bindBackgroundMeshProperties(){this._bounds._size=this._backgroundMesh.scale,this._bounds._needsProcess=!0}unbindBackgroundMeshProperties(){this._bounds._size=new st.Vector3(1,1,1),this._bounds._needsProcess=!0}static definePropertiesValues(e,i){e.children||(e.children=$Ce),e.bounds||(e.bounds=J6),e.flexDirection||(e.flexDirection=cSe),e.justifyContent||(e.justifyContent=mSe),e.alignItems||(e.alignItems=iSe),e.position||(e.position=MSe),e.autoSize||(e.autoSize=ISe),e.renderer||(e.renderer=e8),i.fontSide||(i.fontSide=0),i.invertAlpha||(i.invertAlpha=!1),i.fontCastShadow||(i.fontCastShadow=!1),i.fontReceiveShadow||(i.fontReceiveShadow=!1),i.backgroundCastShadow||(i.backgroundCastShadow=!1),i.backgroundReceiveShadow||(i.backgroundReceiveShadow=!1)}static init(e){Object.defineProperties(e,{isBox:{configurable:!1,enumerable:!0,value:!0}}),e.backgroundMaterial=new j6,e._renderer.render(e),e._backgroundMesh.visible=!1}}let t8=class extends Array{constructor(...n){super(...n),this.width=0,this.lineBase=0,this.lineHeight=0,this.y=0}};class NSe extends dn{constructor(){super("layouter",null,!1),this._needsUpdate=!0,this._childrenPos={}}update(e,i){this._childrenPos={};for(const s of e._children._boxes)s._position._value==="static"&&(this._childrenPos[s.id]=s.position)}process(e){}}class sM extends nM{constructor(e={}){const i={};sM.definePropertiesValues(i,e),super(i,e),sM.init(this)}add(e){const i=[];for(let s=0;s<arguments.length;s++){const r=arguments[s];!r.isUI||r.isBox?i.push(r):console.warn("Block element can only contain Box elements.",r)}return super.add(...i)}static definePropertiesValues(e,i){e.layouter=NSe}static init(e){Object.defineProperties(e,{isBlock:{configurable:!1,enumerable:!0,value:!0}})}}class VSe extends dn{constructor(){super("textContent",null,!1)}update(e,i){e._glyphs._needsUpdate=!0,e._whiteSpace._needsProcess=!0}}class XSe extends dn{constructor(){super("inlines",null,!1),this._value=null}process(e){if(this._value=e._glyphs._value.map(i=>i.asInlineGlyph()),this._value.length){this._value[0].paddingLeft=e._padding._value.w,this._value[0].marginLeft=e._margin._value.w;const i=this._value.length-1;this._value[i].paddingRight=e._padding._value.y,this._value[i].marginRight=e._margin._value.y}e._fontSize._needsProcess=!0,e._lineBreak._needsProcess=!0,e._fontKerning._needsProcess=!0,e._layouter._needsProcess=!0}get value(){return this._value}}class DSe extends dn{constructor(){super("glyphs",null,!1),this._needsUpdate=!1,this._value=null}process(e){e._font._fontVariant&&e._font._fontVariant.isReady&&(this._value=e._whiteSpace._whiteSpacedContent.split("").map(i=>e._font._fontVariant.getTypographicGlyph(i)),this._value&&(e._inlines._needsProcess=!0))}get value(){return this._value}}class zSe extends bw{constructor(){super("color","inherit",!1),this.output=this._outputValue}computeOutputValue(e){this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._value.set(this._input)}}class i8 extends dn{constructor(e=`- ,.:?!
`){super("lineBreak",e,!0),this._newLineBreakability=null}update(e,i){this._needsProcess=!0}process(e){const i=e._whiteSpace._newLineBreakability;if(e._inlines._value)for(let s=0;s<e._inlines._value.length;s++){const r=e._inlines._value[s],o=r.char;let a=null;o!==void 0&&(i!=="nowrap"&&(this._value.includes(o)||o.match(/\s/g))&&(a="possible"),o.match(/\n/g)&&(a=i)),r.lineBreak=a}}get value(){return this._value}}class n8 extends dn{constructor(){super("layouter",null,!1),this._value=null}update(e,i){this._value=e._parent.find(s=>s.isUI&&s.isText),this._needsProcess=!0}process(e){this._value&&(this._value._layouter._needsProcess=!0)}}class FSe extends bw{constructor(e){super("backgroundColor",e,!1),this._allowsInherit=!1,this._input=0}computeOutputValue(e){this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._value.set(this._input)}}class s8 extends X6{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class r8 extends D6{constructor(){super()}computeOutputValue(e){this._value=IX(this.getInheritedInput(e))}}class o8 extends O6{constructor(){super("fontFamily","inherit",!0),this._input="inherit",this._needsUpdate=!0,this._allowsInherit=!1}computeOutputValue(e){let i=this._inheritedInput;if(i==="inherit"&&(i=this.getInheritedInput(e)),i instanceof zE)this._value=i,e._font._needsUpdate=!0;else if(typeof i=="string"){const s=r0.getFontFamily(i);s?(this._value=s,e._font._needsUpdate=!0):console.warn(`(.style) fontFamily, the font '${i}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}}class jX extends W6{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited,this._whiteSpacedContent="",this._stringCollapser=this.emptyStrategyLogic,this._inlineCollapser=this.emptyStrategyLogic,this._inlineWrapper=this.emptyStrategyLogic}_computeFromInherited(e){switch(super._computeFromInherited(e),this._newLineBreakability=USe(this._value),this._value){case"nowrap":case"normal":this._stringCollapser=OSe;break;case"pre-line":this._stringCollapser=l8;break;default:this._stringCollapser=ZSe}switch(this._value){case"pre-line":case"nowrap":case"normal":this._inlineCollapser=YSe;break;case"pre-wrap":this._inlineCollapser=KSe;break;default:this._inlineCollapser=jSe}switch(this._value){case"pre-line":case"pre-wrap":case"normal":this._inlineWrapper=WSe;break;case"pre":this._inlineWrapper=HSe;break;default:this._inlineWrapper=QSe}this._needsProcess=!0}process(e){e.isInline&&!e.isInlineBlock&&(this._whiteSpacedContent=this._stringCollapser(e._textContent._value),e._glyphs._needsProcess=!0)}}const a8={"	":"	","\n":`
`,"\r":"\r"," ":" "},USe=function(n){switch(n){case"pre":case"pre-wrap":case"pre-line":return"mandatory"}return null};function OSe(n){return l8(n.replace(/\n/g," "))}function l8(n){return n.replace(/[ ]{2,}/g," ")}function ZSe(n){return n}function WSe(n,e,i,s){const r=n[e];if(r.lineBreak==="mandatory"||i+r.xadvance+r.xoffset+r.kerning>s.INNER_WIDTH)return!0;const o=d8(n,e,s);return JSe(n[e-1],i,o,s)}function HSe(n,e,i,s){return n[e].lineBreak==="mandatory"}function QSe(){return!1}function KSe(n){if(!n[0])return 0;const e=n[0],i=n[n.length-1];return e.char&&e.char===`
`&&n.length>1&&h8([e],n[1]),i.char&&i.char===`
`&&n.length>1&&c8([i],n[n.length-2]),e.offsetX}function YSe(n){if(!n[0])return 0;let e=[],i;for(let s=0;s<n.length;s++){const r=n[s];if(r.char&&a8[r.char]&&n.length>s){e.push(r),i=n[s+1];continue}break}h8(e,i),e=[],i=null;for(let s=n.length-1;s>0;s--){const r=n[s];if(r.char&&a8[r.char]&&s>0){e.push(r),i=n[s-1];continue}break}return c8(e,i),n[0].offsetX}function jSe(n){return n[0]?n[0].offsetX:0}function c8(n,e){if(e)for(let i=0;i<n.length;i++){const s=n[i];s.fontFactor=0,s.offsetX=e.offsetX+e.cumulativeWidth,s.cumulativeWidth=0}}function h8(n,e){if(e)for(let i=0;i<n.length;i++){const s=n[i];s.fontFactor=0,s.offsetX=e.offsetX,s.cumulativeWidth=0}}function d8(n,e,i,s){if(s=s||0,!n[e])return s;const r=n[e];return r.lineBreak?s+r.xadvance:d8(n,e+1,i,s+r.xadvance+r.xoffset+r.kerning+i.LETTERSPACING)}function JSe(n,e,i,s){return!n||!n.char||e+i<s.INNER_WIDTH?!1:s.BREAKON.indexOf(n.char)>-1}class u8 extends H6{constructor(){super(),this._input="inherit",this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e),e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0}}class p8 extends ns{constructor(){super("fontSize","inherit",!0),this._allowsInherit=!1}computeOutputValue(e){this._value=this._inheritedInput,e._font._fontVariant&&(e._bounds._needsProcess=!0,e._layouter._needsProcess=!0)}process(e){if(!e._font._fontVariant||!e._font._fontVariant.isReady)return;const i=this._value/e._font._fontVariant.typographic.size,s=e._inlines._value;for(let r=0;r<s.length;r++){const o=s[r];o.resetOffsets(),o.fontSize=this._value,o.fontFactor=i}}get value(){return this._value}}class m8 extends Q6{constructor(){super("segments",1,!1),this._notInheritedValue=void 0}update(e,i){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(e)),e._layouter._needsUpdate=!0}set value(e){this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class qSe extends m8{constructor(){super(),this._value="inherit"}}class $Se extends UE{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e),e._parent._value._layouter._needsProcess=!1}process(e){if(this._value!=="none"){const i=e._whiteSpace._whiteSpacedContent,s=e._inlines._value;for(let r=1;r<s.length;r++){const o=i[r-1]+i[r];s[r].kerning=e._font._fontVariant.getKerningAmount(o)}}}}class g8 extends dn{constructor(){super("children",null,!1),this._uis=[]}update(e,i){}process(e){}_compute(e){}dispose(){}}function e_e(n,e=!1){const i=n[0].index!==null,s=new Set(Object.keys(n[0].attributes)),r=new Set(Object.keys(n[0].morphAttributes)),o={},a={},l=n[0].morphTargetsRelative,c=new st.BufferGeometry;let h=0;for(let d=0;d<n.length;++d){const u=n[d];let p=0;if(i!==(u.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const g in u.attributes){if(!s.has(g))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+'. All geometries must have compatible attributes; make sure "'+g+'" attribute exists among all geometries, or in none of them.'),null;o[g]===void 0&&(o[g]=[]),o[g].push(u.attributes[g]),p++}if(p!==s.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". Make sure all geometries have the same number of attributes."),null;if(l!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const g in u.morphAttributes){if(!r.has(g))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+".  .morphAttributes must be consistent throughout all geometries."),null;a[g]===void 0&&(a[g]=[]),a[g].push(u.morphAttributes[g])}if(e){let g;if(i)g=u.index.count;else if(u.attributes.position!==void 0)g=u.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". The geometry must have either an index or a position attribute"),null;c.addGroup(h,g,d),h+=g}}if(i){let d=0;const u=[];for(let p=0;p<n.length;++p){const g=n[p].index;for(let f=0;f<g.count;++f)u.push(g.getX(f)+d);d+=n[p].attributes.position.count}c.setIndex(u)}for(const d in o){const u=f8(o[d]);if(!u)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+d+" attribute."),null;c.setAttribute(d,u)}for(const d in a){const u=a[d][0].length;if(u===0)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[d]=[];for(let p=0;p<u;++p){const g=[];for(let A=0;A<a[d].length;++A)g.push(a[d][A][p]);const f=f8(g);if(!f)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+d+" morphAttribute."),null;c.morphAttributes[d].push(f)}}return c}function f8(n){let e,i,s,r=-1,o=0;for(let h=0;h<n.length;++h){const d=n[h];if(e===void 0&&(e=d.array.constructor),e!==d.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=d.itemSize),i!==d.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(s===void 0&&(s=d.normalized),s!==d.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(r===-1&&(r=d.gpuType),r!==d.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;o+=d.count*i}const a=new e(o),l=new st.BufferAttribute(a,i,s);let c=0;for(let h=0;h<n.length;++h){const d=n[h];if(d.isInterleavedBufferAttribute){const u=c/i;for(let p=0,g=d.count;p<g;p++)for(let f=0;f<i;f++){const A=d.getComponent(p,f);l.setComponent(p+u,f,A)}}else a.set(d.array,c);c+=d.count*i}return r!==void 0&&(l.gpuType=r),l}class t_e extends dn{constructor(){super("renderer")}render(e){if(!e._inlines._value||!e._inlines._value.length)return;const i=e._inlines._value.map(r=>e._font._fontVariant.getGeometricGlyph(r,e).translate(r.offsetX,r.offsetY,0)),s=e_e(i);e.setFontMesh(new st.Mesh(s,e.fontMaterial)),e._fontMesh.renderOrder=1/0}}class i_e extends RX{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!1}computeOutputValue(e){this._value=this._inheritedInput,e._layouter._needsProcess=!0}}class _x extends vw{constructor(e={}){const i={};_x.definePropertiesValues(i,e),super(i,e),m(this,"_rebuildParentUI",()=>{super._rebuildParentUI(),this._layouter._needsUpdate=!0}),_x.init(this)}add(e){const i=[];for(let s=0;s<arguments.length;s++){const r=arguments[s];!r.isUI||r.isInline?(i.push(r),r.position.z=.005):console.warn("Block element can only contain Box elements.",r)}return super.add(...i)}set textContent(e){this._textContent.value=e}get textContent(){return this._textContent._value}set invertAlpha(e){this._invertAlpha.value=e}get invertAlpha(){return this._invertAlpha._value}static definePropertiesValues(e,i){e.children||(e.children=g8),e.textContent||(e.textContent=VSe),e.glyphs||(e.glyphs=DSe),e.inlines||(e.inlines=XSe),e.layouter||(e.layouter=n8),e.renderer||(e.renderer=t_e),e.fontFamily||(e.fontFamily=o8),e.fontWeight||(e.fontWeight=r8),e.fontStyle||(e.fontStyle=s8),e.fontSize||(e.fontSize=p8),e.color||(e.color=zSe),e.backgroundColor||(e.backgroundColor=FSe),e.lineBreak||(e.lineBreak=i8),e.letterSpacing||(e.letterSpacing=u8),e.whiteSpace||(e.whiteSpace=jX),e.segments||(e.segments=qSe),e.textAlign||(e.textAlign=i_e),e.fontKerning||(e.fontKerning=$Se)}static init(e){Object.defineProperties(e,{isInline:{configurable:!1,enumerable:!0,value:!0}})}}class n_e extends V6{constructor(){super("textContent",null,!1),this._needsUpdate=!1}set value(e){this._value!==e&&(this._value=e,this._needsUpdate=!0)}update(e,i){this._needsUpdate=!1;for(let s=e.children.length-1;s>=0;s--){const r=e.children[s];r.isUI&&(e.remove(r),r.clear())}e._children._uis=[],this._value&&e.add(new _x({name:"anonymousInline",textContent:this._value}))}}class s_e extends Array{constructor(...e){super(...e),this.width=0,this.height=0}}class r_e extends dn{constructor(){super("layouter",null,!1),this._value=null}update(e,i){}process(e){let i=e._width._value;e._width._auto?i=1/0:i=e._bounds._innerWidth;const s=e._lineHeight._value,r=new s_e(new t8);let o=0;e._children._inlines.forEach(u=>{if(!u._inlines.value)return;this._resetInlines(u);const p=u._fontSize._value,g=u._letterSpacing._value*p,f=u._whiteSpace._value,A=u._lineBreak._value,y={WHITESPACE:f,LETTERSPACING:g,BREAKON:A,INNER_WIDTH:i},b=u._whiteSpace._inlineWrapper;o+=u._margin._value.w+u._padding._value.w,u._inlines.value.forEach((v,x,w)=>{const C=r[r.length-1];if(b(w,x,o,y)){if(r.push(new t8(v)),v.offsetX=v.xoffset,v.width===0){o=0;return}v.cumulativeWidth=v.xadvance+g,o=v.cumulativeWidth;return}r[r.length-1].push(v),v.offsetX=o+v.xoffset+v.kerning,v.cumulativeWidth=v.xadvance+v.kerning+g,o+=v.cumulativeWidth,C.length-1===1&&C[C.length-2].width===0&&(v.offsetX-=v.xoffset,o-=v.xoffset)}),o+=u._margin._value.y+u._padding._value.y});const a=e._whiteSpace._inlineCollapser;let l=0,c=0,h=0;r.forEach((u,p)=>{const g=a(u);let f=0,A=0;if(u.forEach(y=>{f=Math.max(f,y.lineHeight),A=Math.max(A,y.lineBase),y.offsetX-=g}),u.lineHeight=f,u.lineBase=A,p===0?h=-(f*s-f)*.5:h-=r[p-1].lineHeight*s,u.y=h,u.x=0,u.forEach(y=>{y.offsetY=h-y.anchor,y.lineHeight<u.lineHeight&&(y.offsetY-=u.lineBase-y.lineBase)}),c+=u.lineHeight*s,u.width=0,u[0]){const y=u[u.length-1];u.width=y.offsetX+y.cumulativeWidth+y.paddingRight+y.marginRight+u[0].offsetX,l=Math.max(l,u.width)}}),r.height=c,r.width=l,this._value=r,i===1/0&&e._bounds.setChildrenWidth(e,r.width),e._height._auto&&e._bounds.setChildrenHeight(e,r.height);const d=e._parent._value;d&&(d._autoSize._needsProcess=!0,d._flexDirection._needsProcess=!0),e._inlineJustificator._needsProcess=!0,e._textAlign._needsProcess=!0,e._overflow._needsUpdate=!0}_resetInlines(e){e._fontSize.process(e)}}class o_e extends RX{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(e){this._value=this._inheritedInput,this._needsProcess=!0}process(e){a_e(e),e._renderer._needsRender=!0}}function a_e(n){const e=n._layouter._value,i=n._textAlign._value,s=n._bounds._innerWidth;for(let r=0;r<e.length;r++){const o=e[r],a=l_e(n,o,r===e.length-1),l=n._padding._value,c=n._borderWidth._value,h=(-l.w+l.y)/2+(-c.w+c.y)/2;o.x+=a;for(let d=0;d<o.length;d++)o[d].offsetX+=a-h}if(i.indexOf("justify")===0)for(let r=0;r<e.length;r++){const o=e[r];if(i.indexOf("-")!==-1&&r===e.length-1)return;const a=s-o.width;if(a<=0)return;let l=0;for(let u=1;u<o.length-1;u++)l+=o[u].char===" "?1:0;const c=a/l;let h=1;i==="justify-right"&&(o.reverse(),h=-1);let d=0;for(let u=1;u<=o.length-1;u++){const p=o[u];p.offsetX+=d*h,d+=p.char===" "?c:0}i==="justify-right"&&o.reverse()}}function l_e(n,e,i){switch(n._textAlign._value){case"justify-left":case"justify":case"left":return-n._bounds._innerWidth/2;case"justify-right":case"right":return-e.width+n._bounds._innerWidth/2;case"center":return-e.width/2;case"justify-center":return i?-e.width/2:-n._bounds._innerWidth/2;default:console.warn(`textAlign: '${n._textAlign._value}' is not valid`)}}class c_e extends LX{constructor(){super(),this._value=this._input="column",this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(e){this._value=this._inheritedInput}}class h_e extends Z6{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class d_e extends UE{constructor(){super(),this._value=this._input=this.getDefaultValue(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e)}}class u_e extends J6{constructor(){super(),this._innerWidth=1/0,this._innerHeight=0}}class p_e extends dn{constructor(){super("children",null,!1),m(this,"_sortOrder",(e,i)=>e._order._value<i._order._value?-1:e._order._value>i._order._value?1:this._uis.indexOf(e)<this._uis.indexOf(i)?-1:1),this._uis=[],this._inlines=[],this._boxes=[]}update(e,i){this._compute(e),this._needsProcess=!0}process(e){this._compute(e),e._overflow._needsRender=!0}_compute(e){this._uis=e.children.filter(i=>i.visible&&i.isUI),this._inlines=this._uis.filter(i=>i.isInline).sort(this._sortOrder)}dispose(){this._inlines=null}}class m_e extends dn{constructor(){super("autosize")}process(e){if(e._layouter._value&&e._layouter._value.length){const i=e._layouter._value,s=e._padding._value,r=e._borderWidth._value;e._width._auto&&e._bounds.setOffsetWidth(e,i.width+s.w+s.y+r.w+r.y),e._height._auto&&e._bounds.setOffsetHeight(e,i.height+s.x+s.z+r.x+r.z)}}}class g_e extends e8{constructor(){super("renderer"),this._needsUpdate=!1}render(e){super.render(e);for(const i of e._children._inlines)i._renderer.render(i);e.performAfterUpdate()}}class rM extends nM{constructor(e={},i={}){rM.definePropertiesValues(i,e),super(i,e),rM.init(this)}add(e){const i=[];let s=!1;for(let r=0;r<arguments.length;r++){const o=arguments[r];!o.isUI||o.isInline?(o.isInline&&(s=!0),i.push(o)):console.warn("Block element can only contain Box elements.",o)}return i.length>0&&super.add(...i),s&&(this._children._needsUpdate=!0,this._layouter._needsProcess=!0),this}set textContent(e){this._textContent.value=e}get textContent(){return super.textContent}set invertAlpha(e){this._invertAlpha.value=e}get invertAlpha(){return this._invertAlpha._value}get lines(){return this._layouter._value}static definePropertiesValues(e,i){e.flexDirection=c_e,e.justifyContent=BX,e.alignItems=EX,e.bounds=u_e,e.autoSize=m_e,e.renderer=g_e,e.children||(e.children=p_e),e.textContent||(e.textContent=n_e),e.layouter||(e.layouter=r_e),e.lineHeight||(e.lineHeight=h_e),e.textAlign||(e.textAlign=o_e),e.whiteSpace||(e.whiteSpace=jX),e.fontKerning||(e.fontKerning=d_e),e.segments||(e.segments=m8),i.width||(i.width="100%"),i.fontSide||(i.fontSide=0)}static init(e){Object.defineProperties(e,{isText:{configurable:!1,enumerable:!0,value:!0}})}}class f_e extends dn{constructor(){super("inlines",null,!1),this._value=[]}process(e){this._value[0].paddingLeft=e._padding._value.w,this._value[0].marginLeft=e._margin._value.w;const i=this._value.length-1;this._value[i].paddingRight=e._padding._value.y,this._value[i].marginRight=e._margin._value.y}}class A_e extends dn{constructor(){super("renderer")}render(e){e._backgroundMesh||e.setBackgroundMesh(new $6(e)),e._backgroundMesh.position.x=e._inlines._value[0].offsetX+e._inlines._value[0].width/2,e._backgroundMesh.position.y=e._inlines._value[0].offsetY+e._inlines._value[0].lineBase/2,e._bounds.render(e)}}class y_e extends dn{constructor(){super("bounds",null,!1),this._size=new st.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0}update(e,i){this.output(i),this._needsProcess=!0}process(e){this._offsetWidth=this._innerWidth=e._inlines._value[0].width,this._offsetHeight=this._innerHeight=e._inlines._value[0].height,this._needsRender=!0,e._borderWidth._needsRender=!0,e._borderRadius._needsRender=!0}render(e){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight}output(e){e.size=this._size}}class oM extends vw{constructor(e={}){const i={};oM.definePropertiesValues(i,e),super(i,e),oM.init(this)}clear(){for(const e of this._inlines._value)e.clear();return super.clear()}bindBackgroundMeshProperties(){this._backgroundMesh.raycast=()=>{},this._bounds._size=this._backgroundMesh.scale,this._bounds._needsUpdate=!0}unbindBackgroundMeshProperties(){this._bounds._size=new st.Vector3(1,1,1),this._bounds._needsUpdate=!0}add(e){const i=[];for(let s=0;s<arguments.length;s++){const r=arguments[s];r.isUI?console.warn("ThreeMeshUI::InlineBlockElement cannot contains UI Elements.",r):(i.push(r),r.position.z=.005)}return super.add(...i)}static definePropertiesValues(e,i){e.children||(e.children=g8),e.bounds||(e.bounds=y_e),e.inlines||(e.inlines=f_e),e.layouter||(e.layouter=n8),e.renderer||(e.renderer=A_e),e.fontFamily||(e.fontFamily=o8),e.fontWeight||(e.fontWeight=r8),e.fontStyle||(e.fontStyle=s8),e.fontSize||(e.fontSize=p8),e.backgroundColor||(e.backgroundColor=G6),e.lineBreak||(e.lineBreak=i8),e.letterSpacing||(e.letterSpacing=u8),e.whiteSpace||(e.whiteSpace=jX),e.fontKerning||(e.fontKerning=UE),i.backgroundSize||(i.backgroundSize="cover"),i.width||(i.width="100%"),i.height||(i.height="100%"),i.boxSizing||(i.boxSizing="border-box")}static init(e){Object.defineProperties(e,{isInline:{configurable:!1,enumerable:!0,value:!0},isInlineBlock:{configurable:!1,enumerable:!0,value:!0}}),e._inlines._value=[new b_e(e)],e.backgroundMaterial=new j6,e._renderer.render(e)}}class b_e extends E6{constructor(e){super(),this._uiElement=e}get xadvance(){const e=this._uiElement._padding._value,i=this._uiElement._width;return i._relative?i._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.w+e.y+i.value}get width(){const e=this._uiElement._width;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get height(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get anchor(){return this.height}get lineHeight(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get lineBase(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}clear(){this._uiElement=null}}class A8{constructor(e){this._subject=e}attach(){console.error(`Behavior::attach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}act(){throw new Error(`Behavior::act() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}detach(){console.error(`Behavior::detach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}clear(){}}const y8=()=>ZE.update(),b8={BaseProperty:dn,Block:sM,Text:rM,Inline:_x,InlineBlock:oM,MeshUIBaseElement:vw,FontLibrary:r0,update:y8,MSDFFontMaterialUtils:nh,ShaderChunkUI:Y6,Behavior:A8,FontVariant:yw};typeof global<"u"&&(global.ThreeMeshUI=b8);const v_e=b8;var x_e=or.ti,v8=or.nS,JX=or.eB,w_e=or.Yp,qX=or.VB,C_e=or.BC,S_e=or.zN,HE=or.cV,__e=or.hW,M_e=or.k2,I_e=or.K6,T_e=or.M7,E_e=or.ls,R_e=or.Hi,$X=or.EY,L_e=or.MR,B_e=or.zf,Bn=or.Ay,x8=or.yo;const w8=Object.freeze(Object.defineProperty({__proto__:null,BaseProperty:x_e,Behavior:v8,Block:JX,DefaultValues:w_e,FontLibrary:qX,FontVariant:C_e,InheritableProperty:S_e,Inline:HE,InlineBlock:__e,InlineGlyph:M_e,MSDFFontMaterialUtils:I_e,MaterialTransformers:T_e,MeshUIBaseElement:E_e,ShaderChunkUI:R_e,Text:$X,TypographicFont:L_e,TypographicGlyph:B_e,default:Bn,update:x8},Symbol.toStringTag,{value:"Module"}));class k_e{constructor(){m(this,"Rad2Deg",180/Math.PI),m(this,"Deg2Rad",Math.PI/180),m(this,"Epsilon",1e-5)}random(e,i){return Array.isArray(e)?e.length<=0?null:e[Math.floor(Math.random()*e.length)]:e!==void 0&&i!==void 0?Math.random()*(i-e)+e:Math.random()}randomVector3(e,i=0,s=1){e.x=this.random(i,s),e.y=this.random(i,s),e.z=this.random(i,s)}clamp(e,i,s){return e<i?i:e>s?s:e}clamp01(e){return this.clamp(e,0,1)}lerp(e,i,s){return s=s<0?0:s,s=s>1?1:s,e+(i-e)*s}inverseLerp(e,i,s){return(s-e)/(i-e)}remap(e,i,s,r,o){return r+(o-r)*(e-i)/(s-i)}moveTowards(e,i,s){return e+=s,(s<0&&e<i||s>0&&e>i)&&(e=i),e}toDegrees(e){return e*180/Math.PI}toRadians(e){return e*Math.PI/180}tan(e){return Math.tan(e)}gammaToLinear(e){return Math.pow(e,2.2)}linearToGamma(e){return Math.pow(e,1/2.2)}approximately(e,i,s=Number.EPSILON){for(const r of G_e){const o=e[r],a=i[r];if(o===void 0||a===void 0)break;if(Math.abs(o-a)>s)return!1}return!0}easeInOutCubic(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}}const G_e=["x","y","z","w"],lt=new k_e;class C8{constructor(e){m(this,"y"),m(this,"s"),m(this,"alpha",0),this.setAlpha(e),this.y=null,this.s=null}setAlpha(e){if(e<=0||e>1)throw new Error;this.alpha=e}filter(e,i){i&&this.setAlpha(i);let s;return this.y?s=this.alpha*e+(1-this.alpha)*this.s:s=e,this.y=e,this.s=s,s}lastValue(){return this.y}reset(e){this.y=e,this.s=e}}class QE{constructor(e,i=1,s=0,r=1){if(m(this,"freq"),m(this,"minCutOff"),m(this,"beta"),m(this,"dCutOff"),m(this,"x"),m(this,"dx"),m(this,"lasttime"),e<=0||i<=0||r<=0)throw new Error;this.freq=e,this.minCutOff=i,this.beta=s,this.dCutOff=r,this.x=new C8(this.alpha(this.minCutOff)),this.dx=new C8(this.alpha(this.dCutOff)),this.lasttime=null}alpha(e){const i=1/this.freq;return 1/(1+1/(2*Math.PI*e)/i)}filter(e,i=null){this.lasttime&&i&&(this.freq=1/(i-this.lasttime)),this.lasttime=i;const s=this.x.lastValue(),r=s?(e-s)*this.freq:0,o=this.dx.filter(r,this.alpha(this.dCutOff)),a=this.minCutOff+this.beta*Math.abs(o);return this.x.filter(e,this.alpha(a))}reset(e){e!=null&&this.x.reset(e),this.x.alpha=this.alpha(this.minCutOff),this.dx.alpha=this.alpha(this.dCutOff),this.lasttime=null}}class eD{constructor(e,i=1,s=0,r=1){m(this,"x"),m(this,"y"),m(this,"z"),this.x=new QE(e,i,s,r),this.y=new QE(e,i,s,r),this.z=new QE(e,i,s,r)}filter(e,i,s=null){i.x=this.x.filter(e.x,s),i.y=this.y.filter(e.y,s),i.z=this.z.filter(e.z,s)}reset(e){this.x.reset(e?.x),this.y.reset(e?.y),this.z.reset(e?.z)}}class tb extends pe{constructor(e,i,s,r=128){if(i<=0||s<=0||r<=0)throw new Error("GroundedSkybox height, radius, and resolution must be positive.");const o=new eh(s,2*r,r);o.scale(1,1,-1);const a=o.getAttribute("position"),l=new E;for(let c=0;c<a.count;++c)if(l.fromBufferAttribute(a,c),l.y<0){const h=-i*3/2,d=l.y<h?-i/l.y:1-l.y*l.y/(3*h*h);l.multiplyScalar(d),l.toArray(a.array,3*c)}a.needsUpdate=!0,super(o,new ai({map:e,depthWrite:!1}))}}const KE="needle:cameraController";function S8(n){return n[KE]}function tD(n,e,i){i?n[KE]=e:n[KE]===e&&(n[KE]=null)}const iD="needle:autofit";function _8(n){return n[iD]===void 0?!0:n[iD]!==!1}function nD(n,e){n[iD]=e}function P_e(n,e,i){const s=n.length(),r=e.length(),o=lt.lerp(s,r,i);return n.lerp(e,i).normalize().multiplyScalar(o)}const sD=new Fe,M8=new Fe().setFromAxisAngle(new E(0,1,0),Math.PI);function N_e(n,e){n.lookAt(e),n.quaternion.multiply(M8)}function xw(n,e,i=!0,s=!1){if(n===e)return;sD.copy(n.quaternion);const r=ri(e),o=ri(n);if(s){if(Ic(n,fn(e)),i){const a=o.y,l=o.sub(lD(n));l.y=a,n.lookAt(l),n.quaternion.multiply(M8)}Number.isNaN(n.quaternion.x)&&n.quaternion.copy(sD);return}i&&(r.y=o.y),n.lookAt(r),Number.isNaN(n.quaternion.x)&&n.quaternion.copy(sD)}const V_e=new El(()=>new E,100);function Lt(n,e,i){const s=V_e.get();return s.set(0,0,0),n instanceof E?s.copy(n):Array.isArray(n)?s.set(n[0],n[1],n[2]):n instanceof DOMPointReadOnly?s.set(n.x,n.y,n.z):typeof n=="number"?(s.x=n,s.y=e!==void 0?e:s.x,s.z=i!==void 0?i:s.x):typeof n=="object"&&(s.x=n.x,s.y=n.y,s.z=n.z),s}const X_e=new El(()=>new fe,30);function I8(n){const e=X_e.get();return n?e.copy(n):e.set(0,0,0),e}const D_e=new El(()=>new Fe,100);function bh(n){const e=D_e.get();return e.identity(),n instanceof Fe?e.copy(n):n instanceof DOMPointReadOnly&&e.set(n.x,n.y,n.z,n.w),e}const rD=new El(()=>new E,100),T8=Symbol("lastMatrixWorldUpdateKey");function ri(n,e=null,i=!0){const s=e??rD.get();return n?n.parent?(i&&n.updateWorldMatrix(!0,!1),n.matrixWorldNeedsUpdate&&n[T8]!==Date.now()&&(n[T8]=Date.now(),n.updateMatrixWorld()),s.setFromMatrixPosition(n.matrixWorld),s):s.copy(n.position):s.set(0,0,0)}function Cr(n,e){if(!n)return n;const i=rD.get();return e!==i&&i.copy(e),(n?.parent??n).worldToLocal(i),n.position.set(i.x,i.y,i.z),n}function o0(n,e,i,s){const r=rD.get();return r.set(e,i,s),Cr(n,r),n}const YE=new El(()=>new Fe,100),a0=new Fe,oD=new Fe;function fn(n,e=null){if(!n)return YE.get().identity();const i=e??YE.get();return n.parent?(n.getWorldQuaternion(i),i):i.copy(n.quaternion)}function Ic(n,e){if(!n)return;e!==a0&&a0.copy(e);const i=a0,s=n?.parent;s?.getWorldQuaternion(oD),oD.invert();const r=oD.multiply(i);n.quaternion.set(r.x,r.y,r.z,r.w)}function aD(n,e,i,s,r){a0.set(e,i,s,r),Ic(n,a0)}const z_e=new El(()=>new E,100),F_e=new E;function Dn(n,e=null){return e||(e=z_e.get()),n?n.parent?(n.getWorldScale(e),e):e.copy(n.scale):e.set(0,0,0)}function ib(n,e){if(!n)return;if(!n.parent){n.scale.copy(e);return}const i=F_e;n.parent.getWorldScale(i),n.scale.copy(e),n.scale.divide(i)}const U_e=new E,E8=new Fe;function O_e(n){return fn(n,E8),U_e.set(0,0,1).applyQuaternion(E8)}const Z_e=new El(()=>new E,100),R8=new Fe;function lD(n,e){return e||(e=Z_e.get().set(0,0,1)),fn(n,R8),e.applyQuaternion(R8)}const L8=new Oi,B8=new Oi,W_e=new E;function cD(n){const e=YE.get();return n.getWorldQuaternion(e),B8.setFromQuaternion(e),B8}function hD(n,e){const i=YE.get();Ic(n,i.setFromEuler(e))}function ww(n){const e=cD(n),i=W_e;return i.set(e.x,e.y,e.z),i.x=lt.toDegrees(i.x),i.y=lt.toDegrees(i.y),i.z=lt.toDegrees(i.z),i}function dD(n,e){Cw(n,e.x,e.y,e.z,!0)}function Cw(n,e,i,s,r=!0){r&&(e=lt.toRadians(e),i=lt.toRadians(i),s=lt.toRadians(s)),L8.set(e,i,s),a0.setFromEuler(L8),Ic(n,a0)}function jE(n,e=!0){n&&(e?function i(s){console.groupCollapsed((s.name?s.name:"(no name : "+s.type+")")+" %o",s),s.children.forEach(i),console.groupEnd()}(n):n.traverse(function(i){for(var s="|___",r=i;r.parent!==null;)s="	"+s,r=r.parent;console.log(s+i.name+" <"+i.type+">")}))}function H_e(n){let e=n?.name||"";if(!n)return e;let i=n.parent;for(;i;)e=i.name+"/"+e,i=i.parent;return e}function k8(n){if(n){const e=n;return e.blendMode!==void 0&&e.clampWhenFinished!==void 0&&e.enabled!==void 0&&e.fadeIn!==void 0&&e.getClip!==void 0}return!1}class Tc{static createBlitMaterial(e){return new jt({uniforms:{map:new Te(null)},vertexShader:this.vertex,fragmentShader:e})}static copyTexture(e,i){const s=i??this.blipMaterial;s.uniforms.map.value=e,s.needsUpdate=!0,s.uniformsNeedUpdate=!0,this.blipMaterial||(this.blipMaterial=new jt({uniforms:{map:new Te(null)},vertexShader:this.vertex,fragmentShader:this.fragment}));const r=s.vertexShader;s.vertexShader=this.vertex,this.mesh||(this.mesh=new pe(this.planeGeometry,this.blipMaterial));const o=this.mesh;o.material=s,o.frustumCulled=!1,this.scene.children.length=0,this.scene.add(o),this.renderer||(this.renderer=new om({antialias:!1})),this.renderer.setSize(e.image.width,e.image.height),this.renderer.clear(),this.renderer.render(this.scene,this.perspectiveCam);const a=new di(this.renderer.domElement);return a.name="Copy",a.needsUpdate=!0,s.vertexShader=r,a}static textureToCanvas(e,i){if(!e)return null;(i===!0||e.isCompressedTexture===!0)&&(e=G8(e));const s=e.image;if(K_e(s)){const r=document.createElement("canvas");r.width=s.width,r.height=s.height;const o=r.getContext("2d");return o?(o.drawImage(s,0,0,s.width,s.height,0,0,r.width,r.height),r):(console.error("Failed getting canvas 2d context"),null)}return null}}m(Tc,"planeGeometry",new Xs(2,2,1,1)),m(Tc,"renderer"),m(Tc,"perspectiveCam",new Ot),m(Tc,"scene",new ir),m(Tc,"vertex",`
    varying vec2 vUv;
    void main(){
        vUv = uv;
        gl_Position = vec4(position.xy * 1.0,0.,.999999);
    }`),m(Tc,"fragment",`
    uniform sampler2D map; 
    varying vec2 vUv;
    void main(){ 
        vec2 uv = vUv;
        uv.y = 1.0 - uv.y;
        gl_FragColor = texture2D( map, uv);
        // gl_FragColor = vec4(uv.xy, 0, 1);
    }`),m(Tc,"blipMaterial"),m(Tc,"mesh");function G8(n){return Tc.copyTexture(n)}function Q_e(n,e=!1){return Tc.textureToCanvas(n,e)}function K_e(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&n instanceof ImageBitmap}function Y_e(n){const e=n.type;return e==="Mesh"||e==="SkinnedMesh"}function uD(n,e){e?n["needle:rendercustomshadow"]=!0:n["needle:rendercustomshadow"]=!1}function P8(n){return!!(n&&(n["needle:rendercustomshadow"]===!0||n["needle:rendercustomshadow"]==null))}function Ll(n,e=void 0,i=void 0,s=void 0){const r=s||new gi;r.makeEmpty();const o=[];function a(c){let h=!0;if(c.visible&&_8(c)!==!1&&!(c.type==="TransformControlsGizmo"||c.type==="TransformControlsPlane")){if(c instanceof tN&&(h=!1),c instanceof ST&&(h=!1),c instanceof tb&&(h=!1),c.isGizmo===!0&&(h=!1),c.material instanceof v1&&(h=!1),Y_e(c)||(h=!1),i&&c.layers.test(i)===!1&&(h=!1),h&&(e&&Array.isArray(e)&&e!=null&&e.includes(c)||typeof e=="function"&&e(c)===!0))return;if(c.isUI!==!0){if(h){const d=c.children;c.children=o;const u=c.position,p=c.scale;if(Number.isNaN(u.x)||Number.isNaN(u.y)||Number.isNaN(u.z)){console.warn(`Object "${c.name}" has NaN values in position or scale.... will ignore it`,u,p);return}r.expandByObject(c,!0),c.children=d}for(const d of c.children)a(d)}}}let l=!1;for(const c of n)c&&(l=!0,c.updateMatrixWorld(),a(c));return l||console.warn("No objects to fit camera to..."),r}function N8(n,e,i){const s=Ll([n],i?.ignore),r=new E;s.getSize(r);const o=new E;s.getCenter(o);const a=new E;e.getSize(a);const l=new E;e.getCenter(l);const c=new E;c.set(a.x/r.x,a.y/r.y,a.z/r.z);const h=Math.min(c.x,c.y,c.z),d=i?.scale!==!1;if(d&&ib(n,Dn(n).multiplyScalar(h)),i?.position!==!1){const u=new E;s.getCenter(u),u.y=s.min.y;const p=new E;e.getCenter(p),p.y=e.min.y;const g=p.clone().sub(u);d&&g.multiplyScalar(h),Cr(n,ri(n).add(g))}return{boundsBefore:s,scale:c}}function V8(n,e){const i=Ll([n]),s=new E;i.getCenter(s),s.y=i.min.y;const r=e.clone().sub(s),o=ri(n);return Cr(n,o.add(r)),{offset:r,bounds:i}}function pD(n,e,i,s){if(Array.isArray(e)){let a=!0;for(let l=0;l<e.length;l++)pD(n,e[l],l,e)||(a=!1);return a}if(e.type==="MeshStandardMaterial")return!1;if(e["material:fbx"]!=null)return!0;const r=new Us;r["material:fbx"]=e;const o=e;return o&&(o.map?r.color.set(1,1,1):r.color.copyLinearToSRGB(o.color),r.emissive.copyLinearToSRGB(o.emissive),r.emissiveIntensity=o.emissiveIntensity,r.opacity=o.opacity,r.displacementScale=o.displacementScale,r.transparent=o.transparent,r.bumpMap=o.bumpMap,r.aoMap=o.aoMap,r.map=o.map,r.displacementMap=o.displacementMap,r.emissiveMap=o.emissiveMap,r.normalMap=o.normalMap,r.envMap=o.envMap,r.alphaMap=o.alphaMap,r.metalness=o.reflectivity,o.shininess&&(r.roughness=1-Math.sqrt(o.shininess)/10),r.needsUpdate=!0),i===void 0?n.material=r:s[i]=r,!0}let JE=!1;J1e((...n)=>{var e;Je()&&(e=ji.Current)!=null&&e.isInXR&&(l0(!0),X8("error",...n))});function l0(n){if(n){if(JE)return;JE=!0,J_e()}else{if(!JE)return;JE=!1,q_e()}}const Sw={log:void 0,warn:void 0,error:void 0};class j_e{constructor(){m(this,"familyName","needle-xr"),m(this,"root",null),m(this,"context",null),m(this,"defaultFontSize",.06),m(this,"targetObject",new Ae),m(this,"userForwardViewPoint",new E),m(this,"oneEuroFilter",new eD(90,.8)),m(this,"_lastElementRemoveTime",0),m(this,"onBeforeRender",()=>{var e,i;const s=(e=this.context)==null?void 0:e.mainCamera;if(this.context&&s instanceof Ot){const r=this.getRoot();Number.isNaN(r.position.x)&&r.position.set(0,0,0),Number.isNaN(r.quaternion.x)&&r.quaternion.set(0,0,0,1),this.context.scene.add(this.targetObject);const o=((i=this.context.xr)==null?void 0:i.rigScale)??1,a=3.5*o,l=s.worldForward;l.y=0,l.normalize().multiplyScalar(a),this.userForwardViewPoint.copy(s.worldPosition).sub(l),this.targetObject.position.distanceTo(this.userForwardViewPoint)>2*o&&(this.targetObject.position.copy(this.userForwardViewPoint),xw(this.targetObject,s,!0,!0),this.targetObject.rotateY(Math.PI)),this.oneEuroFilter.filter(this.targetObject.position,r.position,this.context.time.time);const c=this.context.time.deltaTime;if(r.quaternion.slerp(this.targetObject.quaternion,c*5),r.scale.setScalar(o),this.targetObject.removeFromParent(),this.context.scene.add(r),this.context.time.time-this._lastElementRemoveTime>.1){this._lastElementRemoveTime=this.context.time.time;const h=Date.now();for(let d=0;d<this._activeTexts.length;d++){const u=this._activeTexts[d];if(u instanceof Bn.Text&&h-u._activatedTime>2e4){u.removeFromParent(),this._textBuffer.push(u),this._activeTexts.splice(d,1);break}}}}}),m(this,"textOptions",{fontSize:this.defaultFontSize,fontFamily:this.familyName,padding:.03,margin:.005,color:0,backgroundColor:16777215,backgroundOpacity:.4,borderRadius:.03,offset:.025}),m(this,"_textBuffer",[]),m(this,"_activeTexts",[]),this.ensureFont()}onEnable(){this.context=ji.Current||ji.All[0],this.context.pre_render_callbacks.push(this.onBeforeRender)}onDisable(){var e,i,s;(i=this.context)==null||i.pre_render_callbacks.splice((e=this.context)==null?void 0:e.pre_render_callbacks.indexOf(this.onBeforeRender),1),(s=this.root)==null||s.removeFromParent()}addLog(e,i){const s=this.getRoot(),r=this.getText();let o=16777215,a=0;switch(e){case"log":o=16777215,a=0;break;case"warn":o=16772761,a=4465152;break;case"error":o=16755370,a=7798784;break}i.length>1e3&&(i=i.substring(0,1e3)+"...");const l=new Date().toISOString().split("T")[1].split(".")[0];r.textContent="["+l+"] "+i,r.visible=!0,r._activatedTime=Date.now(),s.add(r),this._activeTexts.push(r),this.context&&this.context.scene.add(s),r.set({backgroundColor:o,color:a}),Bn.update()}ensureFont(){let e=Bn.FontLibrary.getFontFamily(this.familyName);if(!e){e=Bn.FontLibrary.addFontFamily(this.familyName);const i=e.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");i?.addEventListener("ready",()=>{Bn.update()})}}getText(){const e=this.getRoot();if(this._textBuffer.length>0){const s=this._textBuffer.pop();return s.visible=!0,setTimeout(()=>this.disableDepthTestRecursive(s),100),s}if(e.children.length>20&&this._activeTexts.length>0)return this._activeTexts.shift();const i=new Bn.Text(this.textOptions);return setTimeout(()=>this.disableDepthTestRecursive(i),500),setTimeout(()=>this.disableDepthTestRecursive(i),1500),i}disableDepthTestRecursive(e,i=0){for(let r=0;r<e.children.length;r++){const o=e.children[r];o instanceof Ae&&this.disableDepthTestRecursive(o,i+1)}e.renderOrder=10*i,e.layers.set(2);const s=e.material;s&&(s.depthWrite=!1,s.depthTest=!1,s.transparent=!0),i===0&&Bn.update()}getRoot(){if(this.root)return this.root;const e=this.defaultFontSize,i={boxSizing:"border-box",fontFamily:this.familyName,width:"2.6",fontSize:e,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:0,whiteSpace:"pre-wrap",flexDirection:"column-reverse"};return this.root=new Bn.Block(i),this.root}}let vh=null;function J_e(){vh||(vh=new j_e),vh.onEnable();for(const n in Sw){Sw[n]=console[n];let e=!1;console[n]=function(){var i;if((i=Sw[n])==null||i.apply(console,arguments),!e)try{e=!0,X8(n,...arguments)}finally{e=!1}}}}function q_e(){vh?.onDisable();for(const n in Sw)console[n]=Sw[n]}const _w=new Map;function X8(n,...e){try{switch(_w.clear(),n){case"log":vh?.addLog("log",i());break;case"warn":vh?.addLog("warn",i());break;case"error":vh?.addLog("error",i());break}}catch(o){console.error("Error in spatial console",o)}finally{_w.clear()}function i(){let o="";for(let a=0;a<e.length;a++){const l=e[a];o+=s(l),a<e.length-1&&(o+=", ")}return o}function s(o,a=0){if(typeof o=="string")return'"'+o+'"';if(typeof o=="number"){if(o%1!==0){const l=o.toFixed(5),c=l.indexOf(".");let h=l.length-1;for(;h>c&&l[h]==="0";)h--;return l.substring(0,h+1)}return o.toString()}else if(Array.isArray(o)){let l="[";for(let c=0;c<o.length;c++){const h=o[c];l+=s(h,a+1),c<o.length-1&&(l+=", ")}return l+="]",l}else{if(o===null)return"null";if(o===void 0)return"undefined";if(typeof o=="function")return o.name+"()"}if(o instanceof Q)return`(${s(o.x)}, ${s(o.y)})`;if(o instanceof E)return`(${s(o.x)}, ${s(o.y)}, ${s(o.z)})`;if(o instanceof $e)return`(${s(o.x)}, ${s(o.y)}, ${s(o.z)}, ${s(o.w)})`;if(o instanceof Fe)return`(${s(o.x)}, ${s(o.y)}, ${s(o.z)}, ${s(o.w)})`;if(o instanceof ti||o instanceof di)return o.name;if(o instanceof oi)return`[${o.elements.join(", ")}]`;if(o instanceof de)return`[${o.elements.join(", ")}]`;if(o instanceof Qo)return o.mask.toString();if(typeof o=="object"){if(_w.has(o))return"*";let l=`{
`;l+=r(a);const c=Object.keys(o);let h="";for(let d=0;d<c.length;d++){const u=c[d],p=o[u];if(_w.has(p)){h+="";continue}_w.set(p,!0),h+=u+":"+s(p,a+1),d<c.length-1&&(h+=", "),h.length>=60&&(h+=`
`,h+=r(a),l+=h,h="")}return l+=h,l+=`
}`,l}return o}function r(o){let a="";for(let l=0;l<o;l++)a+=" ";return a}}const $_e=q("nodevlogs");function ss(n,e=Rl.Log){bd(e,n)}function An(n){ss(n,Rl.Warn)}function Mw(n){ss(n,Rl.Error)}let mD,gD;function Je(){if($_e)return!1;if(mD!==void 0)return mD;if(gD!==void 0)return gD;let n=Ma();return n||(n=window.location.hostname.endsWith(".local-credentialless.webcontainer.io")),gD=n,n}function eMe(n){mD=n}let tl,Ec=null,vd=null,Iw=!1,D8=null;const z8="terminal",Tw=q("console"),tMe=q("noerrors")||q("noconsole")||window.crossOriginIsolated;if(Tw&&AD(),!tMe&&(Tw||Ma())){if(Ma()&&!Tw){const e=new URL(window.location.href);e.searchParams.set("console","1"),console.log('\u{1F335} Tip: You can add the "?console" query parameter to the url to show the debug console (on mobile it will automatically open in the bottom right corner when your get errors during development. In VR a spatial console will appear.)',`
Open this page to get the console: `+e.toString())}const n=Ft.isMobileDevice()||Ft.isQuest()&&Je();if((n||Tw)&&(ewe(),U8(),Z8(!0),n)){const e=document.querySelector("needle-engine");e?.addEventListener("enter-ar",()=>{(Tw||tl||bX()>0)&&q("noerrors")}),e?.addEventListener("exit-ar",()=>{rMe()})}}const fD=Symbol("consoleParent");function AD(){if(tl){tl.showSwitch();return}Z8()}function F8(){tl&&(tl.hide(),tl.hideSwitch())}function U8(){D8||(D8=setInterval(iMe,500))}let O8=0;function iMe(){const n=bX(),e=n!==O8;O8=n,e&&nMe()}function nMe(){AD(),vd&&(vd.setAttribute("error","true"),vd.innerText="\u{1F92C}")}function sMe(){vd&&(vd.removeAttribute("error"),vd.innerText=z8)}function rMe(){Ec&&Ec[fD]&&Ec[fD].appendChild(Ec)}function Z8(n=!1){if(tl!==void 0||Iw)return;Iw=!0;const e=document.createElement("script");e.onload=()=>{if(!globalThis.VConsole){console.warn("\u{1F335} Debug console failed to load."),Iw=!1,tl=null;return}Iw=!1,U8(),tl=new VConsole({pluginOrder:["default","needle-console"]});const i=globalThis["needle:codegen_files"];if(i&&i.length>0&&tl.addPlugin(oMe()),Ec=lMe(),Ec&&(Ec[fD]=Ec.parentElement,Ec.style.position="absolute",Ec.style.zIndex=Number.MAX_SAFE_INTEGER.toString()),tl.setSwitchPosition(20,30),vd=aMe(),vd){vd.innerText=z8,vd.addEventListener("click",sMe);const s=document.createElement("style"),r=40;s.innerHTML=`
                #__vconsole .vc-switch {
                    border: 1px solid rgba(255, 255, 255, .1);
                    border-radius: 50%;
                    width: ${r}px;
                    height: ${r}px;
                    padding: 0;
                    line-height: ${r}px;
                    font-size: ${r*.4}px;
                    text-align: center;
                    background: #ffffff5c;
                    backdrop-filter: blur(16px);
                    -webkit-backdrop-filter: blur(16px);
                    user-select: none;
                    pointer-events: auto;
                    transition: transform .2s ease-in-out;
                    box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);

                    font-family: 'Material Symbols Outlined';
                    color: black;
                    font-size: 2.3em;
                    font-weight: 100;
                }
                #__vconsole .vc-switch:hover {
                    cursor: pointer;
                    transform: scale(1.1);
                    transition: transform .1s ease-in-out, background .1s linear;
                    background: rgba(245, 245, 245, .8);
                    outline: rgba(0, 0, 0, .05) 1px solid;
                }
                #__vconsole .vc-switch[error] {
                    background: rgba(255,0,0,.2);
                    animation: vconsole-notify 1s ease-in-out;
                    line-height: 35px;
                }
                @keyframes vconsole-notify {
                    from {
                        transform: scale(1, 1);
                    }
                    10% {
                        transform: scale(1.3, 1.3);
                    }
                    70% {
                        transform: scale(1.4, 1.4);
                    }
                    to {
                        transform: scale(1, 1);
                    }
                }
                #__vconsole .vc-panel {
                    font-family: monospace;
                    font-size: 11px;
                }
                #__vconsole .vc-plugin-box.vc-actived {
                    height: 100%;
                }
                #__vconsole .vc-mask {
                    overflow: hidden;
                }
            `,Ec?.prepend(s),n===!0&&bX()<=0&&F8(),console.log("\u{1F335} Debug console has loaded")}},e.onerror=()=>{console.warn("\u{1F335} Debug console failed to load."+(window.crossOriginIsolated?"This page is using cross-origin isolation, so external scripts can't be loaded.":"")),Iw=!1,tl=null},e.src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js",document.body.appendChild(e)}function oMe(){if(!globalThis.VConsole)return;const n=new VConsole.VConsolePlugin("needle-console","\u{1F335} Inspect glTF"),e=()=>document.querySelector("#__vc_plug_"+n._id+" iframe");return n.on("renderTab",function(i){const s=globalThis["needle:codegen_files"];if(!s||s.length===0)return;let r=globalThis["needle:codegen_files"][0];const o=r.indexOf("?");o>-1&&(r=r.substring(0,o));const a=location.protocol+"//"+location.host+location.pathname+"/"+r,l=encodeURIComponent(a);n.fullUrl="https://viewer.needle.tools?inspect&file="+l;var c='<iframe src="" style="width: 100%; height: 99%; border: none;"></iframe>';i(c)}),n.on("show",function(){const i=e();i&&i.src!==n.fullUrl&&(i.src=n.fullUrl)}),n.on("hide",function(){const i=e();i&&(i.src="")}),n.on("addTopBar",function(i){var s=new Array;s.push({name:"Open in new window \u2197",onClick:function(r){window.open(n.fullUrl,"_blank"),tl?.hide()}}),s.push({name:"Reload",onClick:function(r){const o=e();o&&(o.src=n.fullUrl)}}),s.push({name:"Fullscreen",onClick:function(r){const o=e();o.requestFullscreen?o.requestFullscreen():o.webkitRequestFullscreen instanceof Function&&o.webkitRequestFullscreen()}}),i(s)}),n}function aMe(){return document.querySelector("#__vconsole .vc-switch")||null}function lMe(){return document.querySelector("#__vconsole")||null}const W8=q("debugdefines");Mm('if(!globalThis[""4.1.0-alpha.9""]) globalThis[""4.1.0-alpha.9""] = "0.0.0";'),Mm('if(!globalThis[""undefined""]) globalThis[""undefined""] = "unknown";'),Mm('if(!globalThis[""Wed Jan 15 2025 09:56:43 GMT+0100 (Central European Standard Time)""]) globalThis[""Wed Jan 15 2025 09:56:43 GMT+0100 (Central European Standard Time)""] = "unknown";'),Mm('if(!globalThis[""npk_74222a9fbd1b42572cdd3bf7f639eeb17a07d07f40a6185fac5f722e8fd34df9""]) globalThis[""npk_74222a9fbd1b42572cdd3bf7f639eeb17a07d07f40a6185fac5f722e8fd34df9""] = "unknown";'),Mm('globalThis["__NEEDLE_ENGINE_VERSION__"] = "4.1.0-alpha.9";'),Mm('globalThis["__NEEDLE_ENGINE_GENERATOR__"] = "undefined";'),Mm('globalThis["__NEEDLE_PROJECT_BUILD_TIME__"] = "Wed Jan 15 2025 09:56:43 GMT+0100 (Central European Standard Time)";'),Mm('globalThis["__NEEDLE_PUBLIC_KEY__"] = "npk_74222a9fbd1b42572cdd3bf7f639eeb17a07d07f40a6185fac5f722e8fd34df9";');const xh="4.1.0-alpha.9",qE="undefined",yD="Wed Jan 15 2025 09:56:43 GMT+0100 (Central European Standard Time)";W8&&console.log(`Engine version: ${xh} (generator: ${qE})
Project built at ${yD}`);const Ew="npk_74222a9fbd1b42572cdd3bf7f639eeb17a07d07f40a6185fac5f722e8fd34df9",Du="needle_isActiveInHierarchy",c0="builtin_components",Rw="needle_editor_guid";function Mm(n){try{(0,eval)(n)}catch(e){W8&&console.error(e)}}const cMe='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 160 187.74"><defs><linearGradient id="a" x1="89.64" y1="184.81" x2="90.48" y2="21.85" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#62d399"/><stop offset=".51" stop-color="#acd842"/><stop offset=".9" stop-color="#d7db0a"/></linearGradient><linearGradient id="b" x1="69.68" y1="178.9" x2="68.08" y2="16.77" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0ba398"/><stop offset=".5" stop-color="#4ca352"/><stop offset="1" stop-color="#76a30a"/></linearGradient><linearGradient id="c" x1="36.6" y1="152.17" x2="34.7" y2="84.19" gradientUnits="userSpaceOnUse"><stop offset=".19" stop-color="#36a382"/><stop offset=".54" stop-color="#49a459"/><stop offset="1" stop-color="#76a30b"/></linearGradient><linearGradient id="d" x1="15.82" y1="153.24" x2="18" y2="90.86" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#267880"/><stop offset=".51" stop-color="#457a5c"/><stop offset="1" stop-color="#717516"/></linearGradient><linearGradient id="e" x1="135.08" y1="135.43" x2="148.93" y2="63.47" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b0d939"/><stop offset="1" stop-color="#eadb04"/></linearGradient><linearGradient id="f" x1="-4163.25" y1="2285.12" x2="-4160.81" y2="2215.34" gradientTransform="rotate(20 4088.49 13316.712)" gradientUnits="userSpaceOnUse"><stop offset=".17" stop-color="#74af52"/><stop offset=".48" stop-color="#99be32"/><stop offset="1" stop-color="#c0c40a"/></linearGradient><symbol id="g" viewBox="0 0 160 187.74"><path style="fill:url(#a)" d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75z"/><path style="fill:url(#b)" d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98z"/><path style="fill:url(#c)" d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z"/><path style="fill:url(#d)" d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04z"/><path style="fill:#9c3" d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5z"/><path style="fill:url(#e)" d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59z"/><path style="fill:url(#f)" d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z"/><path style="fill:#ffe113" d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1z"/><path style="fill:#f3e600" d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75z"/></symbol></defs><use width="160" height="187.74" xlink:href="#g"/></svg>',hMe=btoa(cMe),dMe="data:image/svg+xml;base64,"+hMe,uMe=dMe,pMe=`<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'> <svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" version="1.1" viewBox="0 0 1014 282" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m665.95 132.73v44.88l-10.56-8.4c-0.8-0.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18 0.4-6.06 1.2s-3.54 1.8-4.98 3-2.56 2.5-3.36 3.9-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c0.32 0.24 0.56 0.44 0.72 0.6s0.36 0.32 0.6 0.48c0.96-1.2 2.14-2.28 3.54-3.24s2.92-1.76 4.56-2.4 3.34-1.14 5.1-1.5 3.44-0.54 5.04-0.54c1.44 0 2.92 0.04 4.44 0.12s2.84 0.28 3.96 0.6c4.56 1.12 7.8 3.12 9.72 6s2.88 6.56 2.88 11.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m732.38 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m795.93 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m858.57 97.21c0.64 0.48 0.96 1.16 0.96 2.04v74.88c-0.08 1.04-0.12 2.12-0.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18s-2.06-1.66-2.46-1.98c-1.76 2.48-4.26 4.44-7.5 5.88s-7.02 2.16-11.34 2.16c-3.84 0-7.4-0.7-10.68-2.1s-6.14-3.44-8.58-6.12-4.34-5.94-5.7-9.78-2.04-8.16-2.04-12.96c0-4.32 0.78-8.34 2.34-12.06s3.6-6.92 6.12-9.6 5.38-4.78 8.58-6.3 6.48-2.28 9.84-2.28c2.56 0 4.82 0.22 6.78 0.66s3.68 1.06 5.16 1.86 2.78 1.74 3.9 2.82 2.16 2.22 3.12 3.42v-35.04l10.68 8.64zm-27.96 67.92c3.6 0 6.52-0.68 8.76-2.04s3.98-3.06 5.22-5.1 2.1-4.22 2.58-6.54 0.72-4.44 0.72-6.36v-1.2c0-1.12-0.22-2.7-0.66-4.74s-1.28-4.06-2.52-6.06-3-3.7-5.28-5.1-5.22-2.02-8.82-1.86c-3.44 0-6.26 0.74-8.46 2.22s-3.96 3.26-5.28 5.34-2.24 4.2-2.76 6.36-0.78 3.92-0.78 5.28c0 1.84 0.24 3.92 0.72 6.24s1.36 4.48 2.64 6.48 3.04 3.68 5.28 5.04 5.12 2.04 8.64 2.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m882.81 97.09c0.64 0.48 0.96 1.12 0.96 1.92l-0.12 41.04v37.08l-10.56-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-77.88l10.8 8.64z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m950.36 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.8559 0 0 .7642 45.348 36.475)"> <g transform="translate(2.7114)"> <path d="m3.935 173.02c-0.331 0-0.497-0.402-0.497-1.207v-51.002c0-0.738 0.138-1.107 0.414-1.107h1.781c0.277 0 0.415 0.335 0.415 1.006v5.935c0 0.336 0.027 0.553 0.083 0.654 0.055 0.101 0.151-0.017 0.289-0.352 0.912-1.744 1.754-3.236 2.527-4.477 0.773-1.24 1.554-2.179 2.341-2.816s1.65-0.956 2.588-0.956c1.685 0 3.011 0.922 3.977 2.766 0.967 1.845 1.602 3.84 1.905 5.986 0.056 0.268 0.139 0.369 0.249 0.302s0.221-0.235 0.331-0.503c0.939-1.811 1.802-3.353 2.589-4.628 0.787-1.274 1.581-2.246 2.382-2.917s1.671-1.006 2.61-1.006c2.016 0 3.569 1.392 4.66 4.175 1.09 2.783 1.636 6.421 1.636 10.915v37.925c0 0.871-0.18 1.307-0.539 1.307h-1.739c-0.138 0-0.249-0.1-0.332-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.338-6.321-1.015-8.3-0.676-1.978-1.76-2.967-3.251-2.967-0.884 0-1.726 0.386-2.527 1.157s-1.519 1.727-2.154 2.867-1.201 2.213-1.699 3.219c-0.248 0.469-0.421 0.905-0.517 1.308-0.097 0.402-0.145 0.972-0.145 1.71v37.221c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.166 0-0.29-0.1-0.373-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.332-6.321-0.994-8.3-0.663-1.978-1.754-2.967-3.273-2.967-1.242 0-2.375 0.704-3.396 2.112-1.022 1.409-2.223 3.555-3.604 6.439v39.031c0 0.805-0.18 1.207-0.539 1.207h-1.698z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m53.642 166.28c-1.077 2.549-2.237 4.477-3.479 5.785-1.243 1.307-2.61 1.961-4.101 1.961-2.154 0-3.853-1.324-5.095-3.973-1.243-2.649-1.864-6.187-1.864-10.613 0-3.488 0.4-6.489 1.201-9.004s1.988-4.51 3.562-5.985c1.574-1.476 3.521-2.414 5.841-2.817l3.686-0.704c0.221-0.067 0.394-0.218 0.518-0.453 0.124-0.234 0.187-0.587 0.187-1.056v-2.917c0-3.89-0.504-6.975-1.512-9.255s-2.354-3.42-4.039-3.42c-1.298 0-2.472 0.72-3.521 2.162s-2.002 3.572-2.858 6.388c-0.083 0.268-0.159 0.453-0.228 0.554-0.069 0.1-0.172 0.083-0.311-0.051l-1.698-1.71c-0.083-0.134-0.138-0.285-0.166-0.453-0.027-0.167 0.014-0.452 0.125-0.855 0.856-3.353 2.009-6.052 3.459-8.098 1.449-2.045 3.224-3.068 5.322-3.068 1.74 0 3.211 0.687 4.412 2.062s2.112 3.37 2.734 5.986c0.621 2.615 0.932 5.7 0.932 9.255v35.712c0 0.536-0.035 0.888-0.104 1.056s-0.2 0.251-0.393 0.251h-1.533c-0.166 0-0.29-0.117-0.373-0.352-0.083-0.234-0.124-0.553-0.124-0.955l-0.083-5.231c-0.055-0.939-0.221-1.006-0.497-0.202zm0.456-19.314c0-1.14-0.194-1.643-0.58-1.509l-3.107 0.603c-1.436 0.202-2.686 0.638-3.749 1.308-1.063 0.671-1.953 1.543-2.671 2.616s-1.257 2.33-1.616 3.772-0.538 3.102-0.538 4.98c0 3.152 0.455 5.616 1.367 7.393 0.911 1.778 2.14 2.666 3.686 2.666 0.939 0 1.85-0.419 2.734-1.257s1.671-1.895 2.361-3.169c0.663-1.408 1.181-2.85 1.553-4.326 0.373-1.475 0.56-2.883 0.56-4.225v-8.852z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m79.034 173.02c-0.166 0-0.297-0.117-0.394-0.352-0.096-0.234-0.145-0.553-0.145-0.955v-4.628c0-0.536-0.041-0.838-0.124-0.905s-0.207 0.1-0.373 0.503c-0.276 0.67-0.69 1.593-1.242 2.766-0.553 1.174-1.271 2.23-2.154 3.169-0.884 0.939-1.961 1.408-3.231 1.408-1.74 0-3.314-0.989-4.722-2.967-1.409-1.979-2.534-4.963-3.376-8.953-0.843-3.991-1.264-8.937-1.264-14.838 0-5.701 0.415-10.68 1.243-14.939s1.988-7.595 3.479-10.009c1.492-2.415 3.204-3.622 5.137-3.622 1.436 0 2.616 0.57 3.541 1.71 0.926 1.14 1.719 2.381 2.382 3.722 0.249 0.47 0.414 0.637 0.497 0.503s0.125-0.536 0.125-1.207v-23.841c0-0.805 0.151-1.208 0.455-1.208h1.864c0.276 0 0.414 0.369 0.414 1.107v72.128c0 0.537-0.041 0.905-0.124 1.107-0.083 0.201-0.235 0.301-0.455 0.301h-1.533zm-0.621-42.049c-0.939-2.213-1.885-3.94-2.838-5.181s-2.009-1.861-3.169-1.861c-1.463 0-2.768 0.889-3.914 2.666s-2.044 4.376-2.693 7.796-0.973 7.578-0.973 12.474c0 5.097 0.338 9.272 1.015 12.524 0.676 3.253 1.567 5.651 2.672 7.193 1.104 1.543 2.305 2.314 3.603 2.314 1.188 0 2.258-0.704 3.211-2.113 0.952-1.408 1.705-3.118 2.257-5.13s0.829-3.957 0.829-5.835v-24.847z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m89.514 149.38c0 3.42 0.345 6.606 1.035 9.557 0.691 2.951 1.609 5.315 2.755 7.092s2.437 2.666 3.873 2.666c1.519 0 2.837-0.738 3.956-2.213 1.118-1.476 2.064-3.655 2.837-6.539 0.083-0.336 0.166-0.52 0.249-0.554 0.083-0.033 0.179 0.017 0.29 0.151l1.408 1.912c0.221 0.268 0.235 0.67 0.041 1.207-0.69 2.548-1.47 4.661-2.34 6.337-0.87 1.677-1.857 2.935-2.962 3.773-1.104 0.838-2.319 1.257-3.645 1.257-2.043 0-3.838-1.14-5.385-3.42-1.546-2.28-2.761-5.482-3.645-9.607-0.884-4.124-1.325-8.836-1.325-14.134 0-5.901 0.455-10.931 1.367-15.089 0.911-4.158 2.14-7.377 3.686-9.658 1.547-2.28 3.3-3.42 5.261-3.42 1.988 0 3.714 1.073 5.178 3.219 1.463 2.146 2.595 5.231 3.396 9.255s1.201 8.886 1.201 14.587c0 0.469-0.02 0.939-0.062 1.408-0.041 0.469-0.214 0.704-0.517 0.704h-16.362c-0.083 0-0.152 0.151-0.207 0.453-0.056 0.302-0.083 0.654-0.083 1.056zm13.752-6.237c0.304 0 0.497-0.1 0.58-0.302 0.083-0.201 0.124-0.57 0.124-1.106 0-3.219-0.283-6.187-0.849-8.903s-1.367-4.896-2.402-6.539c-1.036-1.643-2.272-2.464-3.708-2.464-1.629 0-2.996 0.955-4.101 2.867-1.104 1.911-1.94 4.342-2.506 7.293s-0.849 6.002-0.849 9.154h13.711z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m148.54 119.7c0.165 0 0.283 0.117 0.352 0.352s0.076 0.52 0.02 0.855l-6.254 50.902c-0.028 0.47-0.104 0.788-0.228 0.956s-0.297 0.251-0.518 0.251h-1.615c-0.442 0-0.718-0.402-0.829-1.207l-5.26-40.138c-0.111-0.604-0.201-0.905-0.27-0.905s-0.131 0.301-0.186 0.905l-5.012 40.138c-0.028 0.47-0.097 0.788-0.207 0.956-0.111 0.168-0.277 0.251-0.497 0.251h-1.74c-0.442 0-0.718-0.402-0.829-1.207l-6.503-50.801c-0.055-0.403-0.048-0.721 0.021-0.956s0.2-0.352 0.393-0.352h1.823c0.166 0 0.297 0.067 0.393 0.201 0.097 0.134 0.159 0.403 0.187 0.805l5.302 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.219-41.949c0.055-0.268 0.124-0.47 0.207-0.604s0.193-0.201 0.331-0.201h1.533c0.138 0 0.262 0.067 0.373 0.201 0.11 0.134 0.179 0.403 0.207 0.805l5.468 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.053-41.849c0.055-0.335 0.138-0.57 0.249-0.704 0.11-0.134 0.234-0.201 0.373-0.201h1.284z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m156.49 171.51c0 0.604-0.042 1.006-0.125 1.208-0.082 0.201-0.262 0.301-0.538 0.301h-1.533c-0.221 0-0.366-0.083-0.435-0.251s-0.103-0.486-0.103-0.956v-50.902c0-0.805 0.152-1.207 0.456-1.207h1.822c0.304 0 0.456 0.402 0.456 1.207v50.6zm0.165-63.979c0 1.207-0.207 1.811-0.621 1.811h-1.905c-0.221 0-0.366-0.135-0.435-0.403s-0.104-0.67-0.104-1.207v-7.847c0-1.006 0.18-1.509 0.539-1.509h1.988c0.359 0 0.538 0.47 0.538 1.409v7.746z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m168.3 124.83c-0.221 0-0.331 0.269-0.331 0.805v33.801c0 3.42 0.221 5.667 0.663 6.74 0.441 1.073 1.09 1.609 1.946 1.609h3.024c0.138 0 0.242 0.084 0.311 0.252 0.069 0.167 0.103 0.419 0.103 0.754v2.716c0 0.537-0.138 0.906-0.414 1.107-0.248 0.067-0.614 0.134-1.098 0.201-0.483 0.067-0.959 0.118-1.429 0.151-0.469 0.034-0.828 0.05-1.077 0.05-1.712 0-2.934-0.955-3.665-2.867-0.732-1.911-1.098-5.013-1.098-9.305v-35.108c0-0.604-0.124-0.906-0.373-0.906h-3.521c-0.248 0-0.373-0.268-0.373-0.804v-3.521c0-0.537 0.111-0.805 0.332-0.805h3.686c0.166 0 0.263-0.268 0.29-0.805l0.415-16.095c0-0.805 0.124-1.207 0.372-1.207h1.492c0.303 0 0.455 0.436 0.455 1.307v15.995c0 0.537 0.097 0.805 0.29 0.805h5.468c0.221 0 0.331 0.268 0.331 0.805v3.521c0 0.536-0.124 0.804-0.373 0.804h-5.426z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m179.4 173.02c-0.331 0-0.497-0.402-0.497-1.207v-72.329c0-0.738 0.138-1.107 0.414-1.107h1.782c0.276 0 0.414 0.336 0.414 1.006v27.162c0 0.335 0.034 0.536 0.103 0.603s0.159-0.033 0.27-0.302c0.994-1.81 1.898-3.319 2.713-4.526 0.814-1.208 1.629-2.113 2.444-2.717 0.814-0.603 1.691-0.905 2.63-0.905 2.182 0 3.839 1.375 4.971 4.125 1.132 2.749 1.698 6.404 1.698 10.965v37.925c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.165 0-0.29-0.1-0.373-0.301-0.082-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.366-6.321-1.097-8.3-0.732-1.978-1.899-2.967-3.501-2.967-0.883 0-1.705 0.318-2.464 0.956-0.76 0.637-1.526 1.576-2.299 2.816-0.773 1.241-1.643 2.834-2.61 4.779v39.031c0 0.805-0.179 1.207-0.538 1.207h-1.699z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> </g> <g transform="matrix(.80638 0 0 .80638 452.53 65.421)" fill-rule="nonzero"> <path d="m79.32 36.98v150.76l15.68-13.2 6.59-156.31-22.27 18.75z" fill="url(#f)"/> <path d="m79.32 36.98-22.27-18.75 6.59 156.31 15.68 13.2v-150.76z" fill="url(#e)"/> <path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z" fill="url(#d)"/> <path d="m25.19 104.83-25.19-14.59 16.97 53.86 16.85 9.77-8.63-49.04z" fill="url(#c)"/> <path d="M43.86,82.5L18.69,67.98L0,90.24L25.18,104.83L43.86,82.5Z" fill="#9c3"/> <path d="m134.82 78.69-9.97 56.5 15.58-9.04 19.57-62.05-25.18 14.59z" fill="url(#b)"/> <path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z" fill="url(#a)"/> <path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33 25.19-14.59z" fill="#ffe113"/> <path d="M101.59,18.23L79.32,0L57.05,18.23L79.32,36.98L101.59,18.23Z" fill="#f3e600"/> </g> <defs> <linearGradient id="f" x2="1" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)" gradientUnits="userSpaceOnUse"><stop stop-color="#62d399" offset="0"/><stop stop-color="#acd842" offset=".51"/><stop stop-color="#d7db0a" offset=".9"/><stop stop-color="#d7db0a" offset="1"/></linearGradient> <linearGradient id="e" x2="1" gradientTransform="matrix(-1.6,-162.13,162.13,-1.6,69.68,178.9)" gradientUnits="userSpaceOnUse"><stop stop-color="#0ba398" offset="0"/><stop stop-color="#4ca352" offset=".5"/><stop stop-color="#76a30a" offset="1"/></linearGradient> <linearGradient id="d" x2="1" gradientTransform="matrix(-1.9,-67.98,67.98,-1.9,36.6,152.17)" gradientUnits="userSpaceOnUse"><stop stop-color="#36a382" offset="0"/><stop stop-color="#36a382" offset=".19"/><stop stop-color="#49a459" offset=".54"/><stop stop-color="#76a30b" offset="1"/></linearGradient> <linearGradient id="c" x2="1" gradientTransform="matrix(2.18,-62.38,62.38,2.18,15.82,153.24)" gradientUnits="userSpaceOnUse"><stop stop-color="#267880" offset="0"/><stop stop-color="#457a5c" offset=".51"/><stop stop-color="#717516" offset="1"/></linearGradient> <linearGradient id="b" x2="1" gradientTransform="matrix(13.85,-71.96,71.96,13.85,135.08,135.43)" gradientUnits="userSpaceOnUse"><stop stop-color="#b0d939" offset="0"/><stop stop-color="#eadb04" offset="1"/></linearGradient> <linearGradient id="a" x2="1" gradientTransform="matrix(26.159 -64.737 64.737 26.159 107.42 128.14)" gradientUnits="userSpaceOnUse"><stop stop-color="#74af52" offset="0"/><stop stop-color="#74af52" offset=".17"/><stop stop-color="#99be32" offset=".48"/><stop stop-color="#c0c40a" offset="1"/></linearGradient> </defs> </svg>`;btoa(pMe);const mMe='<svg viewBox="0 0 509 154" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><path d="M665.95 132.73v44.88l-10.56-8.4c-.8-.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18.4-6.06 1.2-1.88.8-3.54 1.8-4.98 3-1.44 1.2-2.56 2.5-3.36 3.9-.8 1.4-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-.72-.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c.32.24.56.44.72.6.16.16.36.32.6.48.96-1.2 2.14-2.28 3.54-3.24 1.4-.96 2.92-1.76 4.56-2.4 1.64-.64 3.34-1.14 5.1-1.5 1.76-.36 3.44-.54 5.04-.54 1.44 0 2.92.04 4.44.12 1.52.08 2.84.28 3.96.6 4.56 1.12 7.8 3.12 9.72 6 1.92 2.88 2.88 6.56 2.88 11.04ZM732.38 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM795.93 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM858.57 97.21c.64.48.96 1.16.96 2.04v74.88c-.08 1.04-.12 2.12-.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18-1.24-1-2.06-1.66-2.46-1.98-1.76 2.48-4.26 4.44-7.5 5.88-3.24 1.44-7.02 2.16-11.34 2.16-3.84 0-7.4-.7-10.68-2.1-3.28-1.4-6.14-3.44-8.58-6.12-2.44-2.68-4.34-5.94-5.7-9.78-1.36-3.84-2.04-8.16-2.04-12.96 0-4.32.78-8.34 2.34-12.06 1.56-3.72 3.6-6.92 6.12-9.6 2.52-2.68 5.38-4.78 8.58-6.3 3.2-1.52 6.48-2.28 9.84-2.28 2.56 0 4.82.22 6.78.66 1.96.44 3.68 1.06 5.16 1.86s2.78 1.74 3.9 2.82a35.92 35.92 0 0 1 3.12 3.42V88.57l10.68 8.64Zm-27.96 67.92c3.6 0 6.52-.68 8.76-2.04 2.24-1.36 3.98-3.06 5.22-5.1a20.5 20.5 0 0 0 2.58-6.54c.48-2.32.72-4.44.72-6.36v-1.2c0-1.12-.22-2.7-.66-4.74-.44-2.04-1.28-4.06-2.52-6.06s-3-3.7-5.28-5.1c-2.28-1.4-5.22-2.02-8.82-1.86-3.44 0-6.26.74-8.46 2.22-2.2 1.48-3.96 3.26-5.28 5.34-1.32 2.08-2.24 4.2-2.76 6.36-.52 2.16-.78 3.92-.78 5.28 0 1.84.24 3.92.72 6.24.48 2.32 1.36 4.48 2.64 6.48s3.04 3.68 5.28 5.04c2.24 1.36 5.12 2.04 8.64 2.04ZM882.81 97.09c.64.48.96 1.12.96 1.92l-.12 41.04v37.08l-10.56-8.4c-.72-.64-1.08-1.44-1.08-2.4V88.45l10.8 8.64ZM950.36 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14Z" style="fill-rule:nonzero" transform="translate(-452.406 -63.709) scale(1.00797)"/><path d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75Z" style="fill:url(#a);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98Z" style="fill:url(#b);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33Z" style="fill:url(#c);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04Z" style="fill:url(#d);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5Z" style="fill:#9c3;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59Z" style="fill:url(#e);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5Z" style="fill:url(#f);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1Z" style="fill:#ffe113;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75Z" style="fill:#f3e600;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><defs><linearGradient id="a" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)"><stop offset="0" style="stop-color:#62d399;stop-opacity:1"/><stop offset=".51" style="stop-color:#acd842;stop-opacity:1"/><stop offset=".9" style="stop-color:#d7db0a;stop-opacity:1"/><stop offset="1" style="stop-color:#d7db0a;stop-opacity:1"/></linearGradient><linearGradient id="b" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-90.565 123.412 54.953) scale(162.14)"><stop offset="0" style="stop-color:#0ba398;stop-opacity:1"/><stop offset=".5" style="stop-color:#4ca352;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30a;stop-opacity:1"/></linearGradient><linearGradient id="c" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="scale(-68) rotate(88.4 .881 -1.396)"><stop offset="0" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".19" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".54" style="stop-color:#49a459;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30b;stop-opacity:1"/></linearGradient><linearGradient id="d" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-88 87.255 68.431) scale(62.42)"><stop offset="0" style="stop-color:#267880;stop-opacity:1"/><stop offset=".51" style="stop-color:#457a5c;stop-opacity:1"/><stop offset="1" style="stop-color:#717516;stop-opacity:1"/></linearGradient><linearGradient id="e" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-79.1 149.53 -14.065) scale(73.28)"><stop offset="0" style="stop-color:#b0d939;stop-opacity:1"/><stop offset="1" style="stop-color:#eadb04;stop-opacity:1"/></linearGradient><linearGradient id="f" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-67.997 148.705 -15.558) scale(69.8226)"><stop offset="0" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".17" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".48" style="stop-color:#99be32;stop-opacity:1"/><stop offset="1" style="stop-color:#c0c40a;stop-opacity:1"/></linearGradient></defs></svg>',gMe=btoa(mMe),fMe="data:image/svg+xml;charset=utf-8;base64,"+gMe,AMe=fMe;/**
 * postprocessing v6.36.6 build Tue Dec 31 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van Rüschen
 * @license Zlib
 */var bD=1/1e3,yMe=1e3,bMe=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*bD}get fixedDelta(){return this._fixedDelta*bD}set fixedDelta(n){this._fixedDelta=n*yMe}get elapsed(){return this._elapsed*bD}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},vMe=(()=>{const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),i=new Rt;return i.setAttribute("position",new ct(n,3)),i.setAttribute("uv",new ct(e,2)),i})(),Fr=class kZ{static get fullscreenGeometry(){return vMe}constructor(e="Pass",i=new ir,s=new t1){this.name=e,this.renderer=null,this.scene=i,this.camera=s,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const i=this.fullscreenMaterial;i!==null&&(i.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let i=this.screen;i!==null?i.material=e:(i=new pe(kZ.fullscreenGeometry,e),i.frustumCulled=!1,this.scene===null&&(this.scene=new ir),this.scene.add(i),this.screen=i)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,i=co){}render(e,i,s,r,o){throw new Error("Render method not implemented!")}setSize(e,i){}initialize(e,i,s){}dispose(){for(const e of Object.keys(this)){const i=this[e];(i instanceof fi||i instanceof ti||i instanceof di||i instanceof kZ)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},xMe=class extends Fr{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,i,s,r){const o=n.state.buffers.stencil;o.setLocked(!1),o.setTest(!1)}},wMe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,h0="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",H8=class extends jt{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Te(null),opacity:new Te(1)},blending:Pn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:wMe,vertexShader:h0})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},Q8=class extends Fr{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new H8,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new fi(1,1,{minFilter:Wt,magFilter:Wt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,i,s,r){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==Xi?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":n!==null&&n.outputColorSpace===ut&&(this.renderTarget.texture.colorSpace=ut))}},K8=new fe,$E=class extends Fr{constructor(n=!0,e=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,i){this.color=n,this.depth=e,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,i,s,r){const o=this.overrideClearColor,a=this.overrideClearAlpha,l=n.getClearAlpha(),c=o!==null,h=a>=0;c?(n.getClearColor(K8),n.setClearColor(o,h?a:l)):h&&n.setClearAlpha(a),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),c?n.setClearColor(K8,l):h&&n.setClearAlpha(l)}},CMe=class extends Fr{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new $E(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,i,s,r){const o=n.getContext(),a=n.state.buffers,l=this.scene,c=this.camera,h=this.clearPass,d=this.inverted?0:1,u=1-d;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),a.stencil.setFunc(o.ALWAYS,d,4294967295),a.stencil.setClear(u),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?h.render(n,null):(h.render(n,e),h.render(n,i))),this.renderToScreen?(n.setRenderTarget(null),n.render(l,c)):(n.setRenderTarget(e),n.render(l,c),n.setRenderTarget(i),n.render(l,c)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(o.EQUAL,1,4294967295),a.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),a.stencil.setLocked(!0)}},vD=class{constructor(n=null,{depthBuffer:e=!0,stencilBuffer:i=!1,multisampling:s=0,frameBufferType:r}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,i,r,s),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Q8,this.depthTexture=null,this.passes=[],this.timer=new bMe,this.autoRenderToScreen=!0,this.setRenderer(n)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(n){const e=this.inputBuffer,i=this.multisampling;i>0&&n>0?(this.inputBuffer.samples=n,this.outputBuffer.samples=n,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==n&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,n),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(n){if(this.renderer=n,n!==null){const e=n.getSize(new Q),i=n.getContext().getContextAttributes().alpha,s=this.inputBuffer.texture.type;s===Xi&&n.outputColorSpace===ut&&(this.inputBuffer.texture.colorSpace=ut,this.outputBuffer.texture.colorSpace=ut,this.inputBuffer.dispose(),this.outputBuffer.dispose()),n.autoClear=!1,this.setSize(e.width,e.height);for(const r of this.passes)r.initialize(n,i,s)}}replaceRenderer(n,e=!0){const i=this.renderer,s=i.domElement.parentNode;return this.setRenderer(n),e&&s!==null&&(s.removeChild(i.domElement),s.appendChild(n.domElement)),i}createDepthTexture(){const n=this.depthTexture=new Eu;return this.inputBuffer.depthTexture=n,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(n.format=Jp,n.type=jp):n.type=Gr,n}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const n of this.passes)n.setDepthTexture(null)}}createBuffer(n,e,i,s){const r=this.renderer,o=r===null?new Q:r.getDrawingBufferSize(new Q),a={minFilter:Wt,magFilter:Wt,stencilBuffer:e,depthBuffer:n,type:i},l=new fi(o.width,o.height,a);return s>0&&(l.ignoreDepthForMultisampleCopy=!1,l.samples=s),i===Xi&&r!==null&&r.outputColorSpace===ut&&(l.texture.colorSpace=ut),l.texture.name="EffectComposer.Buffer",l.texture.generateMipmaps=!1,l}setMainScene(n){for(const e of this.passes)e.mainScene=n}setMainCamera(n){for(const e of this.passes)e.mainCamera=n}addPass(n,e){const i=this.passes,s=this.renderer,r=s.getDrawingBufferSize(new Q),o=s.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(n.setRenderer(s),n.setSize(r.width,r.height),n.initialize(s,o,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),n.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?i.splice(e,0,n):i.push(n),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),n.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const l=this.createDepthTexture();for(n of i)n.setDepthTexture(l)}else n.setDepthTexture(this.depthTexture)}removePass(n){const e=this.passes,i=e.indexOf(n);if(i!==-1&&e.splice(i,1).length>0){if(this.depthTexture!==null){const s=(r,o)=>r||o.needsDepthTexture;e.reduce(s,!1)||(n.getDepthTexture()===this.depthTexture&&n.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&i===e.length&&(n.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const n=this.passes;this.deleteDepthTexture(),n.length>0&&(this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!1),this.passes=[])}render(n){const e=this.renderer,i=this.copyPass;let s=this.inputBuffer,r=this.outputBuffer,o=!1,a,l,c;n===void 0&&(this.timer.update(),n=this.timer.getDelta());for(const h of this.passes)h.enabled&&(h.render(e,s,r,n,o),h.needsSwap&&(o&&(i.renderToScreen=h.renderToScreen,a=e.getContext(),l=e.state.buffers.stencil,l.setFunc(a.NOTEQUAL,1,4294967295),i.render(e,s,r,n,o),l.setFunc(a.EQUAL,1,4294967295)),c=s,s=r,r=c),h instanceof CMe?o=!0:h instanceof xMe&&(o=!1))}setSize(n,e,i){const s=this.renderer,r=s.getSize(new Q);(n===void 0||e===void 0)&&(n=r.width,e=r.height),(r.width!==n||r.height!==e)&&s.setSize(n,e,i);const o=s.getDrawingBufferSize(new Q);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const n of this.passes)n.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Fr.fullscreenGeometry.dispose()}},Bl={NONE:0,DEPTH:1,CONVOLUTION:2},sn={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},SMe=class{constructor(){this.shaderParts=new Map([[sn.FRAGMENT_HEAD,null],[sn.FRAGMENT_MAIN_UV,null],[sn.FRAGMENT_MAIN_IMAGE,null],[sn.VERTEX_HEAD,null],[sn.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Bl.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=qi}},xD=!1,Y8=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let i;if(e.material.flatShading)switch(e.material.side){case Qi:i=this.materialsFlatShadedDoubleSide;break;case wn:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(e.material.side){case Qi:i=this.materialsDoubleSide;break;case wn:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=i[2]:e.isInstancedMesh?e.material=i[1]:e.material=i[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof jt))return n.clone();const e=n.uniforms,i=new Map;for(const r in e){const o=e[r].value;o.isRenderTargetTexture&&(e[r].value=null,i.set(r,o))}const s=n.clone();for(const r of i)e[r[0]].value=r[1],s.uniforms[r[0]].value=r[1];return s}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const i of e)i.uniforms=Object.assign({},n.uniforms),i.side=ms;e[2].skinning=!0,this.materialsBackSide=e.map(i=>{const s=this.cloneMaterial(i);return s.uniforms=Object.assign({},n.uniforms),s.side=wn,s}),this.materialsDoubleSide=e.map(i=>{const s=this.cloneMaterial(i);return s.uniforms=Object.assign({},n.uniforms),s.side=Qi,s}),this.materialsFlatShaded=e.map(i=>{const s=this.cloneMaterial(i);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s}),this.materialsFlatShadedBackSide=e.map(i=>{const s=this.cloneMaterial(i);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s.side=wn,s}),this.materialsFlatShadedDoubleSide=e.map(i=>{const s=this.cloneMaterial(i);return s.uniforms=Object.assign({},n.uniforms),s.flatShading=!0,s.side=Qi,s})}}render(n,e,i){const s=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,xD){const r=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,i);for(const o of r)o[0].material=o[1];this.meshCount!==r.size&&r.clear()}else{const r=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,i),e.overrideMaterial=r}n.shadowMap.enabled=s}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return xD}static set workaroundEnabled(n){xD=n}},Im=-1,un=class extends yr{constructor(n,e=Im,i=Im,s=1){super(),this.resizable=n,this.baseSize=new Q(1,1),this.preferredSize=new Q(e,i),this.target=this.preferredSize,this.s=s,this.effectiveSize=new Q,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,i=this.effectiveSize,s=this.scale;e.width!==Im?i.width=e.width:e.height!==Im?i.width=Math.round(e.height*(n.width/Math.max(n.height,1))):i.width=Math.round(n.width*s),e.height!==Im?i.height=e.height:e.width!==Im?i.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):i.height=Math.round(n.height*s)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(Im),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Im}},_Me=class{constructor(n=0){this.nextId=n}getNextId(){return this.nextId++}reset(n=0){return this.nextId=n,this}},wD=new _Me(2),MMe=class extends Set{constructor(n,e=wD.getNextId()){super(),this.exclusive=!1,this._layer=e,(this._layer<1||this._layer>31)&&(console.warn("Layer out of range, resetting to 2"),wD.reset(2),this._layer=wD.getNextId()),n!==void 0&&this.set(n)}get layer(){return this._layer}set layer(n){const e=this._layer;for(const i of this)i.layers.disable(e),i.layers.enable(n);this._layer=n}getLayer(){return this.layer}setLayer(n){this.layer=n}isExclusive(){return this.exclusive}setExclusive(n){this.exclusive=n}clear(){const n=this.layer;for(const e of this)e.layers.disable(n);return super.clear()}set(n){this.clear();for(const e of n)this.add(e);return this}indexOf(n){return this.has(n)?0:-1}add(n){return this.exclusive?n.layers.set(this.layer):n.layers.enable(this.layer),super.add(n)}delete(n){return this.has(n)&&n.layers.disable(this.layer),super.delete(n)}toggle(n){let e;return this.has(n)?(this.delete(n),e=!1):(this.add(n),e=!0),e}setVisible(n){for(const e of this)n?e.layers.enable(0):e.layers.disable(0);return this}},bi={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},IMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",TMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",EMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",RMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",LMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",BMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",kMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",GMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",PMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",NMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",VMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",XMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",DMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",zMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",FMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",UMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",OMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",ZMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",WMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",HMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",QMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",KMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",YMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",jMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",JMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",qMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",$Me="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",eIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",tIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",iIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",nIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",sIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",rIe=new Map([[bi.ADD,IMe],[bi.ALPHA,TMe],[bi.AVERAGE,EMe],[bi.COLOR,RMe],[bi.COLOR_BURN,LMe],[bi.COLOR_DODGE,BMe],[bi.DARKEN,kMe],[bi.DIFFERENCE,GMe],[bi.DIVIDE,PMe],[bi.DST,null],[bi.EXCLUSION,NMe],[bi.HARD_LIGHT,VMe],[bi.HARD_MIX,XMe],[bi.HUE,DMe],[bi.INVERT,zMe],[bi.INVERT_RGB,FMe],[bi.LIGHTEN,UMe],[bi.LINEAR_BURN,OMe],[bi.LINEAR_DODGE,ZMe],[bi.LINEAR_LIGHT,WMe],[bi.LUMINOSITY,HMe],[bi.MULTIPLY,QMe],[bi.NEGATION,KMe],[bi.NORMAL,YMe],[bi.OVERLAY,jMe],[bi.PIN_LIGHT,JMe],[bi.REFLECT,qMe],[bi.SATURATION,$Me],[bi.SCREEN,eIe],[bi.SOFT_LIGHT,tIe],[bi.SRC,iIe],[bi.SUBTRACT,nIe],[bi.VIVID_LIGHT,sIe]]),oIe=class extends yr{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new Te(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return rIe.get(this.blendFunction)}},xd={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},aIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,lIe="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",cIe=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],j8=class extends jt{constructor(n=new $e){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Te(null),texelSize:new Te(new $e),scale:new Te(1),kernel:new Te(0)},blending:Pn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:aIe,vertexShader:lIe}),this.setTexelSize(n.x,n.y),this.kernelSize=xd.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return cIe[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e,n*.5,e*.5)}setSize(n,e){const i=1/n,s=1/e;this.uniforms.texelSize.value.set(i,s,i*.5,s*.5)}},CD=class extends Fr{constructor({kernelSize:n=xd.MEDIUM,resolutionScale:e=.5,width:i=un.AUTO_SIZE,height:s=un.AUTO_SIZE,resolutionX:r=i,resolutionY:o=s}={}){super("KawaseBlurPass"),this.renderTargetA=new fi(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const a=this.resolution=new un(this,r,o,e);a.addEventListener("change",l=>this.setSize(a.baseWidth,a.baseHeight)),this._blurMaterial=new j8,this._blurMaterial.kernelSize=n,this.copyMaterial=new H8}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,i,s,r){const o=this.scene,a=this.camera,l=this.renderTargetA,c=this.renderTargetB,h=this.blurMaterial,d=h.kernelSequence;let u=e;this.fullscreenMaterial=h;for(let p=0,g=d.length;p<g;++p){const f=p&1?c:l;h.kernel=d[p],h.inputBuffer=u.texture,n.setRenderTarget(f),n.render(o,a),u=f}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=u.texture,n.setRenderTarget(this.renderToScreen?null:i),n.render(o,a)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e);const s=i.width,r=i.height;this.renderTargetA.setSize(s,r),this.renderTargetB.setSize(s,r),this.blurMaterial.setSize(n,e)}initialize(n,e,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==Xi?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):n!==null&&n.outputColorSpace===ut&&(this.renderTargetA.texture.colorSpace=ut,this.renderTargetB.texture.colorSpace=ut))}static get AUTO_SIZE(){return un.AUTO_SIZE}},hIe=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l)*l;
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);
#else
gl_FragColor=vec4(l);
#endif
}`,dIe=class extends jt{constructor(n=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:fa.replace(/\D+/g,"")},uniforms:{inputBuffer:new Te(null),threshold:new Te(0),smoothing:new Te(1),range:new Te(null)},blending:Pn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:hIe,vertexShader:h0}),this.colorOutput=n,this.luminanceRange=e}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},J8=class extends Fr{constructor({renderTarget:n,luminanceRange:e,colorOutput:i,resolutionScale:s=1,width:r=un.AUTO_SIZE,height:o=un.AUTO_SIZE,resolutionX:a=r,resolutionY:l=o}={}){super("LuminancePass"),this.fullscreenMaterial=new dIe(i,e),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new fi(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const c=this.resolution=new un(this,a,l,s);c.addEventListener("change",h=>this.setSize(c.baseWidth,c.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,e,i,s,r){const o=this.fullscreenMaterial;o.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height)}initialize(n,e,i){i!==void 0&&i!==Xi&&(this.renderTarget.texture.type=i,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},uIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,pIe="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",mIe=class extends jt{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new Te(null),texelSize:new Te(new Q)},blending:Pn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:uIe,vertexShader:pIe})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},gIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,fIe="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",AIe=class extends jt{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new Te(null),supportBuffer:new Te(null),texelSize:new Te(new Q),radius:new Te(.85)},blending:Pn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:gIe,vertexShader:fIe})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},yIe=class extends Fr{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new fi(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new mIe,this.upsamplingMaterial=new AIe,this.resolution=new Q}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let i=0;i<n;++i){const s=e.clone();s.texture.name="Downsampling.Mipmap"+i,this.downsamplingMipmaps.push(s)}this.upsamplingMipmaps.push(e);for(let i=1,s=n-1;i<s;++i){const r=e.clone();r.texture.name="Upsampling.Mipmap"+i,this.upsamplingMipmaps.push(r)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,e,i,s,r){const{scene:o,camera:a}=this,{downsamplingMaterial:l,upsamplingMaterial:c}=this,{downsamplingMipmaps:h,upsamplingMipmaps:d}=this;let u=e;this.fullscreenMaterial=l;for(let p=0,g=h.length;p<g;++p){const f=h[p];l.setSize(u.width,u.height),l.inputBuffer=u.texture,n.setRenderTarget(f),n.render(o,a),u=f}this.fullscreenMaterial=c;for(let p=d.length-1;p>=0;--p){const g=d[p];c.setSize(u.width,u.height),c.inputBuffer=u.texture,c.supportBuffer=h[p].texture,n.setRenderTarget(g),n.render(o,a),u=g}}setSize(n,e){const i=this.resolution;i.set(n,e);let s=i.width,r=i.height;for(let o=0,a=this.downsamplingMipmaps.length;o<a;++o)s=Math.round(s*.5),r=Math.round(r*.5),this.downsamplingMipmaps[o].setSize(s,r),o<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[o].setSize(s,r)}initialize(n,e,i){if(i!==void 0){const s=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const r of s)r.texture.type=i;if(i!==Xi)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(n!==null&&n.outputColorSpace===ut)for(const r of s)r.texture.colorSpace=ut}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},Ia=class extends yr{constructor(n,e,{attributes:i=Bl.NONE,blendFunction:s=bi.NORMAL,defines:r=new Map,uniforms:o=new Map,extensions:a=null,vertexShader:l=null}={}){super(),this.name=n,this.renderer=null,this.attributes=i,this.fragmentShader=e,this.vertexShader=l,this.defines=r,this.uniforms=o,this.extensions=a,this.blendMode=new oIe(s),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=qi,this._outputColorSpace=ho}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,e=co){}update(n,e,i){}setSize(n,e){}initialize(n,e,i){}dispose(){for(const n of Object.keys(this)){const e=this[n];(e instanceof fi||e instanceof ti||e instanceof di||e instanceof Fr)&&this[n].dispose()}}},bIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,SD=class extends Ia{constructor({blendFunction:n=bi.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:i=.025,mipmapBlur:s=!1,intensity:r=1,radius:o=.85,levels:a=8,kernelSize:l=xd.LARGE,resolutionScale:c=.5,width:h=un.AUTO_SIZE,height:d=un.AUTO_SIZE,resolutionX:u=h,resolutionY:p=d}={}){super("BloomEffect",bIe,{blendFunction:n,uniforms:new Map([["map",new Te(null)],["intensity",new Te(r)]])}),this.renderTarget=new fi(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new CD({kernelSize:l}),this.luminancePass=new J8({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=i,this.mipmapBlurPass=new yIe,this.mipmapBlurPass.enabled=s,this.mipmapBlurPass.radius=o,this.mipmapBlurPass.levels=a,this.uniforms.get("map").value=s?this.mipmapBlurPass.texture:this.renderTarget.texture;const g=this.resolution=new un(this,u,p,c);g.addEventListener("change",f=>this.setSize(g.baseWidth,g.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,e,i){const s=this.renderTarget,r=this.luminancePass;r.enabled?(r.render(n,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,r.renderTarget):this.blurPass.render(n,r.renderTarget,s)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,e):this.blurPass.render(n,e,s)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i),this.luminancePass.setSize(n,e),this.mipmapBlurPass.setSize(n,e)}initialize(n,e,i){this.blurPass.initialize(n,e,i),this.luminancePass.initialize(n,e,i),this.mipmapBlurPass.initialize(n,e,i),i!==void 0&&(this.renderTarget.texture.type=i,n!==null&&n.outputColorSpace===ut&&(this.renderTarget.texture.colorSpace=ut))}},vIe="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(color+vec3(0.5),inputColor.a);}",q8=class extends Ia{constructor({blendFunction:n=bi.SRC,brightness:e=0,contrast:i=0}={}){super("BrightnessContrastEffect",vIe,{blendFunction:n,uniforms:new Map([["brightness",new Te(e)],["contrast",new Te(i)]])}),this.inputColorSpace=ut}get brightness(){return this.uniforms.get("brightness").value}set brightness(n){this.uniforms.get("brightness").value=n}getBrightness(){return this.brightness}setBrightness(n){this.brightness=n}get contrast(){return this.uniforms.get("contrast").value}set contrast(n){this.uniforms.get("contrast").value=n}getContrast(){return this.contrast}setContrast(n){this.contrast=n}},xIe=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,wIe="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",$8=class extends Ia{constructor({offset:n=new Q(.001,5e-4),radialModulation:e=!1,modulationOffset:i=.15}={}){super("ChromaticAberrationEffect",xIe,{vertexShader:wIe,attributes:Bl.CONVOLUTION,uniforms:new Map([["offset",new Te(n)],["modulationOffset",new Te(i)]])}),this.radialModulation=e}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(n){n?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(n){this.uniforms.get("modulationOffset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}},e7={RED:0,GREEN:1,BLUE:2,ALPHA:3},t7={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},CIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,eR=class extends jt{constructor(n=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:n?"2":"1"},uniforms:{inputBuffer:new Te(null),cocBuffer:new Te(null),texelSize:new Te(new Q),kernel64:new Te(null),kernel16:new Te(null),scale:new Te(1)},blending:Pn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:CIe,vertexShader:h0}),e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set cocBuffer(n){this.uniforms.cocBuffer.value=n}setCoCBuffer(n){this.uniforms.cocBuffer.value=n}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(n){return this.scale}setScale(n){this.scale=n}generateKernel(){const n=2.39996323,e=new Float64Array(128),i=new Float64Array(32);let s=0,r=0;for(let o=0,a=Math.sqrt(80);o<80;++o){const l=o*n,c=Math.sqrt(o)/a,h=c*Math.cos(l),d=c*Math.sin(l);o%5===0?(i[r++]=h,i[r++]=d):(e[s++]=h,e[s++]=d)}this.uniforms.kernel64.value=e,this.uniforms.kernel16.value=i}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}};function nb(n,e,i){return n*(e-i)-e}function d0(n,e,i){return Math.min(Math.max((n+e)/(e-i),0),1)}var SIe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#ifdef LOG_DEPTH
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,_Ie=class extends jt{constructor(n){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Te(null),focusDistance:new Te(0),focusRange:new Te(0),cameraNear:new Te(.3),cameraFar:new Te(1e3)},blending:Pn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:SIe,vertexShader:h0}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(n)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=co){this.depthBuffer=n,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(n){this.uniforms.focusDistance.value=n}get worldFocusDistance(){return-nb(this.focusDistance,this.near,this.far)}set worldFocusDistance(n){this.focusDistance=d0(-n,this.near,this.far)}getFocusDistance(n){this.uniforms.focusDistance.value=n}setFocusDistance(n){this.uniforms.focusDistance.value=n}get focalLength(){return this.focusRange}set focalLength(n){this.focusRange=n}get focusRange(){return this.uniforms.focusRange.value}set focusRange(n){this.uniforms.focusRange.value=n}get worldFocusRange(){return-nb(this.focusRange,this.near,this.far)}set worldFocusRange(n){this.focusRange=d0(-n,this.near,this.far)}getFocalLength(n){return this.focusRange}setFocalLength(n){this.focusRange=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof Ot?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},MIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,IIe=class extends jt{constructor(n=null){super({name:"MaskMaterial",uniforms:{maskTexture:new Te(n),inputBuffer:new Te(null),strength:new Te(1)},blending:Pn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:MIe,vertexShader:h0}),this.colorChannel=e7.RED,this.maskFunction=t7.DISCARD}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set maskTexture(n){this.uniforms.maskTexture.value=n,delete this.defines.MASK_PRECISION_HIGH,n.type!==Xi&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(n){this.maskTexture=n}set colorChannel(n){this.defines.COLOR_CHANNEL=n.toFixed(0),this.needsUpdate=!0}setColorChannel(n){this.colorChannel=n}set maskFunction(n){this.defines.MASK_FUNCTION=n.toFixed(0),this.needsUpdate=!0}setMaskFunction(n){this.maskFunction=n}get inverted(){return this.defines.INVERTED!==void 0}set inverted(n){this.inverted&&!n?delete this.defines.INVERTED:n&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get strength(){return this.uniforms.strength.value}set strength(n){this.uniforms.strength.value=n}getStrength(){return this.strength}setStrength(n){this.strength=n}},wd=class extends Fr{constructor(n,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=n,this.input=e}setInput(n){this.input=n}render(n,e,i,s,r){const o=this.fullscreenMaterial.uniforms;e!==null&&o!==void 0&&o[this.input]!==void 0&&(o[this.input].value=e.texture),n.setRenderTarget(this.renderToScreen?null:i),n.render(this.scene,this.camera)}initialize(n,e,i){i!==void 0&&i!==Xi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},TIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform lowp sampler2D farCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,i7=class extends Ia{constructor(n,{blendFunction:e,worldFocusDistance:i,worldFocusRange:s,focusDistance:r=0,focalLength:o=.1,focusRange:a=o,bokehScale:l=1,resolutionScale:c=1,width:h=un.AUTO_SIZE,height:d=un.AUTO_SIZE,resolutionX:u=h,resolutionY:p=d}={}){super("DepthOfFieldEffect",TIe,{blendFunction:e,attributes:Bl.DEPTH,uniforms:new Map([["nearColorBuffer",new Te(null)],["farColorBuffer",new Te(null)],["nearCoCBuffer",new Te(null)],["farCoCBuffer",new Te(null)],["scale",new Te(1)]])}),this.camera=n,this.renderTarget=new fi(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new wd(new _Ie(n));const g=this.cocMaterial;g.focusDistance=r,g.focusRange=a,i!==void 0&&(g.worldFocusDistance=i),s!==void 0&&(g.worldFocusRange=s),this.blurPass=new CD({resolutionScale:c,resolutionX:u,resolutionY:p,kernelSize:xd.MEDIUM}),this.maskPass=new wd(new IIe(this.renderTargetCoC.texture));const f=this.maskPass.fullscreenMaterial;f.colorChannel=e7.GREEN,this.maskFunction=t7.MULTIPLY_RGB,this.bokehNearBasePass=new wd(new eR(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new wd(new eR(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new wd(new eR(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new wd(new eR(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const A=this.resolution=new un(this,u,p,c);A.addEventListener("change",y=>this.setSize(A.baseWidth,A.baseHeight)),this.bokehScale=l}set mainCamera(n){this.camera=n,this.cocMaterial.copyCameraSettings(n)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(n){this.maskFunction!==n&&(this.defines.set("MASK_FUNCTION",n.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=n,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(n){this.bokehNearBasePass.fullscreenMaterial.scale=n,this.bokehNearFillPass.fullscreenMaterial.scale=n,this.bokehFarBasePass.fullscreenMaterial.scale=n,this.bokehFarFillPass.fullscreenMaterial.scale=n,this.maskPass.fullscreenMaterial.strength=n,this.uniforms.get("scale").value=n}getBokehScale(){return this.bokehScale}setBokehScale(n){this.bokehScale=n}getTarget(){return this.target}setTarget(n){this.target=n}calculateFocusDistance(n){const e=this.camera,i=e.position.distanceTo(n);return d0(-i,e.near,e.far)}setDepthTexture(n,e=co){this.cocMaterial.depthBuffer=n,this.cocMaterial.depthPacking=e}update(n,e,i){const s=this.renderTarget,r=this.renderTargetCoC,o=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){const l=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=l}this.cocPass.render(n,null,r),this.blurPass.render(n,r,o),this.maskPass.render(n,e,a),this.bokehFarBasePass.render(n,a,s),this.bokehFarFillPass.render(n,s,this.renderTargetFar),this.bokehNearBasePass.render(n,e,s),this.bokehNearFillPass.render(n,s,this.renderTargetNear)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e);const s=i.width,r=i.height;this.cocPass.setSize(n,e),this.blurPass.setSize(n,e),this.maskPass.setSize(n,e),this.renderTargetFar.setSize(n,e),this.renderTargetCoC.setSize(n,e),this.renderTargetMasked.setSize(n,e),this.renderTarget.setSize(s,r),this.renderTargetNear.setSize(s,r),this.renderTargetCoCBlurred.setSize(s,r),this.bokehNearBasePass.fullscreenMaterial.setSize(n,e),this.bokehNearFillPass.fullscreenMaterial.setSize(n,e),this.bokehFarBasePass.fullscreenMaterial.setSize(n,e),this.bokehFarFillPass.fullscreenMaterial.setSize(n,e)}initialize(n,e,i){this.cocPass.initialize(n,e,i),this.maskPass.initialize(n,e,i),this.bokehNearBasePass.initialize(n,e,i),this.bokehNearFillPass.initialize(n,e,i),this.bokehFarBasePass.initialize(n,e,i),this.bokehFarFillPass.initialize(n,e,i),this.blurPass.initialize(n,e,Xi),n.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,n!==null&&n.outputColorSpace===ut&&(this.renderTarget.texture.colorSpace=ut,this.renderTargetNear.texture.colorSpace=ut,this.renderTargetFar.texture.colorSpace=ut,this.renderTargetMasked.texture.colorSpace=ut))}};function EIe(n,e,i){const s=new Map([[Bx,1],[vl,1],[fc,2],[_i,4]]);let r;if(s.has(e)||console.error("Invalid noise texture format"),i===Xi){r=new Uint8Array(n*s.get(e));for(let o=0,a=r.length;o<a;++o)r[o]=Math.random()*255+.5}else{r=new Float32Array(n*s.get(e));for(let o=0,a=r.length;o<a;++o)r[o]=Math.random()}return r}var RIe=class extends nr{constructor(n,e,i=Bx,s=Xi){super(EIe(n*e,i,s),n,e,i,s),this.needsUpdate=!0}},Lw={DEFAULT:0,KEEP_MAX_DEPTH:1,DISCARD_MAX_DEPTH:2},LIe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer0;uniform highp sampler2D depthBuffer1;
#else
uniform mediump sampler2D depthBuffer0;uniform mediump sampler2D depthBuffer1;
#endif
uniform sampler2D inputBuffer;uniform vec2 cameraNearFar;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}varying vec2 vUv;void main(){vec2 depth;
#if DEPTH_PACKING_0 == 3201
depth.x=unpackRGBAToDepth(texture2D(depthBuffer0,vUv));
#else
depth.x=texture2D(depthBuffer0,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.x*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.x=a+b/d;
#endif
#endif
#if DEPTH_PACKING_1 == 3201
depth.y=unpackRGBAToDepth(texture2D(depthBuffer1,vUv));
#else
depth.y=texture2D(depthBuffer1,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.y*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.y=a+b/d;
#endif
#endif
bool isMaxDepth=(depth.x==1.0);
#ifdef PERSPECTIVE_CAMERA
depth.x=viewZToOrthographicDepth(getViewZ(depth.x),cameraNearFar.x,cameraNearFar.y);depth.y=viewZToOrthographicDepth(getViewZ(depth.y),cameraNearFar.x,cameraNearFar.y);
#endif
#if DEPTH_TEST_STRATEGY == 0
bool keep=depthTest(depth.x,depth.y);
#elif DEPTH_TEST_STRATEGY == 1
bool keep=isMaxDepth||depthTest(depth.x,depth.y);
#else
bool keep=!isMaxDepth&&depthTest(depth.x,depth.y);
#endif
if(keep){gl_FragColor=texture2D(inputBuffer,vUv);}else{discard;}}`,BIe=class extends jt{constructor(){super({name:"DepthMaskMaterial",defines:{DEPTH_EPSILON:"0.0001",DEPTH_PACKING_0:"0",DEPTH_PACKING_1:"0",DEPTH_TEST_STRATEGY:Lw.KEEP_MAX_DEPTH},uniforms:{inputBuffer:new Te(null),depthBuffer0:new Te(null),depthBuffer1:new Te(null),cameraNearFar:new Te(new Q(1,1))},blending:Pn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:LIe,vertexShader:h0}),this.depthMode=rf}set depthBuffer0(n){this.uniforms.depthBuffer0.value=n}set depthPacking0(n){this.defines.DEPTH_PACKING_0=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer0(n,e=co){this.depthBuffer0=n,this.depthPacking0=e}set depthBuffer1(n){this.uniforms.depthBuffer1.value=n}set depthPacking1(n){this.defines.DEPTH_PACKING_1=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer1(n,e=co){this.depthBuffer1=n,this.depthPacking1=e}get maxDepthStrategy(){return Number(this.defines.DEPTH_TEST_STRATEGY)}set maxDepthStrategy(n){this.defines.DEPTH_TEST_STRATEGY=n.toFixed(0),this.needsUpdate=!0}get keepFar(){return this.maxDepthStrategy}set keepFar(n){this.maxDepthStrategy=n?Lw.KEEP_MAX_DEPTH:Lw.DISCARD_MAX_DEPTH}getMaxDepthStrategy(){return this.maxDepthStrategy}setMaxDepthStrategy(n){this.maxDepthStrategy=n}get epsilon(){return Number(this.defines.DEPTH_EPSILON)}set epsilon(n){this.defines.DEPTH_EPSILON=n.toFixed(16),this.needsUpdate=!0}getEpsilon(){return this.epsilon}setEpsilon(n){this.epsilon=n}get depthMode(){return Number(this.defines.DEPTH_MODE)}set depthMode(n){let e;switch(n){case Ex:e="false";break;case UA:e="true";break;case Qp:e="abs(d1 - d0) <= DEPTH_EPSILON";break;case of:e="abs(d1 - d0) > DEPTH_EPSILON";break;case rf:e="d0 > d1";break;case yu:e="d0 >= d1";break;case OA:e="d0 <= d1";break;case ZA:default:e="d0 < d1";break}this.defines.DEPTH_MODE=n.toFixed(0),this.defines["depthTest(d0, d1)"]=e,this.needsUpdate=!0}getDepthMode(){return this.depthMode}setDepthMode(n){this.depthMode=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),n instanceof Ot?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},tR=class extends Fr{constructor(n,e,i=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new $E,this.overrideMaterialManager=i===null?null:new Y8(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new Y8(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,i,s,r){const o=this.scene,a=this.camera,l=this.selection,c=a.layers.mask,h=o.background,d=n.shadowMap.autoUpdate,u=this.renderToScreen?null:e;l!==null&&a.layers.set(l.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(o.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(u),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,o,a):n.render(o,a),a.layers.mask=c,o.background=h,n.shadowMap.autoUpdate=d}},kIe="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",n7=class extends Ia{constructor({blendFunction:n=bi.SRC,hue:e=0,saturation:i=0}={}){super("HueSaturationEffect",kIe,{blendFunction:n,uniforms:new Map([["hue",new Te(new E)],["saturation",new Te(i)]])}),this.hue=e}get saturation(){return this.uniforms.get("saturation").value}set saturation(n){this.uniforms.get("saturation").value=n}getSaturation(){return this.saturation}setSaturation(n){this.saturation=n}get hue(){const n=this.uniforms.get("hue").value;return Math.acos((n.x*3-1)/2)}set hue(n){const e=Math.sin(n),i=Math.cos(n);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3)}getHue(){return this.hue}setHue(n){this.hue=n}},_D={DEPTH:0,LUMA:1,COLOR:2},GIe={DISABLED:0,DEPTH:1,CUSTOM:2},u0={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},Sr={LINEAR:0,REINHARD:1,REINHARD2:2,REINHARD2_ADAPTIVE:3,UNCHARTED2:4,OPTIMIZED_CINEON:5,CINEON:5,ACES_FILMIC:6,AGX:7,NEUTRAL:8},Bw={DEFAULT:0,ESKIL:1},PIe=class extends Fr{constructor(n,e,{renderTarget:i,resolutionScale:s=1,width:r=un.AUTO_SIZE,height:o=un.AUTO_SIZE,resolutionX:a=r,resolutionY:l=o}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new tR(n,e,new n1({depthPacking:dI}));const c=this.renderPass;c.skipShadowMapUpdate=!0,c.ignoreBackground=!0;const h=c.clearPass;h.overrideClearColor=new fe(16777215),h.overrideClearAlpha=1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new fi(1,1,{minFilter:si,magFilter:si}),this.renderTarget.texture.name="DepthPass.Target");const d=this.resolution=new un(this,a,l,s);d.addEventListener("change",u=>this.setSize(d.baseWidth,d.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,i,s,r){const o=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,o)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height)}},NIe="uniform bool active;uniform vec4 d;void mainUv(inout vec2 uv){if(active){uv=d.xy*(floor(uv*d.zw)+0.5);}}",s7=class extends Ia{constructor(n=30){super("PixelationEffect",NIe,{uniforms:new Map([["active",new Te(!1)],["d",new Te(new $e)]])}),this.resolution=new Q,this._granularity=0,this.granularity=n}get granularity(){return this._granularity}set granularity(n){let e=Math.floor(n);e%2>0&&(e+=1),this._granularity=e,this.uniforms.get("active").value=e>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(n){this.granularity=n}setSize(n,e){const i=this.resolution;i.set(n,e);const s=this.granularity,r=s/i.x,o=s/i.y;this.uniforms.get("d").value.set(r,o,1/r,1/o)}},r7=class extends SD{constructor(n,e,i){super(i),this.setAttributes(this.getAttributes()|Bl.DEPTH),this.camera=e,this.depthPass=new PIe(n,e),this.clearPass=new $E(!0,!1,!1),this.clearPass.overrideClearColor=new fe(0),this.depthMaskPass=new wd(new BIe);const s=this.depthMaskMaterial;s.copyCameraSettings(e),s.depthBuffer1=this.depthPass.texture,s.depthPacking1=dI,s.depthMode=Qp,this.renderTargetMasked=new fi(1,1,{depthBuffer:!1}),this.renderTargetMasked.texture.name="Bloom.Masked",this.selection=new MMe,this._inverted=!1,this._ignoreBackground=!1}set mainScene(n){this.depthPass.mainScene=n}set mainCamera(n){this.camera=n,this.depthPass.mainCamera=n,this.depthMaskMaterial.copyCameraSettings(n)}getSelection(){return this.selection}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get inverted(){return this._inverted}set inverted(n){this._inverted=n,this.depthMaskMaterial.depthMode=n?of:Qp}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get ignoreBackground(){return this._ignoreBackground}set ignoreBackground(n){this._ignoreBackground=n,this.depthMaskMaterial.maxDepthStrategy=n?Lw.DISCARD_MAX_DEPTH:Lw.KEEP_MAX_DEPTH}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}setDepthTexture(n,e=co){this.depthMaskMaterial.depthBuffer0=n,this.depthMaskMaterial.depthPacking0=e}update(n,e,i){const s=this.camera,r=this.selection,o=this.inverted;let a=e;if(this.ignoreBackground||!o||r.size>0){const l=s.layers.mask;s.layers.set(r.layer),this.depthPass.render(n),s.layers.mask=l,a=this.renderTargetMasked,this.clearPass.render(n,a),this.depthMaskPass.render(n,e,a)}super.update(n,a,i)}setSize(n,e){super.setSize(n,e),this.renderTargetMasked.setSize(n,e),this.depthPass.setSize(n,e)}initialize(n,e,i){super.initialize(n,e,i),this.clearPass.initialize(n,e,i),this.depthPass.initialize(n,e,i),this.depthMaskPass.initialize(n,e,i),n!==null&&n.capabilities.logarithmicDepthBuffer&&(this.depthMaskPass.fullscreenMaterial.defines.LOG_DEPTH="1"),i!==void 0&&(this.renderTargetMasked.texture.type=i,n!==null&&n.outputColorSpace===ut&&(this.renderTargetMasked.texture.colorSpace=ut))}},VIe=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,XIe=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,DIe=class extends jt{constructor(n=new Q,e=_D.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:fa.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new Te(null),depthBuffer:new Te(null),predicationBuffer:new Te(null),texelSize:new Te(n)},blending:Pn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:VIe,vertexShader:XIe}),this.edgeDetectionMode=e}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=co){this.depthBuffer=n,this.depthPacking=e}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(n){this.defines.EDGE_DETECTION_MODE=n.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(n){this.edgeDetectionMode=n}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(n){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=n.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(n){this.localContrastAdaptationFactor=n}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(n){this.defines.EDGE_THRESHOLD=n.toFixed("6"),this.defines.DEPTH_THRESHOLD=(n*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(n){this.edgeDetectionThreshold=n}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(n){this.defines.PREDICATION_MODE=n.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(n){this.predicationMode=n}set predicationBuffer(n){this.uniforms.predicationBuffer.value=n}setPredicationBuffer(n){this.uniforms.predicationBuffer.value=n}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(n){this.defines.PREDICATION_THRESHOLD=n.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(n){this.predicationThreshold=n}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(n){this.defines.PREDICATION_SCALE=n.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(n){this.predicationScale=n}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(n){this.defines.PREDICATION_STRENGTH=n.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(n){this.predicationStrength=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},zIe=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,FIe="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",UIe=class extends jt{constructor(n=new Q,e=new Q){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new Te(null),searchTexture:new Te(null),areaTexture:new Te(null),resolution:new Te(e),texelSize:new Te(n)},blending:Pn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:zIe,vertexShader:FIe})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(n){this.uniforms.searchTexture.value=n}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(n){this.uniforms.areaTexture.value=n}setLookupTextures(n,e){this.searchTexture=n,this.areaTexture=e}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(n){const e=Math.min(Math.max(n,0),112);this.defines.MAX_SEARCH_STEPS_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(n){this.orthogonalSearchSteps=n}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(n){const e=Math.min(Math.max(n,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(n){this.diagonalSearchSteps=n}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(n){n?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(n){this.diagonalDetection=n}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(n){const e=Math.min(Math.max(n,0),100);this.defines.CORNER_ROUNDING=e.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(e/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(n){this.cornerRounding=n}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(n){n?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(n){this.cornerDetection=n}setSize(n,e){const i=this.uniforms;i.texelSize.value.set(1/n,1/e),i.resolution.value.set(n,e)}},o7="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",a7="data:image/png;base64,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",OIe="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",ZIe="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",l7=class extends Ia{constructor({blendFunction:n=bi.SRC,preset:e=u0.MEDIUM,edgeDetectionMode:i=_D.COLOR,predicationMode:s=GIe.DISABLED}={}){super("SMAAEffect",OIe,{vertexShader:ZIe,blendFunction:n,attributes:Bl.CONVOLUTION|Bl.DEPTH,uniforms:new Map([["weightMap",new Te(null)]])});let r,o;arguments.length>1&&(r=arguments[0],o=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(i=arguments[3])),this.renderTargetEdges=new fi(1,1,{depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new $E(!0,!1,!1),this.clearPass.overrideClearColor=new fe(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new wd(new DIe),this.edgeDetectionMaterial.edgeDetectionMode=i,this.edgeDetectionMaterial.predicationMode=s,this.weightsPass=new wd(new UIe);const a=new gT;a.onLoad=()=>{const l=new di(r);l.name="SMAA.Search",l.magFilter=si,l.minFilter=si,l.generateMipmaps=!1,l.needsUpdate=!0,l.flipY=!0,this.weightsMaterial.searchTexture=l;const c=new di(o);c.name="SMAA.Area",c.magFilter=Wt,c.minFilter=Wt,c.generateMipmaps=!1,c.needsUpdate=!0,c.flipY=!1,this.weightsMaterial.areaTexture=c,this.dispatchEvent({type:"load"})},a.itemStart("search"),a.itemStart("area"),r!==void 0&&o!==void 0?(a.itemEnd("search"),a.itemEnd("area")):typeof Image<"u"&&(r=new Image,o=new Image,r.addEventListener("load",()=>a.itemEnd("search")),o.addEventListener("load",()=>a.itemEnd("area")),r.src=o7,o.src=a7),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(n){this.edgeDetectionMaterial.edgeDetectionThreshold=n}setOrthogonalSearchSteps(n){this.weightsMaterial.orthogonalSearchSteps=n}applyPreset(n){const e=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(n){case u0.LOW:e.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case u0.MEDIUM:e.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case u0.HIGH:e.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case u0.ULTRA:e.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(n,e=co){this.edgeDetectionMaterial.depthBuffer=n,this.edgeDetectionMaterial.depthPacking=e}update(n,e,i){this.clearPass.render(n,this.renderTargetEdges),this.edgeDetectionPass.render(n,e,this.renderTargetEdges),this.weightsPass.render(n,this.renderTargetEdges,this.renderTargetWeights)}setSize(n,e){this.edgeDetectionMaterial.setSize(n,e),this.weightsMaterial.setSize(n,e),this.renderTargetEdges.setSize(n,e),this.renderTargetWeights.setSize(n,e)}dispose(){const{searchTexture:n,areaTexture:e}=this.weightsMaterial;n!==null&&e!==null&&(n.dispose(),e.dispose()),super.dispose()}static get searchImageDataURL(){return o7}static get areaImageDataURL(){return a7}},WIe=`#include <common>
#include <packing>
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}
#else
uniform lowp sampler2D normalBuffer;
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
uniform lowp sampler2D noiseTexture;uniform mat4 inverseProjectionMatrix;uniform mat4 projectionMatrix;uniform vec2 texelSize;uniform vec2 cameraNearFar;uniform float intensity;uniform float minRadiusScale;uniform float fade;uniform float bias;uniform vec2 distanceCutoff;uniform vec2 proximityCutoff;varying vec2 vUv;varying vec2 vUv2;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(inverseProjectionMatrix*clipPosition).xyz;}float getAmbientOcclusion(const in vec3 p,const in vec3 n,const in float depth,const in vec2 uv){float radiusScale=1.0-smoothstep(0.0,distanceCutoff.y,depth);radiusScale=radiusScale*(1.0-minRadiusScale)+minRadiusScale;float radius=RADIUS*radiusScale;float noise=texture2D(noiseTexture,vUv2).r;float baseAngle=noise*PI2;float rings=SPIRAL_TURNS*PI2;float occlusion=0.0;int taps=0;for(int i=0;i<SAMPLES_INT;++i){float alpha=(float(i)+0.5)*INV_SAMPLES_FLOAT;float angle=alpha*rings+baseAngle;vec2 rotation=vec2(cos(angle),sin(angle));vec2 coords=alpha*radius*rotation*texelSize+uv;if(coords.s<0.0||coords.s>1.0||coords.t<0.0||coords.t>1.0){continue;}float sampleDepth=readDepth(coords);float viewZ=getViewZ(sampleDepth);
#ifdef PERSPECTIVE_CAMERA
float linearSampleDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearSampleDepth=sampleDepth;
#endif
float proximity=abs(depth-linearSampleDepth);if(proximity<proximityCutoff.y){float falloff=1.0-smoothstep(proximityCutoff.x,proximityCutoff.y,proximity);vec3 Q=getViewPosition(coords,sampleDepth,viewZ);vec3 v=Q-p;float vv=dot(v,v);float vn=dot(v,n)-bias;float f=max(RADIUS_SQ-vv,0.0)/RADIUS_SQ;occlusion+=(f*f*f*max(vn/(fade+vv),0.0))*falloff;}++taps;}return occlusion/(4.0*max(float(taps),1.0));}void main(){
#ifdef NORMAL_DEPTH
vec4 normalDepth=texture2D(normalDepthBuffer,vUv);
#else
vec4 normalDepth=vec4(texture2D(normalBuffer,vUv).xyz,readDepth(vUv));
#endif
float ao=0.0;float depth=normalDepth.a;float viewZ=getViewZ(depth);
#ifdef PERSPECTIVE_CAMERA
float linearDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearDepth=depth;
#endif
if(linearDepth<distanceCutoff.y){vec3 viewPosition=getViewPosition(vUv,depth,viewZ);vec3 viewNormal=unpackRGBToNormal(normalDepth.rgb);ao+=getAmbientOcclusion(viewPosition,viewNormal,linearDepth,vUv);float d=smoothstep(distanceCutoff.x,distanceCutoff.y,linearDepth);ao=mix(ao,0.0,d);
#ifdef LEGACY_INTENSITY
ao=clamp(1.0-pow(1.0-ao,abs(intensity)),0.0,1.0);
#endif
}gl_FragColor.r=ao;}`,HIe="uniform vec2 noiseScale;varying vec2 vUv;varying vec2 vUv2;void main(){vUv=position.xy*0.5+0.5;vUv2=vUv*noiseScale;gl_Position=vec4(position.xy,1.0,1.0);}",QIe=class extends jt{constructor(n){super({name:"SSAOMaterial",defines:{SAMPLES_INT:"0",INV_SAMPLES_FLOAT:"0.0",SPIRAL_TURNS:"0.0",RADIUS:"1.0",RADIUS_SQ:"1.0",DISTANCE_SCALING:"1",DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Te(null),normalBuffer:new Te(null),normalDepthBuffer:new Te(null),noiseTexture:new Te(null),inverseProjectionMatrix:new Te(new de),projectionMatrix:new Te(new de),texelSize:new Te(new Q),cameraNearFar:new Te(new Q),distanceCutoff:new Te(new Q),proximityCutoff:new Te(new Q),noiseScale:new Te(new Q),minRadiusScale:new Te(.33),intensity:new Te(1),fade:new Te(.01),bias:new Te(0)},blending:Pn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:WIe,vertexShader:HIe}),this.copyCameraSettings(n),this.resolution=new Q,this.r=1}get near(){return this.uniforms.cameraNearFar.value.x}get far(){return this.uniforms.cameraNearFar.value.y}set normalDepthBuffer(n){this.uniforms.normalDepthBuffer.value=n,n!==null?this.defines.NORMAL_DEPTH="1":delete this.defines.NORMAL_DEPTH,this.needsUpdate=!0}setNormalDepthBuffer(n){this.normalDepthBuffer=n}set normalBuffer(n){this.uniforms.normalBuffer.value=n}setNormalBuffer(n){this.uniforms.normalBuffer.value=n}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=co){this.depthBuffer=n,this.depthPacking=e}set noiseTexture(n){this.uniforms.noiseTexture.value=n}setNoiseTexture(n){this.uniforms.noiseTexture.value=n}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(n){this.defines.SAMPLES_INT=n.toFixed(0),this.defines.INV_SAMPLES_FLOAT=(1/n).toFixed(9),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(n){this.samples=n}get rings(){return Number(this.defines.SPIRAL_TURNS)}set rings(n){this.defines.SPIRAL_TURNS=n.toFixed(1),this.needsUpdate=!0}getRings(){return this.rings}setRings(n){this.rings=n}get intensity(){return this.uniforms.intensity.value}set intensity(n){this.uniforms.intensity.value=n,this.defines.LEGACY_INTENSITY===void 0&&(this.defines.LEGACY_INTENSITY="1",this.needsUpdate=!0)}getIntensity(){return this.uniforms.intensity.value}setIntensity(n){this.uniforms.intensity.value=n}get fade(){return this.uniforms.fade.value}set fade(n){this.uniforms.fade.value=n}getFade(){return this.uniforms.fade.value}setFade(n){this.uniforms.fade.value=n}get bias(){return this.uniforms.bias.value}set bias(n){this.uniforms.bias.value=n}getBias(){return this.uniforms.bias.value}setBias(n){this.uniforms.bias.value=n}get minRadiusScale(){return this.uniforms.minRadiusScale.value}set minRadiusScale(n){this.uniforms.minRadiusScale.value=n}getMinRadiusScale(){return this.uniforms.minRadiusScale.value}setMinRadiusScale(n){this.uniforms.minRadiusScale.value=n}updateRadius(){const n=this.r*this.resolution.height;this.defines.RADIUS=n.toFixed(11),this.defines.RADIUS_SQ=(n*n).toFixed(11),this.needsUpdate=!0}get radius(){return this.r}set radius(n){this.r=Math.min(Math.max(n,1e-6),1),this.updateRadius()}getRadius(){return this.radius}setRadius(n){this.radius=n}get distanceScaling(){return!0}set distanceScaling(n){}isDistanceScalingEnabled(){return this.distanceScaling}setDistanceScalingEnabled(n){this.distanceScaling=n}get distanceThreshold(){return this.uniforms.distanceCutoff.value.x}set distanceThreshold(n){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.distanceFalloff,0),1))}get worldDistanceThreshold(){return-nb(this.distanceThreshold,this.near,this.far)}set worldDistanceThreshold(n){this.distanceThreshold=d0(-n,this.near,this.far)}get distanceFalloff(){return this.uniforms.distanceCutoff.value.y-this.distanceThreshold}set distanceFalloff(n){this.uniforms.distanceCutoff.value.y=Math.min(Math.max(this.distanceThreshold+n,0),1)}get worldDistanceFalloff(){return-nb(this.distanceFalloff,this.near,this.far)}set worldDistanceFalloff(n){this.distanceFalloff=d0(-n,this.near,this.far)}setDistanceCutoff(n,e){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+e,0),1))}get proximityThreshold(){return this.uniforms.proximityCutoff.value.x}set proximityThreshold(n){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.proximityFalloff,0),1))}get worldProximityThreshold(){return-nb(this.proximityThreshold,this.near,this.far)}set worldProximityThreshold(n){this.proximityThreshold=d0(-n,this.near,this.far)}get proximityFalloff(){return this.uniforms.proximityCutoff.value.y-this.proximityThreshold}set proximityFalloff(n){this.uniforms.proximityCutoff.value.y=Math.min(Math.max(this.proximityThreshold+n,0),1)}get worldProximityFalloff(){return-nb(this.proximityFalloff,this.near,this.far)}set worldProximityFalloff(n){this.proximityFalloff=d0(-n,this.near,this.far)}setProximityCutoff(n,e){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+e,0),1))}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),this.uniforms.projectionMatrix.value.copy(n.projectionMatrix),this.uniforms.inverseProjectionMatrix.value.copy(n.projectionMatrix).invert(),n instanceof Ot?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const i=this.uniforms,s=i.noiseTexture.value;s!==null&&i.noiseScale.value.set(n/s.image.width,e/s.image.height),i.texelSize.value.set(1/n,1/e),this.resolution.set(n,e),this.updateRadius()}},KIe=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,YIe="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",jIe=class extends jt{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Te(null),normalBuffer:new Te(null),texelSize:new Te(new Q)},blending:Pn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:KIe,vertexShader:YIe})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=co){this.depthBuffer=n,this.depthPacking=e}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},MD=class extends Fr{constructor({normalBuffer:n=null,resolutionScale:e=.5,width:i=un.AUTO_SIZE,height:s=un.AUTO_SIZE,resolutionX:r=i,resolutionY:o=s}={}){super("DepthDownsamplingPass");const a=new jIe;a.normalBuffer=n,this.fullscreenMaterial=a,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new fi(1,1,{minFilter:si,magFilter:si,depthBuffer:!1,type:en}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const l=this.resolution=new un(this,r,o,e);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,e=co){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e}render(n,e,i,s,r){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height),this.fullscreenMaterial.setSize(n,e)}initialize(n,e,i){const s=n.getContext();if(!(s.getExtension("EXT_color_buffer_float")||s.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},JIe=`uniform lowp sampler2D aoBuffer;uniform float luminanceInfluence;uniform float intensity;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH)
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
#endif
#ifdef COLORIZE
uniform vec3 color;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){float aoLinear=texture2D(aoBuffer,uv).r;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH) && __VERSION__ == 300
vec4 normalDepth[4];normalDepth[0]=textureOffset(normalDepthBuffer,uv,ivec2(0,0));normalDepth[1]=textureOffset(normalDepthBuffer,uv,ivec2(0,1));normalDepth[2]=textureOffset(normalDepthBuffer,uv,ivec2(1,0));normalDepth[3]=textureOffset(normalDepthBuffer,uv,ivec2(1,1));float dot01=dot(normalDepth[0].rgb,normalDepth[1].rgb);float dot02=dot(normalDepth[0].rgb,normalDepth[2].rgb);float dot03=dot(normalDepth[0].rgb,normalDepth[3].rgb);float minDot=min(dot01,min(dot02,dot03));float s=step(THRESHOLD,minDot);float smallestDistance=1.0;int index;for(int i=0;i<4;++i){float distance=abs(depth-normalDepth[i].a);if(distance<smallestDistance){smallestDistance=distance;index=i;}}ivec2 offsets[4];offsets[0]=ivec2(0,0);offsets[1]=ivec2(0,1);offsets[2]=ivec2(1,0);offsets[3]=ivec2(1,1);ivec2 coord=ivec2(uv*vec2(textureSize(aoBuffer,0)))+offsets[index];float aoNearest=texelFetch(aoBuffer,coord,0).r;float ao=mix(aoNearest,aoLinear,s);
#else
float ao=aoLinear;
#endif
float l=luminance(inputColor.rgb);ao=mix(ao,0.0,l*luminanceInfluence);ao=clamp(ao*intensity,0.0,1.0);
#ifdef COLORIZE
outputColor=vec4(1.0-ao*(1.0-color),inputColor.a);
#else
outputColor=vec4(vec3(1.0-ao),inputColor.a);
#endif
}`,c7=64,h7=class extends Ia{constructor(n,e,{blendFunction:i=bi.MULTIPLY,samples:s=9,rings:r=7,normalDepthBuffer:o=null,depthAwareUpsampling:a=!0,worldDistanceThreshold:l,worldDistanceFalloff:c,worldProximityThreshold:h,worldProximityFalloff:d,distanceThreshold:u=.97,distanceFalloff:p=.03,rangeThreshold:g=5e-4,rangeFalloff:f=.001,minRadiusScale:A=.1,luminanceInfluence:y=.7,radius:b=.1825,intensity:v=1,bias:x=.025,fade:w=.01,color:C=null,resolutionScale:S=1,width:_=un.AUTO_SIZE,height:I=un.AUTO_SIZE,resolutionX:B=_,resolutionY:M=I}={}){super("SSAOEffect",JIe,{blendFunction:i,attributes:Bl.DEPTH,defines:new Map([["THRESHOLD","0.997"]]),uniforms:new Map([["aoBuffer",new Te(null)],["normalDepthBuffer",new Te(o)],["luminanceInfluence",new Te(y)],["color",new Te(null)],["intensity",new Te(v)],["scale",new Te(0)]])}),this.renderTarget=new fi(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="AO.Target",this.uniforms.get("aoBuffer").value=this.renderTarget.texture;const R=this.resolution=new un(this,B,M,S);R.addEventListener("change",X=>this.setSize(R.baseWidth,R.baseHeight)),this.camera=n,this.depthDownsamplingPass=new MD({normalBuffer:e,resolutionScale:S}),this.depthDownsamplingPass.enabled=o===null,this.ssaoPass=new wd(new QIe(n));const k=new RIe(c7,c7,_i);k.wrapS=k.wrapT=lo;const G=this.ssaoMaterial;G.normalBuffer=e,G.noiseTexture=k,G.minRadiusScale=A,G.samples=s,G.radius=b,G.rings=r,G.fade=w,G.bias=x,G.distanceThreshold=u,G.distanceFalloff=p,G.proximityThreshold=g,G.proximityFalloff=f,l!==void 0&&(G.worldDistanceThreshold=l),c!==void 0&&(G.worldDistanceFalloff=c),h!==void 0&&(G.worldProximityThreshold=h),d!==void 0&&(G.worldProximityFalloff=d),o!==null&&(this.ssaoMaterial.normalDepthBuffer=o,this.defines.set("NORMAL_DEPTH","1")),this.depthAwareUpsampling=a,this.color=C}set mainCamera(n){this.camera=n,this.ssaoMaterial.copyCameraSettings(n)}get normalBuffer(){return this.ssaoMaterial.normalBuffer}set normalBuffer(n){this.ssaoMaterial.normalBuffer=n,this.depthDownsamplingPass.fullscreenMaterial.normalBuffer=n}getResolution(){return this.resolution}get ssaoMaterial(){return this.ssaoPass.fullscreenMaterial}getSSAOMaterial(){return this.ssaoMaterial}get samples(){return this.ssaoMaterial.samples}set samples(n){this.ssaoMaterial.samples=n}get rings(){return this.ssaoMaterial.rings}set rings(n){this.ssaoMaterial.rings=n}get radius(){return this.ssaoMaterial.radius}set radius(n){this.ssaoMaterial.radius=n}get depthAwareUpsampling(){return this.defines.has("DEPTH_AWARE_UPSAMPLING")}set depthAwareUpsampling(n){this.depthAwareUpsampling!==n&&(n?this.defines.set("DEPTH_AWARE_UPSAMPLING","1"):this.defines.delete("DEPTH_AWARE_UPSAMPLING"),this.setChanged())}isDepthAwareUpsamplingEnabled(){return this.depthAwareUpsampling}setDepthAwareUpsamplingEnabled(n){this.depthAwareUpsampling=n}get distanceScaling(){return!0}set distanceScaling(n){}get color(){return this.uniforms.get("color").value}set color(n){const e=this.uniforms,i=this.defines;n!==null?i.has("COLORIZE")?e.get("color").value.set(n):(i.set("COLORIZE","1"),e.get("color").value=new fe(n),this.setChanged()):i.has("COLORIZE")&&(i.delete("COLORIZE"),e.get("color").value=null,this.setChanged())}get luminanceInfluence(){return this.uniforms.get("luminanceInfluence").value}set luminanceInfluence(n){this.uniforms.get("luminanceInfluence").value=n}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getColor(){return this.color}setColor(n){this.color=n}setDistanceCutoff(n,e){this.ssaoMaterial.distanceThreshold=n,this.ssaoMaterial.distanceFalloff=e}setProximityCutoff(n,e){this.ssaoMaterial.proximityThreshold=n,this.ssaoMaterial.proximityFalloff=e}setDepthTexture(n,e=co){this.depthDownsamplingPass.setDepthTexture(n,e),this.ssaoMaterial.depthBuffer=n,this.ssaoMaterial.depthPacking=e}update(n,e,i){const s=this.renderTarget;this.depthDownsamplingPass.enabled&&this.depthDownsamplingPass.render(n),this.ssaoPass.render(n,null,s)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e);const s=i.width,r=i.height;this.ssaoMaterial.copyCameraSettings(this.camera),this.ssaoMaterial.setSize(s,r),this.renderTarget.setSize(s,r),this.depthDownsamplingPass.resolution.scale=i.scale,this.depthDownsamplingPass.setSize(n,e)}initialize(n,e,i){try{let s=this.uniforms.get("normalDepthBuffer").value;s===null&&(this.depthDownsamplingPass.initialize(n,e,i),s=this.depthDownsamplingPass.texture,this.uniforms.get("normalDepthBuffer").value=s,this.ssaoMaterial.normalDepthBuffer=s,this.defines.set("NORMAL_DEPTH","1"))}catch{this.depthDownsamplingPass.enabled=!1}}},qIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform vec4 maskParams;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;float linearGradientMask(const in float x){return smoothstep(maskParams.x,maskParams.y,x)-smoothstep(maskParams.w,maskParams.z,x);}void main(){vec2 dUv=vOffset*(1.0-linearGradientMask(vUv2.y));vec4 sum=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y-dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y-dUv.y));gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,$Ie="uniform vec4 texelSize;uniform float kernel;uniform float scale;uniform float aspect;uniform vec2 rotation;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;void main(){vec2 uv=position.xy*0.5+0.5;vUv=uv;vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));vOffset=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;gl_Position=vec4(position.xy,1.0,1.0);}",eTe=class extends j8{constructor({kernelSize:n=xd.MEDIUM,offset:e=0,rotation:i=0,focusArea:s=.4,feather:r=.3}={}){super(),this.fragmentShader=qIe,this.vertexShader=$Ie,this.kernelSize=n,this.uniforms.aspect=new Te(1),this.uniforms.rotation=new Te(new Q),this.uniforms.maskParams=new Te(new $e),this._offset=e,this._focusArea=s,this._feather=r,this.rotation=i,this.updateParams()}updateParams(){const n=this.uniforms.maskParams.value,e=Math.max(this.focusArea,0),i=Math.max(e-this.feather,0);n.set(this.offset-e,this.offset-i,this.offset+e,this.offset+i)}get rotation(){return Math.acos(this.uniforms.rotation.value.x)}set rotation(n){this.uniforms.rotation.value.set(Math.cos(n),Math.sin(n))}get offset(){return this._offset}set offset(n){this._offset=n,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(n){this._focusArea=n,this.updateParams()}get feather(){return this._feather}set feather(n){this._feather=n,this.updateParams()}setSize(n,e){super.setSize(n,e),this.uniforms.aspect.value=n/e}},tTe=class extends CD{constructor({offset:n=0,rotation:e=0,focusArea:i=.4,feather:s=.3,kernelSize:r=xd.MEDIUM,resolutionScale:o=.5,resolutionX:a=un.AUTO_SIZE,resolutionY:l=un.AUTO_SIZE}={}){super({kernelSize:r,resolutionScale:o,resolutionX:a,resolutionY:l}),this.blurMaterial=new eTe({kernelSize:r,offset:n,rotation:e,focusArea:i,feather:s})}},iTe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform vec2 maskParams;varying vec2 vUv2;float linearGradientMask(const in float x){return step(maskParams.x,x)-step(maskParams.y,x);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float mask=linearGradientMask(vUv2.y);vec4 texel=texture2D(map,uv);outputColor=mix(texel,inputColor,mask);}`,nTe="uniform vec2 rotation;varying vec2 vUv2;void mainSupport(const in vec2 uv){vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));}",d7=class extends Ia{constructor({blendFunction:n,offset:e=0,rotation:i=0,focusArea:s=.4,feather:r=.3,kernelSize:o=xd.MEDIUM,resolutionScale:a=.5,resolutionX:l=un.AUTO_SIZE,resolutionY:c=un.AUTO_SIZE}={}){super("TiltShiftEffect",iTe,{vertexShader:nTe,blendFunction:n,uniforms:new Map([["rotation",new Te(new Q)],["maskParams",new Te(new Q)],["map",new Te(null)]])}),this._offset=e,this._focusArea=s,this._feather=r,this.renderTarget=new fi(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="TiltShift.Target",this.uniforms.get("map").value=this.renderTarget.texture,this.blurPass=new tTe({kernelSize:o,resolutionScale:a,resolutionX:l,resolutionY:c,offset:e,rotation:i,focusArea:s,feather:r});const h=this.resolution=new un(this,l,c,a);h.addEventListener("change",d=>this.setSize(h.baseWidth,h.baseHeight)),this.rotation=i,this.updateParams()}updateParams(){const n=this.uniforms.get("maskParams").value,e=Math.max(this.focusArea-this.feather,0);n.set(this.offset-e,this.offset+e)}get rotation(){return Math.acos(this.uniforms.get("rotation").value.x)}set rotation(n){this.uniforms.get("rotation").value.set(Math.cos(n),Math.sin(n)),this.blurPass.blurMaterial.rotation=n}get offset(){return this._offset}set offset(n){this._offset=n,this.blurPass.blurMaterial.offset=n,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(n){this._focusArea=n,this.blurPass.blurMaterial.focusArea=n,this.updateParams()}get feather(){return this._feather}set feather(n){this._feather=n,this.blurPass.blurMaterial.feather=n,this.updateParams()}get bias(){return 0}set bias(n){}update(n,e,i){this.blurPass.render(n,e,this.renderTarget)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i)}initialize(n,e,i){this.blurPass.initialize(n,e,i),i!==void 0&&(this.renderTarget.texture.type=i,n!==null&&n.outputColorSpace===ut&&(this.renderTarget.texture.colorSpace=ut))}},sTe=`#include <packing>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
uniform lowp sampler2D luminanceBuffer0;uniform lowp sampler2D luminanceBuffer1;uniform float minLuminance;uniform float deltaTime;uniform float tau;varying vec2 vUv;void main(){float l0=unpackRGBAToFloat(texture2D(luminanceBuffer0,vUv));
#if __VERSION__ < 300
float l1=texture2DLodEXT(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#else
float l1=textureLod(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#endif
l0=max(minLuminance,l0);l1=max(minLuminance,l1);float adaptedLum=l0+(l1-l0)*(1.0-exp(-deltaTime*tau));gl_FragColor=(adaptedLum==1.0)?vec4(1.0):packFloatToRGBA(adaptedLum);}`,rTe=class extends jt{constructor(){super({name:"AdaptiveLuminanceMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{luminanceBuffer0:new Te(null),luminanceBuffer1:new Te(null),minLuminance:new Te(.01),deltaTime:new Te(0),tau:new Te(1)},extensions:{shaderTextureLOD:!0},blending:Pn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:sTe,vertexShader:h0})}set luminanceBuffer0(n){this.uniforms.luminanceBuffer0.value=n}setLuminanceBuffer0(n){this.uniforms.luminanceBuffer0.value=n}set luminanceBuffer1(n){this.uniforms.luminanceBuffer1.value=n}setLuminanceBuffer1(n){this.uniforms.luminanceBuffer1.value=n}set mipLevel1x1(n){this.defines.MIP_LEVEL_1X1=n.toFixed(1),this.needsUpdate=!0}setMipLevel1x1(n){this.mipLevel1x1=n}set deltaTime(n){this.uniforms.deltaTime.value=n}setDeltaTime(n){this.uniforms.deltaTime.value=n}get minLuminance(){return this.uniforms.minLuminance.value}set minLuminance(n){this.uniforms.minLuminance.value=n}getMinLuminance(){return this.uniforms.minLuminance.value}setMinLuminance(n){this.uniforms.minLuminance.value=n}get adaptationRate(){return this.uniforms.tau.value}set adaptationRate(n){this.uniforms.tau.value=n}getAdaptationRate(){return this.uniforms.tau.value}setAdaptationRate(n){this.uniforms.tau.value=n}},oTe=class extends Fr{constructor(n,{minLuminance:e=.01,adaptationRate:i=1}={}){super("AdaptiveLuminancePass"),this.fullscreenMaterial=new rTe,this.needsSwap=!1,this.renderTargetPrevious=new fi(1,1,{minFilter:si,magFilter:si,depthBuffer:!1}),this.renderTargetPrevious.texture.name="Luminance.Previous";const s=this.fullscreenMaterial;s.luminanceBuffer0=this.renderTargetPrevious.texture,s.luminanceBuffer1=n,s.minLuminance=e,s.adaptationRate=i,this.renderTargetAdapted=this.renderTargetPrevious.clone(),this.renderTargetAdapted.texture.name="Luminance.Adapted",this.copyPass=new Q8(this.renderTargetPrevious,!1)}get texture(){return this.renderTargetAdapted.texture}getTexture(){return this.renderTargetAdapted.texture}set mipLevel1x1(n){this.fullscreenMaterial.mipLevel1x1=n}get adaptationRate(){return this.fullscreenMaterial.adaptationRate}set adaptationRate(n){this.fullscreenMaterial.adaptationRate=n}render(n,e,i,s,r){this.fullscreenMaterial.deltaTime=s,n.setRenderTarget(this.renderToScreen?null:this.renderTargetAdapted),n.render(this.scene,this.camera),this.copyPass.render(n,this.renderTargetAdapted)}},aTe=`#include <tonemapping_pars_fragment>
uniform float whitePoint;
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
uniform float middleGrey;
#if TONE_MAPPING_MODE == 3
uniform lowp sampler2D luminanceBuffer;
#else
uniform float averageLuminance;
#endif
vec3 Reinhard2ToneMapping(vec3 color){color*=toneMappingExposure;float l=luminance(color);
#if TONE_MAPPING_MODE == 3
float lumAvg=unpackRGBAToFloat(texture2D(luminanceBuffer,vec2(0.5)));
#else
float lumAvg=averageLuminance;
#endif
float lumScaled=(l*middleGrey)/max(lumAvg,1e-6);float lumCompressed=lumScaled*(1.0+lumScaled/(whitePoint*whitePoint));lumCompressed/=(1.0+lumScaled);return clamp(lumCompressed*color,0.0,1.0);}
#elif TONE_MAPPING_MODE == 4
#define A 0.15
#define B 0.50
#define C 0.10
#define D 0.20
#define E 0.02
#define F 0.30
vec3 Uncharted2Helper(const in vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return clamp(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitePoint)),0.0,1.0);}
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
outputColor=vec4(Reinhard2ToneMapping(inputColor.rgb),inputColor.a);
#elif TONE_MAPPING_MODE == 4
outputColor=vec4(Uncharted2ToneMapping(inputColor.rgb),inputColor.a);
#else
outputColor=vec4(toneMapping(inputColor.rgb),inputColor.a);
#endif
}`,iR=class extends Ia{constructor({blendFunction:n=bi.SRC,adaptive:e=!1,mode:i=e?Sr.REINHARD2_ADAPTIVE:Sr.AGX,resolution:s=256,maxLuminance:r=4,whitePoint:o=r,middleGrey:a=.6,minLuminance:l=.01,averageLuminance:c=1,adaptationRate:h=1}={}){super("ToneMappingEffect",aTe,{blendFunction:n,uniforms:new Map([["luminanceBuffer",new Te(null)],["maxLuminance",new Te(r)],["whitePoint",new Te(o)],["middleGrey",new Te(a)],["averageLuminance",new Te(c)]])}),this.renderTargetLuminance=new fi(1,1,{minFilter:Ar,depthBuffer:!1}),this.renderTargetLuminance.texture.generateMipmaps=!0,this.renderTargetLuminance.texture.name="Luminance",this.luminancePass=new J8({renderTarget:this.renderTargetLuminance}),this.adaptiveLuminancePass=new oTe(this.luminancePass.texture,{minLuminance:l,adaptationRate:h}),this.uniforms.get("luminanceBuffer").value=this.adaptiveLuminancePass.texture,this.resolution=s,this.mode=i}get mode(){return Number(this.defines.get("TONE_MAPPING_MODE"))}set mode(n){if(this.mode===n)return;const e=fa.replace(/\D+/g,"")>=168?"CineonToneMapping(texel)":"OptimizedCineonToneMapping(texel)";switch(this.defines.clear(),this.defines.set("TONE_MAPPING_MODE",n.toFixed(0)),n){case Sr.LINEAR:this.defines.set("toneMapping(texel)","LinearToneMapping(texel)");break;case Sr.REINHARD:this.defines.set("toneMapping(texel)","ReinhardToneMapping(texel)");break;case Sr.CINEON:case Sr.OPTIMIZED_CINEON:this.defines.set("toneMapping(texel)",e);break;case Sr.ACES_FILMIC:this.defines.set("toneMapping(texel)","ACESFilmicToneMapping(texel)");break;case Sr.AGX:this.defines.set("toneMapping(texel)","AgXToneMapping(texel)");break;case Sr.NEUTRAL:this.defines.set("toneMapping(texel)","NeutralToneMapping(texel)");break;default:this.defines.set("toneMapping(texel)","texel");break}this.adaptiveLuminancePass.enabled=n===Sr.REINHARD2_ADAPTIVE,this.setChanged()}getMode(){return this.mode}setMode(n){this.mode=n}get whitePoint(){return this.uniforms.get("whitePoint").value}set whitePoint(n){this.uniforms.get("whitePoint").value=n}get middleGrey(){return this.uniforms.get("middleGrey").value}set middleGrey(n){this.uniforms.get("middleGrey").value=n}get averageLuminance(){return this.uniforms.get("averageLuminance").value}set averageLuminance(n){this.uniforms.get("averageLuminance").value=n}get adaptiveLuminanceMaterial(){return this.adaptiveLuminancePass.fullscreenMaterial}getAdaptiveLuminanceMaterial(){return this.adaptiveLuminanceMaterial}get resolution(){return this.luminancePass.resolution.width}set resolution(n){const e=Math.max(0,Math.ceil(Math.log2(n))),i=Math.pow(2,e);this.luminancePass.resolution.setPreferredSize(i,i),this.adaptiveLuminanceMaterial.mipLevel1x1=e}getResolution(){return this.resolution}setResolution(n){this.resolution=n}get adaptive(){return this.mode===Sr.REINHARD2_ADAPTIVE}set adaptive(n){this.mode=n?Sr.REINHARD2_ADAPTIVE:Sr.REINHARD2}get adaptationRate(){return this.adaptiveLuminanceMaterial.adaptationRate}set adaptationRate(n){this.adaptiveLuminanceMaterial.adaptationRate=n}get distinction(){return console.warn(this.name,"distinction was removed."),1}set distinction(n){console.warn(this.name,"distinction was removed.")}update(n,e,i){this.adaptiveLuminancePass.enabled&&(this.luminancePass.render(n,e),this.adaptiveLuminancePass.render(n,null,null,i))}initialize(n,e,i){this.adaptiveLuminancePass.initialize(n,e,i)}},lTe=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,u7=class extends Ia{constructor({blendFunction:n,eskil:e=!1,technique:i=e?Bw.ESKIL:Bw.DEFAULT,offset:s=.5,darkness:r=.5}={}){super("VignetteEffect",lTe,{blendFunction:n,defines:new Map([["VIGNETTE_TECHNIQUE",i.toFixed(0)]]),uniforms:new Map([["offset",new Te(s)],["darkness",new Te(r)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(n){this.technique!==n&&(this.defines.set("VIGNETTE_TECHNIQUE",n.toFixed(0)),this.setChanged())}get eskil(){return this.technique===Bw.ESKIL}set eskil(n){this.technique=n?Bw.ESKIL:Bw.DEFAULT}getTechnique(){return this.technique}setTechnique(n){this.technique=n}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}get darkness(){return this.uniforms.get("darkness").value}set darkness(n){this.uniforms.get("darkness").value=n}getDarkness(){return this.darkness}setDarkness(n){this.darkness=n}},cTe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,hTe="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",dTe=class extends jt{constructor(n,e,i,s,r=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:fa.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Te(null),depthBuffer:new Te(null),resolution:new Te(new Q),texelSize:new Te(new Q),cameraNear:new Te(.3),cameraFar:new Te(1e3),aspect:new Te(1),time:new Te(0)},blending:Pn,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:r}),n&&this.setShaderParts(n),e&&this.setDefines(e),i&&this.setUniforms(i),this.copyCameraSettings(s)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=co){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=cTe.replace(sn.FRAGMENT_HEAD,n.get(sn.FRAGMENT_HEAD)||"").replace(sn.FRAGMENT_MAIN_UV,n.get(sn.FRAGMENT_MAIN_UV)||"").replace(sn.FRAGMENT_MAIN_IMAGE,n.get(sn.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=hTe.replace(sn.VERTEX_HEAD,n.get(sn.VERTEX_HEAD)||"").replace(sn.VERTEX_MAIN_SUPPORT,n.get(sn.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof Ot?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const i=this.uniforms;i.resolution.value.set(n,e),i.texelSize.value.set(1/n,1/e),i.aspect.value=n/e}static get Section(){return sn}};function p7(n,e,i){for(const s of e){const r="$1"+n+s.charAt(0).toUpperCase()+s.slice(1),o=new RegExp("([^\\.])(\\b"+s+"\\b)","g");for(const a of i.entries())a[1]!==null&&i.set(a[0],a[1].replace(o,r))}}function uTe(n,e,i){let s=e.getFragmentShader(),r=e.getVertexShader();const o=s!==void 0&&/mainImage/.test(s),a=s!==void 0&&/mainUv/.test(s);if(i.attributes|=e.getAttributes(),s===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(a&&i.attributes&Bl.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!o&&!a)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const l=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=i.shaderParts;let h=c.get(sn.FRAGMENT_HEAD)||"",d=c.get(sn.FRAGMENT_MAIN_UV)||"",u=c.get(sn.FRAGMENT_MAIN_IMAGE)||"",p=c.get(sn.VERTEX_HEAD)||"",g=c.get(sn.VERTEX_MAIN_SUPPORT)||"";const f=new Set,A=new Set;if(a&&(d+=`	${n}MainUv(UV);
`,i.uvTransformation=!0),r!==null&&/mainSupport/.test(r)){const v=/mainSupport *\([\w\s]*?uv\s*?\)/.test(r);g+=`	${n}MainSupport(`,g+=v?`vUv);
`:`);
`;for(const x of r.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const w of x[1].split(/\s*,\s*/))i.varyings.add(w),f.add(w),A.add(w);for(const x of r.matchAll(l))A.add(x[1])}for(const v of s.matchAll(l))A.add(v[1]);for(const v of e.defines.keys())A.add(v.replace(/\([\w\s,]*\)/g,""));for(const v of e.uniforms.keys())A.add(v);A.delete("while"),A.delete("for"),A.delete("if"),e.uniforms.forEach((v,x)=>i.uniforms.set(n+x.charAt(0).toUpperCase()+x.slice(1),v)),e.defines.forEach((v,x)=>i.defines.set(n+x.charAt(0).toUpperCase()+x.slice(1),v));const y=new Map([["fragment",s],["vertex",r]]);p7(n,A,i.defines),p7(n,A,y),s=y.get("fragment"),r=y.get("vertex");const b=e.blendMode;if(i.blendModes.set(b.blendFunction,b),o){e.inputColorSpace!==null&&e.inputColorSpace!==i.colorSpace&&(u+=e.inputColorSpace===ut?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==ho?i.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(i.colorSpace=e.inputColorSpace);const v=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;u+=`${n}MainImage(color0, UV, `,i.attributes&Bl.DEPTH&&v.test(s)&&(u+="depth, ",i.readDepth=!0),u+=`color1);
	`;const x=n+"BlendOpacity";i.uniforms.set(x,b.opacity),u+=`color0 = blend${b.blendFunction}(color0, color1, ${x});

	`,h+=`uniform float ${x};

`}if(h+=s+`
`,r!==null&&(p+=r+`
`),c.set(sn.FRAGMENT_HEAD,h),c.set(sn.FRAGMENT_MAIN_UV,d),c.set(sn.FRAGMENT_MAIN_IMAGE,u),c.set(sn.VERTEX_HEAD,p),c.set(sn.VERTEX_MAIN_SUPPORT,g),e.extensions!==null)for(const v of e.extensions)i.extensions.add(v)}}var m7=class extends Fr{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new dTe(null,null,null,n),this.listener=i=>this.handleEvent(i),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,i)=>i.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new SMe;let e=0;for(const a of this.effects)if(a.blendMode.blendFunction===bi.DST)n.attributes|=a.getAttributes()&Bl.DEPTH;else{if(n.attributes&a.getAttributes()&Bl.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${a.name})`);uTe("e"+e++,a,n)}let i=n.shaderParts.get(sn.FRAGMENT_HEAD),s=n.shaderParts.get(sn.FRAGMENT_MAIN_IMAGE),r=n.shaderParts.get(sn.FRAGMENT_MAIN_UV);const o=/\bblend\b/g;for(const a of n.blendModes.values())i+=a.getShaderCode().replace(o,`blend${a.blendFunction}`)+`
`;n.attributes&Bl.DEPTH?(n.readDepth&&(s=`float depth = readDepth(UV);

	`+s),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===ut&&(s+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(r=`vec2 transformedUv = vUv;
`+r,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(sn.FRAGMENT_HEAD,i),n.shaderParts.set(sn.FRAGMENT_MAIN_IMAGE,s),n.shaderParts.set(sn.FRAGMENT_MAIN_UV,r);for(const[a,l]of n.shaderParts)l!==null&&n.shaderParts.set(a,l.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=co){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const i of this.effects)i.setDepthTexture(n,e)}render(n,e,i,s,r){for(const o of this.effects)o.update(n,e,s);if(!this.skipRendering||this.renderToScreen){const o=this.fullscreenMaterial;o.inputBuffer=e.texture,o.time+=s*this.timeScale,n.setRenderTarget(this.renderToScreen?null:i),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const i of this.effects)i.setSize(n,e)}initialize(n,e,i){this.renderer=n;for(const s of this.effects)s.initialize(n,e,i);this.updateMaterial(),i!==void 0&&i!==Xi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}},g7=class extends Fr{constructor(n,e,{renderTarget:i,resolutionScale:s=1,width:r=un.AUTO_SIZE,height:o=un.AUTO_SIZE,resolutionX:a=r,resolutionY:l=o}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new tR(n,e,new x1);const c=this.renderPass;c.ignoreBackground=!0,c.skipShadowMapUpdate=!0;const h=c.getClearPass();h.overrideClearColor=new fe(7829503),h.overrideClearAlpha=1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new fi(1,1,{minFilter:si,magFilter:si}),this.renderTarget.texture.name="NormalPass.Target");const d=this.resolution=new un(this,a,l,s);d.addEventListener("change",u=>this.setSize(d.baseWidth,d.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,i,s,r){const o=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,o,o)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height)}},kw=function(){var n=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(d){d.preventDefault(),s(++n%e.children.length)},!1);function i(d){return e.appendChild(d.dom),d}function s(d){for(var u=0;u<e.children.length;u++)e.children[u].style.display=u===d?"block":"none";n=d}var r=(performance||Date).now(),o=r,a=0,l=i(new kw.Panel("FPS","#0ff","#002")),c=i(new kw.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=i(new kw.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:e,addPanel:i,showPanel:s,begin:function(){r=(performance||Date).now()},end:function(){a++;var d=(performance||Date).now();if(c.update(d-r,200),d>=o+1e3&&(l.update(a*1e3/(d-o),100),o=d,a=0,h)){var u=performance.memory;h.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return d},update:function(){r=this.end()},domElement:e,setMode:s}};kw.Panel=function(n,e,i){var s=1/0,r=0,o=Math.round,a=o(window.devicePixelRatio||1),l=80*a,c=48*a,h=3*a,d=2*a,u=3*a,p=15*a,g=74*a,f=30*a,A=document.createElement("canvas");A.width=l,A.height=c,A.style.cssText="width:80px;height:48px";var y=A.getContext("2d");return y.font="bold "+9*a+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=i,y.fillRect(0,0,l,c),y.fillStyle=e,y.fillText(n,h,d),y.fillRect(u,p,g,f),y.fillStyle=i,y.globalAlpha=.9,y.fillRect(u,p,g,f),{dom:A,update:function(b,v){s=Math.min(s,b),r=Math.max(r,b),y.fillStyle=i,y.globalAlpha=1,y.fillRect(0,0,l,p),y.fillStyle=e,y.fillText(o(b)+" "+n+" ("+o(s)+"-"+o(r)+")",h,d),y.drawImage(A,u+a,p,g-a,f,u,p,g-a,f),y.fillRect(u+g-a,p,a,f),y.fillStyle=i,y.globalAlpha=.9,y.fillRect(u+g-a,p,a,o((1-b/v)*f))}}};const pTe=kw,f7=new xj;f7.camera=new Ot,Wn.basic,Wn.basic,Wn.points,Wn.standard,Wn.physical,Wn.phong;const mTe=q("debugpatch");function nR(n,e,i,s){const r=mTe===e;if(!i&&!s)return;const o=e+"___needle";fTe(n,e,i,s);const a=Object.getOwnPropertyDescriptor(n,e),l=n[e];r&&console.log("Patch",n.constructor.name,e,a,l),a?(r&&console.log("Apply patch with existing descriptor",n.constructor.name,e,a),typeof a.value=="function"&&(n[e]=y7(a.value,n,e))):(r&&console.log("Create patch with new property",n.constructor.name,e,a),Object.defineProperty(n,e,{set:function(c){if(typeof c=="function")this[o]=y7(c,n,e);else{const h=this[o];b7(n,e,this,h,c),this[o]=c,v7(n,e,this,h,c)}},get:function(){const c=this[o];return typeof c=="function"&&c[o]?c[o]:c}}))}function gTe(n,e,i){const s=TD(n,e);if(s)for(let r=s.length-1;r>=0;r--){const o=s[r];o.prefix===i&&(o.prefix=null),o.postfix===i&&(o.postfix=null),!o.prefix&&!o.postfix&&s.splice(r,1)}}const A7=Symbol("Needle:Patches:WrappedFunction");function y7(n,e,i){if(n[A7])return n;const s=function(...r){b7(e,i,this,...r);const o=n.apply(this,r);return v7(e,i,this,o,...r),o};return s[A7]=!0,s}const sR="Needle:Patches";function ID(){return globalThis[sR]||(globalThis[sR]=new WeakMap),globalThis[sR]}function TD(n,e){const i=ID().get(n);return i?i.get(e):null}function fTe(n,e,i,s){let r=ID().get(n);r||(r=new Map,ID().set(n,r));let o=r.get(e);o||(o=[],r.set(e,o)),o.push({prefix:i,postfix:s})}function b7(n,e,i,...s){var r;if(!i)return;const o=TD(n,e);if(o)for(const a of o)(r=a.prefix)==null||r.call(i,...s)}function v7(n,e,i,s,...r){var o;if(!i)return;const a=TD(n,e);if(a)for(const l of a)(o=l.postfix)==null||o.call(i,s,...r)}const x7="";globalThis.GLTF_PROGRESSIVE_VERSION=x7,console.debug(`[gltf-progressive] version ${x7}`);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const w7="172",rR=0,ATe=1,yTe=2,C7=1,S7=100,_7=204,M7=205,I7=3,bTe=0,T7="attached",vTe="detached",E7=300,xTe=301,Gw=1e3,p0=1001,ED=1002,sb=1003,wTe=1004,CTe=1005,Tm=1006,STe=1007,Pw=1008,Cd=1009,Em=1015,rb=1016,Rm=1023,ob=1028,Nw=1030,_Te=33777,MTe=33779,ITe=35840,TTe=35842,ETe=36196,RTe=37492,LTe=37496,R7=37808,L7=37812,BTe=36492,kTe=36495,Vw=2300,Xw=2301,RD=2302,B7=2400,k7=2401,G7=2402,GTe=2500,PTe=0,P7=1,LD=2,NTe=0,BD="",ar="srgb",kl="srgb-linear",N7="linear",kD="srgb",ab=7680,V7=519,GD=35044,m0=2e3,PD=2001;class oR{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(i)===-1&&s[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const r=s.indexOf(i);r!==-1&&s.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let r=0,o=s.length;r<o;r++)s[r].call(this,e);e.target=null}}}const $o=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let X7=1234567;const Dw=Math.PI/180,zw=180/Math.PI;function wh(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return($o[n&255]+$o[n>>8&255]+$o[n>>16&255]+$o[n>>24&255]+"-"+$o[e&255]+$o[e>>8&255]+"-"+$o[e>>16&15|64]+$o[e>>24&255]+"-"+$o[i&63|128]+$o[i>>8&255]+"-"+$o[i>>16&255]+$o[i>>24&255]+$o[s&255]+$o[s>>8&255]+$o[s>>16&255]+$o[s>>24&255]).toLowerCase()}function ki(n,e,i){return Math.max(e,Math.min(i,n))}function ND(n,e){return(n%e+e)%e}function VTe(n,e,i,s,r){return s+(n-e)*(r-s)/(i-e)}function XTe(n,e,i){return n!==e?(i-n)/(e-n):0}function Fw(n,e,i){return(1-i)*n+i*e}function DTe(n,e,i,s){return Fw(n,e,1-Math.exp(-i*s))}function zTe(n,e=1){return e-Math.abs(ND(n,e*2)-e)}function FTe(n,e,i){return n<=e?0:n>=i?1:(n=(n-e)/(i-e),n*n*(3-2*n))}function UTe(n,e,i){return n<=e?0:n>=i?1:(n=(n-e)/(i-e),n*n*n*(n*(n*6-15)+10))}function OTe(n,e){return n+Math.floor(Math.random()*(e-n+1))}function ZTe(n,e){return n+Math.random()*(e-n)}function WTe(n){return n*(.5-Math.random())}function HTe(n){n!==void 0&&(X7=n);let e=X7+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function QTe(n){return n*Dw}function KTe(n){return n*zw}function YTe(n){return(n&n-1)===0&&n!==0}function jTe(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function JTe(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function qTe(n,e,i,s,r){const o=Math.cos,a=Math.sin,l=o(i/2),c=a(i/2),h=o((e+s)/2),d=a((e+s)/2),u=o((e-s)/2),p=a((e-s)/2),g=o((s-e)/2),f=a((s-e)/2);switch(r){case"XYX":n.set(l*d,c*u,c*p,l*h);break;case"YZY":n.set(c*p,l*d,c*u,l*h);break;case"ZXZ":n.set(c*u,c*p,l*d,l*h);break;case"XZX":n.set(l*d,c*f,c*g,l*h);break;case"YXY":n.set(c*g,l*d,c*f,l*h);break;case"ZYZ":n.set(c*f,c*g,l*d,l*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function Ch(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function yn(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const $Te={DEG2RAD:Dw,RAD2DEG:zw,generateUUID:wh,clamp:ki,euclideanModulo:ND,mapLinear:VTe,inverseLerp:XTe,lerp:Fw,damp:DTe,pingpong:zTe,smoothstep:FTe,smootherstep:UTe,randInt:OTe,randFloat:ZTe,randFloatSpread:WTe,seededRandom:HTe,degToRad:QTe,radToDeg:KTe,isPowerOfTwo:YTe,ceilPowerOfTwo:jTe,floorPowerOfTwo:JTe,setQuaternionFromProperEuler:qTe,normalize:yn,denormalize:Ch};let Ur=class ice{constructor(e=0,i=0){ice.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,s=this.y,r=e.elements;return this.x=r[0]*i+r[3]*s+r[6],this.y=r[1]*i+r[4]*s+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=ki(this.x,e.x,i.x),this.y=ki(this.y,e.y,i.y),this}clampScalar(e,i){return this.x=ki(this.x,e,i),this.y=ki(this.y,e,i),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(ki(s,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const s=this.dot(e)/i;return Math.acos(ki(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y;return i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const s=Math.cos(i),r=Math.sin(i),o=this.x-e.x,a=this.y-e.y;return this.x=o*s-a*r+e.x,this.y=o*r+a*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},g0=class nce{constructor(e,i,s,r,o,a,l,c,h){nce.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,s,r,o,a,l,c,h)}set(e,i,s,r,o,a,l,c,h){const d=this.elements;return d[0]=e,d[1]=r,d[2]=l,d[3]=i,d[4]=o,d[5]=c,d[6]=s,d[7]=a,d[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],this}extractBasis(e,i,s){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,r=i.elements,o=this.elements,a=s[0],l=s[3],c=s[6],h=s[1],d=s[4],u=s[7],p=s[2],g=s[5],f=s[8],A=r[0],y=r[3],b=r[6],v=r[1],x=r[4],w=r[7],C=r[2],S=r[5],_=r[8];return o[0]=a*A+l*v+c*C,o[3]=a*y+l*x+c*S,o[6]=a*b+l*w+c*_,o[1]=h*A+d*v+u*C,o[4]=h*y+d*x+u*S,o[7]=h*b+d*w+u*_,o[2]=p*A+g*v+f*C,o[5]=p*y+g*x+f*S,o[8]=p*b+g*w+f*_,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8];return i*a*d-i*l*h-s*o*d+s*l*c+r*o*h-r*a*c}invert(){const e=this.elements,i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],u=d*a-l*h,p=l*c-d*o,g=h*o-a*c,f=i*u+s*p+r*g;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const A=1/f;return e[0]=u*A,e[1]=(r*h-d*s)*A,e[2]=(l*s-r*a)*A,e[3]=p*A,e[4]=(d*i-r*c)*A,e[5]=(r*o-l*i)*A,e[6]=g*A,e[7]=(s*c-h*i)*A,e[8]=(a*i-s*o)*A,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,s,r,o,a,l){const c=Math.cos(o),h=Math.sin(o);return this.set(s*c,s*h,-s*(c*a+h*l)+a+e,-r*h,r*c,-r*(-h*a+c*l)+l+i,0,0,1),this}scale(e,i){return this.premultiply(VD.makeScale(e,i)),this}rotate(e){return this.premultiply(VD.makeRotation(-e)),this}translate(e,i){return this.premultiply(VD.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,-s,0,s,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,s=e.elements;for(let r=0;r<9;r++)if(i[r]!==s[r])return!1;return!0}fromArray(e,i=0){for(let s=0;s<9;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const VD=new g0;function eEe(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function XD(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}const D7=new g0().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),z7=new g0().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function tEe(){const n={enabled:!0,workingColorSpace:kl,spaces:{},convert:function(r,o,a){return this.enabled===!1||o===a||!o||!a||(this.spaces[o].transfer===kD&&(r.r=zu(r.r),r.g=zu(r.g),r.b=zu(r.b)),this.spaces[o].primaries!==this.spaces[a].primaries&&(r.applyMatrix3(this.spaces[o].toXYZ),r.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===kD&&(r.r=lb(r.r),r.g=lb(r.g),r.b=lb(r.b))),r},fromWorkingColorSpace:function(r,o){return this.convert(r,this.workingColorSpace,o)},toWorkingColorSpace:function(r,o){return this.convert(r,o,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===BD?N7:this.spaces[r].transfer},getLuminanceCoefficients:function(r,o=this.workingColorSpace){return r.fromArray(this.spaces[o].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,o,a){return r.copy(this.spaces[o].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],i=[.2126,.7152,.0722],s=[.3127,.329];return n.define({[kl]:{primaries:e,whitePoint:s,transfer:N7,toXYZ:D7,fromXYZ:z7,luminanceCoefficients:i,workingColorSpaceConfig:{unpackColorSpace:ar},outputColorSpaceConfig:{drawingBufferColorSpace:ar}},[ar]:{primaries:e,whitePoint:s,transfer:kD,toXYZ:D7,fromXYZ:z7,luminanceCoefficients:i,outputColorSpaceConfig:{drawingBufferColorSpace:ar}}}),n}const il=tEe();function zu(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function lb(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let cb;class iEe{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{cb===void 0&&(cb=XD("canvas")),cb.width=e.width,cb.height=e.height;const s=cb.getContext("2d");e instanceof ImageData?s.putImageData(e,0,0):s.drawImage(e,0,0,e.width,e.height),i=cb}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=XD("canvas");i.width=e.width,i.height=e.height;const s=i.getContext("2d");s.drawImage(e,0,0,e.width,e.height);const r=s.getImageData(0,0,e.width,e.height),o=r.data;for(let a=0;a<o.length;a++)o[a]=zu(o[a]/255)*255;return s.putImageData(r,0,0),i}else if(e.data){const i=e.data.slice(0);for(let s=0;s<i.length;s++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[s]=Math.floor(zu(i[s]/255)*255):i[s]=zu(i[s]);return{data:i,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let nEe=0;class sEe{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:nEe++}),this.uuid=wh(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const s={uuid:this.uuid,url:""},r=this.data;if(r!==null){let o;if(Array.isArray(r)){o=[];for(let a=0,l=r.length;a<l;a++)r[a].isDataTexture?o.push(DD(r[a].image)):o.push(DD(r[a]))}else o=DD(r);s.url=o}return i||(e.images[this.uuid]=s),s}}function DD(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?iEe.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let rEe=0;class ro extends oR{constructor(e=ro.DEFAULT_IMAGE,i=ro.DEFAULT_MAPPING,s=p0,r=p0,o=Tm,a=Pw,l=Rm,c=Cd,h=ro.DEFAULT_ANISOTROPY,d=BD){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:rEe++}),this.uuid=wh(),this.name="",this.source=new sEe(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=s,this.wrapT=r,this.magFilter=o,this.minFilter=a,this.anisotropy=h,this.format=l,this.internalFormat=null,this.type=c,this.offset=new Ur(0,0),this.repeat=new Ur(1,1),this.center=new Ur(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new g0,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=d,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),i||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==E7)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Gw:e.x=e.x-Math.floor(e.x);break;case p0:e.x=e.x<0?0:1;break;case ED:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Gw:e.y=e.y-Math.floor(e.y);break;case p0:e.y=e.y<0?0:1;break;case ED:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}ro.DEFAULT_IMAGE=null,ro.DEFAULT_MAPPING=E7,ro.DEFAULT_ANISOTROPY=1;let Gl=class sce{constructor(e=0,i=0,s=0,r=1){sce.prototype.isVector4=!0,this.x=e,this.y=i,this.z=s,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,s,r){return this.x=e,this.y=i,this.z=s,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,s=this.y,r=this.z,o=this.w,a=e.elements;return this.x=a[0]*i+a[4]*s+a[8]*r+a[12]*o,this.y=a[1]*i+a[5]*s+a[9]*r+a[13]*o,this.z=a[2]*i+a[6]*s+a[10]*r+a[14]*o,this.w=a[3]*i+a[7]*s+a[11]*r+a[15]*o,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,s,r,o;const a=e.elements,l=a[0],c=a[4],h=a[8],d=a[1],u=a[5],p=a[9],g=a[2],f=a[6],A=a[10];if(Math.abs(c-d)<.01&&Math.abs(h-g)<.01&&Math.abs(p-f)<.01){if(Math.abs(c+d)<.1&&Math.abs(h+g)<.1&&Math.abs(p+f)<.1&&Math.abs(l+u+A-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const b=(l+1)/2,v=(u+1)/2,x=(A+1)/2,w=(c+d)/4,C=(h+g)/4,S=(p+f)/4;return b>v&&b>x?b<.01?(s=0,r=.707106781,o=.707106781):(s=Math.sqrt(b),r=w/s,o=C/s):v>x?v<.01?(s=.707106781,r=0,o=.707106781):(r=Math.sqrt(v),s=w/r,o=S/r):x<.01?(s=.707106781,r=.707106781,o=0):(o=Math.sqrt(x),s=C/o,r=S/o),this.set(s,r,o,i),this}let y=Math.sqrt((f-p)*(f-p)+(h-g)*(h-g)+(d-c)*(d-c));return Math.abs(y)<.001&&(y=1),this.x=(f-p)/y,this.y=(h-g)/y,this.z=(d-c)/y,this.w=Math.acos((l+u+A-1)/2),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=ki(this.x,e.x,i.x),this.y=ki(this.y,e.y,i.y),this.z=ki(this.z,e.z,i.z),this.w=ki(this.w,e.w,i.w),this}clampScalar(e,i){return this.x=ki(this.x,e,i),this.y=ki(this.y,e,i),this.z=ki(this.z,e,i),this.w=ki(this.w,e,i),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(ki(s,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this.z=e.z+(i.z-e.z)*s,this.w=e.w+(i.w-e.w)*s,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};class oEe extends ro{constructor(e=null,i=1,s=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:i,height:s,depth:r},this.magFilter=sb,this.minFilter=sb,this.wrapR=p0,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let Lm=class{constructor(n=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=n,this._y=e,this._z=i,this._w=s}static slerpFlat(n,e,i,s,r,o,a){let l=i[s+0],c=i[s+1],h=i[s+2],d=i[s+3];const u=r[o+0],p=r[o+1],g=r[o+2],f=r[o+3];if(a===0){n[e+0]=l,n[e+1]=c,n[e+2]=h,n[e+3]=d;return}if(a===1){n[e+0]=u,n[e+1]=p,n[e+2]=g,n[e+3]=f;return}if(d!==f||l!==u||c!==p||h!==g){let A=1-a;const y=l*u+c*p+h*g+d*f,b=y>=0?1:-1,v=1-y*y;if(v>Number.EPSILON){const w=Math.sqrt(v),C=Math.atan2(w,y*b);A=Math.sin(A*C)/w,a=Math.sin(a*C)/w}const x=a*b;if(l=l*A+u*x,c=c*A+p*x,h=h*A+g*x,d=d*A+f*x,A===1-a){const w=1/Math.sqrt(l*l+c*c+h*h+d*d);l*=w,c*=w,h*=w,d*=w}}n[e]=l,n[e+1]=c,n[e+2]=h,n[e+3]=d}static multiplyQuaternionsFlat(n,e,i,s,r,o){const a=i[s],l=i[s+1],c=i[s+2],h=i[s+3],d=r[o],u=r[o+1],p=r[o+2],g=r[o+3];return n[e]=a*g+h*d+l*p-c*u,n[e+1]=l*g+h*u+c*d-a*p,n[e+2]=c*g+h*p+a*u-l*d,n[e+3]=h*g-a*d-l*u-c*p,n}get x(){return this._x}set x(n){this._x=n,this._onChangeCallback()}get y(){return this._y}set y(n){this._y=n,this._onChangeCallback()}get z(){return this._z}set z(n){this._z=n,this._onChangeCallback()}get w(){return this._w}set w(n){this._w=n,this._onChangeCallback()}set(n,e,i,s){return this._x=n,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(n){return this._x=n.x,this._y=n.y,this._z=n.z,this._w=n.w,this._onChangeCallback(),this}setFromEuler(n,e=!0){const i=n._x,s=n._y,r=n._z,o=n._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(s/2),d=a(r/2),u=l(i/2),p=l(s/2),g=l(r/2);switch(o){case"XYZ":this._x=u*h*d+c*p*g,this._y=c*p*d-u*h*g,this._z=c*h*g+u*p*d,this._w=c*h*d-u*p*g;break;case"YXZ":this._x=u*h*d+c*p*g,this._y=c*p*d-u*h*g,this._z=c*h*g-u*p*d,this._w=c*h*d+u*p*g;break;case"ZXY":this._x=u*h*d-c*p*g,this._y=c*p*d+u*h*g,this._z=c*h*g+u*p*d,this._w=c*h*d-u*p*g;break;case"ZYX":this._x=u*h*d-c*p*g,this._y=c*p*d+u*h*g,this._z=c*h*g-u*p*d,this._w=c*h*d+u*p*g;break;case"YZX":this._x=u*h*d+c*p*g,this._y=c*p*d+u*h*g,this._z=c*h*g-u*p*d,this._w=c*h*d-u*p*g;break;case"XZY":this._x=u*h*d-c*p*g,this._y=c*p*d-u*h*g,this._z=c*h*g+u*p*d,this._w=c*h*d+u*p*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(n,e){const i=e/2,s=Math.sin(i);return this._x=n.x*s,this._y=n.y*s,this._z=n.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(n){const e=n.elements,i=e[0],s=e[4],r=e[8],o=e[1],a=e[5],l=e[9],c=e[2],h=e[6],d=e[10],u=i+a+d;if(u>0){const p=.5/Math.sqrt(u+1);this._w=.25/p,this._x=(h-l)*p,this._y=(r-c)*p,this._z=(o-s)*p}else if(i>a&&i>d){const p=2*Math.sqrt(1+i-a-d);this._w=(h-l)/p,this._x=.25*p,this._y=(s+o)/p,this._z=(r+c)/p}else if(a>d){const p=2*Math.sqrt(1+a-i-d);this._w=(r-c)/p,this._x=(s+o)/p,this._y=.25*p,this._z=(l+h)/p}else{const p=2*Math.sqrt(1+d-i-a);this._w=(o-s)/p,this._x=(r+c)/p,this._y=(l+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(n,e){let i=n.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(n.x)>Math.abs(n.z)?(this._x=-n.y,this._y=n.x,this._z=0,this._w=i):(this._x=0,this._y=-n.z,this._z=n.y,this._w=i)):(this._x=n.y*e.z-n.z*e.y,this._y=n.z*e.x-n.x*e.z,this._z=n.x*e.y-n.y*e.x,this._w=i),this.normalize()}angleTo(n){return 2*Math.acos(Math.abs(ki(this.dot(n),-1,1)))}rotateTowards(n,e){const i=this.angleTo(n);if(i===0)return this;const s=Math.min(1,e/i);return this.slerp(n,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(n){return this._x*n._x+this._y*n._y+this._z*n._z+this._w*n._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let n=this.length();return n===0?(this._x=0,this._y=0,this._z=0,this._w=1):(n=1/n,this._x=this._x*n,this._y=this._y*n,this._z=this._z*n,this._w=this._w*n),this._onChangeCallback(),this}multiply(n){return this.multiplyQuaternions(this,n)}premultiply(n){return this.multiplyQuaternions(n,this)}multiplyQuaternions(n,e){const i=n._x,s=n._y,r=n._z,o=n._w,a=e._x,l=e._y,c=e._z,h=e._w;return this._x=i*h+o*a+s*c-r*l,this._y=s*h+o*l+r*a-i*c,this._z=r*h+o*c+i*l-s*a,this._w=o*h-i*a-s*l-r*c,this._onChangeCallback(),this}slerp(n,e){if(e===0)return this;if(e===1)return this.copy(n);const i=this._x,s=this._y,r=this._z,o=this._w;let a=o*n._w+i*n._x+s*n._y+r*n._z;if(a<0?(this._w=-n._w,this._x=-n._x,this._y=-n._y,this._z=-n._z,a=-a):this.copy(n),a>=1)return this._w=o,this._x=i,this._y=s,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const p=1-e;return this._w=p*o+e*this._w,this._x=p*i+e*this._x,this._y=p*s+e*this._y,this._z=p*r+e*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),d=Math.sin((1-e)*h)/c,u=Math.sin(e*h)/c;return this._w=o*d+this._w*u,this._x=i*d+this._x*u,this._y=s*d+this._y*u,this._z=r*d+this._z*u,this._onChangeCallback(),this}slerpQuaternions(n,e,i){return this.copy(n).slerp(e,i)}random(){const n=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(s*Math.sin(n),s*Math.cos(n),r*Math.sin(e),r*Math.cos(e))}equals(n){return n._x===this._x&&n._y===this._y&&n._z===this._z&&n._w===this._w}fromArray(n,e=0){return this._x=n[e],this._y=n[e+1],this._z=n[e+2],this._w=n[e+3],this._onChangeCallback(),this}toArray(n=[],e=0){return n[e]=this._x,n[e+1]=this._y,n[e+2]=this._z,n[e+3]=this._w,n}fromBufferAttribute(n,e){return this._x=n.getX(e),this._y=n.getY(e),this._z=n.getZ(e),this._w=n.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(n){return this._onChangeCallback=n,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},xe=class rce{constructor(e=0,i=0,s=0){rce.prototype.isVector3=!0,this.x=e,this.y=i,this.z=s}set(e,i,s){return s===void 0&&(s=this.z),this.x=e,this.y=i,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(F7.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(F7.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,s=this.y,r=this.z,o=e.elements;return this.x=o[0]*i+o[3]*s+o[6]*r,this.y=o[1]*i+o[4]*s+o[7]*r,this.z=o[2]*i+o[5]*s+o[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,s=this.y,r=this.z,o=e.elements,a=1/(o[3]*i+o[7]*s+o[11]*r+o[15]);return this.x=(o[0]*i+o[4]*s+o[8]*r+o[12])*a,this.y=(o[1]*i+o[5]*s+o[9]*r+o[13])*a,this.z=(o[2]*i+o[6]*s+o[10]*r+o[14])*a,this}applyQuaternion(e){const i=this.x,s=this.y,r=this.z,o=e.x,a=e.y,l=e.z,c=e.w,h=2*(a*r-l*s),d=2*(l*i-o*r),u=2*(o*s-a*i);return this.x=i+c*h+a*u-l*d,this.y=s+c*d+l*h-o*u,this.z=r+c*u+o*d-a*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,s=this.y,r=this.z,o=e.elements;return this.x=o[0]*i+o[4]*s+o[8]*r,this.y=o[1]*i+o[5]*s+o[9]*r,this.z=o[2]*i+o[6]*s+o[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=ki(this.x,e.x,i.x),this.y=ki(this.y,e.y,i.y),this.z=ki(this.z,e.z,i.z),this}clampScalar(e,i){return this.x=ki(this.x,e,i),this.y=ki(this.y,e,i),this.z=ki(this.z,e,i),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(ki(s,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this.z=e.z+(i.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const s=e.x,r=e.y,o=e.z,a=i.x,l=i.y,c=i.z;return this.x=r*c-o*l,this.y=o*a-s*c,this.z=s*l-r*a,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const s=e.dot(this)/i;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return zD.copy(this).projectOnVector(e),this.sub(zD)}reflect(e){return this.sub(zD.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const s=this.dot(e)/i;return Math.acos(ki(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y,r=this.z-e.z;return i*i+s*s+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,s){const r=Math.sin(i)*e;return this.x=r*Math.sin(s),this.y=Math.cos(i)*e,this.z=r*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,s){return this.x=e*Math.sin(i),this.y=s,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=s,this.z=r,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,s=Math.sqrt(1-i*i);return this.x=s*Math.cos(e),this.y=i,this.z=s*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const zD=new xe,F7=new Lm;class Sh{constructor(e=new xe(1/0,1/0,1/0),i=new xe(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){this.makeEmpty();for(let i=0,s=e.length;i<s;i+=3)this.expandByPoint(_h.fromArray(e,i));return this}setFromBufferAttribute(e){this.makeEmpty();for(let i=0,s=e.count;i<s;i++)this.expandByPoint(_h.fromBufferAttribute(e,i));return this}setFromPoints(e){this.makeEmpty();for(let i=0,s=e.length;i<s;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const s=_h.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(s),this.max.copy(e).add(s),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);const s=e.geometry;if(s!==void 0){const o=s.getAttribute("position");if(i===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let a=0,l=o.count;a<l;a++)e.isMesh===!0?e.getVertexPosition(a,_h):_h.fromBufferAttribute(o,a),_h.applyMatrix4(e.matrixWorld),this.expandByPoint(_h);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),aR.copy(e.boundingBox)):(s.boundingBox===null&&s.computeBoundingBox(),aR.copy(s.boundingBox)),aR.applyMatrix4(e.matrixWorld),this.union(aR)}const r=e.children;for(let o=0,a=r.length;o<a;o++)this.expandByObject(r[o],i);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,_h),_h.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,s;return e.normal.x>0?(i=e.normal.x*this.min.x,s=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,s=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,s+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,s+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,s+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,s+=e.normal.z*this.min.z),i<=-e.constant&&s>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Uw),lR.subVectors(this.max,Uw),hb.subVectors(e.a,Uw),db.subVectors(e.b,Uw),ub.subVectors(e.c,Uw),Bm.subVectors(db,hb),km.subVectors(ub,db),f0.subVectors(hb,ub);let i=[0,-Bm.z,Bm.y,0,-km.z,km.y,0,-f0.z,f0.y,Bm.z,0,-Bm.x,km.z,0,-km.x,f0.z,0,-f0.x,-Bm.y,Bm.x,0,-km.y,km.x,0,-f0.y,f0.x,0];return!FD(i,hb,db,ub,lR)||(i=[1,0,0,0,1,0,0,0,1],!FD(i,hb,db,ub,lR))?!1:(cR.crossVectors(Bm,km),i=[cR.x,cR.y,cR.z],FD(i,hb,db,ub,lR))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,_h).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(_h).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Fu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Fu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Fu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Fu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Fu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Fu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Fu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Fu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Fu),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Fu=[new xe,new xe,new xe,new xe,new xe,new xe,new xe,new xe],_h=new xe,aR=new Sh,hb=new xe,db=new xe,ub=new xe,Bm=new xe,km=new xe,f0=new xe,Uw=new xe,lR=new xe,cR=new xe,A0=new xe;function FD(n,e,i,s,r){for(let o=0,a=n.length-3;o<=a;o+=3){A0.fromArray(n,o);const l=r.x*Math.abs(A0.x)+r.y*Math.abs(A0.y)+r.z*Math.abs(A0.z),c=e.dot(A0),h=i.dot(A0),d=s.dot(A0);if(Math.max(-Math.max(c,h,d),Math.min(c,h,d))>l)return!1}return!0}const aEe=new Sh,Ow=new xe,UD=new xe;class Mh{constructor(e=new xe,i=-1){this.isSphere=!0,this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){const s=this.center;i!==void 0?s.copy(i):aEe.setFromPoints(e).getCenter(s);let r=0;for(let o=0,a=e.length;o<a;o++)r=Math.max(r,s.distanceToSquared(e[o]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){const s=this.center.distanceToSquared(e);return i.copy(e),s>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ow.subVectors(e,this.center);const i=Ow.lengthSq();if(i>this.radius*this.radius){const s=Math.sqrt(i),r=(s-this.radius)*.5;this.center.addScaledVector(Ow,r/s),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(UD.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ow.copy(e.center).add(UD)),this.expandByPoint(Ow.copy(e.center).sub(UD))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Uu=new xe,OD=new xe,hR=new xe,Gm=new xe,ZD=new xe,dR=new xe,WD=new xe;class uR{constructor(e=new xe,i=new xe(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Uu)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);const s=i.dot(this.direction);return s<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const i=Uu.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(Uu.copy(this.origin).addScaledVector(this.direction,i),Uu.distanceToSquared(e))}distanceSqToSegment(e,i,s,r){OD.copy(e).add(i).multiplyScalar(.5),hR.copy(i).sub(e).normalize(),Gm.copy(this.origin).sub(OD);const o=e.distanceTo(i)*.5,a=-this.direction.dot(hR),l=Gm.dot(this.direction),c=-Gm.dot(hR),h=Gm.lengthSq(),d=Math.abs(1-a*a);let u,p,g,f;if(d>0)if(u=a*c-l,p=a*l-c,f=o*d,u>=0)if(p>=-f)if(p<=f){const A=1/d;u*=A,p*=A,g=u*(u+a*p+2*l)+p*(a*u+p+2*c)+h}else p=o,u=Math.max(0,-(a*p+l)),g=-u*u+p*(p+2*c)+h;else p=-o,u=Math.max(0,-(a*p+l)),g=-u*u+p*(p+2*c)+h;else p<=-f?(u=Math.max(0,-(-a*o+l)),p=u>0?-o:Math.min(Math.max(-o,-c),o),g=-u*u+p*(p+2*c)+h):p<=f?(u=0,p=Math.min(Math.max(-o,-c),o),g=p*(p+2*c)+h):(u=Math.max(0,-(a*o+l)),p=u>0?o:Math.min(Math.max(-o,-c),o),g=-u*u+p*(p+2*c)+h);else p=a>0?-o:o,u=Math.max(0,-(a*p+l)),g=-u*u+p*(p+2*c)+h;return s&&s.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(OD).addScaledVector(hR,p),g}intersectSphere(e,i){Uu.subVectors(e.center,this.origin);const s=Uu.dot(this.direction),r=Uu.dot(Uu)-s*s,o=e.radius*e.radius;if(r>o)return null;const a=Math.sqrt(o-r),l=s-a,c=s+a;return c<0?null:l<0?this.at(c,i):this.at(l,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;const s=-(this.origin.dot(e.normal)+e.constant)/i;return s>=0?s:null}intersectPlane(e,i){const s=this.distanceToPlane(e);return s===null?null:this.at(s,i)}intersectsPlane(e){const i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let s,r,o,a,l,c;const h=1/this.direction.x,d=1/this.direction.y,u=1/this.direction.z,p=this.origin;return h>=0?(s=(e.min.x-p.x)*h,r=(e.max.x-p.x)*h):(s=(e.max.x-p.x)*h,r=(e.min.x-p.x)*h),d>=0?(o=(e.min.y-p.y)*d,a=(e.max.y-p.y)*d):(o=(e.max.y-p.y)*d,a=(e.min.y-p.y)*d),s>a||o>r||((o>s||isNaN(s))&&(s=o),(a<r||isNaN(r))&&(r=a),u>=0?(l=(e.min.z-p.z)*u,c=(e.max.z-p.z)*u):(l=(e.max.z-p.z)*u,c=(e.min.z-p.z)*u),s>c||l>r)||((l>s||s!==s)&&(s=l),(c<r||r!==r)&&(r=c),r<0)?null:this.at(s>=0?s:r,i)}intersectsBox(e){return this.intersectBox(e,Uu)!==null}intersectTriangle(e,i,s,r,o){ZD.subVectors(i,e),dR.subVectors(s,e),WD.crossVectors(ZD,dR);let a=this.direction.dot(WD),l;if(a>0){if(r)return null;l=1}else if(a<0)l=-1,a=-a;else return null;Gm.subVectors(this.origin,e);const c=l*this.direction.dot(dR.crossVectors(Gm,dR));if(c<0)return null;const h=l*this.direction.dot(ZD.cross(Gm));if(h<0||c+h>a)return null;const d=-l*Gm.dot(WD);return d<0?null:this.at(d/a,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}let Ji=class GZ{constructor(e,i,s,r,o,a,l,c,h,d,u,p,g,f,A,y){GZ.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,s,r,o,a,l,c,h,d,u,p,g,f,A,y)}set(e,i,s,r,o,a,l,c,h,d,u,p,g,f,A,y){const b=this.elements;return b[0]=e,b[4]=i,b[8]=s,b[12]=r,b[1]=o,b[5]=a,b[9]=l,b[13]=c,b[2]=h,b[6]=d,b[10]=u,b[14]=p,b[3]=g,b[7]=f,b[11]=A,b[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new GZ().fromArray(this.elements)}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],this}copyPosition(e){const i=this.elements,s=e.elements;return i[12]=s[12],i[13]=s[13],i[14]=s[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,s){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,i,s){return this.set(e.x,i.x,s.x,0,e.y,i.y,s.y,0,e.z,i.z,s.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,s=e.elements,r=1/pb.setFromMatrixColumn(e,0).length(),o=1/pb.setFromMatrixColumn(e,1).length(),a=1/pb.setFromMatrixColumn(e,2).length();return i[0]=s[0]*r,i[1]=s[1]*r,i[2]=s[2]*r,i[3]=0,i[4]=s[4]*o,i[5]=s[5]*o,i[6]=s[6]*o,i[7]=0,i[8]=s[8]*a,i[9]=s[9]*a,i[10]=s[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,s=e.x,r=e.y,o=e.z,a=Math.cos(s),l=Math.sin(s),c=Math.cos(r),h=Math.sin(r),d=Math.cos(o),u=Math.sin(o);if(e.order==="XYZ"){const p=a*d,g=a*u,f=l*d,A=l*u;i[0]=c*d,i[4]=-c*u,i[8]=h,i[1]=g+f*h,i[5]=p-A*h,i[9]=-l*c,i[2]=A-p*h,i[6]=f+g*h,i[10]=a*c}else if(e.order==="YXZ"){const p=c*d,g=c*u,f=h*d,A=h*u;i[0]=p+A*l,i[4]=f*l-g,i[8]=a*h,i[1]=a*u,i[5]=a*d,i[9]=-l,i[2]=g*l-f,i[6]=A+p*l,i[10]=a*c}else if(e.order==="ZXY"){const p=c*d,g=c*u,f=h*d,A=h*u;i[0]=p-A*l,i[4]=-a*u,i[8]=f+g*l,i[1]=g+f*l,i[5]=a*d,i[9]=A-p*l,i[2]=-a*h,i[6]=l,i[10]=a*c}else if(e.order==="ZYX"){const p=a*d,g=a*u,f=l*d,A=l*u;i[0]=c*d,i[4]=f*h-g,i[8]=p*h+A,i[1]=c*u,i[5]=A*h+p,i[9]=g*h-f,i[2]=-h,i[6]=l*c,i[10]=a*c}else if(e.order==="YZX"){const p=a*c,g=a*h,f=l*c,A=l*h;i[0]=c*d,i[4]=A-p*u,i[8]=f*u+g,i[1]=u,i[5]=a*d,i[9]=-l*d,i[2]=-h*d,i[6]=g*u+f,i[10]=p-A*u}else if(e.order==="XZY"){const p=a*c,g=a*h,f=l*c,A=l*h;i[0]=c*d,i[4]=-u,i[8]=h*d,i[1]=p*u+A,i[5]=a*d,i[9]=g*u-f,i[2]=f*u-g,i[6]=l*d,i[10]=A*u+p}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(lEe,e,cEe)}lookAt(e,i,s){const r=this.elements;return Pl.subVectors(e,i),Pl.lengthSq()===0&&(Pl.z=1),Pl.normalize(),Pm.crossVectors(s,Pl),Pm.lengthSq()===0&&(Math.abs(s.z)===1?Pl.x+=1e-4:Pl.z+=1e-4,Pl.normalize(),Pm.crossVectors(s,Pl)),Pm.normalize(),pR.crossVectors(Pl,Pm),r[0]=Pm.x,r[4]=pR.x,r[8]=Pl.x,r[1]=Pm.y,r[5]=pR.y,r[9]=Pl.y,r[2]=Pm.z,r[6]=pR.z,r[10]=Pl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,r=i.elements,o=this.elements,a=s[0],l=s[4],c=s[8],h=s[12],d=s[1],u=s[5],p=s[9],g=s[13],f=s[2],A=s[6],y=s[10],b=s[14],v=s[3],x=s[7],w=s[11],C=s[15],S=r[0],_=r[4],I=r[8],B=r[12],M=r[1],R=r[5],k=r[9],G=r[13],X=r[2],F=r[6],z=r[10],H=r[14],Z=r[3],he=r[7],be=r[11],_e=r[15];return o[0]=a*S+l*M+c*X+h*Z,o[4]=a*_+l*R+c*F+h*he,o[8]=a*I+l*k+c*z+h*be,o[12]=a*B+l*G+c*H+h*_e,o[1]=d*S+u*M+p*X+g*Z,o[5]=d*_+u*R+p*F+g*he,o[9]=d*I+u*k+p*z+g*be,o[13]=d*B+u*G+p*H+g*_e,o[2]=f*S+A*M+y*X+b*Z,o[6]=f*_+A*R+y*F+b*he,o[10]=f*I+A*k+y*z+b*be,o[14]=f*B+A*G+y*H+b*_e,o[3]=v*S+x*M+w*X+C*Z,o[7]=v*_+x*R+w*F+C*he,o[11]=v*I+x*k+w*z+C*be,o[15]=v*B+x*G+w*H+C*_e,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[4],r=e[8],o=e[12],a=e[1],l=e[5],c=e[9],h=e[13],d=e[2],u=e[6],p=e[10],g=e[14],f=e[3],A=e[7],y=e[11],b=e[15];return f*(+o*c*u-r*h*u-o*l*p+s*h*p+r*l*g-s*c*g)+A*(+i*c*g-i*h*p+o*a*p-r*a*g+r*h*d-o*c*d)+y*(+i*h*u-i*l*g-o*a*u+s*a*g+o*l*d-s*h*d)+b*(-r*l*d-i*c*u+i*l*p+r*a*u-s*a*p+s*c*d)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,s){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=i,r[14]=s),this}invert(){const e=this.elements,i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],u=e[9],p=e[10],g=e[11],f=e[12],A=e[13],y=e[14],b=e[15],v=u*y*h-A*p*h+A*c*g-l*y*g-u*c*b+l*p*b,x=f*p*h-d*y*h-f*c*g+a*y*g+d*c*b-a*p*b,w=d*A*h-f*u*h+f*l*g-a*A*g-d*l*b+a*u*b,C=f*u*c-d*A*c-f*l*p+a*A*p+d*l*y-a*u*y,S=i*v+s*x+r*w+o*C;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _=1/S;return e[0]=v*_,e[1]=(A*p*o-u*y*o-A*r*g+s*y*g+u*r*b-s*p*b)*_,e[2]=(l*y*o-A*c*o+A*r*h-s*y*h-l*r*b+s*c*b)*_,e[3]=(u*c*o-l*p*o-u*r*h+s*p*h+l*r*g-s*c*g)*_,e[4]=x*_,e[5]=(d*y*o-f*p*o+f*r*g-i*y*g-d*r*b+i*p*b)*_,e[6]=(f*c*o-a*y*o-f*r*h+i*y*h+a*r*b-i*c*b)*_,e[7]=(a*p*o-d*c*o+d*r*h-i*p*h-a*r*g+i*c*g)*_,e[8]=w*_,e[9]=(f*u*o-d*A*o-f*s*g+i*A*g+d*s*b-i*u*b)*_,e[10]=(a*A*o-f*l*o+f*s*h-i*A*h-a*s*b+i*l*b)*_,e[11]=(d*l*o-a*u*o-d*s*h+i*u*h+a*s*g-i*l*g)*_,e[12]=C*_,e[13]=(d*A*r-f*u*r+f*s*p-i*A*p-d*s*y+i*u*y)*_,e[14]=(f*l*r-a*A*r-f*s*c+i*A*c+a*s*y-i*l*y)*_,e[15]=(a*u*r-d*l*r+d*s*c-i*u*c-a*s*p+i*l*p)*_,this}scale(e){const i=this.elements,s=e.x,r=e.y,o=e.z;return i[0]*=s,i[4]*=r,i[8]*=o,i[1]*=s,i[5]*=r,i[9]*=o,i[2]*=s,i[6]*=r,i[10]*=o,i[3]*=s,i[7]*=r,i[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,s,r))}makeTranslation(e,i,s){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,s,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,i,-s,0,0,s,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,0,s,0,0,1,0,0,-s,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,-s,0,0,s,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const s=Math.cos(i),r=Math.sin(i),o=1-s,a=e.x,l=e.y,c=e.z,h=o*a,d=o*l;return this.set(h*a+s,h*l-r*c,h*c+r*l,0,h*l+r*c,d*l+s,d*c-r*a,0,h*c-r*l,d*c+r*a,o*c*c+s,0,0,0,0,1),this}makeScale(e,i,s){return this.set(e,0,0,0,0,i,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,i,s,r,o,a){return this.set(1,s,o,0,e,1,a,0,i,r,1,0,0,0,0,1),this}compose(e,i,s){const r=this.elements,o=i._x,a=i._y,l=i._z,c=i._w,h=o+o,d=a+a,u=l+l,p=o*h,g=o*d,f=o*u,A=a*d,y=a*u,b=l*u,v=c*h,x=c*d,w=c*u,C=s.x,S=s.y,_=s.z;return r[0]=(1-(A+b))*C,r[1]=(g+w)*C,r[2]=(f-x)*C,r[3]=0,r[4]=(g-w)*S,r[5]=(1-(p+b))*S,r[6]=(y+v)*S,r[7]=0,r[8]=(f+x)*_,r[9]=(y-v)*_,r[10]=(1-(p+A))*_,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,i,s){const r=this.elements;let o=pb.set(r[0],r[1],r[2]).length();const a=pb.set(r[4],r[5],r[6]).length(),l=pb.set(r[8],r[9],r[10]).length();this.determinant()<0&&(o=-o),e.x=r[12],e.y=r[13],e.z=r[14],Ih.copy(this);const c=1/o,h=1/a,d=1/l;return Ih.elements[0]*=c,Ih.elements[1]*=c,Ih.elements[2]*=c,Ih.elements[4]*=h,Ih.elements[5]*=h,Ih.elements[6]*=h,Ih.elements[8]*=d,Ih.elements[9]*=d,Ih.elements[10]*=d,i.setFromRotationMatrix(Ih),s.x=o,s.y=a,s.z=l,this}makePerspective(e,i,s,r,o,a,l=m0){const c=this.elements,h=2*o/(i-e),d=2*o/(s-r),u=(i+e)/(i-e),p=(s+r)/(s-r);let g,f;if(l===m0)g=-(a+o)/(a-o),f=-2*a*o/(a-o);else if(l===PD)g=-a/(a-o),f=-a*o/(a-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return c[0]=h,c[4]=0,c[8]=u,c[12]=0,c[1]=0,c[5]=d,c[9]=p,c[13]=0,c[2]=0,c[6]=0,c[10]=g,c[14]=f,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,s,r,o,a,l=m0){const c=this.elements,h=1/(i-e),d=1/(s-r),u=1/(a-o),p=(i+e)*h,g=(s+r)*d;let f,A;if(l===m0)f=(a+o)*u,A=-2*u;else if(l===PD)f=o*u,A=-1*u;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-p,c[1]=0,c[5]=2*d,c[9]=0,c[13]=-g,c[2]=0,c[6]=0,c[10]=A,c[14]=-f,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,s=e.elements;for(let r=0;r<16;r++)if(i[r]!==s[r])return!1;return!0}fromArray(e,i=0){for(let s=0;s<16;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e[i+9]=s[9],e[i+10]=s[10],e[i+11]=s[11],e[i+12]=s[12],e[i+13]=s[13],e[i+14]=s[14],e[i+15]=s[15],e}};const pb=new xe,Ih=new Ji,lEe=new xe(0,0,0),cEe=new xe(1,1,1),Pm=new xe,pR=new xe,Pl=new xe,U7=new Ji,O7=new Lm;let mR=class oce{constructor(e=0,i=0,s=0,r=oce.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=s,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,s,r=this._order){return this._x=e,this._y=i,this._z=s,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,s=!0){const r=e.elements,o=r[0],a=r[4],l=r[8],c=r[1],h=r[5],d=r[9],u=r[2],p=r[6],g=r[10];switch(i){case"XYZ":this._y=Math.asin(ki(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,g),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(p,h),this._z=0);break;case"YXZ":this._x=Math.asin(-ki(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(l,g),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-u,o),this._z=0);break;case"ZXY":this._x=Math.asin(ki(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-u,g),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-ki(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(p,g),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-a,h));break;case"YZX":this._z=Math.asin(ki(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-d,h),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(l,g));break;case"XZY":this._z=Math.asin(-ki(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(p,h),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-d,g),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,s===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,s){return U7.makeRotationFromQuaternion(e),this.setFromRotationMatrix(U7,i,s)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return O7.setFromEuler(this),this.setFromQuaternion(O7,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};mR.DEFAULT_ORDER="XYZ";class hEe{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let dEe=0;const Z7=new xe,mb=new Lm,Ou=new Ji,gR=new xe,Zw=new xe,uEe=new xe,pEe=new Lm,W7=new xe(1,0,0),H7=new xe(0,1,0),Q7=new xe(0,0,1),K7={type:"added"},mEe={type:"removed"},gb={type:"childadded",child:null},HD={type:"childremoved",child:null};class Js extends oR{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:dEe++}),this.uuid=wh(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Js.DEFAULT_UP.clone();const e=new xe,i=new mR,s=new Lm,r=new xe(1,1,1);function o(){s.setFromEuler(i,!1)}function a(){i.setFromQuaternion(s,void 0,!1)}i._onChange(o),s._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Ji},normalMatrix:{value:new g0}}),this.matrix=new Ji,this.matrixWorld=new Ji,this.matrixAutoUpdate=Js.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Js.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new hEe,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return mb.setFromAxisAngle(e,i),this.quaternion.multiply(mb),this}rotateOnWorldAxis(e,i){return mb.setFromAxisAngle(e,i),this.quaternion.premultiply(mb),this}rotateX(e){return this.rotateOnAxis(W7,e)}rotateY(e){return this.rotateOnAxis(H7,e)}rotateZ(e){return this.rotateOnAxis(Q7,e)}translateOnAxis(e,i){return Z7.copy(e).applyQuaternion(this.quaternion),this.position.add(Z7.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(W7,e)}translateY(e){return this.translateOnAxis(H7,e)}translateZ(e){return this.translateOnAxis(Q7,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ou.copy(this.matrixWorld).invert())}lookAt(e,i,s){e.isVector3?gR.copy(e):gR.set(e,i,s);const r=this.parent;this.updateWorldMatrix(!0,!1),Zw.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ou.lookAt(Zw,gR,this.up):Ou.lookAt(gR,Zw,this.up),this.quaternion.setFromRotationMatrix(Ou),r&&(Ou.extractRotation(r.matrixWorld),mb.setFromRotationMatrix(Ou),this.quaternion.premultiply(mb.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(K7),gb.child=e,this.dispatchEvent(gb),gb.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(mEe),HD.child=e,this.dispatchEvent(HD),HD.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Ou.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ou.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ou),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(K7),gb.child=e,this.dispatchEvent(gb),gb.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let s=0,r=this.children.length;s<r;s++){const o=this.children[s].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,s=[]){this[e]===i&&s.push(this);const r=this.children;for(let o=0,a=r.length;o<a;o++)r[o].getObjectsByProperty(e,i,s);return s}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Zw,e,uEe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Zw,pEe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].updateMatrixWorld(e)}updateWorldMatrix(e,i){const s=this.parent;if(e===!0&&s!==null&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const r=this.children;for(let o=0,a=r.length;o<a;o++)r[o].updateWorldMatrix(!1,!0)}}toJSON(e){const i=e===void 0||typeof e=="string",s={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(l=>({boxInitialized:l.boxInitialized,boxMin:l.box.min.toArray(),boxMax:l.box.max.toArray(),sphereInitialized:l.sphereInitialized,sphereRadius:l.sphere.radius,sphereCenter:l.sphere.center.toArray()})),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function o(l,c){return l[c.uuid]===void 0&&(l[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=o(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const c=l.shapes;if(Array.isArray(c))for(let h=0,d=c.length;h<d;h++){const u=c[h];o(e.shapes,u)}else o(e.shapes,c)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let c=0,h=this.material.length;c<h;c++)l.push(o(e.materials,this.material[c]));r.material=l}else r.material=o(e.materials,this.material);if(this.children.length>0){r.children=[];for(let l=0;l<this.children.length;l++)r.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let l=0;l<this.animations.length;l++){const c=this.animations[l];r.animations.push(o(e.animations,c))}}if(i){const l=a(e.geometries),c=a(e.materials),h=a(e.textures),d=a(e.images),u=a(e.shapes),p=a(e.skeletons),g=a(e.animations),f=a(e.nodes);l.length>0&&(s.geometries=l),c.length>0&&(s.materials=c),h.length>0&&(s.textures=h),d.length>0&&(s.images=d),u.length>0&&(s.shapes=u),p.length>0&&(s.skeletons=p),g.length>0&&(s.animations=g),f.length>0&&(s.nodes=f)}return s.object=r,s;function a(l){const c=[];for(const h in l){const d=l[h];delete d.metadata,c.push(d)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let s=0;s<e.children.length;s++){const r=e.children[s];this.add(r.clone())}return this}}Js.DEFAULT_UP=new xe(0,1,0),Js.DEFAULT_MATRIX_AUTO_UPDATE=!0,Js.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Th=new xe,Zu=new xe,QD=new xe,Wu=new xe,fb=new xe,Ab=new xe,Y7=new xe,KD=new xe,YD=new xe,jD=new xe,JD=new Gl,qD=new Gl,$D=new Gl;class ed{constructor(e=new xe,i=new xe,s=new xe){this.a=e,this.b=i,this.c=s}static getNormal(e,i,s,r){r.subVectors(s,i),Th.subVectors(e,i),r.cross(Th);const o=r.lengthSq();return o>0?r.multiplyScalar(1/Math.sqrt(o)):r.set(0,0,0)}static getBarycoord(e,i,s,r,o){Th.subVectors(r,i),Zu.subVectors(s,i),QD.subVectors(e,i);const a=Th.dot(Th),l=Th.dot(Zu),c=Th.dot(QD),h=Zu.dot(Zu),d=Zu.dot(QD),u=a*h-l*l;if(u===0)return o.set(0,0,0),null;const p=1/u,g=(h*c-l*d)*p,f=(a*d-l*c)*p;return o.set(1-g-f,f,g)}static containsPoint(e,i,s,r){return this.getBarycoord(e,i,s,r,Wu)===null?!1:Wu.x>=0&&Wu.y>=0&&Wu.x+Wu.y<=1}static getInterpolation(e,i,s,r,o,a,l,c){return this.getBarycoord(e,i,s,r,Wu)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(o,Wu.x),c.addScaledVector(a,Wu.y),c.addScaledVector(l,Wu.z),c)}static getInterpolatedAttribute(e,i,s,r,o,a){return JD.setScalar(0),qD.setScalar(0),$D.setScalar(0),JD.fromBufferAttribute(e,i),qD.fromBufferAttribute(e,s),$D.fromBufferAttribute(e,r),a.setScalar(0),a.addScaledVector(JD,o.x),a.addScaledVector(qD,o.y),a.addScaledVector($D,o.z),a}static isFrontFacing(e,i,s,r){return Th.subVectors(s,i),Zu.subVectors(e,i),Th.cross(Zu).dot(r)<0}set(e,i,s){return this.a.copy(e),this.b.copy(i),this.c.copy(s),this}setFromPointsAndIndices(e,i,s,r){return this.a.copy(e[i]),this.b.copy(e[s]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,i,s,r){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,s),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Th.subVectors(this.c,this.b),Zu.subVectors(this.a,this.b),Th.cross(Zu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ed.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return ed.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,s,r,o){return ed.getInterpolation(e,this.a,this.b,this.c,i,s,r,o)}containsPoint(e){return ed.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ed.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const s=this.a,r=this.b,o=this.c;let a,l;fb.subVectors(r,s),Ab.subVectors(o,s),KD.subVectors(e,s);const c=fb.dot(KD),h=Ab.dot(KD);if(c<=0&&h<=0)return i.copy(s);YD.subVectors(e,r);const d=fb.dot(YD),u=Ab.dot(YD);if(d>=0&&u<=d)return i.copy(r);const p=c*u-d*h;if(p<=0&&c>=0&&d<=0)return a=c/(c-d),i.copy(s).addScaledVector(fb,a);jD.subVectors(e,o);const g=fb.dot(jD),f=Ab.dot(jD);if(f>=0&&g<=f)return i.copy(o);const A=g*h-c*f;if(A<=0&&h>=0&&f<=0)return l=h/(h-f),i.copy(s).addScaledVector(Ab,l);const y=d*f-g*u;if(y<=0&&u-d>=0&&g-f>=0)return Y7.subVectors(o,r),l=(u-d)/(u-d+(g-f)),i.copy(r).addScaledVector(Y7,l);const b=1/(y+A+p);return a=A*b,l=p*b,i.copy(s).addScaledVector(fb,a).addScaledVector(Ab,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const j7={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Nm={h:0,s:0,l:0},fR={h:0,s:0,l:0};function e5(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*6*(2/3-i):n}class lr{constructor(e,i,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,i,s)}set(e,i,s){if(i===void 0&&s===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,i,s);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=ar){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,il.toWorkingColorSpace(this,i),this}setRGB(e,i,s,r=il.workingColorSpace){return this.r=e,this.g=i,this.b=s,il.toWorkingColorSpace(this,r),this}setHSL(e,i,s,r=il.workingColorSpace){if(e=ND(e,1),i=ki(i,0,1),s=ki(s,0,1),i===0)this.r=this.g=this.b=s;else{const o=s<=.5?s*(1+i):s+i-s*i,a=2*s-o;this.r=e5(a,o,e+1/3),this.g=e5(a,o,e),this.b=e5(a,o,e-1/3)}return il.toWorkingColorSpace(this,r),this}setStyle(e,i=ar){function s(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const a=r[1],l=r[2];switch(a){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return s(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,i);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return s(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,i);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return s(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=r[1],a=o.length;if(a===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,i);if(a===6)return this.setHex(parseInt(o,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=ar){const s=j7[e.toLowerCase()];return s!==void 0?this.setHex(s,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=zu(e.r),this.g=zu(e.g),this.b=zu(e.b),this}copyLinearToSRGB(e){return this.r=lb(e.r),this.g=lb(e.g),this.b=lb(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ar){return il.fromWorkingColorSpace(ea.copy(this),e),Math.round(ki(ea.r*255,0,255))*65536+Math.round(ki(ea.g*255,0,255))*256+Math.round(ki(ea.b*255,0,255))}getHexString(e=ar){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=il.workingColorSpace){il.fromWorkingColorSpace(ea.copy(this),i);const s=ea.r,r=ea.g,o=ea.b,a=Math.max(s,r,o),l=Math.min(s,r,o);let c,h;const d=(l+a)/2;if(l===a)c=0,h=0;else{const u=a-l;switch(h=d<=.5?u/(a+l):u/(2-a-l),a){case s:c=(r-o)/u+(r<o?6:0);break;case r:c=(o-s)/u+2;break;case o:c=(s-r)/u+4;break}c/=6}return e.h=c,e.s=h,e.l=d,e}getRGB(e,i=il.workingColorSpace){return il.fromWorkingColorSpace(ea.copy(this),i),e.r=ea.r,e.g=ea.g,e.b=ea.b,e}getStyle(e=ar){il.fromWorkingColorSpace(ea.copy(this),e);const i=ea.r,s=ea.g,r=ea.b;return e!==ar?`color(${e} ${i.toFixed(3)} ${s.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(s*255)},${Math.round(r*255)})`}offsetHSL(e,i,s){return this.getHSL(Nm),this.setHSL(Nm.h+e,Nm.s+i,Nm.l+s)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,s){return this.r=e.r+(i.r-e.r)*s,this.g=e.g+(i.g-e.g)*s,this.b=e.b+(i.b-e.b)*s,this}lerpHSL(e,i){this.getHSL(Nm),e.getHSL(fR);const s=Fw(Nm.h,fR.h,i),r=Fw(Nm.s,fR.s,i),o=Fw(Nm.l,fR.l,i);return this.setHSL(s,r,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const i=this.r,s=this.g,r=this.b,o=e.elements;return this.r=o[0]*i+o[3]*s+o[6]*r,this.g=o[1]*i+o[4]*s+o[7]*r,this.b=o[2]*i+o[5]*s+o[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ea=new lr;lr.NAMES=j7;let gEe=0;class Vm extends oR{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:gEe++}),this.uuid=wh(),this.name="",this.type="Material",this.blending=C7,this.side=rR,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=_7,this.blendDst=M7,this.blendEquation=S7,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new lr(0,0,0),this.blendAlpha=0,this.depthFunc=I7,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=V7,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ab,this.stencilZFail=ab,this.stencilZPass=ab,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const i in e){const s=e[i];if(s===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const r=this[i];if(r===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(s):r&&r.isVector3&&s&&s.isVector3?r.copy(s):this[i]=s}}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});const s={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(s.dispersion=this.dispersion),this.iridescence!==void 0&&(s.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(s.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(s.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(s.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(s.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(e).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(e).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(e).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(e).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(e).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapRotation!==void 0&&(s.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==C7&&(s.blending=this.blending),this.side!==rR&&(s.side=this.side),this.vertexColors===!0&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=!0),this.blendSrc!==_7&&(s.blendSrc=this.blendSrc),this.blendDst!==M7&&(s.blendDst=this.blendDst),this.blendEquation!==S7&&(s.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(s.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(s.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(s.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(s.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(s.blendAlpha=this.blendAlpha),this.depthFunc!==I7&&(s.depthFunc=this.depthFunc),this.depthTest===!1&&(s.depthTest=this.depthTest),this.depthWrite===!1&&(s.depthWrite=this.depthWrite),this.colorWrite===!1&&(s.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(s.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==V7&&(s.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(s.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(s.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ab&&(s.stencilFail=this.stencilFail),this.stencilZFail!==ab&&(s.stencilZFail=this.stencilZFail),this.stencilZPass!==ab&&(s.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(s.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaHash===!0&&(s.alphaHash=!0),this.alphaToCoverage===!0&&(s.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=!0),this.forceSinglePass===!0&&(s.forceSinglePass=!0),this.wireframe===!0&&(s.wireframe=!0),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=!0),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),this.fog===!1&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData);function r(o){const a=[];for(const l in o){const c=o[l];delete c.metadata,a.push(c)}return a}if(i){const o=r(e.textures),a=r(e.images);o.length>0&&(s.textures=o),a.length>0&&(s.images=a)}return s}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const i=e.clippingPlanes;let s=null;if(i!==null){const r=i.length;s=new Array(r);for(let o=0;o!==r;++o)s[o]=i[o].clone()}return this.clippingPlanes=s,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class yb extends Vm{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new lr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new mR,this.combine=bTe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const cr=new xe,AR=new Ur;class Nl{constructor(e,i,s=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=s,this.usage=GD,this.updateRanges=[],this.gpuType=Em,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,i,s){e*=this.itemSize,s*=i.itemSize;for(let r=0,o=this.itemSize;r<o;r++)this.array[e+r]=i.array[s+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,s=this.count;i<s;i++)AR.fromBufferAttribute(this,i),AR.applyMatrix3(e),this.setXY(i,AR.x,AR.y);else if(this.itemSize===3)for(let i=0,s=this.count;i<s;i++)cr.fromBufferAttribute(this,i),cr.applyMatrix3(e),this.setXYZ(i,cr.x,cr.y,cr.z);return this}applyMatrix4(e){for(let i=0,s=this.count;i<s;i++)cr.fromBufferAttribute(this,i),cr.applyMatrix4(e),this.setXYZ(i,cr.x,cr.y,cr.z);return this}applyNormalMatrix(e){for(let i=0,s=this.count;i<s;i++)cr.fromBufferAttribute(this,i),cr.applyNormalMatrix(e),this.setXYZ(i,cr.x,cr.y,cr.z);return this}transformDirection(e){for(let i=0,s=this.count;i<s;i++)cr.fromBufferAttribute(this,i),cr.transformDirection(e),this.setXYZ(i,cr.x,cr.y,cr.z);return this}set(e,i=0){return this.array.set(e,i),this}getComponent(e,i){let s=this.array[e*this.itemSize+i];return this.normalized&&(s=Ch(s,this.array)),s}setComponent(e,i,s){return this.normalized&&(s=yn(s,this.array)),this.array[e*this.itemSize+i]=s,this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=Ch(i,this.array)),i}setX(e,i){return this.normalized&&(i=yn(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=Ch(i,this.array)),i}setY(e,i){return this.normalized&&(i=yn(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=Ch(i,this.array)),i}setZ(e,i){return this.normalized&&(i=yn(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=Ch(i,this.array)),i}setW(e,i){return this.normalized&&(i=yn(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,s){return e*=this.itemSize,this.normalized&&(i=yn(i,this.array),s=yn(s,this.array)),this.array[e+0]=i,this.array[e+1]=s,this}setXYZ(e,i,s,r){return e*=this.itemSize,this.normalized&&(i=yn(i,this.array),s=yn(s,this.array),r=yn(r,this.array)),this.array[e+0]=i,this.array[e+1]=s,this.array[e+2]=r,this}setXYZW(e,i,s,r,o){return e*=this.itemSize,this.normalized&&(i=yn(i,this.array),s=yn(s,this.array),r=yn(r,this.array),o=yn(o,this.array)),this.array[e+0]=i,this.array[e+1]=s,this.array[e+2]=r,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==GD&&(e.usage=this.usage),e}}class fEe extends Nl{constructor(e,i,s){super(new Uint16Array(e),i,s)}}class AEe extends Nl{constructor(e,i,s){super(new Uint32Array(e),i,s)}}class t5 extends Nl{constructor(e,i,s){super(new Float32Array(e),i,s)}}let yEe=0;const Rc=new Ji,i5=new Js,bb=new xe,Vl=new Sh,Ww=new Sh,Or=new xe;class Jh extends oR{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:yEe++}),this.uuid=wh(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(eEe(e)?AEe:fEe)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,s=0){this.groups.push({start:e,count:i,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const o=new g0().getNormalMatrix(e);s.applyNormalMatrix(o),s.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Rc.makeRotationFromQuaternion(e),this.applyMatrix4(Rc),this}rotateX(e){return Rc.makeRotationX(e),this.applyMatrix4(Rc),this}rotateY(e){return Rc.makeRotationY(e),this.applyMatrix4(Rc),this}rotateZ(e){return Rc.makeRotationZ(e),this.applyMatrix4(Rc),this}translate(e,i,s){return Rc.makeTranslation(e,i,s),this.applyMatrix4(Rc),this}scale(e,i,s){return Rc.makeScale(e,i,s),this.applyMatrix4(Rc),this}lookAt(e){return i5.lookAt(e),i5.updateMatrix(),this.applyMatrix4(i5.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(bb).negate(),this.translate(bb.x,bb.y,bb.z),this}setFromPoints(e){const i=this.getAttribute("position");if(i===void 0){const s=[];for(let r=0,o=e.length;r<o;r++){const a=e[r];s.push(a.x,a.y,a.z||0)}this.setAttribute("position",new t5(s,3))}else{const s=Math.min(e.length,i.count);for(let r=0;r<s;r++){const o=e[r];i.setXYZ(r,o.x,o.y,o.z||0)}e.length>i.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),i.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Sh);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new xe(-1/0,-1/0,-1/0),new xe(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let s=0,r=i.length;s<r;s++){const o=i[s];Vl.setFromBufferAttribute(o),this.morphTargetsRelative?(Or.addVectors(this.boundingBox.min,Vl.min),this.boundingBox.expandByPoint(Or),Or.addVectors(this.boundingBox.max,Vl.max),this.boundingBox.expandByPoint(Or)):(this.boundingBox.expandByPoint(Vl.min),this.boundingBox.expandByPoint(Vl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Mh);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new xe,1/0);return}if(e){const s=this.boundingSphere.center;if(Vl.setFromBufferAttribute(e),i)for(let o=0,a=i.length;o<a;o++){const l=i[o];Ww.setFromBufferAttribute(l),this.morphTargetsRelative?(Or.addVectors(Vl.min,Ww.min),Vl.expandByPoint(Or),Or.addVectors(Vl.max,Ww.max),Vl.expandByPoint(Or)):(Vl.expandByPoint(Ww.min),Vl.expandByPoint(Ww.max))}Vl.getCenter(s);let r=0;for(let o=0,a=e.count;o<a;o++)Or.fromBufferAttribute(e,o),r=Math.max(r,s.distanceToSquared(Or));if(i)for(let o=0,a=i.length;o<a;o++){const l=i[o],c=this.morphTargetsRelative;for(let h=0,d=l.count;h<d;h++)Or.fromBufferAttribute(l,h),c&&(bb.fromBufferAttribute(e,h),Or.add(bb)),r=Math.max(r,s.distanceToSquared(Or))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const s=i.position,r=i.normal,o=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Nl(new Float32Array(4*s.count),4));const a=this.getAttribute("tangent"),l=[],c=[];for(let I=0;I<s.count;I++)l[I]=new xe,c[I]=new xe;const h=new xe,d=new xe,u=new xe,p=new Ur,g=new Ur,f=new Ur,A=new xe,y=new xe;function b(I,B,M){h.fromBufferAttribute(s,I),d.fromBufferAttribute(s,B),u.fromBufferAttribute(s,M),p.fromBufferAttribute(o,I),g.fromBufferAttribute(o,B),f.fromBufferAttribute(o,M),d.sub(h),u.sub(h),g.sub(p),f.sub(p);const R=1/(g.x*f.y-f.x*g.y);isFinite(R)&&(A.copy(d).multiplyScalar(f.y).addScaledVector(u,-g.y).multiplyScalar(R),y.copy(u).multiplyScalar(g.x).addScaledVector(d,-f.x).multiplyScalar(R),l[I].add(A),l[B].add(A),l[M].add(A),c[I].add(y),c[B].add(y),c[M].add(y))}let v=this.groups;v.length===0&&(v=[{start:0,count:e.count}]);for(let I=0,B=v.length;I<B;++I){const M=v[I],R=M.start,k=M.count;for(let G=R,X=R+k;G<X;G+=3)b(e.getX(G+0),e.getX(G+1),e.getX(G+2))}const x=new xe,w=new xe,C=new xe,S=new xe;function _(I){C.fromBufferAttribute(r,I),S.copy(C);const B=l[I];x.copy(B),x.sub(C.multiplyScalar(C.dot(B))).normalize(),w.crossVectors(S,B);const M=w.dot(c[I])<0?-1:1;a.setXYZW(I,x.x,x.y,x.z,M)}for(let I=0,B=v.length;I<B;++I){const M=v[I],R=M.start,k=M.count;for(let G=R,X=R+k;G<X;G+=3)_(e.getX(G+0)),_(e.getX(G+1)),_(e.getX(G+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new Nl(new Float32Array(i.count*3),3),this.setAttribute("normal",s);else for(let p=0,g=s.count;p<g;p++)s.setXYZ(p,0,0,0);const r=new xe,o=new xe,a=new xe,l=new xe,c=new xe,h=new xe,d=new xe,u=new xe;if(e)for(let p=0,g=e.count;p<g;p+=3){const f=e.getX(p+0),A=e.getX(p+1),y=e.getX(p+2);r.fromBufferAttribute(i,f),o.fromBufferAttribute(i,A),a.fromBufferAttribute(i,y),d.subVectors(a,o),u.subVectors(r,o),d.cross(u),l.fromBufferAttribute(s,f),c.fromBufferAttribute(s,A),h.fromBufferAttribute(s,y),l.add(d),c.add(d),h.add(d),s.setXYZ(f,l.x,l.y,l.z),s.setXYZ(A,c.x,c.y,c.z),s.setXYZ(y,h.x,h.y,h.z)}else for(let p=0,g=i.count;p<g;p+=3)r.fromBufferAttribute(i,p+0),o.fromBufferAttribute(i,p+1),a.fromBufferAttribute(i,p+2),d.subVectors(a,o),u.subVectors(r,o),d.cross(u),s.setXYZ(p+0,d.x,d.y,d.z),s.setXYZ(p+1,d.x,d.y,d.z),s.setXYZ(p+2,d.x,d.y,d.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,s=e.count;i<s;i++)Or.fromBufferAttribute(e,i),Or.normalize(),e.setXYZ(i,Or.x,Or.y,Or.z)}toNonIndexed(){function e(l,c){const h=l.array,d=l.itemSize,u=l.normalized,p=new h.constructor(c.length*d);let g=0,f=0;for(let A=0,y=c.length;A<y;A++){l.isInterleavedBufferAttribute?g=c[A]*l.data.stride+l.offset:g=c[A]*d;for(let b=0;b<d;b++)p[f++]=h[g++]}return new Nl(p,d,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Jh,s=this.index.array,r=this.attributes;for(const l in r){const c=r[l],h=e(c,s);i.setAttribute(l,h)}const o=this.morphAttributes;for(const l in o){const c=[],h=o[l];for(let d=0,u=h.length;d<u;d++){const p=h[d],g=e(p,s);c.push(g)}i.morphAttributes[l]=c}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let l=0,c=a.length;l<c;l++){const h=a[l];i.addGroup(h.start,h.count,h.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const h in c)c[h]!==void 0&&(e[h]=c[h]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const s=this.attributes;for(const c in s){const h=s[c];e.data.attributes[c]=h.toJSON(e.data)}const r={};let o=!1;for(const c in this.morphAttributes){const h=this.morphAttributes[c],d=[];for(let u=0,p=h.length;u<p;u++){const g=h[u];d.push(g.toJSON(e.data))}d.length>0&&(r[c]=d,o=!0)}o&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const s=e.index;s!==null&&this.setIndex(s.clone(i));const r=e.attributes;for(const h in r){const d=r[h];this.setAttribute(h,d.clone(i))}const o=e.morphAttributes;for(const h in o){const d=[],u=o[h];for(let p=0,g=u.length;p<g;p++)d.push(u[p].clone(i));this.morphAttributes[h]=d}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let h=0,d=a.length;h<d;h++){const u=a[h];this.addGroup(u.start,u.count,u.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const J7=new Ji,y0=new uR,yR=new Mh,q7=new xe,bR=new xe,vR=new xe,xR=new xe,n5=new xe,wR=new xe,$7=new xe,CR=new xe;class Xm extends Js{constructor(e=new Jh,i=new yb){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(e,i){const s=this.geometry,r=s.attributes.position,o=s.morphAttributes.position,a=s.morphTargetsRelative;i.fromBufferAttribute(r,e);const l=this.morphTargetInfluences;if(o&&l){wR.set(0,0,0);for(let c=0,h=o.length;c<h;c++){const d=l[c],u=o[c];d!==0&&(n5.fromBufferAttribute(u,e),a?wR.addScaledVector(n5,d):wR.addScaledVector(n5.sub(i),d))}i.add(wR)}return i}raycast(e,i){const s=this.geometry,r=this.material,o=this.matrixWorld;r!==void 0&&(s.boundingSphere===null&&s.computeBoundingSphere(),yR.copy(s.boundingSphere),yR.applyMatrix4(o),y0.copy(e.ray).recast(e.near),!(yR.containsPoint(y0.origin)===!1&&(y0.intersectSphere(yR,q7)===null||y0.origin.distanceToSquared(q7)>(e.far-e.near)**2))&&(J7.copy(o).invert(),y0.copy(e.ray).applyMatrix4(J7),!(s.boundingBox!==null&&y0.intersectsBox(s.boundingBox)===!1)&&this._computeIntersections(e,i,y0)))}_computeIntersections(e,i,s){let r;const o=this.geometry,a=this.material,l=o.index,c=o.attributes.position,h=o.attributes.uv,d=o.attributes.uv1,u=o.attributes.normal,p=o.groups,g=o.drawRange;if(l!==null)if(Array.isArray(a))for(let f=0,A=p.length;f<A;f++){const y=p[f],b=a[y.materialIndex],v=Math.max(y.start,g.start),x=Math.min(l.count,Math.min(y.start+y.count,g.start+g.count));for(let w=v,C=x;w<C;w+=3){const S=l.getX(w),_=l.getX(w+1),I=l.getX(w+2);r=SR(this,b,e,s,h,d,u,S,_,I),r&&(r.faceIndex=Math.floor(w/3),r.face.materialIndex=y.materialIndex,i.push(r))}}else{const f=Math.max(0,g.start),A=Math.min(l.count,g.start+g.count);for(let y=f,b=A;y<b;y+=3){const v=l.getX(y),x=l.getX(y+1),w=l.getX(y+2);r=SR(this,a,e,s,h,d,u,v,x,w),r&&(r.faceIndex=Math.floor(y/3),i.push(r))}}else if(c!==void 0)if(Array.isArray(a))for(let f=0,A=p.length;f<A;f++){const y=p[f],b=a[y.materialIndex],v=Math.max(y.start,g.start),x=Math.min(c.count,Math.min(y.start+y.count,g.start+g.count));for(let w=v,C=x;w<C;w+=3){const S=w,_=w+1,I=w+2;r=SR(this,b,e,s,h,d,u,S,_,I),r&&(r.faceIndex=Math.floor(w/3),r.face.materialIndex=y.materialIndex,i.push(r))}}else{const f=Math.max(0,g.start),A=Math.min(c.count,g.start+g.count);for(let y=f,b=A;y<b;y+=3){const v=y,x=y+1,w=y+2;r=SR(this,a,e,s,h,d,u,v,x,w),r&&(r.faceIndex=Math.floor(y/3),i.push(r))}}}}function bEe(n,e,i,s,r,o,a,l){let c;if(e.side===ATe?c=s.intersectTriangle(a,o,r,!0,l):c=s.intersectTriangle(r,o,a,e.side===rR,l),c===null)return null;CR.copy(l),CR.applyMatrix4(n.matrixWorld);const h=i.ray.origin.distanceTo(CR);return h<i.near||h>i.far?null:{distance:h,point:CR.clone(),object:n}}function SR(n,e,i,s,r,o,a,l,c,h){n.getVertexPosition(l,bR),n.getVertexPosition(c,vR),n.getVertexPosition(h,xR);const d=bEe(n,e,i,s,bR,vR,xR,$7);if(d){const u=new xe;ed.getBarycoord($7,bR,vR,xR,u),r&&(d.uv=ed.getInterpolatedAttribute(r,l,c,h,u,new Ur)),o&&(d.uv1=ed.getInterpolatedAttribute(o,l,c,h,u,new Ur)),a&&(d.normal=ed.getInterpolatedAttribute(a,l,c,h,u,new xe),d.normal.dot(s.direction)>0&&d.normal.multiplyScalar(-1));const p={a:l,b:c,c:h,normal:new xe,materialIndex:0};ed.getNormal(bR,vR,xR,p.normal),d.face=p,d.barycoord=u}return d}let eq=class extends Js{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ji,this.projectionMatrix=new Ji,this.projectionMatrixInverse=new Ji,this.coordinateSystem=m0}copy(n,e){return super.copy(n,e),this.matrixWorldInverse.copy(n.matrixWorldInverse),this.projectionMatrix.copy(n.projectionMatrix),this.projectionMatrixInverse.copy(n.projectionMatrixInverse),this.coordinateSystem=n.coordinateSystem,this}getWorldDirection(n){return super.getWorldDirection(n).negate()}updateMatrixWorld(n){super.updateMatrixWorld(n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(n,e){super.updateWorldMatrix(n,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const Dm=new xe,tq=new Ur,iq=new Ur;class s5 extends eq{constructor(e=50,i=1,s=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=s,this.far=r,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const i=.5*this.getFilmHeight()/e;this.fov=zw*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Dw*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return zw*2*Math.atan(Math.tan(Dw*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,i,s){Dm.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Dm.x,Dm.y).multiplyScalar(-e/Dm.z),Dm.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),s.set(Dm.x,Dm.y).multiplyScalar(-e/Dm.z)}getViewSize(e,i){return this.getViewBounds(e,tq,iq),i.subVectors(iq,tq)}setViewOffset(e,i,s,r,o,a){this.aspect=e/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=s,this.view.offsetY=r,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let i=e*Math.tan(Dw*.5*this.fov)/this.zoom,s=2*i,r=this.aspect*s,o=-.5*r;const a=this.view;if(this.view!==null&&this.view.enabled){const c=a.fullWidth,h=a.fullHeight;o+=a.offsetX*r/c,i-=a.offsetY*s/h,r*=a.width/c,s*=a.height/h}const l=this.filmOffset;l!==0&&(o+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+r,i,i-s,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}class vEe{constructor(e,i){this.isInterleavedBuffer=!0,this.array=e,this.stride=i,this.count=e!==void 0?e.length/i:0,this.usage=GD,this.updateRanges=[],this.version=0,this.uuid=wh()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,i,s){e*=this.stride,s*=i.stride;for(let r=0,o=this.stride;r<o;r++)this.array[e+r]=i.array[s+r];return this}set(e,i=0){return this.array.set(e,i),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=wh()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),s=new this.constructor(i,this.stride);return s.setUsage(this.usage),s}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=wh()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ta=new xe;class XZ{constructor(e,i,s,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=s,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,s=this.data.count;i<s;i++)Ta.fromBufferAttribute(this,i),Ta.applyMatrix4(e),this.setXYZ(i,Ta.x,Ta.y,Ta.z);return this}applyNormalMatrix(e){for(let i=0,s=this.count;i<s;i++)Ta.fromBufferAttribute(this,i),Ta.applyNormalMatrix(e),this.setXYZ(i,Ta.x,Ta.y,Ta.z);return this}transformDirection(e){for(let i=0,s=this.count;i<s;i++)Ta.fromBufferAttribute(this,i),Ta.transformDirection(e),this.setXYZ(i,Ta.x,Ta.y,Ta.z);return this}getComponent(e,i){let s=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(s=Ch(s,this.array)),s}setComponent(e,i,s){return this.normalized&&(s=yn(s,this.array)),this.data.array[e*this.data.stride+this.offset+i]=s,this}setX(e,i){return this.normalized&&(i=yn(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=yn(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=yn(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=yn(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=Ch(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=Ch(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=Ch(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=Ch(i,this.array)),i}setXY(e,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=yn(i,this.array),s=yn(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=s,this}setXYZ(e,i,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(i=yn(i,this.array),s=yn(s,this.array),r=yn(r,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=s,this.data.array[e+2]=r,this}setXYZW(e,i,s,r,o){return e=e*this.data.stride+this.offset,this.normalized&&(i=yn(i,this.array),s=yn(s,this.array),r=yn(r,this.array),o=yn(o,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=s,this.data.array[e+2]=r,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let s=0;s<this.count;s++){const r=s*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[r+o])}return new Nl(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new XZ(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let s=0;s<this.count;s++){const r=s*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[r+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const nq=new xe,sq=new Gl,rq=new Gl,xEe=new xe,oq=new Ji,_R=new xe,r5=new Mh,aq=new Ji,o5=new uR;class wEe extends Xm{constructor(e,i){super(e,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=T7,this.bindMatrix=new Ji,this.bindMatrixInverse=new Ji,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Sh),this.boundingBox.makeEmpty();const i=e.getAttribute("position");for(let s=0;s<i.count;s++)this.getVertexPosition(s,_R),this.boundingBox.expandByPoint(_R)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Mh),this.boundingSphere.makeEmpty();const i=e.getAttribute("position");for(let s=0;s<i.count;s++)this.getVertexPosition(s,_R),this.boundingSphere.expandByPoint(_R)}copy(e,i){return super.copy(e,i),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,i){const s=this.material,r=this.matrixWorld;s!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),r5.copy(this.boundingSphere),r5.applyMatrix4(r),e.ray.intersectsSphere(r5)!==!1&&(aq.copy(r).invert(),o5.copy(e.ray).applyMatrix4(aq),!(this.boundingBox!==null&&o5.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,i,o5)))}getVertexPosition(e,i){return super.getVertexPosition(e,i),this.applyBoneTransform(e,i),i}bind(e,i){this.skeleton=e,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Gl,i=this.geometry.attributes.skinWeight;for(let s=0,r=i.count;s<r;s++){e.fromBufferAttribute(i,s);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),i.setXYZW(s,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===T7?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===vTe?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,i){const s=this.skeleton,r=this.geometry;sq.fromBufferAttribute(r.attributes.skinIndex,e),rq.fromBufferAttribute(r.attributes.skinWeight,e),nq.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let o=0;o<4;o++){const a=rq.getComponent(o);if(a!==0){const l=sq.getComponent(o);oq.multiplyMatrices(s.bones[l].matrixWorld,s.boneInverses[l]),i.addScaledVector(xEe.copy(nq).applyMatrix4(oq),a)}}return i.applyMatrix4(this.bindMatrixInverse)}}class lq extends Js{constructor(){super(),this.isBone=!0,this.type="Bone"}}class a5 extends ro{constructor(e=null,i=1,s=1,r,o,a,l,c,h=sb,d=sb,u,p){super(null,a,l,c,h,d,r,o,u,p),this.isDataTexture=!0,this.image={data:e,width:i,height:s},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const cq=new Ji,CEe=new Ji;class DZ{constructor(e=[],i=[]){this.uuid=wh(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),i.length===0)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let s=0,r=this.bones.length;s<r;s++)this.boneInverses.push(new Ji)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){const s=new Ji;this.bones[e]&&s.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(s)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){const s=this.bones[e];s&&s.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){const s=this.bones[e];s&&(s.parent&&s.parent.isBone?(s.matrix.copy(s.parent.matrixWorld).invert(),s.matrix.multiply(s.matrixWorld)):s.matrix.copy(s.matrixWorld),s.matrix.decompose(s.position,s.quaternion,s.scale))}}update(){const e=this.bones,i=this.boneInverses,s=this.boneMatrices,r=this.boneTexture;for(let o=0,a=e.length;o<a;o++){const l=e[o]?e[o].matrixWorld:CEe;cq.multiplyMatrices(l,i[o]),cq.toArray(s,o*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new DZ(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4);i.set(this.boneMatrices);const s=new a5(i,e,e,Rm,Em);return s.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=s,this}getBoneByName(e){for(let i=0,s=this.bones.length;i<s;i++){const r=this.bones[i];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let s=0,r=e.bones.length;s<r;s++){const o=e.bones[s];let a=i[o];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),a=new lq),this.bones.push(a),this.boneInverses.push(new Ji().fromArray(e.boneInverses[s]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const i=this.bones,s=this.boneInverses;for(let r=0,o=i.length;r<o;r++){const a=i[r];e.bones.push(a.uuid);const l=s[r];e.boneInverses.push(l.toArray())}return e}}class l5 extends Nl{constructor(e,i,s,r=1){super(e,i,s),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const vb=new Ji,hq=new Ji,MR=[],dq=new Sh,SEe=new Ji,Hw=new Xm,Qw=new Mh;class _Ee extends Xm{constructor(e,i,s){super(e,i),this.isInstancedMesh=!0,this.instanceMatrix=new l5(new Float32Array(s*16),16),this.instanceColor=null,this.morphTexture=null,this.count=s,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<s;r++)this.setMatrixAt(r,SEe)}computeBoundingBox(){const e=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new Sh),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let s=0;s<i;s++)this.getMatrixAt(s,vb),dq.copy(e.boundingBox).applyMatrix4(vb),this.boundingBox.union(dq)}computeBoundingSphere(){const e=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new Mh),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let s=0;s<i;s++)this.getMatrixAt(s,vb),Qw.copy(e.boundingSphere).applyMatrix4(vb),this.boundingSphere.union(Qw)}copy(e,i){return super.copy(e,i),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,i){i.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,i){i.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,i){const s=i.morphTargetInfluences,r=this.morphTexture.source.data.data,o=s.length+1,a=e*o+1;for(let l=0;l<s.length;l++)s[l]=r[a+l]}raycast(e,i){const s=this.matrixWorld,r=this.count;if(Hw.geometry=this.geometry,Hw.material=this.material,Hw.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Qw.copy(this.boundingSphere),Qw.applyMatrix4(s),e.ray.intersectsSphere(Qw)!==!1))for(let o=0;o<r;o++){this.getMatrixAt(o,vb),hq.multiplyMatrices(s,vb),Hw.matrixWorld=hq,Hw.raycast(e,MR);for(let a=0,l=MR.length;a<l;a++){const c=MR[a];c.instanceId=o,c.object=this,i.push(c)}MR.length=0}}setColorAt(e,i){this.instanceColor===null&&(this.instanceColor=new l5(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),i.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,i){i.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,i){const s=i.morphTargetInfluences,r=s.length+1;this.morphTexture===null&&(this.morphTexture=new a5(new Float32Array(r*this.count),r,this.count,ob,Em));const o=this.morphTexture.source.data.data;let a=0;for(let h=0;h<s.length;h++)a+=s[h];const l=this.geometry.morphTargetsRelative?1:1-a,c=r*e;o[c]=l,o.set(s,c+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}const c5=new xe,MEe=new xe,IEe=new g0;class xb{constructor(e=new xe(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,s,r){return this.normal.set(e,i,s),this.constant=r,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,s){const r=c5.subVectors(s,i).cross(MEe.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,i){const s=e.delta(c5),r=this.normal.dot(s);if(r===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/r;return o<0||o>1?null:i.copy(e.start).addScaledVector(s,o)}intersectsLine(e){const i=this.distanceToPoint(e.start),s=this.distanceToPoint(e.end);return i<0&&s>0||s<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){const s=i||IEe.getNormalMatrix(e),r=this.coplanarPoint(c5).applyMatrix4(e),o=this.normal.applyMatrix3(s).normalize();return this.constant=-r.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const b0=new Mh,IR=new xe;class TEe{constructor(e=new xb,i=new xb,s=new xb,r=new xb,o=new xb,a=new xb){this.planes=[e,i,s,r,o,a]}set(e,i,s,r,o,a){const l=this.planes;return l[0].copy(e),l[1].copy(i),l[2].copy(s),l[3].copy(r),l[4].copy(o),l[5].copy(a),this}copy(e){const i=this.planes;for(let s=0;s<6;s++)i[s].copy(e.planes[s]);return this}setFromProjectionMatrix(e,i=m0){const s=this.planes,r=e.elements,o=r[0],a=r[1],l=r[2],c=r[3],h=r[4],d=r[5],u=r[6],p=r[7],g=r[8],f=r[9],A=r[10],y=r[11],b=r[12],v=r[13],x=r[14],w=r[15];if(s[0].setComponents(c-o,p-h,y-g,w-b).normalize(),s[1].setComponents(c+o,p+h,y+g,w+b).normalize(),s[2].setComponents(c+a,p+d,y+f,w+v).normalize(),s[3].setComponents(c-a,p-d,y-f,w-v).normalize(),s[4].setComponents(c-l,p-u,y-A,w-x).normalize(),i===m0)s[5].setComponents(c+l,p+u,y+A,w+x).normalize();else if(i===PD)s[5].setComponents(l,u,A,x).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),b0.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const i=e.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),b0.copy(i.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(b0)}intersectsSprite(e){return b0.center.set(0,0,0),b0.radius=.7071067811865476,b0.applyMatrix4(e.matrixWorld),this.intersectsSphere(b0)}intersectsSphere(e){const i=this.planes,s=e.center,r=-e.radius;for(let o=0;o<6;o++)if(i[o].distanceToPoint(s)<r)return!1;return!0}intersectsBox(e){const i=this.planes;for(let s=0;s<6;s++){const r=i[s];if(IR.x=r.normal.x>0?e.max.x:e.min.x,IR.y=r.normal.y>0?e.max.y:e.min.y,IR.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(IR)<0)return!1}return!0}containsPoint(e){const i=this.planes;for(let s=0;s<6;s++)if(i[s].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class uq extends Vm{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new lr(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const TR=new xe,ER=new xe,pq=new Ji,Kw=new uR,RR=new Mh,h5=new xe,mq=new xe;class d5 extends Js{constructor(e=new Jh,i=new uq){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,s=[0];for(let r=1,o=i.count;r<o;r++)TR.fromBufferAttribute(i,r-1),ER.fromBufferAttribute(i,r),s[r]=s[r-1],s[r]+=TR.distanceTo(ER);e.setAttribute("lineDistance",new t5(s,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,i){const s=this.geometry,r=this.matrixWorld,o=e.params.Line.threshold,a=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),RR.copy(s.boundingSphere),RR.applyMatrix4(r),RR.radius+=o,e.ray.intersectsSphere(RR)===!1)return;pq.copy(r).invert(),Kw.copy(e.ray).applyMatrix4(pq);const l=o/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,h=this.isLineSegments?2:1,d=s.index,u=s.attributes.position;if(d!==null){const p=Math.max(0,a.start),g=Math.min(d.count,a.start+a.count);for(let f=p,A=g-1;f<A;f+=h){const y=d.getX(f),b=d.getX(f+1),v=LR(this,e,Kw,c,y,b);v&&i.push(v)}if(this.isLineLoop){const f=d.getX(g-1),A=d.getX(p),y=LR(this,e,Kw,c,f,A);y&&i.push(y)}}else{const p=Math.max(0,a.start),g=Math.min(u.count,a.start+a.count);for(let f=p,A=g-1;f<A;f+=h){const y=LR(this,e,Kw,c,f,f+1);y&&i.push(y)}if(this.isLineLoop){const f=LR(this,e,Kw,c,g-1,p);f&&i.push(f)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function LR(n,e,i,s,r,o){const a=n.geometry.attributes.position;if(TR.fromBufferAttribute(a,r),ER.fromBufferAttribute(a,o),i.distanceSqToSegment(TR,ER,h5,mq)>s)return;h5.applyMatrix4(n.matrixWorld);const l=e.ray.origin.distanceTo(h5);if(!(l<e.near||l>e.far))return{distance:l,point:mq.clone().applyMatrix4(n.matrixWorld),index:r,face:null,faceIndex:null,barycoord:null,object:n}}const gq=new xe,fq=new xe;class EEe extends d5{constructor(e,i){super(e,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,s=[];for(let r=0,o=i.count;r<o;r+=2)gq.fromBufferAttribute(i,r),fq.fromBufferAttribute(i,r+1),s[r]=r===0?0:s[r-1],s[r+1]=s[r]+gq.distanceTo(fq);e.setAttribute("lineDistance",new t5(s,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class REe extends d5{constructor(e,i){super(e,i),this.isLineLoop=!0,this.type="LineLoop"}}class Aq extends Vm{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new lr(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const yq=new Ji,u5=new uR,BR=new Mh,kR=new xe;class LEe extends Js{constructor(e=new Jh,i=new Aq){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,i){const s=this.geometry,r=this.matrixWorld,o=e.params.Points.threshold,a=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),BR.copy(s.boundingSphere),BR.applyMatrix4(r),BR.radius+=o,e.ray.intersectsSphere(BR)===!1)return;yq.copy(r).invert(),u5.copy(e.ray).applyMatrix4(yq);const l=o/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,h=s.index,d=s.attributes.position;if(h!==null){const u=Math.max(0,a.start),p=Math.min(h.count,a.start+a.count);for(let g=u,f=p;g<f;g++){const A=h.getX(g);kR.fromBufferAttribute(d,A),bq(kR,A,c,r,e,i,this)}}else{const u=Math.max(0,a.start),p=Math.min(d.count,a.start+a.count);for(let g=u,f=p;g<f;g++)kR.fromBufferAttribute(d,g),bq(kR,g,c,r,e,i,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function bq(n,e,i,s,r,o,a){const l=u5.distanceSqToPoint(n);if(l<i){const c=new xe;u5.closestPointToPoint(n,c),c.applyMatrix4(s);const h=r.ray.origin.distanceTo(c);if(h<r.near||h>r.far)return;o.push({distance:h,distanceToRay:Math.sqrt(l),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:a})}}class p5 extends Js{constructor(){super(),this.isGroup=!0,this.type="Group"}}class GR extends ro{constructor(e,i,s,r,o,a,l,c,h,d,u,p){super(null,a,l,c,h,d,r,o,u,p),this.isCompressedTexture=!0,this.image={width:i,height:s},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class BEe extends GR{constructor(e,i,s,r,o,a){super(e,i,s,o,a),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=p0,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class kEe extends GR{constructor(e,i,s){super(void 0,e[0].width,e[0].height,i,s,xTe),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class PR extends Vm{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new lr(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=NTe,this.normalScale=new Ur(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new mR,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Sd extends PR{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ur(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ki(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new lr(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new lr(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new lr(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function NR(n,e,i){return!n||!i&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function GEe(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function PEe(n){function e(r,o){return n[r]-n[o]}const i=n.length,s=new Array(i);for(let r=0;r!==i;++r)s[r]=r;return s.sort(e),s}function vq(n,e,i){const s=n.length,r=new n.constructor(s);for(let o=0,a=0;a!==s;++o){const l=i[o]*e;for(let c=0;c!==e;++c)r[a++]=n[l+c]}return r}function xq(n,e,i,s){let r=1,o=n[0];for(;o!==void 0&&o[s]===void 0;)o=n[r++];if(o===void 0)return;let a=o[s];if(a!==void 0)if(Array.isArray(a))do a=o[s],a!==void 0&&(e.push(o.time),i.push.apply(i,a)),o=n[r++];while(o!==void 0);else if(a.toArray!==void 0)do a=o[s],a!==void 0&&(e.push(o.time),a.toArray(i,i.length)),o=n[r++];while(o!==void 0);else do a=o[s],a!==void 0&&(e.push(o.time),i.push(a)),o=n[r++];while(o!==void 0)}class Yw{constructor(e,i,s,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new i.constructor(s),this.sampleValues=i,this.valueSize=s,this.settings=null,this.DefaultSettings_={}}evaluate(e){const i=this.parameterPositions;let s=this._cachedIndex,r=i[s],o=i[s-1];e:{t:{let a;i:{n:if(!(e<r)){for(let l=s+2;;){if(r===void 0){if(e<o)break n;return s=i.length,this._cachedIndex=s,this.copySampleValue_(s-1)}if(s===l)break;if(o=r,r=i[++s],e<r)break t}a=i.length;break i}if(!(e>=o)){const l=i[1];e<l&&(s=2,o=l);for(let c=s-2;;){if(o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===c)break;if(r=o,o=i[--s-1],e>=o)break t}a=s,s=0;break i}break e}for(;s<a;){const l=s+a>>>1;e<i[l]?a=l:s=l+1}if(r=i[s],o=i[s-1],o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return s=i.length,this._cachedIndex=s,this.copySampleValue_(s-1)}this._cachedIndex=s,this.intervalChanged_(s,o,r)}return this.interpolate_(s,o,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const i=this.resultBuffer,s=this.sampleValues,r=this.valueSize,o=e*r;for(let a=0;a!==r;++a)i[a]=s[o+a];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class NEe extends Yw{constructor(e,i,s,r){super(e,i,s,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:B7,endingEnd:B7}}intervalChanged_(e,i,s){const r=this.parameterPositions;let o=e-2,a=e+1,l=r[o],c=r[a];if(l===void 0)switch(this.getSettings_().endingStart){case k7:o=e,l=2*i-s;break;case G7:o=r.length-2,l=i+r[o]-r[o+1];break;default:o=e,l=s}if(c===void 0)switch(this.getSettings_().endingEnd){case k7:a=e,c=2*s-i;break;case G7:a=1,c=s+r[1]-r[0];break;default:a=e-1,c=i}const h=(s-i)*.5,d=this.valueSize;this._weightPrev=h/(i-l),this._weightNext=h/(c-s),this._offsetPrev=o*d,this._offsetNext=a*d}interpolate_(e,i,s,r){const o=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=e*l,h=c-l,d=this._offsetPrev,u=this._offsetNext,p=this._weightPrev,g=this._weightNext,f=(s-i)/(r-i),A=f*f,y=A*f,b=-p*y+2*p*A-p*f,v=(1+p)*y+(-1.5-2*p)*A+(-.5+p)*f+1,x=(-1-g)*y+(1.5+g)*A+.5*f,w=g*y-g*A;for(let C=0;C!==l;++C)o[C]=b*a[d+C]+v*a[h+C]+x*a[c+C]+w*a[u+C];return o}}class VEe extends Yw{constructor(e,i,s,r){super(e,i,s,r)}interpolate_(e,i,s,r){const o=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=e*l,h=c-l,d=(s-i)/(r-i),u=1-d;for(let p=0;p!==l;++p)o[p]=a[h+p]*u+a[c+p]*d;return o}}class XEe extends Yw{constructor(e,i,s,r){super(e,i,s,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class _d{constructor(e,i,s,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=NR(i,this.TimeBufferType),this.values=NR(s,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const i=e.constructor;let s;if(i.toJSON!==this.toJSON)s=i.toJSON(e);else{s={name:e.name,times:NR(e.times,Array),values:NR(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(s.interpolation=r)}return s.type=e.ValueTypeName,s}InterpolantFactoryMethodDiscrete(e){return new XEe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new VEe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new NEe(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let i;switch(e){case Vw:i=this.InterpolantFactoryMethodDiscrete;break;case Xw:i=this.InterpolantFactoryMethodLinear;break;case RD:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const s="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(s);return console.warn("THREE.KeyframeTrack:",s),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Vw;case this.InterpolantFactoryMethodLinear:return Xw;case this.InterpolantFactoryMethodSmooth:return RD}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const i=this.times;for(let s=0,r=i.length;s!==r;++s)i[s]+=e}return this}scale(e){if(e!==1){const i=this.times;for(let s=0,r=i.length;s!==r;++s)i[s]*=e}return this}trim(e,i){const s=this.times,r=s.length;let o=0,a=r-1;for(;o!==r&&s[o]<e;)++o;for(;a!==-1&&s[a]>i;)--a;if(++a,o!==0||a!==r){o>=a&&(a=Math.max(a,1),o=a-1);const l=this.getValueSize();this.times=s.slice(o,a),this.values=this.values.slice(o*l,a*l)}return this}validate(){let e=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const s=this.times,r=this.values,o=s.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let l=0;l!==o;l++){const c=s[l];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,l,c),e=!1;break}if(a!==null&&a>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,l,c,a),e=!1;break}a=c}if(r!==void 0&&GEe(r))for(let l=0,c=r.length;l!==c;++l){const h=r[l];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,h),e=!1;break}}return e}optimize(){const e=this.times.slice(),i=this.values.slice(),s=this.getValueSize(),r=this.getInterpolation()===RD,o=e.length-1;let a=1;for(let l=1;l<o;++l){let c=!1;const h=e[l],d=e[l+1];if(h!==d&&(l!==1||h!==e[0]))if(r)c=!0;else{const u=l*s,p=u-s,g=u+s;for(let f=0;f!==s;++f){const A=i[u+f];if(A!==i[p+f]||A!==i[g+f]){c=!0;break}}}if(c){if(l!==a){e[a]=e[l];const u=l*s,p=a*s;for(let g=0;g!==s;++g)i[p+g]=i[u+g]}++a}}if(o>0){e[a]=e[o];for(let l=o*s,c=a*s,h=0;h!==s;++h)i[c+h]=i[l+h];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=i.slice(0,a*s)):(this.times=e,this.values=i),this}clone(){const e=this.times.slice(),i=this.values.slice(),s=this.constructor,r=new s(this.name,e,i);return r.createInterpolant=this.createInterpolant,r}}_d.prototype.TimeBufferType=Float32Array,_d.prototype.ValueBufferType=Float32Array,_d.prototype.DefaultInterpolation=Xw;class wb extends _d{constructor(e,i,s){super(e,i,s)}}wb.prototype.ValueTypeName="bool",wb.prototype.ValueBufferType=Array,wb.prototype.DefaultInterpolation=Vw,wb.prototype.InterpolantFactoryMethodLinear=void 0,wb.prototype.InterpolantFactoryMethodSmooth=void 0;class wq extends _d{}wq.prototype.ValueTypeName="color";class Cb extends _d{}Cb.prototype.ValueTypeName="number";class DEe extends Yw{constructor(e,i,s,r){super(e,i,s,r)}interpolate_(e,i,s,r){const o=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=(s-i)/(r-i);let h=e*l;for(let d=h+l;h!==d;h+=4)Lm.slerpFlat(o,0,a,h-l,a,h,c);return o}}class Sb extends _d{InterpolantFactoryMethodLinear(e){return new DEe(this.times,this.values,this.getValueSize(),e)}}Sb.prototype.ValueTypeName="quaternion",Sb.prototype.InterpolantFactoryMethodSmooth=void 0;class _b extends _d{constructor(e,i,s){super(e,i,s)}}_b.prototype.ValueTypeName="string",_b.prototype.ValueBufferType=Array,_b.prototype.DefaultInterpolation=Vw,_b.prototype.InterpolantFactoryMethodLinear=void 0,_b.prototype.InterpolantFactoryMethodSmooth=void 0;class Mb extends _d{}Mb.prototype.ValueTypeName="vector";class zEe{constructor(e="",i=-1,s=[],r=GTe){this.name=e,this.tracks=s,this.duration=i,this.blendMode=r,this.uuid=wh(),this.duration<0&&this.resetDuration()}static parse(e){const i=[],s=e.tracks,r=1/(e.fps||1);for(let a=0,l=s.length;a!==l;++a)i.push(UEe(s[a]).scale(r));const o=new this(e.name,e.duration,i,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const i=[],s=e.tracks,r={name:e.name,duration:e.duration,tracks:i,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,a=s.length;o!==a;++o)i.push(_d.toJSON(s[o]));return r}static CreateFromMorphTargetSequence(e,i,s,r){const o=i.length,a=[];for(let l=0;l<o;l++){let c=[],h=[];c.push((l+o-1)%o,l,(l+1)%o),h.push(0,1,0);const d=PEe(c);c=vq(c,1,d),h=vq(h,1,d),!r&&c[0]===0&&(c.push(o),h.push(h[0])),a.push(new Cb(".morphTargetInfluences["+i[l].name+"]",c,h).scale(1/s))}return new this(e,-1,a)}static findByName(e,i){let s=e;if(!Array.isArray(e)){const r=e;s=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<s.length;r++)if(s[r].name===i)return s[r];return null}static CreateClipsFromMorphTargetSequences(e,i,s){const r={},o=/^([\w-]*?)([\d]+)$/;for(let l=0,c=e.length;l<c;l++){const h=e[l],d=h.name.match(o);if(d&&d.length>1){const u=d[1];let p=r[u];p||(r[u]=p=[]),p.push(h)}}const a=[];for(const l in r)a.push(this.CreateFromMorphTargetSequence(l,r[l],i,s));return a}static parseAnimation(e,i){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const s=function(d,u,p,g,f){if(p.length!==0){const A=[],y=[];xq(p,A,y,g),A.length!==0&&f.push(new d(u,A,y))}},r=[],o=e.name||"default",a=e.fps||30,l=e.blendMode;let c=e.length||-1;const h=e.hierarchy||[];for(let d=0;d<h.length;d++){const u=h[d].keys;if(!(!u||u.length===0))if(u[0].morphTargets){const p={};let g;for(g=0;g<u.length;g++)if(u[g].morphTargets)for(let f=0;f<u[g].morphTargets.length;f++)p[u[g].morphTargets[f]]=-1;for(const f in p){const A=[],y=[];for(let b=0;b!==u[g].morphTargets.length;++b){const v=u[g];A.push(v.time),y.push(v.morphTarget===f?1:0)}r.push(new Cb(".morphTargetInfluence["+f+"]",A,y))}c=p.length*a}else{const p=".bones["+i[d].name+"]";s(Mb,p+".position",u,"pos",r),s(Sb,p+".quaternion",u,"rot",r),s(Mb,p+".scale",u,"scl",r)}}return r.length===0?null:new this(o,c,r,l)}resetDuration(){const e=this.tracks;let i=0;for(let s=0,r=e.length;s!==r;++s){const o=this.tracks[s];i=Math.max(i,o.times[o.times.length-1])}return this.duration=i,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function FEe(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Cb;case"vector":case"vector2":case"vector3":case"vector4":return Mb;case"color":return wq;case"quaternion":return Sb;case"bool":case"boolean":return wb;case"string":return _b}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function UEe(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=FEe(n.type);if(n.times===void 0){const i=[],s=[];xq(n.keys,i,s,"value"),n.times=i,n.values=s}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const zm={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class OEe{constructor(e,i,s){const r=this;let o=!1,a=0,l=0,c;const h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=s,this.itemStart=function(d){l++,o===!1&&r.onStart!==void 0&&r.onStart(d,a,l),o=!0},this.itemEnd=function(d){a++,r.onProgress!==void 0&&r.onProgress(d,a,l),a===l&&(o=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(d){r.onError!==void 0&&r.onError(d)},this.resolveURL=function(d){return c?c(d):d},this.setURLModifier=function(d){return c=d,this},this.addHandler=function(d,u){return h.push(d,u),this},this.removeHandler=function(d){const u=h.indexOf(d);return u!==-1&&h.splice(u,2),this},this.getHandler=function(d){for(let u=0,p=h.length;u<p;u+=2){const g=h[u],f=h[u+1];if(g.global&&(g.lastIndex=0),g.test(d))return f}return null}}}const ZEe=new OEe;class Fm{constructor(e){this.manager=e!==void 0?e:ZEe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){const s=this;return new Promise(function(r,o){s.load(e,r,i,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Fm.DEFAULT_MATERIAL_NAME="__DEFAULT";const Hu={};class WEe extends Error{constructor(e,i){super(e),this.response=i}}class v0 extends Fm{constructor(e){super(e)}load(e,i,s,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=zm.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{i&&i(o),this.manager.itemEnd(e)},0),o;if(Hu[e]!==void 0){Hu[e].push({onLoad:i,onProgress:s,onError:r});return}Hu[e]=[],Hu[e].push({onLoad:i,onProgress:s,onError:r});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),l=this.mimeType,c=this.responseType;fetch(a).then(h=>{if(h.status===200||h.status===0){if(h.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||h.body===void 0||h.body.getReader===void 0)return h;const d=Hu[e],u=h.body.getReader(),p=h.headers.get("X-File-Size")||h.headers.get("Content-Length"),g=p?parseInt(p):0,f=g!==0;let A=0;const y=new ReadableStream({start(b){v();function v(){u.read().then(({done:x,value:w})=>{if(x)b.close();else{A+=w.byteLength;const C=new ProgressEvent("progress",{lengthComputable:f,loaded:A,total:g});for(let S=0,_=d.length;S<_;S++){const I=d[S];I.onProgress&&I.onProgress(C)}b.enqueue(w),v()}},x=>{b.error(x)})}}});return new Response(y)}else throw new WEe(`fetch for "${h.url}" responded with ${h.status}: ${h.statusText}`,h)}).then(h=>{switch(c){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(d=>new DOMParser().parseFromString(d,l));case"json":return h.json();default:if(l===void 0)return h.text();{const d=/charset="?([^;"\s]*)"?/i.exec(l),u=d&&d[1]?d[1].toLowerCase():void 0,p=new TextDecoder(u);return h.arrayBuffer().then(g=>p.decode(g))}}}).then(h=>{zm.add(e,h);const d=Hu[e];delete Hu[e];for(let u=0,p=d.length;u<p;u++){const g=d[u];g.onLoad&&g.onLoad(h)}}).catch(h=>{const d=Hu[e];if(d===void 0)throw this.manager.itemError(e),h;delete Hu[e];for(let u=0,p=d.length;u<p;u++){const g=d[u];g.onError&&g.onError(h)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class HEe extends Fm{constructor(e){super(e)}load(e,i,s,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,a=zm.get(e);if(a!==void 0)return o.manager.itemStart(e),setTimeout(function(){i&&i(a),o.manager.itemEnd(e)},0),a;const l=XD("img");function c(){d(),zm.add(e,this),i&&i(this),o.manager.itemEnd(e)}function h(u){d(),r&&r(u),o.manager.itemError(e),o.manager.itemEnd(e)}function d(){l.removeEventListener("load",c,!1),l.removeEventListener("error",h,!1)}return l.addEventListener("load",c,!1),l.addEventListener("error",h,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),o.manager.itemStart(e),l.src=e,l}}class Cq extends Fm{constructor(e){super(e)}load(e,i,s,r){const o=new ro,a=new HEe(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(l){o.image=l,o.needsUpdate=!0,i!==void 0&&i(o)},s,r),o}}let m5=class extends Js{constructor(n,e=1){super(),this.isLight=!0,this.type="Light",this.color=new lr(n),this.intensity=e}dispose(){}copy(n,e){return super.copy(n,e),this.color.copy(n.color),this.intensity=n.intensity,this}toJSON(n){const e=super.toJSON(n);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}};const g5=new Ji,Sq=new xe,_q=new xe;class f5{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ur(512,512),this.map=null,this.mapPass=null,this.matrix=new Ji,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new TEe,this._frameExtents=new Ur(1,1),this._viewportCount=1,this._viewports=[new Gl(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const i=this.camera,s=this.matrix;Sq.setFromMatrixPosition(e.matrixWorld),i.position.copy(Sq),_q.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(_q),i.updateMatrixWorld(),g5.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(g5),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(g5)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class QEe extends f5{constructor(){super(new s5(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const i=this.camera,s=zw*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,o=e.distance||i.far;(s!==i.fov||r!==i.aspect||o!==i.far)&&(i.fov=s,i.aspect=r,i.far=o,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class KEe extends m5{constructor(e,i,s=0,r=Math.PI/3,o=0,a=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Js.DEFAULT_UP),this.updateMatrix(),this.target=new Js,this.distance=s,this.angle=r,this.penumbra=o,this.decay=a,this.map=null,this.shadow=new QEe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Mq=new Ji,jw=new xe,A5=new xe;class YEe extends f5{constructor(){super(new s5(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ur(4,2),this._viewportCount=6,this._viewports=[new Gl(2,1,1,1),new Gl(0,1,1,1),new Gl(3,1,1,1),new Gl(1,1,1,1),new Gl(3,0,1,1),new Gl(1,0,1,1)],this._cubeDirections=[new xe(1,0,0),new xe(-1,0,0),new xe(0,0,1),new xe(0,0,-1),new xe(0,1,0),new xe(0,-1,0)],this._cubeUps=[new xe(0,1,0),new xe(0,1,0),new xe(0,1,0),new xe(0,1,0),new xe(0,0,1),new xe(0,0,-1)]}updateMatrices(e,i=0){const s=this.camera,r=this.matrix,o=e.distance||s.far;o!==s.far&&(s.far=o,s.updateProjectionMatrix()),jw.setFromMatrixPosition(e.matrixWorld),s.position.copy(jw),A5.copy(s.position),A5.add(this._cubeDirections[i]),s.up.copy(this._cubeUps[i]),s.lookAt(A5),s.updateMatrixWorld(),r.makeTranslation(-jw.x,-jw.y,-jw.z),Mq.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Mq)}}class jEe extends m5{constructor(e,i,s=0,r=2){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=s,this.decay=r,this.shadow=new YEe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Iq extends eq{constructor(e=-1,i=1,s=1,r=-1,o=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=s,this.bottom=r,this.near=o,this.far=a,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,s,r,o,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=s,this.view.offsetY=r,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let o=s-e,a=s+e,l=r+i,c=r-i;if(this.view!==null&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=h*this.view.offsetX,a=o+h*this.view.width,l-=d*this.view.offsetY,c=l-d*this.view.height}this.projectionMatrix.makeOrthographic(o,a,l,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}class JEe extends f5{constructor(){super(new Iq(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class qEe extends m5{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Js.DEFAULT_UP),this.updateMatrix(),this.target=new Js,this.shadow=new JEe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Jw{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let i="";for(let s=0,r=e.length;s<r;s++)i+=String.fromCharCode(e[s]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(e){const i=e.lastIndexOf("/");return i===-1?"./":e.slice(0,i+1)}static resolveURL(e,i){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(e)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:i+e)}}class $Ee extends Fm{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,i,s,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,a=zm.get(e);if(a!==void 0){if(o.manager.itemStart(e),a.then){a.then(h=>{i&&i(h),o.manager.itemEnd(e)}).catch(h=>{r&&r(h)});return}return setTimeout(function(){i&&i(a),o.manager.itemEnd(e)},0),a}const l={};l.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",l.headers=this.requestHeader;const c=fetch(e,l).then(function(h){return h.blob()}).then(function(h){return createImageBitmap(h,Object.assign(o.options,{colorSpaceConversion:"none"}))}).then(function(h){return zm.add(e,h),i&&i(h),o.manager.itemEnd(e),h}).catch(function(h){r&&r(h),zm.remove(e),o.manager.itemError(e),o.manager.itemEnd(e)});zm.add(e,c),o.manager.itemStart(e)}}class eRe{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Tq(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=Tq();e=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=e}return e}}function Tq(){return performance.now()}const y5="\\[\\]\\.:\\/",tRe=new RegExp("["+y5+"]","g"),b5="[^"+y5+"]",iRe="[^"+y5.replace("\\.","")+"]",nRe=/((?:WC+[\/:])*)/.source.replace("WC",b5),sRe=/(WCOD+)?/.source.replace("WCOD",iRe),rRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",b5),oRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",b5),aRe=new RegExp("^"+nRe+sRe+rRe+oRe+"$"),lRe=["material","materials","bones","map"];class cRe{constructor(e,i,s){const r=s||vn.parseTrackName(i);this._targetGroup=e,this._bindings=e.subscribe_(i,r)}getValue(e,i){this.bind();const s=this._targetGroup.nCachedObjects_,r=this._bindings[s];r!==void 0&&r.getValue(e,i)}setValue(e,i){const s=this._bindings;for(let r=this._targetGroup.nCachedObjects_,o=s.length;r!==o;++r)s[r].setValue(e,i)}bind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=e.length;i!==s;++i)e[i].bind()}unbind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=e.length;i!==s;++i)e[i].unbind()}}class vn{constructor(e,i,s){this.path=i,this.parsedPath=s||vn.parseTrackName(i),this.node=vn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,s){return e&&e.isAnimationObjectGroup?new vn.Composite(e,i,s):new vn(e,i,s)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(tRe,"")}static parseTrackName(e){const i=aRe.exec(e);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const s={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},r=s.nodeName&&s.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const o=s.nodeName.substring(r+1);lRe.indexOf(o)!==-1&&(s.nodeName=s.nodeName.substring(0,r),s.objectName=o)}if(s.propertyName===null||s.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return s}static findNode(e,i){if(i===void 0||i===""||i==="."||i===-1||i===e.name||i===e.uuid)return e;if(e.skeleton){const s=e.skeleton.getBoneByName(i);if(s!==void 0)return s}if(e.children){const s=function(o){for(let a=0;a<o.length;a++){const l=o[a];if(l.name===i||l.uuid===i)return l;const c=s(l.children);if(c)return c}return null},r=s(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)e[i++]=s[r]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)s[r]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)s[r]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const s=this.resolvedProperty;for(let r=0,o=s.length;r!==o;++r)s[r]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,s=i.objectName,r=i.propertyName;let o=i.propertyIndex;if(e||(e=vn.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(s){let h=i.objectIndex;switch(s){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let d=0;d<e.length;d++)if(e[d].name===h){h=d;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[s]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[s]}if(h!==void 0){if(e[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[h]}}const a=e[r];if(a===void 0){const h=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+r+" but it wasn't found.",e);return}let l=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?l=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(l=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(o!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else a.fromArray!==void 0&&a.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}vn.Composite=cRe,vn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},vn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},vn.prototype.GetterByBindingType=[vn.prototype._getValue_direct,vn.prototype._getValue_array,vn.prototype._getValue_arrayElement,vn.prototype._getValue_toArray],vn.prototype.SetterByBindingTypeAndVersioning=[[vn.prototype._setValue_direct,vn.prototype._setValue_direct_setNeedsUpdate,vn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[vn.prototype._setValue_array,vn.prototype._setValue_array_setNeedsUpdate,vn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[vn.prototype._setValue_arrayElement,vn.prototype._setValue_arrayElement_setNeedsUpdate,vn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[vn.prototype._setValue_fromArray,vn.prototype._setValue_fromArray_setNeedsUpdate,vn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:w7}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=w7);function Eq(n,e){if(e===PTe)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===LD||e===P7){let i=n.getIndex();if(i===null){const a=[],l=n.getAttribute("position");if(l!==void 0){for(let c=0;c<l.count;c++)a.push(c);n.setIndex(a),i=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const s=i.count-2,r=[];if(e===LD)for(let a=1;a<=s;a++)r.push(i.getX(0)),r.push(i.getX(a)),r.push(i.getX(a+1));else for(let a=0;a<s;a++)a%2===0?(r.push(i.getX(a)),r.push(i.getX(a+1)),r.push(i.getX(a+2))):(r.push(i.getX(a+2)),r.push(i.getX(a+1)),r.push(i.getX(a)));r.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=n.clone();return o.setIndex(r),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}let v5=class extends Fm{constructor(n){super(n),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new mRe(e)}),this.register(function(e){return new gRe(e)}),this.register(function(e){return new SRe(e)}),this.register(function(e){return new _Re(e)}),this.register(function(e){return new MRe(e)}),this.register(function(e){return new ARe(e)}),this.register(function(e){return new yRe(e)}),this.register(function(e){return new bRe(e)}),this.register(function(e){return new vRe(e)}),this.register(function(e){return new pRe(e)}),this.register(function(e){return new xRe(e)}),this.register(function(e){return new fRe(e)}),this.register(function(e){return new CRe(e)}),this.register(function(e){return new wRe(e)}),this.register(function(e){return new dRe(e)}),this.register(function(e){return new IRe(e)}),this.register(function(e){return new TRe(e)})}load(n,e,i,s){const r=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=Jw.extractUrlBase(n);o=Jw.resolveURL(c,this.path)}else o=Jw.extractUrlBase(n);this.manager.itemStart(n);const a=function(c){s?s(c):console.error(c),r.manager.itemError(n),r.manager.itemEnd(n)},l=new v0(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(n,function(c){try{r.parse(c,o,function(h){e(h),r.manager.itemEnd(n)},a)}catch(h){a(h)}},i,a)}setDRACOLoader(n){return this.dracoLoader=n,this}setKTX2Loader(n){return this.ktx2Loader=n,this}setMeshoptDecoder(n){return this.meshoptDecoder=n,this}register(n){return this.pluginCallbacks.indexOf(n)===-1&&this.pluginCallbacks.push(n),this}unregister(n){return this.pluginCallbacks.indexOf(n)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(n),1),this}parse(n,e,i,s){let r;const o={},a={},l=new TextDecoder;if(typeof n=="string")r=JSON.parse(n);else if(n instanceof ArrayBuffer)if(l.decode(new Uint8Array(n,0,4))===Rq){try{o[Gi.KHR_BINARY_GLTF]=new ERe(n)}catch(h){s&&s(h);return}r=JSON.parse(o[Gi.KHR_BINARY_GLTF].content)}else r=JSON.parse(l.decode(n));else r=n;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new URe(r,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const d=this.pluginCallbacks[h](c);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[d.name]=d,o[d.name]=!0}if(r.extensionsUsed)for(let h=0;h<r.extensionsUsed.length;++h){const d=r.extensionsUsed[h],u=r.extensionsRequired||[];switch(d){case Gi.KHR_MATERIALS_UNLIT:o[d]=new uRe;break;case Gi.KHR_DRACO_MESH_COMPRESSION:o[d]=new RRe(r,this.dracoLoader);break;case Gi.KHR_TEXTURE_TRANSFORM:o[d]=new LRe;break;case Gi.KHR_MESH_QUANTIZATION:o[d]=new BRe;break;default:u.indexOf(d)>=0&&a[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,s)}parseAsync(n,e){const i=this;return new Promise(function(s,r){i.parse(n,e,s,r)})}};function hRe(){let n={};return{get:function(e){return n[e]},add:function(e,i){n[e]=i},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const Gi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};let dRe=class{constructor(n){this.parser=n,this.name=Gi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const n=this.parser,e=this.parser.json.nodes||[];for(let i=0,s=e.length;i<s;i++){const r=e[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&n._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(n){const e=this.parser,i="light:"+n;let s=e.cache.get(i);if(s)return s;const r=e.json,o=((r.extensions&&r.extensions[this.name]||{}).lights||[])[n];let a;const l=new lr(16777215);o.color!==void 0&&l.setRGB(o.color[0],o.color[1],o.color[2],kl);const c=o.range!==void 0?o.range:0;switch(o.type){case"directional":a=new qEe(l),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new jEe(l),a.distance=c;break;case"spot":a=new KEe(l),a.distance=c,o.spot=o.spot||{},o.spot.innerConeAngle=o.spot.innerConeAngle!==void 0?o.spot.innerConeAngle:0,o.spot.outerConeAngle=o.spot.outerConeAngle!==void 0?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,Qu(a,o),o.intensity!==void 0&&(a.intensity=o.intensity),a.name=e.createUniqueName(o.name||"light_"+n),s=Promise.resolve(a),e.cache.add(i,s),s}getDependency(n,e){if(n==="light")return this._loadLight(e)}createNodeAttachment(n){const e=this,i=this.parser,s=i.json.nodes[n],r=(s.extensions&&s.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(o){return i._getNodeRef(e.cache,r,o)})}},uRe=class{constructor(){this.name=Gi.KHR_MATERIALS_UNLIT}getMaterialType(){return yb}extendParams(n,e,i){const s=[];n.color=new lr(1,1,1),n.opacity=1;const r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;n.color.setRGB(o[0],o[1],o[2],kl),n.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(i.assignTexture(n,"map",r.baseColorTexture,ar))}return Promise.all(s)}},pRe=class{constructor(n){this.parser=n,this.name=Gi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(n,e){const i=this.parser.json.materials[n];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(e.emissiveIntensity=s),Promise.resolve()}},mRe=class{constructor(n){this.parser=n,this.name=Gi.KHR_MATERIALS_CLEARCOAT}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Sd}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(e.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Ur(a,a)}return Promise.all(r)}},gRe=class{constructor(n){this.parser=n,this.name=Gi.KHR_MATERIALS_DISPERSION}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Sd}extendMaterialParams(n,e){const i=this.parser.json.materials[n];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return e.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}},fRe=class{constructor(n){this.parser=n,this.name=Gi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Sd}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(e.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(e,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(e.iridescenceIOR=o.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(e,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}},ARe=class{constructor(n){this.parser=n,this.name=Gi.KHR_MATERIALS_SHEEN}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Sd}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];e.sheenColor=new lr(0,0,0),e.sheenRoughness=0,e.sheen=1;const o=s.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;e.sheenColor.setRGB(a[0],a[1],a[2],kl)}return o.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(e,"sheenColorMap",o.sheenColorTexture,ar)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(e,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}},yRe=class{constructor(n){this.parser=n,this.name=Gi.KHR_MATERIALS_TRANSMISSION}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Sd}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(e.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(r)}},bRe=class{constructor(n){this.parser=n,this.name=Gi.KHR_MATERIALS_VOLUME}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Sd}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];e.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return e.attenuationColor=new lr().setRGB(a[0],a[1],a[2],kl),Promise.all(r)}},vRe=class{constructor(n){this.parser=n,this.name=Gi.KHR_MATERIALS_IOR}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Sd}extendMaterialParams(n,e){const i=this.parser.json.materials[n];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return e.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}},xRe=class{constructor(n){this.parser=n,this.name=Gi.KHR_MATERIALS_SPECULAR}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Sd}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];e.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(e,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return e.specularColor=new lr().setRGB(a[0],a[1],a[2],kl),o.specularColorTexture!==void 0&&r.push(i.assignTexture(e,"specularColorMap",o.specularColorTexture,ar)),Promise.all(r)}},wRe=class{constructor(n){this.parser=n,this.name=Gi.EXT_MATERIALS_BUMP}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Sd}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return e.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(i.assignTexture(e,"bumpMap",o.bumpTexture)),Promise.all(r)}},CRe=class{constructor(n){this.parser=n,this.name=Gi.KHR_MATERIALS_ANISOTROPY}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Sd}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(e.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(e.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(e,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}},SRe=class{constructor(n){this.parser=n,this.name=Gi.KHR_TEXTURE_BASISU}loadTexture(n){const e=this.parser,i=e.json,s=i.textures[n];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=e.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(n,r.source,o)}},_Re=class{constructor(n){this.parser=n,this.name=Gi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(n){const e=this.name,i=this.parser,s=i.json,r=s.textures[n];if(!r.extensions||!r.extensions[e])return null;const o=r.extensions[e],a=s.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(n,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(n)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(n){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){n(e.height===1)}})),this.isSupported}},MRe=class{constructor(n){this.parser=n,this.name=Gi.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(n){const e=this.name,i=this.parser,s=i.json,r=s.textures[n];if(!r.extensions||!r.extensions[e])return null;const o=r.extensions[e],a=s.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(n,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(n)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(n){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){n(e.height===1)}})),this.isSupported}},IRe=class{constructor(n){this.name=Gi.EXT_MESHOPT_COMPRESSION,this.parser=n}loadBufferView(n){const e=this.parser.json,i=e.bufferViews[n];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const l=s.byteOffset||0,c=s.byteLength||0,h=s.count,d=s.byteStride,u=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,d,u,s.mode,s.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(h*d);return o.decodeGltfBuffer(new Uint8Array(p),h,d,u,s.mode,s.filter),p})})}else return null}},TRe=class{constructor(n){this.name=Gi.EXT_MESH_GPU_INSTANCING,this.parser=n}createNodeMesh(n){const e=this.parser.json,i=e.nodes[n];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=e.meshes[i.mesh];for(const l of s.primitives)if(l.mode!==Lc.TRIANGLES&&l.mode!==Lc.TRIANGLE_STRIP&&l.mode!==Lc.TRIANGLE_FAN&&l.mode!==void 0)return null;const r=i.extensions[this.name].attributes,o=[],a={};for(const l in r)o.push(this.parser.getDependency("accessor",r[l]).then(c=>(a[l]=c,a[l])));return o.length<1?null:(o.push(this.parser.createNodeMesh(n)),Promise.all(o).then(l=>{const c=l.pop(),h=c.isGroup?c.children:[c],d=l[0].count,u=[];for(const p of h){const g=new Ji,f=new xe,A=new Lm,y=new xe(1,1,1),b=new _Ee(p.geometry,p.material,d);for(let v=0;v<d;v++)a.TRANSLATION&&f.fromBufferAttribute(a.TRANSLATION,v),a.ROTATION&&A.fromBufferAttribute(a.ROTATION,v),a.SCALE&&y.fromBufferAttribute(a.SCALE,v),b.setMatrixAt(v,g.compose(f,A,y));for(const v in a)if(v==="_COLOR_0"){const x=a[v];b.instanceColor=new l5(x.array,x.itemSize,x.normalized)}else v!=="TRANSLATION"&&v!=="ROTATION"&&v!=="SCALE"&&p.geometry.setAttribute(v,a[v]);Js.prototype.copy.call(b,p),this.parser.assignFinalMaterial(b),u.push(b)}return c.isGroup?(c.clear(),c.add(...u),c):u[0]}))}};const Rq="glTF",qw=12,Lq={JSON:1313821514,BIN:5130562};let ERe=class{constructor(n){this.name=Gi.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(n,0,qw),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(n.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Rq)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-qw,r=new DataView(n,qw);let o=0;for(;o<s;){const a=r.getUint32(o,!0);o+=4;const l=r.getUint32(o,!0);if(o+=4,l===Lq.JSON){const c=new Uint8Array(n,qw+o,a);this.content=i.decode(c)}else if(l===Lq.BIN){const c=qw+o;this.body=n.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},RRe=class{constructor(n,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Gi.KHR_DRACO_MESH_COMPRESSION,this.json=n,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(n,e){const i=this.json,s=this.dracoLoader,r=n.extensions[this.name].bufferView,o=n.extensions[this.name].attributes,a={},l={},c={};for(const h in o){const d=w5[h]||h.toLowerCase();a[d]=o[h]}for(const h in n.attributes){const d=w5[h]||h.toLowerCase();if(o[h]!==void 0){const u=i.accessors[n.attributes[h]],p=Ib[u.componentType];c[d]=p.name,l[d]=u.normalized===!0}}return e.getDependency("bufferView",r).then(function(h){return new Promise(function(d,u){s.decodeDracoFile(h,function(p){for(const g in p.attributes){const f=p.attributes[g],A=l[g];A!==void 0&&(f.normalized=A)}d(p)},a,c,kl,u)})})}},LRe=class{constructor(){this.name=Gi.KHR_TEXTURE_TRANSFORM}extendTexture(n,e){return(e.texCoord===void 0||e.texCoord===n.channel)&&e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(n=n.clone(),e.texCoord!==void 0&&(n.channel=e.texCoord),e.offset!==void 0&&n.offset.fromArray(e.offset),e.rotation!==void 0&&(n.rotation=e.rotation),e.scale!==void 0&&n.repeat.fromArray(e.scale),n.needsUpdate=!0),n}},BRe=class{constructor(){this.name=Gi.KHR_MESH_QUANTIZATION}},Bq=class extends Yw{constructor(n,e,i,s){super(n,e,i,s)}copySampleValue_(n){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=n*s*3+s;for(let o=0;o!==s;o++)e[o]=i[r+o];return e}interpolate_(n,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,h=s-e,d=(i-e)/h,u=d*d,p=u*d,g=n*c,f=g-c,A=-2*p+3*u,y=p-u,b=1-A,v=y-u+d;for(let x=0;x!==a;x++){const w=o[f+x+a],C=o[f+x+l]*h,S=o[g+x+a],_=o[g+x]*h;r[x]=b*w+v*C+A*S+y*_}return r}};const kRe=new Lm;let GRe=class extends Bq{interpolate_(n,e,i,s){const r=super.interpolate_(n,e,i,s);return kRe.fromArray(r).normalize().toArray(r),r}};const Lc={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ib={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},kq={9728:sb,9729:Tm,9984:wTe,9985:STe,9986:CTe,9987:Pw},Gq={33071:p0,33648:ED,10497:Gw},x5={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},w5={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Um={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},PRe={CUBICSPLINE:void 0,LINEAR:Xw,STEP:Vw},C5={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function NRe(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new PR({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:rR})),n.DefaultMaterial}function x0(n,e,i){for(const s in i.extensions)n[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=i.extensions[s])}function Qu(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function VRe(n,e,i){let s=!1,r=!1,o=!1;for(let h=0,d=e.length;h<d;h++){const u=e[h];if(u.POSITION!==void 0&&(s=!0),u.NORMAL!==void 0&&(r=!0),u.COLOR_0!==void 0&&(o=!0),s&&r&&o)break}if(!s&&!r&&!o)return Promise.resolve(n);const a=[],l=[],c=[];for(let h=0,d=e.length;h<d;h++){const u=e[h];if(s){const p=u.POSITION!==void 0?i.getDependency("accessor",u.POSITION):n.attributes.position;a.push(p)}if(r){const p=u.NORMAL!==void 0?i.getDependency("accessor",u.NORMAL):n.attributes.normal;l.push(p)}if(o){const p=u.COLOR_0!==void 0?i.getDependency("accessor",u.COLOR_0):n.attributes.color;c.push(p)}}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(h){const d=h[0],u=h[1],p=h[2];return s&&(n.morphAttributes.position=d),r&&(n.morphAttributes.normal=u),o&&(n.morphAttributes.color=p),n.morphTargetsRelative=!0,n})}function XRe(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let i=0,s=e.weights.length;i<s;i++)n.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(n.morphTargetInfluences.length===i.length){n.morphTargetDictionary={};for(let s=0,r=i.length;s<r;s++)n.morphTargetDictionary[i[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function DRe(n){let e;const i=n.extensions&&n.extensions[Gi.KHR_DRACO_MESH_COMPRESSION];if(i?e="draco:"+i.bufferView+":"+i.indices+":"+S5(i.attributes):e=n.indices+":"+S5(n.attributes)+":"+n.mode,n.targets!==void 0)for(let s=0,r=n.targets.length;s<r;s++)e+=":"+S5(n.targets[s]);return e}function S5(n){let e="";const i=Object.keys(n).sort();for(let s=0,r=i.length;s<r;s++)e+=i[s]+":"+n[i[s]]+";";return e}function _5(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function zRe(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":n.search(/\.ktx2($|\?)/i)>0||n.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const FRe=new Ji;let URe=class{constructor(n={},e={}){this.json=n,this.extensions={},this.plugins={},this.options=e,this.cache=new hRe,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=-1,r=!1,o=-1;if(typeof navigator<"u"){const a=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(a)===!0;const l=a.match(/Version\/(\d+)/);s=i&&l?parseInt(l[1],10):-1,r=a.indexOf("Firefox")>-1,o=r?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&s<17||r&&o<98?this.textureLoader=new Cq(this.options.manager):this.textureLoader=new $Ee(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new v0(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(n){this.extensions=n}setPlugins(n){this.plugins=n}parse(n,e){const i=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:i,userData:{}};return x0(r,a,s),Qu(a,s),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();n(a)})}).catch(e)}_markDefs(){const n=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let s=0,r=e.length;s<r;s++){const o=e[s].joints;for(let a=0,l=o.length;a<l;a++)n[o[a]].isBone=!0}for(let s=0,r=n.length;s<r;s++){const o=n[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(n,e){e!==void 0&&(n.refs[e]===void 0&&(n.refs[e]=n.uses[e]=0),n.refs[e]++)}_getNodeRef(n,e,i){if(n.refs[e]<=1)return i;const s=i.clone(),r=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,h]of o.children.entries())r(h,a.children[c])};return r(i,s),s.name+="_instance_"+n.uses[e]++,s}_invokeOne(n){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const s=n(e[i]);if(s)return s}return null}_invokeAll(n){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let s=0;s<e.length;s++){const r=n(e[s]);r&&i.push(r)}return i}getDependency(n,e){const i=n+":"+e;let s=this.cache.get(i);if(!s){switch(n){case"scene":s=this.loadScene(e);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(e)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(e)});break;case"accessor":s=this.loadAccessor(e);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(e)});break;case"buffer":s=this.loadBuffer(e);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(e)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(e)});break;case"skin":s=this.loadSkin(e);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(e)});break;case"camera":s=this.loadCamera(e);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(n,e)}),!s)throw new Error("Unknown type: "+n);break}this.cache.add(i,s)}return s}getDependencies(n){let e=this.cache.get(n);if(!e){const i=this,s=this.json[n+(n==="mesh"?"es":"s")]||[];e=Promise.all(s.map(function(r,o){return i.getDependency(n,o)})),this.cache.add(n,e)}return e}loadBuffer(n){const e=this.json.buffers[n],i=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&n===0)return Promise.resolve(this.extensions[Gi.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,o){i.load(Jw.resolveURL(e.uri,s.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(n){const e=this.json.bufferViews[n];return this.getDependency("buffer",e.buffer).then(function(i){const s=e.byteLength||0,r=e.byteOffset||0;return i.slice(r,r+s)})}loadAccessor(n){const e=this,i=this.json,s=this.json.accessors[n];if(s.bufferView===void 0&&s.sparse===void 0){const o=x5[s.type],a=Ib[s.componentType],l=s.normalized===!0,c=new a(s.count*o);return Promise.resolve(new Nl(c,o,l))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=x5[s.type],c=Ib[s.componentType],h=c.BYTES_PER_ELEMENT,d=h*l,u=s.byteOffset||0,p=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,g=s.normalized===!0;let f,A;if(p&&p!==d){const y=Math.floor(u/p),b="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+y+":"+s.count;let v=e.cache.get(b);v||(f=new c(a,y*p,s.count*p/h),v=new vEe(f,p/h),e.cache.add(b,v)),A=new XZ(v,l,u%p/h,g)}else a===null?f=new c(s.count*l):f=new c(a,u,s.count*l),A=new Nl(f,l,g);if(s.sparse!==void 0){const y=x5.SCALAR,b=Ib[s.sparse.indices.componentType],v=s.sparse.indices.byteOffset||0,x=s.sparse.values.byteOffset||0,w=new b(o[1],v,s.sparse.count*y),C=new c(o[2],x,s.sparse.count*l);a!==null&&(A=new Nl(A.array.slice(),A.itemSize,A.normalized)),A.normalized=!1;for(let S=0,_=w.length;S<_;S++){const I=w[S];if(A.setX(I,C[S*l]),l>=2&&A.setY(I,C[S*l+1]),l>=3&&A.setZ(I,C[S*l+2]),l>=4&&A.setW(I,C[S*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}A.normalized=g}return A})}loadTexture(n){const e=this.json,i=this.options,s=e.textures[n].source,r=e.images[s];let o=this.textureLoader;if(r.uri){const a=i.manager.getHandler(r.uri);a!==null&&(o=a)}return this.loadTextureImage(n,s,o)}loadTextureImage(n,e,i){const s=this,r=this.json,o=r.textures[n],a=r.images[e],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(e,i).then(function(h){h.flipY=!1,h.name=o.name||a.name||"",h.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(h.name=a.uri);const d=(r.samplers||{})[o.sampler]||{};return h.magFilter=kq[d.magFilter]||Tm,h.minFilter=kq[d.minFilter]||Pw,h.wrapS=Gq[d.wrapS]||Gw,h.wrapT=Gq[d.wrapT]||Gw,h.generateMipmaps=!h.isCompressedTexture&&h.minFilter!==sb&&h.minFilter!==Tm,s.associations.set(h,{textures:n}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(n,e){const i=this,s=this.json,r=this.options;if(this.sourceCache[n]!==void 0)return this.sourceCache[n].then(d=>d.clone());const o=s.images[n],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(d){c=!0;const u=new Blob([d],{type:o.mimeType});return l=a.createObjectURL(u),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+n+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(d){return new Promise(function(u,p){let g=u;e.isImageBitmapLoader===!0&&(g=function(f){const A=new ro(f);A.needsUpdate=!0,u(A)}),e.load(Jw.resolveURL(d,r.path),g,void 0,p)})}).then(function(d){return c===!0&&a.revokeObjectURL(l),Qu(d,o),d.userData.mimeType=o.mimeType||zRe(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[n]=h,h}assignTexture(n,e,i,s){const r=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),r.extensions[Gi.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[Gi.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=r.associations.get(o);o=r.extensions[Gi.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,l)}}return s!==void 0&&(o.colorSpace=s),n[e]=o,o})}assignFinalMaterial(n){const e=n.geometry;let i=n.material;const s=e.attributes.tangent===void 0,r=e.attributes.color!==void 0,o=e.attributes.normal===void 0;if(n.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new Aq,Vm.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(n.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new uq,Vm.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(s||r||o){let a="ClonedMaterial:"+i.uuid+":";s&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}n.material=i}getMaterialType(){return PR}loadMaterial(n){const e=this,i=this.json,s=this.extensions,r=i.materials[n];let o;const a={},l=r.extensions||{},c=[];if(l[Gi.KHR_MATERIALS_UNLIT]){const d=s[Gi.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),c.push(d.extendParams(a,r,e))}else{const d=r.pbrMetallicRoughness||{};if(a.color=new lr(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const u=d.baseColorFactor;a.color.setRGB(u[0],u[1],u[2],kl),a.opacity=u[3]}d.baseColorTexture!==void 0&&c.push(e.assignTexture(a,"map",d.baseColorTexture,ar)),a.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,a.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(e.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(e.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(u){return u.getMaterialType&&u.getMaterialType(n)}),c.push(Promise.all(this._invokeAll(function(u){return u.extendMaterialParams&&u.extendMaterialParams(n,a)})))}r.doubleSided===!0&&(a.side=yTe);const h=r.alphaMode||C5.OPAQUE;if(h===C5.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===C5.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==yb&&(c.push(e.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new Ur(1,1),r.normalTexture.scale!==void 0)){const d=r.normalTexture.scale;a.normalScale.set(d,d)}if(r.occlusionTexture!==void 0&&o!==yb&&(c.push(e.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==yb){const d=r.emissiveFactor;a.emissive=new lr().setRGB(d[0],d[1],d[2],kl)}return r.emissiveTexture!==void 0&&o!==yb&&c.push(e.assignTexture(a,"emissiveMap",r.emissiveTexture,ar)),Promise.all(c).then(function(){const d=new o(a);return r.name&&(d.name=r.name),Qu(d,r),e.associations.set(d,{materials:n}),r.extensions&&x0(s,d,r),d})}createUniqueName(n){const e=vn.sanitizeNodeName(n||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(n){const e=this,i=this.extensions,s=this.primitiveCache;function r(a){return i[Gi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,e).then(function(l){return Pq(l,a,e)})}const o=[];for(let a=0,l=n.length;a<l;a++){const c=n[a],h=DRe(c),d=s[h];if(d)o.push(d.promise);else{let u;c.extensions&&c.extensions[Gi.KHR_DRACO_MESH_COMPRESSION]?u=r(c):u=Pq(new Jh,c,e),s[h]={primitive:c,promise:u},o.push(u)}}return Promise.all(o)}loadMesh(n){const e=this,i=this.json,s=this.extensions,r=i.meshes[n],o=r.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const h=o[l].material===void 0?NRe(this.cache):this.getDependency("material",o[l].material);a.push(h)}return a.push(e.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],d=[];for(let p=0,g=h.length;p<g;p++){const f=h[p],A=o[p];let y;const b=c[p];if(A.mode===Lc.TRIANGLES||A.mode===Lc.TRIANGLE_STRIP||A.mode===Lc.TRIANGLE_FAN||A.mode===void 0)y=r.isSkinnedMesh===!0?new wEe(f,b):new Xm(f,b),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),A.mode===Lc.TRIANGLE_STRIP?y.geometry=Eq(y.geometry,P7):A.mode===Lc.TRIANGLE_FAN&&(y.geometry=Eq(y.geometry,LD));else if(A.mode===Lc.LINES)y=new EEe(f,b);else if(A.mode===Lc.LINE_STRIP)y=new d5(f,b);else if(A.mode===Lc.LINE_LOOP)y=new REe(f,b);else if(A.mode===Lc.POINTS)y=new LEe(f,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+A.mode);Object.keys(y.geometry.morphAttributes).length>0&&XRe(y,r),y.name=e.createUniqueName(r.name||"mesh_"+n),Qu(y,r),A.extensions&&x0(s,y,A),e.assignFinalMaterial(y),d.push(y)}for(let p=0,g=d.length;p<g;p++)e.associations.set(d[p],{meshes:n,primitives:p});if(d.length===1)return r.extensions&&x0(s,d[0],r),d[0];const u=new p5;r.extensions&&x0(s,u,r),e.associations.set(u,{meshes:n});for(let p=0,g=d.length;p<g;p++)u.add(d[p]);return u})}loadCamera(n){let e;const i=this.json.cameras[n],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?e=new s5($Te.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(e=new Iq(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),Qu(e,i),Promise.resolve(e)}loadSkin(n){const e=this.json.skins[n],i=[];for(let s=0,r=e.joints.length;s<r;s++)i.push(this._loadNodeShallow(e.joints[s]));return e.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",e.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const r=s.pop(),o=s,a=[],l=[];for(let c=0,h=o.length;c<h;c++){const d=o[c];if(d){a.push(d);const u=new Ji;r!==null&&u.fromArray(r.array,c*16),l.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[c])}return new DZ(a,l)})}loadAnimation(n){const e=this.json,i=this,s=e.animations[n],r=s.name?s.name:"animation_"+n,o=[],a=[],l=[],c=[],h=[];for(let d=0,u=s.channels.length;d<u;d++){const p=s.channels[d],g=s.samplers[p.sampler],f=p.target,A=f.node,y=s.parameters!==void 0?s.parameters[g.input]:g.input,b=s.parameters!==void 0?s.parameters[g.output]:g.output;f.node!==void 0&&(o.push(this.getDependency("node",A)),a.push(this.getDependency("accessor",y)),l.push(this.getDependency("accessor",b)),c.push(g),h.push(f))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(d){const u=d[0],p=d[1],g=d[2],f=d[3],A=d[4],y=[];for(let b=0,v=u.length;b<v;b++){const x=u[b],w=p[b],C=g[b],S=f[b],_=A[b];if(x===void 0)continue;x.updateMatrix&&x.updateMatrix();const I=i._createAnimationTracks(x,w,C,S,_);if(I)for(let B=0;B<I.length;B++)y.push(I[B])}return new zEe(r,void 0,y)})}createNodeMesh(n){const e=this.json,i=this,s=e.nodes[n];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,s.mesh,r);return s.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=s.weights.length;l<c;l++)a.morphTargetInfluences[l]=s.weights[l]}),o})}loadNode(n){const e=this.json,i=this,s=e.nodes[n],r=i._loadNodeShallow(n),o=[],a=s.children||[];for(let c=0,h=a.length;c<h;c++)o.push(i.getDependency("node",a[c]));const l=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([r,Promise.all(o),l]).then(function(c){const h=c[0],d=c[1],u=c[2];u!==null&&h.traverse(function(p){p.isSkinnedMesh&&p.bind(u,FRe)});for(let p=0,g=d.length;p<g;p++)h.add(d[p]);return h})}_loadNodeShallow(n){const e=this.json,i=this.extensions,s=this;if(this.nodeCache[n]!==void 0)return this.nodeCache[n];const r=e.nodes[n],o=r.name?s.createUniqueName(r.name):"",a=[],l=s._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(n)});return l&&a.push(l),r.camera!==void 0&&a.push(s.getDependency("camera",r.camera).then(function(c){return s._getNodeRef(s.cameraCache,r.camera,c)})),s._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(n)}).forEach(function(c){a.push(c)}),this.nodeCache[n]=Promise.all(a).then(function(c){let h;if(r.isBone===!0?h=new lq:c.length>1?h=new p5:c.length===1?h=c[0]:h=new Js,h!==c[0])for(let d=0,u=c.length;d<u;d++)h.add(c[d]);if(r.name&&(h.userData.name=r.name,h.name=o),Qu(h,r),r.extensions&&x0(i,h,r),r.matrix!==void 0){const d=new Ji;d.fromArray(r.matrix),h.applyMatrix4(d)}else r.translation!==void 0&&h.position.fromArray(r.translation),r.rotation!==void 0&&h.quaternion.fromArray(r.rotation),r.scale!==void 0&&h.scale.fromArray(r.scale);return s.associations.has(h)||s.associations.set(h,{}),s.associations.get(h).nodes=n,h}),this.nodeCache[n]}loadScene(n){const e=this.extensions,i=this.json.scenes[n],s=this,r=new p5;i.name&&(r.name=s.createUniqueName(i.name)),Qu(r,i),i.extensions&&x0(e,r,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(s.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let h=0,d=l.length;h<d;h++)r.add(l[h]);const c=h=>{const d=new Map;for(const[u,p]of s.associations)(u instanceof Vm||u instanceof ro)&&d.set(u,p);return h.traverse(u=>{const p=s.associations.get(u);p!=null&&d.set(u,p)}),d};return s.associations=c(r),r})}_createAnimationTracks(n,e,i,s,r){const o=[],a=n.name?n.name:n.uuid,l=[];Um[r.path]===Um.weights?n.traverse(function(u){u.morphTargetInfluences&&l.push(u.name?u.name:u.uuid)}):l.push(a);let c;switch(Um[r.path]){case Um.weights:c=Cb;break;case Um.rotation:c=Sb;break;case Um.position:case Um.scale:c=Mb;break;default:switch(i.itemSize){case 1:c=Cb;break;case 2:case 3:default:c=Mb;break}break}const h=s.interpolation!==void 0?PRe[s.interpolation]:Xw,d=this._getArrayFromAccessor(i);for(let u=0,p=l.length;u<p;u++){const g=new c(l[u]+"."+Um[r.path],e.array,d,h);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),o.push(g)}return o}_getArrayFromAccessor(n){let e=n.array;if(n.normalized){const i=_5(e.constructor),s=new Float32Array(e.length);for(let r=0,o=e.length;r<o;r++)s[r]=e[r]*i;e=s}return e}_createCubicSplineTrackInterpolant(n){n.createInterpolant=function(e){const i=this instanceof Sb?GRe:Bq;return new i(this.times,this.values,this.getValueSize()/3,e)},n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function ORe(n,e,i){const s=e.attributes,r=new Sh;if(s.POSITION!==void 0){const l=i.json.accessors[s.POSITION],c=l.min,h=l.max;if(c!==void 0&&h!==void 0){if(r.set(new xe(c[0],c[1],c[2]),new xe(h[0],h[1],h[2])),l.normalized){const d=_5(Ib[l.componentType]);r.min.multiplyScalar(d),r.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const l=new xe,c=new xe;for(let h=0,d=o.length;h<d;h++){const u=o[h];if(u.POSITION!==void 0){const p=i.json.accessors[u.POSITION],g=p.min,f=p.max;if(g!==void 0&&f!==void 0){if(c.setX(Math.max(Math.abs(g[0]),Math.abs(f[0]))),c.setY(Math.max(Math.abs(g[1]),Math.abs(f[1]))),c.setZ(Math.max(Math.abs(g[2]),Math.abs(f[2]))),p.normalized){const A=_5(Ib[p.componentType]);c.multiplyScalar(A)}l.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(l)}n.boundingBox=r;const a=new Mh;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=a}function Pq(n,e,i){const s=e.attributes,r=[];function o(a,l){return i.getDependency("accessor",a).then(function(c){n.setAttribute(l,c)})}for(const a in s){const l=w5[a]||a.toLowerCase();l in n.attributes||r.push(o(s[a],l))}if(e.indices!==void 0&&!n.index){const a=i.getDependency("accessor",e.indices).then(function(l){n.setIndex(l)});r.push(a)}return il.workingColorSpace!==kl&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${il.workingColorSpace}" not supported.`),Qu(n,e),ORe(n,e,i),Promise.all(r).then(function(){return e.targets!==void 0?VRe(n,e.targets,i):n})}var ZRe=function(){var n="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",e="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),s=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var r=WebAssembly.validate(i)?e:n,o,a=WebAssembly.instantiate(l(r),{}).then(function(b){o=b.instance,o.exports.__wasm_call_ctors()});function l(b){for(var v=new Uint8Array(b.length),x=0;x<b.length;++x){var w=b.charCodeAt(x);v[x]=w>96?w-97:w>64?w-39:w+4}for(var C=0,x=0;x<b.length;++x)v[C++]=v[x]<60?s[v[x]]:(v[x]-60)*64+v[++x];return v.buffer.slice(0,C)}function c(b,v,x,w,C,S){var _=o.exports.sbrk,I=x+3&-4,B=_(I*w),M=_(C.length),R=new Uint8Array(o.exports.memory.buffer);R.set(C,M);var k=b(B,x,w,M,C.length);if(k==0&&S&&S(B,I,w),v.set(R.subarray(B,B+x*w)),_(B-_(0)),k!=0)throw new Error("Malformed buffer data: "+k)}var h={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},d={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},u=[],p=0;function g(b){var v={object:new Worker(b),pending:0,requests:{}};return v.object.onmessage=function(x){var w=x.data;v.pending-=w.count,v.requests[w.id][w.action](w.value),delete v.requests[w.id]},v}function f(b){for(var v="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(l(r))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+c.toString()+y.toString(),x=new Blob([v],{type:"text/javascript"}),w=URL.createObjectURL(x),C=0;C<b;++C)u[C]=g(w);URL.revokeObjectURL(w)}function A(b,v,x,w,C){for(var S=u[0],_=1;_<u.length;++_)u[_].pending<S.pending&&(S=u[_]);return new Promise(function(I,B){var M=new Uint8Array(x),R=p++;S.pending+=b,S.requests[R]={resolve:I,reject:B},S.object.postMessage({id:R,count:b,size:v,source:M,mode:w,filter:C},[M.buffer])})}function y(b){a.then(function(){var v=b.data;try{var x=new Uint8Array(v.count*v.size);c(o.exports[v.mode],x,v.count,v.size,v.source,o.exports[v.filter]),self.postMessage({id:v.id,count:v.count,action:"resolve",value:x},[x.buffer])}catch(w){self.postMessage({id:v.id,count:v.count,action:"reject",value:w})}})}return{ready:a,supported:!0,useWorkers:function(b){f(b)},decodeVertexBuffer:function(b,v,x,w,C){c(o.exports.meshopt_decodeVertexBuffer,b,v,x,w,o.exports[h[C]])},decodeIndexBuffer:function(b,v,x,w){c(o.exports.meshopt_decodeIndexBuffer,b,v,x,w)},decodeIndexSequence:function(b,v,x,w){c(o.exports.meshopt_decodeIndexSequence,b,v,x,w)},decodeGltfBuffer:function(b,v,x,w,C,S){c(o.exports[d[C]],b,v,x,w,o.exports[h[S]])},decodeGltfBufferAsync:function(b,v,x,w,C){return u.length>0?A(b,v,x,d[w],h[C]):a.then(function(){var S=new Uint8Array(b*v);return c(o.exports[d[w]],S,b,v,x,o.exports[h[C]]),S})}}}();const M5=new WeakMap;class WRe extends Fm{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,s,r){const o=new v0(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,a=>{this.parse(a,i,r)},s,r)}parse(e,i,s=()=>{}){this.decodeDracoFile(e,i,null,null,ar,s).catch(s)}decodeDracoFile(e,i,s,r,o=kl,a=()=>{}){const l={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:o};return this.decodeGeometry(e,l).then(i).catch(a)}decodeGeometry(e,i){const s=JSON.stringify(i);if(M5.has(e)){const c=M5.get(e);if(c.key===s)return c.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const o=this.workerNextTaskID++,a=e.byteLength,l=this._getWorker(o,a).then(c=>(r=c,new Promise((h,d)=>{r._callbacks[o]={resolve:h,reject:d},r.postMessage({type:"decode",id:o,taskConfig:i,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return l.catch(()=>!0).then(()=>{r&&o&&this._releaseTask(r,o)}),M5.set(e,{key:s,promise:l}),l}_createGeometry(e){const i=new Jh;e.index&&i.setIndex(new Nl(e.index.array,1));for(let s=0;s<e.attributes.length;s++){const r=e.attributes[s],o=r.name,a=r.array,l=r.itemSize,c=new Nl(a,l);o==="color"&&(this._assignVertexColorSpace(c,r.vertexColorSpace),c.normalized=!(a instanceof Float32Array)),i.setAttribute(o,c)}return i}_assignVertexColorSpace(e,i){if(i!==ar)return;const s=new lr;for(let r=0,o=e.count;r<o;r++)s.fromBufferAttribute(e,r),il.toWorkingColorSpace(s,ar),e.setXYZ(r,s.r,s.g,s.b)}_loadLibrary(e,i){const s=new v0(this.manager);return s.setPath(this.decoderPath),s.setResponseType(i),s.setWithCredentials(this.withCredentials),new Promise((r,o)=>{s.load(e,r,void 0,o)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",i=[];return e?i.push(this._loadLibrary("draco_decoder.js","text")):(i.push(this._loadLibrary("draco_wasm_wrapper.js","text")),i.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(i).then(s=>{const r=s[0];e||(this.decoderConfig.wasmBinary=s[1]);const o=HRe.toString(),a=["/* draco decoder */",r,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,i){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(o){const a=o.data;switch(a.type){case"decode":r._callbacks[a.id].resolve(a);break;case"error":r._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,o){return r._taskLoad>o._taskLoad?-1:1});const s=this.workerPool[this.workerPool.length-1];return s._taskCosts[e]=i,s._taskLoad+=i,s})}_releaseTask(e,i){e._taskLoad-=e._taskCosts[i],delete e._callbacks[i],delete e._taskCosts[i]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function HRe(){let n,e;onmessage=function(a){const l=a.data;switch(l.type){case"init":n=l.decoderConfig,e=new Promise(function(d){n.onModuleLoaded=function(u){d({draco:u})},DracoDecoderModule(n)});break;case"decode":const c=l.buffer,h=l.taskConfig;e.then(d=>{const u=d.draco,p=new u.Decoder;try{const g=i(u,p,new Int8Array(c),h),f=g.attributes.map(A=>A.array.buffer);g.index&&f.push(g.index.array.buffer),self.postMessage({type:"decode",id:l.id,geometry:g},f)}catch(g){console.error(g),self.postMessage({type:"error",id:l.id,error:g.message})}finally{u.destroy(p)}});break}};function i(a,l,c,h){const d=h.attributeIDs,u=h.attributeTypes;let p,g;const f=l.GetEncodedGeometryType(c);if(f===a.TRIANGULAR_MESH)p=new a.Mesh,g=l.DecodeArrayToMesh(c,c.byteLength,p);else if(f===a.POINT_CLOUD)p=new a.PointCloud,g=l.DecodeArrayToPointCloud(c,c.byteLength,p);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!g.ok()||p.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+g.error_msg());const A={index:null,attributes:[]};for(const y in d){const b=self[u[y]];let v,x;if(h.useUniqueIDs)x=d[y],v=l.GetAttributeByUniqueId(p,x);else{if(x=l.GetAttributeId(p,a[d[y]]),x===-1)continue;v=l.GetAttribute(p,x)}const w=r(a,l,p,y,b,v);y==="color"&&(w.vertexColorSpace=h.vertexColorSpace),A.attributes.push(w)}return f===a.TRIANGULAR_MESH&&(A.index=s(a,l,p)),a.destroy(p),A}function s(a,l,c){const h=c.num_faces()*3,d=h*4,u=a._malloc(d);l.GetTrianglesUInt32Array(c,d,u);const p=new Uint32Array(a.HEAPF32.buffer,u,h).slice();return a._free(u),{array:p,itemSize:1}}function r(a,l,c,h,d,u){const p=u.num_components(),g=c.num_points()*p,f=g*d.BYTES_PER_ELEMENT,A=o(a,d),y=a._malloc(f);l.GetAttributeDataArrayForAllPoints(c,u,A,f,y);const b=new d(a.HEAPF32.buffer,y,g).slice();return a._free(y),{name:h,array:b,itemSize:p}}function o(a,l){switch(l){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}let QRe=class{constructor(n=4){this.pool=n,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(n){if(!this.workers[n]){const e=this.workerCreator();e.addEventListener("message",this._onMessage.bind(this,n)),this.workers[n]=e}}_getIdleWorker(){for(let n=0;n<this.pool;n++)if(!(this.workerStatus&1<<n))return n;return-1}_onMessage(n,e){const i=this.workersResolve[n];if(i&&i(e),this.queue.length){const{resolve:s,msg:r,transfer:o}=this.queue.shift();this.workersResolve[n]=s,this.workers[n].postMessage(r,o)}else this.workerStatus^=1<<n}setWorkerCreator(n){this.workerCreator=n}setWorkerLimit(n){this.pool=n}postMessage(n,e){return new Promise(i=>{const s=this._getIdleWorker();s!==-1?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=i,this.workers[s].postMessage(n,e)):this.queue.push({resolve:i,msg:n,transfer:e})})}dispose(){this.workers.forEach(n=>n.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}};const KRe=0,Nq=2,YRe=1,Vq=2,jRe=0,JRe=1,qRe=10,$Re=0,Xq=9,Dq=15,zq=16,Fq=22,Uq=37,Oq=43,Zq=76,Wq=83,Hq=97,Qq=100,Kq=103,Yq=109,jq=165,Jq=166,I5=1000066e3;let e2e=class{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}},$w=class{constructor(n,e,i,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(n.buffer,n.byteOffset+e,i),this._littleEndian=s,this._offset=0}_nextUint8(){const n=this._dataView.getUint8(this._offset);return this._offset+=1,n}_nextUint16(){const n=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,n}_nextUint32(){const n=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,n}_nextUint64(){const n=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,n}_nextInt32(){const n=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,n}_nextUint8Array(n){const e=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,n);return this._offset+=n,e}_skip(n){return this._offset+=n,this}_scan(n,e){e===void 0&&(e=0);const i=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==e&&s<n;)s++,this._offset++;return s<n&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)}};const Ea=[171,75,84,88,32,50,48,187,13,10,26,10];function qq(n){return new TextDecoder().decode(n)}function t2e(n){const e=new Uint8Array(n.buffer,n.byteOffset,Ea.length);if(e[0]!==Ea[0]||e[1]!==Ea[1]||e[2]!==Ea[2]||e[3]!==Ea[3]||e[4]!==Ea[4]||e[5]!==Ea[5]||e[6]!==Ea[6]||e[7]!==Ea[7]||e[8]!==Ea[8]||e[9]!==Ea[9]||e[10]!==Ea[10]||e[11]!==Ea[11])throw new Error("Missing KTX 2.0 identifier.");const i=new e2e,s=17*Uint32Array.BYTES_PER_ELEMENT,r=new $w(n,Ea.length,s,!0);i.vkFormat=r._nextUint32(),i.typeSize=r._nextUint32(),i.pixelWidth=r._nextUint32(),i.pixelHeight=r._nextUint32(),i.pixelDepth=r._nextUint32(),i.layerCount=r._nextUint32(),i.faceCount=r._nextUint32();const o=r._nextUint32();i.supercompressionScheme=r._nextUint32();const a=r._nextUint32(),l=r._nextUint32(),c=r._nextUint32(),h=r._nextUint32(),d=r._nextUint64(),u=r._nextUint64(),p=new $w(n,Ea.length+s,3*o*8,!0);for(let H=0;H<o;H++)i.levels.push({levelData:new Uint8Array(n.buffer,n.byteOffset+p._nextUint64(),p._nextUint64()),uncompressedByteLength:p._nextUint64()});const g=new $w(n,a,l,!0),f={vendorId:g._skip(4)._nextUint16(),descriptorType:g._nextUint16(),versionNumber:g._nextUint16(),descriptorBlockSize:g._nextUint16(),colorModel:g._nextUint8(),colorPrimaries:g._nextUint8(),transferFunction:g._nextUint8(),flags:g._nextUint8(),texelBlockDimension:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],bytesPlane:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],samples:[]},A=(f.descriptorBlockSize/4-6)/4;for(let H=0;H<A;H++){const Z={bitOffset:g._nextUint16(),bitLength:g._nextUint8(),channelType:g._nextUint8(),samplePosition:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Z.channelType?(Z.sampleLower=g._nextInt32(),Z.sampleUpper=g._nextInt32()):(Z.sampleLower=g._nextUint32(),Z.sampleUpper=g._nextUint32()),f.samples[H]=Z}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(f);const y=new $w(n,c,h,!0);for(;y._offset<h;){const H=y._nextUint32(),Z=y._scan(H),he=qq(Z);if(i.keyValue[he]=y._nextUint8Array(H-Z.byteLength-1),he.match(/^ktx/i)){const be=qq(i.keyValue[he]);i.keyValue[he]=be.substring(0,be.lastIndexOf("\0"))}y._skip(H%4?4-H%4:0)}if(u<=0)return i;const b=new $w(n,d,u,!0),v=b._nextUint16(),x=b._nextUint16(),w=b._nextUint32(),C=b._nextUint32(),S=b._nextUint32(),_=b._nextUint32(),I=[];for(let H=0;H<o;H++)I.push({imageFlags:b._nextUint32(),rgbSliceByteOffset:b._nextUint32(),rgbSliceByteLength:b._nextUint32(),alphaSliceByteOffset:b._nextUint32(),alphaSliceByteLength:b._nextUint32()});const B=d+b._offset,M=B+w,R=M+C,k=R+S,G=new Uint8Array(n.buffer,n.byteOffset+B,w),X=new Uint8Array(n.buffer,n.byteOffset+M,C),F=new Uint8Array(n.buffer,n.byteOffset+R,S),z=new Uint8Array(n.buffer,n.byteOffset+k,_);return i.globalData={endpointCount:v,selectorCount:x,imageDescs:I,endpointsData:G,selectorsData:X,tablesData:F,extendedData:z},i}let T5,Ku,E5;const R5={env:{emscripten_notify_memory_growth:function(n){E5=new Uint8Array(Ku.exports.memory.buffer)}}};let i2e=class{init(){return T5||(T5=typeof fetch<"u"?fetch("data:application/wasm;base64,"+$q).then(n=>n.arrayBuffer()).then(n=>WebAssembly.instantiate(n,R5)).then(this._init):WebAssembly.instantiate(Buffer.from($q,"base64"),R5).then(this._init),T5)}_init(n){Ku=n.instance,R5.env.emscripten_notify_memory_growth(0)}decode(n,e=0){if(!Ku)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=n.byteLength,s=Ku.exports.malloc(i);E5.set(n,s),e=e||Number(Ku.exports.ZSTD_findDecompressedSize(s,i));const r=Ku.exports.malloc(e),o=Ku.exports.ZSTD_decompress(r,e,s,i),a=E5.slice(r,r+o);return Ku.exports.free(s),Ku.exports.free(r),a}};const $q="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",n2e="display-p3",s2e="display-p3-linear",L5=new WeakMap;let B5=0,k5,Tb=class vx extends Fm{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new QRe,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new v0(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const i=e.loadAsync("basis_transcoder.js"),s=new v0(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const r=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,r]).then(([o,a])=>{const l=vx.BasisWorker.toString(),c=["/* constants */","let _EngineFormat = "+JSON.stringify(vx.EngineFormat),"let _EngineType = "+JSON.stringify(vx.EngineType),"let _TranscoderFormat = "+JSON.stringify(vx.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(vx.BasisFormat),"/* basis_transcoder.js */",o,"/* worker */",l.substring(l.indexOf("{")+1,l.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([c])),this.transcoderBinary=a,this.workerPool.setWorkerCreator(()=>{const h=new Worker(this.workerSourceURL),d=this.transcoderBinary.slice(0);return h.postMessage({type:"init",config:this.workerConfig,transcoderBinary:d},[d]),h})}),B5>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),B5++}return this.transcoderPending}load(e,i,s,r){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const o=new v0(this.manager);o.setResponseType("arraybuffer"),o.setWithCredentials(this.withCredentials),o.load(e,a=>{this.parse(a,i,r)},s,r)}parse(e,i,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(L5.has(e))return L5.get(e).promise.then(i).catch(s);this._createTexture(e).then(r=>i?i(r):null).catch(s)}_createTextureFrom(e,i){const{type:s,error:r,data:{faces:o,width:a,height:l,format:c,type:h,dfdFlags:d}}=e;if(s==="error")return Promise.reject(r);let u;if(i.faceCount===6)u=new kEe(o,c,h);else{const p=o[0].mipmaps;u=i.layerCount>1?new BEe(p,a,l,i.layerCount,c,h):new GR(p,a,l,c,h)}return u.minFilter=o[0].mipmaps.length===1?Tm:Pw,u.magFilter=Tm,u.generateMipmaps=!1,u.needsUpdate=!0,u.colorSpace=e$(i),u.premultiplyAlpha=!!(d&YRe),u}async _createTexture(e,i={}){const s=t2e(new Uint8Array(e)),r=s.vkFormat===I5&&s.dataFormatDescriptor[0].colorModel===167;if(!(s.vkFormat===$Re||r&&!this.workerConfig.astcHDRSupported))return o2e(s);const o=i,a=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:o},[e])).then(l=>this._createTextureFrom(l.data,s));return L5.set(e,{promise:a}),a}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),B5--,this}};Tb.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2},Tb.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25},Tb.EngineFormat={RGBAFormat:Rm,RGBA_ASTC_4x4_Format:R7,RGB_BPTC_UNSIGNED_Format:kTe,RGBA_BPTC_Format:BTe,RGBA_ETC2_EAC_Format:LTe,RGBA_PVRTC_4BPPV1_Format:TTe,RGBA_S3TC_DXT5_Format:MTe,RGB_ETC1_Format:ETe,RGB_ETC2_Format:RTe,RGB_PVRTC_4BPPV1_Format:ITe,RGBA_S3TC_DXT1_Format:_Te},Tb.EngineType={UnsignedByteType:Cd,HalfFloatType:rb,FloatType:Em},Tb.BasisWorker=function(){let n,e,i;const s=_EngineFormat,r=_EngineType,o=_TranscoderFormat,a=_BasisFormat;self.addEventListener("message",function(f){const A=f.data;switch(A.type){case"init":n=A.config,l(A.transcoderBinary);break;case"transcode":e.then(()=>{try{const{faces:y,buffers:b,width:v,height:x,hasAlpha:w,format:C,type:S,dfdFlags:_}=c(A.buffer);self.postMessage({type:"transcode",id:A.id,data:{faces:y,width:v,height:x,hasAlpha:w,format:C,type:S,dfdFlags:_}},b)}catch(y){console.error(y),self.postMessage({type:"error",id:A.id,error:y.message})}});break}});function l(f){e=new Promise(A=>{i={wasmBinary:f,onRuntimeInitialized:A},BASIS(i)}).then(()=>{i.initializeBasis(),i.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function c(f){const A=new i.KTX2File(new Uint8Array(f));function y(){A.close(),A.delete()}if(!A.isValid())throw y(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let b;if(A.isUASTC())b=a.UASTC;else if(A.isETC1S())b=a.ETC1S;else if(A.isHDR())b=a.UASTC_HDR;else throw new Error("THREE.KTX2Loader: Unknown Basis encoding");const v=A.getWidth(),x=A.getHeight(),w=A.getLayers()||1,C=A.getLevels(),S=A.getFaces(),_=A.getHasAlpha(),I=A.getDFDFlags(),{transcoderFormat:B,engineFormat:M,engineType:R}=u(b,v,x,_);if(!v||!x||!C)throw y(),new Error("THREE.KTX2Loader:	Invalid texture");if(!A.startTranscoding())throw y(),new Error("THREE.KTX2Loader: .startTranscoding failed");const k=[],G=[];for(let X=0;X<S;X++){const F=[];for(let z=0;z<C;z++){const H=[];let Z,he;for(let _e=0;_e<w;_e++){const Ye=A.getImageLevelInfo(z,_e,X);X===0&&z===0&&_e===0&&(Ye.origWidth%4!==0||Ye.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),C>1?(Z=Ye.origWidth,he=Ye.origHeight):(Z=Ye.width,he=Ye.height);let je=new Uint8Array(A.getImageTranscodedSizeInBytes(z,_e,0,B));const le=A.transcodeImage(je,z,_e,X,B,0,-1,-1);if(R===r.HalfFloatType&&(je=new Uint16Array(je.buffer,je.byteOffset,je.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!le)throw y(),new Error("THREE.KTX2Loader: .transcodeImage failed.");H.push(je)}const be=g(H);F.push({data:be,width:Z,height:he}),G.push(be.buffer)}k.push({mipmaps:F,width:v,height:x,format:M,type:R})}return y(),{faces:k,buffers:G,width:v,height:x,hasAlpha:_,dfdFlags:I,format:M,type:R}}const h=[{if:"astcSupported",basisFormat:[a.UASTC],transcoderFormat:[o.ASTC_4x4,o.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],engineType:[r.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[o.BC7_M5,o.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],engineType:[r.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[o.BC1,o.BC3],engineFormat:[s.RGBA_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],engineType:[r.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[o.ETC1,o.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],engineType:[r.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[o.ETC1],engineFormat:[s.RGB_ETC1_Format],engineType:[r.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[o.PVRTC1_4_RGB,o.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],engineType:[r.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[a.UASTC_HDR],transcoderFormat:[o.BC6H],engineFormat:[s.RGB_BPTC_UNSIGNED_Format],engineType:[r.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[o.RGBA32,o.RGBA32],engineFormat:[s.RGBAFormat,s.RGBAFormat],engineType:[r.UnsignedByteType,r.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[a.UASTC_HDR],transcoderFormat:[o.RGBA_HALF],engineFormat:[s.RGBAFormat],engineType:[r.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],d={[a.ETC1S]:h.filter(f=>f.basisFormat.includes(a.ETC1S)).sort((f,A)=>f.priorityUASTC-A.priorityUASTC),[a.UASTC]:h.filter(f=>f.basisFormat.includes(a.UASTC)).sort((f,A)=>f.priorityUASTC-A.priorityUASTC),[a.UASTC_HDR]:h.filter(f=>f.basisFormat.includes(a.UASTC_HDR)).sort((f,A)=>f.priorityHDR-A.priorityHDR)};function u(f,A,y,b){const v=d[f];for(let x=0;x<v.length;x++){const w=v[x];if(w.if&&!n[w.if]||!w.basisFormat.includes(f)||b&&w.transcoderFormat.length<2||w.needsPowerOfTwo&&!(p(A)&&p(y)))continue;const C=w.transcoderFormat[b?1:0],S=w.engineFormat[b?1:0],_=w.engineType[0];return{transcoderFormat:C,engineFormat:S,engineType:_}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}function p(f){return f<=2?!0:(f&f-1)===0&&f!==0}function g(f){if(f.length===1)return f[0];let A=0;for(let v=0;v<f.length;v++){const x=f[v];A+=x.byteLength}const y=new Uint8Array(A);let b=0;for(let v=0;v<f.length;v++){const x=f[v];y.set(x,b),b+=x.byteLength}return y}};const r2e=new Set([Rm,Nw,ob]),G5={[Yq]:Rm,[Hq]:Rm,[Uq]:Rm,[Oq]:Rm,[Kq]:Nw,[Wq]:Nw,[zq]:Nw,[Fq]:Nw,[Qq]:ob,[Zq]:ob,[Dq]:ob,[Xq]:ob,[I5]:R7,[Jq]:L7,[jq]:L7},P5={[Yq]:Em,[Hq]:rb,[Uq]:Cd,[Oq]:Cd,[Kq]:Em,[Wq]:rb,[zq]:Cd,[Fq]:Cd,[Qq]:Em,[Zq]:rb,[Dq]:Cd,[Xq]:Cd,[I5]:rb,[Jq]:Cd,[jq]:Cd};async function o2e(n){const{vkFormat:e}=n;if(G5[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let i;n.supercompressionScheme===Nq&&(k5||(k5=new Promise(async o=>{const a=new i2e;await a.init(),o(a)})),i=await k5);const s=[];for(let o=0;o<n.levels.length;o++){const a=Math.max(1,n.pixelWidth>>o),l=Math.max(1,n.pixelHeight>>o),c=n.pixelDepth?Math.max(1,n.pixelDepth>>o):0,h=n.levels[o];let d;if(n.supercompressionScheme===KRe)d=h.levelData;else if(n.supercompressionScheme===Nq)d=i.decode(h.levelData,h.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let u;P5[e]===Em?u=new Float32Array(d.buffer,d.byteOffset,d.byteLength/Float32Array.BYTES_PER_ELEMENT):P5[e]===rb?u=new Uint16Array(d.buffer,d.byteOffset,d.byteLength/Uint16Array.BYTES_PER_ELEMENT):u=d,s.push({data:u,width:a,height:l,depth:c})}let r;if(r2e.has(G5[e]))r=n.pixelDepth===0?new a5(s[0].data,n.pixelWidth,n.pixelHeight):new oEe(s[0].data,n.pixelWidth,n.pixelHeight,n.pixelDepth);else{if(n.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new GR(s,n.pixelWidth,n.pixelHeight),r.minFilter=s.length===1?Tm:Pw,r.magFilter=Tm}return r.mipmaps=s,r.type=P5[e],r.format=G5[e],r.colorSpace=e$(n),r.needsUpdate=!0,Promise.resolve(r)}function e$(n){const e=n.dataFormatDescriptor[0];return e.colorPrimaries===JRe?e.transferFunction===Vq?ar:kl:e.colorPrimaries===qRe?e.transferFunction===Vq?n2e:s2e:(e.colorPrimaries===jRe||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),BD)}let Eb="https://www.gstatic.com/draco/versioned/decoders/1.5.7/",eC="https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";const a2e=Eb,l2e=eC;fetch(Eb+"draco_decoder.js",{method:"head"}).catch(n=>{Eb===a2e&&(Eb="./include/draco/"),eC===l2e&&(eC="./include/ktx2/")});function c2e(n){Eb=n}function h2e(n){eC=n}let Rb,VR,Lb;function XR(n){return Rb||(Rb=new WRe,Rb.setDecoderPath(Eb),Rb.setDecoderConfig({type:"js"})),Lb||(Lb=new Tb,Lb.setTranscoderPath(eC)),VR||(VR=ZRe),n?Lb.detectSupport(n):n!==null&&console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures might fail"),{dracoLoader:Rb,ktx2Loader:Lb,meshoptDecoder:VR}}function t$(n){n.dracoLoader||n.setDRACOLoader(Rb),n.ktx2Loader||n.setKTX2Loader(Lb),n.meshoptDecoder||n.setMeshoptDecoder(VR)}const N5=new WeakMap;function d2e(n,e){let i=N5.get(n);i?i=Object.assign(i,e):i=e,N5.set(n,i)}const i$=v5.prototype.load;function u2e(...n){const e=N5.get(this);let i=n[0];const s=new URL(i,window.location.href);if(s.hostname.endsWith("needle.tools")){const r=e?.progressive!==void 0?e.progressive:!0,o=e!=null&&e.usecase?e.usecase:"default";r?this.requestHeader.Accept=`*/*;progressive=allowed;usecase=${o}`:this.requestHeader.Accept=`*/*;usecase=${o}`,i=s.toString()}return n[0]=i,i$?.call(this,...n)}v5.prototype.load=u2e,tC("debugprogressive");function tC(n){if(typeof window>"u")return!1;const e=new URL(window.location.href).searchParams.get(n);return e==null||e==="0"||e==="false"?!1:e===""?!0:e}function p2e(n,e){if(e===void 0||e.startsWith("./")||e.startsWith("http")||n===void 0)return e;const i=n.lastIndexOf("/");if(i>=0){const s=n.substring(0,i+1);for(;s.endsWith("/")&&e.startsWith("/");)e=e.substring(1);return s+e}return e}let DR;function m2e(){return DR!==void 0||(DR=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent),tC("debugprogressive")&&console.log("[glTF Progressive]: isMobileDevice",DR)),DR}const V5=Symbol("needle:raycast-mesh");function iC(n){return n?.[V5]instanceof Jh?n[V5]:null}function g2e(n,e){if((n.type==="Mesh"||n.type==="SkinnedMesh")&&!iC(n)){const i=f2e(e);i.userData={isRaycastMesh:!0},n[V5]=i}}function f2e(n){const e=new Jh;for(const i in n.attributes)e.setAttribute(i,n.getAttribute(i));return e.setIndex(n.getIndex()),e}const Om=new Array,Yu="NEEDLE_progressive",Kn=tC("debugprogressive"),X5=Symbol("needle-progressive-texture"),nC=new Map,D5=new Set;if(Kn){let n=function(){e+=1,console.log("Toggle LOD level",e,nC),nC.forEach((r,o)=>{for(const a of r.keys){const l=o[a];if(l!=null){if(l.isBufferGeometry===!0){const c=Fi.getMeshLODInformation(l),h=c?Math.min(e,c.lods.length):0;o["DEBUG:LOD"]=e,Fi.assignMeshLOD(o,h),c&&(i=Math.max(i,c.lods.length-1))}else if(o.isMaterial===!0){o["DEBUG:LOD"]=e,Fi.assignTextureLOD(o,e);break}}}}),e>=i&&(e=-1)},e=-1,i=2,s=!1;window.addEventListener("keyup",r=>{r.key==="p"&&n(),r.key==="w"&&(s=!s,D5&&D5.forEach(o=>{o.name!="BackgroundCubeMaterial"&&o.glyphMap==null&&"wireframe"in o&&(o.wireframe=s)}))})}function n$(n,e,i){var s;if(!Kn)return;nC.has(n)||nC.set(n,{keys:[],sourceId:i});const r=nC.get(n);((s=r?.keys)==null?void 0:s.includes(e))==!1&&r.keys.push(e)}const Zr=class{constructor(n,e){this.loadMesh=i=>{var s,r;if(this._isLoadingMesh)return null;const o=(r=(s=this.parser.json.meshes[i])==null?void 0:s.extensions)==null?void 0:r[Yu];return o?(this._isLoadingMesh=!0,this.parser.getDependency("mesh",i).then(a=>{var l;return this._isLoadingMesh=!1,a&&Zr.registerMesh(this.url,o.guid,a,(l=o.lods)==null?void 0:l.length,void 0,o),a})):null},Kn&&console.log("Progressive extension registered for",e),this.parser=n,this.url=e}get name(){return Yu}static getMeshLODInformation(n){const e=this.getAssignedLODInformation(n);return e!=null&&e.key?this.lodInfos.get(e.key):null}static getMaterialMinMaxLODsCount(n,e){const i=this,s="LODS:minmax",r=n[s];if(r!=null)return r;if(e||(e={min_count:1/0,max_count:0,lods:[]}),Array.isArray(n)){for(const a of n)this.getMaterialMinMaxLODsCount(a,e);return n[s]=e,e}if(Kn==="verbose"&&console.log("getMaterialMinMaxLODsCount",n),n.type==="ShaderMaterial"||n.type==="RawShaderMaterial"){const a=n;for(const l of Object.keys(a.uniforms)){const c=a.uniforms[l].value;c?.isTexture===!0&&o(c,e)}}else if(n.isMaterial)for(const a of Object.keys(n)){const l=n[a];l?.isTexture===!0&&o(l,e)}return n[s]=e,e;function o(a,l){const c=i.getAssignedLODInformation(a);if(c){const h=i.lodInfos.get(c.key);if(h&&h.lods){l.min_count=Math.min(l.min_count,h.lods.length),l.max_count=Math.max(l.max_count,h.lods.length);for(let d=0;d<h.lods.length;d++){const u=h.lods[d];u.width&&(l.lods[d]=l.lods[d]||{min_height:1/0,max_height:0},l.lods[d].min_height=Math.min(l.lods[d].min_height,u.height),l.lods[d].max_height=Math.max(l.lods[d].max_height,u.height))}}}}}static hasLODLevelAvailable(n,e){var i;if(Array.isArray(n)){for(const o of n)if(this.hasLODLevelAvailable(o,e))return!0;return!1}if(n.isMaterial===!0){for(const o of Object.keys(n)){const a=n[o];if(a&&a.isTexture&&this.hasLODLevelAvailable(a,e))return!0}return!1}else if(n.isGroup===!0){for(const o of n.children)if(o.isMesh===!0&&this.hasLODLevelAvailable(o,e))return!0}let s,r;if(n.isMesh?s=n.geometry:(n.isBufferGeometry||n.isTexture)&&(s=n),s&&(i=s?.userData)!=null&&i.LODS){const o=s.userData.LODS;if(r=this.lodInfos.get(o.key),e===void 0)return r!=null;if(r)return Array.isArray(r.lods)?e<r.lods.length:e===0}return!1}static assignMeshLOD(n,e){var i;if(!n)return Promise.resolve(null);if(n instanceof Xm||n.isMesh===!0){const s=n.geometry,r=this.getAssignedLODInformation(s);if(!r)return Promise.resolve(null);for(const o of Om)(i=o.onBeforeGetLODMesh)==null||i.call(o,n,e);return n["LOD:requested level"]=e,Zr.getOrLoadLOD(s,e).then(o=>{if(n["LOD:requested level"]===e){if(delete n["LOD:requested level"],Array.isArray(o)){const a=r.index||0;o=o[a]}o&&s!=o&&(o?.isBufferGeometry?(n.geometry=o,Kn&&n$(n,"geometry",r.url)):Kn&&console.error("Invalid LOD geometry",o))}return o}).catch(o=>(console.error("Error loading mesh LOD",n,o),null))}else Kn&&console.error("Invalid call to assignMeshLOD: Request mesh LOD but the object is not a mesh",n);return Promise.resolve(null)}static assignTextureLOD(n,e=0){if(!n)return Promise.resolve(null);if(n.isMesh===!0){const i=n;if(Array.isArray(i.material)){const s=new Array;for(const r of i.material){const o=this.assignTextureLOD(r,e);s.push(o)}return Promise.all(s).then(r=>{const o=new Array;for(const a of r)Array.isArray(a)&&o.push(...a);return o})}else return this.assignTextureLOD(i.material,e)}if(n instanceof Vm||n.isMaterial===!0){const i=n,s=[],r=new Array;if(Kn&&D5.add(i),i.uniforms&&(i.isRawShaderMaterial||i.isShaderMaterial===!0)){const o=i;for(const a of Object.keys(o.uniforms)){const l=o.uniforms[a].value;if(l?.isTexture===!0){const c=this.assignTextureLODForSlot(l,e,i,a).then(h=>(h&&o.uniforms[a].value!=h&&(o.uniforms[a].value=h,o.uniformsNeedUpdate=!0),h));s.push(c),r.push(a)}}}else for(const o of Object.keys(i)){const a=i[o];if(a?.isTexture===!0){const l=this.assignTextureLODForSlot(a,e,i,o);s.push(l),r.push(o)}}return Promise.all(s).then(o=>{const a=new Array;for(let l=0;l<o.length;l++){const c=o[l],h=r[l];c&&c.isTexture===!0?a.push({material:i,slot:h,texture:c,level:e}):a.push({material:i,slot:h,texture:null,level:e})}return a})}if(n instanceof ro||n.isTexture===!0){const i=n;return this.assignTextureLODForSlot(i,e,null,null)}return Promise.resolve(null)}static assignTextureLODForSlot(n,e,i,s){return n?.isTexture!==!0?Promise.resolve(null):s==="glyphMap"?Promise.resolve(n):Zr.getOrLoadLOD(n,e).then(r=>{if(Array.isArray(r))return null;if(r?.isTexture===!0){if(r!=n){if(i&&s){const o=i[s];if(o){const a=this.getAssignedLODInformation(o);if(a&&a?.level<e)return Kn==="verbose"&&console.warn("Assigned texture level is already higher: ",a.level,e,i,o,r),null}i[s]=r}if(Kn&&s&&i){const o=this.getAssignedLODInformation(n);o&&n$(i,s,o.url)}}return r}else Kn=="verbose"&&console.warn("No LOD found for",n,e);return null}).catch(r=>(console.error("Error loading LOD",n,r),null))}afterRoot(n){var e,i;return Kn&&console.log("AFTER",this.url,n),(e=this.parser.json.textures)==null||e.forEach((s,r)=>{var o;if(s!=null&&s.extensions){const a=s?.extensions[Yu];if(a){if(!a.lods){Kn&&console.warn("Texture has no LODs",a);return}let l=!1;for(const c of this.parser.associations.keys())if(c.isTexture===!0){const h=this.parser.associations.get(c);h?.textures===r&&(l=!0,Zr.registerTexture(this.url,c,(o=a.lods)==null?void 0:o.length,r,a))}l||this.parser.getDependency("texture",r).then(c=>{var h;c&&Zr.registerTexture(this.url,c,(h=a.lods)==null?void 0:h.length,r,a)})}}}),(i=this.parser.json.meshes)==null||i.forEach((s,r)=>{if(s!=null&&s.extensions){const o=s?.extensions[Yu];if(o&&o.lods){for(const a of this.parser.associations.keys())if(a.isMesh){const l=this.parser.associations.get(a);l?.meshes===r&&Zr.registerMesh(this.url,o.guid,a,o.lods.length,l.primitives,o)}}}}),null}static async getOrLoadLOD(n,e){var i,s,r,o;const a=Kn=="verbose",l=n.userData.LODS;if(!l)return null;const c=l?.key;let h;if(n.isTexture===!0){const d=n;d.source&&d.source[X5]&&(h=d.source[X5])}if(h||(h=Zr.lodInfos.get(c)),h){if(e>0){let p=!1;const g=Array.isArray(h.lods);if(g&&e>=h.lods.length?p=!0:g||(p=!0),p)return this.lowresCache.get(c)}const d=Array.isArray(h.lods)?(i=h.lods[e])==null?void 0:i.path:h.lods;if(!d)return Kn&&!h["missing:uri"]&&(h["missing:uri"]=!0,console.warn("Missing uri for progressive asset for LOD "+e,h)),null;const u=p2e(l.url,d);if(u.endsWith(".glb")||u.endsWith(".gltf")){if(!h.guid)return console.warn("missing pointer for glb/gltf texture",h),null;const p=u+"_"+h.guid,g=this.previouslyLoaded.get(p);if(g!==void 0){a&&console.log(`LOD ${e} was already loading/loaded: ${p}`);let y=await g.catch(v=>(console.error(`Error loading LOD ${e} from ${u}
`,v),null)),b=!1;if(y==null||(y instanceof ro&&n instanceof ro?(s=y.image)!=null&&s.data||(r=y.source)!=null&&r.data?y=this.copySettings(n,y):(b=!0,this.previouslyLoaded.delete(p)):y instanceof Jh&&n instanceof Jh&&((o=y.attributes.position)!=null&&o.array||(b=!0,this.previouslyLoaded.delete(p)))),!b)return y}const f=h,A=new Promise(async(y,b)=>{const v=new v5;t$(v),Kn&&(await new Promise(_=>setTimeout(_,1e3)),a&&console.warn("Start loading (delayed) "+u,f.guid));let x=u;if(f&&Array.isArray(f.lods)){const _=f.lods[e];_.hash&&(x+="?v="+_.hash)}const w=await v.loadAsync(x).catch(_=>(console.error(`Error loading LOD ${e} from ${u}
`,_),null));if(!w)return null;const C=w.parser;a&&console.log("Loading finished "+u,f.guid);let S=0;if(w.parser.json.textures){let _=!1;for(const I of w.parser.json.textures){if(I!=null&&I.extensions){const B=I?.extensions[Yu];if(B!=null&&B.guid&&B.guid===f.guid){_=!0;break}}S++}if(_){let I=await C.getDependency("texture",S);return I&&Zr.assignLODInformation(l.url,I,c,e,void 0,void 0),a&&console.log('change "'+n.name+'" \u2192 "'+I.name+'"',u,S,I,p),n instanceof ro&&(I=this.copySettings(n,I)),I&&(I.guid=f.guid),y(I)}else Kn&&console.warn("Could not find texture with guid",f.guid,w.parser.json)}if(S=0,w.parser.json.meshes){let _=!1;for(const I of w.parser.json.meshes){if(I!=null&&I.extensions){const B=I?.extensions[Yu];if(B!=null&&B.guid&&B.guid===f.guid){_=!0;break}}S++}if(_){const I=await C.getDependency("mesh",S),B=f;if(a&&console.log(`Loaded Mesh "${I.name}"`,u,S,I,p),I.isMesh===!0){const M=I.geometry;return Zr.assignLODInformation(l.url,M,c,e,void 0,B.density),y(M)}else{const M=new Array;for(let R=0;R<I.children.length;R++){const k=I.children[R];if(k.isMesh===!0){const G=k.geometry;Zr.assignLODInformation(l.url,G,c,e,R,B.density),M.push(G)}}return y(M)}}else Kn&&console.warn("Could not find mesh with guid",f.guid,w.parser.json)}return y(null)});return this.previouslyLoaded.set(p,A),await A}else if(n instanceof ro){a&&console.log("Load texture from uri: "+u);const p=await new Cq().loadAsync(u);return p?(p.guid=h.guid,p.flipY=!1,p.needsUpdate=!0,p.colorSpace=n.colorSpace,a&&console.log(h,p)):Kn&&console.warn("failed loading",u),p}}else Kn&&console.warn(`Can not load LOD ${e}: no LOD info found for "${c}" ${n.name}`,n.type);return null}static assignLODInformation(n,e,i,s,r,o){if(!e)return;e.userData||(e.userData={});const a=new A2e(n,i,s,r,o);e.userData.LODS=a}static getAssignedLODInformation(n){var e;return((e=n?.userData)==null?void 0:e.LODS)||null}static copySettings(n,e){return e=e.clone(),Kn&&console.warn(`Copying texture settings
`,n.uuid,`
`,e.uuid),e.offset=n.offset,e.repeat=n.repeat,e.colorSpace=n.colorSpace,e.magFilter=n.magFilter,e.minFilter=n.minFilter,e.wrapS=n.wrapS,e.wrapT=n.wrapT,e.flipY=n.flipY,e.anisotropy=n.anisotropy,e.mipmaps||(e.generateMipmaps=n.generateMipmaps),e}};let Fi=Zr;Fi.registerTexture=(n,e,i,s,r)=>{if(Kn&&console.log("> Progressive: register texture",s,e.name,e.uuid,e,r),!e){Kn&&console.error("gltf-progressive: Register texture without texture");return}e.source&&(e.source[X5]=r);const o=r.guid;Zr.assignLODInformation(n,e,o,i,s,void 0),Zr.lodInfos.set(o,r),Zr.lowresCache.set(o,e)},Fi.registerMesh=(n,e,i,s,r,o)=>{var a;Kn&&console.log("> Progressive: register mesh",r,i.name,o,i.uuid,i);const l=i.geometry;if(!l){Kn&&console.warn("gltf-progressive: Register mesh without geometry");return}l.userData||(l.userData={}),Zr.assignLODInformation(n,l,e,s,r,o.density),Zr.lodInfos.set(e,o);let c=Zr.lowresCache.get(e);c?c.push(i.geometry):c=[i.geometry],Zr.lowresCache.set(e,c),s>0&&!iC(i)&&g2e(i,l);for(const h of Om)(a=h.onRegisteredNewMesh)==null||a.call(h,i,o)},Fi.lodInfos=new Map,Fi.previouslyLoaded=new Map,Fi.lowresCache=new Map;class A2e{constructor(e,i,s,r,o){this.url=e,this.key=i,this.level=s,r!=null&&(this.index=r),o!=null&&(this.density=o)}}var s$=(n,e,i)=>{if(!e.has(n))throw TypeError("Cannot "+i)},Yn=(n,e,i)=>(s$(n,e,"read from private field"),i?i.call(n):e.get(n)),w0=(n,e,i)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,i)},ju=(n,e,i,s)=>(s$(n,e,"write to private field"),s?s.call(n,i):e.set(n,i),i),nl,Zm,z5,Bb,sC,zR,Wm;const Eh=tC("debugprogressive"),y2e=tC("noprogressive"),F5=Symbol("Needle:LODSManager"),U5=Symbol("Needle:LODState"),kb=Symbol("Needle:CurrentLOD"),Rh={mesh_lod:-1,texture_lod:-1},Bc=class{constructor(n,e){this.projectionScreenMatrix=new Ji,this.targetTriangleDensity=2e5,this.updateInterval="auto",w0(this,nl,1),this.pause=!1,this.manual=!1,this._lodchangedlisteners=[],w0(this,Zm,void 0),w0(this,z5,new eRe),w0(this,Bb,0),w0(this,sC,0),w0(this,zR,0),w0(this,Wm,0),this._fpsBuffer=[60,60,60,60,60],this._sphere=new Mh,this._tempBox=new Sh,this._tempBox2=new Sh,this.tempMatrix=new Ji,this._tempWorldPosition=new xe,this._tempBoxSize=new xe,this._tempBox2Size=new xe,this.renderer=n,this.context={...e}}static getObjectLODState(n){return n[U5]}static addPlugin(n){Om.push(n)}static removePlugin(n){const e=Om.indexOf(n);e>=0&&Om.splice(e,1)}static get(n,e){if(n[F5])return console.debug("[gltf-progressive] LODsManager already exists for this renderer"),n[F5];const i=new Bc(n,{engine:"unknown",...e});return n[F5]=i,i}get plugins(){return Om}addEventListener(n,e){n==="changed"&&this._lodchangedlisteners.push(e)}removeEventListener(n,e){if(n==="changed"){const i=this._lodchangedlisteners.indexOf(e);i>=0&&this._lodchangedlisteners.splice(i,1)}}enable(){if(Yn(this,Zm))return;console.debug("[gltf-progressive] Enabling LODsManager for renderer");let n=0;ju(this,Zm,this.renderer.render);const e=this;XR(this.renderer),this.renderer.render=function(i,s){const r=e.renderer.getRenderTarget();(r==null||"isXRRenderTarget"in r&&r.isXRRenderTarget)&&(n=0,ju(e,Bb,Yn(e,Bb)+1),ju(e,sC,Yn(e,z5).getDelta()),ju(e,zR,Yn(e,zR)+Yn(e,sC)),e._fpsBuffer.shift(),e._fpsBuffer.push(1/Yn(e,sC)),ju(e,Wm,e._fpsBuffer.reduce((a,l)=>a+l)/e._fpsBuffer.length),Eh&&Yn(e,Bb)%200===0&&console.log("FPS",Math.round(Yn(e,Wm)),"Interval:",Yn(e,nl)));const o=n++;Yn(e,Zm).call(this,i,s),e.onAfterRender(i,s,o)}}disable(){Yn(this,Zm)&&(console.debug("[gltf-progressive] Disabling LODsManager for renderer"),this.renderer.render=Yn(this,Zm),ju(this,Zm,void 0))}update(n,e){this.internalUpdate(n,e)}onAfterRender(n,e,i){if(this.pause)return;const s=this.renderer.renderLists.get(n,0).opaque;let r=!0;if(s.length===1){const o=s[0].material;(o.name==="EffectMaterial"||o.name==="CopyShader")&&(r=!1)}if((e.parent&&e.parent.type==="CubeCamera"||i>=1&&e.type==="OrthographicCamera")&&(r=!1),r){if(y2e||(this.updateInterval==="auto"?Yn(this,Wm)<40&&Yn(this,nl)<10?(ju(this,nl,Yn(this,nl)+1),Eh&&console.warn("\u2193 Reducing LOD updates",Yn(this,nl),Yn(this,Wm).toFixed(0))):Yn(this,Wm)>=60&&Yn(this,nl)>1&&(ju(this,nl,Yn(this,nl)-1),Eh&&console.warn("\u2191 Increasing LOD updates",Yn(this,nl),Yn(this,Wm).toFixed(0))):ju(this,nl,this.updateInterval),Yn(this,nl)>0&&Yn(this,Bb)%Yn(this,nl)!=0))return;this.internalUpdate(n,e)}}internalUpdate(n,e){var i,s;const r=this.renderer.renderLists.get(n,0),o=r.opaque;this.projectionScreenMatrix.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);const a=this.targetTriangleDensity;for(const h of o){if(h.material&&(((i=h.geometry)==null?void 0:i.type)==="BoxGeometry"||((s=h.geometry)==null?void 0:s.type)==="BufferGeometry")&&(h.material.name==="SphericalGaussianBlur"||h.material.name=="BackgroundCubeMaterial"||h.material.name==="CubemapFromEquirect"||h.material.name==="EquirectangularToCubeUV")){Eh&&(h.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]||(h.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]=!0,console.warn("Ignoring skybox or BLIT object",h,h.material.name,h.material.type)));continue}switch(h.material.type){case"LineBasicMaterial":case"LineDashedMaterial":case"PointsMaterial":case"ShadowMaterial":case"MeshDistanceMaterial":case"MeshDepthMaterial":continue}if(Eh==="color"&&h.material&&!h.object.progressive_debug_color){h.object.progressive_debug_color=!0;const u=Math.random()*16777215,p=new PR({color:u});h.object.material=p}const d=h.object;(d instanceof Xm||d.isMesh)&&this.updateLODs(n,e,d,a)}const l=r.transparent;for(const h of l){const d=h.object;(d instanceof Xm||d.isMesh)&&this.updateLODs(n,e,d,a)}const c=r.transmissive;for(const h of c){const d=h.object;(d instanceof Xm||d.isMesh)&&this.updateLODs(n,e,d,a)}}updateLODs(n,e,i,s){var r,o;i.userData||(i.userData={});let a=i[U5];if(a||(a=new b2e,i[U5]=a),a.frames++<2)return;for(const c of Om)(r=c.onBeforeUpdateLOD)==null||r.call(c,this.renderer,n,e,i);this.calculateLodLevel(e,i,a,s,Rh),Rh.mesh_lod=Math.round(Rh.mesh_lod),Rh.texture_lod=Math.round(Rh.texture_lod),Rh.mesh_lod>=0&&this.loadProgressiveMeshes(i,Rh.mesh_lod);let l=Rh.texture_lod;if(i.material&&l>=0){const c=i["DEBUG:LOD"];c!=null&&(l=c),this.loadProgressiveTextures(i.material,l)}for(const c of Om)(o=c.onAfterUpdatedLOD)==null||o.call(c,this.renderer,n,e,i,Rh);a.lastLodLevel_Mesh=Rh.mesh_lod,a.lastLodLevel_Texture=Rh.texture_lod}loadProgressiveTextures(n,e){if(!n)return;if(Array.isArray(n)){for(const s of n)this.loadProgressiveTextures(s,e);return}let i=!1;(n[kb]===void 0||e<n[kb])&&(i=!0),i&&(n[kb]=e,Fi.assignTextureLOD(n,e).then(s=>{this._lodchangedlisteners.forEach(r=>r({type:"texture",level:e,object:n}))}))}loadProgressiveMeshes(n,e){if(!n)return Promise.resolve(null);if(n[kb]!==e){n[kb]=e;const i=n.geometry;return Fi.assignMeshLOD(n,e).then(s=>(s&&n[kb]==e&&i!=n.geometry&&this._lodchangedlisteners.forEach(r=>r({type:"mesh",level:e,object:n})),s))}return Promise.resolve(null)}static isInside(n,e){const i=n.min,s=n.max,r=(i.x+s.x)*.5,o=(i.y+s.y)*.5;return this._tempPtInside.set(r,o,i.z).applyMatrix4(e).z<0}calculateLodLevel(n,e,i,s,r){var o;if(!e){r.mesh_lod=-1,r.texture_lod=-1;return}if(!n){r.mesh_lod=-1,r.texture_lod=-1;return}let a=10+1,l=!1;if(Eh&&e["DEBUG:LOD"]!=null)return e["DEBUG:LOD"];const c=Fi.getMeshLODInformation(e.geometry),h=c?.lods,d=h&&h.length>0,u=Fi.getMaterialMinMaxLODsCount(e.material),p=u?.min_count!=1/0&&u.min_count>0&&u.max_count>0;if(!d&&!p){r.mesh_lod=0,r.texture_lod=0;return}d||(l=!0,a=0);const g=this.renderer.domElement.clientHeight||this.renderer.domElement.height;let f=e.geometry.boundingBox;if(e.type==="SkinnedMesh"){const A=e;if(!A.boundingBox)A.computeBoundingBox();else if(i.frames%30===0){const y=iC(A),b=A.geometry;y&&(A.geometry=y),A.computeBoundingBox(),A.geometry=b}f=A.boundingBox}if(f&&n.isPerspectiveCamera){const A=n;if(e.geometry.attributes.color&&e.geometry.attributes.color.count<100&&e.geometry.boundingSphere){this._sphere.copy(e.geometry.boundingSphere),this._sphere.applyMatrix4(e.matrixWorld);const S=n.getWorldPosition(this._tempWorldPosition);if(this._sphere.containsPoint(S)){r.mesh_lod=0,r.texture_lod=0;return}}if(this._tempBox.copy(f),this._tempBox.applyMatrix4(e.matrixWorld),Bc.isInside(this._tempBox,this.projectionScreenMatrix)){r.mesh_lod=0,r.texture_lod=0;return}if(this._tempBox.applyMatrix4(this.projectionScreenMatrix),this.renderer.xr.enabled&&A.fov>70){const S=this._tempBox.min,_=this._tempBox.max;let I=S.x,B=S.y,M=_.x,R=_.y;const k=2,G=1.5,X=(S.x+_.x)*.5,F=(S.y+_.y)*.5;I=(I-X)*k+X,B=(B-F)*k+F,M=(M-X)*k+X,R=(R-F)*k+F;const z=I<0&&M>0?0:Math.min(Math.abs(S.x),Math.abs(_.x)),H=B<0&&R>0?0:Math.min(Math.abs(S.y),Math.abs(_.y)),Z=Math.max(z,H);i.lastCentrality=(G-Z)*(G-Z)*(G-Z)}else i.lastCentrality=1;const y=this._tempBox.getSize(this._tempBoxSize);y.multiplyScalar(.5),screen.availHeight>0&&g>0&&y.multiplyScalar(g/screen.availHeight),y.x*=A.aspect;const b=n.matrixWorldInverse,v=this._tempBox2;v.copy(f),v.applyMatrix4(e.matrixWorld),v.applyMatrix4(b);const x=v.getSize(this._tempBox2Size),w=Math.max(x.x,x.y);if(Math.max(y.x,y.y)!=0&&w!=0&&(y.z=x.z/Math.max(x.x,x.y)*Math.max(y.x,y.y)),i.lastScreenCoverage=Math.max(y.x,y.y,y.z),i.lastScreenspaceVolume.copy(y),i.lastScreenCoverage*=i.lastCentrality,Eh&&Bc.debugDrawLine){const S=this.tempMatrix.copy(this.projectionScreenMatrix);S.invert();const _=Bc.corner0,I=Bc.corner1,B=Bc.corner2,M=Bc.corner3;_.copy(this._tempBox.min),I.copy(this._tempBox.max),I.x=_.x,B.copy(this._tempBox.max),B.y=_.y,M.copy(this._tempBox.max);const R=(_.z+M.z)*.5;_.z=I.z=B.z=M.z=R,_.applyMatrix4(S),I.applyMatrix4(S),B.applyMatrix4(S),M.applyMatrix4(S),Bc.debugDrawLine(_,I,255),Bc.debugDrawLine(_,B,255),Bc.debugDrawLine(I,M,255),Bc.debugDrawLine(B,M,255)}let C=999;if(h&&i.lastScreenCoverage>0){for(let S=0;S<h.length;S++)if(h[S].density/i.lastScreenCoverage<s){C=S;break}}C<a&&(a=C,l=!0)}if(l?r.mesh_lod=a:r.mesh_lod=i.lastLodLevel_Mesh,Eh&&r.mesh_lod!=i.lastLodLevel_Mesh){const A=h?.[r.mesh_lod];A&&console.log(`Mesh LOD changed: ${i.lastLodLevel_Mesh} \u2192 ${r.mesh_lod} (${A.density.toFixed(0)}) - ${e.name}`)}if(p){const A="saveData"in globalThis.navigator&&globalThis.navigator.saveData===!0;if(i.lastLodLevel_Texture<0){if(r.texture_lod=u.max_count-1,Eh){const y=u.lods[u.max_count-1];Eh&&console.log(`First Texture LOD ${r.texture_lod} (${y.max_height}px) - ${e.name}`)}}else{const y=i.lastScreenspaceVolume.x+i.lastScreenspaceVolume.y+i.lastScreenspaceVolume.z;let b=i.lastScreenCoverage*4;((o=this.context)==null?void 0:o.engine)==="model-viewer"&&(b*=1.5);const v=g/window.devicePixelRatio*b;for(let x=u.lods.length-1;x>=0;x--){let w=u.lods[x];if(!(A&&w.max_height>=2048)&&!(m2e()&&w.max_height>4096)&&w.max_height>v){if(r.texture_lod=x,r.texture_lod<i.lastLodLevel_Texture){const C=w.max_height;Eh&&console.log(`Texture LOD changed: ${i.lastLodLevel_Texture} \u2192 ${r.texture_lod} = ${C}px 
Screensize: ${v.toFixed(0)}px, Coverage: ${(100*i.lastScreenCoverage).toFixed(2)}%, Volume ${y.toFixed(1)} 
${e.name}`)}break}}}}else r.texture_lod=0}};let Xl=Bc;nl=new WeakMap,Zm=new WeakMap,z5=new WeakMap,Bb=new WeakMap,sC=new WeakMap,zR=new WeakMap,Wm=new WeakMap,Xl.corner0=new xe,Xl.corner1=new xe,Xl.corner2=new xe,Xl.corner3=new xe,Xl._tempPtInside=new xe;class b2e{constructor(){this.frames=0,this.lastLodLevel_Mesh=-1,this.lastLodLevel_Texture=-1,this.lastScreenCoverage=0,this.lastScreenspaceVolume=new xe,this.lastCentrality=0}}const r$=Symbol("NEEDLE_mesh_lod"),FR=Symbol("NEEDLE_texture_lod");let UR=null;function o$(){const n=v2e();n&&(n.mapURLs(function(e){return a$(),e}),a$(),UR?.disconnect(),UR=new MutationObserver(e=>{e.forEach(i=>{i.addedNodes.forEach(s=>{s instanceof HTMLElement&&s.tagName.toLowerCase()==="model-viewer"&&c$(s)})})}),UR.observe(document,{childList:!0,subtree:!0}))}function v2e(){return typeof customElements>"u"?null:customElements.get("model-viewer")||(customElements.whenDefined("model-viewer").then(()=>{console.debug("[gltf-progressive] model-viewer defined"),o$()}),null)}function a$(){typeof document>"u"||document.querySelectorAll("model-viewer").forEach(n=>{c$(n)})}const l$=new WeakSet;let x2e=0;function c$(n){if(!n||l$.has(n))return null;l$.add(n),console.debug("[gltf-progressive] found new model-viewer..."+ ++x2e+`
`,n.getAttribute("src"));let e=null,i=null,s=null;for(let r=n;r!=null;r=Object.getPrototypeOf(r)){const o=Object.getOwnPropertySymbols(r),a=o.find(h=>h.toString()=="Symbol(renderer)"),l=o.find(h=>h.toString()=="Symbol(scene)"),c=o.find(h=>h.toString()=="Symbol(needsRender)");!e&&a!=null&&(e=n[a].threeRenderer),!i&&l!=null&&(i=n[l]),!s&&c!=null&&(s=n[c])}if(e&&i){let r=function(){if(s){let a=0,l=setInterval(()=>{if(a++>5){clearInterval(l);return}s?.call(n)},300)}};console.debug("[gltf-progressive] setup model-viewer");const o=Xl.get(e,{engine:"model-viewer"});return Xl.addPlugin(new w2e),o.enable(),o.addEventListener("changed",()=>{s?.call(n)}),n.addEventListener("model-visibility",a=>{a.detail.visible&&s?.call(n)}),n.addEventListener("load",()=>{r()}),()=>{o.disable()}}return null}class w2e{constructor(){this._didWarnAboutMissingUrl=!1}onBeforeUpdateLOD(e,i,s,r){this.tryParseMeshLOD(i,r),this.tryParseTextureLOD(i,r)}getUrl(e){if(!e)return null;let i=e.getAttribute("src");return i||(i=e.src),i||(this._didWarnAboutMissingUrl||console.warn("No url found in modelviewer",e),this._didWarnAboutMissingUrl=!0),i}tryGetCurrentGLTF(e){return e._currentGLTF}tryGetCurrentModelViewer(e){return e.element}tryParseTextureLOD(e,i){if(i[FR]==!0)return;i[FR]=!0;const s=this.tryGetCurrentGLTF(e),r=this.tryGetCurrentModelViewer(e),o=this.getUrl(r);if(o&&s&&i.material){let a=function(c){var h,d,u;if(c[FR]==!0)return;c[FR]=!0,c.userData&&(c.userData.LOD=-1);const p=Object.keys(c);for(let g=0;g<p.length;g++){const f=p[g],A=c[f];if(A?.isTexture===!0){const y=(d=(h=A.userData)==null?void 0:h.associations)==null?void 0:d.textures;if(y==null)continue;const b=s.parser.json.textures[y];if(!b){console.warn("Texture data not found for texture index "+y);continue}if((u=b?.extensions)!=null&&u[Yu]){const v=b.extensions[Yu];v&&o&&Fi.registerTexture(o,A,v.lods.length,y,v)}}}};const l=i.material;if(Array.isArray(l))for(const c of l)a(c);else a(l)}}tryParseMeshLOD(e,i){var s,r;if(i[r$]==!0)return;i[r$]=!0;const o=this.tryGetCurrentModelViewer(e),a=this.getUrl(o);if(!a)return;const l=(r=(s=i.userData)==null?void 0:s.gltfExtensions)==null?void 0:r[Yu];if(l&&a){const c=i.uuid;Fi.registerMesh(a,c,i,0,l.lods.length,l)}}}o$();const Gb=[];function OR(n){Gb.indexOf(n)===-1&&Gb.push(n)}function C2e(n){const e=Gb.indexOf(n);e!==-1&&Gb.splice(e,1)}const Pb=[];function O5(n){Pb.indexOf(n)===-1&&Pb.push(n)}function S2e(n){const e=Pb.indexOf(n);e!==-1&&Pb.splice(e,1)}function h$(n){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-start",{detail:n}));for(let e=0;e<Gb.length;e++)Gb[e](n)}function d$(n){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-end",{detail:n}));for(let e=0;e<Pb.length;e++)Pb[e](n)}const Wr={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function u$(n){const e=await fetch(n);if(e.ok)return e.json();throw new Error(e.statusText)}async function _2e(n){if(!n)throw new Error("No basePath supplied");return await u$(`${n}/profilesList.json`)}async function M2e(n,e,i=null,s=!0){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const r=await _2e(e);let o;if(n.profiles.some(c=>{const h=r[c];return h&&(o={profileId:c,profilePath:`${e}/${h.path}`,deprecated:!!h.deprecated}),!!o}),!o){if(!i)throw new Error("No matching profile name found");const c=r[i];if(!c)throw new Error(`No matching profile name found and default profile "${i}" missing.`);o={profileId:i,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}}const a=await u$(o.profilePath);let l;if(s){let c;if(n.handedness==="any"?c=a.layouts[Object.keys(a.layouts)[0]]:c=a.layouts[n.handedness],!c)throw new Error(`No matching handedness, ${n.handedness}, in profile ${o.profileId}`);c.assetPath&&(l=o.profilePath.replace("profile.json",c.assetPath))}return{profile:a,assetPath:l}}const I2e={xAxis:0,yAxis:0,button:0,state:Wr.ComponentState.DEFAULT};function T2e(n=0,e=0){let i=n,s=e;if(Math.sqrt(n*n+e*e)>1){const r=Math.atan2(e,n);i=Math.cos(r),s=Math.sin(r)}return{normalizedXAxis:i*.5+.5,normalizedYAxis:s*.5+.5}}let E2e=class{constructor(n){this.componentProperty=n.componentProperty,this.states=n.states,this.valueNodeName=n.valueNodeName,this.valueNodeProperty=n.valueNodeProperty,this.valueNodeProperty===Wr.VisualResponseProperty.TRANSFORM&&(this.minNodeName=n.minNodeName,this.maxNodeName=n.maxNodeName),this.value=0,this.updateFromComponent(I2e)}updateFromComponent({xAxis:n,yAxis:e,button:i,state:s}){const{normalizedXAxis:r,normalizedYAxis:o}=T2e(n,e);switch(this.componentProperty){case Wr.ComponentProperty.X_AXIS:this.value=this.states.includes(s)?r:.5;break;case Wr.ComponentProperty.Y_AXIS:this.value=this.states.includes(s)?o:.5;break;case Wr.ComponentProperty.BUTTON:this.value=this.states.includes(s)?i:0;break;case Wr.ComponentProperty.STATE:this.valueNodeProperty===Wr.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(s):this.value=this.states.includes(s)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},R2e=class{constructor(n,e){if(!n||!e||!e.visualResponses||!e.gamepadIndices||Object.keys(e.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=n,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach(i=>{const s=new E2e(e.visualResponses[i]);this.visualResponses[i]=s}),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:Wr.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(n){if(this.values.state=Wr.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&n.buttons.length>this.gamepadIndices.button){const e=n.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||this.values.button===1?this.values.state=Wr.ComponentState.PRESSED:(e.touched||this.values.button>Wr.ButtonTouchThreshold)&&(this.values.state=Wr.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&n.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=n.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Wr.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Wr.AxisTouchThreshold&&(this.values.state=Wr.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&n.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=n.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Wr.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Wr.AxisTouchThreshold&&(this.values.state=Wr.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}},L2e=class{constructor(n,e,i){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=n,this.assetUrl=i,this.id=e.profileId,this.layoutDescription=e.layouts[n.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(s=>{const r=this.layoutDescription.components[s];this.components[s]=new R2e(s,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const n=[];return Object.values(this.components).forEach(e=>{n.push(e.data)}),n}updateFromGamepad(){Object.values(this.components).forEach(n=>{n.updateFromGamepad(this.xrInputSource.gamepad)})}};const _r=q("debuginput");var ZR=(n=>(n.Mouse="mouse",n.Touch="touch",n.Controller="controller",n.Hand="hand",n))(ZR||{}),rs=(n=>(n.PointerDown="pointerdown",n.PointerUp="pointerup",n.PointerMove="pointermove",n.KeyDown="keydown",n.KeyUp="keyup",n.KeyPressed="keypress",n))(rs||{});class Ju extends PointerEvent{constructor(e,i,s){super(e,s),m(this,"clientZ"),m(this,"deviceIndex"),m(this,"origin"),m(this,"source"),m(this,"mode"),m(this,"_ray"),m(this,"space"),m(this,"isClick",!1),m(this,"isDoubleClick",!1),m(this,"_used",!1),m(this,"_pointerid"),m(this,"_pointerType"),m(this,"_type"),m(this,"metadata",{}),m(this,"intersections",new Array),m(this,"_immediatePropagationStopped",!1),m(this,"_propagationStopped",!1),this.clientZ=s.clientZ,this._pointerid=s.pointerId,this._pointerType=s.pointerType,this._type=e,this.deviceIndex=s.deviceIndex,this.origin=s.origin,this.source=i,this.mode=s.mode,this._ray=s.ray,this.space=s.device}get isSpatial(){return this.mode!="screen"}get ray(){return this._ray||(this._ray=new ya(this.space.worldPosition.clone(),this.space.worldForward.clone())),this._ray}set ray(e){this._ray=e}get hasRay(){return this._ray!==void 0}get used(){return this._used}use(){this._used=!0}get pointerId(){return this._pointerid}get pointerType(){return this._pointerType}get type(){return this._type}get immediatePropagationStopped(){return this._immediatePropagationStopped}get propagationStopped(){return this._immediatePropagationStopped||this._propagationStopped}stopImmediatePropagation(){var e;this._immediatePropagationStopped=!0,super.stopImmediatePropagation(),(e=this.source)==null||e.stopImmediatePropagation()}stopPropagation(){var e;this._propagationStopped=!0,super.stopPropagation(),(e=this.source)==null||e.stopPropagation(),_r&&console.warn("Stop propagation...",this.pointerId,this.pointerType)}}class rC extends KeyboardEvent{constructor(e,i,s){super(e,s),m(this,"source"),this.source=i}stopImmediatePropagation(){var e;super.stopImmediatePropagation(),(e=this.source)==null||e.stopImmediatePropagation()}}class B2e{constructor(e){m(this,"key"),m(this,"keyType"),m(this,"source"),this.key=e.key,this.keyType=e.type,this.source=e}}var Dl=(n=>(n[n.Early=-100]="Early",n[n.Default=0]="Default",n[n.Late=100]="Late",n))(Dl||{});class p${constructor(e){m(this,"_eventListeners",{}),m(this,"_doubleClickTimeThreshold",.2),m(this,"_longPressTimeThreshold",1),m(this,"_specialCursorTrigger",0),m(this,"context"),m(this,"_pointerDown",[!1]),m(this,"_pointerUp",[!1]),m(this,"_pointerClick",[!1]),m(this,"_pointerDoubleClick",[!1]),m(this,"_pointerPressed",[!1]),m(this,"_pointerPositions",[new Q]),m(this,"_pointerPositionsLastFrame",[new Q]),m(this,"_pointerPositionsDelta",[new Q]),m(this,"_pointerPositionsRC",[new Q]),m(this,"_pointerPositionDown",[new E]),m(this,"_pointerDownTime",[]),m(this,"_pointerUpTime",[]),m(this,"_pointerUpTimestamp",[]),m(this,"_pointerIds",[]),m(this,"_pointerTypes",[""]),m(this,"_mouseWheelChanged",[!1]),m(this,"_mouseWheelDeltaY",[0]),m(this,"_pointerEvent",[]),m(this,"_pointerEventsPressed",[]),m(this,"_pointerSpace",[]),m(this,"_pressedStack",new Map),m(this,"_htmlEventSource"),m(this,"onLostFocus",()=>{for(const i in this.keysPressed)this.keysPressed[i].pressed=!1}),m(this,"onEndOfFrame",()=>{for(let i=0;i<this._pointerUp.length;i++)this._pointerUp[i]=!1;for(let i=0;i<this._pointerDown.length;i++)this._pointerDown[i]=!1;for(let i=0;i<this._pointerClick.length;i++)this._pointerClick[i]=!1;for(let i=0;i<this._pointerDoubleClick.length;i++)this._pointerDoubleClick[i]=!1;for(const i of this._pointerPositionsDelta)i.set(0,0);for(let i=0;i<this._mouseWheelChanged.length;i++)this._mouseWheelChanged[i]=!1;for(let i=0;i<this._mouseWheelDeltaY.length;i++)this._mouseWheelDeltaY[i]=0}),m(this,"onContextMenu",i=>{this.canReceiveInput(i)!==!1&&i instanceof PointerEvent&&i.pointerType}),m(this,"keysPressed",{}),m(this,"onKeyDown",i=>{if(_r&&console.log(`key down ${i.code}, ${this.context.application.hasFocus}`,i),!this.context.application.hasFocus)return;const s=this.keysPressed[i.code];if(s&&s.pressed)return;this.keysPressed[i.code]={pressed:!0,frame:this.context.time.frameCount+1,startFrame:this.context.time.frameCount+1,key:i.key,code:i.code};const r=new rC("keydown",i,i);this.onDispatchEvent(r)}),m(this,"onKeyPressed",i=>{if(!this.context.application.hasFocus)return;const s=this.keysPressed[i.code];if(!s)return;s.pressed=!0,s.frame=this.context.time.frameCount+1;const r=new rC("keypress",i,i);this.onDispatchEvent(r)}),m(this,"onKeyUp",i=>{if(!this.context.application.hasFocus)return;const s=this.keysPressed[i.code];if(!s)return;s.pressed=!1,s.frame=this.context.time.frameCount+1;const r=new rC("keyup",i,i);this.onDispatchEvent(r)}),m(this,"onWheelWindow",i=>{document.pointerLockElement&&this.onMouseWheel(i)}),m(this,"onMouseWheel",i=>{if(this.canReceiveInput(i)===!1)return;this._mouseWheelDeltaY.length<=0&&this._mouseWheelDeltaY.push(0),this._mouseWheelChanged.length<=0&&this._mouseWheelChanged.push(!1),this._mouseWheelChanged[0]=!0;const s=this._mouseWheelDeltaY[0];this._mouseWheelDeltaY[0]=s+i.deltaY}),m(this,"onPointerDown",i=>{if(this.context.isInAR||this.canReceiveInput(i)===!1)return;i.target instanceof HTMLElement&&i.target.setPointerCapture(i.pointerId);const s=this.getPointerId(i);_r&&ss(`pointer down #${s}, identifier:${i.pointerId}`);const r=this.getAndUpdateSpatialObjectForScreenPosition(s,i.clientX,i.clientY),o=new Ju("pointerdown",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:s,button:i.button,clientX:i.clientX,clientY:i.clientY,pointerType:i.pointerType,buttonName:this.getButtonName(i),device:r,pressure:i.pressure});this.onDown(o)}),m(this,"onPointerMove",i=>{if(this.context.isInAR)return;let s=i.button;i.pointerType==="mouse"&&(s=this.getFirstPressedButtonForPointer(0)??0);const r=this.getPointerId(i,s);s===-1&&(s=r);const o=this.getAndUpdateSpatialObjectForScreenPosition(r,i.clientX,i.clientY),a=new Ju("pointermove",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:r,button:s,clientX:i.clientX,clientY:i.clientY,pointerType:i.pointerType,buttonName:this.getButtonName(i),device:o,pressure:i.pressure});this.onMove(a)}),m(this,"onPointerCancel",i=>{this.context.isInAR||(_r&&console.log("Pointer cancel",i),this.onPointerUp(i))}),m(this,"onPointerUp",i=>{if(this.context.isInAR)return;i.target instanceof HTMLElement&&i.target.releasePointerCapture(i.pointerId);const s=this.getPointerId(i),r=new Ju("pointerup",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:s,button:i.button,clientX:i.clientX,clientY:i.clientY,pointerType:i.pointerType,buttonName:this.getButtonName(i),device:this.getAndUpdateSpatialObjectForScreenPosition(s,i.clientX,i.clientY),pressure:i.pressure});this.onUp(r),this._pointerIds[s]=-1,_r&&console.log("ID="+s,"PointerId="+i.pointerId,"ALL:",[...this._pointerIds])}),m(this,"onTouchStart",i=>{if(this.context.isInAR)for(let s=0;s<i.changedTouches.length;s++){const r=i.changedTouches[s],o=this.getPointerIndex(r.identifier),a=this.getAndUpdateSpatialObjectForScreenPosition(o,r.clientX,r.clientY),l=new Ju("pointerdown",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:o,button:0,clientX:r.clientX,clientY:r.clientY,pointerType:"touch",buttonName:"unknown",device:a,pressure:r.force});this.onDown(l)}}),m(this,"onTouchMove",i=>{if(this.context.isInAR)for(let s=0;s<i.changedTouches.length;s++){const r=i.changedTouches[s],o=this.getPointerIndex(r.identifier),a=this.getAndUpdateSpatialObjectForScreenPosition(o,r.clientX,r.clientY),l=new Ju("pointermove",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:o,button:0,clientX:r.clientX,clientY:r.clientY,pointerType:"touch",buttonName:"unknown",device:a,pressure:r.force});this.onMove(l)}}),m(this,"onTouchEnd",i=>{if(this.context.isInAR)for(let s=0;s<i.changedTouches.length;s++){const r=i.changedTouches[s],o=this.getPointerIndex(r.identifier),a=new Ju("pointerup",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:o,button:0,clientX:r.clientX,clientY:r.clientY,pointerType:"touch",buttonName:"unknown",device:this.getAndUpdateSpatialObjectForScreenPosition(o,r.clientX,r.clientY),pressure:r.force});this.onUp(a),this._pointerIds[o]=-1}}),m(this,"tempNearPlaneVector",new E),m(this,"tempFarPlaneVector",new E),m(this,"tempLookMatrix",new de),this.context=e,this.context.post_render_callbacks.push(this.onEndOfFrame)}addEventListener(e,i,s){if(this._eventListeners[e]||(this._eventListeners[e]=[]),!i||typeof i!="function"){console.error("Invalid call to addEventListener: callback is required and must be a function!");return}s?s={...s}:s={};let r=0;s?.queue!=null&&(r=s.queue);const o=this._eventListeners[e],a=o.find(l=>l.priority===r);a?a.listeners.push({callback:i,options:s}):(o.push({priority:r,listeners:[{callback:i,options:s}]}),o.sort((l,c)=>l.priority-c.priority))}removeEventListener(e,i,s){if(!this._eventListeners[e]||!i)return;const r=this._eventListeners[e];if(s?.queue!=null){const o=r.find(l=>l.priority===s.queue);if(!o)return;const a=o.listeners.findIndex(l=>l.callback===i);a>=0&&o.listeners.splice(a,1)}else for(const o of r){const a=o.listeners.findIndex(l=>l.callback===i);a>=0&&o.listeners.splice(a,1)}}dispatchEvent(e){var i,s,r,o;let a=!1;if(e instanceof rC){const l=this._eventListeners[e.type];if(l)for(const c of l)for(let h=0;h<c.listeners.length;h++){const d=c.listeners[h];if((s=(i=d.options)==null?void 0:i.signal)!=null&&s.aborted){c.listeners.splice(h,1),h--;continue}d.options.once&&(c.listeners.splice(h,1),h--),d.callback(e)}}if(e instanceof Ju){const l=this._eventListeners[e.type];if(l)for(const c of l){if(a)break;for(let h=0;h<c.listeners.length;h++){const d=c.listeners[h];if((o=(r=d.options)==null?void 0:r.signal)!=null&&o.aborted){c.listeners.splice(h,1),h--;continue}if(e.immediatePropagationStopped){a=!0,_r&&console.log("immediatePropagationStopped",e.type);break}else e.propagationStopped&&(a=!0,_r&&console.log("propagationStopped",e.type));d.options.once&&(c.listeners.splice(h,1),h--),d.callback(e)}}}}get mousePosition(){return this._pointerPositions[0]}get mousePositionRC(){return this._pointerPositionsRC[0]}get mouseDown(){return this._pointerDown[0]}get mouseUp(){return this._pointerUp[0]}get mouseClick(){return this._pointerClick[0]}get mouseDoubleClick(){return this._pointerDoubleClick[0]}get mousePressed(){return this._pointerPressed[0]}get mouseWheelChanged(){return this.getMouseWheelChanged(0)}get click(){return this._pointerClick[0]}get doubleClick(){return this._pointerDoubleClick[0]}setCursorPointer(){this._specialCursorTrigger+=1,this.context.domElement.style.cursor="pointer"}setCursorNormal(){this._specialCursorTrigger-=1,this._specialCursorTrigger=Math.max(0,this._specialCursorTrigger),this._specialCursorTrigger===0&&(this.context.domElement.style.cursor="default")}getIsPointerIdInUse(e){for(const i of this._pointerEventsPressed)if(i.pointerId===e&&i.used)return!0;return!1}getPointerPressedCount(){let e=0;for(let i=0;i<this._pointerPressed.length;i++)this._pointerPressed[i]&&e++;return e}getPointerPosition(e){return e>=this._pointerPositions.length?null:this._pointerPositions[e]}getPointerPositionLastFrame(e){return e>=this._pointerPositionsLastFrame.length?null:this._pointerPositionsLastFrame[e]}getPointerPositionDelta(e){return e>=this._pointerPositionsDelta.length?null:this._pointerPositionsDelta[e]}getPointerPositionRC(e){return e>=this._pointerPositionsRC.length?null:this._pointerPositionsRC[e]}getPointerDown(e){return e>=this._pointerDown.length?!1:this._pointerDown[e]}getPointerUp(e){return e>=this._pointerUp.length?!1:this._pointerUp[e]}getPointerPressed(e){return e>=this._pointerPressed.length?!1:this._pointerPressed[e]}getPointerClicked(e){return e>=this._pointerClick.length?!1:this._pointerClick[e]}getPointerDoubleClicked(e){return e>=this._pointerDoubleClick.length?!1:this._pointerDoubleClick[e]}getPointerDownTime(e){return e>=this._pointerDownTime.length?-1:this._pointerDownTime[e]}getPointerUpTime(e){return e>=this._pointerUpTime.length?-1:this._pointerUpTime[e]}getPointerLongPress(e){return e>=this._pointerDownTime.length?!1:this.getPointerPressed(e)&&this.context.time.time-this._pointerDownTime[e]>this._longPressTimeThreshold}getIsMouse(e){return e<0||e>=this._pointerTypes.length?!1:this._pointerTypes[e]==="mouse"}getIsTouch(e){return e<0||e>=this._pointerTypes.length?!1:this._pointerTypes[e]==="touch"}getTouchesPressedCount(){let e=0;for(let i=0;i<this._pointerPressed.length;i++)this._pointerPressed[i]&&this.getIsTouch(i)&&e++;return e}getMouseWheelChanged(e=0){return e>=this._mouseWheelChanged.length?!1:this._mouseWheelChanged[e]}getMouseWheelDeltaY(e=0){return e>=this._mouseWheelDeltaY.length?0:this._mouseWheelDeltaY[e]}getPointerEvent(e){if(!(e>=this._pointerEvent.length))return this._pointerEvent[e]??void 0}*foreachPointerId(e){for(let i=0;i<this._pointerTypes.length;i++)if(this._pointerIsActive(i)){if(e!==void 0){const s=this._pointerTypes[i];if(Array.isArray(e)){let r=!1;for(const o of e)if(s===o){r=!0;break}if(!r)continue}else if(e!==s)continue}yield i}}*foreachTouchId(){for(let e=0;e<this._pointerTypes.length;e++)this._pointerTypes[e]==="touch"&&this._pointerIsActive[e]&&(yield e)}_pointerIsActive(e){return e<0?!1:this._pointerPressed[e]||this._pointerDown[e]||this._pointerUp[e]}onDownButton(e,i){let s=this._pressedStack.get(e);s||(s=[],this._pressedStack.set(e,s)),s.push(i)}onReleaseButton(e,i){const s=this._pressedStack.get(e);if(!s)return;const r=s.indexOf(i);r>=0&&s.splice(r,1)}getFirstPressedButtonForPointer(e){const i=this._pressedStack.get(e);if(i)return i[0]}getLatestPressedButtonForPointer(e){const i=this._pressedStack.get(e);if(i)return i[i.length-1]}getKeyDown(){for(const e in this.keysPressed){const i=this.keysPressed[e];if(i.startFrame===this.context.time.frameCount)return i.key}return null}getKeyPressed(){for(const e in this.keysPressed){const i=this.keysPressed[e];if(i.pressed)return i.key}return null}isKeyDown(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const s=this.getCodeForCommonKeyName(e);if(s!==null){for(const r of s)if(this.isKeyDown(r))return!0;return!1}return((i=this.keysPressed[e])==null?void 0:i.startFrame)===this.context.time.frameCount&&this.keysPressed[e].pressed}isKeyUp(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const s=this.getCodeForCommonKeyName(e);if(s!==null){for(const r of s)if(this.isKeyUp(r))return!0;return!1}return((i=this.keysPressed[e])==null?void 0:i.frame)===this.context.time.frameCount&&!this.keysPressed[e].pressed}isKeyPressed(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const s=this.getCodeForCommonKeyName(e);if(s!==null){for(const r of s)if(this.isKeyPressed(r))return!0;return!1}return(i=this.keysPressed[e])==null?void 0:i.pressed}getCodeForCommonKeyName(e){if(e.length===1){if(e>="0"&&e<="9")return["Digit"+e];if(e>="a"&&e<="z")return["Key"+e.toUpperCase()];if(e==" ")return["Space"]}switch(e){case"shift":case"Shift":return["ShiftLeft","ShiftRight"];case"control":case"Control":return["ControlLeft","ControlRight"];case"alt":case"Alt":return["AltLeft","AltRight"]}return null}createInputEvent(e){switch(e.type){case"pointerdown":_r&&ss("Create Pointer down"),this.onDownButton(e.deviceIndex,e.button),this.onDown(e);break;case"pointermove":_r&&ss("Create Pointer move"),this.onMove(e);break;case"pointerup":_r&&ss("Create Pointer up"),this.onUp(e),this.onReleaseButton(e.deviceIndex,e.button);break}}convertScreenspaceToRaycastSpace(e){return e.x=(e.x-this.context.domX)/this.context.domWidth*2-1,e.y=-((e.y-this.context.domY)/this.context.domHeight)*2+1,e}bindEvents(){this.unbindEvents(),this._htmlEventSource=this.context.renderer.domElement,window.addEventListener("contextmenu",this.onContextMenu),this._htmlEventSource.addEventListener("pointerdown",this.onPointerDown,{passive:!0}),window.addEventListener("pointermove",this.onPointerMove,{passive:!0,capture:!0}),window.addEventListener("pointerup",this.onPointerUp,{passive:!0}),window.addEventListener("pointercancel",this.onPointerCancel,{passive:!0}),window.addEventListener("touchstart",this.onTouchStart,{passive:!0}),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchEnd,{passive:!0}),this._htmlEventSource.addEventListener("wheel",this.onMouseWheel,{passive:!0}),window.addEventListener("wheel",this.onWheelWindow,{passive:!0}),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keypress",this.onKeyPressed,!1),window.addEventListener("keyup",this.onKeyUp,!1),window.addEventListener("blur",this.onLostFocus)}unbindEvents(){var e,i;window.removeEventListener("contextmenu",this.onContextMenu),(e=this._htmlEventSource)==null||e.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("pointercancel",this.onPointerCancel),(i=this._htmlEventSource)==null||i.removeEventListener("wheel",this.onMouseWheel,!1),window.removeEventListener("wheel",this.onWheelWindow,!1),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keypress",this.onKeyPressed,!1),window.removeEventListener("keyup",this.onKeyUp,!1),window.removeEventListener("blur",this.onLostFocus)}dispose(){const e=this.context.post_render_callbacks.indexOf(this.onEndOfFrame);e>=0&&this.context.post_render_callbacks.splice(e,1),this.unbindEvents()}canReceiveInput(e){var i;return e.target===((i=this.context.renderer)==null?void 0:i.domElement)||e.target===this.context.domElement||this.context.isInAR||this.context.isInAR&&e.target===document.body&&Ft.isMozillaXR()?!0:(_r&&console.warn("CanReceiveInput:False for",e.target),!1)}getPointerId(e,i){return e.pointerType==="mouse"?0+(i??e.button):this.getPointerIndex(e.pointerId)}getButtonName(e){const i=e.button;if(e.pointerType==="mouse")switch(i){case 0:return"left";case 1:return"middle";case 2:return"right"}return"unknown"}getAndUpdateSpatialObjectForScreenPosition(e,i,s){let r=this._pointerSpace[e];r||(r=new Ae,this._pointerSpace[e]=r),this._pointerSpace[e]=r;const o=this.context.mainCamera;if(o){const a=this.tempNearPlaneVector.set(i,s,-1);this.convertScreenspaceToRaycastSpace(a);const l=this.tempFarPlaneVector.set(a.x,a.y,1);a.unproject(o),l.unproject(o);const c=o.worldUp||Lt(0,1,0).applyQuaternion(fn(o));this.tempLookMatrix.lookAt(l,a,c),r.position.set(a.x,a.y,a.z),r.quaternion.setFromRotationMatrix(this.tempLookMatrix)}return r}isInRect(e){if(this.context.isInXR)return!0;const i=this.context.domElement.getBoundingClientRect(),s=e.clientX,r=e.clientY,o=s>=i.x&&s<=i.right&&r>=i.y&&r<=i.bottom;return _r&&!o&&console.log("Not in rect",i,s,r),o}onDown(e){const i=e.pointerId;if(this.getPointerPressed(i)&&console.warn(`Received pointerDown for pointerId that is already pressed: ${i}`,_r?e:""),_r&&console.log(e.pointerType,"DOWN",i),!!this.isInRect(e)){for(this.setPointerState(i,this._pointerPressed,!0),this.setPointerState(i,this._pointerDown,!0),this.setPointerStateT(i,this._pointerEvent,e.source);i>=this._pointerTypes.length;)this._pointerTypes.push(e.pointerType);for(this._pointerTypes[i]=e.pointerType;i>=this._pointerPositionDown.length;)this._pointerPositionDown.push(new E);for(this._pointerPositionDown[i].set(e.clientX,e.clientY,e.clientZ??0);i>=this._pointerPositions.length;)this._pointerPositions.push(new Q);this._pointerPositions[i].set(e.clientX,e.clientY),i>=this._pointerDownTime.length&&this._pointerDownTime.push(0),this._pointerDownTime[i]=this.context.time.realtimeSinceStartup,this.updatePointerPosition(e),this._pointerEventsPressed.push(e),this.onDispatchEvent(e)}}onMove(e){const i=e.pointerId,s=this.getPointerPressed(i);s===!1&&!this.isInRect(e)||e.pointerType==="touch"&&!s||(this.updatePointerPosition(e),this.setPointerStateT(i,this._pointerEvent,e.source),this.onDispatchEvent(e))}onUp(e){const i=e.pointerId;if(!this.getPointerPressed(i)){_r&&console.log(e.pointerType,"UP",i,"was not down");return}_r&&console.log(e.pointerType,"UP",i),this.setPointerState(i,this._pointerPressed,!1),this.setPointerStateT(i,this._pointerEvent,e.source),this.setPointerState(i,this._pointerUp,!0),this.updatePointerPosition(e);for(let l=this._pointerEventsPressed.length-1;l>=0;l--)if(this._pointerEventsPressed[l].pointerId===i){this._pointerEventsPressed.splice(l,1);break}if(!this._pointerPositionDown[i]){_r&&An("Received pointer up event without matching down event for button: "+i),console.warn("Received pointer up event without matching down event for button: "+i);return}const s=this._pointerUpTime[i],r=this._pointerDownTime[i],o=this.context.time.realtimeSinceStartup,a=o-r;if(i>=this._pointerUpTime.length&&this._pointerUpTime.push(-99),this._pointerUpTime[i]=o,a<1){let l=e.clientX-this._pointerPositionDown[i].x,c=e.clientY-this._pointerPositionDown[i].y,h=0;if(e.isSpatial&&e.clientZ!=null&&(h=e.clientZ-this._pointerPositionDown[i].z,l*=200,c*=200,h*=200),Math.abs(l)<5&&Math.abs(c)<5&&Math.abs(h)<5){this.setPointerState(i,this._pointerClick,!0),e.isClick=!0;const d=o-s;_r&&console.log("CLICK",i,l,c,h,d),d<this._doubleClickTimeThreshold&&d>0&&(this.setPointerState(i,this._pointerDoubleClick,!0),e.isDoubleClick=!0)}}this.onDispatchEvent(e)}updatePointerPosition(e){const i=e.pointerId;for(;i>=this._pointerPositions.length;)this._pointerPositions.push(new Q);for(;i>=this._pointerPositionsLastFrame.length;)this._pointerPositionsLastFrame.push(new Q);for(;i>=this._pointerPositionsDelta.length;)this._pointerPositionsDelta.push(new Q);const s=this._pointerPositionsLastFrame[i];s.copy(this._pointerPositions[i]);const r=this._pointerPositionsDelta[i];let o=e.clientX-s.x,a=e.clientY-s.y;if(e.source instanceof MouseEvent||e.source instanceof TouchEvent){const d=e.source;o===0&&d.movementX!==0&&(o=d.movementX||0),a===0&&d.movementY!==0&&(a=d.movementY||0)}r.x+=o,r.y+=a,this._pointerPositions[i].x=e.clientX,this._pointerPositions[i].y=e.clientY;const l=e.clientX,c=e.clientY;for(;i>=this._pointerPositionsRC.length;)this._pointerPositionsRC.push(new Q);const h=this._pointerPositionsRC[i];h.set(l,c),this.convertScreenspaceToRaycastSpace(h)}getPointerIndex(e){let i=-1;for(let s=0;s<this._pointerIds.length;s++){if(this._pointerIds[s]===e)return s;i===-1&&this._pointerIds[s]===-1&&(i=s)}return i!==-1?(this._pointerIds[i]=e,i):(_r&&console.log("PUSH pointerId:",e),this._pointerIds.push(e),this._pointerIds.length-1)}setPointerState(e,i,s){i[e]=s}setPointerStateT(e,i,s){return i[e]=s,s}onDispatchEvent(e){const i=$t.Current;try{$t.Current=this.context,this.dispatchEvent(e)}finally{$t.Current=i}}}const Nb=new de().makeRotationY(Math.PI),kc=new Fe().setFromAxisAngle(new E(0,1,0),Math.PI),k2e=q("debugwebxr");class G2e{constructor(){if(m(this,"priority",-1e5),m(this,"gameObject"),this.gameObject=new Ae,this.gameObject.name="Implicit XR Rig",k2e){const e=Ez(16733661);e.position.y+=.5,this.gameObject.add(e)}}isXRRig(){return!0}get isActive(){return this.gameObject.visible}}const Md=q("debugwebxr"),WR=q("debugcustomgesture"),P2e="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",N2e="generic-trigger",V2e=new Fe().setFromEuler(new Oi(Di.degToRad(0),Di.degToRad(-90),Di.degToRad(-90))),X2e=new E(.04,-.04,0);class Z5{constructor(e,i,s){m(this,"xr"),m(this,"inputSource"),m(this,"index",0),m(this,"emitEvents",!0),m(this,"_connected",!0),m(this,"_isTracking",!1),m(this,"__gamepad"),m(this,"__hand"),m(this,"__side"),m(this,"_hitTestSource"),m(this,"_hasSelectEvent",!1),m(this,"_isMxInk",!1),m(this,"_isMxInkFallback",!1),m(this,"_isMetaQuestTouchController",!1),m(this,"_handJointPoses",new Map),m(this,"_gripMatrix",new de),m(this,"_gripPosition",new E),m(this,"_gripQuaternion",new Fe),m(this,"_linearVelocity",new E),m(this,"_rayPositionRaw",new E),m(this,"_rayRotationRaw",new Fe),m(this,"_rayMatrix",new de),m(this,"_rayPosition",new E),m(this,"_rayQuaternion",new Fe),m(this,"_gripWorldPosition",new E),m(this,"_gripWorldQuaternion",new Fe),m(this,"_rayWorldPosition",new E),m(this,"_rayWorldQuaternion",new Fe),m(this,"_pinchPosition",new E),m(this,"_ray"),m(this,"_hand_wristDotUp"),m(this,"_object"),m(this,"_gripSpaceObject"),m(this,"_raySpaceObject"),m(this,"model",null),m(this,"_debugAxesHelper",new Ya(.15)),m(this,"_debugGripAxesHelper",new Ya(.07)),m(this,"_debugRayAxesHelper",new Ya(.07)),m(this,"_hitTestSourcePromise",null),m(this,"onPointerHits",r=>{}),m(this,"_needleGamepadButtons",{}),m(this,"_buttonMap",new Map),m(this,"_motioncontroller"),m(this,"_layout"),m(this,"getMotionController"),m(this,"emitPointerDownEvent",!0),m(this,"emitPointerUpEvent",!0),m(this,"emitPointerMoveEvent",!0),m(this,"pointerMoveDistanceThreshold",.03),m(this,"pointerMoveAngleThreshold",.05),m(this,"_selectButtonIndex"),m(this,"_squeezeButtonIndex"),m(this,"onSelectStart",r=>{var o,a,l,c;if(!this.emitPointerDownEvent||this.inputSource!==r.inputSource)return;this.onUpdateFrame(r.frame),this._hasSelectEvent=!0;const h=(o=this._layout)==null?void 0:o.selectComponentId,d=(c=(l=(a=this._layout)==null?void 0:a.components[h])==null?void 0:l.gamepadIndices)==null?void 0:c.button;d!==void 0&&(this._selectButtonIndex=d),!WR&&(Md&&Nt.DrawDirection(this.rayWorldPosition,Lt(0,.01,1).applyQuaternion(this.rayWorldQuaternion),16711680,10),this.emitPointerEvent(rs.PointerDown,this._selectButtonIndex||0,"xr-standard-trigger",!0,r))}),m(this,"onSelectEnd",r=>{this.emitPointerUpEvent&&(WR||this.inputSource===r.inputSource&&this.emitPointerEvent(rs.PointerUp,this._selectButtonIndex||0,"xr-standard-trigger",!0,r))}),m(this,"onSequeezeStart",r=>{var o,a,l;this.emitPointerDownEvent&&this.inputSource===r.inputSource&&(this._squeezeButtonIndex=(l=(a=(o=this._layout)==null?void 0:o.components["xr-standard-squeeze"])==null?void 0:a.gamepadIndices)==null?void 0:l.button,this._squeezeButtonIndex!==void 0&&(Md&&Nt.DrawDirection(this.rayWorldPosition,Lt(0,.01,1).applyQuaternion(this.rayWorldQuaternion),255,10),this.emitPointerEvent(rs.PointerDown,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,r)))}),m(this,"onSequeezeEnd",r=>{this.emitPointerUpEvent&&this.inputSource===r.inputSource&&this._squeezeButtonIndex!==void 0&&this.emitPointerEvent(rs.PointerUp,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,r)}),m(this,"states",{}),m(this,"_didMoveLastFrame",!1),m(this,"_lastPointerMovePosition",new E),m(this,"_lastPointerMoveQuaternion",new Fe),m(this,"pointerInit"),this.xr=e,this.inputSource=i,this.index=s,this._object=new Ae,this._object.name=`NeedleXRController_${s}`,Md&&(this._object.add(this._debugAxesHelper),this._gripSpaceObject=new Ae,this._raySpaceObject=new Ae,this._gripSpaceObject.name=`NeedleXRController_${s}_gripSpace`,this._raySpaceObject.name=`NeedleXRController_${s}_raySpace`,this._gripSpaceObject.add(this._debugGripAxesHelper),this._raySpaceObject.add(this._debugRayAxesHelper),this.xr.context.scene.add(this._gripSpaceObject),this.xr.context.scene.add(this._raySpaceObject)),this.xr.context.scene.add(this._object),this._ray=new ya,this.pointerInit={origin:this,pointerType:this.hand?"hand":"controller",deviceIndex:this.index,pointerId:-1,mode:this.inputSource.targetRayMode,ray:this._ray,device:this._object,buttonName:"none"},this.initialize(),this.subscribeEvents()}get context(){return this.xr.context}get connected(){return this._connected}get isTracking(){return this._isTracking}get gamepad(){return this.__gamepad??(this.__gamepad=this.inputSource.gamepad)}get isHand(){return this.hand!=null}get hand(){return this.__hand??(this.__hand=this.inputSource.hand)}get handObject(){return this.context.renderer.xr.getHand(this.index)}get profiles(){return this.inputSource.profiles}get layout(){return this._layout}get targetRayMode(){return this.inputSource.targetRayMode}get targetRaySpace(){return this.inputSource.targetRaySpace}get gripSpace(){return this.inputSource.gripSpace}get side(){return this.__side??(this.__side=this.inputSource.handedness)}get isRight(){return this.side==="right"}get isLeft(){return this.side==="left"}get isStylus(){return this._isMxInk}getHitTestSource(){return this._hitTestSource||this._requestHitTestSource(),this._hitTestSource}get hasHitTestSource(){return this._hitTestSource}cancelHitTestSource(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0)}get hasSelectEvent(){return this._hasSelectEvent}getHitTest(){return this.xr.getHitTest(this)}getHandJointPose(e,i){var s;if(i=i||this.xr.frame,!this.hand||!(i!=null&&i.getJointPose)||!this.xr.referenceSpace)return null;let r=(s=this._handJointPoses)==null?void 0:s.get(e);return r||(r=i.getJointPose(e,this.xr.referenceSpace),r&&this._handJointPoses.set(e,r),r)}get gripPosition(){return Lt(this._gripPosition)}get gripQuaternion(){return bh(this._gripQuaternion)}get gripMatrix(){return this._gripMatrix}get gripLinearVelocity(){return Lt(this._linearVelocity).applyQuaternion(kc)}get rayPosition(){return Lt(this._rayPosition)}get rayQuaternion(){return bh(this._rayQuaternion)}get gripWorldPosition(){return Lt(this._gripWorldPosition)}get gripWorldQuaternion(){return bh(this._gripWorldQuaternion)}get rayWorldPosition(){return Lt(this._rayWorldPosition)}updateRayWorldPosition(){var e;const i=(e=this.xr.context.mainCamera)==null?void 0:e.parent;this._rayWorldPosition.copy(this._rayPositionRaw),i&&this._rayWorldPosition.applyMatrix4(i.matrixWorld)}get rayWorldQuaternion(){return bh(this._rayWorldQuaternion)}get pinchPosition(){return Lt(this._pinchPosition)}updateRayWorldQuaternion(){var e;const i=(e=this.xr.context.mainCamera)==null?void 0:e.parent,s=i?fn(i):void 0;this._rayWorldQuaternion.copy(this._rayRotationRaw).multiply(kc),s&&this._rayWorldQuaternion.premultiply(s)}get ray(){return this._ray.origin.copy(this.rayWorldPosition),this._ray.direction.copy(Lt(0,0,1).applyQuaternion(this.rayWorldQuaternion)),this._ray}get handWristDotUp(){var e;if(this._hand_wristDotUp!==void 0)return this._hand_wristDotUp;const i=(e=this.handObject)==null?void 0:e.joints.wrist;if(i){const s=Lt(0,1,0).applyQuaternion(i.quaternion),r=Lt(0,1,0).dot(s);return this._hand_wristDotUp=r}}get isHandUpsideDown(){return this.handWristDotUp!==void 0?this.handWristDotUp<-.7:!1}get isTeleportGesture(){var e;return this.isHandUpsideDown&&((e=this.getGesture("pinch"))==null?void 0:e.isDown)}get object(){return this._object}async getModelUrl(){var e;return(e=this.getMotionController)==null?void 0:e.then(i=>i?.assetUrl||null)}_requestHitTestSource(){var e;return this._hitTestSourcePromise?this._hitTestSourcePromise:this.xr.mode==="immersive-ar"&&this.inputSource.targetRayMode==="tracked-pointer"&&this.xr.session.requestHitTestSourceForTransientInput?this._hitTestSourcePromise=((e=this.xr.session.requestHitTestSourceForTransientInput({profile:this.inputSource.profiles[0],offsetRay:new XRRay}))==null?void 0:e.then(i=>(this._hitTestSourcePromise=null,this.connected?this._hitTestSource=i:(i.cancel(),null))))??null:null}onUpdate(e){performance.mark("NeedleXRController onUpdate start"),this.onUpdateFrame(e),this.updateInputEvents(),this.onUpdateMove(),performance.mark("NeedleXRController onUpdate end"),performance.measure("NeedleXRController onUpdate","NeedleXRController onUpdate start","NeedleXRController onUpdate end")}onRenderDebug(){var e;Nt.DrawSphere(this.rayWorldPosition,.003),Nt.DrawDirection(this.rayWorldPosition,Lt(0,0,10).applyQuaternion(this.rayWorldQuaternion));const i=(this.inputSource.gripSpace?this.gripWorldPosition:this.object.worldPosition).sub(this.object.worldForward.multiplyScalar(.1)),s=this.inputSource.profiles.join(`
`);let r=`Controller[${this.index}] (${this.inputSource.targetRayMode}, ${this.side})
C:${this.connected?"x":"-"} T:${this.isTracking?"x":"-"} Hand:${this.inputSource.hand?"x":"-"} Pen: ${this._isMxInk?"x":"-"}`;if(this.inputSource.hand&&(r+=`
Pinch: ${(e=this.getGesture("pinch"))==null?void 0:e.value.toFixed(3)}`),r+=`
`+s,r+=`
`+(this.inputSource.targetRaySpace?"Ray: x":"Ray: -")+(this.inputSource.gripSpace?" Grip: x":" Grip: -")+(this.inputSource.gamepad?` Gamepad: ${this.inputSource.gamepad.mapping}`:" Gamepad: -"),this.inputSource.gamepad){const o=this.inputSource.gamepad;let a="[btns "+o.buttons.length+"]: "+o.buttons.map(l=>l.value.toPrecision(1)).join(",");a+=`
[axes `+o.axes.length+"]: "+o.axes.map(l=>l.toPrecision(1)).join(","),r+=`
`+a}Nt.DrawLabel(i,r,.006)}onUpdateFrame(e){var i,s,r,o,a,l,c,h,d,u,p;if(this._handJointPoses.clear(),this._hand_wristDotUp=void 0,!this.xr.referenceSpace){this._isTracking=!1;return}const g=e.getPose(this.inputSource.targetRaySpace,this.xr.referenceSpace);this._isTracking=g!=null;let f=null,A=null,y=null,b=null;if(g){const C=g.transform;if(this._rayMatrix.fromArray(C.matrix).premultiply(Nb),this._rayMatrix.decompose(this._rayPosition,this._rayQuaternion,Lt(1,1,1)),y=Lt(C.position),b=bh(C.orientation),this._isMxInk&&!this._isMxInkFallback){const S=Lt(.013,0,-.028).applyQuaternion(b);y.add(S),this._rayPosition.add(S)}this._rayPositionRaw.copy(y),this._rayRotationRaw.copy(b)}if(this.inputSource.gripSpace){const C=e.getPose(this.inputSource.gripSpace,this.xr.referenceSpace);if(C){const S=C.transform;if(f=Lt(S.position),A=bh(S.orientation),this._gripMatrix.fromArray(S.matrix).premultiply(Nb),this._gripMatrix.decompose(this._gripPosition,this._gripQuaternion,Lt(1,1,1)),"linearVelocity"in C&&C.linearVelocity){const _=C.linearVelocity;this._linearVelocity.set(_.x,_.y,_.z)}}}(i=this.xr.context.mainCamera)!=null&&i.parent&&(this._object.parent!==((s=this.xr.context.mainCamera)==null?void 0:s.parent)&&this.xr.context.mainCamera.parent.add(this._object),this._gripSpaceObject!==void 0&&((r=this._gripSpaceObject)==null?void 0:r.parent)!==((o=this.xr.context.mainCamera)==null?void 0:o.parent)&&this.xr.context.mainCamera.parent.add(this._gripSpaceObject),this._raySpaceObject!==void 0&&((a=this._raySpaceObject)==null?void 0:a.parent)!==((l=this.xr.context.mainCamera)==null?void 0:l.parent)&&this.xr.context.mainCamera.parent.add(this._raySpaceObject));const v=this.hand;if(v){let C=!1;const S=v.get("wrist"),_=S&&this.getHandJointPose(S,e);if(_){C=!0;const M=_.transform.position,R=_.transform.orientation;this._object.position.set(M.x,M.y,M.z),this._object.quaternion.set(R.x,R.y,R.z,R.w).multiply(kc)}C||(this._object.position.copy(this._rayPosition),this._object.quaternion.copy(this._rayQuaternion).multiply(kc));const I=v.get("middle-finger-metacarpal"),B=I&&this.getHandJointPose(I,e);B&&(this._gripMatrix.fromArray(B.transform.matrix).premultiply(Nb),this._gripMatrix.decompose(this._gripPosition,this._gripQuaternion,Lt(1,1,1)),f=Lt().copy(B.transform.position),A=bh().copy(B.transform.orientation),A.multiply(V2e),f.add(Lt(X2e).applyQuaternion(A)))}else this.inputSource.gripSpace&&this.targetRayMode==="transient-pointer"&&f&&A?(this._object.position.copy(f),this._object.quaternion.copy(A).multiply(kc)):y&&b&&(this._object.position.copy(y),this._object.quaternion.copy(b).multiply(kc));Md&&(y&&b&&((c=this._raySpaceObject)==null||c.position.copy(y),(h=this._raySpaceObject)==null||h.quaternion.copy(b).multiply(kc)),f&&A&&((d=this._gripSpaceObject)==null||d.position.copy(f),(u=this._gripSpaceObject)==null||u.quaternion.copy(A).multiply(kc)));const x=(p=this.xr.context.mainCamera)==null?void 0:p.parent,w=x?fn(x):void 0;f&&A&&(this._gripWorldPosition.copy(f),x&&this._gripWorldPosition.applyMatrix4(x.matrixWorld),this._gripWorldQuaternion.copy(A),this._gripWorldQuaternion.multiply(kc),w&&this._gripWorldQuaternion.premultiply(w)),this.updateRayWorldPosition(),this.updateRayWorldQuaternion()}onDisconnected(){var e,i,s,r,o,a;this._connected=!1,Md&&console.warn("Controller disconnected",this.index);for(const l of this._object.children)this.xr.context.scene.attach(l);(e=this._object)==null||e.removeFromParent(),(i=this._debugAxesHelper)==null||i.removeFromParent(),(s=this._debugGripAxesHelper)==null||s.removeFromParent(),(r=this._debugRayAxesHelper)==null||r.removeFromParent(),(o=this._gripSpaceObject)==null||o.removeFromParent(),(a=this._raySpaceObject)==null||a.removeFromParent(),this.unsubscribeEvents(),this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0)}getButton(e){var i;if(!this._layout)return;switch(e){case"primary-button":if(this.isLeft)e="x-button";else if(this.isRight)e="a-button";else return;break;case"primary":return this.hand?this.getGesture("pinch"):this.toNeedleGamepadButton(0,e)}if(this._buttonMap.has(e))return this.toNeedleGamepadButton(this._buttonMap.get(e),e);const s=(i=this._layout)==null?void 0:i.components[e];if(s!=null&&s.gamepadIndices)switch(s.type){case"button":case"squeeze":if(this.inputSource.gamepad){const r=s.gamepadIndices.button;return this._buttonMap.set(e,r),this.toNeedleGamepadButton(r,e)}break;default:console.warn("Unsupported component type",s.type);break}this._buttonMap.set(e,void 0)}getGesture(e){const i=this.states[e];if(!i)return null;this.states[e]=i;const s=this._needleGamepadButtons[e]||new g$(void 0,e);return s.pressed=i.pressed,s.value=i.value,s.isDown=i.isDown,s.isUp=i.isUp,this._needleGamepadButtons[e]=s,s}getPointerId(e){if((e==="primary"||e==="pinch")&&(e=0),typeof e!="number"){const i=this._buttonMap.get(e);if(i===void 0)return;e=i}return this.index*10+e}toNeedleGamepadButton(e,i){var s,r;if(!((s=this.inputSource.gamepad)!=null&&s.buttons))return;const o=(r=this.inputSource.gamepad)==null?void 0:r.buttons[e],a=this.states[e],l=this._needleGamepadButtons[e]||new g$(e,i);return o&&(l.pressed=o.pressed,l.value=o.value,l.touched=o.touched),a&&(l.isDown=a.isDown,l.isUp=a.isUp),this._needleGamepadButtons[e]=l,l}getStick(e){var i,s,r,o,a,l,c,h,d;if(!this._layout)return{x:0,y:0,z:0};if(e==="primary"){const p=((i=this.inputSource.gamepad)==null?void 0:i.axes[0])||0,g=((s=this.inputSource.gamepad)==null?void 0:s.axes[1])||0,f=((o=(r=this.inputSource.gamepad)==null?void 0:r.buttons[3])==null?void 0:o.value)||0;return{x:p,y:g,z:f}}const u=(a=this._layout)==null?void 0:a.components[e];if(u!=null&&u.gamepadIndices)switch(u.type){case"thumbstick":if(this.inputSource.gamepad){const p=u.gamepadIndices.xAxis,g=u.gamepadIndices.yAxis;let f=(l=this.inputSource.gamepad)==null?void 0:l.axes[p],A=(c=this.inputSource.gamepad)==null?void 0:c.axes[g];f*=-1,A*=-1;const y=u.gamepadIndices.button,b=(d=(h=this.inputSource.gamepad)==null?void 0:h.buttons[y])==null?void 0:d.value;return{x:f,y:A,z:b}}}return{x:0,y:0,z:0}}initialize(){if(this._hasSelectEvent=this.profiles.includes("generic-hand-select")||this.profiles.some(e=>e.startsWith("generic-trigger")),this._isMetaQuestTouchController=this.profiles.includes("meta-quest-touch-plus")||this.profiles.includes("oculus-touch-v3"),this._isMxInk=this.profiles.includes("logitech-mx-ink"),!this._layout){if(this.inputSource.targetRayMode==="transient-pointer")return;const e=M2e(this.inputSource,P2e,N2e);this.getMotionController=e.then(i=>{var s;if(!this.connected)return null;this._isMxInk&&!i.assetPath&&(Md&&console.log("Falling back to custom MX Ink model",i.profile,i.assetPath),i.assetPath="https://cdn.needle.tools/static/models/controllers/logitech_vr_stylus_v1.3.1_grip_questos68.glb",this._isMxInkFallback=!0),this._motioncontroller=new L2e(this.inputSource,i.profile,i.assetPath||"");const r=i.profile.layouts[this.inputSource.handedness];if(this._layout=r,this._layout&&!((s=this._layout.gamepad)!=null&&s.length)){this._layout.gamepad=[];for(const o in this._layout.components){const a=this._layout.components[o];this._layout.gamepad[a.gamepadIndices.button]=o}}return this._motioncontroller}).catch(i=>(this.inputSource&&console.warn("Couldn't initialize motion controller profile for ",this.inputSource,i),null))}}subscribeEvents(){this.xr.session.addEventListener("selectstart",this.onSelectStart),this.xr.session.addEventListener("selectend",this.onSelectEnd),this.xr.session.addEventListener("squeezestart",this.onSequeezeStart),this.xr.session.addEventListener("squeezeend",this.onSequeezeEnd)}unsubscribeEvents(){this.xr.session.removeEventListener("selectstart",this.onSelectStart),this.xr.session.removeEventListener("selectend",this.onSelectEnd),this.xr.session.removeEventListener("squeezestart",this.onSequeezeStart),this.xr.session.removeEventListener("squeezeend",this.onSequeezeEnd)}updateInputEvents(){var e,i,s;if((e=this.gamepad)!=null&&e.buttons){for(let r=0;r<this.gamepad.buttons.length;r++){const o=this.gamepad.buttons[r],a=this.states[r]||new m$;let l=null;this._isMxInk&&(r===4||r===5)?(o.value>0&&!a.pressed?(l="pointerdown",a.isDown=!0,a.isUp=!1):o.value===0&&a.pressed?(l="pointerup",a.isDown=!1,a.isUp=!0):a.pressed&&(l="pointermove",a.isDown=!1,a.isUp=!1),a.pressed=o.value>0,a.value=o.value):(o.pressed&&!a.pressed?(l="pointerdown",a.isDown=!0,a.isUp=!1):!o.pressed&&a.pressed?(l="pointerup",a.isDown=!1,a.isUp=!0):(a.isDown=!1,a.isUp=!1),a.pressed=o.pressed,a.value=o.value),this.states[r]=a;const c=r!==this._selectButtonIndex&&r!==this._squeezeButtonIndex;if(l!=null&&c){let h=(i=this._layout)==null?void 0:i.gamepad[r];this._isMxInk&&r===4&&(h="stylus-touch"),this._isMxInk&&r===5&&(h="stylus-tip"),(Md||WR)&&console.log("Emitting pointer event",l,r,h,o.value,this.gamepad,this._layout),this.emitPointerEvent(l,r,h??"none",!1,null,o.value)}}if(this._isMetaQuestTouchController){const r=this.gamepad.buttons.length-1,o=this.states[r];if(o&&o.isDown){const a=this.context.menu;a.spatialMenuIsVisible?a.setSpatialMenuVisible(!1):this.context.menu.setSpatialMenuVisible(!0)}}}if(this.hand){const r=this.handObject;if(r){const o=r.joints["index-finger-tip"],a=r.joints["thumb-tip"];if(o&&a){const l=o.position.distanceTo(a.position);this._pinchPosition.lerpVectors(o.position,a.position,.5);const c=(s=this.xr.context.mainCamera)==null?void 0:s.parent;if(c&&this._pinchPosition.applyMatrix4(c.matrixWorld),l!==0){const h=this.states.pinch||new m$,d=(.02+.01)*1.5;h.value=1-(l-.02)/d;const u=l<.02-.01,p=l>.02+.01;u&&!h.pressed?(WR&&console.log("pinch start",l),h.isDown=!0,h.isUp=!1,h.pressed=!0):p&&h.pressed?(h.isDown=!1,h.isUp=!0,h.pressed=!1):(h.isDown=!1,h.isUp=!1),this.states.pinch=h}}}}}onUpdateMove(){var e,i;if(!this.emitPointerMoveEvent)return;let s=!1;if(this._lastPointerMovePosition.distanceTo(this.gripWorldPosition)>this.pointerMoveDistanceThreshold*this.xr.rigScale&&(s=!0),s||this._lastPointerMoveQuaternion.angleTo(this.gripWorldQuaternion)>this.pointerMoveAngleThreshold&&(s=!0),s){this._didMoveLastFrame=!0,this._lastPointerMovePosition.copy(this.gripWorldPosition),this._lastPointerMoveQuaternion.copy(this.gripWorldQuaternion),Md&&Nt.DrawLabel(this.rayWorldPosition.add(this.object.worldForward.multiplyScalar(.1)),"move",.01);let r=this.xr.context.input.getFirstPressedButtonForPointer(this.index);r===void 0&&(r=0);const o=(i=(e=this.gamepad)==null?void 0:e.buttons[r])==null?void 0:i.value;this.emitPointerEvent("pointermove",r,"none",!1,null,o)}else this._didMoveLastFrame=!1}emitPointerEvent(e,i,s,r,o=null,a){if(!this.emitEvents){Md&&e!==rs.PointerMove&&console.warn("Pointer events are disabled for this controller",this.index,e,i);return}if(this.xr.mode==="immersive-vr"||this.xr.isPassThrough){this.pointerInit.origin=this,this.pointerInit.pointerId=this.getPointerId(i),this.pointerInit.pointerType=this.hand?"hand":"controller",this.pointerInit.button=i,this.pointerInit.buttonName=s,this.pointerInit.isPrimary=r,this.pointerInit.mode=this.inputSource.targetRayMode,this.pointerInit.ray=this.ray,this.pointerInit.device=this.object,this.pointerInit.pressure=a,this.pointerInit.clientX=this._rayPosition.x/this.xr.rigScale,this.pointerInit.clientY=this._rayPosition.y/this.xr.rigScale,this.pointerInit.clientZ=this._rayPosition.z/this.xr.rigScale;const l=$t.Current;$t.Current=this.xr.context,Md&&e!=="pointermove"&&console.warn("Pointer event",e,i,s,{...this.pointerInit}),this.xr.context.input.createInputEvent(new Ju(e,o,this.pointerInit)),$t.Current=l}}}class m${constructor(){m(this,"isDown",!1),m(this,"isUp",!1),m(this,"pressed",!1),m(this,"value",0)}}class g${constructor(e,i){m(this,"index"),m(this,"name"),m(this,"touched",!1),m(this,"pressed",!1),m(this,"value",0),m(this,"isDown",!1),m(this,"isUp",!1),this.index=e,this.name=i}}const Vb=new Map,Xb=new Map;let f$=0;function qu(n,e,i){if(Vb.has(e)||Vb.set(e,new Array),Vb.get(e).push({method:n,options:{once:!1,...i}}),f$<30){const s=Xb.get(e);s&&s?.length>100&&(f$+=1,console.warn(`You have ${s.length} methods registered for Event ${e}.

This might be a performance issue!
Consider unregistering the methods when they are not needed anymore!

To unregister you can call the function returned by your event hook (e.g.const unregister = onStart(...)) 

or by using the once option like onStart(()=>{}, { once:true }).

See https://engine.needle.tools/docs/scripting.html#special-lifecycle-hooks for more information.`))}}function Hm(n,e){const i=Xb.get(e);if(i){for(let r=0;r<i.length;r++)if(i[r].method===n){i.splice(r,1);return}}const s=Vb.get(e);if(s){for(let r=0;r<s.length;r++)if(s[r].method===n){s.splice(r,1);return}}}function Id(n,e){e===nn.ContextCreated&&W5.delete(n),A$(n,e)}function A$(n,e){e===_n.Start&&Vb.get(nn.ContextCreated)&&A$(n,nn.ContextCreated);const i=e===_n.Start||e===nn.ContextCreated,s=Xb.get(e);s&&s.length>0&&b$(n,s,i);const r=Vb.get(e);if(r&&r.length>0){const o=[...r];r.length=0,b$(n,o,i),o.length>0&&(Xb.has(e)||Xb.set(e,new Array),Xb.get(e).push(...o))}}const HR=new Array,y$={context:null};function b$(n,e,i){var s,r;HR.length=0;for(let a=0;a<e.length;a++)HR.push(e[a]);let o=W5.get(n);for(let a=0;a<HR.length;a++){const l=HR[a];let c=!0;if(o&&o.has(l)&&(c=!1),c)try{y$.context=n,(s=l.method)==null||s.call(y$,n)}catch(h){console.error("Error in lifecycle method",h)}if((r=l.options)!=null&&r.once){for(let h=0;h<e.length;h++)if(e[h]===l){e.splice(h,1);break}}else i&&(o||(o=new Set,W5.set(n,o)),o.add(l))}}const W5=new WeakMap,H5=2,Td=4,$u=4,Q5=4,Qm=new Int32Array(2),v$=new Float32Array(Qm.buffer),x$=new Float64Array(Qm.buffer),QR=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;class zp{constructor(e,i){this.low=e|0,this.high=i|0}static create(e,i){return e==0&&i==0?zp.ZERO:new zp(e,i)}toFloat64(){return(this.low>>>0)+this.high*4294967296}equals(e){return this.low==e.low&&this.high==e.high}}zp.ZERO=new zp(0,0);var K5;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(K5||(K5={}));class q_{constructor(e){this.bytes_=e,this.position_=0}static allocate(e){return new q_(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return new zp(this.readInt32(e),this.readInt32(e+4))}readUint64(e){return new zp(this.readUint32(e),this.readUint32(e+4))}readFloat32(e){return Qm[0]=this.readInt32(e),v$[0]}readFloat64(e){return Qm[QR?0:1]=this.readInt32(e),Qm[QR?1:0]=this.readInt32(e+4),x$[0]}writeInt8(e,i){this.bytes_[e]=i}writeUint8(e,i){this.bytes_[e]=i}writeInt16(e,i){this.bytes_[e]=i,this.bytes_[e+1]=i>>8}writeUint16(e,i){this.bytes_[e]=i,this.bytes_[e+1]=i>>8}writeInt32(e,i){this.bytes_[e]=i,this.bytes_[e+1]=i>>8,this.bytes_[e+2]=i>>16,this.bytes_[e+3]=i>>24}writeUint32(e,i){this.bytes_[e]=i,this.bytes_[e+1]=i>>8,this.bytes_[e+2]=i>>16,this.bytes_[e+3]=i>>24}writeInt64(e,i){this.writeInt32(e,i.low),this.writeInt32(e+4,i.high)}writeUint64(e,i){this.writeUint32(e,i.low),this.writeUint32(e+4,i.high)}writeFloat32(e,i){v$[0]=i,this.writeInt32(e,Qm[0])}writeFloat64(e,i){x$[0]=i,this.writeInt32(e,Qm[QR?0:1]),this.writeInt32(e+4,Qm[QR?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Td+$u)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let i=0;i<$u;i++)e+=String.fromCharCode(this.readInt8(this.position_+Td+i));return e}__offset(e,i){const s=e-this.readInt32(e);return i<this.readInt16(s)?this.readInt16(s+i):0}__union(e,i){return e.bb_pos=i+this.readInt32(i),e.bb=this,e}__string(e,i){e+=this.readInt32(e);const s=this.readInt32(e);let r="",o=0;if(e+=Td,i===K5.UTF8_BYTES)return this.bytes_.subarray(e,e+s);for(;o<s;){let a;const l=this.readUint8(e+o++);if(l<192)a=l;else{const c=this.readUint8(e+o++);if(l<224)a=(l&31)<<6|c&63;else{const h=this.readUint8(e+o++);if(l<240)a=(l&15)<<12|(c&63)<<6|h&63;else{const d=this.readUint8(e+o++);a=(l&7)<<18|(c&63)<<12|(h&63)<<6|d&63}}}a<65536?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode((a>>10)+55296,(a&1024-1)+56320))}return r}__union_with_string(e,i){return typeof e=="string"?this.__string(i):this.__union(e,i)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Td}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=$u)throw new Error("FlatBuffers: file identifier must be length "+$u);for(let i=0;i<$u;i++)if(e.charCodeAt(i)!=this.readInt8(this.position()+Td+i))return!1;return!0}createLong(e,i){return zp.create(e,i)}createScalarList(e,i){const s=[];for(let r=0;r<i;++r)e(r)!==null&&s.push(e(r));return s}createObjList(e,i){const s=[];for(let r=0;r<i;++r){const o=e(r);o!==null&&s.push(o.unpack())}return s}}class $_{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null;let i;e?i=e:i=1024,this.bb=q_.allocate(i),this.space=i}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,i){e>this.minalign&&(this.minalign=e);const s=~(this.bb.capacity()-this.space+i)+1&e-1;for(;this.space<s+e+i;){const r=this.bb.capacity();this.bb=$_.growByteBuffer(this.bb),this.space+=this.bb.capacity()-r}this.pad(s)}pad(e){for(let i=0;i<e;i++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,i,s){(this.force_defaults||i!=s)&&(this.addInt8(i),this.slot(e))}addFieldInt16(e,i,s){(this.force_defaults||i!=s)&&(this.addInt16(i),this.slot(e))}addFieldInt32(e,i,s){(this.force_defaults||i!=s)&&(this.addInt32(i),this.slot(e))}addFieldInt64(e,i,s){(this.force_defaults||!i.equals(s))&&(this.addInt64(i),this.slot(e))}addFieldFloat32(e,i,s){(this.force_defaults||i!=s)&&(this.addFloat32(i),this.slot(e))}addFieldFloat64(e,i,s){(this.force_defaults||i!=s)&&(this.addFloat64(i),this.slot(e))}addFieldOffset(e,i,s){(this.force_defaults||i!=s)&&(this.addOffset(i),this.slot(e))}addFieldStruct(e,i,s){i!=s&&(this.nested(i),this.slot(e))}nested(e){if(e!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const i=e.capacity();if(i&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const s=i<<1,r=q_.allocate(s);return r.setPosition(s-i),r.bytes().set(e.bytes(),s-i),r}addOffset(e){this.prep(Td,0),this.writeInt32(this.offset()-e+Td)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let i=0;i<e;i++)this.vtable[i]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let i=this.vtable_in_use-1;for(;i>=0&&this.vtable[i]==0;i--);const s=i+1;for(;i>=0;i--)this.addInt16(this.vtable[i]!=0?e-this.vtable[i]:0);const r=2;this.addInt16(e-this.object_start);const o=(s+r)*H5;this.addInt16(o);let a=0;const l=this.space;e:for(i=0;i<this.vtables.length;i++){const c=this.bb.capacity()-this.vtables[i];if(o==this.bb.readInt16(c)){for(let h=H5;h<o;h+=H5)if(this.bb.readInt16(l+h)!=this.bb.readInt16(c+h))continue e;a=this.vtables[i];break}}return a?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,a-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,i,s){const r=s?Q5:0;if(i){const o=i;if(this.prep(this.minalign,Td+$u+r),o.length!=$u)throw new Error("FlatBuffers: file identifier must be length "+$u);for(let a=$u-1;a>=0;a--)this.writeInt8(o.charCodeAt(a))}this.prep(this.minalign,Td+r),this.addOffset(e),r&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,i){this.finish(e,i,!0)}requiredField(e,i){const s=this.bb.capacity()-e,r=s-this.bb.readInt32(s);if(this.bb.readInt16(r+i)==0)throw new Error("FlatBuffers: field "+i+" must be set")}startVector(e,i,s){this.notNested(),this.vector_num_elems=i,this.prep(Td,e*i),this.prep(s,e*i)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const i=this.createString(e);return this.string_maps.set(e,i),i}createString(e){if(!e)return 0;let i;if(e instanceof Uint8Array)i=e;else{i=[];let s=0;for(;s<e.length;){let r;const o=e.charCodeAt(s++);if(o<55296||o>=56320)r=o;else{const a=e.charCodeAt(s++);r=(o<<10)+a+(65536-56623104-56320)}r<128?i.push(r):(r<2048?i.push(r>>6&31|192):(r<65536?i.push(r>>12&15|224):i.push(r>>18&7|240,r>>12&63|128),i.push(r>>6&63|128)),i.push(r&63|128))}}this.addInt8(0),this.startVector(1,i.length,1),this.bb.setPosition(this.space-=i.length);for(let s=0,r=this.space,o=this.bb.bytes();s<i.length;s++)o[r++]=i[s];return this.endVector()}createLong(e,i){return zp.create(e,i)}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const i=[];for(let s=0;s<e.length;++s){const r=e[s];if(r!==null)i.push(this.createObjectOffset(r));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return i}createStructOffsetList(e,i){return i(this,e.length),this.createObjectOffsetList(e),this.endVector()}}const Y5={};function j5(n,e){Y5[n]=e}function w$(n){const e=n.getBufferIdentifier(),i=Y5[e];return i(n)}function C$(n){return typeof n.guid=="function"?n.guid():null}function KR(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var S$={exports:{}};(function(n){var e={};e.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),e.useArrayBufferView=!e.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),n.exports.binaryFeatures=e;var i=n.exports.BlobBuilder;typeof window<"u"&&(i=n.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function s(){this._pieces=[],this._parts=[]}s.prototype.append=function(r){typeof r=="number"?this._pieces.push(r):(this.flush(),this._parts.push(r))},s.prototype.flush=function(){if(this._pieces.length>0){var r=new Uint8Array(this._pieces);e.useArrayBufferView||(r=r.buffer),this._parts.push(r),this._pieces=[]}},s.prototype.getBuffer=function(){if(this.flush(),e.useBlobBuilder){for(var r=new i,o=0,a=this._parts.length;o<a;o++)r.append(this._parts[o]);return r.getBlob()}else return new Blob(this._parts)},n.exports.BufferBuilder=s})(S$);var _$=S$.exports,D2e=_$.BufferBuilder,M$=_$.binaryFeatures,z2e={unpack:function(n){var e=new vo(n);return e.unpack()},pack:function(n){var e=new xo;e.pack(n);var i=e.getBuffer();return i}},F2e=z2e;function vo(n){this.index=0,this.dataBuffer=n,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}vo.prototype.unpack=function(){var n=this.unpack_uint8();if(n<128)return n;if((n^224)<32)return(n^224)-32;var e;if((e=n^160)<=15)return this.unpack_raw(e);if((e=n^176)<=15)return this.unpack_string(e);if((e=n^144)<=15)return this.unpack_array(e);if((e=n^128)<=15)return this.unpack_map(e);switch(n){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}},vo.prototype.unpack_uint8=function(){var n=this.dataView[this.index]&255;return this.index++,n},vo.prototype.unpack_uint16=function(){var n=this.read(2),e=(n[0]&255)*256+(n[1]&255);return this.index+=2,e},vo.prototype.unpack_uint32=function(){var n=this.read(4),e=((n[0]*256+n[1])*256+n[2])*256+n[3];return this.index+=4,e},vo.prototype.unpack_uint64=function(){var n=this.read(8),e=((((((n[0]*256+n[1])*256+n[2])*256+n[3])*256+n[4])*256+n[5])*256+n[6])*256+n[7];return this.index+=8,e},vo.prototype.unpack_int8=function(){var n=this.unpack_uint8();return n<128?n:n-256},vo.prototype.unpack_int16=function(){var n=this.unpack_uint16();return n<32768?n:n-65536},vo.prototype.unpack_int32=function(){var n=this.unpack_uint32();return n<Math.pow(2,31)?n:n-Math.pow(2,32)},vo.prototype.unpack_int64=function(){var n=this.unpack_uint64();return n<Math.pow(2,63)?n:n-Math.pow(2,64)},vo.prototype.unpack_raw=function(n){if(this.length<this.index+n)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+n+" "+this.length);var e=this.dataBuffer.slice(this.index,this.index+n);return this.index+=n,e},vo.prototype.unpack_string=function(n){for(var e=this.read(n),i=0,s="",r,o;i<n;)r=e[i],r<128?(s+=String.fromCharCode(r),i++):(r^192)<32?(o=(r^192)<<6|e[i+1]&63,s+=String.fromCharCode(o),i+=2):(o=(r&15)<<12|(e[i+1]&63)<<6|e[i+2]&63,s+=String.fromCharCode(o),i+=3);return this.index+=n,s},vo.prototype.unpack_array=function(n){for(var e=new Array(n),i=0;i<n;i++)e[i]=this.unpack();return e},vo.prototype.unpack_map=function(n){for(var e={},i=0;i<n;i++){var s=this.unpack(),r=this.unpack();e[s]=r}return e},vo.prototype.unpack_float=function(){var n=this.unpack_uint32(),e=n>>31,i=(n>>23&255)-127,s=n&8388607|8388608;return(e===0?1:-1)*s*Math.pow(2,i-23)},vo.prototype.unpack_double=function(){var n=this.unpack_uint32(),e=this.unpack_uint32(),i=n>>31,s=(n>>20&2047)-1023,r=n&1048575|1048576,o=r*Math.pow(2,s-20)+e*Math.pow(2,s-52);return(i===0?1:-1)*o},vo.prototype.read=function(n){var e=this.index;if(e+n<=this.length)return this.dataView.subarray(e,e+n);throw new Error("BinaryPackFailure: read index out of range")};function xo(){this.bufferBuilder=new D2e}xo.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},xo.prototype.pack=function(n){var e=typeof n;if(e==="string")this.pack_string(n);else if(e==="number")Math.floor(n)===n?this.pack_integer(n):this.pack_double(n);else if(e==="boolean")n===!0?this.bufferBuilder.append(195):n===!1&&this.bufferBuilder.append(194);else if(e==="undefined")this.bufferBuilder.append(192);else if(e==="object")if(n===null)this.bufferBuilder.append(192);else{var i=n.constructor;if(i==Array)this.pack_array(n);else if(i==Blob||i==File||n instanceof Blob||n instanceof File)this.pack_bin(n);else if(i==ArrayBuffer)M$.useArrayBufferView?this.pack_bin(new Uint8Array(n)):this.pack_bin(n);else if("BYTES_PER_ELEMENT"in n)M$.useArrayBufferView?this.pack_bin(new Uint8Array(n.buffer)):this.pack_bin(n.buffer);else if(i==Object||i.toString().startsWith("class"))this.pack_object(n);else if(i==Date)this.pack_string(n.toString());else if(typeof n.toBinaryPack=="function")this.bufferBuilder.append(n.toBinaryPack());else throw new Error('Type "'+i.toString()+'" not yet supported')}else throw new Error('Type "'+e+'" not yet supported');this.bufferBuilder.flush()},xo.prototype.pack_bin=function(n){var e=n.length||n.byteLength||n.size;if(e<=15)this.pack_uint8(160+e);else if(e<=65535)this.bufferBuilder.append(218),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(n)},xo.prototype.pack_string=function(n){var e=O2e(n);if(e<=15)this.pack_uint8(176+e);else if(e<=65535)this.bufferBuilder.append(216),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(n)},xo.prototype.pack_array=function(n){var e=n.length;if(e<=15)this.pack_uint8(144+e);else if(e<=65535)this.bufferBuilder.append(220),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(e);else throw new Error("Invalid length");for(var i=0;i<e;i++)this.pack(n[i])},xo.prototype.pack_integer=function(n){if(n>=-32&&n<=127)this.bufferBuilder.append(n&255);else if(n>=0&&n<=255)this.bufferBuilder.append(204),this.pack_uint8(n);else if(n>=-128&&n<=127)this.bufferBuilder.append(208),this.pack_int8(n);else if(n>=0&&n<=65535)this.bufferBuilder.append(205),this.pack_uint16(n);else if(n>=-32768&&n<=32767)this.bufferBuilder.append(209),this.pack_int16(n);else if(n>=0&&n<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(n);else if(n>=-2147483648&&n<=2147483647)this.bufferBuilder.append(210),this.pack_int32(n);else if(n>=-9223372036854776e3&&n<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(n);else if(n>=0&&n<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(n);else throw new Error("Invalid integer")},xo.prototype.pack_double=function(n){var e=0;n<0&&(e=1,n=-n);var i=Math.floor(Math.log(n)/Math.LN2),s=n/Math.pow(2,i)-1,r=Math.floor(s*Math.pow(2,52)),o=Math.pow(2,32),a=e<<31|i+1023<<20|r/o&1048575,l=r%o;this.bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(l)},xo.prototype.pack_object=function(n){var e=Object.keys(n),i=e.length;if(i<=15)this.pack_uint8(128+i);else if(i<=65535)this.bufferBuilder.append(222),this.pack_uint16(i);else if(i<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(i);else throw new Error("Invalid length");for(var s in n)n.hasOwnProperty(s)&&(this.pack(s),this.pack(n[s]))},xo.prototype.pack_uint8=function(n){this.bufferBuilder.append(n)},xo.prototype.pack_uint16=function(n){this.bufferBuilder.append(n>>8),this.bufferBuilder.append(n&255)},xo.prototype.pack_uint32=function(n){var e=n&4294967295;this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)},xo.prototype.pack_uint64=function(n){var e=n/Math.pow(2,32),i=n%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((i&4278190080)>>>24),this.bufferBuilder.append((i&16711680)>>>16),this.bufferBuilder.append((i&65280)>>>8),this.bufferBuilder.append(i&255)},xo.prototype.pack_int8=function(n){this.bufferBuilder.append(n&255)},xo.prototype.pack_int16=function(n){this.bufferBuilder.append((n&65280)>>8),this.bufferBuilder.append(n&255)},xo.prototype.pack_int32=function(n){this.bufferBuilder.append(n>>>24&255),this.bufferBuilder.append((n&16711680)>>>16),this.bufferBuilder.append((n&65280)>>>8),this.bufferBuilder.append(n&255)},xo.prototype.pack_int64=function(n){var e=Math.floor(n/Math.pow(2,32)),i=n%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((i&4278190080)>>>24),this.bufferBuilder.append((i&16711680)>>>16),this.bufferBuilder.append((i&65280)>>>8),this.bufferBuilder.append(i&255)};function U2e(n){var e=n.charCodeAt(0);return e<=2047?"00":e<=65535?"000":e<=2097151?"0000":e<=67108863?"00000":"000000"}function O2e(n){return n.length>600?new Blob([n]).size:n.replace(/[^\u0000-\u007F]/g,U2e).length}const I$=KR(F2e);let T$=!0,E$=!0;function oC(n,e,i){const s=n.match(e);return s&&s.length>=i&&parseInt(s[i],10)}function Db(n,e,i){if(!n.RTCPeerConnection)return;const s=n.RTCPeerConnection.prototype,r=s.addEventListener;s.addEventListener=function(a,l){if(a!==e)return r.apply(this,arguments);const c=h=>{const d=i(h);d&&(l.handleEvent?l.handleEvent(d):l(d))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,c),r.apply(this,[a,c])};const o=s.removeEventListener;s.removeEventListener=function(a,l){if(a!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(l))return o.apply(this,arguments);const c=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[a,c])},Object.defineProperty(s,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function Z2e(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(T$=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function W2e(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(E$=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function J5(){if(typeof window=="object"){if(T$)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function YR(n,e){E$&&console.warn(n+" is deprecated, please use "+e+" instead.")}function H2e(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator)return e.browser="Not a browser.",e;const{navigator:i}=n;if(i.mozGetUserMedia)e.browser="firefox",e.version=oC(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection&&!n.RTCIceGatherer)e.browser="chrome",e.version=oC(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(i.mediaDevices&&i.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=oC(i.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(n.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=oC(i.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function R$(n){return Object.prototype.toString.call(n)==="[object Object]"}function L$(n){return R$(n)?Object.keys(n).reduce(function(e,i){const s=R$(n[i]),r=s?L$(n[i]):n[i],o=s&&!Object.keys(r).length;return r===void 0||o?e:Object.assign(e,{[i]:r})},{}):n}function q5(n,e,i){!e||i.has(e.id)||(i.set(e.id,e),Object.keys(e).forEach(s=>{s.endsWith("Id")?q5(n,n.get(e[s]),i):s.endsWith("Ids")&&e[s].forEach(r=>{q5(n,n.get(r),i)})}))}function B$(n,e,i){const s=i?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const o=[];return n.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&o.push(a)}),o.forEach(a=>{n.forEach(l=>{l.type===s&&l.trackId===a.id&&q5(n,l,r)})}),r}const k$=J5;function G$(n,e){const i=n&&n.navigator;if(!i.mediaDevices)return;const s=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const d=typeof l[h]=="object"?l[h]:{ideal:l[h]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const u=function(p,g){return p?p+g.charAt(0).toUpperCase()+g.slice(1):g==="deviceId"?"sourceId":g};if(d.ideal!==void 0){c.optional=c.optional||[];let p={};typeof d.ideal=="number"?(p[u("min",h)]=d.ideal,c.optional.push(p),p={},p[u("max",h)]=d.ideal,c.optional.push(p)):(p[u("",h)]=d.ideal,c.optional.push(p))}d.exact!==void 0&&typeof d.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[u("",h)]=d.exact):["min","max"].forEach(p=>{d[p]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[u(p,h)]=d[p])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},r=function(l,c){if(e.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const h=function(d,u,p){u in d&&!(p in d)&&(d[p]=d[u],delete d[u])};l=JSON.parse(JSON.stringify(l)),h(l.audio,"autoGainControl","googAutoGainControl"),h(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=s(l.audio)}if(l&&typeof l.video=="object"){let h=l.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const d=e.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete l.video.facingMode;let u;if(h.exact==="environment"||h.ideal==="environment"?u=["back","rear"]:(h.exact==="user"||h.ideal==="user")&&(u=["front"]),u)return i.mediaDevices.enumerateDevices().then(p=>{p=p.filter(f=>f.kind==="videoinput");let g=p.find(f=>u.some(A=>f.label.toLowerCase().includes(A)));return!g&&p.length&&u.includes("back")&&(g=p[p.length-1]),g&&(l.video.deviceId=h.exact?{exact:g.deviceId}:{ideal:g.deviceId}),l.video=s(l.video),k$("chrome: "+JSON.stringify(l)),c(l)})}l.video=s(l.video)}return k$("chrome: "+JSON.stringify(l)),c(l)},o=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(l,c,h){r(l,d=>{i.webkitGetUserMedia(d,c,u=>{h&&h(o(u))})})};if(i.getUserMedia=a.bind(i),i.mediaDevices.getUserMedia){const l=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(c){return r(c,h=>l(h).then(d=>{if(h.audio&&!d.getAudioTracks().length||h.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(u=>{u.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(o(d))))}}}function Q2e(n,e){if(!(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices)&&n.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}n.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then(s=>{const r=i.video&&i.video.width,o=i.video&&i.video.height,a=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:a||3}},r&&(i.video.mandatory.maxWidth=r),o&&(i.video.mandatory.maxHeight=o),n.navigator.mediaDevices.getUserMedia(i)})}}}function P$(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function N$(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let r;n.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===s.track.id):r={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(s=>{let r;n.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===s.id):r={track:s};const o=new Event("track");o.track=s,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Db(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function V$(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(r,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=r.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:r}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,l){let c=r.apply(this,arguments);return c||(c=e(this,a),this._senders.push(c)),c};const o=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){o.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const s=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],s.apply(this,[r]),r.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function X$(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[i,s,r]=arguments;if(arguments.length>0&&typeof i=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof i!="function"))return e.apply(this,[]);const o=function(l){const c={};return l.result().forEach(h=>{const d={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(u=>{d[u]=h.stat(u)}),c[d.id]=d}),c},a=function(l){return new Map(Object.keys(l).map(c=>[c,l[c]]))};if(arguments.length>=2){const l=function(c){s(a(o(c)))};return e.apply(this,[l,i])}return new Promise((l,c)=>{e.apply(this,[function(h){l(a(o(h)))},c])}).then(s,r)}}function D$(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const i=n.RTCPeerConnection.prototype.getSenders;i&&(n.RTCPeerConnection.prototype.getSenders=function(){const r=i.apply(this,[]);return r.forEach(o=>o._pc=this),r});const s=n.RTCPeerConnection.prototype.addTrack;s&&(n.RTCPeerConnection.prototype.addTrack=function(){const r=s.apply(this,arguments);return r._pc=this,r}),n.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>B$(o,r.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const i=n.RTCPeerConnection.prototype.getReceivers;i&&(n.RTCPeerConnection.prototype.getReceivers=function(){const s=i.apply(this,[]);return s.forEach(r=>r._pc=this),s}),Db(n,"track",s=>(s.receiver._pc=s.srcElement,s)),n.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(r=>B$(r,s.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const i=arguments[0];let s,r,o;return this.getSenders().forEach(a=>{a.track===i&&(s?o=!0:s=a)}),this.getReceivers().forEach(a=>(a.track===i&&(r?o=!0:r=a),a.track===i)),o||s&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function z$(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(h=>h.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();i.apply(this,arguments);const l=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const s=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],s.apply(this,arguments)};const r=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function F$(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return z$(n);const i=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const h=i.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(d=>this._reverseStreams[d.id])};const s=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(d=>{if(this.getSenders().find(u=>u.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const d=new n.MediaStream(h.getTracks());this._streams[h.id]=d,this._reverseStreams[d.id]=h,h=d}s.apply(this,[h])};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},n.RTCPeerConnection.prototype.addTrack=function(h,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const u=[].slice.call(arguments,1);if(u.length!==1||!u[0].getTracks().find(g=>g===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const p=this._streams[d.id];if(p)p.addTrack(h),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new n.MediaStream([h]);this._streams[d.id]=g,this._reverseStreams[g.id]=d,this.addStream(g)}return this.getSenders().find(g=>g.track===h)};function o(h,d){let u=d.sdp;return Object.keys(h._reverseStreams||[]).forEach(p=>{const g=h._reverseStreams[p],f=h._streams[g.id];u=u.replace(new RegExp(f.id,"g"),g.id)}),new RTCSessionDescription({type:d.type,sdp:u})}function a(h,d){let u=d.sdp;return Object.keys(h._reverseStreams||[]).forEach(p=>{const g=h._reverseStreams[p],f=h._streams[g.id];u=u.replace(new RegExp(g.id,"g"),f.id)}),new RTCSessionDescription({type:d.type,sdp:u})}["createOffer","createAnswer"].forEach(function(h){const d=n.RTCPeerConnection.prototype[h],u={[h](){const p=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[g=>{const f=o(this,g);p[0].apply(null,[f])},g=>{p[1]&&p[1].apply(null,g)},arguments[2]]):d.apply(this,arguments).then(g=>o(this,g))}};n.RTCPeerConnection.prototype[h]=u[h]});const l=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=a(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const h=c.get.apply(this);return h.type===""?h:o(this,h)}}),n.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(h._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let d;Object.keys(this._streams).forEach(u=>{this._streams[u].getTracks().find(p=>h.track===p)&&(d=this._streams[u])}),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function $5(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=n.RTCPeerConnection.prototype[i],r={[i](){return arguments[0]=new(i==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};n.RTCPeerConnection.prototype[i]=r[i]})}function U$(n,e){Db(n,"negotiationneeded",i=>{const s=i.target;if(!((e.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")&&s.signalingState!=="stable"))return i})}const O$=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:U$,shimAddTrackRemoveTrack:F$,shimAddTrackRemoveTrackWithNative:z$,shimGetDisplayMedia:Q2e,shimGetSendersWithDtmf:V$,shimGetStats:X$,shimGetUserMedia:G$,shimMediaStream:P$,shimOnTrack:N$,shimPeerConnection:$5,shimSenderReceiverGetStats:D$},Symbol.toStringTag,{value:"Module"}));function K2e(n,e){let i=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(s=>{if(s&&(s.urls||s.url)){let r=s.urls||s.url;s.url&&!s.urls&&YR("RTCIceServer.url","RTCIceServer.urls");const o=typeof r=="string";return o&&(r=[r]),r=r.filter(a=>{if(a.indexOf("stun:")===0)return!1;const l=a.startsWith("turn")&&!a.startsWith("turn:[")&&a.includes("transport=udp");return l&&!i?(i=!0,!0):l&&!i}),delete s.url,s.urls=o?r[0]:r,!!r.length}})}var Z$={exports:{}};(function(n){var e={};e.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},e.localCName=e.generateIdentifier(),e.splitLines=function(i){return i.trim().split(`
`).map(function(s){return s.trim()})},e.splitSections=function(i){var s=i.split(`
m=`);return s.map(function(r,o){return(o>0?"m="+r:r).trim()+`\r
`})},e.getDescription=function(i){var s=e.splitSections(i);return s&&s[0]},e.getMediaSections=function(i){var s=e.splitSections(i);return s.shift(),s},e.matchPrefix=function(i,s){return e.splitLines(i).filter(function(r){return r.indexOf(s)===0})},e.parseCandidate=function(i){var s;i.indexOf("a=candidate:")===0?s=i.substring(12).split(" "):s=i.substring(10).split(" ");for(var r={foundation:s[0],component:parseInt(s[1],10),protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]},o=8;o<s.length;o+=2)switch(s[o]){case"raddr":r.relatedAddress=s[o+1];break;case"rport":r.relatedPort=parseInt(s[o+1],10);break;case"tcptype":r.tcpType=s[o+1];break;case"ufrag":r.ufrag=s[o+1],r.usernameFragment=s[o+1];break;default:r[s[o]]=s[o+1];break}return r},e.writeCandidate=function(i){var s=[];s.push(i.foundation),s.push(i.component),s.push(i.protocol.toUpperCase()),s.push(i.priority),s.push(i.address||i.ip),s.push(i.port);var r=i.type;return s.push("typ"),s.push(r),r!=="host"&&i.relatedAddress&&i.relatedPort&&(s.push("raddr"),s.push(i.relatedAddress),s.push("rport"),s.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(s.push("ufrag"),s.push(i.usernameFragment||i.ufrag)),"candidate:"+s.join(" ")},e.parseIceOptions=function(i){return i.substr(14).split(" ")},e.parseRtpMap=function(i){var s=i.substr(9).split(" "),r={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),r.name=s[0],r.clockRate=parseInt(s[1],10),r.channels=s.length===3?parseInt(s[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(i){var s=i.payloadType;i.preferredPayloadType!==void 0&&(s=i.preferredPayloadType);var r=i.channels||i.numChannels||1;return"a=rtpmap:"+s+" "+i.name+"/"+i.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(i){var s=i.substr(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1]}},e.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+`\r
`},e.parseFmtp=function(i){for(var s={},r,o=i.substr(i.indexOf(" ")+1).split(";"),a=0;a<o.length;a++)r=o[a].trim().split("="),s[r[0].trim()]=r[1];return s},e.writeFmtp=function(i){var s="",r=i.payloadType;if(i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){var o=[];Object.keys(i.parameters).forEach(function(a){i.parameters[a]?o.push(a+"="+i.parameters[a]):o.push(a)}),s+="a=fmtp:"+r+" "+o.join(";")+`\r
`}return s},e.parseRtcpFb=function(i){var s=i.substr(i.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},e.writeRtcpFb=function(i){var s="",r=i.payloadType;return i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(function(o){s+="a=rtcp-fb:"+r+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),s},e.parseSsrcMedia=function(i){var s=i.indexOf(" "),r={ssrc:parseInt(i.substr(7,s-7),10)},o=i.indexOf(":",s);return o>-1?(r.attribute=i.substr(s+1,o-s-1),r.value=i.substr(o+1)):r.attribute=i.substr(s+1),r},e.parseSsrcGroup=function(i){var s=i.substr(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(function(r){return parseInt(r,10)})}},e.getMid=function(i){var s=e.matchPrefix(i,"a=mid:")[0];if(s)return s.substr(6)},e.parseFingerprint=function(i){var s=i.substr(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1]}},e.getDtlsParameters=function(i,s){var r=e.matchPrefix(i+s,"a=fingerprint:");return{role:"auto",fingerprints:r.map(e.parseFingerprint)}},e.writeDtlsParameters=function(i,s){var r="a=setup:"+s+`\r
`;return i.fingerprints.forEach(function(o){r+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),r},e.parseCryptoLine=function(i){var s=i.substr(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},e.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?e.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;var s=i.substr(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},e.getCryptoParameters=function(i,s){var r=e.matchPrefix(i+s,"a=crypto:");return r.map(e.parseCryptoLine)},e.getIceParameters=function(i,s){var r=e.matchPrefix(i+s,"a=ice-ufrag:")[0],o=e.matchPrefix(i+s,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substr(12),password:o.substr(10)}:null},e.writeIceParameters=function(i){return"a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`},e.parseRtpParameters=function(i){for(var s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(i),o=r[0].split(" "),a=3;a<o.length;a++){var l=o[a],c=e.matchPrefix(i,"a=rtpmap:"+l+" ")[0];if(c){var h=e.parseRtpMap(c),d=e.matchPrefix(i,"a=fmtp:"+l+" ");switch(h.parameters=d.length?e.parseFmtp(d[0]):{},h.rtcpFeedback=e.matchPrefix(i,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),s.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(h.name.toUpperCase());break}}}return e.matchPrefix(i,"a=extmap:").forEach(function(u){s.headerExtensions.push(e.parseExtmap(u))}),s},e.writeRtpDescription=function(i,s){var r="";r+="m="+i+" ",r+=s.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=s.codecs.map(function(a){return a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType}).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(function(a){r+=e.writeRtpMap(a),r+=e.writeFmtp(a),r+=e.writeRtcpFb(a)});var o=0;return s.codecs.forEach(function(a){a.maxptime>o&&(o=a.maxptime)}),o>0&&(r+="a=maxptime:"+o+`\r
`),r+=`a=rtcp-mux\r
`,s.headerExtensions&&s.headerExtensions.forEach(function(a){r+=e.writeExtmap(a)}),r},e.parseRtpEncodingParameters=function(i){var s=[],r=e.parseRtpParameters(i),o=r.fecMechanisms.indexOf("RED")!==-1,a=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(i,"a=ssrc:").map(function(p){return e.parseSsrcMedia(p)}).filter(function(p){return p.attribute==="cname"}),c=l.length>0&&l[0].ssrc,h,d=e.matchPrefix(i,"a=ssrc-group:FID").map(function(p){var g=p.substr(17).split(" ");return g.map(function(f){return parseInt(f,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(h=d[0][1]),r.codecs.forEach(function(p){if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){var g={ssrc:c,codecPayloadType:parseInt(p.parameters.apt,10)};c&&h&&(g.rtx={ssrc:h}),s.push(g),o&&(g=JSON.parse(JSON.stringify(g)),g.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},s.push(g))}}),s.length===0&&c&&s.push({ssrc:c});var u=e.matchPrefix(i,"b=");return u.length&&(u[0].indexOf("b=TIAS:")===0?u=parseInt(u[0].substr(7),10):u[0].indexOf("b=AS:")===0?u=parseInt(u[0].substr(5),10)*1e3*.95-50*40*8:u=void 0,s.forEach(function(p){p.maxBitrate=u})),s},e.parseRtcpParameters=function(i){var s={},r=e.matchPrefix(i,"a=ssrc:").map(function(l){return e.parseSsrcMedia(l)}).filter(function(l){return l.attribute==="cname"})[0];r&&(s.cname=r.value,s.ssrc=r.ssrc);var o=e.matchPrefix(i,"a=rtcp-rsize");s.reducedSize=o.length>0,s.compound=o.length===0;var a=e.matchPrefix(i,"a=rtcp-mux");return s.mux=a.length>0,s},e.parseMsid=function(i){var s,r=e.matchPrefix(i,"a=msid:");if(r.length===1)return s=r[0].substr(7).split(" "),{stream:s[0],track:s[1]};var o=e.matchPrefix(i,"a=ssrc:").map(function(a){return e.parseSsrcMedia(a)}).filter(function(a){return a.attribute==="msid"});if(o.length>0)return s=o[0].value.split(" "),{stream:s[0],track:s[1]}},e.parseSctpDescription=function(i){var s=e.parseMLine(i),r=e.matchPrefix(i,"a=max-message-size:"),o;r.length>0&&(o=parseInt(r[0].substr(19),10)),isNaN(o)&&(o=65536);var a=e.matchPrefix(i,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substr(12),10),protocol:s.fmt,maxMessageSize:o};var l=e.matchPrefix(i,"a=sctpmap:");if(l.length>0){var c=e.matchPrefix(i,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},e.writeSctpDescription=function(i,s){var r=[];return i.protocol!=="DTLS/SCTP"?r=["m="+i.kind+" 9 "+i.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:r=["m="+i.kind+" 9 "+i.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&r.push("a=max-message-size:"+s.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,21)},e.writeSessionBoilerplate=function(i,s,r){var o,a=s!==void 0?s:2;i?o=i:o=e.generateSessionId();var l=r||"thisisadapterortc";return`v=0\r
o=`+l+" "+o+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.writeMediaSection=function(i,s,r,o){var a=e.writeRtpDescription(i.kind,s);if(a+=e.writeIceParameters(i.iceGatherer.getLocalParameters()),a+=e.writeDtlsParameters(i.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":"active"),a+="a=mid:"+i.mid+`\r
`,i.direction?a+="a="+i.direction+`\r
`:i.rtpSender&&i.rtpReceiver?a+=`a=sendrecv\r
`:i.rtpSender?a+=`a=sendonly\r
`:i.rtpReceiver?a+=`a=recvonly\r
`:a+=`a=inactive\r
`,i.rtpSender){var l="msid:"+o.id+" "+i.rtpSender.track.id+`\r
`;a+="a="+l,a+="a=ssrc:"+i.sendEncodingParameters[0].ssrc+" "+l,i.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+i.sendEncodingParameters[0].rtx.ssrc+" "+l,a+="a=ssrc-group:FID "+i.sendEncodingParameters[0].ssrc+" "+i.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return a+="a=ssrc:"+i.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+`\r
`,i.rtpSender&&i.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+i.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+`\r
`),a},e.getDirection=function(i,s){for(var r=e.splitLines(i),o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substr(2)}return s?e.getDirection(s):"sendrecv"},e.getKind=function(i){var s=e.splitLines(i),r=s[0].split(" ");return r[0].substr(2)},e.isRejected=function(i){return i.split(" ",2)[1]==="0"},e.parseMLine=function(i){var s=e.splitLines(i),r=s[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(i){var s=e.matchPrefix(i,"o=")[0],r=s.substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;for(var s=e.splitLines(i),r=0;r<s.length;r++)if(s[r].length<2||s[r].charAt(1)!=="=")return!1;return!0},n.exports=e})(Z$);var W$=Z$.exports;const jR=KR(W$);var li=W$;function Y2e(n){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[n.type]||n.type}function H$(n,e,i,s,r){var o=li.writeRtpDescription(n.kind,e);if(o+=li.writeIceParameters(n.iceGatherer.getLocalParameters()),o+=li.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),i==="offer"?"actpass":r||"active"),o+="a=mid:"+n.mid+`\r
`,n.rtpSender&&n.rtpReceiver?o+=`a=sendrecv\r
`:n.rtpSender?o+=`a=sendonly\r
`:n.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,n.rtpSender){var a=n.rtpSender._initialTrackId||n.rtpSender.track.id;n.rtpSender._initialTrackId=a;var l="msid:"+(s?s.id:"-")+" "+a+`\r
`;o+="a="+l,o+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+l,n.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+l,o+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+li.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+li.localCName+`\r
`),o}function j2e(n,e){var i=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(function(s){if(s&&(s.urls||s.url)){var r=s.urls||s.url;s.url&&!s.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var o=typeof r=="string";return o&&(r=[r]),r=r.filter(function(a){var l=a.indexOf("turn:")===0&&a.indexOf("transport=udp")!==-1&&a.indexOf("turn:[")===-1&&!i;return l?(i=!0,!0):a.indexOf("stun:")===0&&e>=14393&&a.indexOf("?transport=udp")===-1}),delete s.url,s.urls=o?r[0]:r,!!r.length}})}function JR(n,e){var i={codecs:[],headerExtensions:[],fecMechanisms:[]},s=function(o,a){o=parseInt(o,10);for(var l=0;l<a.length;l++)if(a[l].payloadType===o||a[l].preferredPayloadType===o)return a[l]},r=function(o,a,l,c){var h=s(o.parameters.apt,l),d=s(a.parameters.apt,c);return h&&d&&h.name.toLowerCase()===d.name.toLowerCase()};return n.codecs.forEach(function(o){for(var a=0;a<e.codecs.length;a++){var l=e.codecs[a];if(o.name.toLowerCase()===l.name.toLowerCase()&&o.clockRate===l.clockRate){if(o.name.toLowerCase()==="rtx"&&o.parameters&&l.parameters.apt&&!r(o,l,n.codecs,e.codecs))continue;l=JSON.parse(JSON.stringify(l)),l.numChannels=Math.min(o.numChannels,l.numChannels),i.codecs.push(l),l.rtcpFeedback=l.rtcpFeedback.filter(function(c){for(var h=0;h<o.rtcpFeedback.length;h++)if(o.rtcpFeedback[h].type===c.type&&o.rtcpFeedback[h].parameter===c.parameter)return!0;return!1});break}}}),n.headerExtensions.forEach(function(o){for(var a=0;a<e.headerExtensions.length;a++){var l=e.headerExtensions[a];if(o.uri===l.uri){i.headerExtensions.push(l);break}}}),i}function Q$(n,e,i){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[e][n].indexOf(i)!==-1}function ez(n,e){var i=n.getRemoteCandidates().find(function(s){return e.foundation===s.foundation&&e.ip===s.ip&&e.port===s.port&&e.priority===s.priority&&e.protocol===s.protocol&&e.type===s.type});return i||n.addRemoteCandidate(e),!i}function ta(n,e){var i=new Error(e);return i.name=n,i.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[n],i}var J2e=function(n,e){function i(c,h){h.addTrack(c),h.dispatchEvent(new n.MediaStreamTrackEvent("addtrack",{track:c}))}function s(c,h){h.removeTrack(c),h.dispatchEvent(new n.MediaStreamTrackEvent("removetrack",{track:c}))}function r(c,h,d,u){var p=new Event("track");p.track=h,p.receiver=d,p.transceiver={receiver:d},p.streams=u,n.setTimeout(function(){c._dispatchEvent("track",p)})}var o=function(c){var h=this,d=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(p){h[p]=d[p].bind(d)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",c=JSON.parse(JSON.stringify(c||{})),this.usingBundle=c.bundlePolicy==="max-bundle",c.rtcpMuxPolicy==="negotiate")throw ta("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(c.rtcpMuxPolicy||(c.rtcpMuxPolicy="require"),c.iceTransportPolicy){case"all":case"relay":break;default:c.iceTransportPolicy="all";break}switch(c.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:c.bundlePolicy="balanced";break}if(c.iceServers=j2e(c.iceServers||[],e),this._iceGatherers=[],c.iceCandidatePoolSize)for(var u=c.iceCandidatePoolSize;u>0;u--)this._iceGatherers.push(new n.RTCIceGatherer({iceServers:c.iceServers,gatherPolicy:c.iceTransportPolicy}));else c.iceCandidatePoolSize=0;this._config=c,this.transceivers=[],this._sdpSessionId=li.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(o.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(o.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),o.prototype.onicecandidate=null,o.prototype.onaddstream=null,o.prototype.ontrack=null,o.prototype.onremovestream=null,o.prototype.onsignalingstatechange=null,o.prototype.oniceconnectionstatechange=null,o.prototype.onconnectionstatechange=null,o.prototype.onicegatheringstatechange=null,o.prototype.onnegotiationneeded=null,o.prototype.ondatachannel=null,o.prototype._dispatchEvent=function(c,h){this._isClosed||(this.dispatchEvent(h),typeof this["on"+c]=="function"&&this["on"+c](h))},o.prototype._emitGatheringStateChange=function(){var c=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",c)},o.prototype.getConfiguration=function(){return this._config},o.prototype.getLocalStreams=function(){return this.localStreams},o.prototype.getRemoteStreams=function(){return this.remoteStreams},o.prototype._createTransceiver=function(c,h){var d=this.transceivers.length>0,u={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:c,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&d)u.iceTransport=this.transceivers[0].iceTransport,u.dtlsTransport=this.transceivers[0].dtlsTransport;else{var p=this._createIceAndDtlsTransports();u.iceTransport=p.iceTransport,u.dtlsTransport=p.dtlsTransport}return h||this.transceivers.push(u),u},o.prototype.addTrack=function(c,h){if(this._isClosed)throw ta("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var d=this.transceivers.find(function(g){return g.track===c});if(d)throw ta("InvalidAccessError","Track already exists.");for(var u,p=0;p<this.transceivers.length;p++)!this.transceivers[p].track&&this.transceivers[p].kind===c.kind&&(u=this.transceivers[p]);return u||(u=this._createTransceiver(c.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(h)===-1&&this.localStreams.push(h),u.track=c,u.stream=h,u.rtpSender=new n.RTCRtpSender(c,u.dtlsTransport),u.rtpSender},o.prototype.addStream=function(c){var h=this;if(e>=15025)c.getTracks().forEach(function(u){h.addTrack(u,c)});else{var d=c.clone();c.getTracks().forEach(function(u,p){var g=d.getTracks()[p];u.addEventListener("enabled",function(f){g.enabled=f.enabled})}),d.getTracks().forEach(function(u){h.addTrack(u,d)})}},o.prototype.removeTrack=function(c){if(this._isClosed)throw ta("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(c instanceof n.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var h=this.transceivers.find(function(p){return p.rtpSender===c});if(!h)throw ta("InvalidAccessError","Sender was not created by this connection.");var d=h.stream;h.rtpSender.stop(),h.rtpSender=null,h.track=null,h.stream=null;var u=this.transceivers.map(function(p){return p.stream});u.indexOf(d)===-1&&this.localStreams.indexOf(d)>-1&&this.localStreams.splice(this.localStreams.indexOf(d),1),this._maybeFireNegotiationNeeded()},o.prototype.removeStream=function(c){var h=this;c.getTracks().forEach(function(d){var u=h.getSenders().find(function(p){return p.track===d});u&&h.removeTrack(u)})},o.prototype.getSenders=function(){return this.transceivers.filter(function(c){return!!c.rtpSender}).map(function(c){return c.rtpSender})},o.prototype.getReceivers=function(){return this.transceivers.filter(function(c){return!!c.rtpReceiver}).map(function(c){return c.rtpReceiver})},o.prototype._createIceGatherer=function(c,h){var d=this;if(h&&c>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var u=new n.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(u,"state",{value:"new",writable:!0}),this.transceivers[c].bufferedCandidateEvents=[],this.transceivers[c].bufferCandidates=function(p){var g=!p.candidate||Object.keys(p.candidate).length===0;u.state=g?"completed":"gathering",d.transceivers[c].bufferedCandidateEvents!==null&&d.transceivers[c].bufferedCandidateEvents.push(p)},u.addEventListener("localcandidate",this.transceivers[c].bufferCandidates),u},o.prototype._gather=function(c,h){var d=this,u=this.transceivers[h].iceGatherer;if(!u.onlocalcandidate){var p=this.transceivers[h].bufferedCandidateEvents;this.transceivers[h].bufferedCandidateEvents=null,u.removeEventListener("localcandidate",this.transceivers[h].bufferCandidates),u.onlocalcandidate=function(g){if(!(d.usingBundle&&h>0)){var f=new Event("icecandidate");f.candidate={sdpMid:c,sdpMLineIndex:h};var A=g.candidate,y=!A||Object.keys(A).length===0;if(y)(u.state==="new"||u.state==="gathering")&&(u.state="completed");else{u.state==="new"&&(u.state="gathering"),A.component=1,A.ufrag=u.getLocalParameters().usernameFragment;var b=li.writeCandidate(A);f.candidate=Object.assign(f.candidate,li.parseCandidate(b)),f.candidate.candidate=b,f.candidate.toJSON=function(){return{candidate:f.candidate.candidate,sdpMid:f.candidate.sdpMid,sdpMLineIndex:f.candidate.sdpMLineIndex,usernameFragment:f.candidate.usernameFragment}}}var v=li.getMediaSections(d._localDescription.sdp);y?v[f.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:v[f.candidate.sdpMLineIndex]+="a="+f.candidate.candidate+`\r
`,d._localDescription.sdp=li.getDescription(d._localDescription.sdp)+v.join("");var x=d.transceivers.every(function(w){return w.iceGatherer&&w.iceGatherer.state==="completed"});d.iceGatheringState!=="gathering"&&(d.iceGatheringState="gathering",d._emitGatheringStateChange()),y||d._dispatchEvent("icecandidate",f),x&&(d._dispatchEvent("icecandidate",new Event("icecandidate")),d.iceGatheringState="complete",d._emitGatheringStateChange())}},n.setTimeout(function(){p.forEach(function(g){u.onlocalcandidate(g)})},0)}},o.prototype._createIceAndDtlsTransports=function(){var c=this,h=new n.RTCIceTransport(null);h.onicestatechange=function(){c._updateIceConnectionState(),c._updateConnectionState()};var d=new n.RTCDtlsTransport(h);return d.ondtlsstatechange=function(){c._updateConnectionState()},d.onerror=function(){Object.defineProperty(d,"state",{value:"failed",writable:!0}),c._updateConnectionState()},{iceTransport:h,dtlsTransport:d}},o.prototype._disposeIceAndDtlsTransports=function(c){var h=this.transceivers[c].iceGatherer;h&&(delete h.onlocalcandidate,delete this.transceivers[c].iceGatherer);var d=this.transceivers[c].iceTransport;d&&(delete d.onicestatechange,delete this.transceivers[c].iceTransport);var u=this.transceivers[c].dtlsTransport;u&&(delete u.ondtlsstatechange,delete u.onerror,delete this.transceivers[c].dtlsTransport)},o.prototype._transceive=function(c,h,d){var u=JR(c.localCapabilities,c.remoteCapabilities);h&&c.rtpSender&&(u.encodings=c.sendEncodingParameters,u.rtcp={cname:li.localCName,compound:c.rtcpParameters.compound},c.recvEncodingParameters.length&&(u.rtcp.ssrc=c.recvEncodingParameters[0].ssrc),c.rtpSender.send(u)),d&&c.rtpReceiver&&u.codecs.length>0&&(c.kind==="video"&&c.recvEncodingParameters&&e<15019&&c.recvEncodingParameters.forEach(function(p){delete p.rtx}),c.recvEncodingParameters.length?u.encodings=c.recvEncodingParameters:u.encodings=[{}],u.rtcp={compound:c.rtcpParameters.compound},c.rtcpParameters.cname&&(u.rtcp.cname=c.rtcpParameters.cname),c.sendEncodingParameters.length&&(u.rtcp.ssrc=c.sendEncodingParameters[0].ssrc),c.rtpReceiver.receive(u))},o.prototype.setLocalDescription=function(c){var h=this;if(["offer","answer"].indexOf(c.type)===-1)return Promise.reject(ta("TypeError",'Unsupported type "'+c.type+'"'));if(!Q$("setLocalDescription",c.type,h.signalingState)||h._isClosed)return Promise.reject(ta("InvalidStateError","Can not set local "+c.type+" in state "+h.signalingState));var d,u;if(c.type==="offer")d=li.splitSections(c.sdp),u=d.shift(),d.forEach(function(g,f){var A=li.parseRtpParameters(g);h.transceivers[f].localCapabilities=A}),h.transceivers.forEach(function(g,f){h._gather(g.mid,f)});else if(c.type==="answer"){d=li.splitSections(h._remoteDescription.sdp),u=d.shift();var p=li.matchPrefix(u,"a=ice-lite").length>0;d.forEach(function(g,f){var A=h.transceivers[f],y=A.iceGatherer,b=A.iceTransport,v=A.dtlsTransport,x=A.localCapabilities,w=A.remoteCapabilities,C=li.isRejected(g)&&li.matchPrefix(g,"a=bundle-only").length===0;if(!C&&!A.rejected){var S=li.getIceParameters(g,u),_=li.getDtlsParameters(g,u);p&&(_.role="server"),(!h.usingBundle||f===0)&&(h._gather(A.mid,f),b.state==="new"&&b.start(y,S,p?"controlling":"controlled"),v.state==="new"&&v.start(_));var I=JR(x,w);h._transceive(A,I.codecs.length>0,!1)}})}return h._localDescription={type:c.type,sdp:c.sdp},c.type==="offer"?h._updateSignalingState("have-local-offer"):h._updateSignalingState("stable"),Promise.resolve()},o.prototype.setRemoteDescription=function(c){var h=this;if(["offer","answer"].indexOf(c.type)===-1)return Promise.reject(ta("TypeError",'Unsupported type "'+c.type+'"'));if(!Q$("setRemoteDescription",c.type,h.signalingState)||h._isClosed)return Promise.reject(ta("InvalidStateError","Can not set remote "+c.type+" in state "+h.signalingState));var d={};h.remoteStreams.forEach(function(b){d[b.id]=b});var u=[],p=li.splitSections(c.sdp),g=p.shift(),f=li.matchPrefix(g,"a=ice-lite").length>0,A=li.matchPrefix(g,"a=group:BUNDLE ").length>0;h.usingBundle=A;var y=li.matchPrefix(g,"a=ice-options:")[0];return y?h.canTrickleIceCandidates=y.substr(14).split(" ").indexOf("trickle")>=0:h.canTrickleIceCandidates=!1,p.forEach(function(b,v){var x=li.splitLines(b),w=li.getKind(b),C=li.isRejected(b)&&li.matchPrefix(b,"a=bundle-only").length===0,S=x[0].substr(2).split(" ")[2],_=li.getDirection(b,g),I=li.parseMsid(b),B=li.getMid(b)||li.generateIdentifier();if(C||w==="application"&&(S==="DTLS/SCTP"||S==="UDP/DTLS/SCTP")){h.transceivers[v]={mid:B,kind:w,protocol:S,rejected:!0};return}!C&&h.transceivers[v]&&h.transceivers[v].rejected&&(h.transceivers[v]=h._createTransceiver(w,!0));var M,R,k,G,X,F,z,H,Z,he=li.parseRtpParameters(b),be,_e;C||(be=li.getIceParameters(b,g),_e=li.getDtlsParameters(b,g),_e.role="client"),z=li.parseRtpEncodingParameters(b);var Ye=li.parseRtcpParameters(b),je=li.matchPrefix(b,"a=end-of-candidates",g).length>0,le=li.matchPrefix(b,"a=candidate:").map(function(rt){return li.parseCandidate(rt)}).filter(function(rt){return rt.component===1});if((c.type==="offer"||c.type==="answer")&&!C&&A&&v>0&&h.transceivers[v]&&(h._disposeIceAndDtlsTransports(v),h.transceivers[v].iceGatherer=h.transceivers[0].iceGatherer,h.transceivers[v].iceTransport=h.transceivers[0].iceTransport,h.transceivers[v].dtlsTransport=h.transceivers[0].dtlsTransport,h.transceivers[v].rtpSender&&h.transceivers[v].rtpSender.setTransport(h.transceivers[0].dtlsTransport),h.transceivers[v].rtpReceiver&&h.transceivers[v].rtpReceiver.setTransport(h.transceivers[0].dtlsTransport)),c.type==="offer"&&!C){M=h.transceivers[v]||h._createTransceiver(w),M.mid=B,M.iceGatherer||(M.iceGatherer=h._createIceGatherer(v,A)),le.length&&M.iceTransport.state==="new"&&(je&&(!A||v===0)?M.iceTransport.setRemoteCandidates(le):le.forEach(function(rt){ez(M.iceTransport,rt)})),H=n.RTCRtpReceiver.getCapabilities(w),e<15019&&(H.codecs=H.codecs.filter(function(rt){return rt.name!=="rtx"})),F=M.sendEncodingParameters||[{ssrc:(2*v+2)*1001}];var ve=!1;if(_==="sendrecv"||_==="sendonly"){if(ve=!M.rtpReceiver,X=M.rtpReceiver||new n.RTCRtpReceiver(M.dtlsTransport,w),ve){var Pe;Z=X.track,I&&I.stream==="-"||(I?(d[I.stream]||(d[I.stream]=new n.MediaStream,Object.defineProperty(d[I.stream],"id",{get:function(){return I.stream}})),Object.defineProperty(Z,"id",{get:function(){return I.track}}),Pe=d[I.stream]):(d.default||(d.default=new n.MediaStream),Pe=d.default)),Pe&&(i(Z,Pe),M.associatedRemoteMediaStreams.push(Pe)),u.push([Z,X,Pe])}}else M.rtpReceiver&&M.rtpReceiver.track&&(M.associatedRemoteMediaStreams.forEach(function(rt){var xt=rt.getTracks().find(function(Re){return Re.id===M.rtpReceiver.track.id});xt&&s(xt,rt)}),M.associatedRemoteMediaStreams=[]);M.localCapabilities=H,M.remoteCapabilities=he,M.rtpReceiver=X,M.rtcpParameters=Ye,M.sendEncodingParameters=F,M.recvEncodingParameters=z,h._transceive(h.transceivers[v],!1,ve)}else if(c.type==="answer"&&!C){M=h.transceivers[v],R=M.iceGatherer,k=M.iceTransport,G=M.dtlsTransport,X=M.rtpReceiver,F=M.sendEncodingParameters,H=M.localCapabilities,h.transceivers[v].recvEncodingParameters=z,h.transceivers[v].remoteCapabilities=he,h.transceivers[v].rtcpParameters=Ye,le.length&&k.state==="new"&&((f||je)&&(!A||v===0)?k.setRemoteCandidates(le):le.forEach(function(rt){ez(M.iceTransport,rt)})),(!A||v===0)&&(k.state==="new"&&k.start(R,be,"controlling"),G.state==="new"&&G.start(_e));var ke=JR(M.localCapabilities,M.remoteCapabilities),_t=ke.codecs.filter(function(rt){return rt.name.toLowerCase()==="rtx"}).length;!_t&&M.sendEncodingParameters[0].rtx&&delete M.sendEncodingParameters[0].rtx,h._transceive(M,_==="sendrecv"||_==="recvonly",_==="sendrecv"||_==="sendonly"),X&&(_==="sendrecv"||_==="sendonly")?(Z=X.track,I?(d[I.stream]||(d[I.stream]=new n.MediaStream),i(Z,d[I.stream]),u.push([Z,X,d[I.stream]])):(d.default||(d.default=new n.MediaStream),i(Z,d.default),u.push([Z,X,d.default]))):delete M.rtpReceiver}}),h._dtlsRole===void 0&&(h._dtlsRole=c.type==="offer"?"active":"passive"),h._remoteDescription={type:c.type,sdp:c.sdp},c.type==="offer"?h._updateSignalingState("have-remote-offer"):h._updateSignalingState("stable"),Object.keys(d).forEach(function(b){var v=d[b];if(v.getTracks().length){if(h.remoteStreams.indexOf(v)===-1){h.remoteStreams.push(v);var x=new Event("addstream");x.stream=v,n.setTimeout(function(){h._dispatchEvent("addstream",x)})}u.forEach(function(w){var C=w[0],S=w[1];v.id===w[2].id&&r(h,C,S,[v])})}}),u.forEach(function(b){b[2]||r(h,b[0],b[1],[])}),n.setTimeout(function(){h&&h.transceivers&&h.transceivers.forEach(function(b){b.iceTransport&&b.iceTransport.state==="new"&&b.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),b.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},o.prototype.close=function(){this.transceivers.forEach(function(c){c.iceTransport&&c.iceTransport.stop(),c.dtlsTransport&&c.dtlsTransport.stop(),c.rtpSender&&c.rtpSender.stop(),c.rtpReceiver&&c.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},o.prototype._updateSignalingState=function(c){this.signalingState=c;var h=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",h)},o.prototype._maybeFireNegotiationNeeded=function(){var c=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,n.setTimeout(function(){if(c.needNegotiation){c.needNegotiation=!1;var h=new Event("negotiationneeded");c._dispatchEvent("negotiationneeded",h)}},0))},o.prototype._updateIceConnectionState=function(){var c,h={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(u){u.iceTransport&&!u.rejected&&h[u.iceTransport.state]++}),c="new",h.failed>0?c="failed":h.checking>0?c="checking":h.disconnected>0?c="disconnected":h.new>0?c="new":h.connected>0?c="connected":h.completed>0&&(c="completed"),c!==this.iceConnectionState){this.iceConnectionState=c;var d=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",d)}},o.prototype._updateConnectionState=function(){var c,h={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(u){u.iceTransport&&u.dtlsTransport&&!u.rejected&&(h[u.iceTransport.state]++,h[u.dtlsTransport.state]++)}),h.connected+=h.completed,c="new",h.failed>0?c="failed":h.connecting>0?c="connecting":h.disconnected>0?c="disconnected":h.new>0?c="new":h.connected>0&&(c="connected"),c!==this.connectionState){this.connectionState=c;var d=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",d)}},o.prototype.createOffer=function(){var c=this;if(c._isClosed)return Promise.reject(ta("InvalidStateError","Can not call createOffer after close"));var h=c.transceivers.filter(function(f){return f.kind==="audio"}).length,d=c.transceivers.filter(function(f){return f.kind==="video"}).length,u=arguments[0];if(u){if(u.mandatory||u.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");u.offerToReceiveAudio!==void 0&&(u.offerToReceiveAudio===!0?h=1:u.offerToReceiveAudio===!1?h=0:h=u.offerToReceiveAudio),u.offerToReceiveVideo!==void 0&&(u.offerToReceiveVideo===!0?d=1:u.offerToReceiveVideo===!1?d=0:d=u.offerToReceiveVideo)}for(c.transceivers.forEach(function(f){f.kind==="audio"?(h--,h<0&&(f.wantReceive=!1)):f.kind==="video"&&(d--,d<0&&(f.wantReceive=!1))});h>0||d>0;)h>0&&(c._createTransceiver("audio"),h--),d>0&&(c._createTransceiver("video"),d--);var p=li.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.transceivers.forEach(function(f,A){var y=f.track,b=f.kind,v=f.mid||li.generateIdentifier();f.mid=v,f.iceGatherer||(f.iceGatherer=c._createIceGatherer(A,c.usingBundle));var x=n.RTCRtpSender.getCapabilities(b);e<15019&&(x.codecs=x.codecs.filter(function(C){return C.name!=="rtx"})),x.codecs.forEach(function(C){C.name==="H264"&&C.parameters["level-asymmetry-allowed"]===void 0&&(C.parameters["level-asymmetry-allowed"]="1"),f.remoteCapabilities&&f.remoteCapabilities.codecs&&f.remoteCapabilities.codecs.forEach(function(S){C.name.toLowerCase()===S.name.toLowerCase()&&C.clockRate===S.clockRate&&(C.preferredPayloadType=S.payloadType)})}),x.headerExtensions.forEach(function(C){var S=f.remoteCapabilities&&f.remoteCapabilities.headerExtensions||[];S.forEach(function(_){C.uri===_.uri&&(C.id=_.id)})});var w=f.sendEncodingParameters||[{ssrc:(2*A+1)*1001}];y&&e>=15019&&b==="video"&&!w[0].rtx&&(w[0].rtx={ssrc:w[0].ssrc+1}),f.wantReceive&&(f.rtpReceiver=new n.RTCRtpReceiver(f.dtlsTransport,b)),f.localCapabilities=x,f.sendEncodingParameters=w}),c._config.bundlePolicy!=="max-compat"&&(p+="a=group:BUNDLE "+c.transceivers.map(function(f){return f.mid}).join(" ")+`\r
`),p+=`a=ice-options:trickle\r
`,c.transceivers.forEach(function(f,A){p+=H$(f,f.localCapabilities,"offer",f.stream,c._dtlsRole),p+=`a=rtcp-rsize\r
`,f.iceGatherer&&c.iceGatheringState!=="new"&&(A===0||!c.usingBundle)&&(f.iceGatherer.getLocalCandidates().forEach(function(y){y.component=1,p+="a="+li.writeCandidate(y)+`\r
`}),f.iceGatherer.state==="completed"&&(p+=`a=end-of-candidates\r
`))});var g=new n.RTCSessionDescription({type:"offer",sdp:p});return Promise.resolve(g)},o.prototype.createAnswer=function(){var c=this;if(c._isClosed)return Promise.reject(ta("InvalidStateError","Can not call createAnswer after close"));if(!(c.signalingState==="have-remote-offer"||c.signalingState==="have-local-pranswer"))return Promise.reject(ta("InvalidStateError","Can not call createAnswer in signalingState "+c.signalingState));var h=li.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.usingBundle&&(h+="a=group:BUNDLE "+c.transceivers.map(function(p){return p.mid}).join(" ")+`\r
`),h+=`a=ice-options:trickle\r
`;var d=li.getMediaSections(c._remoteDescription.sdp).length;c.transceivers.forEach(function(p,g){if(!(g+1>d)){if(p.rejected){p.kind==="application"?p.protocol==="DTLS/SCTP"?h+=`m=application 0 DTLS/SCTP 5000\r
`:h+="m=application 0 "+p.protocol+` webrtc-datachannel\r
`:p.kind==="audio"?h+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:p.kind==="video"&&(h+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),h+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+p.mid+`\r
`;return}if(p.stream){var f;p.kind==="audio"?f=p.stream.getAudioTracks()[0]:p.kind==="video"&&(f=p.stream.getVideoTracks()[0]),f&&e>=15019&&p.kind==="video"&&!p.sendEncodingParameters[0].rtx&&(p.sendEncodingParameters[0].rtx={ssrc:p.sendEncodingParameters[0].ssrc+1})}var A=JR(p.localCapabilities,p.remoteCapabilities),y=A.codecs.filter(function(b){return b.name.toLowerCase()==="rtx"}).length;!y&&p.sendEncodingParameters[0].rtx&&delete p.sendEncodingParameters[0].rtx,h+=H$(p,A,"answer",p.stream,c._dtlsRole),p.rtcpParameters&&p.rtcpParameters.reducedSize&&(h+=`a=rtcp-rsize\r
`)}});var u=new n.RTCSessionDescription({type:"answer",sdp:h});return Promise.resolve(u)},o.prototype.addIceCandidate=function(c){var h=this,d;return c&&!(c.sdpMLineIndex!==void 0||c.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(u,p){if(h._remoteDescription)if(!c||c.candidate==="")for(var g=0;g<h.transceivers.length&&!(!h.transceivers[g].rejected&&(h.transceivers[g].iceTransport.addRemoteCandidate({}),d=li.getMediaSections(h._remoteDescription.sdp),d[g]+=`a=end-of-candidates\r
`,h._remoteDescription.sdp=li.getDescription(h._remoteDescription.sdp)+d.join(""),h.usingBundle));g++);else{var f=c.sdpMLineIndex;if(c.sdpMid){for(var A=0;A<h.transceivers.length;A++)if(h.transceivers[A].mid===c.sdpMid){f=A;break}}var y=h.transceivers[f];if(y){if(y.rejected)return u();var b=Object.keys(c.candidate).length>0?li.parseCandidate(c.candidate):{};if(b.protocol==="tcp"&&(b.port===0||b.port===9)||b.component&&b.component!==1)return u();if((f===0||f>0&&y.iceTransport!==h.transceivers[0].iceTransport)&&!ez(y.iceTransport,b))return p(ta("OperationError","Can not add ICE candidate"));var v=c.candidate.trim();v.indexOf("a=")===0&&(v=v.substr(2)),d=li.getMediaSections(h._remoteDescription.sdp),d[f]+="a="+(b.type?v:"end-of-candidates")+`\r
`,h._remoteDescription.sdp=li.getDescription(h._remoteDescription.sdp)+d.join("")}else return p(ta("OperationError","Can not add ICE candidate"))}else return p(ta("InvalidStateError","Can not add ICE candidate without a remote description"));u()})},o.prototype.getStats=function(c){if(c&&c instanceof n.MediaStreamTrack){var h=null;if(this.transceivers.forEach(function(u){u.rtpSender&&u.rtpSender.track===c?h=u.rtpSender:u.rtpReceiver&&u.rtpReceiver.track===c&&(h=u.rtpReceiver)}),!h)throw ta("InvalidAccessError","Invalid selector.");return h.getStats()}var d=[];return this.transceivers.forEach(function(u){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(p){u[p]&&d.push(u[p].getStats())})}),Promise.all(d).then(function(u){var p=new Map;return u.forEach(function(g){g.forEach(function(f){p.set(f.id,f)})}),p})};var a=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];a.forEach(function(c){var h=n[c];if(h&&h.prototype&&h.prototype.getStats){var d=h.prototype.getStats;h.prototype.getStats=function(){return d.apply(this).then(function(u){var p=new Map;return Object.keys(u).forEach(function(g){u[g].type=Y2e(u[g]),p.set(g,u[g])}),p})}}});var l=["createOffer","createAnswer"];return l.forEach(function(c){var h=o.prototype[c];o.prototype[c]=function(){var d=arguments;return typeof d[0]=="function"||typeof d[1]=="function"?h.apply(this,[arguments[2]]).then(function(u){typeof d[0]=="function"&&d[0].apply(null,[u])},function(u){typeof d[1]=="function"&&d[1].apply(null,[u])}):h.apply(this,arguments)}}),l=["setLocalDescription","setRemoteDescription","addIceCandidate"],l.forEach(function(c){var h=o.prototype[c];o.prototype[c]=function(){var d=arguments;return typeof d[1]=="function"||typeof d[2]=="function"?h.apply(this,arguments).then(function(){typeof d[1]=="function"&&d[1].apply(null)},function(u){typeof d[2]=="function"&&d[2].apply(null,[u])}):h.apply(this,arguments)}}),["getStats"].forEach(function(c){var h=o.prototype[c];o.prototype[c]=function(){var d=arguments;return typeof d[1]=="function"?h.apply(this,arguments).then(function(){typeof d[1]=="function"&&d[1].apply(null)}):h.apply(this,arguments)}}),o};const q2e=KR(J2e);function K$(n){const e=n&&n.navigator,i=function(r){return{name:{PermissionDeniedError:"NotAllowedError"}[r.name]||r.name,message:r.message,constraint:r.constraint,toString(){return this.name}}},s=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(r){return s(r).catch(o=>Promise.reject(i(o)))}}function Y$(n){"getDisplayMedia"in n.navigator&&n.navigator.mediaDevices&&(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||(n.navigator.mediaDevices.getDisplayMedia=n.navigator.getDisplayMedia.bind(n.navigator)))}function tz(n,e){if(n.RTCIceGatherer&&(n.RTCIceCandidate||(n.RTCIceCandidate=function(s){return s}),n.RTCSessionDescription||(n.RTCSessionDescription=function(s){return s}),e.version<15025)){const s=Object.getOwnPropertyDescriptor(n.MediaStreamTrack.prototype,"enabled");Object.defineProperty(n.MediaStreamTrack.prototype,"enabled",{set(r){s.set.call(this,r);const o=new Event("enabled");o.enabled=r,this.dispatchEvent(o)}})}n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)&&Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new n.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),n.RTCDtmfSender&&!n.RTCDTMFSender&&(n.RTCDTMFSender=n.RTCDtmfSender);const i=q2e(n,e.version);n.RTCPeerConnection=function(s){return s&&s.iceServers&&(s.iceServers=K2e(s.iceServers,e.version),J5("ICE servers after filtering:",s.iceServers)),new i(s)},n.RTCPeerConnection.prototype=i.prototype}function j$(n){n.RTCRtpSender&&!("replaceTrack"in n.RTCRtpSender.prototype)&&(n.RTCRtpSender.prototype.replaceTrack=n.RTCRtpSender.prototype.setTrack)}const J$=Object.freeze(Object.defineProperty({__proto__:null,shimGetDisplayMedia:Y$,shimGetUserMedia:K$,shimPeerConnection:tz,shimReplaceTrack:j$},Symbol.toStringTag,{value:"Module"}));function q$(n,e){const i=n&&n.navigator,s=n&&n.MediaStreamTrack;if(i.getUserMedia=function(r,o,a){YR("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(r).then(o,a)},!(e.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const r=function(a,l,c){l in a&&!(c in a)&&(a[c]=a[l],delete a[l])},o=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a.audio,"autoGainControl","mozAutoGainControl"),r(a.audio,"noiseSuppression","mozNoiseSuppression")),o(a)},s&&s.prototype.getSettings){const a=s.prototype.getSettings;s.prototype.getSettings=function(){const l=a.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(s&&s.prototype.applyConstraints){const a=s.prototype.applyConstraints;s.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[l])}}}}function $2e(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(i)})}function $$(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function iz(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const o=n.RTCPeerConnection.prototype[r],a={[r](){return arguments[0]=new(r==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};n.RTCPeerConnection.prototype[r]=a[r]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[r,o,a]=arguments;return s.apply(this,[r||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(c=>{c.type=i[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((h,d)=>{l.set(d,Object.assign({},h,{type:i[h.type]||h.type}))})}return l}).then(o,a)}}function eee(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(r=>r._pc=this),s});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function tee(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Db(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function iee(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){YR("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&e.getTracks().includes(i.track)&&this.removeTrack(i)})})}function nee(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function see(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const i=arguments[1],s=i&&"sendEncodings"in i;s&&i.sendEncodings.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(s){const{sender:o}=r,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i.sendEncodings,o.sendEncodings=i.sendEncodings,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return r})}function ree(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function oee(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function aee(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const lee=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:see,shimCreateAnswer:aee,shimCreateOffer:oee,shimGetDisplayMedia:$2e,shimGetParameters:ree,shimGetUserMedia:q$,shimOnTrack:$$,shimPeerConnection:iz,shimRTCDataChannel:nee,shimReceiverGetStats:tee,shimRemoveStream:iee,shimSenderGetStats:eee},Symbol.toStringTag,{value:"Module"}));function cee(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(s=>e.call(this,s,i)),i.getVideoTracks().forEach(s=>e.call(this,s,i))},n.RTCPeerConnection.prototype.addTrack=function(i,...s){return s&&s.forEach(r=>{this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(e);if(i===-1)return;this._localStreams.splice(i,1);const s=e.getTracks();this.getSenders().forEach(r=>{s.includes(r.track)&&this.removeTrack(r)})})}}function hee(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,this.dispatchEvent(o)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(r=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(r)>=0)return;i._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function dee(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,i=e.createOffer,s=e.createAnswer,r=e.setLocalDescription,o=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(c,h){const d=arguments.length>=2?arguments[2]:arguments[0],u=i.apply(this,[d]);return h?(u.then(c,h),Promise.resolve()):u},e.createAnswer=function(c,h){const d=arguments.length>=2?arguments[2]:arguments[0],u=s.apply(this,[d]);return h?(u.then(c,h),Promise.resolve()):u};let l=function(c,h,d){const u=r.apply(this,[c]);return d?(u.then(h,d),Promise.resolve()):u};e.setLocalDescription=l,l=function(c,h,d){const u=o.apply(this,[c]);return d?(u.then(h,d),Promise.resolve()):u},e.setRemoteDescription=l,l=function(c,h,d){const u=a.apply(this,[c]);return d?(u.then(h,d),Promise.resolve()):u},e.addIceCandidate=l}function uee(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const i=e.mediaDevices,s=i.getUserMedia.bind(i);e.mediaDevices.getUserMedia=r=>s(pee(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(i,s,r){e.mediaDevices.getUserMedia(i).then(s,r)}.bind(e))}function pee(n){return n&&n.video!==void 0?Object.assign({},n,{video:L$(n.video)}):n}function mee(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const r=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(YR("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,r.push(a)):r.push(i.iceServers[o])}i.iceServers=r}return new e(i,s)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function gee(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function fee(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio"),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video")}return e.apply(this,arguments)}}function Aee(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const yee=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Aee,shimCallbacksAPI:dee,shimConstraints:pee,shimCreateOfferLegacy:fee,shimGetUserMedia:uee,shimLocalStreamsAPI:cee,shimRTCIceServerUrls:mee,shimRemoteStreamsAPI:hee,shimTrackEventTransceiver:gee},Symbol.toStringTag,{value:"Module"}));function qR(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const s=new e(i),r=jR.parseCandidate(i.candidate),o=Object.assign(s,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(i)},n.RTCIceCandidate.prototype=e.prototype,Db(n,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new n.RTCIceCandidate(i.candidate),writable:"false"}),i))}function aC(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const i=function(l){if(!l||!l.sdp)return!1;const c=jR.splitSections(l.sdp);return c.shift(),c.some(h=>{const d=jR.parseMLine(h);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},s=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const h=parseInt(c[1],10);return h!==h?-1:h},r=function(l){let c=65536;return e.browser==="firefox"&&(e.version<57?l===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},o=function(l,c){let h=65536;e.browser==="firefox"&&e.version===57&&(h=65535);const d=jR.matchPrefix(l.sdp,"a=max-message-size:");return d.length>0?h=parseInt(d[0].substr(19),10):e.browser==="firefox"&&c!==-1&&(h=2147483637),h},a=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const l=s(arguments[0]),c=r(l),h=o(arguments[0],l);let d;c===0&&h===0?d=Number.POSITIVE_INFINITY:c===0||h===0?d=Math.max(c,h):d=Math.min(c,h);const u={};Object.defineProperty(u,"maxMessageSize",{get(){return d}}),this._sctp=u}return a.apply(this,arguments)}}function lC(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(s,r){const o=s.send;s.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(s.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return o.apply(s,arguments)}}const i=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const s=i.apply(this,arguments);return e(s,this),s},Db(n,"datachannel",s=>(e(s.channel,s.target),s))}function nz(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const s=e[i];e[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const o=r.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const a=new Event("connectionstatechange",r);o.dispatchEvent(a)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function sz(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const i=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&s instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:s.type,sdp:r}):s.sdp=r}return i.apply(this,arguments)}}function $R(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const i=n.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const eLe=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:sz,shimAddIceCandidateNullOrEmpty:$R,shimConnectionState:nz,shimMaxMessageSize:aC,shimRTCIceCandidate:qR,shimSendThrowTypeError:lC},Symbol.toStringTag,{value:"Module"}));function tLe({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const i=J5,s=H2e(n),r={browserDetails:s,commonShim:eLe,extractVersion:oC,disableLog:Z2e,disableWarnings:W2e};switch(s.browser){case"chrome":if(!O$||!$5||!e.shimChrome)return i("Chrome shim is not included in this adapter release."),r;if(s.version===null)return i("Chrome shim can not determine version, not shimming."),r;i("adapter.js shimming chrome."),r.browserShim=O$,$R(n,s),G$(n,s),P$(n),$5(n,s),N$(n),F$(n,s),V$(n),X$(n),D$(n),U$(n,s),qR(n),nz(n),aC(n,s),lC(n),sz(n,s);break;case"firefox":if(!lee||!iz||!e.shimFirefox)return i("Firefox shim is not included in this adapter release."),r;i("adapter.js shimming firefox."),r.browserShim=lee,$R(n,s),q$(n,s),iz(n,s),$$(n),iee(n),eee(n),tee(n),nee(n),see(n),ree(n),oee(n),aee(n),qR(n),nz(n),aC(n,s),lC(n);break;case"edge":if(!J$||!tz||!e.shimEdge)return i("MS edge shim is not included in this adapter release."),r;i("adapter.js shimming edge."),r.browserShim=J$,K$(n),Y$(n),tz(n,s),j$(n),aC(n,s),lC(n);break;case"safari":if(!yee||!e.shimSafari)return i("Safari shim is not included in this adapter release."),r;i("adapter.js shimming safari."),r.browserShim=yee,$R(n,s),mee(n),fee(n),dee(n),cee(n),hee(n),gee(n),uee(n),Aee(n),qR(n),aC(n,s),lC(n),sz(n,s);break;default:i("Unsupported browser!");break}return r}const bee=tLe({window:typeof window>"u"?void 0:window});function Ed(n,e,i,s){Object.defineProperty(n,e,{get:i,set:s,enumerable:!0,configurable:!0})}var rz=bee.default||bee,cC=new(function(){function n(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return n.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},n.prototype.isBrowserSupported=function(){var e=this.getBrowser(),i=this.getVersion(),s=this.supportedBrowsers.includes(e);return s?e==="chrome"?i>=this.minChromeVersion:e==="firefox"?i>=this.minFirefoxVersion:e==="safari"?!this.isIOS&&i>=this.minSafariVersion:!1:!1},n.prototype.getBrowser=function(){return rz.browserDetails.browser},n.prototype.getVersion=function(){return rz.browserDetails.version||0},n.prototype.isUnifiedPlanSupported=function(){var e=this.getBrowser(),i=rz.browserDetails.version||0;if(e==="chrome"&&i<this.minChromeVersion)return!1;if(e==="firefox"&&i>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var s,r=!1;try{s=new RTCPeerConnection,s.addTransceiver("audio"),r=!0}catch{}finally{s&&s.close()}return r},n.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},n}()),vee={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},iLe=function(){function n(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=vee,this.browser=cC.getBrowser(),this.browserVersion=cC.getVersion(),this.supports=function(){var e={browser:cC.isBrowserSupported(),webRTC:cC.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!e.webRTC)return e;var i;try{i=new RTCPeerConnection(vee),e.audioVideo=!0;var s=void 0;try{s=i.createDataChannel("_PEERJSTEST",{ordered:!0}),e.data=!0,e.reliable=!!s.ordered;try{s.binaryType="blob",e.binaryBlob=!cC.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{i&&i.close()}return e}(),this.pack=I$.pack,this.unpack=I$.unpack,this._dataCount=1}return n.prototype.noop=function(){},n.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},n.prototype.chunk=function(e){for(var i=[],s=e.size,r=Math.ceil(s/an.chunkedMTU),o=0,a=0;a<s;){var l=Math.min(s,a+an.chunkedMTU),c=e.slice(a,l),h={__peerData:this._dataCount,n:o,data:c,total:r};i.push(h),a=l,o++}return this._dataCount++,i},n.prototype.blobToArrayBuffer=function(e,i){var s=new FileReader;return s.onload=function(r){r.target&&i(r.target.result)},s.readAsArrayBuffer(e),s},n.prototype.binaryStringToArrayBuffer=function(e){for(var i=new Uint8Array(e.length),s=0;s<e.length;s++)i[s]=e.charCodeAt(s)&255;return i.buffer},n.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},n.prototype.isSecure=function(){return location.protocol==="https:"},n}(),an=new iLe,xee={};Ed(xee,"Peer",()=>dz,n=>dz=n);var hC={},nLe=Object.prototype.hasOwnProperty,Ra="~";function dC(){}Object.create&&(dC.prototype=Object.create(null),new dC().__proto__||(Ra=!1));function sLe(n,e,i){this.fn=n,this.context=e,this.once=i||!1}function wee(n,e,i,s,r){if(typeof i!="function")throw new TypeError("The listener must be a function");var o=new sLe(i,s||n,r),a=Ra?Ra+e:e;return n._events[a]?n._events[a].fn?n._events[a]=[n._events[a],o]:n._events[a].push(o):(n._events[a]=o,n._eventsCount++),n}function e2(n,e){--n._eventsCount===0?n._events=new dC:delete n._events[e]}function ia(){this._events=new dC,this._eventsCount=0}ia.prototype.eventNames=function(){var n=[],e,i;if(this._eventsCount===0)return n;for(i in e=this._events)nLe.call(e,i)&&n.push(Ra?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},ia.prototype.listeners=function(n){var e=Ra?Ra+n:n,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,r=i.length,o=new Array(r);s<r;s++)o[s]=i[s].fn;return o},ia.prototype.listenerCount=function(n){var e=Ra?Ra+n:n,i=this._events[e];return i?i.fn?1:i.length:0},ia.prototype.emit=function(n,e,i,s,r,o){var a=Ra?Ra+n:n;if(!this._events[a])return!1;var l=this._events[a],c=arguments.length,h,d;if(l.fn){switch(l.once&&this.removeListener(n,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,i),!0;case 4:return l.fn.call(l.context,e,i,s),!0;case 5:return l.fn.call(l.context,e,i,s,r),!0;case 6:return l.fn.call(l.context,e,i,s,r,o),!0}for(d=1,h=new Array(c-1);d<c;d++)h[d-1]=arguments[d];l.fn.apply(l.context,h)}else{var u=l.length,p;for(d=0;d<u;d++)switch(l[d].once&&this.removeListener(n,l[d].fn,void 0,!0),c){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,e);break;case 3:l[d].fn.call(l[d].context,e,i);break;case 4:l[d].fn.call(l[d].context,e,i,s);break;default:if(!h)for(p=1,h=new Array(c-1);p<c;p++)h[p-1]=arguments[p];l[d].fn.apply(l[d].context,h)}}return!0},ia.prototype.on=function(n,e,i){return wee(this,n,e,i,!1)},ia.prototype.once=function(n,e,i){return wee(this,n,e,i,!0)},ia.prototype.removeListener=function(n,e,i,s){var r=Ra?Ra+n:n;if(!this._events[r])return this;if(!e)return e2(this,r),this;var o=this._events[r];if(o.fn)o.fn===e&&(!s||o.once)&&(!i||o.context===i)&&e2(this,r);else{for(var a=0,l=[],c=o.length;a<c;a++)(o[a].fn!==e||s&&!o[a].once||i&&o[a].context!==i)&&l.push(o[a]);l.length?this._events[r]=l.length===1?l[0]:l:e2(this,r)}return this},ia.prototype.removeAllListeners=function(n){var e;return n?(e=Ra?Ra+n:n,this._events[e]&&e2(this,e)):(this._events=new dC,this._eventsCount=0),this},ia.prototype.off=ia.prototype.removeListener,ia.prototype.addListener=ia.prototype.on,ia.prefixed=Ra,ia.EventEmitter=ia,hC=ia;var Pt={};Ed(Pt,"LogLevel",()=>sl,n=>sl=n),Ed(Pt,"default",()=>Cee,n=>Cee=n);var C0=function(n,e){var i=typeof Symbol=="function"&&n[Symbol.iterator];if(!i)return n;var s=i.call(n),r,o=[],a;try{for(;(e===void 0||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return o},S0=function(n,e,i){if(i||arguments.length===2)for(var s=0,r=e.length,o;s<r;s++)(o||!(s in e))&&(o||(o=Array.prototype.slice.call(e,0,s)),o[s]=e[s]);return n.concat(o||Array.prototype.slice.call(e))},rLe="PeerJS: ",sl;(function(n){n[n.Disabled=0]="Disabled",n[n.Errors=1]="Errors",n[n.Warnings=2]="Warnings",n[n.All=3]="All"})(sl||(sl={}));var oLe=function(){function n(){this._logLevel=sl.Disabled}return Object.defineProperty(n.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!1,configurable:!0}),n.prototype.log=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._logLevel>=sl.All&&this._print.apply(this,S0([sl.All],C0(e),!1))},n.prototype.warn=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._logLevel>=sl.Warnings&&this._print.apply(this,S0([sl.Warnings],C0(e),!1))},n.prototype.error=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._logLevel>=sl.Errors&&this._print.apply(this,S0([sl.Errors],C0(e),!1))},n.prototype.setLogFunction=function(e){this._print=e},n.prototype._print=function(e){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];var r=S0([rLe],C0(i),!1);for(var o in r)r[o]instanceof Error&&(r[o]="("+r[o].name+") "+r[o].message);e>=sl.All?console.log.apply(console,S0([],C0(r),!1)):e>=sl.Warnings?console.warn.apply(console,S0(["WARNING"],C0(r),!1)):e>=sl.Errors&&console.error.apply(console,S0(["ERROR"],C0(r),!1))},n}(),Cee=new oLe,See={};Ed(See,"Socket",()=>_ee,n=>_ee=n);var Lh;(function(n){n.Data="data",n.Media="media"})(Lh||(Lh={}));var Ws;(function(n){n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc"})(Ws||(Ws={}));var ep;(function(n){n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json"})(ep||(ep={}));var tp;(function(n){n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close"})(tp||(tp={}));var wo;(function(n){n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE"})(wo||(wo={}));var oz={};oz=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz St\xFCckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","So\u0308ren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var aLe=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[o]=r[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function s(){this.constructor=e}e.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}}(),lLe=function(n,e){var i=typeof Symbol=="function"&&n[Symbol.iterator];if(!i)return n;var s=i.call(n),r,o=[],a;try{for(;(e===void 0||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return o},cLe=function(n,e,i){if(i||arguments.length===2)for(var s=0,r=e.length,o;s<r;s++)(o||!(s in e))&&(o||(o=Array.prototype.slice.call(e,0,s)),o[s]=e[s]);return n.concat(o||Array.prototype.slice.call(e))},hLe=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&n[e],s=0;if(i)return i.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},_ee=function(n){aLe(e,n);function e(i,s,r,o,a,l){l===void 0&&(l=5e3);var c=n.call(this)||this;c.pingInterval=l,c._disconnected=!0,c._messagesQueue=[];var h=i?"wss://":"ws://";return c._baseUrl=h+s+":"+r+o+"peerjs?key="+a,c}return e.prototype.start=function(i,s){var r=this;this._id=i;var o="".concat(this._baseUrl,"&id=").concat(i,"&token=").concat(s);this._socket||!this._disconnected||(this._socket=new WebSocket(o+"&version="+oz.version),this._disconnected=!1,this._socket.onmessage=function(a){var l;try{l=JSON.parse(a.data),Pt.default.log("Server message received:",l)}catch{Pt.default.log("Invalid server message",a.data);return}r.emit(tp.Message,l)},this._socket.onclose=function(a){r._disconnected||(Pt.default.log("Socket closed.",a),r._cleanup(),r._disconnected=!0,r.emit(tp.Disconnected))},this._socket.onopen=function(){r._disconnected||(r._sendQueuedMessages(),Pt.default.log("Socket open"),r._scheduleHeartbeat())})},e.prototype._scheduleHeartbeat=function(){var i=this;this._wsPingTimer=setTimeout(function(){i._sendHeartbeat()},this.pingInterval)},e.prototype._sendHeartbeat=function(){if(!this._wsOpen()){Pt.default.log("Cannot send heartbeat, because socket closed");return}var i=JSON.stringify({type:wo.Heartbeat});this._socket.send(i),this._scheduleHeartbeat()},e.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},e.prototype._sendQueuedMessages=function(){var i,s,r=cLe([],lLe(this._messagesQueue),!1);this._messagesQueue=[];try{for(var o=hLe(r),a=o.next();!a.done;a=o.next()){var l=a.value;this.send(l)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},e.prototype.send=function(i){if(!this._disconnected){if(!this._id){this._messagesQueue.push(i);return}if(!i.type){this.emit(tp.Error,"Invalid message");return}if(this._wsOpen()){var s=JSON.stringify(i);this._socket.send(s)}}},e.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},e.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},e}(hC.EventEmitter),az={};Ed(az,"MediaConnection",()=>Tee,n=>Tee=n);var lz={};Ed(lz,"Negotiator",()=>Mee,n=>Mee=n);var t2=function(){return t2=Object.assign||function(n){for(var e,i=1,s=arguments.length;i<s;i++){e=arguments[i];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},t2.apply(this,arguments)},i2=function(n,e,i,s){function r(o){return o instanceof i?o:new i(function(a){a(o)})}return new(i||(i=Promise))(function(o,a){function l(d){try{h(s.next(d))}catch(u){a(u)}}function c(d){try{h(s.throw(d))}catch(u){a(u)}}function h(d){d.done?o(d.value):r(d.value).then(l,c)}h((s=s.apply(n,e||[])).next())})},n2=function(n,e){var i={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,r,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(d){return c([h,d])}}function c(h){if(s)throw new TypeError("Generator is already executing.");for(;i;)try{if(s=1,r&&(o=h[0]&2?r.return:h[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,h[1])).done)return o;switch(r=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return i.label++,{value:h[1],done:!1};case 5:i.label++,r=h[1],h=[0];continue;case 7:h=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){i=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){i.label=h[1];break}if(h[0]===6&&i.label<o[1]){i.label=o[1],o=h;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(h);break}o[2]&&i.ops.pop(),i.trys.pop();continue}h=e.call(n,i)}catch(d){h=[6,d],r=0}finally{s=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},Mee=function(){function n(e){this.connection=e}return n.prototype.startConnection=function(e){var i=this._startPeerConnection();if(this.connection.peerConnection=i,this.connection.type===Lh.Media&&e._stream&&this._addTracksToConnection(e._stream,i),e.originator){if(this.connection.type===Lh.Data){var s=this.connection,r={ordered:!!e.reliable},o=i.createDataChannel(s.label,r);s.initialize(o)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)},n.prototype._startPeerConnection=function(){Pt.default.log("Creating RTCPeerConnection.");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e},n.prototype._setupListeners=function(e){var i=this,s=this.connection.peer,r=this.connection.connectionId,o=this.connection.type,a=this.connection.provider;Pt.default.log("Listening for ICE candidates."),e.onicecandidate=function(l){!l.candidate||!l.candidate.candidate||(Pt.default.log("Received ICE candidates for ".concat(s,":"),l.candidate),a.socket.send({type:wo.Candidate,payload:{candidate:l.candidate,type:o,connectionId:r},dst:s}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":Pt.default.log("iceConnectionState is failed, closing connections to "+s),i.connection.emit("error",new Error("Negotiation of connection to "+s+" failed.")),i.connection.close();break;case"closed":Pt.default.log("iceConnectionState is closed, closing connections to "+s),i.connection.emit("error",new Error("Connection to "+s+" closed.")),i.connection.close();break;case"disconnected":Pt.default.log("iceConnectionState changed to disconnected on the connection with "+s);break;case"completed":e.onicecandidate=an.noop;break}i.connection.emit("iceStateChanged",e.iceConnectionState)},Pt.default.log("Listening for data channel"),e.ondatachannel=function(l){Pt.default.log("Received data channel");var c=l.channel,h=a.getConnection(s,r);h.initialize(c)},Pt.default.log("Listening for remote stream"),e.ontrack=function(l){Pt.default.log("Received remote stream");var c=l.streams[0],h=a.getConnection(s,r);if(h.type===Lh.Media){var d=h;i._addStreamToMediaConnection(c,d)}}},n.prototype.cleanup=function(){Pt.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var i=e.signalingState!=="closed",s=!1;if(this.connection.type===Lh.Data){var r=this.connection,o=r.dataChannel;o&&(s=!!o.readyState&&o.readyState!=="closed")}(i||s)&&e.close()}},n.prototype._makeOffer=function(){return i2(this,void 0,Promise,function(){var e,i,s,r,o,a,l;return n2(this,function(c){switch(c.label){case 0:e=this.connection.peerConnection,i=this.connection.provider,c.label=1;case 1:return c.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:s=c.sent(),Pt.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(s.sdp=this.connection.options.sdpTransform(s.sdp)||s.sdp),c.label=3;case 3:return c.trys.push([3,5,,6]),[4,e.setLocalDescription(s)];case 4:return c.sent(),Pt.default.log("Set localDescription:",s,"for:".concat(this.connection.peer)),r={sdp:s,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:an.browser},this.connection.type===Lh.Data&&(o=this.connection,r=t2(t2({},r),{label:o.label,reliable:o.reliable,serialization:o.serialization})),i.socket.send({type:wo.Offer,payload:r,dst:this.connection.peer}),[3,6];case 5:return a=c.sent(),a!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(i.emitError(Ws.WebRTC,a),Pt.default.log("Failed to setLocalDescription, ",a)),[3,6];case 6:return[3,8];case 7:return l=c.sent(),i.emitError(Ws.WebRTC,l),Pt.default.log("Failed to createOffer, ",l),[3,8];case 8:return[2]}})})},n.prototype._makeAnswer=function(){return i2(this,void 0,Promise,function(){var e,i,s,r,o;return n2(this,function(a){switch(a.label){case 0:e=this.connection.peerConnection,i=this.connection.provider,a.label=1;case 1:return a.trys.push([1,7,,8]),[4,e.createAnswer()];case 2:s=a.sent(),Pt.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(s.sdp=this.connection.options.sdpTransform(s.sdp)||s.sdp),a.label=3;case 3:return a.trys.push([3,5,,6]),[4,e.setLocalDescription(s)];case 4:return a.sent(),Pt.default.log("Set localDescription:",s,"for:".concat(this.connection.peer)),i.socket.send({type:wo.Answer,payload:{sdp:s,type:this.connection.type,connectionId:this.connection.connectionId,browser:an.browser},dst:this.connection.peer}),[3,6];case 5:return r=a.sent(),i.emitError(Ws.WebRTC,r),Pt.default.log("Failed to setLocalDescription, ",r),[3,6];case 6:return[3,8];case 7:return o=a.sent(),i.emitError(Ws.WebRTC,o),Pt.default.log("Failed to create answer, ",o),[3,8];case 8:return[2]}})})},n.prototype.handleSDP=function(e,i){return i2(this,void 0,Promise,function(){var s,r,o,a;return n2(this,function(l){switch(l.label){case 0:i=new RTCSessionDescription(i),s=this.connection.peerConnection,r=this.connection.provider,Pt.default.log("Setting remote description",i),o=this,l.label=1;case 1:return l.trys.push([1,5,,6]),[4,s.setRemoteDescription(i)];case 2:return l.sent(),Pt.default.log("Set remoteDescription:".concat(e," for:").concat(this.connection.peer)),e!=="OFFER"?[3,4]:[4,o._makeAnswer()];case 3:l.sent(),l.label=4;case 4:return[3,6];case 5:return a=l.sent(),r.emitError(Ws.WebRTC,a),Pt.default.log("Failed to setRemoteDescription, ",a),[3,6];case 6:return[2]}})})},n.prototype.handleCandidate=function(e){return i2(this,void 0,Promise,function(){var i,s,r,o,a,l;return n2(this,function(c){switch(c.label){case 0:Pt.default.log("handleCandidate:",e),i=e.candidate,s=e.sdpMLineIndex,r=e.sdpMid,o=this.connection.peerConnection,a=this.connection.provider,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,o.addIceCandidate(new RTCIceCandidate({sdpMid:r,sdpMLineIndex:s,candidate:i}))];case 2:return c.sent(),Pt.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return l=c.sent(),a.emitError(Ws.WebRTC,l),Pt.default.log("Failed to handleCandidate, ",l),[3,4];case 4:return[2]}})})},n.prototype._addTracksToConnection=function(e,i){if(Pt.default.log("add tracks from stream ".concat(e.id," to peer connection")),!i.addTrack)return Pt.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(function(s){i.addTrack(s,e)})},n.prototype._addStreamToMediaConnection=function(e,i){Pt.default.log("add stream ".concat(e.id," to media connection ").concat(i.connectionId)),i.addStream(e)},n}(),cz={};Ed(cz,"BaseConnection",()=>Iee,n=>Iee=n);var dLe=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[o]=r[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function s(){this.constructor=e}e.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}}(),Iee=function(n){dLe(e,n);function e(i,s,r){var o=n.call(this)||this;return o.peer=i,o.provider=s,o.options=r,o._open=!1,o.metadata=r.metadata,o}return Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),e}(hC.EventEmitter),uLe=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[o]=r[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function s(){this.constructor=e}e.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}}(),s2=function(){return s2=Object.assign||function(n){for(var e,i=1,s=arguments.length;i<s;i++){e=arguments[i];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},s2.apply(this,arguments)},pLe=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&n[e],s=0;if(i)return i.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Tee=function(n){uLe(e,n);function e(i,s,r){var o=n.call(this,i,s,r)||this;return o._localStream=o.options._stream,o.connectionId=o.options.connectionId||e.ID_PREFIX+an.randomToken(),o._negotiator=new lz.Negotiator(o),o._localStream&&o._negotiator.startConnection({_stream:o._localStream,originator:!0}),o}return Object.defineProperty(e.prototype,"type",{get:function(){return Lh.Media},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),e.prototype.addStream=function(i){Pt.default.log("Receiving stream",i),this._remoteStream=i,n.prototype.emit.call(this,"stream",i)},e.prototype.handleMessage=function(i){var s=i.type,r=i.payload;switch(i.type){case wo.Answer:this._negotiator.handleSDP(s,r.sdp),this._open=!0;break;case wo.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:Pt.default.warn("Unrecognized message type:".concat(s," from peer:").concat(this.peer));break}},e.prototype.answer=function(i,s){var r,o;if(s===void 0&&(s={}),this._localStream){Pt.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=i,s&&s.sdpTransform&&(this.options.sdpTransform=s.sdpTransform),this._negotiator.startConnection(s2(s2({},this.options._payload),{_stream:i}));var a=this.provider._getMessages(this.connectionId);try{for(var l=pLe(a),c=l.next();!c.done;c=l.next()){var h=c.value;this.handleMessage(h)}}catch(d){r={error:d}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}this._open=!0},e.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},e.ID_PREFIX="mc_",e}(cz.BaseConnection),hz={};Ed(hz,"DataConnection",()=>Lee,n=>Lee=n);var Eee={};Ed(Eee,"EncodingQueue",()=>Ree,n=>Ree=n);var mLe=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[o]=r[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function s(){this.constructor=e}e.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}}(),Ree=function(n){mLe(e,n);function e(){var i=n.call(this)||this;return i.fileReader=new FileReader,i._queue=[],i._processing=!1,i.fileReader.onload=function(s){i._processing=!1,s.target&&i.emit("done",s.target.result),i.doNextTask()},i.fileReader.onerror=function(s){Pt.default.error("EncodingQueue error:",s),i._processing=!1,i.destroy(),i.emit("error",s)},i}return Object.defineProperty(e.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),e.prototype.enque=function(i){this.queue.push(i),!this.processing&&this.doNextTask()},e.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},e.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},e}(hC.EventEmitter),gLe=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[o]=r[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function s(){this.constructor=e}e.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}}(),fLe=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&n[e],s=0;if(i)return i.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Lee=function(n){gLe(e,n);function e(i,s,r){var o=n.call(this,i,s,r)||this;return o.stringify=JSON.stringify,o.parse=JSON.parse,o._buffer=[],o._bufferSize=0,o._buffering=!1,o._chunkedData={},o._encodingQueue=new Eee.EncodingQueue,o.connectionId=o.options.connectionId||e.ID_PREFIX+an.randomToken(),o.label=o.options.label||o.connectionId,o.serialization=o.options.serialization||ep.Binary,o.reliable=!!o.options.reliable,o._encodingQueue.on("done",function(a){o._bufferedSend(a)}),o._encodingQueue.on("error",function(){Pt.default.error("DC#".concat(o.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),o.close()}),o._negotiator=new lz.Negotiator(o),o._negotiator.startConnection(o.options._payload||{originator:!0}),o}return Object.defineProperty(e.prototype,"type",{get:function(){return Lh.Data},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),e.prototype.initialize=function(i){this._dc=i,this._configureDataChannel()},e.prototype._configureDataChannel=function(){var i=this;(!an.supports.binaryBlob||an.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){Pt.default.log("DC#".concat(i.connectionId," dc connection success")),i._open=!0,i.emit("open")},this.dataChannel.onmessage=function(s){Pt.default.log("DC#".concat(i.connectionId," dc onmessage:"),s.data),i._handleDataMessage(s)},this.dataChannel.onclose=function(){Pt.default.log("DC#".concat(i.connectionId," dc closed for:"),i.peer),i.close()}},e.prototype._handleDataMessage=function(i){var s=this,r=i.data,o=r.constructor,a=this.serialization===ep.Binary||this.serialization===ep.BinaryUTF8,l=r;if(a){if(o===Blob){an.blobToArrayBuffer(r,function(h){var d=an.unpack(h);s.emit("data",d)});return}else if(o===ArrayBuffer)l=an.unpack(r);else if(o===String){var c=an.binaryStringToArrayBuffer(r);l=an.unpack(c)}}else this.serialization===ep.JSON&&(l=this.parse(r));if(l.__peerData){this._handleChunk(l);return}n.prototype.emit.call(this,"data",l)},e.prototype._handleChunk=function(i){var s=i.__peerData,r=this._chunkedData[s]||{data:[],count:0,total:i.total};if(r.data[i.n]=i.data,r.count++,this._chunkedData[s]=r,r.total===r.count){delete this._chunkedData[s];var o=new Blob(r.data);this._handleDataMessage({data:o})}},e.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},e.prototype.send=function(i,s){if(!this.open){n.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===ep.JSON)this._bufferedSend(this.stringify(i));else if(this.serialization===ep.Binary||this.serialization===ep.BinaryUTF8){var r=an.pack(i);if(!s&&r.size>an.chunkedMTU){this._sendChunks(r);return}an.supports.binaryBlob?this._bufferedSend(r):this._encodingQueue.enque(r)}else this._bufferedSend(i)},e.prototype._bufferedSend=function(i){(this._buffering||!this._trySend(i))&&(this._buffer.push(i),this._bufferSize=this._buffer.length)},e.prototype._trySend=function(i){var s=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>e.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){s._buffering=!1,s._tryBuffer()},50),!1;try{this.dataChannel.send(i)}catch(r){return Pt.default.error("DC#:".concat(this.connectionId," Error when sending:"),r),this._buffering=!0,this.close(),!1}return!0},e.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var i=this._buffer[0];this._trySend(i)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},e.prototype._sendChunks=function(i){var s,r,o=an.chunk(i);Pt.default.log("DC#".concat(this.connectionId," Try to send ").concat(o.length," chunks..."));try{for(var a=fLe(o),l=a.next();!l.done;l=a.next()){var c=l.value;this.send(c,!0)}}catch(h){s={error:h}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}},e.prototype.handleMessage=function(i){var s=i.payload;switch(i.type){case wo.Answer:this._negotiator.handleSDP(i.type,s.sdp);break;case wo.Candidate:this._negotiator.handleCandidate(s.candidate);break;default:Pt.default.warn("Unrecognized message type:",i.type,"from peer:",this.peer);break}},e.ID_PREFIX="dc_",e.MAX_BUFFERED_AMOUNT=8388608,e}(cz.BaseConnection),Bee={};Ed(Bee,"API",()=>Pee,n=>Pee=n);var kee=function(n,e,i,s){function r(o){return o instanceof i?o:new i(function(a){a(o)})}return new(i||(i=Promise))(function(o,a){function l(d){try{h(s.next(d))}catch(u){a(u)}}function c(d){try{h(s.throw(d))}catch(u){a(u)}}function h(d){d.done?o(d.value):r(d.value).then(l,c)}h((s=s.apply(n,e||[])).next())})},Gee=function(n,e){var i={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,r,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(d){return c([h,d])}}function c(h){if(s)throw new TypeError("Generator is already executing.");for(;i;)try{if(s=1,r&&(o=h[0]&2?r.return:h[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,h[1])).done)return o;switch(r=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return i.label++,{value:h[1],done:!1};case 5:i.label++,r=h[1],h=[0];continue;case 7:h=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){i=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){i.label=h[1];break}if(h[0]===6&&i.label<o[1]){i.label=o[1],o=h;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(h);break}o[2]&&i.ops.pop(),i.trys.pop();continue}h=e.call(n,i)}catch(d){h=[6,d],r=0}finally{s=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},Pee=function(){function n(e){this._options=e}return n.prototype._buildRequest=function(e){var i=this._options.secure?"https":"http",s=this._options,r=s.host,o=s.port,a=s.path,l=s.key,c=new URL("".concat(i,"://").concat(r,":").concat(o).concat(a).concat(l,"/").concat(e));return c.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),c.searchParams.set("version",oz.version),fetch(c.href,{referrerPolicy:this._options.referrerPolicy})},n.prototype.retrieveId=function(){return kee(this,void 0,Promise,function(){var e,i,s;return Gee(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(e=r.sent(),e.status!==200)throw new Error("Error. Status:".concat(e.status));return[2,e.text()];case 2:throw i=r.sent(),Pt.default.error("Error retrieving ID",i),s="",this._options.path==="/"&&this._options.host!==an.CLOUD_HOST&&(s=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+s);case 3:return[2]}})})},n.prototype.listAllPeers=function(){return kee(this,void 0,Promise,function(){var e,i,s;return Gee(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(e=r.sent(),e.status!==200)throw e.status===401?(i="",this._options.host===an.CLOUD_HOST?i="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":i="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+i)):new Error("Error. Status:".concat(e.status));return[2,e.json()];case 2:throw s=r.sent(),Pt.default.error("Error retrieving list peers",s),new Error("Could not get list peers from the server."+s);case 3:return[2]}})})},n}(),ALe=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[o]=r[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function s(){this.constructor=e}e.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}}(),uC=function(){return uC=Object.assign||function(n){for(var e,i=1,s=arguments.length;i<s;i++){e=arguments[i];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},uC.apply(this,arguments)},pC=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&n[e],s=0;if(i)return i.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},yLe=function(n,e){var i=typeof Symbol=="function"&&n[Symbol.iterator];if(!i)return n;var s=i.call(n),r,o=[],a;try{for(;(e===void 0||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(l){a={error:l}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return o},dz=function(n){ALe(e,n);function e(i,s){var r=n.call(this)||this;r._id=null,r._lastServerId=null,r._destroyed=!1,r._disconnected=!1,r._open=!1,r._connections=new Map,r._lostMessages=new Map;var o;return i&&i.constructor==Object?s=i:i&&(o=i.toString()),s=uC({debug:0,host:an.CLOUD_HOST,port:an.CLOUD_PORT,path:"/",key:e.DEFAULT_KEY,token:an.randomToken(),config:an.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},s),r._options=s,r._options.host==="/"&&(r._options.host=window.location.hostname),r._options.path&&(r._options.path[0]!=="/"&&(r._options.path="/"+r._options.path),r._options.path[r._options.path.length-1]!=="/"&&(r._options.path+="/")),r._options.secure===void 0&&r._options.host!==an.CLOUD_HOST?r._options.secure=an.isSecure():r._options.host==an.CLOUD_HOST&&(r._options.secure=!0),r._options.logFunction&&Pt.default.setLogFunction(r._options.logFunction),Pt.default.logLevel=r._options.debug||0,r._api=new Bee.API(s),r._socket=r._createServerConnection(),!an.supports.audioVideo&&!an.supports.data?(r._delayedAbort(Ws.BrowserIncompatible,"The current browser does not support WebRTC"),r):o&&!an.validateId(o)?(r._delayedAbort(Ws.InvalidID,'ID "'.concat(o,'" is invalid')),r):(o?r._initialize(o):r._api.retrieveId().then(function(a){return r._initialize(a)}).catch(function(a){return r._abort(Ws.ServerError,a)}),r)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connections",{get:function(){var i,s,r=Object.create(null);try{for(var o=pC(this._connections),a=o.next();!a.done;a=o.next()){var l=yLe(a.value,2),c=l[0],h=l[1];r[c]=h}}catch(d){i={error:d}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}return r},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),e.prototype._createServerConnection=function(){var i=this,s=new See.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return s.on(tp.Message,function(r){i._handleMessage(r)}),s.on(tp.Error,function(r){i._abort(Ws.SocketError,r)}),s.on(tp.Disconnected,function(){i.disconnected||(i.emitError(Ws.Network,"Lost connection to server."),i.disconnect())}),s.on(tp.Close,function(){i.disconnected||i._abort(Ws.SocketClosed,"Underlying socket is already closed.")}),s},e.prototype._initialize=function(i){this._id=i,this.socket.start(i,this._options.token)},e.prototype._handleMessage=function(i){var s,r,o=i.type,a=i.payload,l=i.src;switch(o){case wo.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case wo.Error:this._abort(Ws.ServerError,a.msg);break;case wo.IdTaken:this._abort(Ws.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case wo.InvalidKey:this._abort(Ws.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case wo.Leave:Pt.default.log("Received leave message from ".concat(l)),this._cleanupPeer(l),this._connections.delete(l);break;case wo.Expire:this.emitError(Ws.PeerUnavailable,"Could not connect to peer ".concat(l));break;case wo.Offer:var f=a.connectionId,A=this.getConnection(l,f);if(A&&(A.close(),Pt.default.warn("Offer received for existing Connection ID:".concat(f))),a.type===Lh.Media){var c=new az.MediaConnection(l,this,{connectionId:f,_payload:a,metadata:a.metadata});A=c,this._addConnection(l,A),this.emit("call",c)}else if(a.type===Lh.Data){var h=new hz.DataConnection(l,this,{connectionId:f,_payload:a,metadata:a.metadata,label:a.label,serialization:a.serialization,reliable:a.reliable});A=h,this._addConnection(l,A),this.emit("connection",h)}else{Pt.default.warn("Received malformed connection type:".concat(a.type));return}var d=this._getMessages(f);try{for(var u=pC(d),p=u.next();!p.done;p=u.next()){var g=p.value;A.handleMessage(g)}}catch(y){s={error:y}}finally{try{p&&!p.done&&(r=u.return)&&r.call(u)}finally{if(s)throw s.error}}break;default:if(!a){Pt.default.warn("You received a malformed message from ".concat(l," of type ").concat(o));return}var f=a.connectionId,A=this.getConnection(l,f);A&&A.peerConnection?A.handleMessage(i):f?this._storeMessage(f,i):Pt.default.warn("You received an unrecognized message:",i);break}},e.prototype._storeMessage=function(i,s){this._lostMessages.has(i)||this._lostMessages.set(i,[]),this._lostMessages.get(i).push(s)},e.prototype._getMessages=function(i){var s=this._lostMessages.get(i);return s?(this._lostMessages.delete(i),s):[]},e.prototype.connect=function(i,s){if(s===void 0&&(s={}),this.disconnected){Pt.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Ws.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var r=new hz.DataConnection(i,this,s);return this._addConnection(i,r),r},e.prototype.call=function(i,s,r){if(r===void 0&&(r={}),this.disconnected){Pt.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Ws.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!s){Pt.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var o=new az.MediaConnection(i,this,uC(uC({},r),{_stream:s}));return this._addConnection(i,o),o},e.prototype._addConnection=function(i,s){Pt.default.log("add connection ".concat(s.type,":").concat(s.connectionId," to peerId:").concat(i)),this._connections.has(i)||this._connections.set(i,[]),this._connections.get(i).push(s)},e.prototype._removeConnection=function(i){var s=this._connections.get(i.peer);if(s){var r=s.indexOf(i);r!==-1&&s.splice(r,1)}this._lostMessages.delete(i.connectionId)},e.prototype.getConnection=function(i,s){var r,o,a=this._connections.get(i);if(!a)return null;try{for(var l=pC(a),c=l.next();!c.done;c=l.next()){var h=c.value;if(h.connectionId===s)return h}}catch(d){r={error:d}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}return null},e.prototype._delayedAbort=function(i,s){var r=this;setTimeout(function(){r._abort(i,s)},0)},e.prototype._abort=function(i,s){Pt.default.error("Aborting!"),this.emitError(i,s),this._lastServerId?this.disconnect():this.destroy()},e.prototype.emitError=function(i,s){Pt.default.error("Error:",s);var r;typeof s=="string"?r=new Error(s):r=s,r.type=i,this.emit("error",r)},e.prototype.destroy=function(){this.destroyed||(Pt.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},e.prototype._cleanup=function(){var i,s;try{for(var r=pC(this._connections.keys()),o=r.next();!o.done;o=r.next()){var a=o.value;this._cleanupPeer(a),this._connections.delete(a)}}catch(l){i={error:l}}finally{try{o&&!o.done&&(s=r.return)&&s.call(r)}finally{if(i)throw i.error}}this.socket.removeAllListeners()},e.prototype._cleanupPeer=function(i){var s,r,o=this._connections.get(i);if(o)try{for(var a=pC(o),l=a.next();!l.done;l=a.next()){var c=l.value;c.close()}}catch(h){s={error:h}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}},e.prototype.disconnect=function(){if(!this.disconnected){var i=this.id;Pt.default.log("Disconnect peer with ID:".concat(i)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=i,this._id=null,this.emit("disconnected",i)}},e.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)Pt.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)Pt.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},e.prototype.listAllPeers=function(i){var s=this;i===void 0&&(i=function(r){}),this._api.listAllPeers().then(function(r){return i(r)}).catch(function(r){return s._abort(Ws.ServerError,r)})},e.DEFAULT_KEY="peerjs",e}(hC.EventEmitter),uz=xee.Peer;const bLe=Object.freeze(Object.defineProperty({__proto__:null,get Peer(){return dz},default:uz,util:an},Symbol.toStringTag,{value:"Module"}));let pz;function vLe(){return pz}function xLe(n){pz=n}function Nee(n,e){return e||(e={}),e={...pz,...e},n?new uz(n,e):new uz(e)}async function Vee(){const n=await Promise.resolve().then(()=>bLe);return console.log(n),n.default===void 0?n:n.default}class Xee{constructor(){m(this,"_host"),m(this,"_client"),m(this,"_clientData"),this.onEnable()}get isHost(){return this._host!==void 0}onEnable(){const e="HOST-5980e65c-8438-453e-8b35-f13c736dcd81";this.trySetupHost(e)}async trySetupHost(e){const i=await Vee(),s=new i(e);s.on("error",r=>{console.error(r),this._host=void 0,this.trySetupClient(e)}),s.on("open",r=>{this._host=new CLe(s)})}async trySetupClient(e){const i=await Vee();this._client=new i,this._client.on("error",s=>{console.error("Client error",s)}),this._client.on("open",s=>{console.log("client connected",s),this._clientData=this._client.connect(e,{metadata:{id:s}}),this._clientData.on("open",()=>{console.log("Connected to host")}),this._clientData.on("data",r=>{console.log("<<",r)})})}}class wLe{constructor(e){m(this,"_peer"),this._peer=e}}class CLe extends wLe{constructor(e){var i;super(e),m(this,"_connections",[]),console.log("I AM THE HOST"),(i=this._peer)==null||i.on("connection",this.onConnection.bind(this)),this._peer.on("close",()=>{this.broadcast("BYE")}),setInterval(()=>{this.broadcast("HELLO")},2e3)}get isHost(){return!0}onConnection(e){console.log("host connection",e),e.on("open",()=>{this._connections.push(e),this.broadcastConnection(e)})}broadcastConnection(e){const i=this._connections.map(s=>{var r;return(r=s.metadata)==null?void 0:r.id}).filter(s=>s!==void 0);this.broadcast({type:"connection-list",connections:i})}broadcast(e){if(e!=null){console.log(">>",e);for(const i in this._peer.connections){const s=this._peer.connections[i];if(s)if(Array.isArray(s))for(const r of s)r&&r.send(e);else console.warn(s)}}}}var Bh=(n=>(n[n.OnConnection=0]="OnConnection",n[n.OnRoomJoin=1]="OnRoomJoin",n[n.Queued=2]="Queued",n[n.Immediate=3]="Immediate",n))(Bh||{});const Dee="https://urls.needle.tools/default-networking-backend/index";let zl="wss://networking.needle.tools/socket";const rl=!!q("debugnet"),mC=!!(rl||q("debugowner")),mz=q("debugnetbin");var zee=(n=>(n.ConnectionInfo="connection-start-info",n))(zee||{}),pi=(n=>(n.Join="join-room",n.Leave="leave-room",n.JoinedRoom="joined-room",n.LeftRoom="left-room",n.UserJoinedRoom="user-joined-room",n.UserLeftRoom="user-left-room",n.RoomStateSent="room-state-sent",n))(pi||{});class SLe{constructor(){m(this,"room"),m(this,"viewId"),m(this,"allowEditing"),m(this,"inRoom")}}class _Le{constructor(){m(this,"room")}}class MLe{constructor(){m(this,"userId")}}var Fee=(n=>(n.RequestHasOwner="request-has-owner",n.ResponseHasOwner="response-has-owner",n.RequestIsOwner="request-is-owner",n.ResponseIsOwner="response-is-owner",n.RequestOwnership="request-ownership",n.GainedOwnership="gained-ownership",n.RemoveOwnership="remove-ownership",n.LostOwnership="lost-ownership",n.GainedOwnershipBroadcast="gained-ownership-broadcast",n.LostOwnershipBroadcast="lost-ownership-broadcast",n))(Fee||{});class gz{constructor(e,i){m(this,"guid"),m(this,"connection"),m(this,"_hasOwnership",!1),m(this,"_isOwned"),m(this,"_gainSubscription"),m(this,"_lostSubscription"),m(this,"_hasOwnerResponse"),m(this,"_isWaitingForOwnershipResponseCallback",null),this.connection=e,this.guid=i,this._gainSubscription=this.onGainedOwnership.bind(this),this._lostSubscription=this.onLostOwnership.bind(this),e.beginListen("lost-ownership",this._lostSubscription),e.beginListen("gained-ownership-broadcast",this._gainSubscription),this._hasOwnerResponse=this.onHasOwnerResponse.bind(this),e.beginListen("response-has-owner",this._hasOwnerResponse)}get hasOwnership(){return this._hasOwnership}get isOwned(){return this._isOwned}get isConnected(){return this.connection.isConnected}updateIsOwned(){this.connection.send("request-has-owner",{guid:this.guid})}onHasOwnerResponse(e){e.guid===this.guid&&(this._isOwned=e.value)}requestOwnershipIfNotOwned(){return this._isWaitingForOwnershipResponseCallback!==null?this:(this._isWaitingForOwnershipResponseCallback=this.waitForHasOwnershipRequestResponse.bind(this),this.connection.beginListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this.connection.send("request-has-owner",{guid:this.guid}),this)}waitForHasOwnershipRequestResponse(e){e.guid===this.guid&&(this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this._isOwned=e.value,e.value||(mC&&console.log("request ownership",this.guid),this.requestOwnership()))}requestOwnershipAsync(){return new Promise((e,i)=>{this.requestOwnership();let s=0;const r=()=>{if(s++>10)return i("Timeout");setTimeout(()=>{this.hasOwnership?e(this):r()},100)};r()})}requestOwnership(){return mC&&console.log("Request ownership",this.guid),this.connection.send("request-ownership",{guid:this.guid}),this}freeOwnership(){return this.connection.send("remove-ownership",{guid:this.guid}),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this}destroy(){this.connection.stopListen("gained-ownership",this._gainSubscription),this.connection.stopListen("lost-ownership",this._lostSubscription),this.connection.stopListen("response-has-owner",this._hasOwnerResponse),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null)}onGainedOwnership(e){e.guid===this.guid&&(this._isOwned=!0,this.connection.connectionId===e.owner?(mC&&console.log("GAINED OWNERSHIP",this.guid),this._hasOwnership=!0):this._hasOwnership=!1)}onLostOwnership(e){e===this.guid&&(mC&&console.log("LOST OWNERSHIP",this.guid),this._hasOwnership=!1,this._isOwned=!1)}}class Uee{constructor(e){m(this,"context"),m(this,"_peer",null),m(this,"_usersInRoomCopy",[]),m(this,"_defaultMessagesBuffer",[]),m(this,"_defaultMessagesBufferArray",[]),m(this,"netWebSocketUrlProvider"),m(this,"_listeners",{}),m(this,"_listenersBinary",{}),m(this,"connected",!1),m(this,"channelId"),m(this,"_connectionId",null),m(this,"_ws"),m(this,"_waitingForSocket",{}),m(this,"_isInRoom",!1),m(this,"_currentRoomName",null),m(this,"_currentRoomViewId",null),m(this,"_currentRoomAllowEditing",!0),m(this,"_currentInRoom",[]),m(this,"_state",{}),m(this,"_currentDelay",-1),m(this,"_connectingToWebsocketPromise",null),this.context=e}get peer(){return this._peer||(this._peer=new Xee),this._peer}tryGetState(e){return e==="invalid"?null:this._state[e]}get connectionId(){return this._connectionId}get isDebugEnabled(){return rl}get isConnected(){return this.connected}get currentRoomName(){return this._currentRoomName}get allowEditing(){return this._currentRoomAllowEditing}get currentRoomViewId(){return this._currentRoomViewId}getViewOnlyUrl(){if(this.currentRoomViewId===null)return null;const e=new URL(window.location.href);return e.searchParams.set("view",this.currentRoomViewId),e.href}get isInRoom(){return this._isInRoom}get currentLatency(){return this._currentDelay}get currentServerUrl(){var e;return((e=this._ws)==null?void 0:e.url)??null}sendPing(){this.send("ping",{time:this.context.time.time})}userIsInRoom(e){return this._currentInRoom.indexOf(e)!==-1}usersInRoom(e=null){e||(e=this._usersInRoomCopy),e.length=0;for(const i of this._currentInRoom)e.push(i);return e}joinRoom(e,i=!1){return e?e.length>1024?(console.error('Room name too long, can not join: "'+e+'". Max length is 1024 characters.'),!1):(this.connect(),rl&&console.log("join: "+e),this.send("join-room",{room:e,viewOnly:i},Bh.OnConnection),!0):(console.error('Missing room name, can not join: "'+e+'"'),!1)}leaveRoom(e=null){return e||(e=this.currentRoomName),e?(this.send("leave-room",{room:e}),!0):(console.error('Missing room name, can not join: "'+e+'"'),!1)}send(e,i=null,s=Bh.Queued){if(i===null&&(i={}),s===Bh.Queued){this._defaultMessagesBuffer.push({key:e,value:i});return}return this.sendWithWebsocket(e,i,s)}sendDeleteRemoteState(e){this.send("delete-state",{guid:e,dontSave:!0}),delete this._state[e]}sendDeleteRemoteStateAll(){this.send("delete-all-state"),this._state={}}sendBinary(e){var i;mz&&console.log("<< send binary",this.context.time.frame,e.length/1024+" KB"),(i=this._ws)==null||i.send(e)}sendBufferedMessagesNow(){var e;if(!this._ws)return;this._defaultMessagesBufferArray.length=0;const i=Object.keys(this._defaultMessagesBuffer).length;for(const r in this._defaultMessagesBuffer){const o=this._defaultMessagesBuffer[r];if(i<=1){this.sendWithWebsocket(o.key,o.value,Bh.Immediate);break}const a=this.toMessage(o.key,o.value);this._defaultMessagesBufferArray.push(a)}if(this._defaultMessagesBuffer.length=0,this._defaultMessagesBufferArray.length>0&&rl&&console.log("SEND BUFFERED",this._defaultMessagesBufferArray.length),this._defaultMessagesBufferArray.length<=0)return;const s=JSON.stringify(this._defaultMessagesBufferArray);(e=this._ws)==null||e.send(s)}beginListen(e,i){return this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(i),i}stopListening(e,i){return this.stopListen(e,i)}stopListen(e,i){if(!i||!this._listeners[e])return;const s=this._listeners[e].indexOf(i);s>=0&&this._listeners[e].splice(s,1)}beginListenBinary(e,i){return this._listenersBinary[e]||(this._listenersBinary[e]=[]),this._listenersBinary[e].push(i),i}stopListenBinary(e,i){if(!this._listenersBinary[e])return;const s=this._listenersBinary[e].indexOf(i);s>=0&&this._listenersBinary[e].splice(s,1)}registerProvider(e){this.netWebSocketUrlProvider=e}async connect(e){var i;if(this.connected&&e&&e!==zl)return Promise.reject("Can not connect to different server url. Please disconnect first.");if(this.connected)return Promise.resolve(!0);e&&console.debug("Connecting to user provided url "+e);const s=e||((i=this.netWebSocketUrlProvider)==null?void 0:i.getWebsocketUrl());return s?zl=s:o6()&&(zl="wss://"+window.location.host+"/socket"),this.connectWebsocket()}disconnect(){var e;(e=this._ws)==null||e.close(),this._ws=void 0,zl=void 0}connectWebsocket(){return this._connectingToWebsocketPromise?this._connectingToWebsocketPromise:this._connectingToWebsocketPromise=new Promise(async(e,i)=>{var s,r;let o=!1;const a=u=>{o||(o=!0,e(u))};if(zl===void 0&&(console.log("Fetch default backend url: "+Dee),zl=await(await fetch(Dee)).text()),zl===void 0){a(!1);return}console.debug(`\u22A1 Connecting to networking backend on
`+zl);const l=await Promise.resolve().then(()=>HOe),c=((s=l.default)==null?void 0:s.WebsocketBuilder)??l.WebsocketBuilder,h=((r=l.default)==null?void 0:r.ExponentialBackoff)??l.ExponentialBackoff,d=new c(zl).withMaxRetries(10).withBackoff(new h(2e3,4)).onOpen(()=>{this._connectingToWebsocketPromise=null,this._ws=d,this.connected=!0,Je()||rl?console.log(`\u229E Connected to networking backend
`+zl):console.debug("\u229E Connected to networking backend",zl),a(!0),this.onSendQueued(Bh.OnConnection)}).onClose(u=>{this._connectingToWebsocketPromise=null,this.connected=!1,this._isInRoom=!1,a(!1);let p="Websocket connection closed...";zl!=null&&zl.includes("/socket")||(p+=' Do you perhaps mean to connect to "/socket"?'),console.error(p)}).onError(u=>{console.error("\u22A0 Websocket connection failed..."),a(!1)}).onRetry(()=>{console.log("\u2192 Retry connecting to networking websocket")}).build();d.addEventListener(l.WebsocketEvent.message,(u,p)=>{this.onMessage(u,p)})})}onMessage(e,i){const s=i.data;try{if(typeof s!="string"){s.size&&this.handleIncomingBinaryMessage(s);return}const r=JSON.parse(s);if(Array.isArray(r))for(const o of r)this.handleIncomingStringMessage(o);else this.handleIncomingStringMessage(r);return}catch(r){rl&&s==="pong"?console.log("<<",s):Je()&&console.error("Failed to parse message",r)}}async handleIncomingBinaryMessage(e){mz&&console.log("<< bin",this.context.time.frame);const i=await e.arrayBuffer();var s=new Uint8Array(i);const r=new q_(s),o=r.getBufferIdentifier(),a=this._listenersBinary[o],l=w$(r),c=C$(l);if(c&&typeof c=="string"&&(this._state[c]=l),!a)return;const h=l??r;for(const d of a)d(h)}handleIncomingStringMessage(e){var i,s;if(rl&&console.log("<<",e.key??e),e.key)switch(e.key){case"connection-start-info":if(e.data){const l=e.data;l&&(console.assert(l.id!==void 0&&l.id!==null&&l.id.length>0,"server did not send connection id",l.id),console.debug("Your id is: "+l.id,this.context.alias??""),this._connectionId=l.id)}else console.warn("Expected connection id in "+e.key);break;case"joined-room":if(rl&&console.log(e),e){this._isInRoom=!0;const l=e;this._currentRoomName=l.room,this._currentRoomViewId=l.viewId,this._currentRoomAllowEditing=l.allowEditing??!0,this._currentInRoom.length=0,this._currentInRoom.push(...l.inRoom),(mz||Je())&&console.debug("Joined Needle Engine Room: "+l.room);const c=new URL(window.location.href);c.searchParams.has("room")&&c.searchParams.delete("room"),c.searchParams.set("view",this._currentRoomViewId),console.debug(`Room view id: ${this._currentRoomViewId}
${c.href}`)}this.onSendQueued(Bh.OnRoomJoin);break;case"left-room":e.room===this.currentRoomName&&(this._isInRoom=!1,this._currentRoomName=null,this._currentInRoom.length=0);break;case"user-joined-room":if(e.data){const l=e.data;this._currentInRoom.push(l.userId),rl&&console.log(l.userId+" joined","now in room:",this._currentInRoom)}break;case"user-left-room":if(e.data){const l=e.data,c=this._currentInRoom.indexOf(l.userId);c>=0&&(rl&&console.log(l.userId+" left","now in room:",this._currentInRoom),this._currentInRoom.splice(c,1)),l.userId===this.connectionId&&console.log("you left the room")}break;case"all-room-state-deleted":rl&&console.log("RECEIVED all-room-state-deleted"),this._state={};break;case"ping":case"pong":const a=(i=e.data)==null?void 0:i.time;a&&(this._currentDelay=this.context.time.time-a),rl&&console.log("Current latency: "+this._currentDelay.toFixed(4)+" sec","Clients in room: "+((s=this._currentInRoom)==null?void 0:s.length));break}const r=e.data;r&&(this._state[r.guid]=r);let o=this._listeners[e.key];if(o){o=[...o];for(const a of o)try{a(e.data)}catch(l){console.error('Error invoking callback for "'+e.key+'"',l)}}}toMessage(e,i){return{key:e,data:i}}sendWithWebsocket(e,i,s=Bh.OnRoomJoin){if(!this._ws){const o=this._waitingForSocket[s]||[];o.push(()=>this.sendWithWebsocket(e,i,s)),this._waitingForSocket[s]=o;return}const r=JSON.stringify(this.toMessage(e,i));rl&&console.log(">>",e),this._ws.send(r)}onSendQueued(e){const i=this._waitingForSocket[e];if(i){for(const s of i)s();i.length=0}}}const gC=q("debugwebxr");class fz{constructor(e,i){m(this,"controllerStates",[]),m(this,"userId"),m(this,"context"),m(this,"userStateEvtName"),m(this,"onReceivedControllerState",s=>{gC&&console.log(`XRSync: Received change for ${this.userId}: ${s.type} ${s.handedness}; tracked=${s.isTracking}`);let r=!1;for(let o=0;o<this.controllerStates.length;o++)if(this.controllerStates[o].index===s.index){this.controllerStates[o]=s,r=!0;break}r||this.controllerStates.push(s)}),this.userId=e,this.context=i,this.userStateEvtName="xr-sync-user-state-"+e,this.context.connection.beginListen(this.userStateEvtName,this.onReceivedControllerState)}dispose(){this.context.connection.stopListen(this.userStateEvtName,this.onReceivedControllerState)}update(e){if(this.context.connection.isConnected!=!1){for(let i=this.controllerStates.length-1;i>=0;i--){const s=this.controllerStates[i];let r=!1;for(let o=0;o<e.controllers.length;o++)e.controllers[o].index===s.index&&(r=!0);r||(gC&&console.log(`XRSync: ${s.type} ${s.handedness} removed`,s.index),this.controllerStates.splice(i,1),this.sendControllerRemoved(s))}for(const i of e.controllers)this.updateControllerStates(i)}}onExitXR(e){for(const i of this.controllerStates)this.sendControllerRemoved(i);this.controllerStates.length=0}sendControllerRemoved(e){e.isTracking=!1,e.guid="",this.context.connection.send(this.userStateEvtName,e),this.context.connection.sendDeleteRemoteState(e.guid)}updateControllerStates(e){const i=this.controllerStates.find(s=>s.index===e.index);if(i){let s=!1;s||(s=i.isTracking!=e.isTracking),s&&(i.isTracking=e.isTracking,this.context.connection.send(this.userStateEvtName,i))}else{const s={guid:this.userId+"-"+e.index,isTracking:e.isTracking,handedness:e.side,index:e.index,type:e.hand?"hand":"controller"};this.controllerStates.push(s),this.context.connection.send(this.userStateEvtName,s),gC&&console.log(`XRSync: ${s.type} ${s.handedness} added`,s.index)}}}class Oee{constructor(e){m(this,"context"),m(this,"onJoinedRoom",()=>{if(this.context.connection.connectionId){this._states.has(this.context.connection.connectionId)||(gC&&console.log("XRSync: Local user joined room",this.context.connection.connectionId),this._states.set(this.context.connection.connectionId,new fz(this.context.connection.connectionId,this.context)));for(const i of this.context.connection.usersInRoom())this._states.has(i)||this._states.set(i,new fz(i,this.context))}}),m(this,"onLeftRoom",()=>{if(this.context.connection.connectionId&&!this._states.has(this.context.connection.connectionId)){const i=this._states.get(this.context.connection.connectionId);i?.dispose(),this._states.delete(this.context.connection.connectionId)}}),m(this,"onOtherUserJoinedRoom",i=>{const s=i.userId;this._states.has(s)||(gC&&console.log("XRSync: Remote user joined room",s),this._states.set(s,new fz(s,this.context)))}),m(this,"onOtherUserLeftRoom",i=>{const s=i.userId;if(!this._states.has(s)){const r=this._states.get(s);r?.dispose(),this._states.delete(s)}}),m(this,"_states",new Map),this.context=e,this.context.connection.beginListen(pi.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(pi.LeftRoom,this.onLeftRoom),this.context.connection.beginListen(pi.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.beginListen(pi.UserLeftRoom,this.onOtherUserLeftRoom)}hasState(e){return e?this._states.has(e):!1}isTracking(e,i){if(!e)return;const s=this._states.get(e);if(!s)return;const r=s.controllerStates.find(o=>o.handedness===i);return r?.isTracking||!1}getDeviceType(e,i){if(!e)return;const s=this._states.get(e);if(!s)return;const r=s.controllerStates.find(o=>o.handedness===i);return r?.type||"unknown"}destroy(){this.context.connection.stopListen(pi.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(pi.LeftRoom,this.onLeftRoom),this.context.connection.stopListen(pi.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.stopListen(pi.UserLeftRoom,this.onOtherUserLeftRoom)}onUpdate(e){if(this.context.connection.isConnected&&this.context.connection.connectionId){const i=this._states.get(this.context.connection.connectionId);i?.update(e)}}onExitXR(e){if(this.context.connection.isConnected&&this.context.connection.connectionId){const i=this._states.get(this.context.connection.connectionId);i?.onExitXR(e)}}}class Zee{constructor(){m(this,"_fadeToColorQuad"),m(this,"_fadeToColorMaterial"),m(this,"_requestedFadeValue",0),m(this,"_transitionPromise",null),m(this,"_transitionResolve",null),this._fadeToColorMaterial=new ai({color:0,transparent:!0,depthTest:!1,fog:!1,side:Qi}),this._fadeToColorQuad=new pe(new Xs(10,10),this._fadeToColorMaterial)}dispose(){this._fadeToColorQuad.geometry.dispose(),this._fadeToColorMaterial.dispose()}update(e,i){const s=this._fadeToColorQuad,r=this._fadeToColorMaterial;s.parent!==e&&r.opacity>0?e.add(s):r.opacity===0&&s.removeFromParent(),s.layers.set(2),s.material=this._fadeToColorMaterial,s.position.z=-1,s.renderOrder=1/0;const o=this._requestedFadeValue;r.opacity=lt.lerp(r.opacity,o,i/.03),Math.abs(r.opacity-o)<=.01&&this._transitionResolve&&(this._transitionResolve(),this._transitionResolve=null,this._transitionPromise=null,this._requestedFadeValue=0)}remove(){this._fadeToColorQuad.removeFromParent()}fadeTransition(){if(this._transitionPromise)return this._transitionPromise;this._requestedFadeValue=1;const e=new Promise(i=>{this._transitionResolve=i});return this._transitionPromise=e,e}}class ILe extends wx{constructor(e,i={}){const s=i.font;if(s===void 0)super();else{const r=s.generateShapes(e,i.size);i.depth===void 0&&i.height!==void 0&&console.warn("THREE.TextGeometry: .height is now depreciated. Please use .depth instead"),i.depth=i.depth!==void 0?i.depth:i.height!==void 0?i.height:50,i.bevelThickness===void 0&&(i.bevelThickness=10),i.bevelSize===void 0&&(i.bevelSize=8),i.bevelEnabled===void 0&&(i.bevelEnabled=!1),super(r,i)}this.type="TextGeometry"}}class TLe extends fs{constructor(e){super(e)}load(e,i,s,r){const o=this,a=new Rs(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){const c=o.parse(JSON.parse(l));i&&i(c)},s,r)}parse(e){return new Wee(e)}}class Wee{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,i=100){const s=[],r=ELe(e,i,this.data);for(let o=0,a=r.length;o<a;o++)s.push(...r[o].toShapes());return s}}function ELe(n,e,i){const s=Array.from(n),r=e/i.resolution,o=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*r,a=[];let l=0,c=0;for(let h=0;h<s.length;h++){const d=s[h];if(d===`
`)l=0,c-=o;else{const u=RLe(d,r,l,c,i);l+=u.offsetX,a.push(u.path)}}return a}function RLe(n,e,i,s,r){const o=r.glyphs[n]||r.glyphs["?"];if(!o){console.error('THREE.Font: character "'+n+'" does not exists in font family '+r.familyName+".");return}const a=new eQ;let l,c,h,d,u,p,g,f;if(o.o){const A=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let y=0,b=A.length;y<b;)switch(A[y++]){case"m":l=A[y++]*e+i,c=A[y++]*e+s,a.moveTo(l,c);break;case"l":l=A[y++]*e+i,c=A[y++]*e+s,a.lineTo(l,c);break;case"q":h=A[y++]*e+i,d=A[y++]*e+s,u=A[y++]*e+i,p=A[y++]*e+s,a.quadraticCurveTo(u,p,h,d);break;case"b":h=A[y++]*e+i,d=A[y++]*e+s,u=A[y++]*e+i,p=A[y++]*e+s,g=A[y++]*e+i,f=A[y++]*e+s,a.bezierCurveTo(u,p,g,f,h,d);break}}return{offsetX:o.ha*e,path:a}}function LLe(n,e=1e-4){e=Math.max(e,Number.EPSILON);const i={},s=n.getIndex(),r=n.getAttribute("position"),o=s?s.count:r.count;let a=0;const l=Object.keys(n.attributes),c={},h={},d=[],u=["getX","getY","getZ","getW"],p=["setX","setY","setZ","setW"];for(let v=0,x=l.length;v<x;v++){const w=l[v],C=n.attributes[w];c[w]=new C.constructor(new C.array.constructor(C.count*C.itemSize),C.itemSize,C.normalized);const S=n.morphAttributes[w];S&&(h[w]||(h[w]=[]),S.forEach((_,I)=>{const B=new _.array.constructor(_.count*_.itemSize);h[w][I]=new _.constructor(B,_.itemSize,_.normalized)}))}const g=e*.5,f=Math.log10(1/e),A=Math.pow(10,f),y=g*A;for(let v=0;v<o;v++){const x=s?s.getX(v):v;let w="";for(let C=0,S=l.length;C<S;C++){const _=l[C],I=n.getAttribute(_),B=I.itemSize;for(let M=0;M<B;M++)w+=`${~~(I[u[M]](x)*A+y)},`}if(w in i)d.push(i[w]);else{for(let C=0,S=l.length;C<S;C++){const _=l[C],I=n.getAttribute(_),B=n.morphAttributes[_],M=I.itemSize,R=c[_],k=h[_];for(let G=0;G<M;G++){const X=u[G],F=p[G];if(R[F](a,I[X](x)),B)for(let z=0,H=B.length;z<H;z++)k[z][F](a,B[z][X](x))}}i[w]=a,d.push(a),a++}}const b=n.clone();for(const v in n.attributes){const x=c[v];if(b.setAttribute(v,new x.constructor(x.array.slice(0,a*x.itemSize),x.itemSize,x.normalized)),v in h)for(let w=0;w<h[v].length;w++){const C=h[v][w];b.morphAttributes[v][w]=new C.constructor(C.array.slice(0,a*C.itemSize),C.itemSize,C.normalized)}}return b.setIndex(d),b}function Hee(n,e){if(e===fW)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===hI||e===bG){let i=n.getIndex();if(i===null){const a=[],l=n.getAttribute("position");if(l!==void 0){for(let c=0;c<l.count;c++)a.push(c);n.setIndex(a),i=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const s=i.count-2,r=[];if(e===hI)for(let a=1;a<=s;a++)r.push(i.getX(0)),r.push(i.getX(a)),r.push(i.getX(a+1));else for(let a=0;a<s;a++)a%2===0?(r.push(i.getX(a)),r.push(i.getX(a+1)),r.push(i.getX(a+2))):(r.push(i.getX(a+2)),r.push(i.getX(a+1)),r.push(i.getX(a)));r.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=n.clone();return o.setIndex(r),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}class ip extends fs{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new NLe(i)}),this.register(function(i){return new VLe(i)}),this.register(function(i){return new HLe(i)}),this.register(function(i){return new QLe(i)}),this.register(function(i){return new KLe(i)}),this.register(function(i){return new DLe(i)}),this.register(function(i){return new zLe(i)}),this.register(function(i){return new FLe(i)}),this.register(function(i){return new ULe(i)}),this.register(function(i){return new PLe(i)}),this.register(function(i){return new OLe(i)}),this.register(function(i){return new XLe(i)}),this.register(function(i){return new WLe(i)}),this.register(function(i){return new ZLe(i)}),this.register(function(i){return new kLe(i)}),this.register(function(i){return new YLe(i)}),this.register(function(i){return new jLe(i)})}load(e,i,s,r){const o=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const h=cd.extractUrlBase(e);a=cd.resolveURL(h,this.path)}else a=cd.extractUrlBase(e);this.manager.itemStart(e);const l=function(h){r?r(h):console.error(h),o.manager.itemError(e),o.manager.itemEnd(e)},c=new Rs(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(h){try{o.parse(h,a,function(d){i(d),o.manager.itemEnd(e)},l)}catch(d){l(d)}},s,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,r){let o;const a={},l={},c=new TextDecoder;if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===Qee){try{a[Pi.KHR_BINARY_GLTF]=new JLe(e)}catch(d){r&&r(d);return}o=JSON.parse(a[Pi.KHR_BINARY_GLTF].content)}else o=JSON.parse(c.decode(e));else o=e;if(o.asset===void 0||o.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const h=new hBe(o,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const u=this.pluginCallbacks[d](h);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),l[u.name]=u,a[u.name]=!0}if(o.extensionsUsed)for(let d=0;d<o.extensionsUsed.length;++d){const u=o.extensionsUsed[d],p=o.extensionsRequired||[];switch(u){case Pi.KHR_MATERIALS_UNLIT:a[u]=new GLe;break;case Pi.KHR_DRACO_MESH_COMPRESSION:a[u]=new qLe(o,this.dracoLoader);break;case Pi.KHR_TEXTURE_TRANSFORM:a[u]=new $Le;break;case Pi.KHR_MESH_QUANTIZATION:a[u]=new eBe;break;default:p.indexOf(u)>=0&&l[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}h.setExtensions(a),h.setPlugins(l),h.parse(s,r)}parseAsync(e,i){const s=this;return new Promise(function(r,o){s.parse(e,i,r,o)})}}function BLe(){let n={};return{get:function(e){return n[e]},add:function(e,i){n[e]=i},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const Pi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class kLe{constructor(e){this.parser=e,this.name=Pi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,i=this.parser.json.nodes||[];for(let s=0,r=i.length;s<r;s++){const o=i[s];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const i=this.parser,s="light:"+e;let r=i.cache.get(s);if(r)return r;const o=i.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let l;const c=new fe(16777215);a.color!==void 0&&c.setRGB(a.color[0],a.color[1],a.color[2],qi);const h=a.range!==void 0?a.range:0;switch(a.type){case"directional":l=new um(c),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new dm(c),l.distance=h;break;case"spot":l=new Gf(c),l.distance=h,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,l.angle=a.spot.outerConeAngle,l.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return l.position.set(0,0,0),l.decay=2,np(l,a),a.intensity!==void 0&&(l.intensity=a.intensity),l.name=i.createUniqueName(a.name||"light_"+e),r=Promise.resolve(l),i.cache.add(s,r),r}getDependency(e,i){if(e==="light")return this._loadLight(i)}createNodeAttachment(e){const i=this,s=this.parser,r=s.json.nodes[e],o=(r.extensions&&r.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(a){return s._getNodeRef(i.cache,o,a)})}}let GLe=class{constructor(){this.name=Pi.KHR_MATERIALS_UNLIT}getMaterialType(){return ai}extendParams(n,e,i){const s=[];n.color=new fe(1,1,1),n.opacity=1;const r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;n.color.setRGB(o[0],o[1],o[2],qi),n.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(i.assignTexture(n,"map",r.baseColorTexture,ut))}return Promise.all(s)}},PLe=class{constructor(n){this.parser=n,this.name=Pi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(n,e){const i=this.parser.json.materials[n];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(e.emissiveIntensity=s),Promise.resolve()}},NLe=class{constructor(n){this.parser=n,this.name=Pi.KHR_MATERIALS_CLEARCOAT}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uo}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(e.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Q(a,a)}return Promise.all(r)}},VLe=class{constructor(n){this.parser=n,this.name=Pi.KHR_MATERIALS_DISPERSION}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uo}extendMaterialParams(n,e){const i=this.parser.json.materials[n];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return e.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}},XLe=class{constructor(n){this.parser=n,this.name=Pi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uo}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(e.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(e,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(e.iridescenceIOR=o.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(e,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}},DLe=class{constructor(n){this.parser=n,this.name=Pi.KHR_MATERIALS_SHEEN}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uo}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];e.sheenColor=new fe(0,0,0),e.sheenRoughness=0,e.sheen=1;const o=s.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;e.sheenColor.setRGB(a[0],a[1],a[2],qi)}return o.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(e,"sheenColorMap",o.sheenColorTexture,ut)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(e,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}},zLe=class{constructor(n){this.parser=n,this.name=Pi.KHR_MATERIALS_TRANSMISSION}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uo}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(e.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(r)}},FLe=class{constructor(n){this.parser=n,this.name=Pi.KHR_MATERIALS_VOLUME}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uo}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];e.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return e.attenuationColor=new fe().setRGB(a[0],a[1],a[2],qi),Promise.all(r)}},ULe=class{constructor(n){this.parser=n,this.name=Pi.KHR_MATERIALS_IOR}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uo}extendMaterialParams(n,e){const i=this.parser.json.materials[n];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return e.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}},OLe=class{constructor(n){this.parser=n,this.name=Pi.KHR_MATERIALS_SPECULAR}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uo}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];e.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(e,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return e.specularColor=new fe().setRGB(a[0],a[1],a[2],qi),o.specularColorTexture!==void 0&&r.push(i.assignTexture(e,"specularColorMap",o.specularColorTexture,ut)),Promise.all(r)}},ZLe=class{constructor(n){this.parser=n,this.name=Pi.EXT_MATERIALS_BUMP}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uo}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return e.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(i.assignTexture(e,"bumpMap",o.bumpTexture)),Promise.all(r)}},WLe=class{constructor(n){this.parser=n,this.name=Pi.KHR_MATERIALS_ANISOTROPY}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:uo}extendMaterialParams(n,e){const i=this.parser,s=i.json.materials[n];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(e.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(e.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(e,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}};class HLe{constructor(e){this.parser=e,this.name=Pi.KHR_TEXTURE_BASISU}loadTexture(e){const i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const o=r.extensions[this.name],a=i.options.ktx2Loader;if(!a){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(e,o.source,a)}}class QLe{constructor(e){this.parser=e,this.name=Pi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const i=this.name,s=this.parser,r=s.json,o=r.textures[e];if(!o.extensions||!o.extensions[i])return null;const a=o.extensions[i],l=r.images[a.source];let c=s.textureLoader;if(l.uri){const h=s.options.manager.getHandler(l.uri);h!==null&&(c=h)}return this.detectSupport().then(function(h){if(h)return s.loadTextureImage(e,a.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class KLe{constructor(e){this.parser=e,this.name=Pi.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const i=this.name,s=this.parser,r=s.json,o=r.textures[e];if(!o.extensions||!o.extensions[i])return null;const a=o.extensions[i],l=r.images[a.source];let c=s.textureLoader;if(l.uri){const h=s.options.manager.getHandler(l.uri);h!==null&&(c=h)}return this.detectSupport().then(function(h){if(h)return s.loadTextureImage(e,a.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class YLe{constructor(e){this.name=Pi.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const i=this.parser.json,s=i.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const r=s.extensions[this.name],o=this.parser.getDependency("buffer",r.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(l){const c=r.byteOffset||0,h=r.byteLength||0,d=r.count,u=r.byteStride,p=new Uint8Array(l,c,h);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(d,u,p,r.mode,r.filter).then(function(g){return g.buffer}):a.ready.then(function(){const g=new ArrayBuffer(d*u);return a.decodeGltfBuffer(new Uint8Array(g),d,u,p,r.mode,r.filter),g})})}else return null}}let jLe=class{constructor(n){this.name=Pi.EXT_MESH_GPU_INSTANCING,this.parser=n}createNodeMesh(n){const e=this.parser.json,i=e.nodes[n];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=e.meshes[i.mesh];for(const l of s.primitives)if(l.mode!==Gc.TRIANGLES&&l.mode!==Gc.TRIANGLE_STRIP&&l.mode!==Gc.TRIANGLE_FAN&&l.mode!==void 0)return null;const r=i.extensions[this.name].attributes,o=[],a={};for(const l in r)o.push(this.parser.getDependency("accessor",r[l]).then(c=>(a[l]=c,a[l])));return o.length<1?null:(o.push(this.parser.createNodeMesh(n)),Promise.all(o).then(l=>{const c=l.pop(),h=c.isGroup?c.children:[c],d=l[0].count,u=[];for(const p of h){const g=new de,f=new E,A=new Fe,y=new E(1,1,1),b=new dP(p.geometry,p.material,d);for(let v=0;v<d;v++)a.TRANSLATION&&f.fromBufferAttribute(a.TRANSLATION,v),a.ROTATION&&A.fromBufferAttribute(a.ROTATION,v),a.SCALE&&y.fromBufferAttribute(a.SCALE,v),b.setMatrixAt(v,g.compose(f,A,y));for(const v in a)if(v==="_COLOR_0"){const x=a[v];b.instanceColor=new Yo(x.array,x.itemSize,x.normalized)}else v!=="TRANSLATION"&&v!=="ROTATION"&&v!=="SCALE"&&p.geometry.setAttribute(v,a[v]);Ae.prototype.copy.call(b,p),this.parser.assignFinalMaterial(b),u.push(b)}return c.isGroup?(c.clear(),c.add(...u),c):u[0]}))}};const Qee="glTF",fC=12,Kee={JSON:1313821514,BIN:5130562};class JLe{constructor(e){this.name=Pi.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(e,0,fC),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==Qee)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-fC,o=new DataView(e,fC);let a=0;for(;a<r;){const l=o.getUint32(a,!0);a+=4;const c=o.getUint32(a,!0);if(a+=4,c===Kee.JSON){const h=new Uint8Array(e,fC+a,l);this.content=s.decode(h)}else if(c===Kee.BIN){const h=fC+a;this.body=e.slice(h,h+l)}a+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class qLe{constructor(e,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Pi.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(e,i){const s=this.json,r=this.dracoLoader,o=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,l={},c={},h={};for(const d in a){const u=yz[d]||d.toLowerCase();l[u]=a[d]}for(const d in e.attributes){const u=yz[d]||d.toLowerCase();if(a[d]!==void 0){const p=s.accessors[e.attributes[d]],g=zb[p.componentType];h[u]=g.name,c[u]=p.normalized===!0}}return i.getDependency("bufferView",o).then(function(d){return new Promise(function(u,p){r.decodeDracoFile(d,function(g){for(const f in g.attributes){const A=g.attributes[f],y=c[f];y!==void 0&&(A.normalized=y)}u(g)},l,h,qi,p)})})}}class $Le{constructor(){this.name=Pi.KHR_TEXTURE_TRANSFORM}extendTexture(e,i){return(i.texCoord===void 0||i.texCoord===e.channel)&&i.offset===void 0&&i.rotation===void 0&&i.scale===void 0||(e=e.clone(),i.texCoord!==void 0&&(e.channel=i.texCoord),i.offset!==void 0&&e.offset.fromArray(i.offset),i.rotation!==void 0&&(e.rotation=i.rotation),i.scale!==void 0&&e.repeat.fromArray(i.scale),e.needsUpdate=!0),e}}class eBe{constructor(){this.name=Pi.KHR_MESH_QUANTIZATION}}class Yee extends Ly{constructor(e,i,s,r){super(e,i,s,r)}copySampleValue_(e){const i=this.resultBuffer,s=this.sampleValues,r=this.valueSize,o=e*r*3+r;for(let a=0;a!==r;a++)i[a]=s[o+a];return i}interpolate_(e,i,s,r){const o=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=l*2,h=l*3,d=r-i,u=(s-i)/d,p=u*u,g=p*u,f=e*h,A=f-h,y=-2*g+3*p,b=g-p,v=1-y,x=b-p+u;for(let w=0;w!==l;w++){const C=a[A+w+l],S=a[A+w+c]*d,_=a[f+w+l],I=a[f+w]*d;o[w]=v*C+x*S+y*_+b*I}return o}}const tBe=new Fe;class iBe extends Yee{interpolate_(e,i,s,r){const o=super.interpolate_(e,i,s,r);return tBe.fromArray(o).normalize().toArray(o),o}}const Gc={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},zb={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},jee={9728:si,9729:Wt,9984:Rx,9985:vu,9986:id,9987:Ar},Jee={33071:Wo,33648:bu,10497:lo},Az={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},yz={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Km={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},nBe={CUBICSPLINE:void 0,LINEAR:xu,STEP:qp},bz={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function sBe(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new Us({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ms})),n.DefaultMaterial}function _0(n,e,i){for(const s in i.extensions)n[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=i.extensions[s])}function np(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function rBe(n,e,i){let s=!1,r=!1,o=!1;for(let h=0,d=e.length;h<d;h++){const u=e[h];if(u.POSITION!==void 0&&(s=!0),u.NORMAL!==void 0&&(r=!0),u.COLOR_0!==void 0&&(o=!0),s&&r&&o)break}if(!s&&!r&&!o)return Promise.resolve(n);const a=[],l=[],c=[];for(let h=0,d=e.length;h<d;h++){const u=e[h];if(s){const p=u.POSITION!==void 0?i.getDependency("accessor",u.POSITION):n.attributes.position;a.push(p)}if(r){const p=u.NORMAL!==void 0?i.getDependency("accessor",u.NORMAL):n.attributes.normal;l.push(p)}if(o){const p=u.COLOR_0!==void 0?i.getDependency("accessor",u.COLOR_0):n.attributes.color;c.push(p)}}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(h){const d=h[0],u=h[1],p=h[2];return s&&(n.morphAttributes.position=d),r&&(n.morphAttributes.normal=u),o&&(n.morphAttributes.color=p),n.morphTargetsRelative=!0,n})}function oBe(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let i=0,s=e.weights.length;i<s;i++)n.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(n.morphTargetInfluences.length===i.length){n.morphTargetDictionary={};for(let s=0,r=i.length;s<r;s++)n.morphTargetDictionary[i[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function aBe(n){let e;const i=n.extensions&&n.extensions[Pi.KHR_DRACO_MESH_COMPRESSION];if(i?e="draco:"+i.bufferView+":"+i.indices+":"+vz(i.attributes):e=n.indices+":"+vz(n.attributes)+":"+n.mode,n.targets!==void 0)for(let s=0,r=n.targets.length;s<r;s++)e+=":"+vz(n.targets[s]);return e}function vz(n){let e="";const i=Object.keys(n).sort();for(let s=0,r=i.length;s<r;s++)e+=i[s]+":"+n[i[s]]+";";return e}function xz(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function lBe(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const cBe=new de;class hBe{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new BLe,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,r=-1,o=!1,a=-1;if(typeof navigator<"u"){const l=navigator.userAgent;s=/^((?!chrome|android).)*safari/i.test(l)===!0;const c=l.match(/Version\/(\d+)/);r=s&&c?parseInt(c[1],10):-1,o=l.indexOf("Firefox")>-1,a=o?l.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||s&&r<17||o&&a<98?this.textureLoader=new hh(this.options.manager):this.textureLoader=new RH(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Rs(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,i){const s=this,r=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(a){const l={scene:a[0][r.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:r.asset,parser:s,userData:{}};return _0(o,l,r),np(l,r),Promise.all(s._invokeAll(function(c){return c.afterRoot&&c.afterRoot(l)})).then(function(){for(const c of l.scenes)c.updateMatrixWorld();e(l)})}).catch(i)}_markDefs(){const e=this.json.nodes||[],i=this.json.skins||[],s=this.json.meshes||[];for(let r=0,o=i.length;r<o;r++){const a=i[r].joints;for(let l=0,c=a.length;l<c;l++)e[a[l]].isBone=!0}for(let r=0,o=e.length;r<o;r++){const a=e[r];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(s[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,i){i!==void 0&&(e.refs[i]===void 0&&(e.refs[i]=e.uses[i]=0),e.refs[i]++)}_getNodeRef(e,i,s){if(e.refs[i]<=1)return s;const r=s.clone(),o=(a,l)=>{const c=this.associations.get(a);c!=null&&this.associations.set(l,c);for(const[h,d]of a.children.entries())o(d,l.children[h])};return o(s,r),r.name+="_instance_"+e.uses[i]++,r}_invokeOne(e){const i=Object.values(this.plugins);i.push(this);for(let s=0;s<i.length;s++){const r=e(i[s]);if(r)return r}return null}_invokeAll(e){const i=Object.values(this.plugins);i.unshift(this);const s=[];for(let r=0;r<i.length;r++){const o=e(i[r]);o&&s.push(o)}return s}getDependency(e,i){const s=e+":"+i;let r=this.cache.get(s);if(!r){switch(e){case"scene":r=this.loadScene(i);break;case"node":r=this._invokeOne(function(o){return o.loadNode&&o.loadNode(i)});break;case"mesh":r=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(i)});break;case"accessor":r=this.loadAccessor(i);break;case"bufferView":r=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(i)});break;case"buffer":r=this.loadBuffer(i);break;case"material":r=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(i)});break;case"texture":r=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(i)});break;case"skin":r=this.loadSkin(i);break;case"animation":r=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(i)});break;case"camera":r=this.loadCamera(i);break;default:if(r=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,i)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(s,r)}return r}getDependencies(e){let i=this.cache.get(e);if(!i){const s=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];i=Promise.all(r.map(function(o,a){return s.getDependency(e,a)})),this.cache.add(e,i)}return i}loadBuffer(e){const i=this.json.buffers[e],s=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&e===0)return Promise.resolve(this.extensions[Pi.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(o,a){s.load(cd.resolveURL(i.uri,r.path),o,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(e){const i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(s){const r=i.byteLength||0,o=i.byteOffset||0;return s.slice(o,o+r)})}loadAccessor(e){const i=this,s=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const a=Az[r.type],l=zb[r.componentType],c=r.normalized===!0,h=new l(r.count*a);return Promise.resolve(new ct(h,a,c))}const o=[];return r.bufferView!==void 0?o.push(this.getDependency("bufferView",r.bufferView)):o.push(null),r.sparse!==void 0&&(o.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(o).then(function(a){const l=a[0],c=Az[r.type],h=zb[r.componentType],d=h.BYTES_PER_ELEMENT,u=d*c,p=r.byteOffset||0,g=r.bufferView!==void 0?s.bufferViews[r.bufferView].byteStride:void 0,f=r.normalized===!0;let A,y;if(g&&g!==u){const b=Math.floor(p/g),v="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+b+":"+r.count;let x=i.cache.get(v);x||(A=new h(l,b*g,r.count*g/d),x=new Cy(A,g/d),i.cache.add(v,x)),y=new xa(x,c,p%g/d,f)}else l===null?A=new h(r.count*c):A=new h(l,p,r.count*c),y=new ct(A,c,f);if(r.sparse!==void 0){const b=Az.SCALAR,v=zb[r.sparse.indices.componentType],x=r.sparse.indices.byteOffset||0,w=r.sparse.values.byteOffset||0,C=new v(a[1],x,r.sparse.count*b),S=new h(a[2],w,r.sparse.count*c);l!==null&&(y=new ct(y.array.slice(),y.itemSize,y.normalized)),y.normalized=!1;for(let _=0,I=C.length;_<I;_++){const B=C[_];if(y.setX(B,S[_*c]),c>=2&&y.setY(B,S[_*c+1]),c>=3&&y.setZ(B,S[_*c+2]),c>=4&&y.setW(B,S[_*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}y.normalized=f}return y})}loadTexture(e){const i=this.json,s=this.options,r=i.textures[e].source,o=i.images[r];let a=this.textureLoader;if(o.uri){const l=s.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,i,s){const r=this,o=this.json,a=o.textures[e],l=o.images[i],c=(l.uri||l.bufferView)+":"+a.sampler;if(this.textureCache[c])return this.textureCache[c];const h=this.loadImageSource(i,s).then(function(d){d.flipY=!1,d.name=a.name||l.name||"",d.name===""&&typeof l.uri=="string"&&l.uri.startsWith("data:image/")===!1&&(d.name=l.uri);const u=(o.samplers||{})[a.sampler]||{};return d.magFilter=jee[u.magFilter]||Wt,d.minFilter=jee[u.minFilter]||Ar,d.wrapS=Jee[u.wrapS]||lo,d.wrapT=Jee[u.wrapT]||lo,d.anisotropy=4,r.associations.set(d,{textures:e}),d}).catch(function(){return null});return this.textureCache[c]=h,h}loadImageSource(e,i){const s=this,r=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const a=r.images[e],l=self.URL||self.webkitURL;let c=a.uri||"",h=!1;if(a.bufferView!==void 0)c=s.getDependency("bufferView",a.bufferView).then(function(u){h=!0;const p=new Blob([u],{type:a.mimeType});return c=l.createObjectURL(p),c});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(c).then(function(u){return new Promise(function(p,g){let f=p;i.isImageBitmapLoader===!0&&(f=function(A){const y=new di(A);y.needsUpdate=!0,p(y)}),i.load(cd.resolveURL(u,o.path),f,void 0,g)})}).then(function(u){return h===!0&&l.revokeObjectURL(c),np(u,a),u.userData.mimeType=a.mimeType||lBe(a.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),u});return this.sourceCache[e]=d,d}assignTexture(e,i,s,r){const o=this;return this.getDependency("texture",s.index).then(function(a){if(!a)return null;if(s.texCoord!==void 0&&s.texCoord>0&&(a=a.clone(),a.channel=s.texCoord),o.extensions[Pi.KHR_TEXTURE_TRANSFORM]){const l=s.extensions!==void 0?s.extensions[Pi.KHR_TEXTURE_TRANSFORM]:void 0;if(l){const c=o.associations.get(a);a=o.extensions[Pi.KHR_TEXTURE_TRANSFORM].extendTexture(a,l),o.associations.set(a,c)}}return r!==void 0&&(a.colorSpace=r),e[i]=a,a})}assignFinalMaterial(e){const i=e.geometry;let s=e.material;const r=i.attributes.tangent===void 0,o=i.attributes.color!==void 0,a=i.attributes.normal===void 0;if(e.isPoints){const l="PointsMaterial:"+s.uuid;let c=this.cache.get(l);c||(c=new rd,ti.prototype.copy.call(c,s),c.color.copy(s.color),c.map=s.map,c.sizeAttenuation=!1,this.cache.add(l,c)),s=c}else if(e.isLine){const l="LineBasicMaterial:"+s.uuid;let c=this.cache.get(l);c||(c=new Cn,ti.prototype.copy.call(c,s),c.color.copy(s.color),c.map=s.map,this.cache.add(l,c)),s=c}if(r||o||a){let l="ClonedMaterial:"+s.uuid+":";r&&(l+="derivative-tangents:"),o&&(l+="vertex-colors:"),a&&(l+="flat-shading:");let c=this.cache.get(l);c||(c=s.clone(),o&&(c.vertexColors=!0),a&&(c.flatShading=!0),r&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(l,c),this.associations.set(c,this.associations.get(s))),s=c}e.material=s}getMaterialType(){return Us}loadMaterial(e){const i=this,s=this.json,r=this.extensions,o=s.materials[e];let a;const l={},c=o.extensions||{},h=[];if(c[Pi.KHR_MATERIALS_UNLIT]){const u=r[Pi.KHR_MATERIALS_UNLIT];a=u.getMaterialType(),h.push(u.extendParams(l,o,i))}else{const u=o.pbrMetallicRoughness||{};if(l.color=new fe(1,1,1),l.opacity=1,Array.isArray(u.baseColorFactor)){const p=u.baseColorFactor;l.color.setRGB(p[0],p[1],p[2],qi),l.opacity=p[3]}u.baseColorTexture!==void 0&&h.push(i.assignTexture(l,"map",u.baseColorTexture,ut)),l.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,l.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(h.push(i.assignTexture(l,"metalnessMap",u.metallicRoughnessTexture)),h.push(i.assignTexture(l,"roughnessMap",u.metallicRoughnessTexture))),a=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(e,l)})))}o.doubleSided===!0&&(l.side=Qi);const d=o.alphaMode||bz.OPAQUE;if(d===bz.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,d===bz.MASK&&(l.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&a!==ai&&(h.push(i.assignTexture(l,"normalMap",o.normalTexture)),l.normalScale=new Q(1,1),o.normalTexture.scale!==void 0)){const u=o.normalTexture.scale;l.normalScale.set(u,u)}if(o.occlusionTexture!==void 0&&a!==ai&&(h.push(i.assignTexture(l,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&a!==ai){const u=o.emissiveFactor;l.emissive=new fe().setRGB(u[0],u[1],u[2],qi)}return o.emissiveTexture!==void 0&&a!==ai&&h.push(i.assignTexture(l,"emissiveMap",o.emissiveTexture,ut)),Promise.all(h).then(function(){const u=new a(l);return o.name&&(u.name=o.name),np(u,o),i.associations.set(u,{materials:e}),o.extensions&&_0(r,u,o),u})}createUniqueName(e){const i=xi.sanitizeNodeName(e||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(e){const i=this,s=this.extensions,r=this.primitiveCache;function o(l){return s[Pi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,i).then(function(c){return qee(c,l,i)})}const a=[];for(let l=0,c=e.length;l<c;l++){const h=e[l],d=aBe(h),u=r[d];if(u)a.push(u.promise);else{let p;h.extensions&&h.extensions[Pi.KHR_DRACO_MESH_COMPRESSION]?p=o(h):p=qee(new Rt,h,i),r[d]={primitive:h,promise:p},a.push(p)}}return Promise.all(a)}loadMesh(e){const i=this,s=this.json,r=this.extensions,o=s.meshes[e],a=o.primitives,l=[];for(let c=0,h=a.length;c<h;c++){const d=a[c].material===void 0?sBe(this.cache):this.getDependency("material",a[c].material);l.push(d)}return l.push(i.loadGeometries(a)),Promise.all(l).then(function(c){const h=c.slice(0,c.length-1),d=c[c.length-1],u=[];for(let g=0,f=d.length;g<f;g++){const A=d[g],y=a[g];let b;const v=h[g];if(y.mode===Gc.TRIANGLES||y.mode===Gc.TRIANGLE_STRIP||y.mode===Gc.TRIANGLE_FAN||y.mode===void 0)b=o.isSkinnedMesh===!0?new Ka(A,v):new pe(A,v),b.isSkinnedMesh===!0&&b.normalizeSkinWeights(),y.mode===Gc.TRIANGLE_STRIP?b.geometry=Hee(b.geometry,bG):y.mode===Gc.TRIANGLE_FAN&&(b.geometry=Hee(b.geometry,hI));else if(y.mode===Gc.LINES)b=new Jo(A,v);else if(y.mode===Gc.LINE_STRIP)b=new is(A,v);else if(y.mode===Gc.LINE_LOOP)b=new fP(A,v);else if(y.mode===Gc.POINTS)b=new Ey(A,v);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(b.geometry.morphAttributes).length>0&&oBe(b,o),b.name=i.createUniqueName(o.name||"mesh_"+e),np(b,o),y.extensions&&_0(r,b,y),i.assignFinalMaterial(b),u.push(b)}for(let g=0,f=u.length;g<f;g++)i.associations.set(u[g],{meshes:e,primitives:g});if(u.length===1)return o.extensions&&_0(r,u[0],o),u[0];const p=new Es;o.extensions&&_0(r,p,o),i.associations.set(p,{meshes:e});for(let g=0,f=u.length;g<f;g++)p.add(u[g]);return p})}loadCamera(e){let i;const s=this.json.cameras[e],r=s[s.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?i=new Ot(Di.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):s.type==="orthographic"&&(i=new lh(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),s.name&&(i.name=this.createUniqueName(s.name)),np(i,s),Promise.resolve(i)}loadSkin(e){const i=this.json.skins[e],s=[];for(let r=0,o=i.joints.length;r<o;r++)s.push(this._loadNodeShallow(i.joints[r]));return i.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",i.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(r){const o=r.pop(),a=r,l=[],c=[];for(let h=0,d=a.length;h<d;h++){const u=a[h];if(u){l.push(u);const p=new de;o!==null&&p.fromArray(o.array,h*16),c.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[h])}return new l1(l,c)})}loadAnimation(e){const i=this.json,s=this,r=i.animations[e],o=r.name?r.name:"animation_"+e,a=[],l=[],c=[],h=[],d=[];let u=0,p=r.channels.length;for(u=0,p=r.channels.length;u<p;u++){const g=r.channels[u],f=r.samplers[g.sampler],A=g.target,y=A.node,b=r.parameters!==void 0?r.parameters[f.input]:f.input,v=r.parameters!==void 0?r.parameters[f.output]:f.output;A.node!==void 0&&(a.push(this.getDependency("node",y)),l.push(this.getDependency("accessor",b)),c.push(this.getDependency("accessor",v)),h.push(f),d.push(A))}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h),Promise.all(d)]).then(function(g){const f=g[0],A=g[1],y=g[2],b=g[3],v=g[4],x=[];for(u=0,p=f.length;u<p;u++){const w=f[u],C=A[u],S=y[u],_=b[u],I=v[u];if(w===void 0)continue;w.updateMatrix&&w.updateMatrix();const B=s._createAnimationTracks(w,C,S,_,I);if(B)for(let M=0;M<B.length;M++)x.push(B[M])}return new wa(o,void 0,x)})}createNodeMesh(e){const i=this.json,s=this,r=i.nodes[e];return r.mesh===void 0?null:s.getDependency("mesh",r.mesh).then(function(o){const a=s._getNodeRef(s.meshCache,r.mesh,o);return r.weights!==void 0&&a.traverse(function(l){if(l.isMesh)for(let c=0,h=r.weights.length;c<h;c++)l.morphTargetInfluences[c]=r.weights[c]}),a})}loadNode(e){const i=this.json,s=this,r=i.nodes[e],o=s._loadNodeShallow(e),a=[],l=r.children||[];for(let h=0,d=l.length;h<d;h++)a.push(s.getDependency("node",l[h]));const c=r.skin===void 0?Promise.resolve(null):s.getDependency("skin",r.skin);return Promise.all([o,Promise.all(a),c]).then(function(h){const d=h[0],u=h[1],p=h[2];p!==null&&d.traverse(function(g){g.isSkinnedMesh&&g.bind(p,cBe)});for(let g=0,f=u.length;g<f;g++)d.add(u[g]);return d})}_loadNodeShallow(e){const i=this.json,s=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const o=i.nodes[e],a=o.name?r.createUniqueName(o.name):"",l=[],c=r._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return c&&l.push(c),o.camera!==void 0&&l.push(r.getDependency("camera",o.camera).then(function(h){return r._getNodeRef(r.cameraCache,o.camera,h)})),r._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){l.push(h)}),this.nodeCache[e]=Promise.all(l).then(function(h){let d;if(o.isBone===!0?d=new Tf:h.length>1?d=new Es:h.length===1?d=h[0]:d=new Ae,d!==h[0])for(let u=0,p=h.length;u<p;u++)d.add(h[u]);if(o.name&&(d.userData.name=o.name,d.name=a),np(d,o),o.extensions&&_0(s,d,o),o.matrix!==void 0){const u=new de;u.fromArray(o.matrix),d.applyMatrix4(u)}else o.translation!==void 0&&d.position.fromArray(o.translation),o.rotation!==void 0&&d.quaternion.fromArray(o.rotation),o.scale!==void 0&&d.scale.fromArray(o.scale);return r.associations.has(d)||r.associations.set(d,{}),r.associations.get(d).nodes=e,d}),this.nodeCache[e]}loadScene(e){const i=this.extensions,s=this.json.scenes[e],r=this,o=new Es;s.name&&(o.name=r.createUniqueName(s.name)),np(o,s),s.extensions&&_0(i,o,s);const a=s.nodes||[],l=[];for(let c=0,h=a.length;c<h;c++)l.push(r.getDependency("node",a[c]));return Promise.all(l).then(function(c){for(let d=0,u=c.length;d<u;d++)o.add(c[d]);const h=d=>{const u=new Map;for(const[p,g]of r.associations)(p instanceof ti||p instanceof di)&&u.set(p,g);return d.traverse(p=>{const g=r.associations.get(p);g!=null&&u.set(p,g)}),u};return r.associations=h(o),o})}_createAnimationTracks(e,i,s,r,o){const a=[],l=e.name?e.name:e.uuid,c=[];Km[o.path]===Km.weights?e.traverse(function(p){p.morphTargetInfluences&&c.push(p.name?p.name:p.uuid)}):c.push(l);let h;switch(Km[o.path]){case Km.weights:h=Ru;break;case Km.rotation:h=ad;break;case Km.position:case Km.scale:h=ld;break;default:switch(s.itemSize){case 1:h=Ru;break;case 2:case 3:default:h=ld;break}break}const d=r.interpolation!==void 0?nBe[r.interpolation]:xu,u=this._getArrayFromAccessor(s);for(let p=0,g=c.length;p<g;p++){const f=new h(c[p]+"."+Km[o.path],i.array,u,d);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(f),a.push(f)}return a}_getArrayFromAccessor(e){let i=e.array;if(e.normalized){const s=xz(i.constructor),r=new Float32Array(i.length);for(let o=0,a=i.length;o<a;o++)r[o]=i[o]*s;i=r}return i}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const s=this instanceof ad?iBe:Yee;return new s(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function dBe(n,e,i){const s=e.attributes,r=new gi;if(s.POSITION!==void 0){const l=i.json.accessors[s.POSITION],c=l.min,h=l.max;if(c!==void 0&&h!==void 0){if(r.set(new E(c[0],c[1],c[2]),new E(h[0],h[1],h[2])),l.normalized){const d=xz(zb[l.componentType]);r.min.multiplyScalar(d),r.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const l=new E,c=new E;for(let h=0,d=o.length;h<d;h++){const u=o[h];if(u.POSITION!==void 0){const p=i.json.accessors[u.POSITION],g=p.min,f=p.max;if(g!==void 0&&f!==void 0){if(c.setX(Math.max(Math.abs(g[0]),Math.abs(f[0]))),c.setY(Math.max(Math.abs(g[1]),Math.abs(f[1]))),c.setZ(Math.max(Math.abs(g[2]),Math.abs(f[2]))),p.normalized){const A=xz(zb[p.componentType]);c.multiplyScalar(A)}l.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(l)}n.boundingBox=r;const a=new Vn;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=a}function qee(n,e,i){const s=e.attributes,r=[];function o(a,l){return i.getDependency("accessor",a).then(function(c){n.setAttribute(l,c)})}for(const a in s){const l=yz[a]||a.toLowerCase();l in n.attributes||r.push(o(s[a],l))}if(e.indices!==void 0&&!n.index){const a=i.getDependency("accessor",e.indices).then(function(l){n.setIndex(l)});r.push(a)}return hi.workingColorSpace!==qi&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${hi.workingColorSpace}" not supported.`),np(n,e),dBe(n,e,i),Promise.all(r).then(function(){return e.targets!==void 0?rBe(n,e.targets,i):n})}var M0=(n=>(n[n.Quad=0]="Quad",n[n.Cube=1]="Cube",n[n.Sphere=2]="Sphere",n[n.RoundedCube=10]="RoundedCube",n))(M0||{}),r2,wz;class Ym{static createText(e,i){let s=null;const r=i?.font||pBe(i?.familyFamily||null);r instanceof Wee?s=FA(this,r2,wz).call(this,e,r,i):s==null&&(s=new Rt);const o=i?.color||16777215,a=new pe(s,i?.material??new Us({color:o}));return this.applyDefaultObjectOptions(a,i),r instanceof Promise?r.then(l=>{a.geometry=FA(this,r2,wz).call(this,e,l,i),i!=null&&i.onGeometry&&i.onGeometry(a)}):i!=null&&i.onGeometry&&i.onGeometry(a),a}static createOccluder(e){const i=new ai({colorWrite:!1,depthWrite:!0,side:Qi});return this.createPrimitive(e,{material:i})}static createPrimitive(e,i){let s;const r=i?.color||16777215;switch(e){case"Quad":case 0:{const o=new Xs(1,1,1,1),a=i?.material??new Us({color:r});i!=null&&i.texture&&"map"in a&&(a.map=i.texture),s=new pe(o,a),s.name="Quad"}break;case"Cube":case 1:{const o=new bn(1,1,1),a=i?.material??new Us({color:r});i!=null&&i.texture&&"map"in a&&(a.map=i.texture),s=new pe(o,a),s.name="Cube"}break;case 10:case"RoundedCube":{const o=uBe(1,1,1,.1,2),a=i?.material??new Us({color:r});i!=null&&i.texture&&"map"in a&&(a.map=i.texture),s=new pe(o,a),s.name="RoundedCube"}break;case"Sphere":case 2:{const o=new eh(.5,16,16),a=i?.material??new Us({color:r});i!=null&&i.texture&&"map"in a&&(a.map=i.texture),s=new pe(o,a),s.name="Sphere"}break;case"ShaderBall":s=new Es,s.name="ShaderBall",mBe(s,i);break}return this.applyDefaultObjectOptions(s,i),s}static createSprite(e){const i=new s1({color:16777215});e!=null&&e.texture&&"map"in i&&(i.map=e.texture);const s=new aP(i);return this.applyDefaultObjectOptions(s,e),s}static applyDefaultObjectOptions(e,i){e.receiveShadow=!0,e.castShadow=!0,i!=null&&i.name&&(e.name=i.name),i!=null&&i.position&&(Array.isArray(i.position)?e.position.set(i.position[0],i.position[1],i.position[2]):e.position.set(i.position.x,i.position.y,i.position.z)),i!=null&&i.rotation&&(Array.isArray(i.rotation)?e.rotation.set(i.rotation[0],i.rotation[1],i.rotation[2]):e.rotation.set(i.rotation.x,i.rotation.y,i.rotation.z)),i!=null&&i.scale&&(typeof i.scale=="number"?e.scale.set(i.scale,i.scale,i.scale):e.scale.set(i.scale.x,i.scale.y,i.scale.z)),i?.receiveShadow!=null&&(e.receiveShadow=i.receiveShadow),i?.castShadow!=null&&(e.castShadow=i.castShadow),i!=null&&i.parent&&i.parent.add(e)}}r2=new WeakSet,wz=function(n,e,i){const s=i?.depth||.1;return new ILe(n,{font:e,size:1,depth:s,height:s,bevelEnabled:i?.bevel||!1,bevelThickness:.01,bevelOffset:.01,bevelSize:.01})},mc(Ym,r2);function uBe(n,e,i,s,r){const o=new lm,a=1e-5,l=s-a;o.absarc(a,a,a,-Math.PI/2,-Math.PI,!0),o.absarc(a,e-l*2,a,Math.PI,Math.PI/2,!0),o.absarc(n-l*2,e-l*2,a,Math.PI/2,0,!0),o.absarc(n-l*2,a,a,0,-Math.PI/2,!0);const c=new wx(o,{bevelEnabled:!0,bevelSegments:r*2,steps:1,bevelSize:l,bevelThickness:s,curveSegments:r});return c.scale(1,1,1-s),c.center(),c.computeVertexNormals(),c}const o2=new Map;function pBe(n){let e="";switch(n){default:case"OpenSans":e="https://cdn.needle.tools/static/fonts/facetype/Open Sans_Regular_ascii.json";break;case"Helvetiker":e="https://raw.githubusercontent.com/mrdoob/three.js/master/examples/fonts/helvetiker_regular.typeface.json";break}if(o2.has(e)){const r=o2.get(e);if(r)return r}const i=new TLe,s=new Promise((r,o)=>{i.load(e,a=>{o2.set(e,a),r(a)},void 0,o)});return o2.set(e,s),s}let Cz=!1,Sz=null;function mBe(n,e){if(Sz===null){const i="https://cdn.needle.tools/static/models/shaderball.glb",s=new ip,r=XR(null);s.setDRACOLoader(r.dracoLoader),s.setKTX2Loader(r.ktx2Loader),Cz=!0,Sz=s.loadAsync(i).then(o=>{const a=o.scene;return a.position.y-=.5,a}).catch(o=>(console.warn("Failed to load shaderball mesh: "+o.message),ete())).finally(()=>{Cz=!1})}if(Cz){const i=ete();i.name="ShaderBall-Placeholder";const s=i.children[0];s?.type==="Mesh"&&$ee(s,e),n.add(i)}Sz.then(i=>{n.children.forEach(o=>{o.name==="ShaderBall-Placeholder"&&n.remove(o)});const s=i.clone(),r=s.children[0];r?.type==="Mesh"&&$ee(r,e),n.add(s)})}function $ee(n,e){var i;if(e?.color||e?.material||e?.texture){const s=e?.material??((i=n.material)==null?void 0:i.clone())??new Us;e.color&&"color"in s&&s.color instanceof fe&&s.color.set(e.color),e!=null&&e.texture&&"map"in s&&(s.map=e.texture),n.material=s}}function ete(){return new Es().add(Ym.createPrimitive("Sphere",{material:new ai({transparent:!0,opacity:.1})}))}const tte=class{constructor(n,e,i){m(this,"_session"),m(this,"_mode"),m(this,"_init"),m(this,"_renderer"),m(this,"_camera"),m(this,"_scene"),m(this,"onEnd",()=>{var s;(s=this._session)==null||s.removeEventListener("end",this.onEnd),this._renderer.setAnimationLoop(null),this._renderer.dispose(),this._scene.clear()}),m(this,"_lastTime",0),m(this,"onFrame",(s,r)=>{const o=s-this._lastTime;this.update(s,o),this._camera.parent!==this._scene&&this._scene.add(this._camera),this._renderer.render(this._scene,this._camera)}),m(this,"_objects",[]),this._mode=n,this._init=e,this._session=i,this._session.addEventListener("end",this.onEnd),this._renderer=new om({alpha:!0}),this._renderer.setAnimationLoop(this.onFrame),this._renderer.xr.setSession(i),this._renderer.xr.enabled=!0,this._camera=new Ot,this._scene=new ir,this._scene.fog=new FI(4473924,10,250),this._scene.add(this._camera),this.setupScene()}static get active(){return this._active}static async start(n,e){if(this._active)return console.error("Cannot start a new XR session while one is already active"),null;if(this._requestInFlight)return console.error("Cannot start a new XR session while a request is already in flight"),null;if("xr"in navigator&&navigator.xr){if(!e)return console.error("XRSessionInit must be provided"),null;this._requestInFlight=!0;const i=await navigator.xr.requestSession(n,e);return i.addEventListener("end",()=>{this._active=null}),this._requestInFlight?(this._requestInFlight=!1,this._active=new tte(n,e,i),this._active):(i.end(),null)}return null}static async handoff(){return this._active?this._active.handoff():null}static async stop(){this._requestInFlight=!1,this._active&&(await this._active.end(),await Ah(100)),this._active=null}get isAR(){return this._mode==="immersive-ar"}end(){return this._session?this._session.end():Promise.resolve()}async handoff(){if(!this._session)throw new Error("Cannot handoff a session that has already ended");const n={session:this._session,mode:this._mode,init:this._init};return await this.onBeforeHandoff(),this.onEnd(),this._session=null,n}async onBeforeHandoff(){await Ah(1e3),this._scene.clear()}setupScene(){this._scene.background=new fe(0),this._scene.add(new ST(5,10,1118481,1118481));const n=new um(16777215,1);n.position.set(0,20,0),n.castShadow=!1,this._scene.add(n);const e=new um(16777215,1);e.position.set(0,-1,0),e.castShadow=!1,this._scene.add(e);const i=new dm(16777215,1,100,1);i.position.set(0,2,0),i.castShadow=!1,i.distance=200,this._scene.add(i);const s=50;for(let r=0;r<100;r++){const o=new Us({color:2236962,metalness:1,roughness:.8});this.isAR&&(o.emissive=new fe(Math.random(),Math.random(),Math.random()),o.emissiveIntensity=Math.random());const a=lt.random(0,1)>.5?M0.Sphere:M0.Cube,l=Ym.createPrimitive(a,{material:o});l.position.x=lt.random(-s,s),l.position.y=lt.random(-2,s),l.position.z=lt.random(-s,s),l.rotation.x=lt.random(0,Math.PI*2),l.rotation.y=lt.random(0,Math.PI*2),l.rotation.z=lt.random(0,Math.PI*2),l.scale.multiplyScalar(.5+Math.random()*10);const c=l.position.distanceTo(this._camera.position)-l.scale.x;c<1&&l.position.multiplyScalar(1+1/c),this._objects.push(l),this._scene.add(l)}}update(n,e){const i=n*4e-4;for(let s=0;s<this._objects.length;s++){const r=this._objects[s];r.position.y+=Math.sin(i+s*.5)*.005,r.rotateY(.002)}}};let Fb=tte;m(Fb,"_active",null),m(Fb,"_requestInFlight",!1);var AC;(n=>{const e=[];function i(){if(!(e!=null&&e.length))return!1;for(const o of e)o.exportAndOpen();return!0}n.exportAndOpen=i;function s(o){e.push(o)}n.registerExporter=s;function r(o){if(!e)return;const a=e.indexOf(o);a>=0&&e.splice(a,1)}n.unregisterExporter=r})(AC||(AC={}));const ite="NeedleXRSession onStart",nte="NeedleXRSession onEnd",Hr=q("debugwebxr"),ste=q("stats");let _z=0;function gBe(n){let e=null;const i=n;return i.getAROverlayContainer?e=i.getAROverlayContainer():e=n,e}fBe();async function fBe(){var n;if(q("debugasap")){let e=globalThis["needle:XRSession"];if(e instanceof Promise){delete globalThis["needle:XRSession"],ji.addContextCreatedCallback(async i=>{if(!e)return;l0(!0);const s=await e;if(s){const r=Qt.getDefaultSessionInit("immersive-vr");Qt.setSession("immersive-vr",s,r,i.context)}else console.error("NeedleXRSession: ASAP session was rejected");e=void 0});return}}if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent)){console.warn("WebXRViewer does not support addEventListener");return}(n=navigator.xr)==null||n.addEventListener("sessiongranted",async()=>{l0(!0),console.log("Received Session Granted..."),await Ah(100);const e=sessionStorage.getItem("needle_xr_session_mode"),i=sessionStorage.getItem("needle_xr_session_init")??null,s=i?JSON.parse(i):null;let r=null;if(rte()&&(await Fb.start(e||"immersive-vr",s||Qt.getDefaultSessionInit("immersive-vr")),await bBe(),r=await Fb.handoff()),r)Qt.setSession(r.mode,r.session,r.init,$t.Current);else if(e&&i){console.log("Session Granted: Restore last session");const o=JSON.parse(i);Qt.start(e,o).catch(a=>console.warn(a))}else Qt.start("immersive-vr").catch(o=>console.warn("Session Granted failed:",o))},{once:!0})}}function ABe(n,e){sessionStorage.setItem("needle_xr_session_mode",n),sessionStorage.setItem("needle_xr_session_init",JSON.stringify(e))}function yBe(){sessionStorage.removeItem("needle_xr_session_mode"),sessionStorage.removeItem("needle_xr_session_init")}const Mz=new Set;ji.registerCallback(nn.ContextCreationStart,async n=>{Mz.add(n.context)}),ji.registerCallback(nn.ContextCreated,async n=>{Mz.delete(n.context)});function rte(){return Mz.size>0}function bBe(){return new Promise(n=>{const e=Date.now(),i=setInterval(()=>{(!rte()||Date.now()-e>6e4)&&(clearInterval(i),n())},100)})}Ft.isDesktop()&&Je()&&window.addEventListener("keydown",n=>{(n.key==="x"||n.key==="Escape")&&Qt.active&&Qt.stop()});const jm=class{constructor(n,e,i,s){m(this,"context"),m(this,"session"),m(this,"mode"),m(this,"controllers",[]),m(this,"_rigScale",1),m(this,"_lastRigScaleUpdate",-1),m(this,"_rigs",[]),m(this,"_viewerHitTestSource",null),m(this,"_defaultRig"),m(this,"_xr_scripts"),m(this,"_xr_update_scripts",[]),m(this,"_inactive_scripts",[]),m(this,"_controllerAdded"),m(this,"_controllerRemoved"),m(this,"_originalCameraWorldPosition"),m(this,"_originalCameraWorldRotation"),m(this,"_originalCameraWorldScale"),m(this,"_originalCameraParent"),m(this,"_mainCamera",null),m(this,"onRendererSessionSet",()=>{var a;this.running&&(this.context.renderer.xr.enabled=!0,this.context.renderer.xr.updateCamera(this.context.mainCamera),(a=this.context.mainCameraComponent)==null||a.applyClearFlags())}),m(this,"onInputSourceAdded",a=>{if(a.targetRayMode==="screen")return;let l=0;for(let h=0;h<this.session.inputSources.length;h++)if(this.session.inputSources[h]===a){l=h;break}if(this.controllers.find(h=>h.inputSource===a)){console.debug("Controller already exists for input source",l);return}else if(this._newControllers.find(h=>h.inputSource===a)){console.debug("Controller already registered for input source",l);return}const c=new Z5(this,a,l);this._newControllers.push(c)}),m(this,"_ended",!1),m(this,"_newControllers",[]),m(this,"onEnd",a=>{var l,c,h;if(this._ended)return;this._ended=!0,console.debug("XR Session ended"),yBe(),this.onAfterRender(),this.revertCustomForward(),this._didStart=!1,this._previousCameraParent=null,Hm(this.onBefore,_n.LateUpdate);const d=this.context.pre_render_callbacks.indexOf(this.onBeforeRender);d>=0&&this.context.pre_render_callbacks.splice(d,1);const u=this.context.post_render_callbacks.indexOf(this.onAfterRender);u>=0&&this.context.post_render_callbacks.splice(u,1),this.context.xr=null,this.context.renderer.xr.enabled=!1,this.context.pre_update_oneshot_callbacks.push(()=>{var g,f;(g=this.context.mainCameraComponent)==null||g.applyClearFlags(),(f=this.context.mainCameraComponent)==null||f.applyClippingPlane()}),d$({session:this});for(const g of jm._xrEndListeners)g({xr:this});const p=[...this.controllers];for(let g=0;g<p.length;g++)this.disconnectInputSource(p[g].inputSource);this._newControllers.length=0,this.controllers.length=0;for(const g of this._xr_scripts)(l=g?.onLeaveXR)==null||l.call(g,{xr:this});(c=this.sync)==null||c.onExitXR(this),this.context.mainCamera&&((h=this._originalCameraParent)==null||h.add(this.context.mainCamera),this._originalCameraWorldPosition&&Cr(this.context.mainCamera,this._originalCameraWorldPosition),this._originalCameraWorldRotation&&Ic(this.context.mainCamera,this._originalCameraWorldRotation),this._originalCameraWorldScale&&ib(this.context.mainCamera,this._originalCameraWorldScale)),this.context.requestSizeUpdate(),this._defaultRig.gameObject.removeFromParent(),l0(!1),performance.mark(nte),performance.measure("NeedleXRSession",ite,nte)}),m(this,"_didStart",!1),m(this,"onBefore",a=>{var l,c,h,d,u,p,g,f;const A=a.xrFrame;if(!A)return;performance.mark("NeedleXRSession onBefore start"),this.context.xr=this,this.context.mainCameraComponent&&this.context.mainCameraComponent!==this._mainCamera&&(this._mainCamera=this.context.mainCameraComponent),((l=this.rig)==null?void 0:l.isActive)==!1&&(Hr&&console.warn("Latest rig is not active - trying to activate a different rig",this.rig),this.updateActiveXRRig()),this.rig&&(c=this._mainCamera)!=null&&c.gameObject&&((d=(h=this._mainCamera)==null?void 0:h.gameObject)==null?void 0:d.parent)!==this.rig.gameObject&&this.rig.gameObject.add((u=this._mainCamera)==null?void 0:u.gameObject),this.internalUpdateState(),this.applyCustomForward();const y={xr:this};if(this._didStart){if(this.context.new_scripts_xr.length>0){const b=[...this.context.new_scripts_xr];for(let v=0;v<b.length;v++){const x=this.context.new_scripts_xr[v];if(!x||x.destroyed||((p=x.supportsXR)==null?void 0:p.call(x,this.mode))==!1){this.context.new_scripts_xr.splice(v,1);continue}if(!x.activeAndEnabled){this.context.new_scripts_xr.splice(v,1),this.markInactive(x);continue}if(this.addScript(x)){this.invokeCallback_EnterXR(x);for(const w of this.controllers)this.invokeCallback_ControllerAdded(x,w)}}}}else{if(this._didStart=!0,this.mode==="immersive-vr"){const v=Ll(this.context.scene.children);if(v){const x=v.getSize(Lt());if(x.length()>0){const w=this._defaultRig.gameObject;w.position.set(v.min.x+x.x*.5,v.min.y,v.max.z+x.z*.5+1.5);const C=v.getCenter(Lt());C.y=w.position.y,w.lookAt(C)}}}h$({session:this});for(const v of jm._xrStartListeners)v(y);const b=[...this._xr_scripts];Hr&&console.log("NeedleXRSession start, handle scripts:",b);for(const v of b){if(v.destroyed){this._script_to_remove.push(v);continue}if(!v.activeAndEnabled){this.markInactive(v);continue}this.invokeCallback_EnterXR(v);for(const x of this.controllers)this.invokeCallback_ControllerAdded(v,x)}}this.syncCameraCullingMask();for(const b of this.controllers)b.onUpdate(A);if(this._newControllers.length>0){const b=[...this._newControllers];this._newControllers.length=0;for(const v of b){if(!v.connected){console.warn("New controller is not connected",v);continue}this.controllers.push(v);for(const x of this._xr_scripts){if(x.destroyed){this._script_to_remove.push(x);continue}x.activeAndEnabled!==!1&&this.invokeCallback_ControllerAdded(x,v)}}this.controllers.sort((v,x)=>v.index-x.index)}Hr&&this.context.time.frame%30===0&&this.controllers.length<=0&&this.session.inputSources.length>0&&(l0(!0),console.error("XRControllers are not added but inputSources are present")),performance.mark("NeedleXRSession update scripts start");for(const b of this._xr_update_scripts){if(b.destroyed===!0){this._script_to_remove.push(b);continue}if(b.activeAndEnabled===!1){this.markInactive(b);continue}b.onUpdateXR&&b.onUpdateXR(y)}if(performance.mark("NeedleXRSession update scripts end"),performance.measure("NeedleXRSession update scripts","NeedleXRSession update scripts start","NeedleXRSession update scripts end"),this.handleInactiveScripts(),this._script_to_remove.length>0){const b=[...new Set(this._script_to_remove)];this._script_to_remove.length=0;for(const v of b)!v.destroyed&&this.running&&((g=v.onLeaveXR)==null||g.call(v,y)),this.removeScript(v)}(f=this.sync)==null||f.onUpdate(this),this.onRenderDebug(),performance.mark("NeedleXRSession onBefore end"),performance.measure("NE XR frame","NeedleXRSession onBefore start","NeedleXRSession onBefore end")}),m(this,"onBeforeRender",()=>{this.context.mainCamera&&this.updateFade(this.context.mainCamera)}),m(this,"onAfterRender",()=>{if(this.onUpdateFade_PostRender(),Ft.isDesktop()||!this._renderOnceOnDevice){const a=this.context.renderer;if(a.xr.isPresenting&&this.context.mainCamera){this._renderOnceOnDevice=!0;const l=a.xr.enabled,c=a.getRenderTarget(),h=this.context.scene.background;a.xr.enabled=!1,a.setRenderTarget(null),this.isPassThrough&&(this.context.scene.background=null),this.context.composer?this.context.composer.render(this.context.time.deltaTime):a.render(this.context.scene,this.context.mainCamera),a.xr.enabled=l,a.setRenderTarget(c),this.context.scene.background=h}}}),m(this,"_script_to_remove",[]),m(this,"_camera"),m(this,"_cameraRenderParent",new Ae().rotateY(Math.PI)),m(this,"_previousCameraParent"),m(this,"_customforward",!0),m(this,"originalCameraNearPlane"),m(this,"_viewerPose"),m(this,"_transformOrientation",new Fe),m(this,"_transformPosition",new E),m(this,"_transition");var r,o;performance.mark(ite),ABe(n,s.init),this.session=e,this.mode=n,this.context=i,(Hr||q("console"))&&l0(!0),this._xr_scripts=[...s.scripts],this._xr_update_scripts=this._xr_scripts.filter(a=>typeof a.onUpdateXR=="function"),this._controllerAdded=s.controller_added,this._controllerRemoved=s.controller_removed,qu(this.onBefore,_n.LateUpdate),this.context.pre_render_callbacks.push(this.onBeforeRender),this.context.post_render_callbacks.push(this.onAfterRender),((r=s.init.optionalFeatures)!=null&&r.includes("hit-test")||(o=s.init.requiredFeatures)!=null&&o.includes("hit-test"))&&e.requestReferenceSpace("viewer").then(a=>{var l,c;return(c=(l=e.requestHitTestSource)==null?void 0:l.call(e,{space:a}))==null?void 0:c.then(h=>this._viewerHitTestSource=h).catch(h=>console.error(h))}).catch(a=>console.error(a)),this.context.mainCamera&&(this._originalCameraWorldPosition=ri(this.context.mainCamera,new E),this._originalCameraWorldRotation=fn(this.context.mainCamera,new Fe),this._originalCameraWorldScale=Dn(this.context.mainCamera,new E),this._originalCameraParent=this.context.mainCamera.parent),this._defaultRig=new G2e,this.context.scene.add(this._defaultRig.gameObject),this.addRig(this._defaultRig);for(let a=0;a<e.inputSources.length;a++){const l=e.inputSources[a];if(!l.handedness){console.warn("Input source in xr session has no handedness - ignoring",a);continue}this.onInputSourceAdded(l)}this.session.addEventListener("end",this.onEnd),this.session.addEventListener("inputsourceschange",a=>{for(const l of a.removed)this.disconnectInputSource(l);for(const l of a.added)this.onInputSourceAdded(l)}),this.context.xr=this,this.context.renderer.xr.setSession(this.session).then(this.onRendererSessionSet),"controllerAutoUpdate"in this.context.renderer.xr?(console.debug("Disabling three.js controllerAutoUpdate"),this.context.renderer.xr.controllerAutoUpdate=!1):Hr&&console.warn("controllerAutoUpdate is not available in three.js - cannot disable it")}static getXRSync(n){return this._sync||(this._sync=new Oee(n)),this._sync}static get currentSessionRequest(){return this._currentSessionRequestMode}static get active(){return this._activeSession}static get activeMode(){var n;return((n=this._activeSession)==null?void 0:n.mode)??null}static get xrSystem(){return"xr"in navigator?navigator.xr:void 0}static isXRSupported(){return Promise.all([this.isVRSupported(),this.isARSupported()]).then(n=>n.some(e=>e)).catch(()=>!1)}static isVRSupported(){return this.isSessionSupported("immersive-vr")}static isARSupported(){return this.isSessionSupported("immersive-ar")}static isSessionSupported(n){var e;return((e=this.xrSystem)==null?void 0:e.isSessionSupported(n).catch(i=>(Hr&&console.error(i),!1)))??Promise.resolve(!1)}static onSessionRequestStart(n){this._sessionRequestStartListeners.push(n)}static offSessionRequestStart(n){const e=this._sessionRequestStartListeners.indexOf(n);e>=0&&this._sessionRequestStartListeners.splice(e,1)}static onSessionRequestEnd(n){this._sessionRequestEndListeners.push(n)}static offSessionRequestEnd(n){const e=this._sessionRequestEndListeners.indexOf(n);e>=0&&this._sessionRequestEndListeners.splice(e,1)}static onXRSessionStart(n){this._xrStartListeners.push(n)}static offXRSessionStart(n){const e=this._xrStartListeners.indexOf(n);e>=0&&this._xrStartListeners.splice(e,1)}static onXRSessionEnd(n){this._xrEndListeners.push(n)}static offXRSessionEnd(n){const e=this._xrEndListeners.indexOf(n);e>=0&&this._xrEndListeners.splice(e,1)}static onControllerAdded(n){this._controllerAddedListeners.push(n)}static offControllerAdded(n){const e=this._controllerAddedListeners.indexOf(n);e>=0&&this._controllerAddedListeners.splice(e,1)}static onControllerRemoved(n){this._controllerRemovedListeners.push(n)}static offControllerRemoved(n){const e=this._controllerRemovedListeners.indexOf(n);e>=0&&this._controllerRemovedListeners.splice(e,1)}static offerSession(n,e,i){return"xr"in navigator&&navigator.xr&&"offerSession"in navigator.xr?(typeof navigator.xr.offerSession=="function"&&(console.log("WebXR offerSession is available - requesting mode: "+n),e=="default"&&(e=this.getDefaultSessionInit(n)),navigator.xr.offerSession(n,{...e}).then(s=>jm.setSession(n,s,e,i)).catch(s=>{console.log("XRSession offer rejected (perhaps because another call to offerSession was made or a call to requestSession was made)")})),!0):!1}static getDefaultSessionInit(n){switch(n){case"immersive-ar":return{optionalFeatures:["anchors","local-floor","hand-tracking","layers","dom-overlay","hit-test","unbounded"]};case"immersive-vr":return{optionalFeatures:["local-floor","bounded-floor","hand-tracking","high-fixed-foveation-level","layers"]};default:return console.warn("No default session init for mode",n),{}}}static async start(n,e,i){var s,r,o,a;if(Ft.isiOS()){if(n==="ar")if(await this.isARSupported())n="immersive-ar";else return AC.exportAndOpen(),null}else n=="ar"&&(n="immersive-ar");if(Je()&&q("debugxrpreroom"))return console.warn("Debug: Starting temporary XR session"),await Fb.start(n,e||jm.getDefaultSessionInit(n)),null;if(this._currentSessionRequest)return console.warn("A XRSession is already being requested"),(Hr||Je())&&An("A XRSession is already being requested"),this._currentSessionRequest.then(()=>this._activeSession);if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;if(i||(i=$t.Current),i||(i=ji.All[0]),!i)throw new Error("No Needle Engine Context found");switch(performance.mark("NeedleXRSession start"),e||(e={}),n){case"immersive-ar":{if(await((s=this.xrSystem)==null?void 0:s.isSessionSupported("immersive-ar"))!==!0)return console.error(n+" is not supported by this browser."),null;const d=this.getDefaultSessionInit(n),u=gBe(i.domElement);u&&!Ft.isQuest()&&(d.domOverlay={root:u},d.optionalFeatures.push("dom-overlay")),e={...d,...e}}break;case"immersive-vr":{if(await((r=this.xrSystem)==null?void 0:r.isSessionSupported("immersive-vr"))!==!0)return console.error(n+" is not supported by this browser."),null;e={...this.getDefaultSessionInit(n),...e}}break;default:console.warn("No default session init for mode",n);break}e.optionalFeatures??(e.optionalFeatures=[]),e.requiredFeatures??(e.requiredFeatures=[]),await Fb.stop();const l=n=="immersive-ar"?i.scripts_immersive_ar:i.scripts_immersive_vr;Hr?console.log(`%cRequesting ${n} session`,"font-weight:bold;",e,l):console.log(`%cRequesting ${n} session`,"font-weight:bold;");for(const d of l)d.onBeforeXR&&d.onBeforeXR(n,e);for(const d of this._sessionRequestStartListeners)d({mode:n,init:e});Hr&&ss("Requesting "+n+" session ("+Date.now()+")"),this._currentSessionRequest=(o=navigator.xr)==null?void 0:o.requestSession(n,e),this._currentSessionRequestMode=n;const c=await((a=this._currentSessionRequest)==null?void 0:a.catch(d=>{console.error(d,"Code: "+d.code),d.code===9&&An("Make sure your device has the required permissions (e.g. camera access)"),console.log("If the specified XR configuration is not supported (e.g. entering AR doesnt work) - make sure you access the website on a secure connection (HTTPS) and your device has the required permissions (e.g. camera access)"),location.protocol==="http:"&&An("XR requires a secure connection (HTTPS)")}));this._currentSessionRequest=void 0,this._currentSessionRequestMode=null;for(const d of this._sessionRequestEndListeners)d({mode:n,init:e,newSession:c||null});if(!c)return console.warn("XR Session request was rejected"),null;const h=this.setSession(n,c,e,i);return performance.mark("NeedleXRSession end"),performance.measure("NeedleXRSession Startup","NeedleXRSession start","NeedleXRSession end"),h}static setSession(n,e,i,s){if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;const r=n=="immersive-ar"?s.scripts_immersive_ar:s.scripts_immersive_vr;return this._activeSession=new jm(n,e,s,{scripts:r,controller_added:this._controllerAddedListeners,controller_removed:this._controllerRemovedListeners,init:i}),e.addEventListener("end",this.onEnd),Hr?console.log(`%cStarted ${n} session`,"font-weight:bold;",r):console.log(`%cStarted ${n} session`,"font-weight:bold;"),this._activeSession}static stop(){var n;(n=this._activeSession)==null||n.end()}get sync(){return jm._sync}get running(){return!this._ended&&this.session!=null}get interactionMode(){return this.session.interactionMode}get visibilityState(){return this.session.visibilityState}get isVisibleBlurred(){return this.session.visibilityState==="visible-blurred"}get isSystemKeyboardSupported(){return this.session.isSystemKeyboardSupported}get environmentBlendMode(){return this.session.environmentBlendMode}get frame(){return this.context.xrFrame}get leftController(){return this.controllers.find(n=>n.side==="left")}get rightController(){return this.controllers.find(n=>n.side==="right")}getController(n){return typeof n=="number"?this.controllers[n]||null:this.controllers.find(e=>e.side===n)||null}get isPassThrough(){return!!(this.environmentBlendMode!=="opaque"&&this.interactionMode==="world-space"||this.mode==="immersive-ar"&&this.environmentBlendMode!=="opaque"&&this.controllers.some(n=>n.inputSource.targetRayMode==="tracked-pointer")||Je()&&Ft.isDesktop()&&this.mode==="immersive-ar")}get isAR(){return this.mode==="immersive-ar"}get isVR(){return this.mode==="immersive-vr"}get isScreenBasedAR(){return this.isAR&&!this.isPassThrough}get posePosition(){return this._transformPosition}get poseOrientation(){return this._transformOrientation}get referenceSpace(){return this.context.renderer.xr.getReferenceSpace()}get viewerPose(){return this._viewerPose}get isTrackingImages(){if(this.frame&&"getImageTrackingResults"in this.frame&&typeof this.frame.getImageTrackingResults=="function")try{const n=this.frame.getImageTrackingResults();for(const e of n)if(e.trackingState==="tracked")return!0}catch{return!1}return!1}get rig(){const n=this._rigs[0]??null;return n!=null&&n.gameObject&&G0(n.gameObject)||n?.isActive===!1?(this.updateActiveXRRig(),this._rigs[0]??null):n}get rigScale(){return this._rigs[0]?(this._lastRigScaleUpdate!==this.context.time.frame&&(this._lastRigScaleUpdate=this.context.time.frame,this._rigScale=this._rigs[0].gameObject.worldScale.x),this._rigScale):1}addRig(n){this._rigs.indexOf(n)>=0||(n.priority===void 0&&(n.priority=0),this._rigs.push(n),this.updateActiveXRRig())}removeRig(n){const e=this._rigs.indexOf(n);e!==-1&&(this._rigs.splice(e,1),this.updateActiveXRRig())}setRigActive(n){const e=this._rigs.indexOf(n);this._rigs.splice(e,1),this._rigs.unshift(n),this.updateActiveXRRig()}getUserOffsetInRig(){var n;const e=(n=this.context.mainCamera)==null?void 0:n.position;if(!e||!this.rig)return Lt(0,0,0);const i=Lt(e);return i.x*=-1,i.z*=-1,i.applyQuaternion(bh(this.rig.gameObject.quaternion)),i}updateActiveXRRig(){const n=this._rigs[0]??null;this._defaultRig.gameObject.parent!==this.context.scene&&this.context.scene.add(this._defaultRig.gameObject),this._defaultRig.gameObject.visible=!0,this._rigs.includes(this._defaultRig)||this._rigs.push(this._defaultRig);let e=this._rigs[0];e&&e.priority===void 0&&(e.priority=0);for(let i=1;i<this._rigs.length;i++){const s=this._rigs[i];if(s.isActive){if(G0(s.gameObject)){this._rigs.splice(i,1),i--;continue}(!e||e.isActive===!1||s.priority!==void 0&&s.priority>e.priority)&&(e=s)}}if(n!==e){const i=this._rigs.indexOf(e);i>=0&&this._rigs.splice(i,1),this._rigs.unshift(e)}Hr&&(n===e?console.log("Updated Active XR Rig:",e,"prev:",n):console.log("Updated Active XRRig:",e," (the same as before)"))}getHitTest(n){if(n)return this.getControllerHitTest(n);if(!this._viewerHitTestSource)return null;const e=this._viewerHitTestSource,i=this.frame.getHitTestResults(e);if(i.length>0){const s=i[0];return this.convertHitTestResult(s)}return null}getControllerHitTest(n){const e=n.getHitTestSource();if(!e)return null;const i=this.frame.getHitTestResultsForTransientInput(e);for(const s of i)if(s.inputSource===n.inputSource)for(const r of s.results)return this.convertHitTestResult(r);return null}convertHitTestResult(n){const e=this.context.renderer.xr.getReferenceSpace(),i=e&&n.getPose(e);if(i){const s=Lt(i.transform.position),r=bh(i.transform.orientation),o=this.context.mainCamera;if(o?.parent!==this._cameraRenderParent&&s.applyMatrix4(Nb),o!=null&&o.parent){s.applyMatrix4(o.parent.matrixWorld),r.multiply(kc);const a=fn(o.parent);a.premultiply(kc),r.premultiply(a)}return{hit:n,position:s,quaternion:r}}return null}convertSpace(n){const e=Lt(n.position);e.applyMatrix4(Nb);const i=bh(n.orientation);return i.premultiply(kc),{position:e,quaternion:i}}disconnectInputSource(n){const e=(i,s,r)=>{if(i.inputSource===n){Hr&&console.log("Disconnecting controller",i.index),this.controllers.splice(r,1),this.invokeControllerEvent(i,this._controllerRemoved,"removed");const o={xr:this,controller:i,change:"removed"};for(const a of this._xr_scripts)a.onXRControllerRemoved&&a.onXRControllerRemoved(o);i.onDisconnected()}};for(let i=this.controllers.length-1;i>=0;i--){const s=this.controllers[i];e(s,this.controllers,i)}for(let i=this._newControllers.length-1;i>=0;i--){const s=this._newControllers[i];e(s,this._newControllers,i)}}end(){this._ended||this.session.end().catch(n=>console.warn(n))}onRenderDebug(){if(Hr)for(const n of this.controllers)n.onRenderDebug();if((Hr||ste)&&this.rig&&(_z++,_z>=20)){const n=this.rig.gameObject.worldPosition,e=this.rig.gameObject.worldForward;n.add(e.multiplyScalar(1.5));const i=this.rig.gameObject.worldUp;n.add(i.multiplyScalar(2.5));let s="";if(s+=`${this.context.time.smoothedFps.toFixed(0)} FPS`,s+=`, calls: ${this.context.renderer.info.render.calls}, tris: ${this.context.renderer.info.render.triangles.toLocaleString()}`,Hr||ste)for(const r of this.controllers)s+=`
${r.hand?"hand":"ctrl"} ${r.inputSource.handedness}[${r.index}] con:${r.connected} tr:${r.isTracking} hts:${r.hasHitTestSource?"yes":"no"}`;_z=0,Nt.DrawLabel(n,s,void 0,1/60*20)}}addScript(n){return this._xr_scripts.includes(n)?!1:(Hr&&console.log("Register new XRScript",n),this._xr_scripts.push(n),typeof n.onUpdateXR=="function"&&this._xr_update_scripts.push(n),!0)}markInactive(n){if(!(this._inactive_scripts.indexOf(n)>=0)){this.removeScript(n,!1),this._inactive_scripts.push(n);for(const e of this.controllers)this.invokeCallback_ControllerRemoved(n,e);this.invokeCallback_LeaveXR(n)}}handleInactiveScripts(){if(this._inactive_scripts.length>0)for(let n=this._inactive_scripts.length-1;n>=0;n--){const e=this._inactive_scripts[n];if(e.activeAndEnabled){this._inactive_scripts.splice(n,1),this.addScript(e),this.invokeCallback_EnterXR(e);for(const i of this.controllers)this.invokeCallback_ControllerAdded(e,i)}}}removeScript(n,e=!0){Hr&&console.log("Remove XRScript",n);const i=this._xr_scripts.indexOf(n);i>=0&&this._xr_scripts.splice(i,1);const s=this._xr_update_scripts.indexOf(n);if(s>=0&&this._xr_update_scripts.splice(s,1),e){const r=this._inactive_scripts.indexOf(n);r>=0&&this._inactive_scripts.splice(r,1)}}invokeCallback_EnterXR(n){n.onEnterXR&&n.onEnterXR({xr:this})}invokeCallback_ControllerAdded(n,e){n.onXRControllerAdded&&n.onXRControllerAdded({xr:this,controller:e,change:"added"})}invokeCallback_ControllerRemoved(n,e){n.onXRControllerRemoved&&n.onXRControllerRemoved({xr:this,controller:e,change:"removed"})}invokeCallback_LeaveXR(n){n.onLeaveXR&&!n.destroyed&&n.onLeaveXR({xr:this})}syncCameraCullingMask(){var n;const e=this.context.xrCamera,i=(n=this.context.mainCameraComponent)==null?void 0:n.cullingMask;if(e&&i!==void 0){for(const s of e.cameras)s.layers.mask=i;e.layers.mask=i}else if(e){for(const s of e.cameras)s.layers.enableAll();e.layers.enableAll()}}invokeControllerEvent(n,e,i){for(let s=e.length-1;s>=0;s--){const r=e[s];if(r)try{r({xr:this,controller:n,change:i})}catch(o){console.error(o)}}}applyCustomForward(){var n;if(this.context.mainCamera&&this._customforward){this._camera=this.context.mainCamera,this._camera.parent!==this._cameraRenderParent&&(this._previousCameraParent=this._camera.parent,(n=this._previousCameraParent)==null||n.add(this._cameraRenderParent)),this._cameraRenderParent.name="XR Camera Render Parent",this._cameraRenderParent.add(this._camera);let e=.02;if(this.rig){const i=Dn(this.rig.gameObject);e*=i.x}this._camera instanceof Ot&&this._camera.near>e&&(this.originalCameraNearPlane=this._camera.near,this._camera.near=e)}}revertCustomForward(){this._camera&&this._previousCameraParent&&this._previousCameraParent.add(this._camera),this._previousCameraParent=null,this._camera instanceof Ot&&this.originalCameraNearPlane!=null&&(this._camera.near=this.originalCameraNearPlane)}internalUpdateState(){const n=this.context.renderer.xr.getReferenceSpace();if(!n){this._viewerPose=void 0;return}if(this._viewerPose=this.frame.getViewerPose(n),this._viewerPose){const e=this._viewerPose.transform;this._transformPosition.set(e.position.x,e.position.y,e.position.z),this._transformOrientation.set(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w)}}get transition(){return this._transition||(this._transition=new Zee),this._transition}fadeTransition(){return this._transition||(this._transition=new Zee),this._transition.fadeTransition()}updateFade(n){this._transition&&n instanceof Ot&&this._transition.update(n,this.context.time.deltaTime)}onUpdateFade_PostRender(){var n;(n=this._transition)==null||n.remove()}};let Qt=jm;m(Qt,"_sync",null),m(Qt,"_currentSessionRequestMode",null),m(Qt,"_currentSessionRequest"),m(Qt,"_activeSession"),m(Qt,"_sessionRequestStartListeners",[]),m(Qt,"_sessionRequestEndListeners",[]),m(Qt,"_xrStartListeners",[]),m(Qt,"_xrEndListeners",[]),m(Qt,"_controllerAddedListeners",[]),m(Qt,"_controllerRemovedListeners",[]),m(Qt,"onEnd",()=>{Hr&&console.log("XR Session ended"),jm._activeSession=null});const Iz=q("debugwebxr");class ote{static tryFindAvatarObjects(e,i,s){if(s.head&&s.leftHand&&s.rightHand)return;const r=e.name.toLocaleLowerCase();!s.head&&r.includes("head")&&(Iz&&console.log("FOUND AVATAR HEAD",e.name),s.head=new Mi("",i,e)),r.includes("hand")&&(!s.leftHand&&r.includes("left")&&(Iz&&console.log("FOUND AVATAR LEFT HAND",e.name),s.leftHand=new Mi("",i,e)),!s.rightHand&&r.includes("right")&&(Iz&&console.log("FOUND AVATAR RIGHT HAND",e.name),s.rightHand=new Mi("",i,e)));for(let o=0;o<e.children.length;o++){if(s.head&&s.leftHand&&s.rightHand)return;const a=e.children[o];this.tryFindAvatarObjects(a,i,s)}}}const na=new E,ate=new E,lte=new Fe,vBe=q("debuggizmos"),kh=8947848,Tz=32,Gh=class{constructor(){}static isGizmo(n){return n[Rz]!==void 0}static DrawLabel(n,e,i=.05,s=0,r,o,a){var l;if(!Gh.enabled)return null;r||(r=kh);const c=((l=Qt.active)==null?void 0:l.rigScale)??1,h=jn.getTextLabel(s,e,i*c,r,o);return a instanceof Ae&&a.add(h),h.position.x=n.x,h.position.y=n.y,h.position.z=n.z,h}static DrawRay(n,e,i=kh,s=0,r=!0){if(!Gh.enabled)return;const o=jn.getLine(s),a=o.geometry.getAttribute("position");a.setXYZ(0,n.x,n.y,n.z),na.set(e.x,e.y,e.z).multiplyScalar(999999999),a.setXYZ(1,n.x+na.x,n.y+na.y,n.z+na.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawDirection(n,e,i=kh,s=0,r=!0,o=1){if(!Gh.enabled)return;const a=jn.getLine(s),l=a.geometry.getAttribute("position");l.setXYZ(0,n.x,n.y,n.z),e.w!==void 0?(na.set(0,0,-o),lte.set(e.x,e.y,e.z,e.w),na.applyQuaternion(lte)):(na.set(e.x,e.y,e.z),na.multiplyScalar(o)),l.setXYZ(1,n.x+na.x,n.y+na.y,n.z+na.z),l.needsUpdate=!0,a.material.color.set(i),a.material.depthTest=r,a.material.depthWrite=!1}static DrawLine(n,e,i=kh,s=0,r=!0){if(!Gh.enabled)return;const o=jn.getLine(s),a=o.geometry.getAttribute("position");a.setXYZ(0,n.x,n.y,n.z),a.setXYZ(1,e.x,e.y,e.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1,o.material.fog=!1}static DrawCircle(n,e,i,s=kh,r=0,o=!0){if(!Gh.enabled)return;const a=jn.getCircle(r);a.position.set(n.x,n.y,n.z),a.scale.set(i,i,i),a.quaternion.setFromUnitVectors(this._up,na.set(e.x,e.y,e.z).normalize()),a.material.color.set(s),a.material.depthTest=o,a.material.depthWrite=!1,a.material.fog=!1}static DrawWireSphere(n,e,i=kh,s=0,r=!0){if(!Gh.enabled)return;const o=jn.getSphere(e,s,!0);o0(o,n.x,n.y,n.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1,o.material.fog=!1}static DrawSphere(n,e,i=kh,s=0,r=!0){if(!Gh.enabled)return;const o=jn.getSphere(e,s,!1);o0(o,n.x,n.y,n.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawWireBox(n,e,i=kh,s=0,r=!0){if(!Gh.enabled)return;const o=jn.getBox(s);o.position.set(n.x,n.y,n.z),o.scale.set(e.x,e.y,e.z),o.material.color.set(i),o.material.depthTest=r,o.material.wireframe=!0,o.material.depthWrite=!1,o.material.fog=!1}static DrawWireBox3(n,e=kh,i=0,s=!0){if(!Gh.enabled)return;const r=jn.getBox(i);r.position.copy(n.getCenter(na)),r.scale.copy(n.getSize(na)),r.material.color.set(e),r.material.depthTest=s,r.material.wireframe=!0,r.material.depthWrite=!1,r.material.fog=!1}static DrawArrow(n,e,i=kh,s=0,r=!0,o=!1){if(!Gh.enabled)return;const a=jn.getArrowHead(s);a.position.set(e.x,e.y,e.z),a.quaternion.setFromUnitVectors(this._up.set(0,1,0),na.set(e.x,e.y,e.z).sub(ate.set(n.x,n.y,n.z)).normalize());const l=na.set(e.x,e.y,e.z).sub(ate.set(n.x,n.y,n.z)).length()*.1;a.scale.set(l,l,l),a.material.color.set(i),a.material.depthTest=r,a.material.wireframe=o,this.DrawLine(n,e,i,s,r)}static DrawWireMesh(n){const e=jn.getMesh(n.duration??0);"mesh"in n?(e.geometry=n.mesh.geometry,e.matrix.copy(n.mesh.matrixWorld)):(e.geometry=n.geometry,e.matrix.copy(n.matrix)),e.matrixAutoUpdate=!1,e.matrixWorldAutoUpdate=!1,e.material.color.set(n.color??kh),e.material.depthTest=n.depthTest??!0,e.material.wireframe=!0}static setVisible(n){for(const e of jn.timedObjectsBuffer)e.visible=n}};let Nt=Gh;m(Nt,"enabled",!0),m(Nt,"_up",new E(0,1,0));const xBe=new bn(1,1,1);function Ez(n=null){const e=new fe(n??14540253),i=new LP(xBe);return new Jo(i,new Cn({color:e}))}const Rz=Symbol("GizmoCache");class jn{static ensureFont(){let e=Bn.FontLibrary.getFontFamily(this.familyName);if(!e){e=Bn.FontLibrary.addFontFamily(this.familyName);const i=e.addVariant("normal","normal","https://uploads.needle.tools/include/font-msdf.json","https://uploads.needle.tools/include/font.png");i?.addEventListener("ready",()=>{Bn.update()})}}static getTextLabel(e,i,s,r,o){this.ensureFont();let a=this.textLabelCache.pop(),l=1;o&&typeof o=="string"&&o?.length>=8&&o.startsWith("#")?(l=parseInt(o.substring(7),16)/255,o=o.substring(0,7),vBe&&console.log(o,l)):typeof o=="object"&&o.a!==void 0&&(l=o.a);const c={boxSizing:"border-box",fontFamily:this.familyName,width:"auto",fontSize:s,color:r,lineHeight:1,backgroundColor:o??void 0,backgroundOpacity:l,textContent:i,borderRadius:.5*s,padding:.8*s,whiteSpace:"pre",offset:.05*s};if(a)a.set(c);else{a=new $X(c);const h=this,d=a;d.setText=function(u){this.set({textContent:u}),h.tmuiNeedsUpdate=!0}}return this.tmuiNeedsUpdate=!0,this.registerTimedObject($t.Current,a,e,this.textLabelCache),a}static getBox(e){let i=this.boxesCache.pop();if(!i){const s=new bn(1,1,1);i=new pe(s)}return this.registerTimedObject($t.Current,i,e,this.boxesCache),i}static getLine(e){let i=this.linesCache.pop();if(!i){i=new is;let s=i.geometry.getAttribute("position");s||(s=new ct(new Float32Array(2*3),3),i.geometry.setAttribute("position",s))}return i.frustumCulled=!1,this.registerTimedObject($t.Current,i,e,this.linesCache),i}static getCircle(e){let i=this.circlesCache.pop();if(!i){i=new is;let s=i.geometry.getAttribute("position");if(!s){s=new ct(new Float32Array(Tz*3),3),i.geometry.setAttribute("position",s);const r=Lt(0,1,0),o=Lt(0,0,1),a=Lt(o);a.cross(r).normalize();const l=Lt(a),c=Math.PI*2/(Tz-1);for(let h=0;h<Tz+1;h++){const d=c*h;r.copy(l).multiplyScalar(Math.cos(d)*1),a.copy(o).multiplyScalar(Math.sin(d)*1);const u=r.add(a);s.setXYZ(h,u.x,u.y,u.z)}}}return i.frustumCulled=!1,this.registerTimedObject($t.Current,i,e,this.circlesCache),i}static getSphere(e,i,s){let r=this.spheresCache.pop();return r||(r=new pe(new eh(1,8,8))),r.scale.set(e,e,e),r.material.wireframe=s,this.registerTimedObject($t.Current,r,i,this.spheresCache),r}static getArrowHead(e){let i=this.arrowHeadsCache.pop();return i||(i=new pe(new js(0,.5,1,8))),this.registerTimedObject($t.Current,i,e,this.arrowHeadsCache),i}static getMesh(e){let i=this.mesh.pop();return i||(i=new pe,i.material=new ai),this.registerTimedObject($t.Current,i,e,this.mesh),i}static registerTimedObject(e,i,s,r){if(!e){console.error("No Needle Engine context available. Did you call a Gizmos function in global scope?");return}const o=this.contextBeforeRenderCallbacks.get(e),a=this.contextPostRenderCallbacks.get(e);if(o){if(e.pre_render_callbacks[e.pre_render_callbacks.length-1]!==o){const l=e.pre_render_callbacks.indexOf(o);l>=0&&e.pre_render_callbacks.splice(l,1),e.pre_render_callbacks.push(o)}}else{const l=()=>{this.onBeforeRender(e,this.timedObjectsBuffer)};this.contextBeforeRenderCallbacks.set(e,l),e.pre_render_callbacks.push(l)}if(a){if(e.post_render_callbacks[e.post_render_callbacks.length-1]!==a){const l=e.post_render_callbacks.indexOf(a);l>=0&&e.post_render_callbacks.splice(l,1),e.post_render_callbacks.push(a)}}else{const l=()=>{this.onPostRender(e,this.timedObjectsBuffer,this.timesBuffer)};this.contextPostRenderCallbacks.set(e,l),e.post_render_callbacks.push(l)}i.traverse(l=>{l.layers.disableAll(),l.layers.enable(2)}),i.renderOrder=999999,i[Rz]=r,i.castShadow=!1,i.receiveShadow=!1,i.isGizmo=!0,this.timedObjectsBuffer.push(i),this.timesBuffer.push($t.Current.time.realtimeSinceStartup+s),e.scene.add(i)}static onBeforeRender(e,i){this.tmuiNeedsUpdate&&(this.tmuiNeedsUpdate=!1,Bn.update());for(let s=0;s<i.length;s++){const r=i[s];if(e.mainCamera&&r instanceof Bn.MeshUIBaseElement){if(G0(r))continue;const o=e.isInVR,a=!1,l=!o;xw(r,e.mainCamera,a,l)}}}static onPostRender(e,i,s){const r=e.time.realtimeSinceStartup;for(let o=i.length-1;o>=0;o--){const a=i[o];r>=s[o]-1e-6&&(i.splice(o,1),s.splice(o,1),a.removeFromParent(),G0(a)!=!0&&a[Rz].push(a))}}}m(jn,"familyName","needle-gizmos"),m(jn,"linesCache",[]),m(jn,"circlesCache",[]),m(jn,"spheresCache",[]),m(jn,"boxesCache",[]),m(jn,"arrowHeadsCache",[]),m(jn,"mesh",[]),m(jn,"textLabelCache",[]),m(jn,"timedObjectsBuffer",new Array),m(jn,"timesBuffer",new Array),m(jn,"contextPostRenderCallbacks",new Map),m(jn,"contextBeforeRenderCallbacks",new Map),m(jn,"tmuiNeedsUpdate",!1);const Fl=q("debugphysics"),cte=new Qo;class Rd{constructor(){m(this,"ray"),m(this,"cam"),m(this,"screenPoint"),m(this,"raycaster"),m(this,"results"),m(this,"targets"),m(this,"recursive",!0),m(this,"minDistance"),m(this,"maxDistance"),m(this,"lineThreshold"),m(this,"layerMask"),m(this,"ignore"),m(this,"testObject"),m(this,"useAcceleratedRaycast")}screenPointFromOffset(e,i){this.screenPoint===void 0&&(this.screenPoint=new Q),this.screenPoint.x=e/window.innerWidth*2-1,this.screenPoint.y=-(i/window.innerHeight)*2+1}setLayer(e){cte.set(e),this.layerMask=cte}setMask(e){this.layerMask||(this.layerMask=new Qo);const i=this.layerMask;i?i.mask=e:this.layerMask=e}}m(Rd,"AllLayers",4294967295);class Lz{constructor(e,i,s){m(this,"distance"),m(this,"point"),m(this,"object"),this.object=e,this.distance=i,this.point=s}}const Bz=class{constructor(n){m(this,"context"),m(this,"engine"),m(this,"raycaster",new pm),m(this,"defaultRaycastOptions",new Rd),m(this,"targetBuffer",new Array(1)),m(this,"defaultThresholds",{Mesh:{},Line:{threshold:-1},LOD:{},Points:{threshold:0},Sprite:{}}),m(this,"sphereResults",new Array),m(this,"sphereMask",new Qo),m(this,"sphere",new Vn),m(this,"tempBoundingBox",new gi),this.context=n}static get raycasting(){return this._raycasting>0}raycastPhysicsFast(n,e=void 0,i=1/0,s=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycast(n,e,{maxDistance:i,solid:s}))??null}raycastPhysicsFastAndGetNormal(n,e=void 0,i=1/0,s=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycastAndGetNormal(n,e,{maxDistance:i,solid:s}))??null}sphereOverlapPhysics(n,e){var i;return((i=this.context.physics.engine)==null?void 0:i.sphereOverlap(n,e))??null}sphereOverlap(n,e,i=!0,s=!1,r=null){if(this.sphereResults.length=0,!this.context.scene)return this.sphereResults;const o=this.sphereMask;o.enableAll(),o.disable(2);for(const a of this.context.scene.children)this.intersectSphere(a,n,e,o,this.sphereResults,i,s,r);return this.sphereResults.sort((a,l)=>a.distance-l.distance)}raycastFromRay(n,e=null){const i=e??this.defaultRaycastOptions;i.ray=n;const s=this.raycast(i);return i===this.defaultRaycastOptions&&(i.ray=void 0),s}raycast(n=null){Fl&&performance.mark("raycast.start"),n||(n=this.defaultRaycastOptions);const e=n.screenPoint??this.context.input.mousePositionRC,i=n.raycaster??this.raycaster;if(i.near=n.minDistance??0,i.far=n.maxDistance??1/0,i.params=this.defaultThresholds,n.lineThreshold===void 0&&(n.lineThreshold=-1),i.params.Line={threshold:n.lineThreshold},n.ray)i.ray.copy(n.ray);else{const a=n.cam??this.context.mainCamera;if(!a)return Fl&&console.error("Can not perform raycast - no main camera found"),this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),this.defaultRaycastOptions.results??[];const l=this.context.xrCamera;this.context.isInXR&&l instanceof sP&&l.cameras.length>0?i.setFromCamera(e,l.cameras[0]):i.setFromCamera(e,a)}let s=n.targets;s||(s=this.targetBuffer,s.length=1,s[0]=this.context.scene);let r=n.results;this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),r||(this.defaultRaycastOptions.results||(this.defaultRaycastOptions.results=new Array),r=this.defaultRaycastOptions.results),n.layerMask!==void 0?n.layerMask instanceof Qo?i.layers.mask=n.layerMask.mask:i.layers.mask=n.layerMask:(i.layers.enableAll(),i.layers.disable(2)),Fl&&console.time("raycast"),r.length=0,Bz._raycasting++,this.intersect(this.raycaster,s,r,n),r.sort((a,l)=>a.distance-l.distance);const o=n.ignore;return o!==void 0&&o.length>0&&(r=r.filter(a=>!o.includes(a.object))),Bz._raycasting--,Fl&&(console.timeEnd("raycast"),console.warn("#"+this.context.time.frame+", hits:",r!=null&&r.length?[...r]:"nothing"),performance.mark("raycast.end"),performance.measure("raycast","raycast.start","raycast.end")),r}intersect(n,e,i,s){var r,o,a;for(const l of e){if(!l||l.visible===!1||Nt.isGizmo(l)||s.lineThreshold!==void 0&&s.lineThreshold<0&&l instanceof is)continue;let c=!0;const h=l,d=h.geometry;if(s.testObject){const u=(r=s.testObject)==null?void 0:r.call(s,l);if(u===!1)continue;u==="continue in children"&&(c=!1)}if(c&&(d&&hte(d)||(c=!1)),c){const u=iC(l);u&&(h.geometry=u);const p=i.length;let g=!0;if(s.precise===!1&&(g=!1),g||(g=((a=(o=d.getAttribute("position"))==null?void 0:o.array)==null?void 0:a.length)<64),h instanceof tb&&(g=!1),!g&&CBe(h,n,i)||(s.useAcceleratedRaycast!==!1?c2.runMeshBVHRaycast(n,h,i,this.context):n.intersectObject(h,!1,i)),Fl&&i.length!=p){const f=i[i.length-1],A=u?8969557:7798784;Nt.DrawWireSphere(f.point,.1,A,1,!1),Nt.DrawWireMesh({mesh:l,depthTest:!1,duration:.2,color:A})}h.geometry=d}s.recursive!==!1&&this.intersect(n,l.children,i,s)}return i}intersectSphere(n,e,i,s,r,o,a,l){let c=n&&n.isMesh&&n.layers.test(s)&&!Nt.isGizmo(n);c&&(c=n.visible),c&&(c=!(n instanceof is)),c&&(c=!(n instanceof tb));const h=n,d=h.geometry;if(c&&l){const u=l(n);if(u===!1)return;u==="continue in children"&&(c=!1)}if(d&&hte(d)||(c=!1),c){if(a){const u=this.sphere;u.center.copy(e),u.radius=i;const p=r.length;if(c2.runMeshBVHRaycast(this.sphere,h,r,this.context),p!=r.length&&!o)return}else if(d.boundingBox||d.computeBoundingBox(),d.boundingBox){h.matrixWorldNeedsUpdate&&h.updateWorldMatrix(!1,!1);const u=this.tempBoundingBox.copy(d.boundingBox).applyMatrix4(h.matrixWorld),p=this.sphere;if(p.center.copy(e),p.radius=i,p.intersectsBox(u)){const g=ri(n),f=g.distanceTo(p.center),A=new Lz(n,f,g);if(r.push(A),!o)return}}}if(n.children)for(const u of n.children){const p=r.length;if(this.intersectSphere(u,e,i,s,r,o,a,l),p!=r.length&&!o)return}}};let a2=Bz;m(a2,"_raycasting",0);function hte(n){return!(n.index&&n.index.array.length<3)}const I0=new Vn,l2=new tr,wBe=new oi;function CBe(n,e,i){const s=n._computeIntersections;if(!s)return!1;let r=n["_computeIntersections:Needle"];return r||(r=n["_computeIntersections:Needle"]=function(o,a,l){const c=this,h=c.geometry.boundingSphere;if(h){if(c instanceof tb){l2.setFromNormalAndCoplanarPoint(Lt(0,1,0),Lt(0,-c.position.y,0)),l2.applyMatrix4(c.matrixWorld,wBe);const u=o.ray.intersectPlane(l2,Lt());if(u){I0.copy(h),I0.applyMatrix4(c.matrixWorld);const p=Lt(u).sub(o.ray.origin).length(),g=I0.radius*.5;p<g&&a.push({distance:p,point:u,object:c,normal:l2.normal.clone()})}return}I0.copy(h),I0.applyMatrix4(c.matrixWorld);const d=o.ray.intersectSphere(I0,Lt());if(d){const u=Lt(d).sub(o.ray.origin),p=u.length();if(p>I0.radius){const g=u.clone().normalize();a.push({distance:p,point:d,object:c,normal:g})}}}}),n._computeIntersections=r,e.intersectObject(n,!1,i),n._computeIntersections=s,!0}var c2;(n=>{function e(b,v,x,w){var C,S,_;if(!v.geometry||!v.geometry.hasAttribute("position"))return!1;const I=v.geometry;if(v!=null&&v.isSkinnedMesh){const B=v,M=B.bvhNeedsUpdate;if(!B.staticGenerator)l(),o&&(B.staticGenerator=new o(v),B.staticGenerator.applyWorldTransforms=!1,B.staticGeometry=B.staticGenerator.generate(),I.boundsTree=a?.call(B.staticGeometry),B.staticGeometryLastUpdate=performance.now()+Math.random()*200,B.autoUpdateMeshBVH===void 0&&(B.autoUpdateMeshBVH=!1));else if(I.boundsTree&&(B.autoUpdateMeshBVH===!0||M===!0)){const R=performance.now(),k=R-B.staticGeometryLastUpdate;(M||k>100)&&(B.bvhNeedsUpdate=!1,B.staticGeometryLastUpdate=R,(C=B.staticGenerator)==null||C.generate(B.staticGeometry),I.boundsTree.refit())}}else if(!I.boundsTree){h||y();let B=!0;if((w.xr||I[g]===!1||(S=I.getAttribute("position"))!=null&&S.isInterleavedBufferAttribute||I.index&&(_=I.index)!=null&&_.isInterleavedBufferAttribute)&&(B=!1),B&&u){if(I[p]===void 0){let M=null;if(A.length>0){const R=A.shift();R&&!R.running&&(M=R)}if(!M&&f.length<3&&(M=new u,f.push(M)),M!=null&&!M.running){const R=v.name;Fl&&console.log("<<<< worker start",R,M),I[p]="queued",performance.mark("bvh.create.start");const k=I.clone();try{M.generate(k).then(G=>{I[p]="done",I.boundsTree=G}).catch(G=>{I[p]="failed - "+G?.message,I[g]=!1,Fl&&console.error("Failed to generate mesh bvh on worker",G)}).finally(()=>{Fl&&console.log(">>>>> worker done",R,{hasBoundsTre:I.boundsTree!=null}),A.push(M),k.dispose(),performance.mark("bvh.create.end"),performance.measure("bvh.create (worker)","bvh.create.start","bvh.create.end")})}catch(G){console.error("Failed to generate mesh bvh on worker",G)}}else Fl&&console.warn("No worker available")}}else(!d||!B)&&(l(),r&&(performance.mark("bvh.create.start"),I.boundsTree=new r(I),performance.mark("bvh.create.end"),performance.measure("bvh.create","bvh.create.start","bvh.create.end")))}if(b instanceof pm){const B=b,M=v.raycast;I.boundsTree?(l(),s&&(v.acceleratedRaycast||(v.acceleratedRaycast=s.bind(v),Fl&&console.debug(`Physics: bind acceleratedRaycast fn to "${v.name}"`)),v.raycast=v.acceleratedRaycast)):Fl&&console.warn("No bounds tree found for mesh",v.name,{workerTask:I[p],hasAcceleratedRaycast:s!=null});const R=B.firstHitOnly;return B.firstHitOnly=!1,B.intersectObject(v,!1,x),B.firstHitOnly=R,v.raycast=M,!0}else if(b instanceof Vn){const B=I.boundsTree;if(B){const M=b;if(c.copy(v.matrixWorld).invert(),M.applyMatrix4(c),B.intersectsSphere(M)){const R=ri(v),k=R.distanceTo(M.center),G=new Lz(v,k,R);x.push(G)}}return!0}return!1}n.runMeshBVHRaycast=e;let i=!1,s=null,r=null,o=null,a=null;function l(){i||(i=!0,Promise.resolve().then(()=>IWe).then(b=>{s=b.acceleratedRaycast,r=b.MeshBVH,o=b.StaticGeometryGenerator,a=b.computeBoundsTree}).catch(b=>{(Fl||Je())&&console.error("Failed to load BVH library...",b.message)}))}const c=new de;let h=!1,d=!1,u=null;const p=Symbol("Needle:MeshBVH-Worker"),g=Symbol("Needle:MeshBVH-CanUseWorker"),f=[],A=[];function y(){h=!0,d=!0,Promise.resolve().then(()=>LWe).then(b=>{u=b.GenerateMeshBVHWorker}).catch(b=>{(Fl||Je())&&console.warn("Failed to setup mesh bvh worker")}).finally(()=>{d=!1})}})(c2||(c2={}));const dte=Symbol("gltf-loader-internal-usage-tracker"),SBe=q("debugusers"),h2=class{constructor(n){m(this,"parser"),m(this,"_getDependency"),m(this,"_loadingId"),m(this,"_loadedObjects",new Set),this.parser=n,this._getDependency=this.parser.getDependency,this._loadingId=Date.now().toString()}get name(){return"NEEDLE_internal_usage_tracker"}static isLoading(n){return h2._loadingProcesses>0}beforeRoot(){h2._loadingProcesses++;const n=this,e=this._getDependency;return this.parser.getDependency=function(i,s){const r=e.call(this,i,s);return r.then(o=>(o&&(n._loadedObjects.add(o),o[dte]=n._loadingId),o)),r},null}afterRoot(n){h2._loadingProcesses--,this.parser.getDependency=this._getDependency;for(const e of this._loadedObjects)delete e[dte],e instanceof Ae&&(e.parent||e instanceof pe&&setTimeout(()=>{SBe&&console.warn("> GLTF LOADER: Mesh not used in scene!",e),e.material=null,e.geometry=null},1e3));return null}};let kz=h2;m(kz,"_loadingProcesses",0);class ute{constructor(){window.addEventListener("unhandledrejection",e=>{var i;if(e.defaultPrevented)return;const s=(i=e?.reason)==null?void 0:i.path;if(s){const r=s[0];r&&r.tagName==="IMG"&&(console.warn(`Could not load image:
`+r.src),e.preventDefault())}})}}const d2=q("trackresources");function pte(){return d2==="dispose"}let T0=!0;d2===0&&(T0=!1);function _Be(n){T0=n}function mte(){return T0}const gte=Symbol("disposable");function Gz(n,e){n&&(n[gte]=e,E0&&console.warn("Set disposable",e,n))}const fte=Symbol("disposed");function MBe(n){return n[fte]===!0}function zn(n){var e;if(n){if(n[gte]===!1){E0&&console.warn("Object is marked as not disposable",n);return}if(n[fte]=!0,n instanceof ir)zn(n.environment),zn(n.background),zn(n.customDepthMaterial),zn(n.customDistanceMaterial);else if(n instanceof Ka)zn(n.geometry),zn(n.material),zn(n.skeleton),zn(n.bindMatrix),zn(n.bindMatrixInverse),zn(n.customDepthMaterial),zn(n.customDistanceMaterial),n.geometry=null,n.material=null,n.visible=!1;else if(n instanceof pe)zn(n.geometry),zn(n.material),zn(n.customDepthMaterial),zn(n.customDistanceMaterial),n.geometry=null,n.material=null,n.visible=!1;else if(n instanceof Rt){Ub(n);for(const i of Object.keys(n.attributes)){const s=n.attributes[i];zn(s)}}else if(n instanceof ct||n instanceof xa)E0&&console.warn("BufferAttribute dispose not supported",n.count);else if(n instanceof Array)for(const i of n)i instanceof ti&&zn(i);else if(n instanceof ti){Ub(n);for(const s of Object.keys(n)){const r=n[s];r instanceof di&&(zn(r),n[s]=null)}const i=n.uniforms;if(i)for(const s of Object.keys(i)){const r=i[s];r instanceof di?(zn(r),i[s]=null):r instanceof Te&&(zn(r.value),r.value=null)}}else n instanceof di?(Ub(n),Ub(n.source),((e=n.source)==null?void 0:e.data)instanceof ImageBitmap&&Ub(n.source.data)):n instanceof l1?(Ub(n.boneTexture),n.boneTexture=null):n instanceof Tf||!(n instanceof Ae)&&E0&&console.warn("Unknown object type",n)}}function Ub(n){n&&((E0||pte()||d2)&&console.warn("\u{1F9E8} FREE",n),n instanceof ImageBitmap?n.close():n instanceof wu?n.data=null:n.dispose())}function Ate(n){(n instanceof pe||n instanceof Ka)&&(n.material=null,n.geometry=null)}const IBe=new Set;function Pz(n,e,i=null,s){if(s||(s=IBe,s.clear()),!n)return s;const r=n[yC];if(r)for(const o of r)s.has(o)||i?.call(null,o)!==!1&&(s.add(o),e&&Pz(o,!0,i,s));return s}function TBe(n){return n[bC]}const E0=q("debugresourceusers")||q("debugmemory"),yC=Symbol("needle-resource-users"),bC=Symbol("needle-resource-users-count");function La(n,e){nR(n,e,function(i,s){T0&&!a2.raycasting&&(u2(yC,this,i,!1),u2(yC,this,s,!0))})}T0&&(La(pe.prototype,"material"),La(pe.prototype,"geometry"),La(ti.prototype,"map"),La(ti.prototype,"bumpMap"),La(ti.prototype,"alphaMap"),La(ti.prototype,"normalMap"),La(ti.prototype,"displacementMap"),La(ti.prototype,"roughnessMap"),La(ti.prototype,"metalnessMap"),La(ti.prototype,"emissiveMap"),La(ti.prototype,"specularMap"),La(ti.prototype,"envMap"),La(ti.prototype,"lightMap"),La(ti.prototype,"aoMap"),La(ti.prototype,"gradientMap"));function EBe(n){if(T0===!1)return;const e=n[yC];if(e)for(const i of e)u2(yC,i,n,!1)}T0&&nR(ti.prototype,"dispose",function(){EBe(this)});let Nz=0;function u2(n,e,i,s){if(Nz>0)return;if(Array.isArray(i)){for(const o of i)u2(n,e,o,s);return}if(!i)return;let r=i[n];if(r||(r=new Set),s){if(e&&!r.has(e)){r.add(e);let o=i[bC]||0;o+=1,i[bC]=o,E0&&console.warn(`\u{1F7E2} Added user of "${i.type}"`,e,i,o,"users:",r)}}else if(e&&r.has(e)){r.delete(e);let o=i[bC]||0;o>0&&(o-=1,i[bC]=o),E0&&console.warn(`\u{1F534} Removed user of "${i.type}"`,e,i,o,"users:",r),o<=0&&(kz.isLoading(i)||(d2&&console.warn(`\u{1F534} Removed all user of "${i.type}"`,i),pte()&&zn(i)))}i[n]=r}try{nR(om.prototype,"render",function(){Nz++},function(){Nz--})}catch(n){console.warn("Could not wrap WebGLRenderer.render",n)}const yte=q("debugcomponentevents");class vC{static addComponentLifecylceEventListener(e,i){this.eventListeners.has(e)&&this.eventListeners.set(e,[]);let s=this.eventListeners.get(e);s||(s=[]),s.push(i),this.eventListeners.set(e,s),yte&&console.log("Added event listener for "+e,this.eventListeners)}static removeComponentLifecylceEventListener(e,i){const s=this.eventListeners.get(e);if(!s)return;const r=s.indexOf(i);r<0||s.splice(r,1)}static dispatchComponentLifecycleEvent(e,i){const s=this.eventListeners.get(e);if(yte&&console.log("Dispatching event "+e,s),!!s)for(const r of s)r(i)}}m(vC,"eventListeners",new Map);const xC=Symbol("NEEDLE_NEED_UPDATE_INSTANCE"),bte=Symbol("isUsingInstancing"),vte=Symbol("instancingRenderer"),wC=Symbol("instancingAutoUpdateBounds");class ih{static isUsingInstancing(e){return e[bte]===!0}static getRenderer(e){return e[vte]||null}setAutoUpdateBounds(e,i){const s=ih.getRenderer(e);s&&(s[wC]=i)}static markDirty(e,i=!0){if(e&&(this.isUsingInstancing(e)&&(e[xC]=!0,e.matrixWorldNeedsUpdate=!0),i))for(const s of e.children)ih.markDirty(s,!0)}}function Ob(n,e){try{e?n(e):n()}catch(i){return console.error(i),!1}return!0}const Vz=q("debugnewscripts"),RBe=q("debughierarchy"),os=[];function LBe(){return os.length>0}function p2(n){if(!(n.new_scripts.length<=0)){if(Vz&&console.log("Register new components",n.new_scripts.length,[...n.new_scripts],n.alias?"element: "+n.alias:n.hash,n),n.new_scripts_pre_setup_callbacks.length>0){for(const e of n.new_scripts_pre_setup_callbacks)e&&e();n.new_scripts_pre_setup_callbacks.length=0}os.length=0,n.new_scripts.length>0&&os.push(...n.new_scripts),n.new_scripts.length=0;for(let e=0;e<os.length;e++)try{const i=os[e];if(i.isComponent!==!0){(Je()||Vz)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,i),os.splice(e,1),e--;continue}if(i.destroyed)continue;if(!i.gameObject){console.warn(`Component can not be initialized: no GameObject assigned.
Did you add and remove a component in the same frame?`),os.splice(e,1),e--;continue}i.context=n,CC(i.gameObject),Xz(i,n)}catch(i){console.error(i),sp(os[e],n),os.splice(e,1),e--}for(let e=0;e<os.length;e++)try{const i=os[e];if(i.destroyed){sp(os[e],n),os.splice(e,1),e--;continue}if(i.registering)try{i.registering()}catch(s){console.error(s)}i.__internalAwake!==void 0&&(i.gameObject||console.error("Calling awake for a component without a GameObject",i,i.gameObject),CC(i.gameObject),i.activeAndEnabled&&Ob(i.__internalAwake.bind(i)))}catch(i){console.error(i),sp(os[e],n),os.splice(e,1),e--}for(let e=0;e<os.length;e++)try{const i=os[e];if(i.destroyed||i.enabled===!1||(CC(i.gameObject),i.activeAndEnabled===!1))continue;i.__internalEnable!==void 0&&(i.enabled=!0,Ob(i.__internalEnable.bind(i)))}catch(i){console.error(i),sp(os[e],n),os.splice(e,1),e--}for(let e=0;e<os.length;e++)try{const i=os[e];if(i.destroyed||!i.gameObject)continue;n.new_script_start.push(i)}catch(i){console.error(i),sp(os[e],n),os.splice(e,1),e--}os.length=0;for(const e of n.new_scripts_post_setup_callbacks)e&&e();n.new_scripts_post_setup_callbacks.length=0}}function BBe(n){n&&(n.__internalDisable(!0),sp(n,n.context))}function xte(n,e){for(let i=0;i<n.new_script_start.length;i++)try{const s=n.new_script_start[i];if(e!==void 0&&s.gameObject!==e||s.destroyed||s.activeAndEnabled===!1)continue;Ob(s.__internalAwake.bind(s)),s.enabled&&(Ob(s.__internalEnable.bind(s)),Ob(s.__internalStart.bind(s)),n.new_script_start.splice(i,1),i--)}catch(s){console.error(s),sp(n.new_script_start[i],n),n.new_script_start.splice(i,1),i--}}function Xz(n,e){e.scripts.indexOf(n)===-1&&(e.scripts.push(n),n.earlyUpdate&&e.scripts_earlyUpdate.push(n),n.update&&e.scripts_update.push(n),n.lateUpdate&&e.scripts_lateUpdate.push(n),n.onBeforeRender&&e.scripts_onBeforeRender.push(n),n.onAfterRender&&e.scripts_onAfterRender.push(n),n.onPausedChanged&&e.scripts_pausedChanged.push(n),Dz(n,null)&&e.new_scripts_xr.push(n),Dz(n,"immersive-vr")&&e.scripts_immersive_vr.push(n),Dz(n,"immersive-ar")&&e.scripts_immersive_ar.push(n))}function sp(n,e){Pc(n,e.new_scripts),Pc(n,e.new_script_start),Pc(n,e.scripts),Pc(n,e.scripts_earlyUpdate),Pc(n,e.scripts_update),Pc(n,e.scripts_lateUpdate),Pc(n,e.scripts_onBeforeRender),Pc(n,e.scripts_onAfterRender),Pc(n,e.scripts_pausedChanged),Pc(n,e.new_scripts_xr),Pc(n,e.scripts_immersive_vr),Pc(n,e.scripts_immersive_ar),e.stopAllCoroutinesFrom(n)}function Pc(n,e){const i=e.indexOf(n);i>=0&&e.splice(i,1)}function Dz(n,e){var i;if(n){const s=n;if(s.onBeforeXR||s.onEnterXR||s.onUpdateXR||s.onLeaveXR||s.onXRControllerAdded||s.onXRControllerRemoved)return!(e!=null&&((i=s.supportsXR)==null?void 0:i.call(s,e))===!1)}return!1}function m2(n){if(n||(n=ji.Current.scene),!n){console.trace("Invalid call - no current context.");return}const e=Qb(n);wte(n,e,!0)||(Vz||Je()?console.error(`Error updating hierarchy
Do you have circular references in your project? <a target="_blank" href="https://docs.needle.tools/circular-reference"> Click here for more information.`,n):console.error('Failed to update active state in hierarchy of "'+n.name+'"',n),console.warn(" \u2191 this error might be caused by circular references. Please make sure you don't have files with circular references (e.g. one GLB 1 is loading GLB 2 which is then loading GLB 1 again)."))}function wte(n,e,i,s=0){if(s>1e3)return console.warn("Hierarchy is too deep (> 1000 level) - will abort updating active state"),!1;const r=Qb(n);if(e&&(e=r,e&&n.parent)){const l=n.parent;e=l[Du],e===void 0&&(l instanceof ir||(e=!0))}const o=n[Du]!==e;n[Du]=e,o&&(RBe&&console.warn("ACTIVE CHANGE",n.name,r,n.visible,e,"changed?"+o,n),i&&kBe(n,l=>{e?l.enabled&&(Ob(l.__internalAwake.bind(l)),l.enabled&&(l.__didEnable=!0,l.onEnable())):l.__didAwake&&l.enabled&&(l.__didEnable=!1,l.onDisable())}));let a=!0;if(n.children){const l=s+1;for(const c of n.children)wte(c,e,i,l)===!1&&(a=!1)}return a}function CC(n){let e=!0,i=n,s=!1;for(;i&&i;){if(i.type==="Scene"&&(s=!0),!Qb(i)){e=!1;break}i=i.parent}if(!n){console.error("GO is null");return}n[Du]=e&&s}function kBe(n,e){var i;if((i=n.userData)!=null&&i.components)for(const s of n.userData.components)e(s)}const g2=new Map,Cte=Symbol("prewarmFlag"),zz=Symbol("waitingForPrewarm"),Fz=q("debugprewarm");function GBe(n,e){!n||n[Cte]===!0||n[zz]===!0||(g2.has(e)||g2.set(e,[]),n[zz]=!0,g2.get(e).push(n),Fz&&console.debug("register prewarm",n.name))}let Uz=null,Oz=null;function PBe(n){if(!n)return;const e=g2.get(n);if(!(e!=null&&e.length))return;const i=n.mainCamera;if(i){Fz&&console.log("prewarm",e.length,"objects",[...e]);const s=n.renderer;if(s.compile){const r=n.scene;s.compile(r,i),Uz??(Uz=new GI(64)),Oz??(Oz=new kI(.001,9999999,Uz)),Oz.update(s,r);for(const o of e)o[Cte]=!0,o[zz]=!1;e.length=0,Fz&&console.log("prewarm done")}}}const NBe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function VBe(n){return typeof n=="string"&&NBe.test(n)}const Co=[];for(let n=0;n<256;++n)Co.push((n+256).toString(16).slice(1));function XBe(n,e=0){return Co[n[e+0]]+Co[n[e+1]]+Co[n[e+2]]+Co[n[e+3]]+"-"+Co[n[e+4]]+Co[n[e+5]]+"-"+Co[n[e+6]]+Co[n[e+7]]+"-"+Co[n[e+8]]+Co[n[e+9]]+"-"+Co[n[e+10]]+Co[n[e+11]]+Co[n[e+12]]+Co[n[e+13]]+Co[n[e+14]]+Co[n[e+15]]}function DBe(n){if(!VBe(n))throw TypeError("Invalid UUID");let e;const i=new Uint8Array(16);return i[0]=(e=parseInt(n.slice(0,8),16))>>>24,i[1]=e>>>16&255,i[2]=e>>>8&255,i[3]=e&255,i[4]=(e=parseInt(n.slice(9,13),16))>>>8,i[5]=e&255,i[6]=(e=parseInt(n.slice(14,18),16))>>>8,i[7]=e&255,i[8]=(e=parseInt(n.slice(19,23),16))>>>8,i[9]=e&255,i[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,i[11]=e/4294967296&255,i[12]=e>>>24&255,i[13]=e>>>16&255,i[14]=e>>>8&255,i[15]=e&255,i}function zBe(n){n=unescape(encodeURIComponent(n));const e=[];for(let i=0;i<n.length;++i)e.push(n.charCodeAt(i));return e}const FBe="6ba7b810-9dad-11d1-80b4-00c04fd430c8",UBe="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function OBe(n,e,i){function s(r,o,a,l){var c;if(typeof r=="string"&&(r=zBe(r)),typeof o=="string"&&(o=DBe(o)),((c=o)===null||c===void 0?void 0:c.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let h=new Uint8Array(16+r.length);if(h.set(o),h.set(r,o.length),h=i(h),h[6]=h[6]&15|e,h[8]=h[8]&63|128,a){l=l||0;for(let d=0;d<16;++d)a[l+d]=h[d];return a}return XBe(h)}try{s.name=n}catch{}return s.DNS=FBe,s.URL=UBe,s}function ZBe(n,e,i,s){switch(n){case 0:return e&i^~e&s;case 1:return e^i^s;case 2:return e&i^e&s^i&s;case 3:return e^i^s}}function Zz(n,e){return n<<e|n>>>32-e}function WBe(n){const e=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){const a=unescape(encodeURIComponent(n));n=[];for(let l=0;l<a.length;++l)n.push(a.charCodeAt(l))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);const s=n.length/4+2,r=Math.ceil(s/16),o=new Array(r);for(let a=0;a<r;++a){const l=new Uint32Array(16);for(let c=0;c<16;++c)l[c]=n[a*64+c*4]<<24|n[a*64+c*4+1]<<16|n[a*64+c*4+2]<<8|n[a*64+c*4+3];o[a]=l}o[r-1][14]=(n.length-1)*8/Math.pow(2,32),o[r-1][14]=Math.floor(o[r-1][14]),o[r-1][15]=(n.length-1)*8&4294967295;for(let a=0;a<r;++a){const l=new Uint32Array(80);for(let g=0;g<16;++g)l[g]=o[a][g];for(let g=16;g<80;++g)l[g]=Zz(l[g-3]^l[g-8]^l[g-14]^l[g-16],1);let c=i[0],h=i[1],d=i[2],u=i[3],p=i[4];for(let g=0;g<80;++g){const f=Math.floor(g/20),A=Zz(c,5)+ZBe(f,h,d,u)+p+e[f]+l[g]>>>0;p=u,u=d,d=Zz(h,30)>>>0,h=c,c=A}i[0]=i[0]+c>>>0,i[1]=i[1]+h>>>0,i[2]=i[2]+d>>>0,i[3]=i[3]+u>>>0,i[4]=i[4]+p>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,i[0]&255,i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,i[1]&255,i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,i[2]&255,i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,i[3]&255,i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,i[4]&255]}const HBe=OBe("v5",80,WBe),Ste=HBe;ji.registerCallback(nn.ContextCreated,n=>{const e=n.context;Rte(e),Ite(e)});const f2=q("debugcomponents"),_te="eff8ba80-635d-11ec-90d6-0242ac120003";class Zo{constructor(e){m(this,"_originalSeed"),m(this,"_seed"),typeof e=="string"&&(e=Zo.hash(e)),this._originalSeed=e,this._seed=e}get seed(){return this._seed}set seed(e){this._seed=e}reset(){this._seed=this._originalSeed}generateUUID(e){if(typeof e=="string")return Ste(e,_te);const i=this._seed;return this._seed-=1,Ste(i.toString(),_te)}initialize(e){typeof e=="string"?this._seed=Zo.hash(e):this._seed=e}static createFromString(e){return new Zo(this.hash(e))}static hash(e){let i=0;for(let s=0;s<e.length;s++)i=e.charCodeAt(s)+((i<<5)-i);return i}}var Mte=(n=>(n.NewInstanceCreated="new-instance-created",n.InstanceDestroyed="instance-destroyed",n))(Mte||{});class QBe{constructor(e){m(this,"guid"),m(this,"dontSave"),this.guid=e}}function SC(n,e,i=!0,s){if(!n)return;const r=n;if(Ol(n,i),!e){console.warn("Can not send destroy: No networking connection provided",n.guid);return}if(!e.isConnected){Je()&&console.debug("Can not send destroy: not connected",n.guid);return}let o=n.guid;if(!o&&r.uuid&&(o=r.uuid),!o){console.warn("Can not send destroy: failed to find guid",n);return}Wz(o,e,s)}function Wz(n,e,i){const s=new QBe(n);i?.saveInRoom===!1&&(s.dontSave=!0),e.send("instance-destroyed",s,Bh.Queued)}function Ite(n){n.connection.beginListen("instance-destroyed",e=>{f2&&console.log("[Remote] Destroyed",n.scene,e);const i=rF(e.guid,n.scene);i&&Ol(i)})}class KBe{constructor(e,i,s){m(this,"filename"),m(this,"hash"),m(this,"size"),this.filename=e,this.hash=i,this.size=s}}class Tte{constructor(e,i){m(this,"guid"),m(this,"originalGuid"),m(this,"seed"),m(this,"visible"),m(this,"hostData"),m(this,"dontSave"),m(this,"parent"),m(this,"position"),m(this,"rotation"),m(this,"scale"),m(this,"preventCreation"),m(this,"deleteStateOnDisconnect"),this.originalGuid=e,this.guid=i}}function Hz(n,e,i,s){var r,o;const a=n;if(!a.guid)return console.warn("Can not instantiate: No guid",a),null;if(e.context||(e.context=$t.Current),!e.context)return console.error("Missing network instantiate options / reference to network connection in sync instantiate"),null;const l=e?{...e}:null,{instance:c,seed:h}=YBe(a,e);if(c){const d=c;if(d.guid){f2&&console.log("[Local] new instance","gameobject:",c?.guid);const u=new Tte(a.guid,d.guid);u.seed=h,e.deleteOnDisconnect===!0&&(u.deleteStateOnDisconnect=!0),l&&(l.position&&(u.position={x:l.position.x,y:l.position.y,z:l.position.z}),l.rotation&&(u.rotation={x:l.rotation.x,y:l.rotation.y,z:l.rotation.z,w:l.rotation.w}),l.scale&&(u.scale={x:l.scale.x,y:l.scale.y,z:l.scale.z})),u.position||(u.position={x:d.position.x,y:d.position.y,z:d.position.z}),u.rotation||(u.rotation={x:d.quaternion.x,y:d.quaternion.y,z:d.quaternion.z,w:d.quaternion.w}),u.scale||(u.scale={x:d.scale.x,y:d.scale.y,z:d.scale.z}),u.visible=a.visible,l!=null&&l.parent&&(typeof l.parent=="string"?u.parent=l.parent:u.parent=l.parent.guid),u.hostData=i,s===!1&&(u.dontSave=!0),!((r=e?.context)!=null&&r.connection)&&Je()&&console.debug("Object will be instantiated but it will not be synced: not connected",a.guid),e.context.connection.isInRoom&&Zb.push(new WeakRef(d)),(o=e?.context)==null||o.connection.send("new-instance-created",u)}else console.warn("Missing guid, can not send new instance event",d)}return c}function Ete(){return Math.random()*9999999}const Zb=new Array;function Rte(n){n.connection.beginListen("new-instance-created",async e=>{const i=await jBe(e.originalGuid,n.scene);if(e.preventCreation===!0)return;if(!i){console.warn("could not find object that was instantiated: "+e.guid);return}const s=new qh;e.position&&(s.position=new E(e.position.x,e.position.y,e.position.z)),e.rotation&&(s.rotation=new Fe(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w)),e.scale&&(s.scale=new E(e.scale.x,e.scale.y,e.scale.z)),s.parent=e.parent,e.seed&&(s.idProvider=new Zo(e.seed)),s.visible=e.visible,s.context=n,f2&&n.alias&&console.log("[Remote] instantiate in: "+n.alias);const r=Yb(i,s);Zb.push(new WeakRef(r)),r&&(e.parent==="scene"&&n.scene.add(r),f2&&console.log("[Remote] new instance","gameobject:",r?.guid,i))}),n.connection.beginListen("left-room",()=>{Zb.length>0&&console.debug(`Left networking room, cleaning up ${Zb.length} instantiated objects`);for(const e of Zb){const i=e.deref();i&&i.destroy()}Zb.length=0})}function YBe(n,e){const i=Ete(),s=e??new qh;s.idProvider=new Zo(i);const r=Yb(n,s);return{seed:i,instance:r}}const Lte={};function Bte(n,e){Lte[n]=e}async function jBe(n,e){const i=Lte[n];if(i!=null){const s=await i(n);if(s)return s}return kte(n,e)}function kte(n,e){if(e===null||!n)return null;if(e.guid===n)return e;if(e.children)for(const i of e.children){const s=kte(n,i);if(s)return s}return null}const _C=q("gizmos"),Qr=q("debugextension"),Qz=q("debugtypes");class JBe{constructor(){m(this,"_types",new Map),Qz&&console.warn("TypeStore: Created",this)}add(e,i){Qz&&console.warn("ADD TYPE",e);const s=this._types.get(e);s?Qz&&s!==i&&console.warn("Type name exists multiple times in your project and may lead to runtime errors:",e):this._types.set(e,i)}get(e){return this._types.get(e)||null}getKey(e){for(const[i,s]of this._types)if(s===e)return i;return null}}const qBe=Symbol("BuiltInType"),Y=new JBe,$Be=function(n){Y.get(n.name)||Y.add(n.name,n)},Kz=q("debugresolvedependencies"),eke=["/extensions/","extensions/"],tke=[{prefix:"/nodes/",dependencyName:"node"},{prefix:"/meshes/",dependencyName:"mesh"},{prefix:"/materials/",dependencyName:"material"},{prefix:"/textures/",dependencyName:"texture"},{prefix:"/animations/",dependencyName:"animation"},{prefix:"nodes/",dependencyName:"node"},{prefix:"meshes/",dependencyName:"mesh"},{prefix:"materials/",dependencyName:"material"},{prefix:"textures/",dependencyName:"texture"},{prefix:"animations/",dependencyName:"animation"}];async function Yz(n,e){Kz&&console.log(n,e);const i=[];jz(tke,n,e,i);const s=await Promise.all(i);return typeof e=="string"&&s.length===1?s[0]:s}function Gte(n,e){return!n||!e?!1:n["needle:identifier"]!=null&&e["needle:identifier"]!=null?n["needle:identifier"]===e["needle:identifier"]:!1}function ike(n,e){n["needle:identifier"]=e}function jz(n,e,i,s){if(typeof i=="object"&&i!==void 0&&i!==null)for(const r of Object.keys(i)){const o=i[r];if(typeof o=="string"){const a=Pte(e,o);if(a!=null)typeof a.then=="function"?s.push(a.then(l=>i[r]=l)):i[r]=a;else{const l=Nte(n,e,o);if(l){s.push(l.then(c=>(i[r]=c,c)));continue}}}else if(Array.isArray(o))for(let a=0;a<o.length;a++){const l=o[a],c=Pte(e,l);if(c!==null){typeof c.then=="function"?s.push(c.then(h=>o[a]=h)):o[a]=c;continue}for(const h of n){const d=Vte(h.prefix,l);if(d>=0){Kz&&console.log(h,d,h.dependencyName),s.push(e.getDependency(h.dependencyName,d).then(u=>o[a]=u));break}}typeof l=="object"&&jz(n,e,l,s)}else typeof o=="object"&&jz(n,e,o,s)}else if(typeof i=="string"){const r=Nte(n,e,i);r&&s.push(r)}}function Pte(n,e){if(n&&n.plugins&&typeof e=="string"){for(const i of eke)if(e.startsWith(i)){let s=e.substring(i.length);const r=s.indexOf("/");r>=0&&(s=s.substring(0,r));const o=n.plugins[s];if(Qr&&console.log(s,o),typeof o?.resolve=="function"){const a=e.substring(i.length+s.length+1);return o.resolve(n,a)}break}}return null}function Nte(n,e,i){for(const s of n){const r=Vte(s.prefix,i);if(r>=0)return Kz&&console.warn("GET DEPENDENCY",s,r,s.dependencyName),e.getDependency(s.dependencyName,r)}return null}function Vte(n,e){if(typeof e=="string"&&e.startsWith(n)){const i=e.substring(n.length),s=Number.parseInt(i);if(s>=0)return s}return-1}const Jz="NEEDLE_persistent_assets";function nke(n){return n?.___persistentAsset===!0}class ske{constructor(e){m(this,"parser"),this.parser=e}get name(){return Jz}async afterRoot(e){var i,s;if(!((s=(i=this.parser)==null?void 0:i.json)!=null&&s.extensions))return;const r=this.parser.json.extensions[Jz];if(!r)return;Qr&&console.log(r);const o=new Array;for(const a of r?.assets){const l=Yz(this.parser,a);l&&o.push(l)}await Promise.all(o)}resolve(e,i){const s=Number.parseInt(i);if(s>=0){Qr&&console.log(i);const r=e.json.extensions[Jz];if(r){const o=r?.assets[s];if(o&&typeof o=="object"){o.___persistentAsset=!0;const a=o.__type;a&&Y.get(a)}return o}}return null}}const Ld=q("debugserializer");class rke{constructor(){m(this,"typeMap",new Map)}register(e,i){if(this.typeMap.has(e)){const s=this.typeMap.get(e);if(s===i)return;Ld&&console.warn("Type: "+e+" is already registered",i,s)}Ld&&console.log("Register type serializer",i.name,i,e),this.typeMap.set(e,i)}getSerializer(e){if(e)return this.typeMap.get(e)}getSerializerForConstructor(e,i=0){if(i>20)return;if(!e||!e.constructor){Ld&&console.log("invalid type");return}const s=e.name,r=this.getSerializer(e);if(r!==void 0)return Ld&&console.log("FOUND SERIALIZER",r?.name,e.name,e.constructor.name,"for type: "+s,r,e,this.typeMap),r;const o=Object.getPrototypeOf(e);if(o&&o!==e){const a=this.getSerializerForConstructor(o,++i);if(a){const l=o.constructor||o.prototype;Ld&&console.log("FOUND SERIALIZER(in constructor) "+l.constructor.name,l.name,l,a),this.register(l,a)}return a}Ld&&console.warn("No serializer found for "+s,e,e.name,e.constructor.name)}}const A2=new rke;class Nc{constructor(e,i){if(m(this,"name"),this.name=i,Array.isArray(e))for(const s of e)A2.register(s,this);else A2.register(e,this)}}class oke{constructor(){m(this,"isDevMode",Ma()),m(this,"cache",{})}registerDefinedKeys(e,i){if(this.isDevMode&&this.cache[e]===void 0){this.cache[e]=Object.keys(i);const s=i;s.$serializedTypes&&Object.keys(s.$serializedTypes)&&this.cache[e].push(...Object.keys(s.$serializedTypes)),Ld&&console.log("registerDefinedKeys for "+e,this.cache[e],i)}}getDefinedKey(e,i){return this.cache[e]===void 0?!1:this.cache[e].includes(i)}}class qz{constructor(e){m(this,"root"),m(this,"gltf"),m(this,"gltfId"),m(this,"object"),m(this,"target"),m(this,"nodeId"),m(this,"nodeToObject"),m(this,"objectToNode"),m(this,"context"),m(this,"path"),m(this,"type"),m(this,"serializable"),m(this,"implementationInformation"),this.root=e}}function Xte(n,e){const i=n.$serializedTypes;if(i===void 0)return null;const s={};for(const o in i){const a=n[o];if(a!=null&&typeof a=="object"){const l=A2.getSerializerForConstructor(a);if(l){s[o]=l.onSerialize(a,e);continue}}s[o]=a}function r(o){const a=Y._types;for(const[l,c]of a)if(c===n.constructor)return l;return o.__name||o.constructor.name}return s.name=r(n),typeof n.guid=="string"&&(s.guid=n.guid),s}const y2=[];function Dte(n,e){if(!n)return e;typeof n.$serializedTypes=="object"&&(e||(e={}),Object.assign(e,n.$serializedTypes));const i=Object.getPrototypeOf(n);return Dte(i,e)}function b2(n,e,i){if(!n)return!1;if(i.target=n,n.onBeforeDeserialize!==void 0){const r=n.onBeforeDeserialize(e,i);if(typeof r=="boolean")return r}const s=Dte(n);if(e){if(typeof e.guid=="string"&&(n.guid=e.guid),s)for(const r in s){let o=function(c){const h=c.type;return h?$z(l,h,i,void 0,n[r]):$z(l,c,i,void 0,n[r])};const a=s[r],l=e[r];if(Ld&&console.log(r,l,n,a),!(n[r]!==void 0&&l===void 0)&&(i.type=void 0,i.path=r,i.serializable=a,!(n.onBeforeDeserializeMember!==void 0&&n.onBeforeDeserializeMember(r,l,i)===!0))){if(a===null)n[r]=l;else{if(Array.isArray(a))for(let c=0;c<a.length;c++){const h=a[c],d=o(h);if(d!==void 0||c===a.length-1){n[r]=d;break}}else n[r]=o(a);y2.length=0}n.onAfterDeserializeMember!==void 0&&n.onAfterDeserializeMember(r,l,i)}}cke(n,e)}return lke(n,e,i.implementationInformation),n.onAfterDeserialize!==void 0&&n.onAfterDeserialize(e,i),!0}const ake=q("noerrors");function lke(n,e,i){var s,r;if(ake||!e||!Ma()||!n||n.constructor&&n.constructor[qBe]===!0)return;const o=(s=n.constructor)==null?void 0:s.name,a=Object.getOwnPropertyNames(e);for(const l of a){if(l==="sourceId")continue;const c=n[l];if(c==null)continue;const h=e[l];if(i?.getDefinedKey(o,l)===!1){const d=l.charAt(0).toUpperCase()+l.slice(1);i.getDefinedKey(o,d)&&(bd(Rl.Warn,'<strong>Please rename</strong> "'+d+'" to "'+l+'" in '+o),console.warn('Please use lowercase for field: "'+d+'" in '+o,h,n));continue}if(h!=null){if(typeof h=="object"&&(c===void 0||!c.isObject3D)){if(typeof h.node=="number"||typeof h.guid=="string"){if(h.could_not_resolve)continue;if(!(c!==void 0&&Object.keys(c).length>1)){bd(Rl.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(Object3D)
${l}? : Object3D;

in script ${o}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(o,l,n[l],n);continue}}else if(!Array.isArray(c)){const d=(r=c.constructor)==null?void 0:r.name;if(d==="Object"&&!c.constructor["did_warn:missing_serializable"]){c.constructor["did_warn:missing_serializable"]=!0;const u='You might be missing a @serializable(Type) decorator for field "'+l+'" in '+o+".ts";console.warn(u+`
${l}:`,h,d),bd(Rl.Warn,"Dev Warning: Are you missing a type in @serializable? Please check the browser console for details")}}}if(typeof c=="string"&&typeof h=="string"&&(h.endsWith(".gltf")||h.endsWith(".glb"))){bd(Rl.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(AssetReference)
${l}? : AssetReference;

in script ${o}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(o,l,n[l],n);continue}}}}function cke(n,e){for(const i of Object.keys(e)){const s=e[i];if(typeof s=="object"&&s!==null&&s!==void 0){const r=n[i];if(!r){Ld&&console.log(i,"is undefined on",n);continue}for(const o of Object.keys(s))if(r[o]===void 0&&zte(s[o])&&!zte(r)){const a=hke(r,o);if(a&&(a?.writable===void 0||a?.writable===!1)&&a.set===void 0){Ld&&console.warn('Property is not writable "'+o+'"',r,a,s[o],r[o]);continue}r[o]=s[o]}}}}function hke(n,e){for(;n;){const i=Object.getOwnPropertyDescriptor(n,e);if(i)return i;n=Object.getPrototypeOf(n)}}function zte(n){switch(typeof n){case"number":case"string":case"boolean":return!0}return!1}function $z(n,e,i,s,r){let o=typeof e=="function"&&e.prototype===void 0,a=e;if(o)try{if(a=e?.call(e,r),o=!1,a==null)return}catch(d){console.error("Error in callback",d,n)}if(i.type=a,!o&&r instanceof a)return r;if(s||(s={serializer:A2.getSerializerForConstructor(a)}),r&&typeof r=="object"&&nke(r)){if(r.__concreteInstance)return r.__concreteInstance;const d=r;if(!d.$serializedTypes&&a.prototype.$serializedTypes&&(d.$serializedTypes=a.prototype.$serializedTypes),d.$serializedTypes&&b2(d,n,i),r&&a!==void 0)try{let u=null;s.serializer&&(u=s.serializer.onDeserialize(n,i)),u||(u=new a,Qr&&console.log("Create concrete instance for persistent asset",r,"instance:",u),Wb(u,r)),r.__concreteInstance=u,r=u}catch(u){console.error("Error creating instance or creating values on instance",u,r,a)}return r}if(Array.isArray(n)){const d=[];for(let u=0;u<n.length;u++){const p=n[u],g=$z(p,e,i,s,p);d.push(g)}return d}const l=s?.serializer;if(l)return l.onDeserialize(n,i);let c;if(n&&(n.isMaterial||n.isTexture||n.isObject3D||n instanceof wa))c=n;else{if(n===void 0)return;if(n===null&&(a===ti||a===di||a===pe||a===wa))return null;try{c=new a(...dke(n))}catch(d){console.error("Error creating "+i.path,i.target,d);return}}const h=c;return h.$serializedTypes&&b2(h,n,i),c}function dke(n){if(y2.length=0,typeof n=="object"&&n!==null&&n!==void 0)for(const e of Object.keys(n))y2.push(n[e]);return y2}const eF=Symbol("assigned component properties");function Wb(n,e,i){var s;if(e==null||n==null)return;n[eF]=!0;const r=((s=n.constructor)==null?void 0:s.name)??"unknown";i?.registerDefinedKeys(r,n);for(const o of Object.keys(e)){const a=uke(n,o);typeof a?.value!="function"&&(!a||a.writable===!0||a?.set!==void 0)&&(n[o]=e[o])}delete n[eF]}function uke(n,e){let i;do i=Object.getOwnPropertyDescriptor(n,e);while(!i&&(n=Object.getPrototypeOf(n)));return i}const Fte=Symbol("customVisibilityFlag");function rp(n,e){n.layers[Fte]=e}const Ute=Symbol("DidPatchLayers");function pke(){const n=Qo.prototype;if(n[Ute])return;n[Ute]=!0;const e=n.test;n.test=function(i){return this[Fte]===!1?!1:e.call(this,i)}}pke(),Object.defineProperty(Ot.prototype,"fov",{get:function(){return this._fov},set:function(n){const e=n!==this._fov;this._fov=n,e&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0}),Object.defineProperty(Ot.prototype,"near",{get:function(){return this._near},set:function(n){const e=n!==this._near;this._near=n,e&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0}),Object.defineProperty(Ot.prototype,"far",{get:function(){return this._far},set:function(n){const e=n!==this._far;this._far=n,e&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0});const Ote=new Map;function Zte(n,e){if(!n)return;if(!e){console.warn("No prototype found",n,n.prototype,n.constructor);return}const i=Ote.get(e);i&&i.apply(n)}function Wte(n){const e=mke(n.prototype);Ote.set(n,e)}function mke(n){return new gke(n)}class gke{constructor(e){m(this,"$symbol"),m(this,"extensions"),m(this,"descriptors"),this.$symbol=Symbol("prototype-extension"),this.extensions=Object.keys(e),this.descriptors=new Array;for(let i=0;i<this.extensions.length;i++){const s=this.extensions[i],r=Object.getOwnPropertyDescriptor(e,s);r&&this.descriptors.push(r)}}apply(e){if(!e[this.$symbol]){e[this.$symbol]=!0;for(let i=0;i<this.extensions.length;i++){const s=this.extensions[i],r=this.descriptors[i];r&&Object.defineProperty(e,s,r)}}}}const R0=new pm,sa=new E,Jm=new E,as=new Fe,Hte={X:new E(1,0,0),Y:new E(0,1,0),Z:new E(0,0,1)},tF={type:"change"},Qte={type:"mouseDown",mode:null},Kte={type:"mouseUp",mode:null},Yte={type:"objectChange"};class fke extends ET{constructor(e,i=null){super(void 0,i);const s=new wke(this);this._root=s;const r=new nF;this._gizmo=r,s.add(r);const o=new Cke;this._plane=o,s.add(o);const a=this;function l(x,w){let C=w;Object.defineProperty(a,x,{get:function(){return C!==void 0?C:w},set:function(S){C!==S&&(C=S,o[x]=S,r[x]=S,a.dispatchEvent({type:x+"-changed",value:S}),a.dispatchEvent(tF))}}),a[x]=w,o[x]=w,r[x]=w}l("camera",e),l("object",void 0),l("enabled",!0),l("axis",null),l("mode","translate"),l("translationSnap",null),l("rotationSnap",null),l("scaleSnap",null),l("space","world"),l("size",1),l("dragging",!1),l("showX",!0),l("showY",!0),l("showZ",!0);const c=new E,h=new E,d=new Fe,u=new Fe,p=new E,g=new Fe,f=new E,A=new E,y=new E,b=0,v=new E;l("worldPosition",c),l("worldPositionStart",h),l("worldQuaternion",d),l("worldQuaternionStart",u),l("cameraPosition",p),l("cameraQuaternion",g),l("pointStart",f),l("pointEnd",A),l("rotationAxis",y),l("rotationAngle",b),l("eye",v),this._offset=new E,this._startNorm=new E,this._endNorm=new E,this._cameraScale=new E,this._parentPosition=new E,this._parentQuaternion=new Fe,this._parentQuaternionInv=new Fe,this._parentScale=new E,this._worldScaleStart=new E,this._worldQuaternionInv=new Fe,this._worldScale=new E,this._positionStart=new E,this._quaternionStart=new Fe,this._scaleStart=new E,this._getPointer=Ake.bind(this),this._onPointerDown=bke.bind(this),this._onPointerHover=yke.bind(this),this._onPointerMove=vke.bind(this),this._onPointerUp=xke.bind(this),i!==null&&this.connect()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&R0.setFromCamera(e,this.camera);const i=iF(this._gizmo.picker[this.mode],R0);i?this.axis=i.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&R0.setFromCamera(e,this.camera);const i=iF(this._plane,R0,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0,Qte.mode=this.mode,this.dispatchEvent(Qte)}}pointerMove(e){const i=this.axis,s=this.mode,r=this.object;let o=this.space;if(s==="scale"?o="local":(i==="E"||i==="XYZE"||i==="XYZ")&&(o="world"),r===void 0||i===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&R0.setFromCamera(e,this.camera);const a=iF(this._plane,R0,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),o==="local"&&i!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),i.indexOf("X")===-1&&(this._offset.x=0),i.indexOf("Y")===-1&&(this._offset.y=0),i.indexOf("Z")===-1&&(this._offset.z=0),o==="local"&&i!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),r.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(o==="local"&&(r.position.applyQuaternion(as.copy(this._quaternionStart).invert()),i.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(this._quaternionStart)),o==="world"&&(r.parent&&r.position.add(sa.setFromMatrixPosition(r.parent.matrixWorld)),i.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(sa.setFromMatrixPosition(r.parent.matrixWorld))));else if(s==="scale"){if(i.search("XYZ")!==-1){let l=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(l*=-1),Jm.set(l,l,l)}else sa.copy(this.pointStart),Jm.copy(this.pointEnd),sa.applyQuaternion(this._worldQuaternionInv),Jm.applyQuaternion(this._worldQuaternionInv),Jm.divide(sa),i.search("X")===-1&&(Jm.x=1),i.search("Y")===-1&&(Jm.y=1),i.search("Z")===-1&&(Jm.z=1);r.scale.copy(this._scaleStart).multiply(Jm),this.scaleSnap&&(i.search("X")!==-1&&(r.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const l=20/this.worldPosition.distanceTo(sa.setFromMatrixPosition(this.camera.matrixWorld));let c=!1;i==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(sa.copy(this.rotationAxis).cross(this.eye))*l):(i==="X"||i==="Y"||i==="Z")&&(this.rotationAxis.copy(Hte[i]),sa.copy(Hte[i]),o==="local"&&sa.applyQuaternion(this.worldQuaternion),sa.cross(this.eye),sa.length()===0?c=!0:this.rotationAngle=this._offset.dot(sa.normalize())*l),(i==="E"||c)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),o==="local"&&i!=="E"&&i!=="XYZE"?(r.quaternion.copy(this._quaternionStart),r.quaternion.multiply(as.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),r.quaternion.copy(as.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(tF),this.dispatchEvent(Yte)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(Kte.mode=this.mode,this.dispatchEvent(Kte)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(tF),this.dispatchEvent(Yte),this.pointStart.copy(this.pointEnd))}getRaycaster(){return R0}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function Ake(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const e=this.domElement.getBoundingClientRect();return{x:(n.clientX-e.left)/e.width*2-1,y:-(n.clientY-e.top)/e.height*2+1,button:n.button}}}function yke(n){if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}function bke(n){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}function vke(n){this.enabled&&this.pointerMove(this._getPointer(n))}function xke(n){this.enabled&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}function iF(n,e,i){const s=e.intersectObject(n,!0);for(let r=0;r<s.length;r++)if(s[r].object.visible||i)return s[r];return!1}const v2=new Oi,kn=new E(0,1,0),jte=new E(0,0,0),Jte=new de,x2=new Fe,w2=new Fe,Bd=new E,qte=new de,MC=new E(1,0,0),L0=new E(0,1,0),IC=new E(0,0,1),C2=new E,TC=new E,EC=new E;class wke extends Ae{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const i=this.controls;i.object!==void 0&&(i.object.updateMatrixWorld(),i.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):i.object.parent.matrixWorld.decompose(i._parentPosition,i._parentQuaternion,i._parentScale),i.object.matrixWorld.decompose(i.worldPosition,i.worldQuaternion,i._worldScale),i._parentQuaternionInv.copy(i._parentQuaternion).invert(),i._worldQuaternionInv.copy(i.worldQuaternion).invert()),i.camera.updateMatrixWorld(),i.camera.matrixWorld.decompose(i.cameraPosition,i.cameraQuaternion,i._cameraScale),i.camera.isOrthographicCamera?i.camera.getWorldDirection(i.eye).negate():i.eye.copy(i.cameraPosition).sub(i.worldPosition).normalize(),super.updateMatrixWorld(e)}}class nF extends Ae{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new ai({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new Cn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const r=i.clone();r.opacity=.5;const o=e.clone();o.color.setHex(16711680);const a=e.clone();a.color.setHex(65280);const l=e.clone();l.color.setHex(255);const c=e.clone();c.color.setHex(16711680),c.opacity=.5;const h=e.clone();h.color.setHex(65280),h.opacity=.5;const d=e.clone();d.color.setHex(255),d.opacity=.5;const u=e.clone();u.opacity=.25;const p=e.clone();p.color.setHex(16776960),p.opacity=.25,e.clone().color.setHex(16776960);const g=e.clone();g.color.setHex(7895160);const f=new js(0,.04,.1,12);f.translate(0,.05,0);const A=new bn(.08,.08,.08);A.translate(0,.04,0);const y=new Rt;y.setAttribute("position",new dt([0,0,0,1,0,0],3));const b=new js(.0075,.0075,.5,3);b.translate(0,.25,0);function v(X,F){const z=new Vp(X,.0075,3,64,F*Math.PI*2);return z.rotateY(Math.PI/2),z.rotateX(Math.PI/2),z}function x(){const X=new Rt;return X.setAttribute("position",new dt([0,0,0,1,1,1],3)),X}const w={X:[[new pe(f,o),[.5,0,0],[0,0,-Math.PI/2]],[new pe(f,o),[-.5,0,0],[0,0,Math.PI/2]],[new pe(b,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new pe(f,a),[0,.5,0]],[new pe(f,a),[0,-.5,0],[Math.PI,0,0]],[new pe(b,a)]],Z:[[new pe(f,l),[0,0,.5],[Math.PI/2,0,0]],[new pe(f,l),[0,0,-.5],[-Math.PI/2,0,0]],[new pe(b,l),null,[Math.PI/2,0,0]]],XYZ:[[new pe(new Np(.1,0),u.clone()),[0,0,0]]],XY:[[new pe(new bn(.15,.15,.01),d.clone()),[.15,.15,0]]],YZ:[[new pe(new bn(.15,.15,.01),c.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new pe(new bn(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},C={X:[[new pe(new js(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new pe(new js(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new pe(new js(.2,0,.6,4),s),[0,.3,0]],[new pe(new js(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new pe(new js(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new pe(new js(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new pe(new Np(.2,0),s)]],XY:[[new pe(new bn(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new pe(new bn(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new pe(new bn(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},S={START:[[new pe(new Np(.01,2),r),null,null,null,"helper"]],END:[[new pe(new Np(.01,2),r),null,null,null,"helper"]],DELTA:[[new is(x(),r),null,null,null,"helper"]],X:[[new is(y,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new is(y,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new is(y,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},_={XYZE:[[new pe(v(.5,1),g),null,[0,Math.PI/2,0]]],X:[[new pe(v(.5,.5),o)]],Y:[[new pe(v(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new pe(v(.5,.5),l),null,[0,Math.PI/2,0]]],E:[[new pe(v(.75,1),p),null,[0,Math.PI/2,0]]]},I={AXIS:[[new is(y,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},B={XYZE:[[new pe(new eh(.25,10,8),s)]],X:[[new pe(new Vp(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new pe(new Vp(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new pe(new Vp(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new pe(new Vp(.75,.1,2,24),s)]]},M={X:[[new pe(A,o),[.5,0,0],[0,0,-Math.PI/2]],[new pe(b,o),[0,0,0],[0,0,-Math.PI/2]],[new pe(A,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new pe(A,a),[0,.5,0]],[new pe(b,a)],[new pe(A,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new pe(A,l),[0,0,.5],[Math.PI/2,0,0]],[new pe(b,l),[0,0,0],[Math.PI/2,0,0]],[new pe(A,l),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new pe(new bn(.15,.15,.01),d),[.15,.15,0]]],YZ:[[new pe(new bn(.15,.15,.01),c),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new pe(new bn(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new pe(new bn(.1,.1,.1),u.clone())]]},R={X:[[new pe(new js(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new pe(new js(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new pe(new js(.2,0,.6,4),s),[0,.3,0]],[new pe(new js(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new pe(new js(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new pe(new js(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new pe(new bn(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new pe(new bn(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new pe(new bn(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new pe(new bn(.2,.2,.2),s),[0,0,0]]]},k={X:[[new is(y,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new is(y,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new is(y,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function G(X){const F=new Ae;for(const z in X)for(let H=X[z].length;H--;){const Z=X[z][H][0].clone(),he=X[z][H][1],be=X[z][H][2],_e=X[z][H][3],Ye=X[z][H][4];Z.name=z,Z.tag=Ye,he&&Z.position.set(he[0],he[1],he[2]),be&&Z.rotation.set(be[0],be[1],be[2]),_e&&Z.scale.set(_e[0],_e[1],_e[2]),Z.updateMatrix();const je=Z.geometry.clone();je.applyMatrix4(Z.matrix),Z.geometry=je,Z.renderOrder=1/0,Z.position.set(0,0,0),Z.rotation.set(0,0,0),Z.scale.set(1,1,1),F.add(Z)}return F}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=G(w)),this.add(this.gizmo.rotate=G(_)),this.add(this.gizmo.scale=G(M)),this.add(this.picker.translate=G(C)),this.add(this.picker.rotate=G(B)),this.add(this.picker.scale=G(R)),this.add(this.helper.translate=G(S)),this.add(this.helper.rotate=G(I)),this.add(this.helper.scale=G(k)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:w2;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let r=0;r<s.length;r++){const o=s[r];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(as.setFromEuler(v2.set(0,0,0)),o.quaternion.copy(i).multiply(as),Math.abs(kn.copy(MC).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(as.setFromEuler(v2.set(0,0,Math.PI/2)),o.quaternion.copy(i).multiply(as),Math.abs(kn.copy(L0).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(as.setFromEuler(v2.set(0,Math.PI/2,0)),o.quaternion.copy(i).multiply(as),Math.abs(kn.copy(IC).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(as.setFromEuler(v2.set(0,Math.PI/2,0)),kn.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(Jte.lookAt(jte,kn,L0)),o.quaternion.multiply(as),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),sa.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),sa.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(sa),o.visible=this.dragging):(o.quaternion.copy(i),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(kn.copy(MC).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(kn.copy(L0).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(kn.copy(IC).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(kn.copy(IC).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(kn.copy(MC).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(kn.copy(L0).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(x2.copy(i),kn.copy(this.eye).applyQuaternion(as.copy(i).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(Jte.lookAt(this.eye,jte,L0)),o.name==="X"&&(as.setFromAxisAngle(MC,Math.atan2(-kn.y,kn.z)),as.multiplyQuaternions(x2,as),o.quaternion.copy(as)),o.name==="Y"&&(as.setFromAxisAngle(L0,Math.atan2(kn.x,kn.z)),as.multiplyQuaternions(x2,as),o.quaternion.copy(as)),o.name==="Z"&&(as.setFromAxisAngle(IC,Math.atan2(kn.y,kn.x)),as.multiplyQuaternions(x2,as),o.quaternion.copy(as))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(l){return o.name===l}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}class Cke extends pe{constructor(){super(new Xs(1e5,1e5,2,2),new ai({visible:!1,wireframe:!0,side:Qi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let i=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(i="local"),C2.copy(MC).applyQuaternion(i==="local"?this.worldQuaternion:w2),TC.copy(L0).applyQuaternion(i==="local"?this.worldQuaternion:w2),EC.copy(IC).applyQuaternion(i==="local"?this.worldQuaternion:w2),kn.copy(TC),this.mode){case"translate":case"scale":switch(this.axis){case"X":kn.copy(this.eye).cross(C2),Bd.copy(C2).cross(kn);break;case"Y":kn.copy(this.eye).cross(TC),Bd.copy(TC).cross(kn);break;case"Z":kn.copy(this.eye).cross(EC),Bd.copy(EC).cross(kn);break;case"XY":Bd.copy(EC);break;case"YZ":Bd.copy(C2);break;case"XZ":kn.copy(EC),Bd.copy(TC);break;case"XYZ":case"E":Bd.set(0,0,0);break}break;case"rotate":default:Bd.set(0,0,0)}Bd.length()===0?this.quaternion.copy(this.cameraQuaternion):(qte.lookAt(sa.set(0,0,0),Bd,kn),this.quaternion.setFromRotationMatrix(qte)),super.updateMatrixWorld(e)}}const Ske=q("debuggetcomponent"),$te=()=>Ske||globalThis.NEEDLE_DEBUG_GETCOMPONENT===!0;function _ke(n){return n==null||n.isObject3D?n:n.object&&n.object.isObject3D?n.object:n}function sF(n,e){if(!n||!n.userData.components)return e;const i=n.userData.components.indexOf(e);return i<0||(vC.dispatchComponentLifecycleEvent("removing-component",e),e.gameObject=null,n.userData.components.splice(i,1)),e}function RC(n,e,i){return k0(n,e)||Ul(n,e,i)}const eie=new Zo("addComponentIdProvider");function B0(n,e,i=!0){n.userData||(n.userData={}),n.userData.components||(n.userData.components=[]),n.userData.components.push(e),e.gameObject=n,(e.guid===void 0||e.guid==="invalid")&&(e.guid=eie.generateUUID()),M2(n),q2(e,e.context);try{i&&e.__internalAwake&&(CC(n),e.activeAndEnabled&&e.__internalAwake()),vC.dispatchComponentLifecycleEvent("component-added",e)}catch(s){console.error(s)}return e}function Ul(n,e,i,s){if(typeof e=="function"){const r=new e;i&&r.__internalNewInstanceCreated(i);let o=!0;return s?.callAwake!=null&&(o=s.callAwake),B0(n,r,o)}if(e.destroyed)return console.warn("Can not move/add a destroyed component",e),e;if(e.gameObject===n)return e;if(e.gameObject&&e.gameObject.userData.components){const r=e.gameObject.userData.components.indexOf(e);e.gameObject.userData.components.splice(r,1)}if(!n.userData.components)n.userData.components=[];else if(n.userData.components.includes(e))return e;return n.userData.components.push(e),e.gameObject=n,(e.guid===void 0||e.guid==="invalid")&&(e.guid=eie.generateUUID()),i&&e._internalInit(i),q2(e,e.context),e}function tie(n){if(n.gameObject&&n.gameObject.userData.components){const e=n.gameObject.userData.components.indexOf(n);n.gameObject.userData.components.splice(e,1)}n.__internalDisable&&n.__internalDisable(),sp(n,n.context??$t.Current),n.destroy(),n.gameObject=null}let iie=!1;function nie(n,e,i){var s;if(n==null)return null;if(!n.isObject3D)return console.error("Object is not object3D"),null;if(!((s=n?.userData)!=null&&s.components)||(typeof e=="string"&&(iie||(iie=!0,console.warn(`Accessing components by name is not supported.
Please use the component type instead. This may keep working in local development but it will fail when bundling your application.

You can import other modules your main module to get access to types
or if you use npmdefs you can make types available globally using globalThis:
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis`,e))),$te()&&console.log("[onGetComponent] FIND",e),e==null))return null;for(let r=0;r<n.userData.components.length;r++){const o=n.userData.components[r];let a=Object.getPrototypeOf(o);for(;a;){if(a===e.prototype)if($te()&&console.log("[onGetComponent] MATCH BY PROTOYPE",a),i)i.push(o);else return o;a=Object.getPrototypeOf(a)}}return i||null}function k0(n,e){const i=nie(n,e);return i?Array.isArray(i)?i[0]:i:null}function LC(n,e,i,s=!0){return i||(i=[]),s&&(i.length=0),nie(n,e,i),i}function BC(n,e,i){var s;const r=k0(n,e);if(i===!1&&r?.enabled===!1)return null;if(r)return r;for(let o=0;o<((s=n?.children)==null?void 0:s.length);o++){const a=BC(n.children[o],e);if(a)return a}return null}function Hb(n,e,i,s=!0){var r;i||(i=[]),s&&(i.length=0),LC(n,e,i,!1);for(let o=0;o<((r=n?.children)==null?void 0:r.length);o++)Hb(n.children[o],e,i,!1);return i}function kC(n,e){if(!n)return null;if(Array.isArray(n)){for(let s=0;s<n.length;s++){const r=_ke(n[s]),o=kC(r,e);if(o)return o}return null}return k0(n,e)||(n.parent?kC(n.parent,e):null)}function S2(n,e,i,s=!0){return i||(i=[]),s&&(i.length=0),n?(LC(n,e,i,!1),n.parent?S2(n.parent,e,i,!1):i):i}function _2(n,e=void 0,i=!0){if(!n)return null;if(!e&&(e=$t.Current,!e))return console.error("Can not search object without any needle context or scene!!!"),null;let s=e;if(s.isScene||(s=e?.scene),!s)return null;for(const r in s.children){const o=s.children[r];if(i===!1&&o[Du]===!1)continue;const a=BC(o,n);if(a)return a}return null}function sie(n,e,i=void 0){if(!n)return e??[];if(e||(e=[]),e.length=0,!i&&(i=$t.Current,!i))return console.error("Can not search object without any needle context or scene!!!"),e;"scene"in i&&(i=i.scene);const s=i;if(!s)return e;for(const r in s.children){const o=s.children[r];Hb(o,n,e,!1)}return e}function M2(n){n&&n.isObject3D===!0&&Zte(n,Ae)}Ae.prototype.SetActive=function(n){this.visible=n},Ae.prototype.setActive=function(n){this.visible=n},Ae.prototype.destroy=function(){Ol(this)},Ae.prototype.addComponent=function(n,e){return Ul(this,n,e)},Ae.prototype.addNewComponent=function(n,e){return Ul(this,n,e)},Ae.prototype.removeComponent=function(n){return sF(this,n)},Ae.prototype.getOrAddComponent=function(n,e){return RC(this,n,e)},Ae.prototype.getComponent=function(n){return k0(this,n)},Ae.prototype.getComponents=function(n,e){return LC(this,n,e)},Ae.prototype.getComponentInChildren=function(n){return BC(this,n)},Ae.prototype.getComponentsInChildren=function(n,e){return Hb(this,n,e)},Ae.prototype.getComponentInParent=function(n){return kC(this,n)},Ae.prototype.getComponentsInParent=function(n,e){return S2(this,n,e)},Object.getOwnPropertyDescriptor(Ae.prototype,"activeSelf")||Object.defineProperty(Ae.prototype,"activeSelf",{get:function(){return Qb(this)},set:function(n){GC(this,n)}}),Object.getOwnPropertyDescriptor(Ae.prototype,"worldPosition")||Object.defineProperty(Ae.prototype,"worldPosition",{get:function(){return this instanceof nF?ri(this.object):ri(this)},set:function(n){Cr(this,n)}}),Object.getOwnPropertyDescriptor(Ae.prototype,"worldQuaternion")||Object.defineProperty(Ae.prototype,"worldQuaternion",{get:function(){return this instanceof nF?fn(this.object):fn(this)},set:function(n){Ic(this,n)}}),Object.getOwnPropertyDescriptor(Ae.prototype,"worldRotation")||Object.defineProperty(Ae.prototype,"worldRotation",{get:function(){return ww(this)},set:function(n){dD(this,n)}}),Object.getOwnPropertyDescriptor(Ae.prototype,"worldScale")||Object.defineProperty(Ae.prototype,"worldScale",{get:function(){return Dn(this)},set:function(n){ib(this,n)}}),Object.getOwnPropertyDescriptor(Ae.prototype,"worldForward")||Object.defineProperty(Ae.prototype,"worldForward",{get:function(){return Lt().set(0,0,1).applyQuaternion(fn(this))}}),Object.getOwnPropertyDescriptor(Ae.prototype,"worldRight")||Object.defineProperty(Ae.prototype,"worldRight",{get:function(){return Lt().set(1,0,0).applyQuaternion(fn(this))}}),Object.getOwnPropertyDescriptor(Ae.prototype,"worldUp")||Object.defineProperty(Ae.prototype,"worldUp",{get:function(){return Lt().set(0,1,0).applyQuaternion(fn(this))}}),Wte(Ae);class pn extends fe{constructor(e,i,s,r){var o=(...a)=>{super(...a),m(this,"alpha",1)};i!=null&&s!=null?(o(e,i,s),this.alpha=r):(o(e),this.alpha=1)}get isRGBAColor(){return!0}set a(e){this.alpha=e}get a(){return this.alpha}clone(){const e=super.clone();return e.alpha=this.alpha,e}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,"alpha"in e&&typeof e.alpha=="number"?this.alpha=e.alpha:typeof e.a=="number"&&(this.alpha=e.a),this}lerp(e,i){const s=e;return s.alpha!=null&&(this.alpha=lt.lerp(this.alpha,s.alpha,i)),super.lerp(e,i)}lerpColors(e,i,s){const r=e,o=i;return r.alpha!=null&&o.alpha!=null&&(this.alpha=lt.lerp(r.alpha,o.alpha,s)),super.lerpColors(e,i,s)}multiply(e){const i=e;return i.alpha!=null&&(this.alpha=this.alpha*i.alpha),super.multiply(e)}fromArray(e,i=0){return this.alpha=e[i+3],super.fromArray(e,i)}}const I2=q("debuggetcomponent"),T2=q("debuginstantiate");var rie=(n=>(n[n.None=0]="None",n[n.HideInHierarchy=1]="HideInHierarchy",n[n.HideInInspector=2]="HideInInspector",n[n.DontSaveInEditor=4]="DontSaveInEditor",n[n.NotEditable=8]="NotEditable",n[n.DontSaveInBuild=16]="DontSaveInBuild",n[n.DontUnloadUnusedAsset=32]="DontUnloadUnusedAsset",n[n.DontSave=52]="DontSave",n[n.HideAndDontSave=61]="HideAndDontSave",n))(rie||{});class qh{constructor(){m(this,"idProvider"),m(this,"parent"),m(this,"keepWorldPosition"),m(this,"position"),m(this,"rotation"),m(this,"scale"),m(this,"visible"),m(this,"context"),m(this,"components")}clone(){var e,i,s;const r=new qh;return r.idProvider=this.idProvider,r.parent=this.parent,r.keepWorldPosition=this.keepWorldPosition,r.position=(e=this.position)==null?void 0:e.clone(),r.rotation=(i=this.rotation)==null?void 0:i.clone(),r.scale=(s=this.scale)==null?void 0:s.clone(),r.visible=this.visible,r.context=this.context,r.components=this.components,r}cloneAssign(e){var i,s,r;this.idProvider=e.idProvider,this.parent=e.parent,this.keepWorldPosition=e.keepWorldPosition,this.position=(i=e.position)==null?void 0:i.clone(),this.rotation=(s=e.rotation)==null?void 0:s.clone(),this.scale=(r=e.scale)==null?void 0:r.clone(),this.visible=e.visible,this.context=e.context,this.components=e.components}}function Qb(n){return n.visible}function GC(n,e){return typeof e=="number"&&(e=e>.5),n.visible=e,n.visible}function oie(n){return n[Du]||E2(n)}function aie(n,e){n[bte]=e}function E2(n){return ih.isUsingInstancing(n)}function rF(n,e){return qy(n,e,!0,!0)}const lie=Symbol("isDestroyed");function G0(n){return n[lie]}function cie(n,e){n[lie]=e}const oF=Symbol("isDontDestroy");function Kb(n,e=!0){n[oF]=e}const R2=[],L2=[];function Ol(n,e=!0,i=!1){R2.length=0,L2.length=0,aF(n,e,!0);for(const s of R2)s.gameObject=null,s.context=null;for(const s of L2)cie(s,!0),i&&zn(s),Ate(s);L2.length=0,R2.length=0}function aF(n,e=!0,i=!0){var s;if(n==null)return;const r=n;if(r.isComponent){if(r[oF])return;R2.push(r);const l=r.gameObject;r.__internalDisable(),r.__internalDestroy(),r.gameObject=l;return}if(n[oF])return;const o=n;I2&&console.log(o),L2.push(o);const a=(s=o.userData)==null?void 0:s.components;if(a!=null&&Array.isArray(a)){let l=a.length;for(let c=0;c<a.length;c++){const h=a[c];aF(h,e,!1),a.length<l&&(l=a.length,c--)}}if(e&&o.children)for(const l of o.children)aF(l,e,!1);i&&o.removeFromParent()}function P0(n,e,i=!0){return hie(n,e,i)}function*B2(n,e,i=!1,s=999,r=0){if(n!=null&&n.userData.components&&!(r>s)){for(const o of n.userData.components)e&&o?.isComponent===!0&&o instanceof e?yield o:yield o;if(i===!0)for(const o of n.children)yield*B2(o,e,!0,s,r+1)}}function hie(n,e,i,s=0){var r;if(n){if(n.isObject3D,s>1e3){console.warn("Failed to iterate components: too many levels");return}if((r=n.userData)!=null&&r.components)for(let o=0;o<n.userData.components.length;o++){const a=n.userData.components[o];if(a?.isComponent===!0){const l=e(a);if(l!==void 0)return l}}if(i&&n.children){const o=s+1;for(let a=0;a<n.children.length;a++){const l=n.children[a];if(!l)continue;const c=hie(l,e,i,o);if(c!==void 0)return c}}}}function Yb(n,e=null){let i=null;e!==null&&(e.x!==void 0?(i=new qh,i.position=e):i=e);let s=$t.Current;i!=null&&i.context&&(s=i.context),I2&&s.alias&&console.log("context",s.alias),i&&!i.idProvider&&(i.idProvider=new Zo(Date.now()));const r=[],o={},a={},l=die(s,n,i,r,o,a);l&&(Ike(o),Mke(a,o)),I2&&(jE(n,!0),jE(l,!0));const c={};if(i?.components!==!1){for(const h in r){const d=r[h],u=d.guid;i&&i.idProvider&&(d.guid=i.idProvider.generateUUID(),c[u]=d.guid,I2&&console.log(d.name,d.guid)),q2(d,s),d.__internalNewInstanceCreated&&d.__internalNewInstanceCreated()}for(const h in r){const d=r[h];d.resolveGuids&&d.resolveGuids(c),d.enabled!==!1&&(d.enabled=!0)}p2(s)}return l}function die(n,e,i,s,r,o){var a;if(!e)return null;const l=e.userData;e.userData={};const c=e.children;e.children=[];const h=e.clone(!1);if(M2(h),e.userData=l,e.children=c,r[e.uuid]={original:e,clone:h},T2&&console.log("ADD",e,h),e.type==="SkinnedMesh"&&(o[e.uuid]={original:e,clone:h}),i?.visible!==void 0&&(h.visible=i.visible),i!=null&&i.idProvider){h.uuid=i.idProvider.generateUUID();const u=h;u&&(u.guid=h.uuid)}e.animations&&e.animations.length>0&&(h.animations=[...e.animations]);const d=e.parent;if(d&&d.add(h),i!=null&&i.position?Cr(h,i.position):h.position.copy(e.position),i!=null&&i.rotation?Ic(h,i.rotation):h.quaternion.copy(e.quaternion),i!=null&&i.scale?h.scale.copy(i.scale):h.scale.copy(e.scale),i!=null&&i.parent&&i.parent!=="scene"){let u=null;if(typeof i.parent=="string"?u=qy(i.parent,n.scene,!0):u=i.parent,u){const p=i.keepWorldPosition===!0?u.attach:u.add;p?p.call(u,h):console.error("Invalid parent object",u,"received when instantiating:",e)}else console.warn("could not find parent:",i.parent)}for(const[u,p]of Object.entries(e.userData))u!=="components"&&(h.userData[u]=p);if((a=e.userData)!=null&&a.components){const u=e.userData.components,p=[];h.userData.components=p;for(let g=0;g<u.length;g++){const f=u[g],A=new f.constructor;Wb(A,f),f[Rw]!==void 0&&(A[Rw]=f[Rw]),p.push(A),A.gameObject=h,s.push(A),r[f.guid]={original:f,clone:A},vC.dispatchComponentLifecycleEvent("component-added",A)}}i&&(i.position=void 0,i.rotation=void 0,i.scale=void 0,i.parent=void 0);for(const u in e.children){const p=e.children[u],g=die(n,p,i,s,r,o);g&&h.add(g)}return h}function Mke(n,e){for(const i in n){const s=n[i],r=s.original,o=r.skeleton,a=s.clone;if(!o){console.warn("Skinned mesh has no skeleton?",s);continue}const l=o.bones,c=a.skeleton.clone();a.skeleton=c,a.bindMatrix.clone().copy(r.bindMatrix),a.bindMatrixInverse.copy(r.bindMatrixInverse);const h=[];c.bones=h;for(let d=0;d<l.length;d++){const u=l[d],p=e[u.uuid].clone;h.push(p)}}for(const i in n){const s=n[i].clone;s.skeleton.update(),s.bind(s.skeleton,s.bindMatrix),s.updateMatrixWorld(!0)}}function Ike(n){var e;for(const i in n){const s=n[i].clone;if(s!=null&&s.isObject3D&&(e=s?.userData)!=null&&e.components)for(let r=0;r<s.userData.components.length;r++){const o=s.userData.components[r],a=Object.entries(o);for(const[l,c]of a)if(Array.isArray(c)){const h=[];o[l]=h;for(let d=0;d<c.length;d++){const u=c[d];if(typeof u!="object"){h.push(u);continue}const p=uie(o,l,u,n);p!==void 0?h.push(p):h.push(u)}}else if(typeof c=="object"){const h=uie(o,l,c,n);h!==void 0&&(o[l]=h)}}}}function uie(n,e,i,s){var r,o;if(i!=null)if(i.isComponent===!0){const a=i.gameObject;if(a){const l=a.uuid,c=(r=s[l])==null?void 0:r.clone;if(!c){T2&&console.log("reference did not change",e,n,i);return}const h=a.userData.components.indexOf(i);if(h>=0&&c.isObject3D)return T2&&console.log(e,l),c.userData.components[h];console.warn("could not find component",e,i)}}else if(i.isObject3D===!0){if(e==="gameObject")return;const a=i;if(a){const l=a.uuid,c=(o=s[l])==null?void 0:o.clone;if(c)return T2&&console.log(e,"old",i,"new",c),c}}else{if(i.isVector4||i.isVector3||i.isVector2||i.isQuaternion||i.isEuler||i.isColor===!0)return i.clone();if(i.isEventList===!0)return i.__internalOnInstantiate(s)}}var pie={exports:{}},mie={exports:{}};(function(){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(i,s){return i<<s|i>>>32-s},rotr:function(i,s){return i<<32-s|i>>>s},endian:function(i){if(i.constructor==Number)return e.rotl(i,8)&16711935|e.rotl(i,24)&4278255360;for(var s=0;s<i.length;s++)i[s]=e.endian(i[s]);return i},randomBytes:function(i){for(var s=[];i>0;i--)s.push(Math.floor(Math.random()*256));return s},bytesToWords:function(i){for(var s=[],r=0,o=0;r<i.length;r++,o+=8)s[o>>>5]|=i[r]<<24-o%32;return s},wordsToBytes:function(i){for(var s=[],r=0;r<i.length*32;r+=8)s.push(i[r>>>5]>>>24-r%32&255);return s},bytesToHex:function(i){for(var s=[],r=0;r<i.length;r++)s.push((i[r]>>>4).toString(16)),s.push((i[r]&15).toString(16));return s.join("")},hexToBytes:function(i){for(var s=[],r=0;r<i.length;r+=2)s.push(parseInt(i.substr(r,2),16));return s},bytesToBase64:function(i){for(var s=[],r=0;r<i.length;r+=3)for(var o=i[r]<<16|i[r+1]<<8|i[r+2],a=0;a<4;a++)r*8+a*6<=i.length*8?s.push(n.charAt(o>>>6*(3-a)&63)):s.push("=");return s.join("")},base64ToBytes:function(i){i=i.replace(/[^A-Z0-9+\/]/ig,"");for(var s=[],r=0,o=0;r<i.length;o=++r%4)o!=0&&s.push((n.indexOf(i.charAt(r-1))&Math.pow(2,-2*o+8)-1)<<o*2|n.indexOf(i.charAt(r))>>>6-o*2);return s}};mie.exports=e})();var Tke=mie.exports,lF={utf8:{stringToBytes:function(n){return lF.bin.stringToBytes(unescape(encodeURIComponent(n)))},bytesToString:function(n){return decodeURIComponent(escape(lF.bin.bytesToString(n)))}},bin:{stringToBytes:function(n){for(var e=[],i=0;i<n.length;i++)e.push(n.charCodeAt(i)&255);return e},bytesToString:function(n){for(var e=[],i=0;i<n.length;i++)e.push(String.fromCharCode(n[i]));return e.join("")}}},gie=lF;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Eke=function(n){return n!=null&&(fie(n)||Rke(n)||!!n._isBuffer)};function fie(n){return!!n.constructor&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function Rke(n){return typeof n.readFloatLE=="function"&&typeof n.slice=="function"&&fie(n.slice(0,0))}(function(){var n=Tke,e=gie.utf8,i=Eke,s=gie.bin,r=function(o,a){o.constructor==String?a&&a.encoding==="binary"?o=s.stringToBytes(o):o=e.stringToBytes(o):i(o)?o=Array.prototype.slice.call(o,0):!Array.isArray(o)&&o.constructor!==Uint8Array&&(o=o.toString());for(var l=n.bytesToWords(o),c=o.length*8,h=1732584193,d=-271733879,u=-1732584194,p=271733878,g=0;g<l.length;g++)l[g]=(l[g]<<8|l[g]>>>24)&16711935|(l[g]<<24|l[g]>>>8)&4278255360;l[c>>>5]|=128<<c%32,l[(c+64>>>9<<4)+14]=c;for(var f=r._ff,A=r._gg,y=r._hh,b=r._ii,g=0;g<l.length;g+=16){var v=h,x=d,w=u,C=p;h=f(h,d,u,p,l[g+0],7,-680876936),p=f(p,h,d,u,l[g+1],12,-389564586),u=f(u,p,h,d,l[g+2],17,606105819),d=f(d,u,p,h,l[g+3],22,-1044525330),h=f(h,d,u,p,l[g+4],7,-176418897),p=f(p,h,d,u,l[g+5],12,1200080426),u=f(u,p,h,d,l[g+6],17,-1473231341),d=f(d,u,p,h,l[g+7],22,-45705983),h=f(h,d,u,p,l[g+8],7,1770035416),p=f(p,h,d,u,l[g+9],12,-1958414417),u=f(u,p,h,d,l[g+10],17,-42063),d=f(d,u,p,h,l[g+11],22,-1990404162),h=f(h,d,u,p,l[g+12],7,1804603682),p=f(p,h,d,u,l[g+13],12,-40341101),u=f(u,p,h,d,l[g+14],17,-1502002290),d=f(d,u,p,h,l[g+15],22,1236535329),h=A(h,d,u,p,l[g+1],5,-165796510),p=A(p,h,d,u,l[g+6],9,-1069501632),u=A(u,p,h,d,l[g+11],14,643717713),d=A(d,u,p,h,l[g+0],20,-373897302),h=A(h,d,u,p,l[g+5],5,-701558691),p=A(p,h,d,u,l[g+10],9,38016083),u=A(u,p,h,d,l[g+15],14,-660478335),d=A(d,u,p,h,l[g+4],20,-405537848),h=A(h,d,u,p,l[g+9],5,568446438),p=A(p,h,d,u,l[g+14],9,-1019803690),u=A(u,p,h,d,l[g+3],14,-187363961),d=A(d,u,p,h,l[g+8],20,1163531501),h=A(h,d,u,p,l[g+13],5,-1444681467),p=A(p,h,d,u,l[g+2],9,-51403784),u=A(u,p,h,d,l[g+7],14,1735328473),d=A(d,u,p,h,l[g+12],20,-1926607734),h=y(h,d,u,p,l[g+5],4,-378558),p=y(p,h,d,u,l[g+8],11,-2022574463),u=y(u,p,h,d,l[g+11],16,1839030562),d=y(d,u,p,h,l[g+14],23,-35309556),h=y(h,d,u,p,l[g+1],4,-1530992060),p=y(p,h,d,u,l[g+4],11,1272893353),u=y(u,p,h,d,l[g+7],16,-155497632),d=y(d,u,p,h,l[g+10],23,-1094730640),h=y(h,d,u,p,l[g+13],4,681279174),p=y(p,h,d,u,l[g+0],11,-358537222),u=y(u,p,h,d,l[g+3],16,-722521979),d=y(d,u,p,h,l[g+6],23,76029189),h=y(h,d,u,p,l[g+9],4,-640364487),p=y(p,h,d,u,l[g+12],11,-421815835),u=y(u,p,h,d,l[g+15],16,530742520),d=y(d,u,p,h,l[g+2],23,-995338651),h=b(h,d,u,p,l[g+0],6,-198630844),p=b(p,h,d,u,l[g+7],10,1126891415),u=b(u,p,h,d,l[g+14],15,-1416354905),d=b(d,u,p,h,l[g+5],21,-57434055),h=b(h,d,u,p,l[g+12],6,1700485571),p=b(p,h,d,u,l[g+3],10,-1894986606),u=b(u,p,h,d,l[g+10],15,-1051523),d=b(d,u,p,h,l[g+1],21,-2054922799),h=b(h,d,u,p,l[g+8],6,1873313359),p=b(p,h,d,u,l[g+15],10,-30611744),u=b(u,p,h,d,l[g+6],15,-1560198380),d=b(d,u,p,h,l[g+13],21,1309151649),h=b(h,d,u,p,l[g+4],6,-145523070),p=b(p,h,d,u,l[g+11],10,-1120210379),u=b(u,p,h,d,l[g+2],15,718787259),d=b(d,u,p,h,l[g+9],21,-343485551),h=h+v>>>0,d=d+x>>>0,u=u+w>>>0,p=p+C>>>0}return n.endian([h,d,u,p])};r._ff=function(o,a,l,c,h,d,u){var p=o+(a&l|~a&c)+(h>>>0)+u;return(p<<d|p>>>32-d)+a},r._gg=function(o,a,l,c,h,d,u){var p=o+(a&c|l&~c)+(h>>>0)+u;return(p<<d|p>>>32-d)+a},r._hh=function(o,a,l,c,h,d,u){var p=o+(a^l^c)+(h>>>0)+u;return(p<<d|p>>>32-d)+a},r._ii=function(o,a,l,c,h,d,u){var p=o+(l^(a|~c))+(h>>>0)+u;return(p<<d|p>>>32-d)+a},r._blocksize=16,r._digestsize=16,pie.exports=function(o,a){if(o==null)throw new Error("Illegal argument "+o);var l=n.wordsToBytes(r(o,a));return a&&a.asBytes?l:a&&a.asString?s.bytesToString(l):n.bytesToHex(l)}})();var Lke=pie.exports;const Aie=KR(Lke);var N0;(n=>{n.baseUrl="https://networking.needle.tools";function e(c){return Aie(new Uint8Array(c))}n.hashMD5=e;function i(c){const h=Aie(new Uint8Array(c),{encoding:"binary",asBytes:!0});return btoa(String.fromCharCode(...h))}n.hashMD5_Base64=i;function s(c){const h=new Uint8Array(c);return crypto.subtle.digest("SHA-256",h).then(d=>btoa(String.fromCharCode(...new Uint8Array(d))))}n.hashSha256=s;function r(c){const h=c.filesize/1024/1024;return Vh()?h<50:h<5}n.canUpload=r;async function o(c,h){var d;const u=n.baseUrl;if(u){if(!c.name)return console.error("Upload: file name is missing"),null}else return console.error("Blob storage base url is not set"),null;let p=null;c instanceof File?p=await c.arrayBuffer():p=c.data;const g=p.byteLength,f=g/1024/1024;if(f>50)return h?.silent!==!0&&An(`File (${f.toFixed(1)}MB) is too large for uploading (see console for details)`),console.warn(`Your file is too large for uploading (${f.toFixed(1)}MB). Max allowed size is 50MB`),null;if(!Vh()&&f>5)return h?.silent!==!0&&An('File is too large for uploading. Please get a <a href="https://needle.tools/pricing" target="_blank">commercial license</a> to upload files larger than 5MB'),console.warn(`Your file is too large for uploading (${f.toFixed(1)}MB). Max size is 5MB for non-commercial users. Please get a commercial license at https://needle.tools/pricing for larger files (up to 50MB)`),null;if(g<1)return console.warn(`Your file is too small for uploading (${f.toFixed(1)}MB). Min size is 1 byte`),null;const A=i(p),y={filename:c.name,"Content-Md5":A,"Content-Type":c.type||"application/octet-stream",FileSize:g.toString(),"Content-Disposition":`attachment; filename="${c.name}"`,"x-amz-server-side-encryption":"AES256"},b=await fetch(u+"/api/needle/blob",{method:"POST",headers:y,signal:h?.abort}).then(v=>v.json()).catch(v=>(console.error(v),null));if(b==null)return console.warn("Upload failed..."),null;if("error"in b)return console.error(b.error),null;if("upload"in b&&b.upload){let v=function(C){var S;return(S=h?.onProgress)==null||S.call(null,{progress01:0,state:"inprogress"}),fetch(C,{method:"PUT",headers:y,body:p,signal:h?.abort}).then(_=>{var I;return(I=h?.onProgress)==null||I.call(null,{progress01:1,state:"finished"}),_}).catch(_=>_)};console.debug("Uploading file",b.upload);let x=!1,w=null;for(let C=0;C<3;C++)try{if(x)break;if((d=h?.abort)!=null&&d.aborted)return console.debug("Aborted upload"),null;const S=await v(b.upload);S instanceof Error?(w=S,await Ah(1e3*C)):S.ok&&(console.debug("File uploaded successfully"),x=!0)}catch(S){console.error(S)}if(!x)return console.error(w?.message||"Failed to upload file"),null}if("download"in b){const v=u+b.download;return console.debug("File found in blob storage",v),{key:b.key,success:!0,download_url:v}}return null}n.upload=o;function a(c){return`${n.baseUrl}/api/needle/blob/${c}`}n.getBlobUrlForKey=a;async function l(c,h){var d;const u=await fetch(c),p=(d=u.body)==null?void 0:d.getReader(),g=u.headers.get("Content-Length"),f=g?parseInt(g):0;if(!p)return null;let A=0;const y=[];for(;;){const{done:x,value:w}=await p.read();if(w&&(y.push(w),A+=w.length,h?.call(null,new ProgressEvent("progress",{loaded:A,total:f}))),x)break}const b=new Uint8Array(A);let v=0;for(const x of y)b.set(x,v),v+=x.length;return b}n.download=l})(N0||(N0={}));const qm=q("debugaddressables");class yie{constructor(e){m(this,"_context"),m(this,"_assetReferences",{}),m(this,"preUpdate",()=>{}),this._context=e,this._context.pre_update_callbacks.push(this.preUpdate)}dispose(){const e=this._context.pre_update_callbacks.indexOf(this.preUpdate);e>=0&&this._context.pre_update_callbacks.splice(e,1);for(const i in this._assetReferences){const s=this._assetReferences[i];s?.unload()}this._assetReferences={}}findAssetReference(e){return this._assetReferences[e]||null}registerAssetReference(e){return e.url&&(this._assetReferences[e.url]?console.warn("Asset reference already registered",e):this._assetReferences[e.url]=e),e}unregisterAssetReference(e){e.url&&delete this._assetReferences[e.url]}}const cF=Symbol("assetReference"),jb=class{constructor(n,e,i=null){m(this,"_loading"),m(this,"_asset"),m(this,"_glbRoot"),m(this,"_url"),m(this,"_progressListeners",[]),m(this,"_hash"),m(this,"_hashedUri"),m(this,"_isLoadingRawBinary",!1),m(this,"_rawBinary"),this._url=n,this._hash=e,n.includes("?v=")?this._hashedUri=n:this._hashedUri=e?n+"?v="+e:n,i!==null&&(this.asset=i),Bte(this._url,this.onResolvePrefab.bind(this))}static getOrCreateFromUrl(n,e){if(!e&&(e=$t.Current,!e))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.');const i=e.addressables,s=i.findAssetReference(n);if(s)return s;const r=new jb(n,e.hash);return i.registerAssetReference(r),r}static getOrCreate(n,e,i){if(typeof n=="string"){if(!i&&(i=$t.Current,!i))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.')}else i=n.context,n=n.sourceId;const s=Sm(n,e);qm&&console.log("GetOrCreate Addressable from",n,e,"FinalPath=",s);const r=i.addressables,o=r.findAssetReference(s);if(o)return o;const a=new jb(s,i.hash);return r.registerAssetReference(a),a}get asset(){return this._glbRoot??this._asset}set asset(n){this._asset=n}get uri(){return this._url}get url(){return this._url}get hasUrl(){return this._url!==void 0&&(this._url.startsWith("http")||this._url.startsWith("blob:")||this._url.startsWith("www.")||this._url.includes("/"))}get rawAsset(){return this._asset}async onResolvePrefab(n){return n===this.url&&(this.mustLoad&&await this.loadAssetAsync(),this.asset)?this.asset:null}get mustLoad(){return!this.asset||this.asset.__destroyed===!0||G0(this.asset)===!0}isLoaded(){return this._rawBinary||this.asset!==void 0}unload(){this.asset&&(qm&&console.log("Unload",this.asset),this.asset.scene&&Ol(this.asset.scene,!0,!0),Ol(this.asset,!0,!0)),this.asset=null,this._rawBinary=void 0,this._glbRoot=null,this._loading=void 0,$t.Current&&$t.Current.addressables.unregisterAssetReference(this)}async preload(){if(!this.mustLoad||this._isLoadingRawBinary)return null;if(this._rawBinary!==void 0)return this._rawBinary;this._isLoadingRawBinary=!0,qm&&console.log("Preload",this._hashedUri);const n=await N0.download(this._hashedUri,e=>{this.raiseProgressEvent(e)});return this._rawBinary=n?.buffer??null,this._isLoadingRawBinary=!1,this._rawBinary}async loadAssetAsync(n){if(qm&&console.log("loadAssetAsync",this.url),!this.mustLoad)return this.asset;if(n&&this._progressListeners.push(n),this._loading!==void 0)return this._loading.then(s=>this.asset);const e=$t.Current;this._rawBinary?(this._loading=fh().parseSync(e,this._rawBinary,this.url,null),this.raiseProgressEvent(new ProgressEvent("progress",{loaded:this._rawBinary.byteLength,total:this._rawBinary.byteLength}))):(qm&&console.log("Load async",this.url),this._loading=fh().loadSync(e,this._hashedUri,this.url,null,s=>{this.raiseProgressEvent(s)}));const i=await this._loading;if(this._progressListeners.length=0,this._glbRoot=this.tryGetActualGameObjectRoot(i),this._loading=void 0,i)return i[cF]=this,this._glbRoot&&(this._glbRoot[cF]=this),this.asset&&(this.asset[cF]=this),p2(e),i.scene!==void 0&&(this.asset=i),this.asset}async instantiate(n){return this.onInstantiate(n,!1)}async instantiateSynced(n,e=!0){return this.onInstantiate(n,!0,e)}beginListenDownload(n){this._progressListeners.indexOf(n)<0&&this._progressListeners.push(n)}endListenDownload(n){const e=this._progressListeners.indexOf(n);e>=0&&this._progressListeners.splice(e,1)}raiseProgressEvent(n){for(const e of this._progressListeners)e(this,n)}async onInstantiate(n,e=!1,i){const s=$t.Current,r=new qh;if(n instanceof Ae?r.parent=n:n&&(Object.assign(r,n),r.cloneAssign(n)),r.parent||(r.parent=s.scene),this.mustLoad&&await this.loadAssetAsync(),qm&&console.log("Instantiate",this.url,"parent:",n),this.asset){qm&&console.log("Add to scene",this.asset);let o=jb.currentlyInstantiating.get(this.url);if(o!==void 0&&o>=1e4)return console.error("Recursive or too many instantiations of "+this.url+" in the same frame ("+o+")"),null;try{if(o===void 0&&(o=0),o+=1,jb.currentlyInstantiating.set(this.url,o),e){r.context=s;const a=this.asset;a.guid=this.url;const l=Hz(a,r,void 0,i);if(l)return l}else{const a=Yb(this.asset,r);if(a)return a}}finally{s.post_render_callbacks.push(()=>{o===void 0||o<0?o=0:o-=1,jb.currentlyInstantiating.set(this.url,o)})}}else qm&&console.warn("Failed to load asset",this.url);return null}tryGetActualGameObjectRoot(n){if(n&&n.scene){const e=n.scene;return e.isGroup&&e.children.length===1&&e.children[0].name+"glb"===e.name?e.children[0]:e}return null}};let Mi=jb;m(Mi,"currentlyInstantiating",new Map);class Bke extends Nc{constructor(){super([Mi],"AssetReferenceSerializer")}onSerialize(e,i){if(e&&e.uri!==void 0&&typeof e.uri=="string")return e.uri}onDeserialize(e,i){if(typeof e=="string")return i.context?i.gltfId?Mi.getOrCreate(i.gltfId,e,i.context):(console.error("Missing source id"),null):(console.error("Missing context"),null);if(e instanceof Ae){if(!i.context)return console.error("Missing context"),null;if(!i.gltfId)return console.error("Missing source id"),null;const s=e,r=i.context,o=s.guid??s.uuid,a=r.addressables.findAssetReference(o);if(a)return a;const l=new Mi(o,void 0,s);return r.addressables.registerAssetReference(l),l}return null}}new Bke;const kke=Promise.resolve(null),k2=class{constructor(n){m(this,"url"),m(this,"_bitmap"),m(this,"_bitmapObject"),m(this,"loader",null),this.url=n}static getOrCreate(n){let e=k2.imageReferences.get(n);return e||(e=new k2(n),k2.imageReferences.set(n,e)),e}dispose(){this._bitmapObject&&this._bitmapObject.close(),this._bitmap=void 0}createHTMLImage(){const n=new Image;return n.src=this.url,n}createTexture(){return this.url?(this.loader||(this.loader=new hh),this.loader.setCrossOrigin("anonymous"),this.loader.loadAsync(this.url)):kke}getBitmap(){return this._bitmap?this._bitmap:(this._bitmap=new Promise((n,e)=>{const i=document.createElement("img");i.addEventListener("load",()=>{this._bitmap=createImageBitmap(i).then(s=>(this._bitmapObject=s,n(s),s))}),i.addEventListener("error",s=>{console.error("Failed to load image:"+this.url,s),n(null)}),i.src=this.url}),this._bitmap)}};let G2=k2;m(G2,"imageReferences",new Map);class bie extends Nc{constructor(){super([G2],"ImageReferenceSerializer")}onSerialize(e,i){return null}onDeserialize(e,i){if(typeof e=="string"){const s=Sm(i.gltfId,e);return G2.getOrCreate(s)}}}new bie;const P2=class{constructor(n){m(this,"url"),m(this,"res"),this.url=n}static getOrCreate(n){let e=P2.cache.get(n);return e||(e=new P2(n),P2.cache.set(n,e)),e}async loadRaw(){return this.res||(this.res=fetch(this.url)),this.res.then(n=>n.blob())}async loadText(){return this.res||(this.res=fetch(this.url)),this.res.then(n=>n.text())}};let N2=P2;m(N2,"cache",new Map);class vie extends Nc{constructor(){super([N2],"FileReferenceSerializer")}onSerialize(e,i){return null}onDeserialize(e,i){if(typeof e=="string"){const s=Sm(i.gltfId,e);return N2.getOrCreate(s)}}}new vie;class Gke{constructor(e){m(this,"context"),m(this,"mixers",[]),this.context=e}onDestroy(){this.mixers.forEach(e=>e.stopAllAction()),this.mixers.length=0}registerAnimationMixer(e){if(!e){console.warn("AnimationsRegistry.registerAnimationMixer called with null or undefined mixer");return}this.mixers.includes(e)||this.mixers.push(e)}unregisterAnimationMixer(e){if(!e){console.warn("AnimationsRegistry.unregisterAnimationMixer called with null or undefined mixer");return}const i=this.mixers.indexOf(e);i!==-1&&this.mixers.splice(i,1)}}class Jb{static tryGetActionsFromMixer(e){return e._actions||null}static tryGetAnimationClipsFromObjectHierarchy(e,i){if(i||(i=new Array),e)e.animations&&i.push(...e.animations);else return i;if(e.children)for(const s of e.children)this.tryGetAnimationClipsFromObjectHierarchy(s,i);return i}static assignAnimationsFromFile(e,i){if(!e||!e.animations){console.debug("No animations found in file");return}for(let r=0;r<e.animations.length;r++){const o=e.animations[r];if(!o.tracks||o.tracks.length<=0){console.warn("Animation has no tracks");continue}for(const a in o.tracks){const l=o.tracks[a],c=xi.parseTrackName(l.name);let h=xi.findNode(e.scene,c.nodeName);if(!h){const u=l.__objectName??l.name.substring(0,l.name.indexOf("."));if(h=e.scene.getObjectByProperty("uuid",u),!h)continue}let d=s(h);if(!d){if(!(i!=null&&i.createAnimationComponent)){console.warn("No AnimationComponent found in parent hierarchy of object and no 'createAnimationComponent' callback was provided in options.");continue}d=i.createAnimationComponent(e.scene,o)}d.addClip&&d.addClip(o)}}function s(r){var o;if(!r)return null;const a=(o=r.userData)==null?void 0:o.components;if(a&&a.length>0){for(let l=0;l<a.length;l++)if(a[l].isAnimationComponent===!0)return r}return s(r.parent)}}}var V2=(n=>(n.Visible="application-visible",n.Hidden="application-hidden",n.MuteChanged="application-mutechanged",n))(V2||{});let X2=!1;const qb=[];function V0(){if(X2)return;Je()&&console.debug("User interaction registered: audio can now be played"),X2=!0;const n=[...qb];qb.length=0,n.forEach(e=>e())}document.addEventListener("mousedown",V0),document.addEventListener("pointerup",V0),document.addEventListener("click",V0),document.addEventListener("dragstart",V0),document.addEventListener("touchend",V0),document.addEventListener("keydown",V0),Qt.onXRSessionStart(()=>{V0()});const xie=class extends EventTarget{constructor(n){super(),m(this,"_mute",!1),m(this,"context"),m(this,"_isVisible",!0),this.context=n,window.addEventListener("visibilitychange",this.onVisiblityChanged.bind(this),!1)}static get userInteractionRegistered(){return X2}static registerWaitForInteraction(n){if(n!==null){if(X2){n();return}qb.indexOf(n)===-1&&qb.push(n)}}static unregisterWaitForInteraction(n){const e=qb.indexOf(n);e!==-1&&qb.splice(e,1)}get muted(){return this._mute}set muted(n){n!==this._mute&&(this._mute=n,this.dispatchEvent(new Event("application-mutechanged")))}get hasFocus(){return document.hasFocus()}get isVisible(){return this._isVisible}onVisiblityChanged(n){switch(n.target.visibilityState){case"hidden":this._isVisible=!1,this.dispatchEvent(new Event("application-hidden"));break;case"visible":this._isVisible=!0,this.dispatchEvent(new Event("application-visible"));break}}};let op=xie;m(op,"registerWaitForAllowAudio",xie.registerWaitForInteraction);function*wie(n,e=null){const i=e?e.time:$t.Current.time,s=i.time;for(;i.time-s<n;)yield}function*Pke(n){for(let e=0;e<n;e++)yield}function*Cie(n){let e=!0;for(n.then(()=>e=!1),n.catch(()=>e=!1);e;)yield}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var ks=Uint8Array,Zl=Uint16Array,hF=Int32Array,D2=new ks([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),z2=new ks([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),dF=new ks([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Sie=function(n,e){for(var i=new Zl(31),s=0;s<31;++s)i[s]=e+=1<<n[s-1];for(var r=new hF(i[30]),s=1;s<30;++s)for(var o=i[s];o<i[s+1];++o)r[o]=o-i[s]<<5|s;return{b:i,r}},_ie=Sie(D2,2),Mie=_ie.b,uF=_ie.r;Mie[28]=258,uF[258]=28;for(var Iie=Sie(z2,0),Nke=Iie.b,Tie=Iie.r,pF=new Zl(32768),es=0;es<32768;++es){var $m=(es&43690)>>1|(es&21845)<<1;$m=($m&52428)>>2|($m&13107)<<2,$m=($m&61680)>>4|($m&3855)<<4,pF[es]=(($m&65280)>>8|($m&255)<<8)>>1}for(var kd=function(n,e,i){for(var s=n.length,r=0,o=new Zl(e);r<s;++r)n[r]&&++o[n[r]-1];var a=new Zl(e);for(r=1;r<e;++r)a[r]=a[r-1]+o[r-1]<<1;var l;if(i){l=new Zl(1<<e);var c=15-e;for(r=0;r<s;++r)if(n[r])for(var h=r<<4|n[r],d=e-n[r],u=a[n[r]-1]++<<d,p=u|(1<<d)-1;u<=p;++u)l[pF[u]>>c]=h}else for(l=new Zl(s),r=0;r<s;++r)n[r]&&(l[r]=pF[a[n[r]-1]++]>>15-n[r]);return l},eg=new ks(288),es=0;es<144;++es)eg[es]=8;for(var es=144;es<256;++es)eg[es]=9;for(var es=256;es<280;++es)eg[es]=7;for(var es=280;es<288;++es)eg[es]=8;for(var PC=new ks(32),es=0;es<32;++es)PC[es]=5;var Vke=kd(eg,9,0),Xke=kd(eg,9,1),Dke=kd(PC,5,0),zke=kd(PC,5,1),mF=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},Ph=function(n,e,i){var s=e/8|0;return(n[s]|n[s+1]<<8)>>(e&7)&i},gF=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(e&7)},fF=function(n){return(n+7)/8|0},AF=function(n,e,i){return(e==null||e<0)&&(e=0),(i==null||i>n.length)&&(i=n.length),new ks(n.subarray(e,i))},Fke=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ol=function(n,e,i){var s=new Error(e||Fke[n]);if(s.code=n,Error.captureStackTrace&&Error.captureStackTrace(s,ol),!i)throw s;return s},Uke=function(n,e,i,s){var r=n.length,o=s?s.length:0;if(!r||e.f&&!e.l)return i||new ks(0);var a=!i,l=a||e.i!=2,c=e.i;a&&(i=new ks(r*3));var h=function(Re){var ze=i.length;if(Re>ze){var U=new ks(Math.max(ze*2,Re));U.set(i),i=U}},d=e.f||0,u=e.p||0,p=e.b||0,g=e.l,f=e.d,A=e.m,y=e.n,b=r*8;do{if(!g){d=Ph(n,u,1);var v=Ph(n,u+1,3);if(u+=3,v)if(v==1)g=Xke,f=zke,A=9,y=5;else if(v==2){var x=Ph(n,u,31)+257,w=Ph(n,u+10,15)+4,C=x+Ph(n,u+5,31)+1;u+=14;for(var S=new ks(C),_=new ks(19),I=0;I<w;++I)_[dF[I]]=Ph(n,u+I*3,7);u+=w*3;for(var B=mF(_),M=(1<<B)-1,R=kd(_,B,1),I=0;I<C;){var k=R[Ph(n,u,M)];u+=k&15;var G=k>>4;if(G<16)S[I++]=G;else{var X=0,F=0;for(G==16?(F=3+Ph(n,u,3),u+=2,X=S[I-1]):G==17?(F=3+Ph(n,u,7),u+=3):G==18&&(F=11+Ph(n,u,127),u+=7);F--;)S[I++]=X}}var z=S.subarray(0,x),H=S.subarray(x);A=mF(z),y=mF(H),g=kd(z,A,1),f=kd(H,y,1)}else ol(1);else{var G=fF(u)+4,Z=n[G-4]|n[G-3]<<8,he=G+Z;if(he>r){c&&ol(0);break}l&&h(p+Z),i.set(n.subarray(G,he),p),e.b=p+=Z,e.p=u=he*8,e.f=d;continue}if(u>b){c&&ol(0);break}}l&&h(p+131072);for(var be=(1<<A)-1,_e=(1<<y)-1,Ye=u;;Ye=u){var X=g[gF(n,u)&be],je=X>>4;if(u+=X&15,u>b){c&&ol(0);break}if(X||ol(2),je<256)i[p++]=je;else if(je==256){Ye=u,g=null;break}else{var le=je-254;if(je>264){var I=je-257,ve=D2[I];le=Ph(n,u,(1<<ve)-1)+Mie[I],u+=ve}var Pe=f[gF(n,u)&_e],ke=Pe>>4;Pe||ol(3),u+=Pe&15;var H=Nke[ke];if(ke>3){var ve=z2[ke];H+=gF(n,u)&(1<<ve)-1,u+=ve}if(u>b){c&&ol(0);break}l&&h(p+131072);var _t=p+le;if(p<H){var rt=o-H,xt=Math.min(H,_t);for(rt+p<0&&ol(3);p<xt;++p)i[p]=s[rt+p]}for(;p<_t;++p)i[p]=i[p-H]}}e.l=g,e.p=Ye,e.b=p,e.f=d,g&&(d=1,e.m=A,e.d=f,e.n=y)}while(!d);return p!=i.length&&a?AF(i,0,p):i.subarray(0,p)},ap=function(n,e,i){i<<=e&7;var s=e/8|0;n[s]|=i,n[s+1]|=i>>8},NC=function(n,e,i){i<<=e&7;var s=e/8|0;n[s]|=i,n[s+1]|=i>>8,n[s+2]|=i>>16},yF=function(n,e){for(var i=[],s=0;s<n.length;++s)n[s]&&i.push({s,f:n[s]});var r=i.length,o=i.slice();if(!r)return{t:Bie,l:0};if(r==1){var a=new ks(i[0].s+1);return a[i[0].s]=1,{t:a,l:1}}i.sort(function(C,S){return C.f-S.f}),i.push({s:-1,f:25001});var l=i[0],c=i[1],h=0,d=1,u=2;for(i[0]={s:-1,f:l.f+c.f,l,r:c};d!=r-1;)l=i[i[h].f<i[u].f?h++:u++],c=i[h!=d&&i[h].f<i[u].f?h++:u++],i[d++]={s:-1,f:l.f+c.f,l,r:c};for(var p=o[0].s,s=1;s<r;++s)o[s].s>p&&(p=o[s].s);var g=new Zl(p+1),f=bF(i[d-1],g,0);if(f>e){var s=0,A=0,y=f-e,b=1<<y;for(o.sort(function(S,_){return g[_.s]-g[S.s]||S.f-_.f});s<r;++s){var v=o[s].s;if(g[v]>e)A+=b-(1<<f-g[v]),g[v]=e;else break}for(A>>=y;A>0;){var x=o[s].s;g[x]<e?A-=1<<e-g[x]++-1:++s}for(;s>=0&&A;--s){var w=o[s].s;g[w]==e&&(--g[w],++A)}f=e}return{t:new ks(g),l:f}},bF=function(n,e,i){return n.s==-1?Math.max(bF(n.l,e,i+1),bF(n.r,e,i+1)):e[n.s]=i},Eie=function(n){for(var e=n.length;e&&!n[--e];);for(var i=new Zl(++e),s=0,r=n[0],o=1,a=function(c){i[s++]=c},l=1;l<=e;++l)if(n[l]==r&&l!=e)++o;else{if(!r&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(r),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}for(;o--;)a(r);o=1,r=n[l]}return{c:i.subarray(0,s),n:e}},VC=function(n,e){for(var i=0,s=0;s<e.length;++s)i+=n[s]*e[s];return i},Rie=function(n,e,i){var s=i.length,r=fF(e+2);n[r]=s&255,n[r+1]=s>>8,n[r+2]=n[r]^255,n[r+3]=n[r+1]^255;for(var o=0;o<s;++o)n[r+o+4]=i[o];return(r+4+s)*8},Lie=function(n,e,i,s,r,o,a,l,c,h,d){ap(e,d++,i),++r[256];for(var u=yF(r,15),p=u.t,g=u.l,f=yF(o,15),A=f.t,y=f.l,b=Eie(p),v=b.c,x=b.n,w=Eie(A),C=w.c,S=w.n,_=new Zl(19),I=0;I<v.length;++I)++_[v[I]&31];for(var I=0;I<C.length;++I)++_[C[I]&31];for(var B=yF(_,7),M=B.t,R=B.l,k=19;k>4&&!M[dF[k-1]];--k);var G=h+5<<3,X=VC(r,eg)+VC(o,PC)+a,F=VC(r,p)+VC(o,A)+a+14+3*k+VC(_,M)+2*_[16]+3*_[17]+7*_[18];if(c>=0&&G<=X&&G<=F)return Rie(e,d,n.subarray(c,c+h));var z,H,Z,he;if(ap(e,d,1+(F<X)),d+=2,F<X){z=kd(p,g,0),H=p,Z=kd(A,y,0),he=A;var be=kd(M,R,0);ap(e,d,x-257),ap(e,d+5,S-1),ap(e,d+10,k-4),d+=14;for(var I=0;I<k;++I)ap(e,d+3*I,M[dF[I]]);d+=3*k;for(var _e=[v,C],Ye=0;Ye<2;++Ye)for(var je=_e[Ye],I=0;I<je.length;++I){var le=je[I]&31;ap(e,d,be[le]),d+=M[le],le>15&&(ap(e,d,je[I]>>5&127),d+=je[I]>>12)}}else z=Vke,H=eg,Z=Dke,he=PC;for(var I=0;I<l;++I){var ve=s[I];if(ve>255){var le=ve>>18&31;NC(e,d,z[le+257]),d+=H[le+257],le>7&&(ap(e,d,ve>>23&31),d+=D2[le]);var Pe=ve&31;NC(e,d,Z[Pe]),d+=he[Pe],Pe>3&&(NC(e,d,ve>>5&8191),d+=z2[Pe])}else NC(e,d,z[ve]),d+=H[ve]}return NC(e,d,z[256]),d+H[256]},Oke=new hF([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Bie=new ks(0),Zke=function(n,e,i,s,r,o){var a=o.z||n.length,l=new ks(s+a+5*(1+Math.ceil(a/7e3))+r),c=l.subarray(s,l.length-r),h=o.l,d=(o.r||0)&7;if(e){d&&(c[0]=o.r>>3);for(var u=Oke[e-1],p=u>>13,g=u&8191,f=(1<<i)-1,A=o.p||new Zl(32768),y=o.h||new Zl(f+1),b=Math.ceil(i/3),v=2*b,x=function(ot){return(n[ot]^n[ot+1]<<b^n[ot+2]<<v)&f},w=new hF(25e3),C=new Zl(288),S=new Zl(32),_=0,I=0,B=o.i||0,M=0,R=o.w||0,k=0;B+2<a;++B){var G=x(B),X=B&32767,F=y[G];if(A[X]=F,y[G]=X,R<=B){var z=a-B;if((_>7e3||M>24576)&&(z>423||!h)){d=Lie(n,c,0,w,C,S,I,M,k,B-k,d),M=_=I=0,k=B;for(var H=0;H<286;++H)C[H]=0;for(var H=0;H<30;++H)S[H]=0}var Z=2,he=0,be=g,_e=X-F&32767;if(z>2&&G==x(B-_e))for(var Ye=Math.min(p,z)-1,je=Math.min(32767,B),le=Math.min(258,z);_e<=je&&--be&&X!=F;){if(n[B+Z]==n[B+Z-_e]){for(var ve=0;ve<le&&n[B+ve]==n[B+ve-_e];++ve);if(ve>Z){if(Z=ve,he=_e,ve>Ye)break;for(var Pe=Math.min(_e,ve-2),ke=0,H=0;H<Pe;++H){var _t=B-_e+H&32767,rt=A[_t],xt=_t-rt&32767;xt>ke&&(ke=xt,F=_t)}}}X=F,F=A[X],_e+=X-F&32767}if(he){w[M++]=268435456|uF[Z]<<18|Tie[he];var Re=uF[Z]&31,ze=Tie[he]&31;I+=D2[Re]+z2[ze],++C[257+Re],++S[ze],R=B+Z,++_}else w[M++]=n[B],++C[n[B]]}}for(B=Math.max(B,R);B<a;++B)w[M++]=n[B],++C[n[B]];d=Lie(n,c,h,w,C,S,I,M,k,B-k,d),h||(o.r=d&7|c[d/8|0]<<3,d-=7,o.h=y,o.p=A,o.i=B,o.w=R)}else{for(var B=o.w||0;B<a+h;B+=65535){var U=B+65535;U>=a&&(c[d/8|0]=h,U=a),d=Rie(c,d+1,n.subarray(B,U))}o.i=a}return AF(l,0,s+fF(d)+r)},Wke=function(){for(var n=new Int32Array(256),e=0;e<256;++e){for(var i=e,s=9;--s;)i=(i&1&&-306674912)^i>>>1;n[e]=i}return n}(),Hke=function(){var n=-1;return{p:function(e){for(var i=n,s=0;s<e.length;++s)i=Wke[i&255^e[s]]^i>>>8;n=i},d:function(){return~n}}},Qke=function(n,e,i,s,r){if(!r&&(r={l:1},e.dictionary)){var o=e.dictionary.subarray(-32768),a=new ks(o.length+n.length);a.set(o),a.set(n,o.length),n=a,r.w=o.length}return Zke(n,e.level==null?6:e.level,e.mem==null?r.l?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):20:12+e.mem,i,s,r)},kie=function(n,e){var i={};for(var s in n)i[s]=n[s];for(var s in e)i[s]=e[s];return i},So=function(n,e,i){for(;i;++e)n[e]=i,i>>>=8},Kke=function(n,e){return((n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31)&&ol(6,"invalid zlib data"),(n[1]>>5&1)==+!e&&ol(6,"invalid zlib data: "+(n[1]&32?"need":"unexpected")+" dictionary"),(n[1]>>3&4)+2};function Yke(n,e){return Qke(n,e||{},0,0)}function XC(n,e){return Uke(n.subarray(Kke(n,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}var Gie=function(n,e,i,s){for(var r in n){var o=n[r],a=e+r,l=s;Array.isArray(o)&&(l=kie(s,o[1]),o=o[0]),o instanceof ks?i[a]=[o,l]:(i[a+="/"]=[new ks(0),l],Gie(o,a,i,s))}},Pie=typeof TextEncoder<"u"&&new TextEncoder,jke=typeof TextDecoder<"u"&&new TextDecoder,Jke=0;try{jke.decode(Bie,{stream:!0}),Jke=1}catch{}function F2(n,e){if(e){for(var i=new ks(n.length),s=0;s<n.length;++s)i[s]=n.charCodeAt(s);return i}if(Pie)return Pie.encode(n);for(var r=n.length,o=new ks(n.length+(n.length>>1)),a=0,l=function(u){o[a++]=u},s=0;s<r;++s){if(a+5>o.length){var c=new ks(a+8+(r-s<<1));c.set(o),o=c}var h=n.charCodeAt(s);h<128||e?l(h):h<2048?(l(192|h>>6),l(128|h&63)):h>55295&&h<57344?(h=65536+(h&1047552)|n.charCodeAt(++s)&1023,l(240|h>>18),l(128|h>>12&63),l(128|h>>6&63),l(128|h&63)):(l(224|h>>12),l(128|h>>6&63),l(128|h&63))}return AF(o,0,a)}var vF=function(n){var e=0;if(n)for(var i in n){var s=n[i].length;s>65535&&ol(9),e+=s+4}return e},Nie=function(n,e,i,s,r,o,a,l){var c=s.length,h=i.extra,d=l&&l.length,u=vF(h);So(n,e,a!=null?33639248:67324752),e+=4,a!=null&&(n[e++]=20,n[e++]=i.os),n[e]=20,e+=2,n[e++]=i.flag<<1|(o<0&&8),n[e++]=r&&8,n[e++]=i.compression&255,n[e++]=i.compression>>8;var p=new Date(i.mtime==null?Date.now():i.mtime),g=p.getFullYear()-1980;if((g<0||g>119)&&ol(10),So(n,e,g<<25|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>1),e+=4,o!=-1&&(So(n,e,i.crc),So(n,e+4,o<0?-o-2:o),So(n,e+8,i.size)),So(n,e+12,c),So(n,e+14,u),e+=16,a!=null&&(So(n,e,d),So(n,e+6,i.attrs),So(n,e+10,a),e+=14),n.set(s,e),e+=c,u)for(var f in h){var A=h[f],y=A.length;So(n,e,+f),So(n,e+2,y),n.set(A,e+4),e+=4+y}return d&&(n.set(l,e),e+=d),e},qke=function(n,e,i,s,r){So(n,e,101010256),So(n,e+8,i),So(n,e+10,i),So(n,e+12,s),So(n,e+16,r)};function $ke(n,e){e||(e={});var i={},s=[];Gie(n,"",i,e);var r=0,o=0;for(var a in i){var l=i[a],c=l[0],h=l[1],d=h.level==0?0:8,u=F2(a),p=u.length,g=h.comment,f=g&&F2(g),A=f&&f.length,y=vF(h.extra);p>65535&&ol(11);var b=d?Yke(c,h):c,v=b.length,x=Hke();x.p(c),s.push(kie(h,{size:c.length,crc:x.d(),c:b,f:u,m:f,u:p!=a.length||f&&g.length!=A,o:r,compression:d})),r+=30+p+y+v,o+=76+2*(p+y)+(A||0)+v}for(var w=new ks(o+22),C=r,S=o-r,_=0;_<s.length;++_){var u=s[_];Nie(w,u.o,u,u.f,u.u,u.c.length);var I=30+u.f.length+vF(u.extra);w.set(u.c,u.o+I),Nie(w,r,u,u.f,u.u,u.c.length,u.o,u.m),r+=16+I+(u.m?u.m.length:0)}return qke(w,r,s.length,S,C),w}class DC extends FP{constructor(e){super(e),this.type=Ki}parse(e){const i=Math.pow(2.7182818,2.2);function s(L,P){let W=0;for(let Se=0;Se<65536;++Se)(Se==0||L[Se>>3]&1<<(Se&7))&&(P[W++]=Se);const te=W-1;for(;W<65536;)P[W++]=0;return te}function r(L){for(let P=0;P<16384;P++)L[P]={},L[P].len=0,L[P].lit=0,L[P].p=null}const o={l:0,c:0,lc:0};function a(L,P,W,te,Se){for(;W<L;)P=P<<8|ze(te,Se),W+=8;W-=L,o.l=P>>W&(1<<L)-1,o.c=P,o.lc=W}const l=new Array(59);function c(L){for(let W=0;W<=58;++W)l[W]=0;for(let W=0;W<65537;++W)l[L[W]]+=1;let P=0;for(let W=58;W>0;--W){const te=P+l[W]>>1;l[W]=P,P=te}for(let W=0;W<65537;++W){const te=L[W];te>0&&(L[W]=te|l[te]++<<6)}}function h(L,P,W,te,Se,re){const Ve=P;let qe=0,Ke=0;for(;te<=Se;te++){if(Ve.value-P.value>W)return!1;a(6,qe,Ke,L,Ve);const We=o.l;if(qe=o.c,Ke=o.lc,re[te]=We,We==63){if(Ve.value-P.value>W)throw new Error("Something wrong with hufUnpackEncTable");a(8,qe,Ke,L,Ve);let De=o.l+6;if(qe=o.c,Ke=o.lc,te+De>Se+1)throw new Error("Something wrong with hufUnpackEncTable");for(;De--;)re[te++]=0;te--}else if(We>=59){let De=We-59+2;if(te+De>Se+1)throw new Error("Something wrong with hufUnpackEncTable");for(;De--;)re[te++]=0;te--}}c(re)}function d(L){return L&63}function u(L){return L>>6}function p(L,P,W,te){for(;P<=W;P++){const Se=u(L[P]),re=d(L[P]);if(Se>>re)throw new Error("Invalid table entry");if(re>14){const Ve=te[Se>>re-14];if(Ve.len)throw new Error("Invalid table entry");if(Ve.lit++,Ve.p){const qe=Ve.p;Ve.p=new Array(Ve.lit);for(let Ke=0;Ke<Ve.lit-1;++Ke)Ve.p[Ke]=qe[Ke]}else Ve.p=new Array(1);Ve.p[Ve.lit-1]=P}else if(re){let Ve=0;for(let qe=1<<14-re;qe>0;qe--){const Ke=te[(Se<<14-re)+Ve];if(Ke.len||Ke.p)throw new Error("Invalid table entry");Ke.len=re,Ke.lit=P,Ve++}}}return!0}const g={c:0,lc:0};function f(L,P,W,te){L=L<<8|ze(W,te),P+=8,g.c=L,g.lc=P}const A={c:0,lc:0};function y(L,P,W,te,Se,re,Ve,qe,Ke){if(L==P){te<8&&(f(W,te,Se,re),W=g.c,te=g.lc),te-=8;let We=W>>te;if(We=new Uint8Array([We])[0],qe.value+We>Ke)return!1;const De=Ve[qe.value-1];for(;We-- >0;)Ve[qe.value++]=De}else if(qe.value<Ke)Ve[qe.value++]=L;else return!1;A.c=W,A.lc=te}function b(L){return L&65535}function v(L){const P=b(L);return P>32767?P-65536:P}const x={a:0,b:0};function w(L,P){const W=v(L),te=v(P),Se=W+(te&1)+(te>>1),re=Se,Ve=Se-te;x.a=re,x.b=Ve}function C(L,P){const W=b(L),te=b(P),Se=W-(te>>1)&65535,re=te+Se-32768&65535;x.a=re,x.b=Se}function S(L,P,W,te,Se,re,Ve){const qe=Ve<16384,Ke=W>Se?Se:W;let We=1,De,vt;for(;We<=Ke;)We<<=1;for(We>>=1,De=We,We>>=1;We>=1;){vt=0;const gt=vt+re*(Se-De),Bt=re*We,ei=re*De,wt=te*We,kt=te*De;let mi,En,us,ma;for(;vt<=gt;vt+=ei){let Rn=vt;const V=vt+te*(W-De);for(;Rn<=V;Rn+=kt){const ee=Rn+wt,me=Rn+Bt,ue=me+wt;qe?(w(L[Rn+P],L[me+P]),mi=x.a,us=x.b,w(L[ee+P],L[ue+P]),En=x.a,ma=x.b,w(mi,En),L[Rn+P]=x.a,L[ee+P]=x.b,w(us,ma),L[me+P]=x.a,L[ue+P]=x.b):(C(L[Rn+P],L[me+P]),mi=x.a,us=x.b,C(L[ee+P],L[ue+P]),En=x.a,ma=x.b,C(mi,En),L[Rn+P]=x.a,L[ee+P]=x.b,C(us,ma),L[me+P]=x.a,L[ue+P]=x.b)}if(W&We){const ee=Rn+Bt;qe?w(L[Rn+P],L[ee+P]):C(L[Rn+P],L[ee+P]),mi=x.a,L[ee+P]=x.b,L[Rn+P]=mi}}if(Se&We){let Rn=vt;const V=vt+te*(W-De);for(;Rn<=V;Rn+=kt){const ee=Rn+wt;qe?w(L[Rn+P],L[ee+P]):C(L[Rn+P],L[ee+P]),mi=x.a,L[ee+P]=x.b,L[Rn+P]=mi}}De=We,We>>=1}return vt}function _(L,P,W,te,Se,re,Ve,qe,Ke){let We=0,De=0;const vt=Ve,gt=Math.trunc(te.value+(Se+7)/8);for(;te.value<gt;)for(f(We,De,W,te),We=g.c,De=g.lc;De>=14;){const ei=We>>De-14&16383,wt=P[ei];if(wt.len)De-=wt.len,y(wt.lit,re,We,De,W,te,qe,Ke,vt),We=A.c,De=A.lc;else{if(!wt.p)throw new Error("hufDecode issues");let kt;for(kt=0;kt<wt.lit;kt++){const mi=d(L[wt.p[kt]]);for(;De<mi&&te.value<gt;)f(We,De,W,te),We=g.c,De=g.lc;if(De>=mi&&u(L[wt.p[kt]])==(We>>De-mi&(1<<mi)-1)){De-=mi,y(wt.p[kt],re,We,De,W,te,qe,Ke,vt),We=A.c,De=A.lc;break}}if(kt==wt.lit)throw new Error("hufDecode issues")}}const Bt=8-Se&7;for(We>>=Bt,De-=Bt;De>0;){const ei=P[We<<14-De&16383];if(ei.len)De-=ei.len,y(ei.lit,re,We,De,W,te,qe,Ke,vt),We=A.c,De=A.lc;else throw new Error("hufDecode issues")}return!0}function I(L,P,W,te,Se,re){const Ve={value:0},qe=W.value,Ke=Re(P,W),We=Re(P,W);W.value+=4;const De=Re(P,W);if(W.value+=4,Ke<0||Ke>=65537||We<0||We>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const vt=new Array(65537),gt=new Array(16384);r(gt);const Bt=te-(W.value-qe);if(h(L,W,Bt,Ke,We,vt),De>8*(te-(W.value-qe)))throw new Error("Something wrong with hufUncompress");p(vt,Ke,We,gt),_(vt,gt,L,W,De,We,re,Se,Ve)}function B(L,P,W){for(let te=0;te<W;++te)P[te]=L[P[te]]}function M(L){for(let P=1;P<L.length;P++){const W=L[P-1]+L[P]-128;L[P]=W}}function R(L,P){let W=0,te=Math.floor((L.length+1)/2),Se=0;const re=L.length-1;for(;!(Se>re||(P[Se++]=L[W++],Se>re));)P[Se++]=L[te++]}function k(L){let P=L.byteLength;const W=new Array;let te=0;const Se=new DataView(L);for(;P>0;){const re=Se.getInt8(te++);if(re<0){const Ve=-re;P-=Ve+1;for(let qe=0;qe<Ve;qe++)W.push(Se.getUint8(te++))}else{const Ve=re;P-=2;const qe=Se.getUint8(te++);for(let Ke=0;Ke<Ve+1;Ke++)W.push(qe)}}return W}function G(L,P,W,te,Se,re){let Ve=new DataView(re.buffer);const qe=W[L.idx[0]].width,Ke=W[L.idx[0]].height,We=3,De=Math.floor(qe/8),vt=Math.ceil(qe/8),gt=Math.ceil(Ke/8),Bt=qe-(vt-1)*8,ei=Ke-(gt-1)*8,wt={value:0},kt=new Array(We),mi=new Array(We),En=new Array(We),us=new Array(We),ma=new Array(We);for(let V=0;V<We;++V)ma[V]=P[L.idx[V]],kt[V]=V<1?0:kt[V-1]+vt*gt,mi[V]=new Float32Array(64),En[V]=new Uint16Array(64),us[V]=new Uint16Array(vt*64);for(let V=0;V<gt;++V){let ee=8;V==gt-1&&(ee=ei);let me=8;for(let J=0;J<vt;++J){J==vt-1&&(me=Bt);for(let Xe=0;Xe<We;++Xe)En[Xe].fill(0),En[Xe][0]=Se[kt[Xe]++],X(wt,te,En[Xe]),F(En[Xe],mi[Xe]),z(mi[Xe]);H(mi);for(let Xe=0;Xe<We;++Xe)Z(mi[Xe],us[Xe],J*64)}let ue=0;for(let J=0;J<We;++J){const Xe=W[L.idx[J]].type;for(let At=8*V;At<8*V+ee;++At){ue=ma[J][At];for(let It=0;It<De;++It){const Tt=It*64+(At&7)*8;Ve.setUint16(ue+0*2*Xe,us[J][Tt+0],!0),Ve.setUint16(ue+1*2*Xe,us[J][Tt+1],!0),Ve.setUint16(ue+2*2*Xe,us[J][Tt+2],!0),Ve.setUint16(ue+3*2*Xe,us[J][Tt+3],!0),Ve.setUint16(ue+4*2*Xe,us[J][Tt+4],!0),Ve.setUint16(ue+5*2*Xe,us[J][Tt+5],!0),Ve.setUint16(ue+6*2*Xe,us[J][Tt+6],!0),Ve.setUint16(ue+7*2*Xe,us[J][Tt+7],!0),ue+=8*2*Xe}}if(De!=vt)for(let At=8*V;At<8*V+ee;++At){const It=ma[J][At]+8*De*2*Xe,Tt=De*64+(At&7)*8;for(let ni=0;ni<me;++ni)Ve.setUint16(It+ni*2*Xe,us[J][Tt+ni],!0)}}}const Rn=new Uint16Array(qe);Ve=new DataView(re.buffer);for(let V=0;V<We;++V){W[L.idx[V]].decoded=!0;const ee=W[L.idx[V]].type;if(W[V].type==2)for(let me=0;me<Ke;++me){const ue=ma[V][me];for(let J=0;J<qe;++J)Rn[J]=Ve.getUint16(ue+J*2*ee,!0);for(let J=0;J<qe;++J)Ve.setFloat32(ue+J*2*ee,ye(Rn[J]),!0)}}}function X(L,P,W){let te,Se=1;for(;Se<64;)te=P[L.value],te==65280?Se=64:te>>8==255?Se+=te&255:(W[Se]=te,Se++),L.value++}function F(L,P){P[0]=ye(L[0]),P[1]=ye(L[1]),P[2]=ye(L[5]),P[3]=ye(L[6]),P[4]=ye(L[14]),P[5]=ye(L[15]),P[6]=ye(L[27]),P[7]=ye(L[28]),P[8]=ye(L[2]),P[9]=ye(L[4]),P[10]=ye(L[7]),P[11]=ye(L[13]),P[12]=ye(L[16]),P[13]=ye(L[26]),P[14]=ye(L[29]),P[15]=ye(L[42]),P[16]=ye(L[3]),P[17]=ye(L[8]),P[18]=ye(L[12]),P[19]=ye(L[17]),P[20]=ye(L[25]),P[21]=ye(L[30]),P[22]=ye(L[41]),P[23]=ye(L[43]),P[24]=ye(L[9]),P[25]=ye(L[11]),P[26]=ye(L[18]),P[27]=ye(L[24]),P[28]=ye(L[31]),P[29]=ye(L[40]),P[30]=ye(L[44]),P[31]=ye(L[53]),P[32]=ye(L[10]),P[33]=ye(L[19]),P[34]=ye(L[23]),P[35]=ye(L[32]),P[36]=ye(L[39]),P[37]=ye(L[45]),P[38]=ye(L[52]),P[39]=ye(L[54]),P[40]=ye(L[20]),P[41]=ye(L[22]),P[42]=ye(L[33]),P[43]=ye(L[38]),P[44]=ye(L[46]),P[45]=ye(L[51]),P[46]=ye(L[55]),P[47]=ye(L[60]),P[48]=ye(L[21]),P[49]=ye(L[34]),P[50]=ye(L[37]),P[51]=ye(L[47]),P[52]=ye(L[50]),P[53]=ye(L[56]),P[54]=ye(L[59]),P[55]=ye(L[61]),P[56]=ye(L[35]),P[57]=ye(L[36]),P[58]=ye(L[48]),P[59]=ye(L[49]),P[60]=ye(L[57]),P[61]=ye(L[58]),P[62]=ye(L[62]),P[63]=ye(L[63])}function z(L){const P=.5*Math.cos(.7853975),W=.5*Math.cos(3.14159/16),te=.5*Math.cos(3.14159/8),Se=.5*Math.cos(3*3.14159/16),re=.5*Math.cos(5*3.14159/16),Ve=.5*Math.cos(3*3.14159/8),qe=.5*Math.cos(7*3.14159/16),Ke=new Array(4),We=new Array(4),De=new Array(4),vt=new Array(4);for(let gt=0;gt<8;++gt){const Bt=gt*8;Ke[0]=te*L[Bt+2],Ke[1]=Ve*L[Bt+2],Ke[2]=te*L[Bt+6],Ke[3]=Ve*L[Bt+6],We[0]=W*L[Bt+1]+Se*L[Bt+3]+re*L[Bt+5]+qe*L[Bt+7],We[1]=Se*L[Bt+1]-qe*L[Bt+3]-W*L[Bt+5]-re*L[Bt+7],We[2]=re*L[Bt+1]-W*L[Bt+3]+qe*L[Bt+5]+Se*L[Bt+7],We[3]=qe*L[Bt+1]-re*L[Bt+3]+Se*L[Bt+5]-W*L[Bt+7],De[0]=P*(L[Bt+0]+L[Bt+4]),De[3]=P*(L[Bt+0]-L[Bt+4]),De[1]=Ke[0]+Ke[3],De[2]=Ke[1]-Ke[2],vt[0]=De[0]+De[1],vt[1]=De[3]+De[2],vt[2]=De[3]-De[2],vt[3]=De[0]-De[1],L[Bt+0]=vt[0]+We[0],L[Bt+1]=vt[1]+We[1],L[Bt+2]=vt[2]+We[2],L[Bt+3]=vt[3]+We[3],L[Bt+4]=vt[3]-We[3],L[Bt+5]=vt[2]-We[2],L[Bt+6]=vt[1]-We[1],L[Bt+7]=vt[0]-We[0]}for(let gt=0;gt<8;++gt)Ke[0]=te*L[16+gt],Ke[1]=Ve*L[16+gt],Ke[2]=te*L[48+gt],Ke[3]=Ve*L[48+gt],We[0]=W*L[8+gt]+Se*L[24+gt]+re*L[40+gt]+qe*L[56+gt],We[1]=Se*L[8+gt]-qe*L[24+gt]-W*L[40+gt]-re*L[56+gt],We[2]=re*L[8+gt]-W*L[24+gt]+qe*L[40+gt]+Se*L[56+gt],We[3]=qe*L[8+gt]-re*L[24+gt]+Se*L[40+gt]-W*L[56+gt],De[0]=P*(L[gt]+L[32+gt]),De[3]=P*(L[gt]-L[32+gt]),De[1]=Ke[0]+Ke[3],De[2]=Ke[1]-Ke[2],vt[0]=De[0]+De[1],vt[1]=De[3]+De[2],vt[2]=De[3]-De[2],vt[3]=De[0]-De[1],L[0+gt]=vt[0]+We[0],L[8+gt]=vt[1]+We[1],L[16+gt]=vt[2]+We[2],L[24+gt]=vt[3]+We[3],L[32+gt]=vt[3]-We[3],L[40+gt]=vt[2]-We[2],L[48+gt]=vt[1]-We[1],L[56+gt]=vt[0]-We[0]}function H(L){for(let P=0;P<64;++P){const W=L[0][P],te=L[1][P],Se=L[2][P];L[0][P]=W+1.5747*Se,L[1][P]=W-.1873*te-.4682*Se,L[2][P]=W+1.8556*te}}function Z(L,P,W){for(let te=0;te<64;++te)P[W+te]=bf.toHalfFloat(he(L[te]))}function he(L){return L<=1?Math.sign(L)*Math.pow(Math.abs(L),2.2):Math.sign(L)*Math.pow(i,Math.abs(L)-1)}function be(L){return new DataView(L.array.buffer,L.offset.value,L.size)}function _e(L){const P=L.viewer.buffer.slice(L.offset.value,L.offset.value+L.size),W=new Uint8Array(k(P)),te=new Uint8Array(W.length);return M(W),R(W,te),new DataView(te.buffer)}function Ye(L){const P=L.array.slice(L.offset.value,L.offset.value+L.size),W=XC(P),te=new Uint8Array(W.length);return M(W),R(W,te),new DataView(te.buffer)}function je(L){const P=L.viewer,W={value:L.offset.value},te=new Uint16Array(L.columns*L.lines*(L.inputChannels.length*L.type)),Se=new Uint8Array(8192);let re=0;const Ve=new Array(L.inputChannels.length);for(let ei=0,wt=L.inputChannels.length;ei<wt;ei++)Ve[ei]={},Ve[ei].start=re,Ve[ei].end=Ve[ei].start,Ve[ei].nx=L.columns,Ve[ei].ny=L.lines,Ve[ei].size=L.type,re+=Ve[ei].nx*Ve[ei].ny*Ve[ei].size;const qe=zt(P,W),Ke=zt(P,W);if(Ke>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(qe<=Ke)for(let ei=0;ei<Ke-qe+1;ei++)Se[ei+qe]=U(P,W);const We=new Uint16Array(65536),De=s(Se,We),vt=Re(P,W);I(L.array,P,W,vt,te,re);for(let ei=0;ei<L.inputChannels.length;++ei){const wt=Ve[ei];for(let kt=0;kt<Ve[ei].size;++kt)S(te,wt.start+kt,wt.nx,wt.size,wt.ny,wt.nx*wt.size,De)}B(We,te,re);let gt=0;const Bt=new Uint8Array(te.buffer.byteLength);for(let ei=0;ei<L.lines;ei++)for(let wt=0;wt<L.inputChannels.length;wt++){const kt=Ve[wt],mi=kt.nx*kt.size,En=new Uint8Array(te.buffer,kt.end*2,mi*2);Bt.set(En,gt),gt+=mi*2,kt.end+=mi}return new DataView(Bt.buffer)}function le(L){const P=L.array.slice(L.offset.value,L.offset.value+L.size),W=XC(P),te=L.inputChannels.length*L.lines*L.columns*L.totalBytes,Se=new ArrayBuffer(te),re=new DataView(Se);let Ve=0,qe=0;const Ke=new Array(4);for(let We=0;We<L.lines;We++)for(let De=0;De<L.inputChannels.length;De++){let vt=0;switch(L.inputChannels[De].pixelType){case 1:Ke[0]=Ve,Ke[1]=Ke[0]+L.columns,Ve=Ke[1]+L.columns;for(let gt=0;gt<L.columns;++gt){const Bt=W[Ke[0]++]<<8|W[Ke[1]++];vt+=Bt,re.setUint16(qe,vt,!0),qe+=2}break;case 2:Ke[0]=Ve,Ke[1]=Ke[0]+L.columns,Ke[2]=Ke[1]+L.columns,Ve=Ke[2]+L.columns;for(let gt=0;gt<L.columns;++gt){const Bt=W[Ke[0]++]<<24|W[Ke[1]++]<<16|W[Ke[2]++]<<8;vt+=Bt,re.setUint32(qe,vt,!0),qe+=4}break}}return re}function ve(L){const P=L.viewer,W={value:L.offset.value},te=new Uint8Array(L.columns*L.lines*(L.inputChannels.length*L.type*2)),Se={version:ot(P,W),unknownUncompressedSize:ot(P,W),unknownCompressedSize:ot(P,W),acCompressedSize:ot(P,W),dcCompressedSize:ot(P,W),rleCompressedSize:ot(P,W),rleUncompressedSize:ot(P,W),rleRawSize:ot(P,W),totalAcUncompressedCount:ot(P,W),totalDcUncompressedCount:ot(P,W),acCompression:ot(P,W)};if(Se.version<2)throw new Error("EXRLoader.parse: "+we.compression+" version "+Se.version+" is unsupported");const re=new Array;let Ve=zt(P,W)-2;for(;Ve>0;){const wt=Pe(P.buffer,W),kt=U(P,W),mi=kt>>2&3,En=(kt>>4)-1,us=new Int8Array([En])[0],ma=U(P,W);re.push({name:wt,index:us,type:ma,compression:mi}),Ve-=wt.length+3}const qe=we.channels,Ke=new Array(L.inputChannels.length);for(let wt=0;wt<L.inputChannels.length;++wt){const kt=Ke[wt]={},mi=qe[wt];kt.name=mi.name,kt.compression=0,kt.decoded=!1,kt.type=mi.pixelType,kt.pLinear=mi.pLinear,kt.width=L.columns,kt.height=L.lines}const We={idx:new Array(3)};for(let wt=0;wt<L.inputChannels.length;++wt){const kt=Ke[wt];for(let mi=0;mi<re.length;++mi){const En=re[mi];kt.name==En.name&&(kt.compression=En.compression,En.index>=0&&(We.idx[En.index]=wt),kt.offset=wt)}}let De,vt,gt;if(Se.acCompressedSize>0)switch(Se.acCompression){case 0:De=new Uint16Array(Se.totalAcUncompressedCount),I(L.array,P,W,Se.acCompressedSize,De,Se.totalAcUncompressedCount);break;case 1:const wt=L.array.slice(W.value,W.value+Se.totalAcUncompressedCount),kt=XC(wt);De=new Uint16Array(kt.buffer),W.value+=Se.totalAcUncompressedCount;break}if(Se.dcCompressedSize>0){const wt={array:L.array,offset:W,size:Se.dcCompressedSize};vt=new Uint16Array(Ye(wt).buffer),W.value+=Se.dcCompressedSize}if(Se.rleRawSize>0){const wt=L.array.slice(W.value,W.value+Se.rleCompressedSize),kt=XC(wt);gt=k(kt.buffer),W.value+=Se.rleCompressedSize}let Bt=0;const ei=new Array(Ke.length);for(let wt=0;wt<ei.length;++wt)ei[wt]=new Array;for(let wt=0;wt<L.lines;++wt)for(let kt=0;kt<Ke.length;++kt)ei[kt].push(Bt),Bt+=Ke[kt].width*L.type*2;G(We,ei,Ke,De,vt,te);for(let wt=0;wt<Ke.length;++wt){const kt=Ke[wt];if(!kt.decoded)switch(kt.compression){case 2:let mi=0,En=0;for(let us=0;us<L.lines;++us){let ma=ei[wt][mi];for(let Rn=0;Rn<kt.width;++Rn){for(let V=0;V<2*kt.type;++V)te[ma++]=gt[En+V*kt.width*kt.height];En++}mi++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(te.buffer)}function Pe(L,P){const W=new Uint8Array(L);let te=0;for(;W[P.value+te]!=0;)te+=1;const Se=new TextDecoder().decode(W.slice(P.value,P.value+te));return P.value=P.value+te+1,Se}function ke(L,P,W){const te=new TextDecoder().decode(new Uint8Array(L).slice(P.value,P.value+W));return P.value=P.value+W,te}function _t(L,P){const W=xt(L,P),te=Re(L,P);return[W,te]}function rt(L,P){const W=Re(L,P),te=Re(L,P);return[W,te]}function xt(L,P){const W=L.getInt32(P.value,!0);return P.value=P.value+4,W}function Re(L,P){const W=L.getUint32(P.value,!0);return P.value=P.value+4,W}function ze(L,P){const W=L[P.value];return P.value=P.value+1,W}function U(L,P){const W=L.getUint8(P.value);return P.value=P.value+1,W}const ot=function(L,P){let W;return"getBigInt64"in DataView.prototype?W=Number(L.getBigInt64(P.value,!0)):W=L.getUint32(P.value+4,!0)+Number(L.getUint32(P.value,!0)<<32),P.value+=8,W};function Ne(L,P){const W=L.getFloat32(P.value,!0);return P.value+=4,W}function yt(L,P){return bf.toHalfFloat(Ne(L,P))}function ye(L){const P=(L&31744)>>10,W=L&1023;return(L>>15?-1:1)*(P?P===31?W?NaN:1/0:Math.pow(2,P-15)*(1+W/1024):6103515625e-14*(W/1024))}function zt(L,P){const W=L.getUint16(P.value,!0);return P.value+=2,W}function Ct(L,P){return ye(zt(L,P))}function O(L,P,W,te){const Se=W.value,re=[];for(;W.value<Se+te-1;){const Ve=Pe(P,W),qe=xt(L,W),Ke=U(L,W);W.value+=3;const We=xt(L,W),De=xt(L,W);re.push({name:Ve,pixelType:qe,pLinear:Ke,xSampling:We,ySampling:De})}return W.value+=1,re}function N(L,P){const W=Ne(L,P),te=Ne(L,P),Se=Ne(L,P),re=Ne(L,P),Ve=Ne(L,P),qe=Ne(L,P),Ke=Ne(L,P),We=Ne(L,P);return{redX:W,redY:te,greenX:Se,greenY:re,blueX:Ve,blueY:qe,whiteX:Ke,whiteY:We}}function ce(L,P){const W=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],te=U(L,P);return W[te]}function Ee(L,P){const W=xt(L,P),te=xt(L,P),Se=xt(L,P),re=xt(L,P);return{xMin:W,yMin:te,xMax:Se,yMax:re}}function He(L,P){const W=["INCREASING_Y","DECREASING_Y","RANDOM_Y"],te=U(L,P);return W[te]}function Le(L,P){const W=["ENVMAP_LATLONG","ENVMAP_CUBE"],te=U(L,P);return W[te]}function bt(L,P){const W=["ONE_LEVEL","MIPMAP_LEVELS","RIPMAP_LEVELS"],te=["ROUND_DOWN","ROUND_UP"],Se=Re(L,P),re=Re(L,P),Ve=U(L,P);return{xSize:Se,ySize:re,levelMode:W[Ve&15],roundingMode:te[Ve>>4]}}function nt(L,P){const W=Ne(L,P),te=Ne(L,P);return[W,te]}function mt(L,P){const W=Ne(L,P),te=Ne(L,P),Se=Ne(L,P);return[W,te,Se]}function ii(L,P,W,te,Se){if(te==="string"||te==="stringvector"||te==="iccProfile")return ke(P,W,Se);if(te==="chlist")return O(L,P,W,Se);if(te==="chromaticities")return N(L,W);if(te==="compression")return ce(L,W);if(te==="box2i")return Ee(L,W);if(te==="envmap")return Le(L,W);if(te==="tiledesc")return bt(L,W);if(te==="lineOrder")return He(L,W);if(te==="float")return Ne(L,W);if(te==="v2f")return nt(L,W);if(te==="v3f")return mt(L,W);if(te==="int")return xt(L,W);if(te==="rational")return _t(L,W);if(te==="timecode")return rt(L,W);if(te==="preview")return W.value+=Se,"skipped";W.value+=Se}function Ge(L,P){const W=Math.log2(L);return P=="ROUND_DOWN"?Math.floor(W):Math.ceil(W)}function Mt(L,P,W){let te=0;switch(L.levelMode){case"ONE_LEVEL":te=1;break;case"MIPMAP_LEVELS":te=Ge(Math.max(P,W),L.roundingMode)+1;break;case"RIPMAP_LEVELS":throw new Error("THREE.EXRLoader: RIPMAP_LEVELS tiles currently unsupported.")}return te}function Yt(L,P,W,te){const Se=new Array(L);for(let re=0;re<L;re++){const Ve=1<<re;let qe=P/Ve|0;te=="ROUND_UP"&&qe*Ve<P&&(qe+=1);const Ke=Math.max(qe,1);Se[re]=(Ke+W-1)/W|0}return Se}function qt(){const L=this,P=L.offset,W={value:0};for(let te=0;te<L.tileCount;te++){const Se=xt(L.viewer,P),re=xt(L.viewer,P);P.value+=8,L.size=Re(L.viewer,P);const Ve=Se*L.blockWidth,qe=re*L.blockHeight;L.columns=Ve+L.blockWidth>L.width?L.width-Ve:L.blockWidth,L.lines=qe+L.blockHeight>L.height?L.height-qe:L.blockHeight;const Ke=L.columns*L.totalBytes,We=L.size<L.lines*Ke?L.uncompress(L):be(L);P.value+=L.size;for(let De=0;De<L.lines;De++){const vt=De*L.columns*L.totalBytes;for(let gt=0;gt<L.inputChannels.length;gt++){const Bt=we.channels[gt].name,ei=L.channelByteOffsets[Bt]*L.columns,wt=L.decodeChannels[Bt];if(wt===void 0)continue;W.value=vt+ei;const kt=(L.height-(1+qe+De))*L.outLineWidth;for(let mi=0;mi<L.columns;mi++){const En=kt+(mi+Ve)*L.outputChannels+wt;L.byteArray[En]=L.getter(We,W)}}}}}function et(){const L=this,P=L.offset,W={value:0};for(let te=0;te<L.height/L.blockHeight;te++){const Se=xt(L.viewer,P)-we.dataWindow.yMin;L.size=Re(L.viewer,P),L.lines=Se+L.blockHeight>L.height?L.height-Se:L.blockHeight;const re=L.columns*L.totalBytes,Ve=L.size<L.lines*re?L.uncompress(L):be(L);P.value+=L.size;for(let qe=0;qe<L.blockHeight;qe++){const Ke=te*L.blockHeight,We=qe+L.scanOrder(Ke);if(We>=L.height)continue;const De=qe*re,vt=(L.height-1-We)*L.outLineWidth;for(let gt=0;gt<L.inputChannels.length;gt++){const Bt=we.channels[gt].name,ei=L.channelByteOffsets[Bt]*L.columns,wt=L.decodeChannels[Bt];if(wt!==void 0){W.value=De+ei;for(let kt=0;kt<L.columns;kt++){const mi=vt+kt*L.outputChannels+wt;L.byteArray[mi]=L.getter(Ve,W)}}}}}}function Vi(L,P,W){const te={};if(L.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");te.version=L.getUint8(4);const Se=L.getUint8(5);te.spec={singleTile:!!(Se&2),longName:!!(Se&4),deepFormat:!!(Se&8),multiPart:!!(Se&16)},W.value=8;let re=!0;for(;re;){const Ve=Pe(P,W);if(Ve==0)re=!1;else{const qe=Pe(P,W),Ke=Re(L,W),We=ii(L,P,W,qe,Ke);We===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${qe}'.`):te[Ve]=We}}if(Se&-7)throw console.error("THREE.EXRHeader:",te),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return te}function vi(L,P,W,te,Se){const re={size:0,viewer:P,array:W,offset:te,width:L.dataWindow.xMax-L.dataWindow.xMin+1,height:L.dataWindow.yMax-L.dataWindow.yMin+1,inputChannels:L.channels,channelByteOffsets:{},scanOrder:null,totalBytes:null,columns:null,lines:null,type:null,uncompress:null,getter:null,format:null,colorSpace:qi};switch(L.compression){case"NO_COMPRESSION":re.blockHeight=1,re.uncompress=be;break;case"RLE_COMPRESSION":re.blockHeight=1,re.uncompress=_e;break;case"ZIPS_COMPRESSION":re.blockHeight=1,re.uncompress=Ye;break;case"ZIP_COMPRESSION":re.blockHeight=16,re.uncompress=Ye;break;case"PIZ_COMPRESSION":re.blockHeight=32,re.uncompress=je;break;case"PXR24_COMPRESSION":re.blockHeight=16,re.uncompress=le;break;case"DWAA_COMPRESSION":re.blockHeight=32,re.uncompress=ve;break;case"DWAB_COMPRESSION":re.blockHeight=256,re.uncompress=ve;break;default:throw new Error("EXRLoader.parse: "+L.compression+" is unsupported")}const Ve={};for(const De of L.channels)switch(De.name){case"Y":case"R":case"G":case"B":case"A":Ve[De.name]=!0,re.type=De.pixelType}let qe=!1;if(Ve.R&&Ve.G&&Ve.B)qe=!Ve.A,re.outputChannels=4,re.decodeChannels={R:0,G:1,B:2,A:3};else if(Ve.Y)re.outputChannels=1,re.decodeChannels={Y:0};else throw new Error("EXRLoader.parse: file contains unsupported data channels.");if(re.type==1)switch(Se){case en:re.getter=Ct;break;case Ki:re.getter=zt;break}else if(re.type==2)switch(Se){case en:re.getter=Ne;break;case Ki:re.getter=yt}else throw new Error("EXRLoader.parse: unsupported pixelType "+re.type+" for "+L.compression+".");re.columns=re.width;const Ke=re.width*re.height*re.outputChannels;switch(Se){case en:re.byteArray=new Float32Array(Ke),qe&&re.byteArray.fill(1,0,Ke);break;case Ki:re.byteArray=new Uint16Array(Ke),qe&&re.byteArray.fill(15360,0,Ke);break;default:console.error("THREE.EXRLoader: unsupported type: ",Se);break}let We=0;for(const De of L.channels)re.decodeChannels[De.name]!==void 0&&(re.channelByteOffsets[De.name]=We),We+=De.pixelType*2;if(re.totalBytes=We,re.outLineWidth=re.width*re.outputChannels,L.lineOrder==="INCREASING_Y"?re.scanOrder=De=>De:re.scanOrder=De=>re.height-1-De,re.outputChannels==4?(re.format=_i,re.colorSpace=qi):(re.format=vl,re.colorSpace=ho),L.spec.singleTile){re.blockHeight=L.tiles.ySize,re.blockWidth=L.tiles.xSize;const De=Mt(L.tiles,re.width,re.height),vt=Yt(De,re.width,L.tiles.xSize,L.tiles.roundingMode),gt=Yt(De,re.height,L.tiles.ySize,L.tiles.roundingMode);re.tileCount=vt[0]*gt[0];for(let Bt=0;Bt<De;Bt++)for(let ei=0;ei<gt[Bt];ei++)for(let wt=0;wt<vt[Bt];wt++)ot(P,te);re.decode=qt.bind(re)}else{re.blockWidth=re.width;const De=Math.ceil(re.height/re.blockHeight);for(let vt=0;vt<De;vt++)ot(P,te);re.decode=et.bind(re)}return re}const gn={value:0},se=new DataView(e),St=new Uint8Array(e),we=Vi(se,e,gn),Ze=vi(we,se,St,gn,this.type);return Ze.decode(),{header:we,width:Ze.width,height:Ze.height,data:Ze.byteArray,format:Ze.format,colorSpace:Ze.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,i,s,r){function o(a,l){a.colorSpace=l.colorSpace,a.minFilter=Wt,a.magFilter=Wt,a.generateMipmaps=!1,a.flipY=!1,i&&i(a,l)}return super.load(e,o,s,r)}}const eGe=Object.freeze(Object.defineProperty({__proto__:null,EXRLoader:DC},Symbol.toStringTag,{value:"Module"}));class U2 extends FP{constructor(e){super(e),this.type=Ki}parse(e){const i=function(b,v){switch(b){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(v||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(v||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(v||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(v||""))}},s=`
`,r=function(b,v,x){v=v||1024;let w=b.pos,C=-1,S=0,_="",I=String.fromCharCode.apply(null,new Uint16Array(b.subarray(w,w+128)));for(;0>(C=I.indexOf(s))&&S<v&&w<b.byteLength;)_+=I,S+=I.length,w+=128,I+=String.fromCharCode.apply(null,new Uint16Array(b.subarray(w,w+128)));return-1<C?(x!==!1&&(b.pos+=S+C+1),_+I.slice(0,C)):!1},o=function(b){const v=/^#\?(\S+)/,x=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,w=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,C=/^\s*FORMAT=(\S+)\s*$/,S=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,_={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let I,B;for((b.pos>=b.byteLength||!(I=r(b)))&&i(1,"no header found"),(B=I.match(v))||i(3,"bad initial token"),_.valid|=1,_.programtype=B[1],_.string+=I+`
`;I=r(b),I!==!1;){if(_.string+=I+`
`,I.charAt(0)==="#"){_.comments+=I+`
`;continue}if((B=I.match(x))&&(_.gamma=parseFloat(B[1])),(B=I.match(w))&&(_.exposure=parseFloat(B[1])),(B=I.match(C))&&(_.valid|=2,_.format=B[1]),(B=I.match(S))&&(_.valid|=4,_.height=parseInt(B[1],10),_.width=parseInt(B[2],10)),_.valid&2&&_.valid&4)break}return _.valid&2||i(3,"missing format specifier"),_.valid&4||i(3,"missing image size specifier"),_},a=function(b,v,x){const w=v;if(w<8||w>32767||b[0]!==2||b[1]!==2||b[2]&128)return new Uint8Array(b);w!==(b[2]<<8|b[3])&&i(3,"wrong scanline width");const C=new Uint8Array(4*v*x);C.length||i(4,"unable to allocate buffer space");let S=0,_=0;const I=4*w,B=new Uint8Array(4),M=new Uint8Array(I);let R=x;for(;R>0&&_<b.byteLength;){_+4>b.byteLength&&i(1),B[0]=b[_++],B[1]=b[_++],B[2]=b[_++],B[3]=b[_++],(B[0]!=2||B[1]!=2||(B[2]<<8|B[3])!=w)&&i(3,"bad rgbe scanline format");let k=0,G;for(;k<I&&_<b.byteLength;){G=b[_++];const F=G>128;if(F&&(G-=128),(G===0||k+G>I)&&i(3,"bad scanline data"),F){const z=b[_++];for(let H=0;H<G;H++)M[k++]=z}else M.set(b.subarray(_,_+G),k),k+=G,_+=G}const X=w;for(let F=0;F<X;F++){let z=0;C[S]=M[F+z],z+=w,C[S+1]=M[F+z],z+=w,C[S+2]=M[F+z],z+=w,C[S+3]=M[F+z],S+=4}R--}return C},l=function(b,v,x,w){const C=b[v+3],S=Math.pow(2,C-128)/255;x[w+0]=b[v+0]*S,x[w+1]=b[v+1]*S,x[w+2]=b[v+2]*S,x[w+3]=1},c=function(b,v,x,w){const C=b[v+3],S=Math.pow(2,C-128)/255;x[w+0]=bf.toHalfFloat(Math.min(b[v+0]*S,65504)),x[w+1]=bf.toHalfFloat(Math.min(b[v+1]*S,65504)),x[w+2]=bf.toHalfFloat(Math.min(b[v+2]*S,65504)),x[w+3]=bf.toHalfFloat(1)},h=new Uint8Array(e);h.pos=0;const d=o(h),u=d.width,p=d.height,g=a(h.subarray(h.pos),u,p);let f,A,y;switch(this.type){case en:y=g.length/4;const b=new Float32Array(y*4);for(let x=0;x<y;x++)l(g,x*4,b,x*4);f=b,A=en;break;case Ki:y=g.length/4;const v=new Uint16Array(y*4);for(let x=0;x<y;x++)c(g,x*4,v,x*4);f=v,A=Ki;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:u,height:p,data:f,header:d.string,gamma:d.gamma,exposure:d.exposure,type:A}}setDataType(e){return this.type=e,this}load(e,i,s,r){function o(a,l){switch(a.type){case en:case Ki:a.colorSpace=qi,a.minFilter=Wt,a.magFilter=Wt,a.generateMipmaps=!1,a.flipY=!0;break}i&&i(a,l)}return super.load(e,o,s,r)}}const tGe=Object.freeze(Object.defineProperty({__proto__:null,RGBELoader:U2},Symbol.toStringTag,{value:"Module"})),Vie="NEEDLE_lightmaps",zC=q("debuglightmapsextension")||q("debuglightmaps");var tg=(n=>(n[n.Lightmap=0]="Lightmap",n[n.Skybox=1]="Skybox",n[n.Reflection=2]="Reflection",n))(tg||{});class iGe{constructor(e,i,s){m(this,"parser"),m(this,"registry"),m(this,"source"),this.parser=e,this.registry=i,this.source=s}get name(){return Vie}afterRoot(e){const i=this.parser.json.extensions;if(i){const s=i[Vie];if(s){const r=s.textures;return r!=null&&r.length?(zC&&console.log(s),new Promise(async(o,a)=>{const l=[];for(const h of r)if(h.pointer){zC&&console.log(h);let d=null;if(h.pointer.startsWith("/textures/"))zC&&console.log("Load texture from gltf",h.pointer),d=Yz(this.parser,h.pointer).then(u=>this.resolveTexture(h,u));else if(typeof h.pointer=="string"){zC&&console.log("Load texture from path",h.pointer);const u=Sm(this.source,h.pointer);let p;u.endsWith(".exr")?p=new DC(this.parser.options.manager):u.endsWith(".hdr")?p=new U2(this.parser.options.manager):p=new hh(this.parser.options.manager),d=p.loadAsync(u,void 0).then(g=>this.resolveTexture(h,g))}else h.pointer;d&&l.push(d)}const c=await kE(l);c!=null&&c.anyFailed&&Je()&&console.error("Failed to load lightmap extension",c),o()})):null}}return null}resolveTexture(e,i){const s=i;zC&&console.log("Lightmap loaded:",s),s!=null&&s.isTexture&&(this.registry?(s.colorSpace=qi,this.registry.registerTexture(this.source,e.type,s,e.index)):console.log(tg[e.type],e.pointer,s))}}const Xie=!!q("debuglightmaps");class nGe{constructor(e){m(this,"_context"),m(this,"_lightmaps",new Map),this._context=e}clear(){this._lightmaps.clear()}registerTexture(e,i,s,r){Xie&&console.log("Registering ",tg[i]+' "'+e+'"',s),this._lightmaps.has(e)||this._lightmaps.set(e,new Map);const o=this._lightmaps.get(e),a=o?.get(i)??[];a.length<r&&(a.length=r+1),a[r]=s,o?.set(i,a)}tryGetLightmap(e,i=0){return this.tryGet(e,tg.Lightmap,i)}tryGetSkybox(e){return this.tryGet(e,tg.Skybox,0)}tryGetReflection(e){return this.tryGet(e,tg.Reflection,0)}tryGet(e,i,s){if(!e)return Xie&&console.warn("Missing source id"),null;const r=this._lightmaps.get(e);if(!r)return null;const o=r.get(i);return o===void 0||!(o!=null&&o.length)||o.length<=s?null:o[s]}}Zt.lights_fragment_maps=Zt.lights_fragment_maps.replace("vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );",`
    vec2 lUv = vLightMapUv.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
    vec4 lightMapTexel = texture2D( lightMap, lUv);
    // The range of RGBM lightmaps goes from 0 to 34.49 (5^2.2) in linear space, and from 0 to 5 in gamma space.
    lightMapTexel.rgb *= lightMapTexel.a * 8.; // no idea where that "8" comes from... heuristically derived
    lightMapTexel.a = 1.;
    lightMapTexel = conv_sRGBToLinear(lightMapTexel);
    `),Zt.lightmap_pars_fragment=`
    #ifdef USE_LIGHTMAP
        uniform sampler2D lightMap;
        uniform float lightMapIntensity;
        uniform vec4 lightmapScaleOffset;
        
        // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
        vec4 conv_sRGBToLinear( in vec4 value ) {
            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
        }
    #endif
    `,Zt.lights_fragment_begin=Zt.lights_fragment_begin.replace("irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );",`
#if defined(USE_LIGHTMAP)
irradiance += 0.;
#else
irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
#endif`),ht.lightmap.lightmapScaleOffset={value:new $e(1,1,0,0)};const xF=q("debugprogressive"),O2=new gi,Z2=new Vn;class sGe{constructor(e){m(this,"context"),m(this,"_lodsManager"),this.context=e}get manager(){return this._lodsManager}get targetTriangleDensity(){var e;return((e=this._lodsManager)==null?void 0:e.targetTriangleDensity)??-1}set targetTriangleDensity(e){this._lodsManager&&(this._lodsManager.targetTriangleDensity=e)}setRenderer(e){var i;(i=this._lodsManager)==null||i.disable(),Xl.removePlugin(this),Xl.addPlugin(this),Xl.debugDrawLine=Nt.DrawLine,this._lodsManager=Xl.get(e),this._lodsManager.enable()}disable(){var e;(e=this._lodsManager)==null||e.disable(),Xl.removePlugin(this)}onAfterUpdatedLOD(e,i,s,r,o){xF&&this.onRenderDebug(s,r,o)}onRenderDebug(e,i,s){var r,o,a;if(!i.geometry||!Fi.hasLODLevelAvailable(i.geometry)&&!Fi.hasLODLevelAvailable(i.material))return;const l=Xl.getObjectLODState(i);if(!l)return;let c=s.mesh_lod;const h=s.mesh_lod!=l.lastLodLevel_Mesh||s.texture_lod!=l.lastLodLevel_Texture;if(xF&&i.geometry.boundingSphere){const d=i.geometry.boundingSphere;Z2.copy(d),Z2.applyMatrix4(i.matrixWorld);const u=Z2.center,p=Z2.radius,g=["#76c43e","#bcc43e","#c4ac3e","#c4673e","#ff3e3e"];if(h)Nt.DrawWireSphere(u,p,g[c],.1);else{const f=((r=i.geometry.index)==null?void 0:r.count)??0,A=(o=Fi.getMeshLODInformation(i.geometry))==null?void 0:o.lods;c=A?Math.min(A?.length-1,c):0;let y="";if(A&&l.lastScreenCoverage>0)for(let x=0;x<A.length;x++){const w=A[x].density,C=x==A.length-1;y+=w.toFixed(0)+">"+(w/l.lastScreenCoverage).toFixed(0)+(C?"":",")}const b=A?(a=A[c])==null?void 0:a.density:-1;let v="LOD "+s.mesh_lod+`
TEX `+s.texture_lod;if(xF=="density"&&(v+=`
`+f+` tris
`+(b/l.lastScreenCoverage).toFixed(0)+` dens
`+(l.lastScreenCoverage*100).toFixed(1)+`% cov
`+(l.lastCentrality*100).toFixed(1)+`% centr
`+(O2.min.x.toFixed(2)+"-"+O2.max.x.toFixed(2)+"x"+O2.min.y.toFixed(2)+"-"+O2.max.y.toFixed(2))+" scr"),l.lastScreenCoverage>.1){const x=e,w=x.worldForward,C=x.worldPosition,S=Lt(w).multiplyScalar(p*.7).add(u),_=S.distanceTo(C),I=g[Math.min(g.length-1,Math.max(0,c))]+"88",B=this.context.domHeight>0?screen.height/this.context.domHeight:1,M=e.isPerspectiveCamera?Math.tan(e.fov*Math.PI/180/2):1;Nt.DrawLabel(S,v,_*.012*B*M,void 0,16777215,I)}}}}}const rGe=q("debugplayerview");var ig=(n=>(n.Browser="browser",n.Headset="headset",n.Handheld="handheld",n))(ig||{});class Die{constructor(e,i){m(this,"userId"),m(this,"context"),m(this,"viewDevice","browser"),m(this,"removed",!1),m(this,"_object"),this.userId=e,this.context=i}get currentObject(){return this._object}set currentObject(e){this._object=e}get isConnected(){return this.context.connection.userIsInRoom(this.userId)}}class zie{constructor(e){m(this,"context"),m(this,"playerViews",new Map),this.context=e}setPlayerView(e,i,s){let r=this.playerViews.get(e);r||(r=new Die(e,this.context),this.playerViews.set(e,r)),r.viewDevice=s,r.currentObject=i,r.removed=!1}getPlayerView(e){if(!!e){if(!this.context.connection.userIsInRoom(e)){this.playerViews.delete(e);return}return this.playerViews.get(e)}}removePlayerView(e,i){const s=this.playerViews.get(e);s?.viewDevice===i&&(rGe&&console.log("REMOVE",e),s.removed=!0,this.playerViews.delete(e))}}new Rs;const FC=new Uint8Array(4);FC[0]=255,FC[1]=255,FC[2]=255,FC[3]=255;const oGe=new nr(FC,1,1,_i);function wF(n,e=1){const i="alpha"in n,s=e*e,r=new Uint8Array(4*s),o=Math.floor(n.r*255),a=Math.floor(n.g*255),l=Math.floor(n.b*255);for(let h=0;h<s;h++){const d=h*4;r[d+0]=o,r[d+1]=a,r[d+2]=l,i?r[d+3]=Math.floor(n.alpha*255):r[d+3]=255}const c=new nr(r,e,e);return c.needsUpdate=!0,c}function aGe(n,e,i,s=1,r=3){const o=s*r,a=[n,e,i],l=a.length,c=new Uint8Array(4*l*o),h=new fe;for(let u=0;u<r;u++){const p=Math.floor(u/r*l),g=lt.clamp(p+1,0,l-1),f=a[p],A=a[g],y=u/r*l%1;h.lerpColors(f,A,y);const b=Math.floor(h.r*255),v=Math.floor(h.g*255),x=Math.floor(h.b*255);for(let w=0;w<s;w++){const C=(u*s+w)*4;c[C+0]=b,c[C+1]=v,c[C+2]=x,c[C+3]=255}}const d=new nr(c,s,r);return d.needsUpdate=!0,d}function W2(n,e){const i=n.elements;e||(e=[]),e.length=0;for(let s=0;s<16;s+=4){const r=i[s],o=i[s+1],a=i[s+2],l=i[s+3],c=new $e(r,o,a,l);e.push(c)}return e}const CF=[],Fie=[];function lGe(n,e){if(CF.length===0)for(let i=0;i<27;i++)CF.push(0);e||(e=CF);for(let i=0;i<27;i++)Fie[i]=e[i];e=Fie,n.unity_SHAr={value:new $e(e[9],e[3],e[6],e[0])},n.unity_SHBr={value:new $e(e[12],e[15],e[18],e[21])},n.unity_SHAg={value:new $e(e[10],e[4],e[7],e[1])},n.unity_SHBg={value:new $e(e[13],e[16],e[19],e[22])},n.unity_SHAb={value:new $e(e[11],e[5],e[8],e[2])},n.unity_SHBb={value:new $e(e[14],e[17],e[20],e[23])},n.unity_SHC={value:new $e(e[24],e[25],e[26],1)}}class cGe{constructor(e,i,s){m(this,"vertexShader"),m(this,"fragmentShader"),m(this,"technique"),this.vertexShader=e,this.fragmentShader=i,this.technique=s}}async function hGe(n,e){if(!n)return console.error("Can not find technique: no shader data"),null;const i=n.programs[e],s=i.vertexShader,r=i.fragmentShader;if(s!==void 0&&r!==void 0){const o=n.shaders[s],a=n.shaders[r];if(o.uri&&a.uri||o.code&&a.code){if(!o.code&&o.uri&&await Uie(o),!a.code&&a.uri&&await Uie(a),!o.code||!a.code)return null;const l=n.techniques[e];return new cGe(o.code,a.code,l)}}return console.error("Shader technique not found",e),null}async function Uie(n){const e=n.uri;if(e)if(e.endsWith(".glsl")){const i=await new Rs().loadAsync(e);n.code=i.toString()}else n.code=dGe(n.uri)}function dGe(n){return decodeURIComponent(Array.prototype.map.call(atob(n),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}const Nh=q("debugenvlight");var $b=(n=>(n[n.Skybox=0]="Skybox",n[n.Trilight=1]="Trilight",n[n.Flat=3]="Flat",n[n.Custom=4]="Custom",n))($b||{}),H2=(n=>(n[n.Skybox=0]="Skybox",n[n.Custom=1]="Custom",n))(H2||{});class Oie{constructor(e){m(this,"context"),m(this,"_currentLightSettingsId"),m(this,"_sceneLightSettings"),m(this,"_timevec4",new $e),m(this,"__currentReflectionId",null),m(this,"_lighting",{}),this.context=e,this.context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){const e=this.context.time;this._timevec4.x=e.time,this._timevec4.y=Math.sin(e.time),this._timevec4.z=Math.cos(e.time),this._timevec4.w=e.deltaTime}get timeVec4(){return this._timevec4}get environmentIntensity(){if(!this._sceneLightSettings||!this._currentLightSettingsId)return 1;const e=this._sceneLightSettings.get(this._currentLightSettingsId);return e?e.ambientIntensity:1}get sceneLightSettings(){var e;return(e=this._sceneLightSettings)==null?void 0:e.values()}enable(e){var i;e instanceof Mi&&(e=e.url);const s=(i=this._sceneLightSettings)==null?void 0:i.get(e);return s?(Nh&&console.log("Enable scene light settings",e,s),e!==this._currentLightSettingsId&&this._currentLightSettingsId&&this.disable(this._currentLightSettingsId),this._currentLightSettingsId=e,s.enabled=!0,!0):(Nh&&console.warn("No light settings found for",e),!1)}disable(e){var i;if(e instanceof Mi&&(e=e.url),e==null)return!1;const s=(i=this._sceneLightSettings)==null?void 0:i.get(e);return s?(Nh&&console.log("Disable scene light settings",e,s),s.enabled=!1,!0):!1}disableCurrent(){if(this._currentLightSettingsId){const e=this._currentLightSettingsId;return this.disable(this._currentLightSettingsId),e}return null}internalRegisterSceneLightSettings(e){const i=e.sourceId;if(!i){console.error("Missing source id for scene light settings, can not register:",e);return}Nh&&console.log("Register "+e?.sourceId+" lighting",e),this._sceneLightSettings||(this._sceneLightSettings=new Map),this._sceneLightSettings.set(i,e)}internalUnregisterSceneLightSettings(e){const i=e.sourceId;if(!i){console.error("Missing source id for scene light settings, can not unregister:",e);return}Nh&&console.log("Unregister "+e?.sourceId+" lighting",e),this._sceneLightSettings&&this._sceneLightSettings.delete(i)}internalRegisterReflection(e,i){Nh&&console.log("Register reflection",e,i);const s=new Zie(this.context,i,1);this._lighting[e]=s}internalGetReflection(e){return this._lighting[e]}internalEnableReflection(e){var i;this.__currentReflectionId=e;const s=(i=this._sceneLightSettings)==null?void 0:i.get(e);switch(Nh&&console.log("Enable reflection",e,s?$b[s.ambientMode]:"Unknown ambient mode",s),s?.ambientMode){case 0:case 4:const r=this.internalGetReflection(e);if(r&&r.Source){Nh&&console.log("Setting environment reflection",r);const o=this.context.scene,a=r.Source;a.mapping=ao,o.environment=a;return}else Nh&&console.warn("Could not find reflection for source",e);break}if(s?.environmentReflectionSource===1)switch(s?.ambientMode){case 1:if(s.ambientTrilight){const r=s.ambientTrilight,o=aGe(r[0],r[1],r[2],64,64);o.colorSpace=ut,o.mapping=ao,this.context.scene.environment=o}else console.error("Missing ambient trilight",s.sourceId);return;case 3:if(s.ambientLight){const r=wF(s.ambientLight,64);r.colorSpace=ut,r.mapping=ao,this.context.scene.environment=r}else console.error("Missing ambientlight",s.sourceId);return;default:return}}internalDisableReflection(e){if(e&&e!==this.__currentReflectionId){Nh&&console.log("Not disabling reflection for",e,"because it is not the current light settings id",this.__currentReflectionId);return}Nh&&console.log("Disable reflection",e);const i=this.context.scene;i.environment=null}}class Zie{constructor(e,i,s=1){m(this,"_source"),this._source=i,i.mapping=ao}get Source(){return this._source}}const Wie=q("timescale");let SF=1;typeof Wie=="number"&&(SF=Wie);class Hie{constructor(){m(this,"_time",0),m(this,"_deltaTime",0),m(this,"_deltaTimeUnscaled",0),m(this,"timeScale",1),m(this,"_frame",0),m(this,"clock",new KP),m(this,"_smoothedFps",0),m(this,"_smoothedDeltaTime",0),m(this,"_fpsSamples",[]),m(this,"_fpsSampleIndex",0),typeof SF=="number"&&(this.timeScale=SF)}get time(){return this._time}set time(e){this._time=e}get deltaTime(){return this._deltaTime}set deltaTime(e){this._deltaTime=e}get deltaTimeUnscaled(){return this._deltaTimeUnscaled}get frame(){return this._frame}set frame(e){this._frame=e}get frameCount(){return this.frame}get realtimeSinceStartup(){return this.clock.elapsedTime}get smoothedFps(){return this._smoothedFps}get smoothedDeltaTime(){return 1/this._smoothedFps}update(){this.deltaTime=this.clock.getDelta(),this.deltaTime=Math.min(.1,this.deltaTime),this._deltaTimeUnscaled=this.deltaTime,this.deltaTime<=0&&(this.deltaTime=1e-12),this.deltaTime*=this.timeScale,this.frame+=1,this.time+=this.deltaTime,this._fpsSamples.length<60?this._fpsSamples.push(this.deltaTime):this._fpsSamples[this._fpsSampleIndex++%60]=this.deltaTime;let e=0;for(let i=0;i<this._fpsSamples.length;i++)e+=this._fpsSamples[i];this._smoothedDeltaTime=e/this._fpsSamples.length,this._smoothedFps=1/this._smoothedDeltaTime}}let Qie=!1;function Kie(n){Qie||(Qie=!0,uGe(),pGe())}Kie();function uGe(){const n=`
float startCompression = 0.8;
float desaturation = 0.5;
// Patched tonemapping function
vec3 NeutralToneMapping( vec3 color ) {
    color *= toneMappingExposure;
    
    float d = 1. - startCompression;
    // float peak = dot(color, vec3(0.299, 0.587, 0.114));
    float peak = max(color.r, max(color.g, color.b));
    if (peak < startCompression) return color;
    float newPeak = 1. - d * d / (peak + d - startCompression);
    float invPeak = 1. / peak;
    
    float extraBrightness = dot(color * (1. - startCompression * invPeak), vec3(1, 1, 1));
    
    color *= newPeak * invPeak;
    float g = 1. - 3. / (desaturation * extraBrightness + 3.);
    return mix(color, vec3(1, 1, 1), g);
}
`,e="vec3 NeutralToneMapping( vec3 color ) {",i=`return mix( color, vec3( newPeak ), g );
}`,s=Zt.tonemapping_pars_fragment.indexOf(e),r=Zt.tonemapping_pars_fragment.indexOf(i,s);if(s>=0&&r>=0){const o=Zt.tonemapping_pars_fragment.substring(s,r+i.length);Zt.tonemapping_pars_fragment=Zt.tonemapping_pars_fragment.replace(o,n)}else Je()&&console.error("Couldn't find NeutralToneMapping in ShaderChunk.tonemapping_pars_fragment")}function pGe(){const n=`
// 0: Default, 1: Golden, 2: Punchy
#define AGX_LOOK 0        

vec3 userSlope = vec3(1.0);
vec3 userOffset = vec3(0.0);
vec3 userPower = vec3(1.0);
float userSaturation = 1.0;

// Mean error^2: 3.6705141e-06
vec3 _agxDefaultContrastApprox(vec3 x) {
    vec3 x2 = x * x;
    vec3 x4 = x2 * x2;
    
    return  + 15.5     * x4 * x2
            - 40.14    * x4 * x
            + 31.96    * x4
            - 6.868    * x2 * x
            + 0.4298   * x2
            + 0.1191   * x
            - 0.00232;
}

vec3 _agx(vec3 val) {
    const mat3 agx_mat = mat3(
        0.842479062253094, 0.0423282422610123, 0.0423756549057051,
        0.0784335999999992,  0.878468636469772,  0.0784336,
        0.0792237451477643, 0.0791661274605434, 0.879142973793104);
    
    const float min_ev = -12.47393f;
    const float max_ev = 4.026069f;

    // val = pow(val, vec3(2.2)); 

    // Input transform (inset)
    val = agx_mat * val;
    
    // Log2 space encoding
    val = clamp(log2(val), min_ev, max_ev);
    val = (val - min_ev) / (max_ev - min_ev);
    
    // Apply sigmoid function approximation
    val = _agxDefaultContrastApprox(val);

    return val;
}

vec3 _agxEotf(vec3 val) {
    const mat3 agx_mat_inv = mat3(
        1.19687900512017, -0.0528968517574562, -0.0529716355144438,
        -0.0980208811401368, 1.15190312990417, -0.0980434501171241,
        -0.0990297440797205, -0.0989611768448433, 1.15107367264116);
        
    // Inverse input transform (outset)
    val = agx_mat_inv * val;
    
    // sRGB IEC 61966-2-1 2.2 Exponent Reference EOTF Display
    // NOTE: We're linearizing the output here. Comment/adjust when
    // *not* using a sRGB render target
    val = pow(val, vec3(2.2)); 

    return val;
}

vec3 _agxLook(vec3 val) {
    const vec3 lw = vec3(0.2126, 0.7152, 0.0722);
    float luma = dot(val, lw);
    
    // Default
    vec3 offset = vec3(0.0);
    vec3 slope = vec3(1.0);
    vec3 power = vec3(1.0);
    float sat = 1.0;
    
    #if AGX_LOOK == 1
    // Golden
    slope = vec3(1.0, 0.9, 0.5);
    power = vec3(0.8);
    sat = 0.8;
    #elif AGX_LOOK == 2
    // Punchy
    slope = vec3(1.0);
    power = vec3(1.35, 1.35, 1.35);
    sat = 1.4;
    #endif        
    
    // Needle
    slope = vec3(1.05);
    power = vec3(1.10, 1.10, 1.10);
    sat = 1.15;

    // User
    // slope = userSlope;
    // offset = userOffset;
    // power = userPower;
    // sat = userSaturation;
    
    // ASC CDL
    val = pow(val * slope + offset, power);
    return luma + sat * (val - luma);
}


vec3 AgXToneMapping( vec3 color ) {
    // apply AGX
    color *= toneMappingExposure;
    color = _agx(color);
    color = _agxLook(color); // Optional
    color = _agxEotf(color);
    return color;
`,e="vec3 AgXToneMapping( vec3 color ) {",i="return color;",s=Zt.tonemapping_pars_fragment.indexOf(e),r=Zt.tonemapping_pars_fragment.indexOf(i,s);if(s>=0&&r>=0){const o=Zt.tonemapping_pars_fragment.substring(s,r+i.length);Zt.tonemapping_pars_fragment=Zt.tonemapping_pars_fragment.replace(o,n)}else Je()&&console.error("Couldn't find AgXToneMapping in ShaderChunk.tonemapping_pars_fragment")}function _o(n){const e=document.createElement("span");return e.style.maxWidth="48px",e.style.maxHeight="48px",e.style.overflow="hidden",e.classList.add("material-symbols-outlined","notranslate"),e.setAttribute("translate","no"),e.innerText=n,e}function Yie(n){var e;return((e=n.classList)==null?void 0:e.contains("material-symbols-outlined"))||!1}const Q2=new Map;async function _F(n){const e="Material Symbols Outlined";if(document.fonts.check(`1em '${e}'`)||(console.log("Font not loaded yet"),await document.fonts.ready),Q2.has(n))return Q2.get(n);const i=document.createElement("canvas"),s=48;i.width=s,i.height=s;const r=i.getContext("2d");if(r){r.font=`${s}px '${e}'`,r.fillStyle="black",r.fillText(n,0,s);const o=i.toDataURL(),a=new di;return a.name=n+" icon",a.image=new Image,a.image.src=o,a.needsUpdate=!0,Q2.set(n,a),a}return Q2.set(n,null),null}const MF=class{constructor(){m(this,"_fullscreenButton"),m(this,"_muteButton"),m(this,"_qrButton")}static getOrCreate(){return this._instance||(this._instance=new MF),this._instance}static create(){return new MF}get fullscreenButton(){return this._fullscreenButton}createFullscreenButton(n){if(this._fullscreenButton)return this._fullscreenButton;if(!document.fullscreenEnabled)return Je()&&console.warn("NeedleMenu: Fullscreen button could not be created, device doesn't support the Fullscreen API"),null;const e=document.createElement("button");this._fullscreenButton=e,e.classList.add("fullscreen-button"),e.title="Click to enter fullscreen mode";const i=_o("fullscreen"),s=_o("fullscreen_exit");return e.appendChild(i),e.onclick=()=>{document.fullscreenElement?document.exitFullscreen():"webkitRequestFullscreen"in n.domElement&&typeof n.domElement.webkitRequestFullscreen=="function"?n.domElement.webkitRequestFullscreen():"requestFullscreen"in n.domElement&&n.domElement.requestFullscreen()},document.addEventListener("fullscreenchange",()=>{document.fullscreenElement?(i.remove(),e.appendChild(s),e.title="Click to enter fullscreen mode"):(s.remove(),e.appendChild(i),e.title="Click to exit fullscreen mode")}),globalThis.addEventListener("needle-xrsession-start",()=>{e.style.display="none"}),globalThis.addEventListener("needle-xrsession-end",()=>{e.style.display=""}),e}get muteButton(){return this._muteButton}createMuteButton(n){if(this._muteButton)return this._muteButton;const e=document.createElement("button");this._muteButton=e,e.classList.add("mute-button"),e.title="Click to mute/unmute";const i=_o("volume_off"),s=_o("volume_up");return n.application.muted?e.appendChild(i):e.appendChild(s),e.onclick=()=>{n.application.muted?(i.remove(),e.appendChild(s),n.application.muted=!1):(s.remove(),e.appendChild(i),n.application.muted=!0)},e}get qrButton(){return this._qrButton}createQRCode(){if(this._qrButton)return this._qrButton;const n=document.createElement("button");this._qrButton=n,n.innerText="QR Code",n.prepend(_o("qr_code")),n.title="Scan this QR code with your phone to open this page",this.hideElementDuringXRSession(n);const e=document.createElement("div");e.style.cssText=`
            position: fixed;
            display: inline-block;
            padding: 1rem;
            background-color: white;
            border-radius: 0.4rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
        `;const i=document.createElement("div");i.classList.add("qr-code-container"),e.appendChild(i),n.addEventListener("click",()=>{if(e.parentNode)return r();window.location.href.includes("://localhost")&&An("To access your website from another device in the same local network you have to use the IP address instead of localhost."),s()});async function s(){await o(),document.body.appendChild(e);const a=i.getBoundingClientRect(),l=n.getBoundingClientRect();e.style.left=l.left+l.width*.5-a.width*.5+"px",l.top<a.height?e.style.top=`calc(${l.bottom}px + ${e.style.padding} * .6)`:e.style.top=`calc(${l.top-a.height}px - ${e.style.padding} * 2.5)`,e.style.opacity="0",e.style.pointerEvents="all",e.style.transition="opacity 0.2s ease-in-out",setTimeout(()=>{e.style.opacity="1",window.addEventListener("click",r,{once:!0})}),window.addEventListener("resize",r),window.addEventListener("scroll",r),document.fullscreenElement?document.fullscreenElement.appendChild(e):document.body.appendChild(e)}function r(){e.style.pointerEvents="none",e.style.transition="opacity 0.2s",e.style.opacity="0",setTimeout(()=>{var a;return(a=e.parentNode)==null?void 0:a.removeChild(e)},500),window.removeEventListener("click",r),window.removeEventListener("resize",r),window.removeEventListener("scroll",r)}async function o(){const a=await f6({text:window.location.href,width:200,height:200});i.innerHTML="",i.appendChild(a)}return n.addEventListener("pointerenter",()=>{o()},{once:!0}),n}hideElementDuringXRSession(n){OR(e=>{n["previous-display"]=n.style.display,n.style.display="none"}),O5(e=>{n["previous-display"]!=null&&(n.style.display=n["previous-display"])})}};let lp=MF;m(lp,"_instance");function K2(n,e){const i=e?.element||document.head,s=Array.from(i.querySelectorAll(`link[rel=stylesheet][href*='${n}']`));if(s.length<=0){const r=document.createElement("link");r.href=n,r.rel="stylesheet",i.appendChild(r),s.push(r)}if(e!=null&&e.loadedCallback)for(let r=0;r<s.length;r++)e!=null&&e.loadedCallback&&s[r].addEventListener("load",e.loadedCallback)}function jie(){K2("https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap")}const IF="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0",Y2="needle-logo-element";class Jie extends HTMLElement{constructor(){super(),m(this,"_root"),m(this,"wrapper"),m(this,"logoElement",document.createElement("img")),m(this,"textElement",document.createElement("span")),this._root=this.attachShadow({mode:"closed"});const e=document.createElement("template");e.innerHTML=`<style>
        :host {
            position: relative;
            min-width: fit-content;
            /* height: 100%; can not have height 100% because of align-items: stretch; in the parent */
            display: flex;
        }

        .wrapper {
            position: relative;
            display: grid;
            grid-template-columns: auto auto;
            padding: .1rem;
        }
        .wrapper:hover {
            cursor: pointer;
        }
        img {
            width: 95px;
            height: 100%;
            align-self: end;
            margin-left: 0.6rem;
        }
        span {
            font-size: 1rem;
            white-space: nowrap;
        }
        </style>
        <div class="wrapper">
            <img class="logo" src=${AMe} />
        </div>
        `,this._root.appendChild(e.content.cloneNode(!0)),this.wrapper=this._root.querySelector(".wrapper"),this._root.appendChild(this.wrapper),this.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")}),this.wrapper.setAttribute("title","Made with Needle Engine")}static get elementName(){return Y2}static create(){return document.createElement(Y2)}setLogoVisible(e){this.logoElement.style.display=e?"block":"none"}}customElements.get(Y2)||customElements.define(Y2,Jie);const TF=q("debugspatialmenu");class mGe{constructor(e,i){m(this,"_context"),m(this,"needleMenu"),m(this,"htmlButtonsMap",new Map),m(this,"enabled",!0),m(this,"userRequestedMenu",!1),m(this,"uiisDirty",!1),m(this,"_showNeedleLogo"),m(this,"_wasInXR",!1),m(this,"preRender",()=>{var o;if(!this.enabled){(o=this.menu)==null||o.removeFromParent();return}TF&&Ft.isDesktop()&&this.updateMenu();const a=this._context.xr;if(!(a!=null&&a.running)){this._wasInXR&&(this._wasInXR=!1,this.onExitXR());return}this._wasInXR||(this._wasInXR=!0,this.onEnterXR()),this.updateMenu()}),m(this,"_menuTarget",new Ae),m(this,"positionFilter",new eD(90,.5)),m(this,"familyName","Needle Spatial Menu"),m(this,"menu"),m(this,"_poweredByNeedleElement");var s;this._context=e,this._context.pre_render_callbacks.push(this.preRender),this.needleMenu=i;const r=(s=this.needleMenu.shadowRoot)==null?void 0:s.querySelector(".options");r?new MutationObserver(o=>{if(this.enabled&&!(this._context.isInXR==!1&&!TF))for(const a of o)a.type==="childList"&&(a.addedNodes.forEach(l=>{this.createButtonFromHTMLNode(l)}),a.removedNodes.forEach(l=>{const c=l,h=this.htmlButtonsMap.get(c);h&&(this.htmlButtonsMap.delete(c),h.remove(),Bn.update())}))}).observe(r,{childList:!0}):console.error("Could not find options container in needle menu")}setEnabled(e){var i;this.enabled=e,e||(i=this.menu)==null||i.removeFromParent()}setDisplay(e){return this.enabled?(this.userRequestedMenu=e,!0):!1}onDestroy(){const e=this._context.pre_render_callbacks.indexOf(this.preRender);e>-1&&this._context.pre_render_callbacks.splice(e,1)}markDirty(){this.uiisDirty=!0}showNeedleLogo(e){this._showNeedleLogo=e}onEnterXR(){var e;const i=(e=this.needleMenu.shadowRoot)==null?void 0:e.querySelector(".options");i&&i.childNodes.forEach(s=>{this.createButtonFromHTMLNode(s)})}onExitXR(){var e;(e=this.menu)==null||e.removeFromParent()}createButtonFromHTMLNode(e){const i=this.getMenu(),s=this.htmlButtonsMap.get(e);if(s){s.add();return}if(e instanceof HTMLButtonElement){const r=this.createButton(i,e);this.htmlButtonsMap.set(e,r),r.add()}else e instanceof HTMLSlotElement&&e.assignedNodes().forEach(r=>{this.createButtonFromHTMLNode(r)})}updateMenu(){var e,i;performance.mark("NeedleSpatialMenu updateMenu start");const s=this.getMenu();this.handleNeedleWatermark(),this._context.scene.add(s);const r=this._context.mainCamera,o=this._context.xr,a=o?.rigScale||1;if(r){const l=r.worldPosition,c=r.worldForward.multiplyScalar(-1),h=c.y>.6,d=c.y>.4,u=(s.visible?d:h)||this.userRequestedMenu,p=!s.visible&&u;s.visible=u||Ft.isDesktop()&&TF,c.multiplyScalar(3*a),l.add(c),p&&(s.position.copy(this._menuTarget.position),s.position.y+=.25,this._menuTarget.position.copy(s.position),this.positionFilter.reset(s.position),s.quaternion.copy(this._menuTarget.quaternion),this.markDirty());const g=this._menuTarget.position.distanceTo(l);(p||g>1.5*a)&&(this.ensureRenderOnTop(this.menu),this._menuTarget.position.copy(l),this._context.scene.add(this._menuTarget),xw(this._menuTarget,this._context.mainCamera,!0,!0),this._menuTarget.removeFromParent()),this.positionFilter.filter(this._menuTarget.position,s.position,this._context.time.time);const f=5;(e=this.menu)==null||e.quaternion.slerp(this._menuTarget.quaternion,this._context.time.deltaTime*f),(i=this.menu)==null||i.scale.setScalar(a)}this.uiisDirty&&(performance.mark("SpatialMenu.update.uiisDirty.start"),this.uiisDirty=!1,Bn.update(),performance.mark("SpatialMenu.update.uiisDirty.end"),performance.measure("SpatialMenu.update.uiisDirty","SpatialMenu.update.uiisDirty.start","SpatialMenu.update.uiisDirty.end")),performance.mark("NeedleSpatialMenu updateMenu end"),performance.measure("SpatialMenu.update","NeedleSpatialMenu updateMenu start","NeedleSpatialMenu updateMenu end")}ensureRenderOnTop(e,i=0){e instanceof pe&&(e.material.depthTest=!1,e.material.depthWrite=!1),e.renderOrder=1e3+i*2;for(const s of e.children)this.ensureRenderOnTop(s,i+1)}get isVisible(){var e;return(e=this.menu)==null?void 0:e.visible}getMenu(){if(this.menu)return this.menu;this.ensureFont(),this.menu=new Bn.Block({boxSizing:"border-box",fontFamily:this.familyName,height:"auto",fontSize:.1,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:.55,borderRadius:1,whiteSpace:"pre-wrap",flexDirection:"row",alignItems:"center",padding:new $e(0,.05,0,.05),borderColor:0,borderOpacity:.05,borderWidth:.005});const e=Y.get("ObjectRaycaster");return e&&B0(this.menu,new e),this.menu}handleNeedleWatermark(){var e;if(!this._poweredByNeedleElement){this._poweredByNeedleElement=new Bn.Block({width:"auto",height:"auto",fontSize:.05,whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",margin:.02,borderRadius:.02,padding:.02,backgroundColor:16777215,backgroundOpacity:1}),this._poweredByNeedleElement["needle:use_eventsystem"]=!0;const i=new qie(this._context,()=>globalThis.open("https://needle.tools","_self"));B0(this._poweredByNeedleElement,i);const s=new Bn.Text({textContent:"Powered by",width:"auto",height:"auto"}),r=new Bn.Text({textContent:"needle",width:"auto",height:"auto",fontSize:.07,margin:new $e(0,0,0,.02)});this._poweredByNeedleElement.add(s),this._poweredByNeedleElement.add(r),(e=this.menu)==null||e.add(this._poweredByNeedleElement),this.markDirty(),new hh().load("./include/needle/poweredbyneedle.webp",o=>{var a;i.allowModifyUI=!1,s.removeFromParent(),r.removeFromParent();const l=o.image.width/o.image.height;(a=this._poweredByNeedleElement)==null||a.set({backgroundImage:o,backgroundOpacity:1,width:.1*l,height:.1}),this.markDirty()})}if(this.menu){const i=this.menu.children.indexOf(this._poweredByNeedleElement);if(!this._showNeedleLogo&&ng())i>=0&&(this._poweredByNeedleElement.removeFromParent(),this.markDirty());else{this._poweredByNeedleElement.visible=!0,this.menu.add(this._poweredByNeedleElement);const s=this.menu.children.indexOf(this._poweredByNeedleElement);i!==s&&this.markDirty()}}}ensureFont(){let e=Bn.FontLibrary.getFontFamily(this.familyName);if(!e){e=Bn.FontLibrary.addFontFamily(this.familyName);const i=e.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");i?.addEventListener("ready",()=>{this.markDirty()})}}createButton(e,i){const s=new Bn.Block({width:"auto",height:"auto",whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",backgroundColor:16777215,backgroundOpacity:0,padding:.02,margin:.01,borderRadius:.02,cursor:"pointer",fontSize:.05}),r=new Bn.Text({textContent:"",width:"auto",justifyContent:"center",alignItems:"center",backgroundOpacity:0,backgroundColor:16777215,fontFamily:this.familyName,color:0,borderRadius:.02,padding:.01});s.add(r),s["needle:use_eventsystem"]=!0;const o=new qie(this._context,()=>i.click());return B0(s,o),new gGe(this,e,i,s,r)}}class gGe{constructor(e,i,s,r,o){m(this,"menu"),m(this,"root"),m(this,"htmlbutton"),m(this,"spatialContainer"),m(this,"spatialText"),m(this,"spatialIcon"),m(this,"_lastText",""),m(this,"_lastTexture"),this.menu=e,this.root=i,this.htmlbutton=s,this.spatialContainer=r,this.spatialText=o,new MutationObserver(a=>{for(const l of a)l.type==="attributes"?l.attributeName==="style"&&this.updateVisible():l.type==="childList"&&this.updateText()}).observe(s,{attributes:!0,childList:!0}),this.updateText()}add(){this.spatialContainer.parent!=this.root&&(this.root.add(this.spatialContainer),this.menu.markDirty(),this.updateVisible(),this.updateText())}remove(){this.spatialContainer.parent&&(this.spatialContainer.removeFromParent(),this.menu.markDirty())}updateVisible(){const e=this.spatialContainer.visible;this.spatialContainer.visible=this.htmlbutton.style.display!=="none",e!==this.spatialContainer.visible&&this.menu.markDirty()}updateText(){let e="",i="";this.htmlbutton.childNodes.forEach(s=>{s.nodeType===Node.TEXT_NODE?e+=s.textContent:s instanceof HTMLElement&&Yie(s)&&s.textContent&&(i=s.textContent)}),this._lastText!==e&&(this._lastText=e,this.spatialText.name=e,this.spatialText.set({textContent:e}),this.menu.markDirty()),e.length<=0?this.spatialText.parent&&(this.spatialText.removeFromParent(),this.menu.markDirty()):this.spatialText.parent||(this.spatialContainer.add(this.spatialText),this.menu.markDirty()),i&&this.createIcon(i)}async createIcon(e){var i;if(!this.spatialIcon){const r=await _F(e);if(r&&!this.spatialIcon){const o=new Bn.Block({width:.08,height:.08,backgroundColor:16777215,backgroundImage:r,backgroundOpacity:1,margin:new $e(0,.005,0,0)});this.spatialIcon=o,this.spatialContainer.add(o),this.menu.markDirty()}}if(e!=this._lastTexture){this._lastTexture=e;const r=await _F(e);r&&((i=this.spatialIcon)==null||i.set({backgroundImage:r}),this.menu.markDirty())}const s=this.spatialContainer.children.indexOf(this.spatialIcon);s>0&&(this.spatialContainer.children.splice(s,1),this.spatialContainer.children.unshift(this.spatialIcon),this.menu.markDirty())}}class qie{constructor(e,i){m(this,"isComponent",!0),m(this,"enabled",!0),m(this,"gameObject"),m(this,"allowModifyUI",!0),m(this,"context"),m(this,"onclick"),this.context=e,this.onclick=i}get activeAndEnabled(){return!0}__internalAwake(){}__internalEnable(){}__internalDisable(){}__internalStart(){}onEnable(){}onDisable(){}get element(){return this.gameObject}onPointerEnter(){this.context.input.setCursorPointer(),this.allowModifyUI&&(this.element.set({backgroundOpacity:1}),Bn.update())}onPointerExit(){this.context.input.setCursorNormal(),this.allowModifyUI&&(this.element.set({backgroundOpacity:0}),Bn.update())}onPointerDown(e){e.use()}onPointerUp(e){e.use()}onPointerClick(e){e.use(),this.onclick()}}const ev="needle-menu",UC=q("debugmenu"),$ie=q("debugnoncommercial");let fGe=class{constructor(n){m(this,"_context"),m(this,"_menu"),m(this,"_spatialMenu"),m(this,"onPostMessage",e=>{if(e.origin===globalThis.location.origin&&typeof e.data=="object"){const i=e.data,s=i.type;if(s==="needle:menu"){const r=i.button;if(r){if(!r.label)return console.error("NeedleMenu: buttoninfo.label is required");if(!r.onclick)return console.error("NeedleMenu: buttoninfo.onclick is required");const o=document.createElement("button");if(o.textContent=r.label,r.icon){const a=_o(r.icon);o.prepend(a)}r.priority&&o.setAttribute("priority",r.priority.toString()),o.onclick=()=>{if(r.onclick){const a=r.onclick.startsWith("http")||r.onclick.startsWith("www."),l=r.target||"_blank";a?globalThis.open(r.onclick,l):console.error("NeedleMenu: onclick is not a valid link",r.onclick)}},this._menu.appendChild(o)}else UC&&console.error("NeedleMenu: unknown postMessage event",i)}else UC&&console.warn("NeedleMenu: unknown postMessage type",s,i)}}),m(this,"onStartXR",e=>{e.session.isScreenBasedAR&&(this._menu.previousParent=this._menu.parentNode,this._context.arOverlayElement.appendChild(this._menu),e.session.session.addEventListener("end",this.onExitXR),this._menu.closeFoldout())}),m(this,"onExitXR",()=>{this._menu.previousParent&&(this._menu.previousParent.appendChild(this._menu),delete this._menu.previousParent)}),m(this,"_muteButton"),m(this,"_fullscreenButton"),this._menu=tne.getOrCreate(n.domElement,n),this._context=n,this._spatialMenu=new mGe(n,this._menu),window.addEventListener("message",this.onPostMessage),OR(this.onStartXR)}onDestroy(){window.removeEventListener("message",this.onPostMessage),this._menu.remove(),this._spatialMenu.onDestroy()}setPosition(n){this._menu.setPosition(n)}setVisible(n){this._menu.setVisible(n)}showNeedleLogo(n){var e;this._menu.showNeedleLogo(n),(e=this._spatialMenu)==null||e.showNeedleLogo(n)}showSpatialMenu(n){this._spatialMenu.setEnabled(n)}setSpatialMenuVisible(n){this._spatialMenu.setDisplay(n)}get spatialMenuIsVisible(){return this._spatialMenu.isVisible}showQRCodeButton(n){if(n==="desktop-only"&&(n=!Ft.isMobileDevice()),n){const e=lp.getOrCreate().createQRCode();return e.style.display="",this._menu.appendChild(e),e}else{const e=lp.getOrCreate().qrButton;return e&&(e.style.display="none"),e??null}}showAudioPlaybackOption(n){var e;if(!n){(e=this._muteButton)==null||e.remove();return}this._muteButton=lp.getOrCreate().createMuteButton(this._context),this._muteButton.setAttribute("priority","100"),this._menu.appendChild(this._muteButton)}showFullscreenOption(n){var e;if(!n){(e=this._fullscreenButton)==null||e.remove();return}this._fullscreenButton=lp.getOrCreate().createFullscreenButton(this._context),this._fullscreenButton&&(this._fullscreenButton.setAttribute("priority","150"),this._menu.appendChild(this._fullscreenButton))}appendChild(n){return this._menu.appendChild(n)}};var j2,J2,EF;const ene=class extends HTMLElement{constructor(){var n,e,i,s,r,o;super(),mc(this,J2),m(this,"_domElement",null),m(this,"_context",null),m(this,"_sizeChangeInterval"),mc(this,j2,f=>{if(!f.defaultPrevented&&f.target==this._domElement&&f instanceof PointerEvent&&f.button===0&&this.root.classList.contains("open")){const A=this.foldout.getBoundingClientRect(),y=f;y.clientX>A.left&&y.clientX<A.right&&y.clientY>A.top&&y.clientY<A.bottom||this.root.classList.toggle("open",!1)}}),m(this,"_userRequestedLogoVisible"),m(this,"_userRequestedMenuVisible"),m(this,"root"),m(this,"wrapper"),m(this,"options"),m(this,"logoContainer"),m(this,"compactMenuButton"),m(this,"foldout"),m(this,"_isHandlingChange",!1),m(this,"_didSort",new Map),m(this,"_lastAvailableWidthChange",0),m(this,"_timeoutHandle",0),m(this,"handleSizeChange",(f,A)=>{if(!this._domElement)return;const y=this._domElement.clientWidth;if(y<100){clearTimeout(this._timeoutHandle),this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style");return}const b=20*2,v=y-b;if(!A&&Math.abs(v-this._lastAvailableWidthChange)<1)return;this._lastAvailableWidthChange=v,clearTimeout(this._timeoutHandle),this._timeoutHandle=setTimeout(()=>{const C=w();C<0?(this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style")):C>0&&(this.root.classList.remove("compact"),this.foldout.classList.remove("floating-panel-style"),w()<0&&(this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style")))},5);const x=()=>this.options.clientWidth+this.logoContainer.clientWidth,w=()=>v-x()});const a=document.createElement("template");a.innerHTML=`<style>

        #root {
            position: absolute;
            width: auto;
            max-width: 95%;
            left: 50%;
            transform: translateX(-50%);
            top: min(20px, 10vh);
            padding: 0.3rem;
            display: flex;
            visibility: visible;
            flex-direction: row-reverse; /* if we overflow this should be right aligned so the logo is always visible */
            pointer-events: all;
            z-index: 1000;
        }

        /** hide the menu if it's empty **/
        #root.has-no-options.logo-hidden {
            display: none; 
        }

        /** using a div here because then we can change the class for placement **/
        #root.bottom {
            top: auto;
            bottom: min(30px, 10vh);
        }
        #root.top {
            top: calc(.7rem + env(safe-area-inset-top));
        }
        
        .wrapper {
            position: relative;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: stretch;
            gap: 0px;
            padding: 0 0rem;
        }

        .wrapper > *, .options > button, .options > select, ::slotted(*) {
            position: relative;
            border: none;
            border-radius: 0;
            outline: 1px solid rgba(0,0,0,0);
            display: flex;
            justify-content: center;
            align-items: center;
            max-height: 2.3rem;
            max-width: 100%;

            /** basic font settings for all entries **/
            font-size: 1rem;
            font-family: 'Roboto Flex', sans-serif;
            font-optical-sizing: auto;
            font-weight: 500;
            font-weight: 200;
            font-variation-settings: "wdth" 100;
            color: rgb(20,20,20);
        }

        .floating-panel-style {
            background: rgba(255, 255, 255, .4);
            outline: rgb(0 0 0 / 5%) 1px solid;
            border: 1px solid rgba(255, 255, 255, .1);
            box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);
            border-radius: 1.5rem;
            /** 
             * to make nested background filter work 
             * https://stackoverflow.com/questions/60997948/backdrop-filter-not-working-for-nested-elements-in-chrome 
             **/
            &::before {
                content: '';
                position: absolute;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                z-index: -1;
                border-radius: 1.5rem;
                -webkit-backdrop-filter: blur(8px);
                backdrop-filter: blur(8px);
            }
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        .options {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        .options > *, ::slotted(*) {
            max-height: 2.25rem;
            padding: .4rem .5rem;
        }
        
        :host .options > *, ::slotted(*) {
            background: transparent;
            border: none;
            white-space: nowrap;
            transition: all 0.1s linear .02s;
            border-radius: 1.5rem;
            user-select: none;
        }
        :host .options > *:hover, ::slotted(*:hover) {
            cursor: pointer;
            color: black;
            background: rgba(245, 245, 245, .8);
            box-shadow: inset 0 0 1rem rgba(0,0,30,.2);
            outline: rgba(0,0,0,.1) 1px solid;
        }
        :host .options > *:active, ::slotted(*:active) {
            background: rgba(255, 255, 255, .8);
            box-shadow: inset 0px 1px 1px rgba(255,255,255,.5), inset 0 0 2rem rgba(0,0,30,.2), inset 0px 2px 4px rgba(0,0,20,.5);
            transition: all 0.05s linear;
        }
        :host .options > *:focus, ::slotted(*:focus) {
            outline: rgba(255,255,255,.5) 1px solid;
        }
        :host .options > *:focus-visible, ::slotted(*:focus-visible) {
            outline: rgba(0,0,0,.5) 1px solid;
        }

        :host .options > *:disabled, ::slotted(*:disabled) {
            background: rgba(0,0,0,.05);
            color: rgba(60,60,60,.7);
            pointer-events: none;
        }

        button, ::slotted(button) {
            gap: 0.3rem;
        }

        /** XR button animation **/
        :host button.this-mode-is-requested {
            background: repeating-linear-gradient(to right, #fff 0%, #fff 40%, #aaffff 55%, #fff 80%);
            background-size: 200% auto;
            background-position: 0 100%;
            animation: AnimationName .7s ease infinite forwards;
        }
        :host button.other-mode-is-requested {
            opacity: .5;
        }
        
        @keyframes AnimationName {
            0% { background-position: 0% 0 }
            100% { background-position: -200% 0 }
        }




        .logo {
            cursor: pointer;
            padding-left: 0.6rem;
            padding-bottom: .02rem;
            margin-right: 0.5rem;
        }
        .logo-hidden {
            .logo {
                display: none;
            }
        }
        :host .has-options .logo {
            border-left: 1px solid rgba(40,40,40,.4);
            margin-left: 0.3rem;
            margin-right: 0.5rem;
        }

        .logo > span {
            white-space: nowrap;
        }



        /** COMPACT */

        /** Hide the menu button normally **/
        .compact-menu-button { display: none; }
        /** And show it when we're in compact mode **/
        .compact .compact-menu-button {
            position: relative;
            display: block;
            background: none;
            border: none;
            border-radius: 2rem;

            margin: 0;
            padding: 0 .3rem;
            padding-top: .2rem;

            z-index: 100;

            color: #000;

            &:hover {
                background: rgba(255,255,255,.2);
                cursor: pointer;
            }
            &:focus {
                outline: 1px solid rgba(255,255,255,.5);
            }
            &:focus-visible {
                outline: 1px solid rgba(0,0,0,.5);
            }
            & .expanded-click-area {
                position: absolute;
                left: 0;
                right: 0;
                top: 10%;
                bottom: 10%;
                transform: scale(1.8);
            }
        }  
        .has-no-options .compact-menu-button {
            display: none;
        }
        .open .compact-menu-button {
            background: rgba(255,255,255,.2);
        }
        .logo-visible .compact-menu-button { 
            margin-left: .2rem;
        }
        
        /** Open and hide menu **/
        .compact .foldout { 
            display: none;
        }
        .open .options, .open .foldout {
            display: flex;
            justify-content: center;
        }
        .compact .wrapper {
            padding: 0;
        }
        .compact .wrapper, .compact .options {
            height: auto;
            max-height: initial;
            flex-direction: row;
            gap: .12rem;
        }
        .compact .options { 
            flex-wrap: wrap;
            gap: .3rem;
        }
        .compact .top .options {
            height: auto;
            flex-direction: row;
        }
        .compact .bottom .wrapper {
            height: auto;
            flex-direction: column;
        }

        .compact .foldout {
            max-height: min(100ch, calc(100vh - 100px));
            overflow: auto;
            overflow-x: hidden;
            align-items: center;

            position: fixed;
            bottom: calc(100% + 5px);
            z-index: 100;
            width: auto;
            left: .2rem;
            right: .2rem;
            padding: .2rem;

        }
        .compact.logo-hidden .foldout {
            /** for when there's no logo we want to center the foldout **/
            min-width: 24ch;
            margin-left: 50%;
            transform: translateX(calc(-50% - .2rem));
        }
        
        .compact.top .foldout {
            top: calc(100% + 5px);
            bottom: auto;
        }

        ::-webkit-scrollbar {
            max-width: 7px;
            background: rgba(100,100,100,.2);
            border-radius: .2rem;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, .3);
            border-radius: .2rem;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgb(150,150,150);
        }

        .compact .options > *, .compact .options > ::slotted(*) {
            font-size: 1.2rem;
            padding: .6rem .5rem;
            width: 100%;
        }
        .compact.has-options .logo {
            border: none;
            padding-left: 0;
            margin-left: 1rem;
            margin-bottom: .02rem;
        }
        .compact .options {
            /** e.g. if we have a very wide menu item like a select with long option names we don't want to overflow **/
            max-width: 100%;

            & > button, & > select {
                display: flex;
                flex-basis: 100%;
                min-height: 3rem;
            }
            & > button.row2 {
                //border: 1px solid red !important;
                display: flex;
                flex: 1;
                flex-basis: 30%;
            }
        }

        /** If there's really not enough space then just hide all options **/
        @media (max-width: 100px) or (max-height: 100px){
            .foldout {
                display: none !important;
            }
            .compact-menu-button {
                display: none !important;
            }
        }
        
        /* dark mode */
        /*
        @media (prefers-color-scheme: dark) {
            :host {
                background: rgba(0,0,0, .6);
            }
            :host button {
                color: rgba(200,200,200);
            }
            :host button:hover {
                background: rgba(100,100,100, .8);
            }
        }
        */

        </style>
        
        <div id="root" class="logo-visible floating-panel-style bottom">
            <div class="wrapper">
                <div class="foldout">
                    <div class="options" part="options">
                        <slot></slot>
                    </div>
                    <div class="options" part="options">
                        <slot name="end"></slot>
                    </div>
                </div>
                <div style="user-select:none" class="logo">
                    <span class="madewith notranslate">powered by</span>
                </div>
            </div>
            <button class="compact-menu-button">
                <div class="expanded-click-area"></div>
            </button>
        </div>
        `;const l=this.attachShadow({mode:"open"});jie(),K2(IF,{loadedCallback:()=>{this.handleSizeChange()}}),K2(IF,{element:l});const c=a.content.cloneNode(!0);l?.appendChild(c),this.root=l.querySelector("#root"),this.wrapper=(n=this.root)==null?void 0:n.querySelector(".wrapper"),this.options=(e=this.root)==null?void 0:e.querySelector(".options"),this.logoContainer=(i=this.root)==null?void 0:i.querySelector(".logo"),this.compactMenuButton=(s=this.root)==null?void 0:s.querySelector(".compact-menu-button"),this.compactMenuButton.append(_o("more_vert")),this.foldout=(r=this.root)==null?void 0:r.querySelector(".foldout"),(o=this.root)==null||o.appendChild(this.wrapper),this.wrapper.classList.add("wrapper");const h=Jie.create();h.style.minHeight="1rem",this.logoContainer.append(h),this.logoContainer.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")});try{CGe(f=>{if(f==!0&&Vh()&&!$ie){let A=this._userRequestedLogoVisible;A===void 0&&(A=!1),FA(this,J2,EF).call(this,A)}})}catch(f){console.error("[Needle Menu] License check failed.",f)}this.compactMenuButton.addEventListener("click",f=>{f.preventDefault(),this.root.classList.toggle("open")});let d=this._context;setTimeout(()=>d=this._context);let u=0;const p=(f,A)=>{var y,b,v;UC&&console.log("Set menu visible",A),d!=null&&d.isInAR&&d.arOverlayElement?f!=d.arOverlayElement&&d.arOverlayElement.appendChild(this):this.parentNode!=((y=this._domElement)==null?void 0:y.shadowRoot)&&((v=(b=this._domElement)==null?void 0:b.shadowRoot)==null||v.appendChild(this)),this.style.display=A?"flex":"none",this.style.visibility="visible",this.style.opacity="1"};let g=!1;new MutationObserver(f=>{var A;if(!g)try{g=!0,this.onChangeDetected(f);const y=this==null?void 0:this.parentNode;if((this.style.display!="flex"||this.style.visibility!="visible"||this.style.opacity!="1"||y!=((A=this._domElement)==null?void 0:A.shadowRoot))&&!Vh()){const b=u++;Ma()&&this._userRequestedMenuVisible===!1?(b===0&&p(y,this._userRequestedMenuVisible),b===1&&console.warn("Needle Menu Warning: You need a PRO license to hide the Needle Engine menu \u2192 The menu will be visible in your deployed website if you don't have a PRO license. See https://needle.tools/pricing for details.")):b===0?p(y,!0):setTimeout(()=>p(y,!0),5)}}finally{g=!1}}).observe(this.root,{childList:!0,subtree:!0,attributes:!0}),UC&&this.___insertDebugOptions()}static create(){return document.createElement(ev,{is:ev})}static getOrCreate(n,e){let i=n.querySelector(ev);return!i&&n.shadowRoot&&(i=n.shadowRoot.querySelector(ev)),i||(i=ene.create(),n.shadowRoot?n.shadowRoot.appendChild(i):n.appendChild(i)),i._domElement=n,i._context=e,i}connectedCallback(){window.addEventListener("resize",this.handleSizeChange),this.handleMenuVisible(),this._sizeChangeInterval=setInterval(()=>this.handleSizeChange(void 0,!0),5e3),setTimeout(()=>{var n,e;(n=this._domElement)==null||n.addEventListener("resize",this.handleSizeChange),(e=this._domElement)==null||e.addEventListener("click",Hi(this,j2))},1)}disconnectedCallback(){var n,e;window.removeEventListener("resize",this.handleSizeChange),clearInterval(this._sizeChangeInterval),(n=this._domElement)==null||n.removeEventListener("resize",this.handleSizeChange),(e=this._context)==null||e.domElement.removeEventListener("click",Hi(this,j2))}showNeedleLogo(n){this._userRequestedLogoVisible=n,!(!n&&(!Vh()||$ie)&&(console.warn("Needle Menu: You need a PRO license to hide the Needle Engine logo."),!Ma()))&&FA(this,J2,EF).call(this,n)}setPosition(n){if(n!=="top"&&n!=="bottom")return console.error("NeedleMenu.setPosition: invalid position",n);this.root.classList.remove("top","bottom"),this.root.classList.add(n)}setVisible(n){this._userRequestedMenuVisible=n,this.style.display=n?"flex":"none"}closeFoldout(){this.root.classList.remove("open")}append(...n){for(const e of n)if(typeof e=="string"){const i=document.createTextNode(e);this.options.appendChild(i)}else this.options.appendChild(e)}appendChild(n){var e;if(!(n instanceof Node)){const i=document.createElement("button");if(i.textContent=n.label,i.onclick=n.onClick,i.setAttribute("priority",((e=n.priority)==null?void 0:e.toString())??"0"),n.title&&(i.title=n.title),n.icon){const s=_o(n.icon);n.iconSide==="right"?i.appendChild(s):i.prepend(s)}n.class&&i.classList.add(n.class),n=i}return this.options.appendChild(n)}prepend(...n){for(const e of n)if(typeof e=="string"){const i=document.createTextNode(e);this.options.prepend(i)}else this.options.prepend(e)}onChangeDetected(n){if(!this._isHandlingChange){this._isHandlingChange=!0;try{this.handleMenuVisible();for(const e of n)e.target==this.options&&this.onOptionsChildrenChanged(e)}finally{this._isHandlingChange=!1}}}onOptionsChildrenChanged(n){if(this.root.classList.toggle("has-options",this.hasAnyVisibleOptions),this.root.classList.toggle("has-no-options",!this.hasAnyVisibleOptions),this.handleSizeChange(void 0,!0),n.type==="childList"&&n.addedNodes.length>0){const e=Array.from(this.options.children);e.sort((s,r)=>{const o=parseInt(s.getAttribute("priority")||"0"),a=parseInt(r.getAttribute("priority")||"0");return o-a});let i=!1;for(let s=0;s<e.length;s++){const r=this.options.children[s],o=e[s];if(r!==o){i=!0;break}}if(i)for(const s of e)this.options.appendChild(s)}}handleMenuVisible(){UC&&console.log("Update VisibleState: Any Content?",this.hasAnyContent),this.hasAnyContent?this.root.style.display="":this.root.style.display="none",this.root.classList.toggle("has-options",this.hasAnyVisibleOptions),this.root.classList.toggle("has-no-options",!this.hasAnyVisibleOptions)}get hasAnyContent(){return!!(this.logoContainer.style.display!="none"||this.hasAnyVisibleOptions)}get hasAnyVisibleOptions(){for(let n=0;n<this.options.children.length;n++){const e=this.options.children[n];if(e.tagName==="SLOT"){const i=e.assignedNodes();for(const s of i)if(s instanceof HTMLElement&&s.style.display!="none")return!0}else if(e.style.display!="none")return!0}return!1}___insertDebugOptions(){window.addEventListener("keydown",i=>{i.key==="p"&&this.setPosition(this.root.classList.contains("top")?"bottom":"top")});const n=document.createElement("button");n.textContent="Hide Buttons",n.onclick=()=>{const i=new Array(this.options.children.length);for(let s=0;s<this.options.children.length;s++)i[s]=this.options.children[s];for(const s of i)this.options.removeChild(s);setTimeout(()=>{for(const s of i)this.options.appendChild(s)},1e3)},this.appendChild(n);const e=document.createElement("button");e.textContent="Toggle Logo",e.addEventListener("click",()=>{this.logoContainer.style.display=this.logoContainer.style.display==="none"?"":"none"}),this.appendChild(e)}};let tne=ene;j2=new WeakMap,J2=new WeakSet,EF=function(n){this.logoContainer.style.display="",this.logoContainer.style.opacity="1",this.logoContainer.style.visibility="visible",n?(this.root.classList.remove("logo-hidden"),this.root.classList.add("logo-visible")):(this.root.classList.remove("logo-visible"),this.root.classList.add("logo-hidden"))},customElements.get(ev)||customElements.define(ev,tne);const Mr=q("debugcontext"),AGe=q("stats"),yGe=q("debugactive"),bGe=q("debugframerate"),vGe=q("debugcoroutine"),xGe={};class wGe{constructor(){m(this,"name"),m(this,"alias"),m(this,"hash"),m(this,"runInBackground"),m(this,"domElement"),m(this,"renderer"),m(this,"camera"),m(this,"scene")}}var _n=(n=>(n[n.Start=-1]="Start",n[n.EarlyUpdate=0]="EarlyUpdate",n[n.Update=1]="Update",n[n.LateUpdate=2]="LateUpdate",n[n.OnBeforeRender=3]="OnBeforeRender",n[n.OnAfterRender=4]="OnAfterRender",n[n.PrePhysicsStep=9]="PrePhysicsStep",n[n.PostPhysicsStep=10]="PostPhysicsStep",n[n.Undefined=-1]="Undefined",n))(_n||{});function q2(n,e){if(!n)return;if(!n.isComponent){(Je()||Mr)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,n);return}e||(e=$t.Current,Mr&&console.warn("> Registering component without context"));const i=e?.new_scripts;i.includes(n)||i.push(n)}const Jn=class{constructor(n){m(this,"name"),m(this,"alias"),m(this,"isManagedExternally",!1),m(this,"isPaused",!1),m(this,"runInBackground",!1),m(this,"targetFrameRate"),m(this,"physicsSteps",1),m(this,"hash"),m(this,"domElement"),m(this,"_resolutionScaleFactor",1),m(this,"_boundingClientRectFrame",-1),m(this,"_boundingClientRect",null),m(this,"_domX"),m(this,"_domY"),m(this,"xr",null),m(this,"_xrFrame",null),m(this,"_currentFrameEvent",-1),m(this,"scene"),m(this,"renderer"),m(this,"composer",null),m(this,"scripts",[]),m(this,"scripts_pausedChanged",[]),m(this,"scripts_earlyUpdate",[]),m(this,"scripts_update",[]),m(this,"scripts_lateUpdate",[]),m(this,"scripts_onBeforeRender",[]),m(this,"scripts_onAfterRender",[]),m(this,"scripts_WithCorroutines",[]),m(this,"scripts_immersive_vr",[]),m(this,"scripts_immersive_ar",[]),m(this,"coroutines",{}),m(this,"post_setup_callbacks",[]),m(this,"pre_update_callbacks",[]),m(this,"pre_render_callbacks",[]),m(this,"post_render_callbacks",[]),m(this,"pre_update_oneshot_callbacks",[]),m(this,"new_scripts",[]),m(this,"new_script_start",[]),m(this,"new_scripts_pre_setup_callbacks",[]),m(this,"new_scripts_post_setup_callbacks",[]),m(this,"new_scripts_xr",[]),m(this,"mainCameraComponent"),m(this,"_mainCamera",null),m(this,"_fallbackCamera",null),m(this,"application"),m(this,"animations"),m(this,"time"),m(this,"input"),m(this,"physics"),m(this,"connection"),m(this,"assets"),m(this,"mainLight",null),m(this,"sceneLighting"),m(this,"addressables"),m(this,"lightmaps"),m(this,"players"),m(this,"lodsManager"),m(this,"menu"),m(this,"_sizeChanged",!1),m(this,"_isCreated",!1),m(this,"_isCreating",!1),m(this,"_isVisible",!1),m(this,"_stats",AGe?new pTe:null),m(this,"_intersectionObserver",null),m(this,"_disposeCallbacks",[]),m(this,"maxRenderResolution"),m(this,"_originalCreationArgs"),m(this,"onUnhandledRejection",s=>{this.onError(s.reason)}),m(this,"_cameraStack",[]),m(this,"_onBeforeRenderListeners",new Map),m(this,"_onAfterRenderListeners",new Map),m(this,"_requireDepthTexture",!1),m(this,"_requireColorTexture",!1),m(this,"_renderTarget"),m(this,"_isRendering",!1),m(this,"_createId",0),m(this,"_renderlooperrors",0),m(this,"_lastTimestamp",0),m(this,"_accumulatedTime",0),m(this,"_dispatchReadyAfterFrame",!1),m(this,"_wasPaused",!1),this.name=n?.name||"",this.alias=n?.alias,this.domElement=n?.domElement||document.body,this.hash=n?.hash,n!=null&&n.renderer&&(this.renderer=n.renderer,this.isManagedExternally=!0),n?.runInBackground!==void 0&&(this.runInBackground=n.runInBackground),n!=null&&n.scene?this.scene=n.scene:this.scene=new ir,n!=null&&n.camera&&(this._mainCamera=n.camera),this.application=new op(this),this.time=new Hie,this.input=new p$(this),this.physics=new a2(this),this.connection=new Uee(this),this.assets=new ute,this.sceneLighting=new Oie(this),this.addressables=new yie(this),this.lightmaps=new nGe(this),this.players=new zie(this),this.menu=new fGe(this),this.lodsManager=new sGe(this),this.animations=new Gke(this);const e=()=>this._sizeChanged=!0;window.addEventListener("resize",e),this._disposeCallbacks.push(()=>window.removeEventListener("resize",e));const i=new ResizeObserver(s=>this._sizeChanged=!0);i.observe(this.domElement),this._disposeCallbacks.push(()=>i.disconnect()),this._intersectionObserver=new IntersectionObserver(s=>{this._isVisible=s[0].isIntersecting}),this._disposeCallbacks.push(()=>{var s;return(s=this._intersectionObserver)==null?void 0:s.disconnect()}),ji.register(this)}static get DefaultTargetFrameRate(){return Jn._defaultTargetFramerate.value}static set DefaultTargetFrameRate(n){Jn._defaultTargetFramerate.value=n}static get DefaultWebGLRendererParameters(){return Jn._defaultWebglRendererParameters}get version(){return xh}static get Current(){return ji.Current}static set Current(n){ji.Current=n}appendHTMLElement(n){return this.domElement.shadowRoot?this.domElement.shadowRoot.appendChild(n):this.domElement.appendChild(n)}get resolutionScaleFactor(){return this._resolutionScaleFactor}set resolutionScaleFactor(n){if(n!==this._resolutionScaleFactor&&typeof n=="number"){if(n<=0){console.error("Invalid resolution scale factor",n);return}this._resolutionScaleFactor=n,this.updateSize()}}calculateBoundingClientRect(){if(this.xr){this._domX=0,this._domY=0;return}this._boundingClientRectFrame!==this.time.frame&&(this._boundingClientRectFrame=this.time.frame,this._boundingClientRect=this.domElement.getBoundingClientRect(),this._domX=this._boundingClientRect.x,this._domY=this._boundingClientRect.y)}get domWidth(){return this.isInAR?window.innerWidth:this.domElement.clientWidth}get domHeight(){return this.isInAR?window.innerHeight:this.domElement.clientHeight}get domX(){return this.calculateBoundingClientRect(),this._domX}get domY(){return this.calculateBoundingClientRect(),this._domY}get isInXR(){var n,e;return((e=(n=this.renderer)==null?void 0:n.xr)==null?void 0:e.isPresenting)||!1}get xrSessionMode(){var n;return(n=this.xr)==null?void 0:n.mode}get isInVR(){return this.xrSessionMode==="immersive-vr"}get isInAR(){return this.xrSessionMode==="immersive-ar"}get isInPassThrough(){return this.xr?this.xr.isPassThrough:!1}get xrSession(){var n,e;return(e=(n=this.renderer)==null?void 0:n.xr)==null?void 0:e.getSession()}get xrFrame(){return this._xrFrame}get xrCamera(){var n,e;return this.renderer.xr.isPresenting?(e=(n=this.renderer)==null?void 0:n.xr)==null?void 0:e.getCamera():void 0}get arOverlayElement(){const n=this.domElement;return typeof n.getAROverlayContainer=="function"?n.getAROverlayContainer():this.domElement}get currentFrameEvent(){return this._currentFrameEvent}get mainCamera(){if(this._mainCamera)return this._mainCamera;if(this.mainCameraComponent){const n=this.mainCameraComponent;return n.threeCamera||n.buildCamera(),n.threeCamera}return this._fallbackCamera||(this._fallbackCamera=new Ot(75,this.domWidth/this.domHeight,.1,1e3)),this._fallbackCamera}set mainCamera(n){this._mainCamera=n}get rendererData(){return this.sceneLighting}get isCreated(){return this._isCreated}createNewRenderer(n){var e,i,s;if((e=this.renderer)==null||e.dispose(),n={...Jn.DefaultWebGLRendererParameters,...n},!n.canvas){const r=(s=(i=this.domElement)==null?void 0:i.shadowRoot)==null?void 0:s.querySelector("canvas");r&&(n.canvas=r,Mr&&console.log("Using canvas from shadow root",r))}Mr&&console.log("Using Renderer Parameters:",n,this.domElement),this.renderer=new om(n),this.renderer.debug.checkShaderErrors=Je()||q("checkshadererrors")===!0,this.renderer.toneMappingExposure=1,this.renderer.toneMapping=kr,this.renderer.setClearColor(new fe("lightgrey"),0),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=nG,this.renderer.setSize(this.domWidth,this.domHeight),this.renderer.outputColorSpace=ut,this.renderer.nodes={library:new n6,modelViewMatrix:null,modelNormalViewMatrix:null},this.lodsManager.setRenderer(this.renderer),this.input.bindEvents()}internalOnUpdateVisible(){var n,e;(n=this._intersectionObserver)==null||n.disconnect(),(e=this._intersectionObserver)==null||e.observe(this.domElement)}requestSizeUpdate(){this._sizeChanged=!0}updateSize(n=!1){var e,i,s;if(n||!this.isManagedExternally&&((e=this.renderer.xr)==null?void 0:e.isPresenting)===!1){this._sizeChanged=!1;const r=this.resolutionScaleFactor;let o=this.domWidth*r,a=this.domHeight*r;this.maxRenderResolution&&(this.maxRenderResolution.x=Math.max(1,this.maxRenderResolution.x),o=Math.min(this.maxRenderResolution.x,o),this.maxRenderResolution.y=Math.max(1,this.maxRenderResolution.y),a=Math.min(this.maxRenderResolution.y,a));const l=this.mainCamera;this.updateAspect(l),this.renderer.setSize(o,a,!0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.composer&&((i=this.composer.setSize)==null||i.call(this.composer,o,a),"setPixelRatio"in this.composer&&typeof this.composer.setPixelRatio=="function"&&((s=this.composer.setPixelRatio)==null||s.call(this.composer,window.devicePixelRatio)))}}updateAspect(n,e,i){if(!n)return;e===void 0&&(e=this.domWidth),i===void 0&&(i=this.domHeight);const s=n.aspect;n.aspect=e/i,s!==n.aspect&&n.updateProjectionMatrix()}recreate(){this.clear(),this.create(this._originalCreationArgs)}async onCreate(n){return this.create(n)}async create(n){try{this._isCreating=!0,n!==this._originalCreationArgs&&(this._originalCreationArgs=gw(n)),window.addEventListener("unhandledrejection",this.onUnhandledRejection);const e=await this.internalOnCreate(n);return this._isCreated=e,e}finally{window.removeEventListener("unhandledrejection",this.onUnhandledRejection),this._isCreating=!1}}onError(n){this.domElement.dispatchEvent(new CustomEvent("error",{detail:n}))}clear(){var n,e,i,s;ji.dispatchCallback(nn.ContextClearing,this),Id(this,nn.ContextClearing),Ol(this.scene,!0,!0),this.scene=new ir,(n=this.addressables)==null||n.dispose(),(e=this.lightmaps)==null||e.clear(),(s=(i=this.physics)==null?void 0:i.engine)==null||s.clearCaches(),this.lodsManager.disable(),this.isManagedExternally||this.renderer&&(this.renderer.renderLists.dispose(),this.renderer.state.reset(),this.renderer.resetState()),ji.dispatchCallback(nn.ContextCleared,this)}dispose(){this.internalOnDestroy()}onDestroy(){this.internalOnDestroy()}internalOnDestroy(){var n,e;Jn.Current=this,ji.dispatchCallback(nn.ContextDestroying,this),Id(this,nn.ContextDestroying),this.clear(),(n=this.renderer)==null||n.setAnimationLoop(null),this.renderer&&(this.renderer.setClearAlpha(0),this.renderer.clear(),this.isManagedExternally||(Mr&&console.log("Disposing renderer"),this.renderer.dispose())),this.scene=null,this.renderer=null,this.input.dispose(),this.menu.onDestroy(),this.animations.onDestroy();for(const i of this._disposeCallbacks)try{i()}catch(s){console.error("Error in on dispose callback:",s,i)}(e=this.domElement)!=null&&e.parentElement&&this.domElement.parentElement.removeChild(this.domElement),this._isCreated=!1,ji.dispatchCallback(nn.ContextDestroyed,this),Id(this,nn.ContextDestroyed),ji.unregister(this),Jn.Current===this&&(Jn.Current=null)}registerCoroutineUpdate(n,e,i){return typeof e?.next!="function"?(console.error("Registered invalid coroutine function from "+n.name+`
Coroutine functions must be generators: "*myCoroutine() {...}"
Start a coroutine from a component by calling "this.startCoroutine(myCoroutine())"`),e):(this.coroutines[i]||(this.coroutines[i]=[]),this.coroutines[i].push({comp:n,main:e}),e)}unregisterCoroutineUpdate(n,e){if(!this.coroutines[e])return;const i=this.coroutines[e].findIndex(s=>s.main===n);i>=0&&this.coroutines[e].splice(i,1)}stopAllCoroutinesFrom(n){for(const e in this.coroutines){const i=this.coroutines[e];for(let s=i.length-1;s>=0;s--)i[s].comp===n&&i.splice(s,1)}}setCurrentCamera(n){var e;if(!n)return;if(n.threeCamera||n.buildCamera(),!n.threeCamera){console.warn("Camera component is missing camera",n);return}const i=this._cameraStack.indexOf(n);i>=0&&this._cameraStack.splice(i,1),this._cameraStack.push(n),this.mainCameraComponent=n;const s=n.threeCamera;s.isPerspectiveCamera&&this.updateAspect(s),(e=this.mainCameraComponent)==null||e.applyClearFlagsIfIsActiveCamera()}removeCamera(n){if(!n)return;const e=this._cameraStack.indexOf(n);if(e>=0&&this._cameraStack.splice(e,1),this.mainCameraComponent===n&&(this.mainCameraComponent=void 0,this._cameraStack.length>0)){const i=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(i)}}addBeforeRenderListener(n,e){this._onBeforeRenderListeners.has(n.uuid)||(this._onBeforeRenderListeners.set(n.uuid,[]),n.onBeforeRender=this._createRenderCallbackWrapper(n,this._onBeforeRenderListeners)),this._onBeforeRenderListeners.get(n.uuid).push(e)}removeBeforeRenderListener(n,e){if(this._onBeforeRenderListeners.has(n.uuid)){const i=this._onBeforeRenderListeners.get(n.uuid),s=i.indexOf(e);s>=0&&i.splice(s,1)}}addAfterRenderListener(n,e){var i;this._onAfterRenderListeners.has(n.uuid)||(this._onAfterRenderListeners.set(n.uuid,[]),n.onAfterRender=this._createRenderCallbackWrapper(n,this._onAfterRenderListeners)),(i=this._onAfterRenderListeners.get(n.uuid))==null||i.push(e)}removeAfterRenderListener(n,e){if(this._onAfterRenderListeners.has(n.uuid)){const i=this._onAfterRenderListeners.get(n.uuid),s=i.indexOf(e);s>=0&&i.splice(s,1)}}_createRenderCallbackWrapper(n,e){return(i,s,r,o,a,l)=>{const c=e.get(n.uuid);if(c)for(let h=0;h<c.length;h++){const d=c[h];d(i,s,r,o,a,l)}}}get isRendering(){return this._isRendering}setRequireDepth(n){this._requireDepthTexture=n}setRequireColor(n){this._requireColorTexture=n}get depthTexture(){var n;return((n=this._renderTarget)==null?void 0:n.depthTexture)||null}get opaqueColorTexture(){var n;return((n=this._renderTarget)==null?void 0:n.texture)||null}get isVisibleToUser(){if(this.isInXR)return!0;if(!this._isVisible)return!1;const n=getComputedStyle(this.domElement);return n.visibility!=="hidden"&&n.display!=="none"&&n.opacity!=="0"}async internalOnCreate(n){var e,i,s,r,o,a,l,c;const h=++this._createId;Mr&&console.log("Creating context",this.name,n);const d=globalThis["needle:dependencies:ready"];d instanceof Promise&&(Mr&&console.log("Waiting for dependencies to be ready"),await d.catch(f=>{if(Mr||Je()){if(Mw("Needle Engine dependencies failed to load. Please check the console for more details"),f instanceof ReferenceError){let A="YourComponentName";const y=f.message.indexOf("'");if(y>0){const b=f.message.indexOf("'",y+1);if(b>0){const v=f.message.substring(y+1,b);v.length>3&&(A=v)}}console.error(`Needle Engine dependencies failed to load:

# Make sure you don't have circular imports in your scripts!
\u2192 Possible solution: Replace @serializable(${A}) in your script with @serializable(Behaviour)

---`,f);return}console.error("Needle Engine dependencies failed to load",f)}}).then(()=>{Mr&&console.log("Needle Engine dependencies are ready")})),this.clear(),this.isManagedExternally===!1&&(this.createNewRenderer(),(e=this.renderer)==null||e.setAnimationLoop(null)),await Ah(1),Jn.Current=this,await ji.dispatchCallback(nn.ContextCreationStart,this);let u=!0,p;try{Jn.Current=this,n?p=await this.internalLoadInitialContent(h,n):p=[]}catch(f){console.error(f),u=!1}if(!u)return this.onError("Failed to load initial content"),!1;if(h!==this._createId||(i=n?.abortSignal)!=null&&i.aborted)return!1;if(this.internalOnUpdateVisible(),!this.renderer)return Mr&&console.warn("Context has no renderer (perhaps it was disconnected?",this.domElement.isConnected),!1;!this.isManagedExternally&&!this.domElement.shadowRoot&&this.domElement.prepend(this.renderer.domElement),Jn.Current=this,Jn.Current=this;for(let f=0;f<this.new_scripts.length;f++){const A=this.new_scripts[f];if(A.gameObject!==void 0&&A.gameObject!==null){A.gameObject.userData===void 0&&(A.gameObject.userData={}),A.gameObject.userData.components===void 0&&(A.gameObject.userData.components=[]);const y=A.gameObject.userData.components;y.includes(A)||y.push(A)}}if(this.post_setup_callbacks)for(let f=0;f<this.post_setup_callbacks.length;f++)Jn.Current=this,await this.post_setup_callbacks[f](this);if(!this._mainCamera){Jn.Current=this;let f=null;P0(this.scene,A=>{const y=A;if(y!=null&&y.isCamera){if(CC(y.gameObject),!y.activeAndEnabled)return;if(y.tag==="MainCamera")return f=y,!0;f=y}}),f?this.setCurrentCamera(f):!ji.dispatchCallback(nn.MissingCamera,this,{files:p})&&!this.mainCamera&&!this.isManagedExternally&&console.warn("Missing camera in main scene",this)}if(this.input.bindEvents(),Jn.Current=this,p2(this),this.physics.engine&&((s=this.physics.engine)==null||s.step(0),(r=this.physics.engine)==null||r.postStep()),!this.isManagedExternally&&this.composer&&this.mainCamera){const f=new tR(this.scene,this.mainCamera);this.renderer.setSize(this.domWidth,this.domHeight),this.composer.addPass(f),this.composer.setSize(this.domWidth,this.domHeight)}this._sizeChanged=!0,this._stats&&(this._stats.showPanel(0),this._stats.dom.style.position="absolute",(o=this.domElement.shadowRoot)==null||o.appendChild(this._stats.dom)),Mr&&jE(this.scene,!0),this.targetFrameRate===void 0?(Mr&&console.warn("No target framerate set, using default",Jn.DefaultTargetFrameRate),this.targetFrameRate=Jn._defaultTargetFramerate):Mr&&console.log("Target framerate set to",this.targetFrameRate),this._dispatchReadyAfterFrame=!0;const g=ji.dispatchCallback(nn.ContextCreated,this,{files:p});return g&&("internalSetLoadingMessage"in this.domElement&&typeof this.domElement.internalSetLoadingMessage=="function"&&((a=this.domElement)==null||a.internalSetLoadingMessage("finish loading")),await g),(l=n?.abortSignal)!=null&&l.aborted?!1:(Id(this,nn.ContextCreated),Mr&&console.log("Context Created...",this.renderer,this.renderer.domElement),this._isCreating=!1,!this.isManagedExternally&&!((c=n?.abortSignal)!=null&&c.aborted)&&this.restartRenderLoop(),!0)}async internalLoadInitialContent(n,e){var i,s,r,o;const a=new Array;if(e.files.length===0)return a;const l=[...e.files],c={name:"",progress:null,index:0,count:l.length},h=fh(),d=0;for(let u=0;u<l.length;u++){if((i=e.abortSignal)!=null&&i.aborted){Mr&&console.log("Aborting loading because of abort signal");break}if(n!==this._createId){Mr&&console.log("Aborting loading because create id changed",n,this._createId);break}const p=l[u];(s=e?.onLoadingStart)==null||s.call(this,u,p),Mr&&console.log("Context Load "+p);const g=await h.loadSync(this,p,p,d,f=>{var A,y;(A=e.abortSignal)!=null&&A.aborted||(c.name=p,c.progress=f,c.index=u,c.count=l.length,(y=e.onLoadingProgress)==null||y.call(this,c))});(r=e?.onLoadingFinished)==null||r.call(this,u,p,g??null),g?a.push({src:p,file:g}):console.warn("Could not load file: "+p)}if(n!==this._createId||(o=e.abortSignal)!=null&&o.aborted){for(const u of a)if(u&&u.file)for(const p of u.file.scenes)Ol(p,!0,!0)}else{let u=!1;for(const p of a)p&&p.file&&(p.file.scene?(u=!0,this.scene.add(p.file.scene)):console.warn("No scene found in loaded file"));if(!u){for(const p of a)if(p&&p.file&&"parser"in p.file){let g=0;if(!Array.isArray(p.file.parser.json.materials))continue;for(let f=0;f<p.file.parser.json.materials.length;f++){const A=await p.file.parser.getDependency("material",f),y=new Ae;y.position.x=f*1.1,y.position.y=g,this.scene.add(y),Ym.createPrimitive("ShaderBall",{parent:y,material:A})}g+=1}}}return a}restartRenderLoop(){return this.renderer?this._isCreating?(console.warn("Can not start render loop while creating context"),!1):(this.renderer.setAnimationLoop((n,e)=>{this.isManagedExternally||this.update(n,e)}),!0):(console.error("Can not start render loop without renderer"),!1)}update(n,e){if(e===void 0&&(e=null),Je()||Mr||LBe())try{performance.mark("update.start"),this.internalStep(n,e),this._renderlooperrors=0,performance.mark("update.end"),performance.measure("NE Frame","update.start","update.end")}catch(i){this._renderlooperrors+=1,(Je()||Mr)&&(i instanceof Error||i instanceof TypeError)&&ss("Caught unhandled exception during render-loop - see console for details.",Rl.Error),console.error("Frame #"+this.time.frame+`
`,i),this._renderlooperrors>=3&&(console.warn("Stopping render loop due to error"),this.renderer.setAnimationLoop(null)),this.domElement.dispatchEvent(new CustomEvent("error",{detail:i}))}else this.internalStep(n,e)}updatePhysics(n){this.internalUpdatePhysics(n)}internalStep(n,e){this.internalOnBeforeRender(n,e)!==!1&&(this.internalOnRender(),this.internalOnAfterRender())}internalOnBeforeRender(n,e){var i;this.renderer.info.autoReset=!0;const s=e!==null&&this._xrFrame===null;if(this._xrFrame=e,s&&this.domElement.dispatchEvent(new CustomEvent("xr-session-started",{detail:{context:this,session:this.xrSession,frame:e}})),this._currentFrameEvent=-1,this.isManagedExternally===!1&&this.isInXR===!1&&this.targetFrameRate!==void 0){this._lastTimestamp===0&&(this._lastTimestamp=n),this._accumulatedTime+=(n-this._lastTimestamp)/1e3,this._lastTimestamp=n;let r=this.targetFrameRate;if(typeof r=="object"&&(r=r.value),this._accumulatedTime<1/(r+1))return!1;this._accumulatedTime=0}if((i=this._stats)==null||i.begin(),Jn.Current=this,this.onHandlePaused())return!1;for(Jn.Current=this,this.time.update(),bGe&&console.log("FPS",this.time.smoothedFps.toFixed(0)),p2(this),m2(this.scene),xte(this),Id(this,-1);this._cameraStack.length>0&&(!this.mainCameraComponent||this.mainCameraComponent.destroyed);){this._cameraStack.splice(this._cameraStack.length-1,1);const r=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(r)}if(this.pre_update_oneshot_callbacks){for(const r in this.pre_update_oneshot_callbacks)this.pre_update_oneshot_callbacks[r]();this.pre_update_oneshot_callbacks.length=0}if(this.pre_update_callbacks)for(const r in this.pre_update_callbacks)this.pre_update_callbacks[r]();this._currentFrameEvent=0;for(let r=0;r<this.scripts_earlyUpdate.length;r++){const o=this.scripts_earlyUpdate[r];o.activeAndEnabled&&o.earlyUpdate!==void 0&&(Jn.Current=this,o.earlyUpdate())}if(this.executeCoroutines(0),Id(this,0),this.onHandlePaused())return!1;this._currentFrameEvent=1;for(let r=0;r<this.scripts_update.length;r++){const o=this.scripts_update[r];o.activeAndEnabled&&o.update!==void 0&&(Jn.Current=this,o.update())}if(this.executeCoroutines(1),Id(this,1),this.onHandlePaused())return!1;this._currentFrameEvent=2;for(let r=0;r<this.scripts_lateUpdate.length;r++){const o=this.scripts_lateUpdate[r];o.activeAndEnabled&&o.lateUpdate!==void 0&&(Jn.Current=this,o.lateUpdate())}if(this.executeCoroutines(2),Id(this,2),this.onHandlePaused()||(this.physicsSteps===void 0&&(this.physicsSteps=1),this.physics.engine&&this.physicsSteps>0&&this.internalUpdatePhysics(this.physicsSteps),this.onHandlePaused()))return!1;if(this.isVisibleToUser||this.runInBackground){this._currentFrameEvent=3;for(let r=0;r<this.scripts_onBeforeRender.length;r++){const o=this.scripts_onBeforeRender[r];o.activeAndEnabled&&o.onBeforeRender!==void 0&&(Jn.Current=this,o.onBeforeRender(e))}if(this.executeCoroutines(3),Id(this,3),this._sizeChanged&&this.updateSize(),this.pre_render_callbacks)for(const r in this.pre_render_callbacks)this.pre_render_callbacks[r](e)}return!0}internalUpdatePhysics(n){if(!this.physics.engine)return!1;const e=n,i=this.time.deltaTime/e;for(let s=0;s<e;s++)this._currentFrameEvent=9,this.executeCoroutines(9),this.physics.engine.step(i),this._currentFrameEvent=10,this.executeCoroutines(10);return this.physics.engine.postStep(),!0}internalOnRender(){this.isManagedExternally||(PBe(this),this._currentFrameEvent=-1,f7.update(),this.renderNow(),this._currentFrameEvent=4)}internalOnAfterRender(){if(this.isVisibleToUser||this.runInBackground){for(let n=0;n<this.scripts_onAfterRender.length;n++){const e=this.scripts_onAfterRender[n];e.activeAndEnabled&&e.onAfterRender!==void 0&&(Jn.Current=this,e.onAfterRender())}if(this.executeCoroutines(4),Id(this,4),this.post_render_callbacks)for(const n in this.post_render_callbacks)this.post_render_callbacks[n]()}this._currentFrameEvent=-1,this.connection.sendBufferedMessagesNow(),this._stats&&(this._stats.end(),this.time.frameCount%150===0&&console.log(this.renderer.info.render.calls+" DrawCalls",`
Render:`,{...this.renderer.info.render},`
Memory:`,{...this.renderer.info.memory},`
Target Framerate: `+this.targetFrameRate)),this._dispatchReadyAfterFrame&&(this._dispatchReadyAfterFrame=!1,this.domElement.dispatchEvent(new CustomEvent("ready")),ji.dispatchCallback(nn.ContextFirstFrameRendered,this))}renderNow(n){var e;return!n&&(n=this.mainCamera,!n)?!1:(this.handleRendererContextLost(),this._isRendering=!0,this.renderRequiredTextures(),this.renderer.toneMapping!==kr&&Kie(),this.composer&&!this.isInXR?(n&&((e=this.composer.passes[0])==null?void 0:e.mainCamera)!=n&&this.composer.setMainCamera(n),this.composer.render(this.time.deltaTime)):n&&(this.isInXR&&Ft.isMacOS()&&this.renderer.clearDepth(),this.renderer.render(this.scene,n)),this._isRendering=!1,!0)}handleRendererContextLost(){this.renderer.getContext().isContextLost()&&(console.warn("Attempting to recover WebGL context..."),this.renderer.forceContextRestore())}onHandlePaused(){const n=this.evaluatePaused();if(this._wasPaused!==n){yGe&&console.log("Paused?",n,"context:"+this.alias);for(let e=0;e<this.scripts_pausedChanged.length;e++){const i=this.scripts_pausedChanged[e];i.activeAndEnabled&&i.onPausedChanged!==void 0&&(Jn.Current=this,i.onPausedChanged(n,this._wasPaused))}}return this._wasPaused=n,n}evaluatePaused(){return this.isInXR?!1:this.isPaused?!0:this.runInBackground?!1:!this.isVisibleToUser}renderRequiredTextures(){if(!this.mainCamera||!this._requireDepthTexture&&!this._requireColorTexture)return;if(!this._renderTarget){if(this._renderTarget=new fi(this.domWidth,this.domHeight),this._requireDepthTexture){const i=new Eu(this.domWidth,this.domHeight);this._renderTarget.depthTexture=i}this._requireColorTexture&&(this._renderTarget.texture=new di,this._renderTarget.texture.generateMipmaps=!1,this._renderTarget.texture.minFilter=si,this._renderTarget.texture.magFilter=si,this._renderTarget.texture.format=_i)}const n=this._renderTarget;n.texture&&(n.texture.colorSpace=this.renderer.outputColorSpace);const e=this.renderer.getRenderTarget();this.renderer.setRenderTarget(n),this.renderer.render(this.scene,this.mainCamera),this.renderer.setRenderTarget(e)}executeCoroutines(n){var e;if(this.coroutines[n]){const s=this.coroutines[n];for(let r=0;r<s.length;r++)try{const o=s[r];if(!o.comp||o.comp.destroyed||!o.main||o.comp.enabled===!1){vGe&&console.log("Removing coroutine",o.comp,o.comp.enabled),s.splice(r,1),--r;continue}const a=o.chained;if(a&&a.length>0){const h=a[a.length-1].next();if(h.done&&a.pop(),i(h)&&(o.chained||(o.chained=[]),o.chained.push(h.value)),!h.done)continue}const l=o.main.next();if(l.done===!0){s.splice(r,1),--r;continue}const c=l.value;if(i(c)){if(c.next().done)continue;o.chained||(o.chained=[]),o.chained.push(c)}else if(c instanceof Promise){const h=c;o.chained||(o.chained=[]);const d=Cie(h);(e=o.chained)==null||e.push(d);continue}}catch(o){console.error(o)}}function i(s){return!!(s&&s.next&&s.return)}}};let $t=Jn;m($t,"_defaultTargetFramerate",{value:90,toString(){return this.value}}),m($t,"_defaultWebglRendererParameters",{antialias:!0,alpha:!1,powerPreference:Ft.isiOS()||Ft.isMacOS()?"default":"high-performance",stencil:!0});const Vc=q("debuglicense");let X0="basic";Vc&&console.log("License Type: "+X0);function ng(){switch(X0){case"pro":case"enterprise":return!0}return!1}function RF(){switch(X0){case"indie":return!0}return!1}function Vh(){return ng()||RF()}const ine=[];function CGe(n){if(ng()||RF())return n(!0);ine.push(n)}function SGe(n){for(const e of ine)try{e(n)}catch{}}ji.registerCallback(nn.ContextRegistered,n=>{IGe(n.context),EGe(),MGe(n.context)});let D0,LF=!1,$2="";async function _Ge(){if(D0)return D0;if(X0==="basic")try{const n="https://engine.needle.tools/licensing/check?location="+encodeURIComponent(window.location.href)+"&version="+xh+"&generator="+encodeURIComponent(qE),e=await fetch(n,{method:"GET"}).catch(i=>{Vc&&console.error("License check failed",i)});e?.status===200?(LF=!1,Vc&&console.log("License check succeeded"),X0="pro",SGe(!0)):e?.status===403?(LF=!0,$2=await e.text()):Vc&&console.log("License check failed with status "+e?.status)}catch(n){Vc&&console.error("License check failed",n)}else Vc&&console.log('Runtime license check is skipped because license is already applied as "'+X0+'"')}D0=_Ge();async function MGe(n){function e(){const r=document.createElement("div");r.className="needle-forbidden",r.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: all;
        zIndex: 2147483647;
        line-height: 1.5;
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        `;const o=r.style.cssText,a=document.createElement("div");r.appendChild(a),a.style.cssText=`
        position: absolute;
        left: 0;
        right: 0;
        top:0;
        bottom: 0;
        padding: 10%;
        color: white;
        font-size: 20px;
        font-family: sans-serif;
        text-align: center;
        pointer-events: all;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: rgba(0,0,0,.3);
        text-shadow: 0 0 2px black;
        `;const l=a.style.cssText,c=$2?.length>1?$2:"This web application has been paused.<br/>You might be in violation of the Needle Engine terms of use.<br/>Please contact the Needle support if you think this is a mistake.";return a.innerHTML=c,setInterval(()=>{a.innerHTML!==c&&(a.innerHTML=c),a.parentNode!==r&&r.appendChild(a),r.style.cssText!==o&&(r.style.cssText=o),a.style.cssText!==l&&(a.style.cssText=l)},500),r}let i=e();const s=i.style.cssText;setInterval(()=>{var r;LF===!0&&(i.style.cssText!==s&&(i=e()),n.domElement.shadowRoot?i.parentNode!==n.domElement.shadowRoot&&((r=n.domElement.shadowRoot)==null||r.appendChild(i)):i.parentNode!=document.body&&document.body.appendChild(i))},500)}async function IGe(n){try{if(Vh()!==!0)return BF(n)}catch(e){return Vc&&console.log("License check failed",e),BF(n)}Vc&&BF(n)}async function BF(n){n.domElement.addEventListener("ready",()=>!0),await D0?.catch(()=>{}),!Vh()&&TGe()}let nne=0;async function TGe(n){var e;const i=Date.now();if(i-nne<2e3)return;nne=i;const s=`
        position: relative;
        display: block;
        font-size: 18px;
        background-size: 20px;
        background-position: 10px 5px;
        background-repeat:no-repeat;
        background-image:url('data:image/webp;base64,UklGRrABAABXRUJQVlA4WAoAAAAQAAAAHwAAHwAAQUxQSKEAAAARN6CmbSM4WR7vdARON11EBDq3fLiNbVtVzpMCPlKAEzsx0Y/x+Ovuv4dn0EFE/ydAvz6YggXzgh5sVgXM/zOC/4sii7qgGvB5N7hmuQYwkvazWAu1JPW41FXSHq6pnaQWvqYH18Fc0j1hO/BFTtIeSBlJi5w6qIIO7IOrwhFsB2Yxukif0FTRLpXswHR8MxbslKe9VZsn/Ub5C7YFOpqSTABWUDgg6AAAAFAGAJ0BKiAAIAA+7VyoTqmkpCI3+qgBMB2JbACdMt69DwMIQBLhkTO6XwY00UEDK6cNIDnuNibPf0EgAP7Y1myuiQHLDsF/0h5unrGh6WAbv7aegg2ZMd3uRKfT/3SJztcaujYfTvMXspfCTmYcoO6a+vhC3ss4M8uM58t4siiu59I4aOl59e9Sr6xoxYlHf2v+NnBNpJYeJf8jABQAId/PXuBkLEFkiCucgSGEcfhvajql/j3reCGl0M5/9gQWy7ayNPs+wlvIxFnNfSlfuND4CZOCyxOHhRqOmHN4ULHo3tCSrUNvgAA=');
        background-max-size: 40px;
        margin-bottom: 5px;
        margin-top: .3em;
        margin-bottom: .5em;
        padding: .2em;
        padding-left: 25px;
        border-radius: .5em;
        border: 2px solid rgba(160,160,160,.3);
    `,r=`Needle Engine \u2014 No license active, commercial use is not allowed. Visit https://needle.tools/pricing for more information and licensing options! v${xh}`;(e=$t.Current)!=null&&e.xr?console.log(r):console.log("%c "+r,s)}async function EGe(){var n;if(!window.crossOriginIsolated)try{const e="https://needle-engine-analytics-v2-r26roub2hq-lz.a.run.app";if(e){Vc&&console.log("Analytics backend url",e);const i=window.location.href.split("?")[0];let s="api/v2/new/request";e.endsWith("/")||(s="/"+s);const r=X0,o=`${e}${s}`;Vc&&console.log("Sending non-commercial usage message to analytics backend",o);const a={license:r,url:i,hostname:window.location.hostname,pathname:window.location.pathname,version:xh,generator:qE,build_time:yD,public_key:Ew},l=(n=navigator.sendBeacon)==null?void 0:n.call(navigator,o,JSON.stringify(a));Vc&&console.log("Send beacon result",l)}}catch(e){Vc&&console.log("Failed to send non-commercial usage message to analytics backend",e)}}const z0=q("debugloading"),OC=q("debugloadingrendering"),sne=q("debuglicense");class RGe{constructor(){m(this,"className"),m(this,"additionalClasses")}}let ZC=0,rne;function kF(n){z0&&console.log(n.progress.loaded.toFixed(0)+"/"+n.progress.total.toFixed(0),n);const e=n.count,i=n.progress.total;i===0||i===void 0?(rne!==n.name&&(ZC=0),rne=n.name,ZC+=(1-ZC)*.001,z0&&An("Loading "+n.name+" did not report total size")):ZC=n.progress.loaded/i;const s=n.index/e+ZC/e;return lt.clamp01(s)}const GF=class{constructor(n,e){m(this,"loadingProgress",0),m(this,"_element"),m(this,"_progress",0),m(this,"_allowCustomLoadingElement",!0),m(this,"_loadingElement"),m(this,"_loadingTextContainer",null),m(this,"_loadingBar",null),m(this,"_messageContainer",null),m(this,"_loadingElementOptions"),m(this,"_progressLoop"),this._element=n,this._loadingElementOptions=e}async onLoadingBegin(n){const e=this._element.shadowRoot||this._element;if(z0&&console.warn("Begin Loading"),!this._loadingElement){for(let i=0;i<e.children.length;i++){const s=e.children[i];if(s.classList.contains(GF.LoadingContainerClassName)){if(!this._allowCustomLoadingElement){z0&&console.warn("Remove custom loading container"),e.removeChild(s);continue}this._loadingElement=this.createLoadingElement(s)}}this._loadingElement||(this._loadingElement=this.createLoadingElement())}this._progress=0,this.loadingProgress=0,this._loadingElement.style.display="flex",e.appendChild(this._loadingElement),this.smoothProgressLoop(),this.setMessage(n??"")}onLoadingUpdate(n,e){var i;if(!((i=this._loadingElement)!=null&&i.parentNode))return;let s=0;typeof n=="number"?s=n:("index"in n&&(s=kF(n)),!e&&"name"in n&&this.setMessage("loading "+n.name)),this.loadingProgress=s,e&&this.setMessage(e),this.updateDisplay()}onLoadingFinished(){z0&&console.warn("Finished Loading"),OC||(this.loadingProgress=1,this.onDoneLoading())}setMessage(n){this._messageContainer&&(this._messageContainer.innerText=n)}smoothProgressLoop(){if(this._progressLoop)return;let n=1/12;OC&&(n=1/500,typeof OC=="number"&&(n*=OC)),this._progressLoop=setInterval(()=>{this.loadingProgress>=.95&&!OC&&(n=.9),this._progress=lt.lerp(this._progress,this.loadingProgress,n*this.loadingProgress),this.updateDisplay()},n)}onDoneLoading(){this._loadingElement&&(z0&&console.log("Hiding loading element"),this._loadingElement.style.display="none",this._loadingElement.remove()),this._progressLoop&&clearInterval(this._progressLoop),this._progressLoop=null}updateDisplay(){const n=this._progress,e=(n*100).toFixed(0)+"%";this._loadingBar&&(this._loadingBar.style.width=n*100+"%"),this._loadingTextContainer&&(this._loadingTextContainer.textContent=e)}createLoadingElement(n){var e,i;z0&&!n&&console.log("Creating loading element"),this._loadingElement=n||document.createElement("div");let s=this._element.getAttribute("loading-style");(!s||s==="auto")&&(window.matchMedia("(prefers-color-scheme: dark)").matches?s="dark":s="light");const r=ng();if(!n&&(this._loadingElement.style.position="absolute",this._loadingElement.style.width="100%",this._loadingElement.style.height="100%",this._loadingElement.style.left="0",this._loadingElement.style.top="0",s==="light"?this._loadingElement.style.backgroundColor="#ddd":this._loadingElement.style.backgroundColor="#222",this._loadingElement.style.display="flex",this._loadingElement.style.alignItems="center",this._loadingElement.style.justifyContent="center",this._loadingElement.style.zIndex=Number.MAX_SAFE_INTEGER.toString(),this._loadingElement.style.flexDirection="column",this._loadingElement.style.pointerEvents="none",this._loadingElement.style.color="white",this._loadingElement.style.fontFamily='system-ui, Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',this._loadingElement.style.fontSize="1rem",s==="light"?this._loadingElement.style.color="rgba(0,0,0,.6)":this._loadingElement.style.color="rgba(255,255,255,.3)",r&&this._element)){const f=this._element.getAttribute("loading-background-color");f&&(this._loadingElement.style.backgroundColor=f);const A=this._element.getAttribute("loading-text-color");A&&(this._loadingElement.style.color=A)}const o=((e=this._loadingElementOptions)==null?void 0:e.className)??GF.LoadingContainerClassName;if(this._loadingElement.classList.add(o),(i=this._loadingElementOptions)!=null&&i.additionalClasses)for(const f of this._loadingElementOptions.additionalClasses)this._loadingElement.classList.add(f);const a=document.createElement("div");this._loadingElement.appendChild(a);const l=document.createElement("img"),c=120;if(l.style.width=`${c}px`,l.style.height=`${c}px`,l.style.paddingTop="20px",l.style.paddingBottom="10px",l.style.margin="0px",l.style.userSelect="none",l.style.objectFit="contain",l.style.transition="transform 1.5s ease-out, opacity .3s ease-in-out",l.style.transform="translateY(30px)",l.style.opacity="0.05",setTimeout(()=>{l.style.opacity="1",l.style.transform="translateY(0px)"},1),l.src=uMe,r&&this._element){const f=this._element.getAttribute("loading-logo-src");f&&(l.src=f)}a.appendChild(l);const h=document.createElement("div");h.style.cssText=`
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        opacity: 0;
        transition: opacity 1s ease-in-out 4s;
        `,setTimeout(()=>{h.style.opacity="1"},1),this._loadingElement.appendChild(h);const d=document.createElement("div"),u=100;d.style.display="flex",d.style.width=u+"%",d.style.height="3px",d.style.position="absolute",d.style.left="0",d.style.bottom="0px",d.style.opacity="0",d.style.transition="opacity 1s ease-in-out 2s",setTimeout(()=>{d.style.opacity="1"},1),s==="light"?d.style.backgroundColor="rgba(0,0,0,.2)":d.style.backgroundColor="rgba(255,255,255,.2)",this._loadingElement.appendChild(d),this._loadingBar=document.createElement("div"),d.appendChild(this._loadingBar);const p=function(f){return lt.lerp(0,u,f)+"%"};if(this._loadingBar.style.background=`linear-gradient(90deg, #204f49 ${p(0)}, #0BA398 ${p(.3)}, #66A22F ${p(.6)}, #D7DB0A ${p(1)})`,this._loadingBar.style.backgroundAttachment="fixed",this._loadingBar.style.width="0%",this._loadingBar.style.height="100%",r&&this._element){const f=this._element.getAttribute("primary-color"),A=this._element.getAttribute("secondary-color");f&&A?this._loadingBar.style.background=`linear-gradient(90deg, ${f} ${p(0)}, ${A} ${p(1)})`:f?this._loadingBar.style.background=f:A&&(this._loadingBar.style.background=A)}this._loadingTextContainer=document.createElement("div"),this._loadingTextContainer.style.display="flex",this._loadingTextContainer.style.justifyContent="center",this._loadingTextContainer.style.marginTop=".2rem",h.appendChild(this._loadingTextContainer);const g=document.createElement("div");if(this._messageContainer=g,g.style.display="flex",g.style.fontSize=".8rem",g.style.paddingTop=".1rem",g.style.justifyContent="center",h.appendChild(g),r&&this._element){const f=this._element.getAttribute("loading-text-color");f&&(g.style.color=f)}return this.handleRuntimeLicense(this._loadingElement),this._loadingElement}async handleRuntimeLicense(n){let e=Vh();if(e)return;sne&&console.log("Loading UI has commercial license?",e);const i=document.createElement("div");i.style.paddingTop=".6em",i.style.fontSize=".8em",i.style.textTransform="uppercase",i.innerText=`NEEDLE ENGINE NON COMMERCIAL VERSION
CLICK HERE TO GET A LICENSE`,i.style.cursor="pointer",i.style.userSelect="none",i.style.textAlign="center",i.style.pointerEvents="all",i.addEventListener("click",()=>window.open("https://needle.tools/pricing","_self")),i.style.opacity="0",n.appendChild(i),!Je()&&D0&&(sne&&console.log("Waiting for runtime license check"),await D0,e=Vh()),!e&&(i.style.transition="opacity .5s ease-in-out",i.style.opacity="1")}};let PF=GF;m(PF,"LoadingContainerClassName","loading");const WC=q("debugoverlay"),one="ar",LGe="quit-ar";class BGe{constructor(){m(this,"arContainer",null),m(this,"currentSession",null),m(this,"_createdAROnlyElements",[]),m(this,"_reparentedObjects",[]),m(this,"contentElement",null),m(this,"originalDomOverlayParent",null),m(this,"requestEndAR",()=>{this.onRequestedEndAR()})}get ARContainer(){return this.arContainer}onBegin(e,i,s){var r;if(this.currentSession=s,this.arContainer=i,Ft.isMozillaXR()){const o=e.domElement.children;for(let a=0;a<o?.length;a++){const l=o[a];if(!l||l===this.arContainer)return;this._reparentedObjects.push({el:l,previousParent:l.parentElement}),(r=this.arContainer)==null||r.appendChild(l)}i?(this.originalDomOverlayParent=i.parentNode,this.originalDomOverlayParent&&(console.log("Reparent DOM Overlay to body",i,i.style.display),i.style.display="",i.style.visibility="",document.body.appendChild(i))):console.warn("WebXRViewer: No DOM Overlay found")}this.ensureQuitARButton(this.arContainer)}onEnd(e){var i;for(const s of this._createdAROnlyElements)s.remove&&s.remove();for(const s of this._reparentedObjects){const r=s.el;(i=s.previousParent)==null||i.appendChild(r)}this._reparentedObjects.length=0,Ft.isMozillaXR()&&setTimeout(()=>{var s;const r=e.renderer.domElement;r&&((s=e.domElement.shadowRoot)==null||s.prepend(r));const o=document.querySelectorAll("*");for(var a=0;a<o.length;a++){const l=o[a];l&&l._displayChanged!==void 0&&l._displayWas!==void 0&&(l.style.display=l._displayWas)}},10)}createOverlayContainer(e){if(this.contentElement)return this.contentElement;WC&&console.log("Setup overlay container");const i=e.shadowRoot.querySelector(".content");this.contentElement=i;const s=e.shadowRoot.querySelector(".overlay-content");return s&&i.appendChild(s),WC&&!Ft.isMobileDevice()&&this.ensureQuitARButton(i),i}onRequestedEndAR(){this.currentSession&&(this.currentSession.end(),this.currentSession=null)}ensureQuitARButton(e){const i=document.createElement("slot");i.setAttribute("name","quit-ar"),this.appendElement(i,e),this._createdAROnlyElements.push(i),i.style.pointerEvents="auto";const s=document.querySelector(`.${LGe}`);if(s){s.addEventListener("click",this.requestEndAR),WC&&s.addEventListener("click",()=>console.log("Clicked quit-ar button"));return}i.addEventListener("click",this.requestEndAR),WC&&i.addEventListener("click",()=>console.log("Clicked fallback close button"));const r=document.createElement("div");r.style.cssText=`
            position: fixed;
            top: 0;
            right: 0;
            z-index: 600;
            pointer-events: all;
        `,this.appendElement(r,i);var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.classList.add("quit-ar-button"),o.setAttribute("width","40px"),o.setAttribute("height","40px"),o.style.cssText=`
            background: rgba(255, 255, 255, .4);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,.3);
            outline: 1px solid rgba(255, 255, 255, .6);
            display: flex;
            justify-content: center;
            align-items: center;
        `,r.appendChild(o);var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),a.setAttribute("stroke","#000000"),a.setAttribute("stroke-width","2px"),a.style.cssText=`
            /**filter: drop-shadow(0 0px 1.2px rgba(0,0,0,.7));**/
        `,o.appendChild(a),WC&&console.log("Created fallback close button",o,e)}appendElement(e,i){return i.shadowRoot?i.shadowRoot.appendChild(e):i.appendChild(e)}}const NF=q("debugdecoders");let VF=null;function eL(){if(!VF){const n=XR(null);VF={dracoLoader:n.dracoLoader,ktx2Loader:n.ktx2Loader,meshoptDecoder:n.meshoptDecoder}}return VF}function ane(n){if(n!==void 0&&typeof n=="string"){c2e(n);const e=eL();NF&&console.log("Setting draco decoder path to",n),e.dracoLoader.setDecoderPath(n)}}function lne(n){if(n!==void 0&&typeof n=="string"){const e=eL();NF&&console.log("Setting draco decoder type to",n),e.dracoLoader.setDecoderConfig({type:n})}}function cne(n){if(n!==void 0&&typeof n=="string"){h2e(n);const e=eL();NF&&console.log("Setting ktx2 transcoder path to",n),e.ktx2Loader.setTranscoderPath(n)}}function tL(n,e){const i=eL();return e.renderer?i.ktx2Loader.detectSupport(e.renderer):console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures will probably fail"),t$(n),n.dracoLoader||n.setDRACOLoader(i.dracoLoader),n.ktx2Loader||n.setKTX2Loader(i.ktx2Loader),n.meshoptDecoder||n.setMeshoptDecoder(i.meshoptDecoder),d2e(n,{progressive:!0}),n}function hne(n,e,i){const s=i.length-n-1;if(e>=i[s])return s-1;if(e<=i[n])return n;let r=n,o=s,a=Math.floor((r+o)/2);for(;e<i[a]||e>=i[a+1];)e<i[a]?o=a:r=a,a=Math.floor((r+o)/2);return a}function kGe(n,e,i,s){const r=[],o=[],a=[];r[0]=1;for(let l=1;l<=i;++l){o[l]=e-s[n+1-l],a[l]=s[n+l]-e;let c=0;for(let h=0;h<l;++h){const d=a[h+1],u=o[l-h],p=r[h]/(d+u);r[h]=c+d*p,c=u*p}r[l]=c}return r}function GGe(n,e,i,s){const r=hne(n,s,e),o=kGe(r,s,n,e),a=new $e(0,0,0,0);for(let l=0;l<=n;++l){const c=i[r-n+l],h=o[l],d=c.w*h;a.x+=c.x*d,a.y+=c.y*d,a.z+=c.z*d,a.w+=c.w*h}return a}function PGe(n,e,i,s,r){const o=[];for(let u=0;u<=i;++u)o[u]=0;const a=[];for(let u=0;u<=s;++u)a[u]=o.slice(0);const l=[];for(let u=0;u<=i;++u)l[u]=o.slice(0);l[0][0]=1;const c=o.slice(0),h=o.slice(0);for(let u=1;u<=i;++u){c[u]=e-r[n+1-u],h[u]=r[n+u]-e;let p=0;for(let g=0;g<u;++g){const f=h[g+1],A=c[u-g];l[u][g]=f+A;const y=l[g][u-1]/l[u][g];l[g][u]=p+f*y,p=A*y}l[u][u]=p}for(let u=0;u<=i;++u)a[0][u]=l[u][i];for(let u=0;u<=i;++u){let p=0,g=1;const f=[];for(let A=0;A<=i;++A)f[A]=o.slice(0);f[0][0]=1;for(let A=1;A<=s;++A){let y=0;const b=u-A,v=i-A;u>=A&&(f[g][0]=f[p][0]/l[v+1][b],y=f[g][0]*l[b][v]);const x=b>=-1?1:-b,w=u-1<=v?A-1:i-u;for(let S=x;S<=w;++S)f[g][S]=(f[p][S]-f[p][S-1])/l[v+1][b+S],y+=f[g][S]*l[b+S][v];u<=v&&(f[g][A]=-f[p][A-1]/l[v+1][u],y+=f[g][A]*l[u][v]),a[A][u]=y;const C=p;p=g,g=C}}let d=i;for(let u=1;u<=s;++u){for(let p=0;p<=i;++p)a[u][p]*=d;d*=i-u}return a}function NGe(n,e,i,s,r){const o=r<n?r:n,a=[],l=hne(n,s,e),c=PGe(l,s,n,o,e),h=[];for(let d=0;d<i.length;++d){const u=i[d].clone(),p=u.w;u.x*=p,u.y*=p,u.z*=p,h[d]=u}for(let d=0;d<=o;++d){const u=h[l-n].clone().multiplyScalar(c[d][0]);for(let p=1;p<=n;++p)u.add(h[l-n+p].clone().multiplyScalar(c[d][p]));a[d]=u}for(let d=o+1;d<=r+1;++d)a[d]=new $e(0,0,0);return a}function VGe(n,e){let i=1;for(let r=2;r<=n;++r)i*=r;let s=1;for(let r=2;r<=e;++r)s*=r;for(let r=2;r<=n-e;++r)s*=r;return i/s}function XGe(n){const e=n.length,i=[],s=[];for(let o=0;o<e;++o){const a=n[o];i[o]=new E(a.x,a.y,a.z),s[o]=a.w}const r=[];for(let o=0;o<e;++o){const a=i[o].clone();for(let l=1;l<=o;++l)a.sub(r[o-l].clone().multiplyScalar(VGe(o,l)*s[l]));r[o]=a.divideScalar(s[0])}return r}function DGe(n,e,i,s,r){const o=NGe(n,e,i,s,r);return XGe(o)}class zGe extends bc{constructor(e,i,s,r,o){super(),this.degree=e,this.knots=i,this.controlPoints=[],this.startKnot=r||0,this.endKnot=o||this.knots.length-1;for(let a=0;a<s.length;++a){const l=s[a];this.controlPoints[a]=new $e(l.x,l.y,l.z,l.w)}}getPoint(e,i=new E){const s=i,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),o=GGe(this.degree,this.knots,this.controlPoints,r);return o.w!==1&&o.divideScalar(o.w),s.set(o.x,o.y,o.z)}getTangent(e,i=new E){const s=i,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),o=DGe(this.degree,this.knots,this.controlPoints,r,1);return s.copy(o[1]).normalize(),s}}let Ii,Hs,Ba;class dne extends fs{constructor(e){super(e)}load(e,i,s,r){const o=this,a=o.path===""?cd.extractUrlBase(e):o.path,l=new Rs(this.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(e,function(c){try{i(o.parse(c,a))}catch(h){r?r(h):console.error(h),o.manager.itemError(e)}},s,r)}parse(e,i){if(HGe(e))Ii=new WGe().parse(e);else{const r=fne(e);if(!QGe(r))throw new Error("THREE.FBXLoader: Unknown format.");if(mne(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+mne(r));Ii=new ZGe().parse(r)}const s=new hh(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin);return new FGe(s,this.manager).parse(Ii)}}class FGe{constructor(e,i){this.textureLoader=e,this.manager=i}parse(){Hs=this.parseConnections();const e=this.parseImages(),i=this.parseTextures(e),s=this.parseMaterials(i),r=this.parseDeformers(),o=new UGe().parse(r);return this.parseScene(r,o,s),Ba}parseConnections(){const e=new Map;return"Connections"in Ii&&Ii.Connections.connections.forEach(function(i){const s=i[0],r=i[1],o=i[2];e.has(s)||e.set(s,{parents:[],children:[]});const a={ID:r,relationship:o};e.get(s).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});const l={ID:s,relationship:o};e.get(r).children.push(l)}),e}parseImages(){const e={},i={};if("Video"in Ii.Objects){const s=Ii.Objects.Video;for(const r in s){const o=s[r],a=parseInt(r);if(e[a]=o.RelativeFilename||o.Filename,"Content"in o){const l=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,c=typeof o.Content=="string"&&o.Content!=="";if(l||c){const h=this.parseImage(s[r]);i[o.RelativeFilename||o.Filename]=h}}}}for(const s in e){const r=e[s];i[r]!==void 0?e[s]=i[r]:e[s]=e[s].split("\\").pop()}return e}parseImage(e){const i=e.Content,s=e.RelativeFilename||e.Filename,r=s.slice(s.lastIndexOf(".")+1).toLowerCase();let o;switch(r){case"bmp":o="image/bmp";break;case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"tif":o="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",s),o="image/tga";break;default:console.warn('FBXLoader: Image type "'+r+'" is not supported.');return}if(typeof i=="string")return"data:"+o+";base64,"+i;{const a=new Uint8Array(i);return window.URL.createObjectURL(new Blob([a],{type:o}))}}parseTextures(e){const i=new Map;if("Texture"in Ii.Objects){const s=Ii.Objects.Texture;for(const r in s){const o=this.parseTexture(s[r],e);i.set(parseInt(r),o)}}return i}parseTexture(e,i){const s=this.loadTexture(e,i);s.ID=e.id,s.name=e.attrName;const r=e.WrapModeU,o=e.WrapModeV,a=r!==void 0?r.value:0,l=o!==void 0?o.value:0;if(s.wrapS=a===0?lo:Wo,s.wrapT=l===0?lo:Wo,"Scaling"in e){const c=e.Scaling.value;s.repeat.x=c[0],s.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;s.offset.x=c[0],s.offset.y=c[1]}return s}loadTexture(e,i){const s=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),r=e.FileName.split(".").pop().toLowerCase(),o=s.has(r)?this.manager.getHandler(`.${r}`):this.textureLoader;if(!o)return console.warn(`FBXLoader: ${r.toUpperCase()} loader not found, creating placeholder texture for`,e.RelativeFilename),new di;const a=o.path;a||o.setPath(this.textureLoader.path);const l=Hs.get(e.id).children;let c;l!==void 0&&l.length>0&&i[l[0].ID]!==void 0&&(c=i[l[0].ID],(c.indexOf("blob:")===0||c.indexOf("data:")===0)&&o.setPath(void 0));const h=o.load(c);return o.setPath(a),h}parseMaterials(e){const i=new Map;if("Material"in Ii.Objects){const s=Ii.Objects.Material;for(const r in s){const o=this.parseMaterial(s[r],e);o!==null&&i.set(parseInt(r),o)}}return i}parseMaterial(e,i){const s=e.id,r=e.attrName;let o=e.ShadingModel;if(typeof o=="object"&&(o=o.value),!Hs.has(s))return null;const a=this.parseParameters(e,i,s);let l;switch(o.toLowerCase()){case"phong":l=new cm;break;case"lambert":l=new uT;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),l=new cm;break}return l.setValues(a),l.name=r,l}parseParameters(e,i,s){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=hi.toWorkingColorSpace(new fe().fromArray(e.Diffuse.value),ut):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(r.color=hi.toWorkingColorSpace(new fe().fromArray(e.DiffuseColor.value),ut)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=hi.toWorkingColorSpace(new fe().fromArray(e.Emissive.value),ut):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(r.emissive=hi.toWorkingColorSpace(new fe().fromArray(e.EmissiveColor.value),ut)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=hi.toWorkingColorSpace(new fe().fromArray(e.Specular.value),ut):e.SpecularColor&&e.SpecularColor.type==="Color"&&(r.specular=hi.toWorkingColorSpace(new fe().fromArray(e.SpecularColor.value),ut));const o=this;return Hs.get(s).children.forEach(function(a){const l=a.relationship;switch(l){case"Bump":r.bumpMap=o.getTexture(i,a.ID);break;case"Maya|TEX_ao_map":r.aoMap=o.getTexture(i,a.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=o.getTexture(i,a.ID),r.map!==void 0&&(r.map.colorSpace=ut);break;case"DisplacementColor":r.displacementMap=o.getTexture(i,a.ID);break;case"EmissiveColor":r.emissiveMap=o.getTexture(i,a.ID),r.emissiveMap!==void 0&&(r.emissiveMap.colorSpace=ut);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=o.getTexture(i,a.ID);break;case"ReflectionColor":r.envMap=o.getTexture(i,a.ID),r.envMap!==void 0&&(r.envMap.mapping=ao,r.envMap.colorSpace=ut);break;case"SpecularColor":r.specularMap=o.getTexture(i,a.ID),r.specularMap!==void 0&&(r.specularMap.colorSpace=ut);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=o.getTexture(i,a.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",l);break}}),r}getTexture(e,i){return"LayeredTexture"in Ii.Objects&&i in Ii.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),i=Hs.get(i).children[0].ID),e.get(i)}parseDeformers(){const e={},i={};if("Deformer"in Ii.Objects){const s=Ii.Objects.Deformer;for(const r in s){const o=s[r],a=Hs.get(parseInt(r));if(o.attrType==="Skin"){const l=this.parseSkeleton(a,s);l.ID=r,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=a.parents[0].ID,e[r]=l}else if(o.attrType==="BlendShape"){const l={id:r};l.rawTargets=this.parseMorphTargets(a,s),l.id=r,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),i[r]=l}}}return{skeletons:e,morphTargets:i}}parseSkeleton(e,i){const s=[];return e.children.forEach(function(r){const o=i[r.ID];if(o.attrType!=="Cluster")return;const a={ID:r.ID,indices:[],weights:[],transformLink:new de().fromArray(o.TransformLink.a)};"Indexes"in o&&(a.indices=o.Indexes.a,a.weights=o.Weights.a),s.push(a)}),{rawBones:s,bones:[]}}parseMorphTargets(e,i){const s=[];for(let r=0;r<e.children.length;r++){const o=e.children[r],a=i[o.ID],l={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if(a.attrType!=="BlendShapeChannel")return;l.geoID=Hs.get(parseInt(o.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,s.push(l)}return s}parseScene(e,i,s){Ba=new Es;const r=this.parseModels(e.skeletons,i,s),o=Ii.Objects.Model,a=this;r.forEach(function(c){var h;const d=o[c.ID];a.setLookAtProperties(c,d);const u=(h=Hs.get(c.ID))==null?void 0:h.parents;u?.forEach(function(p){const g=r.get(p.ID);g!==void 0&&g.add(c)}),c.parent===null&&Ba.add(c)}),this.bindSkeleton(e.skeletons,i,r),this.addGlobalSceneSettings(),Ba.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const h=gne(c.userData.transformData);c.applyMatrix4(h),c.updateWorldMatrix()}});const l=new OGe().parse();Ba.children.length===1&&Ba.children[0].isGroup&&(Ba.children[0].animations=l,Ba=Ba.children[0]),Ba.animations=l}parseModels(e,i,s){const r=new Map,o=Ii.Objects.Model;for(const a in o){const l=parseInt(a),c=o[a],h=Hs.get(l);let d=this.buildSkeleton(h,e,l,c.attrName);if(!d){switch(c.attrType){case"Camera":d=this.createCamera(h);break;case"Light":d=this.createLight(h);break;case"Mesh":d=this.createMesh(h,i,s);break;case"NurbsCurve":d=this.createCurve(h,i);break;case"LimbNode":case"Root":d=new Tf;break;case"Null":default:d=new Es;break}d.name=c.attrName?xi.sanitizeNodeName(c.attrName):"",d.userData.originalName=c.attrName,d.ID=l}this.getTransformData(d,c),r.set(l,d)}return r}buildSkeleton(e,i,s,r){let o=null;return e?.parents.forEach(function(a){for(const l in i){const c=i[l];c.rawBones.forEach(function(h,d){if(h.ID===a.ID){const u=o;o=new Tf,o.matrixWorld.copy(h.transformLink),o.name=r?xi.sanitizeNodeName(r):"",o.userData.originalName=r,o.ID=s,c.bones[d]=o,u!==null&&o.add(u)}})}}),o}createCamera(e){let i,s;if(e.children.forEach(function(r){const o=Ii.Objects.NodeAttribute[r.ID];o!==void 0&&(s=o)}),s===void 0)i=new Ae;else{let r=0;s.CameraProjectionType!==void 0&&s.CameraProjectionType.value===1&&(r=1);let o=1;s.NearPlane!==void 0&&(o=s.NearPlane.value/1e3);let a=1e3;s.FarPlane!==void 0&&(a=s.FarPlane.value/1e3);let l=window.innerWidth,c=window.innerHeight;s.AspectWidth!==void 0&&s.AspectHeight!==void 0&&(l=s.AspectWidth.value,c=s.AspectHeight.value);const h=l/c;let d=45;s.FieldOfView!==void 0&&(d=s.FieldOfView.value);const u=s.FocalLength?s.FocalLength.value:null;switch(r){case 0:i=new Ot(d,h,o,a),u!==null&&i.setFocalLength(u);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),i=new Ae;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),i=new Ae;break}}return i}createLight(e){let i,s;if(e.children.forEach(function(r){const o=Ii.Objects.NodeAttribute[r.ID];o!==void 0&&(s=o)}),s===void 0)i=new Ae;else{let r;s.LightType===void 0?r=0:r=s.LightType.value;let o=16777215;s.Color!==void 0&&(o=hi.toWorkingColorSpace(new fe().fromArray(s.Color.value),ut));let a=s.Intensity===void 0?1:s.Intensity.value/100;s.CastLightOnObject!==void 0&&s.CastLightOnObject.value===0&&(a=0);let l=0;s.FarAttenuationEnd!==void 0&&(s.EnableFarAttenuation!==void 0&&s.EnableFarAttenuation.value===0?l=0:l=s.FarAttenuationEnd.value);const c=1;switch(r){case 0:i=new dm(o,a,l,c);break;case 1:i=new um(o,a);break;case 2:let h=Math.PI/3;s.InnerAngle!==void 0&&(h=Di.degToRad(s.InnerAngle.value));let d=0;s.OuterAngle!==void 0&&(d=Di.degToRad(s.OuterAngle.value),d=Math.max(d,1)),i=new Gf(o,a,l,h,d,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+s.LightType.value+", defaulting to a PointLight."),i=new dm(o,a);break}s.CastShadows!==void 0&&s.CastShadows.value===1&&(i.castShadow=!0)}return i}createMesh(e,i,s){let r,o=null,a=null;const l=[];return e.children.forEach(function(c){i.has(c.ID)&&(o=i.get(c.ID)),s.has(c.ID)&&l.push(s.get(c.ID))}),l.length>1?a=l:l.length>0?a=l[0]:(a=new cm({name:fs.DEFAULT_MATERIAL_NAME,color:13421772}),l.push(a)),"color"in o.attributes&&l.forEach(function(c){c.vertexColors=!0}),o.FBX_Deformer?(r=new Ka(o,a),r.normalizeSkinWeights()):r=new pe(o,a),r}createCurve(e,i){const s=e.children.reduce(function(o,a){return i.has(a.ID)&&(o=i.get(a.ID)),o},null),r=new Cn({name:fs.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new is(s,r)}getTransformData(e,i){const s={};"InheritType"in i&&(s.inheritType=parseInt(i.InheritType.value)),"RotationOrder"in i?s.eulerOrder=HC(i.RotationOrder.value):s.eulerOrder=HC(0),"Lcl_Translation"in i&&(s.translation=i.Lcl_Translation.value),"PreRotation"in i&&(s.preRotation=i.PreRotation.value),"Lcl_Rotation"in i&&(s.rotation=i.Lcl_Rotation.value),"PostRotation"in i&&(s.postRotation=i.PostRotation.value),"Lcl_Scaling"in i&&(s.scale=i.Lcl_Scaling.value),"ScalingOffset"in i&&(s.scalingOffset=i.ScalingOffset.value),"ScalingPivot"in i&&(s.scalingPivot=i.ScalingPivot.value),"RotationOffset"in i&&(s.rotationOffset=i.RotationOffset.value),"RotationPivot"in i&&(s.rotationPivot=i.RotationPivot.value),e.userData.transformData=s}setLookAtProperties(e,i){"LookAtProperty"in i&&Hs.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const r=Ii.Objects.Model[s.ID];if("Lcl_Translation"in r){const o=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),Ba.add(e.target)):e.lookAt(new E().fromArray(o))}}})}bindSkeleton(e,i,s){const r=this.parsePoseNodes();for(const o in e){const a=e[o];Hs.get(parseInt(a.ID)).parents.forEach(function(l){if(i.has(l.ID)){const c=l.ID;Hs.get(c).parents.forEach(function(h){s.has(h.ID)&&s.get(h.ID).bind(new l1(a.bones),r[h.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in Ii.Objects){const i=Ii.Objects.Pose;for(const s in i)if(i[s].attrType==="BindPose"&&i[s].NbPoseNodes>0){const r=i[s].PoseNode;Array.isArray(r)?r.forEach(function(o){e[o.Node]=new de().fromArray(o.Matrix.a)}):e[r.Node]=new de().fromArray(r.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in Ii){if("AmbientColor"in Ii.GlobalSettings){const e=Ii.GlobalSettings.AmbientColor.value,i=e[0],s=e[1],r=e[2];if(i!==0||s!==0||r!==0){const o=new fe().setRGB(i,s,r,ut);Ba.add(new S1(o,1))}}"UnitScaleFactor"in Ii.GlobalSettings&&(Ba.userData.unitScaleFactor=Ii.GlobalSettings.UnitScaleFactor.value)}}}class UGe{constructor(){this.negativeMaterialIndices=!1}parse(e){const i=new Map;if("Geometry"in Ii.Objects){const s=Ii.Objects.Geometry;for(const r in s){const o=Hs.get(parseInt(r)),a=this.parseGeometry(o,s[r],e);i.set(parseInt(r),a)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),i}parseGeometry(e,i,s){switch(i.attrType){case"Mesh":return this.parseMeshGeometry(e,i,s);case"NurbsCurve":return this.parseNurbsGeometry(i)}}parseMeshGeometry(e,i,s){const r=s.skeletons,o=[],a=e.parents.map(function(u){return Ii.Objects.Model[u.ID]});if(a.length===0)return;const l=e.children.reduce(function(u,p){return r[p.ID]!==void 0&&(u=r[p.ID]),u},null);e.children.forEach(function(u){s.morphTargets[u.ID]!==void 0&&o.push(s.morphTargets[u.ID])});const c=a[0],h={};"RotationOrder"in c&&(h.eulerOrder=HC(c.RotationOrder.value)),"InheritType"in c&&(h.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(h.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(h.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(h.scale=c.GeometricScaling.value);const d=gne(h);return this.genGeometry(i,l,o,d)}genGeometry(e,i,s,r){const o=new Rt;e.attrName&&(o.name=e.attrName);const a=this.parseGeoNode(e,i),l=this.genBuffers(a),c=new dt(l.vertex,3);if(c.applyMatrix4(r),o.setAttribute("position",c),l.colors.length>0&&o.setAttribute("color",new dt(l.colors,3)),i&&(o.setAttribute("skinIndex",new _I(l.weightsIndices,4)),o.setAttribute("skinWeight",new dt(l.vertexWeights,4)),o.FBX_Deformer=i),l.normal.length>0){const h=new oi().getNormalMatrix(r),d=new dt(l.normal,3);d.applyNormalMatrix(h),o.setAttribute("normal",d)}if(l.uvs.forEach(function(h,d){const u=d===0?"uv":`uv${d}`;o.setAttribute(u,new dt(l.uvs[d],2))}),a.material&&a.material.mappingType!=="AllSame"){let h=l.materialIndex[0],d=0;if(l.materialIndex.forEach(function(u,p){u!==h&&(o.addGroup(d,p-d,h),h=u,d=p)}),o.groups.length>0){const u=o.groups[o.groups.length-1],p=u.start+u.count;p!==l.materialIndex.length&&o.addGroup(p,l.materialIndex.length-p,h)}o.groups.length===0&&o.addGroup(0,l.materialIndex.length,l.materialIndex[0])}return this.addMorphTargets(o,e,s,r),o}parseGeoNode(e,i){const s={};if(s.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],s.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(s.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(s.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(s.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){s.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&s.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return s.weightTable={},i!==null&&(s.skeleton=i,i.rawBones.forEach(function(r,o){r.indices.forEach(function(a,l){s.weightTable[a]===void 0&&(s.weightTable[a]=[]),s.weightTable[a].push({id:o,weight:r.weights[l]})})})),s}genBuffers(e){const i={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let s=0,r=0,o=!1,a=[],l=[],c=[],h=[],d=[],u=[];const p=this;return e.vertexIndices.forEach(function(g,f){let A,y=!1;g<0&&(g=g^-1,y=!0);let b=[],v=[];if(a.push(g*3,g*3+1,g*3+2),e.color){const x=iL(f,s,g,e.color);c.push(x[0],x[1],x[2])}if(e.skeleton){if(e.weightTable[g]!==void 0&&e.weightTable[g].forEach(function(x){v.push(x.weight),b.push(x.id)}),v.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);const x=[0,0,0,0],w=[0,0,0,0];v.forEach(function(C,S){let _=C,I=b[S];w.forEach(function(B,M,R){if(_>B){R[M]=_,_=B;const k=x[M];x[M]=I,I=k}})}),b=x,v=w}for(;v.length<4;)v.push(0),b.push(0);for(let x=0;x<4;++x)d.push(v[x]),u.push(b[x])}if(e.normal){const x=iL(f,s,g,e.normal);l.push(x[0],x[1],x[2])}e.material&&e.material.mappingType!=="AllSame"&&(A=iL(f,s,g,e.material)[0],A<0&&(p.negativeMaterialIndices=!0,A=0)),e.uv&&e.uv.forEach(function(x,w){const C=iL(f,s,g,x);h[w]===void 0&&(h[w]=[]),h[w].push(C[0]),h[w].push(C[1])}),r++,y&&(p.genFace(i,e,a,A,l,c,h,d,u,r),s++,r=0,a=[],l=[],c=[],h=[],d=[],u=[])}),i}getNormalNewell(e){const i=new E(0,0,0);for(let s=0;s<e.length;s++){const r=e[s],o=e[(s+1)%e.length];i.x+=(r.y-o.y)*(r.z+o.z),i.y+=(r.z-o.z)*(r.x+o.x),i.z+=(r.x-o.x)*(r.y+o.y)}return i.normalize(),i}getNormalTangentAndBitangent(e){const i=this.getNormalNewell(e),s=(Math.abs(i.z)>.5?new E(0,1,0):new E(0,0,1)).cross(i).normalize(),r=i.clone().cross(s).normalize();return{normal:i,tangent:s,bitangent:r}}flattenVertex(e,i,s){return new Q(e.dot(i),e.dot(s))}genFace(e,i,s,r,o,a,l,c,h,d){let u;if(d>3){const p=[],g=i.baseVertexPositions||i.vertexPositions;for(let b=0;b<s.length;b+=3)p.push(new E(g[s[b]],g[s[b+1]],g[s[b+2]]));const{tangent:f,bitangent:A}=this.getNormalTangentAndBitangent(p),y=[];for(const b of p)y.push(this.flattenVertex(b,f,A));u=jh.triangulateShape(y,[])}else u=[[0,1,2]];for(const[p,g,f]of u)e.vertex.push(i.vertexPositions[s[p*3]]),e.vertex.push(i.vertexPositions[s[p*3+1]]),e.vertex.push(i.vertexPositions[s[p*3+2]]),e.vertex.push(i.vertexPositions[s[g*3]]),e.vertex.push(i.vertexPositions[s[g*3+1]]),e.vertex.push(i.vertexPositions[s[g*3+2]]),e.vertex.push(i.vertexPositions[s[f*3]]),e.vertex.push(i.vertexPositions[s[f*3+1]]),e.vertex.push(i.vertexPositions[s[f*3+2]]),i.skeleton&&(e.vertexWeights.push(c[p*4]),e.vertexWeights.push(c[p*4+1]),e.vertexWeights.push(c[p*4+2]),e.vertexWeights.push(c[p*4+3]),e.vertexWeights.push(c[g*4]),e.vertexWeights.push(c[g*4+1]),e.vertexWeights.push(c[g*4+2]),e.vertexWeights.push(c[g*4+3]),e.vertexWeights.push(c[f*4]),e.vertexWeights.push(c[f*4+1]),e.vertexWeights.push(c[f*4+2]),e.vertexWeights.push(c[f*4+3]),e.weightsIndices.push(h[p*4]),e.weightsIndices.push(h[p*4+1]),e.weightsIndices.push(h[p*4+2]),e.weightsIndices.push(h[p*4+3]),e.weightsIndices.push(h[g*4]),e.weightsIndices.push(h[g*4+1]),e.weightsIndices.push(h[g*4+2]),e.weightsIndices.push(h[g*4+3]),e.weightsIndices.push(h[f*4]),e.weightsIndices.push(h[f*4+1]),e.weightsIndices.push(h[f*4+2]),e.weightsIndices.push(h[f*4+3])),i.color&&(e.colors.push(a[p*3]),e.colors.push(a[p*3+1]),e.colors.push(a[p*3+2]),e.colors.push(a[g*3]),e.colors.push(a[g*3+1]),e.colors.push(a[g*3+2]),e.colors.push(a[f*3]),e.colors.push(a[f*3+1]),e.colors.push(a[f*3+2])),i.material&&i.material.mappingType!=="AllSame"&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),i.normal&&(e.normal.push(o[p*3]),e.normal.push(o[p*3+1]),e.normal.push(o[p*3+2]),e.normal.push(o[g*3]),e.normal.push(o[g*3+1]),e.normal.push(o[g*3+2]),e.normal.push(o[f*3]),e.normal.push(o[f*3+1]),e.normal.push(o[f*3+2])),i.uv&&i.uv.forEach(function(A,y){e.uvs[y]===void 0&&(e.uvs[y]=[]),e.uvs[y].push(l[y][p*2]),e.uvs[y].push(l[y][p*2+1]),e.uvs[y].push(l[y][g*2]),e.uvs[y].push(l[y][g*2+1]),e.uvs[y].push(l[y][f*2]),e.uvs[y].push(l[y][f*2+1])})}addMorphTargets(e,i,s,r){if(s.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const o=this;s.forEach(function(a){a.rawTargets.forEach(function(l){const c=Ii.Objects.Geometry[l.geoID];c!==void 0&&o.genMorphGeometry(e,i,c,r,l.name)})})}genMorphGeometry(e,i,s,r,o){const a=i.Vertices!==void 0?i.Vertices.a:[],l=i.PolygonVertexIndex!==void 0?i.PolygonVertexIndex.a:[],c=s.Vertices!==void 0?s.Vertices.a:[],h=s.Indexes!==void 0?s.Indexes.a:[],d=e.attributes.position.count*3,u=new Float32Array(d);for(let A=0;A<h.length;A++){const y=h[A]*3;u[y]=c[A*3],u[y+1]=c[A*3+1],u[y+2]=c[A*3+2]}const p={vertexIndices:l,vertexPositions:u,baseVertexPositions:a},g=this.genBuffers(p),f=new dt(g.vertex,3);f.name=o||s.attrName,f.applyMatrix4(r),e.morphAttributes.position.push(f)}parseNormals(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,r=e.Normals.a;let o=[];return s==="IndexToDirect"&&("NormalIndex"in e?o=e.NormalIndex.a:"NormalsIndex"in e&&(o=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:o,mappingType:i,referenceType:s}}parseUVs(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,r=e.UV.a;let o=[];return s==="IndexToDirect"&&(o=e.UVIndex.a),{dataSize:2,buffer:r,indices:o,mappingType:i,referenceType:s}}parseVertexColors(e){if(!e.Colors)return;const i=e.MappingInformationType,s=e.ReferenceInformationType,r=e.Colors.a;let o=[];s==="IndexToDirect"&&(o=e.ColorIndex.a);for(let a=0,l=new fe;a<r.length;a+=4)l.fromArray(r,a),hi.toWorkingColorSpace(l,ut),l.toArray(r,a);return{dataSize:4,buffer:r,indices:o,mappingType:i,referenceType:s}}parseMaterialIndices(e){const i=e.MappingInformationType,s=e.ReferenceInformationType;if(i==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:s};const r=e.Materials.a,o=[];for(let a=0;a<r.length;++a)o.push(a);return{dataSize:1,buffer:r,indices:o,mappingType:i,referenceType:s}}parseNurbsGeometry(e){const i=parseInt(e.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Rt;const s=i-1,r=e.KnotVector.a,o=[],a=e.Points.a;for(let d=0,u=a.length;d<u;d+=4)o.push(new $e().fromArray(a,d));let l,c;if(e.Form==="Closed")o.push(o[0]);else if(e.Form==="Periodic"){l=s,c=r.length-1-l;for(let d=0;d<s;++d)o.push(o[d])}const h=new zGe(s,r,o,l,c).getPoints(o.length*12);return new Rt().setFromPoints(h)}}class OGe{parse(){const e=[],i=this.parseClips();if(i!==void 0)for(const s in i){const r=i[s],o=this.addClip(r);e.push(o)}return e}parseClips(){if(Ii.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const i=this.parseAnimationLayers(e);return this.parseAnimStacks(i)}parseAnimationCurveNodes(){const e=Ii.Objects.AnimationCurveNode,i=new Map;for(const s in e){const r=e[s];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const o={id:r.id,attr:r.attrName,curves:{}};i.set(o.id,o)}}return i}parseAnimationCurves(e){const i=Ii.Objects.AnimationCurve;for(const s in i){const r={id:i[s].id,times:i[s].KeyTime.a.map(KGe),values:i[s].KeyValueFloat.a},o=Hs.get(r.id);if(o!==void 0){const a=o.parents[0].ID,l=o.parents[0].relationship;l.match(/X/)?e.get(a).curves.x=r:l.match(/Y/)?e.get(a).curves.y=r:l.match(/Z/)?e.get(a).curves.z=r:l.match(/DeformPercent/)&&e.has(a)&&(e.get(a).curves.morph=r)}}}parseAnimationLayers(e){const i=Ii.Objects.AnimationLayer,s=new Map;for(const r in i){const o=[],a=Hs.get(parseInt(r));a!==void 0&&(a.children.forEach(function(l,c){if(e.has(l.ID)){const h=e.get(l.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(o[c]===void 0){const d=Hs.get(l.ID).parents.filter(function(u){return u.relationship!==void 0})[0].ID;if(d!==void 0){const u=Ii.Objects.Model[d.toString()];if(u===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const p={modelName:u.attrName?xi.sanitizeNodeName(u.attrName):"",ID:u.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ba.traverse(function(g){g.ID===u.id&&(p.transform=g.matrix,g.userData.transformData&&(p.eulerOrder=g.userData.transformData.eulerOrder))}),p.transform||(p.transform=new de),"PreRotation"in u&&(p.preRotation=u.PreRotation.value),"PostRotation"in u&&(p.postRotation=u.PostRotation.value),o[c]=p}}o[c]&&(o[c][h.attr]=h)}else if(h.curves.morph!==void 0){if(o[c]===void 0){const d=Hs.get(l.ID).parents.filter(function(y){return y.relationship!==void 0})[0].ID,u=Hs.get(d).parents[0].ID,p=Hs.get(u).parents[0].ID,g=Hs.get(p).parents[0].ID,f=Ii.Objects.Model[g],A={modelName:f.attrName?xi.sanitizeNodeName(f.attrName):"",morphName:Ii.Objects.Deformer[d].attrName};o[c]=A}o[c][h.attr]=h}}}),s.set(parseInt(r),o))}return s}parseAnimStacks(e){const i=Ii.Objects.AnimationStack,s={};for(const r in i){const o=Hs.get(parseInt(r)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const a=e.get(o[0].ID);s[r]={name:i[r].attrName,layer:a}}return s}addClip(e){let i=[];const s=this;return e.layer.forEach(function(r){i=i.concat(s.generateTracks(r))}),new wa(e.name,-1,i)}generateTracks(e){const i=[];let s=new E,r=new E;if(e.transform&&e.transform.decompose(s,new Fe,r),s=s.toArray(),r=r.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,s,"position");o!==void 0&&i.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&i.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");o!==void 0&&i.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&i.push(o)}return i}generateVectorTrack(e,i,s,r){const o=this.getTimesForAllAxes(i),a=this.getKeyframeTrackValues(o,i,s);return new ld(e+"."+r,o,a)}generateRotationTrack(e,i,s,r,o){let a,l;if(i.x===void 0||i.y===void 0||i.z===void 0){console.warn("THREE.FBXLoader: Missing rotation curves "+(i.x===void 0?"x ":"")+(i.y===void 0?"y ":"")+(i.z===void 0?"z ":"")+" for animation of "+e+". This is currently not supported.");return}if(i.x!==void 0&&i.y!==void 0&&i.z!==void 0){const p=this.interpolateRotations(i.x,i.y,i.z,o);a=p[0],l=p[1]}const c=HC(0);s!==void 0&&(s=s.map(Di.degToRad),s.push(c),s=new Oi().fromArray(s),s=new Fe().setFromEuler(s)),r!==void 0&&(r=r.map(Di.degToRad),r.push(c),r=new Oi().fromArray(r),r=new Fe().setFromEuler(r).invert());const h=new Fe,d=new Oi,u=[];if(!(!l||!a)){for(let p=0;p<l.length;p+=3)d.set(l[p],l[p+1],l[p+2],o),h.setFromEuler(d),s!==void 0&&h.premultiply(s),r!==void 0&&h.multiply(r),p>2&&new Fe().fromArray(u,(p-3)/3*4).dot(h)<0&&h.set(-h.x,-h.y,-h.z,-h.w),h.toArray(u,p/3*4);return new ad(e+".quaternion",a,u)}}generateMorphTrack(e){const i=e.DeformPercent.curves.morph,s=i.values.map(function(o){return o/100}),r=Ba.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Ru(e.modelName+".morphTargetInfluences["+r+"]",i.times,s)}getTimesForAllAxes(e){let i=[];if(e.x!==void 0&&(i=i.concat(e.x.times)),e.y!==void 0&&(i=i.concat(e.y.times)),e.z!==void 0&&(i=i.concat(e.z.times)),i=i.sort(function(s,r){return s-r}),i.length>1){let s=1,r=i[0];for(let o=1;o<i.length;o++){const a=i[o];a!==r&&(i[s]=a,r=a,s++)}i=i.slice(0,s)}return i}getKeyframeTrackValues(e,i,s){const r=s,o=[];let a=-1,l=-1,c=-1;return e.forEach(function(h){if(i.x&&(a=i.x.times.indexOf(h)),i.y&&(l=i.y.times.indexOf(h)),i.z&&(c=i.z.times.indexOf(h)),a!==-1){const d=i.x.values[a];o.push(d),r[0]=d}else o.push(r[0]);if(l!==-1){const d=i.y.values[l];o.push(d),r[1]=d}else o.push(r[1]);if(c!==-1){const d=i.z.values[c];o.push(d),r[2]=d}else o.push(r[2])}),o}interpolateRotations(e,i,s,r){const o=[],a=[];o.push(e.times[0]),a.push(Di.degToRad(e.values[0])),a.push(Di.degToRad(i.values[0])),a.push(Di.degToRad(s.values[0]));for(let l=1;l<e.values.length;l++){const c=[e.values[l-1],i.values[l-1],s.values[l-1]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;const h=c.map(Di.degToRad),d=[e.values[l],i.values[l],s.values[l]];if(isNaN(d[0])||isNaN(d[1])||isNaN(d[2]))continue;const u=d.map(Di.degToRad),p=[d[0]-c[0],d[1]-c[1],d[2]-c[2]],g=[Math.abs(p[0]),Math.abs(p[1]),Math.abs(p[2])];if(g[0]>=180||g[1]>=180||g[2]>=180){const f=Math.max(...g)/180,A=new Oi(...h,r),y=new Oi(...u,r),b=new Fe().setFromEuler(A),v=new Fe().setFromEuler(y);b.dot(v)&&v.set(-v.x,-v.y,-v.z,-v.w);const x=e.times[l-1],w=e.times[l]-x,C=new Fe,S=new Oi;for(let _=0;_<1;_+=1/f)C.copy(b.clone().slerp(v.clone(),_)),o.push(x+_*w),S.setFromQuaternion(C,r),a.push(S.x),a.push(S.y),a.push(S.z)}else o.push(e.times[l]),a.push(Di.degToRad(e.values[l])),a.push(Di.degToRad(i.values[l])),a.push(Di.degToRad(s.values[l]))}return[o,a]}}class ZGe{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,i){this.currentProp=e,this.currentPropName=i}parse(e){this.currentIndent=0,this.allNodes=new pne,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const i=this,s=e.split(/[\r\n]+/);return s.forEach(function(r,o){const a=r.match(/^[\s\t]*;/),l=r.match(/^[\s\t]*$/);if(a||l)return;const c=r.match("^\\t{"+i.currentIndent+"}(\\w+):(.*){",""),h=r.match("^\\t{"+i.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),d=r.match("^\\t{"+(i.currentIndent-1)+"}}");c?i.parseNodeBegin(r,c):h?i.parseNodeProperty(r,h,s[++o]):d?i.popStack():r.match(/^[^\s\t}]/)&&i.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,i){const s=i[1].trim().replace(/^"/,"").replace(/"$/,""),r=i[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),o={name:s},a=this.parseNodeAttr(r),l=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(s,o):s in l?(s==="PoseNode"?l.PoseNode.push(o):l[s].id!==void 0&&(l[s]={},l[s][l[s].id]=l[s]),a.id!==""&&(l[s][a.id]=o)):typeof a.id=="number"?(l[s]={},l[s][a.id]=o):s!=="Properties70"&&(s==="PoseNode"?l[s]=[o]:l[s]=o),typeof a.id=="number"&&(o.id=a.id),a.name!==""&&(o.attrName=a.name),a.type!==""&&(o.attrType=a.type),this.pushStack(o)}parseNodeAttr(e){let i=e[0];e[0]!==""&&(i=parseInt(e[0]),isNaN(i)&&(i=e[0]));let s="",r="";return e.length>1&&(s=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:i,name:s,type:r}}parseNodeProperty(e,i,s){let r=i[1].replace(/^"/,"").replace(/"$/,"").trim(),o=i[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&o===","&&(o=s.replace(/"/g,"").replace(/,$/,"").trim());const a=this.getCurrentNode();if(a.name==="Properties70"){this.parseNodeSpecialProperty(e,r,o);return}if(r==="C"){const l=o.split(",").slice(1),c=parseInt(l[0]),h=parseInt(l[1]);let d=o.split(",").slice(3);d=d.map(function(u){return u.trim().replace(/^"/,"")}),r="connections",o=[c,h],jGe(o,d),a[r]===void 0&&(a[r]=[])}r==="Node"&&(a.id=o),r in a&&Array.isArray(a[r])?a[r].push(o):r!=="a"?a[r]=o:a.a=o,this.setCurrentProp(a,r),r==="a"&&o.slice(-1)!==","&&(a.a=DF(o))}parseNodePropertyContinued(e){const i=this.getCurrentNode();i.a+=e,e.slice(-1)!==","&&(i.a=DF(i.a))}parseNodeSpecialProperty(e,i,s){const r=s.split('",').map(function(d){return d.trim().replace(/^\"/,"").replace(/\s/,"_")}),o=r[0],a=r[1],l=r[2],c=r[3];let h=r[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=DF(h);break}this.getPrevNode()[o]={type:a,type2:l,flag:c,value:h},this.setCurrentProp(this.getPrevNode(),o)}}class WGe{parse(e){const i=new une(e);i.skip(23);const s=i.getUint32();if(s<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+s);const r=new pne;for(;!this.endOfContent(i);){const o=this.parseNode(i,s);o!==null&&r.add(o.name,o)}return r}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,i){const s={},r=i>=7500?e.getUint64():e.getUint32(),o=i>=7500?e.getUint64():e.getUint32();i>=7500?e.getUint64():e.getUint32();const a=e.getUint8(),l=e.getString(a);if(r===0)return null;const c=[];for(let p=0;p<o;p++)c.push(this.parseProperty(e));const h=c.length>0?c[0]:"",d=c.length>1?c[1]:"",u=c.length>2?c[2]:"";for(s.singleProperty=o===1&&e.getOffset()===r;r>e.getOffset();){const p=this.parseNode(e,i);p!==null&&this.parseSubNode(l,s,p)}return s.propertyList=c,typeof h=="number"&&(s.id=h),d!==""&&(s.attrName=d),u!==""&&(s.attrType=u),l!==""&&(s.name=l),s}parseSubNode(e,i,s){if(s.singleProperty===!0){const r=s.propertyList[0];Array.isArray(r)?(i[s.name]=s,s.a=r):i[s.name]=r}else if(e==="Connections"&&s.name==="C"){const r=[];s.propertyList.forEach(function(o,a){a!==0&&r.push(o)}),i.connections===void 0&&(i.connections=[]),i.connections.push(r)}else if(s.name==="Properties70")Object.keys(s).forEach(function(r){i[r]=s[r]});else if(e==="Properties70"&&s.name==="P"){let r=s.propertyList[0],o=s.propertyList[1];const a=s.propertyList[2],l=s.propertyList[3];let c;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),o==="Color"||o==="ColorRGB"||o==="Vector"||o==="Vector3D"||o.indexOf("Lcl_")===0?c=[s.propertyList[4],s.propertyList[5],s.propertyList[6]]:c=s.propertyList[4],i[r]={type:o,type2:a,flag:l,value:c}}else i[s.name]===void 0?typeof s.id=="number"?(i[s.name]={},i[s.name][s.id]=s):i[s.name]=s:s.name==="PoseNode"?(Array.isArray(i[s.name])||(i[s.name]=[i[s.name]]),i[s.name].push(s)):i[s.name][s.id]===void 0&&(i[s.name][s.id]=s)}parseProperty(e){const i=e.getString(1);let s;switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return s=e.getUint32(),e.getArrayBuffer(s);case"S":return s=e.getUint32(),e.getString(s);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),o=e.getUint32(),a=e.getUint32();if(o===0)switch(i){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const l=XC(new Uint8Array(e.getArrayBuffer(a))),c=new une(l.buffer);switch(i){case"b":case"c":return c.getBooleanArray(r);case"d":return c.getFloat64Array(r);case"f":return c.getFloat32Array(r);case"i":return c.getInt32Array(r);case"l":return c.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}}class une{constructor(e,i){this.dv=new DataView(e),this.offset=0,this.littleEndian=i!==void 0?i:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const i=[];for(let s=0;s<e;s++)i.push(this.getBoolean());return i}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt32());return i}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),i&2147483648?(i=~i&4294967295,e=~e&4294967295,e===4294967295&&(i=i+1&4294967295),e=e+1&4294967295,-(i*4294967296+e)):i*4294967296+e}getInt64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt64());return i}getUint64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),i*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat32());return i}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat64());return i}getArrayBuffer(e){const i=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,i}getString(e){const i=this.offset;let s=new Uint8Array(this.dv.buffer,i,e);this.skip(e);const r=s.indexOf(0);return r>=0&&(s=new Uint8Array(this.dv.buffer,i,r)),this._textDecoder.decode(s)}}class pne{add(e,i){this[e]=i}}function HGe(n){const e="Kaydara FBX Binary  \0";return n.byteLength>=e.length&&e===fne(n,0,e.length)}function QGe(n){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let i=0;function s(r){const o=n[r-1];return n=n.slice(i+r),i++,o}for(let r=0;r<e.length;++r)if(s(1)===e[r])return!1;return!0}function mne(n){const e=/FBXVersion: (\d+)/,i=n.match(e);if(i)return parseInt(i[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function KGe(n){return n/46186158e3}const YGe=[];function iL(n,e,i,s){let r;switch(s.mappingType){case"ByPolygonVertex":r=n;break;case"ByPolygon":r=e;break;case"ByVertice":r=i;break;case"AllSame":r=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}s.referenceType==="IndexToDirect"&&(r=s.indices[r]);const o=r*s.dataSize,a=o+s.dataSize;return JGe(YGe,s.buffer,o,a)}const XF=new Oi,tv=new E;function gne(n){const e=new de,i=new de,s=new de,r=new de,o=new de,a=new de,l=new de,c=new de,h=new de,d=new de,u=new de,p=new de,g=n.inheritType?n.inheritType:0;n.translation&&e.setPosition(tv.fromArray(n.translation));const f=HC(0);if(n.preRotation){const R=n.preRotation.map(Di.degToRad);R.push(f),i.makeRotationFromEuler(XF.fromArray(R))}if(n.rotation){const R=n.rotation.map(Di.degToRad);R.push(n.eulerOrder||f),s.makeRotationFromEuler(XF.fromArray(R))}if(n.postRotation){const R=n.postRotation.map(Di.degToRad);R.push(f),r.makeRotationFromEuler(XF.fromArray(R)),r.invert()}n.scale&&o.scale(tv.fromArray(n.scale)),n.scalingOffset&&l.setPosition(tv.fromArray(n.scalingOffset)),n.scalingPivot&&a.setPosition(tv.fromArray(n.scalingPivot)),n.rotationOffset&&c.setPosition(tv.fromArray(n.rotationOffset)),n.rotationPivot&&h.setPosition(tv.fromArray(n.rotationPivot)),n.parentMatrixWorld&&(u.copy(n.parentMatrix),d.copy(n.parentMatrixWorld));const A=i.clone().multiply(s).multiply(r),y=new de;y.extractRotation(d);const b=new de;b.copyPosition(d);const v=b.clone().invert().multiply(d),x=y.clone().invert().multiply(v),w=o,C=new de;if(g===0)C.copy(y).multiply(A).multiply(x).multiply(w);else if(g===1)C.copy(y).multiply(x).multiply(A).multiply(w);else{const R=new de().scale(new E().setFromMatrixScale(u)).clone().invert(),k=x.clone().multiply(R);C.copy(y).multiply(A).multiply(k).multiply(w)}const S=h.clone().invert(),_=a.clone().invert();let I=e.clone().multiply(c).multiply(h).multiply(i).multiply(s).multiply(r).multiply(S).multiply(l).multiply(a).multiply(o).multiply(_);const B=new de().copyPosition(I),M=d.clone().multiply(B);return p.copyPosition(M),I=p.clone().multiply(C),I.premultiply(d.invert()),I}function HC(n){n=n||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return n===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[n]}function DF(n){return n.split(",").map(function(e){return parseFloat(e)})}function fne(n,e,i){return e===void 0&&(e=0),i===void 0&&(i=n.byteLength),new TextDecoder().decode(new Uint8Array(n,e,i))}function jGe(n,e){for(let i=0,s=n.length,r=e.length;i<r;i++,s++)n[s]=e[i]}function JGe(n,e,i,s){for(let r=i,o=0;r<s;r++,o++)n[o]=e[r];return n}class qGe extends fs{constructor(e){super(e)}load(e,i,s,r){const o=this,a=this.path===""?cd.extractUrlBase(e):this.path,l=new Rs(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{i(o.parse(c,a))}catch(h){r?r(h):console.error(h),o.manager.itemError(e)}},s,r)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,i){const s=e.split(`
`);let r={};const o=/\s+/,a={};for(let c=0;c<s.length;c++){let h=s[c];if(h=h.trim(),h.length===0||h.charAt(0)==="#")continue;const d=h.indexOf(" ");let u=d>=0?h.substring(0,d):h;u=u.toLowerCase();let p=d>=0?h.substring(d+1):"";if(p=p.trim(),u==="newmtl")r={name:p},a[p]=r;else if(u==="ka"||u==="kd"||u==="ks"||u==="ke"){const g=p.split(o,3);r[u]=[parseFloat(g[0]),parseFloat(g[1]),parseFloat(g[2])]}else r[u]=p}const l=new $Ge(this.resourcePath||i,this.materialOptions);return l.setCrossOrigin(this.crossOrigin),l.setManager(this.manager),l.setMaterials(a),l}}class $Ge{constructor(e="",i={}){this.baseUrl=e,this.options=i,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:ms,this.wrap=this.options.wrap!==void 0?this.options.wrap:lo}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const i={};for(const s in e){const r=e[s],o={};i[s]=o;for(const a in r){let l=!0,c=r[a];const h=a.toLowerCase();switch(h){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(c=[c[0]/255,c[1]/255,c[2]/255]),this.options&&this.options.ignoreZeroRGBs&&c[0]===0&&c[1]===0&&c[2]===0&&(l=!1);break}l&&(o[h]=c)}}return i}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const i in this.materialsInfo)this.materialsArray[e]=this.create(i),this.nameLookup[i]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const i=this,s=this.materialsInfo[e],r={name:e,side:this.side};function o(l,c){return typeof c!="string"||c===""?"":/^https?:\/\//i.test(c)?c:l+c}function a(l,c){if(r[l])return;const h=i.getTextureParams(c,r),d=i.loadTexture(o(i.baseUrl,h.url));d.repeat.copy(h.scale),d.offset.copy(h.offset),d.wrapS=i.wrap,d.wrapT=i.wrap,(l==="map"||l==="emissiveMap")&&(d.colorSpace=ut),r[l]=d}for(const l in s){const c=s[l];let h;if(c!=="")switch(l.toLowerCase()){case"kd":r.color=hi.toWorkingColorSpace(new fe().fromArray(c),ut);break;case"ks":r.specular=hi.toWorkingColorSpace(new fe().fromArray(c),ut);break;case"ke":r.emissive=hi.toWorkingColorSpace(new fe().fromArray(c),ut);break;case"map_kd":a("map",c);break;case"map_ks":a("specularMap",c);break;case"map_ke":a("emissiveMap",c);break;case"norm":a("normalMap",c);break;case"map_bump":case"bump":a("bumpMap",c);break;case"map_d":a("alphaMap",c),r.transparent=!0;break;case"ns":r.shininess=parseFloat(c);break;case"d":h=parseFloat(c),h<1&&(r.opacity=h,r.transparent=!0);break;case"tr":h=parseFloat(c),this.options&&this.options.invertTrProperty&&(h=1-h),h>0&&(r.opacity=1-h,r.transparent=!0);break}}return this.materials[e]=new cm(r),this.materials[e]}getTextureParams(e,i){const s={scale:new Q(1,1),offset:new Q(0,0)},r=e.split(/\s+/);let o;return o=r.indexOf("-bm"),o>=0&&(i.bumpScale=parseFloat(r[o+1]),r.splice(o,2)),o=r.indexOf("-s"),o>=0&&(s.scale.set(parseFloat(r[o+1]),parseFloat(r[o+2])),r.splice(o,4)),o=r.indexOf("-o"),o>=0&&(s.offset.set(parseFloat(r[o+1]),parseFloat(r[o+2])),r.splice(o,4)),s.url=r.join(" ").trim(),s}loadTexture(e,i,s,r,o){const a=this.manager!==void 0?this.manager:zP;let l=a.getHandler(e);l===null&&(l=new hh(a)),l.setCrossOrigin&&l.setCrossOrigin(this.crossOrigin);const c=l.load(e,s,r,o);return i!==void 0&&(c.mapping=i),c}}const ePe=/^[og]\s*(.+)?/,tPe=/^mtllib /,iPe=/^usemtl /,nPe=/^usemap /,Ane=/\s+/,yne=new E,zF=new E,bne=new E,vne=new E,Xc=new E,nL=new fe;function sPe(){const n={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,i){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=i!==!1;return}const s=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:i!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(r,o){const a=this._finalize(!1);a&&(a.inherited||a.groupCount<=0)&&this.materials.splice(a.index,1);const l={index:this.materials.length,name:r||"",mtllib:Array.isArray(o)&&o.length>0?o[o.length-1]:"",smooth:a!==void 0?a.smooth:this.smooth,groupStart:a!==void 0?a.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(c){const h={index:typeof c=="number"?c:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return h.clone=this.clone.bind(h),h}};return this.materials.push(l),l},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(r){const o=this.currentMaterial();if(o&&o.groupEnd===-1&&(o.groupEnd=this.geometry.vertices.length/3,o.groupCount=o.groupEnd-o.groupStart,o.inherited=!1),r&&this.materials.length>1)for(let a=this.materials.length-1;a>=0;a--)this.materials[a].groupCount<=0&&this.materials.splice(a,1);return r&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),o}},s&&s.name&&typeof s.clone=="function"){const r=s.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,i){const s=parseInt(e,10);return(s>=0?s-1:s+i/3)*3},parseNormalIndex:function(e,i){const s=parseInt(e,10);return(s>=0?s-1:s+i/3)*3},parseUVIndex:function(e,i){const s=parseInt(e,10);return(s>=0?s-1:s+i/2)*2},addVertex:function(e,i,s){const r=this.vertices,o=this.object.geometry.vertices;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[i+0],r[i+1],r[i+2]),o.push(r[s+0],r[s+1],r[s+2])},addVertexPoint:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addVertexLine:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addNormal:function(e,i,s){const r=this.normals,o=this.object.geometry.normals;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[i+0],r[i+1],r[i+2]),o.push(r[s+0],r[s+1],r[s+2])},addFaceNormal:function(e,i,s){const r=this.vertices,o=this.object.geometry.normals;yne.fromArray(r,e),zF.fromArray(r,i),bne.fromArray(r,s),Xc.subVectors(bne,zF),vne.subVectors(yne,zF),Xc.cross(vne),Xc.normalize(),o.push(Xc.x,Xc.y,Xc.z),o.push(Xc.x,Xc.y,Xc.z),o.push(Xc.x,Xc.y,Xc.z)},addColor:function(e,i,s){const r=this.colors,o=this.object.geometry.colors;r[e]!==void 0&&o.push(r[e+0],r[e+1],r[e+2]),r[i]!==void 0&&o.push(r[i+0],r[i+1],r[i+2]),r[s]!==void 0&&o.push(r[s+0],r[s+1],r[s+2])},addUV:function(e,i,s){const r=this.uvs,o=this.object.geometry.uvs;o.push(r[e+0],r[e+1]),o.push(r[i+0],r[i+1]),o.push(r[s+0],r[s+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const i=this.uvs;this.object.geometry.uvs.push(i[e+0],i[e+1])},addFace:function(e,i,s,r,o,a,l,c,h){const d=this.vertices.length;let u=this.parseVertexIndex(e,d),p=this.parseVertexIndex(i,d),g=this.parseVertexIndex(s,d);if(this.addVertex(u,p,g),this.addColor(u,p,g),l!==void 0&&l!==""){const f=this.normals.length;u=this.parseNormalIndex(l,f),p=this.parseNormalIndex(c,f),g=this.parseNormalIndex(h,f),this.addNormal(u,p,g)}else this.addFaceNormal(u,p,g);if(r!==void 0&&r!==""){const f=this.uvs.length;u=this.parseUVIndex(r,f),p=this.parseUVIndex(o,f),g=this.parseUVIndex(a,f),this.addUV(u,p,g),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const i=this.vertices.length;for(let s=0,r=e.length;s<r;s++){const o=this.parseVertexIndex(e[s],i);this.addVertexPoint(o),this.addColor(o)}},addLineGeometry:function(e,i){this.object.geometry.type="Line";const s=this.vertices.length,r=this.uvs.length;for(let o=0,a=e.length;o<a;o++)this.addVertexLine(this.parseVertexIndex(e[o],s));for(let o=0,a=i.length;o<a;o++)this.addUVLine(this.parseUVIndex(i[o],r))}};return n.startObject("",!1),n}class FF extends fs{constructor(e){super(e),this.materials=null,this.materialsLoader=new qGe(e)}load(e,i,s,r){const o=this,a=new Rs(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,async function(l){try{const c=o.parse(l,!0);for(let h=0,d=c.materialLibraries.length;h<d;h++){const u=c.materialLibraries[h],p=e.startsWith("blob:")?e+"/"+u:new URL(u,e);console.debug("Loading MTL file: "+p),await new Promise((g,f)=>{o.materialsLoader.load(p.toString(),A=>{o.setMaterials(A),g()},null,f)})}i(o.createObjects(c))}catch(c){r?r(c):console.error(c),o.manager.itemError(e)}},s,r)}setMTLLoader(e){return this.materialsLoader=e,this}setMaterials(e){return this.materials=e,this}parse(e,i=!1){const s=new sPe;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const r=e.split(`
`);let o=[];for(let a=0,l=r.length;a<l;a++){const c=r[a].trimStart();if(c.length===0)continue;const h=c.charAt(0);if(h!=="#")if(h==="v"){const d=c.split(Ane);switch(d[0]){case"v":s.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),d.length>=7?(nL.setRGB(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6]),ut),s.colors.push(nL.r,nL.g,nL.b)):s.colors.push(void 0,void 0,void 0);break;case"vn":s.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":s.uvs.push(parseFloat(d[1]),parseFloat(d[2]));break}}else if(h==="f"){const d=c.slice(1).trim().split(Ane),u=[];for(let g=0,f=d.length;g<f;g++){const A=d[g];if(A.length>0){const y=A.split("/");u.push(y)}}const p=u[0];for(let g=1,f=u.length-1;g<f;g++){const A=u[g],y=u[g+1];s.addFace(p[0],A[0],y[0],p[1],A[1],y[1],p[2],A[2],y[2])}}else if(h==="l"){const d=c.substring(1).trim().split(" ");let u=[];const p=[];if(c.indexOf("/")===-1)u=d;else for(let g=0,f=d.length;g<f;g++){const A=d[g].split("/");A[0]!==""&&u.push(A[0]),A[1]!==""&&p.push(A[1])}s.addLineGeometry(u,p)}else if(h==="p"){const d=c.slice(1).trim().split(" ");s.addPointGeometry(d)}else if((o=ePe.exec(c))!==null){const d=(" "+o[0].slice(1).trim()).slice(1);s.startObject(d)}else if(iPe.test(c))s.object.startMaterial(c.substring(7).trim(),s.materialLibraries);else if(tPe.test(c))s.materialLibraries.push(c.substring(7).trim());else if(nPe.test(c))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(o=c.split(" "),o.length>1){const u=o[1].trim().toLowerCase();s.object.smooth=u!=="0"&&u!=="off"}else s.object.smooth=!0;const d=s.object.currentMaterial();d&&(d.smooth=s.object.smooth)}else{if(c==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+c+'"')}}return s.finalize(),i?s:this.createObjects(s)}createObjects(e){const i=new Es;if(i.materialLibraries=[].concat(e.materialLibraries),!(e.objects.length===1&&e.objects[0].geometry.vertices.length===0))for(let s=0,r=e.objects.length;s<r;s++){const o=e.objects[s],a=o.geometry,l=o.materials,c=a.type==="Line",h=a.type==="Points";let d=!1;if(a.vertices.length===0)continue;const u=new Rt;u.setAttribute("position",new dt(a.vertices,3)),a.normals.length>0&&u.setAttribute("normal",new dt(a.normals,3)),a.colors.length>0&&(d=!0,u.setAttribute("color",new dt(a.colors,3))),a.hasUVIndices===!0&&u.setAttribute("uv",new dt(a.uvs,2));const p=[];for(let f=0,A=l.length;f<A;f++){const y=l[f],b=y.name+"_"+y.smooth+"_"+d;let v=e.materials[b];if(this.materials!==null){if(v=this.materials.create(y.name),c&&v&&!(v instanceof Cn)){const x=new Cn;ti.prototype.copy.call(x,v),x.color.copy(v.color),v=x}else if(h&&v&&!(v instanceof rd)){const x=new rd({size:10,sizeAttenuation:!1});ti.prototype.copy.call(x,v),x.color.copy(v.color),x.map=v.map,v=x}}v===void 0&&(c?v=new Cn:h?v=new rd({size:1,sizeAttenuation:!1}):v=new cm,v.name=y.name,v.flatShading=!y.smooth,v.vertexColors=d,e.materials[b]=v),p.push(v)}let g;if(p.length>1){for(let f=0,A=l.length;f<A;f++){const y=l[f];u.addGroup(y.groupStart,y.groupCount,f)}c?g=new Jo(u,p):h?g=new Ey(u,p):g=new pe(u,p)}else c?g=new Jo(u,p[0]):h?g=new Ey(u,p[0]):g=new pe(u,p[0]);g.name=o.name,i.add(g)}else if(e.vertices.length>0){const s=new rd({size:1,sizeAttenuation:!1}),r=new Rt;r.setAttribute("position",new dt(e.vertices,3)),e.colors.length>0&&e.colors[0]!==void 0&&(r.setAttribute("color",new dt(e.colors,3)),s.vertexColors=!0);const o=new Ey(r,s);i.add(o)}return i}}typeof globalThis!==void 0&&!("OffscreenCanvas"in globalThis)&&(globalThis.OffscreenCanvas=class{constructor(n,e){return m(this,"canvas"),this.canvas=document.createElement("canvas"),this.canvas.width=n,this.canvas.height=e,this.canvas.convertToBlob=(i,s)=>new Promise(r=>{this.canvas.toBlob(r,i,s)}),this.canvas}});const rPe=q("debugprogress");function xne(n){n=n||new Date;const e=n.getMonth()+1,i=n.getDate(),s=n.getHours(),r=n.getMinutes(),o=n.getSeconds(),a=(e<10?"0":"")+e,l=(i<10?"0":"")+i,c=(s<10?"0":"")+s,h=(r<10?"0":"")+r,d=(o<10?"0":"")+o;return n.getFullYear()+a+l+"-"+c+h+d}class Ei{static start(e,i){typeof i=="string"&&(i={parentScope:i});const s=new oPe(e,i);QC.set(e,s)}static report(e,i){const s=QC.get(e);if(!s){console.warn("Reporting progress for non-existing scope",e);return}typeof i=="string"&&(i={message:i,autoStep:!0}),s.report(i)}static end(e){const i=QC.get(e);i&&(i.end(),QC.delete(e))}}const QC=new Map;class oPe{constructor(e,i){m(this,"scopeLabel"),m(this,"parentScope"),m(this,"childScopes",[]),m(this,"parentDepth",0),m(this,"lastStep",0),m(this,"lastAutoStepWeight",1),m(this,"lastTotalSteps",0),m(this,"onProgress"),m(this,"showLogs",!1),m(this,"selfProgress",0),m(this,"totalProgress",0),m(this,"selfReports",0),m(this,"totalReports",0),this.parentScope=i!=null&&i.parentScope?QC.get(i.parentScope):void 0,this.parentScope&&(this.parentScope.childScopes.push(this),this.parentDepth=this.parentScope.parentDepth+1),this.scopeLabel=" ".repeat(this.parentDepth*2)+e,this.showLogs=i?.logTimings??!!rPe,this.showLogs&&console.time(this.scopeLabel),this.onProgress=i?.onProgress}report(e,i=!1){if(e){if(e.totalSteps!==void 0&&(this.lastTotalSteps=e.totalSteps),e.currentStep!==void 0&&(this.lastStep=e.currentStep),e.autoStep!==void 0){if(e.currentStep===void 0){this.lastStep===void 0&&(this.lastStep=0);const r=typeof e.autoStep=="number"?e.autoStep:1;this.lastStep+=this.lastAutoStepWeight,this.lastAutoStepWeight=r,e.currentStep=this.lastStep}e.totalSteps=this.lastTotalSteps}e.progress!==void 0?this.selfProgress=e.progress:e.currentStep!==void 0&&e.totalSteps!==void 0&&(this.selfProgress=e.currentStep/e.totalSteps)}if(this.childScopes.length>0){let r=0,o=0;for(const l of this.childScopes)r+=l.selfProgress,o+=1;o>0&&(r/=o);const a=this.lastAutoStepWeight/(this.lastTotalSteps??1);this.totalProgress=this.selfProgress+r*a}else this.totalProgress=this.selfProgress;this.selfProgress=Math.min(1,this.selfProgress),this.totalProgress=Math.min(1,this.totalProgress);let s=(this.totalProgress*100).toFixed(3)+"%";this.childScopes.length>0&&(s+=" ("+(this.selfProgress*100).toFixed(3)+"% self)"),e!=null&&e.message&&(s=e.message+" \u2013 "+s),this.lastStep!==void 0&&this.lastTotalSteps!==void 0&&(s="Step "+(this.lastStep+(this.lastAutoStepWeight!=1?"\u2013"+(this.lastStep+this.lastAutoStepWeight):"")+"/"+this.lastTotalSteps)+" "+s),i?this.totalReports++:(this.selfReports++,this.totalReports++),this.showLogs&&console.timeLog(this.scopeLabel,s),this.onProgress&&this.onProgress(this.totalProgress),this.parentScope&&this.parentScope.report(void 0,!0)}end(){this.report({progress:1,autoStep:!0},!0),this.showLogs&&(console.timeLog(this.scopeLabel,"Total reports: "+this.totalReports,"Self reports: "+this.selfReports),console.timeEnd(this.scopeLabel));let e=!1;for(const i of this.childScopes)if(!(i.selfProgress>=1)){e=!0;break}e&&console.warn("Progress end with child scopes that are still running",this),this.onProgress=void 0}}function Xh(n){return n=n.replace(/[^a-zA-Z0-9_]/g,""),n.match(/^[a-zA-Z_]/)||(n="_"+n),n}function wne(n){return n=n.replace('"','\\"'),n}function Cne(n){if(n.length===0)return null;const e=n.map(i=>{const s=new Array;for(;i.parent;)s.unshift(i.parent),i=i.parent;return s});return e[0].findLast(i=>e.every(s=>s.includes(i)))||null}function Sne(n){const e=Cne(n),i=new Set;for(const s of n){let r=s.parent;for(;r&&r!==e;)n.includes(r)||i.add(r),r=r.parent}return i}const aPe=new E,lPe=new Fe,cPe=new E(1,1,1),iv=class{constructor(n,e,i=null,s=null,r=null,o=null,a=null,l=null){m(this,"uuid"),m(this,"name"),m(this,"type"),m(this,"extraSchemas",[]),m(this,"displayName"),m(this,"visibility"),m(this,"transform",null),m(this,"_isDynamic"),m(this,"geometry"),m(this,"material"),m(this,"camera"),m(this,"parent"),m(this,"skinnedMesh"),m(this,"children",[]),m(this,"animations"),m(this,"_eventListeners"),m(this,"needsTranslate",!1),m(this,"needsOrient",!1),m(this,"needsScale",!1);var c,h,d;this.uuid=n,this.name=Xh(e),this.displayName=e,i?this.transform={position:((c=i.position)==null?void 0:c.clone())||null,quaternion:((h=i.quaternion)==null?void 0:h.clone())||null,scale:((d=i.scale)==null?void 0:d.clone())||null}:this.transform=null,this.geometry=s,this.material=r,this.camera=o,this.parent=null,this.children=[],this._eventListeners={},this._isDynamic=!1,this.skinnedMesh=a,this.animations=l}getMatrix(){if(!this.transform)return new de;const{position:n,quaternion:e,scale:i}=this.transform,s=new de;return s.compose(n||aPe,e||lPe,i||cPe),s}setMatrix(n){if(!n||!(n instanceof de)){this.transform=null;return}const e=new E,i=new Fe,s=new E;n.decompose(e,i,s),this.transform={position:e,quaternion:i,scale:s}}get matrix(){return this.getMatrix()}set matrix(n){this.setMatrix(n)}get isDynamic(){return this._isDynamic}set isDynamic(n){this._isDynamic=n}static createEmptyParent(n){const e=new iv(Di.generateUUID(),n.name+"_empty_"+iv.USDObject_export_id++,n.transform),i=n.parent;return i&&i.add(e),e.add(n),e.isDynamic=!0,n.transform=null,e}static createEmpty(){const n=new iv(Di.generateUUID(),"Empty_"+iv.USDObject_export_id++);return n.isDynamic=!0,n}is(n){return n?this.uuid===n.uuid:!1}isEmpty(){return!this.geometry}clone(){const n=new iv(Di.generateUUID(),this.name,this.transform,this.geometry,this.material);return n.isDynamic=this.isDynamic,n}deepClone(){const n=this.clone();for(const e of this.children)e&&n.add(e.deepClone());return n}getPath(){let n=this.parent,e=this.name;for(;n;)e=(n.parent?n.name:n.name+"/Scenes/Scene")+"/"+e,n=n.parent;return"</"+e+">"}add(n){n.parent&&n.parent.remove(n),n.parent=this,this.children.push(n)}remove(n){const e=this.children.indexOf(n);e>=0&&(n.parent===this&&(n.parent=null),this.children.splice(e,1))}addEventListener(n,e){this._eventListeners[n]||(this._eventListeners[n]=[]),this._eventListeners[n].push(e)}removeEventListener(n,e){if(!this._eventListeners[n])return;const i=this._eventListeners[n].indexOf(e);i>=0&&this._eventListeners[n].splice(i,1)}onSerialize(n,e){const i=this._eventListeners.serialize;i&&i.forEach(s=>s(n,e))}};let ka=iv;m(ka,"USDObject_export_id",0);class UF extends ka{constructor(){super(void 0,"StageRoot",null,null,null,null),m(this,"stageLength"),this.children=[],this.stageLength=200}get isDocumentRoot(){return!0}get isDynamic(){return!1}add(e){e.parent=this,this.children.push(e)}remove(e){const i=this.children.indexOf(e);i>=0&&(e.parent===this&&(e.parent=null),this.children.splice(i,1))}traverse(e,i=null){if(i!==null?e(i):i=this,i.children)for(const s of i.children)this.traverse(e,s)}findById(e){let i=!1;function s(r){if(!i){if(r.uuid===e)return i=!0,r;if(r.children)for(const o of r.children){if(!o)continue;const a=s(o);if(a)return a}}}return s(this)}buildHeader(e){var i,s,r;const o=(i=e.extensions)==null?void 0:i.find(g=>g?.extensionName==="animation"),a=(s=e.extensions)==null?void 0:s.find(g=>g?.extensionName==="Behaviour"),l=(r=e.extensions)==null?void 0:r.find(g=>g?.extensionName==="Physics"),c=o?.getStartTimeCode()??0,h=o?.getEndTimeCode()??0;let d="";const u=o?.registeredClips;if(u)for(const g of u)d+=`	# Animation: ${g.name}, start=${o.getStartTimeByClip(g)*60}, length=${g.duration*60}
`;const p=d;return`#usda 1.0
(
	customLayerData = {
		string creator = "Needle Engine ${xh}"
		dictionary Needle = {
			bool animations = ${o?1:0}
			bool interactive = ${a?1:0}
			bool physics = ${l?1:0}
			bool quickLookCompatible = ${e.quickLookCompatible?1:0}
		}
	}
	defaultPrim = "${Xh(this.name)}"
	metersPerUnit = 1
	upAxis = "Y"
	startTimeCode = ${c}
	endTimeCode = ${h}
	timeCodesPerSecond = 60
	framesPerSecond = 60
	doc = """Generated by Needle Engine USDZ Exporter ${xh}"""
${p}
)
`}}const nv=`
`,Ga="</StageRoot/Materials";class _ne{constructor(){m(this,"str"),m(this,"indent"),this.str="",this.indent=0}clear(){this.str="",this.indent=0}beginBlock(e=void 0,i="{",s=!0){e!==void 0?(e=this.applyIndent(e),this.str+=e,s?(this.str+=nv,this.str+=this.applyIndent(i)):this.str+=" "+i):this.str+=this.applyIndent(i),this.str+=nv,this.indent+=1}closeBlock(e="}"){this.indent-=1,this.str+=this.applyIndent(e)+nv}beginArray(e){e=this.applyIndent(e+" = ["),this.str+=e,this.str+=nv,this.indent+=1}closeArray(){this.indent-=1,this.str+=this.applyIndent("]")+nv}appendLine(e=""){e=this.applyIndent(e),this.str+=e,this.str+=nv}toString(){return this.str}applyIndent(e){let i="";for(let s=0;s<this.indent;s++)i+="	";return i+e}}class hPe{constructor(e,i,s){m(this,"root"),m(this,"exporter"),m(this,"extensions",[]),m(this,"quickLookCompatible"),m(this,"exportInvisible"),m(this,"materials"),m(this,"textures"),m(this,"files"),m(this,"document"),m(this,"output"),m(this,"animations"),this.root=e,this.exporter=i,this.quickLookCompatible=s.quickLookCompatible,this.exportInvisible=s.exportInvisible,s.extensions&&(this.extensions=s.extensions),this.materials=new Map,this.textures={},this.files={},this.document=new UF,this.output="",this.animations=[]}}class OF{constructor(){m(this,"ar",{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}}),m(this,"quickLookCompatible",!1),m(this,"extensions",[]),m(this,"maxTextureSize",4096),m(this,"exportInvisible",!1)}}let Mne=class{constructor(){m(this,"debug"),m(this,"pruneUnusedNodes"),m(this,"sceneAnchoringOptions",new OF),m(this,"extensions",[]),m(this,"keepObject"),m(this,"beforeWritingDocument"),this.debug=!1,this.pruneUnusedNodes=!0}async parse(n,e=new OF){var i,s;e=Object.assign(new OF,e),this.sceneAnchoringOptions=e;const r=new hPe(n,this,e);this.extensions=r.extensions;const o=r.files,a="model.usda";o[a]=null;const l=r.materials,c=r.textures;Ei.report("export-usdz","Invoking onBeforeBuildDocument"),await sL(r,"onBeforeBuildDocument"),Ei.report("export-usdz","Done onBeforeBuildDocument"),Ei.report("export-usdz","Reparent bones to common ancestor");const h=[],d=new Set;n?.traverse(v=>{if(!(!e.exportInvisible&&!v.visible)&&v instanceof Ka){const x=v.skeleton.bones,w=Cne(x);if(w){const C={object:v,originalParent:v.parent,newParent:w};h.push(C),d.add(C.object.uuid),C.newParent&&d.add(C.newParent.uuid),C.originalParent&&d.add(C.originalParent.uuid)}}});for(const v of h){const{object:x,originalParent:w,newParent:C}=v;C.add(x)}Ei.report("export-usdz","Traversing hierarchy"),n&&Ine(n,r.document,r,this.keepObject),Ei.report("export-usdz","Invoking onAfterBuildDocument"),await sL(r,"onAfterBuildDocument");const u=r.extensions.find(v=>v.extensionName==="Behaviour"),p=u?.getAllTargetUuids()??new Set;if(this.pruneUnusedNodes){const v={allBehaviorTargets:p,debug:!1,boneReparentings:d,quickLookCompatible:r.quickLookCompatible};this.debug&&Tne(r.document,"Hierarchy BEFORE pruning",v),Ene(r.document,v),this.debug&&Tne(r.document,"Hierarchy AFTER pruning")}else this.debug&&console.log("Pruning of empty nodes is disabled. This may result in a larger USDZ file.");Ei.report("export-usdz",{message:"Parsing document",autoStep:10}),await dPe(r,()=>(Ei.report("export-usdz","Building materials"),vPe(l,c,e.quickLookCompatible))),Ei.report("export-usdz","Invoking onAfterSerialize"),await sL(r,"onAfterSerialize");for(const v of h){const{object:x,originalParent:w,newParent:C}=v;w&&w.add(x)}(s=(i=r.exporter)==null?void 0:i.beforeWritingDocument)==null||s.call(i);const g=r.document.buildHeader(r)+`
`+r.output;this.debug&&console.log(g),o[a]=F2(g),r.output="",Ei.report("export-usdz",{message:"Exporting textures",autoStep:10}),Ei.start("export-usdz-textures",{parentScope:"export-usdz",logTimings:!1});const f=new om({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),A=Object.keys(c).length;Ei.report("export-usdz-textures",{totalSteps:A*3,currentStep:0});const y=async v=>{const x=c[v],w=x.texture,C=Dne.includes(w.format);let S={imageData:w.image};Ei.report("export-usdz-textures",{message:"read back texture",autoStep:!0});const _=x.scale!==void 0&&x.scale.x!==1&&x.scale.y!==1&&x.scale.z!==1&&x.scale.w!==1;(w.isCompressedTexture||w.isRenderTargetTexture||_)&&(S=await uPe(w,e.maxTextureSize,f,x.scale)),Ei.report("export-usdz-textures",{message:"convert texture to canvas",autoStep:!0});const I=await mPe(S.imageBitmap||S.imageData,e.maxTextureSize).catch(B=>{console.error("Error converting texture to canvas",w,B)});if(I){Ei.report("export-usdz-textures",{message:"convert canvas to blob",autoStep:!0});const B=await I.convertToBlob({type:C?"image/png":"image/jpeg",quality:.95});o[`textures/${v}.${C?"png":"jpg"}`]=new Uint8Array(await B.arrayBuffer())}else console.warn("Can`t export texture: ",w)};for(const v in c)await y(v);f.dispose(),Ei.end("export-usdz-textures");let b=0;for(const v in o){const x=o[v],w=34+v.length;b+=w;const C=b&63;if(C!==4){const S=64-C,_=new Uint8Array(S);o[v]=[x,{extra:{12345:_}}]}b=x.length}return Ei.report("export-usdz","zip archive"),$ke(o,{level:0})}};function Ine(n,e,i,s){var r;if(!i.exportInvisible&&!n.visible)return;let o,a,l;const c={position:n.position,quaternion:n.quaternion,scale:n.scale};if(n.position.x===0&&n.position.y===0&&n.position.z===0&&(c.position=null),n.quaternion.x===0&&n.quaternion.y===0&&n.quaternion.z===0&&n.quaternion.w===1&&(c.quaternion=null),n.scale.x===1&&n.scale.y===1&&n.scale.z===1&&(c.scale=null),(n instanceof pe||n instanceof Ka)&&(a=n.geometry,l=n.material),s&&!s(n)&&(a=void 0,l=void 0),(n instanceof pe||n instanceof Ka)&&l&&(l instanceof Us||l instanceof ai||l instanceof ti&&l.type==="MeshLineMaterial")){const h=aL(n),d=n instanceof Ka?n:null;o=new ka(n.uuid,h,c,a,l,void 0,d,n.animations)}else if(n instanceof Ot||n instanceof lh){const h=aL(n);o=new ka(n.uuid,h,c,void 0,void 0,n)}else{const h=aL(n);o=new ka(n.uuid,h,c,void 0,void 0,void 0,void 0,n.animations)}if(o){if(o.displayName=((r=n.userData)==null?void 0:r.name)||n.name,o.visibility=n.visible?void 0:"invisible",e&&e.add(o),e=o,i.extensions)for(const h of i.extensions)h.onExportObject&&h.onExportObject.call(h,n,o,i)}else{const h=aL(n),d=new ka(n.uuid,h,{position:n.position,quaternion:n.quaternion,scale:n.scale});e&&e.add(d),e=d}for(const h of n.children)Ine(h,e,i,s)}function Tne(n,e,...i){const s={};let r=0;function o(a,l){r++;let c=a.displayName||a.name;c+=" ("+a.uuid+")",(a.geometry||a.material||a.camera||a.skinnedMesh)&&(c+=" ("+(a.geometry?"geo, ":"")+(a.material?"mat, ":"")+(a.camera?"cam, ":"")+(a.skinnedMesh?"skin, ":"")+")"),l[c]={};const h={object:a};a.material&&(h.mat=!0),a.geometry&&(h.geo=!0),a.camera&&(h.cam=!0),a.skinnedMesh&&(h.skin=!0),l[c]._self=h;for(const d of a.children)d&&o(d,l[c])}o(n,s),console.log(e+" ("+r+" nodes)",s,...i)}function Ene(n,e){var i;let s=!0;const r=new Array,o=new Array;if(n.children.length===0)s=!0;else{const d=[...n.children];for(const u of d)if(u){const p=Ene(u,e);e.debug&&(p?r.push(u):o.push(u)),s=s&&p}}const a=e.allBehaviorTargets.has(n.uuid),l=n.geometry||n.material||n.camera&&!e.quickLookCompatible||n.skinnedMesh||!1,c=e.boneReparentings.has(n.uuid),h=s&&!a&&!l&&!c;return h?(e.debug&&console.log("Pruned object:",(n.displayName||n.name)+" ("+n.uuid+")",{isVisible:l,isBehaviorSourceOrTarget:a,allChildsWerePruned:s,isBoneReparenting:c,object:n,prunedChilds:r,keptChilds:o}),(i=n.parent)==null||i.remove(n)):e.debug&&console.log("Kept object:",(n.displayName||n.name)+" ("+n.uuid+")",{isVisible:l,isBehaviorSourceOrTarget:a,allChildsWerePruned:s,isBoneReparenting:c,object:n,prunedChilds:r,keptChilds:o}),h}async function dPe(n,e){Ei.start("export-usdz-resources","export-usdz");const i=[];for(const c of n.document.children)Rne(c,n,i);const s=i.length;for(let c=0;c<s;c++)Ei.report("export-usdz-resources",{totalSteps:s,currentStep:c}),await new Promise((h,d)=>{i[c](),h()});Ei.end("export-usdz-resources");const r=new _ne,o=n.exporter.sceneAnchoringOptions.ar;r.beginBlock(`def Xform "${n.document.name}"`),r.beginBlock(`def Scope "Scenes" (
		kind = "sceneLibrary"
	)`),r.beginBlock('def Xform "Scene"',"(",!1),r.appendLine('apiSchemas = ["Preliminary_AnchoringAPI"]'),r.appendLine("customData = {"),r.appendLine("	bool preliminary_collidesWithEnvironment = 0"),r.appendLine('	string sceneName = "Scene"'),r.appendLine("}"),r.appendLine('sceneName = "Scene"'),r.closeBlock(")"),r.beginBlock(),r.appendLine(`token preliminary:anchoring:type = "${o.anchoring.type}"`),o.anchoring.type==="plane"&&r.appendLine(`token preliminary:planeAnchoring:alignment = "${o.planeAnchoring.alignment}"`),o.anchoring.type==="image"&&r.appendLine(`rel preliminary:imageAnchoring:referenceImage = </${n.document.name}/Scenes/Scene/AnchoringReferenceImage>`),r.appendLine();const a=c=>{if(!c)return 0;let h=1;for(const d of c.children)h+=a(d);return h},l=a(n.document);Ei.start("export-usdz-xforms","export-usdz"),Ei.report("export-usdz-xforms",{totalSteps:l,currentStep:1});for(const c of n.document.children)kne(c,r,n);Ei.end("export-usdz-xforms"),Ei.report("export-usdz","invoke onAfterHierarchy"),sL(n,"onAfterHierarchy",r),r.closeBlock(),r.closeBlock(),r.appendLine(e()),r.closeBlock(),Ei.report("export-usdz","write to string"),n.output+=r.toString()}function Rne(n,e,i){if(!n)return;const s=n.geometry,r=n.material;if(s)if(r&&("isMeshStandardMaterial"in r&&r.isMeshStandardMaterial||"isMeshBasicMaterial"in r&&r.isMeshBasicMaterial||r.type==="MeshLineMaterial")){const o="geometries/"+WF(s,n.name)+".usda";if(!(o in e.files)){const a=()=>{var l,c;const h=APe(s,(c=(l=n.skinnedMesh)==null?void 0:l.skeleton)==null?void 0:c.bones,e.quickLookCompatible);e.files[o]=fPe(h)};i.push(a)}}else console.warn("NeedleUSDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",r?.name);r&&(r.uuid in e.materials||(e.materials[r.uuid]=r));for(const o of n.children)Rne(o,e,i)}async function sL(n,e,i=null){if(n.extensions){for(const s of n.extensions)if(s&&typeof s[e]=="function"){const r=s[e].call(s,n,i);r instanceof Promise&&await r}}}let rL=null,Pa=null,ZF,sv,oL;async function uPe(n,e=1/0,i=null,s=void 0){ZF||(ZF=new Xs(2,2,1,1)),sv||(sv=new jt({uniforms:{blitTexture:new Te(n),flipY:new Te(!1),scale:new Te(new $e(1,1,1,1))},vertexShader:`
            varying vec2 vUv;
			uniform bool flipY;
            void main(){
                vUv = uv;
				if (flipY)
					vUv.y = 1. - vUv.y;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture;
			uniform vec4 scale; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
				
				gl_FragColor.rgba *= scale.rgba;
            }`}));const r=sv.uniforms;r.blitTexture.value=n,r.flipY.value=!1,r.scale.value=new $e(1,1,1,1),s!==void 0&&r.scale.value.copy(s),sv.defines.IS_SRGB=n.colorSpace==ut,sv.needsUpdate=!0,oL||(oL=new pe(ZF,sv),oL.frustumCulled=!1);const o=new Ot,a=new ir;a.add(oL),i||(i=rL=new om({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}));const l=Math.min(n.image.width,e),c=Math.min(n.image.height,e);Pa&&(Pa.width!==l||Pa.height!==c)&&(Pa.dispose(),Pa=null),Pa||(Pa=new fi(l,c,{format:_i,type:Xi,minFilter:Wt,magFilter:Wt})),i.setRenderTarget(Pa),i.setSize(l,c),i.clear(),i.render(a,o),rL&&(rL.dispose(),rL=null);const h=new Uint8ClampedArray(Pa.width*Pa.height*4);i.readRenderTargetPixels(Pa,0,0,Pa.width,Pa.height,h);const d=new ImageData(h,Pa.width,Pa.height,void 0),u=await createImageBitmap(d,{premultiplyAlpha:"none"});return{imageData:d,imageBitmap:u}}function pPe(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&n instanceof ImageBitmap}async function mPe(n,e=4096){const i=e/Math.max(n.width,n.height),s=n.width*Math.min(1,i),r=n.height*Math.min(1,i),o=new OffscreenCanvas(s,r),a={premultiplyAlpha:"none"};n.width!==s&&(a.resizeWidth=s),n.height!==r&&(a.resizeHeight=r);const l=await createImageBitmap(n,a),c=o.getContext("bitmaprenderer");return c&&c.transferFromImageBitmap(l),o}async function Lne(n,e=void 0,i=!1,s=4096){if(pPe(n)){const r=s/Math.max(n.width,n.height),o=new OffscreenCanvas(n.width*Math.min(1,r),n.height*Math.min(1,r)),a=o.getContext("2d",{alpha:!0,premultipliedAlpha:!1});if(!a)throw new Error("Could not get canvas 2D context");if(i===!0&&(a.translate(0,o.height),a.scale(1,-1)),a.drawImage(n,0,0,o.width,o.height),e!==void 0){const l=e.x,c=e.y,h=e.z,d=e.w,u=a.getImageData(0,0,o.width,o.height),p=u.data;for(let g=0;g<p.length;g+=4)p[g+0]=p[g+0]*l,p[g+1]=p[g+1]*c,p[g+2]=p[g+2]*h,p[g+3]=p[g+3]*d;a.putImageData(u,0,0)}return o}else throw new Error("NeedleUSDZExporter: No valid image data found. Unable to process texture.")}const qn=7;function gPe(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Needle Engine USDZExporter"
    }
    metersPerUnit = 1
    upAxis = "Y"
)
`}function fPe(n,e){let i=gPe();return i+=n,F2(i)}function aL(n){return n.name.replace(/[-<>\(\)\[\]§$%&\/\\\=\?\,\;]/g,"")+"_"+n.id}function Bne(n){return Xh(n.name||"bone_"+n.uuid)}function WF(n,e){return Xh(n.name||"Geometry")+"_"+n.id}function HF(n){return Xh(n.name||"Material")+"_"+n.id}function rv(n,e){let i=Bne(n),s=n.parent;for(;s&&s!==e;)i=Bne(s)+"/"+i,s=s.parent;return i}function kne(n,e,i){var s;if(n==null)return;Ei.report("export-usdz-xforms",{message:"buildXform "+n.displayName||n.name,autoStep:!0});const r=n.transform,o=n.geometry,a=n.material,l=n.camera,c=n.name;if(n.animations)for(const f of n.animations)i.animations.push(f);const h=o&&o.isBufferGeometry&&o.attributes.skinIndex!==void 0&&o.attributes.skinIndex.count>0,d=h?"SkelRoot":"Xform",u=new Array,p=a&&a instanceof ai&&a.color&&a.color.r===1&&a.color.g===1&&a.color.b===1&&!a.map&&a.opacity===1&&o?.attributes.color;if(o!=null&&o.attributes.color&&!p&&console.warn("NeedleUSDZExporter: Geometry has vertex colors. Vertex colors will only be shown in QuickLook for unlit materials with white color and no texture. Otherwise, they will be ignored.",n.displayName),e.appendLine(),o?(e.beginBlock(`def ${d} "${c}"`,"(",!1),i.quickLookCompatible&&a&&a.side===Qi&&!h?e.appendLine(`prepend references = @./geometries/${WF(o)}.usda@</Geometry_doubleSided>`):e.appendLine(`prepend references = @./geometries/${WF(o)}.usda@</Geometry>`),p||u.push("MaterialBindingAPI"),h&&u.push("SkelBindingAPI")):l&&!i.quickLookCompatible?e.beginBlock(`def Camera "${c}"`,"(",!1):n.type!==void 0?e.beginBlock(`def ${n.type} "${c}"`):e.beginBlock(`def Xform "${c}"`,"(",!1),n.type===void 0&&((s=n.extraSchemas)!=null&&s.length&&u.push(...n.extraSchemas),u.length&&e.appendLine(`prepend apiSchemas = [${u.map(f=>`"${f}"`).join(", ")}]`)),n.displayName&&e.appendLine(`displayName = "${wne(n.displayName)}"`),(l||n.type===void 0)&&(e.closeBlock(")"),e.beginBlock()),o&&a){if(!p){const f=HF(a);e.appendLine(`rel material:binding = </StageRoot/Materials/${f}>`)}!i.quickLookCompatible&&a.side===Qi&&(e.beginBlock('over "Geometry" '),e.appendLine("uniform bool doubleSided = 1"),e.closeBlock())}let g=!1;if(h?(e.appendLine("rel skel:skeleton = <Rig>"),e.appendLine("rel skel:animationSource = <Rig/_anim>"),g=!1):n.type===void 0&&r&&(g=g||r.position!==null||r.quaternion!==null||r.scale!==null,r.position&&(n.needsTranslate=!0,e.appendLine(`double3 xformOp:translate = (${Ri(r.position.x)}, ${Ri(r.position.y)}, ${Ri(r.position.z)})`)),r.quaternion&&(n.needsOrient=!0,e.appendLine(`quatf xformOp:orient = (${Ri(r.quaternion.w)}, ${Ri(r.quaternion.x)}, ${Ri(r.quaternion.y)}, ${Ri(r.quaternion.z)})`)),r.scale&&(n.needsScale=!0,e.appendLine(`double3 xformOp:scale = (${Ri(r.scale.x)}, ${Ri(r.scale.y)}, ${Ri(r.scale.z)})`))),n.visibility!==void 0&&e.appendLine(`token visibility = "${n.visibility}"`),l&&!i.quickLookCompatible&&("isOrthographicCamera"in l&&l.isOrthographicCamera?(e.appendLine(`float2 clippingRange = (${l.near}, ${l.far})`),e.appendLine(`float horizontalAperture = ${((Math.abs(l.left)+Math.abs(l.right))*10).toPrecision(qn)}`),e.appendLine(`float verticalAperture = ${((Math.abs(l.top)+Math.abs(l.bottom))*10).toPrecision(qn)}`),e.appendLine('token projection = "orthographic"')):"isPerspectiveCamera"in l&&l.isPerspectiveCamera&&(e.appendLine(`float2 clippingRange = (${l.near.toPrecision(qn)}, ${l.far.toPrecision(qn)})`),e.appendLine(`float focalLength = ${l.getFocalLength().toPrecision(qn)}`),e.appendLine(`float focusDistance = ${l.focus.toPrecision(qn)}`),e.appendLine(`float horizontalAperture = ${l.getFilmWidth().toPrecision(qn)}`),e.appendLine('token projection = "perspective"'),e.appendLine(`float verticalAperture = ${l.getFilmHeight().toPrecision(qn)}`))),n.onSerialize&&n.onSerialize(e,i),n.type===void 0){const f=new Array;n.needsTranslate&&f.push('"xformOp:translate"'),n.needsOrient&&f.push('"xformOp:orient"'),n.needsScale&&f.push('"xformOp:scale"'),f.length&&e.appendLine(`uniform token[] xformOpOrder = [${f.join(", ")}]`)}if(n.children){e.appendLine();for(const f of n.children)kne(f,e,i)}e.closeBlock()}function Ri(n){return Number.isInteger(n)?n.toString():n.toFixed(10)}function Gne(n){const e=n.elements;return`( ${lL(e,0)}, ${lL(e,4)}, ${lL(e,8)}, ${lL(e,12)} )`}function lL(n,e){return`(${Ri(n[e+0])}, ${Ri(n[e+1])}, ${Ri(n[e+2])}, ${Ri(n[e+3])})`}function APe(n,e=[],i=!0){return`
def "Geometry"
${yPe(n,e,i)}
`}function yPe(n,e=[],i=!0){const s="Geometry",r=n.attributes,o=r.position.count,a=e&&e.length>0,l=[],c=[];let h=new Array,d=r.skinIndex;if(a){const p=[];for(const A of e)A.parent.type!=="Bone"&&(l.push({bone:A,index:e.indexOf(A)}),p.push(A.uuid));for(;p.length<e.length;)for(const A of l){const y=A.bone.children;for(const b of y)p.indexOf(b.uuid)===-1&&e.indexOf(b)!==-1&&(l.push({bone:b,index:e.indexOf(b)}),p.push(b.uuid))}for(const A of Sne(e))l.push({bone:A,index:l.length});const g=l[0].bone.parent;l.sort((A,y)=>rv(A.bone,g)>rv(y.bone,g)?1:-1),l.map(A=>'"'+rv(A.bone,g)+'"').join(", ");for(const A in l)c[l[A].index]=parseInt(A);const f=r.skinIndex;h=new Array;for(let A=0;A<f.count;A++){const y=f.getX(A),b=f.getY(A),v=f.getZ(A),x=f.getW(A);h.push(c[y],c[b],c[v],c[x])}d=new ct(new Uint16Array(h),4)}const u=r.skinWeight&&r.skinIndex;return`
{	
    def Mesh "${s}" ${u?`(
        prepend apiSchemas = ["SkelBindingAPI"]
    )`:""}
    {
        int[] faceVertexCounts = [${QF(n)}]
        int[] faceVertexIndices = [${KF(n)}]
		${r.normal||i?`normal3f[] normals = [${cL(r.normal,o)}] (
            interpolation = "vertex"
        )`:""}
        point3f[] points = [${cL(r.position,o)}]
        ${r.uv?`texCoord2f[] primvars:st = [${Nne(r.uv,o,!0)}] (
            interpolation = "vertex"
        )`:""}
		${r.uv1?YF("st1",r.uv1):""}
		${r.uv2?YF("st2",r.uv2):""}
		${r.uv3?YF("st3",r.uv3):""}
		${u?`matrix4d primvars:skel:geomBindTransform = ( (1, 0, 0, 0), (0, 1, 0, 0), (0, 0, 1, 0), (0, 0, 0, 1) ) (
				elementSize = 1
				interpolation = "constant"
			)`:""}
		${r.skinIndex?`int[] primvars:skel:jointIndices = [${Pne(d,!0)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
		${r.skinWeight?`float[] primvars:skel:jointWeights = [${Pne(r.skinWeight)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
		${r.color?`color3f[] primvars:displayColor = [${cL(r.color,o)}] (
			interpolation = "vertex"
		)`:""}
        uniform token subdivisionScheme = "none"
    }
}
${i?`
# This is a workaround for QuickLook/RealityKit not supporting the doubleSided attribute. We're adding a second
# geometry definition here, that uses the same mesh data but appends extra faces with reversed winding order.
def "${s}_doubleSided" (
	prepend references = </Geometry>
)
{
	over "Geometry"
	{
		int[] faceVertexCounts = [${QF(n)+", "+QF(n)}]
		int[] faceVertexIndices = [${KF(n)+", "+KF(n,!0)}]
	}
}
`:""}
`}function QF(n){const e=n.index!==null?n.index.count:n.attributes.position.count;return Array(Math.floor(e/3)).fill(3).join(", ")}function KF(n,e=!1){const i=n.index,s=[];if(i!==null)for(let r=0;r<i.count;r++){let o=r;e&&(o=r%3===0?r+2:r%3===2?r-2:r),s.push(i.getX(o))}else{const r=n.attributes.position.count;for(let o=0;o<r;o++){let a=o;e&&(a=o%3===0?o+2:o%3===2?o-2:o),s.push(a)}}return s.join(", ")}function YF(n,e){const i=e.itemSize;switch(i){case 2:return`texCoord2f[] primvars:${n} = [${Nne(e,i,!0)}] (
				interpolation = "vertex"
			)`;case 3:return`texCoord3f[] primvars:${n} = [${cL(e,i)}] (
				interpolation = "vertex"
			)`;case 4:return`double4[] primvars:${n} = [${bPe(e,i)}] (
				interpolation = "vertex"
			)`;default:return console.warn("USDZExporter: Attribute with "+i+" components are currently not supported. Results may be undefined for "+n+"."),""}}function cL(n,e){if(n===void 0)return console.warn("USDZExporter: A mesh attribute is missing and will be set with placeholder data. The result may look incorrect."),Array(e).fill("(0, 0, 1)").join(", ");const i=[];for(let s=0;s<n.count;s++){const r=n.getX(s),o=n.getY(s),a=n.getZ(s);i.push(`(${r.toPrecision(qn)}, ${o.toPrecision(qn)}, ${a.toPrecision(qn)})`)}return i.join(", ")}function bPe(n,e){if(n===void 0)return console.warn("USDZExporter: Attribute is missing. Results may be undefined."),Array(e).fill("(0, 0, 0, 0)").join(", ");const i=[];for(let s=0;s<n.count;s++){const r=n.getX(s),o=n.getY(s),a=n.getZ(s)||0,l=n.getW(s)||0;i.push(`(${r.toPrecision(qn)}, ${o.toPrecision(qn)}, ${a.toPrecision(qn)}, ${l.toPrecision(qn)})`)}return i.join(", ")}function Pne(n,e=!1){const i=[];for(let s=0;s<n.count;s++){const r=n.getX(s),o=n.getY(s),a=n.getZ(s),l=n.getW(s);i.push(`${e?r:r.toPrecision(qn)}`),i.push(`${e?o:o.toPrecision(qn)}`),i.push(`${e?a:a.toPrecision(qn)}`),i.push(`${e?l:l.toPrecision(qn)}`)}return i.join(", ")}function Nne(n,e,i=!1){if(n===void 0)return console.warn("USDZExporter: UVs missing."),Array(e).fill("(0, 0)").join(", ");const s=[];for(let r=0;r<n.count;r++){const o=n.getX(r);let a=n.getY(r);i&&(a=1-a),s.push(`(${o.toPrecision(qn)}, ${a.toPrecision(qn)})`)}return s.join(", ")}function vPe(n,e,i=!1){const s=[];for(const r in n){const o=n[r];s.push(xPe(o,e,i))}return`
	def "Materials"
    {
${s.join("")}
    }`}function xPe(n,e,i=!1){var s,r,o;const a=HF(n);if(console.log(n),n.colorWrite===!1||((s=n.userData)==null?void 0:s.isShadowCatcherMaterial)||((r=n.userData)==null?void 0:r.isLightBlendMaterial)){const y=n.userData.isLightBlendMaterial||n.userData.isShadowCatcherMaterial?"ND_realitykit_shadowreceiver_surfaceshader":"ND_realitykit_occlusion_surfaceshader";return`

		def Material "${a}" ${n.name?`(
			displayName = "${n.name}"
		)`:""}
		{
			token outputs:mtlx:surface.connect = ${Ga}/${a}/Occlusion.outputs:out>

			def Shader "Occlusion"
			{
				uniform token info:id = "${y}"
				token outputs:out
			}
		}`}const l="                ",c=[],h=[],d=new Set;function u(y){var b;return Xh(y.name)+"_"+(((b=y.source)==null?void 0:b.id)??y.id)}function p(y,b,v=void 0,x=void 0){const w=u(y),C=w+(x!==void 0&&x!==1?"_"+x:""),S=i&&x!==void 0&&x!==1,_=S?new $e(1,1,1,x):void 0;x===void 0&&(x=1),S&&(x=1),_&&_.w<=.05&&(_.w=.05),e[C]={texture:y,scale:_};const I=y.channel>0?"st"+y.channel:"st";d.add(y.channel);const B=Dne.includes(y.format),M={1e3:"repeat",1001:"clamp",1002:"mirror"},R=y.repeat.clone(),k=y.offset.clone(),G=y.rotation,X=Math.sin(G),F=Math.cos(G);k.y=1-k.y-R.y,i?(R.x===0&&(R.x=1e-4),R.y===0&&(R.y=1e-4),k.x=k.x/R.x,k.y=k.y/R.y,k.x+=X/R.x,k.y+=F-1):(k.x+=X*R.x,k.y+=(1-F)*R.y);const z=R.x!=1||R.y!=1||k.x!=0||k.y!=0||G!=0,H=`${Ga}/${a}/${"uvReader_"+I}.outputs:result>`,Z=`${Ga}/${a}/Transform2d_${b}.outputs:result>`,he=b!=="normal"&&v&&(v.r!==1||v.g!==1||v.b!==1||x!==1)||!1,be=b==="normal",_e=n instanceof Us&&n.normalScale?n.normalScale.x*2:2,Ye=_e.toFixed(qn),je=(-1*(_e/2)).toFixed(qn),le=(1-_e).toFixed(qn);return`
			${z?`def Shader "Transform2d_${b}" (
				sdrMetadata = {
					string role = "math"
				}
			)
			{
				uniform token info:id = "UsdTransform2d"
				float2 inputs:in.connect = ${H}
				float2 inputs:scale = ${Xne(R)}
				float2 inputs:translation = ${Xne(k)}
				float inputs:rotation = ${(G/Math.PI*180).toFixed(qn)}
				float2 outputs:result
			}
			`:""}
			def Shader "${w}_${b}"
			{
				uniform token info:id = "UsdUVTexture"
				asset inputs:file = @textures/${C}.${B?"png":"jpg"}@
				token inputs:sourceColorSpace = "${y.colorSpace==="srgb"?"sRGB":"raw"}"
				float2 inputs:st.connect = ${z?Z:H}
				${he?`
				float4 inputs:scale = (${v?v.r+", "+v.g+", "+v.b:"1, 1, 1"}, ${x})
				`:""}
				${be?`
				float4 inputs:scale = (${Ye}, ${Ye}, ${Ye}, 1)
				float4 inputs:bias = (${je}, ${je}, ${le}, 0)
				`:""}
				token inputs:wrapS = "${M[y.wrapS]}"
				token inputs:wrapT = "${M[y.wrapT]}"
				float outputs:r
				float outputs:g
				float outputs:b
				float3 outputs:rgb
				${n.transparent||n.alphaTest>0?"float outputs:a":""}
			}`}let g=n.transparent||n.alphaTest?n.opacity:1,f=!1,A=!1;if(n instanceof uo&&n.transmission!==void 0&&(g*=1-n.transmission*(1-n.roughness*.5)),n.map?(c.push(`${l}color3f inputs:diffuseColor.connect = ${Ga}/${a}/${u(n.map)}_diffuse.outputs:rgb>`),n instanceof ai&&n.transparent&&n.alphaTest==0&&i?(c.push(`${l}float inputs:opacity.connect = ${Ga}/${a}/${u(n.map)}_diffuse.outputs:a>`),f=!0,c.push(`${l}float inputs:opacityThreshold = ${1e-10}`),A=!0):n.transparent?(c.push(`${l}float inputs:opacity.connect = ${Ga}/${a}/${u(n.map)}_diffuse.outputs:a>`),f=!0):n.alphaTest>0&&(c.push(`${l}float inputs:opacity.connect = ${Ga}/${a}/${u(n.map)}_diffuse.outputs:a>`),f=!0,c.push(`${l}float inputs:opacityThreshold = ${n.alphaTest}`),A=!0),h.push(p(n.map,"diffuse",n.color,g))):c.push(`${l}color3f inputs:diffuseColor = ${Vne(n.color)}`),n.alphaHash&&i&&(A?console.warn("Opacity threshold for "+n.name+" was already connected. Skipping alphaHash opacity threshold."):(c.push(`${l}float inputs:opacityThreshold = 0.0000000001`),A=!0)),n.aoMap&&(c.push(`${l}float inputs:occlusion.connect = ${Ga}/${a}/${u(n.aoMap)}_occlusion.outputs:r>`),h.push(p(n.aoMap,"occlusion"))),n.alphaMap?(c.push(`${l}float inputs:opacity.connect = ${Ga}/${a}/${u(n.alphaMap)}_opacity.outputs:r>`),c.push(`${l}float inputs:opacityThreshold = 0.0000000001`),f=!0,A=!0,h.push(p(n.alphaMap,"opacity",new fe(1,1,1),g))):(f?console.warn("Opacity for "+n.name+" was already connected. Skipping default opacity."):(c.push(`${l}float inputs:opacity = ${g}`),f=!0),n.alphaTest>0&&(A?console.warn("Opacity threshold for "+n.name+" was already connected. Skipping default opacity threshold."):(c.push(`${l}float inputs:opacityThreshold = ${n.alphaTest}`),A=!0))),n instanceof Us){if(n.emissiveMap){c.push(`${l}color3f inputs:emissiveColor.connect = ${Ga}/${a}/${u(n.emissiveMap)}_emissive.outputs:rgb>`);const y=n.emissive.clone();y.multiplyScalar(n.emissiveIntensity),h.push(p(n.emissiveMap,"emissive",y))}else if(((o=n.emissive)==null?void 0:o.getHex())>0){const y=n.emissive.clone();y.multiplyScalar(n.emissiveIntensity),c.push(`${l}color3f inputs:emissiveColor = ${Vne(y)}`)}n.normalMap&&(c.push(`${l}normal3f inputs:normal.connect = ${Ga}/${a}/${u(n.normalMap)}_normal.outputs:rgb>`),h.push(p(n.normalMap,"normal"))),n.roughnessMap&&n.roughness===1?(c.push(`${l}float inputs:roughness.connect = ${Ga}/${a}/${u(n.roughnessMap)}_roughness.outputs:g>`),h.push(p(n.roughnessMap,"roughness"))):c.push(`${l}float inputs:roughness = ${n.roughness!==void 0?n.roughness:1}`),n.metalnessMap&&n.metalness===1?(c.push(`${l}float inputs:metallic.connect = ${Ga}/${a}/${u(n.metalnessMap)}_metallic.outputs:b>`),h.push(p(n.metalnessMap,"metallic"))):c.push(`${l}float inputs:metallic = ${n.metalness!==void 0?n.metalness:0}`)}return n instanceof uo&&(c.push(`${l}float inputs:clearcoat = ${n.clearcoat}`),c.push(`${l}float inputs:clearcoatRoughness = ${n.clearcoatRoughness}`),c.push(`${l}float inputs:ior = ${n.ior}`),!n.transparent&&!(n.alphaTest>0)&&n.transmissionMap&&(c.push(`${l}float inputs:opacity.connect = ${Ga}/${a}/${u(n.transmissionMap)}_transmission.outputs:r>`),h.push(p(n.transmissionMap,"transmission")))),d.size>2?console.warn("USDZExporter: Material "+n.name+" uses more than 2 UV channels. Currently, only UV0 and UV1 are supported."):d.size===2&&(!d.has(0)||!d.has(1))&&console.warn("USDZExporter: Material "+n.name+" uses UV channels other than 0 and 1. Currently, only UV0 and UV1 are supported."),`

		def Material "${a}" ${n.name?`(
			displayName = "${wne(n.name)}"
		)`:""}
		{
			token outputs:surface.connect = ${Ga}/${a}/PreviewSurface.outputs:surface>

			def Shader "PreviewSurface"
			{
				uniform token info:id = "UsdPreviewSurface"
${c.join(`
`)}
				int inputs:useSpecularWorkflow = ${n instanceof ai?"1":"0"}
				token outputs:surface
			}
${h.length>0?`
${d.has(0)?`
			def Shader "uvReader_st"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${d.has(1)?`
			def Shader "uvReader_st1"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st1"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${h.join(`
`)}`:""}
		}`}function Vne(n){return`(${n.r}, ${n.g}, ${n.b})`}function Xne(n){return`(${n.x}, ${n.y})`}const Dne=[1023,33777,33778,33779,35842,35843,37496,37808,37809,37810,37811,37812,37813,37814,37815,37816,37817,37818,37819,37820,37821,36492];q("debugusdz");const zne=class{constructor(n,e,i){m(this,"id"),m(this,"trigger"),m(this,"action"),m(this,"exclusive",!1),this.id="Behavior_"+Xh(n)+"_"+zne.global_id++,this.trigger=e,this.action=i}makeExclusive(n){return this.exclusive=n,this}writeTo(n,e,i){if(!this.trigger||!this.action)return;i.beginBlock(`def Preliminary_Behavior "${this.id}"`);let s="";if(Array.isArray(this.trigger)){s="[";for(let r=0;r<this.trigger.length;r++){const o=this.trigger[r];s+="<"+o.id+">",r+1<this.trigger.length&&(s+=", ")}s+="]"}else s=`<${this.trigger.id}>`;if(i.appendLine(`rel triggers = ${s}`),i.appendLine(`rel actions = <${this.action.id}>`),i.appendLine(`uniform bool exclusive = ${this.exclusive?1:0}`),i.appendLine(),Array.isArray(this.trigger))for(const r of this.trigger)r.writeTo(e,i),i.appendLine();else this.trigger.writeTo(e,i);i.appendLine(),this.action.writeTo(e,i),i.closeBlock()}};let Kr=zne;m(Kr,"global_id",0);const ov=new Set;function jF(n,e){var i,s;let r="";if(Array.isArray(n)){ov.clear();let o="[ ";for(let a=0;a<n.length;a++){let l=n[a];if(!l){console.warn("Invalid target object in behavior",n+". Is the object exported?");continue}if(typeof l=="string"){if(ov.has(l))continue;o+=l,ov.add(l)}else if(typeof l=="object"){if(l.isObject3D&&(l=e.findById(l.uuid),!l)){console.warn("Invalid target object in behavior",n+". Is the object exported?");continue}const c=(i=l.getPath)==null?void 0:i.call(l);if(ov.has(c))continue;o+=c,ov.add(c)}a+1<n.length&&(o+=", ")}o+=" ]",r=o,ov.clear()}else if(typeof n=="object"){const o=n;if(o.isObject3D&&(n=e.findById(o.uuid)),!n)throw console.error("Invalid target object in behavior, the target object is likely missing from USDZ export. Is the object exported?",o),new Error(`Invalid target object in behavior, the target object is likely missing from USDZ export. Please report a bug. uuid: ${o.uuid}.`);r=(s=n.getPath)==null?void 0:s.call(n)}return r}const Fne=class{constructor(n,e){m(this,"id"),m(this,"targetId"),m(this,"tokenId"),m(this,"type"),m(this,"distance"),n&&(this.targetId=n),e?this.id=e:this.id="Trigger_"+Fne.global_id++}writeTo(n,e){e.beginBlock(`def Preliminary_Trigger "${this.id}"`),this.targetId&&(typeof this.targetId!="string"&&(this.targetId=jF(this.targetId,n)),e.appendLine("rel affectedObjects = "+this.targetId)),this.tokenId&&e.appendLine(`token info:id = "${this.tokenId}"`),this.type&&e.appendLine(`token type = "${this.type}"`),typeof this.distance=="number"&&e.appendLine(`double distance = ${this.distance}`),e.closeBlock()}};let sg=Fne;m(sg,"global_id",0);function Une(n,e={direct:!0,indirect:!0}){const i=ka.createEmpty();i.name="InputTarget_"+i.name,i.displayName=void 0,i.type="RealityKitComponent",i.onSerialize=s=>{s.appendLine("bool allowsDirectInput = "+(e.direct?1:0)),s.appendLine("bool allowsIndirectInput = "+(e.indirect?1:0)),s.appendLine('uniform token info:id = "RealityKit.InputTarget"')},n.add(i)}class Yr{static sceneStartTrigger(){const e=new sg;return e.targetId=void 0,e.tokenId="SceneTransition",e.type="enter",e}static tapTrigger(e,i={direct:!0,indirect:!0}){const s=new sg(e);if(Array.isArray(e)&&e.length>1)for(const r of e)r instanceof ka&&Une(r,i);else e instanceof ka&&Une(e,i);return s.tokenId="TapGesture",s}static isTapTrigger(e){return e?.tokenId==="TapGesture"}static proximityToCameraTrigger(e,i){const s=new sg(e);return s.tokenId="ProximityToCamera",s.distance=i,s}}class cp{constructor(e,i){m(this,"id"),m(this,"actions"),m(this,"loops",0),m(this,"performCount",1),m(this,"type","serial"),m(this,"multiplePerformOperation"),this.id=e,this.actions=i}static getId(){return this.global_id++}addAction(e){return this.actions.push(e),this}makeParallel(){return this.type="parallel",this}makeSequence(){return this.type="serial",this}makeLooping(){return this.loops=1,this.performCount=0,this}makeRepeat(e){return this.performCount=e,this}writeTo(e,i){i.beginBlock(`def Preliminary_Action "${this.id}"`),i.beginArray("rel actions");for(const s of this.actions){if(!s)continue;const r=s===this.actions[this.actions.length-1];i.appendLine("<"+s.id+">"+(r?"":", "))}i.closeArray(),i.appendLine(),i.appendLine('token info:id = "Group"'),i.appendLine(`bool loops = ${this.loops}`),i.appendLine(`int performCount = ${this.loops>0?0:Math.max(0,this.performCount)}`),i.appendLine(`token type = "${this.type}"`),typeof this.multiplePerformOperation=="string"&&i.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),i.appendLine();for(const s of this.actions)s&&(s.writeTo(e,i),i.appendLine());i.closeBlock()}}m(cp,"global_id",0);const JF=class{constructor(n,e){m(this,"id"),m(this,"tokenId"),m(this,"affectedObjects"),m(this,"easeType"),m(this,"motionType"),m(this,"duration"),m(this,"moveDistance"),m(this,"style"),m(this,"type"),m(this,"front"),m(this,"up"),m(this,"start"),m(this,"animationSpeed"),m(this,"reversed"),m(this,"pingPong"),m(this,"xFormTarget"),m(this,"audio"),m(this,"gain"),m(this,"auralMode"),m(this,"multiplePerformOperation"),m(this,"velocity"),m(this,"comment"),m(this,"animationName"),n&&(this.affectedObjects=n),e?this.id=e:this.id="Action",this.id+="_"+JF.global_id++}clone(){const n=new JF,e=n.id;return Object.assign(n,this),n.id=e,n}writeTo(n,e){e.beginBlock(`def Preliminary_Action "${this.id}"`),this.comment&&e.appendLine(`# ${this.comment}`),this.affectedObjects&&(typeof this.affectedObjects!="string"&&(this.affectedObjects=jF(this.affectedObjects,n)),e.appendLine("rel affectedObjects = "+this.affectedObjects)),typeof this.duration=="number"&&(typeof this.animationSpeed=="number"&&this.animationSpeed!==1?e.appendLine(`double duration = ${this.duration/this.animationSpeed} `):e.appendLine(`double duration = ${this.duration} `)),this.easeType&&e.appendLine(`token easeType = "${this.easeType}"`),this.tokenId&&e.appendLine(`token info:id = "${this.tokenId}"`),this.tokenId==="ChangeScene"&&e.appendLine("rel scene = </StageRoot/Scenes/Scene>"),this.motionType!==void 0&&e.appendLine(`token motionType = "${this.motionType}"`),typeof this.moveDistance=="number"&&e.appendLine(`double moveDistance = ${this.moveDistance} `),this.style&&e.appendLine(`token style = "${this.style}"`),this.type&&e.appendLine(`token type = "${this.type}"`),this.front&&e.appendLine(`vector3d front = (${this.front.x}, ${this.front.y}, ${this.front.z})`),this.up&&e.appendLine(`vector3d upVector = (${this.up.x}, ${this.up.y}, ${this.up.z})`),typeof this.start=="number"&&e.appendLine(`double start = ${this.start} `),typeof this.animationSpeed=="number"&&e.appendLine(`double animationSpeed = ${this.animationSpeed.toFixed(2)} `),typeof this.reversed=="boolean"&&e.appendLine(`bool reversed = ${this.reversed}`),typeof this.pingPong=="boolean"&&e.appendLine(`bool reverses = ${this.pingPong}`),this.xFormTarget&&(typeof this.xFormTarget!="string"&&(this.xFormTarget=jF(this.xFormTarget,n)),e.appendLine(`rel xformTarget = ${this.xFormTarget}`)),typeof this.audio=="string"&&e.appendLine(`asset audio = @${this.audio}@`),typeof this.gain=="number"&&e.appendLine(`double gain = ${this.gain}`),typeof this.auralMode=="string"&&e.appendLine(`token auralMode = "${this.auralMode}"`),typeof this.multiplePerformOperation=="string"&&e.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),typeof this.velocity=="object"&&e.appendLine(`vector3d velocity = (${this.velocity.x}, ${this.velocity.y}, ${this.velocity.z})`),e.closeBlock()}};let Wl=JF;m(Wl,"global_id",0);let av=class xx{constructor(e,i,s){m(this,"x",0),m(this,"y",0),m(this,"z",0),this.x=e,this.y=i,this.z=s}static get up(){return new xx(0,1,0)}static get right(){return new xx(1,0,0)}static get forward(){return new xx(0,0,1)}static get back(){return new xx(0,0,-1)}static get zero(){return new xx(0,0,0)}};class Wi{static sequence(...e){return new cp("Group_"+cp.getId(),e).makeSequence()}static parallel(...e){return new cp("Group_"+cp.getId(),e).makeParallel()}static fadeAction(e,i,s){const r=new Wl(e);return r.tokenId="Visibility",r.type=s?"show":"hide",r.duration=i,r.style="basic",r.motionType="none",r.moveDistance=0,r.easeType="none",r}static startAnimationAction(e,i,s=!1,r=!1){const o=new Wl(e);o.tokenId="StartAnimation";const a=i.start,l=i.duration,c=i.speed,h=i.clipName;if(o.comment=`Animation: ${h}, start=${a*60}, length=${l*60}, end=${(a+l)*60}`,o.animationName=h,o.start=a,o.duration=l,o.animationSpeed=c,o.reversed=s,o.pingPong=r,o.multiplePerformOperation="allow",s&&(o.start-=l),r){o.pingPong=!1;const d=o.clone();return d.reversed=!s,d.start=o.start,d.reversed&&(d.start-=l),Wi.sequence(o,d)}return o}static waitAction(e){const i=new Wl;return i.tokenId="Wait",i.duration=e,i.motionType=void 0,i}static lookAtCameraAction(e,i,s,r){const o=new Wl(e);return o.tokenId="LookAtCamera",o.duration=i===void 0?9999999999999:i,o.front=s??av.forward,o.up=r??av.up,o}static emphasize(e,i,s="bounce",r=1,o="basic"){const a=new Wl(e);return a.tokenId="Emphasize",a.duration=i,a.style=o??"basic",a.motionType=s,a.moveDistance=r,a}static transformAction(e,i,s,r,o="inout"){const a=new Wl(e);return a.tokenId="Transform",a.duration=s,a.duration=Math.max(1e-6,s),a.type=r,a.easeType=s>0?o:"none",Array.isArray(i)&&console.error("Transform target must not be an array",i),a.xFormTarget=i,a}static playAudioAction(e,i,s="play",r=1,o="spatial"){const a=new Wl(e);return a.tokenId="Audio",a.type=s,a.audio=i,a.gain=r,a.auralMode=o,a.multiplePerformOperation="allow",a}static impulseAction(e,i){const s=new Wl(e);return s.tokenId="Impulse",s.velocity=i,s}}class wPe{constructor(e){m(this,"object"),m(this,"model"),this.object=e}get id(){return this.object.uuid}apply(e){if(!this.model&&(this.model=e.findById(this.object.uuid),!this.model)){console.error("could not find model with id "+this.object.uuid);return}this.onApply(e)}}class qF extends wPe{constructor(e,i,s,r){super(e),m(this,"matrix"),m(this,"material"),m(this,"geometry"),m(this,"_enableAction"),m(this,"_disableAction"),this.matrix=i,this.material=s,this.geometry=r}onApply(e){var i,s;const r=this.model;if(!r)return;(i=r.parent)!=null&&i.isDynamic||ka.createEmptyParent(r);const o=r.clone();this.matrix&&o.setMatrix(this.matrix),this.material&&(o.material=this.material),this.geometry&&(o.geometry=this.geometry),(s=r.parent)==null||s.add(o)}enable(){return this._enableAction?this._enableAction:(this._enableAction=Wi.fadeAction(this.object,0,!0),this._enableAction)}disable(){return this._disableAction?this._disableAction:(this._disableAction=Wi.fadeAction(this.object,0,!1),this._disableAction)}}class $F{constructor(e){m(this,"actions"),m(this,"sortedActions"),this.actions=[...e]}organize(){this.sortedActions={};for(const e of this.actions){const i=e.id;this.sortedActions[i]||(this.sortedActions[i]=[]),this.sortedActions[i].push(e)}}getActions(e){return this.sortedActions||this.organize(),this.sortedActions[e.uuid]}}const lv=function(n){return T(n)},T=function(n){if(n===void 0&&(n=null),!Array.isArray(n))n=One(n);else for(let e=0;e<n.length;e++){const i=n[e];n[e]=One(i)}return function(e,i){typeof i!="string"&&(i=i.name),Object.getOwnPropertyDescriptor(e,"$serializedTypes")||(e.$serializedTypes={});const s=e.$serializedTypes=e.$serializedTypes||{};s[i]=n}};function One(n){var e,i;switch((i=(e=n?.prototype)==null?void 0:e.constructor)==null?void 0:i.name){case"Number":case"String":case"Boolean":return null}return n}class $ extends Ae{constructor(){super(...arguments),m(this,"guid")}static isDestroyed(e){return G0(e)}static setActive(e,i,s=!0){e&&(GC(e,i),m2(e),i&&s&&xte($t.Current,e))}static isActiveSelf(e){return Qb(e)}static isActiveInHierarchy(e){return oie(e)}static markAsInstancedRendered(e,i){aie(e,i)}static isUsingInstancing(e){return E2(e)}static foreachComponent(e,i,s=!0){return P0(e,i,s)}static instantiateSynced(e,i){return e?Hz(e,i):null}static instantiate(e,i=null){return Yb(e,i)}static destroySynced(e,i,s=!0){if(!e)return;const r=e;i=i??$t.Current,SC(r,i.connection,s)}static destroy(e,i=!0){return Ol(e,i)}static add(e,i,s){if(!(!e||!i)){if(e===i){console.warn("Can not add object to self",e);return}s||(s=$t.Current),i.add(e),GC(e,!0),m2(e),s?$.foreachComponent(e,r=>{Xz(r,s),!r.__internalDidAwakeAndStart&&s.new_script_start.includes(r)===!1&&s.new_script_start.push(r)},!0):console.warn("Missing context")}}static remove(e){var i;e&&((i=e.parent)==null||i.remove(e),GC(e,!1),m2(e),$.foreachComponent(e,s=>{BBe(s)},!0))}static invokeOnChildren(e,i,...s){this.invoke(e,i,!0,s)}static invoke(e,i,s=!1,...r){e&&this.foreachComponent(e,o=>{const a=o[i];a&&typeof a=="function"&&a?.call(o,...r)},s)}static addNewComponent(e,i,s,r=!0){return Ul(e,i,s,{callAwake:r})}static addComponent(e,i,s,r){return Ul(e,i,s,r)}static moveComponent(e,i){return Ul(e,i)}static removeComponent(e){return sF(e.gameObject,e),e}static getOrAddComponent(e,i){return RC(e,i)}static getComponent(e,i){return e===null?null:k0(e,i)}static getComponents(e,i,s=null){return e===null?s??[]:LC(e,i,s)}static findByGuid(e,i){return rF(e,i)}static findObjectOfType(e,i,s=!0){return _2(e,i??$t.Current,s)}static findObjectsOfType(e,i){const s=[];return sie(e,s,i),s}static getComponentInChildren(e,i){return BC(e,i)}static getComponentsInChildren(e,i,s=null){return Hb(e,i,s??void 0)}static getComponentInParent(e,i){return kC(e,i)}static getComponentsInParent(e,i,s=null){return S2(e,i,s)}static getAllComponents(e){var i;const s=(i=e.userData)==null?void 0:i.components;return s?[...s]:[]}static*iterateComponents(e){var i;const s=(i=e?.userData)==null?void 0:i.components;if(s&&Array.isArray(s))for(let r=0;r<s.length;r++)yield s[r]}}var rg;let Oe=(rg=class{constructor(n){m(this,"__context"),m(this,"__name"),m(this,"gameObject"),m(this,"guid","invalid"),m(this,"sourceId"),m(this,"__didAwake",!1),m(this,"__didStart",!1),m(this,"__didEnable",!1),m(this,"__isEnabled"),m(this,"__destroyed",!1),m(this,"_eventListeners",new Map),this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(n)}get isComponent(){return!0}get context(){return this.__context??$t.Current}set context(n){this.__context=n}get scene(){return this.context.scene}get layer(){var n,e;return(e=(n=this.gameObject)==null?void 0:n.userData)==null?void 0:e.layer}get name(){var n,e;return(n=this.gameObject)!=null&&n.name?this.gameObject.name:(e=this.gameObject)==null?void 0:e.userData.name}set name(n){this.gameObject?(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.name=n,this.__name=n):this.__name=n}get tag(){var n;return(n=this.gameObject)==null?void 0:n.userData.tag}set tag(n){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.tag=n)}get static(){var n;return(n=this.gameObject)==null?void 0:n.userData.static}set static(n){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.static=n)}get hideFlags(){var n;return(n=this.gameObject)==null?void 0:n.userData.hideFlags}get activeAndEnabled(){return!(this.destroyed||this.__isEnabled===!1||!this.__isActiveInHierarchy)}get __isActive(){return this.gameObject.visible}get __isActiveInHierarchy(){if(!this.gameObject)return!1;const n=this.gameObject[Du];return n===void 0?!0:n}set __isActiveInHierarchy(n){this.gameObject&&(this.gameObject[Du]=n)}awake(){}onEnable(){}onDisable(){}onDestroy(){this.__destroyed=!0}startCoroutine(n,e=_n.Update){return this.context.registerCoroutineUpdate(this,n,e)}stopCoroutine(n,e=_n.Update){this.context.unregisterCoroutineUpdate(n,e)}get destroyed(){return this.__destroyed}destroy(){this.__destroyed||this.__internalDestroy()}get __internalDidAwakeAndStart(){return this.__didAwake&&this.__didStart}__internalNewInstanceCreated(n){return this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(n),this}_internalInit(n){if(typeof n=="object")for(const e of Object.keys(n)){const i=n[e];typeof i!="function"&&(this[e]=i)}}__internalAwake(){this.__didAwake||(this.__didAwake=!0,this.awake())}__internalStart(){this.__didStart||(this.__didStart=!0,this.start&&this.start())}__internalEnable(n){return this.__destroyed?(Je()&&console.warn("[Needle Engine Dev] Trying to enable destroyed component"),!1):this.__didAwake?this.__didEnable?(n!==!0&&(this.__isEnabled=!0),!1):(this.__didEnable=!0,this.__isEnabled=!0,this.onEnable(),!0):!1}__internalDisable(n){if(this.__didAwake){if(!this.__didEnable){n!==!0&&(this.__isEnabled=!1);return}this.__didEnable=!1,this.__isEnabled=!1,this.onDisable()}}__internalDestroy(){var n;this.__destroyed||(this.__destroyed=!0,this.__didAwake&&((n=this.onDestroy)==null||n.call(this),this.dispatchEvent(new CustomEvent("destroyed",{detail:this}))),tie(this))}get enabled(){return typeof this.__isEnabled=="boolean"?this.__isEnabled:!0}set enabled(n){if(this.__destroyed){Je()&&console.warn(`[Needle Engine Dev] Trying to ${n?"enable":"disable"} destroyed component`);return}if(typeof n=="number"&&(n>=.5?n=!0:n=!1),!this.__didAwake){this.__isEnabled=n;return}n?this.__internalEnable():this.__internalDisable()}get worldPosition(){return ri(this.gameObject)}set worldPosition(n){Cr(this.gameObject,n)}setWorldPosition(n,e,i){o0(this.gameObject,n,e,i)}get worldQuaternion(){return fn(this.gameObject)}set worldQuaternion(n){Ic(this.gameObject,n)}setWorldQuaternion(n,e,i,s){aD(this.gameObject,n,e,i,s)}get worldEuler(){return cD(this.gameObject)}set worldEuler(n){hD(this.gameObject,n)}get worldRotation(){return this.gameObject.worldRotation}set worldRotation(n){this.setWorldRotation(n.x,n.y,n.z,!0)}setWorldRotation(n,e,i,s=!0){Cw(this.gameObject,n,e,i,s)}get forward(){return rg._forward.set(0,0,-1).applyQuaternion(this.worldQuaternion)}get right(){return rg._right.set(1,0,0).applyQuaternion(this.worldQuaternion)}get up(){return rg._up.set(0,1,0).applyQuaternion(this.worldQuaternion)}addEventListener(n,e){this._eventListeners[n]=this._eventListeners[n]||[],this._eventListeners[n].push(e)}removeEventListener(n,e){if(!this._eventListeners[n])return;const i=this._eventListeners[n].indexOf(e);i>=0&&this._eventListeners[n].splice(i,1)}dispatchEvent(n){if(!n||!this._eventListeners[n.type])return!1;const e=this._eventListeners[n.type];for(let i=0;i<e.length;i++)e[i](n);return!1}},m(rg,"_forward",new E),m(rg,"_right",new E),m(rg,"_up",new E),rg);const CPe=Object.freeze(Object.defineProperty({__proto__:null,Behaviour:Oe,Component:Oe,GameObject:$},Symbol.toStringTag,{value:"Module"}));var SPe=Object.defineProperty,_Pe=Object.getOwnPropertyDescriptor,Zne=(n,e,i,s)=>{for(var r=s>1?void 0:s?_Pe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&SPe(e,i,r),r};class KC extends Oe{constructor(){super(...arguments),m(this,"from"),m(this,"to"),m(this,"width",0),m(this,"centered",!0),m(this,"_centerPos")}awake(){this._centerPos=new E}update(){if(!this.from||!this.to)return;const e=ri(this.from).clone(),i=ri(this.to).clone(),s=e.distanceTo(i);this._centerPos.copy(e),this._centerPos.add(i),this._centerPos.multiplyScalar(.5),Cr(this.gameObject,this.centered?this._centerPos:e),this.gameObject.lookAt(ri(this.to).clone()),this.gameObject.scale.set(this.width,this.width,s)}}Zne([T($)],KC.prototype,"from",2),Zne([T($)],KC.prototype,"to",2);var MPe=Object.defineProperty,IPe=Object.getOwnPropertyDescriptor,F0=(n,e,i,s)=>{for(var r=s>1?void 0:s?IPe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&MPe(e,i,r),r};const og=q("debuganimation");let Wne=class{constructor(){m(this,"x"),m(this,"y")}};class ra extends Oe{constructor(){super(...arguments),m(this,"playAutomatically",!0),m(this,"randomStartTime",!0),m(this,"minMaxSpeed"),m(this,"minMaxOffsetNormalized"),m(this,"loop",!0),m(this,"clampWhenFinished",!1),m(this,"_tempAnimationClipBeforeGameObjectExisted",null),m(this,"_tempAnimationsArray"),m(this,"mixer"),m(this,"_actions"),m(this,"_handles")}get isAnimationComponent(){return!0}addClip(e){this.animations||(this.animations=[]),this.animations.push(e)}get time(){if(this.actions){for(const e of this.actions)if(e.isRunning())return e.time}return 0}set time(e){if(this.actions)for(const i of this.actions)i.time=e}get clip(){var e;return(e=this.animations)!=null&&e.length?this.animations[0]:null}set clip(e){if(!this.__didAwake){og&&console.warn("Assign clip during serialization",e),this._tempAnimationClipBeforeGameObjectExisted=e;return}e&&(this.gameObject.animations||(this.gameObject.animations=[]),!this.animations.includes(e)&&(this.animations.length>0?this.animations.splice(0,0,e):this.animations.push(e)))}set clips(e){this.animations=e}set animations(e){e==null||!Array.isArray(e)||(this.gameObject?this.gameObject.animations=e:this._tempAnimationsArray=e)}get animations(){return this.gameObject.animations||this._tempAnimationsArray||[]}get actions(){return this._actions}set actions(e){this._actions=e}awake(){this.mixer=void 0,og&&console.log("Animation Awake",this.name,this),this._tempAnimationsArray&&(this.animations=this._tempAnimationsArray,this._tempAnimationsArray=void 0),this._tempAnimationClipBeforeGameObjectExisted&&(this.clip=this._tempAnimationClipBeforeGameObjectExisted,this._tempAnimationClipBeforeGameObjectExisted=null),this.actions=[],this._handles=[]}onEnable(){var e;if(this.playAutomatically&&((e=this.animations)==null?void 0:e.length)>0){const i=Math.floor(Math.random()*this.animations.length),s=this.animations[i];this.play(i,{exclusive:!0,fadeDuration:0,startTime:this.randomStartTime?Math.random()*s.duration:0,loop:this.loop,clampWhenFinished:this.clampWhenFinished})}}update(){this.mixer&&(this.mixer.update(this.context.time.deltaTime),this._handles.forEach(e=>e.update()))}onDisable(){this.mixer&&this.mixer.stopAllAction()}onDestroy(){this.context.animations.unregisterAnimationMixer(this.mixer)}getAction(e){var i;return((i=this.actions)==null?void 0:i.find(s=>s.getClip().name===e))||null}get isPlaying(){if(this.actions){for(let e=0;e<this.actions.length;e++)if(this.actions[e].isRunning())return!0}return!1}stopAll(e){if(this.actions)for(const i of this.actions)e!=null&&e.fadeDuration?i.fadeOut(e.fadeDuration):i.stop()}stop(e,i){if(e===void 0){this.stopAll();return}else if(typeof e=="number"){if(e>=this.animations.length){og&&console.log("No animation at index",e);return}e=this.animations[e]}else typeof e=="string"&&(e=this.animations.find(r=>r.name===e));if(!e){console.error("Could not find clip",e);return}const s=this.actions.find(r=>r.getClip()===e);if(!s){console.error("Could not find action",e);return}i!=null&&i.fadeDuration?s.fadeOut(i.fadeDuration):s.stop()}pause(e,i=!1){if(e===void 0){for(const r of this.actions)r.paused=!i;return}else if(typeof e=="number"){if(e>=this.animations.length){og&&console.log("No animation at index",e);return}e=this.animations[e]}else typeof e=="string"&&(e=this.animations.find(r=>r.name===e));if(!e){console.error("Could not find clip",e);return}const s=this.actions.find(r=>r.getClip()===e);if(!s){console.error("Could not find action",e);return}s.paused=!i}resume(){for(const e of this.actions)e.paused=!1}play(e=0,i){if(og&&console.log("PLAY",e),this.ensureMixer(),!this.mixer){og&&console.warn("Missing mixer",this);return}e===void 0&&(e=0);let s=e;if(typeof e=="number"){if(e>=this.animations.length){og&&console.log("No animation at index",e);return}s=this.animations[e]}else typeof e=="string"&&(s=this.animations.find(o=>o.name===e));if(!s){console.error("Could not find clip",e);return}i||(i={});for(const o of this.actions)if(o.getClip()===s)return this.internalOnPlay(o,i);if(!s.tracks){console.warn("Clip is no AnimationClip",s);return}const r=this.mixer.clipAction(s);return this.actions.push(r),this.internalOnPlay(r,i)}internalOnPlay(e,i){var s=this.actions.find(o=>o===e);if(s===e&&s.isRunning()&&s.time<s.getClip().duration){const o=this.tryFindHandle(e);if(s.paused&&(s.paused=!1),o)return o.waitForFinish()}if(i.loop===void 0&&(i.loop=this.loop),i.clampWhenFinished===void 0&&(i.clampWhenFinished=this.clampWhenFinished),i.minMaxOffsetNormalized===void 0&&this.randomStartTime&&(i.minMaxOffsetNormalized=this.minMaxOffsetNormalized),i.minMaxSpeed===void 0&&(i.minMaxSpeed=this.minMaxSpeed),i?.exclusive??!0)for(const o of this.actions)o!=s&&(i.fadeDuration?o.fadeOut(i.fadeDuration):o.stop());if(i!=null&&i.fadeDuration&&e.fadeIn(i.fadeDuration),e.enabled=!0,i?.startTime!=null)e.time=i.startTime;else if(i!=null&&i.minMaxOffsetNormalized&&i.minMaxOffsetNormalized.x!=0&&i.minMaxOffsetNormalized.y!=0){const o=e.getClip();e.time=lt.lerp(i.minMaxOffsetNormalized.x,i.minMaxOffsetNormalized.y,Math.random())*o.duration}else e.time>=e.getClip().duration&&(e.time=0);i!=null&&i.minMaxSpeed?e.timeScale=lt.lerp(i.minMaxSpeed.x,i.minMaxSpeed.y,Math.random()):e.timeScale=i?.speed??1,i?.loop!=null?e.loop=i.loop?AG:zx:e.loop=zx,i!=null&&i.clampWhenFinished&&(e.clampWhenFinished=!0),e.paused=!1,e.play(),og&&console.log("PLAY",e.getClip().name,e);const r=new TPe(e,this.mixer,i,o=>{this._handles.splice(this._handles.indexOf(r),1)});return this._handles.push(r),r.waitForFinish()}tryFindHandle(e){for(const i of this._handles)if(i.action===e)return i}ensureMixer(){if(!this.mixer){const e="animationMixer";this.gameObject[e]&&(this.mixer=this.gameObject[e]),(!this.mixer||!this.mixer.clipAction)&&(this.mixer=new xT(this.gameObject),this.gameObject[e]=this.mixer)}this.context.animations.registerAnimationMixer(this.mixer)}}F0([T()],ra.prototype,"playAutomatically",2),F0([T()],ra.prototype,"randomStartTime",2),F0([T(Wne)],ra.prototype,"minMaxSpeed",2),F0([T(Wne)],ra.prototype,"minMaxOffsetNormalized",2),F0([T()],ra.prototype,"loop",2),F0([T()],ra.prototype,"clampWhenFinished",2),F0([T(wa)],ra.prototype,"clips",1);class TPe{constructor(e,i,s,r){m(this,"mixer"),m(this,"action"),m(this,"promise",null),m(this,"_options"),m(this,"_resolveCallback",null),m(this,"_resolvedOrRejectedCallback"),m(this,"onFinished",o=>{o.action===this.action&&this.onResolve()}),this.action=e,this.mixer=i,this._resolvedOrRejectedCallback=r,this._options=s}waitForFinish(){return this.promise?this.promise:(this.promise=new Promise(e=>{this._resolveCallback=e}),this.mixer.addEventListener("finished",this.onFinished),this.promise)}update(){this._options&&this._options.endTime!==void 0&&this.action.time>this._options.endTime&&(this._options.loop===!0?this.action.time=this._options.startTime??0:(this.action.time=this._options.endTime,this.action.timeScale=0,this.onResolve()))}onResolve(){var e,i;this.dispose(),(e=this._resolvedOrRejectedCallback)==null||e.call(this,this),(i=this._resolveCallback)==null||i.call(this,this.action)}dispose(){this.mixer.removeEventListener("finished",this.onFinished)}}var EPe=Object.defineProperty,RPe=Object.getOwnPropertyDescriptor,ag=(n,e,i,s)=>{for(var r=s>1?void 0:s?RPe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&EPe(e,i,r),r};class Na{constructor(e=0,i=0){m(this,"time",0),m(this,"value",0),m(this,"inTangent",1/0),m(this,"inWeight"),m(this,"outTangent",1/0),m(this,"outWeight"),m(this,"weightedMode"),this.time=e,this.value=i}}ag([T()],Na.prototype,"time",2),ag([T()],Na.prototype,"value",2),ag([T()],Na.prototype,"inTangent",2),ag([T()],Na.prototype,"inWeight",2),ag([T()],Na.prototype,"outTangent",2),ag([T()],Na.prototype,"outWeight",2),ag([T()],Na.prototype,"weightedMode",2);const YC=class{constructor(){m(this,"keys",[])}static linearFromTo(n,e,i){const s=new YC,r=new Na;r.time=0,r.value=n;const o=new Na;return o.time=i,o.value=e,s.keys.push(r,o),s}static constant(n){const e=new YC,i=new Na;return i.time=0,i.value=n,e.keys.push(i),e}clone(){var n;const e=new YC;return e.keys=((n=this.keys)==null?void 0:n.map(i=>{const s=new Na;return s.time=i.time,s.value=i.value,s.inTangent=i.inTangent,s.inWeight=i.inWeight,s.outTangent=i.outTangent,s.outWeight=i.outWeight,s.weightedMode=i.weightedMode,s}))||[],e}get duration(){return!this.keys||this.keys.length==0?0:this.keys[this.keys.length-1].time}evaluate(n){if(!this.keys||this.keys.length==0)return 0;if(this.keys.length===1)return this.keys[0].value;if(this.keys[0].time>=n)return this.keys[0].value;for(let e=0;e<this.keys.length;e++){const i=this.keys[e];if(i.time<=n)if(e+1<this.keys.length){const s=this.keys[e+1];if(s.time<n)continue;return!isFinite(i.outTangent)||!isFinite(s.inTangent)?i.value:YC.interpolateValue(n,i,s)}else return i.value}return this.keys[this.keys.length-1].value}static interpolateValue(n,e,i){const s=e.time,r=e.value,o=e.outTangent,a=i.time,l=i.value,c=i.inTangent,h=a-s,d=h*h,u=d*h,p=((o+c)*h-2*(l-r))/u,g=(3*(l-r)-(c+2*o)*h)/d,f=o,A=r,y=n-s,b=y*y,v=b*y;return p*v+g*b+f*y+A}};let U0=YC;ag([T(Na)],U0.prototype,"keys",2);const hL=Symbol("objectIsAnimatedData");function Hne(n,e,i){if(!n)return;if(n[hL]===void 0){if(!i)return;n[hL]=new Set}const s=n[hL];i?s.add(e):s.has(e)&&s.delete(e)}function LPe(n){if(!n)return!1;const e=n[hL];return e!==void 0&&e.size>0}class BPe{constructor(){m(this,"_context")}get context(){return this._context??$t.Current}get isStateMachineBehaviour(){return!0}}class jC{constructor(e,i,s,r){m(this,"name"),m(this,"nameHash"),m(this,"normalizedTime"),m(this,"length"),m(this,"speed"),m(this,"action"),m(this,"hasTransitions");var o;this.name=e.name,this.nameHash=e.hash,this.normalizedTime=i,this.length=s,this.speed=r,this.action=e.motion.action||null,this.hasTransitions=((o=e.transitions)==null?void 0:o.length)>0||!1}}function Qne(n,e){return{name:"Empty",isLooping:!1,guid:e?.generateUUID()??Di.generateUUID(),index:-1,clip:new wa(n,0,[])}}var lg=(n=>(n[n.If=1]="If",n[n.IfNot=2]="IfNot",n[n.Greater=3]="Greater",n[n.Less=4]="Less",n[n.Equals=6]="Equals",n[n.NotEqual=7]="NotEqual",n))(lg||{}),eU=(n=>(n[n.Float=1]="Float",n[n.Int=3]="Int",n[n.Bool=4]="Bool",n[n.Trigger=9]="Trigger",n))(eU||{});const Ir=q("debuganimatorcontroller"),dL=q("debugrootmotion");class uc{constructor(e){m(this,"_speed",1),m(this,"normalizedStartOffset",0),m(this,"animator"),m(this,"model"),m(this,"_mixer"),m(this,"_activeState"),m(this,"_activeStates",[]),m(this,"_heldActions",[]),m(this,"rootMotionHandler"),this.model=e,Ir&&console.log(this)}static createFromClips(e,i={looping:!1,autoTransition:!0,transitionDuration:0}){const s=[];for(let o=0;o<e.length;o++){const a=e[o],l=[];if(i.autoTransition!==!1){const h=i.transitionDuration??0,d=h/a.duration;let u=o;(i.autoTransition===void 0||i.autoTransition===!0)&&(u=(o+1)%e.length),l.push({exitTime:1-d,offset:0,duration:h,hasExitTime:!0,destinationState:u,conditions:[]})}const c={name:a.name,hash:o,motion:{name:a.name,clip:a,isLooping:i?.looping??!1},transitions:l,behaviours:[]};s.push(c)}const r={name:"AnimatorController",guid:new Zo(Date.now()).generateUUID(),parameters:[],layers:[{name:"Base Layer",stateMachine:{defaultState:0,states:s}}]};return new uc(r)}play(e,i=-1,s=Number.NEGATIVE_INFINITY,r=0){if(i<0)i=0;else if(i>=this.model.layers.length){console.warn("invalid layer");return}const o=this.model.layers[i].stateMachine;for(const a of o.states)if(a.name===e||a.hash===e){Ir&&console.log("transition to ",a),this.transitionTo(a,r,s);return}console.warn("Could not find "+e+" to play")}reset(){this.setStartTransition()}setBool(e,i){var s,r;const o=typeof e=="string"?"name":"hash";return(r=(s=this.model)==null?void 0:s.parameters)==null?void 0:r.filter(a=>a[o]===e).forEach(a=>a.value=i)}getBool(e){var i,s,r;const o=typeof e=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(a=>a[o]===e))==null?void 0:r.value)??!1}setFloat(e,i){var s,r;const o=typeof e=="string"?"name":"hash",a=(r=(s=this.model)==null?void 0:s.parameters)==null?void 0:r.filter(l=>l[o]===e);return a.forEach(l=>l.value=i),a?.length>0}getFloat(e){var i,s,r;const o=typeof e=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(a=>a[o]===e))==null?void 0:r.value)??0}setInteger(e,i){var s,r;const o=typeof e=="string"?"name":"hash";return(r=(s=this.model)==null?void 0:s.parameters)==null?void 0:r.filter(a=>a[o]===e).forEach(a=>a.value=i)}getInteger(e){var i,s,r;const o=typeof e=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(a=>a[o]===e))==null?void 0:r.value)??0}setTrigger(e){var i,s;Ir&&console.log("SET TRIGGER",e);const r=typeof e=="string"?"name":"hash";return(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.filter(o=>o[r]===e).forEach(o=>o.value=!0)}resetTrigger(e){var i,s;const r=typeof e=="string"?"name":"hash";return(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.filter(o=>o[r]===e).forEach(o=>o.value=!1)}getTrigger(e){var i,s,r;const o=typeof e=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(a=>a[o]===e))==null?void 0:r.value)??!1}isInTransition(){return this._activeStates.length>1}setSpeed(e){this._speed=e}FindState(e){return this.findState(e)}findState(e){if(!e)return null;if(Array.isArray(this.model.layers)){for(const i of this.model.layers)for(const s of i.stateMachine.states)if(s.name===e||s.hash==e)return s}return null}getCurrentStateInfo(){if(!this._activeState)return null;const e=this._activeState.motion.action;if(!e)return null;const i=this._activeState.motion.clip.duration,s=i<=0?0:Math.abs(e.time/i);return new jC(this._activeState,s,i,this._speed)}get currentAction(){return this._activeState&&this._activeState.motion.action||null}get context(){var e;return(e=this.animator)==null?void 0:e.context}get mixer(){return this._mixer}dispose(){var e;if(this._mixer.stopAllAction(),this.animator){this._mixer.uncacheRoot(this.animator.gameObject);for(const i of this._activeStates)i.motion.clip&&this.mixer.uncacheAction(i.motion.clip,this.animator.gameObject)}(e=this.context)==null||e.animations.unregisterAnimationMixer(this._mixer)}bind(e){var i,s;e?this.animator!==e&&(this._mixer&&(this._mixer.stopAllAction(),(i=this.context)==null||i.animations.unregisterAnimationMixer(this._mixer)),this.animator=e,this._mixer=new xT(this.animator.gameObject),(s=this.context)==null||s.animations.registerAnimationMixer(this._mixer),this.createActions(this.animator)):console.error("AnimatorController.bind: animator is null")}clone(){if(typeof this.model=="string")return console.warn("AnimatorController has not been resolved, can not create model from string",this.model),null;Ir&&console.warn("AnimatorController clone()",this.model);const e=gw(this.model,(i,s,r)=>r==null?!0:!(r.type==="Object3D"||r.isObject3D===!0||k8(r)||r.tracks!==void 0||r instanceof uc));return console.assert(e!==this.model),new uc(e)}update(e){var i,s;if(!this.animator)return;this.evaluateTransitions(),this.updateActiveStates(e);const r=this.animator.context.time.deltaTime;this.animator.applyRootMotion&&((i=this.rootMotionHandler)==null||i.onBeforeUpdate(e)),this._mixer.update(r),this.animator.applyRootMotion&&((s=this.rootMotionHandler)==null||s.onAfterUpdate(e))}get activeState(){return this._activeState}updateActiveStates(e){for(let i=0;i<this._activeStates.length;i++){const s=this._activeStates[i],r=s.motion;if(!r.action)this._activeStates.splice(i,1),i--;else{const o=r.action;o.weight=e,o.getEffectiveWeight()<=0&&!o.isRunning()&&(Ir&&console.debug("REMOVE",s.name,o.getEffectiveWeight(),o.isRunning(),o.isScheduled()),this._activeStates.splice(i,1),i--)}}}setStartTransition(){var e;this.model.layers.length>1&&(Ir||Je())&&console.warn("Multiple layers are not supported yet "+((e=this.animator)==null?void 0:e.name));for(const i of this.model.layers){const s=i.stateMachine;s.defaultState===void 0&&(Ir&&console.warn("AnimatorController default state is undefined, will assign state 0 as default",i),s.defaultState=0);const r=s.states[s.defaultState];this.transitionTo(r,0,this.normalizedStartOffset);break}}evaluateTransitions(){var e;let i=!1;if(!this._activeState){if(this.setStartTransition(),!this._activeState)return;i=!0}const s=this._activeState,r=s.motion.action;for(const a of s.transitions){if(!a.hasExitTime&&a.conditions.length<=0)continue;let l=!0;for(const c of a.conditions)if(!this.evaluateCondition(c)){l=!1;break}if(l)if(r){const c=s.motion.clip.duration,h=c<=0?1:Math.abs(r.time/c);let d=a.exitTime;r.timeScale<0&&(d=1-d);let u=!1;if(a.hasExitTime?r.timeScale>0?u=h>=a.exitTime:r.timeScale<0&&(u=1-h>=a.exitTime):u=!0,u){for(const p of a.conditions){const g=this.model.parameters.find(f=>f.name===p.parameter);g?.type===eU.Trigger&&g.value&&(g.value=!1)}if(r.clampWhenFinished=!0,Ir){const p=this.getState(a.destinationState,0);console.log(`Transition to ${a.destinationState} / ${p?.name}`,a,`
Timescale: `+r.timeScale,`
Normalized time: `+h.toFixed(3),`
Exit Time: `+d,a.hasExitTime)}this.transitionTo(a.destinationState,a.duration,a.offset);return}}else{this.transitionTo(a.destinationState,a.duration,a.offset);return}}r&&this.setTimescale(r,s);let o=!1;if(s.motion.isLooping&&r&&(r.time>=r.getClip().duration?(o=!0,r.reset(),r.time=0,r.play()):r.time<=0&&r.timeScale<0&&(o=!0,r.reset(),r.time=r.getClip().duration,r.play())),!o&&s&&!i&&r&&this.animator&&s.behaviours){const a=r?.getClip().duration,l=r.time/a,c=new jC(this._activeState,l,a,this._speed);for(const h of s.behaviours)h.instance&&((e=h.instance.onStateUpdate)==null||e.call(h.instance,this.animator,c,0))}}setTimescale(e,i){let s=i.speed??1;i.speedParameter&&(s*=this.getFloat(i.speedParameter)),s!==void 0&&(e.timeScale=s*this._speed)}getState(e,i){return typeof e=="number"&&(e==-1&&(e=this.model.layers[i].stateMachine.defaultState,e===void 0&&(Ir&&console.warn("AnimatorController default state is undefined: ",this.model,"Layer: "+i),e=0)),e=this.model.layers[i].stateMachine.states[e]),e}releaseHeldActions(e){for(const i of this._heldActions)i.fadeOut(e);this._heldActions.length=0}transitionTo(e,i,s){var r,o,a,l,c,h,d,u;if(!this.animator)return;const p=0;if(e=this.getState(e,p),!(e!=null&&e.motion)||!e.motion.clip||!(e.motion.clip instanceof wa))return;const g=this._activeState===e;if(g){const v=e.motion;if(!v.action_loopback&&v.clip){const x=this.rootMotionHandler?this.animator.gameObject.matrix.clone():null;this._mixer.uncacheAction(v.clip,this.animator.gameObject),x&&x.decompose(this.animator.gameObject.position,this.animator.gameObject.quaternion,this.animator.gameObject.scale),v.action_loopback=this.createAction(v.clip)}}if((r=this._activeState)!=null&&r.behaviours&&this._activeState.motion.action){const v=(o=this._activeState)==null?void 0:o.motion.clip.duration,x=this._activeState.motion.action.time/v,w=new jC(this._activeState,x,v,this._speed);for(const C of this._activeState.behaviours)(l=(a=C.instance)==null?void 0:a.onStateExit)==null||l.call(C.instance,this.animator,w,p)}const f=(c=this._activeState)==null?void 0:c.motion.action;g&&(e.motion.action=e.motion.action_loopback,e.motion.action_loopback=f);const A=this._activeState;this._activeState=e;const y=(h=e.motion)==null?void 0:h.action,b=e.motion.clip;if(b?.duration<=0&&b.tracks.length<=0?f&&this._heldActions.push(f):f&&(f.fadeOut(i),this.releaseHeldActions(i)),y){if(s=Math.max(0,Math.min(1,s)),e.cycleOffsetParameter){let x=this.getFloat(e.cycleOffsetParameter);typeof x=="number"?(x<0&&(x+=1),s+=x,s%=1):Ir&&console.warn("AnimatorController cycle offset parameter is not a number",e.cycleOffsetParameter)}else typeof e.cycleOffset=="number"&&(s+=e.cycleOffset,s%=1);y.isRunning()&&y.stop(),y.reset(),y.enabled=!0,this.setTimescale(y,e);const v=e.motion.clip.duration;if(y.time=g?0:s*v,y.timeScale<0&&(y.time=v-y.time),y.clampWhenFinished=!0,y.setLoop(zx,0),i>0?y.fadeIn(i):y.weight=1,y.play(),this.rootMotionHandler&&this.rootMotionHandler.onStart(y),this._activeStates.includes(e)||this._activeStates.push(e),this._activeState.behaviours){const x=new jC(e,s,v,this._speed);for(const w of this._activeState.behaviours)(u=(d=w.instance)==null?void 0:d.onStateEnter)==null||u.call(w.instance,this.animator,x,p)}}else Ir&&(e.__warned_no_motion||(e.__warned_no_motion=!0,console.warn("No action",e.motion,this)));Ir&&console.log("TRANSITION FROM "+A?.name+" TO "+e.name,i,f,y,y?.getEffectiveTimeScale(),y?.getEffectiveWeight(),y?.isRunning(),y?.isScheduled(),y?.paused)}createAction(e){var i,s;if(this._mixer.existingAction(e)&&this._mixer.uncacheAction(e,(i=this.animator)==null?void 0:i.gameObject),(s=this.animator)!=null&&s.applyRootMotion){this.rootMotionHandler||(this.rootMotionHandler=new kPe(this));const r=this.animator.gameObject;return this.rootMotionHandler.createClip(this._mixer,r,e)}else return this._mixer.clipAction(e)}evaluateCondition(e){const i=this.model.parameters.find(s=>s.name===e.parameter);if(!i)return!1;switch(e.mode){case lg.If:return i.value===!0;case lg.IfNot:return i.value===!1;case lg.Greater:return i.value>e.threshold;case lg.Less:return i.value<e.threshold;case lg.Equals:return i.value===e.threshold;case lg.NotEqual:return i.value!==e.threshold}return!1}createActions(e){var i,s,r,o;Ir&&console.log("AnimatorController createActions",this.model);for(const a of this.model.layers){const l=a.stateMachine;for(let c=0;c<l.states.length;c++){const h=l.states[c];h.transitions||(h.transitions=[]);for(const d of h.transitions)d.conditions||(d.conditions=[]);if(h.motion||(Ir&&console.warn("No motion",h),h.motion=Qne(h.name)),this.animator&&h.motion.clips){const d=(i=h.motion.clips)==null?void 0:i.find(u=>{var p,g;return u.node.name===((g=(p=this.animator)==null?void 0:p.gameObject)==null?void 0:g.name)});d?h.motion.clip=d.clip:(Ir||Je())&&console.warn('Could not find clip for animator "'+((r=(s=this.animator)==null?void 0:s.gameObject)==null?void 0:r.name)+'"',h.motion.clips.map(u=>u.node.name))}if(!h.motion.clip){Ir&&console.warn("No clip assigned to state",h);const d=new wa(void 0,void 0,[]);h.motion.clip=d}if((o=h.motion)!=null&&o.clip){const d=h.motion.clip;if(d instanceof wa){const u=this.createAction(d);h.motion.action=u}else(Ir||Je())&&console.warn("No valid animationclip assigned",h)}if(h.behaviours&&Array.isArray(h.behaviours))for(const d of h.behaviours){if(!(d!=null&&d.typeName))continue;const u=Y.get(d.typeName);if(u){const p=new u;p.isStateMachineBehaviour&&(p._context=this.context??void 0,Wb(p,d.properties),d.instance=p),Ir&&console.log("Created animator controller behaviour",h.name,d.typeName,d.properties,p)}else(Ir||Je())&&console.warn("Could not find AnimatorBehaviour type: "+d.typeName)}}}}*enumerateActions(){if(this.model.layers)for(const e of this.model.layers){const i=e.stateMachine;for(let s=0;s<i.states.length;s++){const r=i.states[s];r!=null&&r.motion&&(r.motion.action&&(yield r.motion.action),r.motion.action_loopback&&(yield r.motion.action_loopback))}}}}class Kne{constructor(e,i){m(this,"track"),m(this,"createdInterpolant"),m(this,"originalEvaluate"),m(this,"customEvaluate"),this.track=e;const s=e,r=s.createInterpolant.bind(e);s.createInterpolant=()=>(s.createInterpolant=r,this.createdInterpolant=r(),this.originalEvaluate=this.createdInterpolant.evaluate.bind(this.createdInterpolant),this.customEvaluate=o=>{if(!this.originalEvaluate)return;const a=this.originalEvaluate(o);return i(o,a)},this.createdInterpolant.evaluate=this.customEvaluate,this.createdInterpolant)}dispose(){this.createdInterpolant&&this.originalEvaluate&&(this.createdInterpolant.evaluate=this.originalEvaluate),this.track=void 0,this.createdInterpolant=null,this.originalEvaluate=void 0,this.customEvaluate=void 0}}const jr=class{constructor(n,e,i,s,r){if(m(this,"_action"),m(this,"root"),m(this,"clip"),m(this,"positionWrapper",null),m(this,"rotationWrapper",null),m(this,"context"),m(this,"positionChange",new E),m(this,"rotationChange",new Fe),m(this,"_prevTime",0),this.context=n,this.root=e,this.clip=i,jr.firstKeyframeRotation[this.cacheId]||(jr.firstKeyframeRotation[this.cacheId]=new Fe),r){const o=r.values;jr.firstKeyframeRotation[this.cacheId].set(o[0],o[1],o[2],o[3])}jr.spaceRotation[this.cacheId]||(jr.spaceRotation[this.cacheId]=new Fe),jr.effectiveSpaceRotation[this.cacheId]||(jr.effectiveSpaceRotation[this.cacheId]=new Fe),jr.clipOffsetRotation[this.cacheId]=new Fe,r&&jr.clipOffsetRotation[this.cacheId].set(r.values[0],r.values[1],r.values[2],r.values[3]).invert(),this.handlePosition(i,s),this.handleRotation(i,r)}set action(n){this._action=n}get action(){return this._action}get cacheId(){return this.root.uuid}onStart(n){if(n.getClip()!==this.clip)return;jr.lastObjRotation[this.cacheId]||(jr.lastObjRotation[this.cacheId]=this.root.quaternion.clone());const e=jr.lastObjRotation[this.cacheId];if(jr.spaceRotation[this.cacheId].copy(e),dL){const i=new Oi().setFromQuaternion(e);console.log("START",this.clip.name,lt.toDegrees(i.y),this.root.position.z)}}getClipRotationOffset(){return jr.clipOffsetRotation[this.cacheId]}handlePosition(n,e){if(e){const i=this.root;dL&&i.add(new Ya),jr.lastObjPosition[this.cacheId]||(jr.lastObjPosition[this.cacheId]=this.root.position.clone());const s=new E,r=new E;this.positionWrapper=new Kne(e,(o,a)=>{const l=this.action.getEffectiveWeight();return dL&&i.position.length()>8&&i.position.set(0,i.position.y,0),o>this._prevTime&&(s.set(a[0],a[1],a[2]),s.sub(r),s.multiplyScalar(l),s.applyQuaternion(this.getClipRotationOffset()),s.applyQuaternion(i.quaternion),this.positionChange.copy(s)),r.fromArray(a),this._prevTime=o,a[0]=0,a[1]=0,a[2]=0,a})}}handleRotation(n,e){if(e){if(dL){const o=e.values,a=new Oi().setFromQuaternion(new Fe(o[0],o[1],o[2],o[3]));console.log(n.name,e.name,"FIRST ROTATION IN TRACK",lt.toDegrees(a.y));const l=e.values.length-4,c=new Fe().set(o[l],o[l+1],o[l+2],o[l+3]),h=new Oi().setFromQuaternion(c);console.log(n.name,e.name,"LAST ROTATION IN TRACK",lt.toDegrees(h.y))}let i=0;const s=new Fe,r=new Fe;this.rotationWrapper=new Kne(e,(o,a)=>(o>i&&(r.set(a[0],a[1],a[2],a[3]),s.invert(),r.multiply(s),this.rotationChange.copy(r)),s.fromArray(a),i=o,a[0]=0,a[1]=0,a[2]=0,a[3]=1,a))}}onBeforeUpdate(n){this.positionChange.set(0,0,0),this.rotationChange.set(0,0,0,1)}onAfterUpdate(n){return!this.action||(n*=this.action.getEffectiveWeight(),n<=0)?!1:(this.positionChange.multiplyScalar(n),this.rotationChange.slerp(jr.identityQuaternion,1-n),!0)}};let cg=jr;m(cg,"lastObjPosition",{}),m(cg,"lastObjRotation",{}),m(cg,"firstKeyframeRotation",{}),m(cg,"spaceRotation",{}),m(cg,"effectiveSpaceRotation",{}),m(cg,"clipOffsetRotation",{}),m(cg,"identityQuaternion",new Fe);class kPe{constructor(e){m(this,"controller"),m(this,"handler",[]),m(this,"root"),m(this,"basePosition",new E),m(this,"baseQuaternion",new Fe),m(this,"baseRotation",new Oi),m(this,"summedPosition",new E),m(this,"summedRotation",new Fe),this.controller=e}createClip(e,i,s){this.root=i,i&&"name"in i&&i.name;const r=this.findRootTrack(s,".position"),o=this.findRootTrack(s,".quaternion"),a=new cg(this.controller.context,i,s,r,o);this.handler.push(a);const l=e.clipAction(s);return a.action=l,l}onStart(e){for(const i of this.handler)i.onStart(e)}onBeforeUpdate(e){this.basePosition.copy(this.root.position),this.baseQuaternion.copy(this.root.quaternion);for(const i of this.handler)i.onBeforeUpdate(e)}onAfterUpdate(e){if(!(e<=0)){this.root.position.copy(this.basePosition),this.root.quaternion.copy(this.baseQuaternion),this.summedPosition.set(0,0,0),this.summedRotation.set(0,0,0,1);for(const i of this.handler)i.onAfterUpdate(e)&&(this.summedPosition.add(i.positionChange),this.summedRotation.multiply(i.rotationChange));this.root.position.add(this.summedPosition),this.root.quaternion.multiply(this.summedRotation)}}findRootTrack(e,i){const s=e.tracks;if(!s)return null;for(const r of s)if(r.name.endsWith(i))return r;return null}}class GPe extends Nc{onSerialize(e,i){}onDeserialize(e,i){if(i.type===uc&&e?.__type==="AnimatorController")return new uc(e)}}new GPe(uc);var PPe=Object.defineProperty,NPe=Object.getOwnPropertyDescriptor,uL=(n,e,i,s)=>{for(var r=s>1?void 0:s?NPe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&PPe(e,i,r),r};const Dc=q("debuganimator");class Mo extends Oe{constructor(){super(...arguments),m(this,"applyRootMotion",!1),m(this,"hasRootMotion",!1),m(this,"keepAnimatorControllerStateOnDisable",!1),m(this,"_parametersAreDirty",!1),m(this,"_isDirty",!1),m(this,"_speed",1),m(this,"_normalizedStartOffset",0),m(this,"_animatorController",null),m(this,"_initializeWithRuntimeAnimatorController")}get isAnimationComponent(){return!0}set runtimeAnimatorController(e){var i;this._animatorController&&this._animatorController.model===e||(e?e instanceof uc?(e.animator&&e.animator!==this&&(console.warn("AnimatorController can not be bound to multiple animators",(i=e.model)==null?void 0:i.name),e.model||console.error("AnimatorController has no model"),e=new uc(e.model)),this._animatorController=e,this._animatorController.bind(this)):(Dc&&console.log("Assign animator controller",e,this),this._animatorController=new uc(e),this.__didAwake&&this._animatorController.bind(this)):this._animatorController=null)}get runtimeAnimatorController(){return this._animatorController}getCurrentStateInfo(){var e;return(e=this.runtimeAnimatorController)==null?void 0:e.getCurrentStateInfo()}get currentAction(){var e;return((e=this.runtimeAnimatorController)==null?void 0:e.currentAction)||null}get parametersAreDirty(){return this._parametersAreDirty}get isDirty(){return this._isDirty}Play(e,i=-1,s=Number.NEGATIVE_INFINITY,r=0){this.play(e,i,s,r)}play(e,i=-1,s=Number.NEGATIVE_INFINITY,r=0){var o;(o=this.runtimeAnimatorController)==null||o.play(e,i,s,r),this._isDirty=!0}Reset(){this.reset()}reset(){var e;(e=this._animatorController)==null||e.reset(),this._isDirty=!0}SetBool(e,i){this.setBool(e,i)}setBool(e,i){var s,r;Dc&&console.log("setBool",e,i),((s=this.runtimeAnimatorController)==null?void 0:s.getBool(e))!==i&&(this._parametersAreDirty=!0),(r=this.runtimeAnimatorController)==null||r.setBool(e,i)}GetBool(e){return this.getBool(e)}getBool(e){var i;const s=((i=this.runtimeAnimatorController)==null?void 0:i.getBool(e))??!1;return Dc&&console.log("getBool",e,s),s}toggleBool(e){this.setBool(e,!this.getBool(e))}SetFloat(e,i){this.setFloat(e,i)}setFloat(e,i){var s,r;((s=this.runtimeAnimatorController)==null?void 0:s.getFloat(e))!==i&&(this._parametersAreDirty=!0),Dc&&console.log("setFloat",e,i),(r=this.runtimeAnimatorController)==null||r.setFloat(e,i)}GetFloat(e){return this.getFloat(e)}getFloat(e){var i;const s=((i=this.runtimeAnimatorController)==null?void 0:i.getFloat(e))??-1;return Dc&&console.log("getFloat",e,s),s}SetInteger(e,i){this.setInteger(e,i)}setInteger(e,i){var s,r;((s=this.runtimeAnimatorController)==null?void 0:s.getInteger(e))!==i&&(this._parametersAreDirty=!0),Dc&&console.log("setInteger",e,i),(r=this.runtimeAnimatorController)==null||r.setInteger(e,i)}GetInteger(e){return this.getInteger(e)}getInteger(e){var i;const s=((i=this.runtimeAnimatorController)==null?void 0:i.getInteger(e))??-1;return Dc&&console.log("getInteger",e,s),s}SetTrigger(e){this.setTrigger(e)}setTrigger(e){var i;this._parametersAreDirty=!0,Dc&&console.log("setTrigger",e),(i=this.runtimeAnimatorController)==null||i.setTrigger(e)}ResetTrigger(e){this.resetTrigger(e)}resetTrigger(e){var i;this._parametersAreDirty=!0,Dc&&console.log("resetTrigger",e),(i=this.runtimeAnimatorController)==null||i.resetTrigger(e)}GetTrigger(e){this.getTrigger(e)}getTrigger(e){var i;const s=(i=this.runtimeAnimatorController)==null?void 0:i.getTrigger(e);return Dc&&console.log("getTrigger",e,s),s}IsInTransition(){return this.isInTransition()}isInTransition(){var e;return((e=this.runtimeAnimatorController)==null?void 0:e.isInTransition())??!1}SetSpeed(e){return this.setSpeed(e)}setSpeed(e){var i;e!==this._speed&&(Dc&&console.log("setSpeed",e),this._speed=e,((i=this._animatorController)==null?void 0:i.animator)==this&&this._animatorController.setSpeed(e))}set minMaxSpeed(e){var i;this._speed=lt.lerp(e.x,e.y,Math.random()),((i=this._animatorController)==null?void 0:i.animator)==this&&this._animatorController.setSpeed(this._speed)}set minMaxOffsetNormalized(e){var i;this._normalizedStartOffset=lt.lerp(e.x,e.y,Math.random()),((i=this.runtimeAnimatorController)==null?void 0:i.animator)==this&&(this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset)}awake(){Dc&&console.log("ANIMATOR",this.name,this),this.gameObject&&this.initializeRuntimeAnimatorController()}initializeRuntimeAnimatorController(e=!1){const i=e||this.runtimeAnimatorController!==this._initializeWithRuntimeAnimatorController;if(this.runtimeAnimatorController&&i){const s=this.runtimeAnimatorController.clone();this._initializeWithRuntimeAnimatorController=s,s?(console.assert(this.runtimeAnimatorController!==s),this.runtimeAnimatorController=s,console.assert(this.runtimeAnimatorController===s),this.runtimeAnimatorController.bind(this),this.runtimeAnimatorController.setSpeed(this._speed),this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset):console.warn("Could not clone animator controller",this.runtimeAnimatorController)}}onDisable(){var e;this.keepAnimatorControllerStateOnDisable||(e=this._animatorController)==null||e.reset()}onBeforeRender(){this._isDirty=!1,this._parametersAreDirty=!1,!LPe(this.gameObject)&&this._animatorController&&this._animatorController.update(1)}}uL([T()],Mo.prototype,"applyRootMotion",2),uL([T()],Mo.prototype,"hasRootMotion",2),uL([T()],Mo.prototype,"keepAnimatorControllerStateOnDisable",2),uL([T()],Mo.prototype,"runtimeAnimatorController",1);const Gd=q("debugusdzanimation"),tU=q("debugusdzanimationserialization");class Op{constructor(e,i,s){m(this,"_start"),m(this,"ext"),m(this,"root"),m(this,"_nearestAnimatedRoot"),m(this,"clip"),m(this,"speed"),this.ext=e,this.root=i,this.clip=s,this._nearestAnimatedRoot=this.getNearestAnimatedRoot()}get start(){return this._start===void 0&&(this._start=this.ext.getStartTimeByClip(this.clip)),this._start}get duration(){var e;return((e=this.clip)==null?void 0:e.duration)??bs.restPoseClipDuration}get nearestAnimatedRoot(){return this._nearestAnimatedRoot}get clipName(){var e;return((e=this.clip)==null?void 0:e.name)??"rest"}static isDescendantOf(e,i){let s=i;if(!s||!e)return!1;for(;s;){if(!s)return!1;if(s===e)return!0;s=s.parent}return!1}getNearestAnimatedRoot(){var e;let i;try{for(const s of((e=this.clip)==null?void 0:e.tracks)??[]){const r=xi.parseTrackName(s.name);let o=xi.findNode(this.root,r.nodeName);if(o)if(!i)i=o;else{if(o===i||Op.isDescendantOf(i,o))continue;if(!Op.isDescendantOf(o,i)){for(;!Op.isDescendantOf(o,i)&&o.parent;)o=o.parent;Op.isDescendantOf(o,i)||console.error("USDZExporter: Animation clip targets multiple roots that are not parent/child. Please report a bug",this.root,this.clip,i,o)}i=o}}}catch(s){console.error("USDZExporter: Exception when trying to find nearest animated root. Please report a bug",s),i=void 0}return i}}const pL=class{constructor(n,e,i){if(m(this,"clip"),m(this,"pos"),m(this,"rot"),m(this,"scale"),m(this,"root"),m(this,"target"),m(this,"duration",0),m(this,"useRootMotion",!1),this.root=n,this.target=e,this.clip=i,i?this.duration=i.duration:this.duration=pL.restPoseClipDuration,i&&i.tracks){const r=Math.max(...i.tracks.map(o=>o.times[o.times.length-1]));r!==this.duration&&(console.warn("USDZExporter: Animation clip duration does not match the maximum time value in the tracks.",i,r,this.duration),this.duration=r)}const s=$.getComponent(n,Mo);s&&(this.useRootMotion=s.applyRootMotion)}addTrack(n){var e,i;if(!this.clip){console.error("This is a rest clip but you're trying to add tracks to it \u2013 this is likely a bug");return}n.name.endsWith("position")?this.pos=n:n.name.endsWith("quaternion")?this.rot=n:n.name.endsWith("scale")?this.scale=n:(n.name.endsWith("activeSelf")?console.warn("[USDZ] Animation of enabled/disabled state is not supported for USDZ export and will NOT be exported: "+n.name+" on "+(((e=this.root)==null?void 0:e.name)??this.target.name)+". Animate scale 0/1 instead."):console.warn("[USDZ] Animation track type not supported for USDZ export and will NOT be exported: "+n.name+" on "+(((i=this.root)==null?void 0:i.name)??this.target.name)+". Only .position, .rotation, .scale are supported."),Je()&&An("[USDZ] Some animations can't be exported. See console for details."))}getFrames(){var n,e,i,s,r,o;return this.clip?Math.max(((e=(n=this.pos)==null?void 0:n.times)==null?void 0:e.length)??0,((s=(i=this.rot)==null?void 0:i.times)==null?void 0:s.length)??0,((o=(r=this.scale)==null?void 0:r.times)==null?void 0:o.length)??0):2}getDuration(){return this.duration}getSortedTimesArray(n=!0,e=!0,i=!0){var s,r,o;if(!this.clip)return[0,this.duration];const a=(s=this.pos)==null?void 0:s.times,l=(r=this.rot)==null?void 0:r.times,c=(o=this.scale)==null?void 0:o.times,h=[];if(n&&a)for(const d of a)h.push(d);if(e&&l)for(const d of l)h.push(d);if(i&&c)for(const d of c)h.push(d);return h.includes(0)||h.push(0),h.sort((d,u)=>d-u),[...new Set(h)]}*getValues(n,e=!0,i=!0,s=!0){var r,o,a;const l=new E,c=new Fe,h=new E(1,1,1),d=this.target,u=e?(r=this.pos)==null?void 0:r.createInterpolant():void 0,p=i?(o=this.rot)==null?void 0:o.createInterpolant():void 0,g=s?(a=this.scale)==null?void 0:a.createInterpolant():void 0;u||l.set(d.position.x,d.position.y,d.position.z),p||c.set(d.quaternion.x,d.quaternion.y,d.quaternion.z,d.quaternion.w),g||h.set(d.scale.x,d.scale.y,d.scale.z),u&&u.valueSize!==3&&(u.valueSize=3),p&&p.valueSize!==4&&(p.valueSize=4),g&&g.valueSize!==3&&(g.valueSize=3);const f=0;for(let A=0-f;A<n.length+f;A++){let y=0,b=0;if(A<0?(y=n[0],b=y-pL.animationDurationPadding/2+1/60):A>=n.length?(y=n[n.length-1],b=y+pL.animationDurationPadding/2-1/60):(y=n[A],b=y),u){const v=u.evaluate(y);l.set(v[0],v[1],v[2])}if(p){const v=p.evaluate(y);c.set(v[0],v[1],v[2],v[3])}if(g){const v=g.evaluate(y);h.set(v[0],v[1],v[2])}if(this.useRootMotion&&d===this.root){const v=new de;v.compose(l,c,h),v.multiply(d.matrix),v.decompose(l,c,h)}yield{time:b,translation:l,rotation:c,scale:h,index:A}}}};let bs=pL;m(bs,"frameRate",60),m(bs,"animationDurationPadding",6/60),m(bs,"restPoseClipDuration",6/60);class JC{constructor(e){m(this,"dict",new Map),m(this,"rootTargetMap",new Map),m(this,"rootAndClipToRegisteredAnimationMap",new Map),m(this,"rootToRegisteredClip",new Map),m(this,"lastClipEndTime",0),m(this,"clipToStartTime",new Map),m(this,"clipToHoldClip",new Map),m(this,"serializers",[]),m(this,"injectRestPoses",!1),m(this,"injectImplicitBehaviours",!1),this.injectRestPoses=e,this.injectImplicitBehaviours=e}get extensionName(){return"animation"}get animationData(){return this.dict}get registeredClips(){return this.clipToStartTime.keys()}get animatedRoots(){return this.rootTargetMap.keys()}get holdClipMap(){return this.clipToHoldClip}getStartTimeCode(){return!this.injectRestPoses||this.rootAndClipToRegisteredAnimationMap.size===0?0:(bs.restPoseClipDuration+bs.animationDurationPadding)*60}getEndTimeCode(){let e=0;for(const[i,s]of this.rootAndClipToRegisteredAnimationMap){const r=s.start+s.duration;r>e&&(e=r)}return e*60}getClipCount(e){var i;return((i=this.rootToRegisteredClip.get(e))==null?void 0:i.length)??0??0}getStartTimeByClip(e){return e?this.clipToStartTime.has(e)?this.clipToStartTime.get(e):(console.error("USDZExporter: Missing start time for clip \u2013 please report a bug.",e),0):0}registerAnimation(e,i){var s;if(!e)return null;this.rootTargetMap.has(e)||this.rootTargetMap.set(e,[]);const r=e.uuid+(i?.uuid??"-rest");if(this.rootAndClipToRegisteredAnimationMap.has(r))return this.rootAndClipToRegisteredAnimationMap.get(r);Gd&&console.log("registerAnimation",e,i);const o=this.injectRestPoses?1:0,a=(((s=this.rootToRegisteredClip.get(e))==null?void 0:s.length)??0)+o,l=this.rootTargetMap.get(e),c=new Set(l);if(i&&i.tracks)for(const d of i.tracks){const u=xi.parseTrackName(d.name),p=xi.findNode(e,u.nodeName);if(!p){console.warn("no object found for track",d.name,"using "+e.name+" instead");continue}this.dict.has(p)||this.dict.set(p,[]);const g=this.dict.get(p);if(!g){console.warn("no transform data found for target ",p,"at slot "+a+", this is likely a bug");continue}c.delete(p),this.injectRestPoses&&!g[0]&&(console.log("Injecting rest pose",p,i,"at slot",a),g[0]=new bs(null,p,null));let f=g[a];f||(f=new bs(e,p,i),g[a]=f),f.addTrack(d),l!=null&&l.includes(p)||l==null||l.push(p)}Gd&&console.log("Unregistered nodes for this clip",c,"clip",i,"at slot",a,"for root",e,"targets",l);for(const d of c){const u=this.dict.get(d);if(!u)continue;if(this.injectRestPoses&&!u[0]){console.warn("Adding rest pose for ",d,i,"at slot",a,"This is likely a bug, should have been added earlier.");const g=new bs(null,d,null);u[0]=g}let p=u[a];p||(Gd&&console.log("Adding padding clip for ",d,i,"at slot",a),p=new bs(e,d,i),u[a]=p)}const h=new Op(this,e,i);if(this.rootAndClipToRegisteredAnimationMap.set(r,h),Gd&&console.log({root:e,clip:i,info:h}),i){const d=this.rootToRegisteredClip.get(e);if(d?d.push(i):this.rootToRegisteredClip.set(e,[i]),!this.clipToStartTime.get(i)){this.lastClipEndTime==null&&(this.lastClipEndTime=bs.restPoseClipDuration);let u=this.lastClipEndTime+bs.animationDurationPadding,p=u+i.duration;const g=Math.round(u*60)/60,f=Math.round(p*60)/60;Math.abs(g-u)<.01&&(u=g),Math.abs(f-p)<.01&&(p=f),u=Math.ceil(u),p=u+i.duration,this.clipToStartTime.set(i,u),this.lastClipEndTime=p}}return h}onAfterHierarchy(e){Gd&&console.log("Animation clips per animation target node",this.dict)}onAfterBuildDocument(e){var i,s;Gd&&console.log("Animation data",{dict:this.dict,rootTargetMap:this.rootTargetMap,rootToRegisteredClip:this.rootToRegisteredClip});for(const r of this.rootTargetMap.keys()){const o=this.rootTargetMap.get(r);if(!o)continue;let a;const l=[];for(const c of o){const h=this.dict.get(c);if(!h){console.error("No data found for target on USDZ export \u2013 please report a bug!",c);continue}a===void 0&&(a=h?.length),a!==h?.length&&console.error("Different array lengths for targets \u2013 please report a bug!",h);for(let d=0;d<h.length;d++){let u=h[d];if(!u){const g=d-(this.injectRestPoses?1:0);h[d]=new bs(null,c,this.rootToRegisteredClip.get(r)[g]),u=h[d]}const p=u.getDuration();if(l[d]===void 0)l[d]=p;else if(l[d]!==p){console.error("Error during UDSZ export: Encountered different animation durations for animated targets. Please report a bug!",{datas:h,target:c}),l[d]=p;continue}}}}for(const r of this.serializers){const o=(i=r.model)==null?void 0:i.parent,a=o?.isDynamic===!0;tU&&console.log(a,(s=r.model)==null?void 0:s.parent),a&&r.registerCallback(o)}}onExportObject(e,i,s){$.foreachComponent(e,o=>{const a=o;typeof a.createAnimation=="function"&&a.createAnimation(this,i,s)},!1);const r=new VPe(e,this);this.serializers.push(r),r.registerCallback(i)}}class VPe{constructor(e,i){m(this,"model"),m(this,"object"),m(this,"animationData"),m(this,"ext"),m(this,"callback"),this.object=e,this.animationData=i.animationData,this.ext=i}registerCallback(e){this.model&&this.callback&&this.model.removeEventListener("serialize",this.callback),this.callback||(this.callback=this.onSerialize.bind(this)),tU&&console.log("REPARENT",e),this.model=e,this.callback&&this.model.addEventListener("serialize",this.callback)}skinnedMeshExport(e,i,s){var r;const o=this.model,a=this.animationData;if(o&&o.skinnedMesh){let l=function(k){const G=[];for(const[X,F]of k){let z=`${X} : [`;const H=[];for(const Z of F)H.push(`(${Ri(Z.x)}, ${Ri(Z.y)}, ${Ri(Z.z)})`);z=z.concat(H.join(", ")),z=z.concat("],"),G.push(z)}return G},c=function(k){const G=[];for(const[X,F]of k){let z=`${X} : [`;const H=[];for(const Z of F)H.push(`(${Ri(Z.w)}, ${Ri(Z.x)}, ${Ri(Z.y)}, ${Ri(Z.z)})`);z=z.concat(H.join(", ")),z=z.concat("],"),G.push(z)}return G},h=function(k){let G,X=!0;const F=new Map;for(const[H,Z]of k){G===void 0&&(G=Z.length),G!==Z.length&&(X=!1);let he=0;for(const be of Z)he++,be||(F.has(H)||F.set(H,[]),F.get(H).push(he))}Gd&&console.log("Bone count: ",k.size,"TransformData entries per bone: ",G,"Undefined bone entries: ",F),console.assert(X,"All bones should have the same number of TransformData entries",k),console.assert(F.size===0,"All TransformData entries should be set",F);const z=[];for(const[H,Z]of k)for(let he=0;he<Z.length;he++){const be=Z[he],_e=s.getStartTimeByClip(be.clip);z.length<=he&&z.push({pos:[],rot:[],scale:[],timeOffset:_e});const Ye=z[he];Ye.pos.push(...be.getSortedTimesArray(!0,!1,!1)),Ye.rot.push(...be.getSortedTimesArray(!1,!0,!1)),Ye.scale.push(...be.getSortedTimesArray(!1,!1,!0))}for(const H of z)H.pos.sort((Z,he)=>Z-he),H.rot.sort((Z,he)=>Z-he),H.scale.sort((Z,he)=>Z-he),H.pos=[...new Set(H.pos)],H.rot=[...new Set(H.rot)],H.scale=[...new Set(H.scale)];return z},d=function(k,G,X){const F=new Map,z=new Map,H=new Map,Z=G.length;for(const he of X){const be=k.get(he);let _e;be?console.assert(be.length===Z,"We should have the same number of TransformData entries for each bone",be,G):_e=new bs(null,he,null);for(let Ye=0;Ye<Z;Ye++){const je=be?be[Ye]:_e,le=G[Ye];for(const{time:ve,translation:Pe}of je.getValues(le.pos,!0,!1,!1)){const ke=(ve+le.timeOffset)*60;F.has(ke)||F.set(ke,new Array),F.get(ke).push(Pe.clone())}for(const{time:ve,rotation:Pe}of je.getValues(le.rot,!1,!0,!1)){const ke=(ve+le.timeOffset)*60;z.has(ke)||z.set(ke,new Array),z.get(ke).push(Pe.clone())}for(const{time:ve,scale:Pe}of je.getValues(le.scale,!1,!1,!0)){const ke=(ve+le.timeOffset)*60;H.has(ke)||H.set(ke,new Array),H.get(ke).push(Pe.clone())}}}return{position:F.size==0?void 0:F,quaternion:z.size==0?void 0:z,scale:H.size==0?void 0:H}},u=function(k){const G=[];for(const X of k)G.push(`(${Ri(X.x)}, ${Ri(X.y)}, ${Ri(X.z)})`);return G.join(", ")},p=function(k){const G=[];for(const X of k)G.push(`(${Ri(X.w)}, ${Ri(X.x)}, ${Ri(X.y)}, ${Ri(X.z)})`);return G.join(", ")},g=function(k){const G=new Map;if(Gd){const X=new Array;for(const[F,z]of a)X.push(F.uuid+": "+z.length+" "+z.map(H=>{var Z;return(Z=H.clip)==null?void 0:Z.uuid.substring(0,6)}).join(" "));console.log(`getPerBoneTransformData
`+X.join(`
`))}for(const X of k){const F=a.get(X);F&&G.set(X,F)}return G},f=function(k){const G=g(k),X=h(G);return d(G,X,k)};const A=o.skinnedMesh.skeleton,y=new Array,b=[],v=[];for(const k of A.bones)if(k.parent.type!=="Bone"){b.push(k);const G=A.boneInverses[A.bones.indexOf(k)];y.push({bone:k,inverse:G}),v.push(k.uuid)}for(;v.length<A.bones.length;)for(const k of b){const G=k.children;for(const X of G)if(v.indexOf(X.uuid)===-1&&A.bones.indexOf(X)!==-1){b.push(X);const F=A.boneInverses[A.bones.indexOf(X)];y.push({bone:X,inverse:F}),v.push(X.uuid)}}for(const k of Sne(A.bones))y.push({bone:k,inverse:k.matrixWorld.clone().invert()});const x=y[0].bone.parent;x||console.error("No bone parent found for skinned mesh during USDZ export",o.skinnedMesh),y.sort((k,G)=>rv(k.bone,x)>rv(G.bone,x)?1:-1);const w=i.quickLookCompatible,C=[],S=[],_=[],I=[];for(const{bone:k}of y){if(w){const G=k.scale;G.x==0&&(G.x=1e-5),G.y==0&&(G.y=1e-5),G.z==0&&(G.z=1e-5),C.push(new de().compose(k.position,k.quaternion,k.scale))}else C.push(k.matrix.clone());S.push(k.position),_.push(k.quaternion),I.push(k.scale)}const B=y.map(k=>'"'+rv(k.bone,x)+'"').join(", "),M=y.map(k=>Gne(k.inverse.clone().invert())).join(", ");e.beginBlock('def Skeleton "Rig"'),e.appendLine(`uniform matrix4d[] bindTransforms = [${M}]`),e.appendLine(`uniform token[] joints = [${B}]`),e.appendLine('uniform token purpose = "guide"'),e.appendLine(`uniform matrix4d[] restTransforms = [${C.map(k=>Gne(k)).join(", ")}]`);const R=f(y.map(k=>k.bone));if(Gd){let k=1e7,G=0;for(const X of((r=R.position)==null?void 0:r.keys())??[])k=Math.min(k,X),G=Math.max(G,X);console.log("Time samples",k,G,R)}if(e.beginBlock('def SkelAnimation "_anim"'),e.appendLine(`uniform token[] joints = [${B}]`),e.appendLine(`quatf[] rotations = [${p(_)}]`),R&&R.quaternion){e.beginBlock("quatf[] rotations.timeSamples = {","");const k=c(R.quaternion);for(const G of k)e.appendLine(G);e.closeBlock()}if(e.appendLine(`half3[] scales = [${u(I)}]`),R&&R.scale){e.beginBlock("half3[] scales.timeSamples = {","");const k=l(R.scale);for(const G of k)e.appendLine(G);e.closeBlock()}if(e.appendLine(`float3[] translations = [${u(S)}]`),R&&R.position){e.beginBlock("float3[] translations.timeSamples = {","");const k=l(R.position);for(const G of k)e.appendLine(G);e.closeBlock()}e.closeBlock(),e.closeBlock()}}onSerialize(e,i){if(!this.model)return;const s=this.animationData.get(this.object);if(s)for(let d=0;d<s.length;d++)s[d]===void 0&&(s[d]=new bs(null,this.object,null));const r=this.ext;this.skinnedMeshExport(e,i,r);const o=this.object,a=this.model,l=this.animationData.get(o);if(!l||o.isSkinnedMesh)return;tU&&console.log("SERIALIZE",this.model.name,this.object.type,l);const c=Intl.NumberFormat("en-US",{maximumFractionDigits:3,minimumFractionDigits:0,useGrouping:!1});function h(d,u){var p;if(d.some(g=>g&&{position:g.pos,rotation:g.rot,scale:g.scale}[u])){switch(u){case"position":a.needsTranslate=!0,e.beginBlock("double3 xformOp:translate.timeSamples = {","");break;case"rotation":a.needsOrient=!0,e.beginBlock("quatf xformOp:orient.timeSamples = {","");break;case"scale":a.needsScale=!0,e.beginBlock("double3 xformOp:scale.timeSamples = {","");break}for(let g=0;g<d.length;g++){const f=d[g];if(!f)continue;const A=r.getStartTimeByClip(f.clip),y=f.getSortedTimesArray(u==="position",u==="rotation",u==="scale");if(!y||y.length===0){console.error("got an animated object but no time values?",o,f);continue}const b=!f.clip,v=u==="position"&&(f.pos||b),x=u==="rotation"&&(f.rot||b),w=u==="scale"&&(f.scale||b);if(v||x||w){const C=((p=f.clip)==null?void 0:p.name)??"rest",S=f.getDuration();Gd&&console.log("Write .timeSamples:",C,A,S,d),e.appendLine("# "+C+": start="+c.format(A*bs.frameRate)+", length="+c.format(S*bs.frameRate)+", frames="+f.getFrames())}if(v)for(const{time:C,translation:S}of f.getValues(y,!0,!1,!1)){const _=`${c.format((A+C)*bs.frameRate)}: (${Ri(S.x)}, ${Ri(S.y)}, ${Ri(S.z)}),`;e.appendLine(_)}if(x)for(const{time:C,rotation:S}of f.getValues(y,!1,!0,!1)){const _=`${c.format((A+C)*bs.frameRate)}: (${Ri(S.w)}, ${Ri(S.x)}, ${Ri(S.y)}, ${Ri(S.z)}),`;e.appendLine(_)}if(w)for(const{time:C,scale:S}of f.getValues(y,!1,!1,!0)){const _=`${c.format((A+C)*bs.frameRate)}: (${Ri(S.x)}, ${Ri(S.y)}, ${Ri(S.z)}),`;e.appendLine(_)}}e.closeBlock()}}h(l,"position"),h(l,"rotation"),h(l,"scale")}}class XPe extends is{constructor(e,i=1,s=16,r=2){const o=new Rt,a=s+r*2,l=new Float32Array((a*3+3)*3);o.setAttribute("position",new ct(l,3));const c=new Cn({color:65280}),h=new Cn({color:16776960});super(o,[h,c]),this.audio=e,this.range=i,this.divisionsInnerAngle=s,this.divisionsOuterAngle=r,this.type="PositionalAudioHelper",this.update()}update(){const e=this.audio,i=this.range,s=this.divisionsInnerAngle,r=this.divisionsOuterAngle,o=Di.degToRad(e.panner.coneInnerAngle),a=Di.degToRad(e.panner.coneOuterAngle),l=o/2,c=a/2;let h=0,d=0,u,p;const g=this.geometry,f=g.attributes.position;g.clearGroups();function A(y,b,v,x){const w=(b-y)/v;for(f.setXYZ(h,0,0,0),d++,u=y;u<b;u+=w)p=h+d,f.setXYZ(p,Math.sin(u)*i,0,Math.cos(u)*i),f.setXYZ(p+1,Math.sin(Math.min(u+w,b))*i,0,Math.cos(Math.min(u+w,b))*i),f.setXYZ(p+2,0,0,0),d+=3;g.addGroup(h,d,x),h+=d,d=0}A(-c,-l,r,0),A(-l,l,s,1),A(l,c,r,0),f.needsUpdate=!0,o===a&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}const Yne=Symbol("previous-visibility"),qC=class extends fi{render(n,e,i){if(i instanceof vD)this._unsupported_effectcomposer_warning||(console.warn("RenderTexture.render() does not yet support EffectComposer"),this._unsupported_effectcomposer_warning=!0);else{this.onBeforeRender();const s=i.getRenderTarget(),r=i.xr.enabled;i.xr.enabled=!1,i.setRenderTarget(this),i.clear(!0,!0,!0),i.render(n,e),i.setRenderTarget(s),i.xr.enabled=r,this.onAfterRender()}}onBeforeRender(){qC._userSet.clear();const n=Pz(this.texture,!0,null,qC._userSet);for(const e of n)e instanceof pe&&(e[Yne]=e.visible,e.visible=!1)}onAfterRender(){for(const n of qC._userSet)n instanceof pe&&(n.visible=n[Yne]);qC._userSet.clear()}};let cv=qC;m(cv,"_userSet",new Set);const jne={type:"change"},iU={type:"start"},Jne={type:"end"},mL=new ya,qne=new tr,DPe=Math.cos(70*Di.DEG2RAD),Tr=new E;new E;const al=2*Math.PI,Mn={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},nU=1e-6;let $ne=class extends ET{constructor(n,e=null){super(n,e),this.state=Mn.NONE,this.enabled=!0,this.target=new E,this.cursor=new E,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:nf.ROTATE,MIDDLE:nf.DOLLY,RIGHT:nf.PAN},this.touches={ONE:sf.ROTATE,TWO:sf.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new E,this._lastQuaternion=new Fe,this._lastTargetPosition=new E,this._quat=new Fe().setFromUnitVectors(n.up,new E(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new $P,this._sphericalDelta=new $P,this._scale=1,this._currentScale=1,this._panOffset=new E,this._rotateStart=new Q,this._rotateEnd=new Q,this._rotateDelta=new Q,this._panStart=new Q,this._panEnd=new Q,this._panDelta=new Q,this._dollyStart=new Q,this._dollyEnd=new Q,this._dollyDelta=new Q,this._dollyDirection=new E,this._mouse=new Q,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=FPe.bind(this),this._onPointerDown=zPe.bind(this),this._onPointerUp=UPe.bind(this),this._onContextMenu=YPe.bind(this),this._onMouseWheel=WPe.bind(this),this._onKeyDown=HPe.bind(this),this._onTouchStart=QPe.bind(this),this._onTouchMove=KPe.bind(this),this._onMouseDown=OPe.bind(this),this._onMouseMove=ZPe.bind(this),this._interceptControlDown=jPe.bind(this),this._interceptControlUp=JPe.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(n){n.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=n}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(jne),this.update(),this.state=Mn.NONE}update(n=null){const e=this.object.getWorldPosition(this.object.position);Tr.copy(e).sub(this.target),Tr.applyQuaternion(this._quat),this._spherical.setFromVector3(Tr),this.autoRotate&&this.state===Mn.NONE&&this._rotateLeft(this._getAutoRotationAngle(n)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(i)&&isFinite(s)&&(i<-Math.PI?i+=al:i>Math.PI&&(i-=al),s<-Math.PI?s+=al:s>Math.PI&&(s-=al),i<=s?this._spherical.theta=Math.max(i,Math.min(s,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+s)/2?Math.max(i,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let r=!1;if(this.enableDamping?this._currentScale=Di.lerp(this._currentScale,this._scale,this.dampingFactor):this._currentScale=this._scale,this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._currentScale),r=o!=this._spherical.radius}if(Tr.setFromSpherical(this._spherical),Tr.applyQuaternion(this._quatInverse),e.copy(this.target).add(Tr),this.object.parent?this.object.parent.worldToLocal(e):this.object.position.copy(e),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=Tr.length();o=this._clampDistance(a*this._currentScale);const l=a-o;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),r=!!l}else if(this.object.isOrthographicCamera){const a=new E(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._currentScale)),this.object.updateProjectionMatrix(),r=l!==this.object.zoom;const c=new E(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(a),this.object.updateMatrixWorld(),o=Tr.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(mL.origin.copy(this.object.position),mL.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(mL.direction))<DPe?this.object.lookAt(this.target):(qne.setFromNormalAndCoplanarPoint(this.object.up,this.target),mL.intersectPlane(qne,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),r=!0)}return this._scale=1,r||this._lastPosition.distanceToSquared(this.object.position)>nU||8*(1-this._lastQuaternion.dot(this.object.quaternion))>nU||this._lastTargetPosition.distanceToSquared(this.target)>nU?(this.dispatchEvent(jne),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):(this._performCursorZoom=!1,!1)}_getAutoRotationAngle(n){return n!==null?al/60*this.autoRotateSpeed*n:al/60/60*this.autoRotateSpeed}_getZoomScale(n){const e=Math.abs(n*.01);return Math.pow(.95,this.zoomSpeed*e)}_rotateLeft(n){this._sphericalDelta.theta-=n}_rotateUp(n){this._sphericalDelta.phi-=n}_panLeft(n,e){Tr.setFromMatrixColumn(e,0),Tr.multiplyScalar(-n),this._panOffset.add(Tr)}_panUp(n,e){this.screenSpacePanning===!0?Tr.setFromMatrixColumn(e,1):(Tr.setFromMatrixColumn(e,0),Tr.crossVectors(this.object.up,Tr)),Tr.multiplyScalar(n),this._panOffset.add(Tr)}_pan(n,e){const i=this.domElement;if(this.object.isPerspectiveCamera){this.object.getWorldPosition(Tr).sub(this.target);let s=Tr.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*n*s/i.clientHeight,this.object.matrixWorld),this._panUp(2*e*s/i.clientHeight,this.object.matrixWorld)}else this.object.isOrthographicCamera?(this._panLeft(n*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this._panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(n){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=n:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(n){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=n:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(n,e){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),s=n-i.left,r=e-i.top,o=i.width,a=i.height;this._mouse.x=s/o*2-1,this._mouse.y=-(r/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(n){return Math.max(this.minDistance,Math.min(this.maxDistance,n))}_handleMouseDownRotate(n){this._rotateStart.set(n.clientX,n.clientY)}_handleMouseDownDolly(n){this._updateZoomParameters(n.clientX,n.clientX),this._dollyStart.set(n.clientX,n.clientY)}_handleMouseDownPan(n){this._panStart.set(n.clientX,n.clientY)}_handleMouseMoveRotate(n){this._rotateEnd.set(n.clientX,n.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(al*this._rotateDelta.x/e.clientHeight),this._rotateUp(al*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(n){this._dollyEnd.set(n.clientX,n.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(n){this._panEnd.set(n.clientX,n.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(n){this._updateZoomParameters(n.clientX,n.clientY),n.deltaY<0?this._dollyIn(this._getZoomScale(n.deltaY)):n.deltaY>0&&this._dollyOut(this._getZoomScale(n.deltaY)),this.update()}_handleKeyDown(n){let e=!1;switch(n.code){case this.keys.UP:n.ctrlKey||n.metaKey||n.shiftKey?this._rotateUp(al*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),e=!0;break;case this.keys.BOTTOM:n.ctrlKey||n.metaKey||n.shiftKey?this._rotateUp(-al*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),e=!0;break;case this.keys.LEFT:n.ctrlKey||n.metaKey||n.shiftKey?this._rotateLeft(al*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),e=!0;break;case this.keys.RIGHT:n.ctrlKey||n.metaKey||n.shiftKey?this._rotateLeft(-al*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),e=!0;break}e&&(n.preventDefault(),this.update())}_handleTouchStartRotate(n){if(this._pointers.length===1)this._rotateStart.set(n.pageX,n.pageY);else{const e=this._getSecondPointerPosition(n),i=.5*(n.pageX+e.x),s=.5*(n.pageY+e.y);this._rotateStart.set(i,s)}}_handleTouchStartPan(n){if(this._pointers.length===1)this._panStart.set(n.pageX,n.pageY);else{const e=this._getSecondPointerPosition(n),i=.5*(n.pageX+e.x),s=.5*(n.pageY+e.y);this._panStart.set(i,s)}}_handleTouchStartDolly(n){const e=this._getSecondPointerPosition(n),i=n.pageX-e.x,s=n.pageY-e.y,r=Math.sqrt(i*i+s*s);this._dollyStart.set(0,r)}_handleTouchStartDollyPan(n){this.enableZoom&&this._handleTouchStartDolly(n),this.enablePan&&this._handleTouchStartPan(n)}_handleTouchStartDollyRotate(n){this.enableZoom&&this._handleTouchStartDolly(n),this.enableRotate&&this._handleTouchStartRotate(n)}_handleTouchMoveRotate(n){if(this._pointers.length==1)this._rotateEnd.set(n.pageX,n.pageY);else{const i=this._getSecondPointerPosition(n),s=.5*(n.pageX+i.x),r=.5*(n.pageY+i.y);this._rotateEnd.set(s,r)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(al*this._rotateDelta.x/e.clientHeight),this._rotateUp(al*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(n){if(this._pointers.length===1)this._panEnd.set(n.pageX,n.pageY);else{const e=this._getSecondPointerPosition(n),i=.5*(n.pageX+e.x),s=.5*(n.pageY+e.y);this._panEnd.set(i,s)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(n){const e=this._getSecondPointerPosition(n),i=n.pageX-e.x,s=n.pageY-e.y,r=Math.sqrt(i*i+s*s);this._dollyEnd.set(0,r),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(n.pageX+e.x)*.5,a=(n.pageY+e.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(n){this.enableZoom&&this._handleTouchMoveDolly(n),this.enablePan&&this._handleTouchMovePan(n)}_handleTouchMoveDollyRotate(n){this.enableZoom&&this._handleTouchMoveDolly(n),this.enableRotate&&this._handleTouchMoveRotate(n)}_addPointer(n){this._pointers.push(n.pointerId)}_removePointer(n){delete this._pointerPositions[n.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==n.pointerId){this._pointers.splice(e,1);return}}_isTrackingPointer(n){for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==n.pointerId)return!0;return!1}_trackPointer(n){let e=this._pointerPositions[n.pointerId];e===void 0&&(e=new Q,this._pointerPositions[n.pointerId]=e),e.set(n.pageX,n.pageY)}_getSecondPointerPosition(n){const e=n.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[e]}_customWheelEvent(n){const e=n.deltaMode,i={clientX:n.clientX,clientY:n.clientY,deltaY:n.deltaY};switch(e){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return n.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}};function zPe(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),window.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function FPe(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function UPe(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Jne),this.state=Mn.NONE;break;case 1:const e=this._pointers[0],i=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:i.x,pageY:i.y});break}}function OPe(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case nf.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=Mn.DOLLY;break;case nf.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Mn.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Mn.ROTATE}break;case nf.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Mn.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Mn.PAN}break;default:this.state=Mn.NONE}this.state!==Mn.NONE&&this.dispatchEvent(iU)}function ZPe(n){switch(this.state){case Mn.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case Mn.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case Mn.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function WPe(n){this.enabled===!1||this.enableZoom===!1||this.state!==Mn.NONE||(n.preventDefault(),this.dispatchEvent(iU),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(Jne))}function HPe(n){this.enabled===!1||this.enablePan===!1||this._handleKeyDown(n)}function QPe(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case sf.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=Mn.TOUCH_ROTATE;break;case sf.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=Mn.TOUCH_PAN;break;default:this.state=Mn.NONE}break;case 2:switch(this.touches.TWO){case sf.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=Mn.TOUCH_DOLLY_PAN;break;case sf.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=Mn.TOUCH_DOLLY_ROTATE;break;default:this.state=Mn.NONE}break;default:this.state=Mn.NONE}this.state!==Mn.NONE&&this.dispatchEvent(iU)}function KPe(n){switch(this._trackPointer(n),this.state){case Mn.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case Mn.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case Mn.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case Mn.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=Mn.NONE}}function YPe(n){this.enabled!==!1&&n.preventDefault()}function jPe(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function JPe(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}var qPe=Object.defineProperty,$Pe=Object.getOwnPropertyDescriptor,$C=(n,e,i,s)=>{for(var r=s>1?void 0:s?$Pe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&qPe(e,i,r),r};const sU=q("debuggroundprojection");class Pd extends Oe{constructor(){super(...arguments),m(this,"applyOnAwake",!1),m(this,"autoFit",!0),m(this,"_radius",50),m(this,"_height",3),m(this,"_arblending",0),m(this,"_lastEnvironment"),m(this,"_lastRadius"),m(this,"_lastHeight"),m(this,"_projection"),m(this,"_watcher"),m(this,"_needsTextureUpdate",!1),m(this,"_blurrynessShader",null),m(this,"_lastBlurriness",-1)}set radius(e){this._radius=e,this.updateProjection()}get radius(){return this._radius}set height(e){this._height=e,this.updateProjection()}get height(){return this._height}set arBlending(e){this._arblending=e,this._needsTextureUpdate=!0}get arBlending(){return this._arblending}awake(){this.applyOnAwake&&this.updateAndCreate()}onEnable(){this.context.time.frameCount>0&&this.applyOnAwake&&this.updateAndCreate(),this._watcher||(this._watcher=new Xp(this.context.scene,"environment"),this._watcher.subscribeWrite(e=>{this.updateProjection()}))}onDisable(){var e,i;(e=this._watcher)==null||e.revoke(),(i=this._projection)==null||i.removeFromParent()}onEnterXR(){this.activeAndEnabled&&(this._needsTextureUpdate=!0,this.updateProjection())}async onLeaveXR(){this.activeAndEnabled&&(await RE(1),this.updateProjection())}onBeforeRender(){this._projection&&this.scene.backgroundRotation&&this._projection.rotation.copy(this.scene.backgroundRotation),this.context.scene.backgroundBlurriness!==void 0&&this._lastBlurriness!=this.context.scene.backgroundBlurriness&&this.context.scene.backgroundBlurriness>.001?this.updateProjection():this._needsTextureUpdate&&this.updateBlurriness()}updateAndCreate(){var e;this.updateProjection(),(e=this._watcher)==null||e.apply()}updateProjection(){var e,i,s,r,o;if(!this.context.scene.environment){(e=this._projection)==null||e.removeFromParent();return}if(((i=this.context.xr)!=null&&i.isPassThrough||(s=this.context.xr)!=null&&s.isAR)&&this.arBlending===0){(r=this._projection)==null||r.removeFromParent();return}if(!this.gameObject||this.destroyed)return;let a=!0;const l=0;if(!this._projection||this.context.scene.environment!==this._lastEnvironment||this._height!==this._lastHeight||this._radius!==this._lastRadius){if(sU&&console.log("Create/Update Ground Projection",this.context.scene.environment.name),(o=this._projection)==null||o.removeFromParent(),!this._projection||this.context.scene.environment!==this._lastEnvironment||this._lastHeight!==this._height||this._lastRadius!==this._radius)try{this._projection=new tb(this.context.scene.environment,this._height,this.radius,64)}catch(c){console.error("Failed to enable GroundProjection for environment",c);return}else a=!1;this._projection.position.y=this._height-l,this._projection.name="GroundProjection",uD(this._projection,!1)}else a=!1;if(this._projection.parent||this.gameObject.add(this._projection),this.autoFit&&a){this._projection.updateWorldMatrix(!0,!0);const c=Ll(this.context.scene.children,[this._projection]),h=c.min.y;if(h<1/0){const d=Lt();d.x=c.min.x+(c.max.x-c.min.x)*.5;const u=Dn(this.gameObject).x;d.y=h+this._height*u-l,d.z=c.min.z+(c.max.z-c.min.z)*.5,Cr(this._projection,d)}sU&&Nt.DrawWireBox3(c,65280,5)}this.context.scene.backgroundBlurriness>.001&&this._needsTextureUpdate&&this.updateBlurriness(),this._lastEnvironment=this.context.scene.environment,this._lastHeight=this._height,this._lastRadius=this._radius,this._needsTextureUpdate=!1}updateBlurriness(){var e;if(this._projection){if(!this.context.scene.environment)return}else return;this._needsTextureUpdate=!1,sU&&console.log("Update Blurriness",this.context.scene.backgroundBlurriness),this._blurrynessShader??(this._blurrynessShader=new jt({name:"GroundProjectionBlurriness",uniforms:{map:{value:this.context.scene.environment},blurriness:{value:this.context.scene.backgroundBlurriness},blending:{value:0},alphaFactor:{value:1}},vertexShader:eNe,fragmentShader:tNe})),this._blurrynessShader.depthWrite=!1,this._blurrynessShader.uniforms.blurriness.value=this.context.scene.backgroundBlurriness,this._lastBlurriness=this.context.scene.backgroundBlurriness,this.context.scene.environment.needsPMREMUpdate=!0;const i=this._projection.material.transparent;this._projection.material.transparent=(((e=this.context.xr)==null?void 0:e.isAR)===!0&&this.arBlending>1e-6)??!1,this._projection.material.transparent?this._blurrynessShader.uniforms.blending.value=this.arBlending:this._blurrynessShader.uniforms.blending.value=0,this.context.isInPassThrough?this._blurrynessShader.uniforms.alphaFactor.value=.95:this._blurrynessShader.uniforms.alphaFactor.value=1,i!==this._projection.material.transparent&&(this._projection.material.needsUpdate=!0),this._projection.material.map=Tc.copyTexture(this.context.scene.environment,this._blurrynessShader),this._projection.material.depthTest=!0,this._projection.material.depthWrite=!1}}$C([T()],Pd.prototype,"applyOnAwake",2),$C([T()],Pd.prototype,"autoFit",2),$C([T()],Pd.prototype,"radius",1),$C([T()],Pd.prototype,"height",1),$C([T()],Pd.prototype,"arBlending",1);const eNe=`
  varying vec2 vUv;

  void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,tNe=`
  uniform sampler2D map;
  uniform float blurriness;
  uniform float alphaFactor;
  uniform float blending;
  varying vec2 vUv;

  const float PI = 3.14159265359;

  // Gaussian function
  float gaussian(float x, float sigma) {
    return exp(-(x * x) / (2.0 * sigma * sigma)) / (sqrt(2.0 * PI) * sigma);
  }

  // Custom smoothstep function for desired falloff
  float customSmoothstep(float edge0, float edge1, float x) {
    float t = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return t * t * (3.0 - 2.0 * t);
  }

  void main() {
    vec2 center = vec2(0.0, 0.0);
    vec2 pos = vUv;
    pos.x = 0.0; // Only consider vertical distance
    float distance = length(pos - center);
    
    // Calculate blur amount based on custom falloff
    float blurAmount = customSmoothstep(0.5, 1.0, distance * 2.0);
    blurAmount = clamp(blurAmount, 0.0, 1.0); // Ensure blur amount is within valid range

    // Gaussian blur
    vec2 pixelSize = 1.0 / vec2(textureSize(map, 0));
    vec4 color = vec4(0.0);
    float totalWeight = 0.0;
    int blurSize = int(60.0 * min(1.0, blurriness) * blurAmount); // Adjust blur size based on distance and blurriness
    float lodLevel = log2(float(blurSize)) * 0.5; // Compute LOD level

    for (int x = -blurSize; x <= blurSize; x++) {
        for (int y = -blurSize; y <= blurSize; y++) {
            vec2 offset = vec2(float(x), float(y)) * pixelSize * blurAmount;
            float weight = gaussian(length(vec2(float(x), float(y))), 1000.0 * blurAmount); // Use a fixed sigma value
            color += textureLod(map, vUv + offset, lodLevel) * weight;
            totalWeight += weight;
        }
    }

    color = totalWeight > 0.0 ? color / totalWeight : texture2D(map, vUv);

    gl_FragColor = color;

    float brightness = dot(gl_FragColor.rgb, vec3(0.299, 0.587, 0.114));
    float stepFactor = blending - brightness * .1;
    gl_FragColor.a = pow(1.0 - blending * customSmoothstep(0.35 * stepFactor, 0.45 * stepFactor, distance), 5.);
    gl_FragColor.a *= alphaFactor;
    // gl_FragColor.rgb = vec3(1.0);

    // #include <tonemapping_fragment>
    // #include <colorspace_fragment>
    
    // Uncomment to visualize blur amount
    // gl_FragColor = vec4(blurAmount, 0.0, 0.0, 1.0);
  }
`;var iNe=Object.defineProperty,nNe=Object.getOwnPropertyDescriptor,rU=(n,e,i,s)=>{for(var r=s>1?void 0:s?nNe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&iNe(e,i,r),r};class O0 extends Oe{constructor(){super(...arguments),m(this,"constraintActive",!0),m(this,"locked",!1),m(this,"sources",[])}}rU([T()],O0.prototype,"constraintActive",2),rU([T()],O0.prototype,"locked",2),rU([T(Ae)],O0.prototype,"sources",2);function sNe(n,e){return qu(n,nn.ContextCreated,e),()=>Hm(n,nn.ContextCreated)}function rNe(n,e){return qu(n,nn.ContextClearing,e),()=>Hm(n,nn.ContextClearing)}function oNe(n,e){return qu(n,nn.ContextDestroying,e),()=>Hm(n,nn.ContextDestroying)}function oU(n,e){return qu(n,_n.Start,e),()=>Hm(n,_n.Start)}function aU(n,e){return qu(n,_n.Update,e),()=>Hm(n,_n.Update)}function ese(n,e){return qu(n,_n.OnBeforeRender,e),()=>Hm(n,_n.OnBeforeRender)}function aNe(n,e){return qu(n,_n.OnAfterRender,e),()=>Hm(n,_n.OnAfterRender)}class Z0{constructor(){m(this,"bb",null),m(this,"bb_pos",0)}__init(e,i){return this.bb_pos=e,this.bb=i,this}x(){return this.bb.readFloat32(this.bb_pos)}y(){return this.bb.readFloat32(this.bb_pos+4)}z(){return this.bb.readFloat32(this.bb_pos+8)}static sizeOf(){return 12}static createVec3(e,i,s,r){return e.prep(4,12),e.writeFloat32(r),e.writeFloat32(s),e.writeFloat32(i),e.offset()}}class tse{constructor(){m(this,"bb",null),m(this,"bb_pos",0)}__init(e,i){return this.bb_pos=e,this.bb=i,this}position(e){return(e||new Z0).__init(this.bb_pos,this.bb)}rotation(e){return(e||new Z0).__init(this.bb_pos+12,this.bb)}scale(e){return(e||new Z0).__init(this.bb_pos+24,this.bb)}static sizeOf(){return 36}static createTransform(e,i,s,r,o,a,l,c,h,d){return e.prep(4,36),e.prep(4,12),e.writeFloat32(d),e.writeFloat32(h),e.writeFloat32(c),e.prep(4,12),e.writeFloat32(l),e.writeFloat32(a),e.writeFloat32(o),e.prep(4,12),e.writeFloat32(r),e.writeFloat32(s),e.writeFloat32(i),e.offset()}}class Fp{constructor(){m(this,"bb",null),m(this,"bb_pos",0)}__init(e,i){return this.bb_pos=e,this.bb=i,this}static getRootAsSyncedTransformModel(e,i){return(i||new Fp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedTransformModel(e,i){return e.setPosition(e.position()+Q5),(i||new Fp).__init(e.readInt32(e.position())+e.position(),e)}guid(e){const i=this.bb.__offset(this.bb_pos,4);return i?this.bb.__string(this.bb_pos+i,e):null}fast(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}transform(e){const i=this.bb.__offset(this.bb_pos,8);return i?(e||new tse).__init(this.bb_pos+i,this.bb):null}dontSave(){const e=this.bb.__offset(this.bb_pos,10);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startSyncedTransformModel(e){e.startObject(4)}static addGuid(e,i){e.addFieldOffset(0,i,0)}static addFast(e,i){e.addFieldInt8(1,+i,0)}static addTransform(e,i){e.addFieldStruct(2,i,0)}static addDontSave(e,i){e.addFieldInt8(3,+i,0)}static endSyncedTransformModel(e){return e.endObject()}static finishSyncedTransformModelBuffer(e,i){e.finish(i)}static finishSizePrefixedSyncedTransformModelBuffer(e,i){e.finish(i,void 0,!0)}}var Jr=(n=>(n[n.Average=0]="Average",n[n.Multiply=1]="Multiply",n[n.Minimum=2]="Minimum",n[n.Maximum=3]="Maximum",n))(Jr||{}),gL=(n=>(n[n.Discrete=0]="Discrete",n[n.Continuous=1]="Continuous",n))(gL||{}),Qs=(n=>(n[n.None=0]="None",n[n.FreezePositionX=2]="FreezePositionX",n[n.FreezePositionY=4]="FreezePositionY",n[n.FreezePositionZ=8]="FreezePositionZ",n[n.FreezePosition=14]="FreezePosition",n[n.FreezeRotationX=16]="FreezeRotationX",n[n.FreezeRotationY=32]="FreezeRotationY",n[n.FreezeRotationZ=64]="FreezeRotationZ",n[n.FreezeRotation=112]="FreezeRotation",n[n.FreezeAll=126]="FreezeAll",n))(Qs||{}),hv=(n=>(n[n.None=0]="None",n[n.X=2]="X",n[n.Y=4]="Y",n[n.Z=8]="Z",n[n.All=-1]="All",n))(hv||{});const Io=function(n,e){return function(i,s,r){lNe(i,s,r,n,e)}};function lNe(n,e,i,s,r){if(!r&&!s&&!n.onValidate)return;if(i!==void 0){console.error("Invalid usage of validate decorator. Only fields can be validated.",n,e,i),ss("Invalid usage of validate decorator. Only fields can be validated. Property: "+e,Rl.Error);return}let o="";if(typeof e=="string"?o=e:o=e.name,n.__internalAwake){const a=Symbol(o),l=n.__internalAwake;n.__internalAwake=function(){var c;if(!this.onValidate){Je()&&console.warn('Usage of @validate decorate detected but there is no onValidate method in your class: "'+((c=n.constructor)==null?void 0:c.name)+'"');return}if(this[a]===void 0){this[a]=this[o];const h=this[o];if(h instanceof Q||h instanceof E||h instanceof $e||h instanceof Fe){const d=this[o];BE(d,()=>{this.onValidate(o)})}Object.defineProperty(this,o,{set:function(d){var u;if(this[eF]===!0)this[a]=d;else{s?.call(this,d);const p=this[a];this[a]=d,(u=this.onValidate)==null||u.call(this,o,p)}},get:function(){return r?.call(this),this[a]}})}l.call(this)}}}const cNe=function(n){return function(e,i,s){let r="";typeof i=="string"?r=i:r=i.name;const o=n.prototype,a=Object.getOwnPropertyDescriptor(o,r);if(!(a!=null&&a.value)){console.warn("Can not apply prefix: type does not have method named",i,n);return}const l=a.value,c=e[r];Object.defineProperty(o,r,{value:function(...h){const d=c?.call(this,...h);if(d instanceof Promise){d.then(u=>{if(u!==!1)return l.call(this,...h)});return}if(d!==!1)return l.call(this,...h)}})}};var hNe=Object.defineProperty,dNe=Object.getOwnPropertyDescriptor,Hl=(n,e,i,s)=>{for(var r=s>1?void 0:s?dNe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&hNe(e,i,r),r};class uNe{constructor(e,i){m(this,"positionChanged",!1),m(this,"rotationChanged",!1),m(this,"position"),m(this,"quaternion"),m(this,"_positionKeys",["x","y","z"]),m(this,"_quaternionKeys",["_x","_y","_z","_w"]),m(this,"mute",!1),m(this,"context"),m(this,"obj"),m(this,"_positionWatch"),m(this,"_rotationWatch"),this.context=i,this.obj=e}get isDirty(){return this.positionChanged||this.rotationChanged}reset(e=!1){if(this.positionChanged=!1,this.rotationChanged=!1,this.mute=!1,e){if(this.position)for(const i of this._positionKeys)delete this.position[i];if(this.quaternion)for(const i of this._quaternionKeys)delete this.quaternion[i]}}syncValues(){for(const e of this._positionKeys)this.position[e]=this.obj.position[e];for(const e of this._quaternionKeys)this.quaternion[e]=this.obj.quaternion[e]}applyValues(){if(this.positionChanged&&this.position)for(const e of this._positionKeys){const i=this.position[e];i!==void 0&&(this.obj.position[e]=i)}if(this.rotationChanged&&this.quaternion)for(const e of this._quaternionKeys){const i=this.quaternion[e];i!==void 0&&(this.obj.quaternion[e]=i)}}start(e,i){this.reset(),e&&(this._positionWatch||(this._positionWatch=new Xp(this.obj.position,["x","y","z"])),this._positionWatch.apply(),this.position={},this._positionWatch.subscribeWrite((o,a)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const c=this.position[a];Math.abs(c-o)<1e-5||(this.position[a]=o,this.positionChanged=!0)})),i&&(this._rotationWatch||(this._rotationWatch=new Xp(this.obj.quaternion,["_x","_y","_z","_w"])),this._rotationWatch.apply(),this.quaternion={},this._rotationWatch.subscribeWrite((o,a)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const c=this.quaternion[a];Math.abs(c-o)<1e-5||(this.quaternion[a]=o,this.rotationChanged=!0)}));const s=this.obj.matrixWorld.multiplyMatrices.bind(this.obj.matrixWorld),r=new de;this.obj.matrixWorld.multiplyMatrices=(o,a)=>{var l;return(l=this.context.physics.engine)!=null&&l.isUpdating||this.mute||r.equals(o)||(this.positionChanged=!0,this.rotationChanged=!0,r.copy(o)),s(o,a)}}stop(){var e,i;(e=this._positionWatch)==null||e.revoke(),(i=this._rotationWatch)==null||i.revoke()}}var lU;const cU=(lU=class extends Oe{constructor(){super(...arguments),m(this,"autoMass",!0),m(this,"_mass",0),m(this,"useGravity",!0),m(this,"centerOfMass",new E(0,0,0)),m(this,"constraints",Qs.None),m(this,"isKinematic",!1),m(this,"drag",0),m(this,"angularDrag",1),m(this,"detectCollisions",!0),m(this,"sleepThreshold",.01),m(this,"collisionDetectionMode",gL.Discrete),m(this,"_gravityScale",1),m(this,"dominanceGroup",0),m(this,"_propertiesChanged",!1),m(this,"_currentVelocity",new E),m(this,"_smoothedVelocity",new E),m(this,"_smoothedVelocityGetter",new E),m(this,"_lastPosition",new E),m(this,"_watch")}set mass(n){n!==this._mass&&(this._mass=n,this._propertiesChanged=!0,this.__didAwake&&(this.autoMass=!1))}get mass(){var n,e;return this.autoMass?((e=(n=this.context.physics.engine)==null?void 0:n.getBody(this))==null?void 0:e.mass())??-1:this._mass}get lockPositionX(){return(this.constraints&Qs.FreezePositionX)!==0}get lockPositionY(){return(this.constraints&Qs.FreezePositionY)!==0}get lockPositionZ(){return(this.constraints&Qs.FreezePositionZ)!==0}get lockRotationX(){return(this.constraints&Qs.FreezeRotationX)!==0}get lockRotationY(){return(this.constraints&Qs.FreezeRotationY)!==0}get lockRotationZ(){return(this.constraints&Qs.FreezeRotationZ)!==0}set lockPositionX(n){n?this.constraints|=Qs.FreezePositionX:this.constraints&=~Qs.FreezePositionX}set lockPositionY(n){n?this.constraints|=Qs.FreezePositionY:this.constraints&=~Qs.FreezePositionY}set lockPositionZ(n){n?this.constraints|=Qs.FreezePositionZ:this.constraints&=~Qs.FreezePositionZ}set lockRotationX(n){n?this.constraints|=Qs.FreezeRotationX:this.constraints&=~Qs.FreezeRotationX}set lockRotationY(n){n?this.constraints|=Qs.FreezeRotationY:this.constraints&=~Qs.FreezeRotationY}set lockRotationZ(n){n?this.constraints|=Qs.FreezeRotationZ:this.constraints&=~Qs.FreezeRotationZ}set gravityScale(n){this._gravityScale=n}get gravityScale(){return this._gravityScale}awake(){this._watch=void 0,this._propertiesChanged=!1}onEnable(){var n;this._watch||(this._watch=new uNe(this.gameObject,this.context)),this._watch.start(!0,!0),this.startCoroutine(this.beforePhysics(),_n.LateUpdate),Je()&&!((n=this.context.physics.engine)!=null&&n.getBody(this))&&(globalThis.false?console.warn(`Rigidbody could not be created. Ensure "(${this.name}" has a Collider component.`):console.warn("Rigidbody could not be created: Rapier physics are explicitly disabled."))}onDisable(){var n,e;(n=this._watch)==null||n.stop(),(e=this.context.physics.engine)==null||e.removeBody(this)}onDestroy(){var n;(n=this.context.physics.engine)==null||n.removeBody(this)}onValidate(){this._propertiesChanged=!0}*beforePhysics(){for(var n,e,i,s;;)this._propertiesChanged&&(this._propertiesChanged=!1,(n=this.context.physics.engine)==null||n.updateProperties(this)),(e=this._watch)!=null&&e.isDirty?(this._watch.mute=!0,this._watch.applyValues(),(i=this.context.physics.engine)==null||i.updateBody(this,this._watch.positionChanged,this._watch.rotationChanged),this._watch.reset()):(s=this._watch)==null||s.syncValues(),this.captureVelocity(),yield}teleport(n,e=!0){var i;(i=this._watch)==null||i.reset(!0),e?this.gameObject.position.set(n.x,n.y,n.z):this.setWorldPosition(n.x,n.y,n.z),this.resetForcesAndTorques(),this.resetVelocities()}resetForces(n=!0){var e;(e=this.context.physics.engine)==null||e.resetForces(this,n)}resetTorques(n=!0){var e;(e=this.context.physics.engine)==null||e.resetTorques(this,n)}resetVelocities(){this.setVelocity(0,0,0),this.setAngularVelocity(0,0,0)}resetForcesAndTorques(){this.resetForces(),this.resetTorques()}wakeUp(){var n;(n=this.context.physics.engine)==null||n.wakeup(this)}get isSleeping(){var n;return(n=this.context.physics.engine)==null?void 0:n.isSleeping(this)}updateProperties(){var n;return this._propertiesChanged=!1,(n=this.context.physics.engine)==null?void 0:n.updateProperties(this)}applyForce(n,e,i=!0){var s;this._propertiesChanged&&this.updateProperties(),(s=this.context.physics.engine)==null||s.addForce(this,n,i)}applyImpulse(n,e=!0){var i;this._propertiesChanged&&this.updateProperties(),(i=this.context.physics.engine)==null||i.applyImpulse(this,n,e)}setForce(n,e,i,s=!0){var r,o,a;(r=this.context.physics.engine)==null||r.resetForces(this,s),typeof n=="number"?(e??(e=0),i??(i=0),(o=this.context.physics.engine)==null||o.addForce(this,{x:n,y:e,z:i},s)):(a=this.context.physics.engine)==null||a.addForce(this,n,s)}getVelocity(){var n;const e=(n=this.context.physics.engine)==null?void 0:n.getLinearVelocity(this);return e?(this._currentVelocity.x=e.x,this._currentVelocity.y=e.y,this._currentVelocity.z=e.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setVelocity(n,e,i,s=!0){var r,o;if(n instanceof E){const a=n;(r=this.context.physics.engine)==null||r.setLinearVelocity(this,a,s);return}e===void 0||i===void 0||(o=this.context.physics.engine)==null||o.setLinearVelocity(this,{x:n,y:e,z:i},s)}getAngularVelocity(){var n;const e=(n=this.context.physics.engine)==null?void 0:n.getAngularVelocity(this);return e?(this._currentVelocity.x=e.x,this._currentVelocity.y=e.y,this._currentVelocity.z=e.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setAngularVelocity(n,e,i,s=!0){var r,o;if(typeof n=="object"){const a=n;(r=this.context.physics.engine)==null||r.setAngularVelocity(this,a,s);return}if(e===void 0||i===void 0||typeof e=="boolean"){console.warn("setAngularVelocity expects either a Vec3 or 3 numbers");return}(o=this.context.physics.engine)==null||o.setAngularVelocity(this,{x:n,y:e,z:i},s)}setTorque(n,e,i){typeof n=="number"?this.setAngularVelocity(n,e,i):this.setAngularVelocity(n)}get smoothedVelocity(){return this._smoothedVelocityGetter.copy(this._smoothedVelocity),this._smoothedVelocityGetter.multiplyScalar(1/this.context.time.deltaTime)}setBodyFromGameObject(n=null){}captureVelocity(){const n=ri(this.gameObject);this.gameObject.matrixWorld.decompose(cU.tempPosition,pNe,mNe);const e=n.sub(this._lastPosition);this._lastPosition.copy(cU.tempPosition),this._smoothedVelocity.lerp(e,this.context.time.deltaTime/.1)}},m(lU,"tempPosition",new E),lU);let rn=cU;Hl([Io()],rn.prototype,"autoMass",2),Hl([T()],rn.prototype,"mass",1),Hl([Io(),T()],rn.prototype,"useGravity",2),Hl([T(E)],rn.prototype,"centerOfMass",2),Hl([Io(),T()],rn.prototype,"constraints",2),Hl([Io(),T()],rn.prototype,"isKinematic",2),Hl([Io(),T()],rn.prototype,"drag",2),Hl([Io(),T()],rn.prototype,"angularDrag",2),Hl([Io(),T()],rn.prototype,"detectCollisions",2),Hl([Io(),T()],rn.prototype,"sleepThreshold",2),Hl([Io(),T()],rn.prototype,"collisionDetectionMode",2),Hl([Io()],rn.prototype,"_gravityScale",2),Hl([Io()],rn.prototype,"dominanceGroup",2),new E;const pNe=new Fe,mNe=new E,hg=q("debugsync"),eS="STRS";j5(eS,Fp.getRootAsSyncedTransformModel);const Nd=new $_;function ise(n,e,i=!0){Nd.clear();const s=Nd.createString(n);Fp.startSyncedTransformModel(Nd),Fp.addGuid(Nd,s),Fp.addFast(Nd,i);const r=e.worldPosition,o=e.worldEuler,a=e.gameObject.scale;Fp.addTransform(Nd,tse.createTransform(Nd,r.x,r.y,r.z,o.x,o.y,o.z,a.x,a.y,a.z));const l=Fp.endSyncedTransformModel(Nd);return Nd.finish(l,eS),Nd.asUint8Array()}let hU=0,tS=0;aU(n=>{var e;const i=(e=n.connection.currentServerUrl)!=null&&e.includes("glitch")?10:40;tS=Math.floor(hU/i),hU=0,hg&&tS>0&&console.log("Sync Transform Fast Interval",tS)});class Vd extends Oe{constructor(){super(...arguments),m(this,"overridePhysics",!0),m(this,"interpolatePosition",!0),m(this,"interpolateRotation",!0),m(this,"fastMode",!1),m(this,"syncDestroy",!1),m(this,"_model",null),m(this,"_needsUpdate",!0),m(this,"rb",null),m(this,"_wasKinematic",!1),m(this,"_receivedDataBefore",!1),m(this,"_targetPosition"),m(this,"_targetRotation"),m(this,"_receivedFastUpdate",!1),m(this,"_shouldRequestOwnership",!1),m(this,"joinedRoomCallback",null),m(this,"receivedDataCallback",null),m(this,"tempEuler",new Oi),m(this,"receivedUpdate",!1),m(this,"lastWorldPos"),m(this,"lastWorldRotation")}requestOwnership(){hg&&console.log("Request ownership"),this._model?this._model.requestOwnership():(this._shouldRequestOwnership=!0,this._needsUpdate=!0)}hasOwnership(){var e;return((e=this._model)==null?void 0:e.hasOwnership)??void 0}isOwned(){var e;return(e=this._model)==null?void 0:e.isOwned}awake(){hg&&console.log("new instance",this.guid,this),this._receivedDataBefore=!1,this._targetPosition=new E,this._targetRotation=new Fe,this.lastWorldPos=new E,this.lastWorldRotation=new Fe,this.rb=$.getComponentInChildren(this.gameObject,rn),this.rb&&(this._wasKinematic=this.rb.isKinematic),this.receivedUpdate=!0,this._model=new gz(this.context.connection,this.guid),this.context.connection.isConnected&&this.tryGetLastState(),this.joinedRoomCallback=this.tryGetLastState.bind(this),this.context.connection.beginListen(pi.JoinedRoom,this.joinedRoomCallback),this.receivedDataCallback=this.onReceivedData.bind(this),this.context.connection.beginListenBinary(eS,this.receivedDataCallback)}onDestroy(){this.syncDestroy&&Wz(this.guid,this.context.connection),this._model=null,this.context.connection.stopListen(pi.JoinedRoom,this.joinedRoomCallback),this.context.connection.stopListenBinary(eS,this.receivedDataCallback)}tryGetLastState(){const e=this.context.connection.tryGetState(this.guid);e&&this.onReceivedData(e)}onReceivedData(e){var i;if(!this.destroyed&&typeof e.guid=="function"&&e.guid()===this.guid){hg&&console.log("new data",this.context.connection.connectionId,this.context.time.frameCount,this.guid,e),this.receivedUpdate=!0,this._receivedFastUpdate=e.fast();const s=e.transform();if(s){ih.markDirty(this.gameObject,!0);const r=s.position();r&&(this.interpolatePosition&&((i=this._targetPosition)==null||i.set(r.x(),r.y(),r.z())),(!this.interpolatePosition||!this._receivedDataBefore)&&this.setWorldPosition(r.x(),r.y(),r.z()));const o=s.rotation();o&&(this.tempEuler.set(o.x(),o.y(),o.z()),this.interpolateRotation&&this._targetRotation.setFromEuler(this.tempEuler),(!this.interpolateRotation||!this._receivedDataBefore)&&hD(this.gameObject,this.tempEuler))}this._receivedDataBefore=!0}}onEnable(){this.lastWorldPos.copy(this.worldPosition),this.lastWorldRotation.copy(this.worldQuaternion),this._needsUpdate=!0,this._model&&this._model.updateIsOwned()}onDisable(){this._model&&this._model.freeOwnership()}onBeforeRender(){if(!this.activeAndEnabled||!this.context.connection.isConnected)return;if(!this.context.connection.isInRoom||!this._model){hg&&console.log("no model or room",this.name,this.guid,this.context.connection.isInRoom);return}this._shouldRequestOwnership&&(this._shouldRequestOwnership=!1,this._model.requestOwnership());const e=this.worldPosition,i=this.worldQuaternion;if(this._model.isOwned&&!this.receivedUpdate){const o=e.distanceTo(this.lastWorldPos),a=i.angleTo(this.lastWorldRotation),l=this._model.hasOwnership||this.fastMode?1e-4:.001;(o>l||a>l)&&(this._model.hasOwnership?this._needsUpdate=!0:(hg&&console.log(this.guid,"reset because not owned but",this.gameObject.name,this.lastWorldPos),this.worldPosition=this.lastWorldPos,e.copy(this.lastWorldPos),this.worldQuaternion=this.lastWorldRotation,i.copy(this.lastWorldRotation),ih.markDirty(this.gameObject,!0),this._needsUpdate=!1))}if(this._model&&!this._model.hasOwnership&&this._model.isOwned&&this._receivedDataBefore){const o=this._receivedFastUpdate||this.fastMode?.5:.3;let a=!1;if(this.interpolatePosition&&this._targetPosition){const l=this.worldPosition;l.lerp(this._targetPosition,o),this.worldPosition=l,a=!0}if(this.interpolateRotation&&this._targetRotation){const l=this.worldQuaternion;l.slerp(this._targetRotation,o),this.worldQuaternion=l,a=!0}a&&ih.markDirty(this.gameObject,!0)}if(this.receivedUpdate=!1,this.lastWorldPos.copy(e),this.lastWorldRotation.copy(i),!this._model||!this._model||this._model.hasOwnership===void 0||!this._model.hasOwnership)return;this.rb&&this.overridePhysics&&this._wasKinematic!==void 0&&(hg&&console.log("reset kinematic",this.rb.name,this._wasKinematic),this.rb.isKinematic=this._wasKinematic);const s=10,r=this.rb||this.fastMode;if(this._needsUpdate&&(this.context.time.frameCount%s===0||r)){if(hU++,r&&tS>0&&this.context.time.frameCount%tS!==0)return;hg&&console.log("send update",this.context.connection.connectionId,this.guid,this.gameObject.name,this.gameObject.guid),this._needsUpdate=!1;const o=ise(this.guid,this,!!r);this.context.connection.sendBinary(o)}}}const gNe=q("debugshadowcomponents");JX.prototype.interactable={get(){return this.interactive},set(n){this.interactable=n}};const zc=Symbol("shadowDomOwner");class th extends Oe{constructor(){super(...arguments),m(this,"_shadowComponent",null),m(this,"_controlsChildLayout",!0),m(this,"_root"),m(this,"_parentComponent")}isRoot(){var e;return((e=this.Root)==null?void 0:e.gameObject)===this.gameObject}get canvas(){const e=this.Root;return e!=null&&e.isCanvas?e:null}get Canvas(){return this.canvas}markDirty(){Fc.markUIDirty(this.context)}get shadowComponent(){return this._shadowComponent}set shadowComponent(e){this._shadowComponent=e}get controlsChildLayout(){return this._controlsChildLayout}set controlsChildLayout(e){this._controlsChildLayout=e,this.shadowComponent&&(this.shadowComponent.autoLayout=e)}get Root(){return this._root===void 0&&(this._root=$.getComponentInParent(this.gameObject,iS)),this._root}__internalNewInstanceCreated(e){return super.__internalNewInstanceCreated(e),this.shadowComponent=null,this._root=void 0,this._parentComponent=void 0,this}onEnable(){super.onEnable()}addShadowComponent(e,i){var s;if(!e)return;this.removeShadowComponent();const r=this.isRoot()?this.gameObject:this.gameObject.parent;if(this._parentComponent=$.getComponentInParent(r,th),!this._parentComponent){console.warn(`Component "${this.name}" doesn't have a UI parent anywhere. Do you have an UI element outside a Canvas? UI components must be a child of a Canvas component`,this);return}e.name=this.name+" ("+(this.constructor.name??"UI")+")",e.autoLayout=this._parentComponent.controlsChildLayout,e[zc]=this,this.setShadowComponentOwner(e);let o=!1;if(((s=this.Root)==null?void 0:s.gameObject)===this.gameObject)this.gameObject.add(e);else{const a=this._parentComponent.shadowComponent;a&&(a?.add(e),o=!0)}this.shadowComponent=e,i&&i.shadowComponent&&this.shadowComponent&&i.shadowComponent.add(this.shadowComponent),_C&&e.add(new Ya(.5)),this.onAfterAddedToScene(),o&&x8(),gNe&&console.warn("Added shadow component",this.shadowComponent)}setShadowComponentOwner(e){if(e&&(e[zc]===void 0||e[zc]===this)&&(e[zc]=this,e.children))for(const i of e.children)this.setShadowComponentOwner(i)}traverseOwnedShadowComponents(e,i,s){if(e&&e[zc]===i){s(e);for(const r of e.children)this.traverseOwnedShadowComponents(r,i,s)}}removeShadowComponent(){this.shadowComponent&&this.shadowComponent.removeFromParent()}onAfterAddedToScene(){}setInteractable(e){this.shadowComponent&&(this.shadowComponent.interactable=e)}}class iS extends th{awake(){super.awake()}}class Cx{constructor(e,i){m(this,"event"),m(this,"button"),m(this,"buttonName"),m(this,"_used",!1),m(this,"_propagationStopped",!1),m(this,"z__pointer_ctured",!1),m(this,"z__pointer_cture_rleased",!1),m(this,"inputSource"),m(this,"object"),m(this,"point"),m(this,"normal"),m(this,"face"),m(this,"distance"),m(this,"instanceId"),m(this,"intersection"),m(this,"isDown"),m(this,"isUp"),m(this,"isPressed"),m(this,"isClick"),m(this,"isDoubleClick"),m(this,"input"),this.event=i,this.input=e,this.button=i.button}get deviceIndex(){return this.event.deviceIndex}get pointerId(){return this.event.pointerId}get pressure(){return this.event.pressure}get used(){return this._used}use(){this._used||(this._used=!0,this.event.use())}get propagationStopped(){return this._propagationStopped}stopPropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}stopImmediatePropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}setPointerCapture(){this.z__pointer_ctured=!0}releasePointerCapture(){this.z__pointer_cture_rleased=!0}get mode(){return this.event.mode}clone(){const e=new Cx(this.input,this.event);return Object.assign(e,this),e}Use(){this.use()}StopPropagation(){this.event.stopImmediatePropagation()}}function fL(n,e){return $.foreachComponent(n,i=>{if(!i.enabled)return;const s=i;if(e)switch(e){case"pointerdown":if(s.onPointerDown)return!0;break;case"pointerup":if(s.onPointerUp||s.onPointerClick)return!0;break;case"pointermove":if(s.onPointerEnter||s.onPointerExit||s.onPointerMove)return!0;break}else if(s.onPointerDown||s.onPointerUp||s.onPointerEnter||s.onPointerExit||s.onPointerClick)return!0},!1)===!0}const hp=new Array;class Xd{constructor(e,i,s,r){m(this,"enabled",!0),m(this,"target"),m(this,"methodName"),m(this,"arguments"),this.target=e,this.methodName=i||null,this.arguments=s,r!=null&&(this.enabled=r)}get canClone(){return this.target instanceof Object}invoke(...e){if(this.enabled!==!1){if(typeof this.target=="function")this.arguments?(hp.length=0,e!==void 0&&e.length>0&&hp.push(...e),hp.push(...this.arguments),this.target(...this.arguments),hp.length=0):this.target(...e);else if(this.methodName!=null){const i=this.target[this.methodName];typeof i=="function"?this.arguments?(hp.length=0,e!==void 0&&e.length>0&&hp.push(...e),hp.push(...this.arguments),i.call(this.target,...hp),hp.length=0):i.call(this.target,...e):this.arguments?this.target[this.methodName]=this.arguments[0]||e[0]:this.target[this.methodName]=e[0]}}}}const fNe=n=>/^[A-Z]*$/.test(n);class AL extends Event{constructor(){super(...arguments),m(this,"args")}}class Gn{constructor(e){if(m(this,"isEventList",!0),m(this,"target"),m(this,"key"),m(this,"_isInvoking",!1),m(this,"methods",[]),m(this,"_methodsCopy",[]),this.methods=[],Array.isArray(e))for(const i of e)i instanceof Xd?this.methods.push(i):typeof i=="function"&&this.methods.push(new Xd(i));else typeof e=="function"&&this.methods.push(new Xd(e))}__internalOnInstantiate(e){var i;const s=new Array;for(let r=0;r<this.methods.length;r++){const o=this.methods[r];if(!(o.target instanceof Function)){const a=o.target;let l=a?.uuid;if(a&&(l=a.guid),l){const c=e[l];if(c){const h=(i=o.arguments)==null?void 0:i.map(d=>d instanceof Object&&d.uuid?e[d.uuid]:d!=null&&d.isComponent?e[d.guid]:d);s.push(new Xd(c.clone,o.methodName,h,o.enabled))}else Je()&&console.warn("Could not find target for event listener")}}}return new Gn(s)}setEventTarget(e,i){if(this.key=e,this.target=i,this.key!==void 0){let s="",r=!1;for(const o of this.key)r&&fNe(o)&&(s+="-"),r=!0,s+=o.toLowerCase();this.key=s}}get listenerCount(){var e;return((e=this.methods)==null?void 0:e.length)??0}get isInvoking(){return this._isInvoking}static from(...e){return new Gn(e)}invoke(...e){var i;if(this._isInvoking)return console.warn("Circular event invocation detected. Please check your event listeners for circular references.",this),!1;if(((i=this.methods)==null?void 0:i.length)<=0)return!1;this._isInvoking=!0;try{this._methodsCopy.length=0,this._methodsCopy.push(...this.methods);for(const s of this._methodsCopy)s.invoke(...e);if(typeof this.target=="object"&&typeof this.key=="string"){const s=this.target.dispatchEvent;if(typeof s=="function"){const r=new AL(this.key);r.args=e,s.call(this.target,r)}}}finally{this._isInvoking=!1,this._methodsCopy.length=0}return!0}addEventListener(e){return this.methods.push(new Xd(e)),e}removeEventListener(e){if(e)for(let i=this.methods.length-1;i>=0;i--)this.methods[i].target===e&&(this.methods[i].enabled=!1,this.methods.splice(i,1))}removeAllEventListeners(){this.methods.length=0}}class ANe extends Nc{constructor(){super([fe,pn],"ColorSerializer")}onDeserialize(e){if(e!=null)return e.a!==void 0?new pn(e.r,e.g,e.b,e.a):e.alpha!==void 0?new pn(e.r,e.g,e.b,e.alpha):new fe(e.r,e.g,e.b)}onSerialize(e){if(e!=null)return e.a!==void 0?{r:e.r,g:e.g,b:e.b,a:e.a}:{r:e.r,g:e.g,b:e.b}}}const yNe=new ANe;class bNe extends Nc{constructor(){super([Oi],"EulerSerializer")}onDeserialize(e,i){if(e!=null){if(e.order)return new Oi(e.x,e.y,e.z,e.order);if(e.x!=null)return new Oi(e.x,e.y,e.z)}}onSerialize(e,i){return{x:e.x,y:e.y,z:e.z,order:e.order}}}const vNe=new bNe;class xNe extends Nc{constructor(){super(Ae,"ObjectSerializer")}onSerialize(e,i){if(i.objectToNode!==void 0&&e.uuid){const s=i.objectToNode[e.uuid];return Qr&&console.log(s,e.name,e.uuid),{node:s}}}onDeserialize(e,i){var s,r,o;if(typeof e=="string"){if(e.endsWith(".glb")||e.endsWith(".gltf")){if(i.serializable instanceof Array&&i.serializable.includes(Mi))return;Je()&&An("Detected wrong usage of @serializable with Object3D or GameObject. Instead you should use AssetReference here! Please see the console for details.");const a=(r=(s=i.target)==null?void 0:s.constructor)==null?void 0:r.name;console.warn(`Wrong usage of @serializable detected in your script "${a}"

It looks like you used @serializable(Object3D) or @serializable(GameObject) for a prefab or scene reference which is exported to a separate glTF file.

To fix this please change your code to:

@serializable(AssetReference)
${i.path}! : AssetReference;
\0`)}return}if(e){if(e.node!==void 0&&i.nodeToObject){const a=i.nodeToObject[e.node];return Qr&&console.log("Deserialized object reference?",e,a,i?.nodeToObject),a||console.warn("Did not find node: "+e.node,i.nodeToObject,i.object),a}else if(e.guid){if(!i.context){console.error("Missing context");return}let a;const l=(o=i.gltf)==null?void 0:o.scene;return l&&(a=$.findByGuid(e.guid,l)),a||(a=$.findByGuid(e.guid,i.context.scene)),a?(a&&a.isComponent===!0&&(Qr&&console.warn("Deserialized object reference is a component"),a=a.gameObject),Qr&&console.log("Deserialized object reference?",e,a,i?.nodeToObject)):((Je()||Qr)&&console.warn("Could not resolve object reference",i.path,e,i.target,i.context.scene),e.could_not_resolve=!0),a}}}}const nse=new xNe;class wNe extends Nc{constructor(){super([Oe,Oe],"ComponentSerializer")}onSerialize(e,i){if(e!=null&&e.guid)return{guid:e.guid}}onDeserialize(e,i){var s;if(e!=null&&e.guid){if(e.___persistentAsset){Qr&&console.log("Skipping component deserialization because it's a persistent asset",e);return}const r=i.path;Qr&&console.log(e.guid,i.root,i.object,i.target);let o=this.findObjectForGuid(e.guid,i.root);if(o||i.context&&(o=this.findObjectForGuid(e.guid,(s=i.context)==null?void 0:s.scene),o))return o;(Je()||Qr)&&console.warn('Could not resolve component reference: "'+r+'" using guid '+e.guid,i.target),e.could_not_resolve=!0;return}}findObjectForGuid(e,i){if(i.guid===e)return i;const s=$.foreachComponent(i,r=>{if(r.guid===e)return r},!1);if(s!==void 0)return s;for(let r=0;r<i.children.length;r++){const o=i.children[r],a=this.findObjectForGuid(e,o);if(a)return a}}}const yL=new wNe;class CNe extends Nc{constructor(){super([Gn])}onSerialize(e,i){console.log("TODO: SERIALIZE EVENT")}onDeserialize(e,i){var s,r,o;if(typeof e=="function")return new Gn([new Xd(e,null,[],!0)]);if(e&&e.type==="EventList"){Qr&&console.log("DESERIALIZE EVENT",e);const a=new Array;if(e.calls&&Array.isArray(e.calls))for(const h of e.calls){let d=function(g){if(typeof g=="object"){let f=nse.onDeserialize(g,i);if(f||(f=yL.onDeserialize(g,i)),f)return f}return g};Qr&&console.log(h);let u=yL.findObjectForGuid(h.target,i.root);!u&&(s=i.context)!=null&&s.scene&&(u=yL.findObjectForGuid(h.target,(r=i.context)==null?void 0:r.scene));const p=((o=h.method)==null?void 0:o.length)>0;if(u&&p){const g=()=>{const f=h.method[0].toUpperCase()+h.method.slice(1);if(typeof u[f]=="function"){console.warn(`EventList method:
Could not find method ${h.method} on object ${u.name}. Please rename ${h.method} to ${f}?
`,u[f],`
 in script: `,u),An("EventList methods must start with lowercase letter, see console for details");return}else console.warn(`EventList method:
Could not find method ${h.method} on object ${u.name}`,u,typeof u[h.method])};if(typeof u[h.method]!="function"){let f=!1,A=u;for(;A;){const y=Object.getOwnPropertyDescriptor(A,h.method);if(y&&(y.writable===!0||y.set)){f=!0;break}A=Object.getPrototypeOf(A)}!f&&(Je()||Qr)&&g()}}if(u){let g=h.argument;if(g!==void 0?g=d(g):h.arguments!==void 0&&(g=h.arguments.map(d)),!u[h.method])console.warn(`EventList method not found: "${h.method}" on ${u?.name}`);else{g!==void 0&&!Array.isArray(g)&&(g=[g]);const f=new Xd(u,h.method,g,h.enabled);a.push(f)}}else Je()&&console.warn("[Debug] EventList: Could not find event listener in scene",h,i.object,e)}const l=new Gn(a);Qr&&console.log(l);const c=i.target;return c!==void 0&&i.path!==void 0&&l.setEventTarget(i.path,c),l}}}const SNe=new CNe,bL=new WeakMap,_Ne=di.prototype.clone;di.prototype.clone=function(){const n=_Ne.call(this);return bL.has(n)||bL.set(n,this),n};class sse extends Nc{constructor(){super([cv,fi])}onSerialize(e,i){}onDeserialize(e,i){if(e instanceof di&&i.type===cv){let s=e;bL.has(s)&&(s=bL.get(s)),s.isRenderTargetTexture=!0,s.flipY=!0,s.offset.y=1,s.repeat.y=-1,s.needsUpdate=!0,s.mipmaps=[],s instanceof od&&(s.isCompressedTexture=!1,s.format=_i);const r=new cv(s.image.width,s.image.height,{colorSpace:qi});return r.texture=s,r}}}new sse;class rse extends Nc{constructor(){super([URL])}onSerialize(e,i){return null}onDeserialize(e,i){if(typeof e=="string"&&e.length>0)return Sm(i.gltfId,e)}}new rse;var MNe=Object.defineProperty,INe=Object.getOwnPropertyDescriptor,TNe=(n,e,i,s)=>{for(var r=s>1?void 0:s?INe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&MNe(e,i,r),r};class nS extends Oe{awake(){Fc.createIfNoneExists(this.context)}onEnable(){var e;(e=Fc.get(this.context))==null||e.register(this)}onDisable(){var e;(e=Fc.get(this.context))==null||e.unregister(this)}}class Ql extends nS{constructor(){super(...arguments),m(this,"targets",null),m(this,"raycastHits",[]),m(this,"ignoreSkinnedMeshes",!1)}start(){this.targets=[this.gameObject]}performRaycast(e=null){if(!this.targets)return null;e??(e=new Rd),e.targets=this.targets,e.results=this.raycastHits,e.useAcceleratedRaycast=!0;const i=e.testObject;this.ignoreSkinnedMeshes&&(e.testObject=r=>r instanceof Ka?"continue in children":i?i(r):!0);const s=this.context.physics.raycast(e);return e.testObject=i,s}}TNe([T()],Ql.prototype,"ignoreSkinnedMeshes",2);class vL extends Ql{constructor(){super(),this.ignoreSkinnedMeshes=!0}}const ose=class extends nS{performRaycast(n){if(!Qt.active||!ose.allow||!(n!=null&&n.ray))return null;const e=n.ray.origin,i=.015;return this.context.physics.sphereOverlap(e,i,!1,!0)}};let dv=ose;m(dv,"allow",!0);class xL{static getObject(e){const i=e[zc];return i&&(i.isComponent===!0?e=i.gameObject:e=i),e}static isInteractable(e,i){if(i&&(i.canvasGroup=void 0,i.graphic=void 0),e==null||!e.visible||(e=this.getObject(e),!e.visible))return!1;const s=this.tryFindCanvasGroup(e);if(s?.isCanvasGroup===!0&&(i&&(i.canvasGroup=s),s.blocksRaycasts===!1||s.interactable===!1))return!1;const r=P0(e,o=>{if(o.isGraphic===!0)return o},!1);return i&&r?.isGraphic===!0&&(i.graphic=r),!(r?.raycastTarget===!1||r?.layer===2)}static tryFindCanvasGroup(e){if(!e)return null;const i=P0(e,s=>{const r=s;if(r.blocksRaycasts!==void 0&&r.interactable!==void 0)return r},!1);return i!==void 0?i:this.tryFindCanvasGroup(e.parent)}}function dU(n){return n[zc]||(n.parent?dU(n.parent):null)}function ENe(n){return n.isUI===!0||typeof n[zc]=="object"}function wL(n,e){if(!n)return;const i=n.material;if(i?.isMaterial===!0){const s=n.parent;s&&s.isText,i.side=e.doubleSided??!0?Qi:ms,i.shadowSide=e.doubleSided?Qi:ms,n.castShadow=e.castShadows?e.castShadows:!1,n.receiveShadow=e.receiveShadows?e.receiveShadows:!1}for(const s of n.children)wL(s,e)}function uv(n,e,i){n[e]===void 0&&console.warn("Field",e,"is undefined on",n);const s=Proxy.revocable(n[e],{set(a,l,c,h){const d=a[l],u=Reflect.set(a,l,c,h);return i(c,d),u}}),r=s.revoke,o=n[e];return s.revoke=()=>{n[e]=o,r()},n[e]=s.proxy,s}const ase=Symbol("Scheduled action");function RNe(n,e,i=_n.OnBeforeRender){let s=n[ase];s||(s=n[ase]={});const r=e.name;s[i]||(s[i]={});const o=s[i];if(o[r])return;function*a(){e?.call(n),o[r]=null}const l=n.startCoroutine(a(),i);o[r]=l}const dp=q("debugeventsystem");var uU=(n=>(n.BeforeHandleInput="BeforeHandleInput",n.AfterHandleInput="AfterHandleInput",n))(uU||{});const up=class extends Oe{constructor(){super(),m(this,"raycaster",[]),m(this,"pressedByID",new Map),m(this,"hoveredByID",new Map),m(this,"onPointerEvent",n=>{if(n===void 0||n.propagationStopped||n.defaultPrevented||n.used)return;const e=new Cx(this.context.input,n);this._currentPointerEventName=n.type,e.inputSource=this.context.input,e.isClick=n.isClick,e.isDoubleClick=n.isDoubleClick,e.isDown=n.type==rs.PointerDown,e.isUp=n.type==rs.PointerUp,e.isPressed=this.context.input.getPointerPressed(n.pointerId),dp&&(e.isDown?console.log("DOWN",e.pointerId):e.isUp&&console.log("UP",e.pointerId),e.isClick&&console.log("CLICK",e.pointerId));const i=new Rd;n.hasRay?i.ray=n.ray:i.screenPoint=this.context.input.getPointerPositionRC(n.pointerId);const s=this.performRaycast(i);if(s){for(const o of s)o.event=n,n.intersections.push(o);n.origin.onPointerHits&&n.origin.onPointerHits({sender:this,event:n,hits:s})}dp&&e.isClick&&ss("EventSystem: "+e.pointerId+" - "+this.context.time.frame+" - Up:"+e.isUp+", Down:"+e.isDown);const r={sender:this,args:e,hasActiveUI:this.currentActiveMeshUIComponents.length>0};this.dispatchEvent(new CustomEvent("BeforeHandleInput",{detail:r})),this.handleIntersections(s,e),this.dispatchEvent(new CustomEvent("AfterHandleInput",{detail:r}))}),m(this,"_sortedHits",[]),m(this,"_testObjectsCache",new Map),m(this,"_currentlyActiveRaycaster",null),m(this,"_currentPointerEventName",null),m(this,"shouldRaycastObject",n=>{var e;let i=null;if(ENe(n)&&(i=(e=n[zc])==null?void 0:e.gameObject),this._testObjectsCache.has(n)||i&&this._testObjectsCache.has(i))return this._testObjectsCache.get(n)===!1?"continue in children":!0;{let s=fL(n,this._currentPointerEventName);if(!s&&i&&(s=fL(i,this._currentPointerEventName)),s){this._testObjectsCache.set(n,!0);for(const r of n.children)this.shouldRaycastObject_AddToYesCache(r);return!0}return this._testObjectsCache.set(n,!1),"continue in children"}}),m(this,"_sortingBuffer",[]),m(this,"_noDepthTestingResults",[]),m(this,"out",{}),m(this,"_capturedPointer",{}),m(this,"pointerEnterSymbol",Symbol("pointerEnter")),m(this,"pointerExitSymbol",Symbol("pointerExit")),m(this,"currentActiveMeshUIComponents",[]),up.systems.push(this)}static createIfNoneExists(n){this.didSearchEventSystem||(this.didSearchEventSystem=!0,up.systems.length<=0&&up.systems.push(...$.findObjectsOfType(up,n)));for(const i of up.systems)if(i.context===n)return;const e=new Ae;$.addComponent(e,up),n.scene.add(e)}static get systems(){const n=$t.Current;return this._eventSystemMap.has(n)||this._eventSystemMap.set(n,[]),this._eventSystemMap.get(n)}static get(n){const e=this._eventSystemMap.get(n);return e&&e.length>0?e[0]:null}static get instance(){return this.systems[0]}static ensureUpdateMeshUI(n,e,i=!1){dg.update(n,e,i)}static markUIDirty(n){dg.markDirty()}get hasActiveUI(){return this.currentActiveMeshUIComponents.length>0}get isHoveringObjects(){return this.hoveredByID.size>0}onDestroy(){up.systems.splice(up.systems.indexOf(this),1)}start(){if(this.raycaster.length<=0&&!$.findObjectOfType(nS,this.context)){const n=$.addComponent(this.context.scene,Ql);this.raycaster.push(n),(Je()||dp)&&console.warn("Added an ObjectRaycaster to the scene because no raycaster was found.")}}register(n){var e;n&&this.raycaster&&!this.raycaster.includes(n)&&((e=this.raycaster)==null||e.push(n))}unregister(n){var e,i;const s=(e=this.raycaster)==null?void 0:e.indexOf(n);s!==void 0&&s!==-1&&((i=this.raycaster)==null||i.splice(s,1))}onEnable(){this.context.input.addEventListener(rs.PointerDown,this.onPointerEvent),this.context.input.addEventListener(rs.PointerUp,this.onPointerEvent),this.context.input.addEventListener(rs.PointerMove,this.onPointerEvent)}onDisable(){this.context.input.removeEventListener(rs.PointerDown,this.onPointerEvent),this.context.input.removeEventListener(rs.PointerUp,this.onPointerEvent),this.context.input.removeEventListener(rs.PointerMove,this.onPointerEvent)}onBeforeRender(){this.resetMeshUIStates()}shouldRaycastObject_AddToYesCache(n){this._testObjectsCache.set(n,!0);for(const e of n.children)this.shouldRaycastObject_AddToYesCache(e)}performRaycast(n){if(!this.raycaster)return null;this._testObjectsCache.clear(),this._sortedHits.length=0,n||(n=new Rd),n.testObject=this.shouldRaycastObject;for(const e of this.raycaster){if(!e.activeAndEnabled)continue;this._currentlyActiveRaycaster=e;const i=e.performRaycast(n);this._currentlyActiveRaycaster=null,i&&i.length>0&&this._sortedHits.push(...i)}return this._sortedHits.sort((e,i)=>e.distance-i.distance),this._sortedHits}assignHitInformation(n,e){e?(n.intersection=e,n.point=e.point,n.normal=e.normal,n.face=e.face,n.distance=e.distance,n.instanceId=e.instanceId):(n.intersection=void 0,n.point=void 0,n.normal=void 0,n.face=void 0,n.distance=void 0,n.instanceId=void 0)}handleIntersections(n,e){var i;if(n!=null&&n.length){n=this.sortCandidates(n);for(const r of n){if(e.event.immediatePropagationStopped)return!1;if(this.assignHitInformation(e,r),this.handleEventOnObject(r.object,e))return!0}}this.assignHitInformation(e,n?.[0]),this.invokePointerCapture(e);const s=this.hoveredByID.get(e.pointerId);return s&&this.propagatePointerExit(s.obj,s.data,null),this.hoveredByID.delete(e.pointerId),e.isUp&&((i=this.pressedByID.get(e.pointerId))==null||i.handlers.forEach(r=>this.invokeOnPointerUp(e,r)),this.pressedByID.delete(e.pointerId)),!1}sortCandidates(n){this._sortingBuffer.length=0,this._noDepthTestingResults.length=0;for(let e=0;e<n.length;e++){const i=n[e],s=i.object;if(s.material&&s.material.depthTest===!1){this._noDepthTestingResults.push(i);continue}this._sortingBuffer.push(i)}for(const e of this._sortingBuffer)this._noDepthTestingResults.push(e);return this._noDepthTestingResults}handleEventOnObject(n,e){if(!this.testIsVisible(n))return e.isClick&&dp&&console.log("not allowed",n),!1;if(e.pointerId===void 0)return dp&&console.error("Event without pointer can't be handled",e),!1;e.object=n;const i=n.parent,s=e.isClick??!1;let r=null;if(i&&i.isUI){const c=(e.isPressed||e.isClick)??!1;if(i[zc]){const h=i[zc].gameObject;if(h){if(!xL.isInteractable(h,this.out))return!1;r=this.out.canvasGroup??null,this.handleMeshUIIntersection(n,c),n=h}}}s&&dp&&console.log(this.context.time.frame,n);const o=this.hoveredByID.get(e.pointerId),a=o?.obj;a!==n&&a&&this.propagatePointerExit(a,o.data,n);const l=this.hoveredByID.get(e.pointerId);if(l?(l.obj=n,l.data=e):this.hoveredByID.set(e.pointerId,{obj:n,data:e}),e.isDown){const c=this.pressedByID.get(e.pointerId);c?(c.obj=n,c.data=e):this.pressedByID.set(e.pointerId,{obj:n,data:e,handlers:new Set})}return(r===null||r.interactable)&&this.handleMainInteraction(n,e,a??null),!0}propagate(n,e){for(;n;)$.foreachComponent(n,i=>{e(i)},!1),n=n.parent}handleMainInteraction(n,e,i){const s=this.pressedByID.get(e.pointerId),r=i!==n;let o=!0;switch(e.event.pointerType){case"mouse":case"touch":const a=this.context.input.getPointerPositionLastFrame(e.pointerId),l=this.context.input.getPointerPosition(e.pointerId);o=a&&!lt.approximately(a,l);break}this.propagate(n,a=>{var l;const c=a;c.interactable!==!1&&(!c.activeAndEnabled||!c.enabled||(c.onPointerEnter&&r&&this.handlePointerEnter(c,e),e.isDown&&c.onPointerDown&&(c.onPointerDown(e),s?.handlers.add(c),this.handlePointerCapture(e,c)),c.onPointerMove&&(o&&c.onPointerMove(e),this.handlePointerCapture(e,c)),e.isUp&&(c.onPointerUp&&(this.invokeOnPointerUp(e,c),s?.handlers.delete(c)),c.onPointerExit&&((l=e.event)==null?void 0:l.pointerType)===ZR.Touch&&(this.handlePointerExit(c,e),this.hoveredByID.delete(e.pointerId))),e.isClick&&c.onPointerClick&&c.onPointerClick(e)))}),e.isUp&&(s?.handlers.forEach(a=>{this.invokeOnPointerUp(e,a)}),this.pressedByID.delete(e.pointerId))}propagatePointerExit(n,e,i){this.propagate(n,s=>{if(!s.gameObject||s.destroyed)return;const r=s;if(r.onPointerExit||r.onPointerEnter){if(i&&this.isChild(i,s.gameObject))return;this.handlePointerExit(r,e)}})}invokeOnPointerUp(n,e){var i;(i=e.onPointerUp)==null||i.call(e,n),this.releasePointerCapture(n,e)}handlePointerEnter(n,e){n.onPointerEnter&&this.updatePointerState(n,e.pointerId,this.pointerEnterSymbol,!0)&&n.onPointerEnter(e),this.updatePointerState(n,e.pointerId,this.pointerExitSymbol,!1)}handlePointerExit(n,e){n.onPointerExit&&this.updatePointerState(n,e.pointerId,this.pointerExitSymbol,!0)&&n.onPointerExit(e),this.updatePointerState(n,e.pointerId,this.pointerEnterSymbol,!1)}updatePointerState(n,e,i,s){let r=n[i];if(s)return r&&r.includes(e)?!1:(r=r||[],r.push(e),n[i]=r,!0);{if(!r||!r.includes(e))return!1;const o=r.indexOf(e);return o!==-1&&r.splice(o,1),!0}}handlePointerCapture(n,e){if(n.z__pointer_ctured){n.z__pointer_ctured=!1;const i=n.pointerId;if(e.onPointerMove){const s=this._capturedPointer[i]||[];s.push(e),this._capturedPointer[i]=s}else Je()&&!e.z__warned_no_pointermove&&(e.z__warned_no_pointermove=!0,console.warn("PointerCapture was requested but the component doesn't implement onPointerMove. It will not receive any pointer events"))}else n.z__pointer_cture_rleased&&(n.z__pointer_cture_rleased=!1,this.releasePointerCapture(n,e))}releasePointerCapture(n,e){const i=n.pointerId;if(this._capturedPointer[i]){const s=this._capturedPointer[i].indexOf(e);s!==-1&&(this._capturedPointer[i].splice(s,1),dp&&console.log("released pointer capture",i,e,this._capturedPointer))}}invokePointerCapture(n){var e;if(n.event.type===rs.PointerMove){const i=n.pointerId,s=this._capturedPointer[i];if(s){dp&&console.log("Captured",i,s);for(let r=0;r<s.length;r++){const o=s[r];if(o.destroyed){s.splice(r,1),r--;continue}(e=o.onPointerMove)==null||e.call(o,n)}}}}isChild(n,e){return!n||!e?!1:n===e?!0:n.parent?this.isChild(n.parent,e):!1}handleMeshUiObjectWithoutShadowDom(n,e){return!n||!n.isUI?!0:this.handleMeshUIIntersection(n,e)}handleMeshUIIntersection(n,e){const i=dg.updateState(n,e);return i&&this.currentActiveMeshUIComponents.push(i),i!==null}resetMeshUIStates(){if(this.context.input.getPointerPressedCount()>0&&dg.resetLastSelected(),!(!this.currentActiveMeshUIComponents||this.currentActiveMeshUIComponents.length<=0)){for(let n=0;n<this.currentActiveMeshUIComponents.length;n++){const e=this.currentActiveMeshUIComponents[n];dg.resetState(e)}this.currentActiveMeshUIComponents.length=0}}testIsVisible(n){return n?$.isActiveSelf(n)?this.testIsVisible(n.parent):!1:!0}};let Fc=up;m(Fc,"_eventSystemMap",new Map),m(Fc,"didSearchEventSystem",!1);class dg{static markDirty(){this.needsUpdate=!0}static update(e,i,s=!1){if(s){e.update();return}const r=i.time.frameCount;for(const o of this.lastUpdateFrame)if(o.context===i){if(r===o.frame)return;o.frame=r;let a=this.needsUpdate||r<1;o.nextUpdate<=r&&(a=!0),a&&(dp&&console.log("Update threemeshui"),this.needsUpdate=!1,o.nextUpdate=r+60,e.update());return}this.lastUpdateFrame=[{context:i,frame:r,nextUpdate:r+60}],e.update(),this.needsUpdate=!1}static updateState(e,i){let s=null;if(e&&(s=this.findBlockInParent(e),s&&s!==this.lastSelected)){if(s.interactable===!1)return null;this.needsUpdate=!0}return s}static resetLastSelected(){const e=this.lastSelected;e&&(this.lastSelected=null,this.resetState(e))}static resetState(e){e&&(this.needsUpdate=!0)}static findBlockInParent(e){return e?e.isBlock?e:this.findBlockInParent(e.parent):null}}m(dg,"lastSelected",null),m(dg,"lastUpdateFrame",[]),m(dg,"needsUpdate",!1);var LNe=Object.defineProperty,BNe=Object.getOwnPropertyDescriptor,ls=(n,e,i,s)=>{for(var r=s>1?void 0:s?BNe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&LNe(e,i,r),r};const CL=q("debugorbit"),pU=q("freecam"),SL=q("debugcamerafit"),_L=q("smoothcam"),kNe={LEFT:"",UP:"",RIGHT:"",BOTTOM:""};let mU;class sS extends CustomEvent{constructor(e,i){super("target-reached",{detail:{controls:e,type:i}})}}class ln extends Oe{constructor(){super(...arguments),m(this,"autoTarget",!0),m(this,"autoFit",!1),m(this,"enableRotate",!0),m(this,"autoRotate",!1),m(this,"autoRotateSpeed",1),m(this,"minAzimuthAngle",1/0),m(this,"maxAzimuthAngle",1/0),m(this,"minPolarAngle",0),m(this,"maxPolarAngle",Math.PI),m(this,"enableKeys",!1),m(this,"enableDamping",!0),m(this,"dampingFactor",.1),m(this,"enableZoom",!0),m(this,"minZoom",0),m(this,"maxZoom",1/0),m(this,"zoomSpeed",1),m(this,"zoomToCursor",!1),m(this,"enablePan",!0),m(this,"lookAtConstraint",null),m(this,"lookAtConstraint01",1),m(this,"allowInterrupt",!0),m(this,"middleClickToFocus",!0),m(this,"doubleClickToFocus",!0),m(this,"clickBackgroundToFitScene",2),m(this,"debugLog",!1),m(this,"targetLerpDuration",1),m(this,"_controls",null),m(this,"_cameraObject",null),m(this,"_lookTargetLerpActive",!1),m(this,"_lookTargetStartPosition",new E),m(this,"_lookTargetEndPosition",new E),m(this,"_lookTargetLerp01",0),m(this,"_lookTargetLerpDuration",0),m(this,"_cameraLerpActive",!1),m(this,"_cameraStartPosition",new E),m(this,"_cameraEndPosition",new E),m(this,"_cameraLerp01",0),m(this,"_cameraLerpDuration",0),m(this,"_fovLerpActive",!1),m(this,"_fovLerpStartValue",0),m(this,"_fovLerpEndValue",0),m(this,"_fovLerp01",0),m(this,"_fovLerpDuration",0),m(this,"_inputs",0),m(this,"_enableTime",0),m(this,"_startedListeningToKeyEvents",!1),m(this,"_eventSystem"),m(this,"_afterHandleInputFn"),m(this,"_camera",null),m(this,"_syncedTransform"),m(this,"_didSetTarget",0),m(this,"targetElement",null),m(this,"_activePointerEvents"),m(this,"_lastTimeClickOnBackground",-1),m(this,"_clickOnBackgroundCount",0),m(this,"_onPointerDown",e=>{this._activePointerEvents.push(e)}),m(this,"_onPointerUp",e=>{for(let i=this._activePointerEvents.length-1;i>=0;i--){const s=this._activePointerEvents[i];if(s.pointerId===e.pointerId&&s.button===e.button){this._activePointerEvents.splice(i,1);break}}if(this.clickBackgroundToFitScene>0&&e.isClick&&e.button===0){if(e.hasRay||e.intersections.push(...this.context.physics.raycast()),e.intersections.length<=0){const i=this.context.time.time-this._lastTimeClickOnBackground;this._lastTimeClickOnBackground=this.context.time.time,this.clickBackgroundToFitScene<=1||i<this.clickBackgroundToFitScene*.15?(this._clickOnBackgroundCount+=1,this._clickOnBackgroundCount>=this.clickBackgroundToFitScene-1&&this.fitCamera(this.context.scene.children,{immediate:!1})):this._clickOnBackgroundCount=0}CL&&console.log(this.clickBackgroundToFitScene,e.intersections.length,this._clickOnBackgroundCount)}}),m(this,"_onPointerUpLate",e=>{this.doubleClickToFocus&&e.isDoubleClick&&!e.used&&this.setTargetFromRaycast()}),m(this,"onControlsChangeStarted",()=>{this._syncedTransform&&this._syncedTransform.requestOwnership()}),m(this,"_shouldDisable",!1),m(this,"__onPreRender",()=>{const e=this.context.pre_render_callbacks.indexOf(this.__onPreRender);e>=0&&this.context.pre_render_callbacks.splice(e,1),this.autoFit&&(this.autoFit=!1,this.fitCamera({centerCamera:"y",immediate:!0,objects:this.scene.children}))}),m(this,"_haveAttachedKeyboardEvents",!1)}get isCameraController(){return!0}get controls(){return this._controls}get controllerObject(){return this._cameraObject}onStartInteraction(e){var i;(i=this.controls)==null||i.addEventListener("start",e)}get targetLerpSpeed(){return 5}set targetLerpSpeed(e){this.targetLerpDuration=1/e}awake(){CL&&console.debug("OrbitControls",this),this._didSetTarget=0,this._startedListeningToKeyEvents=!1}start(){this._eventSystem=Fc.get(this.context)??void 0,this._eventSystem&&(this._afterHandleInputFn=this.afterHandleInput.bind(this),this._eventSystem.addEventListener(uU.AfterHandleInput,this._afterHandleInputFn))}onDestroy(){var e,i;(e=this._controls)==null||e.dispose(),(i=this._eventSystem)==null||i.removeEventListener(uU.AfterHandleInput,this._afterHandleInputFn)}onEnable(){this._didSetTarget=0,this._enableTime=this.context.time.time;const e=$.getComponent(this.gameObject,In);this._camera=e;let i=e?.threeCamera;if(!i&&this.gameObject instanceof Ot&&(i=this.gameObject),i&&tD(i,this,!0),!this._controls&&i instanceof Ot){this._cameraObject=i;const s=this.targetElement??this.context.renderer.domElement,r=i?.quaternion.clone();this._controls=new $ne(i,s),i?.quaternion.copy(r),mU===void 0&&(mU={...this._controls.keys})}if(this._controls)if(pU&&(this.enablePan=!0,this.enableZoom=!0,this.middleClickToFocus=!0,Ft.isMobileDevice()&&(this.doubleClickToFocus=!0)),this._controls.addEventListener("start",this.onControlsChangeStarted),!this._startedListeningToKeyEvents&&this.enableKeys)this._startedListeningToKeyEvents=!0,this._controls.listenToKeyEvents(this.context.domElement);else try{this._controls.stopListenToKeyEvents()}catch{}this._syncedTransform=$.getComponent(this.gameObject,Vd)??void 0,this.context.pre_render_callbacks.push(this.__onPreRender),this._activePointerEvents=[],this.context.input.addEventListener("pointerdown",this._onPointerDown,{queue:Dl.Early}),this.context.input.addEventListener("pointerup",this._onPointerUp,{queue:Dl.Early}),this.context.input.addEventListener("pointerup",this._onPointerUpLate,{queue:Dl.Late})}onDisable(){var e;if((e=this._camera)!=null&&e.threeCamera&&tD(this._camera.threeCamera,this,!1),this._controls){this._controls.enabled=!1,this._controls.autoRotate=!1,this._controls.removeEventListener("start",this.onControlsChangeStarted);try{this._controls.stopListenToKeyEvents()}catch{}this._startedListeningToKeyEvents=!1}this._activePointerEvents.length=0,this.context.input.removeEventListener("pointerdown",this._onPointerDown),this.context.input.removeEventListener("pointerup",this._onPointerUp),this.context.input.removeEventListener("pointerup",this._onPointerUpLate)}afterHandleInput(e){e.detail.args.pointerId===0&&(e.detail.args.isDown?this._controls&&this._eventSystem&&(this._shouldDisable=this._eventSystem.hasActiveUI):(!e.detail.args.isPressed||e.detail.args.isUp)&&(this._shouldDisable=!1))}onBeforeRender(){var e,i,s,r;if(!!this._controls){if(this._cameraObject!==this.context.mainCamera){this._controls.enabled=!1;return}if(this._controls.enabled=!0,(this.context.input.getPointerDown(1)||this.context.input.getPointerDown(2)||this.context.input.mouseWheelChanged||this.context.input.getPointerPressed(0)&&(e=this.context.input.getPointerPositionDelta(0))!=null&&e.length()||0>.1)&&(this._inputs+=1),this._inputs>0&&this.allowInterrupt&&(this.enableRotate&&(this.autoRotate=!1),this._cameraLerpActive=!1,this._lookTargetLerpActive=!1),this._inputs=0,this.autoTarget&&this._didSetTarget++===0){const o=$.getComponent(this.gameObject,In);if(o&&!this.setLookTargetFromConstraint()){this.debugLog&&console.log("NO TARGET");const a=ri(o.threeCamera),l=Math.max(.01,a.length()),c=new E(0,0,-l).applyMatrix4(o.threeCamera.matrixWorld);this.setLookTargetPosition(c,!0)}if(!this.setLookTargetFromConstraint()){const a=new Rd;a.screenPoint=new Q(0,0),a.lineThreshold=.1;const l=this.context.physics.raycast(a);l.length>0&&this.setLookTargetPosition(l[0].point,!0),SL&&console.log("OrbitControls hits",...l)}}if(this.middleClickToFocus&&this.context.input.getPointerClicked(1)&&this.setTargetFromRaycast(),this._lookTargetLerpActive||this._cameraLerpActive||this._fovLerpActive){if(this._cameraLerpActive&&this._cameraObject)if(this._cameraLerp01+=this.context.time.deltaTime/this._cameraLerpDuration,this._cameraLerp01>=1)this._cameraObject.position.copy(this._cameraEndPosition),this._cameraLerpActive=!1,this.dispatchEvent(new sS(this,"camera"));else{const o=lt.easeInOutCubic(this._cameraLerp01);this._cameraObject.position.lerpVectors(this._cameraStartPosition,this._cameraEndPosition,o)}if(this._lookTargetLerpActive)if(this._lookTargetLerp01+=this.context.time.deltaTime/this._lookTargetLerpDuration,this._lookTargetLerp01>=1)this._controls.target.copy(this._lookTargetEndPosition),this._lookTargetLerpActive=!1,this.dispatchEvent(new sS(this,"lookat"));else{const o=lt.easeInOutCubic(this._lookTargetLerp01);this._controls.target.lerpVectors(this._lookTargetStartPosition,this._lookTargetEndPosition,o)}if(this._fovLerpActive&&this._cameraObject){const o=this._cameraObject;if(this._fovLerp01+=this.context.time.deltaTime/this._fovLerpDuration,this._fovLerp01>=1)o.fov=this._fovLerpEndValue,this._fovLerpActive=!1;else{const a=lt.easeInOutCubic(this._fovLerp01);o.fov=lt.lerp(this._fovLerpStartValue,this._fovLerpEndValue,a)}o.updateProjectionMatrix()}}if(this._controls){if(this.debugLog&&(this._controls.domElement=this.context.renderer.domElement),this._controls.enabled=!this._shouldDisable&&this._camera===this.context.mainCameraComponent&&!this.context.isInXR&&!this._activePointerEvents.some(o=>o.used),this._controls.keys=this.enableKeys?mU:kNe,this._controls.autoRotate=this.autoRotate,this._controls.autoRotateSpeed=this.autoRotateSpeed,this._controls.enableZoom=this.enableZoom,this._controls.zoomSpeed=this.zoomSpeed,this._controls.zoomToCursor=this.zoomToCursor,this._controls.enableDamping=this.enableDamping,this._controls.dampingFactor=this.dampingFactor,this._controls.enablePan=this.enablePan,this._controls.enableRotate=this.enableRotate,this._controls.minAzimuthAngle=this.minAzimuthAngle,this._controls.maxAzimuthAngle=this.maxAzimuthAngle,this._controls.minPolarAngle=this.minPolarAngle,this._controls.maxPolarAngle=this.maxPolarAngle,pU||(((s=(i=this._camera)==null?void 0:i.threeCamera)==null?void 0:s.type)==="PerspectiveCamera"?(this._controls.minDistance=this.minZoom,this._controls.maxDistance=this.maxZoom,this._controls.minZoom=0,this._controls.maxZoom=1/0):(this._controls.minDistance=0,this._controls.maxDistance=1/0,this._controls.minZoom=this.minZoom,this._controls.maxZoom=this.maxZoom)),typeof _L=="number"||_L===!0){this._controls.enableDamping=!0;const o=typeof _L=="number"?_L:.99;this._controls.dampingFactor=Math.max(.001,1-Math.min(1,o))}this.allowInterrupt||(this._lookTargetLerpActive&&(this._controls.enablePan=!1),this._cameraLerpActive&&(this._controls.enableRotate=!1,this._controls.autoRotate=!1),(this._lookTargetLerpActive||this._cameraLerpActive)&&(this._controls.enableZoom=!1)),this.context.isInXR||(!pU&&(r=this.lookAtConstraint)!=null&&r.locked&&this.setLookTargetFromConstraint(0,this.lookAtConstraint01),this._controls.update(this.context.time.deltaTime),CL&&Nt.DrawWireSphere(this._controls.target,.1,65280))}}}setCameraAndLookTarget(e){if(!e||!(e instanceof Ae))return;const i=ri(e),s=lD(e);this.setTargetFromRaycast(new ya(i,s)),this.setCameraTargetPosition(i)}setCameraTargetPosition(e,i=!1){var s;e&&(e instanceof Ae&&(e=ri(e)),this._cameraEndPosition||(this._cameraEndPosition=new E),this._cameraEndPosition.copy(e),i===!0?(this._cameraLerpActive=!1,this._cameraObject&&this._cameraObject.position.copy(this._cameraEndPosition)):this._cameraObject&&(this._cameraLerpActive=!0,this._cameraLerp01=0,this._cameraStartPosition.copy((s=this._cameraObject)==null?void 0:s.position),typeof i=="number"?this._cameraLerpDuration=i:this._cameraLerpDuration=this.targetLerpDuration))}get cameraLerpActive(){return this._cameraLerpActive}stopCameraLerp(){this._cameraLerpActive=!1}setFieldOfView(e,i=!1){var s;if(!this._controls||typeof e!="number")return;const r=(s=this._camera)==null?void 0:s.threeCamera;r&&(i===!0?r.fov=e:(this._fovLerpActive=!0,this._fovLerp01=0,this._fovLerpStartValue=r.fov,this._fovLerpEndValue=e,typeof i=="number"?this._fovLerpDuration=i:this._fovLerpDuration=this.targetLerpDuration))}setLookTargetPosition(e=null,i=!1){this._controls&&e&&(e instanceof Ae&&(e=ri(e)),this._lookTargetEndPosition.copy(e),this._didSetTarget++,CL&&(console.warn("OrbitControls: setLookTargetPosition",e,i),Nt.DrawWireSphere(this._lookTargetEndPosition,.2,16711680,2)),i===!0?this._controls.target.copy(this._lookTargetEndPosition):(this._lookTargetLerpActive=!0,this._lookTargetLerp01=0,this._lookTargetStartPosition.copy(this._controls.target),typeof i=="number"?this._lookTargetLerpDuration=i:this._lookTargetLerpDuration=this.targetLerpDuration))}get lookTargetLerpActive(){return this._lookTargetLerpActive}stopLookTargetLerp(){this._lookTargetLerpActive=!1}setLookTargetFromConstraint(e=0,i=1){var s;if(!this._controls)return!1;const r=(s=this.lookAtConstraint)==null?void 0:s.sources;if(r&&r.length>0){const o=r[e];if(o)return o.getWorldPosition(this._lookTargetEndPosition),this.lerpLookTarget(this._lookTargetEndPosition,i),!0}return!1}lerpTarget(e,i){return this.lerpLookTarget(e,i)}lerpLookTarget(e,i){this._controls&&(i>=1?this._controls.target.copy(e):this._controls.target.lerp(e,i))}setTargetFromRaycast(e){if(!this.controls)return;const i=e?this.context.physics.raycastFromRay(e):this.context.physics.raycast();for(const s of i)if(s.distance>0&&$.isActiveInHierarchy(s.object)){const r=dU(s.object);if(r){const o=r.canvas;if(o!=null&&o.screenspace)break}this.setLookTargetPosition(s.point);break}}fitCamera(e,i){var s,r;if(this.context.isInXR)return;let o;if(Array.isArray(e)?o=e:e&&"type"in e?o=e.children:e&&"objects"in e&&(o=e?.objects,i=e),o&&!Array.isArray(o)&&(o=o.children),(!Array.isArray(o)||o&&o.length<=0)&&(o=this.context.scene.children),!Array.isArray(o)||o.length<=0){console.warn("No objects to fit camera to...");return}const a=this._cameraObject,l=this._controls;if(!a||!l){console.warn("No camera or controls found to fit camera to objects...");return}i||(i={});const{immediate:c=!1,centerCamera:h="y",cameraNearFar:d="auto",fitOffset:u=1.1,fov:p=a?.fov}=i,g=new E,f=new E,A=Ll(o,void 0,(r=(s=this._camera)==null?void 0:s.threeCamera)==null?void 0:r.layers),y=A.clone();a.updateMatrixWorld(),a.updateProjectionMatrix(),A.getCenter(f);const b=new E;if(A.getSize(b),A.applyMatrix4(a.matrixWorldInverse),A.getSize(g),A.setFromCenterAndSize(f,g),Number.isNaN(g.x)||Number.isNaN(g.y)||Number.isNaN(g.z)){console.warn("Camera fit size resultet in NaN",a,A,[...o]);return}if(g.length()<=1e-10){SL&&console.warn("Camera fit size is zero",A,[...o]);return}const v=i.fov||a.fov,x=2*Math.atan(Math.tan(v*Math.PI/360/2)*a.aspect)/Math.PI*360,w=g.y/(2*Math.atan(Math.PI*v/360)),C=g.x/(2*Math.atan(Math.PI*x/360)),S=u*Math.max(w,C)+g.z/2;SL&&console.log("Fit camera to objects",{fitHeightDistance:w,fitWidthDistance:C,distance:S,verticalFov:v,horizontalFov:x}),this.maxZoom=S*10,this.minZoom=S*.01;const _=.05,I=f.clone();if(I.y-=g.y*_,this.setLookTargetPosition(I,c),this.setFieldOfView(i.fov,c),this.autoTarget=!1,d==null||d=="auto"){const G=$.findObjectOfType(Pd),X=G?G.radius:0,F=Math.max(b.x,b.y,b.z,X);a.near=S/100,a.far=F+S*10,G&&(this.maxZoom=Math.max(Math.min(this.maxZoom,X*.5),S))}const B=l.getDistance();B<this.minZoom&&(this.minZoom=B*.9),B>this.maxZoom&&(this.maxZoom=B*1.1),a.updateMatrixWorld(),a.updateProjectionMatrix();const M=ri(a),R=f.clone();R.sub(M),h==="y"&&(R.y=0),R.normalize(),R.multiplyScalar(S),h==="y"&&(R.y+=-_*4*S);let k=f.clone().sub(R);if(a.parent&&(k=a.parent.worldToLocal(k)),this.setCameraTargetPosition(k,c),SL){const G=new tN(A);this.context.scene.add(G),dD(G,ww(a)),setTimeout(()=>{this.context.scene.remove(G)},1e4),Nt.DrawWireBox3(y,65280,10),this._haveAttachedKeyboardEvents||(this._haveAttachedKeyboardEvents=!0,document.body.addEventListener("keydown",X=>{if(X.code==="KeyF"){let F;this._cameraObject instanceof Ot&&(F=Math.random()*Math.random()*170+10),this.fitCamera({objects:o,fitOffset:u,immediate:!1,fov:F})}X.code==="KeyV"&&this._cameraObject instanceof Ot&&(this._cameraObject.fov=60)}))}l.update()}}ls([T()],ln.prototype,"autoTarget",2),ls([T()],ln.prototype,"autoFit",2),ls([T()],ln.prototype,"enableRotate",2),ls([T()],ln.prototype,"autoRotate",2),ls([T()],ln.prototype,"autoRotateSpeed",2),ls([T()],ln.prototype,"minAzimuthAngle",2),ls([T()],ln.prototype,"maxAzimuthAngle",2),ls([T()],ln.prototype,"minPolarAngle",2),ls([T()],ln.prototype,"maxPolarAngle",2),ls([T()],ln.prototype,"enableKeys",2),ls([T()],ln.prototype,"enableDamping",2),ls([T()],ln.prototype,"dampingFactor",2),ls([T()],ln.prototype,"enableZoom",2),ls([T()],ln.prototype,"minZoom",2),ls([T()],ln.prototype,"maxZoom",2),ls([T()],ln.prototype,"zoomSpeed",2),ls([T()],ln.prototype,"enablePan",2),ls([T(O0)],ln.prototype,"lookAtConstraint",2),ls([T()],ln.prototype,"lookAtConstraint01",2),ls([T()],ln.prototype,"allowInterrupt",2),ls([T()],ln.prototype,"middleClickToFocus",2),ls([T()],ln.prototype,"doubleClickToFocus",2),ls([T()],ln.prototype,"clickBackgroundToFitScene",2),ls([T()],ln.prototype,"targetLerpDuration",2);var GNe=Object.defineProperty,PNe=Object.getOwnPropertyDescriptor,Va=(n,e,i,s)=>{for(var r=s>1?void 0:s?PNe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&GNe(e,i,r),r},ug=(n=>(n[n.None=0]="None",n[n.Skybox=1]="Skybox",n[n.SolidColor=2]="SolidColor",n[n.Uninitialized=4]="Uninitialized",n))(ug||{});const pg=q("debugcam"),lse=q("debugscreenpointtoray");var ML;const rS=(ML=class extends Oe{constructor(){super(...arguments),m(this,"_nearClipPlane",.1),m(this,"_farClipPlane",1e3),m(this,"orthographic",!1),m(this,"orthographicSize",5),m(this,"ARBackgroundAlpha",0),m(this,"_cullingMask",4294967295),m(this,"_backgroundBlurriness"),m(this,"_backgroundIntensity"),m(this,"_backgroundRotation"),m(this,"_environmentIntensity"),m(this,"_targetTexture",null),m(this,"_backgroundColor"),m(this,"_fov"),m(this,"_cam",null),m(this,"_clearFlags",2),m(this,"_skybox"),m(this,"_frustum"),m(this,"_projScreenMatrix",new de)}get isCamera(){return!0}get aspect(){return this._cam instanceof Ot?this._cam.aspect:this.context.domWidth/this.context.domHeight}set aspect(n){this._cam instanceof Ot&&this._cam.aspect!==n&&(this._cam.aspect=n,this._cam.updateProjectionMatrix())}get fieldOfView(){return this._cam instanceof Ot?this._cam.fov:this._fov}set fieldOfView(n){const e=this.fieldOfView!=n;if(this._fov=n,e&&this._cam&&this._cam instanceof Ot){if(this._fov===void 0){console.warn("Can not set undefined fov on PerspectiveCamera");return}this._cam.fov=this._fov,this._cam.updateProjectionMatrix()}}get nearClipPlane(){return this._nearClipPlane}set nearClipPlane(n){const e=this._nearClipPlane!=n;this._nearClipPlane=n,this._cam&&(e||this._cam.near!=n)&&(this._cam.near=n,this._cam.updateProjectionMatrix())}applyClippingPlane(){this._cam&&(this._cam.near=this._nearClipPlane,this._cam.far=this._farClipPlane,this._cam.updateProjectionMatrix())}get farClipPlane(){return this._farClipPlane}set farClipPlane(n){const e=this._farClipPlane!=n;this._farClipPlane=n,this._cam&&(e||this._cam.far!=n)&&(this._cam.far=n,this._cam.updateProjectionMatrix())}get clearFlags(){return this._clearFlags}set clearFlags(n){n!==this._clearFlags&&(this._clearFlags=n,this.applyClearFlagsIfIsActiveCamera())}set cullingMask(n){this._cullingMask=n,this._cam&&(this._cam.layers.mask=n)}get cullingMask(){return this._cam?this._cam.layers.mask:this._cullingMask}set cullingLayer(n){this.cullingMask=(1<<n|0)>>>0}set backgroundBlurriness(n){n!==this._backgroundBlurriness&&(n===void 0?this._backgroundBlurriness=void 0:this._backgroundBlurriness=Math.min(Math.max(n,0),1),this.applyClearFlagsIfIsActiveCamera())}get backgroundBlurriness(){return this._backgroundBlurriness}set backgroundIntensity(n){n!==this._backgroundIntensity&&(n===void 0?this._backgroundIntensity=void 0:this._backgroundIntensity=Math.min(Math.max(n,0),10),this.applyClearFlagsIfIsActiveCamera())}get backgroundIntensity(){return this._backgroundIntensity}set backgroundRotation(n){n!==this._backgroundRotation&&(n===void 0?this._backgroundRotation=void 0:this._backgroundRotation=n,this.applyClearFlagsIfIsActiveCamera())}get backgroundRotation(){return this._backgroundRotation}set environmentIntensity(n){this._environmentIntensity=n}get environmentIntensity(){return this._environmentIntensity}get backgroundColor(){return this._backgroundColor??null}set backgroundColor(n){if(n){if(this._backgroundColor)this._backgroundColor.copy(n);else{if(!n.clone)return;this._backgroundColor=n.clone()}n.alpha===void 0&&(this._backgroundColor.alpha=1),this.applyClearFlagsIfIsActiveCamera()}}set targetTexture(n){this._targetTexture=n}get targetTexture(){return this._targetTexture}get cam(){return this.threeCamera}get threeCamera(){return this.activeAndEnabled&&this.buildCamera(),this._cam}screenPointToRay(n,e,i){const s=this.threeCamera,r=rS._origin;r.set(n,e,-1),this.context.input.convertScreenspaceToRaycastSpace(r),lse&&console.log("screenPointToRay",n.toFixed(2),e.toFixed(2),"now:",r.x.toFixed(2),r.y.toFixed(2),"isInXR:"+this.context.isInXR),r.z=-1,r.unproject(s);const o=rS._direction.set(r.x,r.y,r.z),a=ri(s);return o.sub(a),o.normalize(),i?(i.set(a,o),i):new ya(a.clone(),o.clone())}getFrustum(){return this._frustum||(this._frustum=new Cf,this.updateFrustum()),this._frustum}updateFrustum(){this._frustum||(this._frustum=new Cf),this._frustum.setFromProjectionMatrix(this.getProjectionScreenMatrix(this._projScreenMatrix,!0),this.context.renderer.coordinateSystem)}getProjectionScreenMatrix(n,e){return e&&this._projScreenMatrix.multiplyMatrices(this.threeCamera.projectionMatrix,this.threeCamera.matrixWorldInverse),n===this._projScreenMatrix?n:n.copy(this._projScreenMatrix)}awake(){lse&&window.addEventListener("pointerdown",n=>{const e=n.clientX,i=n.clientY;console.log("touch",e.toFixed(2),i.toFixed(2));const s=this.screenPointToRay(e,i),r="#"+Math.floor(Math.random()*16777215).toString(16);Nt.DrawRay(s.origin,s.direction,r,10)})}onEnable(){pg&&console.log(`Camera enabled: "${this.name}". ClearFlags=${ug[this._clearFlags]}`,this),this.buildCamera(),(this.tag=="MainCamera"||!this.context.mainCameraComponent)&&(this.context.setCurrentCamera(this),VNe(this)),this.applyClearFlagsIfIsActiveCamera({applySkybox:!0})}onDisable(){this.context.removeCamera(this)}onBeforeRender(){if(this._cam&&(this._frustum&&this.updateFrustum(),this._clearFlags===2&&this.applyClearFlagsIfIsActiveCamera(),this._targetTexture)){this.context.isManagedExternally&&(this._warnedAboutExternalRenderer||(this._warnedAboutExternalRenderer=!0,console.warn("Rendering with external renderer is not supported yet. This may not work or throw errors. Please remove the the target texture from your camera: "+this.name,this.targetTexture))),this.context.composer;const n=this.context.renderer;if(n){const e=this.context.mainCameraComponent;this.applyClearFlags(),this._targetTexture.render(this.context.scene,this._cam,n),e?.applyClearFlags()}}}buildCamera(){if(this._cam)return;const n=this.gameObject.isCamera;let e=null;if(n?(e=this.gameObject,e?.layers.enableAll(),e instanceof Ot&&(this._fov=e.fov)):e=this.gameObject.children[0],e&&e.isCamera)e instanceof Ot&&(this._fov&&(e.fov=this._fov),e.near=this._nearClipPlane,e.far=this._farClipPlane,e.updateProjectionMatrix());else if(!this.orthographic)e=new Ot(this.fieldOfView,window.innerWidth/window.innerHeight,this._nearClipPlane,this._farClipPlane),this.fieldOfView&&(e.fov=this.fieldOfView),this.gameObject.add(e);else{const i=this.orthographicSize*100;e=new lh(window.innerWidth/-i,window.innerWidth/i,window.innerHeight/i,window.innerHeight/-i,this._nearClipPlane,this._farClipPlane),this.gameObject.add(e)}this._cam=e,this._cam.layers.mask=this._cullingMask,this.tag=="MainCamera"&&this.context.setCurrentCamera(this)}applyClearFlagsIfIsActiveCamera(n){this.context.mainCameraComponent===this&&this.applyClearFlags(n)}applyClearFlags(n){var e;if(!this._cam){pg&&console.log("Camera does not exist (apply clear flags)");return}if(this.fieldOfView=this._fov,pg){const i=`Camera "${this.name}" clear flags: ${ug[this._clearFlags]}`;console.debug(i)}switch(this._clearFlags){case 0:return;case 1:if(rS.backgroundShouldBeTransparent(this.context)&&(!this.ARBackgroundAlpha||this.ARBackgroundAlpha<.001)){this.context.scene.background=null,this.context.renderer.setClearColor(0,0);return}(!this.scene.background||!this._skybox||n?.applySkybox===!0)&&this.applySceneSkybox(),this._backgroundBlurriness!==void 0?this.context.scene.backgroundBlurriness=this._backgroundBlurriness:pg&&console.warn(`Camera "${this.name}" has no background blurriness`),this._backgroundIntensity!==void 0&&(this.context.scene.backgroundIntensity=this._backgroundIntensity),this._backgroundRotation!==void 0?this.context.scene.backgroundRotation=this._backgroundRotation:pg&&console.warn(`Camera "${this.name}" has no background intensity`);break;case 2:if(this._backgroundColor){let i=this._backgroundColor.alpha;rS.backgroundShouldBeTransparent(this.context)&&(i=this.ARBackgroundAlpha??0),this.context.scene.background=null,(e=this.context.xr)!=null&&e.isVR?this.context.renderer.setClearColor(I8(this._backgroundColor).convertLinearToSRGB()):this.context.renderer.setClearColor(this._backgroundColor,i)}else pg&&console.warn(`Camera "${this.name}" has no background color`,this);break;case 4:this.context.scene.background=null,this.context.renderer.setClearColor(0,0);break}}applySceneSkybox(){this._skybox||(this._skybox=new NNe(this)),this._skybox.apply()}static backgroundShouldBeTransparent(n){var e,i,s,r;const o=(e=n.renderer.xr)==null?void 0:e.getSession();if(!o)return!1;if(typeof o._transparent=="boolean")return o._transparent;const a=o.environmentBlendMode;pg&&ss("Environment blend mode: "+a+" on "+navigator.userAgent);let l=a==="additive"||a==="alpha-blend";return n.isInAR&&a==="opaque"&&((i=navigator.userAgent)!=null&&i.includes("OculusBrowser")||(s=navigator.userAgent)!=null&&s.includes("Mozilla")&&(r=navigator.userAgent)!=null&&r.includes("Mobile WebXRViewer/v2"))&&(l=!0),o._transparent=l,l}},m(ML,"_origin",new E),m(ML,"_direction",new E),ML);let In=rS;Va([T()],In.prototype,"aspect",1),Va([T()],In.prototype,"fieldOfView",1),Va([T()],In.prototype,"nearClipPlane",1),Va([T()],In.prototype,"farClipPlane",1),Va([T()],In.prototype,"clearFlags",1),Va([T()],In.prototype,"orthographic",2),Va([T()],In.prototype,"orthographicSize",2),Va([T()],In.prototype,"ARBackgroundAlpha",2),Va([T()],In.prototype,"cullingMask",1),Va([T()],In.prototype,"backgroundBlurriness",1),Va([T()],In.prototype,"backgroundIntensity",1),Va([T(Oi)],In.prototype,"backgroundRotation",1),Va([T()],In.prototype,"environmentIntensity",1),Va([T(pn)],In.prototype,"backgroundColor",1),Va([T(cv)],In.prototype,"targetTexture",1);class NNe{constructor(e){m(this,"_camera"),m(this,"_skybox"),this._camera=e}get context(){var e;return(e=this._camera)==null?void 0:e.context}apply(){this._skybox=this.context.lightmaps.tryGetSkybox(this._camera.sourceId),this._skybox?this.context.scene.background!==this._skybox&&(pg&&console.log(`Camera "${this._camera.name}" set skybox`,this._camera,this._skybox),this._skybox.mapping=ao,this.context.scene.background=this._skybox):this._did_log_failed_to_find_skybox||(this._did_log_failed_to_find_skybox=!0,console.warn(`Camera "${this._camera.name}" has no skybox texture. ${this._camera.sourceId}`))}}function VNe(n){q("freecam")&&n.context.mainCameraComponent===n&&$.getOrAddComponent(n.gameObject,ln)}class mg extends Oe{constructor(){super(...arguments),m(this,"_listener",null),m(this,"onInteraction",()=>{this.destroyed||this.listener==null||this.addListenerIfItExists()})}get listener(){return this._listener==null&&(this._listener=new PH),this._listener}onEnable(){op.registerWaitForInteraction(this.onInteraction),this.addListenerIfItExists()}onDisable(){op.unregisterWaitForInteraction(this.onInteraction),this.removeListenerIfItExists()}addListenerIfItExists(){const e=this._listener;if(!e||e!=null&&e.parent)return;const i=this.context.mainCameraComponent||$.getComponentInParent(this.gameObject,In);i!=null&&i.threeCamera?i.threeCamera.add(e):this.gameObject.add(e),e.filter?(e.gain.connect(e.filter),e.filter.connect(e.context.destination)):e.gain.connect(e.context.destination)}removeListenerIfItExists(){const e=this._listener;e&&(e.removeFromParent(),e.filter&&e.filter.disconnect(),e.gain&&e.gain.disconnect())}}var XNe=Object.defineProperty,DNe=Object.getOwnPropertyDescriptor,Dh=(n,e,i,s)=>{for(var r=s>1?void 0:s?DNe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&XNe(e,i,r),r};const oa=q("debugaudio"),gg=class extends Oe{constructor(){super(...arguments),m(this,"clip",""),m(this,"playOnAwake",!1),m(this,"preload",!1),m(this,"playInBackground",!0),m(this,"_spatialBlend",0),m(this,"_minDistance",1),m(this,"_maxDistance",100),m(this,"_volume",1),m(this,"rollOffMode",0),m(this,"_loop",!1),m(this,"sound",null),m(this,"helper",null),m(this,"wasPlaying",!1),m(this,"audioLoader",null),m(this,"shouldPlay",!1),m(this,"_lastClipStartedLoading",null),m(this,"_audioElement",null),m(this,"onVisibilityChanged",()=>{switch(document.visibilityState){case"hidden":(this.playInBackground===!1||Ft.isMobileDevice())&&(this.wasPlaying=this.isPlaying,this.isPlaying&&this.pause());break;case"visible":oa&&console.log("visible",this.enabled,this.playOnAwake,!this.isPlaying,gg.userInteractionRegistered,this.wasPlaying),this.enabled&&this.playOnAwake&&!this.isPlaying&&gg.userInteractionRegistered&&this.wasPlaying&&this.play();break}}),m(this,"onApplicationMuteChanged",()=>{var n,e;this.context.application.muted?(n=this.sound)==null||n.setVolume(0):(e=this.sound)==null||e.setVolume(this.volume)}),m(this,"createAudio",n=>{oa&&console.log("AudioBuffer finished loading",n);const e=this.Sound;if(!e){oa&&console.warn("Failed getting sound?",this.name);return}e.isPlaying&&e.stop(),n&&e.setBuffer(n),e.loop=this._loop,this.context.application.muted?e.setVolume(0):e.setVolume(this.volume),e.autoplay=this.shouldPlay&&gg.userInteractionRegistered,this.applySpatialDistanceSettings(),e.isPlaying&&e.stop(),gg.registerWaitForAllowAudio(this.__onAllowAudioCallback)}),m(this,"__onAllowAudioCallback",()=>{this.shouldPlay&&this.play()}),m(this,"_lastContextTime",0),m(this,"_hasEnded",!0),m(this,"_needUpdateSpatialDistanceSettings",!1)}static get userInteractionRegistered(){return op.userInteractionRegistered}static registerWaitForAllowAudio(n){op.registerWaitForInteraction(n)}get isPlaying(){var n;return((n=this.sound)==null?void 0:n.isPlaying)??!1}get duration(){var n,e;return(e=(n=this.sound)==null?void 0:n.buffer)==null?void 0:e.duration}get time01(){var n;const e=this.duration;return e&&this.sound?((n=this.sound)==null?void 0:n.context.currentTime)/e:0}set time01(n){const e=this.duration;e&&this.sound&&(this.time=n*e)}get time(){var n,e;return(n=this.sound)!=null&&n.source?((e=this.sound.source)==null?void 0:e.context.currentTime)-this._lastContextTime+this.sound.offset:0}set time(n){if(this.sound){if(n===this.sound.offset)return;const e=this.isPlaying;this.stop(),this.sound.offset=n,e&&this.play()}}get loop(){return this.sound&&(this._loop=this.sound.getLoop()),this._loop}set loop(n){this._loop=n,this.sound&&this.sound.setLoop(n)}get spatialBlend(){return this._spatialBlend}set spatialBlend(n){n!==this._spatialBlend&&(this._spatialBlend=n,this._needUpdateSpatialDistanceSettings=!0)}get minDistance(){return this._minDistance}set minDistance(n){this._minDistance!==n&&(this._minDistance=n,this._needUpdateSpatialDistanceSettings=!0)}get maxDistance(){return this._maxDistance}set maxDistance(n){this._maxDistance!==n&&(this._maxDistance=n,this._needUpdateSpatialDistanceSettings=!0)}get volume(){return this._volume}set volume(n){this._volume=n,this.sound&&!this.context.application.muted&&(oa&&console.log(this.name,"audio set volume",n),this.sound.setVolume(n))}set pitch(n){this.sound&&this.sound.setPlaybackRate(n)}get pitch(){return this.sound?this.sound.getPlaybackRate():1}get Sound(){var n;if(!this.sound&&gg.userInteractionRegistered){let e=$.getComponent(this.context.mainCamera,mg)??$.findObjectOfType(mg,this.context);!e&&this.context.mainCamera&&(e=$.addComponent(this.context.mainCamera,mg)),e!=null&&e.listener?(this.sound=new VH(e.listener),(n=this.gameObject)==null||n.add(this.sound)):oa&&console.warn("No audio listener found in scene - can not play audio")}return this.sound}get ShouldPlay(){return this.shouldPlay}get audioContext(){var n;return(n=this.sound)==null?void 0:n.context}awake(){oa&&console.log(this),this.audioLoader=new vT,this.playOnAwake&&(this.shouldPlay=!0),this.preload&&typeof this.clip=="string"&&this.audioLoader.load(this.clip,this.createAudio,()=>{},console.error)}onEnable(){this.sound&&this.gameObject.add(this.sound),gg.userInteractionRegistered?this.playOnAwake&&this.context.application.isVisible&&this.play():gg.registerWaitForAllowAudio(()=>{this.enabled&&!this.destroyed&&this.shouldPlay&&this.onNewClip(this.clip)}),globalThis.addEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.addEventListener(V2.MuteChanged,this.onApplicationMuteChanged)}onDisable(){globalThis.removeEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.removeEventListener(V2.MuteChanged,this.onApplicationMuteChanged),this.pause()}applySpatialDistanceSettings(){const n=this.sound;if(!n)return;this._needUpdateSpatialDistanceSettings=!1;const e=lt.lerp(10*this._maxDistance/Math.max(1e-4,this.spatialBlend),this._minDistance,this.spatialBlend);switch(oa&&console.log(this.name,this._minDistance,this._maxDistance,this.spatialBlend,"Ref distance="+e),n.setRefDistance(e),n.setMaxDistance(Math.max(.01,this._maxDistance)),this.rollOffMode){case 0:n.setDistanceModel("exponential");break;case 1:n.setDistanceModel("linear");break;case 2:console.warn("Custom rolloff for AudioSource is not supported: "+this.name);break}this.spatialBlend>0?oa&&!this.helper&&(this.helper=new XPe(n,n.getRefDistance()),n.add(this.helper)):this.helper&&this.helper.parent&&this.helper.removeFromParent()}async onNewClip(n){if(n&&(this.clip=n),typeof n=="string")if(oa&&console.log(n),n.endsWith(".mp3")||n.endsWith(".wav")){if(this.audioLoader||(this.audioLoader=new vT),this.shouldPlay=!0,this._lastClipStartedLoading===n){oa&&console.log("Is currently loading:",this._lastClipStartedLoading,this);return}this._lastClipStartedLoading=n,oa&&console.log("load audio",n);const e=await this.audioLoader.loadAsync(n).catch(console.error);this._lastClipStartedLoading=null,e&&this.createAudio(e)}else console.warn("Unsupported audio clip type",n);else this.shouldPlay=!0,this.createAudio()}play(n=void 0){var e,i,s;!n&&this.clip&&(n=this.clip),n!==void 0&&typeof n!="string"&&!(n instanceof MediaStream)&&(Je()&&console.warn("Called play on AudioSource with unknown argument type:",n+`
Using the assigned clip instead:`,this.clip),n=this.clip);let r=!this.sound||n&&n!==this.clip;if(typeof n=="string"&&!this.audioLoader&&(r=!0),(n instanceof MediaStream||typeof n=="string")&&(this.clip=n),r){this.shouldPlay=!0,this.onNewClip(n);return}if(this.shouldPlay=!0,this._hasEnded=!1,oa&&console.log("play",(e=this.sound)==null?void 0:e.getVolume(),this.sound),this.sound&&!this.sound.isPlaying){const o=this.context.application.muted;o&&this.sound.setVolume(0),(i=this.gameObject)==null||i.add(this.sound),this.clip instanceof MediaStream?(this.sound.setMediaStreamSource(this.clip),this._audioElement||(this._audioElement=document.createElement("audio"),this._audioElement.style.display="none"),this._audioElement.parentNode||(s=this.context.domElement.shadowRoot)==null||s.append(this._audioElement),this._audioElement.srcObject=this.clip,this._audioElement.autoplay=!1):(this._audioElement&&this._audioElement.remove(),this.sound.play(o?.1:0))}}pause(){var n,e;oa&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.isPlaying&&this.sound.source&&(this._lastContextTime=(n=this.sound)==null?void 0:n.context.currentTime,this.sound.pause()),(e=this._audioElement)==null||e.remove()}stop(){var n,e;oa&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.source&&(this._lastContextTime=(n=this.sound)==null?void 0:n.context.currentTime,oa&&console.log(this._lastContextTime),this.sound.stop()),(e=this._audioElement)==null||e.remove()}update(){this.helper&&(this.isPlaying&&this.helper.update(),this.helper.visible=this.isPlaying),this._needUpdateSpatialDistanceSettings&&this.applySpatialDistanceSettings(),this.sound&&!this.sound.isPlaying&&this.shouldPlay&&!this._hasEnded&&(this._hasEnded=!0,oa&&console.log("Audio clip ended",this.clip),this.dispatchEvent(new CustomEvent("ended",{detail:this})))}};let vs=gg;Dh([T(URL)],vs.prototype,"clip",2),Dh([T()],vs.prototype,"playOnAwake",2),Dh([T()],vs.prototype,"preload",2),Dh([T()],vs.prototype,"playInBackground",2),Dh([T()],vs.prototype,"loop",1),Dh([T()],vs.prototype,"spatialBlend",1),Dh([T()],vs.prototype,"minDistance",1),Dh([T()],vs.prototype,"maxDistance",1),Dh([T()],vs.prototype,"volume",1),Dh([T()],vs.prototype,"pitch",1),Dh([T()],vs.prototype,"rollOffMode",2);var zNe=Object.defineProperty,FNe=Object.getOwnPropertyDescriptor,IL=(n,e,i,s)=>{for(var r=s>1?void 0:s?FNe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&zNe(e,i,r),r};const UNe=q("debugsignals");class oS{constructor(){m(this,"guid")}}IL([T()],oS.prototype,"guid",2);class pv{constructor(){m(this,"signal"),m(this,"reaction")}}IL([T(oS)],pv.prototype,"signal",2),IL([T(Gn)],pv.prototype,"reaction",2);var gU;const pp=(gU=class extends Oe{constructor(){super(...arguments),m(this,"events")}static invoke(n){if(pp.receivers[n]){const e=pp.receivers[n];if(!e)return;for(const i of e)i.invoke(n)}}awake(){UNe&&console.log("SignalReceiver awake",this)}onEnable(){if(this.events)for(const n of this.events)pp.receivers[n.signal.guid]||(pp.receivers[n.signal.guid]=[]),pp.receivers[n.signal.guid].push(this)}onDisable(){if(this.events){for(const n of this.events)if(pp.receivers[n.signal.guid]){const e=pp.receivers[n.signal.guid].indexOf(this);e>=0&&pp.receivers[n.signal.guid].splice(e,1)}}}invoke(n){if(!this.events||!Array.isArray(this.events))return;const e=typeof n=="object"?n.guid:n;for(const i of this.events)if(i.signal.guid===e)try{if(i.reaction){if(!i.reaction.invoke){console.warn("Missing invoke - possibly a serialization error",i,this);continue}}else{console.warn("Missing reaction for signal",i,this);continue}i.reaction.invoke()}catch(s){console.error(s)}}},m(gU,"receivers",{}),gU);let mv=pp;IL([T(pv)],mv.prototype,"events",2);var Kl=(n=>(n.Activation="ActivationTrack",n.Animation="AnimationTrack",n.Audio="AudioTrack",n.Control="ControlTrack",n.Marker="MarkerTrack",n.Signal="SignalTrack",n))(Kl||{}),Dd=(n=>(n[n.None=0]="None",n[n.Hold=1]="Hold",n[n.Loop=2]="Loop",n[n.PingPong=3]="PingPong",n[n.Continue=4]="Continue",n))(Dd||{}),fU=(n=>(n.Signal="SignalEmitter",n))(fU||{}),ONe=Object.defineProperty,ZNe=Object.getOwnPropertyDescriptor,cse=(n,e,i,s)=>{for(var r=s>1?void 0:s?ZNe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&ONe(e,i,r),r};const mp=q("debugtimeline");var AU;const yU=(AU=class extends Oe{constructor(){super(...arguments),m(this,"playableAsset"),m(this,"playOnAwake"),m(this,"extrapolationMode",1),m(this,"waitForAudio",!0),m(this,"_visibilityChangeEvt"),m(this,"_clonedPlayableAsset",!1),m(this,"_speed",1),m(this,"_guidsMap"),m(this,"_isPlaying",!1),m(this,"_internalUpdateRoutine"),m(this,"_isPaused",!1),m(this,"_isStopping",!1),m(this,"_time",0),m(this,"_duration",0),m(this,"_weight",1),m(this,"_animationTracks",[]),m(this,"_audioTracks",[]),m(this,"_signalTracks",[]),m(this,"_controlTracks",[]),m(this,"_customTracks",[]),m(this,"_allTracks",[this._animationTracks,this._audioTracks,this._signalTracks,this._controlTracks,this._customTracks]),m(this,"animationCallbackReceivers",[])}static registerCreateTrack(n,e){this.createTrackFunctions[n]=e}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get time(){return this._time}set time(n){typeof n=="number"&&!Number.isNaN(n)?this._time=n:(mp||Ma())&&console.error("INVALID TIMELINE.TIME VALUE",n,this.name)}get duration(){return this._duration}set duration(n){this._duration=n}get weight(){return this._weight}set weight(n){this._weight=n}get speed(){return this._speed}set speed(n){this._speed=n}awake(){var n,e,i,s,r;mp&&console.log(this,(n=this.playableAsset)==null?void 0:n.tracks),this.rebuildGraph(),!this.isValid()&&(mp||Je())&&(mp?console.warn("PlayableDirector is not valid","Asset?",this.playableAsset,"Tracks:",(e=this.playableAsset)==null?void 0:e.tracks,"IsArray?",Array.isArray((i=this.playableAsset)==null?void 0:i.tracks),this):(r=(s=this.playableAsset)==null?void 0:s.tracks)!=null&&r.length?console.warn("PlayableDirector is not valid"):console.warn("PlayableDirector has no tracks"))}onEnable(){var n,e,i;for(const s of this._audioTracks)(n=s.onEnable)==null||n.call(s);for(const s of this._customTracks)(e=s.onEnable)==null||e.call(s);for(const s of this._animationTracks)(i=s.onEnable)==null||i.call(s);this.playOnAwake&&this.play(),this._visibilityChangeEvt||(this._visibilityChangeEvt=()=>{switch(document.visibilityState){case"hidden":this.setAudioTracksAllowPlaying(!1);break;case"visible":this.setAudioTracksAllowPlaying(!0);break}}),window.addEventListener("visibilitychange",this._visibilityChangeEvt)}onDisable(){var n,e,i;this.stop();for(const s of this._audioTracks)(n=s.onDisable)==null||n.call(s);for(const s of this._customTracks)(e=s.onDisable)==null||e.call(s);for(const s of this._animationTracks)(i=s.onDisable)==null||i.call(s);this._visibilityChangeEvt&&window.removeEventListener("visibilitychange",this._visibilityChangeEvt)}onDestroy(){var n;for(const e of this._allTracks)for(const i of e)(n=i.onDestroy)==null||n.call(i)}rebuildGraph(){this.isValid()&&(this.resolveBindings(),this.updateTimelineDuration(),this.setupAndCreateTrackHandlers())}async play(){if(!this.isValid())return;const n=this._isPaused==!0;if(this._isPaused=!1,!this._isPlaying){if(this._isPlaying=!0,n&&this.invokePauseChangedMethodsOnTracks(),this.waitForAudio){const e=[];for(const i of this._audioTracks){const s=i.loadAudio(this._time,1,0);s&&e.push(s)}if(e.length>0&&(await Promise.all(e),!this._isPlaying))return;for(;this._audioTracks.length>0&&this._isPlaying&&!vs.userInteractionRegistered&&this.waitForAudio;)await Ah(200)}this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine=this.startCoroutine(this.internalUpdate(),_n.LateUpdate)}}pause(){this.isValid()&&(this._isPlaying=!1,!this._isPaused&&(this._isPaused=!0,this.internalEvaluate(),this.invokePauseChangedMethodsOnTracks(),this.invokeStateChangedMethodsOnTracks()))}stop(){this._isStopping=!0;for(const i of this._audioTracks)i.stop();const n=this._isPaused==!0,e=this._isPlaying;this._isPlaying&&(this._time=0,this._isPlaying=!1,this._isPaused=!1,this.internalEvaluate(),n&&this.invokePauseChangedMethodsOnTracks()),this._isPlaying=!1,this._isPaused=!1,n&&!e&&this.invokePauseChangedMethodsOnTracks(),e&&this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine&&this.stopCoroutine(this._internalUpdateRoutine),this._internalUpdateRoutine=null,this._isStopping=!1}evaluate(){this.internalEvaluate(!0)}isValid(){return this.playableAsset&&this.playableAsset.tracks&&Array.isArray(this.playableAsset.tracks)}*forEachTrack(){for(const n of this._allTracks)for(const e of n)yield e}get animationTracks(){return this._animationTracks}get audioTracks(){return this._audioTracks}resolveGuids(n){this._guidsMap=n}invokePauseChangedMethodsOnTracks(){var n;for(const e of this.forEachTrack())(n=e.onPauseChanged)==null||n.call(e)}invokeStateChangedMethodsOnTracks(){var n;for(const e of this.forEachTrack())(n=e.onStateChanged)==null||n.call(e,this._isPlaying)}*internalUpdate(){for(;this._isPlaying&&this.activeAndEnabled;)!this._isPaused&&this._isPlaying&&(this._time+=this.context.time.deltaTime*this.speed,this.internalEvaluate()),yield}internalEvaluate(n=!1){if(!this.isValid())return;let e=this._time;switch(this.extrapolationMode){case 0:this._speed>0?e=Math.min(e,this._duration):this._speed<0&&(e=Math.max(e,0)),this._time=e;break;case 1:e%=this._duration,this._time=e;break;case 2:if(e>this._duration){this.stop();return}break}const i=this._time;for(const s of this.playableAsset.tracks)if(!s.muted)switch(s.type){case Kl.Activation:if(!n&&!this._isPlaying)continue;for(let r=0;r<s.outputs.length;r++){const o=s.outputs[r];if(typeof o=="object"){let a=!1;if(s.clips)for(const c of s.clips)c.start<=i&&i<=c.end&&(a=!0);const l=o;l.visible!==void 0&&l.visible!==a&&(l.visible=a,mp&&console.warn(this.name,"set ActivationTrack-"+r,l.name,a,i))}}break}if(!this._isStopping)for(const s of this._animationTracks)s.evaluate(i);for(const s of this._audioTracks)s.evaluate(i);for(const s of this._signalTracks)s.evaluate(i);for(const s of this._controlTracks)s.evaluate(i);for(const s of this._customTracks)s.evaluate(i)}resolveBindings(){if(this._clonedPlayableAsset||(this._clonedPlayableAsset=!0,this.playableAsset=gw(this.playableAsset)),!this.playableAsset||!this.playableAsset.tracks)return;const n=this.findRoot(this.gameObject);for(const e of this.playableAsset.tracks){for(let i=e.outputs.length-1;i>=0;i--){let s=e.outputs[i];if(typeof s=="string"){this._guidsMap&&this._guidsMap[s]&&(s=this._guidsMap[s]);const r=$.findByGuid(s,n);r===null||typeof r!="object"?(e.outputs.splice(i,1),console.warn("Failed to resolve binding",s,e.name,e.type)):(mp&&console.log("Resolved binding",s,"to",r),e.outputs[i]=r)}else if(s===null){if(e.outputs.splice(i,1),yU.createTrackFunctions[e.type])continue;e.type!==Kl.Audio&&e.type!==Kl.Control&&e.type!==Kl.Marker&&e.type!==Kl.Signal&&console.warn("Missing binding",s,e.name,e.type,this.name,this.playableAsset.name)}}if(e.type===Kl.Control&&e.clips)for(let i=0;i<e.clips.length;i++){const s=e.clips[i];let r=s.asset.sourceObject;if(typeof r=="string"){this._guidsMap&&this._guidsMap[r]&&(r=this._guidsMap[r]);const o=$.findByGuid(r,n);o===null||typeof o!="object"?console.warn("Failed to resolve sourceObject binding",r,e.name,s):(mp&&console.log("Resolved binding",r,"to",o),s.asset.sourceObject=o)}}}}findRoot(n){return n.parent?this.findRoot(n.parent):n}updateTimelineDuration(){if(this._duration=0,!(!this.playableAsset||!this.playableAsset.tracks)){for(const n of this.playableAsset.tracks)if(n.muted!==!0){if(n.clips)for(const e of n.clips)e.end>this._duration&&(this._duration=e.end);if(n.markers)for(const e of n.markers)e.time>this._duration&&(this._duration=e.time+.001)}}}setupAndCreateTrackHandlers(){var n,e,i;if(this._animationTracks.length=0,this._audioTracks.length=0,this._signalTracks.length=0,!this.playableAsset)return;let s=$.findObjectOfType(mg,this.context);for(const r of this.playableAsset.tracks){const o=r.type,a=yU.createTrackFunctions[o];if(a!=null){const l=a(this,r);if(typeof l.evaluate=="function"){l.director=this,l.track=r,this._customTracks.push(l);continue}}if(r.type===Kl.Animation){if(!r.clips||r.clips.length<=0){mp&&console.warn("Animation track has no clips",r);continue}for(let l=r.outputs.length-1;l>=0;l--){let c=r.outputs[l];if(c instanceof Ae){const d=$.getOrAddComponent(c,Mo);d&&(c=d)}const h=(n=c?.gameObject)==null?void 0:n.animations;if(h){const d=new TL;d.trackOffset=r.trackOffset,d.director=this,d.track=r;for(let u=0;u<r.clips.length;u++){const p=r.clips[u],g=p.asset;if(!g){console.error(`Timeline ${this.name}: clip #${u} on track "${r.name}" has no animation data`);continue}const f=g.clip;let A=f;if((typeof A=="string"||typeof A=="number")&&(A=h.find(b=>b.name===f)),mp&&console.log(g,f,"\u2192",A),!A){console.warn("Could not find animationClip for model",p,r.name,this.name,(e=this.playableAsset)==null?void 0:e.name,h,c);continue}c instanceof Mo&&c.runtimeAnimatorController&&(c.__internalDidAwakeAndStart||c.initializeRuntimeAnimatorController(),c.runtimeAnimatorController.mixer||c.runtimeAnimatorController.bind(c),d.mixer=c.runtimeAnimatorController.mixer),d.mixer||(d.mixer=new xT(c.gameObject),this.context.animations.registerAnimationMixer(d.mixer)),d.clips.push(A),d.mixer.uncacheAction(A),d.createHooks(p.asset,A);const y=d.mixer.clipAction(A);d.actions.push(y),d.models.push(p)}this._animationTracks.push(d)}}}else if(r.type===Kl.Audio){if(!r.clips||r.clips.length<=0)continue;const l=new cS;l.director=this,l.track=r,l.audioSource=r.outputs.find(c=>c instanceof vs),this._audioTracks.push(l),s||(s=(i=this.context.mainCameraComponent)==null?void 0:i.gameObject.addComponent(mg)),l.listener=s.listener;for(let c=0;c<r.clips.length;c++){const h=r.clips[c];l.addModel(h)}}else if(r.type===Kl.Marker){const l=new hS;if(l.director=this,l.track=r,r.markers)for(const c of r.markers)switch(c.type){case fU.Signal:l.models.push(c),l.didTrigger.push(!1);break}if(l!==null&&l.models.length>0){const c=$.getComponent(this.gameObject,mv);c&&(l.receivers.push(c),this._signalTracks.push(l))}}else if(r.type===Kl.Signal){const l=new hS;if(l.director=this,l.track=r,r.markers)for(const c of r.markers)l.models.push(c),l.didTrigger.push(!1);for(const c of r.outputs)l.receivers.push(c);this._signalTracks.push(l)}else if(r.type===Kl.Control){const l=new EL;if(l.director=this,l.track=r,r.clips)for(const c of r.clips)l.models.push(c);l.resolveSourceObjects(this.context),this._controlTracks.push(l)}}}setAudioTracksAllowPlaying(n){for(const e of this._audioTracks)e.onAllowAudioChanged(n)}registerAnimationCallback(n){this.animationCallbackReceivers.push(n)}unregisterAnimationCallback(n){const e=this.animationCallbackReceivers.indexOf(n);e!==-1&&this.animationCallbackReceivers.splice(e,1)}},m(AU,"createTrackFunctions",{}),AU);let fg=yU;cse([T()],fg.prototype,"playOnAwake",2),cse([T()],fg.prototype,"extrapolationMode",2);const zd=q("debugtimeline");class aS{constructor(){m(this,"director"),m(this,"track")}get muted(){return this.track.muted}set muted(e){var i;e!==this.track.muted&&(this.track.muted=e,(i=this.onMuteChanged)==null||i.call(this))}*forEachClip(e=!1){var i;if((i=this.track)!=null&&i.clips)if(e)for(let s=this.track.clips.length-1;s>=0;s--)yield this.track.clips[s];else for(const s of this.track.clips)yield s}getClipTime(e,i){return i.clipIn+(e-i.start)*i.timeScale}getClipTimeNormalized(e,i){return(e-i.start)/i.duration}evaluateWeight(e,i,s,r=!0){if(i<0||i>=s.length)return 0;const o=s[i];if(r||e>=o.start&&e<=o.end){let a=1;const l=!1;if(o.easeInDuration>0){const c=Math.min((e-o.start)/o.easeInDuration,1);a*=c}if(o.easeOutDuration>0&&!l){const c=Math.min((o.end-e)/o.easeOutDuration,1);a*=c}return a}return 0}}class WNe{constructor(e){m(this,"clip"),m(this,"rootPositionOffset"),m(this,"rootQuaternionOffset"),m(this,"rootStartPosition"),m(this,"rootEndPosition"),m(this,"rootStartQuaternion"),m(this,"rootEndQuaternion");const i=e.getClip();this.clip=i;const s=e.getRoot(),r=s.name+".position",o=s.name+".quaternion";zd&&console.log(i.name,i.tracks,r);for(const a of i.tracks)if(!(a.times.length<=0)){if(a.name.endsWith(r))this.rootStartPosition=new E().fromArray(a.values,0),this.rootEndPosition=new E().fromArray(a.values,a.values.length-3),this.rootPositionOffset=this.rootEndPosition.clone().sub(this.rootStartPosition),zd&&console.log(this.rootPositionOffset);else if(a.name.endsWith(o)&&(this.rootStartQuaternion=new Fe().fromArray(a.values,0),this.rootEndQuaternion=new Fe().fromArray(a.values,a.values.length-4),this.rootQuaternionOffset=this.rootEndQuaternion.clone().multiply(this.rootStartQuaternion),zd)){const l=new Oi().setFromQuaternion(this.rootQuaternionOffset);console.log("ROT",l)}}}get hasOffsets(){return this.rootPositionOffset!==void 0||this.rootQuaternionOffset!==void 0}}class TL extends aS{constructor(){super(...arguments),m(this,"models",[]),m(this,"trackOffset"),m(this,"target"),m(this,"mixer"),m(this,"clips",[]),m(this,"actions",[]),m(this,"weight",1),m(this,"_actionOffsets",[]),m(this,"_didBind",!1),m(this,"_animator",null),m(this,"_useclipOffsets",!0),m(this,"_totalOffsetPosition",new E),m(this,"_totalOffsetRotation",new Fe),m(this,"_totalOffsetPosition2",new E),m(this,"_totalOffsetRotation2",new Fe),m(this,"_summedPos",new E),m(this,"_tempPos",new E),m(this,"_summedRot",new Fe),m(this,"_tempRot",new Fe),m(this,"_clipRotQuat",new Fe)}onDisable(){var e;(e=this.mixer)==null||e.stopAllAction()}onDestroy(){this.director.context.animations.unregisterAnimationMixer(this.mixer)}onStateChanged(){this._animator&&Hne(this._animator.gameObject,this,this.director.isPlaying)}createHooks(e,i){var s,r;if(((s=i.tracks)==null?void 0:s.length)<=0){console.warn("No tracks in AnimationClip",i);return}const o=i.tracks[0].name.split("."),a=o[o.length-2],l=a+".position",c=a+".quaternion";let h=!1,d=!1;for(const u of i.tracks)u.name.endsWith(l)?(h=!0,this.createPositionInterpolant(i,e,u)):u.name.endsWith(c)&&(d=!0,this.createRotationInterpolant(i,e,u));if(!h||!d){const u=(r=this.mixer)==null?void 0:r.getRoot(),p=i.tracks[0],g=p.name.lastIndexOf("."),f=p.name.substring(0,g),A=f.substring(f.lastIndexOf(".")+1),y=u.getObjectByName(A);if(y)if(h){if(!d){const b=i.tracks[0].name.substring(0,g)+".quaternion";zd&&console.warn("Create quaternion track",A,y);const v=y.quaternion,x=new ad(b,[0,i.duration],[v.x,v.y,v.z,v.w,v.x,v.y,v.z,v.w]);i.tracks.push(x),this.createRotationInterpolant(i,e,x)}}else{const b=f+".position";zd&&console.warn("Create position track",A,y);const v=y.position,x=new ld(b,[0,i.duration],[v.x,v.y,v.z,v.x,v.y,v.z]);i.tracks.push(x),this.createPositionInterpolant(i,e,x)}}}bind(){if(!this._didBind){this._didBind=!0,zd&&console.log(this.models),this.mixer?this.target=this.mixer.getRoot():console.warn("No mixer was assigned to animation track");for(const e of this.actions){const i=new WNe(e);this._actionOffsets.push(i)}this.target&&(this._animator=$.getComponent(this.target,Mo)??null,this._animator&&Hne(this._animator.gameObject,this,!0));for(const e of this.models){const i=e.asset,s=i.position,r=i.rotation;s&&s.x!==void 0&&(s.isVector3||(i.position=new E(s.x,s.y,s.z)),r.isQuaternion||(i.rotation=new Fe(r.x,r.y,r.z,r.w)))}this.ensureTrackOffsets()}}ensureTrackOffsets(){if(this.trackOffset){const e=this.trackOffset.position;e&&(e.isVector3||(this.trackOffset.position=new E(e.x,e.y,e.z)));const i=this.trackOffset.rotation;i&&(i.isQuaternion||(this.trackOffset.rotation=new Fe(i.x,i.y,i.z,i.w)))}}evaluate(e){var i,s,r,o,a,l,c;if(this.track.muted||!this.mixer)return;this.bind(),this._totalOffsetPosition.set(0,0,0),this._totalOffsetRotation.set(0,0,0,1),this._totalOffsetPosition2.set(0,0,0),this._totalOffsetRotation2.set(0,0,0,1);let h=0,d=0,u=!1,p=!1,g=0;for(let f=0;f<this.clips.length;f++){const A=this.models[f],y=this.actions[f],b=A.asset;y.weight=0;const v=e>=A.start&&e<=A.end,x=A.preExtrapolationMode,w=A.postExtrapolationMode,C=f<this.clips.length-1?this.models[f+1]:null;let S=v,_=!1;if(!S&&!u&&A.end<e&&w!==Dd.None?(!C||C.start>e)&&(S=!0,u=!0):f==0&&!S&&!p&&A.start>e&&x!==Dd.None&&(!C||C.start<e)&&(S=!0,_=!0,p=!0),S){let I=this.weight;I*=this.evaluateWeight(e,f,this.models,S),I*=this.director.weight;let B=v;if(_)switch(x){case Dd.Hold:break;case Dd.Loop:e+=A.start,B=!0;break;default:e+=A.start,B=!0;break}let M=this.getClipTime(e,A),R=0;const k=b.duration;if(_&&x===Dd.Hold&&(M=0),B){if(b.loop)for(R+=Math.floor(M/(k+1e-6));M>k;)M-=k}else if(!v&&u)switch(w){case Dd.Hold:M=this.getClipTime(A.end,A);break;case Dd.Loop:M%=k;break;case Dd.PingPong:const X=Math.floor(M/k)%2!==0;M%=k,X&&(M=k-M);break}A.reversed===!0?y.time=y.getClip().duration-M:y.time=M,y.timeScale=0;const G=Math.max(0,I);if(y.weight=G,g+=G,y.clampWhenFinished=!1,y.isRunning()||y.play(),this._useclipOffsets){const X=h==0?this._totalOffsetPosition:this._totalOffsetPosition2,F=h==0?this._totalOffsetRotation:this._totalOffsetRotation2;h<1&&(d=1-I),h+=1;const z=this._summedPos.set(0,0,0),H=this._tempPos.set(0,0,0),Z=this._summedRot.identity(),he=this._tempRot.identity(),be=b.rotation;be&&(this._clipRotQuat.identity(),this._clipRotQuat.slerp(be,I));const _e=this._actionOffsets[f];if(_e.hasOffsets)for(let Ye=0;Ye<R;Ye++)_e.rootPositionOffset?H.copy(_e.rootPositionOffset):H.set(0,0,0),H.applyQuaternion(Z),this._clipRotQuat&&H.applyQuaternion(this._clipRotQuat),_e.rootQuaternionOffset&&(he.copy(_e.rootQuaternionOffset),Z.multiply(he)),z.add(H);this._clipRotQuat&&F.multiply(this._clipRotQuat),F.multiply(Z),b.position&&z.add(b.position),X.add(z)}}}if(this._useclipOffsets&&(this._totalOffsetPosition.lerp(this._totalOffsetPosition2,d),this._totalOffsetRotation.slerp(this._totalOffsetRotation2,d)),this.__mixerError===void 0&&(zd||Je())&&(s=(i=this._animator)==null?void 0:i.runtimeAnimatorController)!=null&&s.mixer&&this.mixer!==((o=(r=this._animator)==null?void 0:r.runtimeAnimatorController)==null?void 0:o.mixer)&&(this.__mixerError=!0,console.error("AnimationTrack mixer is not shared with the animator controller - this might result in the timeline to not animate properly. Please report a bug to the Needle Engine team!",this)),(a=this._animator)!=null&&a.runtimeAnimatorController){const f=Math.max(0,1-g);(c=(l=this._animator)==null?void 0:l.runtimeAnimatorController)==null||c.update(f)}else this.mixer.update(e)}createRotationInterpolant(e,i,s){var r;const o=s.createInterpolant.bind(s),a=new Fe;this.ensureTrackOffsets();const l=(r=this.trackOffset)==null?void 0:r.rotation;s.createInterpolant=()=>{const c=o(),h=c.evaluate.bind(c);return c.evaluate=d=>{var u;const p=h(d);if(a.set(p[0],p[1],p[2],p[3]),a.premultiply(this._totalOffsetRotation),l&&a.premultiply(l),this.director.animationCallbackReceivers)for(const g of this.director.animationCallbackReceivers)(u=g?.onTimelineRotation)==null||u.call(g,this.director,this.target,d,a);return p[0]=a.x,p[1]=a.y,p[2]=a.z,p[3]=a.w,p},c}}createPositionInterpolant(e,i,s){var r,o;const a=s.createInterpolant.bind(s),l=new E;this.ensureTrackOffsets();const c=(r=this.trackOffset)==null?void 0:r.rotation,h=(o=this.trackOffset)==null?void 0:o.position;let d;s.createInterpolant=()=>{const u=a(),p=u.evaluate.bind(u);return u.evaluate=g=>{var f,A,y;const b=p(g);if(l.set(b[0],b[1],b[2]),i.removeStartOffset&&(d===void 0?(d=null,d=(A=(f=this._actionOffsets.find(v=>v.clip===e))==null?void 0:f.rootStartPosition)==null?void 0:A.clone()):d!=null&&d.isVector3&&l.sub(d)),l.applyQuaternion(this._totalOffsetRotation),l.add(this._totalOffsetPosition),c&&l.applyQuaternion(c),h&&(l.x-=h.x,l.y+=h.y,l.z+=h.z),this.director.animationCallbackReceivers)for(const v of this.director.animationCallbackReceivers)(y=v?.onTimelinePosition)==null||y.call(v,this.director,this.target,g,l);return b[0]=l.x,b[1]=l.y,b[2]=l.z,b},u}}}const HNe=q("mutetimeline"),lS=class extends aS{constructor(){super(...arguments),m(this,"models",[]),m(this,"listener"),m(this,"audio",[]),m(this,"audioContextTimeOffset",[]),m(this,"lastTime",0),m(this,"audioSource"),m(this,"_audioLoader",null),m(this,"_playableDirectorResumed",!1)}getAudioFilePath(n){const e=this.director.sourceId;return Sm(e,n)}onAllowAudioChanged(n){for(let e=0;e<this.models.length;e++){const i=this.models[e];this.audio[e].setVolume(n?i.asset.volume:0)}}addModel(n){const e=new YP(this.listener);this.audio.push(e);const i=n;i._didTriggerPlay=!1,this.models.push(i)}onDisable(){for(const n of this.audio)n.isPlaying&&n.stop();for(const n of this.models)n._didTriggerPlay=!1}onDestroy(){for(const n of this.audio)n.source&&n?.disconnect();this.audio.length=0}onMuteChanged(){if(this.muted)for(let n=0;n<this.audio.length;n++){const e=this.audio[n];e!=null&&e.isPlaying&&e.stop()}}stop(){for(let n=0;n<this.audio.length;n++){const e=this.audio[n];e!=null&&e.isPlaying&&e.stop()}for(const n of this.models)n._didTriggerPlay=!1}onPauseChanged(){for(let n=0;n<this.audio.length;n++){const e=this.audio[n];e!=null&&e.isPlaying&&e.stop()}this._playableDirectorResumed=this.director.isPlaying}evaluate(n){if(HNe||this.track.muted||this.director.speed<0)return;const e=this.director.context.application.muted,i=this._playableDirectorResumed;this._playableDirectorResumed=!1;const s=e?.1:0;for(let r=0;r<this.models.length;r++){const o=this.models[r],a=this.audio[r],l=o.asset;if((!a||!a.buffer)&&this.isInTimeRange(o,n-1,n+1)&&this.handleAudioLoading(o,a),vs.userInteractionRegistered!==!1&&!(a===null||!a.buffer))if(a.playbackRate=this.director.context.time.timeScale*this.director.speed,a.loop=l.loop,n>=o.start&&n<=o.end&&n<this.director.duration){if(!a.isPlaying||!this.director.isPlaying)(i||!o._didTriggerPlay&&this.lastTime<n)&&(o.duration*o.timeScale>.3?a.offset=o.clipIn+(n-o.start)*o.timeScale:a.offset=0,zd&&console.log("Timeline Audio ("+this.track.name+") play with offset "+a.offset+" - "+o.asset.clip),a.play(s),o._didTriggerPlay=!0);else{const h=o.clipIn+(n-o.start)*o.timeScale,d=a.context.currentTime-a._startedAt+a.offset;Math.abs(h-d)>.3&&(a.offset=h,a.stop(),a.play(s))}let c=l.volume;if(this.track.volume!==void 0&&(c*=this.track.volume),e&&(c=0),o.easeInDuration>0){const h=Math.min((n-o.start)/o.easeInDuration,1);c*=h}if(o.easeOutDuration>0){const h=Math.min((o.end-n)/o.easeOutDuration,1);c*=h}a.setVolume(c*this.director.weight)}else o._didTriggerPlay=!1,this.director.isPlaying&&a.isPlaying&&a.stop()}this.lastTime=n}loadAudio(n,e=0,i=0){let s=null;const r=n-i,o=n+e;for(const a of this.models)if(this.isInTimeRange(a,r,o)){const l=this.audio[this.models.indexOf(a)],c=this.handleAudioLoading(a,l);c!==null&&(s===null&&(s=[]),s.push(c))}return s!==null?Promise.all(s):null}isInTimeRange(n,e,i){return e<=n.start&&i>=n.end||e>=n.start&&e<=n.end||i>=n.start&&i<=n.end}static dispose(){lS._audioBuffers.clear()}handleAudioLoading(n,e){this._audioLoader||(this._audioLoader=new vT);const i=this.getAudioFilePath(n.asset.clip);if(lS._audioBuffers.get(i)){const r=lS._audioBuffers.get(i);return r.then(o=>{o&&e.setBuffer(o)}),r}zd&&console.warn("LOAD audio track",i,this.director.sourceId);const s=new Promise((r,o)=>{this._audioLoader.load(i,a=>{e.setBuffer(a),r(a)},void 0,a=>{console.error("Error loading audio",a),r(null)})});return lS._audioBuffers.set(i,s),s}};let cS=lS;m(cS,"_audioBuffers",new Map);class hS extends aS{constructor(){super(...arguments),m(this,"models",[]),m(this,"didTrigger",[]),m(this,"receivers",[])}evaluate(e){var i;if(this.track.muted)return;const s=this.director.context.time.deltaTime*1.5;for(let r=0;r<this.models.length;r++){const o=this.models[r],a=this.didTrigger[r],l=o.time-e;let c=!1;if(o.retroActive)c=l<=1e-6;else{const h=Math.abs(l);(h===0||h>=1e-5&&h<s)&&(c=!0)}if(c){if(!a)if(zd&&console.log("Trigger signal",e,o.time,o),this.didTrigger[r]=!0,((i=this.receivers)==null?void 0:i.length)<=0)mv.invoke(o.asset);else for(const h of this.receivers)h&&h.invoke(o.asset)}else o.emitOnce||(this.didTrigger[r]=!1)}}}class EL extends aS{constructor(){super(...arguments),m(this,"models",[]),m(this,"timelines",[]),m(this,"_previousActiveModel",null)}resolveSourceObjects(e){for(let i=this.models.length-1;i>=0;i--){const s=this.models[i].asset;if(!s.sourceObject||typeof s.sourceObject!="object"){console.log("no source object, removing model",i,s),this.models.splice(i,1);continue}else{const r=$.getComponent(s.sourceObject,fg);this.timelines.push(r),r&&s.updateDirector&&(r.playOnAwake=!1)}}}evaluate(e){var i;this._previousActiveModel=null;for(let s=0;s<this.models.length;s++){const r=this.models[s],o=r.asset;if(e>=r.start&&e<=r.end){this._previousActiveModel=r;const a=this.getClipTime(e,r);if(o.controlActivation){const l=o.sourceObject;l.visible=!0}if(o.updateDirector){const l=this.timelines[s];l&&(l.isPlaying&&l.pause(),l.time=a,l.evaluate())}}else{const a=(i=this._previousActiveModel)==null?void 0:i.asset;if(o.controlActivation){const l=o.sourceObject;a?.sourceObject!==l&&(l.visible=!1)}}}}}const QNe=q("debugpost");let bU=null;function KNe(n){bU=n}function hse(n){let e=n.gameObject;for(;e;){for(const i of B2(e))if(i.isPostProcessingManager===!0)return i;e=e.parent}return null}function YNe(n){let e=hse(n);if(!e)if(bU){QNe&&console.warn("Adding postprocessing manager to the scene.");const i=n.scene;e=Ul(i,bU)}else Je()&&console.warn("No post processing manager found");return e}var jNe=Object.defineProperty,JNe=Object.getOwnPropertyDescriptor,dse=(n,e,i,s)=>{for(var r=s>1?void 0:s?JNe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&jNe(e,i,r),r};const qNe=q("debugpost");class at{constructor(e){m(this,"isVolumeParameter",!0),m(this,"_isInitialized",!1),m(this,"_active",!0),m(this,"_value"),m(this,"_valueRaw"),m(this,"_defaultValue"),m(this,"valueProcessor"),m(this,"onValueChanged"),e!==void 0&&this.initialize(e)}get isInitialized(){return this._isInitialized}initialize(e){e!==void 0&&(this._value=e,this._defaultValue=e,this._valueRaw=e,this._isInitialized=!0)}get overrideState(){return this._active}set overrideState(e){if(this._active===e)return;this._active=e;const i=e?this._valueRaw:this._defaultValue;this.processValue(i,!0)}get value(){return this._valueRaw}set value(e){this.isInitialized||this.initialize(e),this.processValue(e,!1)}set defaultValue(e){this._defaultValue=e}__init(){this.processValue(this._valueRaw,!0)}processValue(e,i){if(e==null||!i&&this.testIfValueChanged(e)===!1)return;const s=this._value;qNe&&typeof s=="number"&&typeof e=="number"&&(s?.toFixed(4),e?.toFixed(4)),!this._active&&this._defaultValue!==void 0?(this._value=this._defaultValue,e=this._defaultValue,this._valueRaw=e):(this._valueRaw=e,this._active&&this.valueProcessor&&(e=this.valueProcessor(e)),this._value=e),this.onValueChanged&&this.onValueChanged(e,s,this)}testIfValueChanged(e){return this._valueRaw!==e}}dse([T()],at.prototype,"overrideState",1),dse([T()],at.prototype,"value",1);class $Ne extends Nc{constructor(){super([at])}onSerialize(e,i){}onDeserialize(e,i){const s=i.target,r=i.path;let o;if(s&&r&&(o=s[r]),(typeof o!="object"||typeof o=="object"&&o.isVolumeParameter!==!0)&&(o=new at),typeof e=="object"&&"value"in e){const a=e.value;o.initialize(a),o.overrideState=e.overrideState}else o.value=e;return o}}new $Ne;var eVe=Object.defineProperty,tVe=Object.getOwnPropertyDescriptor,iVe=(n,e,i,s)=>{for(var r=s>1?void 0:s?tVe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&eVe(e,i,r),r};const nVe=q("debugpost");class qr extends Oe{constructor(e=void 0){if(super(),m(this,"active",!0),m(this,"_manager",null),m(this,"_result"),m(this,"_postprocessingContext",null),e)for(const i of Object.keys(e)){const s=e[i],r=this[i];r instanceof at?r.initialize(s):r!==void 0&&(this[i]=s)}}get isPostProcessingEffect(){return!0}onEnable(){super.onEnable(),this.onEffectEnabled(),this.__internalDidAwakeAndStart&&(this.active=!0)}onDisable(){var e;super.onDisable(),(e=this._manager)==null||e.removeEffect(this),this.active=!1}onEffectEnabled(e){var i;e&&e.isPostProcessingManager===!0?this._manager=e:this._manager||(this._manager=YNe(this)),(i=this._manager)==null||i.addEffect(this)}init(){}get postprocessingContext(){return this._postprocessingContext}apply(e){var i;return this._postprocessingContext=e,this._result||(this.initParameters(),this._result=(i=this.onCreateEffect)==null?void 0:i.call(this)),this._result&&this.initParameters(),this._result}unapply(){}dispose(){nVe&&console.warn("DISPOSE",this),this._result&&(Array.isArray(this._result)?this._result.forEach(e=>e.dispose()):this._result.dispose()),this._result=void 0}initParameters(){const e=Object.keys(this);for(const i of e){const s=this[i];s instanceof at&&s.__init()}}onEditorModification(e){const i=e.propertyName;if(this[i]instanceof at){const s=e.value;return this[i].value=s,!0}}}iVe([T()],qr.prototype,"active",2);var sVe=Object.defineProperty,rVe=Object.getOwnPropertyDescriptor,oVe=(n,e,i,s)=>{for(var r=s>1?void 0:s?rVe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&sVe(e,i,r),r};const aVe=q("debugpost"),vU={};function Uc(n,e){vU[n]=e}function lVe(n){return n.__type in vU?vU[n.__type]:(aVe&&n.__type&&console.warn("Unknown postprocessing type",n.__type,n),qr)}class dS{constructor(){m(this,"components",[])}init(){var e;(e=this.components)==null||e.forEach(i=>i.init())}addEffect(e){this.components.push(e)}removeEffect(e){const i=this.components.indexOf(e);i>=0&&this.components.splice(i,1)}}oVe([lv([n=>lVe(n),qr])],dS.prototype,"components",2);var cVe=Object.defineProperty,hVe=Object.getOwnPropertyDescriptor,dVe=(n,e,i,s)=>{for(var r=s>1?void 0:s?hVe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&cVe(e,i,r),r};class uS extends qr{constructor(){super(...arguments),m(this,"preset",new at(u0.HIGH))}get typeName(){return"Antialiasing"}onCreateEffect(){const e=new l7({preset:u0.HIGH,edgeDetectionMode:_D.DEPTH});return this.preset.onValueChanged=i=>{e.applyPreset(i)},e}}dVe([T(at)],uS.prototype,"preset",2),Uc("Antialiasing",uS);const uVe=q("debugusdz");class Jg{constructor(){m(this,"files",new Array)}static getName(e){var i;const s=e.split(".").pop();let r=(i=e.split(".").slice(0,-1).join(".").split("/").pop())==null?void 0:i.replace(".","_");return r||(r="Audio_"+Math.random().toString(36).substring(2,15)),Xh(r)+"."+s}get extensionName(){return"Audio"}onExportObject(e,i,s){const r=$.getComponents(e,vs);if(r.length)for(const o of r){if(!o.clip||typeof o.clip!="string"||!o.playOnAwake)continue;const a=o.clip.split("/").pop()||"Audio",l=Jg.getName(o.clip),c=Xh(l);if(!this.files.some(h=>h.path===o.clip)){this.files.push({path:o.clip,name:l});const h=l.toLowerCase();s.quickLookCompatible&&!h.endsWith(".mp3")&&!h.endsWith(".wav")&&!h.endsWith(".m4a")&&console.error("Audio file "+o.clip+" from "+o.name+" is not an MP3 or WAV file. QuickLook may not support playing it.")}s.quickLookCompatible||i.addEventListener("serialize",(h,d)=>{h.appendLine(),h.beginBlock(`def SpatialAudio "${c}"`,"(",!1),h.appendLine(`displayName = "${a}"`),h.closeBlock(")"),h.beginBlock(),h.appendLine(`uniform asset filePath = @audio/${l}@`),h.appendLine(`uniform token auralMode = "${o.spatialBlend>0?"spatial":"nonSpatial"}"`),h.appendLine(`uniform token playbackMode = "${o.loop?"loopFromStage":"onceFromStart"}"`),h.appendLine(`uniform float gain = ${o.volume}`),h.closeBlock()})}}async onAfterSerialize(e){for(const i of this.files){const s="audio/"+i.name;if(e.files[s]){uVe&&console.warn("Audio file with name "+s+" already exists in the context. Skipping.");continue}const r=await(await(await fetch(i.path)).blob()).arrayBuffer(),o=new Uint8Array(r);e.files[s]=o}}}const gp=q("debugautosync"),xU=Symbol("syncerId");class pVe{constructor(){m(this,"_syncers",{})}getOrCreateSyncer(e){if(!e.guid)return null;if(this._syncers[e.guid])return this._syncers[e.guid];const i=new mVe(e);return i[xU]=e.guid,this._syncers[i[xU]]=i,i}removeSyncer(e){delete this._syncers[e[xU]]}}const wU=new pVe;class mVe{constructor(e){m(this,"comp"),m(this,"hasChanges",!1),m(this,"changedProperties",{}),m(this,"_isReceiving",!1),m(this,"_isInit",!1),m(this,"onHandleSending",()=>{if(!this.hasChanges)return;this.hasChanges=!1;const i=this.comp.context.connection;if(!i||!i.isConnected||!i.isInRoom){for(const s in this.changedProperties)delete this.changedProperties[s];return}for(const s in this.changedProperties){const r=this.comp.guid+"/"+s,o=this.changedProperties[s];gp&&console.log("SEND",this.comp.name,this.networkingKey),i.send(this.networkingKey,{guid:r,data:o},Bh.Queued)}}),m(this,"onHandleReceiving",i=>{if(gp&&console.log("RECEIVE",this.comp.name,this.comp.guid,i),!this._isInit||!this.comp||i.guid.startsWith(this.comp.guid)===!1)return;const[s,r]=i.guid.split("/");gp&&console.log("RECEIVED",this.comp.name,this.comp.guid,i);try{this._isReceiving=!0,this.comp[r]=i.data}catch(o){console.error(o)}finally{this._isReceiving=!1}}),this.comp=e}get networkingKey(){return this.comp.guid}init(e){if(this._isInit)return;this._isInit=!0,this.comp=e,this.comp.context.post_render_callbacks.push(this.onHandleSending),this.comp.context.connection.beginListen(this.networkingKey,this.onHandleReceiving);const i=this.comp.context.connection.tryGetState(this.comp.guid);i&&this.onHandleReceiving(i)}destroy(){this._isInit&&(this.comp.context.post_render_callbacks.splice(this.comp.context.post_render_callbacks.indexOf(this.onHandleSending),1),this.comp.context.connection.stopListen(this.networkingKey,this.onHandleReceiving),this.comp=null,this._isInit=!1)}notifyChanged(e,i){this._isReceiving||(gp&&console.log("Property changed: "+e,i),this.hasChanges=!0,this.changedProperties[e]=i)}}function gVe(n,e){let i=e!==n;return!i&&n&&e&&(Array.isArray(n)&&Array.isArray(e)||typeof n=="object"&&typeof e=="object")&&(i=!0),i}const pS=Symbol("AutoSyncHandler");function fVe(n){if(n[pS])return n[pS];const e=wU.getOrCreateSyncer(n);return e?.init(n),n[pS]=e,e}function AVe(n){const e=n[pS];e&&(wU.removeSyncer(e),e.destroy(),delete n[pS])}const CU=function(n=null){return function(e,i){var s;let r="";typeof i=="string"?r=i:r=i.name;let o=null,a;typeof n=="string"?a=e[n]:typeof n=="function"&&(a=n),a==null&&(Je()||gp)&&n!=null&&console.warn('syncField: no callback function found for property "'+r+'"','"'+n+'"');const l=e,c=l.__internalAwake;if(typeof c!="function"){(gp||Je())&&console.error('@syncField can currently only used on Needle Engine Components, custom object of type "'+((s=e?.constructor)==null?void 0:s.name)+'" is not supported',e);return}gp&&console.log(r);const h=Symbol(r);l.__internalAwake=function(){if(this[h]!==void 0)return;this[h]=this[r],o=wU.getOrCreateSyncer(this);const u=Object.getOwnPropertyDescriptor(this,r);if(u?.set===void 0){let p=!1;Object.defineProperty(this,r,{set:function(g){var f;const A=this[h];if(this[h]=g,p){(Je()||gp)&&console.warn("Recursive call detected",r);return}p=!0;try{const y=gVe(g,A);gp&&console.log("SyncField assignment",r,"changed?",y,g,a),y&&a?.call(this,g,A)!==!1&&((f=fVe(this))==null||f.notifyChanged(r,g))}finally{p=!1}},get:function(){return this[h]},configurable:!0,enumerable:!0})}o?.init(this),c.call(this)};const d=l.__internalDestroy;l.__internalDestroy=function(){AVe(this),d.call(this)}}};var yVe=Object.defineProperty,bVe=Object.getOwnPropertyDescriptor,RL=(n,e,i,s)=>{for(var r=s>1?void 0:s?bVe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&yVe(e,i,r),r};const Yl=q("debugplayersync"),use=class extends Oe{constructor(){super(...arguments),m(this,"autoSync",!0),m(this,"asset"),m(this,"onPlayerSpawned"),m(this,"_localInstance"),m(this,"onJoinedRoom",()=>{Yl&&console.log("PlayerSync.joinedRoom. autoSync is set to "+this.autoSync),this.autoSync&&this.getInstance()}),m(this,"destroyInstance",()=>{var n;(n=this._localInstance)==null||n.then(e=>{Yl&&console.log("PlayerSync.destroyInstance",e),SC(e,this.context.connection,!0,{saveInRoom:!1})}),this._localInstance=void 0})}static async setupFrom(n,e){const i=Mi.getOrCreateFromUrl(n);if(!i.asset){const o=await i.loadAssetAsync();$.getOrAddComponent(o,jl)}const s=new use;s._internalInit(e),s.asset=i;const r=new Ae;return r.guid=n,$.addComponent(r,s),s}awake(){this.watchTabVisible(),this.onPlayerSpawned||(this.onPlayerSpawned=new Gn)}onEnable(){this.context.connection.beginListen(pi.RoomStateSent,this.onJoinedRoom),this.context.connection.beginListen(pi.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(pi.LeftRoom,this.destroyInstance),this.context.connection.isInRoom&&this.onJoinedRoom()}onDisable(){this.context.connection.stopListen(pi.RoomStateSent,this.onJoinedRoom),this.context.connection.stopListen(pi.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(pi.LeftRoom,this.destroyInstance)}async getInstance(){var n,e,i,s,r,o;if(this._localInstance)return this._localInstance;if(Yl&&console.log("PlayerSync.createInstance",(n=this.asset)==null?void 0:n.url),!((e=this.asset)!=null&&e.asset)&&!((i=this.asset)!=null&&i.url))return console.error('PlayerSync: can not create an instance because "asset" is not set and or has no URL!'),null;this.gameObject.guid||console.warn("PlayerSync: gameObject has no guid! This might cause issues with syncing the player state."),this._localInstance=(s=this.asset)==null?void 0:s.instantiateSynced({parent:this.gameObject,deleteOnDisconnect:!0},!0);const a=await this._localInstance;if(a){const l=$.getComponentsInChildren(a,jl);if(l!=null&&l.length){for(const c of l)c.owner=this.context.connection.connectionId;(r=this.onPlayerSpawned)==null||r.invoke(a)}else this._localInstance=void 0,console.error("<strong>Failed finding PlayerState on "+((o=this.asset)==null?void 0:o.url)+"</strong>: please make sure the asset has a PlayerState component!"),$.destroySynced(a)}else this._localInstance=void 0,console.warn("PlayerSync: failed instantiating asset!");return this._localInstance}watchTabVisible(){window.addEventListener("visibilitychange",n=>{if(document.visibilityState==="visible")for(let e=jl.all.length-1;e>=0;e--){const i=jl.all[e];(!i.owner||!this.context.connection.userIsInRoom(i.owner))&&i.doDestroy()}})}};let gv=use;RL([T()],gv.prototype,"autoSync",2),RL([T(Mi)],gv.prototype,"asset",2),RL([T(Gn)],gv.prototype,"onPlayerSpawned",2);var pse=(n=>(n.OwnerChanged="ownerChanged",n))(pse||{}),mS;const To=(mS=class extends Oe{constructor(){super(...arguments),m(this,"onOwnerChangeEvent",new Gn),m(this,"onFirstOwnerChangeEvent",new Gn),m(this,"hasOwner",!1),m(this,"owner"),m(this,"dontDestroy",!1),m(this,"onUserLeftRoom",n=>{if(n.userId===this.owner){Yl&&console.log("PLAYERSYNC LEFT",this.owner),this.doDestroy();return}})}static get all(){return To._all}static get local(){return To._local}static getFor(n){if(n instanceof Ae)return $.getComponentInParent(n,To);if(n instanceof Oe)return $.getComponentInParent(n.gameObject,To)}static isLocalPlayer(n){const e=To.getFor(n);return e?.isLocalPlayer??!1}static addEventListener(n,e){return this._callbacks[n]||(this._callbacks[n]=[]),this._callbacks[n].push(e),e}static removeEventListener(n,e){if(!this._callbacks[n])return;const i=this._callbacks[n].indexOf(e);i>=0&&this._callbacks[n].splice(i,1)}static dispatchEvent(n,e){if(this._callbacks[n])for(const i of this._callbacks[n])i(e)}get isLocalPlayer(){return this.owner===this.context.connection.connectionId}onOwnerChange(n,e){var i,s;Yl&&console.log("PlayerSync.onOwnerChange",this,"newOwner",n,"oldOwner",e);const r=To._local.indexOf(this);r>=0&&To._local.splice(r,1);const o={playerState:this,oldValue:e,newValue:n};if(this.hasOwner||(this.hasOwner=!0,(i=this.onFirstOwnerChangeEvent)==null||i.invoke(o)),(s=this.onOwnerChangeEvent)==null||s.invoke(o),this.owner===this.context.connection.connectionId){To._local.push(this);const l=new CustomEvent("local-owner-changed",{detail:o});this.dispatchEvent(l)}const a=new CustomEvent("owner-changed",{detail:o});this.dispatchEvent(a),To.dispatchEvent("ownerChanged",a)}awake(){To.all.push(this),Yl&&console.log("Registered new PlayerState",this.guid,To.all.length-1,To.all),this.context.connection.beginListen(pi.UserLeftRoom,this.onUserLeftRoom)}async start(){Yl&&console.log("PLAYERSTATE.START, owner: "+this.owner,this.context.connection.usersInRoom([])),this.owner?(this.context.connection.isInRoom||await Ah(300),this.context.connection.userIsInRoom(this.owner)==!1&&(Yl&&console.log(`PlayerSync.start \u2192 doDestroy "${this.name}" because user "${this.owner}" is not in room anymore...`,"Currently in room:",...this.context.connection.usersInRoom()),this.doDestroy())):this.owner||(Yl&&console.warn("PlayerState.start \u2192 owner is undefined!",this.name),setTimeout(()=>{!this.destroyed&&!this.owner?this.dontDestroy?Yl&&console.warn("PlayerState.start \u2192 owner is still undefined but dontDestroy is set to true",this.name):(Yl&&console.warn(`PlayerState.start \u2192 owner is still undefined: destroying "${this.name}" instance now`),this.doDestroy()):Yl&&console.log("PlayerState.start \u2192 owner is assigned",this.owner)},2e3))}doDestroy(){Yl&&console.log("PlayerSync.doDestroy \u2192 syncDestroy",this.name),SC(this.gameObject,this.context.connection,!0,{saveInRoom:!1})}onDestroy(){if(this.context.connection.stopListen(pi.UserLeftRoom,this.onUserLeftRoom),To.all.splice(To.all.indexOf(this),1),this.isLocalPlayer){const n=To._local.indexOf(this);n>=0&&To._local.splice(n,1)}}},m(mS,"_all",[]),m(mS,"_local",[]),m(mS,"_callbacks",{}),mS);let jl=To;RL([CU(jl.prototype.onOwnerChange)],jl.prototype,"owner",2);const vVe=q("debugavatar"),Fd=class extends Oe{constructor(){super(...arguments),m(this,"connectionId"),m(this,"avatar")}static getAvatar(n){return n>=0&&n<Fd.instances.length?Fd.instances[n]:null}static onAvatarMarkerCreated(n){return Fd._onNewAvatarMarkerAdded.push(n),n}static onAvatarMarkerDestroyed(n){return Fd._onAvatarMarkerDestroyed.push(n),n}awake(){Fd.instances.push(this),vVe&&console.log(this);for(const n of Fd._onNewAvatarMarkerAdded)n({avatarMarker:this,gameObject:this.gameObject})}onDestroy(){Fd.instances.splice(Fd.instances.indexOf(this),1);for(const n of Fd._onAvatarMarkerDestroyed)n({avatarMarker:this,gameObject:this.gameObject})}isLocalAvatar(){return this.connectionId===this.context.connection.connectionId}};let Eo=Fd;m(Eo,"instances",[]),m(Eo,"_onNewAvatarMarkerAdded",[]),m(Eo,"_onAvatarMarkerDestroyed",[]);var xVe=Object.defineProperty,wVe=Object.getOwnPropertyDescriptor,CVe=(n,e,i,s)=>{for(var r=s>1?void 0:s?wVe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&xVe(e,i,r),r};const fv=q("debugxrflags"),mse=q("disablexrflags");mse&&console.warn("XRFlags are disabled");var Ud=(n=>(n[n.Never=0]="Never",n[n.Browser=1]="Browser",n[n.AR=2]="AR",n[n.VR=4]="VR",n[n.FirstPerson=8]="FirstPerson",n[n.ThirdPerson=16]="ThirdPerson",n[n.All=4294967295]="All",n))(Ud||{});const gse=class{constructor(){m(this,"Mask",17)}Has(n){return(this.Mask&n)!==0}Set(n){fv&&console.warn("Set XR flag state to",n),this.Mask=n,Jl.Apply()}Enable(n){this.Mask|=n,Jl.Apply()}Disable(n){this.Mask&=~n,Jl.Apply()}Toggle(n){this.Mask^=n,Jl.Apply()}EnableAll(){this.Mask=-1,Jl.Apply()}DisableAll(){this.Mask=0,Jl.Apply()}};let Xa=gse;m(Xa,"Global",new gse);var gS;const fp=(gS=class extends Oe{constructor(){super(...arguments),m(this,"visibleIn")}static Apply(){for(const n of this.registry)n.UpdateVisible(Xa.Global)}awake(){fp.registry.push(this)}onEnable(){fp.firstApply?this.UpdateVisible(Xa.Global):(fp.firstApply=!0,fp.Apply())}onDestroy(){const n=fp.registry.indexOf(this);n>=0&&fp.registry.splice(n,1)}get isOn(){return this.gameObject.visible}UpdateVisible(n=null){if(mse)return;let e;const i=n;if(i&&typeof i=="number"&&(console.assert(typeof i=="number","XRFlag.UpdateVisible: state must be a number",i),fv&&console.log(i),fp.buffer.Mask=i,n=fp.buffer),n instanceof Xa?(fv&&console.warn(this.name,"use passed in mask",n.Mask,this.visibleIn),e=n.Has(this.visibleIn)):(fv&&console.log(this.name,"use global mask"),Xa.Global.Has(this.visibleIn)),e!==void 0)if(e)fv&&console.log(this.name,"is visible",this.gameObject.uuid),$.setActive(this.gameObject,!0);else{if(fv&&console.log(this.name,"is not visible",this.gameObject.uuid),!this.gameObject.visible)return;this.gameObject.visible=!1}}},m(gS,"registry",[]),m(gS,"firstApply"),m(gS,"buffer",new Xa),gS);let Jl=fp;CVe([T()],Jl.prototype,"visibleIn",2);var SVe=Object.defineProperty,_Ve=Object.getOwnPropertyDescriptor,SU=(n,e,i,s)=>{for(var r=s>1?void 0:s?_Ve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&SVe(e,i,r),r};const fS=q("debugwebxr"),fse=new Fe().setFromAxisAngle(new E(0,1,0),Math.PI);class Ag extends Oe{constructor(){super(...arguments),m(this,"head"),m(this,"leftHand"),m(this,"rightHand"),m(this,"_leftHandMeshes"),m(this,"_rightHandMeshes"),m(this,"_syncTransforms")}async onEnterXR(e){if(!this.activeAndEnabled)return;fS&&console.warn("AVATAR ENTER XR",this.guid,this.sourceId,this,this.activeAndEnabled),this._syncTransforms&&(this._syncTransforms.length=0),await this.prepareAvatar();const i=jl.getFor(this);if(i!=null&&i.owner){const s=this.gameObject.addComponent(Eo);s.avatar=this.gameObject,s.connectionId=i.owner}else this.context.connection.isConnected?console.error("No player state found for avatar",this):i&&!this.context.connection.isConnected&&(i.dontDestroy=!0)}onLeaveXR(e){const i=this.gameObject.getComponent(Eo);i&&i.destroy()}onUpdateXR(e){var i,s;if(!this.activeAndEnabled)return;const r=jl.isLocalPlayer(this);if(!r)return;const o=e.xr;if(o.rig&&o.rig.gameObject!==this.gameObject.parent&&(this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),this.gameObject.scale.set(1,1,1),o.rig.gameObject.add(this.gameObject)),this._syncTransforms&&r)for(const d of this._syncTransforms)d.fastMode=!0,d.isOwned()||d.requestOwnership();if(this.head&&this.context.mainCamera){const d=this.head.asset;if(d.position.copy(this.context.mainCamera.position),d.position.x*=-1,d.position.z*=-1,d.quaternion.copy(this.context.mainCamera.quaternion),d.quaternion.x*=-1,this.context.time.frameCount%10===0){const u=$.getComponentsInChildren(this.head.asset,Jl);for(const p of u)p.enabled=!1,p.gameObject.visible=!1}}const a=e.xr.leftController,l=(i=this.leftHand)==null?void 0:i.asset;a&&l?(l.position.copy(a.gripPosition),l.quaternion.copy(a.gripQuaternion),l.quaternion.multiply(fse),l.visible=a.isTracking,this.updateHandVisibility(a,l,this._leftHandMeshes)):l&&l.visible&&(l.visible=!1);const c=e.xr.rightController,h=(s=this.rightHand)==null?void 0:s.asset;c&&h?(h.position.copy(c.gripPosition),h.quaternion.copy(c.gripQuaternion),h.quaternion.multiply(fse),h.visible=c.isTracking,this.updateHandVisibility(c,h,this._rightHandMeshes)):h&&h.visible&&(h.visible=!1)}onBeforeRender(){this.context.xr&&this.context.time.frame%10===0&&this.updateRemoteAvatarVisibility()}updateHandVisibility(e,i,s){if(s){const r=e.model&&e.model.visible&&e.model!==i;s.forEach(o=>{rp(o,!r)})}}updateRemoteAvatarVisibility(){var e,i,s;if(this.context.connection.isConnected){const r=jl.getFor(this);if(r&&r.isLocalPlayer==!1){const o=Qt.getXRSync(this.context);if(o&&o.hasState(r.owner)){this.tryFindAvatarObjectsIfMissing();const a=(e=this.leftHand)==null?void 0:e.asset;a&&(a.visible=o?.isTracking(r.owner,"left")??!1);const l=(i=this.rightHand)==null?void 0:i.asset;l&&(l.visible=o?.isTracking(r.owner,"right")??!1)}if((s=this.head)!=null&&s.asset){const a=$.getComponentsInChildren(this.head.asset,Jl);for(const l of a)l.enabled=!1,l.gameObject.visible=!0}}}}tryFindAvatarObjectsIfMissing(){if(!this.head||!this.leftHand||!this.rightHand){const e={head:this.head,leftHand:this.leftHand,rightHand:this.rightHand};ote.tryFindAvatarObjects(this.gameObject,this.sourceId||"",e),e.head&&(this.head=e.head),e.leftHand&&(this.leftHand=e.leftHand),e.rightHand&&(this.rightHand=e.rightHand)}}async prepareAvatar(){if(this.tryFindAvatarObjectsIfMissing(),this.head)this.head instanceof Ae&&(this.head=new Mi("",this.sourceId,this.head));else{const e=new Ae;e.name="Head";const i=Ym.createPrimitive(M0.Cube);e.add(i),this.gameObject.add(e),this.head=new Mi("",this.sourceId,e),fS&&console.log("Create head",e)}if(this.rightHand)this.rightHand instanceof Ae&&(this.rightHand=new Mi("",this.sourceId,this.rightHand));else{const e=new Ae;e.name="Right Hand",this.gameObject.add(e),this.rightHand=new Mi("",this.sourceId,e),fS&&console.log("Create right hand",e)}if(this.leftHand)this.leftHand instanceof Ae&&(this.leftHand=new Mi("",this.sourceId,this.leftHand));else{const e=new Ae;e.name="Left Hand",this.gameObject.add(e),this.leftHand=new Mi("",this.sourceId,e),fS&&console.log("Create left hand",e)}await this.loadAvatarObjects(this.head,this.leftHand,this.rightHand),this._leftHandMeshes=[],this.leftHand.asset.traverse(e=>{e!=null&&e.isMesh&&this._leftHandMeshes.push(e)}),this._rightHandMeshes=[],this.rightHand.asset.traverse(e=>{e!=null&&e.isMesh&&this._rightHandMeshes.push(e)}),jl.isLocalPlayer(this.gameObject)&&(this._syncTransforms=$.getComponentsInChildren(this.gameObject,Vd))}async loadAvatarObjects(e,i,s){const r=e.loadAssetAsync(),o=i.loadAssetAsync(),a=s.loadAssetAsync(),l=new Array;r&&l.push(r),o&&l.push(o),a&&l.push(a);const c=await kE(l);fS&&console.log("Avatar loaded results:",c)}}SU([T(Mi)],Ag.prototype,"head",2),SU([T(Mi)],Ag.prototype,"leftHand",2),SU([T(Mi)],Ag.prototype,"rightHand",2);class Od{static Add(e,i,s=null){if(i){for(const r of this.Pois)if(r.obj===i)return;this.Pois.push({obj:i,avatar:s}),this.LastChangeTime=e.time.time}}static Remove(e,i){var s;if(i){for(const r of this.Pois)if(r.obj===i){this.Pois.splice(this.Pois.indexOf(r),1),this.LastChangeTime=e?.time.time??((s=$t.Current)==null?void 0:s.time.time);return}}}}m(Od,"Pois",[]),m(Od,"LastChangeTime",0);class MVe{constructor(){m(this,"guid"),m(this,"position",new E)}}class AS extends Oe{constructor(){super(...arguments),m(this,"target",null),m(this,"avatar",null),m(this,"_model",null),m(this,"_targetModel",new MVe),m(this,"_currentTargetObject",null),m(this,"_lastUpdateTime",0),m(this,"_lookDuration",0),m(this,"_lastPoiChangedTime",0)}set controlledTarget(e){this.target=e;const i=Y.get("MoveRandom");if(i&&this.target){const s=$.getComponent(this.target,i);s&&s.destroy()}}awake(){if(this.avatar=$.getComponentInParent(this.gameObject,Eo),this.avatar){const e=$.getComponentInParent(this.gameObject,Eo);this._model=new gz(this.context.connection,this.guid),e!=null&&e.isLocalAvatar&&this._model.requestOwnership()}this.context.connection.beginListen("avatar-look-target-changed",e=>{var i;this.target&&e&&e.guid===((i=this.avatar)==null?void 0:i.guid)&&Cr(this.target,e.position)})}update(){var e;if((!this.context.connection.isConnected||(e=this._model)!=null&&e.hasOwnership)&&(Od.LastChangeTime!==this._lastPoiChangedTime&&(this._lastPoiChangedTime=Od.LastChangeTime,this._lookDuration=0),this.selectTarget(),this._currentTargetObject&&this.context.time.frameCount%10===0&&this.target)){const i=ri(this._currentTargetObject);Cr(this.target,i),this.context.connection.isConnected&&this.avatar&&(this.context.connection.send("avatar-look-target-changed",this._targetModel),this._targetModel.guid=this.avatar.guid,this._targetModel.position.copy(i))}}selectTarget(){if(this.context.time.time-this._lastUpdateTime>this._lookDuration){this._lastUpdateTime=this.context.time.time,this._lookDuration=Math.random()*.5+.2;const e=Od.Pois;if(e.length>0){const i=e[Math.floor(Math.random()*e.length)];if(i&&i.obj){if(i.avatar&&i.avatar===this.avatar)return;this._currentTargetObject=i.obj}}}}}function Ase(n){return n&&n.isComponent}const IVe=Symbol("object"),_U=new El(()=>new E,20);class yse{constructor(e,i,s,r,o,a){m(this,"_point"),m(this,"_normal"),m(this,"_tangentVelocity"),m(this,"distance"),m(this,"impulse"),m(this,"friction"),this._point=e,this.distance=i,this._normal=s,this.impulse=r,this.friction=o,this._tangentVelocity=a}get point(){return _U.get().set(this._point.x,this._point.y,this._point.z)}get normal(){return _U.get().set(this._normal.x,this._normal.y,this._normal.z)}get tangentVelocity(){return _U.get().set(this._tangentVelocity.x,this._tangentVelocity.y,this._tangentVelocity.z)}}class bse{constructor(e,i,s){m(this,"contacts"),m(this,"me"),m(this,"_collider"),m(this,"_gameObject"),this.me=e,this._collider=i,this._gameObject=i.gameObject,this.contacts=s}get collider(){return this._collider}get gameObject(){return this._gameObject}get rigidBody(){var e;return(e=this.collider)==null?void 0:e.attachedRigidbody}}class vse{constructor(e,i){m(this,"object"),m(this,"collider"),this.object=e,this.collider=i}}const Ks=q("debugnetworkingstreams");var Zd=(n=>(n.Connected="peer-user-connected",n.StreamReceived="receive-stream",n.StreamEnded="call-ended",n.Disconnected="peer-user-disconnected",n.UserJoined="user-joined",n))(Zd||{});class MU{constructor(e,i){m(this,"type","call-ended"),m(this,"userId"),m(this,"direction"),this.userId=e,this.direction=i}}class xse{constructor(e,i,s){m(this,"type","receive-stream"),m(this,"userId"),m(this,"stream"),m(this,"target"),this.userId=e,this.stream=i,this.target=s}}class TVe{constructor(e,i){m(this,"guid"),m(this,"peerId"),m(this,"dontSave",!0),this.guid=e.id,this.peerId=i}}var wse=(n=>(n.Incoming="incoming",n.Outgoing="outgoing",n))(wse||{});class EVe extends yr{constructor(e,i,s,r=null){super(),m(this,"peerId"),m(this,"userId"),m(this,"direction"),m(this,"call"),m(this,"_stream",null),m(this,"_isDisposed",!1),this.peerId=i.peer,this.userId=e,this.call=i,this.direction=s,this._stream=r,i.on("stream",o=>{if(Ks&&console.log("Receive stream",`
Audio:`,o.getAudioTracks(),`
Video:`,o.getVideoTracks()),this._stream=o,s==="incoming"){const a=new xse(e,o,this);this.dispatchEvent(a)}}),i.on("close",()=>{this.dispatchEvent(new MU(e,s))})}get stream(){return this._stream}close(){this._isDisposed||(this._isDisposed=!0,this.call.close(),Wd(this._stream))}get isOpen(){var e;return((e=this.call.peerConnection)==null?void 0:e.connectionState)==="connected"}get isOpening(){var e;return((e=this.call.peerConnection)==null?void 0:e.connectionState)==="connecting"}get isClosed(){return!this.isOpen||this._isDisposed}}function Cse(n){return n=n.replace("a=fmtp:111 minptime=10;useinbandfec=1","a=fmtp:111 ptime=5;useinbandfec=1;stereo=1;maxplaybackrate=48000;maxaveragebitrat=128000;sprop-stereo=1"),n}const yS=class extends yr{constructor(n,e){super(),m(this,"updateCalls",()=>{var i;for(let s=this._incomingCalls.length-1;s>=0;s--){const r=this._incomingCalls[s];r.isClosed&&!r.isOpening&&this._incomingCalls.splice(s,1)}for(let s=this._outgoingCalls.length-1;s>=0;s--){const r=this._outgoingCalls[s];let o=!1;r.isClosed&&!r.isOpening&&((i=r.stream)!=null&&i.active?Ks&&console.warn("!!! Stream is still active, don't remove call",r.userId,"Your id: "+this.context.connection.connectionId):(Ks&&console.warn("!!! Remove closed call",r.userId),o=!0)),this.context.connection.userIsInRoom(r.userId)===!1&&(Ks&&console.warn("!!! User is not in room anymore, remove call",r.userId),o=!0),o&&(r.close(),this._outgoingCalls.splice(s,1))}}),m(this,"id"),m(this,"context"),m(this,"_incomingCalls",[]),m(this,"_outgoingCalls",[]),m(this,"_peer"),m(this,"_enabled",!1),m(this,"_enabledPeer",!1),m(this,"onConnectRoomFn",this.onConnectRoom.bind(this)),m(this,"onPeerConnect",i=>{if(Ks&&console.log("PEER opened as",i),i===null){console.error("Peer connection failed",i);return}this.context.connection.send("peer-user-connected",new TVe(this,i))}),m(this,"onPeerClose",()=>{Ks&&console.log("PEER closed"),this.updateCalls()}),m(this,"onPeerDisconnected",()=>{Ks&&console.log("PEER disconnected"),this.updateCalls()}),m(this,"onPeerError",i=>{Ks&&console.error("PEER error",i)}),m(this,"onPeerReceivingCall",i=>{i.answer(void 0,{sdpTransform:s=>Cse(s)}),this.registerCall(i,"incoming",null)}),this.context=n,this.id=e,this.setupPeer(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}static getOrCreate(n,e){if(yS.instances.has(e))return yS.instances.get(e);const i=new yS(n,e);return yS.instances.set(e,i),i}getMyPeerId(){if(this.context.connection.connectionId)return this.getPeerIdFromUserId(this.context.connection.connectionId)}getPeerIdFromUserId(n){return this.id+"-"+n}getUserIdFromPeerId(n){return n.substring(this.id.length+1)}makeCall(n,e){var i;if(!(e!=null&&e.id)){Ks?console.warn("Can not make a call: mediastream has no id or is undefined"):console.debug("Can not make a call: mediastream has no id or is undefined");return}const s={metadata:{userId:this.context.connection.connectionId,streamId:e.id},sdpTransform:o=>Cse(o)},r=(i=this._peer)==null?void 0:i.call(n,e,s);if(r){const o=this.registerCall(r,"outgoing",e);return Ks&&console.warn(`\u{1F4DE} CALL ${n}`,`
Outgoing:`,this._outgoingCalls,`
Incoming:`,this._incomingCalls),o}else Ks&&console.error("Failed to make call",n,e,this._peer)}closeAll(){for(const n of this._incomingCalls)n.close();for(const n of this._outgoingCalls)n.close();this.updateCalls()}get peer(){return this._peer}get incomingCalls(){return this._incomingCalls}enable(){this._enabled||(this._enabled=!0,this.context.connection.beginListen(pi.JoinedRoom,this.onConnectRoomFn),this.subscribePeerEvents())}disable(){this._enabled&&(this._enabled=!1,this.context.connection.stopListen(pi.JoinedRoom,this.onConnectRoomFn),this.unsubscribePeerEvents())}onConnectRoom(){this.setupPeer()}setupPeer(){if(this.context.connection.connectionId&&!this._enabledPeer){if(this._enabledPeer=!0,!this._peer){const n=this.getMyPeerId();n?this._peer=Nee(n):console.error("Failed to setup peerjs because we dont have a connection id",this.context.connection.connectionId)}this._enabled&&this.subscribePeerEvents()}}subscribePeerEvents(){this._peer&&(this._peer.on("open",this.onPeerConnect),this._peer.on("close",this.onPeerClose),this._peer.on("call",this.onPeerReceivingCall),this._peer.on("disconnected",this.onPeerDisconnected),this._peer.on("error",this.onPeerError))}unsubscribePeerEvents(){this._peer&&(this._peer.off("open",this.onPeerConnect),this._peer.off("close",this.onPeerClose),this._peer.off("call",this.onPeerReceivingCall),this._peer.off("disconnected",this.onPeerDisconnected),this._peer.off("error",this.onPeerError))}registerCall(n,e,i){const s=n.metadata;(!s||!s.userId)&&console.error("Missing call metadata",n);const r=s.userId;e==="incoming"&&Ks?console.warn("\u2190 Receive call from",n.metadata,n.connectionId):Ks&&console.warn("\u2192 Make call to",n.metadata);const o=e==="incoming"?this._incomingCalls:this._outgoingCalls,a=new EVe(r,n,e,i);return o.push(a),n.on("error",l=>{console.error("Call error",l)}),n.on("close",()=>{Ks&&console.log("Call ended",n.metadata);const l=o.indexOf(a);l!==-1&&o.splice(l,1),a.close(),this.dispatchEvent(new MU(r,e))}),a.addEventListener("call-ended",l=>{this.dispatchEvent(l)}),e==="incoming"&&(a.addEventListener("receive-stream",l=>{this.dispatchEvent(l)}),n.on("stream",()=>{Ks&&console.log("Received stream for call",n.metadata);let l=0;const c=setInterval(()=>{const h=l===0;!a.isOpen&&h&&(Ks&&console.warn("Close call because stream is not active",n.metadata),l+=1,clearInterval(c),a.close())},2e3)})),a}};let bS=yS;m(bS,"instances",new Map);class eM extends yr{constructor(e,i){if(super(),m(this,"context"),m(this,"peer"),m(this,"_sendingStreams",new Map),m(this,"debug",!1),m(this,"_enabled",!1),m(this,"_tickIntervalId"),m(this,"tick",()=>{this.updateSendingCalls()}),m(this,"onJoinedRoom",s=>{this._sendingStreams.size>0&&(this.debug&&console.warn(`${s!=null&&s.userId?`User ${s.userId}`:"You"} joined room`,s,this._sendingStreams.size),this.updateSendingCalls())}),m(this,"onLeftRoom",s=>{this.debug&&console.warn(`${s?.userId||"You"} left room`,s),this.stopCallsToUsersThatAreNotInTheRoomAnymore(),this.peer.closeAll()}),m(this,"onCallStreamReceived",s=>{this.debug&&console.log("Call with "+s.userId+" started"),this.dispatchEvent({type:"receive-stream",target:this,stream:s.stream,userId:s.userId}),this.debug&&this.debugLogCurrentState()}),m(this,"onCallEnded",s=>{this.debug&&console.log("Call with "+s.userId+" ended"),this.dispatchEvent(s),this.debug&&this.debugLogCurrentState()}),m(this,"onUserConnected",s=>{if(this.peer.id===s.guid){this.debug&&console.log("PEER USER CONNECTED",s.guid,s,this._sendingStreams.size);const r=this._sendingStreams.keys().next().value;this.peer.makeCall(s.peerId,r)}else Ks&&console.log("Unknown user connected",s.guid,s.peerId)}),m(this,"onUserLeft",s=>{this.debug&&console.log("User left room: "+s.userId),this.stopCallsToUsersThatAreNotInTheRoomAnymore()}),Ase(e)){const s=e;e=s.context,i=bS.getOrCreate(s.context,s.guid)}else typeof i=="string"&&(i=bS.getOrCreate(e,i));if(e){if(!(e instanceof $t))throw new Error("Failed to create NetworkedStreams because context is not an instance of Context")}else throw new Error("Failed to create NetworkedStreams because context is undefined");if(!i)throw new Error("Failed to create NetworkedStreams because peer is undefined");this.context=e,this.peer=i,Ks&&(this.debug=!0)}static create(e,i){const s=bS.getOrCreate(e.context,i||e.context.connection.connectionId||e.guid);return new eM(e.context,s)}startSendingStream(e){this._sendingStreams.has(e)?console.warn("Received start sending stream with stream that is already being sent"):(this._sendingStreams.set(e,[]),this.updateSendingCalls())}stopSendingStream(e){if(e){const i=this._sendingStreams.get(e);if(i){for(const s of i)s.close();i.length=0}this._sendingStreams.delete(e),i&&this.debug&&this.debugLogCurrentState()}this.updateSendingCalls()}get enabled(){return this._enabled}enable(){this._enabled||(this._enabled=!0,this.peer.enable(),this.peer.addEventListener("receive-stream",this.onCallStreamReceived),this.peer.addEventListener("call-ended",this.onCallEnded),this.context.connection.beginListen("peer-user-connected",this.onUserConnected),this.context.connection.beginListen(pi.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(pi.UserJoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(pi.UserLeftRoom,this.onUserLeft),this.context.connection.beginListen(pi.LeftRoom,this.onLeftRoom),this._tickIntervalId=setInterval(this.tick,5e3))}disable(){this._enabled&&(this._enabled=!1,this.peer.disable(),this.peer.removeEventListener("receive-stream",this.onCallStreamReceived),this.peer.removeEventListener("call-ended",this.onCallEnded),this.context.connection.stopListen("peer-user-connected",this.onUserConnected),this.context.connection.stopListen(pi.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(pi.UserJoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(pi.UserLeftRoom,this.onUserLeft),this.context.connection.stopListen(pi.LeftRoom,this.onLeftRoom),this._tickIntervalId!=null&&(clearInterval(this._tickIntervalId),this._tickIntervalId=void 0))}updateSendingCalls(){const e=this.context.connection.connectionId;for(const i of this._sendingStreams.keys()){const s=this._sendingStreams.get(i)||[];for(const r of this.context.connection.usersInRoom()){if(r===e)continue;const o=this.peer.getPeerIdFromUserId(r);if(s.find(a=>{var l;return a.peerId===o&&a.direction==="outgoing"&&!a.isClosed&&((l=a.stream)==null?void 0:l.active)}))Ks&&console.debug("Already have a call with user "+r+" / peer "+o);else{const a=this.peer.makeCall(o,i);a&&s.push(a)}}this._sendingStreams.set(i,s)}this.stopCallsToUsersThatAreNotInTheRoomAnymore()}stopCallsToUsersThatAreNotInTheRoomAnymore(){for(const e of this._sendingStreams.keys()){const i=this._sendingStreams.get(e);if(i)for(let s=i.length-1;s>=0;s--){const r=i[s];this.context.connection.userIsInRoom(r.userId)?Ks&&(this.context.connection.connectionId===r.userId?console.warn(`You are still in the room [${s}] ${r.userId}`):console.log(`User is still in room [${s}] ${r.userId}`)):(Ks&&console.log(`Remove call ${[s]} to user that is not in room anymore ${r.userId}`),r.close(),i.splice(s,1))}}this.peer.updateCalls(),this.debug&&this.debugLogCurrentState()}debugLogCurrentState(){console.warn(`You (${this.context.connection.connectionId}) are currently sending ${this._sendingStreams.size} and receiving ${this.peer.incomingCalls.length} calls (${this.peer.incomingCalls.map(e=>e.userId).join(", ")})`,this.peer.incomingCalls)}}function Wd(n){if(n&&n instanceof MediaStream)for(const e of n.getTracks())e.stop()}var RVe=Object.defineProperty,LVe=Object.getOwnPropertyDescriptor,IU=(n,e,i,s)=>{for(var r=s>1?void 0:s?LVe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&RVe(e,i,r),r};const BVe="noVoip",kVe=q("debugvoip");class yg extends Oe{constructor(){super(...arguments),m(this,"autoConnect",!0),m(this,"runInBackground",!0),m(this,"createMenuButton",!0),m(this,"debug",!1),m(this,"_net"),m(this,"_menubutton"),m(this,"_allowSending",!0),m(this,"_outputStream",null),m(this,"onJoinedRoom",async()=>{this.debug&&console.log("VOIP: Joined room"),await Ah(300),this.autoConnect&&!this.isSending&&this._allowSending&&this.connect()}),m(this,"onLeftRoom",()=>{this.debug&&console.log("VOIP: Left room"),this.disconnect();for(const e of this._incomingStreams.values())Wd(e.srcObject);this._incomingStreams.clear()}),m(this,"_incomingStreams",new Map),m(this,"onReceiveStream",e=>{const i=e.target.userId,s=e.stream;let r=this._incomingStreams.get(i);r||(r=new Audio,this._incomingStreams.set(i,r)),r.srcObject=s,r.setAttribute("autoplay","true"),op.registerWaitForInteraction(()=>{r?.play().catch(o=>{console.error("VOIP: Failed to play audio",o)})})}),m(this,"onStreamEnded",e=>{const i=this._incomingStreams.get(e.userId);Wd(i?.srcObject),this._incomingStreams.delete(e.userId)}),m(this,"onEnabledChanged",()=>{for(const e of this._incomingStreams){const i=e[1];i.muted=!this.enabled}}),m(this,"onVisibilityChanged",()=>{if(this.runInBackground)return;const e=document.visibilityState!=="visible";this.setMuted(e);for(const i of this._incomingStreams){const s=i[1];s.muted=e}})}awake(){kVe&&(this.debug=!0),this.debug&&(console.log("VOIP debugging: press 'v' to toggle mute or 'c' to toggle connect/disconnect"),window.addEventListener("keydown",async e=>{switch(e.key.toLowerCase()){case"v":console.log("MUTE?",!this.isMuted),this.setMuted(!this.isMuted);break;case"c":this.isSending?this.disconnect():this.connect();break}}),window.addEventListener("blur",()=>{console.log("VOIP: MUTE ON BLUR"),this.setMuted(!0)}),window.addEventListener("focus",()=>{console.log("VOIP: UNMUTE ON FOCUS"),this.setMuted(!1)}))}onEnable(){this._net||(this._net=eM.create(this)),this.debug&&(this._net.debug=!0),this._net.addEventListener(Zd.StreamReceived,this.onReceiveStream),this._net.addEventListener(Zd.StreamEnded,this.onStreamEnded),this._net.enable(),this.autoConnect&&this.context.connection.isConnected&&this.connect(),this.context.connection.beginListen(pi.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(pi.LeftRoom,this.onLeftRoom),this.onEnabledChanged(),this.updateButton(),window.addEventListener("visibilitychange",this.onVisibilityChanged)}onDisable(){var e;this._net&&(this._net.stopSendingStream(this._outputStream),this._net.removeEventListener(Zd.StreamReceived,this.onReceiveStream),this._net.removeEventListener(Zd.StreamEnded,this.onStreamEnded),(e=this._net)==null||e.disable()),this.context.connection.stopListen(pi.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(pi.LeftRoom,this.onLeftRoom),this.onEnabledChanged(),this.updateButton(),window.removeEventListener("visibilitychange",this.onVisibilityChanged)}onDestroy(){var e;(e=this._menubutton)==null||e.remove(),this._menubutton=void 0}get isSending(){return this._outputStream!=null&&this._outputStream.active}async connect(e){var i,s;if(!this._net)return console.error("Cannot connect to voice chat - NetworkedStreams not initialized. Make sure the component is enabled before calling this method."),!1;if(this.context.connection.isConnected){if(!await Ft.microphonePermissionsGranted())return console.error("Cannot connect to voice chat - microphone permissions not granted"),this.updateButton(),!1}else return console.error("Cannot connect to voice chat - not connected to server"),this.updateButton(),!1;return this._allowSending=!0,(i=this._net)==null||i.stopSendingStream(this._outputStream),Wd(this._outputStream),this._outputStream=await this.getAudioStream(e),this._outputStream?(this.debug&&console.log("VOIP: Got audio stream"),(s=this._net)==null||s.startSendingStream(this._outputStream),this.updateButton(),!0):(this.updateButton(),await Ft.microphonePermissionsGranted()?console.error("VOIP: Could not get audio stream - please make sure to connect an audio device and grant microphone permissions"):Mw("Microphone permissions not granted: Please grant microphone permissions to use voice chat"),(this.debug||Je())&&console.log("VOIP: Failed to get audio stream"),!1)}disconnect(e){var i;e!=null&&e.remember&&(this._allowSending=!1),(i=this._net)==null||i.stopSendingStream(this._outputStream),Wd(this._outputStream),this._outputStream=null,this.updateButton()}setMuted(e){var i;const s=(i=this._outputStream)==null?void 0:i.getAudioTracks();if(s)for(const r of s)r.enabled=!e}get isMuted(){var e;if(this._outputStream===null)return!1;const i=(e=this._outputStream)==null?void 0:e.getAudioTracks();if(i){for(const s of i)if(!s.enabled)return!0}return!1}async updateButton(){var e;if(this.createMenuButton){if(this._menubutton||(this._menubutton=document.createElement("button"),this._menubutton.addEventListener("click",()=>{this.isSending?this.disconnect({remember:!0}):this.connect(),Ft.microphonePermissionsGranted().then(i=>{i||An("<strong>Microphone permissions not granted</strong>. Please allow your browser to use the microphone to be able to talk. Click on the button on the left side of your browser's address bar to allow microphone permissions.")})})),this._menubutton){this.context.menu.appendChild(this._menubutton),this.activeAndEnabled?this._menubutton.style.display="":this._menubutton.style.display="none",this._menubutton.title=this.isSending?"Click to disable your microphone":"Click to enable your microphone";let i=(this.isSending,""),s=this.isSending?"mic":"mic_off";await Ft.microphonePermissionsGranted()||(i="No Permission",s="mic_off",this._menubutton.title="Microphone permissions not granted. Please allow your browser to use the microphone to be able to talk. This can usually be done in the addressbar of the webpage."),this._menubutton.innerText=i,this._menubutton.prepend(_o(s)),this.context.connection.isConnected==!1?this._menubutton.setAttribute("disabled",""):this._menubutton.removeAttribute("disabled")}}else this.activeAndEnabled||(e=this._menubutton)==null||e.remove()}getFrequency(e){return this.unsupported_getfrequency||(this.unsupported_getfrequency=!0,Je()&&An("VOIP: getFrequency is currently not supported"),console.warn("VOIP: getFrequency is currently not supported")),null}async getAudioStream(e){if(!navigator.mediaDevices.getUserMedia)return console.error("No getDisplayMedia support"),null;const i=async r=>await navigator.mediaDevices.getUserMedia({audio:r??!0,video:!1}).catch(o=>(console.warn("VOIP failed getting audio stream",o),null)),s=await i(e);if(!s)return null;if(Ft.isiOS()&&e?.deviceId===void 0){const r=(await navigator.mediaDevices.enumerateDevices()).find(o=>(o.kind==="audioinput"||o.kind==="audiooutput")&&!o.label.includes("iPhone"));if(r){const o=Object.assign({},e);return o.deviceId=r.deviceId,await i(o)}}return s}}IU([T()],yg.prototype,"autoConnect",2),IU([T()],yg.prototype,"runInBackground",2),IU([T()],yg.prototype,"createMenuButton",2);var GVe=Object.defineProperty,PVe=Object.getOwnPropertyDescriptor,Sse=(n,e,i,s)=>{for(var r=s>1?void 0:s?PVe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&GVe(e,i,r),r};const NVe=q("debugmouth");class vS extends Oe{constructor(){super(...arguments),m(this,"idle",[]),m(this,"talking",[]),m(this,"marker",null),m(this,"voip",null),m(this,"lastMouthChangeTime",0),m(this,"mouthChangeLength",0)}awake(){setTimeout(()=>{this.voip=$.findObjectOfType(yg,this.context),this.marker||(this.marker=$.getComponentInParent(this.gameObject,Eo))},3e3)}update(){var e;if(!this.voip||this.context.time.frameCount%10!==0)return;let i=((e=this.marker)==null?void 0:e.connectionId)??null;if(!i){NVe&&(i=null);return}const s=this.voip.getFrequency(i)??0;this.updateLips(s)}updateLips(e){if(this.context.time.time-this.lastMouthChangeTime>this.mouthChangeLength){if(this.mouthChangeLength=.05+Math.random()*.1,this.talking&&this.talking.length>0&&e>30){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.talking.length);this.setMouthShapeActive(this.talking,i)}else if(this.idle.length>0&&this.context.time.time-this.lastMouthChangeTime>.5){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.idle.length);this.setMouthShapeActive(this.idle,i)}}}setMouthShapeActive(e,i){if(e){e!=this.idle?this.idle.map(s=>s.visible=!1):this.talking.map(s=>s.visible=!1);for(let s=0;s<e.length;s++){const r=e[s];r&&(r.visible=s===i)}}}}Sse([T(Ae)],vS.prototype,"idle",2),Sse([T(Ae)],vS.prototype,"talking",2);class TU extends Oe{constructor(){super(...arguments),m(this,"voip",null),m(this,"marker",null),m(this,"_startPosition",null)}awake(){this.voip=$.findObjectOfType(yg,this.context),this.marker=$.getComponentInParent(this.gameObject,Eo)}update(){if(!this.voip||!this.marker||this.context.time.frameCount%10!==0)return;const e=this.marker.connectionId,i=this.voip.getFrequency(e);if(i==null)return;this._startPosition||(this._startPosition=this.gameObject.position.clone());const s=i/100;this.gameObject.position.y=this._startPosition.y+s*.07}}var VVe=Object.defineProperty,XVe=Object.getOwnPropertyDescriptor,LL=(n,e,i,s)=>{for(var r=s>1?void 0:s?XVe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&VVe(e,i,r),r};class W0 extends Oe{constructor(){super(...arguments),m(this,"eyes",[]),m(this,"lastBlinkTime",0),m(this,"blinkLength",0),m(this,"eyesOpen",!0),m(this,"state",null)}awake(){this.state=$.getComponentInParent(this.gameObject,Jl)}update(){if(!(!this.gameObject||!this.gameObject.visible||!this.eyes||!Array.isArray(this.eyes)||this.eyes.length===0)&&this.context.time.time-this.lastBlinkTime>this.blinkLength){if(this.lastBlinkTime=this.context.time.time,this.state&&!this.state.isOn||!this.activeAndEnabled)return;if(this.eyesOpen=!this.eyesOpen,this.blinkLength=Math.random(),this.eyesOpen?(this.blinkLength*=3,this.blinkLength+=.5,Math.random()<.1&&(this.blinkLength=.1+Math.random()*.2)):(this.blinkLength*=Math.random()*.2,this.blinkLength+=.1),Math.random()<.1&&(this.blinkLength*=3),this.blinkLength=Math.max(.2,this.blinkLength),this.blinkLength=Math.min(3,this.blinkLength),this.eyes)for(const e of this.eyes)e&&(e.visible=this.eyesOpen)}}}LL([T(Ae)],W0.prototype,"eyes",2),LL([T()],W0.prototype,"lastBlinkTime",2),LL([T()],W0.prototype,"blinkLength",2),LL([T()],W0.prototype,"eyesOpen",2);var DVe=Object.defineProperty,zVe=Object.getOwnPropertyDescriptor,EU=(n,e,i,s)=>{for(var r=s>1?void 0:s?zVe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&DVe(e,i,r),r},RU;const _se=(RU=class extends Oe{constructor(){super(...arguments),m(this,"head",null),m(this,"eyes",null),m(this,"target",null),m(this,"brain",null),m(this,"vec",new E),m(this,"currentTargetPoint",new E)}awake(){this.brain||(this.brain=$.getComponentInParent(this.gameObject,AS)),this.brain||(this.brain=$.addComponent(this.gameObject,AS)),this.brain&&this.target&&(this.brain.controlledTarget=this.target)}update(){const n=this.target;if(n&&this.head){const e=this.eyes;if(e){const i=ri(n);this.currentTargetPoint.lerp(i,this.context.time.deltaTime/.1);const s=ri(this.head),r=this.vec.copy(this.currentTargetPoint).sub(s).normalize();if(r.length()<.1)return;const o=_se.forward;if(o.set(0,0,1),o.applyQuaternion(fn(this.head)),o.dot(r)>.45)for(let a=0;a<e.length;a++)e[a].lookAt(this.currentTargetPoint)}}}},m(RU,"forward",new E(0,0,1)),RU);let Av=_se;EU([T(Ae)],Av.prototype,"head",2),EU([T(Ae)],Av.prototype,"eyes",2),EU([T(Ae)],Av.prototype,"target",2);const xS=q("debugavatar");class BL{constructor(e,i,s,r){m(this,"root"),m(this,"head"),m(this,"leftHand"),m(this,"rigthHand");var o;this.root=e,this.head=i,this.leftHand=s,this.rigthHand=r,(o=this.root)==null||o.traverse(a=>a.layers.set(2))}get isValid(){return this.head!==null&&this.head!==void 0}}class LU{constructor(){m(this,"avatarRegistryUrl",null)}async getOrCreateNewAvatarInstance(e,i){if(!i)return console.error("Can not create avatar: failed to provide id or root object"),null;let s=null;if(typeof i=="string"){if(s=await this.loadAvatar(e,i),!s){const o=new qh;s=$.instantiate(qy(i,e.scene),o)}}else s=i;if(!s)return null;const r=this.findAvatar(s);return r.isValid?(xS&&console.log("[Custom Avatar] valid config",i,xS?r:""),r):(console.warn("[Custom Avatar] config isn't valid",i,xS?r:""),null)}async loadAvatar(e,i){if(console.assert(i!=null&&typeof i=="string","Avatar id must not be null"),i.length<=0||!i)return null;if(xS&&console.log("[Custom Avatar] "+i+", loading..."),i.endsWith(".glb")||(i+=".glb"),this.avatarRegistryUrl===null){const r=await fetch("./"+i);let o=null;if(r.ok){const l=await r.blob();l&&(o=await l.arrayBuffer())}if(!o)return null;const a=await fh().parseSync(e,o,null,0);return a?.scene??null}const s=new ip;return tL(s,e),new Promise((r,o)=>{const a=this.avatarRegistryUrl+"/"+i;s.load(a,async l=>{await fh().createBuiltinComponents(e,a,l,null,void 0),r(l.scene)},l=>{xS&&console.log("[Custom Avatar] "+l.loaded/l.total*100+"% loaded of "+l.total/1024+"kB")},l=>{console.error("[Custom Avatar] Error when loading: "+l),r(null)})})}cacheModel(e,i){}findAvatar(e){const i=e;let s=i;s.children.length==1&&(s=e.children[0]);let r=this.findAvatarPart(s,["head"]);const o=this.findAvatarPart(s,["left","hand"]),a=this.findAvatarPart(s,["right","hand"]);if(!r){r=i;const l=new E;new gi().setFromObject(r).getSize(l);const c=Math.max(l.x,l.y,l.z);console.warn("[Custom Avatar] Normalizing head scale, it's too big: "+c+" meters! Should be < 0.3m"),c>.3&&r.scale.multiplyScalar(1/c*.3)}return new BL(i,r,o,a)}findAvatarPart(e,i){const s=e.name.toLowerCase();let r=!0;for(const o of i){if(!r)break;s.indexOf(o)===-1&&(r=!1)}if(r)return e;if(e.children)for(const o of e.children){const a=this.findAvatarPart(o,i);if(a)return a}return null}handleCustomAvatarErrors(e){if(!e.ok)throw Error(e.statusText);return e}}var FVe=Object.defineProperty,UVe=Object.getOwnPropertyDescriptor,BU=(n,e,i,s)=>{for(var r=s>1?void 0:s?UVe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&FVe(e,i,r),r};class yv extends Oe{constructor(){super(...arguments),m(this,"length",1),m(this,"depthTest",!0),m(this,"isGizmo",!1),m(this,"_axes",null)}onEnable(){if(this.isGizmo&&!_C)return;this._axes||(this._axes=new Ya(this.length)),this._axes.layers.disableAll(),this._axes.layers.set(this.layer),this.gameObject.add(this._axes);const e=this._axes.material;e&&e.depthTest!==void 0&&(e.depthTest=this.depthTest)}onDisable(){this._axes&&this.gameObject.remove(this._axes)}}BU([T()],yv.prototype,"length",2),BU([T()],yv.prototype,"depthTest",2),BU([T()],yv.prototype,"isGizmo",2);class kU extends Oe{constructor(){super(...arguments),m(this,"from"),m(this,"to"),m(this,"hint"),m(this,"desiredDistance",1)}onEnable(){}update(){if(!this.from||!this.to||!this.hint)return;const e=ri(this.to).clone(),i=ri(this.from).clone(),s=e.distanceTo(i),r=e.clone();r.sub(i);const o=i.clone();o.add(e),o.multiplyScalar(.5);const a=ri(this.hint).clone();a.sub(o);const l=new E;l.crossVectors(a,r),l.crossVectors(r,l),l.normalize();const c=s*.5,h=Math.max(this.desiredDistance,c),d=Math.sqrt(h*h-c*c),u=l.clone();u.multiplyScalar(d),u.add(o),Cr(this.gameObject,u);const p=o.clone();p.sub(l),this.gameObject.lookAt(p)}}const kL=q("debugusdzbehaviours");class GL{constructor(){m(this,"behaviours",[]),m(this,"behaviourComponents",[]),m(this,"behaviourComponentsCopy",[]),m(this,"audioClips",[]),m(this,"audioClipsCopy",[]),m(this,"targetUuids",new Set)}get extensionName(){return"Behaviour"}addBehavior(e){this.behaviours.push(e)}addAudioClip(e){if(!e||typeof e!="string")return"";const i="audio/"+Jg.getName(e);return this.audioClips.push({clipUrl:e,filesKey:i}),i}getAllTargetUuids(){return this.targetUuids}onBeforeBuildDocument(e){if(!e.root)return Promise.resolve();const i=[];return e.root.traverse(s=>{$.foreachComponent(s,r=>{var o;const a=r;if(typeof a.createBehaviours=="function"||typeof a.beforeCreateDocument=="function"||typeof a.afterCreateDocument=="function"||typeof a.afterSerialize=="function"){this.behaviourComponents.push(a);const l=(o=a.beforeCreateDocument)==null?void 0:o.call(a,this,e);l instanceof Promise&&i.push(l)}},!1)}),kL&&console.log("onBeforeBuildDocument: all components",this.behaviourComponents),Promise.all(i)}onExportObject(e,i,s){var r;for(const o of this.behaviourComponents)(r=o.createBehaviours)==null||r.call(o,this,i,s)}onAfterBuildDocument(e){for(const u of this.behaviourComponents)typeof u.afterCreateDocument=="function"&&u.afterCreateDocument(this,e);this.behaviourComponentsCopy=this.behaviourComponents.slice(),this.behaviourComponents.length=0,this.audioClipsCopy=this.audioClips.slice(),this.audioClips.length=0;const i=new Set,s=new Set,r=new Set,o=new Set,a=kL;let l=`graph LR
`,c="";function h(u){if(u instanceof cp){a&&(l+=`subgraph Group_${u.id}
`);for(const p of u.actions)a&&(l+=`${u.id}[${u.id}] -- ${u.type} --> ${p.id}[${p.id}]
`),h(p);a&&(l+=`end
`)}else if(u instanceof Wl){u.tokenId==="StartAnimation"&&o.add(u);const p=u.affectedObjects;if(p)if(Array.isArray(p))for(const f of p)s.add(f),a&&(c+=`${u.id}[${u.id}] -- ${u.tokenId} --> ${f.uuid}(("${f.displayName||f.name||f.uuid}"))
`);else typeof p=="object"?(s.add(p),a&&(c+=`${u.id}[${u.id}] -- ${u.tokenId} --> ${p.uuid}(("${p.displayName||p.name||p.uuid}"))
`)):typeof p=="string"&&s.add({uuid:p});const g=u.xFormTarget;g&&(typeof g=="object"?(s.add(g),a&&(c+=`${u.id}[${u.id}] -- ${u.tokenId} --> ${g.uuid}(("${g.displayName||g.name||g.uuid}"))
`)):typeof g=="string"&&s.add({uuid:g}))}}function d(u,p){if(Array.isArray(u))for(const g of u)d(g,p);else u instanceof sg&&(typeof u.targetId=="object"&&(i.add(u.targetId),a&&(c+=`${u.targetId.uuid}(("${u.targetId.displayName}")) --> ${u.id}[${u.id}]
`)),a&&(l+=`${u.id}((${u.id})) -- ${u.tokenId}${u.type?":"+u.type:""} --> ${p.id}[${p.tokenId||p.id}]
`))}for(const u of this.behaviours)a&&(l+=`subgraph Behavior_${u.id}
`),h(u.action),d(u.trigger,u.action),a&&(l+=`end
`);a&&(l+=`
`+c),a&&(console.log("All USDZ behaviours",this.behaviours),console.warn("The Mermaid graph can be pasted into https://massive-mermaid.glitch.me/ or https://mermaid.live/edit. It should be in your clipboard already!"),console.log(l),navigator.clipboard.writeText(l));{let u=`gantt
title Animations
dateFormat X
axisFormat %s
`;const p=Array.from(o),g=new Set;for(const b of p)if(b.affectedObjects&&typeof b.affectedObjects!="string"){if(Array.isArray(b.affectedObjects))for(const v of b.affectedObjects)g.add(v);else g.add(b.affectedObjects);a&&(u+=`section ${b.animationName} (${b.id})
`,u+=`${b.id} : ${b.start}, ${b.duration}s
`)}a&&console.log(u);const f=new Set;for(const b of g){b.getPath||console.error("USDZExporter: Animation target object has no getPath method. This is likely a bug",b);let v=b.getPath();v.startsWith("<")&&(v=v.substring(1)),v.endsWith(">")&&(v=v.substring(0,v.length-1)),f.add({path:v,obj:b})}const A=Array.from(f).sort((b,v)=>b.path.length-v.path.length),y=new Array;for(let b=0;b<A.length;b++)for(let v=b+1;v<A.length;v++)if(A[v].path.startsWith(A[b].path)){const x=A[v],w=A[b];y.push({child:x.obj.displayName+" ("+x.path+")",parent:w.obj.displayName+" ("+w.path+")"})}y.length&&console.warn("USDZExporter: There are overlapping PlayAnimation actions. This can lead to undefined runtime behaviour when playing multiple animations. Please restructure the hierarchy so that animations don't overlap.",{overlappingTargets:y,playAnimationActions:o})}for(const u of new Set([...i,...s]))if(Array.isArray(u))for(const p of u)r.add(p.uuid);else r.add(u.uuid);kL&&console.log("All Behavior trigger sources and action targets",i,s,r),this.targetUuids=new Set(r)}onAfterHierarchy(e,i){var s;if((s=this.behaviours)!=null&&s.length){i.beginBlock('def Scope "Behaviors"');for(const r of this.behaviours)r.writeTo(this,e.document,i);i.closeBlock()}}async onAfterSerialize(e){kL&&console.log("onAfterSerialize behaviours",this.behaviourComponentsCopy);for(const i of this.behaviourComponentsCopy)typeof i.afterSerialize=="function"&&(i.afterSerialize.constructor.name==="AsyncFunction"?await i.afterSerialize(this,e):i.afterSerialize(this,e));for(const{clipUrl:i,filesKey:s}of this.audioClipsCopy){if(e.files[s])return;const r=await(await(await fetch(i)).blob()).arrayBuffer(),o=new Uint8Array(r);e.files[s]=o}this.behaviourComponentsCopy.length=0,this.audioClipsCopy.length=0}}var OVe=Object.defineProperty,ZVe=Object.getOwnPropertyDescriptor,GU=(n,e,i,s)=>{for(var r=s>1?void 0:s?ZVe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&OVe(e,i,r),r},PU;const Mse=(PU=class extends qr{constructor(){super(...arguments),m(this,"threshold",new at(.9)),m(this,"intensity",new at(1)),m(this,"scatter",new at(.3)),m(this,"selectiveBloom")}get typeName(){return"Bloom"}init(){this.threshold.valueProcessor=n=>n,this.intensity.valueProcessor=n=>n,this.scatter.valueProcessor=n=>n}onCreateEffect(){let n;if(this.selectiveBloom==null&&(this.selectiveBloom=Mse.useSelectiveBloom),this.selectiveBloom){const e=n=new r7(this.context.scene,this.context.mainCamera,{blendFunction:bi.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,radius:.85,intensity:this.intensity.value});e.inverted=!0}else n=new SD({blendFunction:bi.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,radius:.85,intensity:this.intensity.value});return this.intensity.onValueChanged=e=>{n.intensity=e},this.threshold.onValueChanged=e=>{n.luminanceMaterial.threshold=Math.pow(e,2.2)},this.scatter.onValueChanged=e=>{n.luminancePass.enabled=!0,n.luminanceMaterial.smoothing=e,n.mipmapBlurPass&&(n.mipmapBlurPass.radius=Di.lerp(.1,.9,e))},n}},m(PU,"useSelectiveBloom",!1),PU);let H0=Mse;GU([T(at)],H0.prototype,"threshold",2),GU([T(at)],H0.prototype,"intensity",2),GU([T(at)],H0.prototype,"scatter",2),Uc("Bloom",H0);var WVe=Object.defineProperty,HVe=Object.getOwnPropertyDescriptor,ll=(n,e,i,s)=>{for(var r=s>1?void 0:s?HVe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&WVe(e,i,r),r};class cl extends Oe{constructor(){super(...arguments),m(this,"attachedRigidbody",null),m(this,"isTrigger",!1),m(this,"sharedMaterial"),m(this,"membership",[0]),m(this,"filter"),m(this,"updateProperties",()=>{var e;(e=this.context.physics.engine)==null||e.updateProperties(this)})}get isCollider(){return!0}awake(){super.awake(),this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(rn))}start(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(rn))}onEnable(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(rn))}onDisable(){var e;(e=this.context.physics.engine)==null||e.removeBody(this)}get body(){var e;return(e=this.context.physics.engine)==null?void 0:e.getBody(this)}updatePhysicsMaterial(){var e;(e=this.context.physics.engine)==null||e.updatePhysicsMaterial(this)}}ll([T(rn)],cl.prototype,"attachedRigidbody",2),ll([T()],cl.prototype,"isTrigger",2),ll([T()],cl.prototype,"sharedMaterial",2),ll([T()],cl.prototype,"membership",2),ll([T()],cl.prototype,"filter",2);class bv extends cl{constructor(){super(...arguments),m(this,"radius",.5),m(this,"center",new E(0,0,0))}onEnable(){var e;super.onEnable(),(e=this.context.physics.engine)==null||e.addSphereCollider(this),BE(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),fX(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}}ll([Io(),T()],bv.prototype,"radius",2),ll([T(E)],bv.prototype,"center",2);const Ise=class extends cl{constructor(){super(...arguments),m(this,"size",new E(1,1,1)),m(this,"center",new E(0,0,0))}static add(n,e){const i=new Ise;n.geometry.boundingBox||n.geometry.computeBoundingBox();const s=n.geometry.boundingBox;return i.size=s.getSize(new E)||new E(1,1,1),i.center=s.getCenter(new E)||new E(0,0,0),Ul(n,i),e?.rigidbody===!0&&Ul(n,rn,{isKinematic:!1}),i}onEnable(){var n;super.onEnable(),(n=this.context.physics.engine)==null||n.addBoxCollider(this,this.size),BE(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),fX(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}};let vv=Ise;ll([Io(),T(E)],vv.prototype,"size",2),ll([T(E)],vv.prototype,"center",2);class Q0 extends cl{constructor(){super(...arguments),m(this,"sharedMesh"),m(this,"convex",!1)}onEnable(){var e,i,s;if(super.onEnable(),!this.context.physics.engine)return;(e=this.sharedMesh)!=null&&e.isMesh||(this.gameObject instanceof pe||this.gameObject instanceof Es)&&(this.sharedMesh=this.gameObject);const r=0;if((i=this.sharedMesh)!=null&&i.isMesh)this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,Dn(this.gameObject)),Fi.assignMeshLOD(this.sharedMesh,r).then(o=>{o&&this.activeAndEnabled&&this.context.physics.engine&&this.sharedMesh&&(this.context.physics.engine.removeBody(this),this.sharedMesh.geometry=o,this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,Dn(this.gameObject)))});else{const o=this.sharedMesh;if(o!=null&&o.isGroup){console.warn(`MeshCollider mesh is a group "${((s=this.sharedMesh)==null?void 0:s.name)||this.gameObject.name}", adding all children as colliders. This is currently not fully supported (colliders can not be removed from world again)`,this);const a=new Array;for(const l in o.children){const c=o.children[l];c.isMesh&&(this.context.physics.engine.addMeshCollider(this,c,this.convex,Dn(this.gameObject)),a.push(Fi.assignMeshLOD(c,r)))}Promise.all(a).then(l=>{var c,h;if(l.some(u=>u)==!1)return;(c=this.context.physics.engine)==null||c.removeBody(this);const d=new pe;for(const u of l)u&&this.activeAndEnabled&&(d.geometry=u,(h=this.context.physics.engine)==null||h.addMeshCollider(this,d,this.convex,Dn(this.gameObject)))})}else console.warn("A MeshCollider mesh is assigned, but it's neither a Mesh nor a Group. Please report a bug!",this,this.sharedMesh)}}}ll([T(pe)],Q0.prototype,"sharedMesh",2),ll([T()],Q0.prototype,"convex",2);class Ap extends cl{constructor(){super(...arguments),m(this,"center",new E(0,0,0)),m(this,"radius",.5),m(this,"height",2)}onEnable(){var e;super.onEnable(),(e=this.context.physics.engine)==null||e.addCapsuleCollider(this,this.height,this.radius)}}ll([T(E)],Ap.prototype,"center",2),ll([T()],Ap.prototype,"radius",2),ll([T()],Ap.prototype,"height",2);var QVe=Object.defineProperty,KVe=Object.getOwnPropertyDescriptor,NU=(n,e,i,s)=>{for(var r=s>1?void 0:s?KVe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&QVe(e,i,r),r};class K0 extends Oe{constructor(){super(...arguments),m(this,"objectBounds",!1),m(this,"color"),m(this,"isGizmo",!0),m(this,"_gizmoObject",null),m(this,"_boxHelper",null)}onEnable(){this.isGizmo&&!_C||(this._gizmoObject||(this.objectBounds?this._gizmoObject=new qH(this.gameObject,this.color??16776960):(this.objectBounds=!1,this._gizmoObject=Ez(this.color??16776960))),this.objectBounds?(this.scene.add(this._gizmoObject),this._boxHelper=this._gizmoObject,this.startCoroutine(this.syncObjectBounds(),_n.OnBeforeRender)):this.gameObject.add(this._gizmoObject))}onDisable(){this._gizmoObject&&this.gameObject.remove(this._gizmoObject)}*syncObjectBounds(){for(var e;this._boxHelper;)(e=this._boxHelper)==null||e.update(),yield}}NU([T()],K0.prototype,"objectBounds",2),NU([T(fe)],K0.prototype,"color",2),NU([T()],K0.prototype,"isGizmo",2);const YVe=q("gizmos"),jVe=q("debugboxhelper"),Hd=class extends Oe{constructor(){super(...arguments),m(this,"box",null),m(this,"_lastMatrixUpdateFrame",-1),m(this,"_helper",null),m(this,"_color",null)}isInBox(n){var e;if(!n)return;if(this.box||(this.box=new gi),Ll([n],void 0,void 0,Hd.testBox),Hd.testBox.isEmpty()){const s=ri(n,Hd._position);Hd.testBox.setFromCenterAndSize(s,Hd._emptyObjectSize)}this.updateBox();const i=(e=this.box)==null?void 0:e.intersectsBox(Hd.testBox);return i&&jVe&&Nt.DrawWireBox3(Hd.testBox,16711680,5),i}intersects(n){return n?this.updateBox(!1).intersectsBox(n):!1}updateBox(n=!1){if(this.box||(this.box=new gi),n||this.context.time.frameCount!=this._lastMatrixUpdateFrame){const e=this._lastMatrixUpdateFrame<0;this._lastMatrixUpdateFrame=this.context.time.frameCount;const i=e,s=ri(this.gameObject,Hd._position,i),r=Dn(this.gameObject,Hd._size);this.box.setFromCenterAndSize(s,r)}return this.box}awake(){this._helper=null,this._color=null,this.box=null}showHelper(n=null,e=!1){var i;if(!(!YVe&&!e)){if(this._helper){n&&((i=this._color)==null||i.set(n)),this.gameObject.add(this._helper);return}this._helper=Ez(n),this.gameObject.add(this._helper)}}};let Oc=Hd;m(Oc,"testBox",new gi),m(Oc,"_position",new E),m(Oc,"_size",new E(.01,.01,.01)),m(Oc,"_emptyObjectSize",new E(.01,.01,.01));class JVe extends v8{constructor(e,i={}){super(e),e._simpleState__activeStates=[],e._simpleState__normalStyles={},e._simpleState__states=i,e._simpleState__statesProperties={};for(const s in i)for(const r in i[s])e._simpleState__statesProperties[r]||(e._simpleState__statesProperties[r]=[]),e._simpleState__statesProperties[r].push(s);for(const s of e._components)e._simpleState__statesProperties[s.id]&&(e._simpleState__normalStyles[s.id]=s.inline?s.inline:s._value);e.__overridedSet=e.set,e.set=this.storeSet.bind(e),e.renderStates=this.renderStates.bind(e),e.setupState=this.setupState.bind(e),e.setState=this.setState.bind(e),e.activatePseudoState=this.activatePseudoState.bind(e),e.deactivatePseudoState=this.deactivatePseudoState.bind(e),e.togglePseudoState=this.togglePseudoState.bind(e)}act(){}attach(){}detach(){}setupState(e,i){this._simpleState__states[e]=i;const s=[];for(const r in i)this._simpleState__statesProperties[r]||(this._simpleState__statesProperties[r]=[],s.push(r)),this._simpleState__statesProperties[r].push(e);for(const r of this._components)s.indexOf(r.id)>-1&&(this._simpleState__normalStyles[r.id]=r.inline?r.inline:r._value)}renderStates(){let e={...this._simpleState__normalStyles};for(const i in this._simpleState__states)this._simpleState__activeStates.indexOf(i)>-1&&(e={...e,...this._simpleState__states[i]});this.set(e,!1)}storeSet(e,i=!0){if(i)for(const s in e)this._simpleState__statesProperties[s]&&(this._simpleState__normalStyles[s]=e[s]);this.__overridedSet(e)}activatePseudoState(e){this._simpleState__activeStates.indexOf(e)===-1&&(this._simpleState__activeStates.push(e),this.renderStates())}deactivatePseudoState(e){const i=this._simpleState__activeStates.indexOf(e);i>-1&&(this._simpleState__activeStates.splice(i,1),this.renderStates())}togglePseudoState(e){const i=this._simpleState__activeStates.indexOf(e);i>-1?this._simpleState__activeStates.splice(i,1):this._simpleState__activeStates.push(e),this.renderStates()}setState(e){Array.isArray(e)?this._simpleState__activeStates=e:this._simpleState__activeStates=[e],this.renderStates()}}var qVe=Object.defineProperty,$Ve=Object.getOwnPropertyDescriptor,Tse=(n,e,i,s)=>{for(var r=s>1?void 0:s?$Ve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&qVe(e,i,r),r};class xv extends Oe{constructor(){super(...arguments),m(this,"effectColor"),m(this,"effectDistance")}}Tse([T(pn)],xv.prototype,"effectColor",2),Tse([T(Q)],xv.prototype,"effectDistance",2);var eXe=Object.defineProperty,tXe=Object.getOwnPropertyDescriptor,wS=(n,e,i,s)=>{for(var r=s>1?void 0:s?tXe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&eXe(e,i,r),r};const VU=q("debugui"),XU=q("debuguilayout");class DU{constructor(){m(this,"width"),m(this,"height")}}class zU{constructor(){m(this,"x"),m(this,"y"),m(this,"width"),m(this,"height")}}const zh=new E,CS=new de,PL=new Fe,Ese=class extends th{constructor(){super(...arguments),m(this,"_anchoredPosition"),m(this,"sizeDelta",new Q(100,100)),m(this,"pivot",new Q(.5,.5)),m(this,"anchorMin",new Q(0,0)),m(this,"anchorMax",new Q(1,1)),m(this,"minWidth"),m(this,"minHeight"),m(this,"lastMatrix"),m(this,"rectBlock"),m(this,"_transformNeedsUpdate",!1),m(this,"_initialPosition"),m(this,"_parentRectTransform"),m(this,"_lastUpdateFrame",-1),m(this,"_lastAnchoring"),m(this,"_createdBlocks",[]),m(this,"_createdTextBlocks",[])}get parent(){return this._parentRectTransform}get translation(){return this.gameObject.position}get rotation(){return this.gameObject.quaternion}get scale(){return this.gameObject.scale}get anchoredPosition(){return this._anchoredPosition||(this._anchoredPosition=new Q),this._anchoredPosition}set anchoredPosition(n){this._anchoredPosition=n}get width(){let n=this.sizeDelta.x;if(this.anchorMin.x!==this.anchorMax.x&&this._parentRectTransform){const e=this._parentRectTransform.width,i=this.anchorMax.x-this.anchorMin.x;n=e*i,n+=this.sizeDelta.x}return this.minWidth!==void 0&&n<this.minWidth?this.minWidth:n}get height(){let n=this.sizeDelta.y;if(this.anchorMin.y!==this.anchorMax.y&&this._parentRectTransform){const e=this._parentRectTransform.height,i=this.anchorMax.y-this.anchorMin.y;n=e*i,n+=this.sizeDelta.y}return this.minHeight!==void 0&&n<this.minHeight?this.minHeight:n}awake(){super.awake(),this._anchoredPosition||(this._anchoredPosition=new Q),this.lastMatrix=new de,this.rectBlock=new Ae,this.rectBlock.name=this.name,this._initialPosition=this.gameObject.position.clone(),this._initialPosition.z=0,uv(this,"_anchoredPosition",()=>{this.markDirty()}),uv(this,"sizeDelta",()=>{this.markDirty()}),uv(this,"pivot",()=>{this.markDirty()}),uv(this,"anchorMin",()=>{this.markDirty()}),uv(this,"anchorMax",()=>{this.markDirty()})}onEnable(){var n;super.onEnable(),this.rectBlock||(this.rectBlock=new Ae),this.lastMatrix||(this.lastMatrix=new de),this._lastAnchoring||(this._lastAnchoring=new Q),this._initialPosition||(this._initialPosition=new E),this._anchoredPosition||(this._anchoredPosition=new Q),this.addShadowComponent(this.rectBlock),this._transformNeedsUpdate=!0,(n=this.canvas)==null||n.registerTransform(this)}onDisable(){var n;super.onDisable(),this.removeShadowComponent(),(n=this.canvas)==null||n.unregisterTransform(this)}onParentRectTransformChanged(n){this._transformNeedsUpdate||this.onApplyTransform(XU?`${n.name} changed`:void 0)}get isDirty(){return this._transformNeedsUpdate||(this._transformNeedsUpdate=!this.lastMatrix.equals(this.gameObject.matrix)),this._transformNeedsUpdate}markDirty(){this._transformNeedsUpdate||(XU&&console.warn("RectTransform markDirty()",this.name),this._transformNeedsUpdate=!0,this._lastUpdateFrame=-1)}updateTransform(){(this._transformNeedsUpdate||!this.lastMatrix.equals(this.gameObject.matrix))&&this.canUpdate()&&this.onApplyTransform(this._transformNeedsUpdate?"Marked dirty":"Matrix changed")}canUpdate(){return this._transformNeedsUpdate&&this.activeAndEnabled&&this._lastUpdateFrame!==this.context.time.frame}onApplyTransform(n){var e;if(this.context.time.frameCount===this._lastUpdateFrame)return;this._lastUpdateFrame=this.context.time.frameCount;const i=this.shadowComponent;if(!i)return;this.gameObject.parent?this._parentRectTransform=$.getComponentInParent(this.gameObject.parent,Ese):this._parentRectTransform=void 0,this._transformNeedsUpdate=!1,XU&&console.warn("RectTransform \u2192 ApplyTransform",this.name+" because "+n),this.isRoot()?this.Root.screenspace||(i.rotation.y=Math.PI):(i.matrix.identity(),i.matrixAutoUpdate=!1,zh.set(0,0,0),this.applyPivot(zh),i.matrix.setPosition(zh.x,zh.y,0),(this.gameObject.quaternion.x||this.gameObject.quaternion.y||this.gameObject.quaternion.z)&&(PL.copy(this.gameObject.quaternion),PL.x*=-1,PL.z*=-1,CS.makeRotationFromQuaternion(PL),i.matrix.premultiply(CS)),zh.set(0,0,0),this.applyAnchoring(zh),(e=this.canvas)!=null&&e.screenspace?zh.z+=.1:zh.z+=.01,CS.identity(),CS.setPosition(zh.x,zh.y,zh.z),i.matrix.premultiply(CS),i.matrix.scale(this.gameObject.scale)),this.lastMatrix.copy(this.gameObject.matrix);const s=!0;for(const r of B2(this.gameObject,th,s,1)){if(r===this||!r.activeAndEnabled)continue;const o=r;o.onParentRectTransformChanged&&o.onParentRectTransformChanged(this)}}applyAnchoring(n){this._lastAnchoring||(this._lastAnchoring=new Q);const e=this._lastAnchoring.sub(this._anchoredPosition);this.gameObject.position.x+=e.x,this.gameObject.position.y+=e.y,this._lastAnchoring.copy(this._anchoredPosition),n.x+=this._initialPosition.x-this.gameObject.position.x,n.y+=this._initialPosition.y-this.gameObject.position.y,n.z+=this._initialPosition.z-this.gameObject.position.z;const i=this._parentRectTransform;if(i){let s=0;const r=1-this.anchorMax.y-this.anchorMin.y;s-=i.height*.5*r,n.y+=s;let o=0;const a=1-this.anchorMax.x-this.anchorMin.x;o-=i.width*.5*a,n.x+=o}}applyPivot(n){if(this.pivot&&!this.isRoot()){const e=this.pivot.x-.5;n.x-=e*this.sizeDelta.x*this.gameObject.scale.x;const i=this.pivot.y-.5;n.y-=i*this.sizeDelta.y*this.gameObject.scale.y}}getBasicOptions(){const n={width:this.sizeDelta.x,height:this.sizeDelta.y,offset:0,backgroundOpacity:0,borderWidth:0,borderRadius:0,borderOpacity:0,letterSpacing:-.03};return this.ensureValidSize(n),n}ensureValidSize(n,e=1e-4){return n.width<=0&&(n.width=e),n.height<=0&&(n.height=1e-4),n}createNewBlock(n){n={...this.getBasicOptions(),...n},VU&&console.log(this.name,n);const e=new JX(n);return this._createdBlocks.push(e),e}createNewText(n){VU&&console.log(n),n={...this.getBasicOptions(),...n},VU&&console.log(this.name,n);const e=new $X(n);return this._createdTextBlocks.push(e),e}};let aa=Ese;wS([T(Q)],aa.prototype,"anchoredPosition",1),wS([T(Q)],aa.prototype,"sizeDelta",2),wS([T(Q)],aa.prototype,"pivot",2),wS([T(Q)],aa.prototype,"anchorMin",2),wS([T(Q)],aa.prototype,"anchorMax",2);var iXe=Object.defineProperty,nXe=Object.getOwnPropertyDescriptor,Rse=(n,e,i,s)=>{for(var r=s>1?void 0:s?nXe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&iXe(e,i,r),r};const NL={backgroundColor:new fe(1,1,1),backgroundOpacity:1,borderColor:new fe(1,1,1),borderOpacity:1};var FU;const SS=(FU=class extends th{constructor(){super(...arguments),m(this,"_alphaFactor",1),m(this,"sRGBColor",new fe(1,0,1)),m(this,"raycastTarget",!0),m(this,"uiObject",null),m(this,"_color",null),m(this,"_rect",null),m(this,"_stateManager",null),m(this,"_currentlyCreatingPanel",!1)}get isGraphic(){return!0}get color(){return this._color||(this._color=new pn(1,1,1,1)),this._color}set color(n){(!this._color||this._color.r!==n.r||this._color.g!==n.g||this._color.b!==n.b||this._color.alpha!==n.alpha)&&(this._color||(this._color=new pn(1,1,1,1)),this._color.copy(n),this.onColorChanged())}setAlphaFactor(n){this._alphaFactor=n,this.onColorChanged()}get alphaFactor(){return this._alphaFactor}onColorChanged(){this.uiObject&&(this.sRGBColor.copy(this._color),this.sRGBColor.convertLinearToSRGB(),NL.backgroundColor=this.sRGBColor,NL.backgroundOpacity=this._color.alpha*this._alphaFactor,this.applyEffects(NL,this._alphaFactor),this.uiObject.set(NL),this.markDirty())}get m_Color(){return this._color}get rectTransform(){if(this._rect||(this._rect=$.getComponent(this.gameObject,aa)),!this._rect)throw new Error("Not Supported: Make sure to add a RectTransform component before adding a UI Graphic component.");return this._rect}onParentRectTransformChanged(){var n;(n=this.uiObject)==null||n.set({width:this.rectTransform.width,height:this.rectTransform.height}),this.markDirty()}__internalNewInstanceCreated(n){return super.__internalNewInstanceCreated(n),this._rect=null,this.uiObject=null,this._color&&(this._color=this._color.clone()),this}setState(n){this.makePanel(),this.uiObject&&(this.uiObject.setState(n),this==null||this.markDirty())}setupState(n){this.makePanel(),this.uiObject&&(this._stateManager||(this._stateManager=new JVe(this.uiObject)),this.uiObject.setupState(n.state,n.attributes))}setOptions(n){this.makePanel(),this.uiObject&&this.uiObject.set(n)}awake(){super.awake(),this.makePanel(),uv(this,"_color",()=>RNe(this,this.onColorChanged))}onEnable(){var n;super.onEnable(),this.uiObject&&((n=this.rectTransform.shadowComponent)==null||n.add(this.uiObject),this.addShadowComponent(this.uiObject,this.rectTransform))}onDisable(){super.onDisable(),this.uiObject&&this.removeShadowComponent()}makePanel(){if(this.uiObject||this._currentlyCreatingPanel)return;this._currentlyCreatingPanel=!0;const n=.015,e={backgroundColor:this.color,backgroundOpacity:this.color.alpha,offset:n};this.onBeforeCreate(e),this.applyEffects(e),this.onCreate(e),this.controlsChildLayout=!1,this._currentlyCreatingPanel=!1,this.onAfterCreated(),this.onColorChanged()}onBeforeCreate(n){}onCreate(n){this.uiObject=this.rectTransform.createNewBlock(n),this.uiObject.name=this.name}onAfterCreated(){}applyEffects(n,e=1){var i;const s=(i=this.gameObject)==null?void 0:i.getComponent(xv);s&&(s.effectDistance&&(n.borderWidth=Math.max(Math.abs(s.effectDistance.x),Math.abs(s.effectDistance.y))),s.effectColor&&(n.borderColor=s.effectColor,n.borderOpacity=s.effectColor.alpha*e))}async setTexture(n){if(this.setOptions({backgroundOpacity:0}),n){if(SS.textureCache.has(n))n=SS.textureCache.get(n);else if(!n.isRenderTargetTexture){const e=n.clone();e.colorSpace=qi,SS.textureCache.set(n,e),n=e}this.setOptions({backgroundImage:n,borderRadius:0,backgroundOpacity:this.color.alpha,backgroundSize:"stretch"}),Fi.assignTextureLOD(n,0).then(e=>{e instanceof di&&(n&&SS.textureCache.set(n,e),this.setOptions({backgroundImage:e}),this.markDirty())})}else this.setOptions({backgroundImage:void 0,borderRadius:0,backgroundOpacity:this.color.alpha});this.markDirty()}onAfterAddedToScene(){super.onAfterAddedToScene(),this.shadowComponent&&(this.shadowComponent.offset=this.shadowComponent.position.z)}},m(FU,"textureCache",new Map),FU);let Y0=SS;Rse([T(pn)],Y0.prototype,"color",1),Rse([T()],Y0.prototype,"raycastTarget",2);class _S extends Y0{constructor(){super(...arguments),m(this,"_flippedObject",!1)}onAfterCreated(){this.uiObject&&!this._flippedObject&&(this._flippedObject=!0,this.uiObject.scale.y*=-1)}}var sXe=Object.defineProperty,rXe=Object.getOwnPropertyDescriptor,VL=(n,e,i,s)=>{for(var r=s>1?void 0:s?rXe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&sXe(e,i,r),r};let UU=class{constructor(){m(this,"texture",null),m(this,"rect")}};VL([T(di)],UU.prototype,"texture",2);let wv=class extends _S{constructor(){super(...arguments),m(this,"_sprite"),m(this,"pixelsPerUnitMultiplier",1)}set image(n){this.sprite||(this.sprite=new UU),this.sprite.texture=n,this.onAfterCreated()}get image(){return this.sprite?this.sprite.texture:null}get sprite(){return this._sprite}set sprite(n){this._sprite!==n&&(this._sprite=n,this.onAfterCreated())}isBuiltinSprite(){var n,e,i,s,r,o,a;const l=this.sprite;switch((n=l?.texture)==null?void 0:n.name){case"InputFieldBackground":case"UISprite":case"Background":case"Knob":return!0}return!((i=(e=l?.texture)==null?void 0:e.name)!=null&&i.length)&&((r=(s=l?.texture)==null?void 0:s.image)==null?void 0:r.width)===32&&((a=(o=l?.texture)==null?void 0:o.image)==null?void 0:a.height)===32}onBeforeCreate(n){var e,i;super.onBeforeCreate(n),this.isBuiltinSprite()&&(n.borderRadius=5/this.pixelsPerUnitMultiplier,((i=(e=this.sprite)==null?void 0:e.texture)==null?void 0:i.name)==="Knob"&&(n.borderRadius=999))}onAfterCreated(){var n;this.__didAwake&&(super.onAfterCreated(),!this.isBuiltinSprite()&&this.setTexture((n=this.sprite)==null?void 0:n.texture))}};VL([T(UU)],wv.prototype,"sprite",1),VL([T()],wv.prototype,"pixelsPerUnitMultiplier",2);class XL extends _S{constructor(){super(...arguments),m(this,"_mainTexture")}get mainTexture(){return this._mainTexture}set mainTexture(e){this._mainTexture!==e&&(this._mainTexture=e,this.onAfterCreated())}onAfterCreated(){this.__didAwake&&(super.onAfterCreated(),this.setTexture(this.mainTexture))}}VL([T(di)],XL.prototype,"mainTexture",1);var oXe=Object.defineProperty,aXe=Object.getOwnPropertyDescriptor,ql=(n,e,i,s)=>{for(var r=s>1?void 0:s?aXe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&oXe(e,i,r),r};const j0=q("debugbutton");class bg{constructor(){m(this,"colorMultiplier"),m(this,"disabledColor"),m(this,"fadeDuration"),m(this,"highlightedColor"),m(this,"normalColor"),m(this,"pressedColor"),m(this,"selectedColor")}}ql([T()],bg.prototype,"colorMultiplier",2),ql([T(pn)],bg.prototype,"disabledColor",2),ql([T()],bg.prototype,"fadeDuration",2),ql([T(pn)],bg.prototype,"highlightedColor",2),ql([T(pn)],bg.prototype,"normalColor",2),ql([T(pn)],bg.prototype,"pressedColor",2),ql([T(pn)],bg.prototype,"selectedColor",2);class lXe{constructor(){m(this,"disabledTrigger"),m(this,"highlightedTrigger"),m(this,"normalTrigger"),m(this,"pressedTrigger"),m(this,"selectedTrigger")}}class yp extends Oe{constructor(){super(...arguments),m(this,"onClick",new Gn),m(this,"_isHovered",0),m(this,"colors"),m(this,"transition"),m(this,"animationTriggers"),m(this,"animator"),m(this,"_interactable",!0),m(this,"_requestedAnimatorTrigger"),m(this,"_isInit",!1),m(this,"_image")}click(){var e;(e=this.onClick)==null||e.invoke()}onPointerEnter(e){var i,s;const r=e.event.pointerType==="mouse"&&e.button===0;r&&(this._isHovered+=1),j0&&console.warn("Button Enter",r,this._isHovered,(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator),this.interactable&&(this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.highlightedTrigger):this.transition===1&&this.colors&&((s=this._image)==null||s.setState("hovered")),r&&this.context.input.setCursorPointer())}onPointerExit(){var e,i;this._isHovered-=1,this._isHovered<0&&(this._isHovered=0),j0&&console.log("Button Exit",this._isHovered,(e=this.animationTriggers)==null?void 0:e.highlightedTrigger,this.animator),this.interactable&&(this._isHovered>0||(this._isHovered=0,this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.normalTrigger):this.transition===1&&this.colors&&((i=this._image)==null||i.setState("normal")),this.context.input.setCursorNormal()))}onPointerDown(e){var i,s;j0&&console.log("Button Down",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator),this.interactable&&(this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.pressedTrigger):this.transition===1&&this.colors&&((s=this._image)==null||s.setState("pressed")))}onPointerUp(e){var i,s;j0&&console.warn("Button Up",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator,this._isHovered),this.interactable&&(this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this._isHovered?this.animationTriggers.highlightedTrigger:this.animationTriggers.normalTrigger):this.transition===1&&this.colors&&((s=this._image)==null||s.setState(this._isHovered?"hovered":"normal")))}onPointerClick(e){if(this.interactable&&!(e.button!==0&&e.event.pointerType===ZR.Mouse)&&(j0&&(console.warn("Button Click",this.onClick),ss("CLICKED button "+this.name+" at "+this.context.time.frameCount)),this.onClick&&this.onClick.listenerCount>0&&(this.onClick.invoke(),e.use(),j0))){const i=this.gameObject.worldPosition;i.add(this.gameObject.worldUp.multiplyScalar(1+Math.random()*.5)),Nt.DrawLabel(i,"CLICK:"+Date.now(),.1,1+Math.random()*.5)}}set interactable(e){this._interactable=e,this._image&&(this._image.setInteractable(e),e?this._image.setState("normal"):this._image.setState("disabled"))}get interactable(){return this._interactable}set_interactable(e){this.interactable=e}awake(){super.awake(),j0&&console.log(this),this._isInit=!1,this.init()}start(){var e;(e=this._image)==null||e.setInteractable(this.interactable),this.gameObject.getComponentInParent(nS)||this.gameObject.addComponent(vL)}onEnable(){super.onEnable()}onDestroy(){this._isHovered&&this.context.input.setCursorNormal()}*setAnimatorTriggerAtEndOfFrame(e){var i;this._requestedAnimatorTrigger=e,yield,yield,this._requestedAnimatorTrigger==e&&((i=this.animator)==null||i.setTrigger(e))}init(){this._isInit||(this._isInit=!0,this._image=$.getComponent(this.gameObject,wv),this._image&&(this.stateSetup(this._image),this.interactable?this._image.setState("normal"):this._image.setState("disabled")))}stateSetup(e){var i,s,r,o,a;e.setInteractable(this.interactable);const l=this.getFinalColor(e.color,(i=this.colors)==null?void 0:i.normalColor),c={state:"normal",attributes:{backgroundColor:l,backgroundOpacity:l.alpha}};e.setupState(c);const h=this.getFinalColor(e.color,(s=this.colors)==null?void 0:s.highlightedColor),d={state:"hovered",attributes:{backgroundColor:h,backgroundOpacity:h.alpha}};e.setupState(d);const u=this.getFinalColor(e.color,(r=this.colors)==null?void 0:r.pressedColor),p={state:"pressed",attributes:{backgroundColor:u,backgroundOpacity:u.alpha}};e.setupState(p);const g=this.getFinalColor(e.color,(o=this.colors)==null?void 0:o.selectedColor),f={state:"selected",attributes:{backgroundColor:g,backgroundOpacity:g.alpha}};e.setupState(f);const A=this.getFinalColor(e.color,(a=this.colors)==null?void 0:a.disabledColor),y={state:"disabled",attributes:{backgroundColor:A,backgroundOpacity:A.alpha}};e.setupState(y)}getFinalColor(e,i){return i?e.clone().multiply(i).convertLinearToSRGB():e.clone().convertLinearToSRGB()}}ql([T(Gn)],yp.prototype,"onClick",2),ql([T(bg)],yp.prototype,"colors",2),ql([T()],yp.prototype,"transition",2),ql([T(lXe)],yp.prototype,"animationTriggers",2),ql([T(Mo)],yp.prototype,"animator",2),ql([T()],yp.prototype,"interactable",1);var cXe=Object.defineProperty,hXe=Object.getOwnPropertyDescriptor,hr=(n,e,i,s)=>{for(var r=s>1?void 0:s?hXe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&cXe(e,i,r),r};const Lse=q("debuguilayout");class vg{constructor(){m(this,"left",0),m(this,"right",0),m(this,"top",0),m(this,"bottom",0)}get vertical(){return this.top+this.bottom}get horizontal(){return this.left+this.right}}hr([T()],vg.prototype,"left",2),hr([T()],vg.prototype,"right",2),hr([T()],vg.prototype,"top",2),hr([T()],vg.prototype,"bottom",2);class $l extends Oe{constructor(){super(...arguments),m(this,"_rectTransform",null),m(this,"_needsUpdate",!1),m(this,"childAlignment",0),m(this,"reverseArrangement",!1),m(this,"spacing",0),m(this,"padding"),m(this,"minWidth",0),m(this,"minHeight",0),m(this,"flexibleHeight",0),m(this,"flexibleWidth",0),m(this,"preferredHeight",0),m(this,"preferredWidth",0)}get rectTransform(){return this._rectTransform}onParentRectTransformChanged(e){this._needsUpdate=!0}get isDirty(){return this._needsUpdate}get isLayoutGroup(){return!0}updateLayout(){this._rectTransform&&(Lse&&console.warn("Layout Update",this.context.time.frame,this.name),this._needsUpdate=!1,this.onCalculateLayout(this._rectTransform))}start(){this._needsUpdate=!0}onEnable(){Lse&&console.log(this.name,this),this._rectTransform=this.gameObject.getComponent(aa);const e=this.gameObject.getComponentInParent(Ro);e&&e.registerLayoutGroup(this),this._needsUpdate=!0}onDisable(){const e=this.gameObject.getComponentInParent(Ro);e&&e.unregisterLayoutGroup(this)}set m_Spacing(e){e!==this.spacing&&(this._needsUpdate=!0,this.spacing=e)}get m_Spacing(){return this.spacing}}hr([T()],$l.prototype,"childAlignment",2),hr([T()],$l.prototype,"reverseArrangement",2),hr([T()],$l.prototype,"spacing",2),hr([T(vg)],$l.prototype,"padding",2),hr([T()],$l.prototype,"minWidth",2),hr([T()],$l.prototype,"minHeight",2),hr([T()],$l.prototype,"flexibleHeight",2),hr([T()],$l.prototype,"flexibleWidth",2),hr([T()],$l.prototype,"preferredHeight",2),hr([T()],$l.prototype,"preferredWidth",2);class xg extends $l{constructor(){super(...arguments),m(this,"childControlHeight",!0),m(this,"childControlWidth",!0),m(this,"childForceExpandHeight",!1),m(this,"childForceExpandWidth",!1),m(this,"childScaleHeight",!1),m(this,"childScaleWidth",!1)}onCalculateLayout(e){var i;const s=this.primaryAxis,r=e.width;let o=r;const a=e.height;let l=a;o-=this.padding.horizontal,l-=this.padding.vertical,s==="x"?this.padding.horizontal:this.padding.vertical;const c=s==="x",h=c?"y":"x",d=c?this.childControlWidth:this.childControlHeight,u=c?this.childControlHeight:this.childControlWidth,p=c?this.childForceExpandWidth:this.childForceExpandHeight,g=c?this.childForceExpandHeight:this.childForceExpandWidth,f=c?l:o,A=c?r:a,y=.5*(c?this.childAlignment%3:Math.floor(this.childAlignment/3));let b=0;c?b+=this.padding.left:b+=this.padding.top;let v=0,x=0;for(let I=0;I<this.gameObject.children.length;I++){const B=this.gameObject.children[I],M=$.getComponent(B,aa);M!=null&&M.activeAndEnabled&&(x+=1,c?v+=M.width:v+=M.height)}let w=0;const C=this.spacing*(x-1);if(p||d){let I=0;c?I=o-=C:I=l-=C,x>0&&(w=I/x)}let S=0;S+=this.padding.left,S-=this.padding.right,y!==0&&(b=A-v,b*=y,b-=C*y,c?(b-=this.padding.right*y,b+=this.padding.left*(1-y),b<this.padding.left&&(b=this.padding.left)):(b-=this.padding.bottom*y,b+=this.padding.top*(1-y),b<this.padding.top&&(b=this.padding.top)));let _=1;for(let I=0;I<this.gameObject.children.length;I++){const B=this.gameObject.children[I],M=$.getComponent(B,aa);if(M!=null&&M.activeAndEnabled){(i=M.pivot)==null||i.set(.5,.5),M.anchorMin.set(0,1),M.anchorMax.set(0,1);const R=r*.5+S*.5;M.anchoredPosition.x!==R&&(M.anchoredPosition.x=R);const k=a*-.5;M.anchoredPosition.y!==k&&(M.anchoredPosition.y=k),g&&u&&M.sizeDelta[h]!==f&&(M.sizeDelta[h]=f),p&&d&&M.sizeDelta[s]!==w&&(M.sizeDelta[s]=w);const G=c?M.width:M.height,X=G*.5;if(b+=X,p){const z=w*_-w*.5;z>b&&(b=z-w*.5+G+this.padding.left,b-=X)}let F=b;s==="y"&&(F=-F),M.anchoredPosition[s]!==F&&(M.anchoredPosition[s]=F),b+=X,b+=this.spacing,_+=1}}}}hr([T()],xg.prototype,"childControlHeight",2),hr([T()],xg.prototype,"childControlWidth",2),hr([T()],xg.prototype,"childForceExpandHeight",2),hr([T()],xg.prototype,"childForceExpandWidth",2),hr([T()],xg.prototype,"childScaleHeight",2),hr([T()],xg.prototype,"childScaleWidth",2);class OU extends xg{get primaryAxis(){return"y"}}class ZU extends xg{get primaryAxis(){return"x"}}class WU extends $l{onCalculateLayout(){}}var dXe=Object.defineProperty,uXe=Object.getOwnPropertyDescriptor,Qd=(n,e,i,s)=>{for(var r=s>1?void 0:s?uXe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&dXe(e,i,r),r},Bse=(n=>(n[n.ScreenSpaceOverlay=0]="ScreenSpaceOverlay",n[n.ScreenSpaceCamera=1]="ScreenSpaceCamera",n[n.WorldSpace=2]="WorldSpace",n[n.Undefined=-1]="Undefined",n))(Bse||{});const HU=q("debuguilayout"),kse=class extends iS{constructor(){super(...arguments),m(this,"_renderOnTop"),m(this,"_depthWrite",!1),m(this,"_doubleSided",!0),m(this,"_castShadows",!1),m(this,"_receiveShadows",!1),m(this,"_renderMode",-1),m(this,"_rootCanvas"),m(this,"_scaleFactor",1),m(this,"worldCamera"),m(this,"planeDistance",-1),m(this,"_boundRenderSettingsChanged",this.onRenderSettingsChanged.bind(this)),m(this,"previousParent",null),m(this,"_lastMatrixWorld",null),m(this,"_rectTransforms",[]),m(this,"_layoutGroups",new Map),m(this,"_receivers",[]),m(this,"onBeforeRenderRoutine",()=>{var n,e,i,s;if(this.previousParent=this.gameObject.parent,((n=this.context.xr)!=null&&n.isVR||(e=this.context.xr)!=null&&e.isPassThrough)&&this.screenspace){this.gameObject.visible=!1,this.gameObject.removeFromParent();return}this.renderOnTop||this.screenspace?this.gameObject.removeFromParent():(this.onUpdateRenderMode(),this.handleLayoutUpdates(),(i=this.shadowComponent)==null||i.updateMatrixWorld(!0),(s=this.shadowComponent)==null||s.updateWorldMatrix(!0,!0),this.invokeBeforeRenderEvents(),Fc.ensureUpdateMeshUI(w8,this.context))}),m(this,"onAfterRenderRoutine",()=>{var n,e,i,s,r;if(((n=this.context.xr)!=null&&n.isVR||(e=this.context.xr)!=null&&e.isPassThrough)&&this.screenspace){(i=this.previousParent)==null||i.add(this.gameObject);return}if((this.screenspace||this.renderOnTop)&&this.previousParent&&this.context.mainCamera){if(this.screenspace){const l=this.context.mainCamera;l?.add(this.gameObject)}else this.previousParent.add(this.gameObject);const o=this.context.renderer.autoClear,a=this.context.renderer.autoClearColor;this.context.renderer.autoClear=!1,this.context.renderer.autoClearColor=!1,this.context.renderer.clearDepth(),this.onUpdateRenderMode(!0),this.handleLayoutUpdates(),(s=this.shadowComponent)==null||s.updateMatrixWorld(!0),this.invokeBeforeRenderEvents(),Fc.ensureUpdateMeshUI(w8,this.context,!0),this.context.renderer.render(this.gameObject,this.context.mainCamera),this.context.renderer.autoClear=o,this.context.renderer.autoClearColor=a,this.previousParent.add(this.gameObject)}(r=this._lastMatrixWorld)==null||r.copy(this.gameObject.matrixWorld)}),m(this,"_updateRenderSettingsRoutine"),m(this,"_activeRenderMode",-1),m(this,"_lastWidth",-1),m(this,"_lastHeight",-1)}get isCanvas(){return!0}get screenspace(){return this.renderMode!==2}set renderOnTop(n){n!==this._renderOnTop&&(this._renderOnTop=n,this.onRenderSettingsChanged())}get renderOnTop(){return this._renderOnTop!==void 0?this._renderOnTop:!!(this.screenspace&&this._renderMode===0)}set depthWrite(n){this._depthWrite!==n&&(this._depthWrite=n,this.onRenderSettingsChanged())}get depthWrite(){return this._depthWrite}set doubleSided(n){this._doubleSided!==n&&(this._doubleSided=n,this.onRenderSettingsChanged())}get doubleSided(){return this._doubleSided}set castShadows(n){this._castShadows!==n&&(this._castShadows=n,this.onRenderSettingsChanged())}get castShadows(){return this._castShadows}set receiveShadows(n){this._receiveShadows!==n&&(this._receiveShadows=n,this.onRenderSettingsChanged())}get receiveShadows(){return this._receiveShadows}get renderMode(){return this._renderMode}set renderMode(n){this._renderMode!==n&&(this._renderMode=n,this.onRenderSettingsChanged())}set rootCanvas(n){this._rootCanvas instanceof kse||(this._rootCanvas=n)}get rootCanvas(){return this._rootCanvas}get scaleFactor(){return this._scaleFactor}set scaleFactor(n){this._scaleFactor=n}awake(){var n;this.shadowComponent=this.gameObject,this.previousParent=this.gameObject.parent,HU&&console.log("Canvas.Awake()",((n=this.previousParent)==null?void 0:n.name)+"/"+this.gameObject.name),super.awake()}start(){this.onUpdateRenderMode()}onEnable(){super.onEnable(),this._updateRenderSettingsRoutine=void 0,this._lastMatrixWorld=new de,this.onUpdateRenderMode(),document.addEventListener("resize",this._boundRenderSettingsChanged),this.context.pre_render_callbacks.push(this.onBeforeRenderRoutine),this.context.post_render_callbacks.push(this.onAfterRenderRoutine)}onDisable(){super.onDisable(),document.removeEventListener("resize",this._boundRenderSettingsChanged);const n=this.context.pre_render_callbacks.indexOf(this.onBeforeRenderRoutine);n!==-1&&this.context.pre_render_callbacks.splice(n,1);const e=this.context.post_render_callbacks.indexOf(this.onAfterRenderRoutine);e!==-1&&this.context.post_render_callbacks.splice(e,1)}registerTransform(n){this._rectTransforms.push(n)}unregisterTransform(n){const e=this._rectTransforms.indexOf(n);e!==-1&&this._rectTransforms.splice(e,1)}registerLayoutGroup(n){const e=n.gameObject;this._layoutGroups.set(e,n)}unregisterLayoutGroup(n){const e=n.gameObject;this._layoutGroups.delete(e)}registerEventReceiver(n){this._receivers.push(n)}unregisterEventReceiver(n){const e=this._receivers.indexOf(n);e!==-1&&this._receivers.splice(e,1)}async onEnterXR(n){this.screenspace?(n.xr.isVR||n.xr.isPassThrough)&&(this.gameObject.visible=!1):(this.gameObject.visible=!1,await RE(1).then(()=>{this.gameObject.visible=!0}))}onLeaveXR(n){this.screenspace&&(n.xr.isVR||n.xr.isPassThrough)&&(this.gameObject.visible=!0)}invokeBeforeRenderEvents(){var n;for(const e of this._receivers)(n=e.onBeforeCanvasRender)==null||n.call(e,this)}handleLayoutUpdates(){this._lastMatrixWorld===null&&(this._lastMatrixWorld=new de);const n=!this._lastMatrixWorld.equals(this.gameObject.matrixWorld);HU&&n&&console.log("Canvas Layout changed",this.context.time.frameCount,this.name);const e=!1;for(const i of this._rectTransforms){n&&i.markDirty();let s=this._layoutGroups.get(i.gameObject);i.isDirty&&!s&&(s=i.gameObject.getComponentInParent($l)),(i.isDirty||s!=null&&s.isDirty)&&(HU&&!e&&console.log("CANVAS UPDATE ### "+i.name+" ##################################### "+this.context.time.frame),s?.updateLayout(),i.updateTransform())}}applyRenderSettings(){this.onRenderSettingsChanged()}onRenderSettingsChanged(){this._updateRenderSettingsRoutine||(this._updateRenderSettingsRoutine=this.startCoroutine(this._updateRenderSettingsDelayed(),_n.OnBeforeRender))}*_updateRenderSettingsDelayed(){if(yield,this._updateRenderSettingsRoutine=void 0,this.shadowComponent){this.onUpdateRenderMode(),wL(this.shadowComponent,this);for(const n of $.getComponentsInChildren(this.gameObject,th))wL(n.shadowComponent,this)}}onUpdateRenderMode(n=!1){if(!n&&this._renderMode===this._activeRenderMode&&this._lastWidth===this.context.domWidth&&this._lastHeight===this.context.domHeight)return;this._activeRenderMode=this._renderMode;let e=this.context.mainCameraComponent,i=10;switch(e&&e.nearClipPlane>0&&e.farClipPlane>0&&(i=lt.lerp(e.nearClipPlane,e.farClipPlane,.01)),this._renderMode===1&&(this.worldCamera&&(e=this.worldCamera),this.planeDistance>0&&(i=this.planeDistance)),this._renderMode){case 0:case 1:if(this._lastWidth=this.context.domWidth,this._lastHeight=this.context.domHeight,!e)return;const s=i+.01;this.gameObject.position.x=0,this.gameObject.position.y=0,this.gameObject.position.z=-s,this.gameObject.quaternion.identity();const r=this.gameObject.getComponent(aa);let o=!1;r.sizeDelta.x!==this.context.domWidth&&(o=!0),r.sizeDelta.y!==this.context.domHeight&&(o=!0);const a=e.fieldOfView*Math.PI/180,l=2*Math.tan(a/2)*Math.abs(s);this.gameObject.scale.x=l/this.context.domHeight,this.gameObject.scale.y=l/this.context.domHeight,this.gameObject.scale.z=.01,o&&(r.sizeDelta.x=this.context.domWidth,r.sizeDelta.y=this.context.domHeight,r?.markDirty());break;case 2:this._lastWidth=-1,this._lastHeight=-1;break}}};let Ro=kse;Qd([T()],Ro.prototype,"renderOnTop",1),Qd([T()],Ro.prototype,"depthWrite",1),Qd([T()],Ro.prototype,"doubleSided",1),Qd([T()],Ro.prototype,"castShadows",1),Qd([T()],Ro.prototype,"receiveShadows",1),Qd([T()],Ro.prototype,"renderMode",1),Qd([T(Ro)],Ro.prototype,"rootCanvas",1),Qd([T()],Ro.prototype,"scaleFactor",1),Qd([T(In)],Ro.prototype,"worldCamera",2),Qd([T()],Ro.prototype,"planeDistance",2);var pXe=Object.defineProperty,mXe=Object.getOwnPropertyDescriptor,QU=(n,e,i,s)=>{for(var r=s>1?void 0:s?mXe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&pXe(e,i,r),r};class wg extends Oe{constructor(){super(...arguments),m(this,"_alpha",1),m(this,"interactable",!0),m(this,"blocksRaycasts",!0),m(this,"_isDirty",!1),m(this,"_buffer",[])}get alpha(){return this._alpha}set alpha(e){e!==this._alpha&&(this._alpha=e,this.markDirty())}get isCanvasGroup(){return!0}markDirty(){this._isDirty||(this._isDirty=!0,this.startCoroutine(this.applyChangesDelayed(),_n.OnBeforeRender))}*applyChangesDelayed(){this._isDirty=!1,this.applyChangesNow()}applyChangesNow(){this._buffer.length=0;for(const e of $.getComponentsInChildren(this.gameObject,th,this._buffer)){const i=e;i.setAlphaFactor&&i.setAlphaFactor(this._alpha)}}}QU([T()],wg.prototype,"alpha",1),QU([T()],wg.prototype,"interactable",2),QU([T()],wg.prototype,"blocksRaycasts",2);var gXe=Object.defineProperty,fXe=Object.getOwnPropertyDescriptor,xs=(n,e,i,s)=>{for(var r=s>1?void 0:s?fXe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&gXe(e,i,r),r};const Gse=q("debugusdzbehaviours");function MS(n){n&&(n.getComponentInParent(nS)||(Je()&&console.debug('Raycaster on "'+n.name+'" was automatically added, because no raycaster was found in the parent hierarchy.'),n.addComponent(Ql)))}class J0 extends Oe{constructor(){super(...arguments),m(this,"object"),m(this,"target"),m(this,"duration",1),m(this,"relativeMotion",!1),m(this,"coroutine",null),m(this,"targetPos",new E),m(this,"targetRot",new Fe),m(this,"targetScale",new E)}start(){MS(this.gameObject)}onPointerClick(e){e.use(),this.coroutine&&this.stopCoroutine(this.coroutine),this.relativeMotion?this.coroutine=this.startCoroutine(this.moveRelative()):this.coroutine=this.startCoroutine(this.moveToTarget())}*moveToTarget(){if(!this.target||!this.object)return;const e=ri(this.object).clone(),i=ri(this.target).clone(),s=fn(this.object).clone(),r=fn(this.target).clone(),o=Dn(this.object).clone(),a=Dn(this.target).clone(),l=e.distanceTo(i),c=s.angleTo(r),h=o.distanceTo(a);if(l<.01&&c<.01&&h<.01){Cr(this.object,i),Ic(this.object,r),ib(this.object,a),this.coroutine=null;return}let d=0,u=0;for(;d<1;)d+=this.context.time.deltaTime/this.duration,d>1&&(d=1),u=d<.5?4*d*d*d:1-Math.pow(-2*d+2,3)/2,this.targetPos.lerpVectors(e,i,u),this.targetRot.slerpQuaternions(s,r,u),this.targetScale.lerpVectors(o,a,u),Cr(this.object,this.targetPos),Ic(this.object,this.targetRot),ib(this.object,this.targetScale),yield;this.coroutine=null}*moveRelative(){if(!this.target||!this.object)return;const e=this.object.position.clone(),i=this.object.quaternion.clone(),s=this.object.scale.clone(),r=this.target.position.clone(),o=this.target.quaternion.clone(),a=this.target.scale.clone();r.applyQuaternion(this.object.quaternion),this.targetPos.copy(this.object.position).add(r),this.targetRot.copy(this.object.quaternion).multiply(o),this.targetScale.copy(this.object.scale).multiply(a);let l=0,c=0;for(;l<1;)l+=this.context.time.deltaTime/this.duration,l>1&&(l=1),c=l<.5?4*l*l*l:1-Math.pow(-2*l+2,3)/2,this.object.position.lerpVectors(e,this.targetPos,c),this.object.quaternion.slerpQuaternions(i,this.targetRot,c),this.object.scale.lerpVectors(s,this.targetScale,c),yield;this.coroutine=null}beforeCreateDocument(e){var i;if(this.target&&this.object&&this.gameObject){const s=new Kr("Move to "+((i=this.target)==null?void 0:i.name),Yr.tapTrigger(this.gameObject),Wi.transformAction(this.object,this.target,this.duration,this.relativeMotion?"relative":"absolute"));e.addBehavior(s)}}}xs([T(Ae)],J0.prototype,"object",2),xs([T(Ae)],J0.prototype,"target",2),xs([T()],J0.prototype,"duration",2),xs([T()],J0.prototype,"relativeMotion",2);var DL;const Kd=(DL=class extends Oe{constructor(){super(...arguments),m(this,"materialToSwitch"),m(this,"variantMaterial"),m(this,"fadeDuration",0),m(this,"_objectsWithThisMaterial",null),m(this,"selfModel"),m(this,"targetModels")}start(){var n;this._objectsWithThisMaterial=this.objectsWithThisMaterial,MS(this.gameObject),Je()&&this._objectsWithThisMaterial.length<=0&&console.warn('ChangeMaterialOnClick: No objects found with material "'+((n=this.materialToSwitch)==null?void 0:n.name)+'"')}onPointerEnter(n){this.context.input.setCursorPointer()}onPointerExit(n){this.context.input.setCursorNormal()}onPointerClick(n){if(n.use(),!!this.variantMaterial)for(let e=0;e<this.objectsWithThisMaterial.length;e++){const i=this.objectsWithThisMaterial[e];i.material=this.variantMaterial}}get objectsWithThisMaterial(){return this._objectsWithThisMaterial!=null?this._objectsWithThisMaterial:(this._objectsWithThisMaterial=[],this.variantMaterial&&this.materialToSwitch&&this.context.scene.traverse(n=>{if(n instanceof pe)if(Array.isArray(n.material)){for(const e of n.material)if(e===this.materialToSwitch){this.objectsWithThisMaterial.push(n);break}}else n.material===this.materialToSwitch?this.objectsWithThisMaterial.push(n):Gte(n.material,this.materialToSwitch)&&this.objectsWithThisMaterial.push(n)}),this._objectsWithThisMaterial)}async beforeCreateDocument(n,e){this.targetModels=[],Kd._materialTriggersPerId={},Kd.variantSwitchIndex=0,this.materialToSwitch&&await Fi.assignTextureLOD(this.materialToSwitch,0),this.variantMaterial&&await Fi.assignTextureLOD(this.variantMaterial,0)}createBehaviours(n,e,i){this.objectsWithThisMaterial.find(s=>s.uuid===e.uuid)&&this.targetModels.push(e),this.gameObject.uuid===e.uuid&&(this.selfModel=e,this.materialToSwitch&&(Kd._materialTriggersPerId[this.materialToSwitch.uuid]||(Kd._materialTriggersPerId[this.materialToSwitch.uuid]=[]),Kd._materialTriggersPerId[this.materialToSwitch.uuid].push(this)))}afterCreateDocument(n,e){if(!this.materialToSwitch)return;const i=Kd._materialTriggersPerId[this.materialToSwitch.uuid];if(i){const s={};for(const r of i){const o=r.createVariants();o&&o.length>0&&(s[r.selfModel.uuid]=o)}for(const r of i){const o=[];for(const a in s)a!==r.selfModel.uuid&&o.push(...s[a]);r.createAndAttachBehaviors(n,s[r.selfModel.uuid],o)}}delete Kd._materialTriggersPerId[this.materialToSwitch.uuid]}createAndAttachBehaviors(n,e,i){const s=[],r=[],o=Math.max(0,this.fadeDuration);r.push(Wi.fadeAction([...this.targetModels,...i],o,!1)),s.push(Wi.fadeAction(e,o,!1)),r.push(Wi.fadeAction(e,o,!0)),n.addBehavior(new Kr("Select_"+this.selfModel.name,Yr.tapTrigger(this.selfModel),Wi.parallel(...r))),n.addBehavior(new Kr("StartHidden_"+this.selfModel.name,Yr.sceneStartTrigger(),Wi.parallel(...s)))}static getMaterialName(n){return Xh(n.name||"Material")+"_"+n.id}createVariants(){if(!this.variantMaterial)return null;const n=[];for(const e of this.targetModels){const i=e.clone();i.name+="_Variant_"+Kd.variantSwitchIndex+++"_"+Kd.getMaterialName(this.variantMaterial),i.displayName=i.displayName+": Variant with material "+this.variantMaterial.name,i.material=this.variantMaterial,i.geometry=e.geometry,i.transform=e.transform,(!e.parent||!e.parent.isEmpty())&&ka.createEmptyParent(e),e.parent&&e.parent.add(i),n.push(i)}return n}},m(DL,"_materialTriggersPerId",{}),m(DL,"variantSwitchIndex",0),DL);let Cv=Kd;xs([T(ti)],Cv.prototype,"materialToSwitch",2),xs([T(ti)],Cv.prototype,"variantMaterial",2),xs([T()],Cv.prototype,"fadeDuration",2);var Sv;const ws=(Sv=class extends Oe{constructor(){super(...arguments),m(this,"target"),m(this,"toggleOnClick",!1),m(this,"targetState",!0),m(this,"hideSelf",!0),m(this,"selfModel"),m(this,"selfModelClone"),m(this,"targetModel"),m(this,"toggleModel"),m(this,"stateBeforeCreatingDocument",!1),m(this,"targetStateBeforeCreatingDocument",!1)}start(){MS(this.gameObject)}onPointerClick(n){n.use(),!this.toggleOnClick&&this.hideSelf&&(this.gameObject.visible=!1),this.target&&(this.target.visible=this.toggleOnClick?!this.target.visible:this.targetState)}createBehaviours(n,e,i){e.uuid===this.gameObject.uuid&&(this.selfModel=e,this.selfModelClone=e.clone())}beforeCreateDocument(){this.target&&(this.gameObject[ws.wasVisible]===void 0&&(this.gameObject[ws.wasVisible]=this.gameObject.activeSelf),this.target[ws.wasVisible]===void 0&&(this.target[ws.wasVisible]=this.target.activeSelf),this.stateBeforeCreatingDocument=this.gameObject[ws.wasVisible],this.targetStateBeforeCreatingDocument=this.target[ws.wasVisible],this.gameObject.visible=!0,this.target.visible=!0)}afterCreateDocument(n,e){if(!this.target)return;this.targetModel=e.document.findById(this.target.uuid);const i=this.selfModel;if(this.selfModel&&this.targetModel){let s=this.selfModel,r=this.targetState;if(this.toggleOnClick)if(r=!this.targetStateBeforeCreatingDocument,!this.selfModelClone.geometry)(!this.selfModel.parent||this.selfModel.parent.isEmpty())&&UF.createEmptyParent(this.selfModel),this.toggleModel=this.selfModel.deepClone(),this.toggleModel.name+="_toggle",this.selfModel.parent.add(this.toggleModel);else{if(!this.gameObject[ws.toggleClone]){const l=this.selfModelClone.clone();l.setMatrix(new de),l.name+="_toggle"+ws.clonedToggleIndex++,i.add(l),this.gameObject[ws.toggleClone]=l,console.warn("USDZExport: Toggle "+this.gameObject.name+" doesn't have geometry. It will be deep cloned and nested behaviours will likely not work.")}const a=this.gameObject[ws.toggleClone];if(!this.gameObject[ws.reverseToggleClone]){const l=this.selfModelClone.clone();l.setMatrix(new de),l.name+="_toggleReverse"+ws.clonedToggleIndex++,i.add(l),this.gameObject[ws.reverseToggleClone]=l}this.toggleModel=this.gameObject[ws.reverseToggleClone],(!this.toggleModel.geometry||!a.geometry)&&console.error("triggers without childs and without geometry won't work!",this,i.geometry),s=a,i.geometry=null,i.material=null}if(this.toggleModel){if(this.toggleOnClick){const a=[];a.push(Wi.fadeAction(s,0,!1)),a.push(Wi.fadeAction(this.toggleModel,0,!0)),a.push(Wi.fadeAction(this.targetModel,0,r)),n.addBehavior(new Kr("Toggle_"+s.name+"_toggleTo"+(r?"On":"Off"),Yr.tapTrigger(s),Wi.parallel(...a)));const l=[];l.push(Wi.fadeAction(this.toggleModel,0,!1)),l.push(Wi.fadeAction(s,0,!0)),l.push(Wi.fadeAction(this.targetModel,0,!r)),n.addBehavior(new Kr("Toggle_"+s.name+"_toggleTo"+(r?"Off":"On"),Yr.tapTrigger(this.toggleModel),Wi.parallel(...l)))}}else{const a=[];this.hideSelf&&a.push(Wi.fadeAction(s,0,!1)),a.push(Wi.fadeAction(this.targetModel,0,r)),n.addBehavior(new Kr("Toggle_"+s.name+"_toggleTo"+(r?"On":"Off"),Yr.tapTrigger(s),Wi.parallel(...a)))}const o=new Array;this.targetStateBeforeCreatingDocument||o.push(this.targetModel),this.stateBeforeCreatingDocument||o.push(i),this.toggleModel&&o.push(this.toggleModel),n.addBehavior(new Kr("HideOnStart_"+this.gameObject.name,Yr.sceneStartTrigger(),Wi.fadeAction(o,0,!1)))}}afterSerialize(n,e){this.gameObject[ws.wasVisible]!==void 0&&(this.gameObject.visible=this.gameObject[ws.wasVisible],delete this.gameObject[ws.wasVisible]),this.target&&this.target[ws.wasVisible]!==void 0&&(this.target.visible=this.target[ws.wasVisible],delete this.target[ws.wasVisible]),delete this.gameObject[ws.toggleClone],delete this.gameObject[ws.reverseToggleClone]}},m(Sv,"clonedToggleIndex",0),m(Sv,"wasVisible",Symbol("usdz_SetActiveOnClick_wasVisible")),m(Sv,"toggleClone",Symbol("clone for toggling")),m(Sv,"reverseToggleClone",Symbol("clone for reverse toggling")),Sv);let q0=ws;xs([T(Ae)],q0.prototype,"target",2),xs([T()],q0.prototype,"toggleOnClick",2),xs([T()],q0.prototype,"targetState",2),xs([T()],q0.prototype,"hideSelf",2);class KU extends Oe{constructor(){super(...arguments),m(this,"wasVisible",!1)}start(){$.setActive(this.gameObject,!1)}createBehaviours(e,i,s){i.uuid===this.gameObject.uuid&&(this.wasVisible||e.addBehavior(new Kr("HideOnStart_"+this.gameObject.name,Yr.sceneStartTrigger(),Wi.fadeAction(i,0,!1))))}beforeCreateDocument(){this.wasVisible=$.isActiveSelf(this.gameObject)}}class _v extends Oe{constructor(){super(...arguments),m(this,"target"),m(this,"duration",.5),m(this,"motionType","bounce")}beforeCreateDocument(){}createBehaviours(e,i,s){if(this.target&&i.uuid===this.gameObject.uuid){const r=new Kr("emphasize "+this.name,Yr.tapTrigger(this.gameObject),Wi.emphasize(this.target,this.duration,this.motionType,void 0,"basic"));e.addBehavior(r)}}afterCreateDocument(e,i){}}xs([T()],_v.prototype,"target",2),xs([T()],_v.prototype,"duration",2),xs([T()],_v.prototype,"motionType",2);class Cg extends Oe{constructor(){super(...arguments),m(this,"target"),m(this,"clip",""),m(this,"toggleOnClick",!1),m(this,"trigger","tap")}start(){MS(this.gameObject)}ensureAudioSource(){if(!this.target){const e=this.gameObject.addComponent(vs);e&&(this.target=e,e.spatialBlend=1,e.volume=1,e.loop=!1,e.preload=!0)}}onPointerClick(e){var i;e.use(),!(!((i=this.target)!=null&&i.clip)&&!this.clip)&&(this.ensureAudioSource(),this.target&&(this.target.isPlaying&&this.toggleOnClick?this.target.stop():(!this.toggleOnClick&&this.target.isPlaying&&this.target.stop(),this.clip?this.target.play(this.clip):this.target.play())))}createBehaviours(e,i,s){if(!(!this.target&&!this.clip)&&i.uuid===this.gameObject.uuid){const r=this.clip?this.clip:this.target?this.target.clip:void 0;if(!r||typeof r!="string")return;const o=this.target?this.target.gameObject:this.gameObject;Jg.getName(r);const a=this.target?this.target.volume:1,l=this.target&&this.target.spatialBlend==0?"nonSpatial":"spatial";let c=!1;this.gameObject.traverse(p=>{p instanceof pe&&p.visible&&(c=!0)}),c=!0;const h=e.addAudioClip(r);let d=Wi.playAudioAction(o,h,"play",a,l);this.target&&this.target.loop&&(d=Wi.sequence(d).makeLooping());const u=this.name?"_"+this.name:"";if(c&&this.trigger==="tap"){this.toggleOnClick&&(d.multiplePerformOperation="stop");const p=new Kr("playAudio"+u,Yr.tapTrigger(i),d);e.addBehavior(p)}if(this.target&&this.target.playOnAwake&&this.target.enabled)if(c&&this.trigger==="tap")console.warn("USDZExport: Audio sources that are played on tap can't also auto-play at scene start due to a QuickLook bug.");else{const p=new Kr("playAudioOnStart"+u,Yr.sceneStartTrigger(),d);e.addBehavior(p)}}}}xs([T(vs)],Cg.prototype,"target",2),xs([T(URL)],Cg.prototype,"clip",2),xs([T()],Cg.prototype,"toggleOnClick",2);var zL;const Yd=(zL=class extends Oe{constructor(){super(...arguments),m(this,"animator"),m(this,"stateName"),m(this,"trigger","tap"),m(this,"animation"),m(this,"selfModel"),m(this,"stateAnimationModel"),m(this,"animationSequence",new Array),m(this,"animationLoopAfterSequence",new Array),m(this,"randomOffsetNormalized",0)}get target(){var n,e;return((n=this.animator)==null?void 0:n.gameObject)||((e=this.animation)==null?void 0:e.gameObject)}start(){MS(this.gameObject)}onPointerClick(n){var e;n.use(),this.target&&this.stateName&&((e=this.animator)==null||e.play(this.stateName,0,0,.1))}createBehaviours(n,e,i){e.uuid===this.gameObject.uuid&&(this.selfModel=e)}afterSerialize(){if(Yd.rootsWithExclusivePlayback.size>1){const n='Multiple root objects targeted by more than one animation. To work around QuickLook bug FB13410767, animations will be set as "exclusive" and activating them will stop other animations being marked as exclusive.';Je()&&An(n),console.warn(n,...Yd.rootsWithExclusivePlayback)}Yd.animationActions=[],Yd.rootsWithExclusivePlayback=new Set}afterCreateDocument(n,e){if(this.animationSequence===void 0&&this.animationLoopAfterSequence===void 0||!this.stateAnimationModel||!this.target)return;const i=e.document,s=e.extensions.find(a=>a instanceof JC);if(!s)return;const r=s.getClipCount(this.target)>1;r&&(Je()&&console.warn("Setting exclusive playback for "+this.target.name+"@"+this.stateName+" because it has "+s.getClipCount(this.target)+" animations. This works around QuickLook bug FB13410767."),Yd.rootsWithExclusivePlayback.add(this.target));const o=this.name?this.name:"";i.traverse(a=>{var l,c;if(a.uuid===((l=this.target)==null?void 0:l.uuid)){const h=Yd.getActionForSequences(i,a,this.animationSequence,this.animationLoopAfterSequence,this.randomOffsetNormalized),d=new Kr(this.trigger+"_"+o+"_toPlayAnimation_"+this.stateName+"_on_"+((c=this.target)==null?void 0:c.name),this.trigger=="tap"?Yr.tapTrigger(this.selfModel):Yr.sceneStartTrigger(),h);r&&d.makeExclusive(!0),n.addBehavior(d)}})}static getActionForSequences(n,e,i,s,r){const o=(l,c)=>{let h=Yd.animationActions.find(d=>d.affectedObjects==l&&d.start==c.start&&d.duration==c.duration&&d.animationSpeed==c.speed);return h||(h=Wi.startAnimationAction(l,c),Yd.animationActions.push(h)),h},a=Wi.sequence();if(i&&i.length>0)for(const l of i)a.addAction(o(e,l));if(s&&s.length>0){const l=a.actions.length==0?a:Wi.sequence();for(const c of s)l.addAction(o(e,c));l.makeLooping(),a!==l&&a.addAction(l)}return r&&r>0&&a.actions.unshift(Wi.waitAction(r)),a}static getAndRegisterAnimationSequences(n,e,i){var s,r,o,a,l,c,h,d;if(!e)return;const u=e.getComponent(Mo),p=e.getComponent(ra);if(!u&&!p)return;if(u&&!i)throw new Error("PlayAnimationOnClick: No stateName specified for animator "+u.name+" on "+e.name);let g=[],f=[];if(p){const C=n.registerAnimation(e,p.clip);C&&(p.loop?f.push(C):g.push(C));let S=0;if(p.minMaxOffsetNormalized){const _=p.minMaxOffsetNormalized.x,I=p.minMaxOffsetNormalized.y;S=(((s=p.clip)==null?void 0:s.duration)||1)*(_+Math.random()*(I-_))}return{animationSequence:g,animationLoopAfterSequence:f,randomTimeOffset:S}}const A=u?.runtimeAnimatorController;let y=A?.findState(i),b=[],v=[];if(A&&y){const C=new Array;C.push(y);let S=!1;for(;C.length<100;){if(!y||y===null||!y.transitions||y.transitions.length===0){(r=y.motion)!=null&&r.isLooping&&(S=!0);break}const _=y.transitions.find(B=>B.conditions.length===0),I=_?A.getState(_.destinationState,0):null;if(I&&C.includes(I)){y=I,S=!0;break}else if(_){if(y=I,!y)break;C.push(y)}else{S=((o=y.motion)==null?void 0:o.isLooping)??!1;break}}if(S&&y){const _=C.indexOf(y);b=C.slice(0,_),v=C.slice(_),Gse&&console.log("found loop from "+i,"states until loop",b,"states looping",v)}else b=C,v=[],Gse&&console.log("found no loop from "+i,"states",b);if(!v.length){const _=b[b.length-1],I=(a=_.motion)==null?void 0:a.clip;if(I){let B;if(n.holdClipMap.has(I))B=n.holdClipMap.get(I);else{const M=_.name+"_hold";B=I.clone(),B.duration=1,B.name=M;const R=I.duration;B.tracks=I.tracks.map(k=>{const G=k.clone();G.times=new Float32Array([0,R]);const X=k.values.length,F=k.getValueSize(),z=k.values.slice(X-F,X);return G.values=new Float32Array(2*F),G.values.set(z,0),G.values.set(z,F),G}),B.name=M,n.holdClipMap.set(I,B)}if(B){const M={name:B.name,motion:{clip:B,isLooping:!1,name:B.name},speed:1,transitions:[],behaviours:[],hash:_.hash+1};v.push(M)}}}}if(b.length===1&&(!((l=b[0].motion)!=null&&l.clip)||((h=(c=b[0].motion)==null?void 0:c.clip.tracks)==null?void 0:h.length)===0)){g=new Array;const C=n.registerAnimation(e,null);C&&g.push(C);return}if(b=b.filter(C=>{var S,_,I;return((S=C.motion)==null?void 0:S.clip)&&((I=(_=C.motion)==null?void 0:_.clip.tracks)==null?void 0:I.length)>0}),v=v.filter(C=>{var S,_,I;return((S=C.motion)==null?void 0:S.clip)&&((I=(_=C.motion)==null?void 0:_.clip.tracks)==null?void 0:I.length)>0}),b.length===0&&v.length===0){console.warn("No clips found for state "+i+" on "+u?.name+", can't export animation data");return}const x=(C,S)=>{if(!e)return;const _=n.registerAnimation(e,C.motion.clip??null);_?(_.speed=C.speed,S.push(_)):console.warn("Couldn't register animation for state "+C.name+" on "+u?.name)};if(b.length>0){g=new Array;for(const C of b)x(C,g)}if(v.length>0){f=new Array;for(const C of v)x(C,f)}let w=0;if(u&&A&&u.minMaxOffsetNormalized){const C=u.minMaxOffsetNormalized.x,S=u.minMaxOffsetNormalized.y,_=b.length?b[0]:v.length?v[0]:null;w=(((d=_?.motion.clip)==null?void 0:d.duration)||1)*(C+Math.random()*(S-C))}return{animationSequence:g,animationLoopAfterSequence:f,randomTimeOffset:w}}createAnimation(n,e,i){if(!this.target||!this.animator&&!this.animation)return;const s=Yd.getAndRegisterAnimationSequences(n,this.target,this.stateName);s&&(this.animationSequence=s.animationSequence,this.animationLoopAfterSequence=s.animationLoopAfterSequence,this.randomOffsetNormalized=s.randomTimeOffset,this.stateAnimationModel=e)}},m(zL,"animationActions",[]),m(zL,"rootsWithExclusivePlayback",new Set),zL);let $0=Yd;xs([T(Mo)],$0.prototype,"animator",2),xs([T()],$0.prototype,"stateName",2);class Mv extends Oe{constructor(){super(...arguments),m(this,"target")}getType(){}getDuration(){}}xs([T(Ae)],Mv.prototype,"target",2);class IS extends Oe{constructor(){super(...arguments),m(this,"target")}}xs([T(Mv)],IS.prototype,"target",2);class TS extends Mv{constructor(){super(...arguments),m(this,"type",1),m(this,"duration",1)}getType(){switch(this.type){case 1:return"hide";case 0:return"show"}}getDuration(){return this.duration}}xs([T()],TS.prototype,"type",2),xs([T()],TS.prototype,"duration",2);class YU extends IS{}var AXe=Object.defineProperty,yXe=Object.getOwnPropertyDescriptor,bp=(n,e,i,s)=>{for(var r=s>1?void 0:s?yXe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&AXe(e,i,r),r};const Pse=q("debugcharactercontroller");class eA extends Oe{constructor(){super(...arguments),m(this,"center",new E(0,0,0)),m(this,"radius",.5),m(this,"height",2),m(this,"_rigidbody",null),m(this,"_activeGroundCollisions"),m(this,"_contactVelocity",new E)}get rigidbody(){return this._rigidbody?this._rigidbody:(this._rigidbody=this.gameObject.getComponent(rn),this._rigidbody||(this._rigidbody=this.gameObject.addComponent(rn)),this.rigidbody)}awake(){this._activeGroundCollisions=new Set}onEnable(){const e=this.rigidbody;let i=this.gameObject.getComponent(Ap);i||(i=this.gameObject.addComponent(Ap)),i.center.copy(this.center),i.radius=this.radius,i.height=this.height;const s=new E(0,0,1),r=new E(1,0,0),o=new E(0,1,0),a=this.gameObject.getWorldDirection(new E);a.y=0;const l=r.dot(a)<0?-1:1,c=s.angleTo(a)*l;this.gameObject.setRotationFromAxisAngle(o,c),e.lockRotationX=!0,e.lockRotationY=!0,e.lockRotationZ=!0}move(e){this.gameObject.position.add(e)}onCollisionEnter(e){(e.contacts.length==0||e.contacts.some(i=>i.normal.y>.2))&&(this._activeGroundCollisions.add(e),Pse&&console.log(`Collision(${this._activeGroundCollisions.size}): ${e.contacts.map(i=>i.normal.y.toFixed(2)).join(", ")} - ${this.isGrounded}`))}onCollisionExit(e){this._activeGroundCollisions.delete(e),Pse&&console.log(`Collision(${this._activeGroundCollisions.size}) - ${this.isGrounded}`)}get isGrounded(){return this._activeGroundCollisions.size>0}get contactVelocity(){var e;this._contactVelocity.set(0,0,0);for(const i of this._activeGroundCollisions){const s=(e=this.context.physics.engine)==null?void 0:e.getLinearVelocity(i.collider);s&&(this._contactVelocity.x+=s.x,this._contactVelocity.y+=s.y,this._contactVelocity.z+=s.z)}return this._contactVelocity}}bp([T(E)],eA.prototype,"center",2),bp([T()],eA.prototype,"radius",2),bp([T()],eA.prototype,"height",2);class vp extends Oe{constructor(){super(...arguments),m(this,"controller"),m(this,"movementSpeed",2),m(this,"rotationSpeed",2),m(this,"jumpForce",1),m(this,"doubleJumpForce",2),m(this,"animator"),m(this,"lookForward",!0),m(this,"lookInput",new Q(0,0)),m(this,"moveInput",new Q(0,0)),m(this,"jumpInput",!1),m(this,"_currentSpeed",new E(0,0,0)),m(this,"_currentAngularSpeed",new E(0,0,0)),m(this,"_temp",new E(0,0,0)),m(this,"_jumpCount",0),m(this,"_currentRotation"),m(this,"_raycastOptions",new Rd)}awake(){this._currentRotation=new Fe}update(){const e=this.context.input;e.isKeyPressed("KeyW")?this.moveInput.y+=1:e.isKeyPressed("KeyS")&&(this.moveInput.y-=1),e.isKeyPressed("KeyD")?this.lookInput.x+=1:e.isKeyPressed("KeyA")&&(this.lookInput.x-=1),this.jumpInput||(this.jumpInput=e.isKeyDown("Space"))}move(e){this.moveInput.add(e)}look(e){this.lookInput.add(e)}jump(){this.jumpInput=!0}onBeforeRender(){this.handleInput(this.moveInput,this.lookInput,this.jumpInput),this.lookInput.set(0,0),this.moveInput.set(0,0),this.jumpInput=!1}handleInput(e,i,s){var r,o,a,l,c,h,d,u,p,g,f;if((r=this.controller)!=null&&r.isGrounded&&(this._jumpCount=0,this.doubleJumpForce>0&&((o=this.animator)==null||o.setBool("doubleJump",!1))),this._currentSpeed.z+=e.y*this.movementSpeed*this.context.time.deltaTime,(a=this.animator)==null||a.setBool("running",e.length()>.01),(c=this.animator)==null||c.setBool("jumping",((l=this.controller)==null?void 0:l.isGrounded)===!0&&s),this._temp.copy(this._currentSpeed),this._temp.applyQuaternion(this.gameObject.quaternion),this.controller?this.controller.move(this._temp):this.gameObject.position.add(this._temp),this._currentAngularSpeed.y+=lt.toRadians(-i.x*this.rotationSpeed)*this.context.time.deltaTime,this.lookForward&&Math.abs(this._currentAngularSpeed.y)<.01){const A=this.context.mainCameraComponent.forward;A.y=0,A.normalize(),this._currentRotation.setFromUnitVectors(new E(0,0,1),A),this.gameObject.quaternion.slerp(this._currentRotation,this.context.time.deltaTime*10)}if(this.gameObject.rotateY(this._currentAngularSpeed.y),this._currentSpeed.multiplyScalar(1-this.context.time.deltaTime*10),this._currentAngularSpeed.y*=1-this.context.time.deltaTime*10,this.controller&&s&&this.jumpForce>0){let A=(h=this.controller)==null?void 0:h.isGrounded;if(this.doubleJumpForce>0&&!((d=this.controller)!=null&&d.isGrounded)&&this._jumpCount===1&&(A=!0,(u=this.animator)==null||u.setBool("doubleJump",!0)),A){this._jumpCount+=1;const y=this.controller.rigidbody,b=this._jumpCount===2?this.doubleJumpForce:this.jumpForce;y.applyImpulse(new E(0,1,0).multiplyScalar(b))}}if(this.controller){const A=(p=this.controller)==null?void 0:p.rigidbody.getVelocity().y;if(A<-1){this._raycastOptions.ray||(this._raycastOptions.ray=new ya),this._raycastOptions.ray.origin.copy(ri(this.gameObject)),this._raycastOptions.ray.direction.set(0,-1,0);const y=this.layer;this.gameObject.layers.disableAll(),this.gameObject.layers.set(2);const b=this.context.physics.raycast(this._raycastOptions);this.gameObject.layers.set(y),(b.length&&b[0].distance>2||A<-10)&&((g=this.animator)==null||g.setBool("falling",!0))}else(f=this.animator)==null||f.setBool("falling",!1)}}}bp([T(eA)],vp.prototype,"controller",2),bp([T()],vp.prototype,"movementSpeed",2),bp([T()],vp.prototype,"rotationSpeed",2),bp([T()],vp.prototype,"jumpForce",2),bp([T()],vp.prototype,"doubleJumpForce",2),bp([T(Mo)],vp.prototype,"animator",2);var bXe=Object.defineProperty,vXe=Object.getOwnPropertyDescriptor,xXe=(n,e,i,s)=>{for(var r=s>1?void 0:s?vXe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&bXe(e,i,r),r};class ES extends qr{constructor(){super(...arguments),m(this,"intensity",new at(0))}get typeName(){return"ChromaticAberration"}onCreateEffect(){const e=new $8;return e.offset=new Q(0,0),e.radialModulation=!0,e.modulationOffset=.15,this.intensity.valueProcessor=i=>i*.02,this.intensity.onValueChanged=i=>{e.offset.x=-i,e.offset.y=i},e}}xXe([T(at)],ES.prototype,"intensity",2),Uc("ChromaticAberration",ES);var wXe=Object.defineProperty,CXe=Object.getOwnPropertyDescriptor,Nse=(n,e,i,s)=>{for(var r=s>1?void 0:s?CXe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&wXe(e,i,r),r};const Vse=q("debugpost");var FL=(n=>(n[n.None=0]="None",n[n.Neutral=1]="Neutral",n[n.ACES=2]="ACES",n[n.AgX=3]="AgX",n[n.KhronosNeutral=4]="KhronosNeutral",n))(FL||{});function jU(n){switch(n){case 0:return af;case 1:return HA;case 2:return QA;case 3:return lf;case 4:return Kp;default:return Kp}}function SXe(n){switch(n){case af:return 0;case QA:return 2;case lf:return 3;case Kp:return 1;case HA:return 1;default:return 0}}function Xse(n){switch(n){case af:return Sr.LINEAR;case QA:return Sr.ACES_FILMIC;case lf:return Sr.AGX;case Kp:return Sr.NEUTRAL;case HA:return Sr.REINHARD;default:return Sr.LINEAR}}const Dse=class extends qr{constructor(){super(...arguments),m(this,"mode",new at(void 0)),m(this,"exposure",new at(1))}get typeName(){return"ToneMapping"}setMode(n){const e=FL[n];return e===void 0?(console.error("Invalid ToneMapping mode",n),this):(this.mode.value=e,this)}get isToneMapping(){return!0}onEffectEnabled(){const n=hse(this);n&&super.onEffectEnabled(n)}onCreateEffect(){if(this.postprocessingContext)for(const i of this.postprocessingContext.components){if(i===this)break;if(i!=this&&i instanceof Dse){console.warn("Multiple tonemapping effects found in the same postprocessing stack: Please check your scene setup.",{activeEffect:i,ignoredEffect:this});return}}if(this.mode.isInitialized==!1){const i=SXe(this.context.renderer.toneMapping);this.mode.initialize(i)}const n=jU(this.mode.value),e=new iR({mode:Xse(n)});return this.mode.onValueChanged=i=>{const s=jU(i);e.mode=Xse(s),Vse&&console.log("ToneMapping mode changed to",FL[i],s,e.mode)},Vse&&console.log("Use ToneMapping",FL[this.mode.value],n,e.mode,"renderer.tonemapping: "+this.context.renderer.toneMapping),this.exposure.onValueChanged=i=>{this.context.renderer.toneMappingExposure=i},e}onBeforeRender(){this.mode.overrideState&&(this.context.renderer.toneMapping=jU(this.mode.value)),this.exposure.overrideState&&(this.context.renderer.toneMappingExposure=this.exposure.value)}};let Sg=Dse;Nse([T(at)],Sg.prototype,"mode",2),Nse([T(at)],Sg.prototype,"exposure",2),Uc("Tonemapping",Sg);var _Xe=Object.defineProperty,MXe=Object.getOwnPropertyDescriptor,UL=(n,e,i,s)=>{for(var r=s>1?void 0:s?MXe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&_Xe(e,i,r),r};class _g extends qr{constructor(){super(...arguments),m(this,"postExposure",new at(0)),m(this,"contrast",new at(0)),m(this,"hueShift",new at(0)),m(this,"saturation",new at(0))}get typeName(){return"ColorAdjustments"}init(){this.postExposure.valueProcessor=e=>(e=Math.pow(2,e),e),this.contrast.valueProcessor=e=>{let i=1;return e>0?i=200:e<0&&(i=100),e/i},this.contrast.defaultValue=0,this.hueShift.valueProcessor=e=>Math.PI*e/180,this.hueShift.defaultValue=0,this.saturation.valueProcessor=e=>e<0?e/100:e/(100*Math.PI),this.saturation.defaultValue=0}onCreateEffect(){var e,i;const s=[];this.context.renderer.toneMapping!==kr&&this.postExposure.overrideState&&(this.context.renderer.toneMapping=kr);let r=(e=this.postprocessingContext)==null?void 0:e.components.find(l=>l instanceof Sg);r||(r=new Sg,(i=this.postprocessingContext)==null||i.components.push(r)),this.postExposure.onValueChanged=l=>{this.postExposure.overrideState&&(r.exposure.value=l)};const o=new q8;this.contrast.onValueChanged=l=>o.contrast=l;const a=new n7;return s.push(o),s.push(a),this.hueShift.onValueChanged=l=>a.hue=l,this.saturation.onValueChanged=l=>a.saturation=l,s}}UL([T(at)],_g.prototype,"postExposure",2),UL([T(at)],_g.prototype,"contrast",2),UL([T(at)],_g.prototype,"hueShift",2),UL([T(at)],_g.prototype,"saturation",2),Uc("ColorAdjustments",_g);const zse=Math.sqrt(5),IXe=(zse-1)/4,Lo=(5-zse)/20,OL=n=>Math.floor(n)|0,ZL=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);function TXe(n=Math.random){const e=EXe(n),i=new Float64Array(e).map(a=>ZL[a%32*4]),s=new Float64Array(e).map(a=>ZL[a%32*4+1]),r=new Float64Array(e).map(a=>ZL[a%32*4+2]),o=new Float64Array(e).map(a=>ZL[a%32*4+3]);return function(a,l,c,h){let d,u,p,g,f;const A=(a+l+c+h)*IXe,y=OL(a+A),b=OL(l+A),v=OL(c+A),x=OL(h+A),w=(y+b+v+x)*Lo,C=y-w,S=b-w,_=v-w,I=x-w,B=a-C,M=l-S,R=c-_,k=h-I;let G=0,X=0,F=0,z=0;B>M?G++:X++,B>R?G++:F++,B>k?G++:z++,M>R?X++:F++,M>k?X++:z++,R>k?F++:z++;const H=G>=3?1:0,Z=X>=3?1:0,he=F>=3?1:0,be=z>=3?1:0,_e=G>=2?1:0,Ye=X>=2?1:0,je=F>=2?1:0,le=z>=2?1:0,ve=G>=1?1:0,Pe=X>=1?1:0,ke=F>=1?1:0,_t=z>=1?1:0,rt=B-H+Lo,xt=M-Z+Lo,Re=R-he+Lo,ze=k-be+Lo,U=B-_e+2*Lo,ot=M-Ye+2*Lo,Ne=R-je+2*Lo,yt=k-le+2*Lo,ye=B-ve+3*Lo,zt=M-Pe+3*Lo,Ct=R-ke+3*Lo,O=k-_t+3*Lo,N=B-1+4*Lo,ce=M-1+4*Lo,Ee=R-1+4*Lo,He=k-1+4*Lo,Le=y&255,bt=b&255,nt=v&255,mt=x&255;let ii=.6-B*B-M*M-R*R-k*k;if(ii<0)d=0;else{const et=Le+e[bt+e[nt+e[mt]]];ii*=ii,d=ii*ii*(i[et]*B+s[et]*M+r[et]*R+o[et]*k)}let Ge=.6-rt*rt-xt*xt-Re*Re-ze*ze;if(Ge<0)u=0;else{const et=Le+H+e[bt+Z+e[nt+he+e[mt+be]]];Ge*=Ge,u=Ge*Ge*(i[et]*rt+s[et]*xt+r[et]*Re+o[et]*ze)}let Mt=.6-U*U-ot*ot-Ne*Ne-yt*yt;if(Mt<0)p=0;else{const et=Le+_e+e[bt+Ye+e[nt+je+e[mt+le]]];Mt*=Mt,p=Mt*Mt*(i[et]*U+s[et]*ot+r[et]*Ne+o[et]*yt)}let Yt=.6-ye*ye-zt*zt-Ct*Ct-O*O;if(Yt<0)g=0;else{const et=Le+ve+e[bt+Pe+e[nt+ke+e[mt+_t]]];Yt*=Yt,g=Yt*Yt*(i[et]*ye+s[et]*zt+r[et]*Ct+o[et]*O)}let qt=.6-N*N-ce*ce-Ee*Ee-He*He;if(qt<0)f=0;else{const et=Le+1+e[bt+1+e[nt+1+e[mt+1]]];qt*=qt,f=qt*qt*(i[et]*N+s[et]*ce+r[et]*Ee+o[et]*He)}return 27*(d+u+p+g+f)}}function EXe(n){const e=new Uint8Array(512);for(let i=0;i<512/2;i++)e[i]=i;for(let i=0;i<512/2-1;i++){const s=i+~~(n()*(256-i)),r=e[i];e[i]=e[s],e[s]=r}for(let i=256;i<512;i++)e[i]=e[i-256];return e}const JU=q("debugstencil");function RXe(n,e){return(n&1<<e.layer)!=0}const LXe=Symbol("stencils"),Iv=class{constructor(n,e){m(this,"parser"),m(this,"source"),this.parser=n,this.source=e}get name(){return"NEEDLE_render_objects"}static applyStencil(n){if(!n)return;const e=n.sourceId;if(JU&&console.log(e,Iv.stencils),!e)return;const i=Iv.stencils[e];if(i)for(let s=i.length-1;s>=0;s--){const r=i[s];if(RXe(r.layer,n)){JU&&console.log(r),setTimeout(()=>{Ma()&&E2(n.gameObject)&&(An("Stencil not supported on instanced objects"),console.warn("Stencil not supported on instanced objects",n))},500);for(let o=0;o<n.sharedMaterials.length;o++){let a=n.sharedMaterials[o];a&&(a=a.clone(),a[LXe]=!0,a.stencilWrite=!0,a.stencilWriteMask=255,a.stencilFuncMask=255,a.stencilRef=r.value,a.stencilFunc=r.compareFunc,a.stencilZPass=r.passOp,a.stencilFail=r.failOp,a.stencilZFail=r.zFailOp,n.sharedMaterials[o]=a)}n.gameObject.renderOrder=r.event*1e3+r.index*50;break}}}afterRoot(n){const e=this.parser.json.extensions;if(e){const i=e[kXe];if(i){JU&&console.log(i);const s=i.stencil;if(s&&Array.isArray(s))for(const r of s){const o={...r};o.compareFunc=BXe(o.compareFunc),o.passOp=$U(o.passOp),o.failOp=$U(o.failOp),o.zFailOp=$U(o.zFailOp),Iv.stencils[this.source]||(Iv.stencils[this.source]=[]),Iv.stencils[this.source].push(o)}}}return null}};let qU=Iv;m(qU,"stencils",{});function $U(n){switch(n){case 0:return $p;case 1:return AW;case 2:return yW;case 3:return bW;case 4:return vW;case 6:return xW;case 7:return wW;case 5:return CW}return 0}function BXe(n){switch(n){case 1:return xG;case 2:return SW;case 3:return _W;case 4:return MW;case 5:return IW;case 6:return TW;case 7:return EW;case 8:return uI}return xG}const kXe="NEEDLE_render_objects";var GXe=Object.defineProperty,PXe=Object.getOwnPropertyDescriptor,Fse=(n,e,i,s)=>{for(var r=s>1?void 0:s?PXe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&GXe(e,i,r),r};const WL=q("debugreflectionprobe"),Use=q("noreflectionprobe"),NXe=Symbol("reflectionProbeKey"),VXe=Symbol("original material");var HL;const xp=(HL=class extends Oe{constructor(){var n;super(),m(this,"_texture"),m(this,"center"),m(this,"size"),m(this,"_boxHelper"),xp._probes.has(this.context)||xp._probes.set(this.context,[]),(n=xp._probes.get(this.context))==null||n.push(this)}static get(n,e,i,s){if(!n||n.isObject3D!==!0||Use)return null;const r=xp._probes.get(e);if(r){for(const o of r)if(o.__didAwake||o.__internalAwake(),o.enabled&&s&&o.gameObject===s)return o}return WL&&console.debug("Did not find reflection probe",n.name,i,n),null}set texture(n){if(n&&!(n instanceof di)){console.error("ReflectionProbe.texture must be a Texture",n);return}this._texture=n,n&&(n.mapping=ao,n.colorSpace=ut,n.needsUpdate=!0)}get texture(){return this._texture}isInBox(n){var e;return(e=this._boxHelper)==null?void 0:e.isInBox(n)}awake(){this._boxHelper=this.gameObject.addComponent(Oc),this._boxHelper.updateBox(!0),WL&&this._boxHelper.showHelper(5592320,!0),this.texture&&(this.texture.mapping=ao,this.texture.colorSpace=ut,this.texture.needsUpdate=!0)}onDestroy(){const n=xp._probes.get(this.context);if(n){const e=n.indexOf(this);e>=0&&n.splice(e,1)}}onSet(n){var e;if(Use||!this.enabled||((e=n.sharedMaterials)==null?void 0:e.length)<=0||!this.texture)return;let i=xp._rendererMaterialsCache.get(n);i||(i=[],xp._rendererMaterialsCache.set(n,i));for(let s=0;s<n.sharedMaterials.length;s++){const r=n.sharedMaterials[s];if(!r||r.envMap===void 0||r instanceof ai)continue;let o=i[s];const a=r===o?.copy,l=!o||o.material.uuid!==r.uuid||o.copy.version!==r.version;if(!a&&l){if(WL){let d="";o?o.material!==r?d="reference changed; cached instance?: "+a:o.copy.version!==r.version&&(d="version changed"):d="not cached",console.warn("Cloning material",r.name,r.version,"Reason:",d,`
`,r.uuid,`
`,o?.copy.uuid,`
`,n.name)}const h=r.clone();h.version=r.version,o?(o.copy=h,o.material=r):(o={material:r,copy:h},i.push(o)),h[NXe]=this,h[VXe]=r,WL&&console.log("Set reflection",n.name,n.guid)}o&&o.copy&&(o.copy.onBeforeCompile=r.onBeforeCompile);const c=o?.copy;c.envMap=this.texture,n.sharedMaterials[s]=c}}onUnset(n){const e=xp._rendererMaterialsCache.get(n);if(e)for(let i=0;i<e.length;i++){const s=e[i];n.sharedMaterials[i]=s.material}}},m(HL,"_probes",new Map),m(HL,"_rendererMaterialsCache",new Map),HL);let Tv=xp;Fse([T(E)],Tv.prototype,"center",2),Fse([T(E)],Tv.prototype,"size",2);const e3=q("debugexr");class XXe{constructor(e){m(this,"parser"),this.parser=e,e3&&console.log(e)}get name(){return"EXT_texture_exr"}loadTexture(e){const i=this.name,s=this.parser,r=s.json.textures[e];if(e3&&console.log("EXT_texture_exr.loadTexture",e,r),!r.extensions||!r.extensions[i])return null;const o=r.extensions[i],a=new DC(s.options.manager);return e3&&console.log("EXT_texture_exr.loadTexture",o),s.loadTextureImage(e,o.source,a)}}typeof window<"u"&&window.addEventListener("unhandledrejection",n=>{});const wp=Qr,QL="$___Export_Components",DXe="NEEDLE_components";var Ose;class zXe{constructor(){m(this,Ose)}}Ose=c0;class FXe{constructor(e,i,s){m(this,"node"),m(this,"nodeIndex"),m(this,"nodeDef"),this.node=e,this.nodeIndex=i,this.nodeDef=s}}class Zse{constructor(){m(this,"parser"),m(this,"nodeToObjectMap",{}),m(this,"gltf",null),m(this,"exportContext"),m(this,"objectToNodeMap",{}),m(this,"context"),m(this,"writer")}get name(){return DXe}registerExport(e){e.register(i=>{if("serializeUserData"in i){const s=i.serializeUserData.bind(i);this.writer=i,i.serializeUserData=(r,o)=>{try{this.serializeUserData(r,o)&&(i.extensionsUsed[this.name]=!0),s(r,o)}finally{this.afterSerializeUserData(r,o)}}}return this})}beforeParse(){this.exportContext={},this.objectToNodeMap={}}serializeUserData(e,i){var s;const r=(s=e.userData)==null?void 0:s.components;return!r||r.length<=0?!1:(delete e.userData.components,e[QL]=r,!0)}afterSerializeUserData(e,i){if(e.type==="Scene"&&wp&&console.log("DONE",JSON.stringify(i)),e[QL]===void 0)return;const s=e[QL];delete e[QL],s!==null&&(e.userData.components=s)}writeNode(e,i){const s=this.writer.json.nodes.length;wp&&console.log(e.name,s,e.uuid);const r=new FXe(e,s,i);this.exportContext[s]=r,this.objectToNodeMap[e.uuid]=s}afterParse(e){var i;wp&&console.log("AFTER",e);for(const s in this.exportContext){const r=this.exportContext[s],o=r.node,a=r.nodeDef,l=r.nodeIndex,c=(i=o.userData)==null?void 0:i.components;if(!c||c.length<=0)continue;const h=new zXe;a.extensions=a.extensions||{},a.extensions[this.name]=h,this.context.object=o,this.context.nodeId=l,this.context.objectToNode=this.objectToNodeMap;const d=[];for(const u of c){this.context.target=u;const p=fh().writeBuiltinComponentData(u,this.context);p!==null&&d.push(p)}d.length>0&&(h[c0]=d,wp&&console.log("DID WRITE",o,"nodeIndex",l,d))}}beforeRoot(){return wp&&console.log("BEGIN LOAD"),this.nodeToObjectMap={},null}async afterRoot(e){this.gltf=e;const i=e.parser,s=i?.extensions;if(!s)return;const r=s[this.name];wp&&console.log("After root",e,this.parser,s);const o=[];if(r===!0){const a=i.json.nodes;if(a){for(let l=0;l<a.length;l++){const c=await i.getDependency("node",l);this.nodeToObjectMap[l]=c}for(let l=0;l<a.length;l++){const c=a[l],h=l,d=c.extensions;if(!d)continue;const u=d[this.name];if(!u)continue;wp&&console.log("NODE",c);const p=this.nodeToObjectMap[h];if(!p){console.error("Could not find object for node index: "+h,c,i);continue}M2(p),o.push(this.createComponents(p,u))}}}await Promise.all(o);for(const a of i.associations.keys()){const l=i.associations.get(a);if(l?.materials!=null){const c="/materials/"+l.materials;ike(a,c)}}}async createComponents(e,i){if(!i)return;const s=i[c0];if(s){const r=new Array;wp&&console.log(e.name,s);for(const o in s){const a=s[o];wp&&console.log("Serialized data",JSON.parse(JSON.stringify(a))),a&&this.parser&&r.push(Yz(this.parser,a).catch(l=>console.error(`Error while resolving references (see console for details)
`,l,e,a))),e.userData=e.userData||{},e.userData[c0]=e.userData[c0]||[],e.userData[c0].push(a)}await Promise.all(r).catch(o=>{console.error("Error while loading components",o)})}}}const Wse="NEEDLE_gameobject_data";class UXe{constructor(e){m(this,"parser"),this.parser=e}get name(){return Wse}afterRoot(e){var i;const s=[];for(let r=0;r<((i=this.parser.json.nodes)==null?void 0:i.length);r++){const o=this.parser.json.nodes[r];if(o&&o.extensions){const a=o.extensions[Wse];if(a){const l=this.findAndApplyExtensionData(r,a);s.push(l)}}}return Promise.all(s).then(()=>null)}async findAndApplyExtensionData(e,i){const s=await this.parser.getDependency("node",e);s&&this.applyExtensionData(s,i)}applyExtensionData(e,i){i.layers===void 0&&(i.layers=0),e.userData.layer=i.layers,e.layers.disableAll(),e.layers.set(i.layers),e.userData.tag=i.tag??"none",e.userData.hideFlags=i.hideFlags??0,e.userData.static=i.static??!1,e.visible=i.activeSelf??!0,e.guid=i.guid}}const Hse="NEEDLE_lighting_settings",Ev=q("debugenvlight");class OXe{constructor(e,i,s){m(this,"parser"),m(this,"sourceId"),m(this,"context"),this.parser=e,this.sourceId=i,this.context=s}get name(){return Hse}afterRoot(e){const i=this.parser.json.extensions;if(i){const s=i[Hse];if(s){Ev&&console.log('Loaded "'+this.name+'", src: "'+this.sourceId+'"',s);let r;if(e.scene.children.length===1){const o=e.scene.children[0];r=$.addComponent(o,KL,{},{callAwake:!1})}else{const o=new Ae;o.name="LightSettings "+this.sourceId,e.scene.add(o),r=$.addComponent(o,KL,{},{callAwake:!1})}r.sourceId=this.sourceId,r.ambientIntensity=s.ambientIntensity,r.ambientLight=new fe().fromArray(s.ambientLight),Array.isArray(s.ambientTrilight)&&(r.ambientTrilight=s.ambientTrilight.map(o=>new fe().fromArray(o))),r.ambientMode=s.ambientMode,r.environmentReflectionSource=s.environmentReflectionSource}}return null}}ji.registerCallback(nn.ContextCreated,n=>{const e=n.context,i=$.findObjectOfType(KL,e);i!=null&&i.sourceId&&(i.enabled=!0)});class KL extends Oe{constructor(){super(...arguments),m(this,"ambientMode",$b.Skybox),m(this,"ambientLight"),m(this,"ambientTrilight"),m(this,"ambientIntensity",1),m(this,"environmentReflectionSource",H2.Skybox),m(this,"_hasReflection",!1),m(this,"_ambientLightObj"),m(this,"_hemisphereLightObj")}awake(){var e;if(this.sourceId){const s=this.environmentReflectionSource===H2.Skybox?tg.Skybox:tg.Reflection,r=this.context.lightmaps.tryGet(this.sourceId,s,0);this._hasReflection=r!=null,r&&this.context.sceneLighting.internalRegisterReflection(this.sourceId,r)}this.enabled=!1,this.context.sceneLighting.internalRegisterSceneLightSettings(this),Ev&&window.addEventListener("keydown",s=>{if(!this.destroyed)switch(s.key){case"l":this.enabled=!this.enabled;break}});const i=(e=this.gameObject.userData)==null?void 0:e.components;if(i){const s=i.indexOf(this);i.splice(s,1),i.push(this)}}onDestroy(){this.context.sceneLighting.internalUnregisterSceneLightSettings(this)}calculateIntensityFactor(e){const i=Math.max(e.r,e.g,e.b);return 2.2*lt.lerp(0,1.33,i)}onEnable(){if(Ev&&console.warn("\u{1F4A1}\u{1F7E1} >>> Enable lighting",this.sourceId,this.enabled,this),this.ambientMode==$b.Flat){if(this.ambientLight&&!this._ambientLightObj){const e=this.calculateIntensityFactor(this.ambientLight);this._ambientLightObj=new S1(this.ambientLight,this.ambientIntensity*e),Ev&&console.log("Created ambient light",this.sourceId,this._ambientLightObj,this.ambientIntensity,e)}this._ambientLightObj&&this.gameObject.add(this._ambientLightObj)}else if(this.ambientMode===$b.Trilight){if(this.ambientTrilight){const e=this.ambientTrilight[0],i=this.ambientTrilight[this.ambientTrilight.length-1],s=this.calculateIntensityFactor(i);this._hemisphereLightObj=new fT(i,e,this.ambientIntensity*s),this.gameObject.add(this._hemisphereLightObj),Ev&&console.log("Created hemisphere ambient light",this.sourceId,this._hemisphereLightObj,this.ambientIntensity,s)}}else this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent();this.sourceId&&this.context.sceneLighting.internalEnableReflection(this.sourceId)}onDisable(){Ev&&console.warn("\u{1F4A1}\u26AB <<< Disable lighting:",this.sourceId,this),this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent(),this.sourceId&&this.context.sceneLighting.internalDisableReflection(this.sourceId)}}var Qse=(n=>(n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_3D=35680]="SAMPLER_3D",n[n.SAMPLER_CUBE=35681]="SAMPLER_CUBE",n[n.UNKNOWN=0]="UNKNOWN",n))(Qse||{});const jd=q("debugcustomshader"),Rv="NEEDLE_techniques_webgl";class ZXe{constructor(){m(this,"objectToWorldMatrix",new de),m(this,"worldToObjectMatrix",new de),m(this,"objectToWorld",new Array),m(this,"worldToObject",new Array)}updateFrom(e){this.objectToWorldMatrix.copy(e.matrixWorld),W2(this.objectToWorldMatrix,this.objectToWorld),this.worldToObjectMatrix.copy(e.matrixWorld).invert(),W2(this.worldToObjectMatrix,this.worldToObject)}}const Cs=class extends dT{constructor(n,...e){super(...e),m(this,"identifier"),m(this,"onBeforeRenderSceneCallback",this.onBeforeRenderScene.bind(this)),m(this,"_sphericalHarmonicsName","unity_SpecCube0"),m(this,"_objToWorldName","hlslcc_mtx4x4unity_ObjectToWorld"),m(this,"_worldToObjectName","hlslcc_mtx4x4unity_WorldToObject"),m(this,"_viewProjectionName","hlslcc_mtx4x4unity_MatrixVP"),m(this,"_viewMatrixName","hlslcc_mtx4x4unity_MatrixV"),m(this,"_rendererData",new ZXe),this.identifier=n,jd&&console.log(this),this.type="NEEDLE_CUSTOM_SHADER",this.uniforms[this._objToWorldName]||(this.uniforms[this._objToWorldName]={value:[]}),this.uniforms[this._worldToObjectName]||(this.uniforms[this._worldToObjectName]={value:[]}),this.uniforms[this._viewProjectionName]||(this.uniforms[this._viewProjectionName]={value:[]}),this.uniforms[this._sphericalHarmonicsName],(this.depthTextureUniform||this.opaqueTextureUniform)&&$t.Current.pre_render_callbacks.push(this.onBeforeRenderSceneCallback)}clone(){const n=super.clone();return Kse(n),n}dispose(){super.dispose();const n=$t.Current.pre_render_callbacks.indexOf(this.onBeforeRenderSceneCallback);n>=0&&$t.Current.pre_render_callbacks.splice(n,1)}get depthTextureUniform(){if(this.uniforms)return this.uniforms._CameraDepthTexture}get opaqueTextureUniform(){if(this.uniforms)return this.uniforms._CameraOpaqueTexture}onBeforeRenderScene(){this.opaqueTextureUniform&&$t.Current.setRequireColor(!0),this.depthTextureUniform&&$t.Current.setRequireDepth(!0)}onBeforeRender(n,e,i,s,r,o){s.attributes.tangent||s.computeTangents(),this.onUpdateUniforms(i,r)}onUpdateUniforms(n,e){const i=$t.Current;if(n&&(Cs.viewProjection&&this.uniforms[this._viewProjectionName]&&(Cs.viewProjection.copy(n.projectionMatrix).multiply(n.matrixWorldInverse),W2(Cs.viewProjection,Cs._viewProjectionValues)),Cs.viewMatrix&&this.uniforms[this._viewMatrixName]&&(Cs.viewMatrix.copy(n.matrixWorldInverse),W2(Cs.viewMatrix,Cs._viewMatrixValues)),this.uniforms[Cs._worldSpaceCameraPosName]&&Cs._worldSpaceCameraPos.setFromMatrixPosition(n.matrixWorld)),this.uniforms._TimeParameters&&(this.uniforms._TimeParameters.value=i.sceneLighting.timeVec4),this.uniforms._Time){const a=this.uniforms._Time.value;a.x=i.sceneLighting.timeVec4.x/20,a.y=i.sceneLighting.timeVec4.x,a.z=i.sceneLighting.timeVec4.x*2,a.w=i.sceneLighting.timeVec4.x*3}if(this.uniforms._SinTime){const a=this.uniforms._SinTime.value;a.x=Math.sin(i.sceneLighting.timeVec4.x/8),a.y=Math.sin(i.sceneLighting.timeVec4.x/4),a.z=Math.sin(i.sceneLighting.timeVec4.x/2),a.w=Math.sin(i.sceneLighting.timeVec4.x)}if(this.uniforms._CosTime){const a=this.uniforms._CosTime.value;a.x=Math.cos(i.sceneLighting.timeVec4.x/8),a.y=Math.cos(i.sceneLighting.timeVec4.x/4),a.z=Math.cos(i.sceneLighting.timeVec4.x/2),a.w=Math.cos(i.sceneLighting.timeVec4.x)}if(this.uniforms.unity_DeltaTime){const a=this.uniforms.unity_DeltaTime.value;a.x=i.time.deltaTime,a.y=1/i.time.deltaTime,a.z=i.time.smoothedDeltaTime,a.w=1/i.time.smoothedDeltaTime}const s=i.mainLight;if(s){const a=ri(s.gameObject,Cs._mainLightPosition);this.uniforms._MainLightPosition={value:a.normalize()},Cs._mainLightColor.set(s.color.r,s.color.g,s.color.b,0),this.uniforms._MainLightColor={value:Cs._mainLightColor};const l=s.intensity;Cs._lightData.z=l,this.uniforms.unity_LightData={value:Cs._lightData}}if(n&&(Cs.viewProjection&&this.uniforms[this._viewProjectionName]&&(this.uniforms[this._viewProjectionName].value=Cs._viewProjectionValues),Cs.viewMatrix&&this.uniforms[this._viewMatrixName]&&(this.uniforms[this._viewMatrixName].value=Cs._viewMatrixValues),this.uniforms[Cs._worldSpaceCameraPosName]&&(this.uniforms[Cs._worldSpaceCameraPosName]={value:Cs._worldSpaceCameraPos}),i.mainCameraComponent)){if(this.uniforms._ProjectionParams){const a=this.uniforms._ProjectionParams.value;a.x=1,a.y=i.mainCameraComponent.nearClipPlane,a.z=i.mainCameraComponent.farClipPlane,a.w=1/a.z,this.uniforms._ProjectionParams.value=a}if(this.uniforms._ZBufferParams){const a=this.uniforms._ZBufferParams.value,l=i.mainCameraComponent;a.x=1-l.farClipPlane/l.nearClipPlane,a.y=l.farClipPlane/l.nearClipPlane,a.z=a.x/l.farClipPlane,a.w=a.y/l.farClipPlane,this.uniforms._ZBufferParams.value=a}if(this.uniforms._ScreenParams){const a=this.uniforms._ScreenParams.value;a.x=i.domWidth,a.y=i.domHeight,a.z=1+1/a.x,a.w=1+1/a.y,this.uniforms._ScreenParams.value=a}if(this.uniforms._ScaledScreenParams){const a=this.uniforms._ScaledScreenParams.value;a.x=i.domWidth,a.y=i.domHeight,a.z=1+1/a.x,a.w=1+1/a.y,this.uniforms._ScaledScreenParams.value=a}}const r=this.depthTextureUniform;r&&(r.value=i.depthTexture);const o=this.opaqueTextureUniform;if(o&&(o.value=i.opaqueColorTexture),e){const a=this._rendererData;a.updateFrom(e),this.uniforms[this._worldToObjectName].value=a.worldToObject,this.uniforms[this._objToWorldName].value=a.objectToWorld}this.uniformsNeedUpdate=!0}};let Fh=Cs;m(Fh,"viewProjection",new de),m(Fh,"_viewProjectionValues",[]),m(Fh,"viewMatrix",new de),m(Fh,"_viewMatrixValues",[]),m(Fh,"_worldSpaceCameraPosName","_WorldSpaceCameraPos"),m(Fh,"_worldSpaceCameraPos",new E),m(Fh,"_mainLightColor",new $e),m(Fh,"_mainLightPosition",new E),m(Fh,"_lightData",new $e);class WXe{constructor(e,i){m(this,"parser"),m(this,"identifier"),this.parser=e,this.identifier=i}get name(){return Rv}loadMaterial(e){const i=this.parser.json.materials[e];if(!i)return jd&&console.log(e,this.parser.json.materials),null;if(!i.extensions||!i.extensions[Rv])return jd&&console.log(`Material ${e} does not use NEEDLE_techniques_webgl`),null;jd&&console.log(`Material ${e} uses NEEDLE_techniques_webgl`,i);const s=i.extensions[Rv].technique;if(s<0)return console.debug(`Material ${e} does not have a valid technique index`),null;const r=this.parser.json.extensions[Rv];if(!r)return jd?console.error("Missing shader data",this.parser.json.extensions):console.debug("Missing custom shader data in parser.json.extensions"),null;jd&&console.log(r);const o=r.techniques[s];return o?new Promise(async(a,l)=>{var c,h,d;const u=await hGe(r,o.program),p=u?.fragmentShader,g=u?.vertexShader;if(!p||!g)return l();jd&&console.log("loadMaterial",i,u);const f={},A=o.uniforms;(g.includes("_Time")||p.includes("_Time"))&&(f._Time={value:new $e(0,0,0,0)}),(g.includes("_SinTime")||p.includes("_SinTime"))&&(f._SinTime={value:new $e(0,0,0,0)}),(g.includes("_CosTime")||p.includes("_CosTime"))&&(f._CosTime={value:new $e(0,0,0,0)}),(g.includes("unity_DeltaTime")||p.includes("unity_DeltaTime"))&&(f.unity_DeltaTime={value:new $e(0,0,0,0)});for(const v in A){const x=v;switch(x){case"_TimeParameters":const w=new $e;f[x]={value:w};break;case"hlslcc_mtx4x4unity_MatrixV":case"hlslcc_mtx4x4unity_MatrixVP":f[x]={value:[]};break;case"_MainLightPosition":case"_MainLightColor":case"_WorldSpaceCameraPos":f[x]={value:[0,0,0,1]};break;case"unity_OrthoParams":break;case"unity_SpecCube0":f[x]={value:null};break;default:case"_ScreenParams":case"_ZBufferParams":case"_ProjectionParams":f[x]={value:[0,0,0,0]};break;case"_CameraOpaqueTexture":case"_CameraDepthTexture":f[x]={value:null};break}}let y=!1;if(i.extensions&&i.extensions[Rv]){const v=i.extensions[Rv];if(v.technique===s){jd&&console.log(i.name,"Material Properties",v);for(const x in v.values){const w=v.values[x];if(typeof w=="string"){if(w.startsWith("/textures/")){const C=w.substring(10),S=Number.parseInt(C);if(S>=0){const _=await this.parser.getDependency("texture",S);_ instanceof di&&(_.colorSpace=qi,_.needsUpdate=!0),f[x]={value:_};continue}}switch(x){case"alphaMode":w==="BLEND"&&(y=!0);continue}}if(Array.isArray(w)&&w.length===4){f[x]={value:new $e(w[0],w[1],w[2],w[3])};continue}f[x]={value:w}}}}const b=new Fh(this.identifier,{name:i.name??"",uniforms:f,vertexShader:g,fragmentShader:p,lights:!1});switch(b.glslVersion=pI,b.vertexShader=b.vertexShader.replace("#version 300 es",""),b.fragmentShader=b.fragmentShader.replace("#version 300 es",""),(c=f._Cull)==null?void 0:c.value){case 0:b.side=Qi;break;case 1:b.side=wn;break;case 2:b.side=ms;break;default:b.side=ms;break}switch((h=f._ZTest)==null?void 0:h.value){case 3:b.depthTest=!0,b.depthFunc=Qp;break;case 6:b.depthTest=!0,b.depthFunc=of;break;case 2:b.depthTest=!0,b.depthFunc=rf;break;case 4:b.depthTest=!0,b.depthFunc=yu;break;case 5:b.depthTest=!0,b.depthFunc=ZA;break;case 7:b.depthTest=!0,b.depthFunc=OA;break;case 8:b.depthTest=!1,b.depthFunc=UA;break}b.transparent=y,y&&(b.depthWrite=!1),lGe(f),b.onUpdateUniforms();for(const v in A){const x=v,w=A[v].type;if(((d=f[x])==null?void 0:d.value)===void 0)switch(w){case Qse.SAMPLER_2D:f[x]={value:oGe},console.warn("Missing/unassigned texture, fallback to white: "+x);break;default:x==="unity_OrthoParams"||console.warn("TODO: EXPECTED UNIFORM / fallback NOT SET: "+x,A[v]);break}}jd&&console.log(b.uuid,f),Kse(b),a(b)}):null}}function Kse(n){if(n.uniforms){jd&&console.log("Uniforms:",n.uniforms);for(const i in n.uniforms)switch(e(i,i),i){case"_Color":e("color",i);break}}function e(i,s){Object.getOwnPropertyDescriptor(n,i)||Object.defineProperty(n,i,{get:()=>n.uniforms[s].value,set:r=>{n.uniforms[s].value=r,n.needsUpdate=!0}})}}const HXe=q("debugextensions");let YL;const QXe=Promise.resolve().then(()=>GWe).then(async n=>(YL=n.GLTFAnimationPointerExtension,YL)).catch(n=>{console.warn("Failed to import GLTFLoaderAnimationPointer. Please use @needle-tools/three for full KHR_animation support",n)}),tA=new Array;function KXe(n){tA.includes(n)||tA.push(n)}function YXe(n){const e=tA.indexOf(n);e>=0&&tA.splice(e,1)}function jL(n){const e=new Zse;return n.register(i=>(e.parser=i,e)),e}class jXe{resolvePath(e){return e.includes("/extensions/builtin_components/")?e.replace("/extensions/builtin_components/","/userData/components/"):e.includes("extensions/builtin_components/")?e.replace("extensions/builtin_components/","/userData/components/"):e}}async function JL(n,e,i){const s=i.indexOf("?");s>=0&&(i=i.substring(0,s)),n.register(r=>new UXe(r)),n.register(r=>new ske(r)),n.register(r=>new iGe(r,e.lightmaps,i)),n.register(r=>new OXe(r,i,e)),n.register(r=>new WXe(r,i)),n.register(r=>new qU(r,i)),n.register(r=>new Fi(r,i)),n.register(r=>new XXe(r)),mte()&&n.register(r=>new kz(r)),await QXe.catch(r=>{}),n.register(r=>{if(YL){const o=new YL(r);return o.setAnimationPointerResolver.bind(o)(new jXe),o}else return(HXe||Je())&&console.error("Missing KHR_animation_pointer extension..."),{name:"KHR_animation_pointer_NOT_AVAILABLE"}});for(const r of tA)r.onImport&&r.onImport(n,i,e)}function t3(n,e){for(const i of tA)i.onExport&&i.onExport(n,e)}function i3(n,e,i){for(const s of tA)s.onLoaded&&s.onLoaded(n,e,i)}const Zc=q("debuginstancing"),Yse=class{constructor(){m(this,"objs",[])}setup(n,e,i,s,r,o=0){n.applySettings(e);const a=this.tryCreateOrAddInstance(e,i,r);if(a){s===null&&(s=[]),s.push(a),Fi.assignTextureLOD(a.renderer.material,0);for(const l of n.sharedMeshes){const c=l.geometry;Fi.assignMeshLOD(l,0).then(h=>{h&&n.activeAndEnabled&&c!=h&&a.setGeometry(h)})}}else if(o<=0&&e.type!=="Mesh"){const l=o+1;for(const c of e.children)s=this.setup(n,c,i,s,r,l)}return o===0&&r.useMatrixWorldAutoUpdate&&s&&s.length>=0&&this.autoUpdateInstanceMatrix(e),s}tryCreateOrAddInstance(n,e,i){if(n.type==="Mesh"){const s=i.foundMeshes;if(i.foundMeshes+=1,!i.rend.enableInstancing)return null;if(i.rend.enableInstancing!==!0){if(s>=i.rend.enableInstancing.length)return Zc&&console.error("Something is wrong with instance setup",n,i.rend.enableInstancing,s),null;if(!i.rend.enableInstancing[s])return null}const r=n,o=r.material;for(const h of this.objs)if(!!h.canAdd(r.geometry,o))return h.addInstance(r);const a=16;let l=n.name;l!=null&&l.length||(l=d6());const c=new jse(l,r.geometry,o,a,e);return this.objs.push(c),c.addInstance(r)}return null}autoUpdateInstanceMatrix(n){const e=n.matrixWorld.multiplyMatrices.bind(n.matrixWorld),i=n.matrixWorld.clone(),s=(r,o)=>{const a=e(r,o);return(n[xC]||i.equals(a)===!1)&&(i.copy(a),n[xC]=!0),a};n.matrixWorld.multiplyMatrices=s}};let Lv=Yse;m(Lv,"instance",new Yse);const qL=class{constructor(n,e){m(this,"object"),m(this,"renderer"),m(this,"__instanceIndex",-1),m(this,"__reservedVertexRange",0),m(this,"__reservedIndexRange",0),m(this,"__geometryIndex",-1),m(this,"meshInformation"),this.__instanceIndex=-1,this.object=n,this.renderer=e,n[vte]=e,this.meshInformation=Bv(n.geometry),qL.all.push(this)}get name(){return this.object.name}get isActive(){return this.__instanceIndex>=0}get vertexCount(){return this.object.geometry.attributes.position.count}get maxVertexCount(){return this.meshInformation.vertexCount}get reservedVertexCount(){return this.__reservedVertexRange}get indexCount(){return this.object.geometry.index?this.object.geometry.index.count:0}get maxIndexCount(){return this.meshInformation.indexCount}get reservedIndexCount(){return this.__reservedIndexRange}updateInstanceMatrix(n=!1,e=!0){this.__instanceIndex<0||(e&&this.object.updateWorldMatrix(!0,n),this.renderer.updateInstance(this.object.matrixWorld,this.__instanceIndex))}setMatrix(n){this.__instanceIndex<0||this.renderer.updateInstance(n,this.__instanceIndex)}setGeometry(n){return this.__geometryIndex<0?!1:this.vertexCount>this.__reservedVertexRange?(console.error(`Cannot update geometry, reserved vertex range is too small: ${this.__reservedVertexRange} < ${this.vertexCount} vertices for ${this.name}`),!1):this.indexCount>this.__reservedIndexRange?(console.error(`Cannot update geometry, reserved index range is too small: ${this.__reservedIndexRange} < ${this.indexCount} indices for ${this.name}`),!1):this.renderer.updateGeometry(n,this.__geometryIndex)}add(){this.__instanceIndex>=0||(this.renderer.add(this),$.markAsInstancedRendered(this.object,!0))}remove(n){if(!(this.__instanceIndex<0)&&(this.renderer.remove(this,n),$.markAsInstancedRendered(this.object,!1),n)){const e=qL.all.indexOf(this);e>=0&&qL.all.splice(e,1)}}};let RS=qL;m(RS,"all",[]);class jse{constructor(e,i,s,r,o){m(this,"allowResize",!0),m(this,"name",""),m(this,"geometry"),m(this,"material"),m(this,"_context"),m(this,"_batchedMesh"),m(this,"_handles",[]),m(this,"_geometryIds",new Map),m(this,"_maxInstanceCount"),m(this,"_currentInstanceCount",0),m(this,"_currentVertexCount",0),m(this,"_currentIndexCount",0),m(this,"_maxVertexCount"),m(this,"_maxIndexCount"),m(this,"_needUpdateBounds",!1),m(this,"_debugMaterial",null),m(this,"onBeforeRender",()=>{this._batchedMesh.layers.enableAll(),this._needUpdateBounds&&this._batchedMesh[wC]===!0&&(Zc&&console.log("Update instancing bounds",this.name,this._batchedMesh.matrixWorldNeedsUpdate),this.updateBounds())}),m(this,"onAfterRender",()=>{this._batchedMesh.layers.disableAll()}),m(this,"_availableBuckets",new Array),m(this,"_usedBuckets",new Array),this.name=e,this.geometry=i,this.material=s,this._context=o,this._maxInstanceCount=Math.max(2,r),Zc&&(this._debugMaterial=Jse());const a=this.tryEstimateVertexCountSize(this._maxInstanceCount,[i],r);this._maxVertexCount=a.vertexCount,this._maxIndexCount=a.indexCount,this._batchedMesh=new u1(this._maxInstanceCount,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material),this._batchedMesh[wC]=!0,this._batchedMesh.visible=!0,this._context.scene.add(this._batchedMesh),s instanceof dT&&(s.defines.USE_INSTANCING=!0,s.needsUpdate=!0),o.pre_render_callbacks.push(this.onBeforeRender),o.post_render_callbacks.push(this.onAfterRender),Zc&&console.log(`Instanced renderer created with ${this._maxInstanceCount} instances, ${this._maxVertexCount} max vertices and ${this._maxIndexCount} max indices for "${e}"`)}get batchedMesh(){return this._batchedMesh}get visible(){return this._batchedMesh.visible}set visible(e){this._batchedMesh.visible=e}get castShadow(){return this._batchedMesh.castShadow}set castShadow(e){this._batchedMesh.castShadow=e}set receiveShadow(e){this._batchedMesh.receiveShadow=e}get count(){return this._currentInstanceCount}updateBounds(e=!0,i=!0){this._needUpdateBounds=!1,e&&this._batchedMesh.computeBoundingBox(),i&&this._batchedMesh.computeBoundingSphere()}canAdd(e,i){return this._maxVertexCount>1e7||i!==this.material||!this.validateGeometry(e)?!1:!!(!this.mustGrow(e)||this.allowResize)}dispose(){Zc&&console.warn("Dispose instanced renderer",this.name),this._context.scene.remove(this._batchedMesh),this._batchedMesh.dispose(),this._batchedMesh=null,this._handles=[]}addInstance(e){const i=new RS(e,this);e.castShadow===!0&&this._batchedMesh.castShadow===!1&&(this._batchedMesh.castShadow=!0),e.receiveShadow===!0&&this._batchedMesh.receiveShadow===!1&&(this._batchedMesh.receiveShadow=!0);try{this.add(i)}catch(s){return console.error(`Failed adding mesh to instancing
`,s),Je()&&Mw("Failed instancing mesh. See the browser console for details."),null}return i}add(e){const i=e.object.geometry;if(!i||!i.attributes)return console.error("Cannot add object to instancing without geometry",e.name),!1;if(this.mustGrow(i))if(this.allowResize)this.grow(i);else return console.error("Cannot add instance, max count reached",this.name,this.count,this._maxInstanceCount),!1;return e.object.updateWorldMatrix(!0,!0),this.addGeometry(e),this._handles[e.__instanceIndex]=e,this._currentInstanceCount+=1,this.markNeedsUpdate(),this._currentInstanceCount>0&&(this._batchedMesh.visible=!0),!0}remove(e,i){e&&(e.__instanceIndex<0||this._handles[e.__instanceIndex]!=e||this._currentInstanceCount<=0||(this.removeGeometry(e,i),this._handles[e.__instanceIndex]=null,e.__instanceIndex=-1,this._currentInstanceCount>0&&(this._currentInstanceCount-=1),this._currentInstanceCount<=0&&(this._batchedMesh.visible=!1),this.markNeedsUpdate()))}updateInstance(e,i){this._batchedMesh.setMatrixAt(i,e),this.markNeedsUpdate()}updateGeometry(e,i){return this.validateGeometry(e)?(this.mustGrow()&&this.grow(e),Zc&&console.debug("UPDATE MESH",i,this._batchedMesh._geometryCount,e.name,Bv(e),e.attributes.position.count,e.index?e.index.count:0),this._batchedMesh.setGeometryAt(i,e),this.markNeedsUpdate(),!0):!1}validateGeometry(e){const i=this.geometry;for(const s in i.attributes)if(s!=="batchId"&&!e.hasAttribute(s))return Je()&&console.warn(`BatchedMesh: Added geometry missing "${s}". All geometries must have consistent attributes.`),!1;return!0}markNeedsUpdate(){Zc&&console.warn("Marking instanced mesh dirty",this.name),this._needUpdateBounds=!0}mustGrow(e){if(this.count>=this._maxInstanceCount)return!0;if(!e||!e.attributes)return!1;const i=Bv(e),s=i.vertexCount,r=i.indexCount;return this._currentVertexCount+s>this._maxVertexCount||this._currentIndexCount+r>this._maxIndexCount}grow(e){const i=this._maxInstanceCount*2,s=this.tryEstimateVertexCountSize(i,[e]),r=Math.max(this._maxVertexCount,s.vertexCount),o=Math.max(this._maxIndexCount,s.indexCount,this._maxVertexCount*2);if(Zc){const c=Bv(e);console.warn(`Growing batched mesh for "${this.name}/${e.name}" ${c.vertexCount} vertices, ${c.indexCount} indices
Max count ${this._maxInstanceCount} \u2192 ${i}
Max vertex count ${this._maxVertexCount} -> ${r}
Max index count ${this._maxIndexCount} -> ${o}`),this._debugMaterial=Jse()}this._maxVertexCount=r,this._maxIndexCount=o;const a=new u1(i,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material);a.layers=this._batchedMesh.layers,a.castShadow=this._batchedMesh.castShadow,a.receiveShadow=this._batchedMesh.receiveShadow,a.visible=this._batchedMesh.visible,a[wC]=this._batchedMesh[wC],a.matrixAutoUpdate=this._batchedMesh.matrixAutoUpdate,a.matrixWorldNeedsUpdate=this._batchedMesh.matrixWorldNeedsUpdate,a.matrixAutoUpdate=this._batchedMesh.matrixAutoUpdate,a.matrixWorld.copy(this._batchedMesh.matrixWorld),a.matrix.copy(this._batchedMesh.matrix),this._batchedMesh.dispose(),this._batchedMesh.removeFromParent(),this._geometryIds.clear(),this._batchedMesh=a,this._maxInstanceCount=i,this._usedBuckets.length=0,this._availableBuckets.length=0;const l=[...this._handles];this._handles=[];for(const c of l)c&&c.__instanceIndex>=0&&(this.addGeometry(c),this._handles[c.__instanceIndex]=c);this._context.scene.add(a)}tryEstimateVertexCountSize(e,i,s=1){const r=new Map;for(const h of this._handles)if(h&&h.__instanceIndex>=0&&h.object.geometry)if(r.has(h.object.geometry)){const d=r.get(h.object.geometry);d.count+=1}else{const d={count:1,...Bv(h.object.geometry)};r.set(h.object.geometry,d)}let o=0,a=0;for(const[h,d]of r)o+=d.vertexCount*d.count,a+=d.indexCount*d.count;let l=Math.ceil(o/Math.max(1,this._currentInstanceCount))*e,c=Math.ceil(a/Math.max(1,this._currentInstanceCount))*e*2;if(i)for(const h of i){const d=Bv(h);d!=null&&(l+=d.vertexCount*s,c+=d.indexCount*s)}return{vertexCount:l,indexCount:c}}addGeometry(e){const i=e.object.geometry;if(!i)return;let s=null,r=-1;for(let l=this._availableBuckets.length-1;l>=0;l--){const c=this._availableBuckets[l];c.vertexCount>=e.maxVertexCount&&c.indexCount>=e.maxIndexCount&&(s==null||c.vertexCount<s.vertexCount)&&(s=c,r=l)}if(s!=null){const l=s;Zc&&console.debug(`RE-USE SPACE #${l.geometryIndex}, ${e.maxVertexCount} vertices, ${e.maxIndexCount} indices, ${e.name}`);try{this._batchedMesh.setGeometryAt(l.geometryIndex,e.object.geometry);const c=this._batchedMesh.addInstance(l.geometryIndex);this._batchedMesh.setMatrixAt(c,e.object.matrixWorld),this._batchedMesh.setVisibleAt(c,!0),e.__instanceIndex=c,this._usedBuckets[l.geometryIndex]=l,this._availableBuckets.splice(r,1);return}catch(c){Zc?console.error("Failed to re-use space",c):Je()&&c instanceof Error&&console.warn(`Failed to re-use space "${c.message}" in bucket ${l.geometryIndex} (${l.vertexCount}) - will add new geometry instead`)}}Zc&&console.debug("ADD GEOMETRY",i.name,`
vertex:`,`${this._currentVertexCount} + ${e.maxVertexCount} < ${this._maxVertexCount}?`,`
index:`,e.maxIndexCount,this._currentIndexCount,this._maxIndexCount);let o=this._geometryIds.get(i);o==null&&(o=this._batchedMesh.addGeometry(i,e.maxVertexCount,e.maxIndexCount),this._geometryIds.set(i,o));const a=this._batchedMesh.addInstance(o);e.__geometryIndex=o,e.__instanceIndex=a,e.__reservedVertexRange=e.maxVertexCount,e.__reservedIndexRange=e.maxIndexCount,this._currentVertexCount+=e.maxVertexCount,this._currentIndexCount+=e.maxIndexCount,this._usedBuckets[a]={geometryIndex:o,vertexCount:e.maxVertexCount,indexCount:e.maxIndexCount},this._batchedMesh.setMatrixAt(a,e.object.matrixWorld),Zc&&console.debug(`ADD MESH & RESERVE SPACE #${a}, ${e.maxVertexCount} vertices, ${e.maxIndexCount} indices, ${e.name} ${e.object.uuid}`)}removeGeometry(e,i){if(e.__instanceIndex<0){console.warn("Cannot remove geometry, instance index is invalid",e.name);return}this._usedBuckets.splice(e.__instanceIndex,1),this._batchedMesh.deleteInstance(e.__instanceIndex),this._availableBuckets.push({geometryIndex:e.__geometryIndex,vertexCount:e.reservedVertexCount,indexCount:e.reservedIndexCount})}}m(jse,"nullMatrix",new de);function Bv(n){var e,i;if(!n)return Je()&&console.error("Cannot get mesh information from null geometry"),{vertexCount:0,indexCount:0};let s=((i=(e=n.attributes)==null?void 0:e.position)==null?void 0:i.count)||0,r=n.index?n.index.count:0;const o=Fi.getMeshLODInformation(n);if(o){const a=o.lods[0];let l=a.vertexCount,c=a.indexCount;const h=Math.min(128,Math.ceil(l*.15));l+=h,c+=20,s=Math.max(s,l),r=Math.max(r,c)}return s=Math.ceil(s),r=Math.ceil(r),{vertexCount:s,indexCount:r}}function Jse(){const n=new Us({color:new fe(Math.random(),Math.random(),Math.random())});return n.emissive=n.color,n.emissiveIntensity=.3,q("wireframe")&&(n.wireframe=!0),n}const kv=q("debuglightmaps");class LS{constructor(e,i){m(this,"lightmapIndex",-1),m(this,"lightmapScaleOffset",new $e(1,1,0,0)),m(this,"context"),m(this,"gameObject"),m(this,"lightmapTexture",null),m(this,"lightmapScaleOffsetUniform",{value:new $e(1,1,0,0)}),m(this,"lightmapUniform",{value:null}),m(this,"onBeforeCompile",(s,r)=>{kv&&console.log(`Lightmaps, before compile
`,s),this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,this.lightmapUniform.value=this.lightmapTexture,s.uniforms.lightmapScaleOffset=this.lightmapScaleOffsetUniform}),this.gameObject=e,this.context=i}get lightmap(){return this.lightmapTexture}set lightmap(e){e!==this.lightmapTexture&&(this.lightmapTexture=e,this.applyLightmap(),this.lightmapTexture&&Fi.assignTextureLOD(this.lightmapTexture,0).then(i=>{i!=null&&i.isTexture&&(this.lightmapTexture=i)}))}init(e,i,s){console.assert(this.gameObject!==void 0&&this.gameObject!==null,"Missing gameobject",this),this.lightmapIndex=e,!(this.lightmapIndex<0)&&(this.lightmapScaleOffset=i,this.lightmapTexture=s,Fi.assignTextureLOD(s,0).then(r=>{r!=null&&r.isTexture&&(this.lightmapTexture=r)}),kv=="show"?(console.log("Lightmap:",this.gameObject.name,e,`
ScaleOffset:`,i,`
Texture:`,s),this.setLightmapDebugMaterial()):kv&&console.log("Use debuglightmaps=show to render lightmaps only in the scene."),this.applyLightmap())}updateLightmapUniforms(e){const i=e.uniforms;i&&i.lightmap&&(this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,i.lightmapScaleOffset=this.lightmapScaleOffsetUniform)}applyLightmap(){if(this.gameObject.type==="Object3D"){kv&&console.warn("Can not add lightmap. Is this object missing a renderer?",this.gameObject.name);return}if(this.gameObject.type==="Group"){this.gameObject["Needle:Multimaterial-LightmapWarning"]===void 0&&(this.gameObject["Needle:Multimaterial-LightmapWarning"]=!0,console.warn("Lightmap on multimaterial object is not supported yet... please open a feature request on https://github.com/needle-tools/needle-engine-support if your project requires it"));return}console.assert(this.gameObject.type==="Mesh","Lightmap only works on meshes",this);const e=this.gameObject;if(e.geometry.getAttribute("uv1")||e.geometry.setAttribute("uv1",e.geometry.getAttribute("uv")),Array.isArray(this.gameObject.material)){const i=this.gameObject.material;for(let s=0;s<i.length;s++)i[s]=this.ensureLightmapMaterial(i[s])}else this.gameObject.material=this.ensureLightmapMaterial(this.gameObject.material);if(this.lightmapIndex>=0&&this.lightmapTexture){this.lightmapTexture.channel=1;const i=this.gameObject.material;if(Array.isArray(i))for(const s of i)this.assignLightmapTexture(s);else i&&this.assignLightmapTexture(i)}}ensureLightmapMaterial(e){return e.userData||(e.userData={}),e["NEEDLE:lightmap-material-version"]!=e.version&&e["NEEDLE:lightmap-material-version"]==null&&(kv&&console.warn("Cloning material for lightmap "+e.name),e=e.clone(),e.onBeforeCompile=this.onBeforeCompile),e}assignLightmapTexture(e){!e||e instanceof uo&&e.transmission>0||!(e.lightMap!==this.lightmapTexture||e["NEEDLE:lightmap-material-version"]!==e.version)||(kv&&console.log("Assigning lightmap",e.name,e.version),e.lightMap=this.lightmapTexture,e["NEEDLE:lightmap-material-version"]=e.version)}setLightmapDebugMaterial(){this.gameObject.material=new jt({vertexShader:`
                varying vec2 vUv1;
                void main()
                {
                    vUv1 = uv1;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
                }
                `,fragmentShader:`
                uniform sampler2D lightMap;
                uniform float lightMapIntensity;
                uniform vec4 lightmapScaleOffset;
                varying vec2 vUv1;

                // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
                vec4 conv_sRGBToLinear( in vec4 value ) {
                    return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
                }

                void main() {
                    vec2 lUv = vUv1.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
                    
                    vec4 lightMapTexel = texture2D( lightMap, lUv);
                    gl_FragColor = lightMapTexel;
                    gl_FragColor.a = 1.;
                }
                `,defines:{USE_LIGHTMAP:""}})}}var JXe=Object.defineProperty,qXe=Object.getOwnPropertyDescriptor,Cp=(n,e,i,s)=>{for(var r=s>1?void 0:s?qXe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&JXe(e,i,r),r};const BS=q("debugrenderer"),qse=q("debugskinnedmesh"),$se=q("noinstancing"),$Xe=q("wireframe");class n3{constructor(){m(this,"path",null),m(this,"asset",null),m(this,"default")}}class eDe{constructor(e,i){m(this,"_renderer"),m(this,"_targets",[]),m(this,"_indexMapMaxIndex"),m(this,"_indexMap"),m(this,"_changed",!1),this._renderer=e;const s=this.setMaterial.bind(this),r=this.getMaterial.bind(this),o=e.gameObject;if(this._targets=[],o)switch(o.type){case"Group":this._targets=[...o.children];break;case"SkinnedMesh":case"Mesh":this._targets.push(o);break}let a=!1,l,c=0;for(let h=0;h<this._targets.length;h++){const d=this._targets[h];if(!d)continue;const u=d.material;if(u){u.shadowSide=u.side;for(let p=0;p<i.length;p++){const g=i[p];if(!g){a=!0;continue}if(u.name===g.name){l===void 0&&(l=new Map),l.set(p,h),c=Math.max(c,p);break}}}}if(a){this._indexMapMaxIndex=c,this._indexMap=l;const h=`Renderer ${e.name} was initialized with missing materials - this may lead to unexpected behaviour when trying to access sharedMaterials by index.`;console.warn(h),Ma()&&An("Found renderer with missing materials: please check the console for details.")}return new Proxy(this,{get(h,d){if(typeof d=="string"){const u=parseInt(d);if(!isNaN(u))return r(u)}return h[d]},set(h,d,u){return typeof d=="string"&&s(u,Number.parseInt(d)),Reflect.set(h,d,u)?(u instanceof ti&&(h.changed=!0),!0):!1}})}get changed(){return this._changed}set changed(e){e===!0&&BS&&console.warn("SharedMaterials have changed: "+this._renderer.name,this),this._changed=e}is(e){return this._renderer===e}get length(){return this._indexMapMaxIndex!==void 0?this._indexMapMaxIndex+1:this._targets.length}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.getMaterial(e)}resolveIndex(e){const i=this._indexMap;return i&&i.has(e)?i.get(e):e}setMaterial(e,i){if(i=this.resolveIndex(i),i<0||i>=this._targets.length)return;const s=this._targets[i];!s||s.material===void 0||(s.material=e,this.changed=!0)}getMaterial(e){if(e=this.resolveIndex(e),e<0)return null;const i=this._targets;if(e>=i.length)return null;const s=i[e];return s?s.material:null}}const $L=class extends Oe{constructor(){super(...arguments),m(this,"receiveShadows",!1),m(this,"shadowCastingMode",0),m(this,"lightmapIndex",-1),m(this,"lightmapScaleOffset",new $e(1,1,0,0)),m(this,"enableInstancing"),m(this,"renderOrder"),m(this,"allowOcclusionWhenDynamic",!0),m(this,"probeAnchor"),m(this,"reflectionProbeUsage",0),m(this,"_lightmaps"),m(this,"_sharedMeshes",[]),m(this,"_sharedMaterials"),m(this,"_originalMaterials"),m(this,"_probeAnchorLastFrame"),m(this,"_lightmapTextureOverride"),m(this,"allowProgressiveLoading",!0),m(this,"_firstFrame",-1),m(this,"_isInstancingEnabled",!1),m(this,"_handles"),m(this,"_handlesTempArray",[]),m(this,"onBeforeRenderThree",(n,e,i,s,r,o)=>{var a;if(r.envMapIntensity!==void 0){const l=this.hasLightmap?Math.PI:1,c=((a=this.context.mainCameraComponent)==null?void 0:a.environmentIntensity)??1;r.envMapIntensity=Math.max(0,c*this.context.sceneLighting.environmentIntensity/l)}if(this._lightmaps)for(const l of this._lightmaps)l.updateLightmapUniforms(r),l.applyLightmap()}),m(this,"_reflectionProbe",null)}static setInstanced(n,e){const i=RC(n,$L);return i.setInstancingEnabled(e),i}static isInstanced(n){const e=k0(n,$L);return e?e.isInstancingActive:ih.isUsingInstancing(n)}static setVisible(n,e){rp(n,e)}get sharedMesh(){if(this.gameObject.type==="Mesh")return this.gameObject;if(this.gameObject.type==="SkinnesMesh")return this.gameObject;if(this.gameObject.type==="Group")return this.gameObject.children[0]}get sharedMeshes(){if(this.destroyed||!this.gameObject)return this._sharedMeshes;if(this._sharedMeshes.length=0,this.gameObject.type==="Group")for(const n of this.gameObject.children)(n.type==="Mesh"||n.type==="SkinnedMesh")&&this._sharedMeshes.push(n);else(this.gameObject.type==="Mesh"||this.gameObject.type==="SkinnedMesh")&&this._sharedMeshes.push(this.gameObject);return this._sharedMeshes}get sharedMaterial(){return this.sharedMaterials[0]}set sharedMaterial(n){this.sharedMaterials[0]!==n&&(this.sharedMaterials[0]=n,this.applyLightmapping())}get material(){return this.sharedMaterials[0]}set material(n){this.sharedMaterial=n}set sharedMaterials(n){if(!this._originalMaterials)this._originalMaterials=n;else if(n){let e=!1;for(let i=0;i<this._sharedMaterials.length;i++){const s=i<n.length?n[i]:null;s&&s instanceof ti?this.sharedMaterials[i]=s:e||(e=!0,console.warn("Can not assign null as material: "+this.name,s))}}}get sharedMaterials(){return(!this._sharedMaterials||!this._sharedMaterials.is(this))&&(this._originalMaterials||(this._originalMaterials=[]),this._sharedMaterials=new eDe(this,this._originalMaterials)),this._sharedMaterials}static get shouldSuppressInstancing(){return $se}get lightmap(){var n;return(n=this._lightmaps)!=null&&n.length?this._lightmaps[0].lightmap:null}set lightmap(n){var e;if(this._lightmapTextureOverride=n,n===void 0&&(n=this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex)),(e=this._lightmaps)!=null&&e.length)for(const i of this._lightmaps)i.lightmap=n}get hasLightmap(){return this.lightmap!=null}registering(){this.enabled||this.setVisibility(!1)}awake(){if(this._firstFrame=this.context.time.frame,BS&&console.log("Renderer ",this.name,this),this.clearInstancingState(),this.probeAnchor&&BS&&this.probeAnchor.add(new Ya(.2)),this._reflectionProbe=null,this.isMultiMaterialObject(this.gameObject)){for(const n of this.gameObject.children)this.context.addBeforeRenderListener(n,this.onBeforeRenderThree),n.layers.mask=this.gameObject.layers.mask;if(this.renderOrder!==void 0){let n=0;for(let e=0;e<this.gameObject.children.length;e++){const i=this.gameObject.children[e];if(!(!this.isMeshOrSkinnedMesh(i)||$.getComponent(i,$L))){if(this.renderOrder.length<=n){console.warn("Incorrect renderOrder element count",this,this.renderOrder.length+" but expected "+this.gameObject.children.length,"Index: "+n,"ChildElement:",i);continue}i.renderOrder=this.renderOrder[n],n+=1}}}}else this.isMeshOrSkinnedMesh(this.gameObject)?(this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree),this.renderOrder!==void 0&&this.renderOrder.length>0&&(this.gameObject.renderOrder=this.renderOrder[0])):this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree);if(this.applyLightmapping(),$Xe)for(let n=0;n<this.sharedMaterials.length;n++){const e=this.sharedMaterials[n];e&&(e.wireframe=!0)}}applyLightmapping(){var n;if(this.lightmapIndex>=0){const e=this.gameObject.type,i=this._lightmapTextureOverride!==void 0?this._lightmapTextureOverride:this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex);if(i){if(this._lightmaps||(this._lightmaps=[]),e==="Mesh"){const s=this.gameObject.material;if(s!=null&&s.isMeshBasicMaterial)s&&console.warn("Lightmapping is not supported on MeshBasicMaterial",s.name);else{if(this._lightmaps.length<=0){const r=new LS(this.gameObject,this.context);this._lightmaps.push(r)}this._lightmaps[0].init(this.lightmapIndex,this.lightmapScaleOffset,i)}}else if(this.isMultiMaterialObject(this.gameObject)&&this.sharedMaterials.length>0)for(let s=0;s<this.gameObject.children.length;s++){const r=this.gameObject.children[s];if(!((n=r.material)!=null&&n.isMeshBasicMaterial)){let o;s>=this._lightmaps.length?(o=new LS(r,this.context),this._lightmaps.push(o)):o=this._lightmaps[s],o.init(this.lightmapIndex,this.lightmapScaleOffset,i)}}}else BS&&console.warn("Lightmap not found",this.sourceId,this.lightmapIndex)}}get isInstancingActive(){return this._handles!=null&&this._handles.length>0&&this._isInstancingEnabled}get instances(){if(!this._handles||this._handles.length<=0)return null;if(this._handlesTempArray.length=0,this._handles)for(const n of this._handles)this._handlesTempArray.push(n);return this._handlesTempArray}setInstancingEnabled(n){if(this._isInstancingEnabled===n)return n&&(this._handles===void 0||this._handles!=null&&this._handles.length>0);if(this._isInstancingEnabled=n,n){if(this.enableInstancing===void 0&&(this.enableInstancing=!0),this._handles===void 0){if(this._handles=Lv.instance.setup(this,this.gameObject,this.context,null,{rend:this,foundMeshes:0,useMatrixWorldAutoUpdate:this.useInstanceMatrixWorldAutoUpdate()}),this._handles)return $.markAsInstancedRendered(this.gameObject,!0),!0}else if(this._handles!==null){for(const e of this._handles)e.updateInstanceMatrix(!0),e.add();return $.markAsInstancedRendered(this.gameObject,!0),!0}}else{if(this._handles)for(const e of this._handles)e.remove(this.destroyed);return!0}return!1}clearInstancingState(){this._isInstancingEnabled=!1,this._handles=void 0}useInstanceMatrixWorldAutoUpdate(){return!0}start(){if(this.enableInstancing&&!$se&&(this.setInstancingEnabled(!0),ih.markDirty(this.gameObject)),this.gameObject.frustumCulled=this.allowOcclusionWhenDynamic,this.isMultiMaterialObject(this.gameObject))for(let n=0;n<this.gameObject.children.length;n++){const e=this.gameObject.children[n];e.frustumCulled=this.allowOcclusionWhenDynamic}}onEnable(){this.sharedMeshes,this.setVisibility(!0),this._isInstancingEnabled||this.enableInstancing==!0||Array.isArray(this.enableInstancing)&&this.enableInstancing.some(n=>n)?this.__internalDidAwakeAndStart&&this.setInstancingEnabled(!0):this.enabled&&this.applyStencil(),this.updateReflectionProbe()}onDisable(){this.setVisibility(!1),this._handles&&this._handles.length>0&&this.setInstancingEnabled(!1)}onDestroy(){if(this._handles=null,this.isMultiMaterialObject(this.gameObject))for(const n of this.gameObject.children)this.context.removeBeforeRenderListener(n,this.onBeforeRenderThree);else this.context.removeBeforeRenderListener(this.gameObject,this.onBeforeRenderThree)}onBeforeRender(){var n,e,i;if(this.gameObject){if(this._probeAnchorLastFrame!==this.probeAnchor&&((n=this._reflectionProbe)==null||n.onUnset(this),this.updateReflectionProbe()),BS==this.name&&this.gameObject instanceof pe){this.gameObject.geometry.computeBoundingSphere();const s=Lt(this.gameObject.geometry.boundingSphere.center).applyMatrix4(this.gameObject.matrixWorld);Nt.DrawWireSphere(s,this.gameObject.geometry.boundingSphere.radius,56831)}if(this.isMultiMaterialObject(this.gameObject)&&((e=this.gameObject.children)==null?void 0:e.length)>0)for(const s of this.gameObject.children)this.applySettings(s);else this.applySettings(this.gameObject);if(this.sharedMaterials.changed&&(this.sharedMaterials.changed=!1,this.applyLightmapping()),(i=this._handles)!=null&&i.length&&this.gameObject[xC]===!0){this.gameObject[xC]=!1;for(let s=this._handles.length-1;s>=0;s--)this._handles[s].updateInstanceMatrix();this.gameObject.matrixWorldNeedsUpdate=!1}if(this._handles&&this._handles.length<=0&&$.markAsInstancedRendered(this.gameObject,!1),this._isInstancingEnabled&&this._handles)for(let s=0;s<this._handles.length;s++){const r=this._handles[s];rp(r.object,!1)}this.reflectionProbeUsage!==0&&this._reflectionProbe&&this._reflectionProbe.onSet(this)}}onAfterRender(){if(this._isInstancingEnabled&&this._handles)for(let n=0;n<this._handles.length;n++){const e=this._handles[n];rp(e.object,!0)}this.reflectionProbeUsage!==0&&this._reflectionProbe&&this._reflectionProbe.onUnset(this),this.static&&this.gameObject.matrixAutoUpdate&&(this.gameObject.matrixAutoUpdate=!1)}applyStencil(){qU.applyStencil(this)}applySettings(n){n.receiveShadow=this.receiveShadows,this.shadowCastingMode==1?n.castShadow=!0:n.castShadow=!1}updateReflectionProbe(){this._reflectionProbe=null,this.reflectionProbeUsage!==0&&(this.startCoroutine(this._updateReflectionProbe(),_n.LateUpdate),this._probeAnchorLastFrame=this.probeAnchor)}*_updateReflectionProbe(){const n=this.probeAnchor||this.gameObject,e=!!this.probeAnchor;this._reflectionProbe=Tv.get(n,this.context,e,this.probeAnchor)}setVisibility(n){if(!this.isMultiMaterialObject(this.gameObject))rp(this.gameObject,n);else for(const e of this.gameObject.children)this.isMeshOrSkinnedMesh(e)&&rp(e,n)}isMultiMaterialObject(n){return n.type==="Group"}isMeshOrSkinnedMesh(n){return n.type==="Mesh"||n.type==="SkinnedMesh"}};let Gs=$L;Cp([T()],Gs.prototype,"receiveShadows",2),Cp([T()],Gs.prototype,"shadowCastingMode",2),Cp([T()],Gs.prototype,"lightmapIndex",2),Cp([T($e)],Gs.prototype,"lightmapScaleOffset",2),Cp([T()],Gs.prototype,"enableInstancing",2),Cp([T()],Gs.prototype,"renderOrder",2),Cp([T()],Gs.prototype,"allowOcclusionWhenDynamic",2),Cp([T(Ae)],Gs.prototype,"probeAnchor",2),Cp([T()],Gs.prototype,"reflectionProbeUsage",2);class kS extends Gs{}class s3 extends kS{constructor(){super(...arguments),m(this,"_needUpdateBoundingSphere",!1)}awake(){var e;super.awake(),qse&&console.log('SkinnedMeshRenderer for "'+this.name+'"',this),this.allowOcclusionWhenDynamic=!1;for(const i of this.sharedMeshes)(e=i.parent)==null||e.updateWorldMatrix(!1,!0),this.markBoundsDirty()}onAfterRender(){if(super.onAfterRender(),this._needUpdateBoundingSphere){for(const e of this.sharedMeshes)if(e instanceof Ka){this._needUpdateBoundingSphere=!1;const i=e.geometry,s=iC(e);s&&(e.geometry=s),e.computeBoundingSphere(),e.geometry=i}}if(qse){for(const e of this.sharedMeshes)if(e instanceof Ka&&e.boundingSphere){const i=Lt(e.boundingSphere.center).applyMatrix4(e.matrixWorld);Nt.DrawWireSphere(i,e.boundingSphere.radius,"red")}}}markBoundsDirty(){this._needUpdateBoundingSphere=!0}}var tDe=Object.defineProperty,iDe=Object.getOwnPropertyDescriptor,ne=(n,e,i,s)=>{for(var r=s>1?void 0:s?iDe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&tDe(e,i,r),r};const eB=q("debugparticles");var Sp=(n=>(n[n.Billboard=0]="Billboard",n[n.Stretch=1]="Stretch",n[n.HorizontalBillboard=2]="HorizontalBillboard",n[n.VerticalBillboard=3]="VerticalBillboard",n[n.Mesh=4]="Mesh",n))(Sp||{});let Mg=class{constructor(){m(this,"alphaKeys",[]),m(this,"colorKeys",[])}get duration(){return 1}evaluate(n,e){let i,s=0,r=null,o=0;for(let a=0;a<this.alphaKeys.length;a++){const l=this.alphaKeys[a];(l.time<n||!i)&&(i=l,s=a)}for(let a=0;a<this.colorKeys.length;a++){const l=this.colorKeys[a];(l.time<n||!r)&&(r=l,o=a)}if(r)if(o+1<this.colorKeys.length){const a=this.colorKeys[o+1],l=lt.remap(n,r.time,a.time,0,1);e.r=lt.lerp(r.color.r,a.color.r,l),e.g=lt.lerp(r.color.g,a.color.g,l),e.b=lt.lerp(r.color.b,a.color.b,l)}else e.r=r.color.r,e.g=r.color.g,e.b=r.color.b;if(i)if(s+1<this.alphaKeys.length){const a=this.alphaKeys[s+1],l=lt.remap(n,i.time,a.time,0,1);e.alpha=lt.lerp(i.alpha,a.alpha,l)}else e.alpha=i.alpha;return e}};ne([T()],Mg.prototype,"alphaKeys",2),ne([T()],Mg.prototype,"colorKeys",2);var GS=(n=>(n[n.Local=0]="Local",n[n.World=1]="World",n[n.Custom=2]="Custom",n))(GS||{}),tB=(n=>(n[n.Sphere=0]="Sphere",n[n.SphereShell=1]="SphereShell",n[n.Hemisphere=2]="Hemisphere",n[n.HemisphereShell=3]="HemisphereShell",n[n.Cone=4]="Cone",n[n.Box=5]="Box",n[n.Mesh=6]="Mesh",n[n.ConeShell=7]="ConeShell",n[n.ConeVolume=8]="ConeVolume",n[n.ConeVolumeShell=9]="ConeVolumeShell",n[n.Circle=10]="Circle",n[n.CircleEdge=11]="CircleEdge",n[n.SingleSidedEdge=12]="SingleSidedEdge",n[n.MeshRenderer=13]="MeshRenderer",n[n.SkinnedMeshRenderer=14]="SkinnedMeshRenderer",n[n.BoxShell=15]="BoxShell",n[n.BoxEdge=16]="BoxEdge",n[n.Donut=17]="Donut",n[n.Rectangle=18]="Rectangle",n[n.Sprite=19]="Sprite",n[n.SpriteRenderer=20]="SpriteRenderer",n))(tB||{});const PS=class{constructor(){m(this,"mode","Constant"),m(this,"constant"),m(this,"constantMin"),m(this,"constantMax"),m(this,"curve"),m(this,"curveMin"),m(this,"curveMax"),m(this,"curveMultiplier")}static constant(n){const e=new PS;return e.setConstant(n),e}static betweenTwoConstants(n,e){const i=new PS;return i.setMinMaxConstant(n,e),i}static curve(n,e=1){const i=new PS;return i.setCurve(n,e),i}setConstant(n){this.mode=0,this.constant=n}setMinMaxConstant(n,e){this.mode=3,this.constantMin=n,this.constantMax=e}setCurve(n,e=1){this.mode=1,this.curve=n,this.curveMultiplier=e}clone(){var n,e,i;const s=new PS;return s.mode=this.mode,s.constant=this.constant,s.constantMin=this.constantMin,s.constantMax=this.constantMax,s.curve=(n=this.curve)==null?void 0:n.clone(),s.curveMin=(e=this.curveMin)==null?void 0:e.clone(),s.curveMax=(i=this.curveMax)==null?void 0:i.clone(),s.curveMultiplier=this.curveMultiplier,s}evaluate(n,e){const i=e===void 0?Math.random():e;switch(this.mode){case 0:case"Constant":return this.constant;case 1:case"Curve":return n=lt.clamp01(n),this.curve.evaluate(n)*this.curveMultiplier;case 2:case"TwoCurves":const s=n*this.curveMin.duration,r=n*this.curveMax.duration;return lt.lerp(this.curveMin.evaluate(s),this.curveMax.evaluate(r),i%1)*this.curveMultiplier;case 3:case"TwoConstants":return lt.lerp(this.constantMin,this.constantMax,i%1);default:this.curveMax.evaluate(n)*this.curveMultiplier;break}return 0}getMax(){switch(this.mode){case 0:case"Constant":return this.constant;case 1:case"Curve":return this.getMaxFromCurve(this.curve)*this.curveMultiplier;case 2:case"TwoCurves":return Math.max(this.getMaxFromCurve(this.curveMin),this.getMaxFromCurve(this.curveMax))*this.curveMultiplier;case 3:case"TwoConstants":return Math.max(this.constantMin,this.constantMax);default:return 0}}getMaxFromCurve(n){if(!n)return 0;let e=Number.MIN_VALUE;for(let i=0;i<n.keys.length;i++){const s=n.keys[i];s.value>e&&(e=s.value)}return e}};let Vt=PS;ne([T()],Vt.prototype,"mode",2),ne([T()],Vt.prototype,"constant",2),ne([T()],Vt.prototype,"constantMin",2),ne([T()],Vt.prototype,"constantMax",2),ne([T(U0)],Vt.prototype,"curve",2),ne([T(U0)],Vt.prototype,"curveMin",2),ne([T(U0)],Vt.prototype,"curveMax",2),ne([T()],Vt.prototype,"curveMultiplier",2);var iB;const ec=(iB=class{constructor(){m(this,"mode",0),m(this,"color"),m(this,"colorMin"),m(this,"colorMax"),m(this,"gradient"),m(this,"gradientMin"),m(this,"gradientMax")}static constant(n){const e=new ec;return e.constant(n),e}static betweenTwoColors(n,e){const i=new ec;return i.betweenTwoColors(n,e),i}constant(n){return this.mode=0,this.color=n,this}betweenTwoColors(n,e){return this.mode=2,this.colorMin=n,this.colorMax=e,this}evaluate(n,e){const i=e===void 0?Math.random():e;switch(this.mode){case 0:case"Color":return this.color;case 1:case"Gradient":return this.gradient.evaluate(n,ec._temp),ec._temp;case 2:case"TwoColors":return ec._temp.lerpColors(this.colorMin,this.colorMax,i);case 3:case"TwoGradients":return this.gradientMin.evaluate(n,ec._temp),this.gradientMax.evaluate(n,ec._temp2),ec._temp.lerp(ec._temp2,i)}return ec._temp.set(16711935),ec._temp.alpha=1,ec._temp}},m(iB,"_temp",new pn(0,0,0,1)),m(iB,"_temp2",new pn(0,0,0,1)),iB);let Da=ec;ne([T()],Da.prototype,"mode",2),ne([T(pn)],Da.prototype,"color",2),ne([T(pn)],Da.prototype,"colorMin",2),ne([T(pn)],Da.prototype,"colorMax",2),ne([T(Mg)],Da.prototype,"gradient",2),ne([T(Mg)],Da.prototype,"gradientMin",2),ne([T(Mg)],Da.prototype,"gradientMax",2);var r3=(n=>(n[n.Hierarchy=0]="Hierarchy",n[n.Local=1]="Local",n[n.Shape=2]="Shape",n))(r3||{});class Bo{constructor(){m(this,"cullingMode"),m(this,"duration"),m(this,"emitterVelocityMode"),m(this,"flipRotation"),m(this,"gravityModifier"),m(this,"gravityModifierMultiplier"),m(this,"loop"),m(this,"maxParticles"),m(this,"playOnAwake"),m(this,"prewarm"),m(this,"ringBufferLoopRange"),m(this,"ringBufferMode"),m(this,"scalingMode"),m(this,"simulationSpace"),m(this,"simulationSpeed"),m(this,"startColor"),m(this,"startDelay"),m(this,"startDelayMultiplier"),m(this,"startLifetime"),m(this,"startLifetimeMultiplier"),m(this,"startRotation"),m(this,"startRotationMultiplier"),m(this,"startRotation3D"),m(this,"startRotationX"),m(this,"startRotationXMultiplier"),m(this,"startRotationY"),m(this,"startRotationYMultiplier"),m(this,"startRotationZ"),m(this,"startRotationZMultiplier"),m(this,"startSize"),m(this,"startSize3D"),m(this,"startSizeMultiplier"),m(this,"startSizeX"),m(this,"startSizeXMultiplier"),m(this,"startSizeY"),m(this,"startSizeYMultiplier"),m(this,"startSizeZ"),m(this,"startSizeZMultiplier"),m(this,"startSpeed"),m(this,"startSpeedMultiplier"),m(this,"stopAction"),m(this,"useUnscaledTime")}}ne([T(Vt)],Bo.prototype,"gravityModifier",2),ne([T(Da)],Bo.prototype,"startColor",2),ne([T(Vt)],Bo.prototype,"startDelay",2),ne([T(Vt)],Bo.prototype,"startLifetime",2),ne([T(Vt)],Bo.prototype,"startRotation",2),ne([T(Vt)],Bo.prototype,"startRotationX",2),ne([T(Vt)],Bo.prototype,"startRotationY",2),ne([T(Vt)],Bo.prototype,"startRotationZ",2),ne([T(Vt)],Bo.prototype,"startSize",2),ne([T(Vt)],Bo.prototype,"startSizeX",2),ne([T(Vt)],Bo.prototype,"startSizeY",2),ne([T(Vt)],Bo.prototype,"startSizeZ",2),ne([T(Vt)],Bo.prototype,"startSpeed",2);class NS{constructor(){m(this,"cycleCount"),m(this,"maxCount"),m(this,"minCount"),m(this,"probability"),m(this,"repeatInterval"),m(this,"time"),m(this,"count"),m(this,"_performed",0)}reset(){this._performed=0}run(e){if(e<=this.time)return 0;let i=0;if(this.cycleCount===0||this._performed<this.cycleCount){const s=this.time+this.repeatInterval*this._performed;if(e>=s&&(this._performed+=1,Math.random()<this.probability))switch(this.count.mode){case 0:i=this.count.constant;break;case 3:i=lt.lerp(this.count.constantMin,this.count.constantMax,Math.random());break;case 1:i=this.count.curve.evaluate(Math.random());break;case 2:const r=Math.random();i=lt.lerp(this.count.curveMin.evaluate(r),this.count.curveMax.evaluate(r),Math.random());break}}return i}}class Jd{constructor(){m(this,"enabled"),m(this,"bursts"),m(this,"rateOverTime"),m(this,"rateOverTimeMultiplier"),m(this,"rateOverDistance"),m(this,"rateOverDistanceMultiplier"),m(this,"system")}get burstCount(){var e;return((e=this.bursts)==null?void 0:e.length)??0}reset(){var e;(e=this.bursts)==null||e.forEach(i=>i.reset())}getBurst(){let e=0;if(this.burstCount>0)for(let i=0;i<this.burstCount;i++){const s=this.bursts[i];this.system.main.loop&&s.time>=this.system.time&&s.reset(),e+=Math.round(s.run(this.system.time))}return e}}ne([T()],Jd.prototype,"enabled",2),ne([T()],Jd.prototype,"bursts",2),ne([T(Vt)],Jd.prototype,"rateOverTime",2),ne([T()],Jd.prototype,"rateOverTimeMultiplier",2),ne([T(Vt)],Jd.prototype,"rateOverDistance",2),ne([T()],Jd.prototype,"rateOverDistanceMultiplier",2);class VS{constructor(){m(this,"enabled"),m(this,"color")}}ne([T(Da)],VS.prototype,"color",2);class Ig{constructor(){m(this,"enabled"),m(this,"separateAxes"),m(this,"size"),m(this,"sizeMultiplier"),m(this,"x"),m(this,"xMultiplier"),m(this,"y"),m(this,"yMultiplier"),m(this,"z"),m(this,"zMultiplier"),m(this,"_time",0),m(this,"_temp",new E)}evaluate(e,i,s){if(i||(i=this._temp),!this.enabled)return i.x=i.y=i.z=1,i;if(this.separateAxes)i.x=this.x.evaluate(e,s)*this.xMultiplier,i.y=this.y.evaluate(e,s)*this.yMultiplier,i.z=this.z.evaluate(e,s)*this.zMultiplier;else{const r=this.size.evaluate(e,s)*this.sizeMultiplier;i.x=r}return i}}ne([T(Vt)],Ig.prototype,"size",2),ne([T(Vt)],Ig.prototype,"x",2),ne([T(Vt)],Ig.prototype,"y",2),ne([T(Vt)],Ig.prototype,"z",2);var nB;const XS=(nB=class{constructor(){m(this,"shapeType",5),m(this,"enabled",!0),m(this,"alignToDirection",!1),m(this,"angle",0),m(this,"arc",360),m(this,"arcSpread"),m(this,"arcSpeedMultiplier"),m(this,"arcMode"),m(this,"boxThickness"),m(this,"position"),m(this,"rotation"),m(this,"_rotation",new Oi),m(this,"scale"),m(this,"radius"),m(this,"radiusThickness"),m(this,"sphericalDirectionAmount"),m(this,"randomDirectionAmount"),m(this,"randomPositionAmount"),m(this,"meshShapeType"),m(this,"meshRenderer"),m(this,"_meshObj"),m(this,"_meshGeometry"),m(this,"system"),m(this,"_space"),m(this,"_worldSpaceMatrix",new de),m(this,"_worldSpaceMatrixInverse",new de),m(this,"_vector",new E(0,0,0)),m(this,"_temp",new E(0,0,0)),m(this,"_triangle",new $s),m(this,"_dir",new E),m(this,"_loopTime",0),m(this,"_loopDirection",1),eB&&console.log(this)}get type(){return tB[this.shapeType]}initialize(n){this.onInitialize(n),n.position.x=this._vector.x,n.position.y=this._vector.y,n.position.z=this._vector.z}toJSON(){return this}clone(){return new XS}setMesh(n){this.meshRenderer=n,n?(this._meshObj=n.sharedMeshes[Math.floor(Math.random()*n.sharedMeshes.length)],this._meshGeometry=this._meshObj.geometry):(this._meshObj=void 0,this._meshGeometry=void 0)}update(n,e){throw new Error("Method not implemented: use onUpdate")}onUpdate(n,e,i,s){this.system=n,this._space=i,i===1&&(this._worldSpaceMatrix.copy(s.matrixWorld),this._worldSpaceMatrix.elements[0]=1,this._worldSpaceMatrix.elements[5]=1,this._worldSpaceMatrix.elements[10]=1,this._worldSpaceMatrixInverse.copy(this._worldSpaceMatrix).invert())}applyRotation(n){const e=this.rotation.x!==0||this.rotation.y!==0||this.rotation.z!==0;return e&&(this._rotation.x=lt.toRadians(this.rotation.x),this._rotation.y=lt.toRadians(this.rotation.y),this._rotation.z=lt.toRadians(this.rotation.z),this._rotation.order="ZYX",n.applyEuler(this._rotation)),e}onInitialize(n){this._vector.set(0,0,0),n.mesh=void 0,n.mesh_geometry=void 0;const e=this._temp.copy(this.position),i=this._space===1;i&&e.applyQuaternion(this.system.worldQuaternion);let s=this.radius;if(i&&(s*=this.system.worldScale.x),this.enabled){switch(this.shapeType){case 5:eB&&Nt.DrawWireBox(this.position,this.scale,14540253,1),this._vector.x=Math.random()*this.scale.x-this.scale.x/2,this._vector.y=Math.random()*this.scale.y-this.scale.y/2,this._vector.z=Math.random()*this.scale.z-this.scale.z/2,this._vector.add(e);break;case 4:this.randomConePoint(this.position,this.angle,s,this.radiusThickness,this.arc,this.arcMode,this._vector);break;case 0:this.randomSpherePoint(this.position,s,this.radiusThickness,this.arc,this._vector);break;case 10:this.randomCirclePoint(this.position,s,this.radiusThickness,this.arc,this._vector);break;case 13:const r=this.meshRenderer;r?.destroyed==!1&&this.setMesh(r);const o=n.mesh=this._meshObj,a=n.mesh_geometry=this._meshGeometry;if(o&&a)switch(this.meshShapeType){case 0:{const l=a.getAttribute("position"),c=Math.floor(Math.random()*l.count);this._vector.fromBufferAttribute(l,c),this._vector.applyMatrix4(o.matrixWorld),n.mesh_normal=c}break;case 1:break;case 2:{const l=a.index;if(l){let c=Math.random(),h=Math.random();c+h>1&&(c=1-c,h=1-h);const d=Math.floor(Math.random()*(l.count/3));let u=d*3,p=d*3+1,g=d*3+2;u=l.getX(u),p=l.getX(p),g=l.getX(g);const f=a.getAttribute("position");this._triangle.a.fromBufferAttribute(f,u),this._triangle.b.fromBufferAttribute(f,p),this._triangle.c.fromBufferAttribute(f,g),this._vector.set(0,0,0).addScaledVector(this._triangle.a,c).addScaledVector(this._triangle.b,h).addScaledVector(this._triangle.c,1-(c+h)),this._vector.applyMatrix4(o.matrixWorld),n.mesh_normal=d}}break}break;default:this._vector.set(0,0,0),Je()&&!globalThis.__particlesystem_shapetype_unsupported&&(console.warn("ParticleSystem ShapeType is not supported:",tB[this.shapeType]),globalThis.__particlesystem_shapetype_unsupported=!0);break}this.randomizePosition(this._vector,this.randomPositionAmount)}this.applyRotation(this._vector),i&&(this._vector.applyQuaternion(this.system.worldQuaternion),this._vector.add(this.system.worldPos)),eB&&Nt.DrawSphere(this._vector,.03,16711680,.5,!0)}getDirection(n,e){var i;if(!this.enabled)return this._dir.set(0,0,1),this._dir;switch(this.shapeType){case 5:this._dir.set(0,0,1);break;case 4:this._dir.set(0,0,1);break;case 10:case 0:const s=e.x,r=e.y,o=e.z;this._dir.set(s,r,o),(i=this.system)!=null&&i.worldspace?this._dir.sub(this.system.worldPos):this._dir.sub(this.position);break;case 13:const a=n.mesh,l=n.mesh_geometry;if(a&&l)switch(this.meshShapeType){case 0:{const c=l.getAttribute("normal"),h=n.mesh_normal;this._dir.fromBufferAttribute(c,h)}break;case 1:break;case 2:{const c=l.index;if(c){const h=n.mesh_normal,d=c.getX(h*3),u=c.getX(h*3+1),p=c.getX(h*3+2),g=l.getAttribute("position"),f=Lt(),A=Lt(),y=Lt();f.fromBufferAttribute(g,d),A.fromBufferAttribute(g,u),y.fromBufferAttribute(g,p),f.sub(A),y.sub(A),f.cross(y),this._dir.copy(f).multiplyScalar(-1);const b=fn(a);this._dir.applyQuaternion(b)}}break}break;default:this._dir.set(0,0,1);break}return this._space===1&&this._dir.applyQuaternion(this.system.worldQuaternion),this.applyRotation(this._dir),this._dir.normalize(),this.spherizeDirection(this._dir,this.sphericalDirectionAmount),this.randomizeDirection(this._dir,this.randomDirectionAmount),eB&&(Nt.DrawSphere(e,.01,8925952,.5,!0),Nt.DrawDirection(e,this._dir,8925952,.5,!0)),this._dir}randomizePosition(n,e){if(e<=0)return;const i=XS._tempVec;i.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1),i.x*=e*this.scale.x,i.y*=e*this.scale.y,i.z*=e*this.scale.z,n.add(i)}randomizeDirection(n,e){if(e===0)return;const i=XS._randomQuat,s=XS._tempVec;s.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize(),i.setFromAxisAngle(s,e*Math.random()*Math.PI),n.applyQuaternion(i)}spherizeDirection(n,e){if(e===0)return;const i=Math.random()*Math.PI*2,s=Math.acos(1-Math.random()*2),r=Math.sin(s)*Math.cos(i),o=Math.sin(s)*Math.sin(i),a=Math.cos(s),l=new E(r,o,a);n.lerp(l,e)}randomSpherePoint(n,e,i,s,r){const o=Math.random(),a=Math.random(),l=2*Math.PI*o*(s/360),c=Math.acos(2*a-1),h=lt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*e,d=n.x+this.scale.x*(-h*Math.sin(c)*Math.cos(l)),u=n.y+this.scale.y*(h*Math.sin(c)*Math.sin(l)),p=n.z+this.scale.z*(h*Math.cos(c));r.x=d,r.y=u,r.z=p}randomCirclePoint(n,e,i,s,r){const o=Math.random(),a=2*Math.PI*o*(s/360),l=lt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*e,c=n.x+this.scale.x*l*Math.cos(a),h=n.y+this.scale.y*l*Math.sin(a),d=n.z;r.x=c,r.y=h,r.z=d}randomConePoint(n,e,i,s,r,o,a){let l=0,c=0;switch(o){case 0:l=Math.random(),c=Math.random();break;case 2:this._loopTime>1&&(this._loopDirection=-1),this._loopTime<0&&(this._loopDirection=1);case 1:l=.5,c=Math.random(),this._loopTime+=this.system.deltaTime*this._loopDirection;break}let h=2*Math.PI*l*(r/360);switch(o){case 2:case 1:h+=Math.PI+.5,h+=this._loopTime*Math.PI*2,h%=lt.toRadians(r);break}const d=Math.acos(2*c-1),u=lt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),s)*i,p=n.x+-u*Math.sin(d)*Math.cos(h),g=n.y+u*Math.sin(d)*Math.sin(h),f=n.z;a.x=p*this.scale.x,a.y=g*this.scale.y,a.z=f*this.scale.z}},m(nB,"_randomQuat",new Fe),m(nB,"_tempVec",new E),nB);let Ss=XS;ne([T()],Ss.prototype,"shapeType",2),ne([T()],Ss.prototype,"enabled",2),ne([T()],Ss.prototype,"alignToDirection",2),ne([T()],Ss.prototype,"angle",2),ne([T()],Ss.prototype,"arc",2),ne([T()],Ss.prototype,"arcSpread",2),ne([T()],Ss.prototype,"arcSpeedMultiplier",2),ne([T()],Ss.prototype,"arcMode",2),ne([T(E)],Ss.prototype,"boxThickness",2),ne([T(E)],Ss.prototype,"position",2),ne([T(E)],Ss.prototype,"rotation",2),ne([T(E)],Ss.prototype,"scale",2),ne([T()],Ss.prototype,"radius",2),ne([T()],Ss.prototype,"radiusThickness",2),ne([T()],Ss.prototype,"sphericalDirectionAmount",2),ne([T()],Ss.prototype,"randomDirectionAmount",2),ne([T()],Ss.prototype,"randomPositionAmount",2),ne([T()],Ss.prototype,"meshShapeType",2),ne([T(kS)],Ss.prototype,"meshRenderer",2);class mn{constructor(){m(this,"damping"),m(this,"enabled"),m(this,"frequency"),m(this,"octaveCount"),m(this,"octaveMultiplier"),m(this,"octaveScale"),m(this,"positionAmount"),m(this,"quality"),m(this,"remap"),m(this,"remapEnabled"),m(this,"remapMultiplier"),m(this,"remapX"),m(this,"remapXMultiplier"),m(this,"remapY"),m(this,"remapYMultiplier"),m(this,"remapZ"),m(this,"remapZMultiplier"),m(this,"scrollSpeedMultiplier"),m(this,"separateAxes"),m(this,"strengthMultiplier"),m(this,"strengthX"),m(this,"strengthXMultiplier"),m(this,"strengthY"),m(this,"strengthYMultiplier"),m(this,"strengthZ"),m(this,"strengthZMultiplier"),m(this,"_noise"),m(this,"_time",0),m(this,"_temp",new E)}update(e){this._time+=e.time.deltaTime*this.scrollSpeedMultiplier}apply(e,i,s,r,o,a){if(!this.enabled)return;this._noise||(this._noise=TXe(()=>0));const l=this._temp.set(i.x,i.y,i.z).multiplyScalar(this.frequency),c=this._noise(l.x,l.y,l.z,this._time),h=this._noise(l.x,l.y,l.z,this._time+1e3*this.frequency),d=this._noise(l.x,l.y,l.z,this._time+2e3*this.frequency);this._temp.set(c,h,d).normalize();const u=o/a;let p=this.positionAmount.evaluate(u);this.separateAxes?(this._temp.x*=p*this.strengthXMultiplier,this._temp.y*=p*this.strengthYMultiplier,this._temp.z*=p*this.strengthZMultiplier):(this.strengthX&&(p*=this.strengthX.evaluate(u)*1.5),this._temp.multiplyScalar(p)),s.x+=this._temp.x,s.y+=this._temp.y,s.z+=this._temp.z}}ne([T()],mn.prototype,"damping",2),ne([T()],mn.prototype,"enabled",2),ne([T()],mn.prototype,"frequency",2),ne([T()],mn.prototype,"octaveCount",2),ne([T()],mn.prototype,"octaveMultiplier",2),ne([T()],mn.prototype,"octaveScale",2),ne([T(Vt)],mn.prototype,"positionAmount",2),ne([T()],mn.prototype,"quality",2),ne([T(Vt)],mn.prototype,"remap",2),ne([T()],mn.prototype,"remapEnabled",2),ne([T()],mn.prototype,"remapMultiplier",2),ne([T(Vt)],mn.prototype,"remapX",2),ne([T()],mn.prototype,"remapXMultiplier",2),ne([T(Vt)],mn.prototype,"remapY",2),ne([T()],mn.prototype,"remapYMultiplier",2),ne([T(Vt)],mn.prototype,"remapZ",2),ne([T()],mn.prototype,"remapZMultiplier",2),ne([T()],mn.prototype,"scrollSpeedMultiplier",2),ne([T()],mn.prototype,"separateAxes",2),ne([T()],mn.prototype,"strengthMultiplier",2),ne([T(Vt)],mn.prototype,"strengthX",2),ne([T()],mn.prototype,"strengthXMultiplier",2),ne([T(Vt)],mn.prototype,"strengthY",2),ne([T()],mn.prototype,"strengthYMultiplier",2),ne([T(Vt)],mn.prototype,"strengthZ",2),ne([T()],mn.prototype,"strengthZMultiplier",2);class cs{constructor(){m(this,"enabled"),m(this,"attachRibbonToTransform",!1),m(this,"colorOverLifetime"),m(this,"colorOverTrail"),m(this,"dieWithParticles",!0),m(this,"inheritParticleColor",!0),m(this,"lifetime"),m(this,"lifetimeMultiplier"),m(this,"minVertexDistance",.2),m(this,"mode",0),m(this,"ratio",1),m(this,"ribbonCount",1),m(this,"shadowBias",0),m(this,"sizeAffectsLifetime",!1),m(this,"sizeAffectsWidth",!1),m(this,"splitSubEmitterRibbons",!1),m(this,"textureMode",0),m(this,"widthOverTrail"),m(this,"widthOverTrailMultiplier"),m(this,"worldSpace",!1)}getWidth(e,i,s,r){const o=this.widthOverTrail.evaluate(s,r);return e*=o,e}getColor(e,i,s){const r=this.colorOverTrail.evaluate(s),o=this.colorOverLifetime.evaluate(i);e.x*=r.r*o.r,e.y*=r.g*o.g,e.z*=r.b*o.b,"alpha"in r&&"alpha"in o&&(e.w*=r.alpha*o.alpha)}}ne([T()],cs.prototype,"enabled",2),ne([T()],cs.prototype,"attachRibbonToTransform",2),ne([T(Da)],cs.prototype,"colorOverLifetime",2),ne([T(Da)],cs.prototype,"colorOverTrail",2),ne([T()],cs.prototype,"dieWithParticles",2),ne([T()],cs.prototype,"inheritParticleColor",2),ne([T(Vt)],cs.prototype,"lifetime",2),ne([T()],cs.prototype,"lifetimeMultiplier",2),ne([T()],cs.prototype,"minVertexDistance",2),ne([T()],cs.prototype,"mode",2),ne([T()],cs.prototype,"ratio",2),ne([T()],cs.prototype,"ribbonCount",2),ne([T()],cs.prototype,"shadowBias",2),ne([T()],cs.prototype,"sizeAffectsLifetime",2),ne([T()],cs.prototype,"sizeAffectsWidth",2),ne([T()],cs.prototype,"splitSubEmitterRibbons",2),ne([T()],cs.prototype,"textureMode",2),ne([T(Vt)],cs.prototype,"widthOverTrail",2),ne([T()],cs.prototype,"widthOverTrailMultiplier",2),ne([T()],cs.prototype,"worldSpace",2);class _s{constructor(){m(this,"enabled"),m(this,"space",0),m(this,"orbitalX"),m(this,"orbitalY"),m(this,"orbitalZ"),m(this,"orbitalXMultiplier"),m(this,"orbitalYMultiplier"),m(this,"orbitalZMultiplier"),m(this,"orbitalOffsetX"),m(this,"orbitalOffsetY"),m(this,"orbitalOffsetZ"),m(this,"speedModifier"),m(this,"speedModifierMultiplier"),m(this,"x"),m(this,"xMultiplier"),m(this,"y"),m(this,"yMultiplier"),m(this,"z"),m(this,"zMultiplier"),m(this,"_system"),m(this,"_temp",new E),m(this,"_temp2",new E),m(this,"_temp3",new E),m(this,"_hasOrbital",!1),m(this,"_index",0),m(this,"_orbitalMatrix",new de)}update(e){this._system=e}init(e){this._index==0&&(e.debug=!0),this._index+=1,e.orbitx=this.orbitalX.evaluate(Math.random()),e.orbity=this.orbitalY.evaluate(Math.random()),e.orbitz=this.orbitalZ.evaluate(Math.random()),this._hasOrbital=e.orbitx!=0||e.orbity!=0||e.orbitz!=0}apply(e,i,s,r,o,a,l){var c;if(!this.enabled)return;const h=a/l,d=this.speedModifier.evaluate(h)*this.speedModifierMultiplier,u=this.x.evaluate(h),p=this.y.evaluate(h),g=this.z.evaluate(h);if(this._temp.set(-u,p,g),this._system&&this._system.main.simulationSpace===1&&this._temp.applyQuaternion(this._system.worldQuaternion),this._hasOrbital&&((c=this._system)==null?void 0:c.worldPos)){const f=this._temp2.set(s.x,s.y,s.z),A=this.orbitalXMultiplier,y=this.orbitalYMultiplier,b=this.orbitalZMultiplier,v=d*Math.PI*2*10,x=Math.cos(v*A),w=Math.sin(v*A),C=Math.cos(v*y),S=Math.sin(v*y),_=Math.cos(v*b),I=Math.sin(v*b),B=f.x*(C*_)+f.y*(C*I)+f.z*-S,M=f.x*(w*S*_-x*I)+f.y*(w*S*I+x*_)+f.z*(w*C),R=f.x*(x*S*_+w*I)+f.y*(x*S*I-w*_)+f.z*(x*C),k=this._temp3.set(f.x-B,f.y-M,f.z-R);k.normalize(),k.multiplyScalar(.2/o*Math.max(this.orbitalXMultiplier,this.orbitalYMultiplier,this.orbitalZMultiplier)),r.x+=k.x,r.y+=k.y,r.z+=k.z}r.x+=this._temp.x,r.y+=this._temp.y,r.z+=this._temp.z,r.x*=d,r.y*=d,r.z*=d}}ne([T()],_s.prototype,"enabled",2),ne([T()],_s.prototype,"space",2),ne([T(Vt)],_s.prototype,"orbitalX",2),ne([T(Vt)],_s.prototype,"orbitalY",2),ne([T(Vt)],_s.prototype,"orbitalZ",2),ne([T()],_s.prototype,"orbitalXMultiplier",2),ne([T()],_s.prototype,"orbitalYMultiplier",2),ne([T()],_s.prototype,"orbitalZMultiplier",2),ne([T()],_s.prototype,"orbitalOffsetX",2),ne([T()],_s.prototype,"orbitalOffsetY",2),ne([T()],_s.prototype,"orbitalOffsetZ",2),ne([T(Vt)],_s.prototype,"speedModifier",2),ne([T()],_s.prototype,"speedModifierMultiplier",2),ne([T(Vt)],_s.prototype,"x",2),ne([T()],_s.prototype,"xMultiplier",2),ne([T(Vt)],_s.prototype,"y",2),ne([T()],_s.prototype,"yMultiplier",2),ne([T(Vt)],_s.prototype,"z",2),ne([T()],_s.prototype,"zMultiplier",2);class ko{constructor(){m(this,"animation"),m(this,"enabled"),m(this,"cycleCount"),m(this,"frameOverTime"),m(this,"frameOverTimeMultiplier"),m(this,"numTilesX"),m(this,"numTilesY"),m(this,"startFrame"),m(this,"startFrameMultiplier"),m(this,"rowMode"),m(this,"rowIndex"),m(this,"spriteCount"),m(this,"timeMode")}sampleOnceAtStart(){if(this.timeMode===0)switch(this.frameOverTime.mode){case 0:case 3:case 2:case 1:return!0}return!1}getStartIndex(){return this.sampleOnceAtStart()?Math.random()*(this.numTilesX*this.numTilesY):0}evaluate(e){if(!this.sampleOnceAtStart())return this.getIndex(e)}getIndex(e){const i=this.numTilesX*this.numTilesY;e=e*this.cycleCount;let s=this.frameOverTime.evaluate(e%1);return s*=this.frameOverTimeMultiplier,s*=i,s=s%i,s=Math.floor(s),s}}ne([T()],ko.prototype,"animation",2),ne([T()],ko.prototype,"enabled",2),ne([T()],ko.prototype,"cycleCount",2),ne([T(Vt)],ko.prototype,"frameOverTime",2),ne([T()],ko.prototype,"frameOverTimeMultiplier",2),ne([T()],ko.prototype,"numTilesX",2),ne([T()],ko.prototype,"numTilesY",2),ne([T(Vt)],ko.prototype,"startFrame",2),ne([T()],ko.prototype,"startFrameMultiplier",2),ne([T()],ko.prototype,"rowMode",2),ne([T()],ko.prototype,"rowIndex",2),ne([T()],ko.prototype,"spriteCount",2),ne([T()],ko.prototype,"timeMode",2);class Wc{constructor(){m(this,"enabled"),m(this,"separateAxes"),m(this,"x"),m(this,"xMultiplier"),m(this,"y"),m(this,"yMultiplier"),m(this,"z"),m(this,"zMultiplier")}evaluate(e,i){return this.enabled?this.separateAxes?0:this.z.evaluate(e,i)*-1:0}}ne([T()],Wc.prototype,"enabled",2),ne([T()],Wc.prototype,"separateAxes",2),ne([T(Vt)],Wc.prototype,"x",2),ne([T()],Wc.prototype,"xMultiplier",2),ne([T(Vt)],Wc.prototype,"y",2),ne([T()],Wc.prototype,"yMultiplier",2),ne([T(Vt)],Wc.prototype,"z",2),ne([T()],Wc.prototype,"zMultiplier",2);class tc{constructor(){m(this,"enabled"),m(this,"range"),m(this,"separateAxes"),m(this,"x"),m(this,"xMultiplier"),m(this,"y"),m(this,"yMultiplier"),m(this,"z"),m(this,"zMultiplier")}evaluate(e,i){if(!this.enabled)return 0;if(!this.separateAxes){const s=lt.lerp(this.range.x,this.range.y,i);return this.z.evaluate(s)*-1}return 0}}ne([T()],tc.prototype,"enabled",2),ne([T()],tc.prototype,"range",2),ne([T()],tc.prototype,"separateAxes",2),ne([T(Vt)],tc.prototype,"x",2),ne([T()],tc.prototype,"xMultiplier",2),ne([T(Vt)],tc.prototype,"y",2),ne([T()],tc.prototype,"yMultiplier",2),ne([T(Vt)],tc.prototype,"z",2),ne([T()],tc.prototype,"zMultiplier",2);class dr{constructor(){m(this,"enabled"),m(this,"dampen"),m(this,"drag"),m(this,"dragMultiplier"),m(this,"limit"),m(this,"limitMultiplier"),m(this,"separateAxes"),m(this,"limitX"),m(this,"limitXMultiplier"),m(this,"limitY"),m(this,"limitYMultiplier"),m(this,"limitZ"),m(this,"limitZMultiplier"),m(this,"multiplyDragByParticleSize",!1),m(this,"multiplyDragByParticleVelocity",!1),m(this,"space"),m(this,"_temp",new E),m(this,"_temp2",new E)}apply(e,i,s,r,o,a,l){if(this.enabled){const c=this.limit.evaluate(o)*this.limitMultiplier;if(i.length()>c){this._temp.copy(i).normalize().multiplyScalar(c);const h=this.dampen*.5;i.x=lt.lerp(i.x,this._temp.x,h),i.y=lt.lerp(i.y,this._temp.y,h),i.z=lt.lerp(i.z,this._temp.z,h),s.x=lt.lerp(s.x,this._temp.x,h),s.y=lt.lerp(s.y,this._temp.y,h),s.z=lt.lerp(s.z,this._temp.z,h)}}}}ne([T()],dr.prototype,"enabled",2),ne([T()],dr.prototype,"dampen",2),ne([T(Vt)],dr.prototype,"drag",2),ne([T()],dr.prototype,"dragMultiplier",2),ne([T(Vt)],dr.prototype,"limit",2),ne([T()],dr.prototype,"limitMultiplier",2),ne([T()],dr.prototype,"separateAxes",2),ne([T(Vt)],dr.prototype,"limitX",2),ne([T()],dr.prototype,"limitXMultiplier",2),ne([T(Vt)],dr.prototype,"limitY",2),ne([T()],dr.prototype,"limitYMultiplier",2),ne([T(Vt)],dr.prototype,"limitZ",2),ne([T()],dr.prototype,"limitZMultiplier",2),ne([T()],dr.prototype,"multiplyDragByParticleSize",2),ne([T()],dr.prototype,"multiplyDragByParticleVelocity",2),ne([T()],dr.prototype,"space",2);const ere=class{constructor(){m(this,"enabled"),m(this,"curve"),m(this,"curveMultiplier"),m(this,"mode"),m(this,"system"),m(this,"_temp",new E),m(this,"_firstUpdate",!0),m(this,"_frames",0)}clone(){var n;const e=new ere;return e.enabled=this.enabled,e.curve=(n=this.curve)==null?void 0:n.clone(),e.curveMultiplier=this.curveMultiplier,e.mode=this.mode,e}get _lastWorldPosition(){return this.system._iv_lastWorldPosition||(this.system._iv_lastWorldPosition=new E),this.system._iv_lastWorldPosition}get _velocity(){return this.system._iv_velocity||(this.system._iv_velocity=new E),this.system._iv_velocity}awake(n){this.system=n,this.reset()}reset(){this._firstUpdate=!0}update(n){this.enabled&&this.system.worldspace!==!1&&(this._firstUpdate?(this._firstUpdate=!1,this._velocity.set(0,0,0),this._lastWorldPosition.copy(this.system.worldPos)):this._lastWorldPosition&&(this._velocity.copy(this.system.worldPos).sub(this._lastWorldPosition).multiplyScalar(1/this.system.deltaTime),this._lastWorldPosition.copy(this.system.worldPos)))}applyInitial(n){if(this.enabled&&this.system.worldspace!==!1&&this.mode===0){const e=this.curve.evaluate(Math.random(),Math.random());this._temp.copy(this._velocity).multiplyScalar(e),n.x+=this._temp.x,n.y+=this._temp.y,n.z+=this._temp.z}}applyCurrent(n,e,i){if(this.enabled&&this.system&&this.system.worldspace!==!1&&this.mode===1){const s=this.curve.evaluate(e,i);this._temp.copy(this._velocity).multiplyScalar(s),n.x+=this._temp.x,n.y+=this._temp.y,n.z+=this._temp.z}}};let Tg=ere;ne([T()],Tg.prototype,"enabled",2),ne([T(Vt)],Tg.prototype,"curve",2),ne([T()],Tg.prototype,"curveMultiplier",2),ne([T()],Tg.prototype,"mode",2);class za{constructor(){m(this,"enabled"),m(this,"range"),m(this,"separateAxes"),m(this,"size"),m(this,"sizeMultiplier"),m(this,"x"),m(this,"xMultiplier"),m(this,"y"),m(this,"yMultiplier"),m(this,"z"),m(this,"zMultiplier")}evaluate(e,i,s,r){const o=e.length(),a=lt.remap(o,this.range.x,this.range.y,0,1),l=this.size.evaluate(a,s);return r.x*=l,r.y*=l,r.z*=l,r}}ne([T()],za.prototype,"enabled",2),ne([T(Q)],za.prototype,"range",2),ne([T()],za.prototype,"separateAxes",2),ne([T(Vt)],za.prototype,"size",2),ne([T()],za.prototype,"sizeMultiplier",2),ne([T(Vt)],za.prototype,"x",2),ne([T()],za.prototype,"xMultiplier",2),ne([T(Vt)],za.prototype,"y",2),ne([T()],za.prototype,"yMultiplier",2),ne([T(Vt)],za.prototype,"z",2),ne([T()],za.prototype,"zMultiplier",2);class iA{constructor(){m(this,"enabled"),m(this,"range"),m(this,"color")}evaluate(e,i,s){const r=e.length(),o=lt.remap(r,this.range.x,this.range.y,0,1),a=this.color.evaluate(o,i);s.x*=a.r,s.y*=a.g,s.z*=a.b,"alpha"in a&&(s.w*=a.alpha)}}ne([T()],iA.prototype,"enabled",2),ne([T(Q)],iA.prototype,"range",2),ne([T(Da)],iA.prototype,"color",2);const nDe={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},sDe={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};var rDe=Object.defineProperty,oDe=Object.getOwnPropertyDescriptor,Gv=(n,e,i,s)=>{for(var r=s>1?void 0:s?oDe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&rDe(e,i,r),r};const DS=q("debugcontactshadows");oU(n=>{const e=n.domElement.getAttribute("contactshadows");e!=null&&e!="0"&&e!="false"&&Uh.auto(n)});var o3;const tre=(o3=class extends Oe{constructor(){super(...arguments),m(this,"autoFit",!1),m(this,"darkness",.5),m(this,"opacity",.5),m(this,"blur",4),m(this,"occludeBelowGround",!1),m(this,"backfaceShadows",!0),m(this,"minSize"),m(this,"shadowsRoot",new Ae),m(this,"shadowCamera"),m(this,"shadowGroup",new Es),m(this,"renderTarget"),m(this,"renderTargetBlur"),m(this,"plane"),m(this,"occluderMesh"),m(this,"blurPlane"),m(this,"depthMaterial"),m(this,"horizontalBlurMaterial"),m(this,"verticalBlurMaterial"),m(this,"textureSize",512)}static auto(n){if(n||(n=$t.Current),!n)throw new Error("No context provided and no current context set.");let e=this._instances.get(n);if(!e||e.destroyed){const i=new Ae;e=Ul(i,tre,{autoFit:!1,occludeBelowGround:!1}),this._instances.set(n,e)}return n.scene.add(e.gameObject),e.fitShadows(),e}fitShadows(){DS&&console.warn("Fitting shadows to scene"),nD(this.shadowsRoot,!1);const n=Ll(this.context.scene.children,[this.shadowsRoot]),e=Math.max(1,this.blur/32),i=n.max.x-n.min.x,s=n.max.z-n.min.z;n.expandByVector(new E(e*i,0,e*s)),DS&&Nt.DrawWireBox3(n,16776960,60),this.gameObject.parent&&n.applyMatrix4(this.gameObject.parent.matrixWorld.clone().invert());const r=n.min,o=Math.max(1e-5,(n.max.y-r.y)*.002);n.max.y+=o,this.shadowsRoot.position.set((r.x+n.max.x)/2,r.y-o,(r.z+n.max.z)/2),this.shadowsRoot.scale.set(n.max.x-r.x,n.max.y-r.y,n.max.z-r.z),this.applyMinSize(),this.shadowsRoot.matrixWorldNeedsUpdate=!0,DS&&console.log("Fitted shadows to scene",this.shadowsRoot.scale.clone())}awake(){nD(this.shadowsRoot,!1)}start(){DS&&console.log("Create ContactShadows on "+this.gameObject.name,this),this.gameObject.add(this.shadowsRoot),this.shadowsRoot.add(this.shadowGroup),this.renderTarget=new fi(this.textureSize,this.textureSize),this.renderTarget.texture.generateMipmaps=!1,this.renderTargetBlur=new fi(this.textureSize,this.textureSize),this.renderTargetBlur.texture.generateMipmaps=!1;const n=new Xs(1,1).rotateX(Math.PI/2);this.gameObject instanceof pe&&(console.warn("ContactShadows can not be added to a Mesh. Please add it to a Group or an empty Object"),rp(this.gameObject,!1));const e=new ai({map:this.renderTarget.texture,opacity:this.opacity,color:0,transparent:!0,depthWrite:!1,side:ms});this.plane=new pe(n,e),this.plane.scale.y=-1,this.plane.layers.set(2),this.shadowsRoot.add(this.plane),this.plane&&(this.plane.renderOrder=1),this.occluderMesh=new pe(this.plane.geometry,new ai({depthWrite:!0,stencilWrite:!0,colorWrite:!1,side:wn})).translateY(-1e-4),this.occluderMesh.renderOrder=-100,this.occluderMesh.layers.set(2),this.shadowsRoot.add(this.occluderMesh),this.blurPlane=new pe(n),this.blurPlane.visible=!1,this.shadowGroup.add(this.blurPlane);const i=0,s=1;this.shadowCamera=new lh(-1/2,1/2,1/2,-1/2,i,s),this.shadowCamera.layers.enableAll(),this.shadowCamera.rotation.x=Math.PI/2,this.shadowGroup.add(this.shadowCamera),this.depthMaterial=new n1,this.depthMaterial.userData.darkness={value:this.darkness},this.depthMaterial.blending=oG,this.depthMaterial.blendEquation=aG,this.depthMaterial.onBeforeCompile=r=>{this.depthMaterial&&(r.uniforms.darkness=this.depthMaterial.userData.darkness,r.fragmentShader=`
                uniform float darkness;
                ${r.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 ), ( 1.0 - fragCoordZ ) * darkness * opacity * (gl_FrontFacing ? 1.0 : 0.66) );")}
            `)},this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1,this.horizontalBlurMaterial=new jt(nDe),this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial=new jt(sDe),this.verticalBlurMaterial.depthTest=!1,this.shadowGroup.visible=!1,this.autoFit?this.fitShadows():this.applyMinSize()}onDestroy(){var n,e,i,s,r,o,a,l;(n=this.renderTarget)==null||n.dispose(),(e=this.renderTargetBlur)==null||e.dispose(),(i=this.depthMaterial)==null||i.dispose(),(s=this.horizontalBlurMaterial)==null||s.dispose(),(r=this.verticalBlurMaterial)==null||r.dispose(),(o=this.blurPlane)==null||o.geometry.dispose(),(a=this.plane)==null||a.geometry.dispose(),(l=this.occluderMesh)==null||l.geometry.dispose()}onBeforeRender(n){if(!this.renderTarget||!this.renderTargetBlur||!this.depthMaterial||!this.shadowCamera||!this.blurPlane||!this.shadowGroup||!this.plane||!this.horizontalBlurMaterial||!this.verticalBlurMaterial){DS&&console.error("ContactShadows: not initialized yet");return}const e=this.context.scene,i=this.context.renderer,s=i.getRenderTarget();this.shadowGroup.visible=!0,this.occluderMesh&&(this.occluderMesh.visible=!1);const r=this.plane.visible;this.plane.visible=!1,this.gameObject instanceof pe&&rp(this.gameObject,!1);const o=e.background;e.background=null,e.overrideMaterial=this.depthMaterial,this.backfaceShadows?this.depthMaterial.side=Qi:this.depthMaterial.side=ms;const a=i.getClearAlpha();i.setClearAlpha(0);const l=i.xr.enabled;i.xr.enabled=!1;const c=this.context.scene.matrixWorldAutoUpdate;this.context.scene.matrixWorldAutoUpdate=!1;const h=i.renderLists.get(e,0),d=h.transparent;ire.length=0,h.transparent=ire,a3.length=0;for(const p of h.opaque){if(!p.object.visible)continue;const g=p.material;let f=p.material.colorWrite==!1||g.wireframe===!0||P8(p.object)===!1;!f&&p.material.linewidth!=null&&(f=!0),f&&(a3.push(p.object),p.object["needle:visible"]=p.object.visible,p.object.visible=!1)}i.setRenderTarget(this.renderTarget),i.clear(),i.render(e,this.shadowCamera),h.transparent=d;for(const p of a3)p["needle:visible"]!=null&&(p.visible=p["needle:visible"]);e.overrideMaterial=null;const u=Math.max(this.blur,.05);this.blurShadow(u*2),this.blurShadow(u*.5),this.shadowGroup.visible=!1,this.occluderMesh&&(this.occluderMesh.visible=this.occludeBelowGround),this.plane.visible=r,i.setRenderTarget(s),i.setClearAlpha(a),e.background=o,i.xr.enabled=l,this.context.scene.matrixWorldAutoUpdate=c}blurShadow(n){if(!this.blurPlane||!this.shadowCamera||!this.renderTarget||!this.renderTargetBlur||!this.horizontalBlurMaterial||!this.verticalBlurMaterial)return;this.blurPlane.visible=!0;const e=this.shadowsRoot.worldScale,i=(e.x+e.z)/2,s=e.z/i,r=e.x/i;this.blurPlane.material=this.horizontalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTarget.texture,this.horizontalBlurMaterial.uniforms.h.value=n*1/this.textureSize*s;const o=this.context.renderer,a=o.getRenderTarget();o.setRenderTarget(this.renderTargetBlur),o.render(this.blurPlane,this.shadowCamera),this.blurPlane.material=this.verticalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTargetBlur.texture,this.verticalBlurMaterial.uniforms.v.value=n*1/this.textureSize*r,o.setRenderTarget(this.renderTarget),o.render(this.blurPlane,this.shadowCamera),this.blurPlane.visible=!1,o.setRenderTarget(a)}applyMinSize(){this.minSize&&this.shadowsRoot.scale.set(Math.max(this.minSize.x||0,this.shadowsRoot.scale.x),Math.max(this.minSize.y||0,this.shadowsRoot.scale.y),Math.max(this.minSize.z||0,this.shadowsRoot.scale.z))}},m(o3,"_instances",new Map),o3);let Uh=tre;Gv([T()],Uh.prototype,"autoFit",2),Gv([T()],Uh.prototype,"darkness",2),Gv([T()],Uh.prototype,"opacity",2),Gv([T()],Uh.prototype,"blur",2),Gv([T()],Uh.prototype,"occludeBelowGround",2),Gv([T()],Uh.prototype,"backfaceShadows",2);const ire=[],a3=new Array,nre=class{constructor(){m(this,"_quicklookButton"),m(this,"_arButton"),m(this,"_vrButton"),m(this,"_sendToQuestButton")}static create(){return new nre}static getOrCreate(){return this._instance||(this._instance=this.create()),this._instance}get isSecureConnection(){return window.location.protocol==="https:"}get quicklookButton(){return this._quicklookButton}get arButton(){return this._arButton}get vrButton(){return this._vrButton}get sendToQuestButton(){return this._sendToQuestButton}get qrButton(){return lp.getOrCreate().createQRCode()}createQuicklookButton(){if(this._quicklookButton)return this._quicklookButton;const n=document.createElement("button");this._quicklookButton=n,n.dataset.needle="quicklook-button";const e=Ft.supportsQuickLookAR();n.innerText="View in AR",n.prepend(_o("view_in_ar"));let i=!1,s=null;return n.addEventListener("click",()=>{s=_2(Ms),s||(i=!0,s=new Ms),i&&(s.objectToExport=$t.Current.scene),s?(n.classList.add("this-mode-is-requested"),s.exportAndOpen().then(()=>{n.classList.remove("this-mode-is-requested")}).catch(r=>{n.classList.remove("this-mode-is-requested"),console.error(r)})):console.warn("No USDZExporter component found in the scene")}),this.hideElementDuringXRSession(n),n}createARButton(n){var e;if(this._arButton)return this._arButton;const i="immersive-ar",s=document.createElement("button");return this._arButton=s,s.classList.add("webxr-button"),s.dataset.needle="webxr-ar-button",s.innerText="Enter AR",s.prepend(_o("view_in_ar")),s.title="Click to start an AR session",s.addEventListener("click",()=>Qt.start(i,n)),this.updateSessionSupported(s,i),this.listenToXRSessionState(s,i),this.hideElementDuringXRSession(s),this.isSecureConnection||(s.disabled=!0,s.title="WebXR requires a secure connection (HTTPS)"),Ft.isMozillaXR()||(e=navigator.xr)==null||e.addEventListener("devicechange",()=>this.updateSessionSupported(s,i)),s}createVRButton(n){var e;if(this._vrButton)return this._vrButton;const i="immersive-vr",s=document.createElement("button");return this._vrButton=s,s.classList.add("webxr-button"),s.dataset.needle="webxr-vr-button",s.innerText="Enter VR",s.prepend(_o("panorama_photosphere")),s.title="Click to start a VR session",s.addEventListener("click",()=>Qt.start(i,n)),this.updateSessionSupported(s,i),this.listenToXRSessionState(s,i),this.hideElementDuringXRSession(s),this.isSecureConnection||(s.disabled=!0,s.title="WebXR requires a secure connection (HTTPS)"),Ft.isMozillaXR()||(e=navigator.xr)==null||e.addEventListener("devicechange",()=>this.updateSessionSupported(s,i)),s}createSendToQuestButton(){var n;if(this._sendToQuestButton)return this._sendToQuestButton;const e="https://oculus.com/open_url/?url=",i=document.createElement("button");return this._sendToQuestButton=i,i.dataset.needle="webxr-sendtoquest-button",i.innerText="Open on Quest",i.prepend(_o("share_windows")),i.title="Click to send this page to the Oculus Browser on your Quest",i.addEventListener("click",()=>{const s=encodeURIComponent(window.location.href),r=e+s;window.open(r)==null&&ss("This page doesn't allow popups. Please paste "+r+" into your browser.")}),this.listenToXRSessionState(i),this.hideElementDuringXRSession(i),Ft.isMozillaXR()||(n=navigator.xr)==null||n.addEventListener("devicechange",()=>{var s;(s=navigator.xr)!=null&&s.isSessionSupported("immersive-vr")?i.style.display="none":i.style.display=""}),i}createQRCode(){return lp.getOrCreate().createQRCode()}updateSessionSupported(n,e){if(!("xr"in navigator)){n.style.display="none";return}Qt.isSessionSupported(e).then(i=>{n.style.display=i?"":"none",Je()&&!i&&console.log('[WebXR] "'+e+'" is not supported on this device \u2013 make sure your server runs using HTTPS and you have a device connected that supports '+e)})}hideElementDuringXRSession(n){OR(e=>{n["previous-display"]=n.style.display,n.style.display="none"}),O5(e=>{n["previous-display"]!=null&&(n.style.display=n["previous-display"])})}listenToXRSessionState(n,e){e&&(Qt.onSessionRequestStart(i=>{i.mode===e?n.classList.add("this-mode-is-requested"):(n["was-disabled"]=n.disabled,n.disabled=!0,n.classList.add("other-mode-is-requested"))}),Qt.onSessionRequestEnd(i=>{n.classList.remove("this-mode-is-requested"),n.classList.remove("other-mode-is-requested"),n.disabled=n["was-disabled"]}))}};let nA=nre;m(nA,"_instance");var aDe=Object.defineProperty,lDe=Object.getOwnPropertyDescriptor,$r=(n,e,i,s)=>{for(var r=s>1?void 0:s?lDe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&aDe(e,i,r),r};const sB=q("debugspriterenderer"),cDe=q("wireframe"),l3=class{static getOrCreateGeometry(n){if(n.__cached_geometry)return n.__cached_geometry;if(n.guid&&l3.cache[n.guid])return sB&&console.log("Take cached geometry for sprite",n.guid),l3.cache[n.guid];const e=new Rt;n.__cached_geometry=e;const i=new Float32Array(n.triangles.length*3),s=new Float32Array(n.triangles.length*2);for(let r=0;r<n.triangles.length;r+=1){const o=n.triangles[r];i[r*3]=-n.vertices[o].x,i[r*3+1]=n.vertices[o].y,i[r*3+2]=0;const a=n.uv[o];s[r*2]=a.x,s[r*2+1]=1-a.y}return e.setAttribute("position",new ct(i,3)),e.setAttribute("uv",new ct(s,2)),n.guid&&(this.cache[n.guid]=e),sB&&console.log("Built sprite geometry",n,e),e}};let zS=l3;m(zS,"cache",{});class hDe{constructor(){m(this,"x"),m(this,"y")}}function sre(n){n&&(n.colorSpace!=ut&&(n.colorSpace=ut,n.needsUpdate=!0),n.minFilter==si&&n.magFilter==si&&(n.anisotropy=1,n.needsUpdate=!0))}class qd{constructor(e){m(this,"guid"),m(this,"texture"),m(this,"triangles"),m(this,"uv"),m(this,"vertices"),m(this,"__cached_geometry"),m(this,"_mesh"),m(this,"_material"),e&&(this.texture=e,this.triangles=[0,1,2,0,2,3],this.uv=[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],this.vertices=[{x:-.5,y:-.5},{x:.5,y:-.5},{x:.5,y:.5},{x:-.5,y:.5}])}get mesh(){return this._mesh||(this._mesh=new pe(zS.getOrCreateGeometry(this),this.material)),this._mesh}get material(){return this._material||(this.texture&&sre(this.texture),this._material=new ai({map:this.texture,color:16777215,side:Qi,transparent:!0})),this._material}getGeometry(){return zS.getOrCreateGeometry(this)}}$r([T()],qd.prototype,"guid",2),$r([T(di)],qd.prototype,"texture",2),$r([lv()],qd.prototype,"triangles",2),$r([lv()],qd.prototype,"uv",2),$r([lv()],qd.prototype,"vertices",2);const c3=Symbol("spriteOwner");class Eg{constructor(){m(this,"sprites")}}$r([T(qd)],Eg.prototype,"sprites",2);const rre=class{constructor(){m(this,"spriteSheet"),m(this,"index",0)}static create(){const n=new rre;return n.spriteSheet=new Eg,n}set sprite(n){n&&(this.spriteSheet?((this.index===null||this.index===void 0)&&(this.index=0),this.spriteSheet.sprites[this.index]=n):(this.spriteSheet=new Eg,this.spriteSheet.sprites=[n],this.index=0))}get sprite(){if(this.spriteSheet)return this.spriteSheet.sprites[this.index]}update(n){if(!this.spriteSheet)return;const e=this.index;if(e<0||e>=this.spriteSheet.sprites.length)return;const i=this.spriteSheet.sprites[e],s=i?.texture;if(s&&(sre(s),!i.__hasLoadedProgressive)){i.__hasLoadedProgressive=!0;const r=s;Fi.assignTextureLOD(s,0).then(o=>{o instanceof di&&(i.texture=o,n?.map===r&&(n.map=o,n.needsUpdate=!0))})}}};let _p=rre;$r([T(Eg)],_p.prototype,"spriteSheet",2),$r([T()],_p.prototype,"index",2);class hl extends Oe{constructor(){super(...arguments),m(this,"drawMode",0),m(this,"size",{x:1,y:1}),m(this,"color"),m(this,"sharedMaterial"),m(this,"transparent",!0),m(this,"cutoutThreshold",0),m(this,"castShadows",!1),m(this,"renderOrder",0),m(this,"toneMapped",!0),m(this,"_spriteSheet"),m(this,"_currentSprite")}set texture(e){var i;if(!this._spriteSheet)return;const s=(i=this._spriteSheet.spriteSheet)==null?void 0:i.sprites[this.spriteIndex];s&&(s.texture=e,this.updateSprite())}addSprite(e,i=!1){var s,r;if(this._spriteSheet||(this._spriteSheet=_p.create()),!this._spriteSheet.spriteSheet)return-1;(s=this._spriteSheet.spriteSheet)==null||s.sprites.push(e);const o=((r=this._spriteSheet.spriteSheet)==null?void 0:r.sprites.length)-1;return i&&(this.spriteIndex=o),o}get sprite(){return this._spriteSheet}set sprite(e){if(e!==this._spriteSheet)if(typeof e=="number"){const i=Math.floor(e);this.spriteIndex=i;return}else e instanceof qd?(this._spriteSheet||(this._spriteSheet=_p.create()),this._spriteSheet.sprite!=e&&(this._spriteSheet.sprite=e,this.updateSprite())):e!=this._spriteSheet&&(this._spriteSheet=e,this.updateSprite())}set spriteIndex(e){this._spriteSheet&&e!==this.spriteIndex&&(this._spriteSheet.index=e,this.updateSprite())}get spriteIndex(){var e;return((e=this._spriteSheet)==null?void 0:e.index)??0}get spriteFrames(){var e,i;return((i=(e=this._spriteSheet)==null?void 0:e.spriteSheet)==null?void 0:i.sprites.length)??0}awake(){this._currentSprite=void 0,this._spriteSheet||(this._spriteSheet=new _p,this._spriteSheet.spriteSheet=new Eg),sB&&console.log("Awake",this.name,this,this.sprite)}start(){this._currentSprite?this.gameObject&&this.gameObject.add(this._currentSprite):this.updateSprite()}updateSprite(e=!1){var i;if(!this.__didAwake&&!e)return!1;const s=this._spriteSheet;if(!((i=s?.spriteSheet)!=null&&i.sprites))return console.warn("SpriteRenderer has no data or spritesheet assigned..."),!1;const r=s.spriteSheet.sprites[this.spriteIndex];if(!r)return sB&&console.warn("Sprite not found",this.spriteIndex,s.spriteSheet.sprites),!1;if(this._currentSprite)this._currentSprite.geometry=zS.getOrCreateGeometry(r),this._currentSprite.material.map=r.texture;else{const o=new ai({color:16777215,side:Qi});if(cDe&&(o.wireframe=!0),this.color&&(o.color||(o.color=new fe),o.color.copy(this.color),o.opacity=this.color.alpha),o.transparent=!0,o.toneMapped=this.toneMapped,r.texture&&!o.wireframe){let a=r.texture;a[c3]!==void 0&&a[c3]!==this&&this.spriteFrames>1&&(a=r.texture=a.clone()),a[c3]=this,o.map=a}this.sharedMaterial=o,this._currentSprite=new pe(zS.getOrCreateGeometry(r),o),this._currentSprite.renderOrder=Math.round(this.renderOrder),Fi.assignTextureLOD(o,0)}return this._currentSprite.parent!==this.gameObject&&(this.drawMode===2&&this._currentSprite.scale.set(this.size.x,this.size.y,1),this.gameObject&&this.gameObject.add(this._currentSprite)),this._currentSprite&&this._currentSprite.layers.set(this.layer),this.sharedMaterial&&(this.sharedMaterial.alphaTest=this.cutoutThreshold,this.sharedMaterial.transparent=this.transparent),this._currentSprite.castShadow=this.castShadows,s?.update(this.sharedMaterial),!0}}$r([T()],hl.prototype,"drawMode",2),$r([T(hDe)],hl.prototype,"size",2),$r([T(pn)],hl.prototype,"color",2),$r([T(ti)],hl.prototype,"sharedMaterial",2),$r([T()],hl.prototype,"transparent",2),$r([T()],hl.prototype,"cutoutThreshold",2),$r([T()],hl.prototype,"castShadows",2),$r([T()],hl.prototype,"renderOrder",2),$r([T()],hl.prototype,"toneMapped",2),$r([T(_p)],hl.prototype,"sprite",1);const ore=q("debugwebxr"),dDe=new de().makeRotationY(Math.PI);class Mp extends Oe{constructor(){super(...arguments),m(this,"_arScale",1),m(this,"invertForward",!1),m(this,"customReticle"),m(this,"arTouchTransform",!0),m(this,"autoPlace",!1),m(this,"autoCenter",!1),m(this,"useXRAnchor",!1),m(this,"_isPlacing",!0),m(this,"_startOffset",new de),m(this,"_createdPlacementObject",null),m(this,"_reparentedComponents",[]),m(this,"_placementScene",new ir),m(this,"_reticle",[]),m(this,"_hits",[]),m(this,"_placementStartTime",-1),m(this,"_rigPlacementMatrix"),m(this,"_anchor",null),m(this,"userInput"),m(this,"onPlaceScene",e=>{var i;if(this._isPlacing==!1||e!=null&&e.used)return;let s=this._reticle[0];if(!s){console.warn("No reticle to place...");return}if(!s.visible&&!this.autoPlace){console.warn("Reticle is not visible (can not place)");return}if((i=Qt.active)!=null&&i.isTrackingImages){console.warn("Scene Placement is disabled while images are being tracked");return}let r=this._hits[0];if(e&&e.origin instanceof Z5){const o=this._reticle[e.origin.index];o&&(s=o,r=this._hits[e.origin.index])}if(e&&(e.stopImmediatePropagation(),e.stopPropagation(),e.use()),this._isPlacing=!1,this.context.input.removeEventListener("pointerup",this.onPlaceScene),this.onRevertSceneChanges(),s.position.copy(s.lastPos),s.quaternion.copy(s.lastQuat),this.onApplyPose(s),this.useXRAnchor&&this.onCreateAnchor(Qt.active,r),this.context.xr)for(const o of this.context.xr.controllers)o.cancelHitTestSource()}),m(this,"upVec",new E(0,1,0)),m(this,"lookPoint",new E),m(this,"worldUpVec",new E(0,1,0))}static onPlaced(e){const i="placed";return this._eventListeners[i]||(this._eventListeners[i]=[]),this._eventListeners[i].push(e),()=>{const s=this._eventListeners[i].indexOf(e);s>=0&&this._eventListeners[i].splice(s,1)}}get arScale(){return this._arScale}set arScale(e){e!==this._arScale&&(this._arScale=e,this.onScaleChanged())}onEnable(){var e;(e=this.customReticle)==null||e.preload()}supportsXR(e){return e==="immersive-ar"}onEnterXR(e){ore&&console.log("ENTER WEBXR: SessionRoot start..."),this._anchor=null,this.gameObject.updateMatrixWorld(),this._startOffset.copy(this.gameObject.matrixWorld);const i=new Ae;this._createdPlacementObject=i,i.name="AR Session Root",this._placementScene.name="AR Placement Scene",this._placementScene.children.length=0;for(let s=this.context.scene.children.length-1;s>=0;s--){const r=this.context.scene.children[s];this._placementScene.add(r)}if(this.context.scene.add(i),this.autoCenter){const s=Ll(this._placementScene.children),r=s.getCenter(new E),o=s.getSize(new E),a=new de;a.makeTranslation(r.x,r.y-o.y*.5,r.z),this._startOffset.multiply(a)}this._reparentedComponents.length=0,this._reparentedComponents.push({comp:this,originalObject:this.gameObject}),$.addComponent(i,this);for(const s of this._reticle)Ol(s);this._reticle.length=0,this._isPlacing=!0,this.context.input.addEventListener("pointerup",this.onPlaceScene,{queue:Dl.Early})}onLeaveXR(){this.context.input.removeEventListener("pointerup",this.onPlaceScene,{queue:Dl.Early}),this.onRevertSceneChanges(),this._anchor=null,this._rigPlacementMatrix=void 0}onUpdateXR(e){var i,s,r,o;if(e.xr.isTrackingImages){for(const a of this._reticle)a.visible=!1;return}if(this._isPlacing){const a=(i=e.xr.rig)==null?void 0:i.gameObject;a&&a.parent!==this.context.scene&&this.context.scene.add(a);let l=!1;if(e.xr.isPassThrough&&e.xr.controllers.length>0&&!this.autoPlace)for(const c of e.xr.controllers){const h=c.getHitTest();h&&(l=!0,this.updateReticleAndHits(e.xr,c.index,h,e.xr.rigScale))}if(!l){const c=e.xr.getHitTest();c&&this.updateReticleAndHits(e.xr,0,c,e.xr.rigScale)}}else{if(this._anchor&&e.xr.referenceSpace){const a=e.xr.frame.getPose(this._anchor.anchorSpace,e.xr.referenceSpace);if(a&&this.context.time.frame%20===0){const l=e.xr.convertSpace(a.transform),c=this._reticle[0];c&&(c.position.copy(l.position),c.quaternion.copy(l.quaternion),this.onApplyPose(c))}}if(this.arTouchTransform?(this.userInput||(this.userInput=new rB(this.context)),(s=this.userInput)==null||s.enable()):(r=this.userInput)==null||r.disable(),this.arTouchTransform&&(o=this.userInput)!=null&&o.hasChanged){if(e.xr.rig){const a=e.xr.rig.gameObject;this.userInput.applyMatrixTo(a.matrix,!0),a.matrix.decompose(a.position,a.quaternion,a.scale),this.userInput.factor=a.scale.x}this.userInput.reset()}}}updateReticleAndHits(e,i,s,r){this._hits[i]=s.hit;let o=this._reticle[i];if(!o){if(this.customReticle)if(this.customReticle.asset)o=Yb(this.customReticle.asset);else{this.customReticle.loadAssetAsync();return}else o=new pe(new j_(.07,.09,32).rotateX(-Math.PI/2),new ai({side:Qi,depthTest:!1,depthWrite:!1,transparent:!0,opacity:1,color:15658734})),o.name="AR Placement Reticle";if(ore){const a=new Ya(1);a.position.y+=.01,o.add(a)}this._reticle[i]=o,o.matrixAutoUpdate=!1,o.visible=!1}if(o.lastPos=o.lastPos||s.position.clone(),o.lastQuat=o.lastQuat||s.quaternion.clone(),o.position.copy(o.lastPos.lerp(s.position,this.context.time.deltaTime/.1)),o.lastPos.copy(o.position),o.quaternion.copy(o.lastQuat.slerp(s.quaternion,this.context.time.deltaTime/.05)),o.lastQuat.copy(o.quaternion),o.scale.set(r,r,r),this.customReticle&&this.applyViewBasedTransform(o),o.updateMatrix(),o.visible=!0,o.parent!==this.context.scene&&this.context.scene.add(o),this._placementStartTime<0&&(this._placementStartTime=this.context.time.realtimeSinceStartup),this.autoPlace)if(this.upVec.set(0,1,0).applyQuaternion(o.quaternion),this.upVec.dot(Lt(0,1,0))>.9){let a=o["autoplace:timer"]||0;a>=1?(o.visible=!1,this.onPlaceScene(null)):(a+=this.context.time.deltaTime,o["autoplace:timer"]=a)}else o["autoplace:timer"]=0}onScaleChanged(){}onRevertSceneChanges(){var e;for(const i of this._reticle)i&&(i.visible=!1,i?.removeFromParent());this._reticle.length=0;for(let i=this._placementScene.children.length-1;i>=0;i--){const s=this._placementScene.children[i];this.context.scene.add(s)}(e=this._createdPlacementObject)==null||e.removeFromParent();for(const i of this._reparentedComponents)$.addComponent(i.originalObject,i.comp)}async onCreateAnchor(e,i){if(i.createAnchor===void 0){console.warn("Hit does not support creating an anchor",i),Je()&&An("Hit does not support creating an anchor");return}else{const s=await i.createAnchor(e.viewerPose.transform);e.running&&s&&(this._anchor=s)}}applyViewBasedTransform(e){const i=this.context.mainCamera,s=e,r=i.worldPosition,o=s.worldPosition;this.upVec.set(0,1,0).applyQuaternion(e.quaternion);const a=i.worldPosition;a&&e.position.clone().sub(a).angleTo(this.upVec)<Math.PI/2&&this.upVec.negate();const l=this.upVec.angleTo(this.worldUpVec)*180/Math.PI,c=30;l>c&&l<180-c||l<-c&&l>-180+c?(this.lookPoint.copy(e.position).add(this.upVec),this.lookPoint.y=e.position.y,e.lookAt(this.lookPoint)):(r.y=o.y,e.lookAt(r))}onApplyPose(e){var i,s,r,o;const a=(s=(i=Qt.active)==null?void 0:i.rig)==null?void 0:s.gameObject;if(!a){console.warn("No rig object to place");return}(r=Qt.active)!=null&&r.rigScale;const l=a.parent||this.context.scene;this._rigPlacementMatrix?(o=this._rigPlacementMatrix)==null||o.decompose(a.position,a.quaternion,a.scale):this._rigPlacementMatrix=a.matrix.clone(),this.applyViewBasedTransform(e),e.updateMatrix(),this.context.scene.add(e),e.attach(a),e.removeFromParent(),a.scale.set(this.arScale,this.arScale,this.arScale),a.position.multiplyScalar(this.arScale),a.updateMatrix(),this.invertForward&&a.matrix.premultiply(dDe),a.matrix.premultiply(this._startOffset),a.matrix.decompose(a.position,a.quaternion,a.scale),l.add(a)}}m(Mp,"_eventListeners",{});const h3=class{constructor(n){m(this,"oneFingerDrag",!0),m(this,"twoFingerRotate",!0),m(this,"twoFingerScale",!0),m(this,"factor",1),m(this,"context"),m(this,"offset"),m(this,"plane"),m(this,"_scale",1),m(this,"_hasChanged",!1),m(this,"_enabled",!1),m(this,"currentlyUsedPointerIds",new Set),m(this,"currentlyUnusedPointerIds",new Set),m(this,"onPointerDownEarly",e=>{this.isActive&&e.stopPropagation()}),m(this,"onPointerDownLate",e=>{e.used?this.currentlyUsedPointerIds.add(e.pointerId):this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.add(e.pointerId)}),m(this,"onPointerUpEarly",e=>{this.currentlyUsedPointerIds.delete(e.pointerId),this.currentlyUnusedPointerIds.delete(e.pointerId)}),m(this,"prev",new Map),m(this,"_didMultitouch",!1),m(this,"touchStart",e=>{if(!e.defaultPrevented)for(let i=0;i<e.changedTouches.length;i++){const s=e.changedTouches[i],r=Ft.isAndroidDevice()&&s.clientY<window.innerHeight*.1;this.prev.has(s.identifier)||this.prev.set(s.identifier,{ignore:r,x:0,z:0,screenx:0,screeny:0});const o=this.prev.get(s.identifier);if(o){const a=this.getPositionOnPlane(s.clientX,s.clientY);o.x=a.x,o.z=a.z,o.screenx=s.clientX,o.screeny=s.clientY}}}),m(this,"touchEnd",e=>{e.touches.length<=0&&(this._didMultitouch=!1);for(let i=0;i<e.changedTouches.length;i++){const s=e.changedTouches[i];this.prev.delete(s.identifier)}}),m(this,"touchMove",e=>{if(!e.defaultPrevented&&this.isActive){if(e.touches.length===1){if(this._didMultitouch)return;const i=e.touches[0],s=this.prev.get(i.identifier);if(!s||s.ignore)return;const r=this.getPositionOnPlane(i.clientX,i.clientY),o=r.x-s.x,a=r.z-s.z;if(o===0&&a===0)return;this.oneFingerDrag&&this.addMovement(o,a),s.x=r.x,s.z=r.z,s.screenx=i.clientX,s.screeny=i.clientY;return}else if(e.touches.length===2){this._didMultitouch=!0;const i=e.touches[0],s=e.touches[1],r=this.prev.get(i.identifier),o=this.prev.get(s.identifier);if(!r||!o)return;if(this.twoFingerRotate){const a=Math.atan2(i.clientY-s.clientY,i.clientX-s.clientX),l=Math.atan2(r.screeny-o.screeny,r.screenx-o.screenx),c=a-l;Math.abs(c)>.001&&this.addRotation(c)}if(this.twoFingerScale){const a=i.clientX-s.clientX,l=i.clientY-s.clientY,c=Math.sqrt(a*a+l*l),h=r.screenx-o.screenx,d=r.screeny-o.screeny,u=Math.sqrt(h*h+d*d),p=c-u;Math.abs(p)>2&&this.addScale(p)}r.screenx=i.clientX,r.screeny=i.clientY,o.screenx=s.clientX,o.screeny=s.clientY}}}),m(this,"_raycaster",new pm),m(this,"_intersection",new E),m(this,"_screenPos",new E),m(this,"_tempMatrix",new de),this.context=n,this.offset=new de,this.plane=new tr,this.plane.setFromNormalAndCoplanarPoint(h3.up,h3.zero)}reset(){this._scale=1,this.offset.identity()}get hasChanged(){return this._hasChanged}applyMatrixTo(n,e){this._hasChanged=!1,e?(this.offset.invert(),n.premultiply(this.offset)):n.multiply(this.offset)}get isActive(){return this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.size>0}enable(){this._enabled||(this._enabled=!0,this.context.input.addEventListener("pointerdown",this.onPointerDownEarly,{queue:Dl.Early}),this.context.input.addEventListener("pointerdown",this.onPointerDownLate,{queue:Dl.Late}),this.context.input.addEventListener("pointerup",this.onPointerUpEarly,{queue:Dl.Early}),window.addEventListener("touchstart",this.touchStart,{passive:!1}),window.addEventListener("touchmove",this.touchMove,{passive:!1}),window.addEventListener("touchend",this.touchEnd,{passive:!1}))}disable(){this._enabled&&(this._enabled=!1,this.context.input.removeEventListener("pointerdown",this.onPointerDownEarly,{queue:Dl.Early}),this.context.input.removeEventListener("pointerdown",this.onPointerDownLate,{queue:Dl.Late}),this.context.input.removeEventListener("pointerup",this.onPointerUpEarly,{queue:Dl.Early}),window.removeEventListener("touchstart",this.touchStart),window.removeEventListener("touchmove",this.touchMove),window.removeEventListener("touchend",this.touchEnd))}getPositionOnPlane(n,e){const i=this.context.mainCamera;return this._screenPos.x=n/window.innerWidth*2-1,this._screenPos.y=-(e/window.innerHeight)*2+1,this._screenPos.z=1,this._screenPos.unproject(i),this._raycaster.set(i.position,this._screenPos.sub(i.position)),this._raycaster.ray.intersectPlane(this.plane,this._intersection),this._intersection}addMovement(n,e){n/=this._scale,e/=this._scale,n*=this.factor,e*=this.factor,this.offset.elements[12]+=n,this.offset.elements[14]+=e,(n!==0||e!==0)&&(this._hasChanged=!0)}addScale(n){n/=window.innerWidth,n*=-1,this._scale*=1+n,this._tempMatrix.makeScale(1-n,1-n,1-n),this.offset.premultiply(this._tempMatrix),n!==0&&(this._hasChanged=!0)}addRotation(n){n*=-1,this._tempMatrix.makeRotationY(n),this.offset.premultiply(this._tempMatrix),n!==0&&(this._hasChanged=!0)}};let rB=h3;m(rB,"up",new E(0,1,0)),m(rB,"zero",new E(0,0,0)),m(rB,"one",new E(1,1,1));var uDe=Object.defineProperty,pDe=Object.getOwnPropertyDescriptor,Pv=(n,e,i,s)=>{for(var r=s>1?void 0:s?pDe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&uDe(e,i,r),r};class $d extends Oe{constructor(){super(...arguments),m(this,"position","bottom"),m(this,"showNeedleLogo",!0),m(this,"showSpatialMenu"),m(this,"createFullscreenButton"),m(this,"createMuteButton"),m(this,"createQRCodeButton")}onEnable(){this.applyOptions()}applyOptions(){this.context.menu.setPosition(this.position),this.context.menu.showNeedleLogo(this.showNeedleLogo),this.createFullscreenButton===!0&&this.context.menu.showFullscreenOption(!0),this.createMuteButton===!0&&this.context.menu.showAudioPlaybackOption(!0),this.showSpatialMenu===!0&&this.context.menu.showSpatialMenu(this.showSpatialMenu),this.createQRCodeButton===!0&&(Ft.isMobileDevice()||this.context.menu.showQRCodeButton(!0))}}Pv([T()],$d.prototype,"position",2),Pv([T()],$d.prototype,"showNeedleLogo",2),Pv([T()],$d.prototype,"showSpatialMenu",2),Pv([T()],$d.prototype,"createFullscreenButton",2),Pv([T()],$d.prototype,"createMuteButton",2),Pv([T()],$d.prototype,"createQRCodeButton",2);const Ps={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function are(n){const e=await fetch(n);if(e.ok)return e.json();throw new Error(e.statusText)}async function mDe(n){if(!n)throw new Error("No basePath supplied");return await are(`${n}/profilesList.json`)}async function gDe(n,e,i=null,s=!0){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const r=await mDe(e);let o;if(n.profiles.some(c=>{const h=r[c];return h&&(o={profileId:c,profilePath:`${e}/${h.path}`,deprecated:!!h.deprecated}),!!o}),!o){if(!i)throw new Error("No matching profile name found");const c=r[i];if(!c)throw new Error(`No matching profile name found and default profile "${i}" missing.`);o={profileId:i,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}}const a=await are(o.profilePath);let l;if(s){let c;if(n.handedness==="any"?c=a.layouts[Object.keys(a.layouts)[0]]:c=a.layouts[n.handedness],!c)throw new Error(`No matching handedness, ${n.handedness}, in profile ${o.profileId}`);c.assetPath&&(l=o.profilePath.replace("profile.json",c.assetPath))}return{profile:a,assetPath:l}}const fDe={xAxis:0,yAxis:0,button:0,state:Ps.ComponentState.DEFAULT};function ADe(n=0,e=0){let i=n,s=e;if(Math.sqrt(n*n+e*e)>1){const r=Math.atan2(e,n);i=Math.cos(r),s=Math.sin(r)}return{normalizedXAxis:i*.5+.5,normalizedYAxis:s*.5+.5}}class yDe{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Ps.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(fDe)}updateFromComponent({xAxis:e,yAxis:i,button:s,state:r}){const{normalizedXAxis:o,normalizedYAxis:a}=ADe(e,i);switch(this.componentProperty){case Ps.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?o:.5;break;case Ps.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?a:.5;break;case Ps.ComponentProperty.BUTTON:this.value=this.states.includes(r)?s:0;break;case Ps.ComponentProperty.STATE:this.valueNodeProperty===Ps.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class bDe{constructor(e,i){if(!e||!i||!i.visualResponses||!i.gamepadIndices||Object.keys(i.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=i.type,this.rootNodeName=i.rootNodeName,this.touchPointNodeName=i.touchPointNodeName,this.visualResponses={},Object.keys(i.visualResponses).forEach(s=>{const r=new yDe(i.visualResponses[s]);this.visualResponses[s]=r}),this.gamepadIndices=Object.assign({},i.gamepadIndices),this.values={state:Ps.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=Ps.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const i=e.buttons[this.gamepadIndices.button];this.values.button=i.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,i.pressed||this.values.button===1?this.values.state=Ps.ComponentState.PRESSED:(i.touched||this.values.button>Ps.ButtonTouchThreshold)&&(this.values.state=Ps.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Ps.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Ps.AxisTouchThreshold&&(this.values.state=Ps.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Ps.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Ps.AxisTouchThreshold&&(this.values.state=Ps.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(i=>{i.updateFromComponent(this.values)})}}class vDe{constructor(e,i,s){if(!e)throw new Error("No xrInputSource supplied");if(!i)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=s,this.id=i.profileId,this.layoutDescription=i.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(r=>{const o=this.layoutDescription.components[r];this.components[r]=new bDe(r,o)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(i=>{e.push(i.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const xDe="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",wDe="generic-trigger";let CDe=class extends Ae{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(n){return this.envMap==n?this:(this.envMap=n,this.traverse(e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}),this)}updateMatrixWorld(n){super.updateMatrixWorld(n),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(i=>{const{valueNode:s,minNode:r,maxNode:o,value:a,valueNodeProperty:l}=i;s&&(l===Ps.VisualResponseProperty.VISIBILITY?s.visible=a:l===Ps.VisualResponseProperty.TRANSFORM&&(s.quaternion.slerpQuaternions(r.quaternion,o.quaternion,a),s.position.lerpVectors(r.position,o.position,a)))})}))}};function SDe(n,e){Object.values(n.components).forEach(i=>{const{type:s,touchPointNodeName:r,visualResponses:o}=i;if(s===Ps.ComponentType.TOUCHPAD)if(i.touchPointNode=e.getObjectByName(r),i.touchPointNode){const a=new eh(.001),l=new ai({color:255}),c=new pe(a,l);i.touchPointNode.add(c)}else console.warn(`Could not find touch dot, ${i.touchPointNodeName}, in touchpad component ${i.id}`);Object.values(o).forEach(a=>{const{valueNodeName:l,minNodeName:c,maxNodeName:h,valueNodeProperty:d}=a;if(d===Ps.VisualResponseProperty.TRANSFORM){if(a.minNode=e.getObjectByName(c),a.maxNode=e.getObjectByName(h),!a.minNode){console.warn(`Could not find ${c} in the model`);return}if(!a.maxNode){console.warn(`Could not find ${h} in the model`);return}}a.valueNode=e.getObjectByName(l),a.valueNode||console.warn(`Could not find ${l} in the model`)})})}function lre(n,e){SDe(n.motionController,e),n.envMap&&e.traverse(i=>{i.isMesh&&(i.material.envMap=n.envMap,i.material.needsUpdate=!0)}),n.layers.mask!=0&&e.traverse(i=>{i.layers.mask=n.layers.mask}),n.add(e)}class _De{constructor(e=null,i=null){this.gltfLoader=e,this.path=xDe,this._assetCache={},this.onLoad=i,this.gltfLoader||(this.gltfLoader=new ip)}setPath(e){return this.path=e,this}createControllerModel(e){const i=new CDe;let s=null;return e.addEventListener("connected",r=>{const o=r.data;o.targetRayMode!=="tracked-pointer"||!o.gamepad||o.hand||gDe(o,this.path,wDe).then(({profile:a,assetPath:l})=>{i.motionController=new vDe(o,a,l);const c=this._assetCache[i.motionController.assetUrl];if(c)s=c.scene.clone(),lre(i,s),this.onLoad&&this.onLoad(s);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(i.motionController.assetUrl,h=>{this._assetCache[i.motionController.assetUrl]=h,s=h.scene.clone(),lre(i,s),this.onLoad&&this.onLoad(s)},null,()=>{throw new Error(`Asset ${i.motionController.assetUrl} missing or malformed.`)})}}).catch(a=>{console.warn(a)})}),e.addEventListener("disconnected",()=>{i.motionController=null,i.remove(s),s=null}),i}}const MDe="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class IDe{constructor(e,i,s,r,o=null,a=null){this.controller=i,this.handModel=e,this.bones=[],o===null&&(o=new ip,o.setPath(s||MDe)),o.load(`${r}.glb`,l=>{const c=l.scene.children[0];this.handModel.add(c),c.layers.mask=this.handModel.layers.mask;const h=c.getObjectByProperty("type","SkinnedMesh");h.frustumCulled=!1,h.castShadow=!0,h.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(d=>{const u=c.getObjectByName(d);u!==void 0?u.jointName=d:console.warn(`Couldn't find ${d} in ${r} hand mesh`),this.bones.push(u)}),a&&a(c)})}updateMesh(){const e=this.controller.joints;for(let i=0;i<this.bones.length;i++){const s=this.bones[i];if(s){const r=e[s.jointName];if(r.visible){const o=r.position;s.position.copy(o),s.quaternion.copy(r.quaternion)}}}}}var TDe=Object.defineProperty,EDe=Object.getOwnPropertyDescriptor,oB=(n,e,i,s)=>{for(var r=s>1?void 0:s?EDe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&TDe(e,i,r),r};const Ip=q("debugwebxr"),Rg=new Array;class eu extends Oe{constructor(){super(...arguments),m(this,"createControllerModel",!0),m(this,"createHandModel",!0),m(this,"customLeftHand"),m(this,"customRightHand"),m(this,"_models",new Array)}supportsXR(e){return e==="immersive-vr"||e==="immersive-ar"}async onXRControllerAdded(e){var i;if(!(e.xr.isVR||e.xr.isPassThrough))return;const{controller:s}=e;if(Ip&&console.warn("Add Controller Model for",s.side,s.index),this.createControllerModel||this.createHandModel){if(s.hand){if(this.createHandModel){const r=await this.loadHandModel(this,s);if(!r||!s.connected||!s.isHand){r!=null&&r.handObject&&Kb(r.handObject,!1),(i=r?.handObject)==null||i.destroy();return}this._models.push({controller:s,model:r.handObject,handmesh:r.handmesh}),this._models.sort((o,a)=>o.controller.index-a.controller.index),this.scene.add(r.handObject),s.model=r.handObject}}else if(this.createControllerModel){const r=await s.getModelUrl();if(r){const o=await this.loadModel(s,r);if(!o||!s.connected||s.isHand)return;this._models.push({controller:s,model:o}),this._models.sort((a,l)=>a.controller.index-l.controller.index),this.scene.add(o),o.traverse(a=>{a.layers.set(2),a.matrixAutoUpdate=!1,a.updateMatrix()}),s.model=o}else s.targetRayMode!=="transient-pointer"&&console.warn("XRControllerModel: no model found for "+s.side)}}}onXRControllerRemoved(e){console.debug("XR Controller Removed",e.controller.side,e.controller.index);const i=this._models.findIndex(r=>r.controller===e.controller),s=this._models[i];s&&(this._models.splice(i,1),s.model&&(Kb(s.model,!1),s.model.destroy(),s.model=void 0))}onLeaveXR(e){for(const i of this._models)i&&(i.model&&(Kb(i.model,!1),i.model.destroy(),i.model=void 0),i.controller.model===i.model&&(i.controller.model=null));this._models.length=0}onBeforeRender(){if(Qt.active&&(Ip&&(Rg[0]=Date.now()),this.updateRendering(Qt.active),Ip)){const e=Date.now()-Rg[0];Rg.push(e),Rg.length>=30&&(Rg[0]=0,Rg.reduce((i,s)=>i+s,0)/Rg.length,Rg.length=0)}}updateRendering(e){var i,s,r,o,a;for(let l=0;l<this._models.length;l++){const c=this._models[l];if(!c)continue;const h=c.controller;if(!h.connected){Ip&&console.warn("XRControllerModel.onUpdateXR: controller is not connected anymore",h.side,h.hand);continue}if(c.model&&!c.handmesh)c.model.matrixAutoUpdate=!1,c.model.matrix.copy(h.gripMatrix),c.model.visible=h.isTracking,(i=e.rig)==null||i.gameObject.add(c.model);else if(h.inputSource.hand&&c.handmesh){const d=e.referenceSpace,u=this.context.renderer.xr.getHand(h.index);if(d&&e.frame.getJointPose){for(const p of h.inputSource.hand.values()){const g=u.joints[p.jointName];if(g){const f=h.getHandJointPose(p);if(f){const A=f.transform.position,y=f.transform.orientation;g.position.copy(A),g.quaternion.copy(y),g.matrixAutoUpdate=!1}g.visible=f!=null}}c.model&&(c.model.visible=h.isTracking,c.model.visible&&c.model.parent!==((s=e.rig)==null?void 0:s.gameObject)&&((r=e.rig)==null||r.gameObject.add(c.model))),(o=c.model)!=null&&o.visible&&((a=c.handmesh)==null||a.updateMesh(),c.model.matrixAutoUpdate=!1,c.model.matrix.identity(),c.model.applyMatrix4(Nb))}}}}async loadModel(e,i){var s;if(!e.connected)return console.warn("XRControllerModel.onXRControllerAdded: controller is not connected anymore",e.side),null;const r=await Mi.getOrCreate("",i).instantiate();return Kb(r),(s=Qt.active)!=null&&s.isPassThrough&&r.traverseVisible(o=>{this.makeOccluder(o)}),r}async loadHandModel(e,i){const s=this.context,r=s.renderer.xr.getHand(i.index);r||(Ip?Nt.DrawLabel(i.rayWorldPosition,"No hand found for index "+i.index,.05,5):console.warn("No hand found for index "+i.index));const o=new ip;tL(o,s),await JL(o,s,this.sourceId??"");const a=jL(o);let l="";const c=i.side==="left"?this.customLeftHand:this.customRightHand;c?(l=c.url.split(".").slice(0,-1).join("."),o.setPath("")):(l=i.inputSource.handedness==="left"?"left":"right",o.setPath("https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/"));const h=new Ae;Kb(h);const d=new IDe(h,r,o.path,l,o,u=>{var p;const g=a.gltf;((p=g?.scene.children)==null?void 0:p.length)===0&&(g.scene.children[0]=u),fh().createBuiltinComponents(e.context,e.sourceId||l,a.gltf,null,a),u.traverse(f=>{var A;f.layers.set(2),(A=Qt.active)!=null&&A.isPassThrough&&!c&&this.makeOccluder(f),f instanceof pe&&Fi.assignMeshLOD(f,0)}),i.connected||(Ip&&Nt.DrawLabel(i.rayWorldPosition,"Hand is loaded but not connected anymore",.05,5),u.removeFromParent())});if(Ip&&h.add(new Ya(.5)),i.inputSource.hand){Ip&&console.log(i.inputSource.hand);for(const u of i.inputSource.hand.values())if(r.joints[u.jointName]===void 0){const p=new Es;p.matrixAutoUpdate=!1,p.visible=!0,r.joints[u.jointName]=p,r.add(p)}}else Ip&&Nt.DrawLabel(i.rayWorldPosition,"No inputSource.hand found for index "+i.index,.05,5);return{handObject:h,handmesh:d}}makeOccluder(e){if(e instanceof pe){let i=e.material;i instanceof ti&&(i=e.material=i.clone(),i.depthWrite=!0,i.depthTest=!0,i.colorWrite=!1,e.receiveShadow=!1,e.renderOrder=-100)}}}m(eu,"factory",new _De),oB([T()],eu.prototype,"createControllerModel",2),oB([T()],eu.prototype,"createHandModel",2),oB([T(Mi)],eu.prototype,"customLeftHand",2),oB([T(Mi)],eu.prototype,"customRightHand",2);const cre=new gi,aB=new E;class hre extends AT{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],i=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],s=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(s),this.setAttribute("position",new dt(e,3)),this.setAttribute("uv",new dt(i,2))}applyMatrix4(e){const i=this.attributes.instanceStart,s=this.attributes.instanceEnd;return i!==void 0&&(i.applyMatrix4(e),s.applyMatrix4(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new _1(i,6,1);return this.setAttribute("instanceStart",new xa(s,3,0)),this.setAttribute("instanceEnd",new xa(s,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new _1(i,6,1);return this.setAttribute("instanceColorStart",new xa(s,3,0)),this.setAttribute("instanceColorEnd",new xa(s,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new GP(e.geometry)),this}fromLineSegments(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new gi);const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;e!==void 0&&i!==void 0&&(this.boundingBox.setFromBufferAttribute(e),cre.setFromBufferAttribute(i),this.boundingBox.union(cre))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Vn),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(e!==void 0&&i!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let r=0;for(let o=0,a=e.count;o<a;o++)aB.fromBufferAttribute(e,o),r=Math.max(r,s.distanceToSquared(aB)),aB.fromBufferAttribute(i,o),r=Math.max(r,s.distanceToSquared(aB));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}ht.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Q(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},Wn.line={uniforms:Ay.merge([ht.common,ht.fog,ht.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class d3 extends jt{constructor(e){super({type:"LineMaterial",uniforms:Ay.clone(Wn.line.uniforms),vertexShader:Wn.line.vertexShader,fragmentShader:Wn.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const u3=new $e,dre=new E,ure=new E,Go=new $e,Po=new $e,tu=new $e,p3=new E,m3=new de,No=new vc,pre=new E,lB=new gi,cB=new Vn,iu=new $e;let nu,sA;function mre(n,e,i){return iu.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),iu.multiplyScalar(1/iu.w),iu.x=sA/i.width,iu.y=sA/i.height,iu.applyMatrix4(n.projectionMatrixInverse),iu.multiplyScalar(1/iu.w),Math.abs(Math.max(iu.x,iu.y))}function RDe(n,e){const i=n.matrixWorld,s=n.geometry,r=s.attributes.instanceStart,o=s.attributes.instanceEnd,a=Math.min(s.instanceCount,r.count);for(let l=0,c=a;l<c;l++){No.start.fromBufferAttribute(r,l),No.end.fromBufferAttribute(o,l),No.applyMatrix4(i);const h=new E,d=new E;nu.distanceSqToSegment(No.start,No.end,d,h),d.distanceTo(h)<sA*.5&&e.push({point:d,pointOnLine:h,distance:nu.origin.distanceTo(d),object:n,face:null,faceIndex:l,uv:null,uv1:null})}}function LDe(n,e,i){const s=e.projectionMatrix,r=n.material.resolution,o=n.matrixWorld,a=n.geometry,l=a.attributes.instanceStart,c=a.attributes.instanceEnd,h=Math.min(a.instanceCount,l.count),d=-e.near;nu.at(1,tu),tu.w=1,tu.applyMatrix4(e.matrixWorldInverse),tu.applyMatrix4(s),tu.multiplyScalar(1/tu.w),tu.x*=r.x/2,tu.y*=r.y/2,tu.z=0,p3.copy(tu),m3.multiplyMatrices(e.matrixWorldInverse,o);for(let u=0,p=h;u<p;u++){if(Go.fromBufferAttribute(l,u),Po.fromBufferAttribute(c,u),Go.w=1,Po.w=1,Go.applyMatrix4(m3),Po.applyMatrix4(m3),Go.z>d&&Po.z>d)continue;if(Go.z>d){const b=Go.z-Po.z,v=(Go.z-d)/b;Go.lerp(Po,v)}else if(Po.z>d){const b=Po.z-Go.z,v=(Po.z-d)/b;Po.lerp(Go,v)}Go.applyMatrix4(s),Po.applyMatrix4(s),Go.multiplyScalar(1/Go.w),Po.multiplyScalar(1/Po.w),Go.x*=r.x/2,Go.y*=r.y/2,Po.x*=r.x/2,Po.y*=r.y/2,No.start.copy(Go),No.start.z=0,No.end.copy(Po),No.end.z=0;const g=No.closestPointToPointParameter(p3,!0);No.at(g,pre);const f=Di.lerp(Go.z,Po.z,g),A=f>=-1&&f<=1,y=p3.distanceTo(pre)<sA*.5;if(A&&y){No.start.fromBufferAttribute(l,u),No.end.fromBufferAttribute(c,u),No.start.applyMatrix4(o),No.end.applyMatrix4(o);const b=new E,v=new E;nu.distanceSqToSegment(No.start,No.end,v,b),i.push({point:v,pointOnLine:b,distance:nu.origin.distanceTo(v),object:n,face:null,faceIndex:u,uv:null,uv1:null})}}}class BDe extends pe{constructor(e=new hre,i=new d3({color:Math.random()*16777215})){super(e,i),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,i=e.attributes.instanceStart,s=e.attributes.instanceEnd,r=new Float32Array(2*i.count);for(let a=0,l=0,c=i.count;a<c;a++,l+=2)dre.fromBufferAttribute(i,a),ure.fromBufferAttribute(s,a),r[l]=l===0?0:r[l-1],r[l+1]=r[l]+dre.distanceTo(ure);const o=new _1(r,2,1);return e.setAttribute("instanceDistanceStart",new xa(o,1,0)),e.setAttribute("instanceDistanceEnd",new xa(o,1,1)),this}raycast(e,i){const s=this.material.worldUnits,r=e.camera;r===null&&!s&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const o=e.params.Line2!==void 0&&e.params.Line2.threshold||0;nu=e.ray;const a=this.matrixWorld,l=this.geometry,c=this.material;sA=c.linewidth+o,l.boundingSphere===null&&l.computeBoundingSphere(),cB.copy(l.boundingSphere).applyMatrix4(a);let h;if(s)h=sA*.5;else{const u=Math.max(r.near,cB.distanceToPoint(nu.origin));h=mre(r,u,c.resolution)}if(cB.radius+=h,nu.intersectsSphere(cB)===!1)return;l.boundingBox===null&&l.computeBoundingBox(),lB.copy(l.boundingBox).applyMatrix4(a);let d;if(s)d=sA*.5;else{const u=Math.max(r.near,lB.distanceToPoint(nu.origin));d=mre(r,u,c.resolution)}lB.expandByScalar(d),nu.intersectsBox(lB)!==!1&&(s?RDe(this,i):LDe(this,r,i))}onBeforeRender(e){const i=this.material.uniforms;i&&i.resolution&&(e.getViewport(u3),this.material.uniforms.resolution.value.set(u3.z,u3.w))}}class gre extends hre{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const i=e.length-3,s=new Float32Array(2*i);for(let r=0;r<i;r+=3)s[2*r]=e[r],s[2*r+1]=e[r+1],s[2*r+2]=e[r+2],s[2*r+3]=e[r+3],s[2*r+4]=e[r+4],s[2*r+5]=e[r+5];return super.setPositions(s),this}setColors(e){const i=e.length-3,s=new Float32Array(2*i);for(let r=0;r<i;r+=3)s[2*r]=e[r],s[2*r+1]=e[r+1],s[2*r+2]=e[r+2],s[2*r+3]=e[r+3],s[2*r+4]=e[r+4],s[2*r+5]=e[r+5];return super.setColors(s),this}fromLine(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}}class kDe extends BDe{constructor(e=new gre,i=new d3({color:Math.random()*16777215})){super(e,i),this.isLine2=!0,this.type="Line2"}}class hB extends Oe{}var GDe=Object.defineProperty,PDe=Object.getOwnPropertyDescriptor,Lg=(n,e,i,s)=>{for(var r=s>1?void 0:s?PDe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&GDe(e,i,r),r};const g3=q("debugwebxr");class ic extends Oe{constructor(){super(...arguments),m(this,"movementSpeed",1.5),m(this,"rotationStep",30),m(this,"useTeleport",!0),m(this,"usePinchToTeleport",!0),m(this,"useTeleportTarget",!1),m(this,"useTeleportFade",!1),m(this,"showRays",!0),m(this,"showHits",!0),m(this,"isXRMovementHandler",!0),m(this,"xrSessionMode","immersive-vr"),m(this,"_didApplyRotation",!1),m(this,"_didTeleport",!1),m(this,"_teleportBuffer",new Array),m(this,"_plane",null),m(this,"_lines",[]),m(this,"_hitDiscs",[]),m(this,"_hitDistances",[]),m(this,"_lastHitDistances",[]),m(this,"hitPointRaycastFilter",e=>e.type==="SkinnedMesh"?"continue in children":!0)}onUpdateXR(e){const i=e.xr.rig;if(!(i!=null&&i.gameObject)||e.xr.isPassThrough)return;const s=e.xr.leftController,r=e.xr.rightController;s&&this.onHandleMovement(s,i.gameObject),r&&(this.onHandleRotation(r,i.gameObject),this.useTeleport&&this.onHandleTeleport(r,i.gameObject))}onLeaveXR(e){for(const i of this._lines)i.removeFromParent();for(const i of this._hitDiscs)i?.removeFromParent()}onBeforeRender(){var e;(e=this.context.xr)!=null&&e.running&&(this.showRays&&this.renderRays(this.context.xr),this.showHits&&this.renderHits(this.context.xr))}onHandleMovement(e,i){const s=e.getStick("xr-standard-thumbstick");if(s.x!=0||s.y!=0){const r=Lt(s.x,0,s.y);r.multiplyScalar(this.context.time.deltaTimeUnscaled*this.movementSpeed);const o=Dn(i);r.multiplyScalar(o.x),r.applyQuaternion(e.xr.poseOrientation),r.y=0,r.applyQuaternion(i.worldQuaternion),i.position.add(r),i.updateWorldMatrix(!1,!1);for(const a of i.children)a.updateWorldMatrix(!1,!1)}}onHandleRotation(e,i){if(e._isMxInk)return;const s=e.getStick("xr-standard-thumbstick").x;if(this._didApplyRotation)Math.abs(s)<.3&&(this._didApplyRotation=!1);else if(Math.abs(s)>.5){this._didApplyRotation=!0;const r=s>0?1:-1,o=ri(this.context.mainCamera).clone();i.rotateY(r*lt.toRadians(this.rotationStep));const a=ri(this.context.mainCamera).clone().sub(o);a.y=0,i.position.sub(a)}}onHandleTeleport(e,i){var s,r,o,a,l;let c=0;if(e.hand&&this.usePinchToTeleport&&e.isTeleportGesture){const h=e.getPointerId("primary");if(h!=null&&this.context.input.getIsPointerIdInUse(h))return;const d=e.getGesture("pinch");d&&(c=d.value)}else c=(s=e.getStick("xr-standard-thumbstick"))==null?void 0:s.y;if(this._didTeleport)c>=0&&c<.4?this._didTeleport=!1:c<0&&c>-.4&&(this._didTeleport=!1);else if(c>.8){this._didTeleport=!0;const h=this.context.physics.raycastFromRay(e.ray)[0];if(h&&h.object instanceof tb){const u=(r=h.normal)==null?void 0:r.dot(Lt(0,1,0));if(u!==void 0&&u<.4)return}let d=h?.point;if(!d&&!this.useTeleportTarget){this._plane||(this._plane=new tr(new E(0,1,0),0));const u=i.worldPosition;this._plane.setFromNormalAndCoplanarPoint(new E(0,1,0),u);const p=e.ray;d=u.clone(),this._plane.intersectLine(new vc(p.origin,Lt(p.direction).multiplyScalar(1e4).add(p.origin)),d),d.distanceTo(u)>i.scale.x*10&&(d=null)}if(d){if(this.useTeleportTarget&&!$.getComponentInParent(h.object,hB))return;const u=d.clone();if(g3&&Nt.DrawSphere(d,.025,16711680,5),(o=this.context.mainCamera)==null?void 0:o.position){const p=(a=this.context.xr)==null?void 0:a.getUserOffsetInRig();p&&(p.y=0,u.sub(p),g3&&Nt.DrawWireSphere(p.add(u),.025,65280,5))}this._teleportBuffer.push(i.matrix.clone()),this._teleportBuffer.length>10&&this._teleportBuffer.shift(),this.useTeleportFade?(l=e.xr.fadeTransition())==null||l.then(()=>{i.worldPosition=u}):i.worldPosition=u}}else if(c<-.8&&(this._didTeleport=!0,this._teleportBuffer.length>0)){const h=this._teleportBuffer.pop();h&&h.decompose(i.position,i.quaternion,i.scale)}}renderRays(e){var i;for(let s=0;s<this._lines.length;s++){const r=this._lines[s];r&&(r.visible=!1)}for(let s=0;s<e.controllers.length;s++){const r=e.controllers[s];let o=this._lines[s];if(!r.connected||!r.isTracking||!r.ray||r.targetRayMode==="transient-pointer"||!r.hasSelectEvent){o&&(o.visible=!1);continue}o||(o=this.createRayLineObject(),o.scale.z=.5,this._lines[s]=o),r.updateRayWorldPosition(),r.updateRayWorldQuaternion();const a=r.rayWorldPosition,l=r.rayWorldQuaternion;o.position.copy(a),o.quaternion.copy(l);const c=e.rigScale,h=this.usePinchToTeleport&&r.isTeleportGesture,d=this._lastHitDistances[s],u=this._hitDistances[s]!=null,p=d??c;o.scale.set(c,c,p),o.visible=!0,o.layers.disableAll(),o.layers.enable(2);let g=o.material.opacity;h?g=1:this.showHits&&p<e.rigScale*.5?g=0:(i=r.getButton("primary"))!=null&&i.pressed?g=.5:g=u?.2:.1,o.material.opacity=lt.lerp(o.material.opacity,g,this.context.time.deltaTimeUnscaled/.1),o.parent!==this.context.scene&&this.context.scene.add(o)}}renderHits(e){var i;for(const s of this._hitDiscs){if(!s)continue;const r=s.controller;if(!r||!r.connected||!r.isTracking){s.visible=!1;continue}}for(let s=0;s<e.controllers.length;s++){const r=e.controllers[s];if(!r.connected||!r.isTracking||!r.ray||!r.hasSelectEvent)continue;let o=this._hitDiscs[s],a=!0;const l=r.getPointerId("primary");l!=null&&this.context.input.getIsPointerIdInUse(l)&&(o&&(o.visible=!1),this._hitDistances[s]=null,this._lastHitDistances[s]=0,a=!1);const c=this.context.time.smoothedFps>=59?1:10;if((this.context.time.frame+r.index)%c!==0&&(a=!1),!a){const u=this._hitDiscs[s];u&&u.visible&&u.hit&&this.updateHitPointerPosition(r,u,u.hit.distance);continue}const h=this.context.physics.raycastFromRay(r.ray,{testObject:this.hitPointRaycastFilter,precise:!1});let d=h.find(u=>this.usePinchToTeleport&&r.isTeleportGesture?!0:this.isObjectWithInteractiveComponent(u.object));if(d||(d=h[0]),o&&(o.controller=r,o.hit=d),this._hitDistances[s]=d?.distance||null,d){this._lastHitDistances[s]=d.distance;const u=e.rigScale??1;g3&&(Nt.DrawWireSphere(d.point,.025*u,16711680),Nt.DrawLabel(Lt(0,.2,0).add(d.point),d.object.name,.02,0)),o||(o=this.createHitPointObject(),this._hitDiscs[s]=o),o.hit=d,o.visible=d.distance>u*.05;let p=.01*(u+d.distance);const g=(i=r.getButton("primary"))==null?void 0:i.pressed;g&&(p*=1.1),o.scale.set(p,p,p),o.layers.set(2);let f=o.material.opacity;if(g?f=1:f=d.distance<.15*u?.2:.6,o.material.opacity=lt.lerp(o.material.opacity,f,this.context.time.deltaTimeUnscaled/.1),o.visible){if(d.normal){this.updateHitPointerPosition(r,o,d.distance);const A=d.normal.applyQuaternion(fn(d.object));o.quaternion.setFromUnitVectors(NDe,A)}else this.updateHitPointerPosition(r,o,d.distance);o.parent!==this.context.scene&&this.context.scene.add(o)}}else this._hitDiscs[s]&&(this._hitDiscs[s].visible=!1)}}isObjectWithInteractiveComponent(e,i=0){return fL(e)||e.isUI===!0?!0:e.isScene?!1:e.parent?this.isObjectWithInteractiveComponent(e.parent,i+1):!1}updateHitPointerPosition(e,i,s){const r=Lt(e.rayWorldPosition);r.add(Lt(0,0,s-.01).applyQuaternion(e.rayWorldQuaternion)),i.position.lerp(r,this.context.time.deltaTimeUnscaled/.05)}createHitPointObject(){const e=new pe(new eh(.3,6,6),new ai({color:15658734,opacity:.7,transparent:!0,depthTest:!1,depthWrite:!1,side:Qi}));return e.layers.disableAll(),e.layers.enable(2),e}createRayLineObject(){const e=new kDe;e.layers.disableAll(),e.layers.enable(2);const i=new gre;e.geometry=i;const s=new Float32Array(9);s.set([0,0,.02,0,0,.4,0,0,1]),i.setPositions(s);const r=new Float32Array(9);r.set([1,1,1,.1,.1,.1,0,0,0]),i.setColors(r);const o=new d3({color:16777215,vertexColors:!0,worldUnits:!0,linewidth:.004,transparent:!0,depthWrite:!1,blending:Wp,dashed:!1});return e.material=o,e}}Lg([T()],ic.prototype,"movementSpeed",2),Lg([T()],ic.prototype,"rotationStep",2),Lg([T()],ic.prototype,"useTeleport",2),Lg([T()],ic.prototype,"usePinchToTeleport",2),Lg([T()],ic.prototype,"useTeleportTarget",2),Lg([T()],ic.prototype,"useTeleportFade",2),Lg([T()],ic.prototype,"showRays",2),Lg([T()],ic.prototype,"showHits",2);const NDe=new E(0,1,0);var VDe=Object.defineProperty,XDe=Object.getOwnPropertyDescriptor,eo=(n,e,i,s)=>{for(var r=s>1?void 0:s?XDe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&VDe(e,i,r),r};const dB=q("debugwebxr"),DDe=q("debugusdz");var f3;const Nv=(f3=class extends Oe{constructor(){super(...arguments),m(this,"createVRButton",!0),m(this,"createARButton",!0),m(this,"createSendToQuestButton",!0),m(this,"createQRCode",!0),m(this,"useDefaultControls",!0),m(this,"showControllerModels",!0),m(this,"showHandModels",!0),m(this,"usePlacementReticle",!0),m(this,"customARPlacementReticle"),m(this,"usePlacementAdjustment",!0),m(this,"arScale",1),m(this,"useXRAnchor",!1),m(this,"autoPlace",!0),m(this,"autoCenter",!1),m(this,"useQuicklookExport",!1),m(this,"useDepthSensing",!1),m(this,"useSpatialGrab",!0),m(this,"defaultAvatar"),m(this,"_playerSync"),m(this,"_createdComponentsInSession",[]),m(this,"_usdzExporter"),m(this,"_exitXRMenuButton"),m(this,"_previousXRState",0),m(this,"_spatialGrabRaycaster"),m(this,"onAvatarSpawned",n=>{dB&&console.log("WebXR.onAvatarSpawned",n),$.getComponentInChildren(n,Ag)??(t=$.addComponent(n,Ag))}),m(this,"_buttonFactory"),m(this,"_buttons",[])}awake(){Qt.getXRSync(this.context)}onEnable(){var n,e;window.location.protocol!=="https:"&&An('<a href="https://developer.mozilla.org/en-US/docs/Web/API/WebXR_Device_API" target="_blank">WebXR</a> only works on secure connections (https).'),this.useQuicklookExport&&($.findObjectOfType(Ms)||(dB&&console.log("WebXR: Adding USDZExporter"),this._usdzExporter=$.addComponent(this.gameObject,Ms),this._usdzExporter.objectToExport=this.context.scene,this._usdzExporter.autoExportAnimations=!0,this._usdzExporter.autoExportAudioSources=!0)),this.handleCreatingHTML(),this.handleOfferSession(),this.defaultAvatar===!0&&(dB&&console.warn("WebXR: No default avatar set, using static default avatar"),this.defaultAvatar=new Mi("https://cdn.needle.tools/static/avatars/DefaultAvatar.glb")),this.defaultAvatar&&(this._playerSync=this.gameObject.getOrAddComponent(gv),this._playerSync.autoSync=!1),this._playerSync&&typeof this.defaultAvatar!="boolean"&&(this._playerSync.asset=this.defaultAvatar,(n=this._playerSync.onPlayerSpawned)==null||n.removeEventListener(this.onAvatarSpawned),(e=this._playerSync.onPlayerSpawned)==null||e.addEventListener(this.onAvatarSpawned))}onDisable(){var n;(n=this._usdzExporter)==null||n.destroy(),this.removeButtons()}async handleOfferSession(){return this.createVRButton&&await Qt.isVRSupported()&&this.createVRButton?Qt.offerSession("immersive-vr","default",this.context):this.createARButton&&await Qt.isARSupported()&&this.createARButton?Qt.offerSession("immersive-ar","default",this.context):!1}get session(){return Qt.active??null}get sessionMode(){return Qt.activeMode??null}async enterVR(n){return Qt.start("immersive-vr",n,this.context)}async enterAR(n){return Qt.start("immersive-ar",n,this.context)}exitXR(){Qt.stop()}get isActiveWebXR(){return!Nv.activeWebXRComponent||Nv.activeWebXRComponent===this}onBeforeXR(n,e){var i;if(!this.isActiveWebXR){console.warn(`WebXR: another WebXR component is already active (${(i=Nv.activeWebXRComponent)==null?void 0:i.name}). This is ignored: ${this.name}`);return}Nv.activeWebXRComponent=this,n=="immersive-ar"&&this.useDepthSensing&&(e.optionalFeatures=e.optionalFeatures||[],e.optionalFeatures.push("depth-sensing"))}async onEnterXR(n){if(!this.isActiveWebXR)return;dB&&console.log("WebXR onEnterXR"),this._previousXRState=Xa.Global.Mask;const e=n.xr.isVR;if(Xa.Global.Set(e?Ud.VR:Ud.AR),this.usePlacementReticle&&n.xr.isAR){let i=$.findObjectOfType(Mp);if(!i){const s=new Ae;for(const r of this.context.scene.children)s.add(r);this.context.scene.add(s),i=$.addComponent(s,Mp),this._createdComponentsInSession.push(i)}i.customReticle=this.customARPlacementReticle,i.arScale=this.arScale,i.arTouchTransform=this.usePlacementAdjustment,i.autoPlace=this.autoPlace,i.autoCenter=this.autoCenter,i.useXRAnchor=this.useXRAnchor}this.useDefaultControls&&this.setDefaultMovementEnabled(!0),(this.showControllerModels||this.showHandModels)&&this.setDefaultControllerRenderingEnabled(!0),this.useSpatialGrab&&(this._spatialGrabRaycaster=$.findObjectOfType(dv)??void 0,this._spatialGrabRaycaster||(this._spatialGrabRaycaster=this.gameObject.addComponent(dv))),this.createLocalAvatar(n.xr),n.xr.isScreenBasedAR||(this._exitXRMenuButton=this.context.menu.appendChild({label:"Quit XR",onClick:()=>this.exitXR(),icon:"exit_to_app",priority:2e4}))}onUpdateXR(n){this.isActiveWebXR&&this._spatialGrabRaycaster&&(this._spatialGrabRaycaster.enabled=this.useSpatialGrab)}onLeaveXR(n){var e,i;if((e=this._exitXRMenuButton)==null||e.remove(),!!this.isActiveWebXR){Xa.Global.Set(this._previousXRState),(i=this._playerSync)==null||i.destroyInstance();for(const s of this._createdComponentsInSession)s.destroy();this._createdComponentsInSession.length=0,this.handleOfferSession(),RE(1).then(()=>Nv.activeWebXRComponent=null)}}setDefaultMovementEnabled(n){let e=this.gameObject.getComponent(ic);return!e&&n&&(e=this.gameObject.addComponent(ic),this._createdComponentsInSession.push(e)),e&&(e.enabled=n),e}setDefaultControllerRenderingEnabled(n){let e=this.gameObject.getComponent(eu);return!e&&n&&(e=this.gameObject.addComponent(eu),this._createdComponentsInSession.push(e),e.createControllerModel=this.showControllerModels,e.createHandModel==this.showHandModels),e&&(e.enabled=n),e}async createLocalAvatar(n){this._playerSync&&n.running&&typeof this.defaultAvatar!="boolean"&&(this._playerSync.asset=this.defaultAvatar,await this._playerSync.getInstance())}getButtonsContainer(){return this.getButtonsFactory()}getButtonsFactory(){return this._buttonFactory||(this._buttonFactory=nA.getOrCreate()),this._buttonFactory}handleCreatingHTML(){if(this.createARButton||this.createVRButton||this.useQuicklookExport){if((Ft.isiOS()&&Ft.isSafari()||DDe)&&this.useQuicklookExport){const n=$.findObjectOfType(Ms);if(!n||n&&n.allowCreateQuicklookButton){const e=this.getButtonsFactory().createQuicklookButton();this.addButton(e,50)}}if(this.createARButton){const n=this.getButtonsFactory().createARButton();this.addButton(n,50)}if(this.createVRButton){const n=this.getButtonsFactory().createVRButton();this.addButton(n,50)}}if(this.createSendToQuestButton&&!Ft.isQuest()&&Qt.isVRSupported().then(n=>{if(!n){const e=this.getButtonsFactory().createSendToQuestButton();this.addButton(e,50)}}),this.createQRCode){const n=_2($d);if(n&&n.createQRCodeButton===!1)Je()&&console.warn("WebXR: QRCode button is disabled in the Needle Menu component");else if(!Ft.isMobileDevice()){const e=lp.getOrCreate().createQRCode();this.addButton(e,50)}}}addButton(n,e){this._buttons.push(n),n.setAttribute("priority",e.toString()),this.context.menu.appendChild(n)}removeButtons(){for(const n of this._buttons)n.remove();this._buttons.length=0}},m(f3,"activeWebXRComponent",null),f3);let Ns=Nv;eo([T()],Ns.prototype,"createVRButton",2),eo([T()],Ns.prototype,"createARButton",2),eo([T()],Ns.prototype,"createSendToQuestButton",2),eo([T()],Ns.prototype,"createQRCode",2),eo([T()],Ns.prototype,"useDefaultControls",2),eo([T()],Ns.prototype,"showControllerModels",2),eo([T()],Ns.prototype,"showHandModels",2),eo([T()],Ns.prototype,"usePlacementReticle",2),eo([T(Mi)],Ns.prototype,"customARPlacementReticle",2),eo([T()],Ns.prototype,"usePlacementAdjustment",2),eo([T()],Ns.prototype,"arScale",2),eo([T()],Ns.prototype,"useXRAnchor",2),eo([T()],Ns.prototype,"autoPlace",2),eo([T()],Ns.prototype,"autoCenter",2),eo([T()],Ns.prototype,"useQuicklookExport",2),eo([T()],Ns.prototype,"useDepthSensing",2),eo([T()],Ns.prototype,"useSpatialGrab",2),eo([T(Mi)],Ns.prototype,"defaultAvatar",2);class uB{get extensionName(){return"Physics"}onExportObject(e,i,s){const r=$.getComponents(e,rn).filter(c=>c.enabled),o=$.getComponents(e,cl).filter(c=>c.enabled&&!c.isTrigger);let a=r.length>0?r[0]:null;const l=o.length>0?o[0]:null;l&&!a&&(a=new rn,a.isKinematic=!0),a&&i.addEventListener("serialize",(c,h)=>{var d,u,p;if(a){if(c.appendLine(),c.beginBlock('def RealityKitComponent "RigidBody"',"{",!0),a.useGravity||c.appendLine("bool gravityEnabled = 0"),c.appendLine('uniform token info:id = "RealityKit.RigidBody"'),a.isKinematic&&c.appendLine('token motionType = "Kinematic"'),c.beginBlock('def RealityKitStruct "massFrame"',"{",!0),c.appendLine(`float m_mass = ${a.mass}`),c.beginBlock('def RealityKitStruct "m_pose"',"{",!0),c.appendLine(`float3 position = (${a.centerOfMass.x}, ${a.centerOfMass.y}, ${a.centerOfMass.z})`),c.closeBlock("}"),c.closeBlock("}"),o.length>0){const g=o[0];c.beginBlock('def RealityKitStruct "material"',"{",!0);const f=g.sharedMaterial;f&&f.dynamicFriction!==void 0&&c.appendLine(`double dynamicFriction = ${(d=g.sharedMaterial)==null?void 0:d.dynamicFriction}`),f&&f.bounciness!==void 0&&c.appendLine(`double restitution = ${(u=g.sharedMaterial)==null?void 0:u.bounciness}`),f&&f.staticFriction!==void 0&&c.appendLine(`double staticFriction = ${(p=g.sharedMaterial)==null?void 0:p.staticFriction}`),c.closeBlock("}")}c.closeBlock("}")}}),l&&(i.addEventListener("serialize",(c,h)=>{var d;c.beginBlock('def RealityKitComponent "Collider"',"{",!0),c.appendLine("uint group = 1"),c.appendLine('uniform token info:id = "RealityKit.Collider"'),c.appendLine("uint mask = 4294967295");const u=l.isTrigger?"Trigger":"Default";if(c.appendLine(`token type = "${u}"`),c.beginBlock('def RealityKitStruct "Shape"',"{",!0),l instanceof bv){const p=l;c.appendLine('token shapeType = "Sphere"'),c.appendLine(`float radius = ${p.radius}`)}else if(l instanceof vv){const p=l;c.appendLine('token shapeType = "Box"'),c.appendLine(`float3 extent = (${p.size.x}, ${p.size.y}, ${p.size.z})`)}else if(l instanceof Ap){const p=l;c.appendLine('token shapeType = "Capsule"'),c.appendLine(`float radius = ${p.radius}`),c.appendLine(`float height = ${p.height}`)}else if(l instanceof Q0&&(d=l.sharedMesh)!=null&&d.geometry){const p=l.sharedMesh.geometry;p.boundingBox||p.computeBoundingBox();const g=l.sharedMesh.geometry.boundingBox;g&&(c.appendLine('token shapeType = "Box"'),c.appendLine(`float3 extent = (${g.max.x-g.min.x}, ${g.max.y-g.min.y}, ${g.max.z-g.min.z})`),console.log("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. MeshCollider will be exported as Box",l))}else console.warn("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. Ignoring collider:",l);c.beginBlock('def RealityKitStruct "pose"',"{",!0),c.closeBlock("}"),c.closeBlock("}"),c.closeBlock("}")}),o.length>1&&console.log("WARNING: Multiple colliders detected. visionOS / iOS can only support objects with a single collider, only exporting the first collider: ",l))}}var zDe=Object.defineProperty,FDe=Object.getOwnPropertyDescriptor,Tp=(n,e,i,s)=>{for(var r=s>1?void 0:s?FDe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&zDe(e,i,r),r};const rA=q("debugtext");var Er=(n=>(n[n.UpperLeft=0]="UpperLeft",n[n.UpperCenter=1]="UpperCenter",n[n.UpperRight=2]="UpperRight",n[n.MiddleLeft=3]="MiddleLeft",n[n.MiddleCenter=4]="MiddleCenter",n[n.MiddleRight=5]="MiddleRight",n[n.LowerLeft=6]="LowerLeft",n[n.LowerCenter=7]="LowerCenter",n[n.LowerRight=8]="LowerRight",n))(Er||{}),fre=(n=>(n[n.Normal=0]="Normal",n[n.Bold=1]="Bold",n[n.Italic=2]="Italic",n[n.BoldAndItalic=3]="BoldAndItalic",n))(fre||{});class la extends Y0{constructor(){super(...arguments),m(this,"alignment",0),m(this,"verticalOverflow",0),m(this,"horizontalOverflow",0),m(this,"lineSpacing",1),m(this,"supportRichText",!1),m(this,"font"),m(this,"fontStyle",0),m(this,"sRGBTextColor",new fe(1,0,1)),m(this,"_text",""),m(this,"_fontSize",12),m(this,"_textMeshUi",null),m(this,"_didHandleTextRenderOnTop",!1)}setAlphaFactor(e){var i;super.setAlphaFactor(e),(i=this.uiObject)==null||i.set({fontOpacity:this.color.alpha*this.alphaFactor}),this.markDirty()}get text(){return this._text}set text(e){e!==this._text&&(this._text=e,this.feedText(this.text,this.supportRichText),this.markDirty())}set_text(e){this.text=e}get fontSize(){return this._fontSize}set fontSize(e){var i;this._fontSize=e,(i=this.uiObject)==null||i.set({fontSize:e})}onColorChanged(){var e;this.sRGBTextColor.copy(this.color),this.sRGBTextColor.convertLinearToSRGB(),(e=this.uiObject)==null||e.set({color:this.sRGBTextColor,fontOpacity:this.color.alpha})}onParentRectTransformChanged(){super.onParentRectTransformChanged(),this.uiObject&&this.updateOverflow()}onBeforeCanvasRender(e){this.updateOverflow()}updateOverflow(){var e;const i=(e=this.uiObject)==null?void 0:e._overflow;i&&(i._needsUpdate=!0)}onCreate(e){rA&&console.log(this),this.horizontalOverflow==1&&(e.whiteSpace="pre"),this.verticalOverflow==0&&(this.context.renderer.localClippingEnabled=!0,e.overflow="hidden"),this.horizontalOverflow==1&&this.verticalOverflow==0,e.lineHeight=this.lineSpacing,delete e.backgroundOpacity,delete e.backgroundColor,rA&&(e.backgroundColor=16750848,e.backgroundOpacity=.5);const i=this.rectTransform;e={...e,...this.getTextOpts()},this.getAlignment(e),rA&&(e.backgroundColor=Math.random()*16777215,e.backgroundOpacity=.1),this.uiObject=i.createNewText(e),this.feedText(this.text,this.supportRichText)}onAfterAddedToScene(){super.onAfterAddedToScene(),this.handleTextRenderOnTop()}getTextOpts(){const e=this.fontSize,i={color:this.color,fontOpacity:this.color.alpha,fontSize:e,fontKerning:"normal"};return this.setFont(i,this.fontStyle),i}onEnable(){var e;super.onEnable(),this._didHandleTextRenderOnTop=!1,this.uiObject&&this.uiObject.addAfterUpdate(()=>{this.setShadowComponentOwner(this.uiObject),this.markDirty()}),setTimeout(()=>this.markDirty(),10),(e=this.canvas)==null||e.registerEventReceiver(this)}onDisable(){var e;super.onDisable(),(e=this.canvas)==null||e.unregisterEventReceiver(this)}getAlignment(e){switch(e.flexDirection="column",this.alignment){case 0:case 3:case 6:e.textAlign="left";break;case 1:case 4:case 7:e.textAlign="center";break;case 2:case 5:case 8:e.textAlign="right";break}switch(this.alignment){default:case 0:case 1:case 2:e.alignItems="start";break;case 3:case 4:case 5:e.alignItems="center";break;case 6:case 7:case 8:e.alignItems="end";break}return e}feedText(e,i){var s,r,o;if(rA&&console.log("feedText",this.uiObject,e,i),!!this.uiObject)if(this._textMeshUi||(this._textMeshUi=[]),this.uiObject.children.length=0,!i||e.length===0)this.uiObject.textContent=e;else{let a=this.getNextTag(e);if(a){if(a.startIndex>0){for(let h=this.uiObject.children.length-1;h>=0;h--){const d=this.uiObject.children[h];d.isUI&&(this.uiObject.remove(d),d.clear())}const c=new HE({textContent:e.substring(0,a.startIndex),color:"inherit"});this.uiObject.add(c)}}else{this.uiObject.textContent="",this.setOptions({textContent:e});return}const l=[];for(;a;){const c=this.getNextTag(e,a.endIndex),h={fontFamily:(s=this.uiObject)==null?void 0:s.get("fontFamily"),color:"inherit",textContent:""};if(c){h.textContent=this.getText(e,a,c),this.handleTag(a,h,l);const d=new HE(h);(r=this.uiObject)==null||r.add(d)}else{h.textContent=e.substring(a.endIndex),this.handleTag(a,h,l);const d=new HE(h);(o=this.uiObject)==null||o.add(d)}a=c}}}handleTextRenderOnTop(){this._didHandleTextRenderOnTop||(this._didHandleTextRenderOnTop=!0,this.startCoroutine(this.renderOnTopCoroutine()))}*renderOnTopCoroutine(){if(!this.canvas)return;const e=[],i=this.canvas,s={renderOnTop:i.renderOnTop,depthWrite:i.depthWrite,doubleSided:i.doubleSided};for(;;){let r=!1;if(this._textMeshUi)for(let o=0;o<this._textMeshUi.length;o++){if(e[o]===!0)continue;r=!0;const a=this._textMeshUi[o];a.textContent&&(wL(a,s),e[o]=!0)}if(!r)break;yield}}handleTag(e,i,s){if(!e.isEndTag){if(e.type.includes("color")){const r=new A3(e,{color:i.color});if(s.push(r),e.type.length>6){const o=parseInt("0x"+e.type.substring(7));i.color=o}else i.color=new fe(1,1,1)}else if(e.type=="b"){this.setFont(i,1);const r=new A3(e,{fontWeight:700});s.push(r)}else if(e.type=="i"){this.setFont(i,2);const r=new A3(e,{fontStyle:"italic"});s.push(r)}}}getText(e,i,s){return e.substring(i.endIndex,s.startIndex)}getNextTag(e,i=0){const s=e.indexOf("<",i),r=e.indexOf(">",s);if(s>=0&&r>=0){const o=e.substring(s+1,r);return{type:o,startIndex:s,endIndex:r+1,isEndTag:o.startsWith("/")}}return null}setFont(e,i){if(!this.font)return;const s=this.font,r=this.getFamilyNameWithCorrectSuffix(s,i);rA&&console.log("Selected font family:"+r);let o=qX.getFontFamily(r);switch(o||(o=qX.addFontFamily(r)),e.fontFamily=o,i){default:case 0:e.fontWeight=400,e.fontStyle="normal";break;case 1:e.fontWeight=700,e.fontStyle="normal";break;case 2:e.fontWeight=400,e.fontStyle="italic";break;case 3:e.fontStyle="italic",e.fontWeight=400}let a=o.getVariant(e.fontWeight,e.fontStyle);if(!a){let l=r;l!=null&&l.endsWith("-msdf.json")||(l+="-msdf.json");let c=r;c!=null&&c.endsWith(".png")||(c+=".png"),a=o.addVariant(e.fontWeight,e.fontStyle,l,c),a?.addEventListener("ready",()=>{this.markDirty()})}}getFamilyNameWithCorrectSuffix(e,i){var s;const r=e.lastIndexOf("-");if(r<0)return e;const o=(s=e.substring(r+1))==null?void 0:s.toLowerCase();if(UDe.includes(o))return rA&&console.warn("Unsupported font style: "+o),e;const a=e.lastIndexOf("/");let l=e;a>=0&&(l=l.substring(a+1));const c=l[0]===l[0].toUpperCase(),h=e.substring(0,r);switch(rA&&console.log("Select font: ",e,fre[i],l,c,h),i){case 0:return c?h+"-Regular":h+"-regular";case 1:return c?h+"-Bold":h+"-bold";case 2:return c?h+"-Italic":h+"-italic";case 3:return c?h+"-BoldItalic":h+"-bolditalic";default:return e}}}Tp([T()],la.prototype,"alignment",2),Tp([T()],la.prototype,"verticalOverflow",2),Tp([T()],la.prototype,"horizontalOverflow",2),Tp([T()],la.prototype,"lineSpacing",2),Tp([T()],la.prototype,"supportRichText",2),Tp([T(URL)],la.prototype,"font",2),Tp([T()],la.prototype,"fontStyle",2),Tp([T()],la.prototype,"text",1),Tp([T()],la.prototype,"fontSize",1);class A3{constructor(e,i){m(this,"tag"),m(this,"previousValues"),this.tag=e,this.previousValues=i}}const UDe=["medium","mediumitalic","black","blackitalic","thin","thinitalic","extrabold","light","lightitalic","semibold"];class Bg{constructor(e){m(this,"id"),m(this,"content",""),m(this,"font",[]),m(this,"pointSize",144),m(this,"width"),m(this,"height"),m(this,"depth"),m(this,"wrapMode"),m(this,"horizontalAlignment"),m(this,"verticalAlignment"),m(this,"material"),this.id=e}static getId(){return this.global_id++}setDepth(e){return this.depth=e,this}setPointSize(e){return this.pointSize=e,this}setHorizontalAlignment(e){return this.horizontalAlignment=e,this}setVerticalAlignment(e){return this.verticalAlignment=e,this}writeTo(e,i){var s;i.beginBlock(`def Preliminary_Text "${this.id}"`,"(",!1),i.appendLine('prepend apiSchemas = ["MaterialBindingAPI"]'),i.closeBlock(")"),i.beginBlock(),this.content&&i.appendLine(`string content = "${this.content}"`),(!this.font||this.font.length<=0)&&(this.font||(this.font=[]),(s=this.font)==null||s.push("sans-serif"));const r=this.font.map(o=>`"${o}"`).join(", ");i.appendLine(`string[] font = [ ${r} ]`),i.appendLine(`double pointSize = ${this.pointSize}`),typeof this.width=="number"&&i.appendLine(`double width = ${this.width}`),typeof this.height=="number"&&i.appendLine(`double height = ${this.height}`),typeof this.depth=="number"&&i.appendLine(`double depth = ${this.depth}`),this.wrapMode&&i.appendLine(`token wrapMode = "${this.wrapMode}"`),this.horizontalAlignment&&i.appendLine(`token horizontalAlignment = "${this.horizontalAlignment}"`),this.verticalAlignment&&i.appendLine(`token verticalAlignment = "${this.verticalAlignment}"`),this.material!==void 0&&i.appendLine(`rel material:binding = </StageRoot/Materials/${HF(this.material)}>`),i.closeBlock()}}m(Bg,"global_id",0);class pB{static singleLine(e,i,s){const r=new Bg("text_"+Bg.getId());return r.content=e,i&&(r.pointSize=i),s&&(r.depth=s),r}static multiLine(e,i,s,r,o,a){const l=new Bg("text_"+Bg.getId());return l.content=e,l.width=i,l.height=s,l.horizontalAlignment=r,l.verticalAlignment=o,a!==void 0&&(l.wrapMode=a),l}}const ODe=new de().makeRotationY(Math.PI),ZDe=new de().makeScale(-1,1,-1);class FS{get extensionName(){return"text"}exportText(e,i,s){const r=$.getComponent(e,la);if(!r)return;const o=$.getComponent(e,aa);let a=100,l=100;o&&(a=o.width,l=o.height);const c=ODe.clone();o&&c.premultiply(ZDe),i.setMatrix(c);const h=r.color.clone();i.material=new Us({color:h,emissive:h}),i.addEventListener("serialize",(d,u)=>{let p=r.text;p=p.replace(/\r/g,""),p=p.replace(/\n/g,"\\n");const g=pB.multiLine(p,a,l,"center","bottom","flowing");this.setTextAlignment(g,r.alignment),this.setOverflow(g,r),i.material&&(g.material=i.material),g.pointSize=this.convertToTextSize(r.fontSize),g.depth=.001,g.writeTo(void 0,d)})}convertToTextSize(e){return 1/.0502*144*e}setOverflow(e,i){i.horizontalOverflow?e.wrapMode="singleLine":e.wrapMode="flowing"}setTextAlignment(e,i){switch(i){case Er.LowerLeft:case Er.MiddleLeft:case Er.UpperLeft:e.horizontalAlignment="left";break;case Er.LowerCenter:case Er.MiddleCenter:case Er.UpperCenter:e.horizontalAlignment="center";break;case Er.LowerRight:case Er.MiddleRight:case Er.UpperRight:e.horizontalAlignment="right";break}switch(i){case Er.LowerLeft:case Er.LowerCenter:case Er.LowerRight:e.verticalAlignment="bottom";break;case Er.MiddleLeft:case Er.MiddleCenter:case Er.MiddleRight:e.verticalAlignment="middle";break;case Er.UpperLeft:case Er.UpperCenter:case Er.UpperRight:e.verticalAlignment="top";break}}}class mB{get extensionName(){return"tmui"}onExportObject(e,i,s){const r=$.getComponent(e,Ro);if(r&&r.enabled&&r.renderMode===Bse.WorldSpace){const o=new FS,a=$.getComponent(e,aa),l=$.getComponent(e,wg),c=new Array;if(a){if(!$.isActiveSelf(e)){const u=$.isActiveSelf(e);$.setActive(e,!0),a.onEnable(),a.updateTransform(),c.push(()=>{a.onDisable(),$.setActive(e,u)})}e.traverse(u=>{if(!$.isActiveInHierarchy(u)){const p=$.isActiveSelf(u);$.setActive(u,!0);const g=$.getComponent(u,th);g&&(g.onEnable(),c.push(()=>{g.onDisable()}));const f=$.getComponent(u,aa);f&&(f.onEnable(),f.updateTransform(),f.onApplyTransform(),c.push(()=>{f.onDisable()}));const A=$.getComponent(u,la);A&&(A.onEnable(),c.push(()=>{A.onDisable()})),c.push(()=>{$.setActive(u,p)})}}),a.width,a.height;const h=ka.createEmpty(),d=a.shadowComponent;if(i.add(h),d){const u=d.matrix;h.setMatrix(u);const p=new Map,g=new Map;p.set(d,h),g.set(d,l?l.alpha:1),d.traverse(f=>{if(f===d)return;const A=ka.createEmpty();A.setMatrix(f.matrix);const y=f.parent,b=!!y&&typeof y.textContent=="string"&&y.textContent.length>0;let v=g.get(y)||1;const x=$.getComponent(f,wg);if(x&&(v*=x.alpha),f instanceof pe&&b){const C=f[zc];C?o.exportText(C.gameObject,A,s):console.error("Error when exporting UI: shadow component owner not found. This is likely a bug.",f)}if(f instanceof pe&&!b){const C=f.geometry.clone();C.scale(1,1,-1),this.flipWindingOrder(C),A.geometry=C;const S=new fe,_=f.material.opacity;S.copy(f.material.color),A.material=new ai({color:S,opacity:_*v,map:f.material.map,transparent:!0})}p.set(f,A),g.set(f,v);const w=p.get(y);if(!w){console.error("Error when exporting UI: shadow component parent not found!",f,f.parent);return}w.add(A)})}}for(const h of c)h()}}flipWindingOrder(e){const i=e.index.array;for(let s=0,r=i.length/3;s<r;s++){const o=i[s*3];i[s*3]=i[s*3+2],i[s*3+2]=o}e.index.needsUpdate=!0}}const US=q("debugusdz");function WDe(n,e){var i;const s=[],r=$.getComponentsInChildren(n,Mo),o=$.getComponentsInChildren(n,ra),a=new Array,l=new Array;if(e.injectImplicitBehaviours)for(const c of r){if(!c||!c.runtimeAnimatorController||!c.enabled)continue;const h=c.runtimeAnimatorController.activeState;if(!h||!h.motion||!h.motion.clip||((i=h.motion.clip.tracks)==null?void 0:i.length)<1||a.includes(c))continue;const d=new $0;d.animator=c,d.stateName=h.name,d.trigger="start",d.name="PlayAnimationOnClick_implicitAtStart_"+d.stateName;const u=new Ae;$.addComponent(u,d),l.push(u),a.push(c),n.add(u)}else for(const c of r){if(!c||!c.runtimeAnimatorController||!c.enabled)continue;US&&console.log(c);const h=[];for(const d of c.runtimeAnimatorController.enumerateActions()){US&&console.log(d);const u=d.getClip();h.includes(u)||h.push(u)}s.push({root:c.gameObject,clips:h})}if(e.injectImplicitBehaviours)for(const c of o){if(!c||!c.clip||!c.enabled||!c.playAutomatically||a.includes(c))continue;const h=new $0;h.animation=c,h.stateName=c.clip.name,h.trigger="start",h.name="PlayAnimationOnClick_implicitAtStart_"+h.stateName;const d=new Ae;$.addComponent(d,h),l.push(d),a.push(c),n.add(d)}else for(const c of o){US&&console.log(c);const h=[];for(const d of c.animations)h.includes(d)||h.push(d);s.push({root:c.gameObject,clips:h})}US&&s?.length>0&&console.log("USDZ Animation Clips without behaviours",s);for(const c of s)for(const h of c.clips)e.registerAnimation(c.root,h);return l}function HDe(n,e){const i=$.getComponentsInChildren(n,vs),s=$.getComponentsInChildren(n,Cg),r=new Array,o=new Array;US&&console.log({audioSources:i,playAudioOnClicks:s});for(const a of s){if(!a.target)continue;const l=i.indexOf(a.target);l>-1&&i.splice(l,1)}for(const a of i){if(!a||!a.clip||a.volume<=0||r.includes(a))continue;const l=new Cg;l.target=a,l.name="PlayAudioOnClick_implicitAtStart_",l.trigger="start";const c=new Ae;$.addComponent(c,l),console.log("implicit PlayAudioOnStart",c,l),o.push(c),r.push(a),n.add(c)}return o}function QDe(n){return new Kr("DisableAtStart",Yr.sceneStartTrigger(),Wi.fadeAction(n,0,!1))}function Are(n,e){const i=n.domElement.shadowRoot.querySelector("link[rel='ar']");if(i)return i;const s=document.createElement("div");s.classList.add("menu"),s.classList.add("quicklook-menu"),s.style.display="none",s.style.visibility="hidden";const r=document.createElement("button");r.id="open-in-ar",e?(r.innerText="View in AR",r.title="View this scene in AR. The scene will be exported to USDZ and opened with Apple's QuickLook."):(r.innerText="View in AR",r.title="Download this scene for AR. Open the downloaded USDZ file to view it in AR using Apple's QuickLook."),s.appendChild(r);const o=document.createElement("a");o.id="needle-usdz-link",o.style.display="none",o.rel="ar",o.href="",o.target="_blank",s.appendChild(o);const a=document.createElement("img");return a.id="button",o.appendChild(a),n.domElement.shadowRoot.appendChild(s),o}var KDe=Object.defineProperty,YDe=Object.getOwnPropertyDescriptor,Vo=(n,e,i,s)=>{for(var r=s>1?void 0:s?YDe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&KDe(e,i,r),r};const nc=q("debugusdz"),jDe=q("debugusdzpruning");class kg{constructor(){m(this,"callToAction"),m(this,"checkoutTitle"),m(this,"checkoutSubtitle"),m(this,"callToActionURL")}}Vo([T()],kg.prototype,"callToAction",2),Vo([T()],kg.prototype,"checkoutTitle",2),Vo([T()],kg.prototype,"checkoutSubtitle",2),Vo([T()],kg.prototype,"callToActionURL",2);var gB;const y3=(gB=class extends Oe{constructor(){super(...arguments),m(this,"objectToExport"),m(this,"autoExportAnimations",!0),m(this,"autoExportAudioSources",!0),m(this,"exportFileName"),m(this,"customUsdzFile"),m(this,"customBranding"),m(this,"anchoringType","plane"),m(this,"maxTextureSize",2048),m(this,"planeAnchoringAlignment","horizontal"),m(this,"interactive",!0),m(this,"physics",!0),m(this,"allowCreateQuicklookButton",!0),m(this,"quickLookCompatible",!0),m(this,"extensions",[]),m(this,"link"),m(this,"button"),m(this,"onClickedOpenInARElement",n=>{n.preventDefault(),this.exportAndOpen()}),m(this,"_currentExportTasks",new Map),m(this,"_previousTimeScale",1),m(this,"lastCallback"),m(this,"_rootSessionRootWasAppliedTo",null),m(this,"_rootPositionBeforeExport",new E),m(this,"_rootRotationBeforeExport",new Fe),m(this,"_rootScaleBeforeExport",new E)}start(){var n,e,i;nc&&(console.log("USDZExporter",this),console.log("Debug USDZ Mode. Press 'T' to export"),window.addEventListener("keydown",s=>{switch(s.key){case"t":this.exportAndOpen();break}})),this.objectToExport||(this.objectToExport=this.gameObject),!((e=(n=this.objectToExport)==null?void 0:n.children)!=null&&e.length)&&!((i=this.objectToExport)!=null&&i.isMesh)&&(this.objectToExport=this.context.scene)}onEnable(){var n;const e=Ft.supportsQuickLookAR(),i=Ft.isiOS()||Ft.isiPad();!this.button&&(nc||e||i)&&(this.allowCreateQuicklookButton&&(this.button=this.createQuicklookButton()),this.lastCallback=this.quicklookCallback.bind(this),this.link=Are(this.context,e),this.link.addEventListener("message",this.lastCallback)),nc&&ss("USDZ Exporter enabled: "+this.name),(n=document.getElementById("open-in-ar"))==null||n.addEventListener("click",this.onClickedOpenInARElement),AC.registerExporter(this)}onDisable(){var n,e,i;(n=this.button)==null||n.remove(),(e=this.link)==null||e.removeEventListener("message",this.lastCallback),nc&&ss("USDZ Exporter disabled: "+this.name),(i=document.getElementById("open-in-ar"))==null||i.removeEventListener("click",this.onClickedOpenInARElement),AC.unregisterExporter(this)}async exportAsync(){return this.exportAndOpen()}async exportAndOpen(){var n;let e=this.exportFileName??((n=this.objectToExport)==null?void 0:n.name)??this.name;if(e+="-"+xne(),ng()||(e!==""&&(e+="-"),e+="MadeWithNeedle"),this.link||(this.link=Are(this.context,Ft.supportsQuickLookAR())),this.customUsdzFile)return nc&&console.log("Exporting custom usdz",this.customUsdzFile),this.openInQuickLook(this.customUsdzFile,e),null;if(!this.objectToExport)return console.warn("No object to export",this),null;const i=await this.export(this.objectToExport);return i?(nc&&console.log("USDZ generation done. Downloading as "+e),this.openInQuickLook(i,e),i):(console.error("USDZ generation failed. Please report a bug",this),null)}async export(n){if(!n)return console.warn("No object to export"),null;const e=this._currentExportTasks.get(n);if(e)return e;const i=this.internalExport(n);return i instanceof Promise?(this._currentExportTasks.set(n,i),i.then(s=>(this._currentExportTasks.delete(n),s)).catch(s=>(this._currentExportTasks.delete(n),console.error("Error during USDZ export \u2013 please report a bug!",s),null))):i}async internalExport(n){Ei.start("export-usdz",{onProgress:x=>{this.dispatchEvent(new CustomEvent("export-progress",{detail:{progress:x}}))}}),Ei.report("export-usdz",{message:"Starting export",totalSteps:40,currentStep:0}),Ei.report("export-usdz",{message:"Load progressive textures",autoStep:5}),Ei.start("export-usdz-textures","export-usdz");const e=$.getComponentsInChildren(n,hl);for(const x of e)x&&x.enabled&&x.updateSprite(!0);const i=$.getComponentsInChildren(n,Gs),s=new Array;let r=0;for(const x of i){for(const w of x.sharedMeshes)if(w){const C=Fi.assignMeshLOD(w,0);C instanceof Promise&&s.push(new Promise((S,_)=>{C.then(()=>{r++,Ei.report("export-usdz-textures",{message:"Loaded progressive mesh",currentStep:r,totalSteps:s.length}),S()}).catch(I=>_(I))}))}for(const w of x.sharedMaterials)if(w){const C=Fi.assignTextureLOD(w,0);C instanceof Promise&&s.push(new Promise((S,_)=>{C.then(()=>{r++,Ei.report("export-usdz-textures",{message:"Loaded progressive texture",currentStep:r,totalSteps:s.length}),S()}).catch(I=>_(I))}))}}nc&&ss("Progressive Loading: "+s.length),await Promise.all(s),nc&&ss("Progressive Loading: done"),Ei.end("export-usdz-textures");const o=Xa.Global.Mask;Xa.Global.Set(Ud.AR);const a=new Mne,l=new JC(this.quickLookCompatible);let c;const h=[];this.interactive&&(h.push(new GL),h.push(new Jg),globalThis.false&&$.getComponentsInChildren(n,rn).length>0&&(this.physics?(c=new uB,h.push(c)):Je()&&console.warn("USDZExporter: Physics export is disabled, but there are active Rigidbody components in the scene. They will not be exported.")),h.push(new FS),h.push(new mB));const d=[l,...h,...this.extensions],u={self:this,exporter:a,extensions:d,object:n};Ei.report("export-usdz","Invoking before-export"),this.dispatchEvent(new CustomEvent("before-export",{detail:u})),this.applyWebARSessionRoot(),this._previousTimeScale=this.context.time.timeScale,this.context.time.timeScale=0,Ei.report("export-usdz","auto export animations and audio sources");const p=new Array;this.autoExportAnimations&&p.push(...WDe(n,l)),this.extensions.find(x=>x.extensionName==="Audio")&&this.autoExportAudioSources&&p.push(...HDe(n)),a.debug=nc,a.pruneUnusedNodes=!jDe;const g=Lv.instance.objs.map(x=>x.batchedMesh);a.keepObject=x=>{let w=!0;const C=$.getComponent(x,Gs);return C&&!C.enabled&&(w=!1),w&&g.includes(x)&&(w=!1),w&&$.getComponentInParent(x,Uh)&&(w=!1),w&&$.getComponentInParent(x,Pd)&&(w=!1),nc&&!w&&console.log("USDZExporter: Discarding object",x),w},a.beforeWritingDocument=()=>{if(Je()&&l&&c){const x=l.animatedRoots;for(const w of x){const C=$.getComponentsInChildren(w,rn).filter(_=>_.enabled),S=$.getComponents(w,cl).filter(_=>_.enabled&&!_.isTrigger);(C.length>0||S.length>0)&&console.error("An animated object has physics components in its child hierarchy. This can lead to undefined behaviour due to a bug in Apple's QuickLook (FB15925487). Remove the physics components from child objects or verify that you get the expected results.",w)}}};const f=new Array;this.objectToExport&&this.quickLookCompatible&&this.interactive&&this.objectToExport.traverse(x=>{x.visible||f.push(x)});const A=this.extensions.find(x=>x.extensionName==="Behaviour");this.interactive&&A&&f.length>0&&A.addBehavior(QDe(f));let y=!0;this.quickLookCompatible&&!this.interactive&&(y=!1),this.anchoringType!=="plane"&&this.anchoringType!=="none"&&this.anchoringType!=="image"&&this.anchoringType!=="face"&&(this.anchoringType="plane"),this.planeAnchoringAlignment!=="horizontal"&&this.planeAnchoringAlignment!=="vertical"&&this.planeAnchoringAlignment!=="any"&&(this.planeAnchoringAlignment="horizontal"),Ei.report("export-usdz","Invoking exporter.parse");const b=await a.parse(this.objectToExport,{ar:{anchoring:{type:this.anchoringType},planeAnchoring:{alignment:this.planeAnchoringAlignment}},extensions:d,quickLookCompatible:this.quickLookCompatible,maxTextureSize:this.maxTextureSize,exportInvisible:y}),v=new Blob([b],{type:"model/vnd.usdz+zip"});this.revertWebARSessionRoot(),this.context.time.timeScale=this._previousTimeScale,Ei.report("export-usdz","Invoking after-export"),this.dispatchEvent(new CustomEvent("after-export",{detail:u}));for(const x of p)$.destroy(x);return Xa.Global.Set(o),Ei.end("export-usdz"),v}openInQuickLook(n,e){const i=n instanceof Blob?URL.createObjectURL(n):n,s=this.buildQuicklookOverlay();nc&&console.log("QuickLook Overlay",s);const r=s.callToAction?encodeURIComponent(s.callToAction):"",o=s.checkoutTitle?encodeURIComponent(s.checkoutTitle):"",a=s.checkoutSubtitle?encodeURIComponent(s.checkoutSubtitle):"";this.link.href=i+`#callToAction=${r}&checkoutTitle=${o}&checkoutSubtitle=${a}&callToActionURL=${s.callToActionURL}`,this.lastCallback||(this.lastCallback=this.quicklookCallback.bind(this),this.link.addEventListener("message",this.lastCallback)),this.link.download=e+".usdz",this.link.click()}download(n,e){y3.save(n,e)}static save(n,e){const i=document.createElement("a");i.style.display="none",document.body.appendChild(i),typeof n=="string"?i.href=n:i.href=URL.createObjectURL(n),i.download=e,i.click(),i.remove()}quicklookCallback(n){if(n?.data=="_apple_ar_quicklook_button_tapped"){nc&&An("Quicklook closed via call to action button");var e=new CustomEvent("quicklook-button-tapped",{detail:this});if(this.dispatchEvent(e),!e.defaultPrevented){const i=new URLSearchParams(this.link.href);if(i){const s=i.get("callToActionURL");nc&&ss("Quicklook url: "+s),s&&(ng()?globalThis.open(s,"_blank"):console.warn("Quicklook closed: custom redirects require a Needle Engine Pro license: https://needle.tools/pricing",s))}}}}buildQuicklookOverlay(){var n,e,i,s,r,o;const a={};return this.customBranding&&Object.assign(a,this.customBranding),ng()||(console.log("Custom Quicklook banner text requires pro license: https://needle.tools/pricing"),a.callToAction="Close",a.checkoutTitle="\u{1F335} Made with Needle",a.checkoutSubtitle="_"),(((n=a.callToAction)==null?void 0:n.length)||((e=a.checkoutTitle)==null?void 0:e.length)||((i=a.checkoutSubtitle)==null?void 0:i.length))&&((s=a.callToAction)!=null&&s.length||(a.callToAction="\0"),(r=a.checkoutTitle)!=null&&r.length||(a.checkoutTitle="\0"),(o=a.checkoutSubtitle)!=null&&o.length||(a.checkoutSubtitle="\0")),this.dispatchEvent(new CustomEvent("quicklook-overlay",{detail:a})),a}getARScaleAndTarget(){if(!this.objectToExport)return{scale:1,_invertForward:!1,target:this.gameObject,sessionRoot:null};const n=$.findObjectOfType(Ns);let e=$.getComponentInParent(this.objectToExport,Mp);e||(e=$.getComponentInChildren(this.objectToExport,Mp));let i=1,s=!1;const r=this.objectToExport;return n?i=n.arScale:e&&(i=e.arScale,s=e.invertForward),{scale:1/i,_invertForward:s,target:r,sessionRoot:e?.gameObject??null}}applyWebARSessionRoot(){if(!this.objectToExport)return;const{scale:n,_invertForward:e,target:i,sessionRoot:s}=this.getARScaleAndTarget(),r=s?.matrixWorld.clone().invert();this._rootSessionRootWasAppliedTo=i,this._rootPositionBeforeExport.copy(i.position),this._rootRotationBeforeExport.copy(i.quaternion),this._rootScaleBeforeExport.copy(i.scale),i.scale.multiplyScalar(n),e&&i.quaternion.multiply(y3.invertForwardQuaternion),i.updateMatrix(),i.updateMatrixWorld(!0),s&&r&&i.matrix.premultiply(r)}revertWebARSessionRoot(){if(!this.objectToExport||!this._rootSessionRootWasAppliedTo)return;const n=this._rootSessionRootWasAppliedTo;n.position.copy(this._rootPositionBeforeExport),n.quaternion.copy(this._rootRotationBeforeExport),n.scale.copy(this._rootScaleBeforeExport),n.updateMatrix(),n.updateMatrixWorld(!0),this._rootSessionRootWasAppliedTo=null}createQuicklookButton(){const n=nA.getOrCreate().createQuicklookButton();return n.parentNode||this.context.menu.appendChild(n),n}},m(gB,"invertForwardMatrix",new de().makeRotationY(Math.PI)),m(gB,"invertForwardQuaternion",new Fe().setFromEuler(new Oi(0,Math.PI,0))),gB);let Ms=y3;Vo([T(Ae)],Ms.prototype,"objectToExport",2),Vo([T()],Ms.prototype,"autoExportAnimations",2),Vo([T()],Ms.prototype,"autoExportAudioSources",2),Vo([T()],Ms.prototype,"exportFileName",2),Vo([T(URL)],Ms.prototype,"customUsdzFile",2),Vo([T(kg)],Ms.prototype,"customBranding",2),Vo([T()],Ms.prototype,"anchoringType",2),Vo([T()],Ms.prototype,"maxTextureSize",2),Vo([T()],Ms.prototype,"planeAnchoringAlignment",2),Vo([T()],Ms.prototype,"interactive",2),Vo([T()],Ms.prototype,"physics",2),Vo([T()],Ms.prototype,"allowCreateQuicklookButton",2),Vo([T()],Ms.prototype,"quickLookCompatible",2);class OS extends Oe{constructor(){super(...arguments),m(this,"isUsed",!0),m(this,"usedBy",null)}}class b3 extends Oe{}const yre=q("debugdeletable"),fB=class extends Oc{onEnable(){fB._instances.push(this)}onDisable(){const n=fB._instances.indexOf(this);n>=0&&fB._instances.splice(n,1)}};let ZS=fB;m(ZS,"_instances",[]);class v3 extends Oe{update(){for(const e of ZS._instances){const i=this.gameObject;if(e.isInBox(i)===!0){const s=$.getComponentInParent(this.gameObject,OS);if(s)yre&&console.warn("DeleteBox: Not deleting object with usage marker",this.guid,s);else{if(yre)try{if(e.box){const r=e.box,o=Oc.testBox;Nt.DrawWireBox3(r,16711680,5),Nt.DrawWireBox3(o,255,5),console.log("DeleteBox: Destroying",this.gameObject,{deleteBoxArea:r,deletedObjectArea:o})}else console.log("DeleteBox: Destroying",this.gameObject)}catch{}SC(this.gameObject,this.context.connection)}}}}}var JDe=Object.defineProperty,qDe=Object.getOwnPropertyDescriptor,oA=(n,e,i,s)=>{for(var r=s>1?void 0:s?qDe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&JDe(e,i,r),r};const $De=q("debugpost");class Oh extends qr{constructor(){super(...arguments),m(this,"mode"),m(this,"focusDistance",new at(1)),m(this,"focalLength",new at(.2)),m(this,"aperture",new at(20)),m(this,"gaussianMaxRadius",new at),m(this,"resolutionScale",new at(1*1/window.devicePixelRatio)),m(this,"bokehScale",new at)}get typeName(){return"DepthOfField"}init(){this.focalLength.valueProcessor=i=>{const s=i/300,r=2;return lt.lerp(r,.01,s)};const e=20;this.aperture.valueProcessor=i=>{const s=1-i/32;return lt.lerp(1,e,s)}}onCreateEffect(){if(this.mode===0){$De&&console.warn("DepthOfField: Mode is set to Off");return}const e=new i7(this.context.mainCamera,{worldFocusRange:.2,focalLength:1,bokehScale:20,resolutionScale:this.resolutionScale.value});return this.focusDistance.onValueChanged=i=>{e.cocMaterial.worldFocusDistance=i},this.focalLength.onValueChanged=i=>e.cocMaterial.worldFocusRange=i,this.aperture.onValueChanged=i=>e.bokehScale=i,this.resolutionScale&&(this.resolutionScale.onValueChanged=i=>e.resolution.scale=i),[e]}unapply(){}}oA([T()],Oh.prototype,"mode",2),oA([T(at)],Oh.prototype,"focusDistance",2),oA([T(at)],Oh.prototype,"focalLength",2),oA([T(at)],Oh.prototype,"aperture",2),oA([T(at)],Oh.prototype,"gaussianMaxRadius",2),oA([T(at)],Oh.prototype,"resolutionScale",2),oA([T(at)],Oh.prototype,"bokehScale",2),Uc("DepthOfField",Oh);var e5e=Object.defineProperty,t5e=Object.getOwnPropertyDescriptor,i5e=(n,e,i,s)=>{for(var r=s>1?void 0:s?t5e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&e5e(e,i,r),r};class AB extends Oe{constructor(){super(...arguments),m(this,"visibleOn")}onEnable(){this.apply()}apply(){this.test()||$.setActive(this.gameObject,!1)}test(){return this.visibleOn<0?!0:Ft.isMobileDevice()?(this.visibleOn&2)!==0:(this.visibleOn&1)!==0}}i5e([T()],AB.prototype,"visibleOn",2);class x3{get extensionName(){return"DocumentExtension"}onAfterBuildDocument(e){}}var n5e=Object.defineProperty,s5e=Object.getOwnPropertyDescriptor,aA=(n,e,i,s)=>{for(var r=s>1?void 0:s?s5e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&n5e(e,i,r),r};const su=q("debugdrag"),w3=[];var C3=(n=>(n[n.XZPlane=0]="XZPlane",n[n.Attached=1]="Attached",n[n.HitNormal=2]="HitNormal",n[n.DynamicViewAngle=3]="DynamicViewAngle",n[n.SnapToSurfaces=4]="SnapToSurfaces",n[n.None=5]="None",n))(C3||{}),WS;const Hc=(WS=class extends Oe{constructor(){super(...arguments),m(this,"dragMode",3),m(this,"snapGridResolution",0),m(this,"keepRotation",!0),m(this,"xrDragMode",1),m(this,"xrKeepRotation",!1),m(this,"xrDistanceDragFactor",1),m(this,"showGizmo",!1),m(this,"_rigidbody",null),m(this,"_targetObject",null),m(this,"_dragHelper",null),m(this,"_draggingRigidbodies",[]),m(this,"_potentialDragStartEvt",null),m(this,"_dragHandlers",new Map),m(this,"_totalMovement",new E),m(this,"_marker",null),m(this,"_isDragging",!1),m(this,"_didDrag",!1)}static get HasAnySelected(){return this._active>0}static get CurrentlySelected(){w3.length=0;for(const n of this._instances)n._isDragging&&w3.push(n);return w3}get draggedObject(){return this._targetObject}setTargetObject(n){var e,i;this._targetObject=n;for(const r of this._dragHandlers.values())r.setTargetObject(n);const s="_rigidbody-was-kinematic";((e=this._rigidbody)==null?void 0:e[s])===!1&&(this._rigidbody.isKinematic=!1,this._rigidbody[s]=void 0),this._rigidbody=null,n&&(this._rigidbody=$.getComponentInChildren(n,rn),((i=this._rigidbody)==null?void 0:i.isKinematic)===!1&&(this._rigidbody.isKinematic=!0,this._rigidbody[s]=!1))}awake(){this._potentialDragStartEvt=null,this._dragHandlers=new Map,this._totalMovement=new E,this._marker=null,this._isDragging=!1,this._didDrag=!1,this._dragHelper=null,this._draggingRigidbodies=[]}start(){this.gameObject.getComponentInParent(Ql)||this.gameObject.addComponent(Ql)}onEnable(){Hc._instances.push(this)}onDisable(){Hc._instances=Hc._instances.filter(n=>n!==this)}allowEdit(n=null){return this.context.connection.allowEditing}onPointerEnter(n){if(!this.allowEdit(this.gameObject)||n.mode!=="screen"||(n.event.mode==="tracked-pointer"||n.event.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===5)return;const e=$.getComponentInParent(n.object,Hc);!e||e!==this||(Hc.lastHovered=n.object,this.context.domElement.style.cursor="pointer")}onPointerMove(n){(this._isDragging||this._potentialDragStartEvt!==null)&&n.use()}onPointerExit(n){this.allowEdit(this.gameObject)&&n.mode==="screen"&&Hc.lastHovered===n.object&&(this.context.domElement.style.cursor="auto")}onPointerDown(n){if(!(!this.allowEdit(this.gameObject)||n.used||(n.mode==="tracked-pointer"||n.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===5)&&(Hc.lastHovered=n.object,n.button===0)){this._dragHandlers.size===0&&(this._didDrag=!1,this._totalMovement.set(0,0,0),this._potentialDragStartEvt=n),this._targetObject||this.setTargetObject(this.gameObject),Hc._active+=1;const e=new o5e(this,this._targetObject);if(this._dragHandlers.set(n.event.space,e),e.onDragStart(n),this._dragHandlers.size===2){const i=this._dragHandlers.values(),s=i.next().value,r=i.next().value,o=new r5e(this,this._targetObject,s,r);this._dragHandlers.set(this.gameObject,o),o.onDragStart(n)}n.use()}}onPointerUp(n){if(su&&Nt.DrawLabel(n.point??this.gameObject.worldPosition,"POINTERUP:"+n.pointerId+", "+n.button,.03,3),!this.allowEdit(this.gameObject)||n.button!==0)return;this._potentialDragStartEvt=null;const e=this._dragHandlers.get(n.event.space),i=this._dragHandlers.get(this.gameObject);i&&(i.handlerA===e||i.handlerB===e)&&(this._dragHandlers.delete(this.gameObject),i.onDragEnd(n)),e&&(Hc._active>0&&(Hc._active-=1),this.setTargetObject(null),e.onDragEnd&&e.onDragEnd(n),this._dragHandlers.delete(n.event.space),this._dragHandlers.size===0&&this.onLastDragEnd(n),n.use())}update(){for(const n of this._dragHandlers.values())n.collectMovementInfo&&n.collectMovementInfo(),n.getTotalMovement&&this._totalMovement.add(n.getTotalMovement());if(this._potentialDragStartEvt){if(!this._didDrag)if(this._totalMovement.length()>3e-4)this._didDrag=!0;else return;const n=this._potentialDragStartEvt;this._potentialDragStartEvt=null,this.onFirstDragStart(n)}for(const n of this._dragHandlers.values())n.onDragUpdate&&n.onDragUpdate(this._dragHandlers.size);this._dragHelper&&this._dragHelper.hasSelected&&this.onAnyDragUpdate()}onFirstDragStart(n){if(!n||!n.object)return;const e=$.getComponentInParent(n.object,Hc);if(!e||e!==this&&e._isDragging)return;const i=this._targetObject||this.gameObject;if(!i)return;this._isDragging=!0;const s=$.getComponentInChildren(i,Vd);su&&console.log("DRAG START",s,i),s&&(s.fastMode=!0,s?.requestOwnership()),this._marker=$.addComponent(i,OS),this._draggingRigidbodies.length=0;const r=$.getComponentsInChildren(i,rn);r&&this._draggingRigidbodies.push(...r)}onAnyDragUpdate(){if(!this._dragHelper)return;this._dragHelper.showGizmo=this.showGizmo,this._dragHelper.onUpdate(this.context);for(const e of this._draggingRigidbodies)e.wakeUp(),e.resetVelocities(),e.resetForcesAndTorques();const n=this._targetObject||this.gameObject;ih.markDirty(n)}onLastDragEnd(n){if(!this||!this._isDragging)return;this._isDragging=!1;for(const i of this._draggingRigidbodies)i.setVelocity(i.smoothedVelocity);if(this._draggingRigidbodies.length=0,this._targetObject=null,n!=null&&n.object){const i=$.getComponentInChildren(n.object,Vd);i&&(i.fastMode=!1)}if(this._marker&&this._marker.destroy(),!this._dragHelper)return;const e=this._dragHelper.selected;su&&console.log("DRAG END",e,e?.visible),this._dragHelper.setSelected(null,this.context)}},m(WS,"_active",0),m(WS,"_instances",[]),m(WS,"lastHovered"),WS);let dl=Hc;aA([T()],dl.prototype,"dragMode",2),aA([T()],dl.prototype,"snapGridResolution",2),aA([T()],dl.prototype,"keepRotation",2),aA([T()],dl.prototype,"xrDragMode",2),aA([T()],dl.prototype,"xrKeepRotation",2),aA([T()],dl.prototype,"xrDistanceDragFactor",2),aA([T()],dl.prototype,"showGizmo",2);class r5e{constructor(e,i,s,r){m(this,"handlerA"),m(this,"handlerB"),m(this,"context"),m(this,"settings"),m(this,"gameObject"),m(this,"_handlerAAttachmentPoint",new E),m(this,"_handlerBAttachmentPoint",new E),m(this,"_followObject"),m(this,"_manipulatorObject"),m(this,"_deviceMode"),m(this,"_followObjectStartWorldQuaternion",new Fe),m(this,"_manipulatorPosOffset",new E),m(this,"_manipulatorRotOffset",new Fe),m(this,"_manipulatorScaleOffset",new E),m(this,"_tempVec1",new E),m(this,"_tempVec2",new E),m(this,"_tempVec3",new E),m(this,"tempLookMatrix",new de),m(this,"_initialScale",new E),m(this,"_initialDistance",0);var o,a;this.context=e.context,this.settings=e,this.gameObject=i,this.handlerA=s,this.handlerB=r,this._followObject=new Ae,this._manipulatorObject=new Ae,this.context.scene.add(this._manipulatorObject);const l=(a=(o=Qt.active)==null?void 0:o.rig)==null?void 0:a.gameObject;if(!this.handlerA||!this.handlerB||!this.handlerA.hitPointInLocalSpace||!this.handlerB.hitPointInLocalSpace){console.error("Invalid: MultiTouchDragHandler needs two valid DragPointerHandlers with hitPointInLocalSpace set.");return}if(this._tempVec1.copy(this.handlerA.hitPointInLocalSpace),this._tempVec2.copy(this.handlerB.hitPointInLocalSpace),this.gameObject.localToWorld(this._tempVec1),this.gameObject.localToWorld(this._tempVec2),l&&(l.worldToLocal(this._tempVec1),l.worldToLocal(this._tempVec2)),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.02?(su&&console.log("Finding alternative drag attachment points since initial distance is too low: "+this._initialDistance.toFixed(2)),this.handlerA.followObject.parent.getWorldPosition(this._tempVec1),this.handlerB.followObject.parent.getWorldPosition(this._tempVec2),this._handlerAAttachmentPoint.copy(this._tempVec1),this._handlerBAttachmentPoint.copy(this._tempVec2),this.gameObject.worldToLocal(this._handlerAAttachmentPoint),this.gameObject.worldToLocal(this._handlerBAttachmentPoint),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.001&&(console.warn("Not supported right now \u2013 controller drag points for multitouch are too close!"),this._initialDistance=1)):(this._handlerAAttachmentPoint.copy(this.handlerA.hitPointInLocalSpace),this._handlerBAttachmentPoint.copy(this.handlerB.hitPointInLocalSpace)),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._initialScale.copy(i.scale),su){this._followObject.add(new Ya(2)),this._manipulatorObject.add(new Ya(5));const c=h=>`${h.x.toFixed(2)}, ${h.y.toFixed(2)}, ${h.z.toFixed(2)}`;Nt.DrawLine(this._tempVec1,this._tempVec2,65535,0,!1),Nt.DrawLabel(this._tempVec3,"A:B "+this._initialDistance.toFixed(2)+`
`+c(this._tempVec1)+`
`+c(this._tempVec2),.03,5)}}onDragStart(e){this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.matrix.identity(),this._deviceMode=e.mode,this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this.alignManipulator(),this._manipulatorObject.attach(this._followObject),this._manipulatorPosOffset.copy(this._followObject.position),this._manipulatorRotOffset.copy(this._followObject.quaternion),this._manipulatorScaleOffset.copy(this._followObject.scale)}onDragEnd(e){if(!this.handlerA||!this.handlerB){console.error("onDragEnd called on MultiTouchDragHandler without valid handlers. This is likely a bug.");return}this.handlerA.recenter(),this.handlerB.recenter(),this._manipulatorObject.removeFromParent(),this._followObject.removeFromParent(),this._manipulatorObject.destroy(),this._followObject.destroy()}alignManipulator(){if(!this.handlerA||!this.handlerB){console.error("alignManipulator called on MultiTouchDragHandler without valid handlers. This is likely a bug.",this);return}if(!this.handlerA.followObject||!this.handlerB.followObject){console.error("alignManipulator called on MultiTouchDragHandler without valid follow objects. This is likely a bug.",this.handlerA,this.handlerB);return}this._tempVec1.copy(this._handlerAAttachmentPoint),this._tempVec2.copy(this._handlerBAttachmentPoint),this.handlerA.followObject.localToWorld(this._tempVec1),this.handlerB.followObject.localToWorld(this._tempVec2),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._manipulatorObject.position.copy(this._tempVec3);const e=this.context.mainCamera;this.tempLookMatrix.lookAt(this._tempVec3,this._tempVec2,e.worldUp),this._manipulatorObject.quaternion.setFromRotationMatrix(this.tempLookMatrix);const i=this._tempVec1.distanceTo(this._tempVec2);this._manipulatorObject.scale.copy(this._initialScale).multiplyScalar(i/this._initialDistance),this._manipulatorObject.updateMatrix(),this._manipulatorObject.updateMatrixWorld(!0),su&&(Nt.DrawLabel(this._tempVec3.clone().add(new E(0,.2,0)),"A:B "+i.toFixed(2),.03),Nt.DrawLine(this._tempVec1,this._tempVec2,65280,0,!1))}onDragUpdate(){this.alignManipulator();const e=30,i=1;this._followObject.position.copy(this._manipulatorPosOffset),this._followObject.quaternion.copy(this._manipulatorRotOffset),this._followObject.scale.copy(this._manipulatorScaleOffset);const s=this.gameObject,r=this._followObject;r.updateMatrix(),r.updateMatrixWorld(!0);const o=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrKeepRotation:this.settings.keepRotation;if(this.settings.snapGridResolution>0){const d=this._followObject.worldPosition,u=this.settings.snapGridResolution;d.x=Math.round(d.x/u)*u,d.y=Math.round(d.y/u)*u,d.z=Math.round(d.z/u)*u,this._followObject.worldPosition=d,this._followObject.updateMatrix()}o&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const a=lt.clamp01(this.context.time.deltaTime*e*i),l=s.worldPosition;l.lerp(r.worldPosition,a),s.worldPosition=l;const c=s.worldQuaternion;c.slerp(r.worldQuaternion,a),s.worldQuaternion=c;const h=s.worldScale;h.lerp(r.worldScale,a),s.worldScale=h}setTargetObject(e){this.gameObject=e}}class o5e{constructor(e,i){m(this,"context"),m(this,"gameObject"),m(this,"settings"),m(this,"_lastRig"),m(this,"_followObject"),m(this,"_totalMovement",new E),m(this,"_totalMovementAlongRayDirection",0),m(this,"_grabStartDistance",0),m(this,"_deviceMode"),m(this,"_followObjectStartPosition",new E),m(this,"_followObjectStartQuaternion",new Fe),m(this,"_followObjectStartWorldQuaternion",new Fe),m(this,"_lastDragPosRigSpace"),m(this,"_tempVec",new E),m(this,"_tempMat",new de),m(this,"_hitPointInLocalSpace",new E),m(this,"_hitNormalInLocalSpace",new E),m(this,"_bottomCenter",new E),m(this,"_backCenter",new E),m(this,"_backBottomCenter",new E),m(this,"_bounds",new gi),m(this,"_dragPlane",new tr(new E(0,1,0))),m(this,"_draggedOverObject",null),m(this,"_draggedOverObjectLastSetUp",null),m(this,"_draggedOverObjectLastNormal",new E),m(this,"_draggedOverObjectDuration",0),m(this,"_hasLastSurfaceHitPoint",!1),m(this,"_lastSurfaceHitPoint",new E),this.settings=e,this.context=e.context,this.gameObject=i,this._followObject=new Ae}getTotalMovement(){return this._totalMovement}get followObject(){return this._followObject}get hitPointInLocalSpace(){return this._hitPointInLocalSpace}setTargetObject(e){this.gameObject=e}recenter(){var e,i;if(!this._followObject.parent){console.warn("Error: space follow object doesn't have parent but recenter() is called. This is likely a bug");return}if(!this.gameObject){console.warn("Error: space follow object doesn't have a gameObject");return}const s=this._followObject.parent;this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.position.set(0,0,0),this._followObject.quaternion.set(0,0,0,1),this._followObject.scale.set(1,1,1),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0),s.attach(this._followObject),this._followObjectStartPosition.copy(this._followObject.position),this._followObjectStartQuaternion.copy(this._followObject.quaternion),this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const r=this._hitPointInLocalSpace.clone();this.gameObject.localToWorld(r),this._grabStartDistance=r.distanceTo(s.worldPosition);const o=(i=(e=Qt.active)==null?void 0:e.rig)==null?void 0:i.gameObject,a=o?.worldScale.x||1;this._grabStartDistance/=a,this._totalMovementAlongRayDirection=0,this._lastDragPosRigSpace=void 0,su&&(Nt.DrawLine(r,s.worldPosition,65280,.5,!1),Nt.DrawLabel(s.worldPosition.add(new E(0,.1,0)),this._grabStartDistance.toFixed(2),.03,.5))}onDragStart(e){if(!this.gameObject){console.warn("Error: space follow object doesn't have a gameObject");return}if(e.event.space.add(this._followObject),this._lastDragPosRigSpace=void 0,e.point&&e.normal)this._hitPointInLocalSpace.copy(e.point),this.gameObject.worldToLocal(this._hitPointInLocalSpace),this._hitNormalInLocalSpace.copy(e.normal);else if(e){const g=e.event.space,f=g.worldPosition;this.gameObject.worldToLocal(f),this._hitPointInLocalSpace.copy(f);const A=g.worldUp;this._tempMat.copy(this.gameObject.matrixWorld).invert(),A.transformDirection(this._tempMat),this._hitNormalInLocalSpace.copy(A)}this.recenter(),this._totalMovement.set(0,0,0),this._deviceMode=e.mode;const i=this._followObject.parent.worldForward,s=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrDragMode:this.settings.dragMode,r=this._hitPointInLocalSpace.clone();switch(this.gameObject.localToWorld(r),s){case 0:const g=new E(0,1,0);this.gameObject.parent&&g.transformDirection(this.gameObject.parent.matrixWorld.clone().invert()),this._dragPlane.setFromNormalAndCoplanarPoint(g,r);break;case 2:const f=this._hitNormalInLocalSpace.clone();f.transformDirection(this.gameObject.matrixWorld),this._dragPlane.setFromNormalAndCoplanarPoint(f,r);break;case 1:this._dragPlane.setFromNormalAndCoplanarPoint(i,r);break;case 3:this.setPlaneViewAligned(r,!0);break;case 4:this.setPlaneViewAligned(r,!1);break}const o=this.gameObject.parent,a=this.gameObject.position.clone(),l=this.gameObject.quaternion.clone(),c=this.gameObject.scale.clone(),h=this.gameObject.matrixWorld.clone();o&&o.remove(this.gameObject),this.gameObject.position.set(0,0,0),this.gameObject.quaternion.set(0,0,0,1),this.gameObject.scale.set(1,1,1);const d=Ll([this.gameObject]);d.expandByPoint(this.gameObject.worldPosition);const u=new E;d.getCenter(u);const p=new E;d.getSize(p),this._bottomCenter.copy(u.clone().add(new E(0,-p.y/2,0))),this._backCenter.copy(u.clone().add(new E(0,0,p.z/2))),this._backBottomCenter.copy(u.clone().add(new E(0,-p.y/2,p.z/2))),this._bounds.copy(d),o&&o.add(this.gameObject),this.gameObject.position.copy(a),this.gameObject.quaternion.copy(l),this.gameObject.scale.copy(c),this.gameObject.matrixWorld.copy(h),this._draggedOverObject=null,this._draggedOverObjectLastSetUp=null,this._draggedOverObjectLastNormal.set(0,1,0),this._draggedOverObjectDuration=0}collectMovementInfo(){var e,i;if(!this._followObject.parent)return;const s=this._followObject.parent;this._followObject.updateMatrix();const r=s.worldPosition,o=(i=(e=Qt.active)==null?void 0:e.rig)==null?void 0:i.gameObject;o&&o.worldToLocal(r),(this._lastDragPosRigSpace===void 0||o!=this._lastRig)&&(this._lastDragPosRigSpace=r.clone(),this._lastRig=o),this._tempVec.copy(r).sub(this._lastDragPosRigSpace);const a=s.worldForward;if(o&&(this._tempMat.copy(o.matrixWorld).invert(),a.transformDirection(this._tempMat)),this._totalMovementAlongRayDirection+=a.dot(this._tempVec),this._tempVec.x=Math.abs(this._tempVec.x),this._tempVec.y=Math.abs(this._tempVec.y),this._tempVec.z=Math.abs(this._tempVec.z),this._totalMovement.add(this._tempVec),this._lastDragPosRigSpace.copy(r),su){let l=r;o&&(l=l.clone(),l.transformDirection(o.matrixWorld)),Nt.DrawRay(l,a,255)}}onDragUpdate(e){if(e>1)return;const i=this.gameObject;if(!i||!this._followObject){console.warn("Warning: DragPointerHandler doesn't have a dragged object. This is likely a bug.");return}const s=this._followObject.parent;if(!s){console.warn("Warning: DragPointerHandler doesn't have a drag source. This is likely a bug.");return}this._followObject.updateMatrix();const r=s.worldPosition,o=s.worldForward,a=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer",l=a?this.settings.xrKeepRotation:this.settings.keepRotation,c=a?this.settings.xrDragMode:this.settings.dragMode;if(c===5)return;const h=10;l&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);let d=1,u=2;if(a&&this._grabStartDistance>.5){const v=1+this._totalMovementAlongRayDirection*(2*this.settings.xrDistanceDragFactor);d=Math.max(0,v),d=d*d*d}else this._grabStartDistance<=.5&&(u=3);this._followObject.position.copy(this._followObjectStartPosition),l||this._followObject.quaternion.copy(this._followObjectStartQuaternion),this._followObject.position.multiplyScalar(d),this._followObject.updateMatrix();const p=this._hasLastSurfaceHitPoint;this._hasLastSurfaceHitPoint=!1;const g=new ya(r,o);if(c==4){const v=this.context.physics.raycastFromRay(g,{testObject:x=>x!==this.followObject&&x!==s&&x!==i});if(v.length>0){const x=v[0];if(this._draggedOverObject===x.object?this._draggedOverObjectDuration+=this.context.time.deltaTime:(this._draggedOverObject=x.object,this._draggedOverObjectDuration=0),x.face){this._hasLastSurfaceHitPoint=!0,this._lastSurfaceHitPoint.copy(x.point);const w=.15,C=this._draggedOverObjectDuration>=w,S=.001,_=this._totalMovement.length()>=S,I=Lt(x.normal||x.face.normal).applyQuaternion(x.object.worldQuaternion);if((C||_)&&(this._draggedOverObjectLastSetUp!==this._draggedOverObject||this._draggedOverObjectLastNormal.dot(I)<.999999||this.context.time.frame%60===0)){this._draggedOverObjectLastSetUp=this._draggedOverObject,this._draggedOverObjectLastNormal.copy(x.face.normal);const B=Lt(),M=Lt();this._bounds.getCenter(B),this._bounds.getSize(M),B.sub(M.multiplyScalar(.5).multiply(I)),this._hitPointInLocalSpace.copy(B),this._hitNormalInLocalSpace.copy(x.face.normal),this._bounds.getCenter(B),this._bounds.getSize(M),B.add(M.multiplyScalar(.5).multiply(x.face.normal));const R=Lt(this._hitPointInLocalSpace).add(B);this._followObject.localToWorld(R);const k=x.point;this._dragPlane.setFromNormalAndCoplanarPoint(I,k)}else if(!(C||_))return}}else p&&this.gameObject&&this.setPlaneViewAligned(this.gameObject.worldPosition,!1)}if(c!==1&&g.intersectPlane(this._dragPlane,this._tempVec)){this._followObject.worldPosition=this._tempVec,this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const v=Lt(this._hitPointInLocalSpace);this._followObject.localToWorld(v),su&&Nt.DrawLine(v,this._tempVec,65535,0,!1),this._followObject.worldPosition=this._tempVec.multiplyScalar(2).sub(v),this._followObject.updateMatrix(),this._followObject.updateMatrix()}if(this.settings.snapGridResolution>0){const v=this._followObject.worldPosition,x=this.settings.snapGridResolution;v.x=Math.round(v.x/x)*x,v.y=Math.round(v.y/x)*x,v.z=Math.round(v.z/x)*x,this._followObject.worldPosition=v,this._followObject.updateMatrix()}l&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const f=lt.clamp01(this.context.time.deltaTime*h*u),A=lt.clamp01(this.context.time.deltaTime*h*.5*u),y=i.worldPosition;y.lerp(this._followObject.worldPosition,f),i.worldPosition=y;const b=i.worldQuaternion;if(b.slerp(this._followObject.worldQuaternion,A),i.worldQuaternion=b,su){const v=this._hitPointInLocalSpace.clone();i.localToWorld(v),Nt.DrawSphere(v,.02,16711680);const x=this._hitNormalInLocalSpace.clone();x.applyQuaternion(b),Nt.DrawRay(v,x,16711680),Nt.DrawLabel(y.add(new E(0,.25,0)),`Distance: ${this._totalMovement.length().toFixed(2)}

                Along Ray: ${this._totalMovementAlongRayDirection.toFixed(2)}

                Session: ${!!Qt.active}

                Device: ${this._deviceMode}

                `,.03);const w=this._bottomCenter.clone(),C=this._backCenter.clone(),S=this._backBottomCenter.clone();i.localToWorld(w),i.localToWorld(C),i.localToWorld(S),Nt.DrawSphere(w,.01,65280,0,!1),Nt.DrawSphere(C,.01,255,0,!1),Nt.DrawSphere(S,.01,16711935,0,!1),Nt.DrawLine(w,S,65535,0,!1),Nt.DrawLine(S,C,65535,0,!1)}}onDragEnd(e){console.assert(this._followObject.parent===e.event.space,"Drag end: _followObject is not parented to the space object"),this._followObject.removeFromParent(),this._followObject.destroy(),this._lastDragPosRigSpace=void 0}setPlaneViewAligned(e,i){if(!this._followObject.parent)return!1;const s=this._followObject.parent.worldForward,r=Lt(0,1,0),o=s,a=r.angleTo(o),l=.5;return i&&(a>Math.PI/2+l||a<Math.PI/2-l)?this._dragPlane.setFromNormalAndCoplanarPoint(r,e):this._dragPlane.setFromNormalAndCoplanarPoint(s,e),!0}}const bre=class{constructor(n){m(this,"showGizmo",!0),m(this,"useViewAngle",!0),m(this,"_selected",null),m(this,"_context",null),m(this,"_camera"),m(this,"_cameraPlane",new tr),m(this,"_hasGroundPlane",!1),m(this,"_groundPlane",new tr),m(this,"_groundOffset",new E),m(this,"_groundOffsetFactor",0),m(this,"_groundDistance",0),m(this,"_groundPlanePoint",new E),m(this,"_raycaster",new pm),m(this,"_cameraPlaneOffset",new E),m(this,"_intersection",new E),m(this,"_worldPosition",new E),m(this,"_inverseMatrix",new de),m(this,"_rbs",[]),m(this,"_groundLine"),m(this,"_groundMarker"),m(this,"_groundOffsetVector",new E(0,1,0)),m(this,"_requireUpdateGroundPlane",!0),m(this,"_didDragOnGroundPlaneLastFrame",!1),this._camera=n;const e=new is(bre.geometry),i=e.material;i.color=new fe(.4,.4,.4),e.layers.set(2),e.name="line",e.scale.y=1,this._groundLine=e;const s=new eh(.5,22,22),r=new ai({color:i.color}),o=new pe(s,r);o.visible=!1,o.layers.set(2),this._groundMarker=o}get hasSelected(){return this._selected!==null&&this._selected!==void 0}get selected(){return this._selected}setSelected(n,e){if(this._selected&&e)for(const i of this._rbs)i.wakeUp(),i.setVelocity(0,0,0);if(this._selected&&Od.Remove(e,this._selected),this._selected=n,this._context=e,this._rbs.length=0,n?(e.scene.add(this._groundLine),e.scene.add(this._groundMarker)):(this._groundLine.removeFromParent(),this._groundMarker.removeFromParent()),this._selected){if(!e){console.error("DragHelper: no context");return}Od.Add(e,this._selected,null),this._groundOffsetFactor=0,this._hasGroundPlane=!0,this._groundOffset.set(0,0,0),this._requireUpdateGroundPlane=!0,this.onUpdateScreenSpacePlane()}}onUpdate(n){this._selected}onUpdateWorldPosition(n,e,i){if(this._selected){if(i){const s=ri(this._selected);s.y=n.y,n=s}if(Cr(this._selected,n),Cr(this._groundLine,n),this._hasGroundPlane?this._groundLine.scale.y=this._groundDistance:this._groundLine.scale.y=1e3,this._groundLine.visible=this.showGizmo,this._groundMarker.visible=e!==null&&this.showGizmo,e){const s=ri(this._camera).distanceTo(e)*.01;this._groundMarker.scale.set(s,s,s),Cr(this._groundMarker,e)}}}onUpdateScreenSpacePlane(){if(!this._selected||!this._context)return;const n=this._context.input.getPointerPositionRC(0);n&&(this._raycaster.setFromCamera(n,this._camera),this._cameraPlane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._cameraPlane.normal),this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld)),this._raycaster.ray.intersectPlane(this._cameraPlane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._cameraPlaneOffset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))))}onUpdateGroundPlane(){if(!this._selected||!this._context)return;const n=ri(this._selected),e=new ya(Lt(0,.1,0).add(n),Lt(0,-1,0)),i=new Rd;i.testObject=r=>r!==this._selected;const s=this._context.physics.raycastFromRay(e,i);for(let r=0;r<s.length;r++){const o=s[r];if(!o.face||this.contains(this._selected,o.object))continue;const a=Lt(0,1,0);this._groundPlane.setFromNormalAndCoplanarPoint(a,o.point);break}this._hasGroundPlane=!0,this._groundPlane.setFromNormalAndCoplanarPoint(e.direction.multiplyScalar(-1),e.origin),this._raycaster.ray.intersectPlane(this._groundPlane,this._intersection),this._groundDistance=this._intersection.distanceTo(n),this._groundOffset.copy(this._intersection).sub(n)}contains(n,e){if(n===e)return!0;if(n.children){for(const i of n.children)if(this.contains(i,e))return!0}return!1}};let a5e=bre;m(a5e,"geometry",new Rt().setFromPoints([new E(0,0,0),new E(0,-1,0)]));var vre=(n=>(n.File_Spawned="file-spawned",n))(vre||{});class l5e{constructor(e,i,s,r,o,a,l,c,h){m(this,"guid"),m(this,"file_name"),m(this,"file_hash"),m(this,"file_size"),m(this,"position"),m(this,"scale"),m(this,"seed"),m(this,"sender"),m(this,"downloadUrl"),m(this,"parentGuid"),m(this,"boundsSize"),this.seed=i,this.guid=s,this.file_name=r,this.file_hash=o,this.file_size=a,this.position=l,this.scale=c,this.sender=e,this.downloadUrl=h}}var Gg;(n=>{const e=new Map;function i(r){var o;e.has(r.guid)&&s(r.guid);const a=new Ae;e.set(r.guid,a);const l=new Ae;l.position.y=-.5,a.add(l);const c=new pe(new bn(1,1,1,1,1,1),new ai({color:14540253,wireframe:!0,transparent:!0,opacity:.3}));c.position.y=.5,l.add(c);const h=new Ae;l.add(h);const d=new pe(new bn(1,1,1,1,1,1),new ai({color:12307660,transparent:!0,opacity:.4}));d.position.y=.5,h.scale.y=.01,h.add(d);const u=new pe(new Xs(1,1,1,1),new ai({color:34,transparent:!0,opacity:.05,depthTest:!1}));return u.rotateX(-Math.PI/2),u.position.y=.51,d.add(u),r.parent.add(a),a.rotateY(Math.PI/2),r.position&&((o=a.position)==null||o.copy(r.position)),r.size&&(a.worldScale=new E().copy(r.size)),a.position.y=a.scale.y/2,{object:a,onProgress:p=>{h instanceof Ae&&h.scale.set(1,p,1)}}}n.addPreview=i;function s(r){const o=e.get(r);o&&(e.delete(r),o.removeFromParent())}n.removePreview=s})(Gg||(Gg={}));var c5e=Object.defineProperty,h5e=Object.getOwnPropertyDescriptor,Vv=(n,e,i,s)=>{for(var r=s>1?void 0:s?h5e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&c5e(e,i,r),r};const Zh=q("debugdroplistener");class yB extends CustomEvent{constructor(e){super("object-added",{detail:e})}}const d5e="blob";class Ep extends Oe{constructor(){super(...arguments),m(this,"useNetworking",!0),m(this,"dropArea"),m(this,"fitIntoVolume",!1),m(this,"fitVolumeSize",new E(1,1,1)),m(this,"placeAtHitPosition",!0),m(this,"onDropped",new Gn),m(this,"onNetworkEvent",e=>{var i;if(!this.useNetworking){Zh&&console.debug("[DropListener] Ignoring networked event because networking is disabled",e);return}if((i=e.guid)!=null&&i.startsWith(this.guid)){const s=e.url;if(console.debug("[DropListener] Received networked event",e),s)if(Array.isArray(s))for(const r of s)this.addFromUrl(r,{screenposition:new Q,point:e.point,size:e.size},!0);else this.addFromUrl(s,{screenposition:new Q,point:e.point,size:e.size},!0)}}),m(this,"handlePaste",e=>{this.context.connection.allowEditing===!1||e.defaultPrevented||navigator.clipboard.readText().then(i=>{if(i&&(i.startsWith("http")||i.startsWith("https")||i.startsWith("blob"))){const s={screenposition:new Q(this.context.input.mousePosition.x,this.context.input.mousePosition.y)};this.testIfIsInDropArea(s)&&this.addFromUrl(i,s,!1)}}).catch(console.warn)}),m(this,"onDrag",e=>{this.context.connection.allowEditing!==!1&&e.preventDefault()}),m(this,"onDrop",async e=>{if(this.context.connection.allowEditing===!1||(Zh&&console.log(e),!(e!=null&&e.dataTransfer))||e["droplistener:handled"])return;e.preventDefault();const i={screenposition:new Q(e.offsetX,e.offsetY)};if(this.dropArea&&this.testIfIsInDropArea(i)===!1)return;e["droplistener:handled"]=!0;const s=e.dataTransfer.items;if(!s)return;const r=[];for(const o in s){const a=s[o];if(a.kind==="file"){const l=a.getAsFile();if(!l)continue;r.push(l)}else a.kind==="string"&&a.type=="text/plain"&&a.getAsString(l=>{this.addFromUrl(l,i,!1)})}r.length>0&&await this.addDroppedFiles(r,i)}),m(this,"_abort",null),m(this,"_addedObjects",new Array),m(this,"_addedModels",new Array)}onEnable(){this.context.renderer.domElement.addEventListener("dragover",this.onDrag),this.context.renderer.domElement.addEventListener("drop",this.onDrop),window.addEventListener("paste",this.handlePaste),this.context.connection.beginListen("droplistener",this.onNetworkEvent)}onDisable(){this.context.renderer.domElement.removeEventListener("dragover",this.onDrag),this.context.renderer.domElement.removeEventListener("drop",this.onDrop),window.removeEventListener("paste",this.handlePaste),this.context.connection.stopListen("droplistener",this.onNetworkEvent)}loadFromURL(e,i){this.addFromUrl(e,{screenposition:new Q,point:i?.point,size:i?.size},!0)}forgetObjects(){this.removePreviouslyAddedObjects(!1)}async addFromUrl(e,i,s){Zh&&console.log("dropped url",e);try{if(e.startsWith("https://github.com/")){const a=e.split("/"),l=a[3],c=a[4],h=a[6],d=a.slice(7).join("/");e=`https://raw.githubusercontent.com/${l}/${c}/${h}/${d}`}else e.startsWith("https://polyhaven.com/a")&&(e=u5e(e));if(!e)return null;const r=e.toLowerCase();if(r.endsWith(".hdr")||r.endsWith(".hdri")||r.endsWith(".exr")||r.endsWith(".png")||r.endsWith(".jpg")||r.endsWith(".jpeg"))return null;this.removePreviouslyAddedObjects();const o=await bB.loadFileFromURL(new URL(e),{guid:this.guid,context:this.context,parent:this.gameObject,point:i.point,size:i.size});if(o&&this._addedObjects.length<=0)return i.url=e,this.addObject(o,i,s)}catch{console.warn("String is not a valid URL",e)}return null}async addDroppedFiles(e,i){var s,r;if(Zh&&console.log("Add files",e),!!Array.isArray(e)&&e.length){this.deleteDropEvent(),this.removePreviouslyAddedObjects(),mw(d5e,null),(s=this._abort)==null||s.abort("New files dropped"),this._abort=new AbortController;for(const o of e){if(!o)continue;console.debug("Load file "+o.name);const a=await bB.loadFile(o,this.context,{guid:this.guid});if(a){this.dispatchEvent(new CustomEvent("file-dropped",{detail:o})),i.file=o;const l=this.addObject(a,i,!1);l&&this.context.connection.isConnected&&this.useNetworking&&(console.debug("Uploading dropped file to blob storage"),N0.upload(o,{abort:(r=this._abort)==null?void 0:r.signal}).then(c=>{c!=null&&c.download_url&&this._addedObjects.includes(l)&&this.sendDropEvent(c.download_url,l,a.contentMD5)}).catch(console.warn));break}}}}removePreviouslyAddedObjects(e=!0){if(e)for(const i of this._addedObjects)i.parent===this.gameObject&&Ol(i,!0,!0);this._addedObjects.length=0,this._addedModels.length=0}addObject(e,i,s){var r,o;const{model:a,contentMD5:l}=e;if(Zh&&console.log(`Dropped ${this.gameObject.name}`,a),!(a!=null&&a.scene))return console.warn("No object specified to add to scene",a),null;this.removePreviouslyAddedObjects();const c=a.scene;this.gameObject.attach(c),c.position.set(0,0,0),c.quaternion.identity(),this._addedObjects.push(c),this._addedModels.push(a);const h=new gi().setFromCenterAndSize(new E(0,this.fitVolumeSize.y*.5,0).add(this.gameObject.worldPosition),this.fitVolumeSize);if(Zh&&Nt.DrawWireBox3(h,255,5),this.fitIntoVolume&&N8(c,h,{position:!this.placeAtHitPosition}),this.placeAtHitPosition&&i&&i.screenposition){c.visible=!1;const u=this.context.physics.raycast({screenPoint:this.context.input.convertScreenspaceToRaycastSpace(i.screenposition.clone())});if(c.visible=!0,u&&u.length>0)for(const p of u){const g=p.point.clone();Zh&&console.log("Place object at hit",p),V8(c,g);break}}Jb.assignAnimationsFromFile(a,{createAnimationComponent:u=>Ul(u,ra)});const d=new yB({sender:this,gltf:a,model:a,object:c,contentMD5:l,dropped:i.file||(i.url?new URL(i.url):void 0)});return this.dispatchEvent(d),(r=this.onDropped)==null||r.invoke(d.detail),!s&&(o=i.url)!=null&&o.startsWith("http")&&this.context.connection.isConnected&&c&&this.sendDropEvent(i.url,c,l),c}async sendDropEvent(e,i,s){if(!this.useNetworking){Zh&&console.debug("[DropListener] Ignoring networked event because networking is disabled",e);return}if(this.context.connection.isConnected){console.debug('Sending drop event "'+i.name+'"',e);const r=Ll([i]),o={name:i.name,guid:this.guid,url:e,point:i.worldPosition.clone(),size:r.getSize(new E),contentMD5:s};this.context.connection.send("droplistener",o)}}deleteDropEvent(){this.context.connection.sendDeleteRemoteState(this.guid)}testIfIsInDropArea(e){if(this.dropArea){const i=this.context.input.convertScreenspaceToRaycastSpace(e.screenposition.clone());if(!this.context.physics.raycast({targets:[this.dropArea],screenPoint:i,recursive:!0,testObject:s=>!this._addedObjects.includes(s)}).length)return Je()&&console.log(`Dropped outside of drop area for DropListener "${this.name}".`),!1}return!0}}Vv([T()],Ep.prototype,"useNetworking",2),Vv([T(Ae)],Ep.prototype,"dropArea",2),Vv([T()],Ep.prototype,"fitIntoVolume",2),Vv([T(E)],Ep.prototype,"fitVolumeSize",2),Vv([T()],Ep.prototype,"placeAtHitPosition",2),Vv([T(Gn)],Ep.prototype,"onDropped",2);function u5e(n){if(!n.startsWith("https://polyhaven.com/"))return n;const e="https://dl.polyhaven.org/file/ph-assets/Models/gltf/4k/",i=new URL(n).pathname.split("/").pop(),s=`${e}${i}/${i}_4k.gltf`;return console.log("Resolved polyhaven asset url",n,"\u2192",s),s}var bB;(n=>{async function e(s,r,o){const a=s.name.toLowerCase();return a.endsWith(".gltf")||a.endsWith(".glb")||a.endsWith(".fbx")||a.endsWith(".obj")||a.endsWith(".usdz")||a.endsWith(".vrm")||s.type==="model/gltf+json"||s.type==="model/gltf-binary"?new Promise((l,c)=>{const h=new FileReader;h.readAsArrayBuffer(s),h.onloadend=async d=>{const u=h.result,p=o.guid,g=new Zo(p),f=await fh().parseSync(r,u,s.name,g);if(f){const A=N0.hashMD5(u);l({model:f,contentMD5:A})}}}):(console.warn("Unsupported file type: "+a,s.type),null)}n.loadFile=e;async function i(s,r){return new Promise(async(o,a)=>{const l=new Zo(r.guid),c=s.toString();Zh&&Nt.DrawWireSphere(r.point,.1,16711680,3);const h=Gg.addPreview({guid:r.guid,parent:r.parent,position:r?.point,size:r?.size}),d=await fh().loadSync(r.context,c,c,l,u=>{h.onProgress(u.loaded/u.total)}).catch(console.warn);if(d){const u=await fetch(c).then(g=>g.arrayBuffer()),p=N0.hashMD5(u);Zh?setTimeout(()=>Gg.removePreview(r.guid),3e3):Gg.removePreview(r.guid),o({model:d,contentMD5:p})}else Zh?setTimeout(()=>Gg.removePreview(r.guid),3e3):Gg.removePreview(r.guid),console.warn("Unsupported file type: "+s.toString())})}n.loadFileFromURL=i})(bB||(bB={}));var p5e=Object.defineProperty,m5e=Object.getOwnPropertyDescriptor,vB=(n,e,i,s)=>{for(var r=s>1?void 0:s?m5e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&p5e(e,i,r),r};const xre=class extends Oe{constructor(){super(...arguments),m(this,"parent",null),m(this,"object",null),m(this,"limitCount",10),m(this,"limitInterval",60),m(this,"_currentCount",0),m(this,"_startPosition",null),m(this,"_startQuaternion",null),m(this,"_forwardPointerEvents",new Map)}start(){var n,e;if(this._currentCount=0,this._startPosition=null,this._startQuaternion=null,this.object||(this.object=this.gameObject),this.object){if(this.object===this.gameObject){const s=new Zo(this.guid);this.object=$.instantiate(this.object,{idProvider:s,keepWorldPosition:!1});const r=$.getComponent(this.object,xre);r?.destroy();let o=this.object.getComponentInChildren(dl);o||(o=this.object.addComponent(dl,{dragMode:C3.SnapToSurfaces}),o.guid=s.generateUUID());let a=$.getComponent(o.gameObject,Vd);a||(a=o.gameObject.addComponent(Vd),a.guid=s.generateUUID())}this.object.visible=!1;const i=this.gameObject.getComponent(dl);i&&(i.enabled=!1),this._startPosition=((n=this.object.position)==null?void 0:n.clone())??new E(0,0,0),this._startQuaternion=((e=this.object.quaternion)==null?void 0:e.clone())??new Fe(0,0,0,1)}this.gameObject.getComponentInParent(Ql)||this.gameObject.addComponent(Ql),this.cloneLimitIntervalFn()}onPointerEnter(n){n.used||this.object&&this.context.connection.allowEditing&&n.button===0&&this.context.input.setCursorPointer()}onPointerExit(n){n.used||this.object&&this.context.connection.allowEditing&&n.button===0&&this.context.input.setCursorNormal()}onPointerDown(n){if(n.used||!this.object||!this.context.connection.allowEditing||n.button!==0)return;const e=this.handleDuplication();if(e){const i=$.getComponent(e,dl);i?(i.onPointerDown(n),this._forwardPointerEvents.set(n.event.space,i)):console.warn("Duplicated object does not have DragControls",e)}else console.warn("Could not duplicate object. Has the target object been destroyed?",this)}onPointerUp(n){if(n.used)return;const e=this._forwardPointerEvents.get(n.event.space);e&&(e.onPointerUp(n),this._forwardPointerEvents.delete(n.event.space))}cloneLimitIntervalFn(){this.destroyed||(this._currentCount>0&&(this._currentCount-=1),setTimeout(()=>{this.cloneLimitIntervalFn()},this.limitInterval/this.limitCount*1e3))}handleDuplication(){var n;if(!this.object||this._currentCount>=this.limitCount||this.object===this.gameObject)return null;if($.isDestroyed(this.object))return this.object=null,null;this.object.visible=!0,this._startPosition&&this.object.position.copy(this._startPosition),this._startQuaternion&&this.object.quaternion.copy(this._startQuaternion);const e=new qh;this.parent||(this.parent=this.gameObject.parent),this.parent&&(e.parent=this.parent.guid??((n=this.parent.userData)==null?void 0:n.guid),e.keepWorldPosition=!0),e.position=this.worldPosition,e.rotation=this.worldQuaternion,e.context=this.context,this._currentCount+=1;const i=$.instantiateSynced(this.object,e);return console.assert(i!==this.object,"Duplicated object is original"),this.object.visible=!1,this._startPosition&&this.object.position.clone().copy(this._startPosition),this._startQuaternion&&this.object.quaternion.clone().copy(this._startQuaternion),i}};let lA=xre;vB([T(Ae)],lA.prototype,"parent",2),vB([T(Ae)],lA.prototype,"object",2),vB([T()],lA.prototype,"limitCount",2),vB([T()],lA.prototype,"limitInterval",2);class HS extends qr{constructor(e){super(),m(this,"effect"),this.effect=e}get typeName(){return this.effect.constructor.name}onCreateEffect(){return this.effect}}var Xv=(n=>(n[n.PointerEnter=0]="PointerEnter",n[n.PointerExit=1]="PointerExit",n[n.PointerDown=2]="PointerDown",n[n.PointerUp=3]="PointerUp",n[n.PointerClick=4]="PointerClick",n[n.Drag=5]="Drag",n[n.Drop=6]="Drop",n[n.Scroll=7]="Scroll",n[n.UpdateSelected=8]="UpdateSelected",n[n.Select=9]="Select",n[n.Deselect=10]="Deselect",n[n.Move=11]="Move",n[n.InitializePotentialDrag=12]="InitializePotentialDrag",n[n.BeginDrag=13]="BeginDrag",n[n.EndDrag=14]="EndDrag",n[n.Submit=15]="Submit",n[n.Cancel=16]="Cancel",n))(Xv||{}),g5e=Object.defineProperty,f5e=Object.getOwnPropertyDescriptor,S3=(n,e,i,s)=>{for(var r=s>1?void 0:s?f5e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&g5e(e,i,r),r};class _3{constructor(){m(this,"eventID"),m(this,"callback",new Gn)}}S3([T()],_3.prototype,"eventID",2),S3([T(Gn)],_3.prototype,"callback",2);class xB extends Oe{constructor(){super(...arguments),m(this,"triggers",[])}invoke(e){var i;if(this.triggers)for(const s of this.triggers)s.eventID===e&&((i=s.callback)==null||i.invoke())}onPointerClick(e){this.invoke(Xv.PointerClick)}onPointerEnter(e){this.invoke(Xv.PointerEnter)}onPointerExit(e){this.invoke(Xv.PointerExit)}onPointerDown(e){this.invoke(Xv.PointerDown)}onPointerUp(e){this.invoke(Xv.PointerUp)}}S3([T(_3)],xB.prototype,"triggers",2);var A5e=Object.defineProperty,y5e=Object.getOwnPropertyDescriptor,M3=(n,e,i,s)=>{for(var r=s>1?void 0:s?y5e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&A5e(e,i,r),r};class I3 extends Oe{constructor(){super(...arguments),m(this,"connectedBody"),m(this,"_rigidBody",null)}get rigidBody(){return this._rigidBody}onEnable(){this._rigidBody||(this._rigidBody=this.gameObject.getComponent(rn)),this.rigidBody&&this.connectedBody&&this.startCoroutine(this.create())}*create(){yield,this.rigidBody&&this.connectedBody&&this.activeAndEnabled&&this.createJoint(this.rigidBody,this.connectedBody)}}M3([T(rn)],I3.prototype,"connectedBody",2);class T3 extends I3{createJoint(e,i){var s;(s=this.context.physics.engine)==null||s.addFixedJoint(e,i)}}class QS extends I3{constructor(){super(...arguments),m(this,"anchor"),m(this,"axis")}createJoint(e,i){var s;this.axis&&this.anchor&&((s=this.context.physics.engine)==null||s.addHingeJoint(e,i,this.anchor,this.axis))}}M3([T(E)],QS.prototype,"anchor",2),M3([T(E)],QS.prototype,"axis",2);const b5e={type:"change"},wre=1e-6,Cre=new Fe;let v5e=class extends ET{constructor(n,e=null){super(n,e),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new E(0,0,0),this._rotationVector=new E(0,0,0),this._lastQuaternion=new Fe,this._lastPosition=new E,this._status=0,this._onKeyDown=x5e.bind(this),this._onKeyUp=w5e.bind(this),this._onPointerMove=S5e.bind(this),this._onPointerDown=C5e.bind(this),this._onPointerUp=_5e.bind(this),this._onPointerCancel=M5e.bind(this),this._onContextMenu=I5e.bind(this),e!==null&&this.connect()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(n){if(this.enabled===!1)return;const e=this.object,i=n*this.movementSpeed,s=n*this.rollSpeed;e.translateX(this._moveVector.x*i),e.translateY(this._moveVector.y*i),e.translateZ(this._moveVector.z*i),Cre.set(this._rotationVector.x*s,this._rotationVector.y*s,this._rotationVector.z*s,1).normalize(),e.quaternion.multiply(Cre),(this._lastPosition.distanceToSquared(e.position)>wre||8*(1-this._lastQuaternion.dot(e.quaternion))>wre)&&(this.dispatchEvent(b5e),this._lastQuaternion.copy(e.quaternion),this._lastPosition.copy(e.position))}_updateMovementVector(){const n=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-n+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}};function x5e(n){if(!(n.altKey||this.enabled===!1)){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function w5e(n){if(this.enabled!==!1){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function C5e(n){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(n.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function S5e(n){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),i=e.size[0]/2,s=e.size[1]/2;this._moveState.yawLeft=-(n.pageX-e.offset[0]-i)/i,this._moveState.pitchDown=(n.pageY-e.offset[1]-s)/s,this._updateRotationVector()}}function _5e(n){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(n.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function M5e(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function I5e(n){this.enabled!==!1&&n.preventDefault()}class E3 extends Oe{constructor(){super(...arguments),m(this,"_controls",null)}onEnable(){var e;const i=(e=$.getComponent(this.gameObject,In))==null?void 0:e.threeCamera;if(!i){console.warn("FlyControls: Requires a Camera component on the same object as this component.");return}this._controls=new v5e(i,this.context.renderer.domElement),this._controls.rollSpeed=.5,this._controls.movementSpeed=3,this._controls.dragToLook=!0}onDisable(){var e;(e=this._controls)==null||e.dispose(),this._controls=null}update(){this._controls&&this._controls.update(this.context.time.deltaTime)}}var T5e=Object.defineProperty,E5e=Object.getOwnPropertyDescriptor,R3=(n,e,i,s)=>{for(var r=s>1?void 0:s?E5e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&T5e(e,i,r),r};class Dv extends Oe{constructor(){super(...arguments),m(this,"_fog")}get fog(){return this._fog||(this._fog=new FI(0,0,50)),this._fog}get mode(){return 1}set near(e){this.fog.near=e}get near(){return this.fog.near}set far(e){this.fog.far=e}get far(){return this.fog.far}set color(e){this.fog.color.copy(e)}get color(){return this.fog.color}onEnable(){this.scene.fog=this.fog}onDisable(){this.scene.fog===this._fog&&(this.scene.fog=null)}}R3([T()],Dv.prototype,"near",1),R3([T()],Dv.prototype,"far",1),R3([T(fe)],Dv.prototype,"color",1);let KS,L3,zv,wB;function B3(n,e=1/0,i=null){L3||(L3=new Xs(2,2,1,1)),zv||(zv=new jt({uniforms:{blitTexture:new Te(n)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = sRGBTransferOETF( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),zv.uniforms.blitTexture.value=n,zv.defines.IS_SRGB=n.colorSpace==ut,zv.needsUpdate=!0,wB||(wB=new pe(L3,zv),wB.frustumCulled=!1);const s=new Ot,r=new ir;r.add(wB),i===null&&(i=KS=new om({antialias:!1}));const o=Math.min(n.image.width,e),a=Math.min(n.image.height,e);i.setSize(o,a),i.clear(),i.render(r,s);const l=document.createElement("canvas"),c=l.getContext("2d");l.width=o,l.height=a,c.drawImage(i.domElement,0,0,o,a);const h=new vP(l);return h.minFilter=n.minFilter,h.magFilter=n.magFilter,h.wrapS=n.wrapS,h.wrapT=n.wrapT,h.colorSpace=n.colorSpace,h.name=n.name,KS&&(KS.forceContextLoss(),KS.dispose(),KS=null),h}const Sre={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class CB{constructor(){this.pluginCallbacks=[],this.register(function(e){return new D5e(e)}),this.register(function(e){return new z5e(e)}),this.register(function(e){return new Z5e(e)}),this.register(function(e){return new W5e(e)}),this.register(function(e){return new H5e(e)}),this.register(function(e){return new Q5e(e)}),this.register(function(e){return new F5e(e)}),this.register(function(e){return new U5e(e)}),this.register(function(e){return new O5e(e)}),this.register(function(e){return new K5e(e)}),this.register(function(e){return new Y5e(e)}),this.register(function(e){return new j5e(e)}),this.register(function(e){return new J5e(e)}),this.register(function(e){return new q5e(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,r){const o=new X5e,a=[];for(let l=0,c=this.pluginCallbacks.length;l<c;l++)a.push(this.pluginCallbacks[l](o));o.setPlugins(a),o.write(e,i,r).catch(s)}parseAsync(e,i){const s=this;return new Promise(function(r,o){s.parse(e,r,o,i)})}}const Ni={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},k3="KHR_mesh_quantization",sc={};sc[si]=Ni.NEAREST,sc[Rx]=Ni.NEAREST_MIPMAP_NEAREST,sc[id]=Ni.NEAREST_MIPMAP_LINEAR,sc[Wt]=Ni.LINEAR,sc[vu]=Ni.LINEAR_MIPMAP_NEAREST,sc[Ar]=Ni.LINEAR_MIPMAP_LINEAR,sc[Wo]=Ni.CLAMP_TO_EDGE,sc[lo]=Ni.REPEAT,sc[bu]=Ni.MIRRORED_REPEAT;const _re={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},R5e=new fe,Mre=12,L5e=1179937895,B5e=2,Ire=8,k5e=1313821514,G5e=5130562;function YS(n,e){return n.length===e.length&&n.every(function(i,s){return i===e[s]})}function P5e(n){return new TextEncoder().encode(n).buffer}function N5e(n){return YS(n.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function V5e(n,e,i){const s={min:new Array(n.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(n.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let r=e;r<e+i;r++)for(let o=0;o<n.itemSize;o++){let a;n.itemSize>4?a=n.array[r*n.itemSize+o]:(o===0?a=n.getX(r):o===1?a=n.getY(r):o===2?a=n.getZ(r):o===3&&(a=n.getW(r)),n.normalized===!0&&(a=Di.normalize(a,n.array))),s.min[o]=Math.min(s.min[o],a),s.max[o]=Math.max(s.max[o],a)}return s}function Tre(n){return Math.ceil(n/4)*4}function G3(n,e=0){const i=Tre(n.byteLength);if(i!==n.byteLength){const s=new Uint8Array(i);if(s.set(new Uint8Array(n)),e!==0)for(let r=n.byteLength;r<i;r++)s[r]=e;return s.buffer}return n}function Ere(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function Rre(n,e){if(n.toBlob!==void 0)return new Promise(s=>n.toBlob(s,e));let i;return e==="image/jpeg"?i=.92:e==="image/webp"&&(i=.8),n.convertToBlob({type:e,quality:i})}class X5e{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+fa}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,i,s={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const r=this,o=r.buffers,a=r.json;s=r.options;const l=r.extensionsUsed,c=r.extensionsRequired,h=new Blob(o,{type:"application/octet-stream"}),d=Object.keys(l),u=Object.keys(c);if(d.length>0&&(a.extensionsUsed=d),u.length>0&&(a.extensionsRequired=u),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=h.size),s.binary===!0){const p=new FileReader;p.readAsArrayBuffer(h),p.onloadend=function(){const g=G3(p.result),f=new DataView(new ArrayBuffer(Ire));f.setUint32(0,g.byteLength,!0),f.setUint32(4,G5e,!0);const A=G3(P5e(JSON.stringify(a)),32),y=new DataView(new ArrayBuffer(Ire));y.setUint32(0,A.byteLength,!0),y.setUint32(4,k5e,!0);const b=new ArrayBuffer(Mre),v=new DataView(b);v.setUint32(0,L5e,!0),v.setUint32(4,B5e,!0);const x=Mre+y.byteLength+A.byteLength+f.byteLength+g.byteLength;v.setUint32(8,x,!0);const w=new Blob([b,y,A,f,g],{type:"application/octet-stream"}),C=new FileReader;C.readAsArrayBuffer(w),C.onloadend=function(){i(C.result)}}}else if(a.buffers&&a.buffers.length>0){const p=new FileReader;p.readAsDataURL(h),p.onloadend=function(){const g=p.result;a.buffers[0].uri=g,i(a)}}else i(a)}serializeUserData(e,i){if(Object.keys(e.userData).length===0)return;const s=this.options,r=this.extensionsUsed;try{const o=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&o.gltfExtensions){i.extensions===void 0&&(i.extensions={});for(const a in o.gltfExtensions)i.extensions[a]=o.gltfExtensions[a],r[a]=!0;delete o.gltfExtensions}Object.keys(o).length>0&&(i.extras=o)}catch(o){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+o.message)}}getUID(e,i=!1){if(this.uids.has(e)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(e,s)}return this.uids.get(e).get(i)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new E;for(let s=0,r=e.count;s<r;s++)if(Math.abs(i.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const i=this.cache;if(i.attributesNormalized.has(e))return i.attributesNormalized.get(e);const s=e.clone(),r=new E;for(let o=0,a=s.count;o<a;o++)r.fromBufferAttribute(s,o),r.x===0&&r.y===0&&r.z===0?r.setX(1):r.normalize(),s.setXYZ(o,r.x,r.y,r.z);return i.attributesNormalized.set(e,s),s}applyTextureTransform(e,i){let s=!1;const r={};(i.offset.x!==0||i.offset.y!==0)&&(r.offset=i.offset.toArray(),s=!0),i.rotation!==0&&(r.rotation=i.rotation,s=!0),(i.repeat.x!==1||i.repeat.y!==1)&&(r.scale=i.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,i){if(e===i)return e;function s(p){return p.colorSpace===ut?function(g){return g<.04045?g*.0773993808:Math.pow(g*.9478672986+.0521327014,2.4)}:function(g){return g}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof od&&(e=B3(e)),i instanceof od&&(i=B3(i));const r=e?e.image:null,o=i?i.image:null,a=Math.max(r?r.width:0,o?o.width:0),l=Math.max(r?r.height:0,o?o.height:0),c=Ere();c.width=a,c.height=l;const h=c.getContext("2d",{willReadFrequently:!0});h.fillStyle="#00ffff",h.fillRect(0,0,a,l);const d=h.getImageData(0,0,a,l);if(r){h.drawImage(r,0,0,a,l);const p=s(e),g=h.getImageData(0,0,a,l).data;for(let f=2;f<g.length;f+=4)d.data[f]=p(g[f]/256)*256}if(o){h.drawImage(o,0,0,a,l);const p=s(i),g=h.getImageData(0,0,a,l).data;for(let f=1;f<g.length;f+=4)d.data[f]=p(g[f]/256)*256}h.putImageData(d,0,0);const u=(e||i).clone();return u.source=new wu(c),u.colorSpace=ho,u.channel=(e||i).channel,e&&i&&e.channel!==i.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),u}processBuffer(e){const i=this.json,s=this.buffers;return i.buffers||(i.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,i,s,r,o){const a=this.json;a.bufferViews||(a.bufferViews=[]);let l;switch(i){case Ni.BYTE:case Ni.UNSIGNED_BYTE:l=1;break;case Ni.SHORT:case Ni.UNSIGNED_SHORT:l=2;break;default:l=4}let c=e.itemSize*l;o===Ni.ARRAY_BUFFER&&(c=Math.ceil(c/4)*4);const h=Tre(r*c),d=new DataView(new ArrayBuffer(h));let u=0;for(let g=s;g<s+r;g++){for(let f=0;f<e.itemSize;f++){let A;e.itemSize>4?A=e.array[g*e.itemSize+f]:(f===0?A=e.getX(g):f===1?A=e.getY(g):f===2?A=e.getZ(g):f===3&&(A=e.getW(g)),e.normalized===!0&&(A=Di.normalize(A,e.array))),i===Ni.FLOAT?d.setFloat32(u,A,!0):i===Ni.INT?d.setInt32(u,A,!0):i===Ni.UNSIGNED_INT?d.setUint32(u,A,!0):i===Ni.SHORT?d.setInt16(u,A,!0):i===Ni.UNSIGNED_SHORT?d.setUint16(u,A,!0):i===Ni.BYTE?d.setInt8(u,A):i===Ni.UNSIGNED_BYTE&&d.setUint8(u,A),u+=l}u%c!==0&&(u+=c-u%c)}const p={buffer:this.processBuffer(d.buffer),byteOffset:this.byteOffset,byteLength:h};return o!==void 0&&(p.target=o),o===Ni.ARRAY_BUFFER&&(p.byteStride=c),this.byteOffset+=h,a.bufferViews.push(p),{id:a.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const i=this,s=i.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(r){const o=new FileReader;o.readAsArrayBuffer(e),o.onloadend=function(){const a=G3(o.result),l={buffer:i.processBuffer(a),byteOffset:i.byteOffset,byteLength:a.byteLength};i.byteOffset+=a.byteLength,r(s.bufferViews.push(l)-1)}})}processAccessor(e,i,s,r){const o=this.json,a={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let l;if(e.array.constructor===Float32Array)l=Ni.FLOAT;else if(e.array.constructor===Int32Array)l=Ni.INT;else if(e.array.constructor===Uint32Array)l=Ni.UNSIGNED_INT;else if(e.array.constructor===Int16Array)l=Ni.SHORT;else if(e.array.constructor===Uint16Array)l=Ni.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)l=Ni.BYTE;else if(e.array.constructor===Uint8Array)l=Ni.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(s===void 0&&(s=0),(r===void 0||r===1/0)&&(r=e.count),r===0)return null;const c=V5e(e,s,r);let h;i!==void 0&&(h=e===i.index?Ni.ELEMENT_ARRAY_BUFFER:Ni.ARRAY_BUFFER);const d=this.processBufferView(e,l,s,r,h),u={bufferView:d.id,byteOffset:d.byteOffset,componentType:l,count:r,max:c.max,min:c.min,type:a[e.itemSize]};return e.normalized===!0&&(u.normalized=!0),o.accessors||(o.accessors=[]),o.accessors.push(u)-1}processImage(e,i,s,r="image/png"){if(e!==null){const o=this,a=o.cache,l=o.json,c=o.options,h=o.pending;a.images.has(e)||a.images.set(e,{});const d=a.images.get(e),u=r+":flipY/"+s.toString();if(d[u]!==void 0)return d[u];l.images||(l.images=[]);const p={mimeType:r},g=Ere();g.width=Math.min(e.width,c.maxTextureSize),g.height=Math.min(e.height,c.maxTextureSize);const f=g.getContext("2d",{willReadFrequently:!0});if(s===!0&&(f.translate(0,g.height),f.scale(1,-1)),e.data!==void 0){i!==_i&&console.error("GLTFExporter: Only RGBAFormat is supported.",i),(e.width>c.maxTextureSize||e.height>c.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const y=new Uint8ClampedArray(e.height*e.width*4);for(let b=0;b<y.length;b+=4)y[b+0]=e.data[b+0],y[b+1]=e.data[b+1],y[b+2]=e.data[b+2],y[b+3]=e.data[b+3];f.putImageData(new ImageData(y,e.width,e.height),0,0)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)f.drawImage(e,0,0,g.width,g.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");c.binary===!0?h.push(Rre(g,r).then(y=>o.processBufferViewImage(y)).then(y=>{p.bufferView=y})):g.toDataURL!==void 0?p.uri=g.toDataURL(r):h.push(Rre(g,r).then(y=>new FileReader().readAsDataURL(y)).then(y=>{p.uri=y}));const A=l.images.push(p)-1;return d[u]=A,A}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const i=this.json;i.samplers||(i.samplers=[]);const s={magFilter:sc[e.magFilter],minFilter:sc[e.minFilter],wrapS:sc[e.wrapS],wrapT:sc[e.wrapT]};return i.samplers.push(s)-1}processTexture(e){const i=this.options,s=this.cache,r=this.json;if(s.textures.has(e))return s.textures.get(e);const o={keep:!0,newTexture:null};if(this._invokeAll(function(h){h.beforeWriteTexture&&h.beforeWriteTexture(e,o)}),o.keep===!1)return null;o.newTexture!=null&&(e=o.newTexture),r.textures||(r.textures=[]),e instanceof od&&(e=B3(e,i.maxTextureSize));let a=e.userData.mimeType;a==="image/webp"&&(a="image/png");const l={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,a)};e.name&&(l.name=e.name),this._invokeAll(function(h){h.writeTexture&&h.writeTexture(e,l)});const c=r.textures.push(l)-1;return s.textures.set(e,c),c}processMaterial(e){var i,s,r,o,a;const l=this.cache,c=this.json;if(l.materials.has(e))return l.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;c.materials||(c.materials=[]);const h={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const d=e.color.toArray().concat([e.opacity]);YS(d,[1,1,1,1])||(h.pbrMetallicRoughness.baseColorFactor=d),e.isMeshStandardMaterial?(h.pbrMetallicRoughness.metallicFactor=e.metalness,h.pbrMetallicRoughness.roughnessFactor=e.roughness):(h.pbrMetallicRoughness.metallicFactor=.5,h.pbrMetallicRoughness.roughnessFactor=.5);const u=(i=e.metalnessMap)!=null&&i.image?e.metalnessMap:void 0,p=(s=e.roughnessMap)!=null&&s.image?e.roughnessMap:void 0;if(u||p){const f=this.buildMetalRoughTexture(u,p),A={index:this.processTexture(f),channel:f.channel};this.applyTextureTransform(A,f),h.pbrMetallicRoughness.metallicRoughnessTexture=A}if(e.map){const f={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(f,e.map),h.pbrMetallicRoughness.baseColorTexture=f}if(e.emissive){const f=e.emissive;if(Math.max(f.r,f.g,f.b)>0&&(h.emissiveFactor=e.emissive.toArray()),(r=e.emissiveMap)!=null&&r.image){const A={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(A,e.emissiveMap),h.emissiveTexture=A}}if((o=e.normalMap)!=null&&o.image){const f={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(f.scale=e.normalScale.x),this.applyTextureTransform(f,e.normalMap),h.normalTexture=f}if((a=e.aoMap)!=null&&a.image){const f={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(f.strength=e.aoMapIntensity),this.applyTextureTransform(f,e.aoMap),h.occlusionTexture=f}e.transparent?h.alphaMode="BLEND":e.alphaTest>0&&(h.alphaMode="MASK",h.alphaCutoff=e.alphaTest),e.side===Qi&&(h.doubleSided=!0),e.name!==""&&(h.name=e.name),this.serializeUserData(e,h),this._invokeAll(function(f){f.writeMaterial&&f.writeMaterial(e,h)});const g=c.materials.push(h)-1;return l.materials.set(e,g),g}processMesh(e){const i={keep:!0};if(this._invokeAll(function(C){C.beforeWriteMesh&&C.beforeWriteMesh(e,i)}),i.keep!=!0)return null;const s=this.cache,r=this.json,o=[e.geometry.uuid];if(Array.isArray(e.material))for(let C=0,S=e.material.length;C<S;C++)o.push(e.material[C].uuid);else o.push(e.material.uuid);const a=o.join(":");if(s.meshes.has(a))return s.meshes.get(a);const l=e.geometry;let c;e.isLineSegments?c=Ni.LINES:e.isLineLoop?c=Ni.LINE_LOOP:e.isLine?c=Ni.LINE_STRIP:e.isPoints?c=Ni.POINTS:c=e.material.wireframe?Ni.LINES:Ni.TRIANGLES;const h={},d={},u=[],p=[],g={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},f=l.getAttribute("normal");f!==void 0&&!this.isNormalizedNormalAttribute(f)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),l.setAttribute("normal",this.createNormalizedNormalAttribute(f)));let A=null;for(let C in l.attributes){if(C.slice(0,5)==="morph")continue;const S=l.attributes[C];if(C=g[C]||C.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(C)||(C="_"+C),s.attributes.has(this.getUID(S))){d[C]=s.attributes.get(this.getUID(S));continue}A=null;const _=S.array;C==="JOINTS_0"&&!(_ instanceof Uint16Array)&&!(_ instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),A=new ct(new Uint16Array(_),S.itemSize,S.normalized));const I=this.processAccessor(A||S,l);I!==null&&(C.startsWith("_")||this.detectMeshQuantization(C,S),d[C]=I,s.attributes.set(this.getUID(S),I))}if(f!==void 0&&l.setAttribute("normal",f),Object.keys(d).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const C=[],S=[],_={};if(e.morphTargetDictionary!==void 0)for(const I in e.morphTargetDictionary)_[e.morphTargetDictionary[I]]=I;for(let I=0;I<e.morphTargetInfluences.length;++I){const B={};let M=!1;for(const R in l.morphAttributes){if(R!=="position"&&R!=="normal"){M||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),M=!0);continue}const k=l.morphAttributes[R][I],G=R.toUpperCase(),X=l.attributes[R];if(s.attributes.has(this.getUID(k,!0))){B[G]=s.attributes.get(this.getUID(k,!0));continue}const F=k.clone();if(!l.morphTargetsRelative)for(let z=0,H=k.count;z<H;z++)for(let Z=0;Z<k.itemSize;Z++)Z===0&&F.setX(z,k.getX(z)-X.getX(z)),Z===1&&F.setY(z,k.getY(z)-X.getY(z)),Z===2&&F.setZ(z,k.getZ(z)-X.getZ(z)),Z===3&&F.setW(z,k.getW(z)-X.getW(z));B[G]=this.processAccessor(F,l),s.attributes.set(this.getUID(X,!0),B[G])}p.push(B),C.push(e.morphTargetInfluences[I]),e.morphTargetDictionary!==void 0&&S.push(_[I])}h.weights=C,S.length>0&&(h.extras={},h.extras.targetNames=S)}const y=Array.isArray(e.material);if(y&&l.groups.length===0)return null;let b=!1;if(y&&l.index===null){const C=[];for(let S=0,_=l.attributes.position.count;S<_;S++)C[S]=S;l.setIndex(C),b=!0}const v=y?e.material:[e.material],x=y?l.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let C=0,S=x.length;C<S;C++){const _={mode:c,attributes:d};if(this.serializeUserData(l,_),p.length>0&&(_.targets=p),l.index!==null){let B=this.getUID(l.index);(x[C].start!==void 0||x[C].count!==void 0)&&(B+=":"+x[C].start+":"+x[C].count),s.attributes.has(B)?_.indices=s.attributes.get(B):(_.indices=this.processAccessor(l.index,l,x[C].start,x[C].count),s.attributes.set(B,_.indices)),_.indices===null&&delete _.indices}const I=this.processMaterial(v[x[C].materialIndex]);I!==null&&(_.material=I),u.push(_)}b===!0&&l.setIndex(null),h.primitives=u,r.meshes||(r.meshes=[]),this._invokeAll(function(C){C.writeMesh&&C.writeMesh(e,h)});const w=r.meshes.push(h)-1;return s.meshes.set(a,w),w}detectMeshQuantization(e,i){if(this.extensionsUsed[k3])return;let s;switch(i.array.constructor){case Int8Array:s="byte";break;case Uint8Array:s="unsigned byte";break;case Int16Array:s="short";break;case Uint16Array:s="unsigned short";break;default:return}i.normalized&&(s+=" normalized");const r=e.split("_",1)[0];Sre[r]&&Sre[r].includes(s)&&(this.extensionsUsed[k3]=!0,this.extensionsRequired[k3]=!0)}processCamera(e){const i=this.json;i.cameras||(i.cameras=[]);const s=e.isOrthographicCamera,r={type:s?"orthographic":"perspective"};return s?r.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:Di.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(r.name=e.type),i.cameras.push(r)-1}processAnimation(e,i){const s=this.json,r=this.nodeMap;s.animations||(s.animations=[]),e=CB.Utils.mergeMorphTargetTracks(e.clone(),i);const o=e.tracks,a=[],l=[];for(let c=0;c<o.length;++c){const h=o[c],d=xi.parseTrackName(h.name);let u=xi.findNode(i,d.nodeName);const p=_re[d.propertyName];if(d.objectName==="bones"&&(u.isSkinnedMesh===!0?u=u.skeleton.getBoneByName(d.objectIndex):u=void 0),!u||!p){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',h.name);continue}const g=1;let f=h.values.length/h.times.length;p===_re.morphTargetInfluences&&(f/=u.morphTargetInfluences.length);let A;h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(A="CUBICSPLINE",f/=3):h.getInterpolation()===qp?A="STEP":A="LINEAR",l.push({input:this.processAccessor(new ct(h.times,g)),output:this.processAccessor(new ct(h.values,f)),interpolation:A}),a.push({sampler:l.length-1,target:{node:r.get(u),path:p}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:l,channels:a}),s.animations.length-1}processSkin(e){const i=this.json,s=this.nodeMap,r=i.nodes[s.get(e)],o=e.skeleton;if(o===void 0)return null;const a=e.skeleton.bones[0];if(a===void 0)return null;const l=[],c=new Float32Array(o.bones.length*16),h=new de;for(let d=0;d<o.bones.length;++d)l.push(s.get(o.bones[d])),h.copy(o.boneInverses[d]),h.multiply(e.bindMatrix).toArray(c,d*16);return i.skins===void 0&&(i.skins=[]),i.skins.push({inverseBindMatrices:this.processAccessor(new ct(c,16)),joints:l,skeleton:s.get(a)}),r.skin=i.skins.length-1}processNode(e){const i={keep:!0};if(this._invokeAll(function(c){c.beforeWriteNode&&c.beforeWriteNode(e,i)}),i.keep!=!0)return null;const s=this.json,r=this.options,o=this.nodeMap;s.nodes||(s.nodes=[]);const a={};if(r.trs){const c=e.quaternion.toArray(),h=e.position.toArray(),d=e.scale.toArray();YS(c,[0,0,0,1])||(a.rotation=c),YS(h,[0,0,0])||(a.translation=h),YS(d,[1,1,1])||(a.scale=d)}else e.matrixAutoUpdate&&e.updateMatrix(),N5e(e.matrix)===!1&&(a.matrix=e.matrix.elements);if(e.name!==""&&(a.name=String(e.name)),this.serializeUserData(e,a),e.isMesh||e.isLine||e.isPoints){const c=this.processMesh(e);c!==null&&(a.mesh=c)}else e.isCamera&&(a.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const c=[];for(let h=0,d=e.children.length;h<d;h++){const u=e.children[h];if(u.visible||r.onlyVisible===!1){const p=this.processNode(u);p!==null&&c.push(p)}}c.length>0&&(a.children=c)}this._invokeAll(function(c){c.writeNode&&c.writeNode(e,a)});const l=s.nodes.push(a)-1;return o.set(e,l),l}processScene(e){const i=this.json,s=this.options;i.scenes||(i.scenes=[],i.scene=0);const r={};e.name!==""&&(r.name=e.name),i.scenes.push(r);const o=[];for(let a=0,l=e.children.length;a<l;a++){const c=e.children[a];if(c.visible||s.onlyVisible===!1){const h=this.processNode(c);h!==null&&o.push(h)}}o.length>0&&(r.nodes=o),this.serializeUserData(e,r)}processObjects(e){const i=new ir;i.name="AuxScene";for(let s=0;s<e.length;s++)i.children.push(e[s]);this.processScene(i)}processInput(e){const i=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(r){r.beforeParse&&r.beforeParse(e)});const s=[];for(let r=0;r<e.length;r++)e[r]instanceof ir?this.processScene(e[r]):s.push(e[r]);s.length>0&&this.processObjects(s);for(let r=0;r<this.skins.length;++r)this.processSkin(this.skins[r]);for(let r=0;r<i.animations.length;++r)this.processAnimation(i.animations[r],e[0]);this._invokeAll(function(r){r.afterParse&&r.afterParse(e)})}_invokeAll(e){for(let i=0,s=this.plugins.length;i<s;i++)e(this.plugins[i])}}class D5e{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,i){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const s=this.writer,r=s.json,o=s.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(1-e.penumbra)*e.angle,a.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),o[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},o[this.name]=!0);const l=r.extensions[this.name].lights;l.push(a),i.extensions=i.extensions||{},i.extensions[this.name]={light:l.length-1}}}class z5e{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,i){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;i.extensions=i.extensions||{},i.extensions[this.name]={},s[this.name]=!0,i.pbrMetallicRoughness.metallicFactor=0,i.pbrMetallicRoughness.roughnessFactor=.9}}class F5e{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const s=this.writer,r=s.extensionsUsed,o={};if(o.clearcoatFactor=e.clearcoat,e.clearcoatMap){const a={index:s.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};s.applyTextureTransform(a,e.clearcoatMap),o.clearcoatTexture=a}if(o.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const a={index:s.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};s.applyTextureTransform(a,e.clearcoatRoughnessMap),o.clearcoatRoughnessTexture=a}if(e.clearcoatNormalMap){const a={index:s.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};e.clearcoatNormalScale.x!==1&&(a.scale=e.clearcoatNormalScale.x),s.applyTextureTransform(a,e.clearcoatNormalMap),o.clearcoatNormalTexture=a}i.extensions=i.extensions||{},i.extensions[this.name]=o,r[this.name]=!0}}class U5e{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.dispersion===0)return;const s=this.writer.extensionsUsed,r={};r.dispersion=e.dispersion,i.extensions=i.extensions||{},i.extensions[this.name]=r,s[this.name]=!0}}class O5e{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const s=this.writer,r=s.extensionsUsed,o={};if(o.iridescenceFactor=e.iridescence,e.iridescenceMap){const a={index:s.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};s.applyTextureTransform(a,e.iridescenceMap),o.iridescenceTexture=a}if(o.iridescenceIor=e.iridescenceIOR,o.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],o.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const a={index:s.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};s.applyTextureTransform(a,e.iridescenceThicknessMap),o.iridescenceThicknessTexture=a}i.extensions=i.extensions||{},i.extensions[this.name]=o,r[this.name]=!0}}class Z5e{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,r=s.extensionsUsed,o={};if(o.transmissionFactor=e.transmission,e.transmissionMap){const a={index:s.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};s.applyTextureTransform(a,e.transmissionMap),o.transmissionTexture=a}i.extensions=i.extensions||{},i.extensions[this.name]=o,r[this.name]=!0}}class W5e{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,r=s.extensionsUsed,o={};if(o.thicknessFactor=e.thickness,e.thicknessMap){const a={index:s.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};s.applyTextureTransform(a,e.thicknessMap),o.thicknessTexture=a}e.attenuationDistance!==1/0&&(o.attenuationDistance=e.attenuationDistance),o.attenuationColor=e.attenuationColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=o,r[this.name]=!0}}class H5e{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const s=this.writer.extensionsUsed,r={};r.ior=e.ior,i.extensions=i.extensions||{},i.extensions[this.name]=r,s[this.name]=!0}}class Q5e{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(R5e)&&!e.specularIntensityMap&&!e.specularColorMap)return;const s=this.writer,r=s.extensionsUsed,o={};if(e.specularIntensityMap){const a={index:s.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};s.applyTextureTransform(a,e.specularIntensityMap),o.specularTexture=a}if(e.specularColorMap){const a={index:s.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};s.applyTextureTransform(a,e.specularColorMap),o.specularColorTexture=a}o.specularFactor=e.specularIntensity,o.specularColorFactor=e.specularColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=o,r[this.name]=!0}}class K5e{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const s=this.writer,r=s.extensionsUsed,o={};if(e.sheenRoughnessMap){const a={index:s.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};s.applyTextureTransform(a,e.sheenRoughnessMap),o.sheenRoughnessTexture=a}if(e.sheenColorMap){const a={index:s.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};s.applyTextureTransform(a,e.sheenColorMap),o.sheenColorTexture=a}o.sheenRoughnessFactor=e.sheenRoughness,o.sheenColorFactor=e.sheenColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=o,r[this.name]=!0}}class Y5e{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const s=this.writer,r=s.extensionsUsed,o={};if(e.anisotropyMap){const a={index:s.processTexture(e.anisotropyMap)};s.applyTextureTransform(a,e.anisotropyMap),o.anisotropyTexture=a}o.anisotropyStrength=e.anisotropy,o.anisotropyRotation=e.anisotropyRotation,i.extensions=i.extensions||{},i.extensions[this.name]=o,r[this.name]=!0}}class j5e{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const s=this.writer.extensionsUsed,r={};r.emissiveStrength=e.emissiveIntensity,i.extensions=i.extensions||{},i.extensions[this.name]=r,s[this.name]=!0}}class J5e{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.bumpScale===1&&!e.bumpMap)return;const s=this.writer,r=s.extensionsUsed,o={};if(e.bumpMap){const a={index:s.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};s.applyTextureTransform(a,e.bumpMap),o.bumpTexture=a}o.bumpFactor=e.bumpScale,i.extensions=i.extensions||{},i.extensions[this.name]=o,r[this.name]=!0}}class q5e{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,i){if(!e.isInstancedMesh)return;const s=this.writer,r=e,o=new Float32Array(r.count*3),a=new Float32Array(r.count*4),l=new Float32Array(r.count*3),c=new de,h=new E,d=new Fe,u=new E;for(let g=0;g<r.count;g++)r.getMatrixAt(g,c),c.decompose(h,d,u),h.toArray(o,g*3),d.toArray(a,g*4),u.toArray(l,g*3);const p={TRANSLATION:s.processAccessor(new ct(o,3)),ROTATION:s.processAccessor(new ct(a,4)),SCALE:s.processAccessor(new ct(l,3))};r.instanceColor&&(p._COLOR_0=s.processAccessor(r.instanceColor)),i.extensions=i.extensions||{},i.extensions[this.name]={attributes:p},s.extensionsUsed[this.name]=!0,s.extensionsRequired[this.name]=!0}}CB.Utils={insertKeyframe:function(n,e){const i=n.getValueSize(),s=new n.TimeBufferType(n.times.length+1),r=new n.ValueBufferType(n.values.length+i),o=n.createInterpolant(new n.ValueBufferType(i));let a;if(n.times.length===0){s[0]=e;for(let l=0;l<i;l++)r[l]=0;a=0}else if(e<n.times[0]){if(Math.abs(n.times[0]-e)<.001)return 0;s[0]=e,s.set(n.times,1),r.set(o.evaluate(e),0),r.set(n.values,i),a=0}else if(e>n.times[n.times.length-1]){if(Math.abs(n.times[n.times.length-1]-e)<.001)return n.times.length-1;s[s.length-1]=e,s.set(n.times,0),r.set(n.values,0),r.set(o.evaluate(e),n.values.length),a=s.length-1}else for(let l=0;l<n.times.length;l++){if(Math.abs(n.times[l]-e)<.001)return l;if(n.times[l]<e&&n.times[l+1]>e){s.set(n.times.slice(0,l+1),0),s[l+1]=e,s.set(n.times.slice(l+1),l+2),r.set(n.values.slice(0,(l+1)*i),0),r.set(o.evaluate(e),(l+1)*i),r.set(n.values.slice((l+1)*i),(l+2)*i),a=l+1;break}}return n.times=s,n.values=r,a},mergeMorphTargetTracks:function(n,e){const i=[],s={},r=n.tracks;for(let o=0;o<r.length;++o){let a=r[o];const l=xi.parseTrackName(a.name),c=xi.findNode(e,l.nodeName);if(l.propertyName!=="morphTargetInfluences"||l.propertyIndex===void 0){i.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(xu)}const h=c.morphTargetInfluences.length,d=c.morphTargetDictionary[l.propertyIndex];if(d===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+l.propertyIndex);let u;if(s[c.uuid]===void 0){u=a.clone();const g=new u.ValueBufferType(h*u.times.length);for(let f=0;f<u.times.length;f++)g[f*h+d]=u.values[f];u.name=(l.nodeName||"")+".morphTargetInfluences",u.values=g,s[c.uuid]=u,i.push(u);continue}const p=a.createInterpolant(new a.ValueBufferType(1));u=s[c.uuid];for(let g=0;g<u.times.length;g++)u.values[g*h+d]=p.evaluate(u.times[g]);for(let g=0;g<a.times.length;g++){const f=this.insertKeyframe(u,a.times[g]);u.values[f*h+d]=a.values[g]}}return n.tracks=i,n}};class Lre{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,i){if(e.constructor.name!=="InstancedMesh")return;const s=this.writer,r=s.extensionsUsed,o={};i.extensions=i.extensions||{},i.extensions[this.name]=o;let a=new de;const l=new Array,c=new Array,h=new Array;for(let g=0;g<e.count;g++){e.getMatrixAt(g,a);let f=new E,A=new Fe,y=new E;a.decompose(f,A,y),l.push(f.x,f.y,f.z),c.push(A.x,A.y,A.z,A.w),h.push(y.x,y.y,y.z)}const d=new Float32Array(l),u=new Float32Array(c),p=new Float32Array(h);o.attributes={TRANSLATION:s.processAccessor(new ct(d,3)),ROTATION:s.processAccessor(new ct(u,4)),SCALE:s.processAccessor(new ct(p,3))},r[this.name]=!0}}var $5e=Object.defineProperty,eze=Object.getOwnPropertyDescriptor,Bre=(n,e,i,s)=>{for(var r=s>1?void 0:s?eze(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&$5e(e,i,r),r};const SB=q("debuggltfexport");class P3 extends Oc{constructor(){super(...arguments),m(this,"sceneRoot")}}const Fv=class extends Oe{constructor(){super(...arguments),m(this,"binary",!0),m(this,"objects",[]),m(this,"ext")}async exportNow(n,e){SB&&console.log("Exporting objects as glTF",this.objects),n||(n="scene"),(!this.objects||this.objects.length<=0)&&(this.objects=[this.context.scene]);const i={binary:this.binary,pivot:Fv.calculateCenter(this.objects),...e},s=await this.export(this.objects,i).catch(r=>(console.error(r),!1));return s===!1?!1:(this.binary?n.endsWith(".glb")||(n+=".glb"):n.endsWith(".gltf")||(n+=".gltf"),this.binary?Fv.saveArrayBuffer(s,n):Fv.saveJson(s,n),!0)}async export(n,e){if(!n||n.length<=0){console.warn("No objects set to export");return}const i=new CB;i.register(l=>new Lre(l)),t3(i,this.context),Fv.filterTopmostParent(n);const s={trs:!1,onlyVisible:!0,truncateDrawRange:!1,binary:!0,maxTextureSize:1/0,embedImages:!0,includeCustomExtensions:!0,animations:e?.animations||Fv.collectAnimations(n),...e},r=new Ae;e!=null&&e.pivot&&r.position.sub(e.pivot),SB&&console.log("EXPORT",n),n.forEach(l=>{l&&(r.children.push(l),l.matrixAutoUpdate=!1,l.matrix.copy(l.matrixWorld),$.getComponentsInChildren(l,Gs).forEach(c=>{$.isActiveInHierarchy(c.gameObject)&&c.setInstancingEnabled(!1)}))});const o=new qz(r);return e!=null&&e.needleComponents&&(this.ext=new Zse),this.ext&&(this.ext.registerExport(i),this.ext.context=o),new Promise((l,c)=>{SB&&console.log("Starting glTF export.");try{i?.parse(r,h=>{a(),l(h)},h=>{a(),c(h)},s)}catch(h){console.error(h),c(h)}finally{SB&&console.log("Finished glTF export.")}});function a(){n.forEach(l=>{l&&(l.matrixAutoUpdate=!0,$.getComponentsInChildren(l,Gs).forEach(c=>{$.isActiveInHierarchy(c.gameObject)&&c.setInstancingEnabled(!1)}))})}}static saveArrayBuffer(n,e){this.save(new Blob([n],{type:"application/octet-stream"}),e)}static saveJson(n,e){this.save("data: text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(n)),e)}static save(n,e){const i=document.createElement("a");i.style.display="none",document.body.appendChild(i),typeof n=="string"?i.href=n:i.href=URL.createObjectURL(n),i.download=e,i.click(),i.remove()}static collectAnimations(n,e){e=e||[];for(const i of n)i&&i.traverseVisible(s=>{s.animations&&s.animations.length>0&&e.push(...s.animations)});return e}static calculateCenter(n,e){const i=e||new E;return i.set(0,0,0),n.forEach(s=>{i.add(ri(s))}),i.divideScalar(n.length),i}static filterTopmostParent(n){if(!(n.length<=0))for(let e=0;e<n.length;e++){let i=n[e];if(!i){n.splice(e,1),e--;continue}for(;i.parent;){if(n.includes(i.parent)){n.splice(e,1),e--;break}i=i.parent}}}};let jS=Fv;Bre([T()],jS.prototype,"binary",2),Bre([T(Ae)],jS.prototype,"objects",2);var tze=Object.defineProperty,ize=Object.getOwnPropertyDescriptor,N3=(n,e,i,s)=>{for(var r=s>1?void 0:s?ize(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&tze(e,i,r),r};class Uv extends Oe{constructor(){super(...arguments),m(this,"isGizmo",!1),m(this,"color0"),m(this,"color1"),m(this,"gridHelper"),m(this,"size"),m(this,"divisions"),m(this,"offset")}onEnable(){if(this.isGizmo&&!_C)return;const e=this.size,i=this.divisions;this.gridHelper||(this.gridHelper=new ST(e,i,this.color0??new fe(.4,.4,.4),this.color1??new fe(.6,.6,.6)),this.offset!==void 0&&(this.gridHelper.position.y+=this.offset)),this.gridHelper&&this.gameObject.add(this.gridHelper)}onDisable(){this.gridHelper&&(this.gameObject.remove(this.gridHelper),this.gridHelper=null)}}N3([T()],Uv.prototype,"isGizmo",2),N3([T(fe)],Uv.prototype,"color0",2),N3([T(fe)],Uv.prototype,"color1",2);var nze=Object.defineProperty,sze=Object.getOwnPropertyDescriptor,_B=(n,e,i,s)=>{for(var r=s>1?void 0:s?sze(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&nze(e,i,r),r};const Pg=q("debuginputfield");var Ov;const Ut=(Ov=class extends Oe{constructor(){super(...arguments),m(this,"textComponent"),m(this,"placeholder"),m(this,"onValueChanged"),m(this,"onEndEdit"),m(this,"inputEventFn"),m(this,"_iosEventFn")}get text(){var n;return((n=this.textComponent)==null?void 0:n.text)??""}get isFocused(){return Ut.active===this}start(){Pg&&console.log(this.name,this)}onEnable(){var n;Ut.htmlField||(Ut.htmlField=document.createElement("input"),Ut.htmlField.style.width="0px",Ut.htmlField.style.height="0px",Ut.htmlField.style.padding="0px",Ut.htmlField.style.border="none",Ut.htmlField.style.overflow="hidden",Ut.htmlField.style.caretColor="transparent",Ut.htmlField.style.outline="none",Ut.htmlField.classList.add("ar"),Ut.htmlField.onfocus=()=>Ut.htmlFieldFocused=!0,Ut.htmlField.onblur=()=>Ut.htmlFieldFocused=!1,document.body.append(Ut.htmlField)),this.inputEventFn||(this.inputEventFn=this.onInput.bind(this)),Ut.htmlField.addEventListener("keyup",this.inputEventFn),this.placeholder&&(n=this.textComponent)!=null&&n.text.length&&$.setActive(this.placeholder.gameObject,!1),Ft.isiOS()&&(this._iosEventFn=this.processInputOniOS.bind(this),window.addEventListener("click",this._iosEventFn))}onDisable(){var n;(n=Ut.htmlField)==null||n.removeEventListener("keyup",this.inputEventFn),this.onDeselected(),this._iosEventFn&&window.removeEventListener("click",this._iosEventFn)}clear(){Ut.active===this&&Ut.htmlField?(Ut.htmlField.value="",this.setTextFromInputField()):(this.textComponent&&(this.textComponent.text=""),this.placeholder&&$.setActive(this.placeholder.gameObject,!0))}select(){this.onSelected()}deselect(){this.onDeselected()}onPointerClick(n){Pg&&console.log("CLICK",n,Ut.active),Ut.activeTime=this.context.time.time,Ut.active!==this&&this.startCoroutine(this.activeLoop(),_n.LateUpdate),this.selectInputField()}*activeLoop(){for(this.onSelected();Ut.active===this&&!(this.context.input.getPointerClicked(0)&&this.context.time.time-Ut.activeTime>.2);)this.setTextFromInputField(),yield;this.onDeselected()}onSelected(){var n,e,i,s;if(Ut.active!==this&&(Pg&&console.log("Select",this.name,this,Ut.htmlField,this.context.isInXR,this.context.arOverlayElement,(n=this.textComponent)==null?void 0:n.text,(e=Ut.htmlField)==null?void 0:e.value),(i=Ut.active)==null||i.onDeselected(),Ut.active=this,this.placeholder&&$.setActive(this.placeholder.gameObject,!1),Ut.htmlField)){if(Ut.htmlField.value=((s=this.textComponent)==null?void 0:s.text)||"",Pg&&console.log("set input field value",Ut.htmlField.value),this.context.isInXR){const r=this.context.arOverlayElement;r&&r.append(Ut.htmlField)}this.selectInputField()}}onDeselected(){var n;Ut.active===this&&(Ut.active=null,Pg&&console.log("Deselect",this.name,this),Ut.htmlField&&(Ut.htmlField.blur(),document.body.append(Ut.htmlField)),this.placeholder&&(!this.textComponent||this.textComponent.text.length<=0)&&$.setActive(this.placeholder.gameObject,!0),Ut.htmlField&&((n=this.onEndEdit)==null||n.invoke(Ut.htmlField.value)))}update(){var n;Ut.active===this&&((n=this.textComponent)==null||n.markDirty())}onInput(n){var e,i;if(Ut.active===this){if(Pg&&console.log(n.code,n,(e=Ut.htmlField)==null?void 0:e.value,(i=this.textComponent)==null?void 0:i.text),n.code==="Escape"||n.code==="Enter"){this.onDeselected();return}Ut.htmlField&&(this.textComponent&&(this.setTextFromInputField(),this.placeholder&&$.setActive(this.placeholder.gameObject,this.textComponent.text.length<=0)),this.selectInputField())}}setTextFromInputField(){var n;if(this.textComponent&&Ut.htmlField){if(this.textComponent.text!==Ut.htmlField.value){Pg&&console.log("VALUE CHANGED");const e=this.textComponent.text,i=Ut.htmlField.value;(n=this.onValueChanged)==null||n.invoke(i,e)}this.textComponent.text=Ut.htmlField.value}}selectInputField(){Ut.htmlField&&(Pg&&console.log("Focus Inputfield",Ut.htmlFieldFocused),Ut.htmlField.setSelectionRange(Ut.htmlField.value.length,Ut.htmlField.value.length),Ft.isiOS()?Ut.htmlField.focus({preventScroll:!0}):setTimeout(()=>{var n;return(n=Ut.htmlField)==null?void 0:n.focus()},1))}processInputOniOS(){const n=this.context.physics.raycast();if(!n.length)return;const e=n[0].object,i=dU(e);(i?.gameObject===this.gameObject||i?.gameObject.parent===this.gameObject)&&this.selectInputField()}},m(Ov,"active",null),m(Ov,"activeTime",-1),m(Ov,"htmlField",null),m(Ov,"htmlFieldFocused",!1),Ov);let cA=Ut;_B([T(la)],cA.prototype,"textComponent",2),_B([T(la)],cA.prototype,"placeholder",2),_B([T(Gn)],cA.prototype,"onValueChanged",2),_B([T(Gn)],cA.prototype,"onEndEdit",2);var rze=Object.defineProperty,oze=Object.getOwnPropertyDescriptor,ru=(n,e,i,s)=>{for(var r=s>1?void 0:s?oze(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&rze(e,i,r),r};function V3(n){return n*Math.PI/180}const kre=300,Ng=q("debuglights");class ul extends Oe{constructor(){super(...arguments),m(this,"type",0),m(this,"range",1),m(this,"spotAngle",1),m(this,"innerSpotAngle",1),m(this,"_color",new fe(16777215)),m(this,"_shadowNearPlane",.1),m(this,"_shadowBias",0),m(this,"_shadowNormalBias",0),m(this,"_overrideShadowBiasSettings",!1),m(this,"_shadows",1),m(this,"lightmapBakeType",4),m(this,"_intensity",-1),m(this,"_shadowDistance"),m(this,"shadowWidth"),m(this,"shadowHeight"),m(this,"_shadowResolution"),m(this,"light"),m(this,"_webXRStartedListener"),m(this,"_webXREndedListener"),m(this,"_webARRoot")}set color(e){this._color=e,this.light!==void 0&&(this.light.color=e)}get color(){return this.light?this.light.color:this._color}set shadowNearPlane(e){var i,s;if(e!==this._shadowNearPlane&&(this._shadowNearPlane=e,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.camera)!==void 0)){const r=this.light.shadow.camera;r.near=e}}get shadowNearPlane(){return this._shadowNearPlane}set shadowBias(e){var i,s;e!==this._shadowBias&&(this._shadowBias=e,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.bias)!==void 0&&(this.light.shadow.bias=e,this.light.shadow.needsUpdate=!0))}get shadowBias(){return this._shadowBias}set shadowNormalBias(e){var i,s;e!==this._shadowNormalBias&&(this._shadowNormalBias=e,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.normalBias)!==void 0&&(this.light.shadow.normalBias=e,this.light.shadow.needsUpdate=!0))}get shadowNormalBias(){return this._shadowNormalBias}set shadows(e){this._shadows=e,this.light&&(this.light.castShadow=e!==0,this.updateShadowSoftHard())}get shadows(){return this._shadows}set intensity(e){var i;if(this._intensity=e,this.light){let s=1;if(this.context.isInXR&&this._webARRoot){const r=(i=this._webARRoot)==null?void 0:i.arScale;typeof r=="number"&&r>0&&(s/=r)}this.light.intensity=e*s}Ng&&console.log("Set light intensity to "+this._intensity,e,this)}get intensity(){return this._intensity}get shadowDistance(){const e=this.light;return e!=null&&e.shadow?e.shadow.camera.far:-1}set shadowDistance(e){this._shadowDistance=e;const i=this.light;if(i!=null&&i.shadow){const s=i.shadow.camera;s.far=e,s.updateProjectionMatrix()}}get shadowResolution(){const e=this.light;return e!=null&&e.shadow?e.shadow.mapSize.x:-1}set shadowResolution(e){if(e===this._shadowResolution)return;this._shadowResolution=e;const i=this.light;i!=null&&i.shadow&&(i.shadow.mapSize.set(e,e),i.shadow.needsUpdate=!0)}get isBaked(){return this.lightmapBakeType===2}get selfIsLight(){if(this.gameObject.isLight===!0)return!0;switch(this.gameObject.type){case"SpotLight":case"PointLight":case"DirectionalLight":return!0}return!1}getWorldPosition(e){return this.light?this.type===1?this.light.getWorldPosition(e).multiplyScalar(1):this.light.getWorldPosition(e):e}awake(){this.color=new fe(this.color??16777215),Ng&&console.log(this.name,this)}onEnable(){Ng&&console.log("ENABLE LIGHT",this.name),this.createLight(),!this.isBaked&&(this.light&&(this.light.visible=!0,this.light.intensity=this._intensity,Ng&&console.log("Set light intensity to "+this.light.intensity,this.name),this.selfIsLight||this.light.parent!==this.gameObject&&this.gameObject.add(this.light)),this.type===1&&this.startCoroutine(this.updateMainLightRoutine(),_n.LateUpdate))}onDisable(){Ng&&console.log("DISABLE LIGHT",this.name),this.light&&(this.selfIsLight?this.light.intensity=0:this.light.visible=!1)}onEnterXR(e){this._webARRoot=$.getComponentInParent(this.gameObject,Mp)??void 0}onLeaveXR(e){}createLight(){const e=this.selfIsLight;if(e&&!this.light)switch(this.light=this.gameObject,this.light.name=this.name,this._intensity=this.light.intensity,this.type){case 1:this.setDirectionalLight(this.light);break}else if(!this.light)switch(this.type){case 1:const i=new um(this.color,this.intensity*Math.PI);if(i.position.set(0,0,-kre*.5).applyQuaternion(this.gameObject.quaternion),this.gameObject.add(i.target),o0(i.target,0,0,0),this.light=i,this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),Ng){const a=new jH(this.light,.2,this.color);this.context.scene.add(a)}break;case 0:const s=new Gf(this.color,this.intensity*Math.PI,this.range,V3(this.spotAngle/2),1-V3(this.innerSpotAngle/2)/V3(this.spotAngle/2),2);s.position.set(0,0,0),s.rotation.set(0,0,0),this.light=s;const r=s.target;s.add(r),r.position.set(0,0,this.range),r.rotation.set(0,0,0);break;case 2:const o=new dm(this.color,this.intensity*Math.PI,this.range);this.light=o;break}if(this.light){if(this._intensity>=0?this.light.intensity=this._intensity:this._intensity=this.light.intensity,this.shadows!==0?this.light.castShadow=!0:this.light.castShadow=!1,this.light.shadow){this._shadowResolution!==void 0&&this._shadowResolution>4?(this.light.shadow.mapSize.width=this._shadowResolution,this.light.shadow.mapSize.height=this._shadowResolution):(this.light.shadow.mapSize.width=2048,this.light.shadow.mapSize.height=2048),Ng&&console.log("Override shadow bias?",this._overrideShadowBiasSettings,this.shadowBias,this.shadowNormalBias),this.light.shadow.bias=this.shadowBias,this.light.shadow.normalBias=this.shadowNormalBias,this.updateShadowSoftHard();const i=this.light.shadow.camera;if(i.near=this.shadowNearPlane,this._shadowDistance!==void 0&&typeof this._shadowDistance=="number"?i.far=this._shadowDistance:i.far=kre*Math.abs(this.gameObject.scale.z),this.gameObject.scale.set(1,1,1),this.shadowWidth!==void 0)i.left=-this.shadowWidth/2,i.right=this.shadowWidth/2;else{const s=this.gameObject.scale.x;i.left*=s,i.right*=s}if(this.shadowHeight!==void 0)i.top=this.shadowHeight/2,i.bottom=-this.shadowHeight/2;else{const s=this.gameObject.scale.y;i.top*=s,i.bottom*=s}this.light.shadow.needsUpdate=!0,Ng&&this.context.scene.add(new JH(i))}this.isBaked?this.light.removeFromParent():e||this.gameObject.add(this.light)}}*updateMainLightRoutine(){for(;;){this.type===1&&((!this.context.mainLight||this.intensity>this.context.mainLight.intensity)&&(this.context.mainLight=this),yield);break}}updateShadowSoftHard(){this.light&&this.light.shadow&&(this.shadows===2||(this.light.shadow.radius=1,this.light.shadow.blurSamples=1))}setDirectionalLight(e){e.add(e.target),e.target.position.set(0,0,-1)}}m(ul,"allowChangingRendererShadowMapType",!0),ru([T()],ul.prototype,"type",2),ru([T(fe)],ul.prototype,"color",1),ru([T()],ul.prototype,"shadowNearPlane",1),ru([T()],ul.prototype,"shadowBias",1),ru([T()],ul.prototype,"shadowNormalBias",1),ru([T()],ul.prototype,"shadows",1),ru([T()],ul.prototype,"lightmapBakeType",2),ru([T()],ul.prototype,"intensity",1),ru([T()],ul.prototype,"shadowDistance",1),ru([T()],ul.prototype,"shadowResolution",1),new E(0,0,0);var aze=Object.defineProperty,lze=Object.getOwnPropertyDescriptor,JS=(n,e,i,s)=>{for(var r=s>1?void 0:s?lze(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&aze(e,i,r),r};const X3=q("debuglods"),cze=q("nolods");class hA{constructor(){m(this,"screenRelativeTransitionHeight"),m(this,"distance"),m(this,"renderers")}}JS([T()],hA.prototype,"screenRelativeTransitionHeight",2),JS([T()],hA.prototype,"distance",2),JS([T(Gs)],hA.prototype,"renderers",2);class hze{constructor(e){m(this,"model"),this.model=e}get renderers(){return this.model.renderers}}class qS extends Oe{constructor(){super(...arguments),m(this,"fadeMode",0),m(this,"localReferencePoint"),m(this,"lodCount",0),m(this,"size",0),m(this,"animateCrossFading",!1),m(this,"lodModels"),m(this,"_lods",[]),m(this,"_settings",[]),m(this,"_lodsHandler"),m(this,"_distanceFactor",1)}start(){if(X3&&console.log("LODGROUP",this.name,this.lodModels,this),!cze&&!this._lodsHandler&&this.gameObject&&this.lodModels&&Array.isArray(this.lodModels)){const e=[];for(const s of this.lodModels){const r=new hze(s);this._lods.push(r);for(const o of r.renderers)e.includes(o)||e.push(o)}this._lodsHandler=new Array;for(let s=0;s<e.length;s++){const r=new lP;this._lodsHandler.push(r),this.gameObject.add(r)}const i=new Ae;i.name="Cull "+this.name;for(let s=0;s<e.length;s++){const r=e[s],o=this._lodsHandler[s],a=r.gameObject;X3&&console.log(s,a.name);for(const l of this._lods){const c=l.model.distance;let h=null;if(l.renderers.includes(r)?h=a:h=i,h.type==="Group"){console.warn(`LODGroup ${this.name}: Group or MultiMaterial object's are not supported as LOD object: ${h.name}`);continue}X3&&console.log("LEVEL",h.name,c),o.autoUpdate=!1,this.onAddLodLevel(o,h,l.model.distance)}}}}onAfterRender(){if(!this.gameObject||!this._lodsHandler)return;const e=this.context.mainCamera;if(e)for(const i of this._lodsHandler){i.update(e);const s=i.getCurrentLevel(),r=i.levels[s];i.layers.mask=r.object.layers.mask}}onAddLodLevel(e,i,s){if(i===this.gameObject){console.warn("LODGroup component must be on parent object and not mesh directly at the moment",i.name,i);return}e.addLevel(i,s*this._distanceFactor,.01);const r={lod:e,levelIndex:e.levels.length-1,distance:s};this._settings.push(r)}distanceFactor(e){if(e!==this._distanceFactor){this._distanceFactor=e;for(const i of this._settings){const s=i.lod.levels[i.levelIndex];s.distance=i.distance*e}}}}JS([T(E)],qS.prototype,"localReferencePoint",2),JS([T(hA)],qS.prototype,"lodModels",2);const dze=q("logstats");class D3 extends Oe{onEnable(){console.log(this),dze&&this.startCoroutine(this.run(),_n.OnAfterRender)}*run(){for(;this.enabled;){const e=this.context.renderer.info;console.log(e.memory,e.render,e.programs),yield}}}var uze=Object.defineProperty,pze=Object.getOwnPropertyDescriptor,MB=(n,e,i,s)=>{for(var r=s>1?void 0:s?pze(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&uze(e,i,r),r},z3;const Gre=(z3=class extends Oe{constructor(){super(...arguments),m(this,"target"),m(this,"invertForward",!1),m(this,"keepUpDirection",!0),m(this,"copyTargetRotation",!1)}onBeforeRender(){let n=this.target;if(n||(n=this.context.mainCamera),!n)return;let e=this.copyTargetRotation;(this.context.isInVR||this.context.isInPassThrough)&&(e=!1),xw(this.gameObject,n,this.keepUpDirection,e),this.invertForward&&this.gameObject.quaternion.multiply(Gre.flipYQuat)}createBehaviours(n,e,i){if(e.uuid===this.gameObject.uuid){let s=e;if(this.keepUpDirection){const o=ka.createEmptyParent(e);s=o;const a=this.invertForward?-1:1;o.setMatrix(o.getMatrix().multiply(new de().makeRotationZ(Math.PI/2*a))),e.setMatrix(e.getMatrix().multiply(new de().makeRotationZ(-Math.PI/2*a)))}const r=new Kr("lookat "+this.name,Yr.sceneStartTrigger(),Wi.lookAtCameraAction(s,void 0,this.invertForward?av.back:av.forward,this.keepUpDirection?av.up:av.zero));n.addBehavior(r)}}},m(z3,"flipYQuat",new Fe().setFromAxisAngle(new E(0,1,0),Math.PI)),z3);let dA=Gre;MB([T(Ae)],dA.prototype,"target",2),MB([T()],dA.prototype,"invertForward",2),MB([T()],dA.prototype,"keepUpDirection",2),MB([T()],dA.prototype,"copyTargetRotation",2);var mze=Object.defineProperty,gze=Object.getOwnPropertyDescriptor,fze=(n,e,i,s)=>{for(var r=s>1?void 0:s?gze(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&mze(e,i,r),r};const IB=q("debugnestedgltf");class TB extends Oe{constructor(){super(...arguments),m(this,"filePath"),m(this,"loadAssetInParent",!0),m(this,"_isLoadingOrDoneLoading",!1)}listenToProgress(e){var i;(i=this.filePath)==null||i.beginListenDownload(e)}preload(){var e;(e=this.filePath)==null||e.preload()}async start(){var e,i,s,r,o;if(this._isLoadingOrDoneLoading)return;IB&&console.log(this,this.guid);const a=this.gameObject.parent;if(a){this._isLoadingOrDoneLoading=!0;const l=new qh;l.idProvider=new Zo(this.hash(this.guid)),l.parent=this.loadAssetInParent!==!1?a:this.gameObject,this.gameObject.updateMatrix();const c=this.gameObject.matrix;IB&&console.log("Load nested:",((e=this.filePath)==null?void 0:e.url)??this.filePath,this.gameObject.position);const h=await((s=(i=this.filePath)==null?void 0:i.instantiate)==null?void 0:s.call(this.filePath,l));IB&&console.log("Nested loaded:",((r=this.filePath)==null?void 0:r.url)??this.filePath,h),h&&this.loadAssetInParent!==!1&&(h.matrixAutoUpdate=!1,h.matrix.identity(),h.applyMatrix4(c),h.matrixAutoUpdate=!0,h.layers.disableAll(),h.layers.set(this.layer),this.dispatchEvent(new CustomEvent("loaded",{detail:{instance:h,assetReference:this.filePath}}))),IB&&console.log("Nested loading done:",((o=this.filePath)==null?void 0:o.url)??this.filePath,h)}}onDestroy(){var e;(e=this.filePath)==null||e.unload()}hash(e){let i=0;for(let s=0;s<e.length;s++)i=e.charCodeAt(s)+((i<<5)-i);return i}}fze([T(Mi)],TB.prototype,"filePath",2);var Aze=Object.defineProperty,yze=Object.getOwnPropertyDescriptor,F3=(n,e,i,s)=>{for(var r=s>1?void 0:s?yze(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Aze(e,i,r),r};const bze=q("debugnet"),U3=class extends Oe{constructor(){super(...arguments),m(this,"url",null),m(this,"urlParameterName",null),m(this,"localhost",null)}awake(){bze&&console.log(this),this.context.connection.registerProvider(this)}getWebsocketUrl(){let n=this.url?U3.GetUrl(this.url,this.localhost):null;if(this.urlParameterName){const i=q(this.urlParameterName);i&&typeof i=="string"&&(n=i)}if(!n)return null;const e=new RegExp("(((https?)|(?<socket_prefix>wss?))://)?(www.)?(?<url>.+)","gm").exec(n);return e!=null&&e.groups?e?.groups.socket_prefix?n:"wss://"+e?.groups.url:null}static GetUrl(n,e){let i=n;const s=U3.IsLocalNetwork()&&e;if(s&&(i=e),n!=null&&n.startsWith("/")){const r=s?i:window.location.origin;r!=null&&r.endsWith("/")&&n.startsWith("/")&&(n=n.substring(1)),i=r+n}return i}static IsLocalNetwork(n=window.location.hostname){return Ma(n)}};let Zv=U3;F3([T()],Zv.prototype,"url",2),F3([T()],Zv.prototype,"urlParameterName",2),F3([T()],Zv.prototype,"localhost",2);var vze=Object.defineProperty,xze=Object.getOwnPropertyDescriptor,EB=(n,e,i,s)=>{for(var r=s>1?void 0:s?xze(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&vze(e,i,r),r};class uA extends Oe{constructor(){super(...arguments),m(this,"referenceSpace"),m(this,"from"),m(this,"affectPosition",!1),m(this,"affectRotation",!1),m(this,"alignLookDirection",!1),m(this,"levelLookDirection",!1),m(this,"levelPosition",!1),m(this,"positionOffset",new E(0,0,0)),m(this,"rotationOffset",new E(0,0,0)),m(this,"offset",new E(0,0,0))}update(){if(!this.from)return;var e=ri(this.from),i=fn(this.from);this.offset.copy(this.positionOffset);const s=this.offset.length();if(this.referenceSpace&&this.offset.transformDirection(this.referenceSpace.matrixWorld).multiplyScalar(s),e.add(this.offset),this.levelPosition&&this.referenceSpace){const l=new tr(this.gameObject.up,0),c=ri(this.referenceSpace);l.setFromNormalAndCoplanarPoint(this.gameObject.up,c);const h=new E(0,0,0);l.projectPoint(e,h),e.copy(h)}this.affectPosition&&Cr(this.gameObject,e);const r=new Oi(this.rotationOffset.x,this.rotationOffset.y,this.rotationOffset.z),o=new Fe().setFromEuler(r);this.affectRotation&&Ic(this.gameObject,i.multiply(o));const a=new E;this.from.getWorldDirection(a).multiplyScalar(50),this.levelLookDirection&&(a.y=0),this.alignLookDirection&&this.gameObject.lookAt(a)}}EB([T($)],uA.prototype,"referenceSpace",2),EB([T($)],uA.prototype,"from",2),EB([T(E)],uA.prototype,"positionOffset",2),EB([T(E)],uA.prototype,"rotationOffset",2);var wze=Object.defineProperty,Cze=Object.getOwnPropertyDescriptor,O3=(n,e,i,s)=>{for(var r=s>1?void 0:s?Cze(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&wze(e,i,r),r};class Wv extends Oe{constructor(){super(...arguments),m(this,"url"),m(this,"mode",0),m(this,"clickable",!0)}async open(){if(!this.url){console.warn("OpenURL: URL is not set, can't open.",this);return}this._validateUrl();let e=this.url;switch(!e.startsWith("mailto:")&&e.includes("@")&&(e="mailto:"+e),Je()&&ss("Open URL: "+e),this.mode){case 0:Ft.isSafari(),globalThis.open(e,"_blank");break;case 1:Ft.isSafari()&&Ft.isiOS()?globalThis.open(e,"_top"):globalThis.open(e,"_self");break;case 2:Ft.isSafari()?globalThis.open(e,"_top"):globalThis.open(e,"_new");break}}start(){this.gameObject.getComponentInParent(Ql)||this.gameObject.addComponent(Ql)}onPointerEnter(e){!e.used&&this.clickable&&this.context.input.setCursorPointer()}onPointerExit(){this.clickable&&this.context.input.setCursorNormal()}onPointerClick(e){var i;this.clickable&&!e.used&&(i=this.url)!=null&&i.length&&this.open()}_validateUrl(){this.url&&this.url.startsWith("www.")&&(Je()&&console.warn("URL is not valid, adding https:// to the start of the URL",this.url),this.url="https://"+this.url)}}O3([T()],Wv.prototype,"url",2),O3([T()],Wv.prototype,"mode",2),O3([T()],Wv.prototype,"clickable",2);const ca=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Pre=1234567;const Nre=Math.PI/180,Vre=180/Math.PI;function Sze(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(ca[n&255]+ca[n>>8&255]+ca[n>>16&255]+ca[n>>24&255]+"-"+ca[e&255]+ca[e>>8&255]+"-"+ca[e>>16&15|64]+ca[e>>24&255]+"-"+ca[i&63|128]+ca[i>>8&255]+"-"+ca[i>>16&255]+ca[i>>24&255]+ca[s&255]+ca[s>>8&255]+ca[s>>16&255]+ca[s>>24&255]).toLowerCase()}function ou(n,e,i){return Math.max(e,Math.min(i,n))}function Xre(n,e){return(n%e+e)%e}function _ze(n,e,i,s,r){return s+(n-e)*(r-s)/(i-e)}function Mze(n,e,i){return n!==e?(i-n)/(e-n):0}function Dre(n,e,i){return(1-i)*n+i*e}function Ize(n,e,i,s){return Dre(n,e,1-Math.exp(-i*s))}function Tze(n,e=1){return e-Math.abs(Xre(n,e*2)-e)}function Eze(n,e,i){return n<=e?0:n>=i?1:(n=(n-e)/(i-e),n*n*(3-2*n))}function Rze(n,e,i){return n<=e?0:n>=i?1:(n=(n-e)/(i-e),n*n*n*(n*(n*6-15)+10))}function Lze(n,e){return n+Math.floor(Math.random()*(e-n+1))}function Bze(n,e){return n+Math.random()*(e-n)}function kze(n){return n*(.5-Math.random())}function Gze(n){n!==void 0&&(Pre=n);let e=Pre+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Pze(n){return n*Nre}function Nze(n){return n*Vre}function Vze(n){return(n&n-1)===0&&n!==0}function Xze(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Dze(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function zze(n,e,i,s,r){const o=Math.cos,a=Math.sin,l=o(i/2),c=a(i/2),h=o((e+s)/2),d=a((e+s)/2),u=o((e-s)/2),p=a((e-s)/2),g=o((s-e)/2),f=a((s-e)/2);switch(r){case"XYX":n.set(l*d,c*u,c*p,l*h);break;case"YZY":n.set(c*p,l*d,c*u,l*h);break;case"ZXZ":n.set(c*u,c*p,l*d,l*h);break;case"XZX":n.set(l*d,c*f,c*g,l*h);break;case"YXY":n.set(c*g,l*d,c*f,l*h);break;case"ZYZ":n.set(c*f,c*g,l*d,l*h);break;default:console.warn("../math.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function Fze(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Uze(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const Hv={DEG2RAD:Nre,RAD2DEG:Vre,generateUUID:Sze,clamp:ou,euclideanModulo:Xre,mapLinear:_ze,inverseLerp:Mze,lerp:Dre,damp:Ize,pingpong:Tze,smoothstep:Eze,smootherstep:Rze,randInt:Lze,randFloat:Bze,randFloatSpread:kze,seededRandom:Gze,degToRad:Pze,radToDeg:Nze,isPowerOfTwo:Vze,ceilPowerOfTwo:Xze,floorPowerOfTwo:Dze,setQuaternionFromProperEuler:zze,normalize:Uze,denormalize:Fze};class On{constructor(e=0,i=0,s=0,r=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=s,this._w=r}static slerpFlat(e,i,s,r,o,a,l){let c=s[r+0],h=s[r+1],d=s[r+2],u=s[r+3];const p=o[a+0],g=o[a+1],f=o[a+2],A=o[a+3];if(l===0){e[i+0]=c,e[i+1]=h,e[i+2]=d,e[i+3]=u;return}if(l===1){e[i+0]=p,e[i+1]=g,e[i+2]=f,e[i+3]=A;return}if(u!==A||c!==p||h!==g||d!==f){let y=1-l;const b=c*p+h*g+d*f+u*A,v=b>=0?1:-1,x=1-b*b;if(x>Number.EPSILON){const C=Math.sqrt(x),S=Math.atan2(C,b*v);y=Math.sin(y*S)/C,l=Math.sin(l*S)/C}const w=l*v;if(c=c*y+p*w,h=h*y+g*w,d=d*y+f*w,u=u*y+A*w,y===1-l){const C=1/Math.sqrt(c*c+h*h+d*d+u*u);c*=C,h*=C,d*=C,u*=C}}e[i]=c,e[i+1]=h,e[i+2]=d,e[i+3]=u}static multiplyQuaternionsFlat(e,i,s,r,o,a){const l=s[r],c=s[r+1],h=s[r+2],d=s[r+3],u=o[a],p=o[a+1],g=o[a+2],f=o[a+3];return e[i]=l*f+d*u+c*g-h*p,e[i+1]=c*f+d*p+h*u-l*g,e[i+2]=h*f+d*g+l*p-c*u,e[i+3]=d*f-l*u-c*p-h*g,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,s,r){return this._x=e,this._y=i,this._z=s,this._w=r,this._onChangeCallback(),this}clone(){return new On(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i=!0){const s=e._x,r=e._y,o=e._z,a=e._order,l=Math.cos,c=Math.sin,h=l(s/2),d=l(r/2),u=l(o/2),p=c(s/2),g=c(r/2),f=c(o/2);switch(a){case"XYZ":this._x=p*d*u+h*g*f,this._y=h*g*u-p*d*f,this._z=h*d*f+p*g*u,this._w=h*d*u-p*g*f;break;case"YXZ":this._x=p*d*u+h*g*f,this._y=h*g*u-p*d*f,this._z=h*d*f-p*g*u,this._w=h*d*u+p*g*f;break;case"ZXY":this._x=p*d*u-h*g*f,this._y=h*g*u+p*d*f,this._z=h*d*f+p*g*u,this._w=h*d*u-p*g*f;break;case"ZYX":this._x=p*d*u-h*g*f,this._y=h*g*u+p*d*f,this._z=h*d*f-p*g*u,this._w=h*d*u+p*g*f;break;case"YZX":this._x=p*d*u+h*g*f,this._y=h*g*u+p*d*f,this._z=h*d*f-p*g*u,this._w=h*d*u-p*g*f;break;case"XZY":this._x=p*d*u-h*g*f,this._y=h*g*u-p*d*f,this._z=h*d*f+p*g*u,this._w=h*d*u+p*g*f;break;default:console.warn("../math.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,i){const s=i/2,r=Math.sin(s);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){const i=e.elements,s=i[0],r=i[4],o=i[8],a=i[1],l=i[5],c=i[9],h=i[2],d=i[6],u=i[10],p=s+l+u;if(p>0){const g=.5/Math.sqrt(p+1);this._w=.25/g,this._x=(d-c)*g,this._y=(o-h)*g,this._z=(a-r)*g}else if(s>l&&s>u){const g=2*Math.sqrt(1+s-l-u);this._w=(d-c)/g,this._x=.25*g,this._y=(r+a)/g,this._z=(o+h)/g}else if(l>u){const g=2*Math.sqrt(1+l-s-u);this._w=(o-h)/g,this._x=(r+a)/g,this._y=.25*g,this._z=(c+d)/g}else{const g=2*Math.sqrt(1+u-s-l);this._w=(a-r)/g,this._x=(o+h)/g,this._y=(c+d)/g,this._z=.25*g}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let s=e.dot(i)+1;return s<Number.EPSILON?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ou(this.dot(e),-1,1)))}rotateTowards(e,i){const s=this.angleTo(e);if(s===0)return this;const r=Math.min(1,i/s);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){const s=e._x,r=e._y,o=e._z,a=e._w,l=i._x,c=i._y,h=i._z,d=i._w;return this._x=s*d+a*l+r*h-o*c,this._y=r*d+a*c+o*l-s*h,this._z=o*d+a*h+s*c-r*l,this._w=a*d-s*l-r*c-o*h,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);const s=this._x,r=this._y,o=this._z,a=this._w;let l=a*e._w+s*e._x+r*e._y+o*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=a,this._x=s,this._y=r,this._z=o,this;const c=1-l*l;if(c<=Number.EPSILON){const g=1-i;return this._w=g*a+i*this._w,this._x=g*s+i*this._x,this._y=g*r+i*this._y,this._z=g*o+i*this._z,this.normalize(),this}const h=Math.sqrt(c),d=Math.atan2(h,l),u=Math.sin((1-i)*d)/h,p=Math.sin(i*d)/h;return this._w=a*u+this._w*p,this._x=s*u+this._x*p,this._y=r*u+this._y*p,this._z=o*u+this._z*p,this._onChangeCallback(),this}slerpQuaternions(e,i,s){return this.copy(e).slerp(i,s)}random(){const e=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),s=Math.random(),r=Math.sqrt(1-s),o=Math.sqrt(s);return this.set(r*Math.sin(e),r*Math.cos(e),o*Math.sin(i),o*Math.cos(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Dt{constructor(e=0,i=0,s=0){this.isVector3=!0,Dt.prototype.isVector3=!0,this.x=e,this.y=i,this.z=s}set(e,i,s){return s===void 0&&(s=this.z),this.x=e,this.y=i,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new Dt(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(zre.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(zre.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,s=this.y,r=this.z,o=e.elements;return this.x=o[0]*i+o[3]*s+o[6]*r,this.y=o[1]*i+o[4]*s+o[7]*r,this.z=o[2]*i+o[5]*s+o[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,s=this.y,r=this.z,o=e.elements,a=1/(o[3]*i+o[7]*s+o[11]*r+o[15]);return this.x=(o[0]*i+o[4]*s+o[8]*r+o[12])*a,this.y=(o[1]*i+o[5]*s+o[9]*r+o[13])*a,this.z=(o[2]*i+o[6]*s+o[10]*r+o[14])*a,this}applyQuaternion(e){const i=this.x,s=this.y,r=this.z,o=e.x,a=e.y,l=e.z,c=e.w,h=2*(a*r-l*s),d=2*(l*i-o*r),u=2*(o*s-a*i);return this.x=i+c*h+a*u-l*d,this.y=s+c*d+l*h-o*u,this.z=r+c*u+o*d-a*h,this}transformDirection(e){const i=this.x,s=this.y,r=this.z,o=e.elements;return this.x=o[0]*i+o[4]*s+o[8]*r,this.y=o[1]*i+o[5]*s+o[9]*r,this.z=o[2]*i+o[6]*s+o[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this.z=e.z+(i.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const s=e.x,r=e.y,o=e.z,a=i.x,l=i.y,c=i.z;return this.x=r*c-o*l,this.y=o*a-s*c,this.z=s*l-r*a,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const s=e.dot(this)/i;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return Z3.copy(this).projectOnVector(e),this.sub(Z3)}reflect(e){return this.sub(Z3.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const s=this.dot(e)/i;return Math.acos(ou(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y,r=this.z-e.z;return i*i+s*s+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSphericalCoords(e,i,s){const r=Math.sin(i)*e;return this.x=r*Math.sin(s),this.y=Math.cos(i)*e,this.z=r*Math.cos(s),this}setFromCylindricalCoords(e,i,s){return this.x=e*Math.sin(i),this.y=s,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=s,this.z=r,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,s=Math.sqrt(1-i*i);return this.x=s*Math.cos(e),this.y=i,this.z=s*Math.sin(e),this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Z3=new Dt,zre=new On,RB=2e3,Fre=2001;class Up{constructor(e,i,s,r,o,a,l,c,h,d,u,p,g,f,A,y){this.isMatrix4=!0,Up.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,s,r,o,a,l,c,h,d,u,p,g,f,A,y)}extractPosition(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)}multiplyToArray(e,i,s){return console.error("THREE.Matrix4: .multiplyToArray() has been removed."),this}setRotationFromQuaternion(e){return this.makeRotationFromQuaternion(e)}set(e,i,s,r,o,a,l,c,h,d,u,p,g,f,A,y){const b=this.elements;return b[0]=e,b[4]=i,b[8]=s,b[12]=r,b[1]=o,b[5]=a,b[9]=l,b[13]=c,b[2]=h,b[6]=d,b[10]=u,b[14]=p,b[3]=g,b[7]=f,b[11]=A,b[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Up().fromArray(this.elements)}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],this}copyPosition(e){const i=this.elements,s=e.elements;return i[12]=s[12],i[13]=s[13],i[14]=s[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,s){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,i,s){return this.set(e.x,i.x,s.x,0,e.y,i.y,s.y,0,e.z,i.z,s.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,s=e.elements,r=1/Qv.setFromMatrixColumn(e,0).length(),o=1/Qv.setFromMatrixColumn(e,1).length(),a=1/Qv.setFromMatrixColumn(e,2).length();return i[0]=s[0]*r,i[1]=s[1]*r,i[2]=s[2]*r,i[3]=0,i[4]=s[4]*o,i[5]=s[5]*o,i[6]=s[6]*o,i[7]=0,i[8]=s[8]*a,i[9]=s[9]*a,i[10]=s[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,s=e.x,r=e.y,o=e.z,a=Math.cos(s),l=Math.sin(s),c=Math.cos(r),h=Math.sin(r),d=Math.cos(o),u=Math.sin(o);if(e.order==="XYZ"){const p=a*d,g=a*u,f=l*d,A=l*u;i[0]=c*d,i[4]=-c*u,i[8]=h,i[1]=g+f*h,i[5]=p-A*h,i[9]=-l*c,i[2]=A-p*h,i[6]=f+g*h,i[10]=a*c}else if(e.order==="YXZ"){const p=c*d,g=c*u,f=h*d,A=h*u;i[0]=p+A*l,i[4]=f*l-g,i[8]=a*h,i[1]=a*u,i[5]=a*d,i[9]=-l,i[2]=g*l-f,i[6]=A+p*l,i[10]=a*c}else if(e.order==="ZXY"){const p=c*d,g=c*u,f=h*d,A=h*u;i[0]=p-A*l,i[4]=-a*u,i[8]=f+g*l,i[1]=g+f*l,i[5]=a*d,i[9]=A-p*l,i[2]=-a*h,i[6]=l,i[10]=a*c}else if(e.order==="ZYX"){const p=a*d,g=a*u,f=l*d,A=l*u;i[0]=c*d,i[4]=f*h-g,i[8]=p*h+A,i[1]=c*u,i[5]=A*h+p,i[9]=g*h-f,i[2]=-h,i[6]=l*c,i[10]=a*c}else if(e.order==="YZX"){const p=a*c,g=a*h,f=l*c,A=l*h;i[0]=c*d,i[4]=A-p*u,i[8]=f*u+g,i[1]=u,i[5]=a*d,i[9]=-l*d,i[2]=-h*d,i[6]=g*u+f,i[10]=p-A*u}else if(e.order==="XZY"){const p=a*c,g=a*h,f=l*c,A=l*h;i[0]=c*d,i[4]=-u,i[8]=h*d,i[1]=p*u+A,i[5]=a*d,i[9]=g*u-f,i[2]=f*u-g,i[6]=l*d,i[10]=A*u+p}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Oze,e,Zze)}lookAt(e,i,s){const r=this.elements;return rc.subVectors(e,i),rc.lengthSq()===0&&(rc.z=1),rc.normalize(),Vg.crossVectors(s,rc),Vg.lengthSq()===0&&(Math.abs(s.z)===1?rc.x+=1e-4:rc.z+=1e-4,rc.normalize(),Vg.crossVectors(s,rc)),Vg.normalize(),LB.crossVectors(rc,Vg),r[0]=Vg.x,r[4]=LB.x,r[8]=rc.x,r[1]=Vg.y,r[5]=LB.y,r[9]=rc.y,r[2]=Vg.z,r[6]=LB.z,r[10]=rc.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,r=i.elements,o=this.elements,a=s[0],l=s[4],c=s[8],h=s[12],d=s[1],u=s[5],p=s[9],g=s[13],f=s[2],A=s[6],y=s[10],b=s[14],v=s[3],x=s[7],w=s[11],C=s[15],S=r[0],_=r[4],I=r[8],B=r[12],M=r[1],R=r[5],k=r[9],G=r[13],X=r[2],F=r[6],z=r[10],H=r[14],Z=r[3],he=r[7],be=r[11],_e=r[15];return o[0]=a*S+l*M+c*X+h*Z,o[4]=a*_+l*R+c*F+h*he,o[8]=a*I+l*k+c*z+h*be,o[12]=a*B+l*G+c*H+h*_e,o[1]=d*S+u*M+p*X+g*Z,o[5]=d*_+u*R+p*F+g*he,o[9]=d*I+u*k+p*z+g*be,o[13]=d*B+u*G+p*H+g*_e,o[2]=f*S+A*M+y*X+b*Z,o[6]=f*_+A*R+y*F+b*he,o[10]=f*I+A*k+y*z+b*be,o[14]=f*B+A*G+y*H+b*_e,o[3]=v*S+x*M+w*X+C*Z,o[7]=v*_+x*R+w*F+C*he,o[11]=v*I+x*k+w*z+C*be,o[15]=v*B+x*G+w*H+C*_e,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[4],r=e[8],o=e[12],a=e[1],l=e[5],c=e[9],h=e[13],d=e[2],u=e[6],p=e[10],g=e[14],f=e[3],A=e[7],y=e[11],b=e[15];return f*(+o*c*u-r*h*u-o*l*p+s*h*p+r*l*g-s*c*g)+A*(+i*c*g-i*h*p+o*a*p-r*a*g+r*h*d-o*c*d)+y*(+i*h*u-i*l*g-o*a*u+s*a*g+o*l*d-s*h*d)+b*(-r*l*d-i*c*u+i*l*p+r*a*u-s*a*p+s*c*d)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,s){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=i,r[14]=s),this}invert(){const e=this.elements,i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],u=e[9],p=e[10],g=e[11],f=e[12],A=e[13],y=e[14],b=e[15],v=u*y*h-A*p*h+A*c*g-l*y*g-u*c*b+l*p*b,x=f*p*h-d*y*h-f*c*g+a*y*g+d*c*b-a*p*b,w=d*A*h-f*u*h+f*l*g-a*A*g-d*l*b+a*u*b,C=f*u*c-d*A*c-f*l*p+a*A*p+d*l*y-a*u*y,S=i*v+s*x+r*w+o*C;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _=1/S;return e[0]=v*_,e[1]=(A*p*o-u*y*o-A*r*g+s*y*g+u*r*b-s*p*b)*_,e[2]=(l*y*o-A*c*o+A*r*h-s*y*h-l*r*b+s*c*b)*_,e[3]=(u*c*o-l*p*o-u*r*h+s*p*h+l*r*g-s*c*g)*_,e[4]=x*_,e[5]=(d*y*o-f*p*o+f*r*g-i*y*g-d*r*b+i*p*b)*_,e[6]=(f*c*o-a*y*o-f*r*h+i*y*h+a*r*b-i*c*b)*_,e[7]=(a*p*o-d*c*o+d*r*h-i*p*h-a*r*g+i*c*g)*_,e[8]=w*_,e[9]=(f*u*o-d*A*o-f*s*g+i*A*g+d*s*b-i*u*b)*_,e[10]=(a*A*o-f*l*o+f*s*h-i*A*h-a*s*b+i*l*b)*_,e[11]=(d*l*o-a*u*o-d*s*h+i*u*h+a*s*g-i*l*g)*_,e[12]=C*_,e[13]=(d*A*r-f*u*r+f*s*p-i*A*p-d*s*y+i*u*y)*_,e[14]=(f*l*r-a*A*r-f*s*c+i*A*c+a*s*y-i*l*y)*_,e[15]=(a*u*r-d*l*r+d*s*c-i*u*c-a*s*p+i*l*p)*_,this}scale(e){const i=this.elements,s=e.x,r=e.y,o=e.z;return i[0]*=s,i[4]*=r,i[8]*=o,i[1]*=s,i[5]*=r,i[9]*=o,i[2]*=s,i[6]*=r,i[10]*=o,i[3]*=s,i[7]*=r,i[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,s,r))}makeTranslation(e,i,s){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,s,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,i,-s,0,0,s,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,0,s,0,0,1,0,0,-s,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,-s,0,0,s,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const s=Math.cos(i),r=Math.sin(i),o=1-s,a=e.x,l=e.y,c=e.z,h=o*a,d=o*l;return this.set(h*a+s,h*l-r*c,h*c+r*l,0,h*l+r*c,d*l+s,d*c-r*a,0,h*c-r*l,d*c+r*a,o*c*c+s,0,0,0,0,1),this}makeScale(e,i,s){return this.set(e,0,0,0,0,i,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,i,s,r,o,a){return this.set(1,s,o,0,e,1,a,0,i,r,1,0,0,0,0,1),this}compose(e,i,s){const r=this.elements,o=i._x,a=i._y,l=i._z,c=i._w,h=o+o,d=a+a,u=l+l,p=o*h,g=o*d,f=o*u,A=a*d,y=a*u,b=l*u,v=c*h,x=c*d,w=c*u,C=s.x,S=s.y,_=s.z;return r[0]=(1-(A+b))*C,r[1]=(g+w)*C,r[2]=(f-x)*C,r[3]=0,r[4]=(g-w)*S,r[5]=(1-(p+b))*S,r[6]=(y+v)*S,r[7]=0,r[8]=(f+x)*_,r[9]=(y-v)*_,r[10]=(1-(p+A))*_,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,i,s){const r=this.elements;let o=Qv.set(r[0],r[1],r[2]).length();const a=Qv.set(r[4],r[5],r[6]).length(),l=Qv.set(r[8],r[9],r[10]).length();this.determinant()<0&&(o=-o),e.x=r[12],e.y=r[13],e.z=r[14],Wh.copy(this);const c=1/o,h=1/a,d=1/l;return Wh.elements[0]*=c,Wh.elements[1]*=c,Wh.elements[2]*=c,Wh.elements[4]*=h,Wh.elements[5]*=h,Wh.elements[6]*=h,Wh.elements[8]*=d,Wh.elements[9]*=d,Wh.elements[10]*=d,i.setFromRotationMatrix(Wh),s.x=o,s.y=a,s.z=l,this}makePerspective(e,i,s,r,o,a,l=RB){const c=this.elements,h=2*o/(i-e),d=2*o/(s-r),u=(i+e)/(i-e),p=(s+r)/(s-r);let g,f;if(l===RB)g=-(a+o)/(a-o),f=-2*a*o/(a-o);else if(l===Fre)g=-a/(a-o),f=-a*o/(a-o);else throw new Error("Matrix4.makePerspective(): Invalid coordinate system: "+l);return c[0]=h,c[4]=0,c[8]=u,c[12]=0,c[1]=0,c[5]=d,c[9]=p,c[13]=0,c[2]=0,c[6]=0,c[10]=g,c[14]=f,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,s,r,o,a,l=RB){const c=this.elements,h=1/(i-e),d=1/(s-r),u=1/(a-o),p=(i+e)*h,g=(s+r)*d;let f,A;if(l===RB)f=(a+o)*u,A=-2*u;else if(l===Fre)f=o*u,A=-1*u;else throw new Error("../math.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-p,c[1]=0,c[5]=2*d,c[9]=0,c[13]=-g,c[2]=0,c[6]=0,c[10]=A,c[14]=-f,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,s=e.elements;for(let r=0;r<16;r++)if(i[r]!==s[r])return!1;return!0}fromArray(e,i=0){for(let s=0;s<16;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e[i+9]=s[9],e[i+10]=s[10],e[i+11]=s[11],e[i+12]=s[12],e[i+13]=s[13],e[i+14]=s[14],e[i+15]=s[15],e}}const Qv=new Dt,Wh=new Up,Oze=new Dt(0,0,0),Zze=new Dt(1,1,1),Vg=new Dt,LB=new Dt,rc=new Dt,Ure=new Up,Ore=new On;class aM{constructor(e=0,i=0,s=0,r=aM.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=s,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,s,r=this._order){return this._x=e,this._y=i,this._z=s,this._order=r,this._onChangeCallback(),this}clone(){return new aM(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,s=!0){const r=e.elements,o=r[0],a=r[4],l=r[8],c=r[1],h=r[5],d=r[9],u=r[2],p=r[6],g=r[10];switch(i){case"XYZ":this._y=Math.asin(ou(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,g),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(p,h),this._z=0);break;case"YXZ":this._x=Math.asin(-ou(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(l,g),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-u,o),this._z=0);break;case"ZXY":this._x=Math.asin(ou(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-u,g),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-ou(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(p,g),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-a,h));break;case"YZX":this._z=Math.asin(ou(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-d,h),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(l,g));break;case"XZY":this._z=Math.asin(-ou(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(p,h),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-d,g),this._y=0);break;default:console.warn("../math.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,s===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,s){return Ure.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Ure,i,s)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return Ore.setFromEuler(this),this.setFromQuaternion(Ore,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(e){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}aM.DEFAULT_ORDER="XYZ";class Sx{constructor(e=0,i=0){this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new Sx(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,s=this.y,r=e.elements;return this.x=r[0]*i+r[3]*s+r[6],this.y=r[1]*i+r[4]*s+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const s=this.dot(e)/i;return Math.acos(ou(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y;return i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}rotateAround(e,i){const s=Math.cos(i),r=Math.sin(i),o=this.x-e.x,a=this.y-e.y;return this.x=o*s-a*r+e.x,this.y=o*r+a*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Sx.isVector2=!0;class Al{constructor(e=0,i=0,s=0,r=1){Al.prototype.isVector4=!0,this.x=e,this.y=i,this.z=s,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,s,r){return this.x=e,this.y=i,this.z=s,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new Al(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,s=this.y,r=this.z,o=this.w,a=e.elements;return this.x=a[0]*i+a[4]*s+a[8]*r+a[12]*o,this.y=a[1]*i+a[5]*s+a[9]*r+a[13]*o,this.z=a[2]*i+a[6]*s+a[10]*r+a[14]*o,this.w=a[3]*i+a[7]*s+a[11]*r+a[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,s,r,o;const a=e.elements,l=a[0],c=a[4],h=a[8],d=a[1],u=a[5],p=a[9],g=a[2],f=a[6],A=a[10];if(Math.abs(c-d)<.01&&Math.abs(h-g)<.01&&Math.abs(p-f)<.01){if(Math.abs(c+d)<.1&&Math.abs(h+g)<.1&&Math.abs(p+f)<.1&&Math.abs(l+u+A-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const b=(l+1)/2,v=(u+1)/2,x=(A+1)/2,w=(c+d)/4,C=(h+g)/4,S=(p+f)/4;return b>v&&b>x?b<.01?(s=0,r=.707106781,o=.707106781):(s=Math.sqrt(b),r=w/s,o=C/s):v>x?v<.01?(s=.707106781,r=0,o=.707106781):(r=Math.sqrt(v),s=w/r,o=S/r):x<.01?(s=.707106781,r=.707106781,o=0):(o=Math.sqrt(x),s=C/o,r=S/o),this.set(s,r,o,i),this}let y=Math.sqrt((f-p)*(f-p)+(h-g)*(h-g)+(d-c)*(d-c));return Math.abs(y)<.001&&(y=1),this.x=(f-p)/y,this.y=(h-g)/y,this.z=(d-c)/y,this.w=Math.acos((l+u+A-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this.z=e.z+(i.z-e.z)*s,this.w=e.w+(i.w-e.w)*s,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class mu{constructor(e,i,s,r,o,a,l,c,h){mu.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,s,r,o,a,l,c,h)}set(e,i,s,r,o,a,l,c,h){const d=this.elements;return d[0]=e,d[1]=r,d[2]=l,d[3]=i,d[4]=o,d[5]=c,d[6]=s,d[7]=a,d[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],this}extractBasis(e,i,s){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,r=i.elements,o=this.elements,a=s[0],l=s[3],c=s[6],h=s[1],d=s[4],u=s[7],p=s[2],g=s[5],f=s[8],A=r[0],y=r[3],b=r[6],v=r[1],x=r[4],w=r[7],C=r[2],S=r[5],_=r[8];return o[0]=a*A+l*v+c*C,o[3]=a*y+l*x+c*S,o[6]=a*b+l*w+c*_,o[1]=h*A+d*v+u*C,o[4]=h*y+d*x+u*S,o[7]=h*b+d*w+u*_,o[2]=p*A+g*v+f*C,o[5]=p*y+g*x+f*S,o[8]=p*b+g*w+f*_,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8];return i*a*d-i*l*h-s*o*d+s*l*c+r*o*h-r*a*c}invert(){const e=this.elements,i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],u=d*a-l*h,p=l*c-d*o,g=h*o-a*c,f=i*u+s*p+r*g;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const A=1/f;return e[0]=u*A,e[1]=(r*h-d*s)*A,e[2]=(l*s-r*a)*A,e[3]=p*A,e[4]=(d*i-r*c)*A,e[5]=(r*o-l*i)*A,e[6]=g*A,e[7]=(s*c-h*i)*A,e[8]=(a*i-s*o)*A,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,s,r,o,a,l){const c=Math.cos(o),h=Math.sin(o);return this.set(s*c,s*h,-s*(c*a+h*l)+a+e,-r*h,r*c,-r*(-h*a+c*l)+l+i,0,0,1),this}scale(e,i){return this.premultiply(W3.makeScale(e,i)),this}rotate(e){return this.premultiply(W3.makeRotation(-e)),this}translate(e,i){return this.premultiply(W3.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),s=Math.sin(e);return this.set(i,-s,0,s,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,s=e.elements;for(let r=0;r<9;r++)if(i[r]!==s[r])return!1;return!0}fromArray(e,i=0){for(let s=0;s<9;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e}clone(){return new mu().fromArray(this.elements)}}const W3=new mu;var Fa;(function(n){n[n.Random=0]="Random",n[n.Loop=1]="Loop",n[n.PingPong=2]="PingPong",n[n.Burst=3]="Burst"})(Fa||(Fa={}));function $S(n,e,i,s){let r;switch(Fa.Random===n?e=Math.random():Fa.Burst===n&&s.isBursting&&(e=s.burstParticleIndex/s.burstParticleCount),i>0?r=Math.floor(e/i)*i:r=e,n){case Fa.Loop:r=r%1;break;case Fa.PingPong:r=Math.abs(r%2-1);break}return r}class PA{constructor(e,i,s,r){this.p=[e,i,s,r]}genValue(e){const i=e*e,s=e*e*e,r=1-e,o=r*r,a=o*r;return this.p[0]*a+this.p[1]*o*e*3+this.p[2]*r*i*3+this.p[3]*s}derivativeCoefficients(e){const i=[];for(let s=e,r=s.length-1;r>0;r--){const o=[];for(let a=0;a<r;a++){const l=r*(s[a+1]-s[a]);o.push(l)}i.push(o),s=o}return i}getSlope(e){const i=this.derivativeCoefficients(this.p)[0],s=1-e,r=s*s,o=s*e*2,a=e*e;return r*i[0]+o*i[1]+a*i[2]}controlCurve(e,i){this.p[1]=e/3+this.p[0],this.p[2]=this.p[3]-i/3}hull(e){let i=this.p,s=[],r,o=0,a=0,l=0;const c=[];for(c[o++]=i[0],c[o++]=i[1],c[o++]=i[2],c[o++]=i[3];i.length>1;){for(s=[],a=0,l=i.length-1;a<l;a++)r=e*i[a]+(1-e)*i[a+1],c[o++]=r,s.push(r);i=s}return c}split(e){const i=this.hull(e);return{left:new PA(i[0],i[4],i[7],i[9]),right:new PA(i[9],i[8],i[6],i[3]),span:i}}clone(){return new PA(this.p[0],this.p[1],this.p[2],this.p[3])}toJSON(){return{p0:this.p[0],p1:this.p[1],p2:this.p[2],p3:this.p[3]}}static fromJSON(e){return new PA(e.p0,e.p1,e.p2,e.p3)}}const e_=n=>({r:n.x,g:n.y,b:n.z,a:n.w}),t_=n=>new Al(n.r,n.g,n.b,n.a),Wze=(n,e)=>{switch(e){case"Vector3":return new Dt(n.x,n.y,n.z);case"Vector4":return new Al(n.x,n.y,n.z,n.w);case"Color":return new Dt(n.r,n.g,n.b);case"Number":return n;default:return n}},Hze=(n,e)=>{switch(e){case"Vector3":return{x:n.x,y:n.y,z:n.z};case"Vector4":return{x:n.x,y:n.y,z:n.z,w:n.w};case"Color":return{r:n.x,g:n.y,b:n.z};case"Number":return n;default:return n}};class Hk{constructor(e,i){this.a=e,this.b=i,this.type="value"}startGen(e){}genColor(e,i){const s=Math.random();return i.copy(this.a).lerp(this.b,s)}toJSON(){return{type:"RandomColor",a:e_(this.a),b:e_(this.b)}}static fromJSON(e){return new Hk(t_(e.a),t_(e.b))}clone(){return new Hk(this.a.clone(),this.b.clone())}}class Mx{constructor(e,i){this.a=e,this.b=i,this.indexCount=-1,this.type="value"}startGen(e){this.indexCount=e.length,e.push(Math.random())}genColor(e,i){return this.indexCount===-1&&this.startGen(e),i.copy(this.a).lerp(this.b,e[this.indexCount])}toJSON(){return{type:"ColorRange",a:e_(this.a),b:e_(this.b)}}static fromJSON(e){return new Mx(t_(e.a),t_(e.b))}clone(){return new Mx(this.a.clone(),this.b.clone())}}class ef{constructor(e,i){this.subType=i,this.type="function",this.keys=e}findKey(e){let i=0,s=0,r=this.keys.length-1;for(;s+1<r;)if(i=Math.floor((s+r)/2),e<this.getStartX(i))r=i-1;else if(e>this.getEndX(i))s=i+1;else return i;for(let o=s;o<=r;o++)if(e>=this.getStartX(o)&&e<=this.getEndX(o))return o;return-1}getStartX(e){return this.keys[e][1]}getEndX(e){return e+1<this.keys.length?this.keys[e+1][1]:1}genValue(e,i){const s=this.findKey(i);return this.subType==="Number"?s===-1?this.keys[0][0]:s+1>=this.keys.length?this.keys[this.keys.length-1][0]:(this.keys[s+1][0]-this.keys[s][0])*((i-this.getStartX(s))/(this.getEndX(s)-this.getStartX(s)))+this.keys[s][0]:s===-1?e.copy(this.keys[0][0]):s+1>=this.keys.length?e.copy(this.keys[this.keys.length-1][0]):e.copy(this.keys[s][0]).lerp(this.keys[s+1][0],(i-this.getStartX(s))/(this.getEndX(s)-this.getStartX(s)))}toJSON(){return this.keys[0][0].constructor.name,{type:"CLinearFunction",subType:this.subType,keys:this.keys.map(([e,i])=>({value:Hze(e,this.subType),pos:i}))}}static fromJSON(e){return new ef(e.keys.map(i=>[Wze(i.value,e.subType),i.pos]),e.subType)}clone(){return this.subType==="Number"?new ef(this.keys.map(([e,i])=>[e,i]),this.subType):new ef(this.keys.map(([e,i])=>[e.clone(),i]),this.subType)}}const BB=new Dt;class DA{constructor(e=[[new Dt(0,0,0),0],[new Dt(1,1,1),0]],i=[[1,0],[1,1]]){this.type="function",this.color=new ef(e,"Color"),this.alpha=new ef(i,"Number")}genColor(e,i,s){return this.color.genValue(BB,s),i.set(BB.x,BB.y,BB.z,this.alpha.genValue(1,s))}toJSON(){return{type:"Gradient",color:this.color.toJSON(),alpha:this.alpha.toJSON()}}static fromJSON(e){if(e.functions){const i=e.functions.map(s=>[Mx.fromJSON(s.function).a,s.start]);return e.functions.length>0&&i.push([Mx.fromJSON(e.functions[e.functions.length-1].function).b,1]),new DA(i.map(s=>[new Dt(s[0].x,s[0].y,s[0].z),s[1]]),i.map(s=>[s[0].w,s[1]]))}else{const i=new DA;return i.alpha=ef.fromJSON(e.alpha),i.color=ef.fromJSON(e.color),i}}clone(){const e=new DA;return e.alpha=this.alpha.clone(),e.color=this.color.clone(),e}startGen(e){}}const H3=new Al;class Qk{constructor(e,i){this.indexCount=0,this.type="function",this.gradient1=e,this.gradient2=i}startGen(e){this.indexCount=e.length,e.push(Math.random())}genColor(e,i,s){return this.gradient1.genColor(e,i,s),this.gradient2.genColor(e,H3,s),e&&e[this.indexCount]!==void 0?i.lerp(H3,e[this.indexCount]):i.lerp(H3,Math.random()),i}toJSON(){return{type:"RandomColorBetweenGradient",gradient1:this.gradient1.toJSON(),gradient2:this.gradient2.toJSON()}}static fromJSON(e){return new Qk(DA.fromJSON(e.gradient1),DA.fromJSON(e.gradient2))}clone(){return new Qk(this.gradient1.clone(),this.gradient2.clone())}}class NA{constructor(e){this.color=e,this.type="value"}startGen(e){}genColor(e,i){return i.copy(this.color)}toJSON(){return{type:"ConstantColor",color:e_(this.color)}}static fromJSON(e){return new NA(t_(e.color))}clone(){return new NA(this.color.clone())}}function Q3(n){switch(n.type){case"ConstantColor":return NA.fromJSON(n);case"ColorRange":return Mx.fromJSON(n);case"RandomColor":return Hk.fromJSON(n);case"Gradient":return DA.fromJSON(n);case"RandomColorBetweenGradient":return Qk.fromJSON(n);default:return new NA(new Al(1,1,1,1))}}class cn{constructor(e){this.value=e,this.type="value"}startGen(e){}genValue(e){return this.value}toJSON(){return{type:"ConstantValue",value:this.value}}static fromJSON(e){return new cn(e.value)}clone(){return new cn(this.value)}}class VA{constructor(e,i){this.a=e,this.b=i,this.indexCount=-1,this.type="value"}startGen(e){this.indexCount=e.length,e.push(Math.random())}genValue(e){return this.indexCount===-1&&this.startGen(e),Hv.lerp(this.a,this.b,e[this.indexCount])}toJSON(){return{type:"IntervalValue",a:this.a,b:this.b}}static fromJSON(e){return new VA(e.a,e.b)}clone(){return new VA(this.a,this.b)}}class Qze{constructor(){this.functions=new Array}findFunction(e){let i=0,s=0,r=this.functions.length-1;for(;s+1<r;)if(i=Math.floor((s+r)/2),e<this.getStartX(i))r=i-1;else if(e>this.getEndX(i))s=i+1;else return i;for(let o=s;o<=r;o++)if(e>=this.functions[o][1]&&e<=this.getEndX(o))return o;return-1}getStartX(e){return this.functions[e][1]}setStartX(e,i){e>0&&(this.functions[e][1]=i)}getEndX(e){return e+1<this.functions.length?this.functions[e+1][1]:1}setEndX(e,i){e+1<this.functions.length&&(this.functions[e+1][1]=i)}insertFunction(e,i){const s=this.findFunction(e);this.functions.splice(s+1,0,[i,e])}removeFunction(e){return this.functions.splice(e,1)[0][0]}getFunction(e){return this.functions[e][0]}setFunction(e,i){this.functions[e][0]=i}get numOfFunctions(){return this.functions.length}}class lM extends Qze{constructor(e=[[new PA(0,1/3,1/3*2,1),0]]){super(),this.type="function",this.functions=e}genValue(e,i=0){const s=this.findFunction(i);return s===-1?0:this.functions[s][0].genValue((i-this.getStartX(s))/(this.getEndX(s)-this.getStartX(s)))}toSVG(e,i){if(i<1)return"";let s=["M",0,this.functions[0][0].p[0]].join(" ");for(let r=1/i;r<=1;r+=1/i)s=[s,"L",r*e,this.genValue(void 0,r)].join(" ");return s}toJSON(){return{type:"PiecewiseBezier",functions:this.functions.map(([e,i])=>({function:e.toJSON(),start:i}))}}static fromJSON(e){return new lM(e.functions.map(i=>[PA.fromJSON(i.function),i.start]))}clone(){return new lM(this.functions.map(([e,i])=>[e.clone(),i]))}startGen(e){}}function Ui(n){switch(n.type){case"ConstantValue":return cn.fromJSON(n);case"IntervalValue":return VA.fromJSON(n);case"PiecewiseBezier":return lM.fromJSON(n);default:return new cn(0)}}class cM{constructor(){this.indexCount=0,this.type="rotation"}startGen(e){this.indexCount=e.length,e.push(new On);let i,s,r,o,a,l;do i=Math.random()*2-1,s=Math.random()*2-1,r=i*i+s*s;while(r>1);do o=Math.random()*2-1,a=Math.random()*2-1,l=o*o+a*a;while(l>1);const c=Math.sqrt((1-r)/l);e[this.indexCount].set(i,s,c*o,c*a)}genValue(e,i,s,r){return this.indexCount===-1&&this.startGen(e),i.copy(e[this.indexCount]),i}toJSON(){return{type:"RandomQuat"}}static fromJSON(e){return new cM}clone(){return new cM}}class hM{constructor(e,i){this.axis=e,this.angle=i,this.type="rotation"}startGen(e){this.angle.startGen(e)}genValue(e,i,s,r){return i.setFromAxisAngle(this.axis,this.angle.genValue(e,r)*s)}toJSON(){return{type:"AxisAngle",axis:{x:this.axis.x,y:this.axis.y,z:this.axis.z},angle:this.angle.toJSON()}}static fromJSON(e){return new hM(new Dt(e.axis.x,e.axis.y,e.axis.z),Ui(e.angle))}clone(){return new hM(this.axis.clone(),this.angle.clone())}}class Kk{constructor(e,i,s,r){this.angleX=e,this.angleY=i,this.angleZ=s,this.type="rotation",this.eular=new aM(0,0,0,r)}startGen(e){this.angleX.startGen(e),this.angleY.startGen(e),this.angleZ.startGen(e)}genValue(e,i,s,r){return this.eular.set(this.angleX.genValue(e,r)*s,this.angleY.genValue(e,r)*s,this.angleZ.genValue(e,r)*s),i.setFromEuler(this.eular)}toJSON(){return{type:"Euler",angleX:this.angleX.toJSON(),angleY:this.angleY.toJSON(),angleZ:this.angleZ.toJSON(),eulerOrder:this.eular.order}}static fromJSON(e){return new Kk(Ui(e.angleX),Ui(e.angleY),Ui(e.angleZ),e.eulerOrder)}clone(){return new Kk(this.angleX,this.angleY,this.angleZ,this.eular.order)}}function Zre(n){switch(n.type){case"AxisAngle":return hM.fromJSON(n);case"Euler":return Kk.fromJSON(n);case"RandomQuat":return cM.fromJSON(n);default:return new cM}}class XA{constructor(e,i,s){this.x=e,this.y=i,this.z=s,this.type="vec3function"}startGen(e){this.x.startGen(e),this.y.startGen(e),this.z.startGen(e)}genValue(e,i,s){return i.set(this.x.genValue(e,s),this.y.genValue(e,s),this.z.genValue(e,s))}toJSON(){return{type:"Vector3Function",x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}static fromJSON(e){return new XA(Ui(e.x),Ui(e.y),Ui(e.z))}clone(){return new XA(this.x,this.y,this.z)}}function Kze(n){switch(n.type){case"Vector3Function":return XA.fromJSON(n);default:return new XA(new cn(0),new cn(0),new cn(0))}}function kB(n){switch(n.type){case"ConstantValue":case"IntervalValue":case"PiecewiseBezier":return Ui(n);case"AxisAngle":case"RandomQuat":case"Euler":return Zre(n);case"Vector3Function":return Kze(n);default:return new cn(0)}}class dM{constructor(e={}){var i,s,r,o,a,l,c;this.type="cone",this.currentValue=0,this.radius=(i=e.radius)!==null&&i!==void 0?i:10,this.arc=(s=e.arc)!==null&&s!==void 0?s:2*Math.PI,this.thickness=(r=e.thickness)!==null&&r!==void 0?r:1,this.angle=(o=e.angle)!==null&&o!==void 0?o:Math.PI/6,this.mode=(a=e.mode)!==null&&a!==void 0?a:Fa.Random,this.spread=(l=e.spread)!==null&&l!==void 0?l:0,this.speed=(c=e.speed)!==null&&c!==void 0?c:new cn(1),this.memory=[]}update(e,i){Fa.Random!=this.mode&&(this.currentValue+=this.speed.genValue(this.memory,e.emissionState.time/e.duration)*i)}initialize(e,i){const s=$S(this.mode,this.currentValue,this.spread,i),r=Hv.lerp(1-this.thickness,1,Math.random()),o=s*this.arc,a=Math.sqrt(r),l=Math.sin(o),c=Math.cos(o);e.position.x=a*c,e.position.y=a*l,e.position.z=0;const h=this.angle*a;e.velocity.set(0,0,Math.cos(h)).addScaledVector(e.position,Math.sin(h)).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius)}toJSON(){return{type:"cone",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new dM({radius:e.radius,arc:e.arc,thickness:e.thickness,angle:e.angle,mode:e.mode,speed:e.speed?Ui(e.speed):void 0,spread:e.spread})}clone(){return new dM({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class uM{constructor(e={}){var i,s,r,o,a,l;this.type="circle",this.currentValue=0,this.radius=(i=e.radius)!==null&&i!==void 0?i:10,this.arc=(s=e.arc)!==null&&s!==void 0?s:2*Math.PI,this.thickness=(r=e.thickness)!==null&&r!==void 0?r:1,this.mode=(o=e.mode)!==null&&o!==void 0?o:Fa.Random,this.spread=(a=e.spread)!==null&&a!==void 0?a:0,this.speed=(l=e.speed)!==null&&l!==void 0?l:new cn(1),this.memory=[]}update(e,i){this.currentValue+=this.speed.genValue(this.memory,e.emissionState.time/e.duration)*i}initialize(e,i){const s=$S(this.mode,this.currentValue,this.spread,i),r=Hv.lerp(1-this.thickness,1,Math.random()),o=s*this.arc;e.position.x=Math.cos(o),e.position.y=Math.sin(o),e.position.z=0,e.velocity.copy(e.position).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius*r)}toJSON(){return{type:"circle",radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new uM({radius:e.radius,arc:e.arc,thickness:e.thickness,mode:e.mode,speed:e.speed?Ui(e.speed):void 0,spread:e.spread})}clone(){return new uM({radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class pM{constructor(e={}){var i,s,r,o,a,l,c;this.type="donut",this.currentValue=0,this.radius=(i=e.radius)!==null&&i!==void 0?i:10,this.arc=(s=e.arc)!==null&&s!==void 0?s:2*Math.PI,this.thickness=(r=e.thickness)!==null&&r!==void 0?r:1,this.donutRadius=(o=e.donutRadius)!==null&&o!==void 0?o:this.radius*.2,this.mode=(a=e.mode)!==null&&a!==void 0?a:Fa.Random,this.spread=(l=e.spread)!==null&&l!==void 0?l:0,this.speed=(c=e.speed)!==null&&c!==void 0?c:new cn(1),this.memory=[]}update(e,i){Fa.Random!=this.mode&&(this.currentValue+=this.speed.genValue(this.memory,e.emissionState.time/e.duration)*i)}initialize(e,i){const s=$S(this.mode,this.currentValue,this.spread,i),r=Math.random(),o=Hv.lerp(1-this.thickness,1,Math.random()),a=s*this.arc,l=r*Math.PI*2,c=Math.sin(a),h=Math.cos(a);e.position.x=this.radius*h,e.position.y=this.radius*c,e.position.z=0,e.velocity.z=this.donutRadius*o*Math.sin(l),e.velocity.x=this.donutRadius*o*Math.cos(l)*h,e.velocity.y=this.donutRadius*o*Math.cos(l)*c,e.position.add(e.velocity),e.velocity.normalize().multiplyScalar(e.startSpeed)}toJSON(){return{type:"donut",radius:this.radius,arc:this.arc,thickness:this.thickness,donutRadius:this.donutRadius,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new pM({radius:e.radius,arc:e.arc,thickness:e.thickness,donutRadius:e.donutRadius,mode:e.mode,speed:e.speed?Ui(e.speed):void 0,spread:e.spread})}clone(){return new pM({radius:this.radius,arc:this.arc,thickness:this.thickness,donutRadius:this.donutRadius,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class mM{constructor(){this.type="point"}update(e,i){}initialize(e){const i=Math.random(),s=Math.random(),r=i*Math.PI*2,o=Math.acos(2*s-1),a=Math.cbrt(Math.random()),l=Math.sin(r),c=Math.cos(r),h=Math.sin(o),d=Math.cos(o);e.velocity.x=a*h*c,e.velocity.y=a*h*l,e.velocity.z=a*d,e.velocity.multiplyScalar(e.startSpeed),e.position.setScalar(0)}toJSON(){return{type:"point"}}static fromJSON(e){return new mM}clone(){return new mM}}class Ix{constructor(e={}){var i,s,r,o,a,l;this.type="sphere",this.currentValue=0,this.radius=(i=e.radius)!==null&&i!==void 0?i:10,this.arc=(s=e.arc)!==null&&s!==void 0?s:2*Math.PI,this.thickness=(r=e.thickness)!==null&&r!==void 0?r:1,this.mode=(o=e.mode)!==null&&o!==void 0?o:Fa.Random,this.spread=(a=e.spread)!==null&&a!==void 0?a:0,this.speed=(l=e.speed)!==null&&l!==void 0?l:new cn(1),this.memory=[]}update(e,i){Fa.Random!=this.mode&&(this.currentValue+=this.speed.genValue(this.memory,e.emissionState.time/e.duration)*i)}initialize(e,i){const s=$S(this.mode,this.currentValue,this.spread,i),r=Math.random(),o=Hv.lerp(1-this.thickness,1,Math.random()),a=s*this.arc,l=Math.acos(2*r-1),c=Math.sin(a),h=Math.cos(a),d=Math.sin(l),u=Math.cos(l);e.position.x=d*h,e.position.y=d*c,e.position.z=u,e.velocity.copy(e.position).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius*o)}toJSON(){return{type:"sphere",radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new Ix({radius:e.radius,arc:e.arc,thickness:e.thickness,mode:e.mode,speed:e.speed?Ui(e.speed):void 0,spread:e.spread})}clone(){return new Ix({radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class gM{constructor(e={}){var i,s,r,o,a,l;this.type="sphere",this.currentValue=0,this.radius=(i=e.radius)!==null&&i!==void 0?i:10,this.arc=(s=e.arc)!==null&&s!==void 0?s:2*Math.PI,this.thickness=(r=e.thickness)!==null&&r!==void 0?r:1,this.mode=(o=e.mode)!==null&&o!==void 0?o:Fa.Random,this.spread=(a=e.spread)!==null&&a!==void 0?a:0,this.speed=(l=e.speed)!==null&&l!==void 0?l:new cn(1),this.memory=[]}update(e,i){Fa.Random!=this.mode&&(this.currentValue+=this.speed.genValue(this.memory,e.emissionState.time/e.duration)*i)}initialize(e,i){const s=$S(this.mode,this.currentValue,this.spread,i),r=Math.random(),o=Hv.lerp(1-this.thickness,1,Math.random()),a=s*this.arc,l=Math.acos(r),c=Math.sin(a),h=Math.cos(a),d=Math.sin(l),u=Math.cos(l);e.position.x=d*h,e.position.y=d*c,e.position.z=u,e.velocity.copy(e.position).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius*o)}toJSON(){return{type:"hemisphere",radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new gM({radius:e.radius,arc:e.arc,thickness:e.thickness,mode:e.mode,speed:e.speed?Ui(e.speed):void 0,spread:e.spread})}clone(){return new gM({radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class fM{constructor(e={}){var i,s,r,o;this.type="grid",this.width=(i=e.width)!==null&&i!==void 0?i:1,this.height=(s=e.height)!==null&&s!==void 0?s:1,this.column=(r=e.column)!==null&&r!==void 0?r:10,this.row=(o=e.row)!==null&&o!==void 0?o:10}initialize(e){const i=Math.floor(Math.random()*this.row),s=Math.floor(Math.random()*this.column);e.position.x=s*this.width/this.column-this.width/2,e.position.y=i*this.height/this.row-this.height/2,e.position.z=0,e.velocity.set(0,0,e.startSpeed)}toJSON(){return{type:"grid",width:this.width,height:this.height,column:this.column,row:this.row}}static fromJSON(e){return new fM(e)}clone(){return new fM({width:this.width,height:this.height,column:this.column,row:this.row})}update(e,i){}}const K3={circle:{type:"circle",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc"]]],constructor:uM,loadJSON:uM.fromJSON},cone:{type:"cone",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["angle",["radian"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc"]]],constructor:dM,loadJSON:dM.fromJSON},donut:{type:"donut",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["donutRadius",["number"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc"]]],constructor:pM,loadJSON:pM.fromJSON},point:{type:"point",params:[],constructor:mM,loadJSON:mM.fromJSON},sphere:{type:"sphere",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["angle",["radian"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc"]]],constructor:Ix,loadJSON:Ix.fromJSON},hemisphere:{type:"hemisphere",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["angle",["radian"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc"]]],constructor:gM,loadJSON:gM.fromJSON},grid:{type:"grid",params:[["width",["number"]],["height",["number"]],["rows",["number"]],["column",["number"]]],constructor:fM,loadJSON:fM.fromJSON}};function Yze(n,e){return K3[n.type].loadJSON(n,e)}class AM{constructor(e){this.color=e,this.type="ColorOverLife"}initialize(e){this.color.startGen(e.memory)}update(e,i){this.color.genColor(e.memory,e.color,e.age/e.life),e.color.x*=e.startColor.x,e.color.y*=e.startColor.y,e.color.z*=e.startColor.z,e.color.w*=e.startColor.w}frameUpdate(e){}toJSON(){return{type:this.type,color:this.color.toJSON()}}static fromJSON(e){return new AM(Q3(e.color))}clone(){return new AM(this.color.clone())}reset(){}}class yM{constructor(e){this.angularVelocity=e,this.type="RotationOverLife"}initialize(e){typeof e.rotation=="number"&&this.angularVelocity.startGen(e.memory)}update(e,i){typeof e.rotation=="number"&&(e.rotation+=i*this.angularVelocity.genValue(e.memory,e.age/e.life))}toJSON(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON()}}static fromJSON(e){return new yM(Ui(e.angularVelocity))}frameUpdate(e){}clone(){return new yM(this.angularVelocity.clone())}reset(){}}class bM{constructor(e){this.angularVelocity=e,this.type="Rotation3DOverLife",this.tempQuat=new On,this.tempQuat2=new On}initialize(e){e.rotation instanceof On&&(e.angularVelocity=new On,this.angularVelocity.startGen(e.memory))}update(e,i){e.rotation instanceof On&&(this.angularVelocity.genValue(e.memory,this.tempQuat,i,e.age/e.life),e.rotation.multiply(this.tempQuat))}toJSON(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON()}}static fromJSON(e){return new bM(Zre(e.angularVelocity))}frameUpdate(e){}clone(){return new bM(this.angularVelocity.clone())}reset(){}}class vM{initialize(e,i){this.ps=i,this.x.startGen(e.memory),this.y.startGen(e.memory),this.z.startGen(e.memory)}constructor(e,i,s){this.x=e,this.y=i,this.z=s,this.type="ForceOverLife",this._temp=new Dt,this._tempScale=new Dt,this._tempQ=new On}update(e,i){this._temp.set(this.x.genValue(e.memory,e.age/e.life),this.y.genValue(e.memory,e.age/e.life),this.z.genValue(e.memory,e.age/e.life)),this.ps.worldSpace?e.velocity.addScaledVector(this._temp,i):(this._temp.multiply(this._tempScale).applyQuaternion(this._tempQ),e.velocity.addScaledVector(this._temp,i))}toJSON(){return{type:this.type,x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}static fromJSON(e){return new vM(Ui(e.x),Ui(e.y),Ui(e.z))}frameUpdate(e){if(this.ps&&!this.ps.worldSpace){const i=this._temp,s=this._tempQ,r=this._tempScale;this.ps.emitter.matrixWorld.decompose(i,s,r),s.invert(),r.set(1/r.x,1/r.y,1/r.z)}}clone(){return new vM(this.x.clone(),this.y.clone(),this.z.clone())}reset(){}}class xM{initialize(e){this.size.startGen(e.memory)}constructor(e){this.size=e,this.type="SizeOverLife"}update(e){this.size instanceof XA?this.size.genValue(e.memory,e.size,e.age/e.life).multiply(e.startSize):e.size.copy(e.startSize).multiplyScalar(this.size.genValue(e.memory,e.age/e.life))}toJSON(){return{type:this.type,size:this.size.toJSON()}}static fromJSON(e){return new xM(kB(e.size))}frameUpdate(e){}clone(){return new xM(this.size.clone())}reset(){}}class wM{initialize(e){this.speed.startGen(e.memory)}constructor(e){this.speed=e,this.type="SpeedOverLife"}update(e){e.speedModifier=this.speed.genValue(e.memory,e.age/e.life)}toJSON(){return{type:this.type,speed:this.speed.toJSON()}}static fromJSON(e){return new wM(Ui(e.speed))}frameUpdate(e){}clone(){return new wM(this.speed.clone())}reset(){}}class CM{constructor(e){this.frame=e,this.type="FrameOverLife"}initialize(e){this.frame.startGen(e.memory)}update(e,i){this.frame instanceof lM&&(e.uvTile=this.frame.genValue(e.memory,e.age/e.life))}frameUpdate(e){}toJSON(){return{type:this.type,frame:this.frame.toJSON()}}static fromJSON(e){return new CM(Ui(e.frame))}clone(){return new CM(this.frame.clone())}reset(){}}new Dt(0,0,1);class SM{constructor(e,i=new Dt(0,1,0)){this.orbitSpeed=e,this.axis=i,this.type="OrbitOverLife",this.temp=new Dt,this.rotation=new On}initialize(e){this.orbitSpeed.startGen(e.memory)}update(e,i){this.temp.copy(e.position).projectOnVector(this.axis),this.rotation.setFromAxisAngle(this.axis,this.orbitSpeed.genValue(e.memory,e.age/e.life)*i),e.position.sub(this.temp),e.position.applyQuaternion(this.rotation),e.position.add(this.temp)}frameUpdate(e){}toJSON(){return{type:this.type,orbitSpeed:this.orbitSpeed.toJSON(),axis:[this.axis.x,this.axis.y,this.axis.z]}}static fromJSON(e){return new SM(Ui(e.orbitSpeed),e.axis?new Dt(e.axis[0],e.axis[1],e.axis[2]):void 0)}clone(){return new SM(this.orbitSpeed.clone())}reset(){}}class Y3{constructor(e){this.data=e,this.next=null,this.prev=null}hasPrev(){return this.prev!==null}hasNext(){return this.next!==null}}class jze{constructor(){this.length=0,this.head=this.tail=null}isEmpty(){return this.head===null}clear(){this.length=0,this.head=this.tail=null}front(){return this.head===null?null:this.head.data}back(){return this.tail===null?null:this.tail.data}dequeue(){if(this.head){const e=this.head.data;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}}pop(){if(this.tail){const e=this.tail.data;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}}queue(e){const i=new Y3(e);this.tail||(this.tail=i),this.head&&(this.head.prev=i,i.next=this.head),this.head=i,this.length++}push(e){const i=new Y3(e);this.head||(this.head=i),this.tail&&(this.tail.next=i,i.prev=this.tail),this.tail=i,this.length++}insertBefore(e,i){const s=new Y3(i);s.next=e,s.prev=e.prev,s.prev!==null&&(s.prev.next=s),s.next.prev=s,e==this.head&&(this.head=s),this.length++}remove(e){if(this.head===null||this.tail===null)return;let i=this.head;for(e===this.head.data&&(this.head=this.head.next),e===this.tail.data&&(this.tail=this.tail.prev);i.next!==null&&i.data!==e;)i=i.next;i.data===e&&(i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.length--)}*values(){let e=this.head;for(;e!==null;)yield e.data,e=e.next}}class Jze{constructor(){this.startSpeed=0,this.startColor=new Al,this.startSize=new Dt(1,1,1),this.position=new Dt,this.velocity=new Dt,this.age=0,this.life=1,this.size=new Dt(1,1,1),this.speedModifier=1,this.rotation=0,this.color=new Al,this.uvTile=0,this.memory=[]}get died(){return this.age>=this.life}reset(){this.memory.length=0}}class qze{constructor(e,i,s){this.position=e,this.size=i,this.color=s}}class i_{constructor(){this.startSpeed=0,this.startColor=new Al,this.startSize=new Dt(1,1,1),this.position=new Dt,this.velocity=new Dt,this.age=0,this.life=1,this.size=new Dt(1,1,1),this.length=100,this.speedModifier=1,this.color=new Al,this.previous=new jze,this.uvTile=0,this.memory=[]}update(){for(this.age<=this.life?this.previous.push(new qze(this.position.clone(),this.size.x,this.color.clone())):this.previous.length>0&&this.previous.dequeue();this.previous.length>this.length;)this.previous.dequeue()}get died(){return this.age>=this.life}reset(){this.memory.length=0,this.previous.clear()}}class _M{initialize(e){this.width.startGen(e.memory)}constructor(e){this.width=e,this.type="WidthOverLength"}update(e){if(e instanceof i_){const i=e.previous.values();for(let s=0;s<e.previous.length;s++){const r=i.next();r.value.size=this.width.genValue(e.memory,(e.previous.length-s)/e.length)}}}frameUpdate(e){}toJSON(){return{type:this.type,width:this.width.toJSON()}}static fromJSON(e){return new _M(Ui(e.width))}clone(){return new _M(this.width.clone())}reset(){}}class MM{constructor(e,i){this.direction=e,this.magnitude=i,this.type="ApplyForce",this.memory={data:[],dataCount:0},this.magnitudeValue=this.magnitude.genValue(this.memory)}initialize(e){}update(e,i){e.velocity.addScaledVector(this.direction,this.magnitudeValue*i)}frameUpdate(e){this.magnitudeValue=this.magnitude.genValue(this.memory)}toJSON(){return{type:this.type,direction:[this.direction.x,this.direction.y,this.direction.z],magnitude:this.magnitude.toJSON()}}static fromJSON(e){var i;return new MM(new Dt(e.direction[0],e.direction[1],e.direction[2]),Ui((i=e.magnitude)!==null&&i!==void 0?i:e.force))}clone(){return new MM(this.direction.clone(),this.magnitude.clone())}reset(){}}class IM{constructor(e,i){this.center=e,this.magnitude=i,this.type="GravityForce",this.temp=new Dt}initialize(e){}update(e,i){this.temp.copy(this.center).sub(e.position).normalize(),e.velocity.addScaledVector(this.temp,this.magnitude/e.position.distanceToSquared(this.center)*i)}frameUpdate(e){}toJSON(){return{type:this.type,center:[this.center.x,this.center.y,this.center.z],magnitude:this.magnitude}}static fromJSON(e){return new IM(new Dt(e.center[0],e.center[1],e.center[2]),e.magnitude)}clone(){return new IM(this.center.clone(),this.magnitude)}reset(){}}new Dt(0,0,1);class TM{constructor(e){this.angle=e,this.type="ChangeEmitDirection",this._temp=new Dt,this._q=new On,this.memory={data:[],dataCount:0}}initialize(e){const i=e.velocity.length();i!=0&&(e.velocity.normalize(),e.velocity.x===0&&e.velocity.y===0?this._temp.set(0,e.velocity.z,0):this._temp.set(-e.velocity.y,e.velocity.x,0),this.angle.startGen(this.memory),this._q.setFromAxisAngle(this._temp.normalize(),this.angle.genValue(this.memory)),this._temp.copy(e.velocity),e.velocity.applyQuaternion(this._q),this._q.setFromAxisAngle(this._temp,Math.random()*Math.PI*2),e.velocity.applyQuaternion(this._q),e.velocity.setLength(i))}update(e,i){}frameUpdate(e){}toJSON(){return{type:this.type,angle:this.angle.toJSON()}}static fromJSON(e){return new TM(Ui(e.angle))}clone(){return new TM(this.angle)}reset(){}}const $ze=new Dt(1,1,1),Wre=new Dt(0,0,1);var Kv;(function(n){n[n.Death=0]="Death",n[n.Birth=1]="Birth",n[n.Frame=2]="Frame"})(Kv||(Kv={}));class EM{constructor(e,i,s,r=Kv.Frame,o=1){this.particleSystem=e,this.useVelocityAsBasis=i,this.subParticleSystem=s,this.mode=r,this.emitProbability=o,this.type="EmitSubParticleSystem",this.q_=new On,this.v_=new Dt,this.v2_=new Dt,this.subEmissions=new Array,this.subParticleSystem&&this.subParticleSystem.system&&(this.subParticleSystem.system.onlyUsedByOther=!0)}initialize(e){}update(e,i){this.mode===Kv.Frame?this.emit(e,i):this.mode===Kv.Birth&&e.age===0?this.emit(e,i):this.mode===Kv.Death&&e.age+i>=e.life&&this.emit(e,i)}emit(e,i){if(!this.subParticleSystem||Math.random()>this.emitProbability)return;const s=new Up;this.setMatrixFromParticle(s,e),this.subEmissions.push({burstParticleCount:0,burstParticleIndex:0,isBursting:!1,burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,matrix:s,travelDistance:0,particle:e})}frameUpdate(e){if(this.subParticleSystem)for(let i=0;i<this.subEmissions.length;i++)if(this.subEmissions[i].time>=this.subParticleSystem.system.duration)this.subEmissions[i]=this.subEmissions[this.subEmissions.length-1],this.subEmissions.length=this.subEmissions.length-1,i--;else{const s=this.subEmissions[i];s.particle&&s.particle.age<s.particle.life?this.setMatrixFromParticle(s.matrix,s.particle):s.particle=void 0,this.subParticleSystem.system.emit(e,s,s.matrix)}}toJSON(){return{type:this.type,subParticleSystem:this.subParticleSystem?this.subParticleSystem.uuid:"",useVelocityAsBasis:this.useVelocityAsBasis,mode:this.mode,emitProbability:this.emitProbability}}static fromJSON(e,i){return new EM(i,e.useVelocityAsBasis,e.subParticleSystem,e.mode,e.emitProbability)}clone(){return new EM(this.particleSystem,this.useVelocityAsBasis,this.subParticleSystem,this.mode,this.emitProbability)}reset(){}setMatrixFromParticle(e,i){let s;if(i.rotation===void 0||this.useVelocityAsBasis)if(i.velocity.x===0&&i.velocity.y===0&&(i.velocity.z===1||i.velocity.z===0))e.set(1,0,0,i.position.x,0,1,0,i.position.y,0,0,1,i.position.z,0,0,0,1);else{this.v_.copy(Wre).cross(i.velocity),this.v2_.copy(i.velocity).cross(this.v_);const r=this.v_.length(),o=this.v2_.length();e.set(this.v_.x/r,this.v2_.x/o,i.velocity.x,i.position.x,this.v_.y/r,this.v2_.y/o,i.velocity.y,i.position.y,this.v_.z/r,this.v2_.z/o,i.velocity.z,i.position.z,0,0,0,1)}else i.rotation instanceof On?s=i.rotation:(this.q_.setFromAxisAngle(Wre,i.rotation),s=this.q_),e.compose(i.position,s,$ze);this.particleSystem.worldSpace||e.multiplyMatrices(this.particleSystem.emitter.matrixWorld,e)}}const eFe=.5*(Math.sqrt(3)-1),n_=(3-Math.sqrt(3))/6,tFe=1/3,au=1/6,iFe=(Math.sqrt(5)-1)/4,Xo=(5-Math.sqrt(5))/20,to=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),ur=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class Hre{constructor(e=Math.random){const i=typeof e=="function"?e:sFe(e);this.p=nFe(i),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let s=0;s<512;s++)this.perm[s]=this.p[s&255],this.permMod12[s]=this.perm[s]%12}noise2D(e,i){const s=this.permMod12,r=this.perm;let o=0,a=0,l=0;const c=(e+i)*eFe,h=Math.floor(e+c),d=Math.floor(i+c),u=(h+d)*n_,p=h-u,g=d-u,f=e-p,A=i-g;let y,b;f>A?(y=1,b=0):(y=0,b=1);const v=f-y+n_,x=A-b+n_,w=f-1+2*n_,C=A-1+2*n_,S=h&255,_=d&255;let I=.5-f*f-A*A;if(I>=0){const R=s[S+r[_]]*3;I*=I,o=I*I*(to[R]*f+to[R+1]*A)}let B=.5-v*v-x*x;if(B>=0){const R=s[S+y+r[_+b]]*3;B*=B,a=B*B*(to[R]*v+to[R+1]*x)}let M=.5-w*w-C*C;if(M>=0){const R=s[S+1+r[_+1]]*3;M*=M,l=M*M*(to[R]*w+to[R+1]*C)}return 70*(o+a+l)}noise3D(e,i,s){const r=this.permMod12,o=this.perm;let a,l,c,h;const d=(e+i+s)*tFe,u=Math.floor(e+d),p=Math.floor(i+d),g=Math.floor(s+d),f=(u+p+g)*au,A=u-f,y=p-f,b=g-f,v=e-A,x=i-y,w=s-b;let C,S,_,I,B,M;v>=x?x>=w?(C=1,S=0,_=0,I=1,B=1,M=0):v>=w?(C=1,S=0,_=0,I=1,B=0,M=1):(C=0,S=0,_=1,I=1,B=0,M=1):x<w?(C=0,S=0,_=1,I=0,B=1,M=1):v<w?(C=0,S=1,_=0,I=0,B=1,M=1):(C=0,S=1,_=0,I=1,B=1,M=0);const R=v-C+au,k=x-S+au,G=w-_+au,X=v-I+2*au,F=x-B+2*au,z=w-M+2*au,H=v-1+3*au,Z=x-1+3*au,he=w-1+3*au,be=u&255,_e=p&255,Ye=g&255;let je=.6-v*v-x*x-w*w;if(je<0)a=0;else{const ke=r[be+o[_e+o[Ye]]]*3;je*=je,a=je*je*(to[ke]*v+to[ke+1]*x+to[ke+2]*w)}let le=.6-R*R-k*k-G*G;if(le<0)l=0;else{const ke=r[be+C+o[_e+S+o[Ye+_]]]*3;le*=le,l=le*le*(to[ke]*R+to[ke+1]*k+to[ke+2]*G)}let ve=.6-X*X-F*F-z*z;if(ve<0)c=0;else{const ke=r[be+I+o[_e+B+o[Ye+M]]]*3;ve*=ve,c=ve*ve*(to[ke]*X+to[ke+1]*F+to[ke+2]*z)}let Pe=.6-H*H-Z*Z-he*he;if(Pe<0)h=0;else{const ke=r[be+1+o[_e+1+o[Ye+1]]]*3;Pe*=Pe,h=Pe*Pe*(to[ke]*H+to[ke+1]*Z+to[ke+2]*he)}return 32*(a+l+c+h)}noise4D(e,i,s,r){const o=this.perm;let a,l,c,h,d;const u=(e+i+s+r)*iFe,p=Math.floor(e+u),g=Math.floor(i+u),f=Math.floor(s+u),A=Math.floor(r+u),y=(p+g+f+A)*Xo,b=p-y,v=g-y,x=f-y,w=A-y,C=e-b,S=i-v,_=s-x,I=r-w;let B=0,M=0,R=0,k=0;C>S?B++:M++,C>_?B++:R++,C>I?B++:k++,S>_?M++:R++,S>I?M++:k++,_>I?R++:k++;const G=B>=3?1:0,X=M>=3?1:0,F=R>=3?1:0,z=k>=3?1:0,H=B>=2?1:0,Z=M>=2?1:0,he=R>=2?1:0,be=k>=2?1:0,_e=B>=1?1:0,Ye=M>=1?1:0,je=R>=1?1:0,le=k>=1?1:0,ve=C-G+Xo,Pe=S-X+Xo,ke=_-F+Xo,_t=I-z+Xo,rt=C-H+2*Xo,xt=S-Z+2*Xo,Re=_-he+2*Xo,ze=I-be+2*Xo,U=C-_e+3*Xo,ot=S-Ye+3*Xo,Ne=_-je+3*Xo,yt=I-le+3*Xo,ye=C-1+4*Xo,zt=S-1+4*Xo,Ct=_-1+4*Xo,O=I-1+4*Xo,N=p&255,ce=g&255,Ee=f&255,He=A&255;let Le=.6-C*C-S*S-_*_-I*I;if(Le<0)a=0;else{const Ge=o[N+o[ce+o[Ee+o[He]]]]%32*4;Le*=Le,a=Le*Le*(ur[Ge]*C+ur[Ge+1]*S+ur[Ge+2]*_+ur[Ge+3]*I)}let bt=.6-ve*ve-Pe*Pe-ke*ke-_t*_t;if(bt<0)l=0;else{const Ge=o[N+G+o[ce+X+o[Ee+F+o[He+z]]]]%32*4;bt*=bt,l=bt*bt*(ur[Ge]*ve+ur[Ge+1]*Pe+ur[Ge+2]*ke+ur[Ge+3]*_t)}let nt=.6-rt*rt-xt*xt-Re*Re-ze*ze;if(nt<0)c=0;else{const Ge=o[N+H+o[ce+Z+o[Ee+he+o[He+be]]]]%32*4;nt*=nt,c=nt*nt*(ur[Ge]*rt+ur[Ge+1]*xt+ur[Ge+2]*Re+ur[Ge+3]*ze)}let mt=.6-U*U-ot*ot-Ne*Ne-yt*yt;if(mt<0)h=0;else{const Ge=o[N+_e+o[ce+Ye+o[Ee+je+o[He+le]]]]%32*4;mt*=mt,h=mt*mt*(ur[Ge]*U+ur[Ge+1]*ot+ur[Ge+2]*Ne+ur[Ge+3]*yt)}let ii=.6-ye*ye-zt*zt-Ct*Ct-O*O;if(ii<0)d=0;else{const Ge=o[N+1+o[ce+1+o[Ee+1+o[He+1]]]]%32*4;ii*=ii,d=ii*ii*(ur[Ge]*ye+ur[Ge+1]*zt+ur[Ge+2]*Ct+ur[Ge+3]*O)}return 27*(a+l+c+h+d)}}function nFe(n){const e=new Uint8Array(256);for(let i=0;i<256;i++)e[i]=i;for(let i=0;i<255;i++){const s=i+~~(n()*(256-i)),r=e[i];e[i]=e[s],e[s]=r}return e}function sFe(n){let e=0,i=0,s=0,r=1;const o=rFe();return e=o(" "),i=o(" "),s=o(" "),e-=o(n),e<0&&(e+=1),i-=o(n),i<0&&(i+=1),s-=o(n),s<0&&(s+=1),function(){const a=2091639*e+r*23283064365386963e-26;return e=i,i=s,s=a-(r=a|0)}}function rFe(){let n=4022871197;return function(e){e=e.toString();for(let i=0;i<e.length;i++){n+=e.charCodeAt(i);let s=.02519603282416938*n;n=s>>>0,s-=n,s*=n,n=s>>>0,s-=n,n+=s*4294967296}return(n>>>0)*23283064365386963e-26}}class RM{constructor(e,i,s,r){this.scale=e,this.octaves=i,this.velocityMultiplier=s,this.timeScale=r,this.type="TurbulenceField",this.generator=new Hre,this.timeOffset=new Dt,this.temp=new Dt,this.temp2=new Dt,this.timeOffset.x=Math.random()/this.scale.x*this.timeScale.x,this.timeOffset.y=Math.random()/this.scale.y*this.timeScale.y,this.timeOffset.z=Math.random()/this.scale.z*this.timeScale.z}initialize(e){}update(e,i){const s=e.position.x/this.scale.x,r=e.position.y/this.scale.y,o=e.position.z/this.scale.z;this.temp.set(0,0,0);let a=1;for(let l=0;l<this.octaves;l++)this.temp2.set(this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.x*a)/a,this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.y*a)/a,this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.z*a)/a),this.temp.add(this.temp2),a*=2;this.temp.multiply(this.velocityMultiplier),e.velocity.addScaledVector(this.temp,i)}toJSON(){return{type:this.type,scale:[this.scale.x,this.scale.y,this.scale.z],octaves:this.octaves,velocityMultiplier:[this.velocityMultiplier.x,this.velocityMultiplier.y,this.velocityMultiplier.z],timeScale:[this.timeScale.x,this.timeScale.y,this.timeScale.z]}}frameUpdate(e){this.timeOffset.x+=e*this.timeScale.x,this.timeOffset.y+=e*this.timeScale.y,this.timeOffset.z+=e*this.timeScale.z}static fromJSON(e){return new RM(new Dt(e.scale[0],e.scale[1],e.scale[2]),e.octaves,new Dt(e.velocityMultiplier[0],e.velocityMultiplier[1],e.velocityMultiplier[2]),new Dt(e.timeScale[0],e.timeScale[1],e.timeScale[2]))}clone(){return new RM(this.scale.clone(),this.octaves,this.velocityMultiplier.clone(),this.timeScale.clone())}reset(){}}function GB(n,e){return Math.floor(Math.random()*(e-n))+n}const lu=[],j3=new Dt,J3=new On;class LM{constructor(e,i,s=new cn(1),r=new cn(0)){if(this.frequency=e,this.power=i,this.positionAmount=s,this.rotationAmount=r,this.type="Noise",this.duration=0,lu.length===0)for(let o=0;o<100;o++)lu.push(new Hre)}initialize(e){e.lastPosNoise=new Dt,typeof e.rotation=="number"?e.lastRotNoise=0:e.lastRotNoise=new On,e.generatorIndex=[GB(0,100),GB(0,100),GB(0,100),GB(0,100)],this.positionAmount.startGen(e.memory),this.rotationAmount.startGen(e.memory),this.frequency.startGen(e.memory),this.power.startGen(e.memory)}update(e,i){let s=this.frequency.genValue(e.memory,e.age/e.life),r=this.power.genValue(e.memory,e.age/e.life),o=this.positionAmount.genValue(e.memory,e.age/e.life),a=this.rotationAmount.genValue(e.memory,e.age/e.life);o>0&&e.lastPosNoise!==void 0&&(e.position.sub(e.lastPosNoise),j3.set(lu[e.generatorIndex[0]].noise2D(0,e.age*s)*r*o,lu[e.generatorIndex[1]].noise2D(0,e.age*s)*r*o,lu[e.generatorIndex[2]].noise2D(0,e.age*s)*r*o),e.position.add(j3),e.lastPosNoise.copy(j3)),a>0&&e.lastRotNoise!==void 0&&(typeof e.rotation=="number"?(e.rotation-=e.lastRotNoise,e.rotation+=lu[e.generatorIndex[3]].noise2D(0,e.age*s)*Math.PI*r*a):(e.lastRotNoise.invert(),e.rotation.multiply(e.lastRotNoise),J3.set(lu[e.generatorIndex[0]].noise2D(0,e.age*s)*r*a,lu[e.generatorIndex[1]].noise2D(0,e.age*s)*r*a,lu[e.generatorIndex[2]].noise2D(0,e.age*s)*r*a,lu[e.generatorIndex[3]].noise2D(0,e.age*s)*r*a).normalize(),e.rotation.multiply(J3),e.lastRotNoise.copy(J3)))}toJSON(){return{type:this.type,frequency:this.frequency.toJSON(),power:this.power.toJSON(),positionAmount:this.positionAmount.toJSON(),rotationAmount:this.rotationAmount.toJSON()}}frameUpdate(e){this.duration+=e}static fromJSON(e){return new LM(Ui(e.frequency),Ui(e.power),Ui(e.positionAmount),Ui(e.rotationAmount))}clone(){return new LM(this.frequency.clone(),this.power.clone(),this.positionAmount.clone(),this.rotationAmount.clone())}reset(){}}class BM{constructor(e,i){this.color=e,this.speedRange=i,this.type="ColorBySpeed"}initialize(e){this.color.startGen(e.memory)}update(e,i){const s=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.color.genColor(e.memory,e.color,s),e.color.x*=e.startColor.x,e.color.y*=e.startColor.y,e.color.z*=e.startColor.z,e.color.w*=e.startColor.w}frameUpdate(e){}toJSON(){return{type:this.type,color:this.color.toJSON(),speedRange:this.speedRange.toJSON()}}static fromJSON(e){return new BM(Q3(e.color),VA.fromJSON(e.speedRange))}clone(){return new BM(this.color.clone(),this.speedRange.clone())}reset(){}}class kM{initialize(e){this.size.startGen(e.memory)}constructor(e,i){this.size=e,this.speedRange=i,this.type="SizeBySpeed"}update(e){const i=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.size instanceof XA?this.size.genValue(e.memory,e.size,i).multiply(e.startSize):e.size.copy(e.startSize).multiplyScalar(this.size.genValue(e.memory,i))}toJSON(){return{type:this.type,size:this.size.toJSON(),speedRange:this.speedRange.toJSON()}}static fromJSON(e){return new kM(kB(e.size),VA.fromJSON(e.speedRange))}frameUpdate(e){}clone(){return new kM(this.size.clone(),this.speedRange.clone())}reset(){}}class GM{constructor(e,i){this.angularVelocity=e,this.speedRange=i,this.type="RotationBySpeed",this.tempQuat=new On}initialize(e){typeof e.rotation=="number"&&this.angularVelocity.startGen(e.memory)}update(e,i){if(typeof e.rotation=="number"){const s=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);e.rotation+=i*this.angularVelocity.genValue(e.memory,s)}}toJSON(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),speedRange:this.speedRange.toJSON()}}static fromJSON(e){return new GM(Ui(e.angularVelocity),VA.fromJSON(e.speedRange))}frameUpdate(e){}clone(){return new GM(this.angularVelocity.clone(),this.speedRange.clone())}reset(){}}class PM{initialize(e){this.speed.startGen(e.memory)}constructor(e,i){this.speed=e,this.dampen=i,this.type="LimitSpeedOverLife"}update(e,i){let s=e.velocity.length(),r=this.speed.genValue(e.memory,e.age/e.life);if(s>r){const o=(s-r)/s;e.velocity.multiplyScalar(1-o*this.dampen*i*20)}}toJSON(){return{type:this.type,speed:this.speed.toJSON(),dampen:this.dampen}}static fromJSON(e){return new PM(Ui(e.speed),e.dampen)}frameUpdate(e){}clone(){return new PM(this.speed.clone(),this.dampen)}reset(){}}const q3={ApplyForce:{type:"ApplyForce",constructor:MM,params:[["direction",["vec3"]],["magnitude",["value"]]],loadJSON:MM.fromJSON},Noise:{type:"Noise",constructor:LM,params:[["frequency",["value"]],["power",["value"]],["positionAmount",["value"]],["rotationAmount",["value"]]],loadJSON:LM.fromJSON},TurbulenceField:{type:"TurbulenceField",constructor:RM,params:[["scale",["vec3"]],["octaves",["number"]],["velocityMultiplier",["vec3"]],["timeScale",["vec3"]]],loadJSON:RM.fromJSON},GravityForce:{type:"GravityForce",constructor:IM,params:[["center",["vec3"]],["magnitude",["number"]]],loadJSON:IM.fromJSON},ColorOverLife:{type:"ColorOverLife",constructor:AM,params:[["color",["colorFunc"]]],loadJSON:AM.fromJSON},RotationOverLife:{type:"RotationOverLife",constructor:yM,params:[["angularVelocity",["value","valueFunc"]]],loadJSON:yM.fromJSON},Rotation3DOverLife:{type:"Rotation3DOverLife",constructor:bM,params:[["angularVelocity",["rotationFunc"]]],loadJSON:bM.fromJSON},SizeOverLife:{type:"SizeOverLife",constructor:xM,params:[["size",["value","valueFunc","vec3Func"]]],loadJSON:xM.fromJSON},ColorBySpeed:{type:"ColorBySpeed",constructor:BM,params:[["color",["colorFunc"]],["speedRange",["range"]]],loadJSON:BM.fromJSON},RotationBySpeed:{type:"RotationBySpeed",constructor:GM,params:[["angularVelocity",["value","valueFunc"]],["speedRange",["range"]]],loadJSON:GM.fromJSON},SizeBySpeed:{type:"SizeBySpeed",constructor:kM,params:[["size",["value","valueFunc","vec3Func"]],["speedRange",["range"]]],loadJSON:kM.fromJSON},SpeedOverLife:{type:"SpeedOverLife",constructor:wM,params:[["speed",["value","valueFunc"]]],loadJSON:wM.fromJSON},FrameOverLife:{type:"FrameOverLife",constructor:CM,params:[["frame",["value","valueFunc"]]],loadJSON:CM.fromJSON},ForceOverLife:{type:"ForceOverLife",constructor:vM,params:[["x",["value","valueFunc"]],["y",["value","valueFunc"]],["z",["value","valueFunc"]]],loadJSON:vM.fromJSON},OrbitOverLife:{type:"OrbitOverLife",constructor:SM,params:[["orbitSpeed",["value","valueFunc"]],["axis",["vec3"]]],loadJSON:SM.fromJSON},WidthOverLength:{type:"WidthOverLength",constructor:_M,params:[["width",["value","valueFunc"]]],loadJSON:_M.fromJSON},ChangeEmitDirection:{type:"ChangeEmitDirection",constructor:TM,params:[["angle",["value"]]],loadJSON:TM.fromJSON},EmitSubParticleSystem:{type:"EmitSubParticleSystem",constructor:EM,params:[["particleSystem",["self"]],["useVelocityAsBasis",["boolean"]],["subParticleSystem",["particleSystem"]],["mode",["number"]],["emitProbability",["number"]]],loadJSON:EM.fromJSON},LimitSpeedOverLife:{type:"LimitSpeedOverLife",constructor:PM,params:[["speed",["value","valueFunc"]],["dampen",["number"]]],loadJSON:PM.fromJSON}};function oFe(n,e){return q3[n.type].loadJSON(n,e)}const aFe=[];function lFe(n){if(!aFe.find(e=>e.id===n.id)){n.initialize();for(const e of n.emitterShapes)K3[e.type]||(K3[e.type]=e);for(const e of n.behaviors)q3[e.type]||(q3[e.type]=e)}}var cFe=`
#ifdef SOFT_PARTICLES

    /* #ifdef LOGDEPTH
    float distSample = linearize_depth_log(sampleDepth, near, far);
    #else
    float distSample = ortho ? linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far);
    #endif */

    vec2 p2 = projPosition.xy / projPosition.w;
    
    p2 = 0.5 * p2 + 0.5;

    float readDepth = texture2D(depthTexture, p2.xy).r;
    float viewDepth = linearize_depth(readDepth);

    float softParticlesFade = saturate(SOFT_INV_FADE_DISTANCE * ((viewDepth - SOFT_NEAR_FADE) - linearDepth));
    
    gl_FragColor *= softParticlesFade;

    //gl_FragColor = vec4(softParticlesFade , 0, 0, 1);
#endif
`,hFe=`
#ifdef SOFT_PARTICLES

    uniform sampler2D depthTexture;
    uniform vec4 projParams;
    uniform vec2 softParams;

    varying vec4 projPosition;
    varying float linearDepth;

    #define SOFT_NEAR_FADE softParams.x
    #define SOFT_INV_FADE_DISTANCE softParams.y

    #define zNear projParams.x
    #define zFar projParams.y

    float linearize_depth(float d)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }

#endif
`,dFe=`
#ifdef SOFT_PARTICLES
    varying vec4 projPosition;
    varying float linearDepth;
#endif
`,uFe=`
#ifdef SOFT_PARTICLES
    projPosition = gl_Position;
    linearDepth = -mvPosition.z;
#endif
`,pFe=`
#ifdef USE_MAP
    vec4 texelColor = texture2D( map, vUv);
    #ifdef TILE_BLEND
        texelColor = mix( texelColor, texture2D( map, vUvNext ), vUvBlend );
    #endif
    diffuseColor *= texelColor;
#endif
`,mFe=`
#if defined( USE_UV ) || defined( USE_ANISOTROPY )

	varying vec2 vUv;
#ifdef TILE_BLEND
    varying vec2 vUvNext;
    varying float vUvBlend;
#endif

#endif
#ifdef USE_MAP

	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#ifdef TILE_BLEND
    varying vec2 vMapUvNext;
#endif

#endif
#ifdef USE_ALPHAMAP

	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;

#endif
#ifdef USE_LIGHTMAP

	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;

#endif
#ifdef USE_AOMAP

	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;

#endif
#ifdef USE_BUMPMAP

	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;

#endif
#ifdef USE_NORMALMAP

	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;

#endif
#ifdef USE_DISPLACEMENTMAP

	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;

#endif
#ifdef USE_EMISSIVEMAP

	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;

#endif
#ifdef USE_METALNESSMAP

	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;

#endif
#ifdef USE_ROUGHNESSMAP

	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;

#endif
#ifdef USE_ANISOTROPYMAP

	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;

#endif
#ifdef USE_CLEARCOATMAP

	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;

#endif
#ifdef USE_SHEEN_COLORMAP

	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;

#endif
#ifdef USE_IRIDESCENCEMAP

	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;

#endif
#ifdef USE_SPECULARMAP

	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;

#endif
#ifdef USE_SPECULAR_COLORMAP

	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;

#endif
#ifdef USE_TRANSMISSIONMAP

	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;

#endif
#ifdef USE_THICKNESSMAP

	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;

#endif
`,gFe=`
#ifdef UV_TILE
    attribute float uvTile;
    uniform vec2 tileCount;
    
    mat3 makeTileTransform(float uvTile) {
        float col = mod(uvTile, tileCount.x);
        float row = (tileCount.y - floor(uvTile / tileCount.x) - 1.0);
        
        return mat3(
          1.0 / tileCount.x, 0.0, 0.0,
          0.0, 1.0 / tileCount.y, 0.0, 
          col / tileCount.x, row / tileCount.y, 1.0);
    }
#else
    mat3 makeTileTransform(float uvTile) {
        return mat3(1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0);
    }
#endif

#if defined( USE_UV ) || defined( USE_ANISOTROPY )

	varying vec2 vUv;
#ifdef TILE_BLEND
    varying vec2 vUvNext;
    varying float vUvBlend;
#endif

#endif
#ifdef USE_MAP

	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#ifdef TILE_BLEND
    varying vec2 vMapUvNext;
#endif

#endif
#ifdef USE_ALPHAMAP

	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;

#endif
#ifdef USE_LIGHTMAP

	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;

#endif
#ifdef USE_AOMAP

	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;

#endif
#ifdef USE_BUMPMAP

	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;

#endif
#ifdef USE_NORMALMAP

	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;

#endif
#ifdef USE_DISPLACEMENTMAP

	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;

#endif
#ifdef USE_EMISSIVEMAP

	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;

#endif
#ifdef USE_METALNESSMAP

	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;

#endif
#ifdef USE_ROUGHNESSMAP

	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;

#endif
#ifdef USE_ANISOTROPYMAP

	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;

#endif
#ifdef USE_CLEARCOATMAP

	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;

#endif
#ifdef USE_SHEEN_COLORMAP

	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;

#endif
#ifdef USE_IRIDESCENCEMAP

	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;

#endif
#ifdef USE_SPECULARMAP

	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;

#endif
#ifdef USE_SPECULAR_COLORMAP

	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;

#endif
#ifdef USE_TRANSMISSIONMAP

	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;

#endif
#ifdef USE_THICKNESSMAP

	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;

#endif
`,fFe=`
#ifdef UV_TILE
    mat3 tileTransform = makeTileTransform(floor(uvTile));
    #ifdef TILE_BLEND
        mat3 nextTileTransform = makeTileTransform(ceil(uvTile));
        vUvBlend = fract(uvTile);
    #endif
#else
    mat3 tileTransform = makeTileTransform(0.0);
#endif

#if defined( USE_UV ) || defined( USE_ANISOTROPY )

vUv = (tileTransform *vec3( uv, 1 )).xy;
#if defined( TILE_BLEND ) && defined( UV_TILE )
    vUvNext = (nextTileTransform *vec3( uv, 1 )).xy;
#endif

#endif
#ifdef USE_MAP

vMapUv = ( tileTransform * (mapTransform * vec3( MAP_UV, 1 ) )).xy;
#if defined( TILE_BLEND ) && defined( UV_TILE )
    vMapUvNext = (nextTileTransform * (mapTransform * vec3( MAP_UV, 1 ))).xy;
#endif

#endif
#ifdef USE_ALPHAMAP

vAlphaMapUv = ( tileTransform * (alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) )).xy;
    
#endif
#ifdef USE_LIGHTMAP

vLightMapUv = ( tileTransform * (lightMapTransform * vec3( LIGHTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_AOMAP

vAoMapUv = ( tileTransform * (aoMapTransform * vec3( AOMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_BUMPMAP

vBumpMapUv = ( tileTransform * (bumpMapTransform * vec3( BUMPMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_NORMALMAP

vNormalMapUv = ( tileTransform * (normalMapTransform * vec3( NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_DISPLACEMENTMAP

vDisplacementMapUv = ( tileTransform * (displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_EMISSIVEMAP

vEmissiveMapUv = ( tileTransform * (emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_METALNESSMAP

vMetalnessMapUv = ( tileTransform * (metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ROUGHNESSMAP

vRoughnessMapUv = ( tileTransform * (roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ANISOTROPYMAP

vAnisotropyMapUv = ( tileTransform * (anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOATMAP

vClearcoatMapUv = ( tileTransform * (clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

vClearcoatNormalMapUv = ( tileTransform * (clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

vClearcoatRoughnessMapUv = ( tileTransform * (clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCEMAP

vIridescenceMapUv = ( tileTransform * (iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

vIridescenceThicknessMapUv = ( tileTransform * (iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_COLORMAP

vSheenColorMapUv = ( tileTransform * (sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

vSheenRoughnessMapUv = ( tileTransform * (sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULARMAP

vSpecularMapUv = ( tileTransform * (specularMapTransform * vec3( SPECULARMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_COLORMAP

vSpecularColorMapUv = ( tileTransform * (specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

vSpecularIntensityMapUv = ( tileTransform * (specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_TRANSMISSIONMAP

vTransmissionMapUv = ( tileTransform * transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_THICKNESSMAP

vThicknessMapUv = ( tileTransform * thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) )).xy;

#endif

`;const Xg=Zt;function AFe(){Xg.tile_pars_vertex=gFe,Xg.tile_vertex=fFe,Xg.tile_pars_fragment=mFe,Xg.tile_fragment=pFe,Xg.soft_pars_vertex=dFe,Xg.soft_vertex=uFe,Xg.soft_pars_fragment=hFe,Xg.soft_fragment=cFe}class yFe extends Ae{constructor(e){super(),this.type="ParticleEmitter",this.system=e}clone(){const e=this.system.clone();return e.emitter.copy(this,!0),e.emitter}dispose(){}extractFromCache(e){const i=[];for(const s in e){const r=e[s];delete r.metadata,i.push(r)}return i}toJSON(e,i={}){const s=this.children;this.children=this.children.filter(o=>o.type!=="ParticleSystemPreview");const r=super.toJSON(e);return this.children=s,this.system!==null&&(r.object.ps=this.system.toJSON(e,i)),r}}var ft;(function(n){n[n.BillBoard=0]="BillBoard",n[n.StretchedBillBoard=1]="StretchedBillBoard",n[n.Mesh=2]="Mesh",n[n.Trail=3]="Trail",n[n.HorizontalBillBoard=4]="HorizontalBillBoard",n[n.VerticalBillBoard=5]="VerticalBillBoard"})(ft||(ft={}));class Qre extends pe{constructor(e){super(),this.type="VFXBatch",this.maxParticles=1e3,this.systems=new Set;const i=new Qo;i.mask=e.layers.mask;const s=e.material.clone();s.defines={},Object.assign(s.defines,e.material.defines),this.settings={instancingGeometry:e.instancingGeometry,renderMode:e.renderMode,renderOrder:e.renderOrder,material:s,uTileCount:e.uTileCount,vTileCount:e.vTileCount,blendTiles:e.blendTiles,softParticles:e.softParticles,softNearFade:e.softNearFade,softFarFade:e.softFarFade,layers:i},this.frustumCulled=!1,this.renderOrder=this.settings.renderOrder}addSystem(e){this.systems.add(e)}removeSystem(e){this.systems.delete(e)}applyDepthTexture(e){const i=this.material.uniforms.depthTexture;i&&i.value!==e&&(i.value=e,this.material.needsUpdate=!0)}}const bFe=new Dt(0,0,1),$3=new On,vFe=new Dt,xFe=new Dt;new Dt;const Kre=60,wFe=new Xs(1,1,1,1);let CFe=class PZ{set time(e){this.emissionState.time=e}get time(){return this.emissionState.time}get layers(){return this.rendererSettings.layers}get texture(){return this.rendererSettings.material.map}set texture(e){this.rendererSettings.material.map=e,this.neededToUpdateRender=!0}get material(){return this.rendererSettings.material}set material(e){this.rendererSettings.material=e,this.neededToUpdateRender=!0}get uTileCount(){return this.rendererSettings.uTileCount}set uTileCount(e){this.rendererSettings.uTileCount=e,this.neededToUpdateRender=!0}get vTileCount(){return this.rendererSettings.vTileCount}set vTileCount(e){this.rendererSettings.vTileCount=e,this.neededToUpdateRender=!0}get blendTiles(){return this.rendererSettings.blendTiles}set blendTiles(e){this.rendererSettings.blendTiles=e,this.neededToUpdateRender=!0}get softParticles(){return this.rendererSettings.softParticles}set softParticles(e){this.rendererSettings.softParticles=e,this.neededToUpdateRender=!0}get softNearFade(){return this.rendererSettings.softNearFade}set softNearFade(e){this.rendererSettings.softNearFade=e,this.neededToUpdateRender=!0}get softFarFade(){return this.rendererSettings.softFarFade}set softFarFade(e){this.rendererSettings.softFarFade=e,this.neededToUpdateRender=!0}get instancingGeometry(){return this.rendererSettings.instancingGeometry}set instancingGeometry(e){this.restart(),this.particles.length=0,this.rendererSettings.instancingGeometry=e,this.neededToUpdateRender=!0}get renderMode(){return this.rendererSettings.renderMode}set renderMode(e){if((this.rendererSettings.renderMode!=ft.Trail&&e===ft.Trail||this.rendererSettings.renderMode==ft.Trail&&e!==ft.Trail)&&(this.restart(),this.particles.length=0),this.rendererSettings.renderMode!==e)switch(e){case ft.Trail:this.rendererEmitterSettings={startLength:new cn(30),followLocalOrigin:!1};break;case ft.Mesh:this.rendererEmitterSettings={geometry:new Xs(1,1)},this.startRotation=new hM(new Dt(0,1,0),new cn(0));break;case ft.StretchedBillBoard:this.rendererEmitterSettings={speedFactor:0,lengthFactor:2},this.rendererSettings.renderMode===ft.Mesh&&(this.startRotation=new cn(0));break;case ft.BillBoard:case ft.VerticalBillBoard:case ft.HorizontalBillBoard:this.rendererEmitterSettings={},this.rendererSettings.renderMode===ft.Mesh&&(this.startRotation=new cn(0));break}this.rendererSettings.renderMode=e,this.neededToUpdateRender=!0}get renderOrder(){return this.rendererSettings.renderOrder}set renderOrder(e){this.rendererSettings.renderOrder=e,this.neededToUpdateRender=!0}get blending(){return this.rendererSettings.material.blending}set blending(e){this.rendererSettings.material.blending=e,this.neededToUpdateRender=!0}constructor(e){var i,s,r,o,a,l,c,h,d,u,p,g,f,A,y,b,v,x,w,C,S,_,I,B,M,R;if(this.temp=new Dt,this.travelDistance=0,this.normalMatrix=new mu,this.memory=[],this.listeners={},this.firstTimeUpdate=!0,this.autoDestroy=e.autoDestroy===void 0?!1:e.autoDestroy,this.duration=(i=e.duration)!==null&&i!==void 0?i:1,this.looping=e.looping===void 0?!0:e.looping,this.prewarm=e.prewarm===void 0?!1:e.prewarm,this.startLife=(s=e.startLife)!==null&&s!==void 0?s:new cn(5),this.startSpeed=(r=e.startSpeed)!==null&&r!==void 0?r:new cn(0),this.startRotation=(o=e.startRotation)!==null&&o!==void 0?o:new cn(0),this.startSize=(a=e.startSize)!==null&&a!==void 0?a:new cn(1),this.startColor=(l=e.startColor)!==null&&l!==void 0?l:new NA(new Al(1,1,1,1)),this.emissionOverTime=(c=e.emissionOverTime)!==null&&c!==void 0?c:new cn(10),this.emissionOverDistance=(h=e.emissionOverDistance)!==null&&h!==void 0?h:new cn(0),this.emissionBursts=(d=e.emissionBursts)!==null&&d!==void 0?d:[],this.onlyUsedByOther=(u=e.onlyUsedByOther)!==null&&u!==void 0?u:!1,this.emitterShape=(p=e.shape)!==null&&p!==void 0?p:new Ix,this.behaviors=(g=e.behaviors)!==null&&g!==void 0?g:new Array,this.worldSpace=(f=e.worldSpace)!==null&&f!==void 0?f:!1,this.rendererEmitterSettings=(A=e.rendererEmitterSettings)!==null&&A!==void 0?A:{},e.renderMode===ft.StretchedBillBoard){const k=this.rendererEmitterSettings;e.speedFactor!==void 0&&(k.speedFactor=e.speedFactor),k.speedFactor=(y=k.speedFactor)!==null&&y!==void 0?y:0,k.lengthFactor=(b=k.lengthFactor)!==null&&b!==void 0?b:0}this.rendererSettings={instancingGeometry:(v=e.instancingGeometry)!==null&&v!==void 0?v:wFe,renderMode:(x=e.renderMode)!==null&&x!==void 0?x:ft.BillBoard,renderOrder:(w=e.renderOrder)!==null&&w!==void 0?w:0,material:e.material,uTileCount:(C=e.uTileCount)!==null&&C!==void 0?C:1,vTileCount:(S=e.vTileCount)!==null&&S!==void 0?S:1,blendTiles:(_=e.blendTiles)!==null&&_!==void 0?_:!1,softParticles:(I=e.softParticles)!==null&&I!==void 0?I:!1,softNearFade:(B=e.softNearFade)!==null&&B!==void 0?B:0,softFarFade:(M=e.softFarFade)!==null&&M!==void 0?M:0,layers:(R=e.layers)!==null&&R!==void 0?R:new Qo},this.neededToUpdateRender=!0,this.particles=new Array,this.startTileIndex=e.startTileIndex||new cn(0),this.emitter=new yFe(this),this.paused=!1,this.particleNum=0,this.emissionState={isBursting:!1,burstParticleIndex:0,burstParticleCount:0,burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,travelDistance:0},this.emissionBursts.forEach(k=>k.count.startGen(this.memory)),this.emissionOverDistance.startGen(this.memory),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}pause(){this.paused=!0}play(){this.paused=!1}stop(){this.restart(),this.pause()}spawn(e,i,s){$3.setFromRotationMatrix(s);const r=vFe,o=$3,a=xFe;s.decompose(r,o,a);for(let l=0;l<e;l++){for(i.burstParticleIndex=l,this.particleNum++;this.particles.length<this.particleNum;)this.rendererSettings.renderMode===ft.Trail?this.particles.push(new i_):this.particles.push(new Jze);const c=this.particles[this.particleNum-1];if(c.reset(),c.speedModifier=1,this.startColor.startGen(c.memory),this.startColor.genColor(c.memory,c.startColor,this.emissionState.time),c.color.copy(c.startColor),this.startSpeed.startGen(c.memory),c.startSpeed=this.startSpeed.genValue(c.memory,i.time/this.duration),this.startLife.startGen(c.memory),c.life=this.startLife.genValue(c.memory,i.time/this.duration),c.age=0,this.startSize.startGen(c.memory),this.startSize.type==="vec3function")this.startSize.genValue(c.memory,c.startSize,i.time/this.duration);else{const h=this.startSize.genValue(c.memory,i.time/this.duration);c.startSize.set(h,h,h)}if(this.startTileIndex.startGen(c.memory),c.uvTile=this.startTileIndex.genValue(c.memory),c.size.copy(c.startSize),this.rendererSettings.renderMode===ft.Mesh||this.rendererSettings.renderMode===ft.BillBoard||this.rendererSettings.renderMode===ft.VerticalBillBoard||this.rendererSettings.renderMode===ft.HorizontalBillBoard||this.rendererSettings.renderMode===ft.StretchedBillBoard){const h=c;this.startRotation.startGen(c.memory),this.rendererSettings.renderMode===ft.Mesh?(h.rotation instanceof On||(h.rotation=new On),this.startRotation.type==="rotation"?this.startRotation.genValue(c.memory,h.rotation,1,i.time/this.duration):h.rotation.setFromAxisAngle(bFe,this.startRotation.genValue(h.memory,i.time/this.duration))):this.startRotation.type==="rotation"?h.rotation=0:h.rotation=this.startRotation.genValue(h.memory,i.time/this.duration)}else if(this.rendererSettings.renderMode===ft.Trail){const h=c;this.rendererEmitterSettings.startLength.startGen(h.memory),h.length=this.rendererEmitterSettings.startLength.genValue(h.memory,i.time/this.duration)}if(this.emitterShape.initialize(c,i),this.rendererSettings.renderMode===ft.Trail&&this.rendererEmitterSettings.followLocalOrigin){const h=c;h.localPosition=new Dt().copy(h.position)}this.worldSpace?(c.position.applyMatrix4(s),c.startSize.multiply(a).abs(),c.size.copy(c.startSize),c.velocity.multiply(a).applyMatrix3(this.normalMatrix),c.rotation&&c.rotation instanceof On&&c.rotation.multiplyQuaternions($3,c.rotation)):this.onlyUsedByOther&&(c.parentMatrix=s);for(let h=0;h<this.behaviors.length;h++)this.behaviors[h].initialize(c,this)}}endEmit(){this.emitEnded=!0,this.autoDestroy&&(this.markForDestroy=!0),this.fire({type:"emitEnd",particleSystem:this})}dispose(){this._renderer&&this._renderer.deleteSystem(this),this.emitter.dispose(),this.emitter.parent&&this.emitter.parent.remove(this.emitter),this.fire({type:"destroy",particleSystem:this})}restart(){this.memory.length=0,this.paused=!1,this.particleNum=0,this.emissionState.isBursting=!1,this.emissionState.burstIndex=0,this.emissionState.burstWaveIndex=0,this.emissionState.time=0,this.emissionState.waitEmiting=0,this.behaviors.forEach(e=>{e.reset()}),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1,this.emissionBursts.forEach(e=>e.count.startGen(this.memory)),this.emissionOverDistance.startGen(this.memory)}update(e){if(this.paused)return;let i=this.emitter;for(;i.parent;)i=i.parent;if(i.type!=="Scene"){this.dispose();return}if(this.firstTimeUpdate&&(this.firstTimeUpdate=!1,this.emitter.updateWorldMatrix(!0,!1)),this.emitEnded&&this.particleNum===0){this.markForDestroy&&this.emitter.parent&&this.dispose();return}if(this.looping&&this.prewarm&&!this.prewarmed){this.prewarmed=!0;for(let s=0;s<this.duration*Kre;s++)this.update(1/Kre)}e>.1&&(e=.1),this.neededToUpdateRender&&(this._renderer&&this._renderer.updateSystem(this),this.neededToUpdateRender=!1),this.onlyUsedByOther||this.emit(e,this.emissionState,this.emitter.matrixWorld),this.emitterShape.update(this,e);for(let s=0;s<this.behaviors.length;s++){this.behaviors[s].frameUpdate(e);for(let r=0;r<this.particleNum;r++)this.particles[r].died||this.behaviors[s].update(this.particles[r],e)}for(let s=0;s<this.particleNum;s++)this.rendererEmitterSettings.followLocalOrigin&&this.particles[s].localPosition?(this.particles[s].position.copy(this.particles[s].localPosition),this.particles[s].parentMatrix?this.particles[s].position.applyMatrix4(this.particles[s].parentMatrix):this.particles[s].position.applyMatrix4(this.emitter.matrixWorld)):this.particles[s].position.addScaledVector(this.particles[s].velocity,e*this.particles[s].speedModifier),this.particles[s].age+=e;if(this.rendererSettings.renderMode===ft.Trail)for(let s=0;s<this.particleNum;s++)this.particles[s].update();for(let s=0;s<this.particleNum;s++){const r=this.particles[s];r.died&&(!(r instanceof i_)||r.previous.length===0)&&(this.particles[s]=this.particles[this.particleNum-1],this.particles[this.particleNum-1]=r,this.particleNum--,s--,this.fire({type:"particleDied",particleSystem:this,particle:r}))}}emit(e,i,s){i.time>this.duration&&(this.looping?(i.time-=this.duration,i.burstIndex=0,this.behaviors.forEach(o=>{o.reset()})):!this.emitEnded&&!this.onlyUsedByOther&&this.endEmit()),this.normalMatrix.getNormalMatrix(s);const r=Math.ceil(i.waitEmiting);for(this.spawn(r,i,s),i.waitEmiting-=r;i.burstIndex<this.emissionBursts.length&&this.emissionBursts[i.burstIndex].time<=i.time;){if(Math.random()<this.emissionBursts[i.burstIndex].probability){const o=this.emissionBursts[i.burstIndex].count.genValue(this.memory,this.time);i.isBursting=!0,i.burstParticleCount=o,this.spawn(o,i,s),i.isBursting=!1}i.burstIndex++}if(!this.emitEnded&&(i.waitEmiting+=e*this.emissionOverTime.genValue(this.memory,i.time/this.duration),i.previousWorldPos!=null)){this.temp.set(s.elements[12],s.elements[13],s.elements[14]),i.travelDistance+=i.previousWorldPos.distanceTo(this.temp);const o=this.emissionOverDistance.genValue(this.memory,i.time/this.duration);if(i.travelDistance*o>0){const a=Math.floor(i.travelDistance*o);i.travelDistance-=a/o,i.waitEmiting+=a}}i.previousWorldPos===void 0&&(i.previousWorldPos=new Dt),i.previousWorldPos.set(s.elements[12],s.elements[13],s.elements[14]),i.time+=e}toJSON(e,i={}){var s;if((e===void 0||typeof e=="string")&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}}),e.materials[this.rendererSettings.material.uuid]=this.rendererSettings.material.toJSON(e),i.useUrlForImage&&((s=this.texture)===null||s===void 0?void 0:s.source)!==void 0){const a=this.texture.source;e.images[a.uuid]={uuid:a.uuid,url:this.texture.image.url}}let r;this.renderMode===ft.Trail?r={startLength:this.rendererEmitterSettings.startLength.toJSON(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===ft.Mesh?r={}:this.renderMode===ft.StretchedBillBoard?r={speedFactor:this.rendererEmitterSettings.speedFactor,lengthFactor:this.rendererEmitterSettings.lengthFactor}:r={};const o=this.rendererSettings.instancingGeometry;return e.geometries&&!e.geometries[o.uuid]&&(e.geometries[o.uuid]=o.toJSON()),{version:"3.0",autoDestroy:this.autoDestroy,looping:this.looping,prewarm:this.prewarm,duration:this.duration,shape:this.emitterShape.toJSON(),startLife:this.startLife.toJSON(),startSpeed:this.startSpeed.toJSON(),startRotation:this.startRotation.toJSON(),startSize:this.startSize.toJSON(),startColor:this.startColor.toJSON(),emissionOverTime:this.emissionOverTime.toJSON(),emissionOverDistance:this.emissionOverDistance.toJSON(),emissionBursts:this.emissionBursts.map(a=>({time:a.time,count:a.count.toJSON(),probability:a.probability,interval:a.interval,cycle:a.cycle})),onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry.uuid,renderOrder:this.renderOrder,renderMode:this.renderMode,rendererEmitterSettings:r,material:this.rendererSettings.material.uuid,layers:this.layers.mask,startTileIndex:this.startTileIndex.toJSON(),uTileCount:this.uTileCount,vTileCount:this.vTileCount,blendTiles:this.blendTiles,softParticles:this.rendererSettings.softParticles,softFarFade:this.rendererSettings.softFarFade,softNearFade:this.rendererSettings.softNearFade,behaviors:this.behaviors.map(a=>a.toJSON()),worldSpace:this.worldSpace}}static fromJSON(e,i,s){var r,o;const a=Yze(e.shape,i);let l;if(e.renderMode===ft.Trail){const d=e.rendererEmitterSettings;l={startLength:d.startLength!=null?Ui(d.startLength):new cn(30),followLocalOrigin:d.followLocalOrigin}}else e.renderMode===ft.Mesh?l={}:e.renderMode===ft.StretchedBillBoard?(l=e.rendererEmitterSettings,e.speedFactor!=null&&(l.speedFactor=e.speedFactor)):l={};const c=new Qo;e.layers&&(c.mask=e.layers);const h=new PZ({autoDestroy:e.autoDestroy,looping:e.looping,prewarm:e.prewarm,duration:e.duration,shape:a,startLife:Ui(e.startLife),startSpeed:Ui(e.startSpeed),startRotation:kB(e.startRotation),startSize:kB(e.startSize),startColor:Q3(e.startColor),emissionOverTime:Ui(e.emissionOverTime),emissionOverDistance:Ui(e.emissionOverDistance),emissionBursts:(r=e.emissionBursts)===null||r===void 0?void 0:r.map(d=>{var u,p,g;return{time:d.time,count:typeof d.count=="number"?new cn(d.count):Ui(d.count),probability:(u=d.probability)!==null&&u!==void 0?u:1,interval:(p=d.interval)!==null&&p!==void 0?p:.1,cycle:(g=d.cycle)!==null&&g!==void 0?g:1}}),onlyUsedByOther:e.onlyUsedByOther,instancingGeometry:i.geometries[e.instancingGeometry],renderMode:e.renderMode,rendererEmitterSettings:l,renderOrder:e.renderOrder,layers:c,material:e.material?i.materials[e.material]:e.texture?new ai({map:i.textures[e.texture],transparent:(o=e.transparent)!==null&&o!==void 0?o:!0,blending:e.blending,side:Qi}):new ai({color:16777215,transparent:!0,blending:Wp,side:Qi}),startTileIndex:typeof e.startTileIndex=="number"?new cn(e.startTileIndex):Ui(e.startTileIndex),uTileCount:e.uTileCount,vTileCount:e.vTileCount,blendTiles:e.blendTiles,softParticles:e.softParticles,softFarFade:e.softFarFade,softNearFade:e.softNearFade,behaviors:[],worldSpace:e.worldSpace});return h.behaviors=e.behaviors.map(d=>{const u=oFe(d,h);return u.type==="EmitSubParticleSystem"&&(s[d.subParticleSystem]=u),u}),h}addBehavior(e){this.behaviors.push(e)}getRendererSettings(){return this.rendererSettings}addEventListener(e,i){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(i)}removeAllEventListeners(e){this.listeners[e]&&(this.listeners[e]=[])}removeEventListener(e,i){if(this.listeners[e]){const s=this.listeners[e].indexOf(i);s!==-1&&this.listeners[e].splice(s,1)}}fire(e){this.listeners[e.type]&&this.listeners[e.type].forEach(i=>i(e))}clone(){const e=[];for(const o of this.emissionBursts){const a={};Object.assign(a,o),e.push(a)}const i=[];for(const o of this.behaviors)i.push(o.clone());let s;this.renderMode===ft.Trail?s={startLength:this.rendererEmitterSettings.startLength.clone(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===ft.StretchedBillBoard?s={lengthFactor:this.rendererEmitterSettings.lengthFactor,speedFactor:this.rendererEmitterSettings.speedFactor}:s={};const r=new Qo;return r.mask=this.layers.mask,new PZ({autoDestroy:this.autoDestroy,looping:this.looping,duration:this.duration,shape:this.emitterShape.clone(),startLife:this.startLife.clone(),startSpeed:this.startSpeed.clone(),startRotation:this.startRotation.clone(),startSize:this.startSize.clone(),startColor:this.startColor.clone(),emissionOverTime:this.emissionOverTime.clone(),emissionOverDistance:this.emissionOverDistance.clone(),emissionBursts:e,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry,renderMode:this.renderMode,renderOrder:this.renderOrder,rendererEmitterSettings:s,material:this.rendererSettings.material,startTileIndex:this.startTileIndex,uTileCount:this.uTileCount,vTileCount:this.vTileCount,blendTiles:this.blendTiles,softParticles:this.softParticles,softFarFade:this.softFarFade,softNearFade:this.softNearFade,behaviors:i,worldSpace:this.worldSpace,layers:r})}};var eO=`

#include <common>
#include <color_pars_fragment>
#include <map_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <alphatest_pars_fragment>

#include <tile_pars_fragment>
#include <soft_pars_fragment>

void main() {

    #include <clipping_planes_fragment>
    
    vec3 outgoingLight = vec3( 0.0 );
    vec4 diffuseColor = vColor;
    
    #include <logdepthbuf_fragment>
    
    #include <tile_fragment>
    #include <alphatest_fragment>

    outgoingLight = diffuseColor.rgb;
    
    #ifdef USE_COLOR_AS_ALPHA
    gl_FragColor = vec4( outgoingLight, diffuseColor.r );
    #else
    gl_FragColor = vec4( outgoingLight, diffuseColor.a );
    #endif
    
    #include <soft_fragment>
    #include <tonemapping_fragment>
}
`,tO=`
#define STANDARD

#ifdef PHYSICAL
#define IOR
#define USE_SPECULAR
#endif

uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;

#ifdef IOR
uniform float ior;
#endif

#ifdef USE_SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;

#ifdef USE_SPECULAR_COLORMAP
uniform sampler2D specularColorMap;
#endif

#ifdef USE_SPECULAR_INTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#endif

#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif

#ifdef USE_DISPERSION
uniform float dispersion;
#endif

#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif

#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;

#ifdef USE_SHEEN_COLORMAP
uniform sampler2D sheenColorMap;
#endif

#ifdef USE_SHEEN_ROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif

#ifdef USE_ANISOTROPY
uniform vec2 anisotropyVector;

#ifdef USE_ANISOTROPYMAP
uniform sampler2D anisotropyMap;
#endif
#endif

varying vec3 vViewPosition;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

vec4 diffuseColor = vec4( diffuse, opacity );
#include <clipping_planes_fragment>

ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveRadiance = emissive;

#include <logdepthbuf_fragment>
#include <map_fragment>
#include <color_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <alphahash_fragment>
#include <roughnessmap_fragment>
#include <metalnessmap_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <clearcoat_normal_fragment_begin>
#include <clearcoat_normal_fragment_maps>
#include <emissivemap_fragment>

// accumulation
#include <lights_physical_fragment>
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>

// modulation
#include <aomap_fragment>

vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;

#include <transmission_fragment>

vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;

#ifdef USE_SHEEN

// Sheen energy compensation approximation calculation can be found at the end of
// https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );

outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;

#endif

#ifdef USE_CLEARCOAT

float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );

vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );

outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;

#endif

#include <opaque_fragment>
#include <tonemapping_fragment>
#include <colorspace_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,SFe=`
#include <common>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

#include <tile_pars_vertex>
#include <soft_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute vec3 size;

void main() {
	
    vec2 alignedPosition = position.xy * size.xy;
    
    vec2 rotatedPosition;
    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
#ifdef HORIZONTAL
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.x += rotatedPosition.x;
    mvPosition.z -= rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
#elif defined(VERTICAL)
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.y += rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
    mvPosition.x += rotatedPosition.x;
#else
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    mvPosition.xy += rotatedPosition;
#endif

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>

	#include <clipping_planes_vertex>

	#include <tile_vertex>
	#include <soft_vertex>
}
`,_Fe=`
#include <common>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <tile_pars_vertex>
#include <soft_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute vec3 size;
// attribute vec4 color;

void main() {

    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size.x, sy = size.y, sz = size.z;
    
    mat4 matrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);
    
    vec4 mvPosition = modelViewMatrix * (matrix * vec4( position, 1.0 ));

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
    #include <tile_vertex>
    #include <soft_vertex>
}
`,iO=`
#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>

attribute vec3 offset;
attribute vec4 rotation;
attribute vec3 size;
#include <tile_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

    #include <tile_vertex>
    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size.x, sy = size.y, sz = size.z;

    mat4 particleMatrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);

#include <color_vertex>
#include <morphinstance_vertex>
#include <morphcolor_vertex>
#include <batching_vertex>

#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>

	// replace defaultnormal_vertex
	vec3 transformedNormal = objectNormal;
    mat3 m = mat3( particleMatrix );
    transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
    transformedNormal = m * transformedNormal;
    transformedNormal = normalMatrix * transformedNormal;
    #ifdef FLIP_SIDED
        transformedNormal = - transformedNormal;
    #endif
    #ifdef USE_TANGENT
        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
        #ifdef FLIP_SIDED
        transformedTangent = - transformedTangent;
        #endif
    #endif

	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>

	// replace include <project_vertex>
  vec4 mvPosition = vec4( transformed, 1.0 );
  mvPosition = modelViewMatrix * (particleMatrix * mvPosition);
	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
	vViewPosition = - mvPosition.xyz;
	
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
    vWorldPosition = worldPosition.xyz;
#endif
}
`,MFe=`
#include <common>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

#include <tile_pars_vertex>
#include <soft_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute vec3 size;
attribute vec4 velocity;

uniform float speedFactor;

void main() {
    float lengthFactor = velocity.w;
    float avgSize = (size.x + size.y) * 0.5;
#ifdef USE_SKEW
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    vec3 viewVelocity = normalMatrix * velocity.xyz;

    vec3 scaledPos = vec3(position.xy * size.xy, position.z);
    float vlength = length(viewVelocity);
    vec3 projVelocity =  dot(scaledPos, viewVelocity) * viewVelocity / vlength;
    mvPosition.xyz += scaledPos + projVelocity * (speedFactor / avgSize + lengthFactor / vlength);
#else
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    vec3 viewVelocity = normalMatrix * velocity.xyz;
    float vlength = length(viewVelocity); 
    mvPosition.xyz += position.y * normalize(cross(mvPosition.xyz, viewVelocity)) * avgSize; // switch the cross to  match unity implementation
    mvPosition.xyz -= (position.x + 0.5) * viewVelocity * (1.0 + lengthFactor / vlength) * avgSize; // minus position.x to match unity implementation
#endif
	vColor = color;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <tile_vertex>
	#include <soft_vertex>
}
`;function nO(n){return n===0?"uv":`uv${n}`}class IFe extends Us{constructor(e){super(e)}onBeforeCompile(e,i){super.onBeforeCompile(e,i),e.vertexShader=iO,e.fragmentShader=tO}}class TFe extends uo{constructor(e){super(e)}onBeforeCompile(e,i){super.onBeforeCompile(e,i),e.vertexShader=iO,e.fragmentShader=tO}}new Dt(0,0,1);class EFe extends Qre{constructor(e){super(e),this.vector_=new Dt,this.vector2_=new Dt,this.vector3_=new Dt,this.quaternion_=new On,this.quaternion2_=new On,this.quaternion3_=new On,this.rotationMat_=new mu,this.rotationMat2_=new mu,this.maxParticles=1e3,this.setupBuffers(),this.rebuildMaterial()}buildExpandableBuffers(){this.offsetBuffer=new Yo(new Float32Array(this.maxParticles*3),3),this.offsetBuffer.setUsage(Fs),this.geometry.setAttribute("offset",this.offsetBuffer),this.colorBuffer=new Yo(new Float32Array(this.maxParticles*4),4),this.colorBuffer.setUsage(Fs),this.geometry.setAttribute("color",this.colorBuffer),this.settings.renderMode===ft.Mesh?(this.rotationBuffer=new Yo(new Float32Array(this.maxParticles*4),4),this.rotationBuffer.setUsage(Fs),this.geometry.setAttribute("rotation",this.rotationBuffer)):(this.settings.renderMode===ft.BillBoard||this.settings.renderMode===ft.HorizontalBillBoard||this.settings.renderMode===ft.VerticalBillBoard||this.settings.renderMode===ft.StretchedBillBoard)&&(this.rotationBuffer=new Yo(new Float32Array(this.maxParticles),1),this.rotationBuffer.setUsage(Fs),this.geometry.setAttribute("rotation",this.rotationBuffer)),this.sizeBuffer=new Yo(new Float32Array(this.maxParticles*3),3),this.sizeBuffer.setUsage(Fs),this.geometry.setAttribute("size",this.sizeBuffer),this.uvTileBuffer=new Yo(new Float32Array(this.maxParticles),1),this.uvTileBuffer.setUsage(Fs),this.geometry.setAttribute("uvTile",this.uvTileBuffer),this.settings.renderMode===ft.StretchedBillBoard&&(this.velocityBuffer=new Yo(new Float32Array(this.maxParticles*4),4),this.velocityBuffer.setUsage(Fs),this.geometry.setAttribute("velocity",this.velocityBuffer))}setupBuffers(){this.geometry&&this.geometry.dispose(),this.geometry=new AT,this.geometry.setIndex(this.settings.instancingGeometry.getIndex()),this.settings.instancingGeometry.hasAttribute("normal")&&this.geometry.setAttribute("normal",this.settings.instancingGeometry.getAttribute("normal")),this.geometry.setAttribute("position",this.settings.instancingGeometry.getAttribute("position")),this.geometry.setAttribute("uv",this.settings.instancingGeometry.getAttribute("uv")),this.buildExpandableBuffers()}expandBuffers(e){for(;e>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}rebuildMaterial(){this.layers.mask=this.settings.layers.mask;const e={},i={};this.settings.material.type!=="MeshStandardMaterial"&&this.settings.material.type!=="MeshPhysicalMaterial"&&(e.map=new Te(this.settings.material.map)),this.settings.material.alphaTest&&(i.USE_ALPHATEST="",e.alphaTest=new Te(this.settings.material.alphaTest)),i.USE_UV="";const s=this.settings.uTileCount,r=this.settings.vTileCount;(s>1||r>1)&&(i.UV_TILE="",e.tileCount=new Te(new Sx(s,r))),this.settings.material.defines&&this.settings.material.defines.USE_COLOR_AS_ALPHA!==void 0&&(i.USE_COLOR_AS_ALPHA=""),this.settings.material.normalMap&&(i.USE_NORMALMAP="",i.NORMALMAP_UV=nO(this.settings.material.normalMap.channel),e.normalMapTransform=new Te(new mu().copy(this.settings.material.normalMap.matrix))),this.settings.material.map&&(i.USE_MAP="",this.settings.blendTiles&&(i.TILE_BLEND=""),i.MAP_UV=nO(this.settings.material.map.channel),e.mapTransform=new Te(new mu().copy(this.settings.material.map.matrix))),i.USE_COLOR_ALPHA="";let o;if(this.settings.softParticles){i.SOFT_PARTICLES="";const l=this.settings.softNearFade,c=1/(this.settings.softFarFade-this.settings.softNearFade);e.softParams=new Te(new Sx(l,c)),e.depthTexture=new Te(null);const h=e.projParams=new Te(new Al);o=(d,u,p)=>{h.value.set(p.near,p.far,0,0)}}let a=!1;if(this.settings.renderMode===ft.BillBoard||this.settings.renderMode===ft.VerticalBillBoard||this.settings.renderMode===ft.HorizontalBillBoard||this.settings.renderMode===ft.Mesh){let l,c;this.settings.renderMode===ft.Mesh?this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"?(i.USE_COLOR="",l=iO,c=tO,a=!0):(l=_Fe,c=eO):(l=SFe,c=eO),this.settings.renderMode===ft.VerticalBillBoard?i.VERTICAL="":this.settings.renderMode===ft.HorizontalBillBoard&&(i.HORIZONTAL="");let h=!1;this.settings.renderMode===ft.Mesh&&(this.settings.material.type==="MeshStandardMaterial"?(this.material=new IFe({}),this.material.copy(this.settings.material),this.material.uniforms=e,this.material.defines=i,h=!0):this.settings.material.type==="MeshPhysicalMaterial"&&(this.material=new TFe({}),this.material.copy(this.settings.material),this.material.uniforms=e,this.material.defines=i,h=!0)),h||(this.material=new jt({uniforms:e,defines:i,vertexShader:l,fragmentShader:c,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,blendDst:this.settings.material.blendDst,blendSrc:this.settings.material.blendSrc,blendEquation:this.settings.material.blendEquation,premultipliedAlpha:this.settings.material.premultipliedAlpha,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,depthTest:this.settings.material.depthTest,lights:a}))}else if(this.settings.renderMode===ft.StretchedBillBoard)e.speedFactor=new Te(1),this.material=new jt({uniforms:e,defines:i,vertexShader:MFe,fragmentShader:eO,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,blendDst:this.settings.material.blendDst,blendSrc:this.settings.material.blendSrc,blendEquation:this.settings.material.blendEquation,premultipliedAlpha:this.settings.material.premultipliedAlpha,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,depthTest:this.settings.material.depthTest});else throw new Error("render mode unavailable");this.material&&o&&(this.material.onBeforeRender=o)}update(){let e=0,i=0;this.systems.forEach(s=>{i+=s.particleNum}),i>this.maxParticles&&this.expandBuffers(i),this.systems.forEach(s=>{s.emitter.updateMatrixWorld&&(s.emitter.updateWorldMatrix(!0,!1),s.emitter.updateMatrixWorld(!0));const r=s.particles,o=s.particleNum,a=this.quaternion2_,l=this.vector2_,c=this.vector3_;s.emitter.matrixWorld.decompose(l,a,c),this.rotationMat_.setFromMatrix4(s.emitter.matrixWorld);for(let h=0;h<o;h++,e++){const d=r[h];if(this.settings.renderMode===ft.Mesh){let p;if(s.worldSpace)p=d.rotation;else{let g;d.parentMatrix?g=this.quaternion3_.setFromRotationMatrix(d.parentMatrix):g=a,p=this.quaternion_,p.copy(g).multiply(d.rotation)}this.rotationBuffer.setXYZW(e,p.x,p.y,p.z,p.w)}else(this.settings.renderMode===ft.StretchedBillBoard||this.settings.renderMode===ft.VerticalBillBoard||this.settings.renderMode===ft.HorizontalBillBoard||this.settings.renderMode===ft.BillBoard)&&this.rotationBuffer.setX(e,d.rotation);let u;if(s.worldSpace?u=d.position:(u=this.vector_,d.parentMatrix?u.copy(d.position).applyMatrix4(d.parentMatrix):u.copy(d.position).applyMatrix4(s.emitter.matrixWorld)),this.offsetBuffer.setXYZ(e,u.x,u.y,u.z),this.colorBuffer.setXYZW(e,d.color.x,d.color.y,d.color.z,d.color.w),s.worldSpace?this.sizeBuffer.setXYZ(e,d.size.x,d.size.y,d.size.z):d.parentMatrix?this.sizeBuffer.setXYZ(e,d.size.x,d.size.y,d.size.z):this.sizeBuffer.setXYZ(e,d.size.x*Math.abs(c.x),d.size.y*Math.abs(c.y),d.size.z*Math.abs(c.z)),this.uvTileBuffer.setX(e,d.uvTile),this.settings.renderMode===ft.StretchedBillBoard&&this.velocityBuffer){let p=s.rendererEmitterSettings.speedFactor;p===0&&(p=.001);const g=s.rendererEmitterSettings.lengthFactor;let f;s.worldSpace?f=d.velocity:(f=this.vector_,d.parentMatrix?(this.rotationMat2_.setFromMatrix4(d.parentMatrix),f.copy(d.velocity).applyMatrix3(this.rotationMat2_)):f.copy(d.velocity).applyMatrix3(this.rotationMat_)),this.velocityBuffer.setXYZW(e,f.x*p,f.y*p,f.z*p,g)}}}),this.geometry.instanceCount=e,e>0&&(this.offsetBuffer.clearUpdateRanges(),this.offsetBuffer.addUpdateRange(0,e*3),this.offsetBuffer.needsUpdate=!0,this.sizeBuffer.clearUpdateRanges(),this.sizeBuffer.addUpdateRange(0,e*3),this.sizeBuffer.needsUpdate=!0,this.colorBuffer.clearUpdateRanges(),this.colorBuffer.addUpdateRange(0,e*4),this.colorBuffer.needsUpdate=!0,this.uvTileBuffer.clearUpdateRanges(),this.uvTileBuffer.addUpdateRange(0,e),this.uvTileBuffer.needsUpdate=!0,this.settings.renderMode===ft.StretchedBillBoard&&this.velocityBuffer&&(this.velocityBuffer.clearUpdateRanges(),this.velocityBuffer.addUpdateRange(0,e*4),this.velocityBuffer.needsUpdate=!0),this.settings.renderMode===ft.Mesh?(this.rotationBuffer.clearUpdateRanges(),this.rotationBuffer.addUpdateRange(0,e*4),this.rotationBuffer.needsUpdate=!0):(this.settings.renderMode===ft.StretchedBillBoard||this.settings.renderMode===ft.HorizontalBillBoard||this.settings.renderMode===ft.VerticalBillBoard||this.settings.renderMode===ft.BillBoard)&&(this.rotationBuffer.clearUpdateRanges(),this.rotationBuffer.addUpdateRange(0,e),this.rotationBuffer.needsUpdate=!0))}dispose(){this.geometry.dispose()}}var RFe=`

#include <common>
#include <tile_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

uniform sampler2D alphaMap;
uniform float useAlphaMap;
uniform float visibility;
uniform float alphaTest;

varying vec4 vColor;
    
void main() {
    #include <clipping_planes_fragment>
    #include <logdepthbuf_fragment>

    vec4 diffuseColor = vColor;
    
    #ifdef USE_MAP
    #include <tile_fragment>
    #ifndef USE_COLOR_AS_ALPHA
    #endif
    #endif
    if( useAlphaMap == 1. ) diffuseColor.a *= texture2D( alphaMap, vUv).a;
    if( diffuseColor.a < alphaTest ) discard;
    gl_FragColor = diffuseColor;

    #include <fog_fragment>
    #include <tonemapping_fragment>
}`,LFe=`
#include <common>
#include <tile_pars_vertex>
#include <color_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <fog_pars_vertex>

attribute vec3 previous;
attribute vec3 next;
attribute float side;
attribute float width;

uniform vec2 resolution;
uniform float lineWidth;
uniform float sizeAttenuation;
    
vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
}
    
void main() {

    #include <tile_vertex>
    
    float aspect = resolution.x / resolution.y;

    vColor = color;

    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4( position, 1.0 );
    vec4 prevPos = m * vec4( previous, 1.0 );
    vec4 nextPos = m * vec4( next, 1.0 );

    vec2 currentP = fix( finalPosition, aspect );
    vec2 prevP = fix( prevPos, aspect );
    vec2 nextP = fix( nextPos, aspect );

    float w = lineWidth * width;

    vec2 dir;
    if( nextP == currentP ) dir = normalize( currentP - prevP );
    else if( prevP == currentP ) dir = normalize( nextP - currentP );
    else {
        vec2 dir1 = normalize( currentP - prevP );
        vec2 dir2 = normalize( nextP - currentP );
        dir = normalize( dir1 + dir2 );

        vec2 perp = vec2( -dir1.y, dir1.x );
        vec2 miter = vec2( -dir.y, dir.x );
        //w = clamp( w / dot( miter, perp ), 0., 4., * lineWidth * width );

    }

    //vec2 normal = ( cross( vec3( dir, 0. ) vec3( 0., 0., 1. ) ) ).xy;
    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );
    normal.xy *= .5 * w;
    normal *= projectionMatrix;
    if( sizeAttenuation == 0. ) {
        normal.xy *= finalPosition.w;
        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;
    }

    finalPosition.xy += normal.xy * side;

    gl_Position = finalPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    
	#include <fog_vertex>
}`;new Dt(0,0,1);class BFe extends Qre{constructor(e){super(e),this.vector_=new Dt,this.vector2_=new Dt,this.vector3_=new Dt,this.quaternion_=new On,this.maxParticles=1e4,this.setupBuffers(),this.rebuildMaterial()}setupBuffers(){this.geometry&&this.geometry.dispose(),this.geometry=new Rt,this.indexBuffer=new ct(new Uint32Array(this.maxParticles*6),1),this.indexBuffer.setUsage(Fs),this.geometry.setIndex(this.indexBuffer),this.positionBuffer=new ct(new Float32Array(this.maxParticles*6),3),this.positionBuffer.setUsage(Fs),this.geometry.setAttribute("position",this.positionBuffer),this.previousBuffer=new ct(new Float32Array(this.maxParticles*6),3),this.previousBuffer.setUsage(Fs),this.geometry.setAttribute("previous",this.previousBuffer),this.nextBuffer=new ct(new Float32Array(this.maxParticles*6),3),this.nextBuffer.setUsage(Fs),this.geometry.setAttribute("next",this.nextBuffer),this.widthBuffer=new ct(new Float32Array(this.maxParticles*2),1),this.widthBuffer.setUsage(Fs),this.geometry.setAttribute("width",this.widthBuffer),this.sideBuffer=new ct(new Float32Array(this.maxParticles*2),1),this.sideBuffer.setUsage(Fs),this.geometry.setAttribute("side",this.sideBuffer),this.uvBuffer=new ct(new Float32Array(this.maxParticles*4),2),this.uvBuffer.setUsage(Fs),this.geometry.setAttribute("uv",this.uvBuffer),this.colorBuffer=new ct(new Float32Array(this.maxParticles*8),4),this.colorBuffer.setUsage(Fs),this.geometry.setAttribute("color",this.colorBuffer)}expandBuffers(e){for(;e>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}rebuildMaterial(){this.layers.mask=this.settings.layers.mask;const e={lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},resolution:{value:new Sx(1,1)},sizeAttenuation:{value:1},visibility:{value:1},alphaTest:{value:0}},i={};if(i.USE_UV="",i.USE_COLOR_ALPHA="",this.settings.material.map&&(i.USE_MAP="",i.MAP_UV=nO(this.settings.material.map.channel),e.map=new Te(this.settings.material.map),e.mapTransform=new Te(new mu().copy(this.settings.material.map.matrix))),this.settings.material.defines&&this.settings.material.defines.USE_COLOR_AS_ALPHA!==void 0&&(i.USE_COLOR_AS_ALPHA=""),this.settings.renderMode===ft.Trail)this.material=new jt({uniforms:e,defines:i,vertexShader:LFe,fragmentShader:RFe,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,side:this.settings.material.side,blending:this.settings.material.blending||Wp,blendDst:this.settings.material.blendDst,blendSrc:this.settings.material.blendSrc,blendEquation:this.settings.material.blendEquation,premultipliedAlpha:this.settings.material.premultipliedAlpha});else throw new Error("render mode unavailable")}update(){let e=0,i=0,s=0;this.systems.forEach(r=>{for(let o=0;o<r.particleNum;o++)s+=r.particles[o].previous.length*2}),s>this.maxParticles&&this.expandBuffers(s),this.systems.forEach(r=>{r.emitter.updateMatrixWorld&&(r.emitter.updateWorldMatrix(!0,!1),r.emitter.updateMatrixWorld(!0));const o=this.quaternion_,a=this.vector2_,l=this.vector3_;r.emitter.matrixWorld.decompose(a,o,l);const c=r.particles,h=r.particleNum,d=this.settings.uTileCount,u=this.settings.vTileCount,p=1/d,g=1/u;for(let f=0;f<h;f++){const A=c[f],y=A.uvTile%u,b=Math.floor(A.uvTile/u+.001),v=A.previous.values();let x=v.next(),w=x.value,C=w;x.done||(x=v.next());let S;x.value!==void 0?S=x.value:S=C;for(let _=0;_<A.previous.length;_++,e+=2){if(this.positionBuffer.setXYZ(e,C.position.x,C.position.y,C.position.z),this.positionBuffer.setXYZ(e+1,C.position.x,C.position.y,C.position.z),r.worldSpace?(this.positionBuffer.setXYZ(e,C.position.x,C.position.y,C.position.z),this.positionBuffer.setXYZ(e+1,C.position.x,C.position.y,C.position.z)):(A.parentMatrix?this.vector_.copy(C.position).applyMatrix4(A.parentMatrix):this.vector_.copy(C.position).applyMatrix4(r.emitter.matrixWorld),this.positionBuffer.setXYZ(e,this.vector_.x,this.vector_.y,this.vector_.z),this.positionBuffer.setXYZ(e+1,this.vector_.x,this.vector_.y,this.vector_.z)),r.worldSpace?(this.previousBuffer.setXYZ(e,w.position.x,w.position.y,w.position.z),this.previousBuffer.setXYZ(e+1,w.position.x,w.position.y,w.position.z)):(A.parentMatrix?this.vector_.copy(w.position).applyMatrix4(A.parentMatrix):this.vector_.copy(w.position).applyMatrix4(r.emitter.matrixWorld),this.previousBuffer.setXYZ(e,this.vector_.x,this.vector_.y,this.vector_.z),this.previousBuffer.setXYZ(e+1,this.vector_.x,this.vector_.y,this.vector_.z)),r.worldSpace?(this.nextBuffer.setXYZ(e,S.position.x,S.position.y,S.position.z),this.nextBuffer.setXYZ(e+1,S.position.x,S.position.y,S.position.z)):(A.parentMatrix?this.vector_.copy(S.position).applyMatrix4(A.parentMatrix):this.vector_.copy(S.position).applyMatrix4(r.emitter.matrixWorld),this.nextBuffer.setXYZ(e,this.vector_.x,this.vector_.y,this.vector_.z),this.nextBuffer.setXYZ(e+1,this.vector_.x,this.vector_.y,this.vector_.z)),this.sideBuffer.setX(e,-1),this.sideBuffer.setX(e+1,1),r.worldSpace)this.widthBuffer.setX(e,C.size),this.widthBuffer.setX(e+1,C.size);else if(A.parentMatrix)this.widthBuffer.setX(e,C.size),this.widthBuffer.setX(e+1,C.size);else{const I=(Math.abs(l.x)+Math.abs(l.y)+Math.abs(l.z))/3;this.widthBuffer.setX(e,C.size*I),this.widthBuffer.setX(e+1,C.size*I)}this.uvBuffer.setXY(e,(_/A.previous.length+y)*p,(u-b-1)*g),this.uvBuffer.setXY(e+1,(_/A.previous.length+y)*p,(u-b)*g),this.colorBuffer.setXYZW(e,C.color.x,C.color.y,C.color.z,C.color.w),this.colorBuffer.setXYZW(e+1,C.color.x,C.color.y,C.color.z,C.color.w),_+1<A.previous.length&&(this.indexBuffer.setX(i*3,e),this.indexBuffer.setX(i*3+1,e+1),this.indexBuffer.setX(i*3+2,e+2),i++,this.indexBuffer.setX(i*3,e+2),this.indexBuffer.setX(i*3+1,e+1),this.indexBuffer.setX(i*3+2,e+3),i++),w=C,C=S,x.done||(x=v.next(),x.value!==void 0&&(S=x.value))}}}),this.positionBuffer.clearUpdateRanges(),this.positionBuffer.addUpdateRange(0,e*3),this.positionBuffer.needsUpdate=!0,this.previousBuffer.clearUpdateRanges(),this.previousBuffer.addUpdateRange(0,e*3),this.previousBuffer.needsUpdate=!0,this.nextBuffer.clearUpdateRanges(),this.nextBuffer.addUpdateRange(0,e*3),this.nextBuffer.needsUpdate=!0,this.sideBuffer.clearUpdateRanges(),this.sideBuffer.addUpdateRange(0,e),this.sideBuffer.needsUpdate=!0,this.widthBuffer.clearUpdateRanges(),this.widthBuffer.addUpdateRange(0,e),this.widthBuffer.needsUpdate=!0,this.uvBuffer.clearUpdateRanges(),this.uvBuffer.addUpdateRange(0,e*2),this.uvBuffer.needsUpdate=!0,this.colorBuffer.clearUpdateRanges(),this.colorBuffer.addUpdateRange(0,e*4),this.colorBuffer.needsUpdate=!0,this.indexBuffer.clearUpdateRanges(),this.indexBuffer.addUpdateRange(0,i*3),this.indexBuffer.needsUpdate=!0,this.geometry.setDrawRange(0,i*3)}dispose(){this.geometry.dispose()}}class NM{get geometry(){return this._geometry}set geometry(e){if(this._geometry=e,e===void 0||typeof e=="string")return;const i=new $s;this._triangleIndexToArea.length=0;let s=0;if(!e.getIndex())return;const r=e.getIndex().array,o=r.length/3;this._triangleIndexToArea.push(0);for(let a=0;a<o;a++)i.setFromAttributeAndIndices(e.getAttribute("position"),r[a*3],r[a*3+1],r[a*3+2]),s+=i.getArea(),this._triangleIndexToArea.push(s);e.userData.triangleIndexToArea=this._triangleIndexToArea}constructor(e){this.type="mesh_surface",this._triangleIndexToArea=[],this._tempA=new E,this._tempB=new E,this._tempC=new E,e&&(this.geometry=e)}initialize(e){const i=this._geometry;if(!i||i.getIndex()===null){e.position.set(0,0,0),e.velocity.set(0,0,1).multiplyScalar(e.startSpeed);return}const s=this._triangleIndexToArea.length-1;let r=0,o=s;const a=Math.random()*this._triangleIndexToArea[s];for(;r+1<o;){const g=Math.floor((r+o)/2);a<this._triangleIndexToArea[g]?o=g:r=g}let l=Math.random(),c=Math.random();l+c>1&&(l=1-l,c=1-c);const h=i.getIndex().array[r*3],d=i.getIndex().array[r*3+1],u=i.getIndex().array[r*3+2],p=i.getAttribute("position");this._tempA.fromBufferAttribute(p,h),this._tempB.fromBufferAttribute(p,d),this._tempC.fromBufferAttribute(p,u),this._tempB.sub(this._tempA),this._tempC.sub(this._tempA),this._tempA.addScaledVector(this._tempB,l).addScaledVector(this._tempC,c),e.position.copy(this._tempA),this._tempA.copy(this._tempB).cross(this._tempC).normalize(),e.velocity.copy(this._tempA).normalize().multiplyScalar(e.startSpeed)}toJSON(){return{type:"mesh_surface",mesh:this._geometry?this._geometry.uuid:""}}static fromJSON(e,i){return new NM(i.geometries[e.geometry])}clone(){return new NM(this._geometry)}update(e,i){}}lFe({id:"three.quarks",initialize:()=>{},emitterShapes:[{type:"mesh_surface",params:[["geometry",["geometry"]]],constructor:NM,loadJSON:NM.fromJSON}],behaviors:[]});class zZ extends Ae{constructor(){super(),this.batches=[],this.systemToBatchIndex=new Map,this.type="BatchedRenderer",this.depthTexture=null}static equals(e,i){return e.material.side===i.material.side&&e.material.blending===i.material.blending&&e.material.blendSrc===i.material.blendSrc&&e.material.blendDst===i.material.blendDst&&e.material.blendEquation===i.material.blendEquation&&e.material.premultipliedAlpha===i.material.premultipliedAlpha&&e.material.transparent===i.material.transparent&&e.material.depthTest===i.material.depthTest&&e.material.type===i.material.type&&e.material.alphaTest===i.material.alphaTest&&e.material.map===i.material.map&&e.renderMode===i.renderMode&&e.blendTiles===i.blendTiles&&e.softParticles===i.softParticles&&e.softFarFade===i.softFarFade&&e.softNearFade===i.softNearFade&&e.uTileCount===i.uTileCount&&e.vTileCount===i.vTileCount&&e.instancingGeometry===i.instancingGeometry&&e.renderOrder===i.renderOrder&&e.layers.mask===i.layers.mask}addSystem(e){e._renderer=this;const i=e.getRendererSettings();for(let r=0;r<this.batches.length;r++)if(zZ.equals(this.batches[r].settings,i)){this.batches[r].addSystem(e),this.systemToBatchIndex.set(e,r);return}let s;switch(i.renderMode){case ft.Trail:s=new BFe(i);break;case ft.Mesh:case ft.BillBoard:case ft.VerticalBillBoard:case ft.HorizontalBillBoard:case ft.StretchedBillBoard:s=new EFe(i);break}this.depthTexture&&s.applyDepthTexture(this.depthTexture),s.addSystem(e),this.batches.push(s),this.systemToBatchIndex.set(e,this.batches.length-1),this.add(s)}deleteSystem(e){const i=this.systemToBatchIndex.get(e);i!=null&&(this.batches[i].removeSystem(e),this.systemToBatchIndex.delete(e))}setDepthTexture(e){this.depthTexture=e;for(const i of this.batches)i.applyDepthTexture(e)}updateSystem(e){this.deleteSystem(e),this.addSystem(e)}update(e){this.systemToBatchIndex.forEach((i,s)=>{s.update(e)});for(let i=0;i<this.batches.length;i++)this.batches[i].update()}}const kFe=zZ;AFe(),console.log("%c Particle system powered by three.quarks. https://quarks.art/","font-size: 14px; font-weight: bold;");var GFe=Object.defineProperty,PFe=Object.getOwnPropertyDescriptor,Is=(n,e,i,s)=>{for(var r=s>1?void 0:s?PFe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&GFe(e,i,r),r};const s_=q("debugparticles"),NFe=q("noprogressive"),VFe=q("debugprogressive");var sO=(n=>(n[n.Birth=0]="Birth",n[n.Collision=1]="Collision",n[n.Death=2]="Death",n[n.Trigger=3]="Trigger",n[n.Manual=4]="Manual",n))(sO||{});class Qc extends Oe{constructor(){super(...arguments),m(this,"renderMode"),m(this,"particleMaterial"),m(this,"trailMaterial"),m(this,"particleMesh"),m(this,"maxParticleSize"),m(this,"minParticleSize"),m(this,"velocityScale"),m(this,"cameraVelocityScale"),m(this,"lengthScale")}start(){if(this.maxParticleSize!==.5&&this.minParticleSize!==0&&Je()){const e=`ParticleSystem "${this.name}" has non-default min/max particle size. This may not render correctly. Please set min size to 0 and the max size to 0.5 and use the "StartSize" setting instead`;console.warn(e)}}get transparent(){var e;return((e=this.particleMaterial)==null?void 0:e.transparent)??!1}getMaterial(e=!1){let i=e===!0&&this.trailMaterial?this.trailMaterial:this.particleMaterial;return i&&e&&i.side===ms&&(i=i.clone(),i.side=wn,e?this.trailMaterial=i:this.particleMaterial=i),i&&!NFe&&i._didRequestTextureLOD===void 0&&(i._didRequestTextureLOD=0,VFe&&console.log("Load material LOD",i.name),Fi.assignTextureLOD(i,0)),i}getMesh(e){let i=null;if(!i&&(this.particleMesh instanceof pe&&(i=this.particleMesh.geometry),i===null)){i=new Xs(1,1);const s=i.attributes.uv;for(let r=0;r<s.count;r++)s.setX(r,1-s.getX(r))}return new pe(i,this.getMaterial())}}Is([T()],Qc.prototype,"renderMode",2),Is([T(ti)],Qc.prototype,"particleMaterial",2),Is([T(ti)],Qc.prototype,"trailMaterial",2),Is([T()],Qc.prototype,"maxParticleSize",2),Is([T()],Qc.prototype,"minParticleSize",2),Is([T()],Qc.prototype,"velocityScale",2),Is([T()],Qc.prototype,"cameraVelocityScale",2),Is([T()],Qc.prototype,"lengthScale",2);class PB{constructor(e,i=1){m(this,"_curve"),m(this,"_factor"),m(this,"type","function"),this._curve=e,this._factor=i}startGen(e){}genValue(e,i){return this._curve.evaluate(i,Math.random())*this._factor}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class rO{constructor(e){m(this,"type","value"),m(this,"system"),this.system=e}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}startGen(e){}}class XFe extends rO{genValue(){return this.system.textureSheetAnimation.getStartIndex()}}class DFe extends rO{constructor(){super(...arguments),m(this,"_lastPosition",new E),m(this,"_lastDistance",0)}update(){const e=ri(this.system.gameObject);this._lastDistance=this._lastPosition.distanceTo(e),this._lastPosition.copy(e)}genValue(){if(!this.system.isPlaying||!this.system.emission.enabled||this.system.currentParticles>=this.system.maxParticles)return 0;let e=this.system.emission.rateOverTime.evaluate(this.system.time/this.system.duration,Math.random());if(this.system.deltaTime>0){const r=this.system.emission.rateOverDistance.evaluate(this.system.time/this.system.duration,Math.random());let o=this._lastDistance/this.system.deltaTime*r;Number.isFinite(o)||(o=0),e+=o}const i=this.system.emission.getBurst();i>0&&(e+=i/this.system.deltaTime);const s=this.system.maxParticles-this.system.currentParticles;return lt.clamp(e,0,s/this.system.deltaTime)}}class zFe extends rO{genValue(){return this.system.isPlaying,0}}class Dg{constructor(e){m(this,"system"),m(this,"type"),this.type=Object.getPrototypeOf(this).constructor.name||"ParticleSystemBaseBehaviour",e&&(this.system=e)}get context(){return this.system.context}initialize(e){}update(e,i){}frameUpdate(e){}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}reset(){}}class FFe extends Dg{constructor(){super(...arguments),m(this,"type","NeedleTextureSheet")}update(e,i){const s=this.system.textureSheetAnimation;if(s.enabled){const r=e.age/e.life,o=s.evaluate(r);o!==void 0&&(e.uvTile=o)}}}const Yre=Symbol("particleRotation");class UFe extends Dg{constructor(){super(...arguments),m(this,"type","NeedleRotation")}initialize(e){e[Yre]=Math.random()}update(e,i){if(e.rotation===void 0)return;const s=e.age/e.life;if(typeof e.rotation=="number"&&(this.system.rotationOverLifetime.enabled?e.rotation+=this.system.rotationOverLifetime.evaluate(s,e[Yre])*i:this.system.renderer.renderMode===Sp.Billboard&&(e.rotation=Math.PI),this.system.rotationBySpeed.enabled)){const r=e.velocity.length();e.rotation+=this.system.rotationBySpeed.evaluate(s,r)*i}}}const jre=Symbol("sizeLerpFactor"),OFe=new E;class ZFe extends Dg{constructor(){super(...arguments),m(this,"type","NeedleSize"),m(this,"_minSize",0),m(this,"_maxSize",1)}initialize(e){e[jre]=Math.random(),this._minSize=this.system.renderer.minParticleSize,this._maxSize=this.system.renderer.maxParticleSize}update(e,i){const s=e.age/e.life;let r=1;this.system.sizeOverLifetime.enabled&&(r*=this.system.sizeOverLifetime.evaluate(s,void 0,e[jre]).x);let o=1;this.system.renderer.renderMode!==Sp.Mesh&&(o=this.system.worldScale.x/this.system.cameraScale);const a=Lt(e.startSize).multiplyScalar(r*o);if(e.size.set(a.x,a.y,a.z),this.system.localspace){const l=toe(this.system,OFe);e.size.x*=l.x,e.size.y*=l.y,e.size.z*=l.z}}}const Yv=Symbol("particleLife"),oO=Symbol("trailLifetime"),Jre=Symbol("trailStartLength"),aO=Symbol("trailWidthRandom");class WFe extends Dg{constructor(){super(...arguments),m(this,"type","NeedleTrail")}initialize(e){e instanceof i_&&(e[Yv]=e.life,this.system.trails.enabled&&this.system.trails.dieWithParticles===!1&&(e[oO]=this.system.trails.lifetime.evaluate(Math.random(),Math.random()),e.life+=e[oO]),e[Jre]=e.length,e[aO]=Math.random())}update(e){var i;if((i=this.system.trails)!=null&&i.enabled&&e instanceof i_){const s=e,r=e.age/e[Yv],o=e.previous.values(),a=e.previous.length;for(let l=0;l<a;l++){const c=o.next().value,h=1-l/(a-1),d=e.size;if(d.x<=0&&!this.system.trails.sizeAffectsWidth){const u=20*this.system.trails.widthOverTrail.evaluate(.5,s[aO]);d.x=u,d.y=u,d.z=u}c.size=this.system.trails.getWidth(d.x,r,h,s[aO]),c.color.copy(e.color),this.system.trails.getColor(c.color,r,h)}if(e.age>e[Yv]){e.velocity.set(0,0,0);const l=(e.age-e[Yv])/e[oO];s.length=lt.lerp(e[Jre],0,l)}}}}const NB=Symbol("startVelocity"),qre=Symbol("gravityModifier"),lO=Symbol("gravitySpeed"),VB=Symbol("velocity lerp factor"),cO=new E;class HFe extends Dg{constructor(){super(...arguments),m(this,"type","NeedleVelocity"),m(this,"_gravityDirection",new E)}initialize(e){var i,s;const r=this.system.main.simulationSpeed;e.startSpeed=this.system.main.startSpeed.evaluate(Math.random(),Math.random());const o=this.system.shape.getDirection(e,e.position);e.velocity.x=o.x*e.startSpeed,e.velocity.y=o.y*e.startSpeed,e.velocity.z=o.z*e.startSpeed,(i=this.system.inheritVelocity)!=null&&i.enabled&&this.system.inheritVelocity.applyInitial(e.velocity),e[NB]?e[NB].copy(e.velocity):e[NB]=e.velocity.clone();const a=this.system.main.gravityModifier.evaluate(Math.random(),Math.random());e[qre]=a*r,e[lO]=a*r*.5,e[VB]=Math.random(),(s=this.system.velocityOverLifetime)==null||s.init(e),this._gravityDirection.set(0,-1,0),this.system.main.simulationSpace===GS.Local&&this._gravityDirection.applyQuaternion(this.system.worldQuaternionInverted).normalize()}update(e,i){var s;const r=e[NB],o=e[qre];if(o!==0){const p=o*e[lO];cO.copy(this._gravityDirection).multiplyScalar(p),e[lO]+=i*.05,r.add(cO)}e.velocity.copy(r);const a=e.age/e.life;(s=this.system.inheritVelocity)!=null&&s.enabled&&this.system.inheritVelocity.applyCurrent(e.velocity,a,e[VB]);const l=this.system.noise;l.enabled&&l.apply(0,e.position,e.velocity,i,e.age,e.life);const c=this.system.sizeBySpeed;c!=null&&c.enabled&&(e.size=c.evaluate(e.velocity,a,e[VB],e.size));const h=this.system.colorBySpeed;h!=null&&h.enabled&&h.evaluate(e.velocity,e[VB],e.color);const d=this.system.velocityOverLifetime;d.enabled&&d.apply(e,0,e.position,e.velocity,i,e.age,e.life);const u=this.system.limitVelocityOverLifetime;if(u.enabled&&u.apply(e.position,r,e.velocity,e.size,a,i,1),this.system.worldspace){const p=this.system.worldScale;e.velocity.x*=p.x,e.velocity.y*=p.y,e.velocity.z*=p.z}}}const $re=Symbol("colorLerpFactor"),eoe=new pn(1,1,1,1),pA=new pn(1,1,1,1);class QFe extends Dg{constructor(){super(...arguments),m(this,"type","NeedleColor")}initialize(e){}_init(e){const i=this.system.renderer.particleMaterial;pA.copy(this.system.main.startColor.evaluate(Math.random())),i!=null&&i.color&&(eoe.copy(i.color),pA.multiply(eoe)),pA.convertLinearToSRGB(),e.startColor.set(pA.r,pA.g,pA.b,pA.alpha),e.color.copy(e.startColor),e[$re]=Math.random()}update(e,i){if(e.age===0&&this._init(e),this.system.colorOverLifetime.enabled){const s=e.age/e.life,r=this.system.colorOverLifetime.color.evaluate(s,e[$re]);e.color.set(r.r,r.g,r.b,"alpha"in r?r.alpha:1).multiply(e.startColor)}else e.color.copy(e.startColor)}}class KFe{constructor(e){m(this,"system"),m(this,"emission"),m(this,"autoDestroy"),m(this,"startLength"),m(this,"emissionBursts"),m(this,"onlyUsedByOther"),m(this,"behaviors",[]),m(this,"rendererEmitterSettings",{startLength:new cn(220),followLocalOrigin:!1}),m(this,"flatWhiteTexture"),m(this,"clonedTexture",{original:void 0,clone:void 0}),this.system=e,this.emission=new DFe(this.system)}get anim(){return this.system.textureSheetAnimation}get prewarm(){return!1}get material(){return this.system.renderer.getMaterial(this.system.trails.enabled)}get layers(){return this.system.gameObject.layers}update(){this.emission.update()}get looping(){return this.system.main.loop}get duration(){return this.system.duration}get shape(){return this.system.shape}get startLife(){return new PB(this.system.main.startLifetime)}get startSpeed(){return new PB(this.system.main.startSpeed)}get startRotation(){return new PB(this.system.main.startRotation)}get startSize(){return new PB(this.system.main.startSize)}get startColor(){return new NA(new Al(1,1,1,1))}get emissionOverTime(){return this.emission}get emissionOverDistance(){return new zFe(this.system)}get instancingGeometry(){return this.system.renderer.getMesh(this.system.renderer.renderMode).geometry}get renderMode(){if(this.system.trails.enabled===!0)return ft.Trail;switch(this.system.renderer.renderMode){case Sp.Billboard:return ft.BillBoard;case Sp.Stretch:return ft.StretchedBillBoard;case Sp.HorizontalBillboard:return ft.HorizontalBillBoard;case Sp.VerticalBillboard:return ft.VerticalBillBoard;case Sp.Mesh:return ft.Mesh}return ft.BillBoard}get speedFactor(){var e;let i=this.system.main.simulationSpeed;return((e=this.system.renderer)==null?void 0:e.renderMode)===Sp.Stretch&&(i*=this.system.renderer.velocityScale??1),i}get texture(){const e=this.material;if(e&&e.map){const i=e.map;if(this.clonedTexture.original!==i||!this.clonedTexture.clone){const s=i.clone();s.premultiplyAlpha=!1,s.colorSpace=qi,this.clonedTexture.original=i,this.clonedTexture.clone=s}return this.clonedTexture.clone}return this.flatWhiteTexture||(this.flatWhiteTexture=wF(new pn(1,1,1,1),1)),this.flatWhiteTexture}get startTileIndex(){return new XFe(this.system)}get uTileCount(){var e;return this.anim.enabled?(e=this.anim)==null?void 0:e.numTilesX:void 0}get vTileCount(){var e;return this.anim.enabled?(e=this.anim)==null?void 0:e.numTilesY:void 0}get renderOrder(){return 1}get blending(){var e;return((e=this.system.renderer.particleMaterial)==null?void 0:e.blending)??Au}get transparent(){return this.system.renderer.transparent}get worldSpace(){return this.system.main.simulationSpace===GS.World}}class YFe{constructor(){m(this,"burstParticleIndex",0),m(this,"burstParticleCount",0),m(this,"isBursting",!1),m(this,"travelDistance",0),m(this,"previousWorldPos"),m(this,"burstIndex",0),m(this,"burstWaveIndex",0),m(this,"time",0),m(this,"waitEmiting",0)}}const XB=class extends Oe{constructor(){super(...arguments),m(this,"_state"),m(this,"colorOverLifetime"),m(this,"main"),m(this,"emission"),m(this,"sizeOverLifetime"),m(this,"shape"),m(this,"noise"),m(this,"trails"),m(this,"velocityOverLifetime"),m(this,"limitVelocityOverLifetime"),m(this,"inheritVelocity"),m(this,"colorBySpeed"),m(this,"textureSheetAnimation"),m(this,"rotationOverLifetime"),m(this,"rotationBySpeed"),m(this,"sizeBySpeed"),m(this,"_cameraScale",1),m(this,"__worldQuaternion",new Fe),m(this,"_worldQuaternionInverted",new Fe),m(this,"_worldScale",new E),m(this,"_worldPositionFrame",-1),m(this,"_worldPos",new E),m(this,"_renderer"),m(this,"_batchSystem"),m(this,"_particleSystem"),m(this,"_interface"),m(this,"_container"),m(this,"_time",0),m(this,"_isPlaying",!0),m(this,"_isUsedAsSubsystem",!1),m(this,"_didPreWarm",!1),m(this,"_bursts"),m(this,"_subEmitterSystems"),m(this,"_lastBatchesCount",-1),m(this,"lastMaterialVersion",-1)}play(n=!1){var e;n&&$.foreachComponent(this.gameObject,i=>{i instanceof XB&&i!==this&&i.play(!1)},!0),this._isPlaying=!0,this._particleSystem&&(this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1),(e=this.emission)==null||e.reset()}pause(n=!0){n&&$.foreachComponent(this.gameObject,e=>{e instanceof XB&&e!==this&&e.pause(!1)},!0),this._isPlaying=!1}stop(n=!0,e=!1){n&&$.foreachComponent(this.gameObject,i=>{i instanceof XB&&i!==this&&i.stop(!1,e)},!0),this._isPlaying=!1,this._time=0,e&&this.reset()}reset(){var n;this._time=0,this._particleSystem&&(this._particleSystem.particleNum=0,this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1,(n=this.emission)==null||n.reset())}emit(n){if(this._particleSystem){this.onUpdate(),n=Math.min(n,this.maxParticles-this.currentParticles),this._state||(this._state=new YFe),this._state.waitEmiting=n,this._state.time=0;const e=this._particleSystem.emitEnded;this._particleSystem.emitEnded=!1,this._particleSystem.emit(this.deltaTime,this._state,this._particleSystem.emitter.matrixWorld),this._particleSystem.emitEnded=e}}get playOnAwake(){return this.main.playOnAwake}set playOnAwake(n){this.main.playOnAwake=n}get renderer(){return this._renderer}get isPlaying(){return this._isPlaying}get currentParticles(){var n;return((n=this._particleSystem)==null?void 0:n.particleNum)??0}get maxParticles(){return this.main.maxParticles}get time(){return this._time}get duration(){return this.main.duration}get deltaTime(){return this.context.time.deltaTime*this.main.simulationSpeed}get scale(){return this.gameObject.scale.x}get cameraScale(){return this._cameraScale}get container(){return this._container}get worldspace(){return this.main.simulationSpace===GS.World}get localspace(){return this.main.simulationSpace===GS.Local}get worldQuaternion(){return this.__worldQuaternion}get worldQuaternionInverted(){return this._worldQuaternionInverted}get worldScale(){return this._worldScale}get worldPos(){return this._worldPositionFrame!==this.context.time.frame&&(this._worldPositionFrame=this.context.time.frame,ri(this.gameObject,this._worldPos)),this._worldPos}get matrixWorld(){return this._container.matrixWorld}get isSubsystem(){return this._isUsedAsSubsystem}addBehaviour(n){return this._particleSystem?(n instanceof Dg&&(n.system=this),Je()&&console.log("add behaviour",n),this._particleSystem.addBehavior(n),!0):!1}removeBehaviour(n){if(!this._particleSystem)return!1;const e=this._particleSystem.behaviors,i=e.indexOf(n);return i!==-1&&e.splice(i,1),!0}removeAllBehaviours(){return this._particleSystem?(this._particleSystem.behaviors.length=0,!0):!1}get behaviours(){return this._particleSystem?this._particleSystem.behaviors:null}get particleSystem(){return this._particleSystem??null}set bursts(n){for(let e=0;e<n.length;e++){const i=n[e];if(!(i instanceof NS)){const s=new NS;Wb(s,i),n[e]=s}}this._bursts=n}set subEmitterSystems(n){for(let e=0;e<n.length;e++){const i=n[e];if(!(i instanceof r_)){const s=new r_;Wb(s,i),n[e]=s}}s_&&n.length>0&&console.log("SubEmitters: ",n,this),this._subEmitterSystems=n}onAfterDeserialize(n){if(this._subEmitterSystems&&Array.isArray(this._subEmitterSystems))for(const e of this._subEmitterSystems)e._deserialize(this.context,this.gameObject)}awake(){if(this._worldPositionFrame=-1,this._renderer=this.gameObject.getComponent(Qc),!this.main)throw new Error("Not Supported: ParticleSystem needs a serialized MainModule. Creating new particle systems at runtime is currently not supported.");this._container=new Ae,this._container.matrixAutoUpdate=!1,this.context.scene.add(this._container),this._batchSystem=new kFe,this._batchSystem.name=this.gameObject.name,this._container.add(this._batchSystem),this._interface=new KFe(this),this._particleSystem=new CFe(this._interface),this._particleSystem.addBehavior(new ZFe(this)),this._particleSystem.addBehavior(new QFe(this)),this._particleSystem.addBehavior(new FFe(this)),this._particleSystem.addBehavior(new UFe(this)),this._particleSystem.addBehavior(new HFe(this)),this._particleSystem.addBehavior(new WFe(this)),this._batchSystem.addSystem(this._particleSystem);const n=this._particleSystem.emitter;this.context.scene.add(n),this.inheritVelocity.system&&this.inheritVelocity.system!==this&&(this.inheritVelocity=this.inheritVelocity.clone()),this.inheritVelocity.awake(this),s_&&(console.log(this),this.gameObject.add(new Ya(1)))}start(){this.addSubParticleSystems(),this.updateLayers(),this.renderer.particleMesh instanceof pe&&this._interface.renderMode==ft.Mesh&&Fi.assignMeshLOD(this.renderer.particleMesh,0).then(n=>{n&&this.particleSystem&&this._interface.renderMode==ft.Mesh&&(this.particleSystem.instancingGeometry=n)})}onDestroy(){var n,e,i,s;(n=this._container)==null||n.removeFromParent(),(e=this._batchSystem)==null||e.removeFromParent(),(i=this._particleSystem)==null||i.emitter.removeFromParent(),(s=this._particleSystem)==null||s.dispose()}onEnable(){this.main&&(this.inheritVelocity&&(this.inheritVelocity.system=this),this._batchSystem&&(this._batchSystem.visible=!0),this.playOnAwake&&this.play(),this._isPlaying=this.playOnAwake)}onDisable(){this._batchSystem&&(this._batchSystem.visible=!1)}onBeforeRender(){var n;this.main&&(this._didPreWarm===!1&&((n=this.main)==null?void 0:n.prewarm)===!0&&(this._didPreWarm=!0,this.preWarm()),this.onUpdate(),this.onSimulate(this.deltaTime))}preWarm(){var n;if(!((n=this.emission)!=null&&n.enabled)||this.emission.rateOverTime.getMax()<=0)return;const e=1/60,i=this.main.duration,s=this.main.startLifetime.getMax(),r=1e3,o=Math.min(Math.max(i,s)/Math.max(.01,this.main.simulationSpeed),r),a=Math.ceil(o/e),l=Date.now();s_&&console.log(`Particles ${this.name} - Prewarm for ${a} frames (${o} sec). Duration: ${i}, Lifetime: ${s}`);for(let c=0;c<a&&!(this.currentParticles>=this.maxParticles);c++){const h=Date.now()-l;if(h>2e3){console.warn(`Particles ${this.name} - Prewarm took too long. Aborting: ${h}`);break}this.onUpdate(),this.onSimulate(e)}}onSimulate(n){if(this._batchSystem){let e=this.context.time.frameCount%60===0;this._lastBatchesCount!==this._batchSystem.batches.length&&(this._lastBatchesCount=this._batchSystem.batches.length,e=!0),e&&this.updateLayers(),this._batchSystem.update(n)}this._time+=n,this._time>this.duration&&(this._time=0)}updateLayers(){if(this._batchSystem)for(let n=0;n<this._batchSystem.batches.length;n++){const e=this._batchSystem.batches[n];e.layers.disableAll();const i=this.layer;e.layers.mask=1<<i}}onUpdate(){var n,e;const i=this.renderer.getMaterial(this.trails.enabled);if(i&&i.version!=this.lastMaterialVersion&&this._particleSystem&&(this.lastMaterialVersion=i.version,this._particleSystem.texture=this._interface.texture),this._bursts&&(this.emission.bursts=this._bursts,delete this._bursts),!this._isPlaying)return;const s=this.context.mainCamera;if(s){const a=Dn(s);this._cameraScale=a.x}const r=!this.worldspace,o=this.gameObject;if(fn(o,this.__worldQuaternion),this._worldQuaternionInverted.copy(this.__worldQuaternion).invert(),Dn(this.gameObject,this._worldScale),r&&this._container&&(n=this.gameObject)!=null&&n.parent){const a=toe(this,cO);this._container.matrix.makeScale(a.x,a.y,a.z),this._container.matrix.makeRotationFromQuaternion(this.__worldQuaternion),this._container.matrix.setPosition(this.worldPos),this._container.matrix.scale(this.gameObject.scale)}this.emission.system=this,this._interface.update(),this.shape.onUpdate(this,this.context,this.main.simulationSpace,this.gameObject),this.noise.update(this.context),(e=this.inheritVelocity)==null||e.update(this.context),this.velocityOverLifetime.update(this)}addSubParticleSystems(){var n;if(this._subEmitterSystems&&this._particleSystem)for(const e of this._subEmitterSystems){e.particleSystem&&(e.particleSystem.__internalAwake?e.particleSystem.__internalAwake():Je()&&console.warn("SubParticleSystem serialization issue(?)",e.particleSystem,e));const i=(n=e.particleSystem)==null?void 0:n._particleSystem;if(i){e.particleSystem._isUsedAsSubsystem=!0;const s=new DB(this,this._particleSystem,e.particleSystem,i);s.emitterType=e.type,s.emitterProbability=e.emitProbability,this._particleSystem.addBehavior(s)}else s_&&console.warn("Could not add SubParticleSystem",e,this)}}};let pr=XB;Is([T(VS)],pr.prototype,"colorOverLifetime",2),Is([T(Bo)],pr.prototype,"main",2),Is([T(Jd)],pr.prototype,"emission",2),Is([T(Ig)],pr.prototype,"sizeOverLifetime",2),Is([T(Ss)],pr.prototype,"shape",2),Is([T(mn)],pr.prototype,"noise",2),Is([T(cs)],pr.prototype,"trails",2),Is([T(_s)],pr.prototype,"velocityOverLifetime",2),Is([T(dr)],pr.prototype,"limitVelocityOverLifetime",2),Is([T(Tg)],pr.prototype,"inheritVelocity",2),Is([T(iA)],pr.prototype,"colorBySpeed",2),Is([T(ko)],pr.prototype,"textureSheetAnimation",2),Is([T(Wc)],pr.prototype,"rotationOverLifetime",2),Is([T(tc)],pr.prototype,"rotationBySpeed",2),Is([T(za)],pr.prototype,"sizeBySpeed",2);class r_{constructor(){m(this,"particleSystem"),m(this,"emitProbability",1),m(this,"properties"),m(this,"type")}_deserialize(e,i){const s=this.particleSystem;if(s instanceof pr)return;let r="";s&&typeof s.guid=="string"&&(r=s.guid,this.particleSystem=$.findByGuid(r,i)),s_&&!(this.particleSystem instanceof pr)&&console.warn("Could not find particle system for sub emitter",r,i,this)}}function toe(n,e){if(e.set(1,1,1),n.gameObject.parent&&n.localspace)switch(n.main.scalingMode){case r3.Local:e=Dn(n.gameObject.parent,e),e.x=1/e.x,e.y=1/e.y,e.z=1/e.z;break;default:if(!n.unsupported_scaling_mode){n.unsupported_scaling_mode=!0;const i="ParticleSystem scale mode "+r3[n.main.scalingMode]+" is not supported";Je()&&An(i),console.warn(i,n.name,n)}e=Dn(n.gameObject,e);break}return e}new E(1,1,1),new E(0,0,1);class DB{constructor(e,i,s,r){m(this,"type","NeedleParticleSubEmitter"),m(this,"emitterType"),m(this,"emitterProbability"),m(this,"q_",new Fe),m(this,"v_",new E),m(this,"v2_",new E),m(this,"_emitterMatrix",new Up),m(this,"_circularBuffer"),this.system=e,this.particleSystem=i,this.subSystem=s,this.subParticleSystem=r,this.subParticleSystem&&this.subParticleSystem&&(this.subParticleSystem.onlyUsedByOther=!0);const o=1e3;this._circularBuffer=new El(()=>new Up,o)}clone(){throw new Error("Method not implemented.")}initialize(e){e.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this._emitterMatrix.copy(this.subSystem.matrixWorld).invert().premultiply(this.system.matrixWorld),this._emitterMatrix.setPosition(0,0,0),this.emitterType===sO.Birth&&this.run(e)}update(e,i){this.run(e)}frameUpdate(e){}toJSON(){}reset(){}run(e){if(this.subSystem.currentParticles>=this.subSystem.main.maxParticles||!this.subParticleSystem||!e.emissionState||this.emitterProbability&&Math.random()>this.emitterProbability)return;const i=this.system.deltaTime;if(this.emitterType===sO.Death){let r=e.life;if(e[Yv]!==void 0&&(r=e[Yv]),!(e.age+i*1.2>=r))return;const o=this.subSystem.main.maxParticles-this.subSystem.currentParticles;e.emissionState.waitEmiting=o}const s=new Up;s.set(1,0,0,e.position.x,0,1,0,e.position.y,0,0,1,e.position.z,0,0,0,1),this.particleSystem.worldSpace||s.multiplyMatrices(this._emitterMatrix,s),this.subParticleSystem.emit(i,e.emissionState,s)}}var jFe=Object.defineProperty,JFe=Object.getOwnPropertyDescriptor,qFe=(n,e,i,s)=>{for(var r=s>1?void 0:s?JFe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&jFe(e,i,r),r};class o_ extends qr{constructor(){super(...arguments),m(this,"granularity",new at(10))}get typeName(){return"PixelationEffect"}onCreateEffect(){const e=new s7;return this.granularity.onValueChanged=i=>{e.granularity=i},e}}qFe([T(at)],o_.prototype,"granularity",2),Uc("PixelationEffect",o_);class Tx extends Oe{constructor(){super(...arguments),m(this,"_didAssignPlayerColor",!1),m(this,"tryAssignColor",()=>{const e=$.getComponentInParent(this.gameObject,jl);if(e&&e.owner)return this._didAssignPlayerColor=!0,this.assignUserColor(e.owner),!0;const i=$.getComponentInParent(this.gameObject,Eo);return i!=null&&i.connectionId?(this._didAssignPlayerColor=!0,this.assignUserColor(i.connectionId),!0):!1})}onEnable(){this.context.connection.beginListen(pi.JoinedRoom,this.tryAssignColor),this._didAssignPlayerColor||this.startCoroutine(this.waitForConnection())}onDisable(){this.context.connection.stopListen(pi.JoinedRoom,this.tryAssignColor)}*waitForConnection(){for(;!this.destroyed&&this.activeAndEnabled&&(yield wie(.2),!this.tryAssignColor()););}assignUserColor(e){const i=Tx.hashCode(e),s=Tx.colorFromHashCode(i);if(this.gameObject.type==="Mesh"){const r=this.gameObject;this.assignColor(s,e,r)}else if(this.gameObject.children)for(const r of this.gameObject.children){const o=r;o.material&&o.material.color&&this.assignColor(s,e,o)}}assignColor(e,i,s){let r=s.material;r&&(r._playerMaterial!==i&&(r=r.clone(),r._playerMaterial=i,s.material=r),r.color=e)}static hashCode(e){var i=0,s,r;if(e.length===0)return i;for(s=0;s<e.length;s++)r=e.charCodeAt(s),i=(i<<5)-i+r,i|=0;return i}static colorFromHashCode(e){const i=(e&16711680)>>16,s=(e&65280)>>8,r=e&255;return new fe(i/255,s/255,r/255)}}const a_=new Rt;a_.setAttribute("position",new ct(new Float32Array([-1,-1,3,-1,-1,3]),2)),a_.setAttribute("uv",new ct(new Float32Array([0,0,2,0,0,2]),2)),a_.boundingSphere=new Vn,a_.computeBoundingSphere=function(){};const $Fe=new lh;class mA{constructor(e){this._mesh=new pe(a_,e),this._mesh.frustumCulled=!1}render(e){e.render(this._mesh,$Fe)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}}const eUe={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new de},viewMat:{value:new de},projViewMat:{value:new de},projectionMatrixInv:{value:new de},viewMatrixInv:{value:new de},cameraPos:{value:new E},resolution:{value:new Q},biasAdjustment:{value:new Q},time:{value:0},samples:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1},frame:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform highp sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform vec2 biasAdjustment;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform float frame;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      /*return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);*/
       #ifdef ORTHO

       return linearize_depth_ortho(d, nearZ, farZ);

        #else
        return linearize_depth(linDepth, nearZ, farZ);
        #endif
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        #ifndef ORTHO
          return getWorldPosLog(vec3(coord, depth));
        #endif
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

mat3 makeRotationZ(float theta) {
	float c = cos(theta);
	float s = sin(theta);
	return mat3(c, - s, 0,
			s,  c, 0,
			0,  0, 1);
  }

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec2 harmoniousNumbers = vec2(
        1.618033988749895,
        1.324717957244746
      );
      noise.rg += harmoniousNumbers * frame;
      noise.rg = fract(noise.rg);
        vec3 helperVec = vec3(0.0, 1.0, 0.0);
        if (dot(helperVec, normal) > 0.99) {
          helperVec = vec3(1.0, 0.0, 0.0);
        }
        vec3 tangent = normalize(cross(helperVec, normal));
        vec3 bitangent = cross(normal, tangent);
        mediump mat3 tbn = mat3(tangent, bitangent, normal) *  makeRotationZ( noise.r * 3.1415962 * 2.0) ;

      mediump float occluded = 0.0;
      mediump float totalWeight = 0.0;
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : radiusToUse * distanceFalloff * 0.2;
      float bias = (min(
        0.1,
        distanceFalloffToUse * 0.1
      ) / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      bias = biasAdjustment.x + biasAdjustment.y * bias;
      mediump float offsetMove = noise.g;
      mediump float offsetMoveInv = 1.0 / FSAMPLES;
      float farTimesNear = far * near;
      float farMinusNear = far - near;
      
      for(int i = 0; i < SAMPLES; i++) {
        mediump vec3 sampleDirection = tbn * samples[i];

        float moveAmt = fract(offsetMove);
        offsetMove += offsetMoveInv;
        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        
        if (all(greaterThan(offset.xyz * (1.0 - offset.xyz), vec3(0.0)))) {
          float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;

          /*#ifdef LOGDEPTH
          float distSample = linearize_depth_log(sampleDepth, near, far);
      #else
          #ifdef ORTHO
              float distSample = near + farMinusNear * sampleDepth;
          #else
              float distSample = (farTimesNear) / (far - sampleDepth * farMinusNear);
          #endif
      #endif*/
      #ifdef ORTHO
          float distSample = near + sampleDepth * farMinusNear;
      #else
          #ifdef LOGDEPTH
              float distSample = linearize_depth_log(sampleDepth, near, far);
          #else
              float distSample = (farTimesNear) / (far - sampleDepth * farMinusNear);
          #endif
      #endif
      
      #ifdef ORTHO
          float distWorld = near + offset.z * farMinusNear;
      #else
          float distWorld = (farTimesNear) / (far - offset.z * farMinusNear);
      #endif
          
          mediump float rangeCheck = smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
          vec2 diff = gl_FragCoord.xy - floor(offset.xy * resolution);
          occluded += rangeCheck * float(distSample != distWorld) * float(sampleDepth != depth) * step(distSample + bias, distWorld) * step(
            1.0,
            dot(diff, diff)
          );
          
          totalWeight ++;
        }
      }
      float occ = clamp(1.0 - occluded / (totalWeight == 0.0 ? 1.0 : totalWeight), 0.0, 1.0);
      gl_FragColor = vec4(occ, 0.5 + 0.5 * normal);
}`},tUe={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},transparencyDWFalse:{value:null},transparencyDWTrue:{value:null},transparencyDWTrueDepth:{value:null},transparencyAware:{value:!1},projMat:{value:new de},viewMat:{value:new de},projectionMatrixInv:{value:new de},viewMatrixInv:{value:new de},cameraPos:{value:new E},resolution:{value:new Q},color:{value:new E(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1},fog:{value:!1},fogExp:{value:!1},fogDensity:{value:0},fogNear:{value:1/0},fogFar:{value:1/0},colorMultiply:{value:!0},aoTones:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform highp sampler2D downsampledDepth;
    uniform highp sampler2D transparencyDWFalse;
    uniform highp sampler2D transparencyDWTrue;
    uniform highp sampler2D transparencyDWTrueDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform float aoTones;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform bool fog;
    uniform bool fogExp;
    uniform bool colorMultiply;
    uniform bool transparencyAware;
    uniform float fogDensity;
    uniform float fogNear;
    uniform float fogFar;
    uniform float radius;
    uniform float distanceFalloff;
    uniform vec3 cameraPos;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          #ifndef ORTHO
            return getWorldPosLog(vec3(coord, depth));
          #endif
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        #ifdef HALFRES 
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.gba * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

        #ifdef LOGDEPTH
        texel.r = clamp(texel.r, 0.0, 1.0);
        if (texel.r == 0.0) {
          texel.r = 1.0;
        }
        #endif
     
        float finalAo = pow(texel.r, intensity);
        if (aoTones > 0.0) {
            finalAo = ceil(finalAo * aoTones) / aoTones;
        }
        float fogFactor;
        float fogDepth = distance(
            cameraPos,
            getWorldPos(depth, vUv)
        );
        if (fog) {
            if (fogExp) {
                fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
            } else {
                fogFactor = smoothstep( fogNear, fogFar, fogDepth );
            }
        }
        if (transparencyAware) {
            float transparencyDWOff = texture2D(transparencyDWFalse, vUv).a;
            float transparencyDWOn = texture2D(transparencyDWTrue, vUv).a;
            float adjustmentFactorOff = transparencyDWOff;
            float adjustmentFactorOn = (1.0 - transparencyDWOn) * (
                texture2D(transparencyDWTrueDepth, vUv).r == texture2D(sceneDepth, vUv).r ? 1.0 : 0.0
            );
            float adjustmentFactor = max(adjustmentFactorOff, adjustmentFactorOn);
            finalAo = mix(finalAo, 1.0, adjustmentFactor);
        }
        finalAo = mix(finalAo, 1.0, fogFactor);
        vec3 aoApplied = color * mix(vec3(1.0), sceneTexel.rgb, float(colorMultiply));
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = sRGBTransferOETF(gl_FragColor);
        }
    }
    `},iUe={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new de},viewMat:{value:new de},projectionMatrixInv:{value:new de},viewMatrixInv:{value:new de},cameraPos:{value:new E},resolution:{value:new Q},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
      #ifndef ORTHO
          return getWorldPosLog(vec3(coord, depth));
      #endif
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.r;
        float baseOcc = data.r;
        vec3 normal = data.gba * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        if (d == 1.0) {
          gl_FragColor = data;
          return;
        }
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
        radiusToUse * distanceFalloff
    : radiusToUse * distanceFalloff * 0.2;

        float invDistance = (1.0 / distanceFalloffToUse);
        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.r;
            vec3 normalSample = dataSample.gba * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
            float rangeCheck = float(dSample != 1.0) * exp(-1.0 * tangentPlaneDist * invDistance ) * max(dot(normal, normalSample), 0.0);
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        if (count > 0.0) {
          occlusion /= count;
        }
        #ifdef LOGDEPTH
          occlusion = clamp(occlusion, 0.0, 1.0);
          if (occlusion == 0.0) {
            occlusion = 1.0;
          }
        #endif
        gl_FragColor = vec4(occlusion, 0.5 + 0.5 * normal);
    }
    `},nUe={uniforms:{sceneDepth:{value:null},resolution:{value:new Q},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new de},projectionMatrixInv:{value:new de},logDepth:{value:!1},ortho:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform highp sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform bool ortho;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth && !ortho) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        highp vec2[4] uvSamples;
        uvSamples[0] = uv;
        uvSamples[1] = uv + vec2(pixelSize.x, 0.0);
        uvSamples[2] = uv + vec2(0.0, pixelSize.y);
        uvSamples[3] = uv + pixelSize;
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[4] samples;
        samples[0] = depth00;
        samples[1] = depth10;
        samples[2] = depth01;
        samples[3] = depth11;
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
    }`};var ioe="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";const sUe=(()=>parseInt(fa.replace(/\D+/g,"")))(),rUe=sUe>=162?class extends fi{constructor(n=1,e=1,i=1,s={}){super(n,e,{...s,count:i}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}:class extends fi{constructor(n=1,e=1,i=1,s={}){super(n,e,s),this.isWebGLMultipleRenderTargets=!0;const r=this.texture;this.texture=[];for(let o=0;o<i;o++)this.texture[o]=r.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(n,e,i=1){if(this.width!==n||this.height!==e||this.depth!==i){this.width=n,this.height=e,this.depth=i;for(let s=0,r=this.texture.length;s<r;s++)this.texture[s].image.width=n,this.texture[s].image.height=e,this.texture[s].image.depth=i;this.dispose()}this.viewport.set(0,0,n,e),this.scissor.set(0,0,n,e)}copy(n){this.dispose(),this.width=n.width,this.height=n.height,this.depth=n.depth,this.scissor.copy(n.scissor),this.scissorTest=n.scissorTest,this.viewport.copy(n.viewport),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,n.depthTexture!==null&&(this.depthTexture=n.depthTexture.clone()),this.texture.length=0;for(let e=0,i=n.texture.length;e<i;e++)this.texture[e]=n.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}},oUe=Uint8Array.from(atob(ioe),n=>n.charCodeAt(0));function noe(n,e,i){if(e.getQueryParameter(n,e.QUERY_RESULT_AVAILABLE)){const s=e.getQueryParameter(n,e.QUERY_RESULT)/1e6;i.lastTime=i.lastTime===0?s:i.timeRollingAverage*i.lastTime+(1-i.timeRollingAverage)*s}else setTimeout(()=>{noe(n,e,i)},1)}class soe extends Fr{constructor(e,i,s=512,r=512){super(),this.width=s,this.height=r,this.clear=!0,this.camera=i,this.scene=e,this.autosetGamma=!0,this.configuration=new Proxy({aoSamples:16,aoRadius:5,aoTones:0,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,biasOffset:0,biasMultiplier:0,color:new fe(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0,colorMultiply:!0,transparencyAware:!1,accumulate:!1},{set:(o,a,l)=>{const c=o[a];return o[a]=l,l.equals?l.equals(c)||this.firstFrame():c!==l&&this.firstFrame(),a==="aoSamples"&&c!==l&&this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),a==="denoiseSamples"&&c!==l&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),a==="halfRes"&&c!==l&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.setSize(this.width,this.height)),a==="depthAwareUpsampling"&&c!==l&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),a==="gammaCorrection"&&(this.autosetGamma=!1),a==="transparencyAware"&&c!==l&&(this.autoDetectTransparency=!1,this.configureTransparencyTarget()),!0}}),this.samples=[],this.samplesDenoise=[],this.autoDetectTransparency=!0,this.frames=0,this.lastViewMatrix=new de,this.lastProjectionMatrix=new de,this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.detectTransparency(),this.configureTransparencyTarget(),this.copyQuad=new mA(new jt({uniforms:{tDiffuse:{value:null}},depthWrite:!1,vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }
            `,fragmentShader:`
            uniform sampler2D tDiffuse;
            varying vec2 vUv;
            void main() {
                gl_FragColor = texture2D(tDiffuse, vUv);
            }
            `})),this.writeTargetInternal=new fi(this.width,this.height,{minFilter:Wt,magFilter:Wt,depthBuffer:!1,format:_i}),this.readTargetInternal=new fi(this.width,this.height,{minFilter:Wt,magFilter:Wt,depthBuffer:!1,format:_i}),this.outputTargetInternal=new fi(this.width,this.height,{minFilter:Wt,magFilter:Wt,depthBuffer:!1}),this.accumulationRenderTarget=new fi(this.width,this.height,{minFilter:Wt,magFilter:Wt,depthBuffer:!1,format:_i,type:Ki,stencilBuffer:!1,depthBuffer:!1,alpha:!0}),this.accumulationQuad=new mA(new jt({uniforms:{frame:{value:0},tDiffuse:{value:null}},transparent:!0,opacity:1,vertexShader:`
             varying vec2 vUv;
             void main() {
                 vUv = uv;
                 gl_Position = vec4(position, 1);
             }`,fragmentShader:`
             uniform sampler2D tDiffuse;
             uniform float frame;
                varying vec2 vUv;
                void main() {
                    vec4 color = texture2D(tDiffuse, vUv);
                    gl_FragColor = vec4(color.rgb, 1.0 / (frame + 1.0));
                }
                `})),this.bluenoise=new nr(oUe,128,128),this.bluenoise.colorSpace=ho,this.bluenoise.wrapS=lo,this.bluenoise.wrapT=lo,this.bluenoise.minFilter=si,this.bluenoise.magFilter=si,this.bluenoise.needsUpdate=!0,this.lastTime=0,this.timeRollingAverage=.99,this.needsDepthTexture=!0,this.needsSwap=!0,this._r=new Q,this._c=new fe}configureHalfResTargets(){this.firstFrame(),this.configuration.halfRes?(this.depthDownsampleTarget=new rUe(this.width/2,this.height/2,2),this.depthDownsampleTarget.textures[0].format=vl,this.depthDownsampleTarget.textures[0].type=en,this.depthDownsampleTarget.textures[0].minFilter=si,this.depthDownsampleTarget.textures[0].magFilter=si,this.depthDownsampleTarget.textures[0].depthBuffer=!1,this.depthDownsampleTarget.textures[1].format=_i,this.depthDownsampleTarget.textures[1].type=Ki,this.depthDownsampleTarget.textures[1].minFilter=si,this.depthDownsampleTarget.textures[1].magFilter=si,this.depthDownsampleTarget.textures[1].depthBuffer=!1,this.depthDownsampleQuad=new mA(new jt(nUe))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}detectTransparency(){if(this.autoDetectTransparency){let e=!1;this.scene.traverse(i=>{i.material&&i.material.transparent&&(e=!0)}),e&&(this.configuration.transparencyAware=!0)}}configureTransparencyTarget(){this.configuration.transparencyAware?(this.transparencyRenderTargetDWFalse=new fi(this.width,this.height,{minFilter:Wt,magFilter:si,type:Ki,format:_i}),this.transparencyRenderTargetDWTrue=new fi(this.width,this.height,{minFilter:Wt,magFilter:si,type:Ki,format:_i}),this.transparencyRenderTargetDWTrue.depthTexture=new Eu(this.width,this.height,Gr),this.depthCopyPass=new mA(new jt({uniforms:{depthTexture:{value:this.depthTexture}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }`,fragmentShader:`
            uniform sampler2D depthTexture;
            varying vec2 vUv;
            void main() {
               gl_FragDepth = texture2D(depthTexture, vUv).r + 0.00001;
               gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
            }
            `}))):(this.transparencyRenderTargetDWFalse&&(this.transparencyRenderTargetDWFalse.dispose(),this.transparencyRenderTargetDWFalse=null),this.transparencyRenderTargetDWTrue&&(this.transparencyRenderTargetDWTrue.dispose(),this.transparencyRenderTargetDWTrue=null),this.depthCopyPass&&(this.depthCopyPass.dispose(),this.depthCopyPass=null))}renderTransparency(e){const i=this.scene.background,s=e.getClearColor(new fe),r=e.getClearAlpha(),o=new Map,a=e.autoClearDepth;this.scene.traverse(l=>{o.set(l,l.visible)}),this.scene.background=null,e.autoClearDepth=!1,e.setClearColor(new fe(0,0,0),0),this.depthCopyPass.material.uniforms.depthTexture.value=this.depthTexture,e.setRenderTarget(this.transparencyRenderTargetDWFalse),this.scene.traverse(l=>{l.material&&(l.visible=o.get(l)&&(l.material.transparent&&!l.material.depthWrite&&!l.userData.treatAsOpaque||!!l.userData.cannotReceiveAO))}),e.clear(!0,!0,!0),this.depthCopyPass.render(e),e.render(this.scene,this.camera),e.setRenderTarget(this.transparencyRenderTargetDWTrue),this.scene.traverse(l=>{l.material&&(l.visible=o.get(l)&&l.material.transparent&&l.material.depthWrite&&!l.userData.treatAsOpaque)}),e.clear(!0,!0,!0),this.depthCopyPass.render(e),e.render(this.scene,this.camera),this.scene.traverse(l=>{l.visible=o.get(l)}),e.setClearColor(s,r),this.scene.background=i,e.autoClearDepth=a}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera)}configureAOPass(e=!1,i=!1){this.firstFrame(),this.samples=this.generateHemisphereSamples(this.configuration.aoSamples);const s={...eUe};s.fragmentShader=s.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),e&&(s.fragmentShader=`#define LOGDEPTH
`+s.fragmentShader),i&&(s.fragmentShader=`#define ORTHO
`+s.fragmentShader),this.configuration.halfRes&&(s.fragmentShader=`#define HALFRES
`+s.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new jt(s)):this.effectShaderQuad=new mA(new jt(s))}configureDenoisePass(e=!1,i=!1){this.firstFrame(),this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);const s={...iUe};s.fragmentShader=s.fragmentShader.replace("16",this.configuration.denoiseSamples),e&&(s.fragmentShader=`#define LOGDEPTH
`+s.fragmentShader),i&&(s.fragmentShader=`#define ORTHO
`+s.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new jt(s)):this.poissonBlurQuad=new mA(new jt(s))}configureEffectCompositer(e=!1,i=!1){this.firstFrame();const s={...tUe};e&&(s.fragmentShader=`#define LOGDEPTH
`+s.fragmentShader),i&&(s.fragmentShader=`#define ORTHO
`+s.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(s.fragmentShader=`#define HALFRES
`+s.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new jt(s)):this.effectCompositerQuad=new mA(new jt(s))}generateHemisphereSamples(e){const i=[];for(let s=0;s<e;s++){const r=2.399963*s,o=Math.sqrt(s+.5)/Math.sqrt(e),a=o*Math.cos(r),l=o*Math.sin(r),c=Math.sqrt(1-(a*a+l*l));i.push(new E(a,l,c))}return i}generateDenoiseSamples(e,i){const s=2*Math.PI*i/e,r=1/e,o=r,a=[];let l=r,c=0;for(let h=0;h<e;h++)a.push(new Q(Math.cos(c),Math.sin(c)).multiplyScalar(Math.pow(l,.75))),l+=o,c+=s;return a}setSize(e,i){this.firstFrame(),this.width=e,this.height=i;const s=this.configuration.halfRes?.5:1;this.writeTargetInternal.setSize(e*s,i*s),this.readTargetInternal.setSize(e*s,i*s),this.accumulationRenderTarget.setSize(e*s,i*s),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(e*s,i*s),this.configuration.transparencyAware&&(this.transparencyRenderTargetDWFalse.setSize(e,i),this.transparencyRenderTargetDWTrue.setSize(e,i)),this.outputTargetInternal.setSize(e,i)}setDepthTexture(e){this.depthTexture=e}firstFrame(){this.needsFrame=!0}render(e,i,s){const r=e.xr.enabled;e.xr.enabled=!1,e.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=e.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera)),this.detectTransparency(),(i.texture.type!==this.outputTargetInternal.texture.type||i.texture.format!==this.outputTargetInternal.texture.format)&&(this.outputTargetInternal.texture.type=i.texture.type,this.outputTargetInternal.texture.format=i.texture.format,this.outputTargetInternal.texture.needsUpdate=!0),this.camera.updateMatrixWorld(),this.lastViewMatrix.equals(this.camera.matrixWorldInverse)&&this.lastProjectionMatrix.equals(this.camera.projectionMatrix)&&this.configuration.accumulate&&!this.needsFrame?this.frame++:(this.configuration.accumulate&&(e.setRenderTarget(this.accumulationRenderTarget),e.clear(!0,!0,!0)),this.frame=0,this.needsFrame=!1),this.lastViewMatrix.copy(this.camera.matrixWorldInverse),this.lastProjectionMatrix.copy(this.camera.projectionMatrix);let o,a,l;this.debugMode&&(o=e.getContext(),a=o.getExtension("EXT_disjoint_timer_query_webgl2"),a===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),this.debugMode&&(l=o.createQuery(),o.beginQuery(a.TIME_ELAPSED_EXT,l)),this.configuration.transparencyAware&&this.renderTransparency(e),this._r.set(this.width,this.height);let c=this.configuration.aoRadius;if(this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(c*=.5),this.frame<1024/this.configuration.aoSamples){this.configuration.halfRes&&(e.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.depthDownsampleQuad.render(e)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=i.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new E),this.effectShaderQuad.material.uniforms.biasAdjustment.value=new Q(this.configuration.biasOffset,this.configuration.biasMultiplier),this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=c,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectShaderQuad.material.uniforms.frame.value=this.frame,e.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(e);for(let d=0;d<this.configuration.denoiseIterations;d++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new E),this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=c,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=d,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(e);e.setRenderTarget(this.accumulationRenderTarget);const h=e.autoClear;e.autoClear=!1,this.accumulationQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.accumulationQuad.material.uniforms.frame.value=this.frame,this.accumulationQuad.render(e),e.autoClear=h}this.configuration.transparencyAware&&(this.effectCompositerQuad.material.uniforms.transparencyDWFalse.value=this.transparencyRenderTargetDWFalse.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrue.value=this.transparencyRenderTargetDWTrue.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrueDepth.value=this.transparencyRenderTargetDWTrue.depthTexture,this.effectCompositerQuad.material.uniforms.transparencyAware.value=!0),this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=i.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.effectCompositerQuad.material.uniforms.aoTones.value=this.configuration.aoTones,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=c,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.autosetGamma?this.renderToScreen:this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.accumulationRenderTarget.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),this.effectCompositerQuad.material.uniforms.colorMultiply.value=this.configuration.colorMultiply,this.effectCompositerQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new E),this.effectCompositerQuad.material.uniforms.fog.value=!!this.scene.fog,this.scene.fog&&(this.scene.fog.isFog?(this.effectCompositerQuad.material.uniforms.fogExp.value=!1,this.effectCompositerQuad.material.uniforms.fogNear.value=this.scene.fog.near,this.effectCompositerQuad.material.uniforms.fogFar.value=this.scene.fog.far):this.scene.fog.isFogExp2?(this.effectCompositerQuad.material.uniforms.fogExp.value=!0,this.effectCompositerQuad.material.uniforms.fogDensity.value=this.scene.fog.density):console.error(`Unsupported fog type ${this.scene.fog.constructor.name} in SSAOPass.`)),e.setRenderTarget(this.outputTargetInternal),this.effectCompositerQuad.render(e),e.setRenderTarget(this.renderToScreen?null:s),this.copyQuad.material.uniforms.tDiffuse.value=this.outputTargetInternal.texture,this.copyQuad.render(e),this.debugMode&&(o.endQuery(a.TIME_ELAPSED_EXT),noe(l,o,this)),e.xr.enabled=r}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(e){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(e)}setQualityMode(e){e==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):e==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):e==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}}Uint8Array.from(atob(ioe),n=>n.charCodeAt(0));var aUe=Object.defineProperty,lUe=Object.getOwnPropertyDescriptor,roe=(n,e,i,s)=>{for(var r=s>1?void 0:s?lUe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&aUe(e,i,r),r};class l_ extends qr{constructor(){super(...arguments),m(this,"_effect")}get typeName(){return"Sharpening"}onCreateEffect(){return this.effect}get effect(){return this._effect??(this._effect=new ooe),this._effect}set amount(e){this.effect.uniforms.get("amount").value=e}get amount(){return this.effect.uniforms.get("amount").value}set radius(e){this.effect.uniforms.get("radius").value=e}get radius(){return this.effect.uniforms.get("radius").value}}roe([T()],l_.prototype,"amount",1),roe([T()],l_.prototype,"radius",1);const cUe=`
  void mainSupport() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,hUe=`
uniform sampler2D tDiffuse;
uniform float amount;
uniform float radius;

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
    float tx = 1.0 / resolution.x;
    float ty = 1.0 / resolution.y;
    vec2 texelSize = vec2(tx, ty);

    vec4 blurred = vec4(0.0);
    float total = 0.0;

    for (float x = -radius; x <= radius; x++) {
        for (float y = -radius; y <= radius; y++) {
            vec2 offset = vec2(x, y) * texelSize;
            vec4 diffuse = texture2D(tDiffuse, uv + offset);
            float weight = exp(-length(offset) * amount);
            blurred += diffuse * weight;
            total += weight;
        }
    }

    if (total > 0.0) {
        blurred /= total;
    }

    // Calculate the sharpened color using inputColor
    vec4 sharp = inputColor + clamp(inputColor - blurred, 0.0, 1.0) * amount;
    // Keep original alpha
    sharp.a = inputColor.a;

    // Ensure the sharp color does not go below 0 or above 1
    // This means: sharpening must happen AFTER tonemapping.
    sharp = clamp(sharp, 0.0, 1.0);

    outputColor = sharp;
}

`;class ooe extends Ia{constructor(){super("Sharpening",hUe,{vertexShader:cUe,blendFunction:bi.NORMAL,uniforms:new Map([["amount",new Te(1)],["radius",new Te(1)]])})}}const gA=q("debugpost"),hO=Symbol("needle:postprocessing-handler"),dO=Symbol("needle:previous-autoclear-state");class zB{constructor(e){m(this,"_composer",null),m(this,"_lastVolumeComponents"),m(this,"_effects",[]),m(this,"_isActive",!1),m(this,"context"),this.context=e}get isActive(){return this._isActive}get composer(){return this._composer}apply(e){this._isActive=!0,this.onApply(this.context,e)}unapply(){var e;if(gA&&console.log("Unapplying postprocessing effects"),this._isActive=!1,this._lastVolumeComponents){for(const s of this._lastVolumeComponents)s.unapply();this._lastVolumeComponents.length=0}const i=this.context;i[hO]===this&&delete i[hO],i.composer===this._composer&&((e=i.composer)==null||e.dispose(),i.composer=null),typeof i.renderer[dO]=="boolean"&&(i.renderer.autoClear=i.renderer[dO])}dispose(){this.unapply();for(const e of this._effects)e.dispose();this._effects.length=0,this._composer=null}onApply(e,i){if(!i)return;e[hO]=this,gA&&console.log("Apply Postprocessing Effects",i),this._lastVolumeComponents=[...i],this._effects.length=0;const s={handler:this,components:this._lastVolumeComponents};for(let r=0;r<this._lastVolumeComponents.length;r++){const o=this._lastVolumeComponents[r];if(o.context=e,o.apply){if(o.active){if(!e.mainCameraComponent){console.error("No camera in scene found or available yet - can not create postprocessing effects");return}const a=o.apply(s);if(!a)continue;Array.isArray(a)?this._effects.push(...a):this._effects.push(a)}}else o.active&&An("Volume component is not a VolumeComponent: "+o.__type)}if(this.context.renderer.toneMapping!=kr&&!this._effects.find(r=>r instanceof iR)){const r=new iR;this._effects.push(r)}this.applyEffects(e)}applyEffects(e){const i=this._effects;if(i.length<=0)return;const s=e.mainCameraComponent,r=e.renderer,o=e.scene,a=s.threeCamera;r[dO]=r.autoClear;const l=r.capabilities.maxSamples;this._composer||(this._composer=new vD(r,{frameBufferType:Ki,stencilBuffer:!0,multisampling:Math.min(Ft.isMobileDevice()?4:8,l)})),e.composer&&e.composer!==this._composer&&console.warn("There's already an active EffectComposer in your scene: replacing it with a new one. This might cause unexpected behaviour. Make sure to only use one PostprocessingManager/Volume in your scene."),e.composer=this._composer;const c=e.composer;c.setMainCamera(a),c.setRenderer(r),c.setMainScene(o);for(const d of c.passes)d.dispose();c.removeAllPasses();const h=new tR(o,a);h.name="Render To Screen",h.mainScene=o,c.addPass(h);try{this.orderEffects();const d=[];for(const u of i)if(u instanceof Ia)d.push(u);else if(u instanceof Fr){const p=new m7(a,...d);p.mainScene=o,p.name=d.map(g=>g.constructor.name).join(", "),p.enabled=!0,d.length=0,c.addPass(u)}if(d.length>0){const u=new m7(a,...d);u.name=d.map(p=>p.name).join(" "),u.mainScene=o,u.enabled=!0,c.addPass(u)}}catch(d){console.error("Error while applying postprocessing effects",d),c.removeAllPasses()}gA&&console.log("PostProcessing Passes",i,"->",c.passes)}orderEffects(){var e;gA&&console.log("Before ordering effects",[...this._effects]);const i=this._effects;i.sort((s,r)=>{const o=uO.findIndex(l=>s.constructor.name.endsWith(l.name)),a=uO.findIndex(l=>r.constructor.name.endsWith(l.name));return o<0?(gA&&console.warn("Unknown effect found: ",s.constructor.name),-1):a<0?(gA&&console.warn("Unknown effect found: ",r.constructor.name),1):o<0?1:a<0?-1:o-a}),gA&&console.log("After ordering effects",[...this._effects]);for(let s=0;s<i.length;s++){const r=i[s];if(((e=r?.configuration)==null?void 0:e.gammaCorrection)!==void 0){const o=s===i.length-1;r.configuration.gammaCorrection=o}}}}const uO=[g7,MD,l7,h7,soe,d7,i7,$8,SD,r7,u7,s7,iR,n7,q8,ooe];class dUe{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const i=this.workerCreator();i.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=i}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,i){const s=this.workersResolve[e];if(s&&s(i),this.queue.length){const{resolve:r,msg:o,transfer:a}=this.queue.shift();this.workersResolve[e]=r,this.workers[e].postMessage(o,a)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,i){return new Promise(s=>{const r=this._getIdleWorker();r!==-1?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=s,this.workers[r].postMessage(e,i)):this.queue.push({resolve:s,msg:e,transfer:i})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const uUe=0,aoe=2,pUe=1,loe=2,mUe=0,gUe=1,fUe=10,AUe=0,coe=9,hoe=15,doe=16,uoe=22,poe=37,moe=43,goe=76,foe=83,Aoe=97,yoe=100,boe=103,voe=109,xoe=165,woe=166,Coe=1000066e3;class yUe{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class c_{constructor(e,i,s,r){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+i,s),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const i=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,i}_skip(e){return this._offset+=e,this}_scan(e,i){i===void 0&&(i=0);const s=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==i&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,r)}}const Ua=[171,75,84,88,32,50,48,187,13,10,26,10];function Soe(n){return new TextDecoder().decode(n)}function bUe(n){const e=new Uint8Array(n.buffer,n.byteOffset,Ua.length);if(e[0]!==Ua[0]||e[1]!==Ua[1]||e[2]!==Ua[2]||e[3]!==Ua[3]||e[4]!==Ua[4]||e[5]!==Ua[5]||e[6]!==Ua[6]||e[7]!==Ua[7]||e[8]!==Ua[8]||e[9]!==Ua[9]||e[10]!==Ua[10]||e[11]!==Ua[11])throw new Error("Missing KTX 2.0 identifier.");const i=new yUe,s=17*Uint32Array.BYTES_PER_ELEMENT,r=new c_(n,Ua.length,s,!0);i.vkFormat=r._nextUint32(),i.typeSize=r._nextUint32(),i.pixelWidth=r._nextUint32(),i.pixelHeight=r._nextUint32(),i.pixelDepth=r._nextUint32(),i.layerCount=r._nextUint32(),i.faceCount=r._nextUint32();const o=r._nextUint32();i.supercompressionScheme=r._nextUint32();const a=r._nextUint32(),l=r._nextUint32(),c=r._nextUint32(),h=r._nextUint32(),d=r._nextUint64(),u=r._nextUint64(),p=new c_(n,Ua.length+s,3*o*8,!0);for(let H=0;H<o;H++)i.levels.push({levelData:new Uint8Array(n.buffer,n.byteOffset+p._nextUint64(),p._nextUint64()),uncompressedByteLength:p._nextUint64()});const g=new c_(n,a,l,!0),f={vendorId:g._skip(4)._nextUint16(),descriptorType:g._nextUint16(),versionNumber:g._nextUint16(),descriptorBlockSize:g._nextUint16(),colorModel:g._nextUint8(),colorPrimaries:g._nextUint8(),transferFunction:g._nextUint8(),flags:g._nextUint8(),texelBlockDimension:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],bytesPlane:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],samples:[]},A=(f.descriptorBlockSize/4-6)/4;for(let H=0;H<A;H++){const Z={bitOffset:g._nextUint16(),bitLength:g._nextUint8(),channelType:g._nextUint8(),samplePosition:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Z.channelType?(Z.sampleLower=g._nextInt32(),Z.sampleUpper=g._nextInt32()):(Z.sampleLower=g._nextUint32(),Z.sampleUpper=g._nextUint32()),f.samples[H]=Z}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(f);const y=new c_(n,c,h,!0);for(;y._offset<h;){const H=y._nextUint32(),Z=y._scan(H),he=Soe(Z);if(i.keyValue[he]=y._nextUint8Array(H-Z.byteLength-1),he.match(/^ktx/i)){const be=Soe(i.keyValue[he]);i.keyValue[he]=be.substring(0,be.lastIndexOf("\0"))}y._skip(H%4?4-H%4:0)}if(u<=0)return i;const b=new c_(n,d,u,!0),v=b._nextUint16(),x=b._nextUint16(),w=b._nextUint32(),C=b._nextUint32(),S=b._nextUint32(),_=b._nextUint32(),I=[];for(let H=0;H<o;H++)I.push({imageFlags:b._nextUint32(),rgbSliceByteOffset:b._nextUint32(),rgbSliceByteLength:b._nextUint32(),alphaSliceByteOffset:b._nextUint32(),alphaSliceByteLength:b._nextUint32()});const B=d+b._offset,M=B+w,R=M+C,k=R+S,G=new Uint8Array(n.buffer,n.byteOffset+B,w),X=new Uint8Array(n.buffer,n.byteOffset+M,C),F=new Uint8Array(n.buffer,n.byteOffset+R,S),z=new Uint8Array(n.buffer,n.byteOffset+k,_);return i.globalData={endpointCount:v,selectorCount:x,imageDescs:I,endpointsData:G,selectorsData:X,tablesData:F,extendedData:z},i}let pO,Rp,mO;const gO={env:{emscripten_notify_memory_growth:function(n){mO=new Uint8Array(Rp.exports.memory.buffer)}}};class vUe{init(){return pO||(pO=typeof fetch<"u"?fetch("data:application/wasm;base64,"+_oe).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,gO)).then(this._init):WebAssembly.instantiate(Buffer.from(_oe,"base64"),gO).then(this._init),pO)}_init(e){Rp=e.instance,gO.env.emscripten_notify_memory_growth(0)}decode(e,i=0){if(!Rp)throw new Error("ZSTDDecoder: Await .init() before decoding.");const s=e.byteLength,r=Rp.exports.malloc(s);mO.set(e,r),i=i||Number(Rp.exports.ZSTD_findDecompressedSize(r,s));const o=Rp.exports.malloc(i),a=Rp.exports.ZSTD_decompress(o,i,r,s),l=mO.slice(o,o+a);return Rp.exports.free(r),Rp.exports.free(o),l}}const _oe="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",fO=new WeakMap;let AO=0,yO;class fu extends fs{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new dUe,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new Rs(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const i=e.loadAsync("basis_transcoder.js"),s=new Rs(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const r=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,r]).then(([o,a])=>{const l=fu.BasisWorker.toString(),c=["/* constants */","let _EngineFormat = "+JSON.stringify(fu.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(fu.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(fu.BasisFormat),"/* basis_transcoder.js */",o,"/* worker */",l.substring(l.indexOf("{")+1,l.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([c])),this.transcoderBinary=a,this.workerPool.setWorkerCreator(()=>{const h=new Worker(this.workerSourceURL),d=this.transcoderBinary.slice(0);return h.postMessage({type:"init",config:this.workerConfig,transcoderBinary:d},[d]),h})}),AO>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),AO++}return this.transcoderPending}load(e,i,s,r){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const o=new Rs(this.manager);o.setResponseType("arraybuffer"),o.setWithCredentials(this.withCredentials),o.load(e,a=>{this.parse(a,i,r)},s,r)}parse(e,i,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(fO.has(e))return fO.get(e).promise.then(i).catch(s);this._createTexture(e).then(r=>i?i(r):null).catch(s)}_createTextureFrom(e,i){const{faces:s,width:r,height:o,format:a,type:l,error:c,dfdFlags:h}=e;if(l==="error")return Promise.reject(c);let d;if(i.faceCount===6)d=new bP(s,a,Xi);else{const u=s[0].mipmaps;d=i.layerCount>1?new iH(u,r,o,i.layerCount,a,Xi):new od(u,r,o,a,Xi)}return d.minFilter=s[0].mipmaps.length===1?Wt:Ar,d.magFilter=Wt,d.generateMipmaps=!1,d.needsUpdate=!0,d.colorSpace=Moe(i),d.premultiplyAlpha=!!(h&pUe),d}async _createTexture(e,i={}){const s=bUe(new Uint8Array(e));if(s.vkFormat!==AUe)return wUe(s);const r=i,o=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:r},[e])).then(a=>this._createTextureFrom(a.data,s));return fO.set(e,{promise:o}),o}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),AO--,this}}fu.BasisFormat={ETC1S:0,UASTC_4x4:1},fu.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},fu.EngineFormat={RGBAFormat:_i,RGBA_ASTC_4x4_Format:qA,RGBA_BPTC_Format:ey,RGBA_ETC2_EAC_Format:Dx,RGBA_PVRTC_4BPPV1_Format:Nx,RGBA_S3TC_DXT5_Format:JA,RGB_ETC1_Format:Vx,RGB_ETC2_Format:Xx,RGB_PVRTC_4BPPV1_Format:Px,RGBA_S3TC_DXT1_Format:jA},fu.BasisWorker=function(){let n,e,i;const s=_EngineFormat,r=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",function(f){const A=f.data;switch(A.type){case"init":n=A.config,a(A.transcoderBinary);break;case"transcode":e.then(()=>{try{const{faces:y,buffers:b,width:v,height:x,hasAlpha:w,format:C,dfdFlags:S}=l(A.buffer);self.postMessage({type:"transcode",id:A.id,faces:y,width:v,height:x,hasAlpha:w,format:C,dfdFlags:S},b)}catch(y){console.error(y),self.postMessage({type:"error",id:A.id,error:y.message})}});break}});function a(f){e=new Promise(A=>{i={wasmBinary:f,onRuntimeInitialized:A},BASIS(i)}).then(()=>{i.initializeBasis(),i.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function l(f){const A=new i.KTX2File(new Uint8Array(f));function y(){A.close(),A.delete()}if(!A.isValid())throw y(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const b=A.isUASTC()?o.UASTC_4x4:o.ETC1S,v=A.getWidth(),x=A.getHeight(),w=A.getLayers()||1,C=A.getLevels(),S=A.getFaces(),_=A.getHasAlpha(),I=A.getDFDFlags(),{transcoderFormat:B,engineFormat:M}=u(b,v,x,_);if(!v||!x||!C)throw y(),new Error("THREE.KTX2Loader:	Invalid texture");if(!A.startTranscoding())throw y(),new Error("THREE.KTX2Loader: .startTranscoding failed");const R=[],k=[];for(let G=0;G<S;G++){const X=[];for(let F=0;F<C;F++){const z=[];let H,Z;for(let be=0;be<w;be++){const _e=A.getImageLevelInfo(F,be,G);G===0&&F===0&&be===0&&(_e.origWidth%4!==0||_e.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),C>1?(H=_e.origWidth,Z=_e.origHeight):(H=_e.width,Z=_e.height);const Ye=new Uint8Array(A.getImageTranscodedSizeInBytes(F,be,0,B));if(!A.transcodeImage(Ye,F,be,G,B,0,-1,-1))throw y(),new Error("THREE.KTX2Loader: .transcodeImage failed.");z.push(Ye)}const he=g(z);X.push({data:he,width:H,height:Z}),k.push(he.buffer)}R.push({mipmaps:X,width:v,height:x,format:M})}return y(),{faces:R,buffers:k,width:v,height:x,hasAlpha:_,format:M,dfdFlags:I}}const c=[{if:"astcSupported",basisFormat:[o.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[s.RGBA_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[s.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],h=c.sort(function(f,A){return f.priorityETC1S-A.priorityETC1S}),d=c.sort(function(f,A){return f.priorityUASTC-A.priorityUASTC});function u(f,A,y,b){let v,x;const w=f===o.ETC1S?h:d;for(let C=0;C<w.length;C++){const S=w[C];if(n[S.if]&&S.basisFormat.includes(f)&&!(b&&S.transcoderFormat.length<2)&&!(S.needsPowerOfTwo&&!(p(A)&&p(y))))return v=S.transcoderFormat[b?1:0],x=S.engineFormat[b?1:0],{transcoderFormat:v,engineFormat:x}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),v=r.RGBA32,x=s.RGBAFormat,{transcoderFormat:v,engineFormat:x}}function p(f){return f<=2?!0:(f&f-1)===0&&f!==0}function g(f){if(f.length===1)return f[0];let A=0;for(let v=0;v<f.length;v++){const x=f[v];A+=x.byteLength}const y=new Uint8Array(A);let b=0;for(let v=0;v<f.length;v++){const x=f[v];y.set(x,b),b+=x.byteLength}return y}};const xUe=new Set([_i,fc,vl]),bO={[voe]:_i,[Aoe]:_i,[poe]:_i,[moe]:_i,[boe]:fc,[foe]:fc,[doe]:fc,[uoe]:fc,[yoe]:vl,[goe]:vl,[hoe]:vl,[coe]:vl,[Coe]:qA,[woe]:$A,[xoe]:$A},vO={[voe]:en,[Aoe]:Ki,[poe]:Xi,[moe]:Xi,[boe]:en,[foe]:Ki,[doe]:Xi,[uoe]:Xi,[yoe]:en,[goe]:Ki,[hoe]:Xi,[coe]:Xi,[Coe]:Ki,[woe]:Xi,[xoe]:Xi};async function wUe(n){const{vkFormat:e}=n;if(bO[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let i;n.supercompressionScheme===aoe&&(yO||(yO=new Promise(async o=>{const a=new vUe;await a.init(),o(a)})),i=await yO);const s=[];for(let o=0;o<n.levels.length;o++){const a=Math.max(1,n.pixelWidth>>o),l=Math.max(1,n.pixelHeight>>o),c=n.pixelDepth?Math.max(1,n.pixelDepth>>o):0,h=n.levels[o];let d;if(n.supercompressionScheme===uUe)d=h.levelData;else if(n.supercompressionScheme===aoe)d=i.decode(h.levelData,h.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let u;vO[e]===en?u=new Float32Array(d.buffer,d.byteOffset,d.byteLength/Float32Array.BYTES_PER_ELEMENT):vO[e]===Ki?u=new Uint16Array(d.buffer,d.byteOffset,d.byteLength/Uint16Array.BYTES_PER_ELEMENT):u=d,s.push({data:u,width:a,height:l,depth:c})}let r;if(xUe.has(bO[e]))r=n.pixelDepth===0?new nr(s[0].data,n.pixelWidth,n.pixelHeight):new gI(s[0].data,n.pixelWidth,n.pixelHeight,n.pixelDepth);else{if(n.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new od(s,n.pixelWidth,n.pixelHeight)}return r.mipmaps=s,r.type=vO[e],r.format=bO[e],r.colorSpace=Moe(n),r.needsUpdate=!0,Promise.resolve(r)}function Moe(n){const e=n.dataFormatDescriptor[0];return e.colorPrimaries===gUe?e.transferFunction===loe?ut:qi:e.colorPrimaries===fUe?e.transferFunction===loe?Ux:ty:(e.colorPrimaries===mUe||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),ho)}async function xO(n){const{NeedleEngineHTMLElement:e}=await Promise.resolve().then(()=>cOe);e.observedAttributes.includes(n)||e.observedAttributes.push(n)}var CUe=Object.defineProperty,SUe=Object.getOwnPropertyDescriptor,h_=(n,e,i,s)=>{for(var r=s>1?void 0:s?SUe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&CUe(e,i,r),r};const Kc=q("debugskybox");xO("skybox-image"),xO("environment-image");function Ioe(n,e,i,s,r){const o=new cu;o.allowDrop=!1,o.allowNetworking=!1,o.background=i,o.environment=s,$.addComponent(n.scene,o);const a=l=>{typeof l=="string"&&(Kc&&console.log(r,"CHANGED TO",l),o.setSkybox(l))};return m6(n.domElement,r,a),o.addEventListener("destroy",()=>{Kc&&console.log("Destroyed attribute remote skybox",r),g6(n.domElement,r,a)}),o.setSkybox(e)}ji.addContextCreatedCallback(n=>{var e;const i=n.context,s=i.domElement.getAttribute("skybox-image")||i.domElement.getAttribute("background-image"),r=i.domElement.getAttribute("environment-image"),o=new Array;if(s){Kc&&console.log("Creating remote skybox to load "+s),((e=i.mainCameraComponent)==null?void 0:e.clearFlags)!==ug.Skybox&&console.warn('"skybox-image"/"background-image" attribute has no effect: camera clearflags are not set to "Skybox"');const a=Ioe(i,s,!0,!1,"skybox-image");o.push(a)}if(r){Kc&&console.log("Creating remote environment to load "+r);const a=Ioe(i,r,!1,!0,"environment-image");o.push(a)}return o.length>0?kE(o):Promise.resolve()});function Toe(){return globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES||(globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES=new Array),globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES}function Eoe(n){const e=Toe().find(i=>i.src===n);return e?(Kc&&console.log("Skybox: Found previously loaded texture for "+n),e.texture):null}async function _Ue(n){const e=await n;Gz(e,!0),zn(e)}function MUe(n,e){const i=Toe();for(;i.length>5;){const s=i.shift();s&&_Ue(s.texture)}e.then(s=>Gz(s,!1)),i.push({src:n,texture:e})}class cu extends Oe{constructor(){super(...arguments),m(this,"url"),m(this,"allowDrop",!0),m(this,"background",!0),m(this,"environment",!0),m(this,"allowNetworking",!0),m(this,"_loader"),m(this,"_prevUrl"),m(this,"_prevLoadedEnvironment"),m(this,"_prevEnvironment",null),m(this,"_prevBackground",null),m(this,"validTextureTypes",[".ktx2",".hdr",".exr",".jpg",".jpeg",".png"]),m(this,"onDragOverEvent",e=>{if(this.allowDrop&&e.dataTransfer)for(const i of e.dataTransfer.types)(i==="text/uri-list"||i==="Files")&&e.preventDefault()}),m(this,"onDrop",e=>{var i,s,r,o;if(this.allowDrop&&e.dataTransfer){for(const a of e.dataTransfer.types)if(Kc&&console.log(a),a==="text/uri-list"){const l=e.dataTransfer.getData(a);Kc&&console.log(a,l);let c=(s=(i=new RegExp(/polyhaven.com\/asset_img\/.+?\/(?<name>.+)\.png/).exec(l))==null?void 0:i.groups)==null?void 0:s.name;if(c||(c=(o=(r=new RegExp(/polyhaven\.com\/a\/(?<name>.+)/).exec(l))==null?void 0:r.groups)==null?void 0:o.name),Kc&&console.log(c),c){const h="https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/"+c+"_1k.exr";console.log(`[Remote Skybox] Setting skybox from url: ${h}`),e.preventDefault(),this.setSkybox(h);break}else if(this.isValidTextureType(l)){console.log("[Remote Skybox] Setting skybox from url: "+l),e.preventDefault(),this.setSkybox(l);break}else{console.warn(`[RemoteSkybox] Unknown url ${l}. If you want to load a skybox from a url, make sure it is a valid image url. Url must end with${this.validTextureTypes.join(", ")}.`);const h=new CustomEvent("dropped-unknown-url",{detail:{sender:this,event:e,url:l,apply:d=>{e.preventDefault(),this.setSkybox(d)}}});this.dispatchEvent(h)}}else if(a=="Files"){const l=e.dataTransfer.files.item(0);if(Kc&&console.log(a,l),!l)continue;if(!this.isValidTextureType(l.name)){console.warn(`[RemoteSkybox]: File "${l.name}" is not supported. Supported files are ${this.validTextureTypes.join(", ")}`);return}if(Eoe(l.name)===null){const c=new Blob([l]),h=URL.createObjectURL(c);e.preventDefault(),this.setSkybox(h,l.name)}else e.preventDefault(),this.setSkybox(l.name);break}}})}onEnable(){this.setSkybox(this.url),this.registerDropEvents()}onDisable(){var e;this.context.scene.environment===this._prevLoadedEnvironment&&(this.context.scene.environment=this._prevEnvironment,In.backgroundShouldBeTransparent(this.context)||(this.context.scene.background=this._prevBackground),this._prevLoadedEnvironment=void 0),this.unregisterDropEvents(),(e=this.context.mainCameraComponent)==null||e.applyClearFlags()}urlChangedSyncField(){this.allowNetworking&&this.url&&this.isRemoteTexture(this.url)&&this.setSkybox(this.url)}async setSkybox(e,i){var s;if(!this.activeAndEnabled||(e=IUe(e,this.environment,this.background),!e))return!1;if(i??(i=e),this.isValidTextureType(i)||console.warn("Potentially invalid skybox url",i,"on",this.name),Kc&&console.log("Set remote skybox url: "+e),this._prevUrl===e&&this._prevLoadedEnvironment)return this.applySkybox(),!0;(s=this._prevLoadedEnvironment)==null||s.dispose(),this._prevLoadedEnvironment=void 0,this._prevUrl=e;const r=await this.loadTexture(e,i);if(!r||!this.enabled)return!1;this.url=e;const o=e.lastIndexOf("/");return r.name=e.substring(o>=0?o+1:0),this._loader instanceof hh&&(r.colorSpace=ut),this._prevLoadedEnvironment=r,this.applySkybox(),!0}async loadTexture(e,i){var s,r,o,a,l;if(!e)return Promise.resolve(null);i??(i=e);const c=Eoe(i);if(c){const g=await c;if(((r=(s=g.source)==null?void 0:s.data)==null?void 0:r.length)>0||(l=(a=(o=g.source)==null?void 0:o.data)==null?void 0:a.data)!=null&&l.length)return g}const h=i.endsWith(".exr"),d=i.endsWith(".hdr"),u=i.endsWith(".ktx2");if(h)this._loader instanceof DC||(this._loader=new DC);else if(d)this._loader instanceof U2||(this._loader=new U2);else if(u){if(!(this._loader instanceof fu)){const{ktx2Loader:g}=XR(this.context.renderer);this._loader=g}}else this._loader instanceof hh||(this._loader=new hh);Kc&&console.log("Loading skybox: "+e);const p=this._loader.loadAsync(e);return MUe(i,p),await p}applySkybox(){var e;const i=this._prevLoadedEnvironment;i&&(i instanceof xf||i instanceof bP||(i.mapping=Yp,i.needsUpdate=!0),this.context.scene.background!==i&&(this._prevBackground=this.context.scene.background),this.context.scene.environment!==i&&(this._prevEnvironment=this.context.scene.environment),Kc&&console.log("Set remote skybox",this.url,!In.backgroundShouldBeTransparent(this.context)),this.environment&&(this.context.scene.environment=i),this.background&&!In.backgroundShouldBeTransparent(this.context)&&(this.context.scene.background=i),((e=this.context.mainCameraComponent)==null?void 0:e.backgroundBlurriness)!==void 0&&(this.context.scene.backgroundBlurriness=this.context.mainCameraComponent.backgroundBlurriness))}isRemoteTexture(e){return e.startsWith("http://")||e.startsWith("https://")}isValidTextureType(e){for(const i of this.validTextureTypes)if(e.endsWith(i))return!0;return!1}registerDropEvents(){this.unregisterDropEvents(),this.context.domElement.addEventListener("dragover",this.onDragOverEvent),this.context.domElement.addEventListener("drop",this.onDrop)}unregisterDropEvents(){this.context.domElement.removeEventListener("dragover",this.onDragOverEvent),this.context.domElement.removeEventListener("drop",this.onDrop)}}h_([CU(cu.prototype.urlChangedSyncField),T(URL)],cu.prototype,"url",2),h_([T()],cu.prototype,"allowDrop",2),h_([T()],cu.prototype,"background",2),h_([T()],cu.prototype,"environment",2),h_([T()],cu.prototype,"allowNetworking",2);function IUe(n,e,i){const s=e&&!i;switch(n?.toLowerCase()){case"studio":return s?"https://cdn.needle.tools/static/skybox/modelviewer-Neutral-small.hdr":"https://cdn.needle.tools/static/skybox/modelviewer-Neutral.hdr";case"blurred-skybox":return s?"https://cdn.needle.tools/static/skybox/blurred-skybox-small.exr":"https://cdn.needle.tools/static/skybox/blurred-skybox.exr";case"quicklook-ar":return s?"https://cdn.needle.tools/static/skybox/QuickLook-ARMode-small.exr":"https://cdn.needle.tools/static/skybox/QuickLook-ARMode.exr";case"quicklook":return s?"https://cdn.needle.tools/static/skybox/QuickLook-ObjectMode-small.exr":"https://cdn.needle.tools/static/skybox/QuickLook-ObjectMode.exr"}return n===void 0?null:n}var TUe=Object.defineProperty,EUe=Object.getOwnPropertyDescriptor,ha=(n,e,i,s)=>{for(var r=s>1?void 0:s?EUe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&TUe(e,i,r),r};const pl=q("debugsceneswitcher"),RUe=q("sceneswitcher:clearscene"),FB="scene";xO(FB);const zg=Promise.resolve(!1);class Rr extends Oe{constructor(){super(...arguments),m(this,"autoLoadFirstScene",!0),m(this,"scenes",[]),m(this,"loadingScene"),m(this,"queryParameterName","scene"),m(this,"useSceneName",!0),m(this,"clamp",!0),m(this,"useHistory",!0),m(this,"useKeyboard",!0),m(this,"useSwipe",!0),m(this,"useSceneLighting",!0),m(this,"useSceneBackground",!0),m(this,"preloadNext",1),m(this,"preloadPrevious",1),m(this,"preloadConcurrent",2),m(this,"createMenuButtons",!1),m(this,"sceneLoaded",new Gn),m(this,"_currentIndex",-1),m(this,"_currentScene"),m(this,"_engineElementOverserver"),m(this,"_preloadScheduler"),m(this,"_menuButtons"),m(this,"onPopState",async e=>{if(!this.useHistory)return;const i=this.useHistory;try{this.useHistory=!1;let s=!1;if(this.queryParameterName&&(s=await this.tryLoadFromQueryParam()),!s){const r=e?.state;if(r&&r.startsWith(this.guid)){const o=r.substr(this.guid.length+2);pl&&console.log("PopState",o),await this.trySelectSceneFromValue(o)}}}finally{this.useHistory=i}}),m(this,"normalizedSwipeThresholdX",.1),m(this,"_didSwipe",!1),m(this,"onInputPointerMove",e=>{if(this.useSwipe&&!this._didSwipe&&e.button===0&&e.pointerType==="touch"&&this.context.input.getPointerPressedCount()===1){const i=this.context.input.getPointerPositionDelta(e.button);if(i){const s=i.x/this.context.domWidth;s>=this.normalizedSwipeThresholdX?(this._didSwipe=!0,this.selectPrev()):s<=-this.normalizedSwipeThresholdX&&(this._didSwipe=!0,this.selectNext())}}}),m(this,"onInputPointerUp",e=>{e.button===0&&(this._didSwipe=!1)}),m(this,"onInputKeyDown",e=>{if(!this.useKeyboard||!this.scenes)return;const i=e.key.toLowerCase();if(!i)return;const s=parseInt(i)-1;if(s>=0){this.trySelectSceneFromValue(s);return}switch(i){case"arrowright":case"d":this.selectNext();break;case"arrowleft":case"a":this.selectPrev();break}}),m(this,"__lastSwitchScene"),m(this,"__lastSwitchScenePromise"),m(this,"_currentlyLoadingScene"),m(this,"_lastLoadingScene"),m(this,"_loadingScenePromise"),m(this,"_isCurrentlyLoading",!1),m(this,"_currentLoadingProgress")}get currentIndex(){return this._currentIndex}get currentLoadingProgress(){return this._currentLoadingProgress}get currentlyLoadingScene(){return this._currentlyLoadingScene}get currentlyLoadedScene(){return this._currentScene}awake(){this.scenes===void 0&&(this.scenes=[]);for(const e of this.scenes)e&&!e.hasUrl&&e.asset instanceof Ae&&e.asset.removeFromParent();pl&&console.log("SceneSwitcher",this)}async onEnable(){if(globalThis.addEventListener("popstate",this.onPopState),this.context.input.addEventListener(rs.KeyDown,this.onInputKeyDown),this.context.input.addEventListener(rs.PointerMove,this.onInputPointerMove),this.context.input.addEventListener(rs.PointerUp,this.onInputPointerUp),this._engineElementOverserver||(this._engineElementOverserver=new MutationObserver(e=>{for(const i of e)if(i.type==="attributes"&&i.attributeName===FB){const s=this.context.domElement.getAttribute(FB);s!==null&&this.trySelectSceneFromValue(s)}})),this._engineElementOverserver.observe(this.context.domElement,{attributes:!0}),this._preloadScheduler||(this._preloadScheduler=new LUe(this)),this._preloadScheduler.maxLoadAhead=this.preloadNext,this._preloadScheduler.maxLoadBehind=this.preloadPrevious,this._preloadScheduler.maxConcurrent=this.preloadConcurrent,this._preloadScheduler.begin(),this.autoLoadFirstScene&&this._currentIndex===-1&&!await this.tryLoadFromQueryParam()){const e=this.context.domElement.getAttribute(FB);try{(e===null||!await this.trySelectSceneFromValue(e))&&this._currentIndex===-1&&this.select(0)}finally{}}this.createMenuButtons&&(this._menuButtons??(this._menuButtons=[]),this._menuButtons.push(this.context.menu.appendChild({label:"Previous",icon:"arrow_back_ios",onClick:()=>this.selectPrev(),priority:-1005,class:"row2"})),this._menuButtons.push(this.context.menu.appendChild({label:"Next",icon:"arrow_forward_ios",iconSide:"right",onClick:()=>this.selectNext(),priority:-1e3,class:"row2"})))}onDisable(){var e;if(globalThis.removeEventListener("popstate",this.onPopState),this.context.input.removeEventListener(rs.KeyDown,this.onInputKeyDown),this.context.input.removeEventListener(rs.PointerMove,this.onInputPointerMove),this.context.input.removeEventListener(rs.PointerUp,this.onInputPointerUp),(e=this._preloadScheduler)==null||e.stop(),this._menuButtons){for(const i of this._menuButtons)i.remove();this._menuButtons=void 0}}addScene(e){if(typeof e=="string"){let i=this.context.addressables.findAssetReference(e);return i||(i=new Mi(e),this.context.addressables.registerAssetReference(i)),this.scenes.push(i),i}return this.scenes.push(e),e}selectNext(){return this.select(this._currentIndex+1)}selectPrev(){return this.select(this._currentIndex-1)}select(e){var i,s,r;if(pl&&console.log("select",e),typeof e=="object"&&console.warn('Switching to "'+e+'" might not work. Please either use an index or a AssetReference (not a scene reference)'),typeof e=="string"){const a=(i=this.scenes)==null?void 0:i.find(l=>l.url===e);if(!a){const l=Mi.getOrCreate(this.sourceId??"",e,this.context);return this.switchScene(l)}if(a)e=(s=this.scenes)==null?void 0:s.indexOf(a);else return zg}if(!((r=this.scenes)!=null&&r.length))return zg;if(e<0){if(this.clamp)return zg;e=this.scenes.length-1}else if(e>=this.scenes.length){if(this.clamp)return zg;e=0}const o=this.scenes[e];return this.switchScene(o)}unload(){return this.__lastSwitchScene=void 0,this.__lastSwitchScenePromise=void 0,this.__unloadCurrentScene()}async reload(){if(this.__lastSwitchScene){const e=this.__lastSwitchScene;return this.__lastSwitchScene=void 0,this.switchScene(e)}return!1}async switchScene(e){if(!(e instanceof Mi)){const i=typeof e;return i==="string"?this.select(e):i==="number"?this.select(e):(console.warn("SceneSwitcher: Can't switch to scene",e,"of type",i),!1)}return e.url===this.sourceId?(console.warn("SceneSwitcher: can't load own scene - prevent recursive loading",this.sourceId),!1):this.__lastSwitchScene===e&&this.__lastSwitchScenePromise?this.__lastSwitchScenePromise:(this.__lastSwitchScene=e,this.__lastSwitchScenePromise=this.__internalSwitchScene(e),await this.__lastSwitchScenePromise)}async __unloadCurrentScene(){const e=this._currentScene;if(this._currentScene=void 0,e){pl&&console.log("UNLOAD",e.url,"HasURL?: "+e.hasUrl);const i=this.tryGetSceneEventListener(e.asset);if(i!=null&&i.sceneClosing){const s=i.sceneClosing();s instanceof Promise&&await s}e.hasUrl?e.unload():e.asset instanceof Ae&&e.asset.removeFromParent()}}async __internalSwitchScene(e){var i,s,r,o;await this.__unloadCurrentScene();const a=this._currentIndex=((i=this.scenes)==null?void 0:i.indexOf(e))??-1;try{this._currentlyLoadingScene=e,this._currentLoadingProgress=new ProgressEvent("progress",{loaded:0,total:1});const l=new CustomEvent("loadscene-start",{detail:{scene:e,switcher:this,index:a}});this.dispatchEvent(l),await this.onStartLoading(),await e.loadAssetAsync((h,d)=>{this._currentLoadingProgress=d,this.dispatchEvent(d)}).catch(console.error),await this.onEndLoading();const c=new CustomEvent("loadscene-finished",{detail:{scene:e,switcher:this,index:a}});if(this.dispatchEvent(c),this._currentLoadingProgress=void 0,this._currentlyLoadingScene=void 0,c.defaultPrevented)return pl&&console.warn("Adding loaded scene prevented:",e,c),!1;if(!e.asset)return pl&&console.warn("Failed loading scene:",e),!1;if(this._currentIndex===a){if(pl&&console.log("ADD",e.url),this._currentScene=e,RUe){const u=((s=this.context.mainCameraComponent)==null?void 0:s.gameObject)||this.context.mainCamera;u?.removeFromParent();const p=this.gameObject.removeFromParent();Ol(this.context.scene,!0,!0),this.context.scene=new ir,this.context.scene.add(p),u&&this.context.scene.add(u)}if($.add(e.asset,this.gameObject),this.useSceneLighting&&this.context.sceneLighting.enable(e),this.useSceneBackground){const u=this.context.lightmaps.tryGetSkybox(e.url);u?(u.mapping=ao,this.context.scene.background=u):pl&&console.warn("SceneSwitcher: Can't find skybox for scene "+e.url)}if(this.useHistory&&a>=0){let u=a.toString();if(this.useSceneName&&(u=Roe(e.url)),(r=this.queryParameterName)!=null&&r.length)mw(this.queryParameterName,u,this.useHistory);else{const p=history.state,g=this.guid+"::"+a;p!==g&&history.pushState(g,"unused",location.href)}}const h=this.tryGetSceneEventListener(e.asset);if(h!=null&&h.sceneOpened){const u=h.sceneOpened(this);u instanceof Promise&&await u}const d=new CustomEvent("scene-opened",{detail:{scene:e,switcher:this,index:a}});return this.dispatchEvent(d),(o=this.sceneLoaded)==null||o.invoke(this),!0}}catch(l){console.error(l)}return!1}preload(e){if(e>=0&&e<this.scenes.length){const i=this.scenes[e];if(i instanceof Mi)return i.preload()}return zg}tryLoadFromQueryParam(){var e;if(!((e=this.queryParameterName)!=null&&e.length))return zg;const i=q(this.queryParameterName);return typeof i=="boolean"?zg:this.trySelectSceneFromValue(i)}trySelectSceneFromValue(e){if(typeof e=="string"){const i=parseInt(e);if(i>=0&&i<this.scenes.length)return this.select(i);{const s=e.toLowerCase();for(let r=0;r<this.scenes.length;r++){const o=this.scenes[r];if(o&&Roe(o.url).toLowerCase().includes(s))return this.select(r)}}}else if(typeof e=="number"&&e>=0&&e<this.scenes.length)return this.select(e);return Ma()&&console.warn('Can not find scene: "'+e+'"',this),zg}async onStartLoading(){var e,i;if(this._isCurrentlyLoading=!0,this.loadingScene&&(this._lastLoadingScene!==this.loadingScene&&(this._loadingScenePromise=void 0),this._lastLoadingScene=this.loadingScene,this._loadingScenePromise||(this._loadingScenePromise=(e=this.loadingScene)==null?void 0:e.loadAssetAsync()),await this._loadingScenePromise,this._isCurrentlyLoading&&(i=this.loadingScene)!=null&&i.asset)){pl&&console.log("Add loading scene",this.loadingScene.url,this.loadingScene.asset);const s=this.loadingScene.asset;$.add(s,this.gameObject);const r=this.tryGetSceneEventListener(s);if(r!=null&&r.sceneOpened){const o=r.sceneOpened(this);o instanceof Promise&&await o}}if(this._isCurrentlyLoading){const s=this.tryGetSceneEventListener(this.gameObject);if(s&&s.sceneOpened){const r=s.sceneOpened(this);r instanceof Promise&&await r}}}async onEndLoading(){var e;if(this._isCurrentlyLoading=!1,(e=this.loadingScene)!=null&&e.asset){pl&&console.log("Remove loading scene",this.loadingScene.url);const i=this.loadingScene.asset,s=this.tryGetSceneEventListener(i);if(typeof s?.sceneClosing=="function"){const r=s.sceneClosing();r instanceof Promise&&await r}$.remove(i)}if(!this._isCurrentlyLoading){const i=this.tryGetSceneEventListener(this.gameObject);if(i&&i.sceneClosing){const s=i.sceneClosing();s instanceof Promise&&await s}}}tryGetSceneEventListener(e,i=0){if(!e)return null;const s=$.foreachComponent(e,r=>{const o=r;if(o.sceneClosing||o.sceneOpened)return o});if(i===0&&!s&&e.children.length)for(const r of e.children){const o=this.tryGetSceneEventListener(r,i+1);if(o)return o}return s||null}}ha([T()],Rr.prototype,"autoLoadFirstScene",2),ha([T(Mi)],Rr.prototype,"scenes",2),ha([T(Mi)],Rr.prototype,"loadingScene",2),ha([T()],Rr.prototype,"queryParameterName",2),ha([T()],Rr.prototype,"useSceneName",2),ha([T()],Rr.prototype,"clamp",2),ha([T()],Rr.prototype,"useHistory",2),ha([T()],Rr.prototype,"useKeyboard",2),ha([T()],Rr.prototype,"useSwipe",2),ha([T()],Rr.prototype,"useSceneLighting",2),ha([T()],Rr.prototype,"useSceneBackground",2),ha([T()],Rr.prototype,"preloadNext",2),ha([T()],Rr.prototype,"preloadPrevious",2),ha([T()],Rr.prototype,"preloadConcurrent",2),ha([T()],Rr.prototype,"createMenuButtons",2),ha([T(Gn)],Rr.prototype,"sceneLoaded",2);function Roe(n){const e=n.split("/").pop(),i=e?.split(".").shift();return i!=null&&i.length?i:n}class LUe{constructor(e,i=1,s=1,r=2){m(this,"maxLoadAhead"),m(this,"maxLoadBehind"),m(this,"maxConcurrent"),m(this,"_isRunning",!1),m(this,"_switcher"),m(this,"_loadTasks",[]),m(this,"_maxConcurrentLoads",1),this._switcher=e,this.maxLoadAhead=i,this.maxLoadBehind=s,this.maxConcurrent=r}begin(){if(this._isRunning)return;pl&&console.log("Preload begin"),this._isRunning=!0;let e=-1,i,s;const r=this._switcher.scenes,o=setInterval(()=>{if(this.allLoaded()&&(pl&&console.log("All scenes loaded"),this.stop()),!this._isRunning){clearInterval(o);return}if(this.canLoadNewScene()===!1)return;e!==this._switcher.currentIndex&&(e=this._switcher.currentIndex,s=0,i=0);const a=s%2===0;a&&(i+=1),s+=1;const l=a?this.maxLoadAhead:this.maxLoadBehind;if(i>l)return;const c=a?e+i:e-i;if(c<0||c<0||c>=r.length)return;const h=r[c];new BUe(c,h,this._loadTasks)},200)}stop(){this._isRunning=!1}canLoadNewScene(){return this._loadTasks.length<this._maxConcurrentLoads}allLoaded(){if(this._switcher.scenes){for(const e of this._switcher.scenes)if(e?.isLoaded()===!1)return!1}return!0}}class BUe{constructor(e,i,s){m(this,"index"),m(this,"asset"),m(this,"tasks"),this.index=e,this.asset=i,this.tasks=s,s.push(this),this.awaitLoading()}async awaitLoading(){this.asset&&!this.asset.isLoaded()&&(pl&&console.log("Preload start: "+this.asset.url,this.index),await this.asset.preload(),pl&&console.log("Preload finished: "+this.asset.url,this.index));const e=this.tasks.indexOf(this);e>=0&&this.tasks.splice(e,1)}}function kUe(){return new Promise((n,e)=>{const i=()=>{i!=null&&(document.removeEventListener("pointerdown",i),document.removeEventListener("click",i),document.removeEventListener("dragstart",i),document.removeEventListener("touchstart",i),n())};document.addEventListener("pointerdown",i),document.addEventListener("click",i),document.addEventListener("dragstart",i),document.addEventListener("touchstart",i)})}async function GUe(n){await kUe(),n()}var PUe=Object.defineProperty,NUe=Object.getOwnPropertyDescriptor,oc=(n,e,i,s)=>{for(var r=s>1?void 0:s?NUe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&PUe(e,i,r),r};const io=q("debugvideo");var Loe=(n=>(n[n.None=0]="None",n[n.AdjustHeight=1]="AdjustHeight",n[n.AdjustWidth=2]="AdjustWidth",n))(Loe||{}),Boe=(n=>(n[n.VideoClip=0]="VideoClip",n[n.Url=1]="Url",n))(Boe||{}),koe=(n=>(n[n.CameraFarPlane=0]="CameraFarPlane",n[n.CameraNearPlane=1]="CameraNearPlane",n[n.RenderTexture=2]="RenderTexture",n[n.MaterialOverride=3]="MaterialOverride",n))(koe||{});class Lr extends Oe{constructor(){super(),m(this,"playOnAwake",!0),m(this,"aspectMode",0),m(this,"clip",null),m(this,"source",1),m(this,"_url",null),m(this,"renderMode"),m(this,"targetMaterialProperty"),m(this,"targetMaterialRenderer"),m(this,"targetTexture"),m(this,"time",0),m(this,"_playbackSpeed",1),m(this,"_isLooping",!1),m(this,"_muted",!1),m(this,"_audioOutputMode",2),m(this,"playInBackground",!0),m(this,"_crossOrigin","anonymous"),m(this,"_videoElement",null),m(this,"_videoTexture",null),m(this,"_videoMaterial",null),m(this,"_isPlaying",!1),m(this,"wasPlaying",!1),m(this,"visibilityChanged",e=>{switch(document.visibilityState){case"hidden":this.playInBackground||(this.wasPlaying=this._isPlaying,this.pause());break;case"visible":this.wasPlaying&&!this._isPlaying&&this.play();break}}),m(this,"_receivedInput",!1),m(this,"_overlay",null),m(this,"_targetObjects"),m(this,"_updateAspectRoutineId",-1),m(this,"_hls"),m(this,"onHlsAvailable",()=>{var e;io&&console.log("HLS: available",this.clip),!(!this.shouldUseM3U||!this.url)&&(this._hls||(this._hls=new Hls),this.videoElement.autoplay=!0,this._hls.loadSource(this.url),this._hls.attachMedia(this.videoElement),(e=this._videoElement)==null||e.play(),io&&console.log("HLS: loaded",this.clip))}),GUe(()=>{this._receivedInput=!0,this.updateVideoElementSettings()}),this._targetObjects=[],q("videoscreenspace")&&window.addEventListener("keydown",e=>{e.key==="f"&&(this.screenspace=!this.screenspace)})}get url(){return this._url}set url(e){const i=this._url!==e;this.__didAwake?i&&this.setClipURL(e??""):this._url=e}get playbackSpeed(){var e;return((e=this._videoElement)==null?void 0:e.playbackRate)??this._playbackSpeed}set playbackSpeed(e){this._playbackSpeed=e,this._videoElement&&(this._videoElement.playbackRate=e)}get isLooping(){var e;return((e=this._videoElement)==null?void 0:e.loop)??this._isLooping}set isLooping(e){this._isLooping=e,this._videoElement&&(this._videoElement.loop=e)}get currentTime(){var e;return((e=this._videoElement)==null?void 0:e.currentTime)??this.time}set currentTime(e){this._videoElement?this._videoElement.currentTime=e:this.time=e}get isPlaying(){const e=this._videoElement;return!!(e&&(e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>e.HAVE_CURRENT_DATA||e.srcObject&&e.srcObject.active))}get crossOrigin(){var e;return((e=this._videoElement)==null?void 0:e.crossOrigin)??this._crossOrigin}set crossOrigin(e){this._crossOrigin=e,this._videoElement&&(e!==null?this._videoElement.setAttribute("crossorigin",e):this._videoElement.removeAttribute("crossorigin"))}get videoMaterial(){return!this._videoMaterial&&!this.create(!1)?null:this._videoMaterial}get videoTexture(){return!this._videoTexture&&!this.create(!1)?null:this._videoTexture}get videoElement(){return!this._videoElement&&!this.create(!1)?null:this._videoElement}requestPictureInPicture(){return this._videoElement?this._videoElement.requestPictureInPicture():null}get muted(){var e;return((e=this._videoElement)==null?void 0:e.muted)??this._muted}set muted(e){this._muted=e,this._videoElement&&(this._videoElement.muted=e)}get currentVideo(){return this.clip}set audioOutputMode(e){e!==this._audioOutputMode&&(e===1&&Je()&&console.warn("VideoAudioOutputMode.AudioSource is not yet implemented"),this._audioOutputMode=e,this.updateVideoElementSettings())}get audioOutputMode(){return this._audioOutputMode}preloadVideo(){io&&console.log("Video Preload: "+this.name,this.clip),this.create(!1)}preload(){this.preloadVideo()}setVideo(e){this.clip=e,this.source=0,this._videoElement?(this._videoElement.srcObject=e,this._isPlaying&&this.play(),this.updateAspect()):this.create(this.playOnAwake)}setClipURL(e){this._url!==e&&(this._url=e,this.source=1,io&&console.log("set url",e),this._videoElement?e.endsWith(".m3u8")||e.includes(".m3u")?this.ensureM3UCanBePlayed():(this._videoElement.src=e,this._isPlaying&&(this.stop(),this.play())):this.create(this.playOnAwake))}onEnable(){var e,i;io&&console.log("VideoPlayer.onEnable",Boe[this.source],this.clip,this.url,this),window.addEventListener("visibilitychange",this.visibilityChanged),this.playOnAwake===!0?this.create(!0):this.preloadVideo(),this.screenspace?(e=this._overlay)==null||e.start():(i=this._overlay)==null||i.stop()}onDisable(){var e;window.removeEventListener("visibilitychange",this.visibilityChanged),(e=this._overlay)==null||e.stop(),this.pause()}onDestroy(){var e;this._videoElement&&((e=this.videoElement)==null||e.remove(),this._videoElement=null),this._videoTexture&&(this._videoTexture.dispose(),this._videoTexture=null)}play(){var e,i;if(this._videoElement||this.create(!1),!this._videoElement){io&&console.warn("Can not play: no video element found",this);return}if(!(this._isPlaying&&!((e=this._videoElement)!=null&&e.ended)&&!((i=this._videoElement)!=null&&i.paused))){if(this._isPlaying=!0,this._receivedInput||(this._videoElement.muted=!0),this.handleBeginPlaying(!1),this.shouldUseM3U){this.ensureM3UCanBePlayed();return}io&&console.log("Video Play()",this.clip,this._videoElement,this.time),this._videoElement.currentTime=this.time,this._videoElement.play().catch(s=>{var r;console.log(s),io&&console.error("Error playing video",s,"CODE="+s.code,(r=this.videoElement)==null?void 0:r.src,this),setTimeout(()=>{this._isPlaying&&!this.destroyed&&this.activeAndEnabled&&this.play()},1e3)}),io&&console.log("play",this._videoElement,this.time)}}stop(){this._isPlaying=!1,this.time=0,this._videoElement&&(this._videoElement.currentTime=0,this._videoElement.pause(),io&&console.log("STOP",this))}pause(){var e,i;this.time=((e=this._videoElement)==null?void 0:e.currentTime)??0,this._isPlaying=!1,(i=this._videoElement)==null||i.pause(),io&&console.log("PAUSE",this,this.currentTime)}create(e){let i;switch(this.source){case 0:i=this.clip;break;case 1:i=this.url,!(i!=null&&i.length)&&typeof this.clip=="string"&&(i=this.clip);break}return i?(this._videoElement||(io&&console.warn("Create VideoElement",this),this._videoElement=this.createVideoElement(),this.context.domElement.shadowRoot.prepend(this._videoElement),this.updateVideoElementStyles()),typeof i=="string"?(io&&console.log("Set Video src",i),this._videoElement.src=i):(io&&console.log("Set Video srcObject",i),this._videoElement.srcObject=i),this._videoTexture||(this._videoTexture=new tH(this._videoElement)),this._videoTexture.flipY=!1,this._videoTexture.colorSpace=ut,e&&this.handleBeginPlaying(e),io&&console.log("Video: handle playing done...",i,e),!0):(io&&console.warn("No video source set",this),!1)}updateAspect(){this.aspectMode!==0&&this.startCoroutine(this.updateAspectImpl())}get screenspace(){var e;return((e=this._overlay)==null?void 0:e.enabled)??!1}set screenspace(e){var i;if(e){if(!this._videoTexture)return;this._overlay||(this._overlay=new VUe(this.context)),this._overlay.add(this._videoTexture)}else(i=this._overlay)==null||i.remove(this._videoTexture);this._overlay&&(this._overlay.enabled=e)}createVideoElement(){const e=document.createElement("video");return this._crossOrigin&&e.setAttribute("crossorigin",this._crossOrigin),io&&console.log("created video element",e),e}handleBeginPlaying(e){var i,s;if(!this.activeAndEnabled||!this._videoElement)return;this._targetObjects.length=0;let r=this.gameObject;switch(this.renderMode){case 3:r=(i=this.targetMaterialRenderer)==null?void 0:i.gameObject,r||(r=(s=$.getComponent(this.gameObject,Gs))==null?void 0:s.gameObject);break;case 2:console.error("VideoPlayer renderTexture not implemented yet. Please use material override instead");return}if(!r){console.error("Missing target for video material renderer",this.name,koe[this.renderMode],this);return}const o=r.material;if(o){this._targetObjects.push(r),o!==this._videoMaterial&&(this._videoMaterial=o.clone(),r.material=this._videoMaterial);const a="map",l=this._videoMaterial;if(!this.targetMaterialProperty)l[a]=this._videoTexture;else switch(this.targetMaterialProperty){default:l[a]=this._videoTexture;break}}else{console.warn("Can not play video, no material found, this might be a multimaterial case which is not supported yet");return}this.updateVideoElementSettings(),this.updateVideoElementStyles(),e&&(this.shouldUseM3U&&this.ensureM3UCanBePlayed(),this.play())}updateVideoElementSettings(){if(!this._videoElement)return;this._videoElement.loop=this._isLooping,this._videoElement.currentTime=this.currentTime,this._videoElement.playbackRate=this._playbackSpeed,this._videoElement.playsInline=!0;let e=!this._receivedInput||this.audioOutputMode===0;!e&&this._muted&&(e=!0),this._videoElement.muted=e,this.playOnAwake&&(this._videoElement.autoplay=!0)}updateVideoElementStyles(){this._videoElement&&(this._videoElement.style.userSelect="none",this._videoElement.style.visibility="hidden",this._videoElement.style.display="none",this.updateAspect())}*updateAspectImpl(){const e=++this._updateAspectRoutineId,i=void 0,s=this.clip;for(;e===this._updateAspectRoutineId&&this.aspectMode!==0&&this.clip&&s===this.clip&&this._isPlaying;){if(!s||typeof s=="string")return;let r;for(const o of s.getVideoTracks()){const a=o.getSettings();if(a&&a.width&&a.height){r=a.width/a.height;break}else r=this.context.renderer.domElement.clientWidth/this.context.renderer.domElement.clientHeight}if(r===void 0){for(let o=0;o<10;o++)yield;if(!this.isPlaying)break;continue}if(i===r){yield;continue}for(const o of this._targetObjects){let a=1;if(o.parent){const l=Dn(o.parent);a=l.x/l.y}switch(this.aspectMode){case 1:o.scale.y=1/r*o.scale.x*a;break;case 2:o.scale.x=r*o.scale.y*a;break}}for(let o=0;o<3;o++)yield}}get shouldUseM3U(){return this.url!=null&&(this.url.endsWith(".m3u8")||this.url.endsWith(".m3u"))&&this.source===1}ensureM3UCanBePlayed(){if(!this.shouldUseM3U)return;let e=document.head.querySelector("script[data-hls_library]");e?globalThis.Hls?this.onHlsAvailable():e.addEventListener("load",this.onHlsAvailable):(io&&console.log("HLS: load script"),e=document.createElement("script"),e.dataset.hls_library="hls.js",e.src="https://cdn.jsdelivr.net/npm/hls.js@1",e.addEventListener("load",this.onHlsAvailable),document.head.append(e))}}oc([T()],Lr.prototype,"playOnAwake",2),oc([T()],Lr.prototype,"aspectMode",2),oc([T(URL)],Lr.prototype,"clip",2),oc([T()],Lr.prototype,"source",2),oc([T(URL)],Lr.prototype,"url",1),oc([T()],Lr.prototype,"renderMode",2),oc([T()],Lr.prototype,"targetMaterialProperty",2),oc([T(Gs)],Lr.prototype,"targetMaterialRenderer",2),oc([T(di)],Lr.prototype,"targetTexture",2),oc([T()],Lr.prototype,"time",2),oc([T()],Lr.prototype,"playbackSpeed",1),oc([T()],Lr.prototype,"isLooping",1),oc([T()],Lr.prototype,"audioOutputMode",1);class VUe{constructor(e){m(this,"context"),m(this,"_videos",[]),m(this,"_screenspaceModeQuad"),m(this,"_isInScreenspaceMode",!1),m(this,"_input"),this.context=e,this._input=new XUe(this)}get enabled(){return this._isInScreenspaceMode}set enabled(e){e?this.start():this.stop()}add(e){this._videos.indexOf(e)===-1&&this._videos.push(e)}remove(e){if(!e)return;const i=this._videos.indexOf(e);i>=0&&this._videos.splice(i,1)}start(){var e;if(this._isInScreenspaceMode||this._videos.length<0)return;const i=this._videos[this._videos.length-1];if(!i)return;if(this._isInScreenspaceMode=!0,!this._screenspaceModeQuad){if(this._screenspaceModeQuad=Ym.createPrimitive(M0.Quad,{material:new DUe(i)}),!this._screenspaceModeQuad)return;this._screenspaceModeQuad.geometry.scale(2,2,2)}const s=this._screenspaceModeQuad;this.context.scene.add(s),this.updateScreenspaceMaterialUniforms();const r=s.material;r?.reset(),(e=this._input)==null||e.enable(r)}stop(){var e;this._isInScreenspaceMode=!1,this._screenspaceModeQuad&&((e=this._input)==null||e.disable(),this._screenspaceModeQuad.removeFromParent())}updateScreenspaceMaterialUniforms(){var e;const i=(e=this._screenspaceModeQuad)==null?void 0:e.material;i&&(i.screenAspect=this.context.domElement.clientWidth/this.context.domElement.clientHeight)}}class XUe{constructor(e){m(this,"_onResizeScreenFn"),m(this,"_onKeyUpFn"),m(this,"_onMouseWheelFn"),m(this,"context"),m(this,"overlay"),m(this,"_material"),m(this,"_isPinching",!1),m(this,"_lastPinch",0),this.overlay=e,this.context=e.context}enable(e){this._material=e,window.addEventListener("resize",this._onResizeScreenFn=()=>{this.overlay.updateScreenspaceMaterialUniforms()}),window.addEventListener("keyup",this._onKeyUpFn=r=>{r.key==="Escape"&&this.overlay.stop()}),window.addEventListener("wheel",this._onMouseWheelFn=r=>{this.overlay.enabled&&(e.zoom+=r.deltaY*5e-4,r.preventDefault())},{passive:!1});const i=new Q;window.addEventListener("mousemove",r=>{if(this.overlay.enabled&&this.context.input.getPointerPressed(0)){const o=new Q(r.movementX,r.movementY);o.x/=this.context.domElement.clientWidth,o.y/=this.context.domElement.clientHeight,i.set(o.x,o.y),i.multiplyScalar(e.zoom/-this.context.time.deltaTime*.01),e.offset=e.offset.add(i)}}),window.addEventListener("pointermove",r=>{this.overlay.enabled&&this.context.input.getPointerPressed(0)&&this.context.input.getTouchesPressedCount()===1&&(i.set(r.movementX,r.movementY),i.multiplyScalar(e.zoom*-this.context.time.deltaTime*.05),e.offset=e.offset.add(i))});let s=0;window.addEventListener("touchstart",r=>{if(r.touches.length<2){this.context.time.time-s<.3&&this.overlay.stop(),s=this.context.time.time;return}this._isPinching=!0,this._lastPinch=0}),window.addEventListener("touchmove",r=>{if(!this._isPinching||!this._material)return;const o=r.touches[0],a=r.touches[1],l=o.clientX-a.clientX,c=o.clientY-a.clientY,h=Math.sqrt(l*l+c*c);if(this._lastPinch!==0){const d=h-this._lastPinch;this._material.zoom-=d*.004}this._lastPinch=h}),window.addEventListener("touchend",()=>{this._isPinching=!1})}disable(){this._onResizeScreenFn&&(window.removeEventListener("resize",this._onResizeScreenFn),this._onResizeScreenFn=void 0),this._onKeyUpFn&&(window.removeEventListener("keyup",this._onKeyUpFn),this._onKeyUpFn=void 0),this._onMouseWheelFn&&(window.removeEventListener("wheel",this._onMouseWheelFn),this._onMouseWheelFn=void 0)}}class DUe extends jt{constructor(e){super(),m(this,"_offset",new Q),this.uniforms={map:{value:e},screenAspect:{value:1},offsetScale:{value:new $e(0,0,1,1)}},this.vertexShader=`
        uniform sampler2D map;
        uniform float screenAspect;
        uniform vec4 offsetScale;
        varying vec2 vUv;

        void main() {

            gl_Position = vec4( position , 1.0 );
            vUv = uv;
            vUv.y = 1. - vUv.y;

            // fit into screen
            ivec2 res = textureSize(map, 0);
            float videoAspect = float(res.x) / float(res.y);
            float aspect = videoAspect / screenAspect;
            if(aspect >= 1.0) 
            {
                vUv.y = vUv.y * aspect;
                float offset = (1. - aspect) * .5;
                vUv.y = vUv.y + offset;
            }
            else
            {
                vUv.x = vUv.x / aspect;
                float offset = (1. - 1. / aspect) * .5;
                vUv.x = vUv.x + offset;
            }

            vUv.x -= .5;
            vUv.y -= .5;

            vUv.x *= offsetScale.z;
            vUv.y *= offsetScale.z;
            vUv.x += offsetScale.x;
            vUv.y += offsetScale.y;

            vUv.x += .5;
            vUv.y += .5;
        }

        `,this.fragmentShader=`
        uniform sampler2D map;
        varying vec2 vUv;
        void main() {
            if(vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.)
                gl_FragColor = vec4(0., 0., 0., 1.);
            else
            {
                vec4 texcolor = texture2D(map, vUv);
                texcolor = LinearTosRGB(texcolor);
                gl_FragColor = texcolor;
            }
        }
        `}set screenAspect(e){this.uniforms.screenAspect.value=e,this.needsUpdate=!0}set offset(e){const i=this.uniforms.offsetScale.value;i.x=e.x,i.y=e.y,this.uniforms.offsetScale.value=i,this.needsUpdate=!0}get offset(){const e=this.uniforms.offsetScale.value;return this._offset.set(e.x,e.y),this._offset}set zoom(e){const i=this.uniforms.offsetScale.value;e<.001&&(e=.001),i.z=e,this.needsUpdate=!0}get zoom(){return this.uniforms.offsetScale.value.z}reset(){this.offset=this.offset.set(0,0),this.zoom=1,this.needsUpdate=!0}}var zUe=Object.defineProperty,FUe=Object.getOwnPropertyDescriptor,d_=(n,e,i,s)=>{for(var r=s>1?void 0:s?FUe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&zUe(e,i,r),r};const Do=q("debugscreensharing");var Goe=(n=>(n[n.Screen=0]="Screen",n[n.Camera=1]="Camera",n[n.Canvas=2]="Canvas",n[n.Microphone=3]="Microphone",n))(Goe||{});class Fg extends Oe{constructor(){super(...arguments),m(this,"allowStartOnClick",!0),m(this,"autoConnect",!1),m(this,"_videoPlayer"),m(this,"_audioSource"),m(this,"device","Screen"),m(this,"deviceName"),m(this,"deviceFilter"),m(this,"_net"),m(this,"_requestOpen",!1),m(this,"_currentStream",null),m(this,"_currentMode",0),m(this,"onJoinedRoom",async()=>{await Ah(1e3),this.autoConnect&&!this.isSending&&!this.isReceiving&&this.context.connection.isInRoom&&this.share()}),m(this,"_activeShareRequest",null),m(this,"onReceiveStream",e=>{var i;((i=e.stream)==null?void 0:i.active)===!0&&this.setStream(e.stream,2)}),m(this,"onCallEnded",e=>{Do&&console.log("CALL ENDED",this.isReceiving,this==null?void 0:this.screenspace),this.isReceiving&&(this.screenspace=!1)})}onPointerEnter(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorPointer()}onPointerExit(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorNormal()}onPointerClick(e){var i;if(this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&!(e&&e.pointerId!==0)){if(this.isReceiving&&(i=this.videoPlayer)!=null&&i.isPlaying){this.videoPlayer&&(this.videoPlayer.screenspace=!this.videoPlayer.screenspace);return}if(this.isSending){this.close();return}this.share()}}set videoPlayer(e){this._videoPlayer&&(this.isSending||this.isReceiving)&&this._videoPlayer.stop(),this._videoPlayer=e,this._videoPlayer&&this._currentStream&&(this.isSending||this.isReceiving)&&this._videoPlayer.setVideo(this._currentStream)}get videoPlayer(){return this._videoPlayer}get screenspace(){var e;return((e=this.videoPlayer)==null?void 0:e.screenspace)??!1}set screenspace(e){this.videoPlayer&&(this.videoPlayer.screenspace=e)}get currentScream(){return this._currentStream}get currentMode(){return this._currentMode}get isSending(){var e;return((e=this._currentStream)==null?void 0:e.active)&&this._currentMode===1}get isReceiving(){if(this._currentMode===2){if(!this._currentStream||this._currentStream.active===!1)return!1;const e=this._currentStream.getTracks();for(const i of e)if(i.readyState==="live")return!0}return!1}get requiresVideoPlayer(){return this.device!=="Microphone"}awake(){typeof this.device=="number"&&(this.device=Goe[this.device]),Do&&console.log("Screensharing",this.name,this),vs.registerWaitForAllowAudio(()=>{this._videoPlayer&&this._currentStream&&this._currentMode===2&&(this._videoPlayer.playInBackground=!0,this._videoPlayer.setVideo(this._currentStream))}),this._net=new eM(this)}onEnable(){var e,i,s;(e=this._net)==null||e.enable(),(i=this._net)==null||i.addEventListener(Zd.StreamReceived,this.onReceiveStream),(s=this._net)==null||s.addEventListener(Zd.StreamEnded,this.onCallEnded),this.context.connection.beginListen(pi.JoinedRoom,this.onJoinedRoom),this.autoConnect&&Ah(1e3).then(()=>(this.enabled&&this.autoConnect&&!this.isReceiving&&!this.isSending&&this.context.connection.isInRoom&&this.share(),0))}onDisable(){var e,i,s;(e=this._net)==null||e.removeEventListener(Zd.StreamReceived,this.onReceiveStream),(i=this._net)==null||i.removeEventListener(Zd.StreamEnded,this.onCallEnded),this.context.connection.stopListen(pi.JoinedRoom,this.onJoinedRoom),(s=this._net)==null||s.disable(),this.close()}_ensureVideoPlayer(){const e=new Lr;e.aspectMode=Loe.AdjustWidth,$.addComponent(this.gameObject,e),this._videoPlayer=e}async share(e){return this._activeShareRequest?this._activeShareRequest:(this._activeShareRequest=this.internalShare(e),this._activeShareRequest.then(()=>this._activeShareRequest=null))}async internalShare(e){if(this.context.connection.isInRoom===!1){console.warn("Can not start screensharing: requires network connection"),Je()&&An("Can not start screensharing: requires network connection. Add a SyncedRoom component or join a room first.");return}if(e!=null&&e.device&&(this.device=e.device),!this.videoPlayer&&this.requiresVideoPlayer&&(this._videoPlayer||(this._videoPlayer=$.getComponent(this.gameObject,Lr)??void 0),this.videoPlayer||this._ensureVideoPlayer(),!this.videoPlayer)){console.warn("Can not share video without a videoPlayer assigned");return}this._requestOpen=!0;try{const i=e?.constraints??{echoCancellation:!0,autoGainControl:!1},s={video:i,audio:i},r=s.video;switch(r!==void 0&&typeof r!="boolean"&&(r.width||(r.width={max:1920}),r.height||(r.height={max:1920}),r.aspectRatio||(r.aspectRatio={ideal:1.7777777778}),r.frameRate||(r.frameRate={ideal:24}),r.facingMode||(r.facingMode={ideal:"user"})),this.device){case"Camera":this.tryShareUserCamera(s,e);break;case"Screen":{if(!navigator.mediaDevices.getDisplayMedia){console.error("No getDisplayMedia support");return}const l=await navigator.mediaDevices.getDisplayMedia(s);this._requestOpen?this.setStream(l,1):Wd(l)}break;case"Canvas":const o=0,a=this.context.renderer.domElement.captureStream(o);this.setStream(a,1);break;case"Microphone":{if(!navigator.mediaDevices.getUserMedia){console.error("No getDisplayMedia support");return}s.video=!1;const l=await navigator.mediaDevices.getUserMedia(s);this._requestOpen?this.setStream(l,1):Wd(l)}break;default:console.error("Can not start screen sharing: Unknown device type",this.device)}}catch(i){if(i.name==="NotAllowedError"){console.log("Selection cancelled"),this._requestOpen=!1;return}console.error("Error opening video",i)}}close(){var e;this._requestOpen=!1,this._currentStream&&(Do&&console.warn("Close current stream / disposing resources, stream was active?",this._currentStream.active),(e=this._net)==null||e.stopSendingStream(this._currentStream),Wd(this._currentStream),this._currentMode=0,this._currentStream=null)}setStream(e,i){var s,r,o;if(e===this._currentStream||(this.close(),!e))return;this._currentStream=e,this._requestOpen=!0,this._currentMode=i;const a=this.device!=="Microphone",l=i===1;a?(this._videoPlayer||this._ensureVideoPlayer(),this._videoPlayer?this._videoPlayer.setVideo(e):console.error("No video player assigned for video stream")):(this._audioSource||(this._audioSource=new vs,this._audioSource.spatialBlend=0,this._audioSource.volume=1,this.gameObject.addComponent(this._audioSource)),l||(Do&&console.log("PLAY",e.getAudioTracks()),this._audioSource.volume=1,(s=this._audioSource)==null||s.play(e))),l&&((r=this._net)==null||r.startSendingStream(e)),l&&(this._videoPlayer&&(this._videoPlayer.muted=!0),(o=this._audioSource)==null||o.stop());for(const c of e.getTracks())c.addEventListener("ended",()=>{Do&&console.log("Track ended",c),this.close()}),Do&&c.kind==="video"&&console.log(l?"Video \u2192":"Video \u2190",c.getSettings())}async tryShareUserCamera(e,i){const s=(await navigator.mediaDevices.enumerateDevices()).filter(o=>o.kind==="videoinput");Do&&console.log(`Request camera. These are your kind:videoinput devices:
`,s);let r=!1;for(const o of s)try{if(!this._requestOpen){Do&&console.log("Camera selection cancelled");break}if(o.kind!=="videoinput"){Do&&console.log("Skipping non-video device",o);continue}const a=o.deviceId;if(i?.deviceId!=null||i?.deviceFilter!=null){if(i?.deviceId!==void 0&&a!==i.deviceId){Do&&console.log("Skipping device due to options.deviceId: "+o.label+"; "+o.deviceId);continue}if(i!=null&&i.deviceFilter&&i.deviceFilter(o)===!1){Do&&console.log("Skipping device due to options.deviceFilter: "+o.label+"; "+o.deviceId);continue}}else if(this.deviceFilter)if(this.deviceFilter(o)===!1){Do&&console.log("Skipping device due to ScreenShare.deviceFilter: "+o.label+"; "+o.deviceId);continue}else Do&&console.log("Selected device by filter",o);else if(this.deviceName){const c=o.label.toLowerCase(),h=this.deviceName.toLowerCase(),d=c.includes(h),u=o.deviceId===this.deviceName;if(!d&&!u){Do&&console.log("Skipping device due to ScreenShare.deviceName: "+o.label+"; "+o.deviceId);continue}else Do&&console.log("Selected device by name",o)}e.video!==!1&&((typeof e.video>"u"||typeof e.video=="boolean")&&(e.video={}),e.video.deviceId=a),r=!0;const l=await navigator.mediaDevices.getUserMedia(e).catch(c=>(console.error("Failed to get user media",c),null));if(l===null)continue;this._requestOpen?(this.setStream(l,1),Do&&console.log("Selected camera",o)):(Wd(l),Do&&console.log("Camera selection cancelled"));break}catch(a){if(a.message==="Failed to allocate videosource"||a.message==="Could not start video source"){An("Failed to start video: Try another camera (Code "+a.code+")"),console.warn(a);continue}else console.error("Failed to get user media",a.message,a.code,a)}!r&&Je()&&(An("No camera found for sharing. Please connect a camera (see console for more information)"),console.warn("No camera found for sharing. Please connect a camera",s,this.deviceName,"Using deviceFilter? "+this.deviceFilter!=null,"Using options? "+i!=null,"Using deviceName? "+this.deviceName!=null,"Using options.deviceId? "+i?.deviceId!=null,"Using options.deviceFilter? "+i?.deviceFilter!=null))}}d_([T()],Fg.prototype,"allowStartOnClick",2),d_([T()],Fg.prototype,"autoConnect",2),d_([T(Lr)],Fg.prototype,"videoPlayer",1),d_([T()],Fg.prototype,"device",2),d_([T()],Fg.prototype,"deviceName",2);var UUe=Object.defineProperty,OUe=Object.getOwnPropertyDescriptor,u_=(n,e,i,s)=>{for(var r=s>1?void 0:s?OUe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&UUe(e,i,r),r};class Lp extends qr{constructor(){super(...arguments),m(this,"intensity",new at(2)),m(this,"falloff",new at(1)),m(this,"samples",new at(9)),m(this,"color",new at(new fe(0,0,0))),m(this,"luminanceInfluence",new at(.7)),m(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusion"}onBeforeRender(){if(this._ssao&&this.context.mainCamera instanceof Ot){const e=this.context.mainCamera.far-this.context.mainCamera.near;this._ssao.ssaoMaterial.worldDistanceFalloff=e*.01,this._ssao.ssaoMaterial.worldDistanceThreshold=this.context.mainCamera.far}}onCreateEffect(){const e=this.context.mainCamera,i=new g7(this.context.scene,e),s=new MD({normalBuffer:i.texture,resolutionScale:.5}),r=this._ssao=new h7(e,i.texture,{normalDepthBuffer:s.texture,worldDistanceThreshold:1,worldDistanceFalloff:1,worldProximityThreshold:.1,worldProximityFalloff:2,intensity:1,blendFunction:bi.MULTIPLY,luminanceInfluence:.5});this.intensity.onValueChanged=a=>{r.intensity=a},this.falloff.onValueChanged=a=>{r.ssaoMaterial.radius=a*.1},this.samples.onValueChanged=a=>{r.ssaoMaterial.samples=a},this.color.onValueChanged=a=>{r.color||(r.color=new fe),r.color.copy(a)},this.luminanceInfluence.onValueChanged=a=>{r.luminanceInfluence=a};const o=new Array;return o.push(i),o.push(s),o.push(r),o}}u_([T(at)],Lp.prototype,"intensity",2),u_([T(at)],Lp.prototype,"falloff",2),u_([T(at)],Lp.prototype,"samples",2),u_([T(at)],Lp.prototype,"color",2),u_([T(at)],Lp.prototype,"luminanceInfluence",2),Uc("ScreenSpaceAmbientOcclusion",Lp);var ZUe=Object.defineProperty,WUe=Object.getOwnPropertyDescriptor,fA=(n,e,i,s)=>{for(var r=s>1?void 0:s?WUe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&ZUe(e,i,r),r},wO=(n=>(n[n.Performance=0]="Performance",n[n.Low=1]="Low",n[n.Medium=2]="Medium",n[n.High=3]="High",n[n.Ultra=4]="Ultra",n))(wO||{});class Hh extends qr{constructor(){super(...arguments),m(this,"gammaCorrection",!0),m(this,"aoRadius",new at(1)),m(this,"falloff",new at(1)),m(this,"intensity",new at(1)),m(this,"color",new at(new fe(0,0,0))),m(this,"screenspaceRadius",!1),m(this,"quality",2),m(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusionN8"}onValidate(){this._ssao&&(this._ssao.setQualityMode(wO[this.quality]),this._ssao.configuration.gammaCorrection=this.gammaCorrection,this._ssao.configuration.screenSpaceRadius=this.screenspaceRadius)}onCreateEffect(){const e=this.context.mainCamera,i=this._ssao=new soe(this.context.scene,e,this.context.domWidth,this.context.domHeight),s=wO[this.quality];i.setQualityMode(s),i.configuration.gammaCorrection=this.gammaCorrection,i.configuration.screenSpaceRadius=this.screenspaceRadius,this.intensity.onValueChanged=o=>{i.configuration.intensity=o},this.falloff.onValueChanged=o=>{i.configuration.distanceFalloff=o},this.aoRadius.onValueChanged=o=>{i.configuration.aoRadius=o},this.color.onValueChanged=o=>{i.color||(i.color=new fe),i.configuration.color.copy(o)};const r=new Array;return r.push(i),r}}fA([Io(),T()],Hh.prototype,"gammaCorrection",2),fA([T(at)],Hh.prototype,"aoRadius",2),fA([T(at)],Hh.prototype,"falloff",2),fA([T(at)],Hh.prototype,"intensity",2),fA([T(at)],Hh.prototype,"color",2),fA([Io(),T()],Hh.prototype,"screenspaceRadius",2),fA([Io(),T()],Hh.prototype,"quality",2),Uc("ScreenSpaceAmbientOcclusionN8",Hh);var HUe=Object.defineProperty,QUe=Object.getOwnPropertyDescriptor,Poe=(n,e,i,s)=>{for(var r=s>1?void 0:s?QUe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&HUe(e,i,r),r};class p_ extends Oe{constructor(){super(...arguments),m(this,"mode",0),m(this,"shadowColor",new pn(0,0,0,1)),m(this,"targetMesh")}start(){if(this.gameObject instanceof pe)this.gameObject instanceof pe&&this.gameObject.material&&(this.gameObject.material=this.gameObject.material.clone(),this.targetMesh=this.gameObject,this.targetMesh.receiveShadow=!0);else{const e=Ym.createPrimitive(M0.Quad,{name:"ShadowCatcher",material:new Us({color:10066329,roughness:1,metalness:0,transparent:!0})});e.receiveShadow=!0,e.geometry.rotateX(-Math.PI/2),this.gameObject.add(e),this.targetMesh=e}if(!this.targetMesh){console.warn("ShadowCatcher: no mesh to apply shadow catching to. Groups are currently not supported.");return}switch(this.targetMesh.layers.set(2),this.mode){case 0:this.applyShadowMaterial();break;case 1:this.applyLightBlendMaterial();break;case 2:this.applyOccluderMaterial();break}}applyLightBlendMaterial(){if(!this.targetMesh)return;const e=this.targetMesh.material;e.blending=Wp,this.applyMaterialOptions(e),e.onBeforeCompile=i=>{i.fragmentShader=i.fragmentShader.replace("vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;",`vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
            // diffuse-only lighting with overdrive to somewhat compensate
            // for the loss of indirect lighting and to make it more visible.
            vec3 direct = (reflectedLight.directDiffuse + reflectedLight.directSpecular) * 6.6;
            float max = max(direct.r, max(direct.g, direct.b));
            
            // early out - we're simply returning direct lighting and some alpha based on it so it can 
            // be blended onto the scene.
            gl_FragColor = vec4(direct, max);
            return;
            `)},e.userData.isLightBlendMaterial=!0}applyShadowMaterial(){if(this.targetMesh)if(this.targetMesh.material.type!=="ShadowMaterial"){const e=new v1;e.color=this.shadowColor,e.opacity=this.shadowColor.alpha,this.applyMaterialOptions(e),this.targetMesh.material=e,e.userData.isShadowCatcherMaterial=!0}else{const e=this.targetMesh.material;e.color=this.shadowColor,e.opacity=this.shadowColor.alpha,this.applyMaterialOptions(e),e.userData.isShadowCatcherMaterial=!0}}applyOccluderMaterial(){if(this.targetMesh){let e=this.targetMesh.material;if(!e){const i=new ai;this.targetMesh.material=i,e=i}e.depthWrite=!0,e.stencilWrite=!0,e.colorWrite=!1,this.gameObject.renderOrder=-100}}applyMaterialOptions(e){e&&(e.depthWrite=!1,e.stencilWrite=!1)}}Poe([T()],p_.prototype,"mode",2),Poe([T(pn)],p_.prototype,"shadowColor",2);var KUe=Object.defineProperty,YUe=Object.getOwnPropertyDescriptor,UB=(n,e,i,s)=>{for(var r=s>1?void 0:s?YUe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&KUe(e,i,r),r},CO;const Noe=(CO=class extends Oe{constructor(){super(...arguments),m(this,"target",null),m(this,"followFactor",.1),m(this,"rotateFactor",.1),m(this,"positionAxes",hv.All),m(this,"flipForward",!1),m(this,"_firstUpdate",!0)}onBeforeRender(){this.updateNow(!1)}updateNow(n){if(!(!this.target||this.target===this.gameObject)){if(this.followFactor>0){const e=ri(this.target),i=this._firstUpdate||n?1:lt.clamp01(this.context.time.deltaTime*this.followFactor),s=this.worldPosition;this.positionAxes&hv.X&&(s.x=lt.lerp(s.x,e.x,i)),this.positionAxes&hv.Y&&(s.y=lt.lerp(s.y,e.y,i)),this.positionAxes&hv.Z&&(s.z=lt.lerp(s.z,e.z,i)),this.worldPosition=s}if(this.rotateFactor>0){const e=fn(this.target);this.flipForward&&e.premultiply(Noe._invertForward);const i=this._firstUpdate||n?1:lt.clamp01(this.context.time.deltaTime*this.rotateFactor);this.worldQuaternion=this.worldQuaternion.slerp(e,i)}this._firstUpdate=!1}}},m(CO,"_invertForward",new Fe().setFromAxisAngle(new E(0,1,0),Math.PI)),CO);let Ug=Noe;UB([T(Ae)],Ug.prototype,"target",2),UB([T()],Ug.prototype,"followFactor",2),UB([T()],Ug.prototype,"rotateFactor",2),UB([T()],Ug.prototype,"positionAxes",2);class jUe extends pe{constructor(e){const i=new JUe(e),s=new Xs(i.image.width*.001,i.image.height*.001),r=new ai({map:i,toneMapped:!1,transparent:!0});super(s,r);function o(a){r.map.dispatchDOMEvent(a)}this.addEventListener("mousedown",o),this.addEventListener("mousemove",o),this.addEventListener("mouseup",o),this.addEventListener("click",o),this.dispose=function(){s.dispose(),r.dispose(),r.map.dispose(),SO.delete(e),this.removeEventListener("mousedown",o),this.removeEventListener("mousemove",o),this.removeEventListener("mouseup",o),this.removeEventListener("click",o)}}}class JUe extends vP{constructor(e){super(Voe(e)),this.dom=e,this.anisotropy=16,this.colorSpace=ut,this.minFilter=Wt,this.magFilter=Wt;const i=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),s={attributes:!0,childList:!0,subtree:!0,characterData:!0};i.observe(e,s),this.observer=i}dispatchDOMEvent(e){e.data&&qUe(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=Voe(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const SO=new WeakMap;function Voe(n){const e=document.createRange(),i=new fe;function s(p){const g=[];let f=!1;function A(){if(f&&(f=!1,p.restore()),g.length===0)return;let y=-1/0,b=-1/0,v=1/0,x=1/0;for(let w=0;w<g.length;w++){const C=g[w];y=Math.max(y,C.x),b=Math.max(b,C.y),v=Math.min(v,C.x+C.width),x=Math.min(x,C.y+C.height)}p.save(),p.beginPath(),p.rect(y,b,v-y,x-b),p.clip(),f=!0}return{add:function(y){g.push(y),A()},remove:function(){g.pop(),A()}}}function r(p,g,f,A){A!==""&&(p.textTransform==="uppercase"&&(A=A.toUpperCase()),d.font=p.fontWeight+" "+p.fontSize+" "+p.fontFamily,d.textBaseline="top",d.fillStyle=p.color,d.fillText(A,g,f+parseFloat(p.fontSize)*.1))}function o(p,g,f,A,y){f<2*y&&(y=f/2),A<2*y&&(y=A/2),d.beginPath(),d.moveTo(p+y,g),d.arcTo(p+f,g,p+f,g+A,y),d.arcTo(p+f,g+A,p,g+A,y),d.arcTo(p,g+A,p,g,y),d.arcTo(p,g,p+f,g,y),d.closePath()}function a(p,g,f,A,y,b){const v=p[g+"Width"],x=p[g+"Style"],w=p[g+"Color"];v!=="0px"&&x!=="none"&&w!=="transparent"&&w!=="rgba(0, 0, 0, 0)"&&(d.strokeStyle=w,d.lineWidth=parseFloat(v),d.beginPath(),d.moveTo(f,A),d.lineTo(f+y,A+b),d.stroke())}function l(p,g){if(p.nodeType===Node.COMMENT_NODE||p.nodeName==="SCRIPT"||p.style&&p.style.display==="none")return;let f=0,A=0,y=0,b=0;if(p.nodeType===Node.TEXT_NODE){e.selectNode(p);const x=e.getBoundingClientRect();f=x.left-c.left-.5,A=x.top-c.top-.5,y=x.width,b=x.height,r(g,f,A,p.nodeValue.trim())}else if(p instanceof HTMLCanvasElement){const x=p.getBoundingClientRect();f=x.left-c.left-.5,A=x.top-c.top-.5,d.save();const w=window.devicePixelRatio;d.scale(1/w,1/w),d.drawImage(p,f,A),d.restore()}else if(p instanceof HTMLImageElement){const x=p.getBoundingClientRect();f=x.left-c.left-.5,A=x.top-c.top-.5,y=x.width,b=x.height,d.drawImage(p,f,A,y,b)}else{const x=p.getBoundingClientRect();f=x.left-c.left-.5,A=x.top-c.top-.5,y=x.width,b=x.height,g=window.getComputedStyle(p),o(f,A,y,b,parseFloat(g.borderRadius));const w=g.backgroundColor;w!=="transparent"&&w!=="rgba(0, 0, 0, 0)"&&(d.fillStyle=w,d.fill());const C=["borderTop","borderLeft","borderBottom","borderRight"];let S=!0,_=null;for(const I of C){if(_!==null&&(S=g[I+"Width"]===g[_+"Width"]&&g[I+"Color"]===g[_+"Color"]&&g[I+"Style"]===g[_+"Style"]),S===!1)break;_=I}if(S===!0){const I=parseFloat(g.borderTopWidth);g.borderTopWidth!=="0px"&&g.borderTopStyle!=="none"&&g.borderTopColor!=="transparent"&&g.borderTopColor!=="rgba(0, 0, 0, 0)"&&(d.strokeStyle=g.borderTopColor,d.lineWidth=I,d.stroke())}else a(g,"borderTop",f,A,y,0),a(g,"borderLeft",f,A,0,b),a(g,"borderBottom",f,A+b,y,0),a(g,"borderRight",f+y,A,0,b);if(p instanceof HTMLInputElement){let I=g.accentColor;(I===void 0||I==="auto")&&(I=g.color),i.set(I);const B=Math.sqrt(.299*i.r**2+.587*i.g**2+.114*i.b**2)<.5?"white":"#111111";if(p.type==="radio"&&(o(f,A,y,b,b),d.fillStyle="white",d.strokeStyle=I,d.lineWidth=1,d.fill(),d.stroke(),p.checked&&(o(f+2,A+2,y-4,b-4,b),d.fillStyle=I,d.strokeStyle=B,d.lineWidth=2,d.fill(),d.stroke())),p.type==="checkbox"&&(o(f,A,y,b,2),d.fillStyle=p.checked?I:"white",d.strokeStyle=p.checked?B:I,d.lineWidth=1,d.stroke(),d.fill(),p.checked)){const M=d.textAlign;d.textAlign="center";const R={color:B,fontFamily:g.fontFamily,fontSize:b+"px",fontWeight:"bold"};r(R,f+y/2,A,"\u2714"),d.textAlign=M}if(p.type==="range"){const[M,R,k]=["min","max","value"].map(X=>parseFloat(p[X])),G=(k-M)/(R-M)*(y-b);o(f,A+b/4,y,b/2,b/4),d.fillStyle=B,d.strokeStyle=I,d.lineWidth=1,d.fill(),d.stroke(),o(f,A+b/4,G+b/2,b/2,b/4),d.fillStyle=I,d.fill(),o(f+G,A,b,b,b/2),d.fillStyle=I,d.fill()}(p.type==="color"||p.type==="text"||p.type==="number")&&(u.add({x:f,y:A,width:y,height:b}),r(g,f+parseInt(g.paddingLeft),A+parseInt(g.paddingTop),p.value),u.remove())}}const v=g.overflow==="auto"||g.overflow==="hidden";v&&u.add({x:f,y:A,width:y,height:b});for(let x=0;x<p.childNodes.length;x++)l(p.childNodes[x],g);v&&u.remove()}const c=n.getBoundingClientRect();let h=SO.get(n);h===void 0&&(h=document.createElement("canvas"),h.width=c.width,h.height=c.height,SO.set(n,h));const d=h.getContext("2d"),u=new s(d);return d.clearRect(0,0,h.width,h.height),l(n),h}function qUe(n,e,i,s){const r={clientX:i*n.offsetWidth+n.offsetLeft,clientY:s*n.offsetHeight+n.offsetTop,view:n.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(e,r));const o=n.getBoundingClientRect();i=i*o.width+o.left,s=s*o.height+o.top;function a(l){if(l.nodeType!==Node.TEXT_NODE&&l.nodeType!==Node.COMMENT_NODE){const c=l.getBoundingClientRect();if(i>c.left&&i<c.right&&s>c.top&&s<c.bottom&&(l.dispatchEvent(new MouseEvent(e,r)),l instanceof HTMLInputElement&&l.type==="range"&&(e==="mousedown"||e==="click"))){const[h,d]=["min","max"].map(g=>parseFloat(l[g])),u=c.width,p=(i-c.x)/u;l.value=h+(d-h)*p,l.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let h=0;h<l.childNodes.length;h++)a(l.childNodes[h])}}a(n)}const OB=new Q,jv={type:"",data:OB},Xoe=new pm;class $Ue extends Es{listenToPointerEvents(e,i){const s=this,r=new pm,o=e.domElement;function a(l){l.stopPropagation();const c=e.domElement.getBoundingClientRect();OB.x=(l.clientX-c.left)/c.width*2-1,OB.y=-(l.clientY-c.top)/c.height*2+1,r.setFromCamera(OB,i);const h=r.intersectObjects(s.children,!1);if(h.length>0){const d=h[0],u=d.object,p=d.uv;jv.type=l.type,jv.data.set(p.x,1-p.y),u.dispatchEvent(jv)}}o.addEventListener("pointerdown",a),o.addEventListener("pointerup",a),o.addEventListener("pointermove",a),o.addEventListener("mousedown",a),o.addEventListener("mouseup",a),o.addEventListener("mousemove",a),o.addEventListener("click",a)}listenToXRControllerEvents(e){const i=this,s={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"};function r(o){const a=o.target;Xoe.setFromXRController(a);const l=Xoe.intersectObjects(i.children,!1);if(l.length>0){const c=l[0],h=c.object,d=c.uv;jv.type=s[o.type],jv.data.set(d.x,1-d.y),h.dispatchEvent(jv)}}e.addEventListener("move",r),e.addEventListener("select",r),e.addEventListener("selectstart",r),e.addEventListener("selectend",r)}}var e3e=Object.defineProperty,t3e=Object.getOwnPropertyDescriptor,Doe=(n,e,i,s)=>{for(var r=s>1?void 0:s?t3e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&e3e(e,i,r),r};class m_ extends Oe{constructor(){super(...arguments),m(this,"id",null),m(this,"keepAspect",!1),m(this,"_object",null)}onEnable(){if(this._object){this.gameObject.add(this._object);return}if(!this.id||!this.context.mainCamera)return;const e=document.getElementById(this.id);if(!e){console.warn('Could not find element with id "'+this.id+'"');return}e.style.display="block",e.style.visibility="hidden";const i=new $Ue;i.listenToPointerEvents(this.context.renderer,this.context.mainCamera),this.gameObject.add(i);const s=new jUe(e);i.add(s),s.visible=!1;const r=s.material;r.transparent=!0,setTimeout(()=>{s.visible=!0;const o=ww(this.gameObject).clone();Cw(this.gameObject,0,0,0),this.gameObject.updateMatrixWorld();const a=new gi;a.setFromObject(i),this.setWorldRotation(o.x,o.y,o.z);const l=a.max.x-a.min.x,c=a.max.y-a.min.y;if(this.keepAspect){const d=l/c;l>c?s.scale.set(1/l,1/c/d,1):s.scale.set(1/l*d,1/c,1)}else s.scale.set(1/l,1/c,1);const h=this.gameObject.scale;s.scale.multiply(h)},1)}onDisable(){var e;(e=this._object)==null||e.removeFromParent()}}Doe([T()],m_.prototype,"id",2),Doe([T()],m_.prototype,"keepAspect",2);var i3e=Object.defineProperty,n3e=Object.getOwnPropertyDescriptor,g_=(n,e,i,s)=>{for(var r=s>1?void 0:s?n3e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&i3e(e,i,r),r};const f_=q("debugspatialtrigger"),zoe=new Qo,Foe=new Qo;function s3e(n,e){return zoe.mask=n,Foe.mask=e,zoe.test(Foe)}class hu extends Oe{constructor(){super(...arguments),m(this,"triggerMask",0),m(this,"onEnter"),m(this,"onStay"),m(this,"onExit"),m(this,"currentIntersected",[]),m(this,"lastIntersected",[])}start(){f_&&console.log(this.name,this.triggerMask,this)}update(){this.currentIntersected.length=0;for(const e of A_.triggers)s3e(e.triggerMask,this.triggerMask)&&e.test(this.gameObject)&&this.currentIntersected.push(e);for(let e=this.lastIntersected.length-1;e>=0;e--){const i=this.lastIntersected[e];this.currentIntersected.indexOf(i)<0&&(this.onExitTrigger(i),this.lastIntersected.splice(e,1))}for(const e of this.currentIntersected)this.lastIntersected.indexOf(e)<0&&this.onEnterTrigger(e),this.onStayTrigger(e);this.lastIntersected.length=0,this.lastIntersected.push(...this.currentIntersected)}onEnterTrigger(e){var i;f_&&console.log("ENTER TRIGGER",this.name,e.name,this,e),e.raiseOnEnterEvent(this),(i=this.onEnter)==null||i.invoke(this,e)}onExitTrigger(e){var i;f_&&console.log("EXIT TRIGGER",this.name,e.name,this,e),e.raiseOnExitEvent(this),(i=this.onExit)==null||i.invoke(this,e)}onStayTrigger(e){var i;e.raiseOnStayEvent(this),(i=this.onStay)==null||i.invoke(this,e)}}g_([T()],hu.prototype,"triggerMask",2),g_([T(Gn)],hu.prototype,"onEnter",2),g_([T(Gn)],hu.prototype,"onStay",2),g_([T(Gn)],hu.prototype,"onExit",2);var _O;const ZB=(_O=class extends Oe{constructor(){super(...arguments),m(this,"triggerMask"),m(this,"boxHelper")}start(){f_&&console.log(this.name,this.triggerMask,this)}onEnable(){var n;ZB.triggers.push(this),this.boxHelper||(this.boxHelper=$.addComponent(this.gameObject,Oc),(n=this.boxHelper)==null||n.showHelper(null,f_))}onDisable(){ZB.triggers.splice(ZB.triggers.indexOf(this),1)}test(n){return this.boxHelper?this.boxHelper.isInBox(n)??!1:!1}raiseOnEnterEvent(n){$.foreachComponent(this.gameObject,e=>{e!==n&&e instanceof hu&&e.onEnterTrigger(this)},!1)}raiseOnStayEvent(n){$.foreachComponent(this.gameObject,e=>{e!==n&&e instanceof hu&&e.onStayTrigger(this)},!1)}raiseOnExitEvent(n){$.foreachComponent(this.gameObject,e=>{e!==n&&e instanceof hu&&e.onExitTrigger(this)},!1)}},m(_O,"triggers",[]),_O);let A_=ZB;g_([T()],A_.prototype,"triggerMask",2);var r3e=Object.defineProperty,o3e=Object.getOwnPropertyDescriptor,a3e=(n,e,i,s)=>{for(var r=s>1?void 0:s?o3e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&r3e(e,i,r),r};const ac=q("debugspectator");class WB extends Oe{constructor(){super(...arguments),m(this,"cam",null),m(this,"useKeys",!0),m(this,"_mode",0),m(this,"orbit",null),m(this,"_handler"),m(this,"eventSub_WebXRRequestStartEvent",null),m(this,"eventSub_WebXRStartEvent",null),m(this,"eventSub_WebXREndEvent",null),m(this,"_debug"),m(this,"_networking")}get mode(){return this._mode}set mode(e){this._mode=e}get isSpectating(){var e;return((e=this._handler)==null?void 0:e.currentTarget)!==void 0}isSpectatingUser(e){var i;return((i=this.target)==null?void 0:i.userId)===e}isFollowedBy(e){var i;return(i=this.followers)==null?void 0:i.includes(e)}get followers(){return this._networking.followers}stopSpectating(){if(this.context.isInXR){this.followSelf();return}this.target=void 0}get localId(){return this.context.connection.connectionId??"local"}set target(e){var i;if(this._handler){const s=(i=this._handler.currentTarget)==null?void 0:i.userId,r=this.context.players.getPlayerView(this.localId);e===void 0||this.context.isInXR===!1&&r?.currentObject===e.currentObject?this._handler.currentTarget!==void 0&&(this._handler.disable(),$.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),this._networking.onSpectatedObjectChanged(e,s)):this._handler.currentTarget!==e&&(this._handler.set(e),$.setActive(this.gameObject,!0),this.orbit&&(this.orbit.enabled=!1),this._networking.onSpectatedObjectChanged(e,s))}}get target(){var e;return(e=this._handler)==null?void 0:e.currentTarget}requestAllFollowMe(){this._networking.onRequestFollowMe()}get isSpectatingSelf(){var e,i;return this.isSpectating&&((e=this.target)==null?void 0:e.currentObject)===((i=this.context.players.getPlayerView(this.localId))==null?void 0:i.currentObject)}awake(){if(this._debug=new h3e(this.context,this),this._networking=new p3e(this.context,this),this._networking.awake(),$.setActive(this.gameObject,!1),this.cam=$.getComponent(this.gameObject,In),!this.cam){console.warn("SpectatorCamera: Spectator camera needs camera component on the same object.",this);return}!this._handler&&this.cam&&(this._handler=new l3e(this.context,this.cam,this)),this.orbit=$.getComponent(this.context.mainCamera,ln)}onDestroy(){var e,i;this.stopSpectating(),(e=this._handler)==null||e.destroy(),(i=this._networking)==null||i.destroy()}isSupportedPlatform(){const e=window.navigator.userAgent,i=/Windows|MacOS/.test(e),s=/Windows NT/.test(e)&&/Edg/.test(e)&&!/Win64/.test(e);return i&&!s}onBeforeXR(e){this.isSupportedPlatform()&&$.setActive(this.gameObject,!0)}onEnterXR(e){this.isSupportedPlatform()&&(ac&&console.log(this.context.mainCamera),this.context.mainCamera&&this.followSelf())}onLeaveXR(e){var i,s;this.context.removeCamera(this.cam),$.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),(i=this._handler)==null||i.set(void 0),(s=this._handler)==null||s.disable(),this.isSpectatingSelf&&this.stopSpectating()}followSelf(){this.target=this.context.players.getPlayerView(this.context.connection.connectionId),this.target||(this.context.players.setPlayerView(this.localId,this.context.mainCamera,ig.Headset),this.target=this.context.players.getPlayerView(this.localId)),ac&&console.log("Follow self",this.target)}onAfterRender(){var e,i,s;if(!this.cam)return;const r=this.context.renderer,o=r.xr.enabled;if(!r.xr.isPresenting&&!((e=this._handler)!=null&&e.currentTarget))return;(i=this._handler)==null||i.update(this._mode);const a=r.getRenderTarget();let l=null;const c=r.state;if(!a){if(!r.state.bindFramebuffer||!c.bindXRFramebuffer)return;l=r._framebuffer,c.bindXRFramebuffer(null)}this.setAvatarFlagsBeforeRender();const h=this.context.mainCameraComponent;if(h){const p=h.backgroundColor;p&&r.setClearColor(p,p.alpha),this.cam.backgroundColor=p,this.cam.clearFlags=h.clearFlags,this.cam.nearClipPlane=h.nearClipPlane,this.cam.farClipPlane=h.farClipPlane}else r.setClearColor(new fe(1,1,1));r.setRenderTarget(null),r.xr.enabled=!1;const d=(s=this.cam)==null?void 0:s.threeCamera;this.context.updateAspect(d);const u=r.xr.isPresenting;r.xr.isPresenting=!1,r.setSize(this.context.domWidth,this.context.domHeight),r.render(this.context.scene,d),r.xr.isPresenting=u,r.xr.enabled=o,a?r.setRenderTarget(a):c.bindXRFramebuffer&&c.bindXRFramebuffer(l),this.resetAvatarFlags()}setAvatarFlagsBeforeRender(){const e=this._mode===0;for(const i of Eo.instances)if(i.avatar&&"isLocalAvatar"in i.avatar&&"flags"in i.avatar){let s=Ud.All;this.isSpectatingSelf&&(s=e&&i.avatar.isLocalAvatar?Ud.FirstPerson:Ud.ThirdPerson);const r=i.avatar.flags;if(!r)continue;for(const o of r)o.UpdateVisible(s)}}resetAvatarFlags(){var e;for(const i of Eo.instances)if(i.avatar&&"flags"in i.avatar){const s=i.avatar.flags;if(!s)continue;for(const r of s)"isLocalAvatar"in i.avatar&&(e=i.avatar)!=null&&e.isLocalAvatar?r.UpdateVisible(Ud.FirstPerson):r.UpdateVisible(Ud.ThirdPerson)}}}a3e([T()],WB.prototype,"useKeys",2);class l3e{constructor(e,i,s){m(this,"context"),m(this,"cam"),m(this,"spectator"),m(this,"follow"),m(this,"target"),m(this,"view"),m(this,"currentObject"),this.context=e,this.cam=i,this.spectator=s}get currentTarget(){return this.view}set(e){const i=e?.currentObject;if(!i){this.spectator.stopSpectating();return}i!==this.currentObject&&(this.currentObject=i,this.view=e,this.follow||(this.follow=$.addComponent(this.cam.gameObject,Ug)),this.target||(this.target=new Ae),i.add(this.target),this.follow.enabled=!0,this.follow.target=this.target,ac&&console.log("FOLLOW",i),this.context.isInXR?this.context.removeCamera(this.cam):this.context.setCurrentCamera(this.cam))}disable(){ac&&console.log("STOP FOLLOW",this.currentObject),this.view=void 0,this.currentObject=void 0,this.context.removeCamera(this.cam),this.follow&&(this.follow.enabled=!1)}destroy(){var e;(e=this.target)==null||e.removeFromParent(),this.follow&&$.destroy(this.follow)}update(e){var i,s,r,o,a,l;if(((i=this.currentTarget)==null?void 0:i.isConnected)===!1||((s=this.currentTarget)==null?void 0:s.removed)===!0){ac&&console.log("Target disconnected or timeout",this.currentTarget),this.spectator.stopSpectating();return}this.currentTarget&&((r=this.currentTarget)==null?void 0:r.currentObject)!==this.currentObject&&(ac&&console.log("Target changed",this.currentObject,"to",this.currentTarget.currentObject),this.set(this.currentTarget));const c=this.context.mainCamera;if(c){const d=this.cam.threeCamera;(d.near!==c.near||d.far!==c.far)&&(d.near=c.near,d.far=c.far,d.updateProjectionMatrix())}const h=(o=this.follow)==null?void 0:o.target;if(!(!h||!this.follow)){switch(e){case 0:((a=this.view)==null?void 0:a.viewDevice)!==ig.Browser?(this.follow.followFactor=5,this.follow.rotateFactor=5):(this.follow.followFactor=50,this.follow.rotateFactor=50),h.position.set(0,0,0);break;case 1:this.follow.followFactor=3,this.follow.rotateFactor=2,h.position.set(0,.5,1.5);break}this.follow.flipForward=!1,((l=this.view)==null?void 0:l.viewDevice)!==ig.Browser?h.quaternion.copy(c3e):h.quaternion.identity()}}}const c3e=new Fe().setFromAxisAngle(new E(0,1,0),Math.PI);class h3e{constructor(e,i){m(this,"context"),m(this,"spectator"),this.context=e,this.spectator=i,console.log("[Spectator Camera] Click other avatars or cameras to follow them. Press ESC to exit spectator mode."),this.context.domElement.addEventListener("keydown",r=>{!this.spectator.useKeys||r.key==="Escape"&&this.spectator.stopSpectating()});let s=0;this.context.input.addEventListener(rs.PointerDown,r=>{s=this.context.time.time}),this.context.input.addEventListener(rs.PointerUp,r=>{const o=this.context.time.time-s;o>1?this.spectator.stopSpectating():this.context.input.getPointerClicked(0)&&o<.3&&this.trySelectObject()})}trySelectObject(){const e=new Rd;e.setMask(16777215);const i=this.context.physics.raycast(e);if(ac&&console.log(...i),i!=null&&i.length)for(const s of i){if(s.distance<.2)continue;const r=s.object,o=$.getComponentInParent(r,Eo),a=o?.connectionId;if(a){const l=this.context.players.getPlayerView(a);this.spectator.target=l,ac&&console.log("spectate",a,o);break}}}}class d3e{constructor(e,i,s){m(this,"guid"),m(this,"dontSave",!0),m(this,"targetUserId"),m(this,"stoppedFollowing"),this.guid=e,this.targetUserId=i,this.stoppedFollowing=s}}class u3e{constructor(e,i){m(this,"guid"),m(this,"userId"),this.guid=e.guid,this.userId=i}}class p3e{constructor(e,i){m(this,"followers",[]),m(this,"context"),m(this,"spectator"),m(this,"_followerEventMethod"),m(this,"_requestFollowMethod"),m(this,"_joinedRoomMethod"),m(this,"_lastRequestFollowUser"),m(this,"_enforceFollowInterval"),this.context=e,this.spectator=i,this._followerEventMethod=this.onFollowerEvent.bind(this),this._requestFollowMethod=this.onRequestFollowEvent.bind(this),this._joinedRoomMethod=this.onUserJoinedRoom.bind(this)}awake(){this.context.connection.beginListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.beginListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.beginListen(pi.JoinedRoom,this._joinedRoomMethod),this.context.domElement.addEventListener("keydown",e=>{this.spectator.useKeys&&(e.key==="f"?this.onRequestFollowMe():e.key==="Escape"&&this.onRequestFollowMe(!0))})}destroy(){this.context.connection.stopListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.stopListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.stopListen(pi.JoinedRoom,this._joinedRoomMethod)}onSpectatedObjectChanged(e,i){if(ac&&console.log(this.context.connection.connectionId,"onSpectatedObjectChanged",e,i),this.context.connection.connectionId){const s=e?.userId===void 0,r=s?i:e?.userId,o=new d3e(this.context.connection.connectionId,r,s);this.context.connection.send("spectator-follower-changed",o)}}onRequestFollowMe(e=!1){if(ac&&console.log("Request follow",this.context.connection.connectionId),this.context.connection.connectionId){this.spectator.stopSpectating();const i=e?void 0:this.context.connection.connectionId,s=new u3e(this.spectator,i);this.context.connection.send("spectator-request-follow",s)}}onUserJoinedRoom(){q("followme")&&this.onRequestFollowMe()}onFollowerEvent(e){const i=e.targetUserId,s=e.guid;if(ac&&console.log(e),i===this.context.connection.connectionId)if(e.stoppedFollowing){const r=this.followers.indexOf(s);r!==-1&&(this.followers.splice(r,1),this.removeDisconnectedFollowers(),console.log(s,"unfollows you",this.followers.length))}else this.followers.includes(s)||(this.followers.push(s),this.removeDisconnectedFollowers(),console.log(s,"follows you",this.followers.length))}removeDisconnectedFollowers(){for(let e=this.followers.length-1;e>=0;e--){const i=this.followers[e];this.context.connection.userIsInRoom(i)===!1&&this.followers.splice(e,1)}}onRequestFollowEvent(e){if(this._lastRequestFollowUser=e,e.userId===this.context.connection.connectionId)this.spectator.stopSpectating();else if(e.userId===void 0)this.spectator.stopSpectating();else{const i=this.context.players.getPlayerView(e.userId);if(i)this.spectator.target=i;else return ac&&console.warn("Could not find view",e.userId),this.enforceFollow(),!1}return!0}enforceFollow(){this._enforceFollowInterval||(this._enforceFollowInterval=setInterval(()=>{this._lastRequestFollowUser===void 0||this._lastRequestFollowUser.userId&&this.spectator.isFollowedBy(this._lastRequestFollowUser.userId)?(clearInterval(this._enforceFollowInterval),this._enforceFollowInterval=void 0):(ac&&console.log("REQUEST FOLLOW AGAIN",this._lastRequestFollowUser.userId),this.onRequestFollowEvent(this._lastRequestFollowUser))},1e3))}}class gu{constructor(){m(this,"bb",null),m(this,"bb_pos",0)}__init(e,i){return this.bb_pos=e,this.bb=i,this}static getRootAsSyncedCameraModel(e,i){return(i||new gu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedCameraModel(e,i){return e.setPosition(e.position()+Q5),(i||new gu).__init(e.readInt32(e.position())+e.position(),e)}userId(e){const i=this.bb.__offset(this.bb_pos,4);return i?this.bb.__string(this.bb_pos+i,e):null}guid(e){const i=this.bb.__offset(this.bb_pos,6);return i?this.bb.__string(this.bb_pos+i,e):null}dontSave(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}pos(e){const i=this.bb.__offset(this.bb_pos,10);return i?(e||new Z0).__init(this.bb_pos+i,this.bb):null}rot(e){const i=this.bb.__offset(this.bb_pos,12);return i?(e||new Z0).__init(this.bb_pos+i,this.bb):null}static startSyncedCameraModel(e){e.startObject(5)}static addUserId(e,i){e.addFieldOffset(0,i,0)}static addGuid(e,i){e.addFieldOffset(1,i,0)}static addDontSave(e,i){e.addFieldInt8(2,+i,0)}static addPos(e,i){e.addFieldStruct(3,i,0)}static addRot(e,i){e.addFieldStruct(4,i,0)}static endSyncedCameraModel(e){return e.endObject()}static finishSyncedCameraModelBuffer(e,i){e.finish(i)}static finishSizePrefixedSyncedCameraModelBuffer(e,i){e.finish(i,void 0,!0)}}var m3e=Object.defineProperty,g3e=Object.getOwnPropertyDescriptor,f3e=(n,e,i,s)=>{for(var r=s>1?void 0:s?g3e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&m3e(e,i,r),r};const HB="SCAM";j5(HB,gu.getRootAsSyncedCameraModel);const lc=new $_;class A3e{constructor(e,i){m(this,"userId"),m(this,"guid"),this.guid=i,this.userId=e}send(e,i){if(e){lc.clear();const s=lc.createString(this.guid),r=lc.createString(this.userId);gu.startSyncedCameraModel(lc),gu.addGuid(lc,s),gu.addUserId(lc,r);const o=ri(e),a=ww(e);gu.addPos(lc,Z0.createVec3(lc,o.x,o.y,o.z)),gu.addRot(lc,Z0.createVec3(lc,a.x,a.y,a.z));const l=gu.endSyncedCameraModel(lc);lc.finish(l,HB),i.sendBinary(lc.asUint8Array())}}}var MO;const IO=(MO=class extends Oe{constructor(){super(...arguments),m(this,"cameraPrefab",null),m(this,"_lastWorldPosition"),m(this,"_lastWorldQuaternion"),m(this,"_model",null),m(this,"_needsUpdate",!0),m(this,"_lastUpdateTime",0),m(this,"remoteCams",{}),m(this,"userToCamMap",{}),m(this,"_camTimeoutInSeconds",10),m(this,"_receiveCallback",null)}getCameraObject(n){const e=this.userToCamMap[n];return e?this.remoteCams[e].obj:null}async awake(){this._lastWorldPosition=this.worldPosition.clone(),this._lastWorldQuaternion=this.worldQuaternion.clone(),this.cameraPrefab&&("uri"in this.cameraPrefab&&(this.cameraPrefab=await this.cameraPrefab.instantiate(this.gameObject)),this.cameraPrefab&&"isObject3D"in this.cameraPrefab&&(this.cameraPrefab.visible=!1))}onEnable(){this._receiveCallback=this.context.connection.beginListenBinary(HB,this.onReceivedRemoteCameraInfoBin.bind(this))}onDisable(){this.context.connection.stopListenBinary(HB,this._receiveCallback)}update(){for(const s in this.remoteCams){const r=this.remoteCams[s],o=this.context.time.realtimeSinceStartup-r.lastUpdate;if(!r||o>this._camTimeoutInSeconds){Je()&&console.log("Remote cam timeout",s),r!=null&&r.obj&&$.destroy(r.obj),delete this.remoteCams[s],r&&delete this.userToCamMap[r.userId],IO.instances.push(r),this.context.players.removePlayerView(r.userId,ig.Browser);continue}}if(this.context.isInXR)return;const n=this.context.mainCamera;if(n===null){this.enabled=!1;return}if(!this.context.connection.isConnected||this.context.connection.connectionId===null)return;this._model===null&&(this._model=new A3e(this.context.connection.connectionId,this.context.connection.connectionId+"_camera"));const e=ri(n),i=fn(n);(e.distanceTo(this._lastWorldPosition)>.001||i.angleTo(this._lastWorldQuaternion)>.01)&&(this._needsUpdate=!0),this._lastWorldPosition.copy(e),this._lastWorldQuaternion.copy(i),!((!this._needsUpdate||this.context.time.frameCount%2!==0)&&!(this.context.time.realtimeSinceStartup-this._lastUpdateTime>this._camTimeoutInSeconds*.5))&&(this._lastUpdateTime=this.context.time.realtimeSinceStartup,this._needsUpdate=!1,this._model.send(n,this.context.connection),this.context.isInXR||this.context.players.setPlayerView(this.context.connection.connectionId,n,ig.Browser))}onReceivedRemoteCameraInfoBin(n){const e=n.guid();if(!e)return;const i=n.userId();if(!i||!this.context.connection.userIsInRoom(i)||!this.cameraPrefab)return;let s=this.remoteCams[e];if(!s)if("isObject3D"in this.cameraPrefab){const l=new qh;l.context=this.context;const c=$.instantiate(this.cameraPrefab,l);s=this.remoteCams[e]={obj:c,lastUpdate:this.context.time.realtimeSinceStartup,userId:i},s.obj.visible=!0,this.gameObject.add(c),this.userToCamMap[i]=e,IO.instances.push(s);const h=$.getOrAddComponent(c,Eo);h.connectionId=i,h.avatar=c}else return;const r=s.obj;this.context.players.setPlayerView(i,r,ig.Browser),s.lastUpdate=this.context.time.realtimeSinceStartup,ih.markDirty(r);const o=n.pos();o&&o0(r,o.x(),o.y(),o.z());const a=n.rot();a&&Cw(r,a.x(),a.y(),a.z())}},m(MO,"instances",[]),MO);let QB=IO;f3e([T([Ae,Mi])],QB.prototype,"cameraPrefab",2);var y3e=Object.defineProperty,b3e=Object.getOwnPropertyDescriptor,Og=(n,e,i,s)=>{for(var r=s>1?void 0:s?b3e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&y3e(e,i,r),r};const TO="view",EO=q("debugsyncedroom");class Qh extends Oe{constructor(){super(...arguments),m(this,"roomName",""),m(this,"urlParameterName","room"),m(this,"joinRandomRoom"),m(this,"requireRoomParameter",!1),m(this,"autoRejoin",!0),m(this,"createJoinButton",!0),m(this,"createViewOnlyButton",!1),m(this,"_lastJoinedRoom"),m(this,"_roomPrefix",""),m(this,"_lastPingTime",0),m(this,"_lastRoomTime",-1),m(this,"_userWantsToBeInARoom",!1),m(this,"_roomButton"),m(this,"_roomButtonIconJoin"),m(this,"_roomButtonIconLeave"),m(this,"updateRoomButtonState",()=>{var e,i;this._roomButton&&(this.context.connection.isInRoom?(this._roomButton.title="Leave the networked room",this._roomButton.textContent="Leave Room",(e=this._roomButtonIconJoin)==null||e.remove(),this._roomButton.prepend(this._roomButtonIconLeave)):(this._roomButton.title="Create or join a networked room",this._roomButton.textContent="Join Room",(i=this._roomButtonIconLeave)==null||i.remove(),this._roomButton.prepend(this._roomButtonIconJoin)))}),m(this,"_viewOnlyButton"),m(this,"onCreateViewOnlyButton",()=>{if(!this._viewOnlyButton){const e=document.createElement("button");this._viewOnlyButton=e,e.classList.add("view-only-button"),e.setAttribute("priority","90"),e.onclick=()=>{var i;const s=this.getViewOnlyUrl();s!=null&&s.length?navigator.canShare({url:s})?(i=navigator.share({url:s}))==null||i.catch(r=>{console.warn(r)}):(navigator.clipboard.writeText(s),ss("View only URL copied to clipboard")):An("Could not create view only URL")},e.title="Copy the view only URL: A page accessed by the view only URL can not be modified by visiting users.",e.textContent="Share View URL",e.prepend(_o("visibility"))}this.context.menu.appendChild(this._viewOnlyButton)})}get currentRoomName(){return q(TO)||q(this.urlParameterName)}set roomPrefix(e){this._roomPrefix=e}get roomPrefix(){return this._roomPrefix}awake(){var e;this.joinRandomRoom===void 0&&((e=this.roomName)==null?void 0:e.length)<=0&&(this.joinRandomRoom=!0),EO&&console.log(`SyncedRoom roomName:${this.roomName}, urlParamName:${this.urlParameterName}, joinRandomRoom:${this.joinRandomRoom}`)}onEnable(){const e=q(TO);if(e&&typeof e=="string"&&e.length>0){console.log("Join as viewer"),this.context.connection.joinRoom(e,!0);return}if(this.tryJoinRoom(),this.createJoinButton){const i=this.createRoomButton();this.context.menu.appendChild(i)}this.createViewOnlyButton&&this.onEnableViewOnlyButton()}onDisable(){var e;(e=this._roomButton)==null||e.remove(),this.onDisableViewOnlyButton(),this.roomName&&this.roomName.length>0&&this.context.connection.leaveRoom(this.roomName)}onDestroy(){this.destroyRoomButton()}tryJoinRandomRoom(){this.setRandomRoomUrlParameter(),this.tryJoinRoom()}tryJoinRoom(e=0){var i;e===void 0&&(e=0);let s=!1;if(((i=this.urlParameterName)==null?void 0:i.length)>0){const r=q(this.urlParameterName);if(r&&(typeof r=="string"||typeof r=="number")){s=!0;const o=u6(r.toString());this.roomName=o}else if(this.joinRandomRoom&&(console.log("No room name found in url, generating random one"),this.setRandomRoomUrlParameter(),e<1))return this.tryJoinRoom(e+1)}else this.joinRandomRoom&&(this.roomName===null||this.roomName===void 0||this.roomName.length<=0)&&(this.roomName=this.generateRoomName());return this.requireRoomParameter&&!s?((EO||Je())&&console.warn('[SyncedRoom] Missing required room parameter "'+this.urlParameterName+`" in url - will not connect.
To allow joining a room without a query parameter you can set "requireRoomParameter" to false.`),!1):(this.context.connection.isConnected||this.context.connection.connect(),this._lastJoinedRoom=this.roomName,this._roomPrefix&&(this.roomName=this._roomPrefix+this.roomName),this.roomName.length<=0?(console.warn(`[SyncedRoom] Room name is not set so we can not join a networked room.
Please choose one of the following options to fix this:
A) Set a room name in the SyncedRoom component
B) Set a room name in the URL parameter "?`+this.urlParameterName+`=my_room"
C) Set "joinRandomRoom" to true`),!1):(EO&&console.log("Join "+this.roomName),this._userWantsToBeInARoom=!0,this.context.connection.joinRoom(this.roomName),!0))}update(){this.context.connection.isConnected&&(this.context.time.time-this._lastPingTime>3&&(this._lastPingTime=this.context.time.time,this.context.connection.sendPing()),this.context.connection.isInRoom&&(this._lastRoomTime=this.context.time.time)),this._lastRoomTime>0&&this.context.time.time-this._lastRoomTime>.3&&(this._lastRoomTime=-1,this.autoRejoin?this._userWantsToBeInARoom&&(console.log("Disconnected from networking backend - attempt reconnecting now"),this.tryJoinRoom()):Je()&&console.warn("You are not connected to a room anymore (possibly because the tab was inactive for too long and the server kicked you?)"))}getViewOnlyUrl(){if(this.context.connection.isConnected&&this.context.connection.currentRoomViewId){const e=window.location.search,i=new URLSearchParams(e);return i.has(this.urlParameterName)&&i.delete(this.urlParameterName),i.set(TO,this.context.connection.currentRoomViewId),window.location.origin+window.location.pathname+"?"+i.toString()}return null}setRandomRoomUrlParameter(){const e=pw(),i=this.generateRoomName();q(this.urlParameterName)?e.set(this.urlParameterName,i):e.append(this.urlParameterName,i),gX(i,e)}generateRoomName(){let e="";for(let i=0;i<6;i++)e+=Math.floor(Math.random()*10).toFixed(0);return e}createRoomButton(){if(this._roomButton)return this._roomButton;const e=document.createElement("button");return this._roomButton=e,e.classList.add("create-room-button"),e.setAttribute("priority","90"),e.onclick=()=>{if(this.context.connection.isInRoom)this.urlParameterName&&mw(this.urlParameterName,null),this.context.connection.leaveRoom(),this._userWantsToBeInARoom=!1;else{if(this.urlParameterName){const i=q(this.urlParameterName);(!i||i===!0)&&(this._lastJoinedRoom?mw(this.urlParameterName,this._lastJoinedRoom):this.setRandomRoomUrlParameter())}this.tryJoinRoom()}},this._roomButtonIconJoin=_o("group"),this._roomButtonIconLeave=_o("group_off"),this.updateRoomButtonState(),this.context.connection.beginListen(pi.JoinedRoom,this.updateRoomButtonState),this.context.connection.beginListen(pi.LeftRoom,this.updateRoomButtonState),e}destroyRoomButton(){this.context.connection.stopListen(pi.JoinedRoom,this.updateRoomButtonState),this.context.connection.stopListen(pi.LeftRoom,this.updateRoomButtonState)}onEnableViewOnlyButton(){this.context.connection.isConnected?this.onCreateViewOnlyButton():(this.context.connection.stopListen(pi.JoinedRoom,this.onCreateViewOnlyButton),this.context.connection.beginListen(pi.JoinedRoom,this.onCreateViewOnlyButton))}onDisableViewOnlyButton(){var e;this.context.connection.stopListen(pi.JoinedRoom,this.onCreateViewOnlyButton),(e=this._viewOnlyButton)==null||e.remove()}}Og([T()],Qh.prototype,"roomName",2),Og([T()],Qh.prototype,"urlParameterName",2),Og([T()],Qh.prototype,"joinRandomRoom",2),Og([T()],Qh.prototype,"requireRoomParameter",2),Og([T()],Qh.prototype,"autoRejoin",2),Og([T()],Qh.prototype,"createJoinButton",2),Og([T()],Qh.prototype,"createViewOnlyButton",2),Og([T()],Qh.prototype,"roomPrefix",1);function v3e(){const n=q("testwindowcount")||0;n&&n>0&&x3e(n)}function x3e(n){if(q("testwindow"))return null;const e=new URL(window.location.href);mX(e.searchParams,BVe,1),mX(e.searchParams,"testwindow",1);const i=e.toString(),s=[];window.onbeforeunload=()=>{for(const c of s)c.close()};const r=.05,o=128;let a=0,l=0;for(let c=0;c<n;c++){a*o+o*.01>=window.innerWidth&&(l+=1,a=0);const h=a*(o*(1+r))+window.screenLeft,d=l*(o*(1+r))+window.screenTop+90+60*l;a+=1;const u=window.open(i,"test window "+c,`popup=yes width=${o} height=${o} top=${d} left=${h}`);if(!u){console.warn("Failed to open window");continue}s.push(u),u.onload=()=>{u.onbeforeunload=()=>{for(let p=0;p<s.length;p++){const g=s[p];g!==u&&g.close()}s.length=0}}}return s}class RO extends Oe{awake(){v3e()}}class LO extends Oe{constructor(){super(...arguments),m(this,"transformsPerFrame",10),m(this,"interval",0),m(this,"useFlatbuffers",!0),m(this,"builder",null),m(this,"models",null)}awake(){if(this.useFlatbuffers)this.context.connection.beginListenBinary(eS,e=>{});else{this.models=[];for(let e=0;e<this.transformsPerFrame;e++)this.models.push(new Uoe(this.context.connection.connectionId+"_simulatedTransform_"+e,this))}}update(){if(this.context.connection.isConnected){if(this.useFlatbuffers){if(!this.context.connection.connectionId||this.context.time.frameCount%this.interval!==0)return;this.builder===null&&(this.builder=new $_(1024));const e=this.builder;for(let i=0;i<this.transformsPerFrame;i++){e.clear();const s=ise(this.context.connection.connectionId,this);this.context.connection.sendBinary(s)}}else if(this.models)for(let e=0;e<this.models.length;e++){const i=this.models[e];i.dontSave=!0,i.update(this,null),this.context.connection.send("TestSimulateUserData-"+e,i)}}}}class Uoe{constructor(e,i){m(this,"guid"),m(this,"fast",!1),m(this,"position"),m(this,"rotation"),m(this,"velocity"),m(this,"dontSave"),this.guid=e,this.position={x:0,y:0,z:0},this.rotation={x:0,y:0,z:0,w:0},this.update(i,null)}isValid(){return this.fast!==void 0||this.position!==void 0||this.rotation!==void 0||this.velocity!==void 0}update(e,i){const s=e.worldPosition;this.position.x=s.x,this.position.y=s.y,this.position.z=s.z;const r=e.worldQuaternion;if(this.rotation.x=r.x,this.rotation.y=r.y,this.rotation.z=r.z,this.rotation.w=r.w,this.fast=!1,i){const o=i.getVelocity();this.velocity===void 0&&(this.velocity={x:0,y:0,z:0}),this.velocity.x=o.x,this.velocity.y=o.y,this.velocity.z=o.z}}}m(Uoe,"temp",new E);var w3e=Object.defineProperty,C3e=Object.getOwnPropertyDescriptor,Jv=(n,e,i,s)=>{for(var r=s>1?void 0:s?C3e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&w3e(e,i,r),r};class du extends qr{constructor(){super(...arguments),m(this,"offset",new at(0)),m(this,"rotation",new at(0)),m(this,"focusArea",new at(.4)),m(this,"feather",new at(.3)),m(this,"kernelSize",new at(xd.MEDIUM)),m(this,"resolutionScale",new at(1/window.devicePixelRatio))}get typeName(){return"TiltShiftEffect"}init(){this.offset.defaultValue=0,this.rotation.defaultValue=0,this.focusArea.defaultValue=.4,this.feather.defaultValue=.3,this.kernelSize.defaultValue=xd.MEDIUM,this.resolutionScale.defaultValue=1/window.devicePixelRatio}onCreateEffect(){const e=new d7({kernelSize:xd.VERY_LARGE,offset:this.offset.value,rotation:this.rotation.value,focusArea:this.focusArea.value,feather:this.feather.value});return this.offset.onValueChanged=i=>e.offset=i,this.rotation.onValueChanged=i=>e.rotation=i,this.focusArea.onValueChanged=i=>e.focusArea=i,this.feather.onValueChanged=i=>e.feather=i,this.kernelSize.onValueChanged=i=>e.blurPass.kernelSize=i,this.resolutionScale.onValueChanged=i=>e.resolution.scale=i/window.devicePixelRatio,e}}Jv([T(at)],du.prototype,"offset",2),Jv([T(at)],du.prototype,"rotation",2),Jv([T(at)],du.prototype,"focusArea",2),Jv([T(at)],du.prototype,"feather",2),Jv([T(at)],du.prototype,"kernelSize",2),Jv([T(at)],du.prototype,"resolutionScale",2),Uc("TiltShiftEffect",du);var S3e=Object.defineProperty,_3e=Object.getOwnPropertyDescriptor,KB=(n,e,i,s)=>{for(var r=s>1?void 0:s?_3e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&S3e(e,i,r),r};class AA extends Oe{constructor(){super(...arguments),m(this,"isGizmo",!1),m(this,"translationSnap",1),m(this,"rotationSnapAngle",15),m(this,"scaleSnap",.25),m(this,"control"),m(this,"orbit"),m(this,"onControlChangedEvent",e=>{const i=this.orbit;if(i&&(i.enabled=!e.value),e.value){const s=$.getComponentInParent(this.gameObject,Vd);s&&s.requestOwnership()}}),m(this,"windowKeyDownListener",e=>{if(this.enabled&&this.control)switch(e.keyCode){case 81:this.control.setSpace(this.control.space==="local"?"world":"local");break;case 16:this.enableSnapping();break;case 87:this.control.setMode("translate");break;case 69:this.control.setMode("rotate");break;case 82:this.control.setMode("scale");break;case 187:case 107:this.control.setSize(this.control.size+.1);break;case 189:case 109:this.control.setSize(Math.max(this.control.size-.1,.1));break;case 88:this.control.showX=!this.control.showX;break;case 89:this.control.showY=!this.control.showY;break;case 90:this.control.showZ=!this.control.showZ;break;case 32:this.control.enabled=!this.control.enabled;break}}),m(this,"windowKeyUpListener",e=>{if(this.enabled)switch(e.keyCode){case 16:this.disableSnapping();break}})}onEnable(){var e;if(!(this.isGizmo&&!_C)&&this.context.mainCamera&&(this.control||(this.control=new fke(this.context.mainCamera,this.context.renderer.domElement),this.control.enabled=!0,this.control.getRaycaster().layers.set(2),this.control.size=1,("_root"in this.control?this.control._root:this.control).traverse(i=>{const s=i;if(s.layers.set(2),s){const r=s.material;r&&(r.opacity=.3)}}),this.orbit=$.getComponentInParent(this.context.mainCamera,ln)??void 0),this.control)){const i=this.control.getHelper();this.context.scene.add(i),this.control.attach(this.gameObject),(e=this.control)==null||e.addEventListener("dragging-changed",this.onControlChangedEvent),window.addEventListener("keydown",this.windowKeyDownListener),window.addEventListener("keyup",this.windowKeyUpListener)}}onDisable(){var e,i,s;(i=(e=this.control)==null?void 0:e.getHelper())==null||i.removeFromParent(),(s=this.control)==null||s.removeEventListener("dragging-changed",this.onControlChangedEvent),window.removeEventListener("keydown",this.windowKeyDownListener),window.removeEventListener("keyup",this.windowKeyUpListener)}enableSnapping(){this.control&&(this.control.setTranslationSnap(this.translationSnap),this.control.setRotationSnap(Di.degToRad(this.rotationSnapAngle)),this.control.setScaleSnap(this.scaleSnap))}disableSnapping(){this.control&&(this.control.setTranslationSnap(null),this.control.setRotationSnap(null),this.control.setScaleSnap(null))}}KB([T()],AA.prototype,"isGizmo",2),KB([T()],AA.prototype,"translationSnap",2),KB([T()],AA.prototype,"rotationSnapAngle",2),KB([T()],AA.prototype,"scaleSnap",2);var M3e=Object.defineProperty,I3e=Object.getOwnPropertyDescriptor,BO=(n,e,i,s)=>{for(var r=s>1?void 0:s?I3e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&M3e(e,i,r),r};class yA extends qr{constructor(){super(...arguments),m(this,"color",new at({r:0,g:0,b:0,a:1})),m(this,"intensity",new at(0)),m(this,"center",new at({x:.5,y:.5}))}get typeName(){return"Vignette"}init(){this.color.defaultValue={r:0,g:0,b:0,a:1},this.intensity.defaultValue=0,this.center.defaultValue={x:.5,y:.5}}onCreateEffect(){const e=new u7;return this.intensity.onValueChanged=i=>{e.offset=i,this.updateDarkness(e)},this.color.onValueChanged=i=>{this.updateDarkness(e)},e}updateDarkness(e){const i=this.intensity.value;e.darkness=i}}BO([T(at)],yA.prototype,"color",2),BO([T(at)],yA.prototype,"intensity",2),BO([T(at)],yA.prototype,"center",2),Uc("Vignette",yA);var T3e=Object.defineProperty,E3e=Object.getOwnPropertyDescriptor,R3e=(n,e,i,s)=>{for(var r=s>1?void 0:s?E3e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&T3e(e,i,r),r};const YB=q("debugpost");class qv extends Oe{constructor(){super(...arguments),m(this,"sharedProfile"),m(this,"_postprocessing"),m(this,"_activeEffects",[]),m(this,"_effects",[]),m(this,"_lastApplyTime"),m(this,"_rapidApplyCount",0),m(this,"_isDirty",!1),m(this,"_modificationQueue"),m(this,"_recreateId",-1)}get isPostProcessingManager(){return!0}get effects(){return this._activeEffects}addEffect(e){let i=e;return i instanceof Ia&&(i=new HS(i)),this._effects.includes(i)||(this._effects.push(i),this._isDirty=!0),e}removeEffect(e){var i,s,r,o;let a=-1;if(e instanceof Ia?a=this._effects.findIndex(l=>l instanceof HS&&l.effect===e):a=this._effects.indexOf(e),a!==-1)return this._effects.splice(a,1),this._isDirty=!0,e;if(e instanceof qr){const l=(s=(i=this.sharedProfile)==null?void 0:i.components)==null?void 0:s.indexOf(e);l!==void 0&&l!==-1&&(this._isDirty=!0,(o=(r=this.sharedProfile)==null?void 0:r.components)==null||o.splice(l,1))}return e}markDirty(){this._isDirty=!0}awake(){var e;YB&&(console.log("PostprocessingManager Awake",this),console.log("Press P to toggle post processing"),window.addEventListener("keydown",i=>{i.key==="p"&&(this.enabled=!this.enabled,ss("Toggle PostProcessing "+this.name+": Enabled="+this.enabled),this.markDirty())})),(e=this.sharedProfile)==null||e.init()}onEnable(){this._isDirty=!0}onDisable(){var e;(e=this._postprocessing)==null||e.unapply(),this._isDirty=!1}onBeforeRender(){var e;if(!this.context.isInXR){if(this.context.composer&&!(this.context.composer instanceof vD)){YB&&console.warn("PostProcessing: The current composer is not an EffectComposer - this is not supported");return}if(this.context.mainCamera&&this._isDirty&&this.apply(),this.context.composer&&((e=this._postprocessing)==null?void 0:e.composer)===this.context.composer&&(this.context.renderer.getContext().isContextLost()&&this.context.renderer.forceContextRestore(),this.context.composer.getRenderer()!==this.context.renderer&&this.context.composer.setRenderer(this.context.renderer),this.context.composer.setMainScene(this.context.scene),this.context.mainCamera)){const i=this.context.composer.passes;for(const s of i)if(s.mainCamera&&s.mainCamera!==this.context.mainCamera){this.context.composer.setMainCamera(this.context.mainCamera);break}}}}onDestroy(){var e;(e=this._postprocessing)==null||e.dispose()}apply(){var e;if(YB&&console.log("Apply PostProcessing "+this.name),Je()&&(this._lastApplyTime!==void 0&&Date.now()-this._lastApplyTime<100&&(this._rapidApplyCount++,this._rapidApplyCount===5&&console.warn("Detected rapid post processing modifications - this might be a bug",this)),this._lastApplyTime=Date.now()),this._isDirty=!1,this.unapply(),this._activeEffects.length=0,(e=this.sharedProfile)!=null&&e.components){const i=this.sharedProfile.components;for(const s of i)s.active&&!this._activeEffects.includes(s)&&this._activeEffects.push(s)}for(const i of this._effects)i.active&&!this._activeEffects.includes(i)&&this._activeEffects.push(i);YB&&console.log("Apply PostProcessing",this._activeEffects),this._activeEffects.length>0&&(this._postprocessing||(this._postprocessing=new zB(this.context)),this._postprocessing.apply(this._activeEffects),this._applyPostQueue())}unapply(){var e;(e=this._postprocessing)==null||e.unapply()}_applyPostQueue(){if(this._modificationQueue){for(const e of this._modificationQueue.values())this.onEditorModification(e);this._modificationQueue.clear()}}onEditorModification(e){var i,s;if(e.propertyName.startsWith("postprocessing.")){if(!this._postprocessing)return this._modificationQueue||(this._modificationQueue=new Map),this._modificationQueue.set(e.propertyName,e),!0;if(!((i=this._activeEffects)!=null&&i.length))return;const r=e.propertyName.split(".");if(r.length===3||r.length===4){const o=r[1],a=r[2];for(const l of this._activeEffects)if(((s=l.typeName)==null?void 0:s.toLowerCase())===o.toLowerCase()){if(a==="active"){l.active=e.value,this.scheduleRecreate();return}if(!jB.has(o)){const c=new Array;jB.set(o,c);const h=Object.keys(l);for(const d of h)l[d]instanceof at&&c.push(d)}if(jB.has(o)){const c=a.toLowerCase(),h=jB.get(o);for(const d of h)if(d.toLowerCase()===c){const u=l[d];u instanceof at&&(r.length===4&&r[3]==="active"?(u.overrideState=e.value,this.scheduleRecreate()):u&&u.value!==void 0&&(u.value=e.value));return}}console.warn("Unknown modification",a);return}}return!0}return!1}scheduleRecreate(){const e=++this._recreateId;setTimeout(()=>{e===this._recreateId&&(this.onDisable(),this.onEnable())},200)}}R3e([lv(dS)],qv.prototype,"sharedProfile",2);const jB=new Map;KNe(qv);function Ooe(n,e){const i=n.xr.getFrame();if(!i)return console.warn("No XRFrame available"),!1;const s=i.session.enabledFeatures;if(s&&!s.some(o=>o==="camera-access"))return console.error(`No camera feed available - please request the 'camera-access' feature before starting WebXR or add the ARCameraBackground component to your scene.

Example to request camera-access in global scope:
NeedleXRSession.onSessionRequestStart(evt => {
    evt.init.optionalFeatures = evt.init.optionalFeatures || [];
    evt.init.optionalFeatures.push('camera-access');
});
`),Je()&&Mw("No camera feed available - please request the 'camera-access' feature before starting WebXR or add the ARCameraBackground component to your scene"),!1;const r=i.getViewerPose(n.xr.getReferenceSpace());if(r)for(const o of r.views)if("camera"in o&&o.camera){let a=n.xr.getBinding();if(a||(a=new XRWebGLBinding(i.session,n.getContext())),a){let l=null;if("getCameraImage"in a){L3e(n,e);const c=n.properties.get(e);if(c)return l=a.getCameraImage(o.camera),c.__webglTexture=l,!0;console.warn("No texture properties found for target texture")}}else console.error(o.camera,n.xr)}else console.error("NO CAMERA IN VIEW");else console.error(n.xr.getReferenceSpace(),i);return!1}const Zoe=new WeakMap;function L3e(n,e){const i=Zoe.get(e)||new WeakSet;if(i.has(n))return;i.add(n),Zoe.set(e,i),console.debug("Initialize texture for camera feed");const s=new ai,r=new Xs,o=new ir;o.add(new pe(r,s));const a=new Ot;s.map=e,n.render(o,a)}function B3e(n,e,i,s="image/webp",r){return kO({context:n,width:e,height:i,mimeType:s,camera:r})}function kO(n){var e,i;n||(n={});const{transparent:s=!1}=n;let{mimeType:r,context:o,width:a,height:l,camera:c}=n;if(!o&&(o=ji.Current,!o))return console.error("Can not save screenshot: No needle-engine context found or provided."),null;if(!c&&(c=o.mainCamera,!c))return console.error("No camera found"),null;const h=o.renderer,d=h.xr.enabled;if(d&&o.currentFrameEvent!=_n.EarlyUpdate)return console.warn("Screenshot: defer to access XR frame"),new Promise(_=>{qu(I=>{const B=kO(n);_(B)},_n.EarlyUpdate,{once:!0})});const u=h.domElement,p=u.width,g=u.height;a||(a=p),l||(l=g);const f=a,A=l,y=window.devicePixelRatio||1;a/=y,l/=y,h.xr.isPresenting&&h.xr.getFrame();const b=h.xr.enabled;h.xr.enabled=!1,h.xr.isPresenting=!1,u.style.width=`${a}px`,u.style.height=`${l}px`;const v=h.getRenderTarget(),x=h.getClearColor(new fe),w=h.getClearAlpha(),C=o.scene.background,S="aspect"in c?c.aspect:null;try{const _=n.render_events!==!1,I=new Array;_&&(Hb(o.scene,Gs,I),I.forEach(G=>{var X;if(G?.onBeforeRender(),G.isInstancingActive&&G.instances)for(let F=0;F<((X=G.instances)==null?void 0:X.length);F++){const z=G.instances[F];rp(z.object,!0)}})),s&&(o.scene.background=null,h.setClearColor(0,0)),n.background&&(o.scene.background=null,h.setClearColor(n.background),n.background instanceof pn&&h.setClearAlpha(n.background.a)),s&&h.setClearAlpha(0),h.setSize(a,l,!1),"cam"in c&&(c=c.threeCamera),c instanceof Ot&&(c.aspect=a/l,c.updateProjectionMatrix());const B="type"in n&&n.type==="texture";let M=null;B&&(M=new fi(a,l,{wrapS:bu,wrapT:bu,format:1023}),h.setRenderTarget(M));let R=u;if(d?(M&&console.error('Taking XR screenshots with { type: "texture" } is currently not supported.'),R=b_.compositeWithCameraImage({width:f,height:A,scene:o.scene,camera:c,renderer:h})):o.renderNow(c||null),c instanceof Ot&&S!=null&&(c.aspect=S,c.updateProjectionMatrix()),_&&I.forEach(G=>G.onAfterRender()),!r&&"download_filename"in n&&n.download_filename)switch((e=n.download_filename.split(".").pop())==null?void 0:e.toLowerCase()){case"png":r="image/png";break;case"jpg":case"jpeg":r="image/jpeg";break;case"webp":r="image/webp";break}if(s&&n.trim===!0){const G=k3e(R);G&&(R=G)}if("type"in n){if(n.type==="texture")return M?(n.target&&(n.target.image=M?.texture.image,n.target.needsUpdate=!0),M.texture.offset.set(0,-1),M.texture.needsUpdate=!0,M.texture):(console.error("No target texture found"),null);if(n.type==="blob")return new Promise((G,X)=>{R.toBlob(F=>{G(F)},r)});if(n.type==="share")return new Promise((G,X)=>{R.toBlob(F=>{if(F&&"share"in navigator){let z="file_type"in n&&n.file_type||r;r||(z="image/png");const H=z?.split("/")[1]||"png",Z=new File([F],"filename"in n?n.filename||`screenshot.${H}`:`screenshot.${H}`,{type:z});return navigator.share({title:"title"in n?n.title:void 0,text:"text"in n?n.text:void 0,url:"url"in n?n.url:void 0,files:[Z]}).catch(he=>{console.warn("User cancelled share",he.message)}).finally(()=>{G({blob:F,shared:!0})})}return{blob:F,shared:!1}},r)})}const k=R.toDataURL(r);if("download_filename"in n&&n.download_filename){let G=n.download_filename;const X=(i=G.split(".").pop())==null?void 0:i.toLowerCase();G=`${G}-${Date.now()}.${X}`,Woe(k,G)}return k}finally{h.setRenderTarget(v),o.scene.background=C,h.setSize(p,g,!1),h.setClearColor(x,w),S!=null&&c instanceof Ot&&(c.aspect=S,c.updateProjectionMatrix()),h.xr.enabled=b,h.xr.isPresenting=d,d||o.updateSize(!0)}return null}function k3e(n){if(!("document"in globalThis))return null;const e=document.createElement("canvas");e.width=n.width,e.height=n.height;const i=e.getContext("2d");if(!i)return null;i.drawImage(n,0,0);const s=e.width,r=e.height,o=i.getImageData(0,0,s,r).data;let a=r,l=s,c=0,h=0;for(let f=0;f<r;f++)for(let A=0;A<s;A++){const y=(f*s+A)*4;o[y+3]!==0&&(A<l&&(l=A),A>h&&(h=A),f<a&&(a=f),f>c&&(c=f))}const d=h-l+1,u=c-a+1,p=document.createElement("canvas"),g=p.getContext("2d");return g?(p.width=d,p.height=u,g.drawImage(e,l,a,d,u,0,0,d,u),p):null}let y_=null;function Woe(n,e){if(n){if(!n.startsWith("data:image")){console.error("Can not save image: Data url is not an image",n);return}y_||(y_=document.createElement("a")),y_.href=n,y_.download=e,y_.click()}}var b_;(n=>{let e=null,i=null,s=null,r=null,o=null;function a(h){const{renderer:d,width:u,height:p}=h,g=d.xr.enabled,f=d.getRenderTarget(),A=d.autoClear,y=u,b=p,v=u/p;(!s||s.width!==y||s.height!==b)&&(s??(s=new fi(y,b,{colorSpace:ut})),s.width=y,s.height=b,s.samples=4,s.texture.repeat.y=-1,s.texture.offset.y=1),(!o||o.width!==y||o.height!==b)&&(o=document.createElement("canvas"),o.width=y,o.height=b,o.style.position="fixed",o.style.top="0px",o.style.right="0px",o.style.width="300px",o.style.height=`${300/v}px`,o.style.zIndex="1000",o.style.pointerEvents="none",o.style.opacity="1.0",o.style.willChange="contents"),e||(e=c({defines:{DECODE_VIDEO_TEXTURE:!0}})),i||(i=c()),r||(r=new di),d.xr.updateCamera(h.camera),d.xr.enabled=!1,d.autoClear=!1,d.clear(),d.setSize(y,b),d.setRenderTarget(s),Ooe(h.renderer,r)||console.error("Could not update texture from XR frame");const x=$.findObjectOfType(v_);return x?x.setTexture(r):(e.setTexture(r),d.render(e,h.camera)),d.clearDepth(),d.setSize(y,b),d.render(h.scene,h.camera),d.setRenderTarget(null),i.setTexture(s.texture),d.render(i,h.camera),o.getContext("2d",{alpha:!1}).drawImage(d.domElement,0,0,o.width,o.height),d.setRenderTarget(f),d.xr.enabled=g,d.autoClear=A,o}n.compositeWithCameraImage=a;const l=`
uniform sampler2D t2D;
varying vec2 vUv;

void main() {

    vec4 texColor = texture2D( t2D, vUv );

    #ifdef DECODE_VIDEO_TEXTURE

        // inline sRGB decode (TODO: Remove this code when https://crbug.com/1256340 is solved)
        texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );

    #endif

    gl_FragColor = texColor;
    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`;function c(h){const d=h?.material||new jt({name:"BackgroundMaterial",uniforms:Ay.clone(Wn.background.uniforms),vertexShader:Wn.background.vertexShader,fragmentShader:l,defines:h?.defines,side:ms,depthTest:!1,depthWrite:!1,fog:!1});Object.defineProperty(d,"map",{get:function(){return this.threeTexture}});const u=new pe(new Xs(2,2),d);return u.geometry.deleteAttribute("normal"),u.renderOrder=-1e6,u.setTexture=function(p){d.uniforms.t2D.value=p},u}n.makeFullscreenPlane=c})(b_||(b_={}));var G3e=Object.defineProperty,P3e=Object.getOwnPropertyDescriptor,N3e=(n,e,i,s)=>{for(var r=s>1?void 0:s?P3e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&G3e(e,i,r),r};const Hoe=q("debugarcamera");class v_ extends Oe{constructor(){super(...arguments),m(this,"backgroundTint",new pn(1,1,1,1)),m(this,"backgroundPlane"),m(this,"threeTexture"),m(this,"forceTextureInitialization",function(){const e=new ai,i=new Xs,s=new ir;s.add(new pe(i,e));const r=new Ot;return function(o,a){e.map=a,o.render(s,r),Hoe&&console.warn("Force texture initialization")}}()),m(this,"preRender",()=>{if(!(!this||!this.gameObject)&&this.context.renderer.xr.getFrame()){if(!this.threeTexture&&this.context.renderer&&(this.threeTexture=new di,this.forceTextureInitialization(this.context.renderer,this.threeTexture)),this.backgroundPlane===void 0){const e=this.backgroundTint;this.backgroundPlane=b_.makeFullscreenPlane({material:new jt({name:"BackgroundMaterial",uniforms:{...Ay.clone(Wn.background.uniforms),tint:{value:new $e(e.r,e.g,e.b,e.a)}},vertexShader:Wn.background.vertexShader,fragmentShader:V3e,side:Qi,depthTest:!1,depthWrite:!1,fog:!1})})}this.backgroundPlane.parent!==this.scene&&this.scene.add(this.backgroundPlane),this.backgroundPlane.material instanceof jt&&this.backgroundPlane.material.uniforms.tint.value.set(this.backgroundTint.r,this.backgroundTint.g,this.backgroundTint.b,this.backgroundTint.a),this.updateFromFrame()}})}onBeforeXR(e,i){e==="immersive-ar"&&(i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.push("camera-access"),Hoe&&console.warn("Requesting camera-access"))}onEnterXR(e){e.xr.mode==="immersive-ar"&&(this.backgroundPlane&&(this.context.scene.add(this.backgroundPlane),this.backgroundPlane.visible=!1),this.backgroundPlane&&this.context.scene.add(this.backgroundPlane),this.context.pre_render_callbacks.push(this.preRender))}onLeaveXR(e){this.backgroundPlane&&this.backgroundPlane.removeFromParent();const i=this.context.pre_render_callbacks.indexOf(this.preRender);i>=0&&this.context.pre_render_callbacks.splice(i,1)}get background(){return this.backgroundPlane}onBeforeRender(e){this.updateFromFrame()}updateFromFrame(){var e;this.threeTexture&&((e=this.context.xr)==null?void 0:e.mode)==="immersive-ar"&&(Ooe(this.context.renderer,this.threeTexture),this.setTexture(this.threeTexture))}setTexture(e){this.backgroundPlane&&(this.threeTexture=e,this.backgroundPlane.setTexture(this.threeTexture),this.backgroundPlane.visible=!0)}}N3e([T(pn)],v_.prototype,"backgroundTint",2);const V3e=`
uniform sampler2D t2D;
uniform vec4 tint;

varying vec2 vUv;

void main() {

    vec4 texColor = texture2D( t2D, vUv );
    texColor.w = 1.0;

    // inline sRGB decode
    texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );

    gl_FragColor = texColor * tint;

    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`;var X3e=Object.defineProperty,D3e=Object.getOwnPropertyDescriptor,bA=(n,e,i,s)=>{for(var r=s>1?void 0:s?D3e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&X3e(e,i,r),r};const Qoe=q("debugimagetracking"),GO=class{constructor(n,e,i,s,r,o){m(this,"measuredSize"),m(this,"state"),m(this,"_position"),m(this,"_rotation"),m(this,"_trackingComponent"),m(this,"_trackedImage"),m(this,"_bitmap"),m(this,"_pose"),this._trackingComponent=n,this._trackedImage=e,this._bitmap=i,this.measuredSize=s,this.state=r,this._pose=o}get url(){return this._trackedImage.image??""}get widthInMeters(){return this._trackedImage.widthInMeters??void 0}get bitmap(){return this._bitmap}get model(){return this._trackedImage}getPosition(n){return this.ensureTransformData(),n.copy(this._position),n}getQuaternion(n){return this.ensureTransformData(),n.copy(this._rotation),n}applyToObject(n,e=void 0){this.ensureTransformData();const i=n.position.distanceToSquared(this._position)/.05+n.quaternion.angleTo(this._rotation)/.05;e&&(e*=Math.max(1,i)),e===void 0||e>=1?(n.position.copy(this._position),n.quaternion.copy(this._rotation)):(e=Math.max(0,Math.min(1,e)),n.position.lerp(this._position,e),n.quaternion.slerp(this._rotation,e))}ensureTransformData(){if(!this._position){this._position=GO._positionBuffer.get(),this._rotation=GO._rotationBuffer.get();const n=this._pose.transform,e=Qt.active.convertSpace(n);this._position.copy(e?.position),this._rotation.copy(e?.quaternion)}}};let $v=GO;m($v,"_positionBuffer",new El(()=>new E,20)),m($v,"_rotationBuffer",new El(()=>new Fe,20));class uu{constructor(){m(this,"image"),m(this,"widthInMeters",.25),m(this,"object"),m(this,"createObjectInstance",!1),m(this,"imageDoesNotMove",!1),m(this,"hideWhenTrackingIsLost",!0)}}bA([T(URL)],uu.prototype,"image",2),bA([T()],uu.prototype,"widthInMeters",2),bA([T(Mi)],uu.prototype,"object",2),bA([T()],uu.prototype,"createObjectInstance",2),bA([T()],uu.prototype,"imageDoesNotMove",2),bA([T()],uu.prototype,"hideWhenTrackingIsLost",2);class z3e{constructor(e,i,s){m(this,"filename"),m(this,"widthInMeters"),m(this,"imageData"),this.filename=e,this.imageData=i,this.widthInMeters=s}get extensionName(){return"image-tracking"}onAfterHierarchy(e,i){i.beginBlock('def Preliminary_ReferenceImage "AnchoringReferenceImage"'),i.appendLine("uniform asset image = @image_tracking/"+this.filename+"@"),i.appendLine("uniform double physicalWidth = "+(this.widthInMeters*100).toFixed(8)),i.closeBlock()}onBeforeBuildDocument(e){const i=$.findObjectOfType(ex);!i||!i.trackedImages||i.trackedImages.length>1&&(Je()&&An("USDZ: Only one tracked image is supported."),console.warn("USDZ: Only one tracked image is supported."))}onAfterSerialize(e){e.files["image_tracking/"+this.filename]=this.imageData}onExportObject(e,i,s){var r;const o=$.findObjectOfType(ex);if(!(!o||!o.trackedImages)){for(const a of o.trackedImages)if(((r=a.object)==null?void 0:r.asset)===e){const l=$.findObjectOfType(Ms);if(!l)continue;const{scale:c,target:h}=l.getARScaleAndTarget();let d=e;const u=new de;if(e!==h)for(;d.parent&&d.parent!==h;)d=d.parent,u.premultiply(d.matrix);const p=u.clone().invert();i.setMatrix(p.scale(new E(c,c,c)));break}}}}var PO;const x_=(PO=class extends Oe{constructor(){super(...arguments),m(this,"trackedImages"),m(this,"smooth",!0),m(this,"trackedImageIndexMap",new Map),m(this,"imageToObjectMap",new Map),m(this,"currentImages",[]),m(this,"onImageTrackingUpdate",n=>{const e=Qt.active;if(e)for(const i of n){const s=i.model,r=i.state==="tracked";if(!s.object)continue;let o=this.imageToObjectMap.get(s);if(o===void 0)o={object:null,frames:0,lastTrackingTime:Date.now()},this.imageToObjectMap.set(s,o),s.object.loadAssetAsync().then(a=>{if(s.createObjectInstance&&a&&(a=$.instantiate(a)),a){o.object=a;for(const l of a.getComponentsInChildren(Gs))l.setInstancingEnabled(!1);e.rig?(e.rig.gameObject.add(a),i.applyToObject(a),a.activeSelf||$.setActive(a,!0)):console.warn("XRImageTracking: missing XRRig")}});else{if(o.frames++,r&&(o.lastTrackingTime=Date.now()),s.imageDoesNotMove&&o.frames>10||!o.object)continue;e.rig&&(e.rig.gameObject.add(o.object),i.applyToObject(o.object,this.smooth?this.context.time.deltaTimeUnscaled*3:void 0),o.object.activeSelf||$.setActive(o.object,!0))}}})}awake(){if(Qoe&&console.log(this),!!this.trackedImages){for(const n of this.trackedImages)if(n.image&&!x_._imageElements.has(n.image)){const e=n.image;x_._imageElements.set(e,null);const i=document.createElement("img");i.src=e,i.addEventListener("load",async()=>{const s=await createImageBitmap(i);x_._imageElements.set(e,s);const r=await Lne(s);if(r){const o=await(await r.convertToBlob({type:"image/png"})).arrayBuffer(),a=$.findObjectOfType(Ms);a&&this.trackedImages&&(a.extensions.push(new z3e("marker.png",new Uint8Array(o),this.trackedImages[0].widthInMeters)),a.anchoringType="image")}})}}}onBeforeXR(n,e){var i;if(this.trackedImages){e.optionalFeatures=e.optionalFeatures||[],e.optionalFeatures.includes("image-tracking")||e.optionalFeatures.push("image-tracking"),e.trackedImages=[];for(const s of this.trackedImages)if((i=s.image)!=null&&i.length&&s.widthInMeters>0){const r=x_._imageElements.get(s.image);r&&(this.trackedImageIndexMap.set(e.trackedImages.length,s),e.trackedImages.push({image:r,widthInMeters:s.widthInMeters}))}}}onEnterXR(n){var e;if(this.trackedImages){for(const i of this.trackedImages)if((e=i.object)!=null&&e.asset){const s=i.object.asset;s.userData||(s.userData={});const r={visible:s.visible,parent:s.parent,matrix:s.matrix.clone()};s.userData["image-tracking"]=r}}for(const i of this.imageToObjectMap.values())i.frames=0}onLeaveXR(n){var e,i;if(this.trackedImages){for(const s of this.trackedImages)if((e=s.object)!=null&&e.asset){const r=s.object.asset;if(r.userData){const o=r.userData["image-tracking"];o&&(r.visible=o.visible,(i=o.parent)==null||i.add(r),r.matrix.copy(o.matrix),r.matrix.decompose(r.position,r.quaternion,r.scale)),delete r.userData["image-tracking"]}}}}onUpdateXR(n){var e;this.currentImages.length=0;const i=n.xr.frame;if(!i)return;if("getImageTrackingResults"in i){if(((e=n.xr.session.enabledFeatures)==null?void 0:e.includes("image-tracking"))===!1)return;if(i.session&&typeof i.getImageTrackingResults=="function"){const r=i.getImageTrackingResults();if(r.length>0){const o=this.context.renderer.xr.getReferenceSpace();if(o){for(const a of r){const l=a.trackingState,c=a.index,h=this.trackedImageIndexMap.get(c);if(h){const d=i.getPose(a.imageSpace,o),u=new $v(this,h,a.image,a.measuredSize,l,d);this.currentImages.push(u)}else Qoe&&console.warn("No tracked image for index",c)}if(this.currentImages.length>0)try{this.dispatchEvent(new CustomEvent("image-tracking",{detail:this.currentImages})),this.onImageTrackingUpdate(this.currentImages)}catch(a){console.error(a)}}}}}else{const r=`Image tracking is currently not supported on this device. On Chrome for Android, you can enable the <a target="_blank" href="#" onclick="() => console.log('I')">chrome://flags/#webxr-incubations</a> flag.`;this.didPrintWarning||(this.didPrintWarning=!0,console.log(r)),An(r);return}const s=1e3;for(const[r,o]of this.imageToObjectMap){if(!o.object||!r||r.hideWhenTrackingIsLost===!1)continue;let a=!1;for(const l of this.currentImages)if(l.model===r){const c=Date.now()-o.lastTrackingTime;if(r.imageDoesNotMove||l.state==="tracked"||c<=s){a=!0;break}}a||$.setActive(o.object,!1)}}},m(PO,"_imageElements",new Map),PO);let ex=x_;bA([T(uu)],ex.prototype,"trackedImages",2);const w_=new E,C_=new E,Koe=new oi;class F3e extends Jo{constructor(e,i=1,s=16711680){const r=new Rt,o=e.geometry.attributes.normal.count,a=new dt(o*2*3,3);r.setAttribute("position",a),super(r,new Cn({color:s,toneMapped:!1})),this.object=e,this.size=i,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0),Koe.getNormalMatrix(this.object.matrixWorld);const e=this.object.matrixWorld,i=this.geometry.attributes.position,s=this.object.geometry;if(s){const r=s.attributes.position,o=s.attributes.normal;let a=0;for(let l=0,c=r.count;l<c;l++)w_.fromBufferAttribute(r,l).applyMatrix4(e),C_.fromBufferAttribute(o,l),C_.applyMatrix3(Koe).normalize().multiplyScalar(this.size).add(w_),i.setXYZ(a,w_.x,w_.y,w_.z),a=a+1,i.setXYZ(a,C_.x,C_.y,C_.z),a=a+1}i.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}var U3e=Object.defineProperty,O3e=Object.getOwnPropertyDescriptor,tx=(n,e,i,s)=>{for(var r=s>1?void 0:s?O3e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&U3e(e,i,r),r};const vA=q("debugplanetracking");class Bp extends Oe{constructor(){super(...arguments),m(this,"dataTemplate"),m(this,"occluder",!0),m(this,"initiateRoomCaptureIfNoData",!0),m(this,"usePlaneData",!0),m(this,"useMeshData",!0),m(this,"runInVR",!0),m(this,"bounds",new gi),m(this,"center",new E),m(this,"labelOffset",new E),m(this,"_dataId",1),m(this,"_allPlanes",new Map),m(this,"_allMeshes",new Map),m(this,"firstTimeNoPlanesDetected",-100),m(this,"makeOccluder",(e,i,s=!1)=>{if(i){if(i instanceof Array){for(const r of i)this.makeOccluder(e,r,s);return}!s&&!i.name.toLowerCase().includes("occlu")||(i.colorWrite=!1,i.depthTest=!0,i.depthWrite=!0,i.transparent=!1,i.polygonOffset=!0,i.polygonOffsetFactor=1,i.polygonOffsetUnits=.1,e.renderOrder=-1e3)}}),m(this,"_flipForwardMatrix",new de().makeRotationY(Math.PI)),m(this,"_verticesCache",new Map)}get trackedPlanes(){return this._allPlanes.values()}get trackedMeshes(){return this._allMeshes.values()}onBeforeXR(e,i){e==="immersive-vr"&&!this.runInVR||(i.optionalFeatures=i.optionalFeatures||[],this.usePlaneData&&!i.optionalFeatures.includes("plane-detection")&&i.optionalFeatures.push("plane-detection"),this.useMeshData&&!i.optionalFeatures.includes("mesh-detection")&&i.optionalFeatures.push("mesh-detection"))}onEnterXR(e){for(const i of this._allPlanes.keys())this.removeData(i,this._allPlanes);for(const i of this._allMeshes.keys())this.removeData(i,this._allMeshes)}onLeaveXR(e){for(const i of this._allPlanes.keys())this.removeData(i,this._allPlanes);for(const i of this._allMeshes.keys())this.removeData(i,this._allMeshes)}onUpdateXR(e){if(!this.runInVR&&e.xr.isVR)return;const i=e.xr.rig;if(!i){console.warn("No XR rig found, cannot parent tracked planes to it");return}const s=e.xr.frame;if(!this.context.renderer.xr.getReferenceSpace())return;const r=s.detectedPlanes,o=s.detectedMeshes,a=r!==void 0&&r.size>0,l=o!==void 0&&o.size>0;if(this.initiateRoomCaptureIfNoData&&(!a&&!l&&this.firstTimeNoPlanesDetected<-10&&(this.firstTimeNoPlanesDetected=Date.now()),(a||l)&&(this.firstTimeNoPlanesDetected=-1),this.firstTimeNoPlanesDetected>0&&Date.now()-this.firstTimeNoPlanesDetected>2500&&"initiateRoomCapture"in s.session&&(s.session.initiateRoomCapture(),this.firstTimeNoPlanesDetected=-1)),r!==void 0&&this.processFrameData(e.xr,i.gameObject,s,r,this._allPlanes),o!==void 0&&this.processFrameData(e.xr,i.gameObject,s,o,this._allMeshes),vA){const c=this.context.mainCameraComponent.gameObject.worldPosition;for(const h of this._allPlanes.values())!h.mesh||!h.mesh.visible||(this.bounds.makeEmpty(),h.mesh.traverse(d=>{d instanceof pe&&this.bounds.expandByObject(d)}),this.bounds.getCenter(this.center),this.labelOffset.copy(c).sub(this.center).normalize().multiplyScalar(.1),Nt.DrawLabel(this.center.add(this.labelOffset),(h.xrData.semanticLabel||"plane").toUpperCase()+`
`+h.xrData.lastChangedTime.toFixed(2),.02))}}removeData(e,i){const s=i.get(e);if(!s)return;i.delete(e),vA&&console.log("Plane no longer tracked, id="+s.id),s.mesh&&(s.mesh.removeFromParent(),s.mesh.traverse(o=>{const a=o.userData.normalsHelper;a?(a.dispose(),a.removeFromParent()):vA&&console.warn("No normals helper found for mesh",s.mesh)}),Ol(s.mesh,!0,!0));const r=new CustomEvent("plane-tracking",{detail:{type:"plane-removed",context:s}});this.dispatchEvent(r)}processFrameData(e,i,s,r,o){const a=this.context.renderer.xr.getReferenceSpace();if(a){for(const l of o.keys())r.has(l)||this.removeData(l,o);for(const l of r){const c="planeSpace"in l?l.planeSpace:"meshSpace"in l?l.meshSpace:void 0;if(!c)continue;const h=s.getPose(c,a);let d;if(o.has(l)){const u=o.get(l);if(d=u.mesh,u.timestamp<l.lastChangedTime){if(u.timestamp=l.lastChangedTime,u.mesh){const g=this.createGeometry(l);if(u.mesh instanceof pe)u.mesh.geometry.dispose(),u.mesh.geometry=g,this.makeOccluder(u.mesh,u.mesh.material);else if(u.mesh instanceof Es)for(const f of u.mesh.children)f instanceof pe&&(f.geometry.dispose(),f.geometry=g,this.makeOccluder(f,f.material));if(u.collider){const f=u.mesh;u.collider.sharedMesh=f,u.collider.convex=this.checkIfContextShouldBeConvex(f,u.xrData),u.collider.onDisable(),u.collider.onEnable()}vA&&(console.log("Plane updated, id="+u.id,u),u.mesh.traverse(f=>{if(!(f instanceof pe))return;const A=f.userData.normalsHelper;A&&A.update()}))}const p=new CustomEvent("plane-tracking",{detail:{type:"plane-updated",context:u}});this.dispatchEvent(p)}}else{if(!this.dataTemplate){const u=new pe;vA?u.material=new x1:this.occluder?(u.material=new ai,this.makeOccluder(u,u.material,!0)):u.material=new ai({wireframe:!0,opacity:.5,transparent:!0,color:3355443}),this.dataTemplate=new Mi("","",u)}if(!this.dataTemplate.asset)this.dataTemplate.loadAssetAsync();else{const u=$.instantiate(this.dataTemplate.asset);if(u.name="xr-tracked-plane",d=u,uD(u,!1),u instanceof pe)zn(u.geometry),u.geometry=this.createGeometry(l),this.makeOccluder(u,u.material,this.occluder);else if(u instanceof Es)for(const f of u.children)f instanceof pe&&(zn(f.geometry),f.geometry=this.createGeometry(l),this.makeOccluder(f,f.material,this.occluder));const p=u.getComponent(Q0);if(p){const f=u;p.sharedMesh=f,p.convex=this.checkIfContextShouldBeConvex(f,l),p.onDisable(),p.onEnable()}u.matrixAutoUpdate=!1,u.matrixWorldNeedsUpdate=!0,i.add(u);const g={id:this._dataId++,xrData:l,timestamp:l.lastChangedTime,mesh:u,collider:p};o.set(l,g),vA&&console.log("New plane detected, id="+g.id,g,{hasCollider:!!p,isGroup:u instanceof Es});try{const f=new CustomEvent("plane-tracking",{detail:{type:"plane-added",context:g}});this.dispatchEvent(f)}catch(f){console.error(f)}}}d&&(h?(d.visible=!0,d.matrix.fromArray(h.transform.matrix),d.matrix.premultiply(this._flipForwardMatrix)):d.visible=!1,vA&&d.traverse(u=>{if(u instanceof pe)if(u.userData.normalsHelper)u.userData.normalsHelper.update();else{const p=new F3e(u,.05,255);p.layers.disableAll(),p.layers.set(2),this.context.scene.add(p),u.userData.normalsHelper=p}}))}}}checkIfContextShouldBeConvex(e,i){if(!e)return!0;if(e){const s=new gi;s.expandByObject(e);const r=new E;s.getSize(r);let o=!0;return r.x>2&&r.y>2&&r.z>1.5&&(o=!1),o&&"semanticLabel"in i&&i.semanticLabel==="wall"&&(o=!0),o}return!0}createGeometry(e){return"polygon"in e?this.createPlaneGeometry(e.polygon):"vertices"in e&&"indices"in e?this.createMeshGeometry(e.vertices,e.indices):new Rt}createMeshGeometry(e,i){const s=e.toString()+"_"+i.toString();if(this._verticesCache.has(s))return this._verticesCache.get(s);const r=new Rt;r.setIndex(new ct(i,1)),r.setAttribute("position",new ct(e,3));const o=Array();for(let a=0;a<e.length;a+=3)o.push(e[a],e[a+2]);return r.setAttribute("uv",new ct(e,3)),r.computeVertexNormals(),this._verticesCache.set(s,r),r}createPlaneGeometry(e){const i=new Rt,s=[],r=[];e.forEach(p=>{s.push(p.x,p.y,p.z),r.push(p.x,p.z)});const o=new E(s[0],s[1],s[2]),a=new E(s[3],s[4],s[5]),l=new E(s[6],s[7],s[8]),c=new E,h=new E;c.subVectors(a,o),h.subVectors(l,o),c.cross(h),c.normalize();const d=[];for(let p=0;p<s.length/3;p++)d.push(c.x,c.y,c.z);const u=[];for(let p=2;p<e.length;++p)u.push(0,p-1,p);return i.setAttribute("position",new ct(new Float32Array(s),3)),i.setAttribute("uv",new ct(new Float32Array(r),2)),i.setAttribute("normal",new ct(new Float32Array(d),3)),i.setIndex(u),i.computeBoundingBox(),i.computeBoundingSphere(),i}}tx([T(Mi)],Bp.prototype,"dataTemplate",2),tx([T()],Bp.prototype,"occluder",2),tx([T()],Bp.prototype,"initiateRoomCaptureIfNoData",2),tx([T()],Bp.prototype,"usePlaneData",2),tx([T()],Bp.prototype,"useMeshData",2),tx([T()],Bp.prototype,"runInVR",2);var Z3e=Object.defineProperty,W3e=Object.getOwnPropertyDescriptor,ix=(n,e,i,s)=>{for(var r=s>1?void 0:s?W3e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&Z3e(e,i,r),r};class kp extends Oe{constructor(){super(...arguments),m(this,"side","none"),m(this,"controller",!0),m(this,"hands",!1),m(this,"controlVisibility",!0),m(this,"useGripSpace",!1),m(this,"resetTransformAfterXRSession",!0),m(this,"_startPosition",new E),m(this,"_startRotation",new Fe),m(this,"_startScale",new E)}get activeAndEnabled(){return!0}onEnterXR(e){this._startPosition.copy(this.gameObject.position),this._startRotation.copy(this.gameObject.quaternion),this._startScale.copy(this.gameObject.scale)}onUpdateXR(e){const i=e.xr.getController(this.side);if(i){if(i.hand&&!this.hands){this.controlVisibility&&(this.gameObject.visible=!1);return}else if(!this.controller){this.controlVisibility&&(this.gameObject.visible=!1);return}this.controlVisibility&&(this.gameObject.visible=!0),this.useGripSpace||i.targetRayMode==="transient-pointer"?(this.gameObject.worldPosition=i.gripWorldPosition,this.gameObject.worldQuaternion=i.gripWorldQuaternion,this.gameObject.worldScale=Lt(i.xr.rigScale,i.xr.rigScale,i.xr.rigScale).multiply(this._startScale)):(this.gameObject.worldPosition=i.rayWorldPosition,this.gameObject.worldQuaternion=i.rayWorldQuaternion,this.gameObject.worldScale=Lt(i.xr.rigScale,i.xr.rigScale,i.xr.rigScale).multiply(this._startScale))}}onLeaveXR(e){this.resetTransformAfterXRSession&&(this.gameObject.position.copy(this._startPosition),this.gameObject.quaternion.copy(this._startRotation),this.gameObject.scale.copy(this._startScale))}}ix([T()],kp.prototype,"side",2),ix([T()],kp.prototype,"controller",2),ix([T()],kp.prototype,"hands",2),ix([T()],kp.prototype,"controlVisibility",2),ix([T()],kp.prototype,"useGripSpace",2),ix([T()],kp.prototype,"resetTransformAfterXRSession",2);var H3e=Object.defineProperty,Q3e=Object.getOwnPropertyDescriptor,K3e=(n,e,i,s)=>{for(var r=s>1?void 0:s?Q3e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&H3e(e,i,r),r};const Yoe=q("debugwebxr");class JB extends Oe{constructor(){super(...arguments),m(this,"priority",0),m(this,"_startScale")}get isActive(){return this.activeAndEnabled&&this.gameObject.visible}setAsActiveXRRig(){var e;(e=Qt.active)==null||e.setRigActive(this)}awake(){if(Yoe){const e=new Ae;e.position.y+=.5,this.gameObject.add(e);const i=e.addNewComponent(K0);i&&(i.isGizmo=!1);const s=new Ya(.5);this.gameObject.add(s)}}isXRRig(){return!0}supportsXR(e){return!0}onEnterXR(e){this._startScale=this.gameObject.scale.clone(),e.xr.addRig(this),Yoe&&console.log("WebXR: add Rig",this.name,this.priority)}onLeaveXR(e){e.xr.removeRig(this),this._startScale&&this.gameObject&&this.gameObject.scale.copy(this._startScale)}}K3e([T()],JB.prototype,"priority",2);class NO{}const Y3e=Object.freeze(Object.defineProperty({__proto__:null,ActionBuilder:Wi,ActionCollection:$F,ActionModel:Wl,AlignmentConstraint:KC,Animation:ra,AnimationCurve:U0,AnimationExtension:JC,AnimationTrackHandler:TL,Animator:Mo,AnimatorController:uc,Antialiasing:uS,AudioExtension:Jg,AudioListener:mg,AudioSource:vs,AudioTrackHandler:cS,Avatar:Ag,AvatarBlink_Simple:W0,AvatarEyeLook_Rotation:Av,AvatarLoader:LU,AvatarMarker:Eo,AvatarModel:BL,Avatar_Brain_LookAt:AS,Avatar_MouthShapes:vS,Avatar_MustacheShake:TU,Avatar_POI:Od,AxesHelper:yv,BaseUIComponent:th,BasicIKConstraint:kU,BehaviorExtension:GL,BehaviorModel:Kr,BloomEffect:H0,BoxCollider:vv,BoxGizmo:K0,BoxHelperComponent:Oc,Button:yp,CallInfo:Xd,Camera:In,CameraTargetReachedEvent:sS,Canvas:Ro,CanvasGroup:wg,CapsuleCollider:Ap,ChangeMaterialOnClick:Cv,ChangeTransformOnClick:J0,CharacterController:eA,CharacterControllerInput:vp,ChromaticAberration:ES,Collider:cl,ColorAdjustments:_g,ColorBySpeedModule:iA,ColorOverLifetimeModule:VS,ContactShadows:Uh,ControlTrackHandler:EL,CustomBranding:kg,Deletable:v3,DeleteBox:ZS,DepthOfField:Oh,DeviceFlag:AB,DocumentExtension:x3,DragControls:dl,DropListener:Ep,DropListenerAddedEvent:yB,Duplicatable:lA,EffectWrapper:HS,EmissionModule:Jd,EmphasizeOnClick:_v,EventList:Gn,EventListEvent:AL,EventSystem:Fc,EventTrigger:xB,FieldWithDefault:n3,FixedJoint:T3,FlyControls:E3,Fog:Dv,GltfExport:jS,GltfExportBox:P3,Gradient:Mg,Graphic:Y0,GraphicRaycaster:vL,GridHelper:Uv,GridLayoutGroup:WU,GroundProjectedEnv:Pd,GroupActionModel:cp,HideOnStart:KU,HingeJoint:QS,HorizontalLayoutGroup:ZU,Image:wv,InheritVelocityModule:Tg,InputField:cA,InstanceHandle:RS,InstancingHandler:Lv,Interactable:b3,Keyframe:Na,LODGroup:qS,LODModel:hA,Light:ul,LimitVelocityOverLifetimeModule:dr,LogStats:D3,LookAt:dA,LookAtConstraint:O0,MainModule:Bo,MaskableGraphic:_S,MeshCollider:Q0,MeshRenderer:kS,MinMaxCurve:Vt,MinMaxGradient:Da,NeedleMenu:$d,NestedGltf:TB,Networking:Zv,NoiseModule:mn,ObjectRaycaster:Ql,OffsetConstraint:uA,OpenURL:Wv,OrbitControls:ln,Outline:xv,Padding:vg,ParticleBurst:NS,ParticleSubEmitter:DB,ParticleSystem:pr,ParticleSystemRenderer:Qc,PhysicsExtension:uB,PixelationEffect:o_,PlayAnimationOnClick:$0,PlayAudioOnClick:Cg,PlayableDirector:fg,PlayerColor:Tx,PointerEventData:Cx,PostProcessingHandler:zB,PreliminaryAction:Mv,PreliminaryTrigger:IS,RawImage:XL,Rect:zU,RectTransform:aa,ReflectionProbe:Tv,RegisteredAnimationInfo:Op,RemoteSkybox:cu,Renderer:Gs,RendererLightmap:LS,Rigidbody:rn,RotationBySpeedModule:tc,RotationOverLifetimeModule:Wc,SceneSwitcher:Rr,ScreenCapture:Fg,ScreenSpaceAmbientOcclusion:Lp,ScreenSpaceAmbientOcclusionN8:Hh,SetActiveOnClick:q0,ShadowCatcher:p_,ShapeModule:Ss,SharpeningEffect:l_,SignalAsset:oS,SignalReceiver:mv,SignalReceiverEvent:pv,SignalTrackHandler:hS,Size:DU,SizeBySpeedModule:za,SizeOverLifetimeModule:Ig,SkinnedMeshRenderer:s3,SmoothFollow:Ug,SpatialGrabRaycaster:dv,SpatialHtml:m_,SpatialTrigger:A_,SpatialTriggerReceiver:hu,SpectatorCamera:WB,SphereCollider:bv,Sprite:qd,SpriteData:_p,SpriteRenderer:hl,SpriteSheet:Eg,SubEmitterSystem:r_,SyncedCamera:QB,SyncedRoom:Qh,SyncedTransform:Vd,TapGestureTrigger:YU,TeleportTarget:hB,TestRunner:RO,TestSimulateUserData:LO,Text:la,TextBuilder:pB,TextExtension:FS,TextureSheetAnimationModule:ko,TiltShiftEffect:du,ToneMappingEffect:Sg,TrailModule:cs,TransformData:bs,TransformGizmo:AA,TriggerBuilder:Yr,TriggerModel:sg,UIRaycastUtils:xL,UIRootComponent:iS,USDZExporter:Ms,USDZText:Bg,USDZUIExtension:mB,UsageMarker:OS,VariantAction:qF,VelocityOverLifetimeModule:_s,VerticalLayoutGroup:OU,VideoPlayer:Lr,Vignette:yA,VisibilityAction:TS,Voip:yg,Volume:qv,VolumeParameter:at,VolumeProfile:dS,WebARCameraBackground:v_,WebARSessionRoot:Mp,WebXR:Ns,WebXRImageTracking:ex,WebXRImageTrackingModel:uu,WebXRPlaneTracking:Bp,WebXRTrackedImage:$v,XRControllerFollow:kp,XRControllerModel:eu,XRControllerMovement:ic,XRFlag:Jl,XRRig:JB,XRState:Xa,__Ignore:NO},Symbol.toStringTag,{value:"Module"}));class j3e extends Oe{constructor(){super(...arguments),m(this,"toggleKey","KeyP")}update(){this.context.input.isKeyDown(this.toggleKey)&&this.context.domElement.classList.toggle("presentation-mode")}}Y.add("__Ignore",NO),Y.add("ActionBuilder",Wi),Y.add("ActionCollection",$F),Y.add("ActionModel",Wl),Y.add("AlignmentConstraint",KC),Y.add("Animation",ra),Y.add("AnimationCurve",U0),Y.add("AnimationExtension",JC),Y.add("AnimationTrackHandler",TL),Y.add("Animator",Mo),Y.add("AnimatorController",uc),Y.add("Antialiasing",uS),Y.add("AudioExtension",Jg),Y.add("AudioListener",mg),Y.add("AudioSource",vs),Y.add("AudioTrackHandler",cS),Y.add("Avatar",Ag),Y.add("Avatar_Brain_LookAt",AS),Y.add("Avatar_MouthShapes",vS),Y.add("Avatar_MustacheShake",TU),Y.add("Avatar_POI",Od),Y.add("AvatarBlink_Simple",W0),Y.add("AvatarEyeLook_Rotation",Av),Y.add("AvatarLoader",LU),Y.add("AvatarMarker",Eo),Y.add("AvatarModel",BL),Y.add("AxesHelper",yv),Y.add("BaseUIComponent",th),Y.add("BasicIKConstraint",kU),Y.add("BehaviorExtension",GL),Y.add("BehaviorModel",Kr),Y.add("BloomEffect",H0),Y.add("BoxCollider",vv),Y.add("BoxGizmo",K0),Y.add("BoxHelperComponent",Oc),Y.add("Button",yp),Y.add("CallInfo",Xd),Y.add("Camera",In),Y.add("CameraTargetReachedEvent",sS),Y.add("Canvas",Ro),Y.add("CanvasGroup",wg),Y.add("CapsuleCollider",Ap),Y.add("ChangeMaterialOnClick",Cv),Y.add("ChangeTransformOnClick",J0),Y.add("CharacterController",eA),Y.add("CharacterControllerInput",vp),Y.add("ChromaticAberration",ES),Y.add("Collider",cl),Y.add("ColorAdjustments",_g),Y.add("ColorBySpeedModule",iA),Y.add("ColorOverLifetimeModule",VS),Y.add("ContactShadows",Uh),Y.add("ControlTrackHandler",EL),Y.add("CustomBranding",kg),Y.add("Deletable",v3),Y.add("DeleteBox",ZS),Y.add("DepthOfField",Oh),Y.add("DeviceFlag",AB),Y.add("DocumentExtension",x3),Y.add("DragControls",dl),Y.add("DropListener",Ep),Y.add("DropListenerAddedEvent",yB),Y.add("Duplicatable",lA),Y.add("EffectWrapper",HS),Y.add("EmissionModule",Jd),Y.add("EmphasizeOnClick",_v),Y.add("EventList",Gn),Y.add("EventListEvent",AL),Y.add("EventSystem",Fc),Y.add("EventTrigger",xB),Y.add("FieldWithDefault",n3),Y.add("FixedJoint",T3),Y.add("FlyControls",E3),Y.add("Fog",Dv),Y.add("GltfExport",jS),Y.add("GltfExportBox",P3),Y.add("Gradient",Mg),Y.add("Graphic",Y0),Y.add("GraphicRaycaster",vL),Y.add("GridHelper",Uv),Y.add("GridLayoutGroup",WU),Y.add("GroundProjectedEnv",Pd),Y.add("GroupActionModel",cp),Y.add("HideOnStart",KU),Y.add("HingeJoint",QS),Y.add("HorizontalLayoutGroup",ZU),Y.add("Image",wv),Y.add("InheritVelocityModule",Tg),Y.add("InputField",cA),Y.add("InstanceHandle",RS),Y.add("InstancingHandler",Lv),Y.add("Interactable",b3),Y.add("Keyframe",Na),Y.add("Light",ul),Y.add("LimitVelocityOverLifetimeModule",dr),Y.add("LODGroup",qS),Y.add("LODModel",hA),Y.add("LogStats",D3),Y.add("LookAt",dA),Y.add("LookAtConstraint",O0),Y.add("MainModule",Bo),Y.add("MaskableGraphic",_S),Y.add("MeshCollider",Q0),Y.add("MeshRenderer",kS),Y.add("MinMaxCurve",Vt),Y.add("MinMaxGradient",Da),Y.add("NeedleMenu",$d),Y.add("NestedGltf",TB),Y.add("Networking",Zv),Y.add("NoiseModule",mn),Y.add("ObjectRaycaster",Ql),Y.add("OffsetConstraint",uA),Y.add("OpenURL",Wv),Y.add("OrbitControls",ln),Y.add("Outline",xv),Y.add("Padding",vg),Y.add("ParticleBurst",NS),Y.add("ParticleSubEmitter",DB),Y.add("ParticleSystem",pr),Y.add("ParticleSystemRenderer",Qc),Y.add("PhysicsExtension",uB),Y.add("PixelationEffect",o_),Y.add("PlayableDirector",fg),Y.add("PlayAnimationOnClick",$0),Y.add("PlayAudioOnClick",Cg),Y.add("PlayerColor",Tx),Y.add("PlayerState",jl),Y.add("PlayerSync",gv),Y.add("PointerEventData",Cx),Y.add("PostProcessingHandler",zB),Y.add("PreliminaryAction",Mv),Y.add("PreliminaryTrigger",IS),Y.add("PresentationMode",j3e),Y.add("RawImage",XL),Y.add("Rect",zU),Y.add("RectTransform",aa),Y.add("ReflectionProbe",Tv),Y.add("RegisteredAnimationInfo",Op),Y.add("RemoteSkybox",cu),Y.add("Renderer",Gs),Y.add("RendererLightmap",LS),Y.add("Rigidbody",rn),Y.add("RotationBySpeedModule",tc),Y.add("RotationOverLifetimeModule",Wc),Y.add("SceneSwitcher",Rr),Y.add("ScreenCapture",Fg),Y.add("ScreenSpaceAmbientOcclusion",Lp),Y.add("ScreenSpaceAmbientOcclusionN8",Hh),Y.add("SetActiveOnClick",q0),Y.add("ShadowCatcher",p_),Y.add("ShapeModule",Ss),Y.add("SharpeningEffect",l_),Y.add("SignalAsset",oS),Y.add("SignalReceiver",mv),Y.add("SignalReceiverEvent",pv),Y.add("SignalTrackHandler",hS),Y.add("Size",DU),Y.add("SizeBySpeedModule",za),Y.add("SizeOverLifetimeModule",Ig),Y.add("SkinnedMeshRenderer",s3),Y.add("SmoothFollow",Ug),Y.add("SpatialGrabRaycaster",dv),Y.add("SpatialHtml",m_),Y.add("SpatialTrigger",A_),Y.add("SpatialTriggerReceiver",hu),Y.add("SpectatorCamera",WB),Y.add("SphereCollider",bv),Y.add("Sprite",qd),Y.add("SpriteData",_p),Y.add("SpriteRenderer",hl),Y.add("SpriteSheet",Eg),Y.add("SubEmitterSystem",r_),Y.add("SyncedCamera",QB),Y.add("SyncedRoom",Qh),Y.add("SyncedTransform",Vd),Y.add("TapGestureTrigger",YU),Y.add("TeleportTarget",hB),Y.add("TestRunner",RO),Y.add("TestSimulateUserData",LO),Y.add("Text",la),Y.add("TextBuilder",pB),Y.add("TextExtension",FS),Y.add("TextureSheetAnimationModule",ko),Y.add("TiltShiftEffect",du),Y.add("ToneMappingEffect",Sg),Y.add("TrailModule",cs),Y.add("TransformData",bs),Y.add("TransformGizmo",AA),Y.add("TriggerBuilder",Yr),Y.add("TriggerModel",sg),Y.add("UIRaycastUtils",xL),Y.add("UIRootComponent",iS),Y.add("UsageMarker",OS),Y.add("USDZExporter",Ms),Y.add("USDZText",Bg),Y.add("USDZUIExtension",mB),Y.add("VariantAction",qF),Y.add("VelocityOverLifetimeModule",_s),Y.add("VerticalLayoutGroup",OU),Y.add("VideoPlayer",Lr),Y.add("Vignette",yA),Y.add("VisibilityAction",TS),Y.add("Voip",yg),Y.add("Volume",qv),Y.add("VolumeParameter",at),Y.add("VolumeProfile",dS),Y.add("WebARCameraBackground",v_),Y.add("WebARSessionRoot",Mp),Y.add("WebXR",Ns),Y.add("WebXRImageTracking",ex),Y.add("WebXRImageTrackingModel",uu),Y.add("WebXRPlaneTracking",Bp),Y.add("WebXRTrackedImage",$v),Y.add("XRControllerFollow",kp),Y.add("XRControllerModel",eu),Y.add("XRControllerMovement",ic),Y.add("XRFlag",Jl),Y.add("XRRig",JB),Y.add("XRState",Xa);const S_=Qr,J3e=q("debugtypestore");J3e&&console.log(Y);function q3e(n,e){const i=Xte(n,e);return i!==void 0?i:null}const $3e=new oke,VO=Symbol("deserialize-queue");async function eOe(n,e,i,s=null,r){if(!i){console.debug("Can not create component instances: gltf is null");return}let o=s;typeof o=="number"&&(o=new Zo(s));const a=e.indexOf("?");e=a===-1?e:e.substring(0,a);const l=new qz(i.scene);l.gltfId=e,l.context=n,l.gltf=i,l.nodeToObject=r?.nodeToObjectMap,l.implementationInformation=$3e;let c=n[VO];if(c||(c=n[VO]=[]),i.scenes)for(const h of i.scenes)await zO(l,h,c);if(i.children)for(const h of i.children)await zO(l,h,c);n.new_scripts_pre_setup_callbacks.push(()=>{const h=n[VO];if(h){for(const d of h)tOe(d,l);h.length=0}if(o){const d={},u=[];DO(i,o,d,u);for(const p of i.scenes)DO(p,o,d,u);for(const p of u)p.resolveGuids(d)}})}const XO=Symbol("original-component-name"),nx=new Map;function DO(n,e,i,s){if(e===null||!n)return;const r=n.guid,o=n.guid;o!=null&&o.length&&(nx.has(o)||(S_&&console.log('Creating InstanceIdProvider with key "'+o+'" for object '+n.name),nx.set(o,new Zo(o))));const a=o&&nx.get(o)||e;if(n.guid=a.generateUUID(),r&&r!=="invalid"&&(i[r]=n.guid),n&&n.userData&&n.userData.components)for(const l of n.userData.components){if(l===null)continue;const c=l.guid;c?nx.has(c)||(S_&&console.log('Creating InstanceIdProvider with key "'+c+'" for component '+l[XO]),nx.set(c,new Zo(c))):S_&&console.warn("Can not create IdProvider: component "+l[XO]+" has no guid",l.guid);const h=nx.get(c)||e,d=l.guid;l.guid=h.generateUUID(),d&&d!=="invalid"&&(i[d]=l.guid),l.resolveGuids&&s.push(l)}if(n.children)for(const l of n.children)DO(l,e,i,s)}const __=[];async function zO(n,e,i,s){if(!e)return;const r=e.userData;if(r){const o=r.builtin_components;if(o&&o.length>0)for(const a of o)try{if(a===null)continue;const l=Y.get(a.name);if(l!=null){const c=new l;c.sourceId=n.gltfId,Wb(c,a,n.implementationInformation),c.context=n.context,"guid"in a&&(c[Rw]=a.guid),c[XO]=a.name,B0(e,c,!1),i.push({instance:c,compData:a,obj:e}),c.isCamera&&n.context&&n.context.mainCamera===null&&c.tag==="MainCamera"&&n.context.setCurrentCamera(c)}else S_&&console.debug("unknown component: "+a.name),__.includes(a.name)||__.push(a.name)}catch(l){console.error(a.name+" - "+l.message,l)}if(__.length>0){const a=__.join(", ");console.warn("unknown components: "+a),__.length=0,Ma()&&ss(`<strong>Unknown components in scene</strong>:

${a}

This could mean you forgot to add a npmdef to your ExportInfo
<a href="https://engine.needle.tools/docs/project_structure.html#creating-and-installing-a-npmdef" target="_blank">documentation</a>`,Rl.Warn)}}if(e.children)for(const o of e.children)await zO(n,o,i)}function tOe(n,e){const{instance:i,compData:s,obj:r}=n;e.object=r,e.target=i,b2(i,s,e),S_&&console.debug("add "+s.name,s,i)}const qB=q("debugfileformat");async function joe(n,e=!0){var i;if(e){const r=n,o=new URL(r,globalThis.location.origin);let a=null;const l=o.searchParams.get("filetype");switch(l&&(a=l.toUpperCase()),a!=null&&a.length||(a=(i=o.pathname.split(".").pop())==null?void 0:i.toUpperCase()),qB&&console.debug("Use file extension to determine type: "+a),a){case"GLTF":return"gltf";case"VRM":return"vrm";case"GLB":return"glb";case"FBX":return"fbx";case"USD":return"usd";case"USDA":return"usda";case"USDZ":return"usdz";case"OBJ":return"obj"}}const s=await fetch(n,{method:"GET",headers:{range:"bytes=0-32"}}).catch(r=>null);if(s!=null&&s.ok){const r=await s.arrayBuffer(),o=Joe(r,s);return qB&&console.log("Determined file type from header: "+o),o}return"unknown"}function Joe(n,e){if(n.byteLength<4)return"unknown";const i=new Uint8Array(n);if(qB&&console.warn(`Trying to determine file type from binary data
`,'"'+new TextDecoder().decode(n)+`"
`,i),i[0]==103&&i[1]==108&&i[2]==84&&i[3]==70)return console.debug("GLTF detected"),"glb";if(i[0]==80&&i[1]==75&&i[2]==3&&i[3]==4)return console.debug("USDZ detected"),"usdz";if(i[0]==80&&i[1]==88&&i[2]==82&&i[3]==45&&i[4]==85&&i[5]==83&&i[6]==68&&i[7]==67)return console.debug("Binary USD detected"),"usd";if(i[0]==35&&i[1]==117&&i[2]==115&&i[3]==100&&i[4]==97)return console.debug("ASCII USD detected"),"usda";if(i[0]==75&&i[1]==97&&i[2]==121&&i[3]==100&&i[4]==97&&i[5]==114&&i[6]==97&&i[7]==32)return console.debug("Binary FBX detected"),"fbx";if(i[0]==59&&i[1]==32&&i[2]==70&&i[3]==66&&i[4]==88&&i[5]==32)return console.debug("ASCII FBX detected"),"fbx";if(i[0]==35&&i[1]==32&&i[2]==66&&i[3]==108&&i[4]==101&&i[5]==110&&i[6]==100&&i[7]==101&&i[8]==114&&i[9]==32||i[0]==35&&i[1]==32&&i[2]==65&&i[3]==108&&i[4]==105&&i[5]==97&&i[6]==115&&i[7]==32&&i[8]==79&&i[9]==66&&i[10]==74)return console.debug("OBJ detected"),"obj";if(e.headers.has("content-type")){const s=e.headers.get("content-type");switch(console.debug("Content-Type: "+s),s){case"model/gltf+json":return"gltf";case"model/gltf-binary":return"glb";case"model/vrm":return"vrm";case"model/vnd.usdz+zip":return"usdz";case"model/vnd.usd+zip":return"usd";case"model/vnd.usda+zip":return"usda";case"model/fbx":return"fbx";case"model/obj":return"obj"}}if(i[0]==118&&i[1]==32||i[0]==102&&i[1]==32)return console.debug("OBJ detected (the file has no header and starts with vertex or face)"),"obj";if(i[0]==35&&i[1]==32&&i[2]==70&&i[3]==105&&i[4]==108&&i[5]==101&&i[6]==32&&i[7]==101&&i[8]==120&&i[9]==112&&i[10]==111&&i[11]==114&&i[12]==116&&i[13]==101&&i[14]==100&&i[15]==32&&i[16]==98&&i[17]==121&&i[18]==32&&i[19]==90&&i[20]==66&&i[21]==114&&i[22]==117&&i[23]==115&&i[24]==104)return console.debug("OBJ detected (exported by ZBrush)"),"obj";if(i[0]==109&&i[1]==116&&i[2]==108&&i[3]==108&&i[4]==105&&i[5]==98)return console.debug("OBJ detected (mtllib)"),"obj";if(Je()||qB){const s=new TextDecoder().decode(n.slice(0,16));console.debug('Could not determine file type from binary data: "'+s+'..."',i)}else console.debug("Could not determine file type from binary data",i);return"unknown"}class FO{createBuiltinComponents(e,i,s,r,o){return eOe(e,i,s,r,o)}writeBuiltinComponentData(e,i){return q3e(e,i)}parseSync(e,i,s,r){return iae(e,i,s,r)}loadSync(e,i,s,r,o){return OO(e,i,s,r,o)}}dX(FO);const qoe=q("printGltf")||q("printgltf"),$oe=q("downloadgltf"),iOe=q("debugfileformat");var eae=(n=>(n[n.BeforeLoad=0]="BeforeLoad",n[n.AfterLoaded=1]="AfterLoaded",n[n.FinishedSetup=10]="FinishedSetup",n))(eae||{});class xA{constructor(e,i,s,r){m(this,"context"),m(this,"loader"),m(this,"path"),m(this,"gltf"),this.context=e,this.path=i,this.loader=s,this.gltf=r}}const Zg={};function nOe(n,e){Zg[n]=Zg[n]||[],Zg[n].push(e)}function sOe(n,e){if(Zg[n]){const i=Zg[n].indexOf(e);i>=0&&Zg[n].splice(i,1)}}function sx(n,e){if(Zg[n])for(const i of Zg[n])i(e)}async function tae(n,e,i,s,r){qoe&&console.warn("glTF",e,i),e.includes("?")&&(e=e.split("?")[0]),await fh().createBuiltinComponents(n,e,i,s,r)}async function UO(n,e){const i=await joe(n)||"unknown";switch(iOe&&console.debug("Determined file type: "+i+" for url",n),i){case"unknown":{console.warn("Unknown file type. Assuming glTF:",n);const s=new ip;return await JL(s,e,n),s}case"fbx":return new dne;case"obj":return new FF;case"usd":case"usda":case"usdz":return console.warn(i.toUpperCase()+" files are not supported."),null;default:console.warn("Unknown file type:",i);case"gltf":case"glb":case"vrm":{const s=new ip;return await JL(s,e,n),s}}}async function iae(n,e,i,s){typeof i!="string"&&(console.warn("Parse gltf binary without path, this might lead to errors in resolving extensions. Please provide the source path of the gltf/glb file",i,typeof i),i=""),qoe&&console.log("Parse glTF",i);const r=await UO(i,n);if(!r)return;if(r instanceof FF){typeof e!="string"&&(e=new TextDecoder().decode(e));const a=r.parse(e);return{animations:a.animations,scene:a,scenes:[a]}}if(!(r instanceof ip)){const a=r.parse(e,i);return rae(r,a),{animations:a.animations,scene:a,scenes:[a]}}const o=jL(r);return new Promise((a,l)=>{try{let c=i.split("?")[0].trimEnd();if(c.endsWith(".glb")||c.endsWith(".gltf")){const d=c.split("/");d.pop(),c=d.join("/"),c.endsWith("/")||(c+="/")}r.resourcePath=c,tL(r,n),sx(0,new xA(n,i,r));const h=n.mainCamera;r.parse(e,"",async d=>{i3(i,d,n),sx(1,new xA(n,i,r,d)),await tae(n,i,d,s,o),await nae(d.scene,n,h),sx(10,new xA(n,i,r,d)),a(d),$oe&&sae(e)},d=>{console.error('Loading asset at "'+i+`" failed
`,d),a(void 0)})}catch(c){console.error(c),l(c)}})}async function OO(n,e,i,s,r){rOe(e);const o=await UO(e,n);if(!o)return;if(!(o instanceof ip)){const l=await o.loadAsync(e,r);return rae(o,l),{animations:l.animations,scene:l,scenes:[l]}}const a=jL(o);return new Promise((l,c)=>{try{tL(o,n),sx(0,new xA(n,e,o));const h=n.mainCamera;o.load(e,async d=>{i3(e,d,n),sx(1,new xA(n,e,o,d)),await tae(n,i,d,s,a),await nae(d.scene,n,h),sx(10,new xA(n,e,o,d)),l(d),$oe&&sae(e)},d=>{r?.call(o,d)},d=>{console.error('Loading asset at "'+e+`" failed
`,d),l(void 0)})}catch(h){console.error(h),c(h)}})}async function nae(n,e,i){i||(i=e.mainCamera);try{i?await e.renderer.compileAsync(n,i,e.scene).catch(s=>{console.warn(s.message)}):GBe(n,e)}catch(s){console.warn(s?.message||s)}}function rOe(n){if(new URL(n,window.location.href).href.startsWith("file://")){const e=`Hi - it looks like you are trying to load a local file which will not work. You need to use a webserver to serve your files.
Please refer to the documentation on <a href="https://fwd.needle.tools/needle-engine/docs/local-server">https://docs.needle.tools</a> or ask for help in our <a href="https://discord.needle.tools">discord community</a>`;ss(e),console.warn(e)}}function sae(n){if(typeof n=="string"){const e=document.createElement("a");e.href=n,e.download=n.split("/").pop(),e.click()}else{const e=new Blob([n],{type:"application/octet-stream"}),i=window.URL.createObjectURL(e),s=document.createElement("a");s.href=i,s.download="download.glb",s.click()}}function rae(n,e){if(e!=null&&e.isObject3D){const i=e;(n instanceof dne||n instanceof FF)&&i.traverse(s=>{const r=s;r!=null&&r.isMesh&&pD(r,r.material)})}}dX(FO);const Vs=q("debugwebcomponent"),oae="needle-engine",aae="vr",lae="desktop",oOe=[one,aae,lae],M_="ar-session-active",I_="desktop-session-active",aOe=["public-key","version","hash","src","camera-controls","loadstart","progress","loadfinished","dracoDecoderPath","dracoDecoderType","ktx2DecoderPath","tone-mapping","tone-mapping-exposure","background-blurriness","background-color"];class ZO extends HTMLElement{constructor(){super(),m(this,"_context"),m(this,"_overlay_ar"),m(this,"_loadingProgress01",0),m(this,"_loadingView"),m(this,"_previousSrc",null),m(this,"_didFullyLoad",!1),m(this,"_loadId",0),m(this,"_abortController",null),m(this,"_lastSourceFiles",null),m(this,"_createContextPromise",null),m(this,"onXRSessionStarted",()=>{var i;const s=this.context.xrSessionMode;s==="immersive-ar"?this.onEnterAR(this.context.xrSession):s==="immersive-vr"&&this.onEnterVR(this.context.xrSession),(i=this.context.xrSession)==null||i.addEventListener("end",()=>{this.dispatchEvent(new CustomEvent("xr-session-ended",{detail:{session:this.context.xrSession,context:this._context,sessionMode:s}})),s==="immersive-ar"?this.onExitAR(this.context.xrSession):s==="immersive-vr"&&this.onExitVR(this.context.xrSession)})}),m(this,"onReady",()=>{var i;return(i=this._loadingView)==null?void 0:i.onLoadingFinished()}),m(this,"onError",()=>{var i;return(i=this._loadingView)==null?void 0:i.setMessage("Loading failed!")}),m(this,"_previouslyRegisteredMap",new Map),this._overlay_ar=new BGe,this.addEventListener("ready",this.onReady),jie(),this.attachShadow({mode:"open"});const e=document.createElement("template");e.innerHTML=`<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

    :host {
        position: absolute;
        display: block;
        width: max(600px, 100%);
        height: max(300px, 100%);
        touch-action: none;

        -webkit-tap-highlight-color: transparent;
    }

    @media (max-width: 600px) {
        :host {
            width: 100%;
        }
    }
    @media (max-height: 300px) {
        :host {
            height: 100%;
        }
    }

    :host > div.canvas-wrapper {
        width: 100%;
        height: 100%;
    }

    :host canvas {   
        position: absolute;
        user-select: none;
        -webkit-user-select: none;

        /** allow touch panning but no pinch zoom **/
        /** but this doesnt work yet: 
         * touch-action: pan-x, pan-y;
         **/
        
        -webkit-touch-callout: none;
        -webkit-user-drag: none;
        -webkit-user-modify: none;
    }
    :host .content {
        position: absolute;
        top: 0;
        width: 100%;
        height: 100%;
        visibility: visible;
        z-index: 500; /* < must be less than the webxr buttons element */
        pointer-events: none;
    }
    :host .overlay-content {
        position: absolute;
        user-select: auto;
        pointer-events: all;
    }
    :host slot[name="quit-ar"]:hover {
        cursor: pointer;
    }
    :host .quit-ar-button {
        position: absolute;
        // top: env(titlebar-area-y); /** this doesnt work **/
        top: 60px; /** camera access needs a bit more space **/
        right: 20px;
        z-index: 9999;
    }
</style>
<div class="canvas-wrapper"> <!-- this wrapper is necessary for WebXR https://github.com/meta-quest/immersive-web-emulator/issues/55 -->
    <canvas></canvas>
</div>
<div class="content">
    <slot class="overlay-content"></slot>
</div>
`,this.shadowRoot&&this.shadowRoot.appendChild(e.content.cloneNode(!0)),this._context=new $t({domElement:this}),this.addEventListener("error",this.onError)}static get observedAttributes(){return aOe}get loadingProgress01(){return this._loadingProgress01}get loadingFinished(){return this.loadingProgress01>.999}get cameraControls(){const e=this.getAttribute("camera-controls");return e==null?null:!(e===null||e==="False"||e==="false"||e==="0"||e==="none")}getContext(){return new Promise((e,i)=>{if(this._context&&this.loadingFinished)e(this._context);else{const s=()=>{this.removeEventListener("loadfinished",s),this._context&&this.loadingFinished&&e(this._context)};this.addEventListener("loadfinished",s)}})}get context(){return this._context}async connectedCallback(){if(Vs&&console.log("<needle-engine> connected"),this.setPublicKey(),this.setVersion(),this.addEventListener("xr-session-started",this.onXRSessionStarted),this.onSetupDesktop(),!this.getAttribute("src")){const i=globalThis["needle:codegen_files"];Vs&&console.log('src is null, trying to load from globalThis["needle:codegen_files"]',i),i&&(Vs&&console.log('globalThis["needle:codegen_files"]',i),this.setAttribute("src",i))}Vs&&console.log("src",this.getAttribute("src"));const e=this._loadId;setTimeout(()=>{this.isConnected!==!1&&e===this._loadId&&this.onLoad()},1)}disconnectedCallback(){var e;this.removeEventListener("xr-session-started",this.onXRSessionStarted),this._didFullyLoad=!1;const i=this.getAttribute("keep-alive"),s=i==null||i?.length>0&&i!=="true"&&i!=="1";Vs&&console.warn('<needle-engine> disconnected, keep-alive: "'+i+'"',typeof i,"Dispose=",s),s?(Vs&&console.warn("<needle-engine> dispose"),(e=this._context)==null||e.dispose(),this._context=null,this._lastSourceFiles=null,this._loadId+=1):Vs&&console.warn("<needle-engine> is not disposed because keep-alive is set")}attributeChangedCallback(e,i,s){switch(Vs&&console.log("attributeChangedCallback",e,i,s),e){case"src":Vs&&console.warn(`<needle-engine src>
changed from "`,i,'" to "',s,'"'),this.onLoad();break;case"hash":this._context&&(this._context.hash=s);break;case"loadstart":case"progress":case"loadfinished":typeof s=="string"&&s.length>0&&(Vs&&console.log(e+" attribute changed",s),this.registerEventFromAttribute(e,s));break;case"dracoDecoderPath":Vs&&console.log("dracoDecoderPath",s),ane(s);break;case"dracoDecoderType":s==="wasm"||s==="js"?(Vs&&console.log("dracoDecoderType",s),lne(s)):console.error("Invalid dracoDecoderType",s,"expected js or wasm");break;case"ktx2DecoderPath":Vs&&console.log("ktx2DecoderPath",s),cne(s);break;case"tone-mapping":{this.applyAttributes();break}case"tone-mapping-exposure":{this.applyAttributes();break}case"background-blurriness":{const r=parseFloat(s);r!=null&&this._context&&(this._context.scene.backgroundBlurriness=r);break}case"background-color":{this.applyAttributes();break}case"public-key":{s!=Ew&&this.setPublicKey();break}case"version":{s!=xh&&this.setVersion();break}}}async onLoad(){var e,i;if(!this.isConnected)return;if(this._context||(Vs&&console.warn("Create new context"),this._context=new $t({domElement:this})),!this._context){console.error("Needle Engine: Context not initialized");return}const s=this.getSourceFiles();if(!this.checkIfSourceHasChanged(s,this._lastSourceFiles))return;this._abortController&&(Vs&&console.warn("Abort previous loading process"),this._abortController.abort(),this._abortController=null),this._lastSourceFiles=s;const r=++this._loadId;if((s==null||s.length<=0)&&(Vs&&console.warn("Clear scene",s),this._context.clear(),r!==this._loadId))return;const o=this.getAttribute("alias");this.classList.add("loading");const a=Vh();this.ensureLoadStartIsRegistered();let l=this.dispatchEvent(new CustomEvent("loadstart",{detail:{context:this._context,alias:o},cancelable:!0}));if(a){const y=this.getAttribute("hide-loading-overlay");y!=null&&y!=="0"&&(l=!1)}l===!1&&!a&&(Je()||(l=!0),console.warn("Needle Engine: You need a commercial license to override the default loading view. Visit https://needle.tools/pricing"),Je()&&An('You need a <a target="_blank" href="https://needle.tools/pricing">commercial license</a> to override the default loading view. This will not work in production.')),!this._loadingView&&l&&(this._loadingView=new PF(this)),l&&(this._didFullyLoad!==!0?(e=this._loadingView)==null||e.onLoadingBegin("begin load"):setTimeout(()=>{this._loadingView&&this._loadingProgress01<.3&&this._loadId===r&&this._loadingView.onLoadingBegin("begin load")},300)),Vs&&console.warn(`--------------
Needle Engine: Begin loading `+r+`
`,s),this.onBeforeBeginLoading();const c=[],h={context:this._context,name:"",progress:{},index:0,count:s.length,totalProgress01:this._loadingProgress01},d=new CustomEvent("progress",{detail:h}),u=new Array,p=new AbortController;this._abortController=p;const g={files:s,abortSignal:p.signal,onLoadingProgress:y=>{var b;if(p.signal.aborted)return;const v=y.index;!u[v]&&y.name&&(u[v]=lOe(y.name)),y.name=u[v],l&&((b=this._loadingView)==null||b.onLoadingUpdate(y)),h.name=y.name,h.progress=y.progress,this._loadingProgress01=kF(y),h.totalProgress01=this._loadingProgress01,this.dispatchEvent(d)},onLoadingFinished:(y,b,v)=>{p.signal.aborted||v&&c.push({src:b,file:v})}},f=this.getAttribute("hash");f!=null&&(this._context.hash=f),this._context.alias=o,this._createContextPromise=this._context.create(g);const A=await this._createContextPromise;if(this.applyAttributes(),Vs&&console.warn(`--------------
Needle Engine: finished loading `+r+`
`,s,`Aborted? ${p.signal.aborted}`),p.signal.aborted){console.log("Loading finished but aborted...");return}if(this._loadId!==r){console.log("Load id changed during loading process");return}this._loadingProgress01=1,l&&A&&((i=this._loadingView)==null||i.onLoadingUpdate(1,"creating scene")),this._didFullyLoad=!0,this.classList.remove("loading"),this.classList.add("loading-finished"),this.dispatchEvent(new CustomEvent("loadfinished",{detail:{context:this._context,src:o,loadedFiles:c}}))}applyAttributes(){if(this._context.renderer){const s=this.getAttribute("tonemapping")||this.getAttribute("tone-mapping");switch(s?.toLowerCase()){case"none":this._context.renderer.toneMapping=kr;break;case"linear":this._context.renderer.toneMapping=af;break;case"neutral":this._context.renderer.toneMapping=Kp;break;case"agx":this._context.renderer.toneMapping=lf;break;default:s!=null&&console.warn("Invalid tone-mapping attribute: "+s)}const r=this.getAttribute("tone-mapping-exposure");if(r!=null){const o=parseFloat(r);isNaN(o)||(this._context.renderer.toneMappingExposure=o)}}const e=this.getAttribute("background-blurriness");if(e!=null){const s=parseFloat(e);s!==void 0&&this._context&&(this._context.scene.backgroundBlurriness=s)}const i=this.getAttribute("background-color");if(this._context&&typeof i=="string"&&i.length>0){const s=this._context.scene.background;s instanceof fe?s.set(i):this._context.scene.background=new fe(i)}}internalSetLoadingMessage(e){var i;(i=this._loadingView)==null||i.setMessage(e)}getSourceFiles(){const e=this.getAttribute("src");if(!e)return[];let i;Array.isArray(e)?i=e:e.startsWith("[")&&e.endsWith("]")?i=JSON.parse(e):e.includes(",")?i=e.split(","):i=[e];for(let s=i.length-1;s>=0;s--){const r=i[s];(r==="null"||r==="undefined"||r?.length<=0)&&i.splice(s,1)}return i}checkIfSourceHasChanged(e,i){if(e?.length!==i?.length||e==null&&i!==null||e!==null&&i==null)return!0;if(e!==null&&i!==null){for(let s=0;s<e?.length;s++)if(e[s]!==i[s])return!0}return!1}ensureLoadStartIsRegistered(){const e=this.getAttribute("loadstart");e&&this.registerEventFromAttribute("loadstart",e)}registerEventFromAttribute(e,i){const s=this._previouslyRegisteredMap.get(e);if(s&&(this._previouslyRegisteredMap.delete(e),this.removeEventListener(e,s)),typeof i=="string"&&i.length>0)try{const r=(0,eval)(i);typeof r=="function"&&(this._previouslyRegisteredMap.set(e,r),this.addEventListener(e,o=>r?.call(globalThis,this._context,o)))}catch(r){console.error("Error registering event "+e+'="'+i+`" failed with the following error:
`,r)}}setPublicKey(){Ew.length>0&&this.setAttribute("public-key",Ew)}setVersion(){xh.length>0&&this.setAttribute("version",xh)}getAROverlayContainer(){return this._overlay_ar.createOverlayContainer(this)}getVROverlayContainer(){for(let e=0;e<this.children.length;e++){const i=this.children[e];if(i.classList.contains("vr"))return i}return null}onEnterAR(e){var i;this.onSetupAR();const s=this.getAROverlayContainer();this._overlay_ar.onBegin(this._context,s,e),this.dispatchEvent(new CustomEvent("enter-ar",{detail:{session:e,context:this._context,htmlContainer:(i=this._overlay_ar)==null?void 0:i.ARContainer}}))}onExitAR(e){var i;this._overlay_ar.onEnd(this._context),this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-ar",{detail:{session:e,context:this._context,htmlContainer:(i=this._overlay_ar)==null?void 0:i.ARContainer}}))}onEnterVR(e){this.onSetupVR(),this.dispatchEvent(new CustomEvent("enter-vr",{detail:{session:e,context:this._context}}))}onExitVR(e){this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-vr",{detail:{session:e,context:this._context}}))}onSetupAR(){this.classList.add(M_),this.classList.remove(I_);const e=this.getAROverlayContainer();Vs&&console.warn("onSetupAR:",e),e&&(e.classList.add(M_),e.classList.remove(I_)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,one))}onSetupVR(){this.classList.remove(M_),this.classList.remove(I_),this.foreachHtmlElement(e=>this.setupElementsForMode(e,aae))}onSetupDesktop(){this.classList.remove(M_),this.classList.add(I_);const e=this.getAROverlayContainer();e&&(e.classList.remove(M_),e.classList.add(I_)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,lae))}setupElementsForMode(e,i,s=null){var r,o;if(!(e===((o=(r=this._context)==null?void 0:r.renderer)==null?void 0:o.domElement)||e.id==="VRButton"||e.id==="ARButton"))if(e.classList.contains(i))e.style.visibility="visible",e.style.display==="none"&&(e.style.display="block");else for(const a of oOe)e.classList.contains(a)&&(e.style.visibility="hidden",e.style.display="none")}foreachHtmlElement(e){for(let i=0;i<this.children.length;i++){const s=this.children[i];s.style&&e(s)}}onBeforeBeginLoading(){const e=this.getAttribute("dracoDecoderPath");e&&(Vs&&console.log("using custom draco decoder path",e),ane(e));const i=this.getAttribute("dracoDecoderType");i&&(Vs&&console.log("using custom draco decoder type",i),lne(i));const s=this.getAttribute("ktx2DecoderPath");s&&(Vs&&console.log("using custom ktx2 decoder path",s),cne(s))}}typeof window<"u"&&!window.customElements.get(oae)&&window.customElements.define(oae,ZO);function lOe(n){if(n.startsWith("blob:"))return"blob";const e=n.split("/");let i=e[e.length-1];const s=i.indexOf("?");s>0&&(i=i.substring(0,s));const r=i.indexOf("=");r>0&&(i=i.substring(r));const o=i.split(".").pop(),a=o?["glb","gltf","usdz","usd","fbx","obj","mtl"].indexOf(o.toLowerCase()):-1;if(o&&a>=0&&(i=i.substring(0,i.length-o.length-1)),i=decodeURIComponent(i),i.length>3){let l="",c=!1;const h=["(",")","[","]","{","}",":",";",",",".","!","?"];for(let d=0;d<i.length;d++){let u=i[d];(u==="_"||u==="-")&&(u=" "),!(u===" "&&l.length<=0||h.includes(u)||(l.length===0&&(u=u.toUpperCase()),c&&u===" "))&&(c&&(u=u.toUpperCase()),c=!1,l+=u,u===" "&&(c=!0))}return Je()&&i!==l&&console.debug('Generated display name: "'+i+'" \u2192 "'+l+'"'),l.trim()}return Je()&&console.debug("Loading: use default name",i),i}const cOe=Object.freeze(Object.defineProperty({__proto__:null,NeedleEngineHTMLElement:ZO},Symbol.toStringTag,{value:"Module"}));function hOe(){op.registerWaitForInteraction(()=>{const n=bT.getContext();n.addEventListener("statechange",()=>{setTimeout(()=>{const e=n.state;(e==="suspended"||e==="interrupted")&&n.resume().then(()=>{console.log("AudioContext resumed successfully")}).catch(i=>{console.log("Failed to resume AudioContext: "+i)})},500)})})}setTimeout(hOe,1e3);const $B=q("debughotreload");let T_=!1;const E_=new Map;function dOe(){return T_}function uOe(n){var e;if(T_)return;const i=n.constructor.name;E_.has(i)?(e=E_.get(i))==null||e.push(n):E_.set(i,[n])}function pOe(n){if(T_)return;const e=n.constructor.name,i=E_.get(e);if(!i)return;const s=i.indexOf(n);s!==-1&&i.splice(s,1)}let cae=!1;function mOe(){if($B||cae)return;cae=!0;const n=console.error;console.error=(...e)=>{if(e.length){const i=e[0];if(typeof i=="string"&&i.includes("[hmr] Failed to reload ")){console.log("[Needle Engine] Hot reloading failed"),window.location.reload();return}}n.apply(console,e)}}function gOe(n){$B&&console.log("[HMR] Apply changes",n,Object.keys(n)),mOe();for(const e of Object.keys(n))try{T_=!0;const i=Y.get(e);if(!i){$B&&console.log("[HMR] Type not found: "+e);continue}const s=n[e],r=E_.get(s.name);let o="[Needle Engine] Updating type: "+e;const a=r?.length??-1;a>0?o+=" x"+a:o+=" - no instances",console.log(o);const l=Object.getOwnPropertyNames(i.prototype),c=Object.getOwnPropertyDescriptors(s.prototype);for(const h in c)c[h].writable&&(i.prototype[h]=n[e].prototype[h]);for(const h of l)c[h]||delete i.prototype[h];if(r){const h=new s,d=Object.getOwnPropertyDescriptors(h);for(const u of r){const p=u,g=p.isComponent===!0,f=g?p.activeAndEnabled:!0,A=g?p.context:void 0;try{if(g&&A&&sp(p,A),g&&f&&(p.enabled=!1),u.onBeforeHotReloadFields&&u.onBeforeHotReloadFields()===!1)continue;for(const y in d)if(d[y].writable){if(u[y]===void 0)u[y]=h[y];else if(typeof u[y]=="function"&&!u[y].prototype){const b=u[y],v=b.name,x="bound ";if(v===x)continue;const w=b.name.substring(x.length),C=s.prototype[w];C&&(u[y]=C.bind(u))}}u.onAfterHotReloadFields&&u.onAfterHotReloadFields()}finally{g&&A&&Xz(p,A),g&&f&&(p.enabled=!0)}}}}catch(i){if($B)console.error(i);else return!1}finally{T_=!1,bd(Rl.Log,"Script changes applied (HMR)")}return!0}let Ie;const R_=new Array(128).fill(void 0);R_.push(void 0,null,!0,!1),R_.length;let ek=null;function hae(){return ek!==null&&ek.byteLength!==0||(ek=new Int32Array(Ie.memory.buffer)),ek}const fOe=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&fOe.decode();function Xt(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`);return n.ptr}let tk=null;function AOe(){return tk!==null&&tk.byteLength!==0||(tk=new Float32Array(Ie.memory.buffer)),tk}let L_=128;function dae(n){if(L_==1)throw new Error("out of js stack");return R_[--L_]=n,L_}let ik=null;function yOe(){return ik!==null&&ik.byteLength!==0||(ik=new Uint32Array(Ie.memory.buffer)),ik}let cc=0;function wA(n,e){const i=e(4*n.length,4)>>>0;return AOe().set(n,i/4),cc=n.length,i}function nk(n,e){const i=e(4*n.length,4)>>>0;return yOe().set(n,i/4),cc=n.length,i}const zo=Object.freeze({Ball:0,0:"Ball",Cuboid:1,1:"Cuboid",Capsule:2,2:"Capsule",Segment:3,3:"Segment",Polyline:4,4:"Polyline",Triangle:5,5:"Triangle",TriMesh:6,6:"TriMesh",HeightField:7,7:"HeightField",Compound:8,8:"Compound",ConvexPolyhedron:9,9:"ConvexPolyhedron",Cylinder:10,10:"Cylinder",Cone:11,11:"Cone",RoundCuboid:12,12:"RoundCuboid",RoundTriangle:13,13:"RoundTriangle",RoundCylinder:14,14:"RoundCylinder",RoundCone:15,15:"RoundCone",RoundConvexPolyhedron:16,16:"RoundConvexPolyhedron",HalfSpace:17,17:"HalfSpace"});typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawbroadphase_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawccdsolver_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawcharactercollision_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawcolliderset_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawcollidershapecasthit_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawcontactforceevent_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawcontactmanifold_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawcontactpair_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawdebugrenderpipeline_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawdeserializedworld_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawdynamicraycastvehiclecontroller_free(n>>>0));const bOe=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>Ie.__wbg_raweventqueue_free(n>>>0));class vOe{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,bOe.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_raweventqueue_free(e)}constructor(e){const i=Ie.raweventqueue_new(e);return this.__wbg_ptr=i>>>0,this}drainCollisionEvents(e){try{Ie.raweventqueue_drainCollisionEvents(this.__wbg_ptr,dae(e))}finally{R_[L_++]=void 0}}drainContactForceEvents(e){try{Ie.raweventqueue_drainContactForceEvents(this.__wbg_ptr,dae(e))}finally{R_[L_++]=void 0}}clear(){Ie.raweventqueue_clear(this.__wbg_ptr)}}const uae=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>Ie.__wbg_rawgenericjoint_free(n>>>0));class pa{static __wrap(e){e>>>=0;const i=Object.create(pa.prototype);return i.__wbg_ptr=e,uae.register(i,i.__wbg_ptr,i),i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,uae.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_rawgenericjoint_free(e)}static generic(e,i,s,r){Xt(e,Et),Xt(i,Et),Xt(s,Et);const o=Ie.rawgenericjoint_generic(e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r);return o===0?void 0:pa.__wrap(o)}static spring(e,i,s,r,o){Xt(r,Et),Xt(o,Et);const a=Ie.rawgenericjoint_spring(e,i,s,r.__wbg_ptr,o.__wbg_ptr);return pa.__wrap(a)}static rope(e,i,s){Xt(i,Et),Xt(s,Et);const r=Ie.rawgenericjoint_rope(e,i.__wbg_ptr,s.__wbg_ptr);return pa.__wrap(r)}static spherical(e,i){Xt(e,Et),Xt(i,Et);const s=Ie.rawgenericjoint_spherical(e.__wbg_ptr,i.__wbg_ptr);return pa.__wrap(s)}static prismatic(e,i,s,r,o,a){Xt(e,Et),Xt(i,Et),Xt(s,Et);const l=Ie.rawgenericjoint_prismatic(e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r,o,a);return l===0?void 0:pa.__wrap(l)}static fixed(e,i,s,r){Xt(e,Et),Xt(i,Oo),Xt(s,Et),Xt(r,Oo);const o=Ie.rawgenericjoint_fixed(e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr);return pa.__wrap(o)}static revolute(e,i,s){Xt(e,Et),Xt(i,Et),Xt(s,Et);const r=Ie.rawgenericjoint_revolute(e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr);return r===0?void 0:pa.__wrap(r)}}typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawimpulsejointset_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawintegrationparameters_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawislandmanager_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawkinematiccharactercontroller_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawmultibodyjointset_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawnarrowphase_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawphysicspipeline_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawpointcolliderprojection_free(n>>>0));const pae=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>Ie.__wbg_rawpointprojection_free(n>>>0));class FZ{static __wrap(e){e>>>=0;const i=Object.create(FZ.prototype);return i.__wbg_ptr=e,pae.register(i,i.__wbg_ptr,i),i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,pae.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_rawpointprojection_free(e)}point(){const e=Ie.rawpointprojection_point(this.__wbg_ptr);return Et.__wrap(e)}isInside(){return Ie.rawpointprojection_isInside(this.__wbg_ptr)!==0}}typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawquerypipeline_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawraycolliderhit_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawraycolliderintersection_free(n>>>0));const mae=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>Ie.__wbg_rawrayintersection_free(n>>>0));class UZ{static __wrap(e){e>>>=0;const i=Object.create(UZ.prototype);return i.__wbg_ptr=e,mae.register(i,i.__wbg_ptr,i),i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,mae.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_rawrayintersection_free(e)}normal(){const e=Ie.rawcollidershapecasthit_witness1(this.__wbg_ptr);return Et.__wrap(e)}time_of_impact(){return Ie.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}featureType(){return Ie.rawpointcolliderprojection_featureType(this.__wbg_ptr)}featureId(){try{const s=Ie.__wbindgen_add_to_stack_pointer(-16);Ie.rawpointcolliderprojection_featureId(s,this.__wbg_ptr);var e=hae()[s/4+0],i=hae()[s/4+1];return e===0?void 0:i>>>0}finally{Ie.__wbindgen_add_to_stack_pointer(16)}}}typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawrigidbodyset_free(n>>>0));const gae=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>Ie.__wbg_rawrotation_free(n>>>0));class Oo{static __wrap(e){e>>>=0;const i=Object.create(Oo.prototype);return i.__wbg_ptr=e,gae.register(i,i.__wbg_ptr,i),i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,gae.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_rawrotation_free(e)}constructor(e,i,s,r){const o=Ie.rawrotation_new(e,i,s,r);return this.__wbg_ptr=o>>>0,this}static identity(){const e=Ie.rawrotation_identity();return Oo.__wrap(e)}get x(){return Ie.rawrotation_x(this.__wbg_ptr)}get y(){return Ie.rawintegrationparameters_dt(this.__wbg_ptr)}get z(){return Ie.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}get w(){return Ie.rawrotation_w(this.__wbg_ptr)}}typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawsdpmatrix3_free(n>>>0)),typeof FinalizationRegistry>"u"||new FinalizationRegistry(n=>Ie.__wbg_rawserializationpipeline_free(n>>>0));const fae=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>Ie.__wbg_rawshape_free(n>>>0));class Ci{static __wrap(e){e>>>=0;const i=Object.create(Ci.prototype);return i.__wbg_ptr=e,fae.register(i,i.__wbg_ptr,i),i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,fae.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_rawshape_free(e)}static cuboid(e,i,s){const r=Ie.rawshape_cuboid(e,i,s);return Ci.__wrap(r)}static roundCuboid(e,i,s,r){const o=Ie.rawshape_roundCuboid(e,i,s,r);return Ci.__wrap(o)}static ball(e){const i=Ie.rawshape_ball(e);return Ci.__wrap(i)}static halfspace(e){Xt(e,Et);const i=Ie.rawshape_halfspace(e.__wbg_ptr);return Ci.__wrap(i)}static capsule(e,i){const s=Ie.rawshape_capsule(e,i);return Ci.__wrap(s)}static cylinder(e,i){const s=Ie.rawshape_cylinder(e,i);return Ci.__wrap(s)}static roundCylinder(e,i,s){const r=Ie.rawshape_roundCylinder(e,i,s);return Ci.__wrap(r)}static cone(e,i){const s=Ie.rawshape_cone(e,i);return Ci.__wrap(s)}static roundCone(e,i,s){const r=Ie.rawshape_roundCone(e,i,s);return Ci.__wrap(r)}static polyline(e,i){const s=wA(e,Ie.__wbindgen_malloc),r=cc,o=nk(i,Ie.__wbindgen_malloc),a=cc,l=Ie.rawshape_polyline(s,r,o,a);return Ci.__wrap(l)}static trimesh(e,i,s){const r=wA(e,Ie.__wbindgen_malloc),o=cc,a=nk(i,Ie.__wbindgen_malloc),l=cc,c=Ie.rawshape_trimesh(r,o,a,l,s);return Ci.__wrap(c)}static heightfield(e,i,s,r,o){const a=wA(s,Ie.__wbindgen_malloc),l=cc;Xt(r,Et);const c=Ie.rawshape_heightfield(e,i,a,l,r.__wbg_ptr,o);return Ci.__wrap(c)}static segment(e,i){Xt(e,Et),Xt(i,Et);const s=Ie.rawshape_segment(e.__wbg_ptr,i.__wbg_ptr);return Ci.__wrap(s)}static triangle(e,i,s){Xt(e,Et),Xt(i,Et),Xt(s,Et);const r=Ie.rawshape_triangle(e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr);return Ci.__wrap(r)}static roundTriangle(e,i,s,r){Xt(e,Et),Xt(i,Et),Xt(s,Et);const o=Ie.rawshape_roundTriangle(e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r);return Ci.__wrap(o)}static convexHull(e){const i=wA(e,Ie.__wbindgen_malloc),s=cc,r=Ie.rawshape_convexHull(i,s);return r===0?void 0:Ci.__wrap(r)}static roundConvexHull(e,i){const s=wA(e,Ie.__wbindgen_malloc),r=cc,o=Ie.rawshape_roundConvexHull(s,r,i);return o===0?void 0:Ci.__wrap(o)}static convexMesh(e,i){const s=wA(e,Ie.__wbindgen_malloc),r=cc,o=nk(i,Ie.__wbindgen_malloc),a=cc,l=Ie.rawshape_convexMesh(s,r,o,a);return l===0?void 0:Ci.__wrap(l)}static roundConvexMesh(e,i,s){const r=wA(e,Ie.__wbindgen_malloc),o=cc,a=nk(i,Ie.__wbindgen_malloc),l=cc,c=Ie.rawshape_roundConvexMesh(r,o,a,l,s);return c===0?void 0:Ci.__wrap(c)}castShape(e,i,s,r,o,a,l,c,h,d){Xt(e,Et),Xt(i,Oo),Xt(s,Et),Xt(r,Ci),Xt(o,Et),Xt(a,Oo),Xt(l,Et);const u=Ie.rawshape_castShape(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr,o.__wbg_ptr,a.__wbg_ptr,l.__wbg_ptr,c,h,d);return u===0?void 0:OZ.__wrap(u)}intersectsShape(e,i,s,r,o){return Xt(e,Et),Xt(i,Oo),Xt(s,Ci),Xt(r,Et),Xt(o,Oo),Ie.rawshape_intersectsShape(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr,o.__wbg_ptr)!==0}contactShape(e,i,s,r,o,a){Xt(e,Et),Xt(i,Oo),Xt(s,Ci),Xt(r,Et),Xt(o,Oo);const l=Ie.rawshape_contactShape(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr,o.__wbg_ptr,a);return l===0?void 0:ZZ.__wrap(l)}containsPoint(e,i,s){return Xt(e,Et),Xt(i,Oo),Xt(s,Et),Ie.rawshape_containsPoint(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr)!==0}projectPoint(e,i,s,r){Xt(e,Et),Xt(i,Oo),Xt(s,Et);const o=Ie.rawshape_projectPoint(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r);return FZ.__wrap(o)}intersectsRay(e,i,s,r,o){return Xt(e,Et),Xt(i,Oo),Xt(s,Et),Xt(r,Et),Ie.rawshape_intersectsRay(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr,o)!==0}castRay(e,i,s,r,o,a){return Xt(e,Et),Xt(i,Oo),Xt(s,Et),Xt(r,Et),Ie.rawshape_castRay(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr,o,a)}castRayAndGetNormal(e,i,s,r,o,a){Xt(e,Et),Xt(i,Oo),Xt(s,Et),Xt(r,Et);const l=Ie.rawshape_castRayAndGetNormal(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,s.__wbg_ptr,r.__wbg_ptr,o,a);return l===0?void 0:UZ.__wrap(l)}}const Aae=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>Ie.__wbg_rawshapecasthit_free(n>>>0));class OZ{static __wrap(e){e>>>=0;const i=Object.create(OZ.prototype);return i.__wbg_ptr=e,Aae.register(i,i.__wbg_ptr,i),i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Aae.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_rawshapecasthit_free(e)}time_of_impact(){return Ie.rawrotation_x(this.__wbg_ptr)}witness1(){const e=Ie.rawshapecasthit_witness1(this.__wbg_ptr);return Et.__wrap(e)}witness2(){const e=Ie.rawcontactforceevent_total_force(this.__wbg_ptr);return Et.__wrap(e)}normal1(){const e=Ie.rawshapecasthit_normal1(this.__wbg_ptr);return Et.__wrap(e)}normal2(){const e=Ie.rawshapecasthit_normal2(this.__wbg_ptr);return Et.__wrap(e)}}const yae=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>Ie.__wbg_rawshapecontact_free(n>>>0));class ZZ{static __wrap(e){e>>>=0;const i=Object.create(ZZ.prototype);return i.__wbg_ptr=e,yae.register(i,i.__wbg_ptr,i),i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,yae.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_rawshapecontact_free(e)}distance(){return Ie.rawkinematiccharactercontroller_maxSlopeClimbAngle(this.__wbg_ptr)}point1(){const e=Ie.rawpointprojection_point(this.__wbg_ptr);return Et.__wrap(e)}point2(){const e=Ie.rawcollidershapecasthit_witness1(this.__wbg_ptr);return Et.__wrap(e)}normal1(){const e=Ie.rawcollidershapecasthit_witness2(this.__wbg_ptr);return Et.__wrap(e)}normal2(){const e=Ie.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return Et.__wrap(e)}}const bae=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>Ie.__wbg_rawvector_free(n>>>0));class Et{static __wrap(e){e>>>=0;const i=Object.create(Et.prototype);return i.__wbg_ptr=e,bae.register(i,i.__wbg_ptr,i),i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,bae.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_rawvector_free(e)}static zero(){const e=Ie.rawvector_zero();return Et.__wrap(e)}constructor(e,i,s){const r=Ie.rawvector_new(e,i,s);return this.__wbg_ptr=r>>>0,this}get x(){return Ie.rawrotation_x(this.__wbg_ptr)}set x(e){Ie.rawvector_set_x(this.__wbg_ptr,e)}get y(){return Ie.rawintegrationparameters_dt(this.__wbg_ptr)}set y(e){Ie.rawintegrationparameters_set_dt(this.__wbg_ptr,e)}get z(){return Ie.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}set z(e){Ie.rawvector_set_z(this.__wbg_ptr,e)}xyz(){const e=Ie.rawvector_xyz(this.__wbg_ptr);return Et.__wrap(e)}yxz(){const e=Ie.rawvector_yxz(this.__wbg_ptr);return Et.__wrap(e)}zxy(){const e=Ie.rawvector_zxy(this.__wbg_ptr);return Et.__wrap(e)}xzy(){const e=Ie.rawvector_xzy(this.__wbg_ptr);return Et.__wrap(e)}yzx(){const e=Ie.rawvector_yzx(this.__wbg_ptr);return Et.__wrap(e)}zyx(){const e=Ie.rawvector_zyx(this.__wbg_ptr);return Et.__wrap(e)}}class xOe{constructor(e,i,s){this.x=e,this.y=i,this.z=s}}class Ue{static new(e,i,s){return new xOe(e,i,s)}static intoRaw(e){return new Et(e.x,e.y,e.z)}static zeros(){return Ue.new(0,0,0)}static fromRaw(e){if(!e)return null;let i=Ue.new(e.x,e.y,e.z);return e.free(),i}static copy(e,i){e.x=i.x,e.y=i.y,e.z=i.z}}class vae{constructor(e,i,s,r){this.x=e,this.y=i,this.z=s,this.w=r}}class Fn{static identity(){return new vae(0,0,0,1)}static fromRaw(e){if(!e)return null;let i=new vae(e.x,e.y,e.z,e.w);return e.free(),i}static intoRaw(e){return new Oo(e.x,e.y,e.z,e.w)}static copy(e,i){e.x=i.x,e.y=i.y,e.z=i.z,e.w=i.w}}class wOe{constructor(e){this.elements=e}get m11(){return this.elements[0]}get m12(){return this.elements[1]}get m21(){return this.m12}get m13(){return this.elements[2]}get m31(){return this.m13}get m22(){return this.elements[3]}get m23(){return this.elements[4]}get m32(){return this.m23}get m33(){return this.elements[5]}}class xae{static fromRaw(e){const i=new wOe(e.elements());return e.free(),i}}var B_,da,wae,Cae,mr,WO,Ys,Sae,_ae,Mae,sk,HO,Iae,rk,rx;(function(n){n[n.Dynamic=0]="Dynamic",n[n.Fixed=1]="Fixed",n[n.KinematicPositionBased=2]="KinematicPositionBased",n[n.KinematicVelocityBased=3]="KinematicVelocityBased"})(B_||(B_={}));class Tae{constructor(e,i,s){this.rawSet=e,this.colliderSet=i,this.handle=s}finalizeDeserialization(e){this.colliderSet=e}isValid(){return this.rawSet.contains(this.handle)}lockTranslations(e,i){return this.rawSet.rbLockTranslations(this.handle,e,i)}lockRotations(e,i){return this.rawSet.rbLockRotations(this.handle,e,i)}setEnabledTranslations(e,i,s,r){return this.rawSet.rbSetEnabledTranslations(this.handle,e,i,s,r)}restrictTranslations(e,i,s,r){this.setEnabledTranslations(e,i,s,r)}setEnabledRotations(e,i,s,r){return this.rawSet.rbSetEnabledRotations(this.handle,e,i,s,r)}restrictRotations(e,i,s,r){this.setEnabledRotations(e,i,s,r)}dominanceGroup(){return this.rawSet.rbDominanceGroup(this.handle)}setDominanceGroup(e){this.rawSet.rbSetDominanceGroup(this.handle,e)}additionalSolverIterations(){return this.rawSet.rbAdditionalSolverIterations(this.handle)}setAdditionalSolverIterations(e){this.rawSet.rbSetAdditionalSolverIterations(this.handle,e)}enableCcd(e){this.rawSet.rbEnableCcd(this.handle,e)}setSoftCcdPrediction(e){this.rawSet.rbSetSoftCcdPrediction(this.handle,e)}softCcdPrediction(){return this.rawSet.rbSoftCcdPrediction(this.handle)}translation(){let e=this.rawSet.rbTranslation(this.handle);return Ue.fromRaw(e)}rotation(){let e=this.rawSet.rbRotation(this.handle);return Fn.fromRaw(e)}nextTranslation(){let e=this.rawSet.rbNextTranslation(this.handle);return Ue.fromRaw(e)}nextRotation(){let e=this.rawSet.rbNextRotation(this.handle);return Fn.fromRaw(e)}setTranslation(e,i){this.rawSet.rbSetTranslation(this.handle,e.x,e.y,e.z,i)}setLinvel(e,i){let s=Ue.intoRaw(e);this.rawSet.rbSetLinvel(this.handle,s,i),s.free()}gravityScale(){return this.rawSet.rbGravityScale(this.handle)}setGravityScale(e,i){this.rawSet.rbSetGravityScale(this.handle,e,i)}setRotation(e,i){this.rawSet.rbSetRotation(this.handle,e.x,e.y,e.z,e.w,i)}setAngvel(e,i){let s=Ue.intoRaw(e);this.rawSet.rbSetAngvel(this.handle,s,i),s.free()}setNextKinematicTranslation(e){this.rawSet.rbSetNextKinematicTranslation(this.handle,e.x,e.y,e.z)}setNextKinematicRotation(e){this.rawSet.rbSetNextKinematicRotation(this.handle,e.x,e.y,e.z,e.w)}linvel(){return Ue.fromRaw(this.rawSet.rbLinvel(this.handle))}angvel(){return Ue.fromRaw(this.rawSet.rbAngvel(this.handle))}mass(){return this.rawSet.rbMass(this.handle)}effectiveInvMass(){return Ue.fromRaw(this.rawSet.rbEffectiveInvMass(this.handle))}invMass(){return this.rawSet.rbInvMass(this.handle)}localCom(){return Ue.fromRaw(this.rawSet.rbLocalCom(this.handle))}worldCom(){return Ue.fromRaw(this.rawSet.rbWorldCom(this.handle))}invPrincipalInertiaSqrt(){return Ue.fromRaw(this.rawSet.rbInvPrincipalInertiaSqrt(this.handle))}principalInertia(){return Ue.fromRaw(this.rawSet.rbPrincipalInertia(this.handle))}principalInertiaLocalFrame(){return Fn.fromRaw(this.rawSet.rbPrincipalInertiaLocalFrame(this.handle))}effectiveWorldInvInertiaSqrt(){return xae.fromRaw(this.rawSet.rbEffectiveWorldInvInertiaSqrt(this.handle))}effectiveAngularInertia(){return xae.fromRaw(this.rawSet.rbEffectiveAngularInertia(this.handle))}sleep(){this.rawSet.rbSleep(this.handle)}wakeUp(){this.rawSet.rbWakeUp(this.handle)}isCcdEnabled(){return this.rawSet.rbIsCcdEnabled(this.handle)}numColliders(){return this.rawSet.rbNumColliders(this.handle)}collider(e){return this.colliderSet.get(this.rawSet.rbCollider(this.handle,e))}setEnabled(e){this.rawSet.rbSetEnabled(this.handle,e)}isEnabled(){return this.rawSet.rbIsEnabled(this.handle)}bodyType(){return this.rawSet.rbBodyType(this.handle)}setBodyType(e,i){return this.rawSet.rbSetBodyType(this.handle,e,i)}isSleeping(){return this.rawSet.rbIsSleeping(this.handle)}isMoving(){return this.rawSet.rbIsMoving(this.handle)}isFixed(){return this.rawSet.rbIsFixed(this.handle)}isKinematic(){return this.rawSet.rbIsKinematic(this.handle)}isDynamic(){return this.rawSet.rbIsDynamic(this.handle)}linearDamping(){return this.rawSet.rbLinearDamping(this.handle)}angularDamping(){return this.rawSet.rbAngularDamping(this.handle)}setLinearDamping(e){this.rawSet.rbSetLinearDamping(this.handle,e)}recomputeMassPropertiesFromColliders(){this.rawSet.rbRecomputeMassPropertiesFromColliders(this.handle,this.colliderSet.raw)}setAdditionalMass(e,i){this.rawSet.rbSetAdditionalMass(this.handle,e,i)}setAdditionalMassProperties(e,i,s,r,o){let a=Ue.intoRaw(i),l=Ue.intoRaw(s),c=Fn.intoRaw(r);this.rawSet.rbSetAdditionalMassProperties(this.handle,e,a,l,c,o),a.free(),l.free(),c.free()}setAngularDamping(e){this.rawSet.rbSetAngularDamping(this.handle,e)}resetForces(e){this.rawSet.rbResetForces(this.handle,e)}resetTorques(e){this.rawSet.rbResetTorques(this.handle,e)}addForce(e,i){const s=Ue.intoRaw(e);this.rawSet.rbAddForce(this.handle,s,i),s.free()}applyImpulse(e,i){const s=Ue.intoRaw(e);this.rawSet.rbApplyImpulse(this.handle,s,i),s.free()}addTorque(e,i){const s=Ue.intoRaw(e);this.rawSet.rbAddTorque(this.handle,s,i),s.free()}applyTorqueImpulse(e,i){const s=Ue.intoRaw(e);this.rawSet.rbApplyTorqueImpulse(this.handle,s,i),s.free()}addForceAtPoint(e,i,s){const r=Ue.intoRaw(e),o=Ue.intoRaw(i);this.rawSet.rbAddForceAtPoint(this.handle,r,o,s),r.free(),o.free()}applyImpulseAtPoint(e,i,s){const r=Ue.intoRaw(e),o=Ue.intoRaw(i);this.rawSet.rbApplyImpulseAtPoint(this.handle,r,o,s),r.free(),o.free()}userForce(){return Ue.fromRaw(this.rawSet.rbUserForce(this.handle))}userTorque(){return Ue.fromRaw(this.rawSet.rbUserTorque(this.handle))}}(function(n){n[n.Revolute=0]="Revolute",n[n.Fixed=1]="Fixed",n[n.Prismatic=2]="Prismatic",n[n.Rope=3]="Rope",n[n.Spring=4]="Spring",n[n.Spherical=5]="Spherical",n[n.Generic=6]="Generic"})(da||(da={})),function(n){n[n.AccelerationBased=0]="AccelerationBased",n[n.ForceBased=1]="ForceBased"}(wae||(wae={})),function(n){n[n.LinX=1]="LinX",n[n.LinY=2]="LinY",n[n.LinZ=4]="LinZ",n[n.AngX=8]="AngX",n[n.AngY=16]="AngY",n[n.AngZ=32]="AngZ"}(Cae||(Cae={}));class Dp{constructor(){}static fixed(e,i,s,r){let o=new Dp;return o.anchor1=e,o.anchor2=s,o.frame1=i,o.frame2=r,o.jointType=da.Fixed,o}static spring(e,i,s,r,o){let a=new Dp;return a.anchor1=r,a.anchor2=o,a.length=e,a.stiffness=i,a.damping=s,a.jointType=da.Spring,a}static rope(e,i,s){let r=new Dp;return r.anchor1=i,r.anchor2=s,r.length=e,r.jointType=da.Rope,r}static generic(e,i,s,r){let o=new Dp;return o.anchor1=e,o.anchor2=i,o.axis=s,o.axesMask=r,o.jointType=da.Generic,o}static spherical(e,i){let s=new Dp;return s.anchor1=e,s.anchor2=i,s.jointType=da.Spherical,s}static prismatic(e,i,s){let r=new Dp;return r.anchor1=e,r.anchor2=i,r.axis=s,r.jointType=da.Prismatic,r}static revolute(e,i,s){let r=new Dp;return r.anchor1=e,r.anchor2=i,r.axis=s,r.jointType=da.Revolute,r}intoRaw(){let e,i,s=Ue.intoRaw(this.anchor1),r=Ue.intoRaw(this.anchor2),o=!1,a=0,l=0;switch(this.jointType){case da.Fixed:let c=Fn.intoRaw(this.frame1),h=Fn.intoRaw(this.frame2);i=pa.fixed(s,c,r,h),c.free(),h.free();break;case da.Spring:i=pa.spring(this.length,this.stiffness,this.damping,s,r);break;case da.Rope:i=pa.rope(this.length,s,r);break;case da.Prismatic:e=Ue.intoRaw(this.axis),this.limitsEnabled&&(o=!0,a=this.limits[0],l=this.limits[1]),i=pa.prismatic(s,r,e,o,a,l),e.free();break;case da.Generic:e=Ue.intoRaw(this.axis);let d=this.axesMask;i=pa.generic(s,r,e,d);break;case da.Spherical:i=pa.spherical(s,r);break;case da.Revolute:e=Ue.intoRaw(this.axis),i=pa.revolute(s,r,e),e.free()}return s.free(),r.free(),i}}(function(n){n[n.Average=0]="Average",n[n.Min=1]="Min",n[n.Multiply=2]="Multiply",n[n.Max=3]="Max"})(mr||(mr={}));class tM{constructor(e,i,s,r,o){this.distance=e,this.point1=i,this.point2=s,this.normal1=r,this.normal2=o}static fromRaw(e){if(!e)return null;const i=new tM(e.distance(),Ue.fromRaw(e.point1()),Ue.fromRaw(e.point2()),Ue.fromRaw(e.normal1()),Ue.fromRaw(e.normal2()));return e.free(),i}}(function(n){n[n.Vertex=0]="Vertex",n[n.Edge=1]="Edge",n[n.Face=2]="Face",n[n.Unknown=3]="Unknown"})(WO||(WO={}));class Yk{constructor(e,i){this.point=e,this.isInside=i}static fromRaw(e){if(!e)return null;const i=new Yk(Ue.fromRaw(e.point()),e.isInside());return e.free(),i}}class COe{constructor(e,i){this.origin=e,this.dir=i}pointAt(e){return{x:this.origin.x+this.dir.x*e,y:this.origin.y+this.dir.y*e,z:this.origin.z+this.dir.z*e}}}class jk{constructor(e,i,s,r){this.featureType=WO.Unknown,this.featureId=void 0,this.timeOfImpact=e,this.normal=i,r!==void 0&&(this.featureId=r),s!==void 0&&(this.featureType=s)}static fromRaw(e){if(!e)return null;const i=new jk(e.time_of_impact(),Ue.fromRaw(e.normal()),e.featureType(),e.featureId());return e.free(),i}}class iM{constructor(e,i,s,r,o){this.time_of_impact=e,this.witness1=i,this.witness2=s,this.normal1=r,this.normal2=o}static fromRaw(e,i){if(!i)return null;const s=new iM(i.time_of_impact(),Ue.fromRaw(i.witness1()),Ue.fromRaw(i.witness2()),Ue.fromRaw(i.normal1()),Ue.fromRaw(i.normal2()));return i.free(),s}}class WZ extends iM{constructor(e,i,s,r,o,a){super(i,s,r,o,a),this.collider=e}static fromRaw(e,i){if(!i)return null;const s=new WZ(e.get(i.colliderHandle()),i.time_of_impact(),Ue.fromRaw(i.witness1()),Ue.fromRaw(i.witness2()),Ue.fromRaw(i.normal1()),Ue.fromRaw(i.normal2()));return i.free(),s}}class no{static fromRaw(e,i){const s=e.coShapeType(i);let r,o,a,l,c,h,d;switch(s){case zo.Ball:return new QO(e.coRadius(i));case zo.Cuboid:return r=e.coHalfExtents(i),new Eae(r.x,r.y,r.z);case zo.RoundCuboid:return r=e.coHalfExtents(i),o=e.coRoundRadius(i),new Rae(r.x,r.y,r.z,o);case zo.Capsule:return c=e.coHalfHeight(i),h=e.coRadius(i),new Lae(c,h);case zo.Segment:return a=e.coVertices(i),new Bae(Ue.new(a[0],a[1],a[2]),Ue.new(a[3],a[4],a[5]));case zo.Polyline:return a=e.coVertices(i),l=e.coIndices(i),new Pae(a,l);case zo.Triangle:return a=e.coVertices(i),new kae(Ue.new(a[0],a[1],a[2]),Ue.new(a[3],a[4],a[5]),Ue.new(a[6],a[7],a[8]));case zo.RoundTriangle:return a=e.coVertices(i),o=e.coRoundRadius(i),new Gae(Ue.new(a[0],a[1],a[2]),Ue.new(a[3],a[4],a[5]),Ue.new(a[6],a[7],a[8]),o);case zo.HalfSpace:return d=Ue.fromRaw(e.coHalfspaceNormal(i)),new SOe(d);case zo.TriMesh:a=e.coVertices(i),l=e.coIndices(i);const u=e.coTriMeshFlags(i);return new Nae(a,l,u);case zo.HeightField:const p=e.coHeightfieldScale(i),g=e.coHeightfieldHeights(i),f=e.coHeightfieldNRows(i),A=e.coHeightfieldNCols(i),y=e.coHeightFieldFlags(i);return new Vae(f,A,g,p,y);case zo.ConvexPolyhedron:return a=e.coVertices(i),l=e.coIndices(i),new KO(a,l);case zo.RoundConvexPolyhedron:return a=e.coVertices(i),l=e.coIndices(i),o=e.coRoundRadius(i),new YO(a,l,o);case zo.Cylinder:return c=e.coHalfHeight(i),h=e.coRadius(i),new Xae(c,h);case zo.RoundCylinder:return c=e.coHalfHeight(i),h=e.coRadius(i),o=e.coRoundRadius(i),new Dae(c,h,o);case zo.Cone:return c=e.coHalfHeight(i),h=e.coRadius(i),new zae(c,h);case zo.RoundCone:return c=e.coHalfHeight(i),h=e.coRadius(i),o=e.coRoundRadius(i),new Fae(c,h,o);default:throw new Error("unknown shape type: "+s)}}castShape(e,i,s,r,o,a,l,c,h,d){let u=Ue.intoRaw(e),p=Fn.intoRaw(i),g=Ue.intoRaw(s),f=Ue.intoRaw(o),A=Fn.intoRaw(a),y=Ue.intoRaw(l),b=this.intoRaw(),v=r.intoRaw(),x=iM.fromRaw(null,b.castShape(u,p,g,v,f,A,y,c,h,d));return u.free(),p.free(),g.free(),f.free(),A.free(),y.free(),b.free(),v.free(),x}intersectsShape(e,i,s,r,o){let a=Ue.intoRaw(e),l=Fn.intoRaw(i),c=Ue.intoRaw(r),h=Fn.intoRaw(o),d=this.intoRaw(),u=s.intoRaw(),p=d.intersectsShape(a,l,u,c,h);return a.free(),l.free(),c.free(),h.free(),d.free(),u.free(),p}contactShape(e,i,s,r,o,a){let l=Ue.intoRaw(e),c=Fn.intoRaw(i),h=Ue.intoRaw(r),d=Fn.intoRaw(o),u=this.intoRaw(),p=s.intoRaw(),g=tM.fromRaw(u.contactShape(l,c,p,h,d,a));return l.free(),c.free(),h.free(),d.free(),u.free(),p.free(),g}containsPoint(e,i,s){let r=Ue.intoRaw(e),o=Fn.intoRaw(i),a=Ue.intoRaw(s),l=this.intoRaw(),c=l.containsPoint(r,o,a);return r.free(),o.free(),a.free(),l.free(),c}projectPoint(e,i,s,r){let o=Ue.intoRaw(e),a=Fn.intoRaw(i),l=Ue.intoRaw(s),c=this.intoRaw(),h=Yk.fromRaw(c.projectPoint(o,a,l,r));return o.free(),a.free(),l.free(),c.free(),h}intersectsRay(e,i,s,r){let o=Ue.intoRaw(i),a=Fn.intoRaw(s),l=Ue.intoRaw(e.origin),c=Ue.intoRaw(e.dir),h=this.intoRaw(),d=h.intersectsRay(o,a,l,c,r);return o.free(),a.free(),l.free(),c.free(),h.free(),d}castRay(e,i,s,r,o){let a=Ue.intoRaw(i),l=Fn.intoRaw(s),c=Ue.intoRaw(e.origin),h=Ue.intoRaw(e.dir),d=this.intoRaw(),u=d.castRay(a,l,c,h,r,o);return a.free(),l.free(),c.free(),h.free(),d.free(),u}castRayAndGetNormal(e,i,s,r,o){let a=Ue.intoRaw(i),l=Fn.intoRaw(s),c=Ue.intoRaw(e.origin),h=Ue.intoRaw(e.dir),d=this.intoRaw(),u=jk.fromRaw(d.castRayAndGetNormal(a,l,c,h,r,o));return a.free(),l.free(),c.free(),h.free(),d.free(),u}}(function(n){n[n.Ball=0]="Ball",n[n.Cuboid=1]="Cuboid",n[n.Capsule=2]="Capsule",n[n.Segment=3]="Segment",n[n.Polyline=4]="Polyline",n[n.Triangle=5]="Triangle",n[n.TriMesh=6]="TriMesh",n[n.HeightField=7]="HeightField",n[n.ConvexPolyhedron=9]="ConvexPolyhedron",n[n.Cylinder=10]="Cylinder",n[n.Cone=11]="Cone",n[n.RoundCuboid=12]="RoundCuboid",n[n.RoundTriangle=13]="RoundTriangle",n[n.RoundCylinder=14]="RoundCylinder",n[n.RoundCone=15]="RoundCone",n[n.RoundConvexPolyhedron=16]="RoundConvexPolyhedron",n[n.HalfSpace=17]="HalfSpace"})(Ys||(Ys={})),function(n){n[n.FIX_INTERNAL_EDGES=1]="FIX_INTERNAL_EDGES"}(Sae||(Sae={})),function(n){n[n.DELETE_BAD_TOPOLOGY_TRIANGLES=4]="DELETE_BAD_TOPOLOGY_TRIANGLES",n[n.ORIENTED=8]="ORIENTED",n[n.MERGE_DUPLICATE_VERTICES=16]="MERGE_DUPLICATE_VERTICES",n[n.DELETE_DEGENERATE_TRIANGLES=32]="DELETE_DEGENERATE_TRIANGLES",n[n.DELETE_DUPLICATE_TRIANGLES=64]="DELETE_DUPLICATE_TRIANGLES",n[n.FIX_INTERNAL_EDGES=152]="FIX_INTERNAL_EDGES"}(_ae||(_ae={}));class QO extends no{constructor(e){super(),this.type=Ys.Ball,this.radius=e}intoRaw(){return Ci.ball(this.radius)}}class SOe extends no{constructor(e){super(),this.type=Ys.HalfSpace,this.normal=e}intoRaw(){let e=Ue.intoRaw(this.normal),i=Ci.halfspace(e);return e.free(),i}}class Eae extends no{constructor(e,i,s){super(),this.type=Ys.Cuboid,this.halfExtents=Ue.new(e,i,s)}intoRaw(){return Ci.cuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z)}}class Rae extends no{constructor(e,i,s,r){super(),this.type=Ys.RoundCuboid,this.halfExtents=Ue.new(e,i,s),this.borderRadius=r}intoRaw(){return Ci.roundCuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z,this.borderRadius)}}class Lae extends no{constructor(e,i){super(),this.type=Ys.Capsule,this.halfHeight=e,this.radius=i}intoRaw(){return Ci.capsule(this.halfHeight,this.radius)}}class Bae extends no{constructor(e,i){super(),this.type=Ys.Segment,this.a=e,this.b=i}intoRaw(){let e=Ue.intoRaw(this.a),i=Ue.intoRaw(this.b),s=Ci.segment(e,i);return e.free(),i.free(),s}}class kae extends no{constructor(e,i,s){super(),this.type=Ys.Triangle,this.a=e,this.b=i,this.c=s}intoRaw(){let e=Ue.intoRaw(this.a),i=Ue.intoRaw(this.b),s=Ue.intoRaw(this.c),r=Ci.triangle(e,i,s);return e.free(),i.free(),s.free(),r}}class Gae extends no{constructor(e,i,s,r){super(),this.type=Ys.RoundTriangle,this.a=e,this.b=i,this.c=s,this.borderRadius=r}intoRaw(){let e=Ue.intoRaw(this.a),i=Ue.intoRaw(this.b),s=Ue.intoRaw(this.c),r=Ci.roundTriangle(e,i,s,this.borderRadius);return e.free(),i.free(),s.free(),r}}class Pae extends no{constructor(e,i){super(),this.type=Ys.Polyline,this.vertices=e,this.indices=i??new Uint32Array(0)}intoRaw(){return Ci.polyline(this.vertices,this.indices)}}class Nae extends no{constructor(e,i,s){super(),this.type=Ys.TriMesh,this.vertices=e,this.indices=i,this.flags=s}intoRaw(){return Ci.trimesh(this.vertices,this.indices,this.flags)}}class KO extends no{constructor(e,i){super(),this.type=Ys.ConvexPolyhedron,this.vertices=e,this.indices=i}intoRaw(){return this.indices?Ci.convexMesh(this.vertices,this.indices):Ci.convexHull(this.vertices)}}class YO extends no{constructor(e,i,s){super(),this.type=Ys.RoundConvexPolyhedron,this.vertices=e,this.indices=i,this.borderRadius=s}intoRaw(){return this.indices?Ci.roundConvexMesh(this.vertices,this.indices,this.borderRadius):Ci.roundConvexHull(this.vertices,this.borderRadius)}}class Vae extends no{constructor(e,i,s,r,o){super(),this.type=Ys.HeightField,this.nrows=e,this.ncols=i,this.heights=s,this.scale=r,this.flags=o}intoRaw(){let e=Ue.intoRaw(this.scale),i=Ci.heightfield(this.nrows,this.ncols,this.heights,e,this.flags);return e.free(),i}}class Xae extends no{constructor(e,i){super(),this.type=Ys.Cylinder,this.halfHeight=e,this.radius=i}intoRaw(){return Ci.cylinder(this.halfHeight,this.radius)}}class Dae extends no{constructor(e,i,s){super(),this.type=Ys.RoundCylinder,this.borderRadius=s,this.halfHeight=e,this.radius=i}intoRaw(){return Ci.roundCylinder(this.halfHeight,this.radius,this.borderRadius)}}class zae extends no{constructor(e,i){super(),this.type=Ys.Cone,this.halfHeight=e,this.radius=i}intoRaw(){return Ci.cone(this.halfHeight,this.radius)}}class Fae extends no{constructor(e,i,s){super(),this.type=Ys.RoundCone,this.halfHeight=e,this.radius=i,this.borderRadius=s}intoRaw(){return Ci.roundCone(this.halfHeight,this.radius,this.borderRadius)}}(function(n){n[n.EXCLUDE_FIXED=1]="EXCLUDE_FIXED",n[n.EXCLUDE_KINEMATIC=2]="EXCLUDE_KINEMATIC",n[n.EXCLUDE_DYNAMIC=4]="EXCLUDE_DYNAMIC",n[n.EXCLUDE_SENSORS=8]="EXCLUDE_SENSORS",n[n.EXCLUDE_SOLIDS=16]="EXCLUDE_SOLIDS",n[n.ONLY_DYNAMIC=3]="ONLY_DYNAMIC",n[n.ONLY_KINEMATIC=5]="ONLY_KINEMATIC",n[n.ONLY_FIXED=6]="ONLY_FIXED"})(Mae||(Mae={})),function(n){n[n.NONE=0]="NONE",n[n.COLLISION_EVENTS=1]="COLLISION_EVENTS",n[n.CONTACT_FORCE_EVENTS=2]="CONTACT_FORCE_EVENTS"}(sk||(sk={}));class _Oe{free(){this.raw&&this.raw.free(),this.raw=void 0}collider1(){return this.raw.collider1()}collider2(){return this.raw.collider2()}totalForce(){return Ue.fromRaw(this.raw.total_force())}totalForceMagnitude(){return this.raw.total_force_magnitude()}maxForceDirection(){return Ue.fromRaw(this.raw.max_force_direction())}maxForceMagnitude(){return this.raw.max_force_magnitude()}}class MOe{constructor(e,i){this.raw=i||new vOe(e)}free(){this.raw&&this.raw.free(),this.raw=void 0}drainCollisionEvents(e){this.raw.drainCollisionEvents(e)}drainContactForceEvents(e){let i=new _Oe;this.raw.drainContactForceEvents(s=>{i.raw=s,e(i),i.free()})}clear(){this.raw.clear()}}(function(n){n[n.NONE=0]="NONE",n[n.FILTER_CONTACT_PAIRS=1]="FILTER_CONTACT_PAIRS",n[n.FILTER_INTERSECTION_PAIRS=2]="FILTER_INTERSECTION_PAIRS"})(HO||(HO={})),function(n){n[n.EMPTY=0]="EMPTY",n[n.COMPUTE_IMPULSE=1]="COMPUTE_IMPULSE"}(Iae||(Iae={})),function(n){n[n.DYNAMIC_DYNAMIC=1]="DYNAMIC_DYNAMIC",n[n.DYNAMIC_KINEMATIC=12]="DYNAMIC_KINEMATIC",n[n.DYNAMIC_FIXED=2]="DYNAMIC_FIXED",n[n.KINEMATIC_KINEMATIC=52224]="KINEMATIC_KINEMATIC",n[n.KINEMATIC_FIXED=8704]="KINEMATIC_FIXED",n[n.FIXED_FIXED=32]="FIXED_FIXED",n[n.DEFAULT=15]="DEFAULT",n[n.ALL=60943]="ALL"}(rk||(rk={}));class Uae{constructor(e,i,s,r){this.colliderSet=e,this.handle=i,this._parent=s,this._shape=r}finalizeDeserialization(e){this.handle!=null&&(this._parent=e.get(this.colliderSet.raw.coParent(this.handle)))}ensureShapeIsCached(){this._shape||(this._shape=no.fromRaw(this.colliderSet.raw,this.handle))}get shape(){return this.ensureShapeIsCached(),this._shape}isValid(){return this.colliderSet.raw.contains(this.handle)}translation(){return Ue.fromRaw(this.colliderSet.raw.coTranslation(this.handle))}rotation(){return Fn.fromRaw(this.colliderSet.raw.coRotation(this.handle))}isSensor(){return this.colliderSet.raw.coIsSensor(this.handle)}setSensor(e){this.colliderSet.raw.coSetSensor(this.handle,e)}setShape(e){let i=e.intoRaw();this.colliderSet.raw.coSetShape(this.handle,i),i.free(),this._shape=e}setEnabled(e){this.colliderSet.raw.coSetEnabled(this.handle,e)}isEnabled(){return this.colliderSet.raw.coIsEnabled(this.handle)}setRestitution(e){this.colliderSet.raw.coSetRestitution(this.handle,e)}setFriction(e){this.colliderSet.raw.coSetFriction(this.handle,e)}frictionCombineRule(){return this.colliderSet.raw.coFrictionCombineRule(this.handle)}setFrictionCombineRule(e){this.colliderSet.raw.coSetFrictionCombineRule(this.handle,e)}restitutionCombineRule(){return this.colliderSet.raw.coRestitutionCombineRule(this.handle)}setRestitutionCombineRule(e){this.colliderSet.raw.coSetRestitutionCombineRule(this.handle,e)}setCollisionGroups(e){this.colliderSet.raw.coSetCollisionGroups(this.handle,e)}setSolverGroups(e){this.colliderSet.raw.coSetSolverGroups(this.handle,e)}contactSkin(){return this.colliderSet.raw.coContactSkin(this.handle)}setContactSkin(e){return this.colliderSet.raw.coSetContactSkin(this.handle,e)}activeHooks(){return this.colliderSet.raw.coActiveHooks(this.handle)}setActiveHooks(e){this.colliderSet.raw.coSetActiveHooks(this.handle,e)}activeEvents(){return this.colliderSet.raw.coActiveEvents(this.handle)}setActiveEvents(e){this.colliderSet.raw.coSetActiveEvents(this.handle,e)}activeCollisionTypes(){return this.colliderSet.raw.coActiveCollisionTypes(this.handle)}setContactForceEventThreshold(e){return this.colliderSet.raw.coSetContactForceEventThreshold(this.handle,e)}contactForceEventThreshold(){return this.colliderSet.raw.coContactForceEventThreshold(this.handle)}setActiveCollisionTypes(e){this.colliderSet.raw.coSetActiveCollisionTypes(this.handle,e)}setDensity(e){this.colliderSet.raw.coSetDensity(this.handle,e)}setMass(e){this.colliderSet.raw.coSetMass(this.handle,e)}setMassProperties(e,i,s,r){let o=Ue.intoRaw(i),a=Ue.intoRaw(s),l=Fn.intoRaw(r);this.colliderSet.raw.coSetMassProperties(this.handle,e,o,a,l),o.free(),a.free(),l.free()}setTranslation(e){this.colliderSet.raw.coSetTranslation(this.handle,e.x,e.y,e.z)}setTranslationWrtParent(e){this.colliderSet.raw.coSetTranslationWrtParent(this.handle,e.x,e.y,e.z)}setRotation(e){this.colliderSet.raw.coSetRotation(this.handle,e.x,e.y,e.z,e.w)}setRotationWrtParent(e){this.colliderSet.raw.coSetRotationWrtParent(this.handle,e.x,e.y,e.z,e.w)}shapeType(){return this.colliderSet.raw.coShapeType(this.handle)}halfExtents(){return Ue.fromRaw(this.colliderSet.raw.coHalfExtents(this.handle))}setHalfExtents(e){const i=Ue.intoRaw(e);this.colliderSet.raw.coSetHalfExtents(this.handle,i)}radius(){return this.colliderSet.raw.coRadius(this.handle)}setRadius(e){this.colliderSet.raw.coSetRadius(this.handle,e)}roundRadius(){return this.colliderSet.raw.coRoundRadius(this.handle)}setRoundRadius(e){this.colliderSet.raw.coSetRoundRadius(this.handle,e)}halfHeight(){return this.colliderSet.raw.coHalfHeight(this.handle)}setHalfHeight(e){this.colliderSet.raw.coSetHalfHeight(this.handle,e)}vertices(){return this.colliderSet.raw.coVertices(this.handle)}indices(){return this.colliderSet.raw.coIndices(this.handle)}heightfieldHeights(){return this.colliderSet.raw.coHeightfieldHeights(this.handle)}heightfieldScale(){let e=this.colliderSet.raw.coHeightfieldScale(this.handle);return Ue.fromRaw(e)}heightfieldNRows(){return this.colliderSet.raw.coHeightfieldNRows(this.handle)}heightfieldNCols(){return this.colliderSet.raw.coHeightfieldNCols(this.handle)}parent(){return this._parent}friction(){return this.colliderSet.raw.coFriction(this.handle)}restitution(){return this.colliderSet.raw.coRestitution(this.handle)}density(){return this.colliderSet.raw.coDensity(this.handle)}mass(){return this.colliderSet.raw.coMass(this.handle)}volume(){return this.colliderSet.raw.coVolume(this.handle)}collisionGroups(){return this.colliderSet.raw.coCollisionGroups(this.handle)}solverGroups(){return this.colliderSet.raw.coSolverGroups(this.handle)}containsPoint(e){let i=Ue.intoRaw(e),s=this.colliderSet.raw.coContainsPoint(this.handle,i);return i.free(),s}projectPoint(e,i){let s=Ue.intoRaw(e),r=Yk.fromRaw(this.colliderSet.raw.coProjectPoint(this.handle,s,i));return s.free(),r}intersectsRay(e,i){let s=Ue.intoRaw(e.origin),r=Ue.intoRaw(e.dir),o=this.colliderSet.raw.coIntersectsRay(this.handle,s,r,i);return s.free(),r.free(),o}castShape(e,i,s,r,o,a,l,c){let h=Ue.intoRaw(e),d=Ue.intoRaw(s),u=Fn.intoRaw(r),p=Ue.intoRaw(o),g=i.intoRaw(),f=iM.fromRaw(this.colliderSet,this.colliderSet.raw.coCastShape(this.handle,h,g,d,u,p,a,l,c));return h.free(),d.free(),u.free(),p.free(),g.free(),f}castCollider(e,i,s,r,o,a){let l=Ue.intoRaw(e),c=Ue.intoRaw(s),h=WZ.fromRaw(this.colliderSet,this.colliderSet.raw.coCastCollider(this.handle,l,i.handle,c,r,o,a));return l.free(),c.free(),h}intersectsShape(e,i,s){let r=Ue.intoRaw(i),o=Fn.intoRaw(s),a=e.intoRaw(),l=this.colliderSet.raw.coIntersectsShape(this.handle,a,r,o);return r.free(),o.free(),a.free(),l}contactShape(e,i,s,r){let o=Ue.intoRaw(i),a=Fn.intoRaw(s),l=e.intoRaw(),c=tM.fromRaw(this.colliderSet.raw.coContactShape(this.handle,l,o,a,r));return o.free(),a.free(),l.free(),c}contactCollider(e,i){return tM.fromRaw(this.colliderSet.raw.coContactCollider(this.handle,e.handle,i))}castRay(e,i,s){let r=Ue.intoRaw(e.origin),o=Ue.intoRaw(e.dir),a=this.colliderSet.raw.coCastRay(this.handle,r,o,i,s);return r.free(),o.free(),a}castRayAndGetNormal(e,i,s){let r=Ue.intoRaw(e.origin),o=Ue.intoRaw(e.dir),a=jk.fromRaw(this.colliderSet.raw.coCastRayAndGetNormal(this.handle,r,o,i,s));return r.free(),o.free(),a}}(function(n){n[n.Density=0]="Density",n[n.Mass=1]="Mass",n[n.MassProps=2]="MassProps"})(rx||(rx={}));class ds{constructor(e){this.enabled=!0,this.shape=e,this.massPropsMode=rx.Density,this.density=1,this.friction=.5,this.restitution=0,this.rotation=Fn.identity(),this.translation=Ue.zeros(),this.isSensor=!1,this.collisionGroups=4294967295,this.solverGroups=4294967295,this.frictionCombineRule=mr.Average,this.restitutionCombineRule=mr.Average,this.activeCollisionTypes=rk.DEFAULT,this.activeEvents=sk.NONE,this.activeHooks=HO.NONE,this.mass=0,this.centerOfMass=Ue.zeros(),this.contactForceEventThreshold=0,this.contactSkin=0,this.principalAngularInertia=Ue.zeros(),this.angularInertiaLocalFrame=Fn.identity()}static ball(e){const i=new QO(e);return new ds(i)}static capsule(e,i){const s=new Lae(e,i);return new ds(s)}static segment(e,i){const s=new Bae(e,i);return new ds(s)}static triangle(e,i,s){const r=new kae(e,i,s);return new ds(r)}static roundTriangle(e,i,s,r){const o=new Gae(e,i,s,r);return new ds(o)}static polyline(e,i){const s=new Pae(e,i);return new ds(s)}static trimesh(e,i,s){const r=new Nae(e,i,s);return new ds(r)}static cuboid(e,i,s){const r=new Eae(e,i,s);return new ds(r)}static roundCuboid(e,i,s,r){const o=new Rae(e,i,s,r);return new ds(o)}static heightfield(e,i,s,r,o){const a=new Vae(e,i,s,r,o);return new ds(a)}static cylinder(e,i){const s=new Xae(e,i);return new ds(s)}static roundCylinder(e,i,s){const r=new Dae(e,i,s);return new ds(r)}static cone(e,i){const s=new zae(e,i);return new ds(s)}static roundCone(e,i,s){const r=new Fae(e,i,s);return new ds(r)}static convexHull(e){const i=new KO(e,null);return new ds(i)}static convexMesh(e,i){const s=new KO(e,i);return new ds(s)}static roundConvexHull(e,i){const s=new YO(e,null,i);return new ds(s)}static roundConvexMesh(e,i,s){const r=new YO(e,i,s);return new ds(r)}setTranslation(e,i,s){if(typeof e!="number"||typeof i!="number"||typeof s!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:e,y:i,z:s},this}setRotation(e){return Fn.copy(this.rotation,e),this}setSensor(e){return this.isSensor=e,this}setEnabled(e){return this.enabled=e,this}setContactSkin(e){return this.contactSkin=e,this}setDensity(e){return this.massPropsMode=rx.Density,this.density=e,this}setMass(e){return this.massPropsMode=rx.Mass,this.mass=e,this}setMassProperties(e,i,s,r){return this.massPropsMode=rx.MassProps,this.mass=e,Ue.copy(this.centerOfMass,i),Ue.copy(this.principalAngularInertia,s),Fn.copy(this.angularInertiaLocalFrame,r),this}setRestitution(e){return this.restitution=e,this}setFriction(e){return this.friction=e,this}setFrictionCombineRule(e){return this.frictionCombineRule=e,this}setRestitutionCombineRule(e){return this.restitutionCombineRule=e,this}setCollisionGroups(e){return this.collisionGroups=e,this}setSolverGroups(e){return this.solverGroups=e,this}setActiveHooks(e){return this.activeHooks=e,this}setActiveEvents(e){return this.activeEvents=e,this}setActiveCollisionTypes(e){return this.activeCollisionTypes=e,this}setContactForceEventThreshold(e){return this.contactForceEventThreshold=e,this}}for(var PWe={byteLength:function(n){var e=Oae(n),i=e[0],s=e[1];return 3*(i+s)/4-s},toByteArray:function(n){var e,i,s=Oae(n),r=s[0],o=s[1],a=new IOe(function(h,d,u){return 3*(d+u)/4-u}(0,r,o)),l=0,c=o>0?r-4:r;for(i=0;i<c;i+=4)e=Yc[n.charCodeAt(i)]<<18|Yc[n.charCodeAt(i+1)]<<12|Yc[n.charCodeAt(i+2)]<<6|Yc[n.charCodeAt(i+3)],a[l++]=e>>16&255,a[l++]=e>>8&255,a[l++]=255&e;return o===2&&(e=Yc[n.charCodeAt(i)]<<2|Yc[n.charCodeAt(i+1)]>>4,a[l++]=255&e),o===1&&(e=Yc[n.charCodeAt(i)]<<10|Yc[n.charCodeAt(i+1)]<<4|Yc[n.charCodeAt(i+2)]>>2,a[l++]=e>>8&255,a[l++]=255&e),a},fromByteArray:function(n){for(var e,i=n.length,s=i%3,r=[],o=16383,a=0,l=i-s;a<l;a+=o)r.push(EOe(n,a,a+o>l?l:a+o));return s===1?(e=n[i-1],r.push(pu[e>>2]+pu[e<<4&63]+"==")):s===2&&(e=(n[i-2]<<8)+n[i-1],r.push(pu[e>>10]+pu[e>>4&63]+pu[e<<2&63]+"=")),r.join("")}},pu=[],Yc=[],IOe=typeof Uint8Array<"u"?Uint8Array:Array,jO="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ox=0,TOe=jO.length;ox<TOe;++ox)pu[ox]=jO[ox],Yc[jO.charCodeAt(ox)]=ox;function Oae(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=n.indexOf("=");return i===-1&&(i=e),[i,i===e?0:4-i%4]}function EOe(n,e,i){for(var s,r,o=[],a=e;a<i;a+=3)s=(n[a]<<16&16711680)+(n[a+1]<<8&65280)+(255&n[a+2]),o.push(pu[(r=s)>>18&63]+pu[r>>12&63]+pu[r>>6&63]+pu[63&r]);return o.join("")}Yc["-".charCodeAt(0)]=62,Yc["_".charCodeAt(0)]=63;const Fo=q("debugphysics"),JO=q("debugcolliderplacement"),qO=q("debugcollisions"),ROe=q("showcolliders"),$O=q("debugraycasts"),ml=Symbol("needle component"),Oa=Symbol("physics body"),Zae=Symbol("rigidbody");let CA;globalThis.false=globalThis.false!==void 0?globalThis.false:!0,Fo&&console.log("Use Rapier",!1,globalThis.false);const ok=class{constructor(){m(this,"debugRenderColliders",!1),m(this,"debugRenderRaycasts",!1),m(this,"context"),m(this,"_initializePromise"),m(this,"_isInitialized",!1),m(this,"rapierRay",new COe({x:0,y:0,z:0},{x:0,y:0,z:1})),m(this,"raycastVectorsBuffer",new El(()=>new E,10)),m(this,"rapierSphere",null),m(this,"rapierColliderArray",[]),m(this,"rapierIdentityRotation",{x:0,y:0,z:0,w:1}),m(this,"rapierForwardVector",{x:0,y:0,z:1}),m(this,"enabled",!1),m(this,"_tempPosition",new E),m(this,"_tempQuaternion",new Fe),m(this,"_tempScale",new E),m(this,"_tempMatrix",new de),m(this,"_isUpdatingPhysicsWorld",!1),m(this,"_world"),m(this,"_hasCreatedWorld",!1),m(this,"eventQueue"),m(this,"collisionHandler"),m(this,"objects",[]),m(this,"bodies",[]),m(this,"_meshCache",new Map),m(this,"_gravity",{x:0,y:-9.81,z:0}),m(this,"lines"),m(this,"_tempCenterPos",new E),m(this,"_tempCenterVec",new E),m(this,"_tempCenterQuaternion",new Fe)}removeBody(n){var e,i,s;if(!n)return;this.validate();const r=n[Oa];if(n[Oa]=null,r&&this.world){const o=this.objects.findIndex(a=>a===n);if(o>=0){const a=this.bodies[o];if(this.bodies.splice(o,1),this.objects.splice(o,1),a instanceof Uae){const l=a;(e=this.world)==null||e.removeCollider(l,!0);const c=l.parent();c&&c.numColliders()<=0&&(c[ml]||(i=this.world)==null||i.removeRigidBody(c))}else a instanceof Tae&&(a.numColliders()<=0?(s=this.world)==null||s.removeRigidBody(a):Je()&&(a.did_log_removing||setTimeout(()=>{a.numColliders()>0&&(a.did_log_removing=!0,console.warn("RapierPhysics: removing rigidbody with colliders from the physics world is not possible right now, please remove the colliders first"))},1)))}}}updateBody(n,e,i){if(this.validate(),!!this.enabled&&!(n.destroyed||!n.gameObject)&&!(!e&&!i))if(n.isCollider===!0)console.warn("TODO: implement updating collider position");else{const s=n,r=s[Oa];r&&this.syncPhysicsBody(s.gameObject,r,e,i)}}updateProperties(n){if(this.validate(),n.isCollider){const e=n,i=e[Oa];i&&(this.internalUpdateColliderProperties(e,i),e.sharedMaterial&&this.updatePhysicsMaterial(e))}else{const e=n,i=this.internal_getRigidbody(e);i&&this.internalUpdateRigidbodyProperties(e,i)}}addForce(n,e,i){this.validate();const s=this.internal_getRigidbody(n);s?s.addForce(e,i):console.warn("Rigidbody doesn't exist: can not apply force (does your object with the Rigidbody have a collider?)")}addImpulse(n,e,i){this.validate();const s=this.internal_getRigidbody(n);s?s.applyImpulse(e,i):console.warn("Rigidbody doesn't exist: can not apply impulse (does your object with the Rigidbody have a collider?)")}getLinearVelocity(n){this.validate();const e=this.internal_getRigidbody(n);return e?e.linvel():null}getAngularVelocity(n){this.validate();const e=this.internal_getRigidbody(n);return e?e.angvel():null}resetForces(n,e){this.validate();const i=this.internal_getRigidbody(n);i?.resetForces(e)}resetTorques(n,e){this.validate();const i=this.internal_getRigidbody(n);i?.resetTorques(e)}applyImpulse(n,e,i){this.validate();const s=this.internal_getRigidbody(n);s?s.applyImpulse(e,i):console.warn("Rigidbody doesn't exist: can not apply impulse (does your object with the Rigidbody have a collider?)")}wakeup(n){this.validate();const e=this.internal_getRigidbody(n);e?e.wakeUp():console.warn("Rigidbody doesn't exist: can not wake up (does your object with the Rigidbody have a collider?)")}isSleeping(n){this.validate();const e=this.internal_getRigidbody(n);return e?.isSleeping()}setAngularVelocity(n,e,i){this.validate();const s=this.internal_getRigidbody(n);s?s.setAngvel(e,i):console.warn("Rigidbody doesn't exist: can not set angular velocity (does your object with the Rigidbody have a collider?)")}setLinearVelocity(n,e,i){this.validate();const s=this.internal_getRigidbody(n);s?s.setLinvel(e,i):console.warn("Rigidbody doesn't exist: can not set linear velocity (does your object with the Rigidbody have a collider?)")}async initialize(n){return this.context=n,this._initializePromise||(this._initializePromise=this.internalInitialization()),this._initializePromise}async internalInitialization(){return Fo&&console.log("Initialize rapier physics engine"),"env"in import.meta&&{}.VITE_NEEDLE_USE_RAPIER==="false"&&Fo&&console.log("Rapier disabled"),!1}validate(){this._isInitialized||Fo&&(this._lastWarnTime=this._lastWarnTime??0,Date.now()-this._lastWarnTime>1e3&&(this._lastWarnTime=Date.now(),console.warn("Physics engine is not initialized")))}raycast(n,e,i){var s;let r=i?.maxDistance,o=i?.solid;r===void 0&&(r=1/0),o===void 0&&(o=!0);const a=this.getPhysicsRay(this.rapierRay,n,e);if(!a)return null;(this.debugRenderRaycasts||$O)&&Nt.DrawRay(a.origin,a.dir,255,1);const l=(s=this.world)==null?void 0:s.castRay(a,r,o,i?.queryFilterFlags,i?.filterGroups,void 0,void 0,c=>{const h=c[ml];return i!=null&&i.filterPredicate?i.filterPredicate(h):i?.useIgnoreRaycastLayer!==!1?!(h!=null&&h.gameObject.layers.isEnabled(2)):!0});if(l){const c=a.pointAt(l.timeOfImpact),h=this.raycastVectorsBuffer.get();return h.set(c.x,c.y,c.z),{point:h,collider:l.collider[ml]}}return null}raycastAndGetNormal(n,e,i){var s;let r=i?.maxDistance,o=i?.solid;r===void 0&&(r=1/0),o===void 0&&(o=!0);const a=this.getPhysicsRay(this.rapierRay,n,e);if(!a)return null;(this.debugRenderRaycasts||$O)&&Nt.DrawRay(a.origin,a.dir,255,1);const l=(s=this.world)==null?void 0:s.castRayAndGetNormal(a,r,o,i?.queryFilterFlags,i?.filterGroups,void 0,void 0,c=>{const h=c[ml];return i!=null&&i.filterPredicate?i.filterPredicate(h):i?.useIgnoreRaycastLayer!==!1?!(h!=null&&h.gameObject.layers.isEnabled(2)):!0});if(l){const c=a.pointAt(l.timeOfImpact),h=l.normal,d=this.raycastVectorsBuffer.get(),u=this.raycastVectorsBuffer.get();return d.set(c.x,c.y,c.z),u.set(h.x,h.y,h.z),{point:d,normal:u,collider:l.collider[ml]}}return null}getPhysicsRay(n,e,i){var s,r,o;const a=(s=this.context)==null?void 0:s.mainCamera;if(e===void 0){const h=(r=this.context)==null?void 0:r.input.getPointerPosition(0);if(h)e=h;else return null}if(e.z===void 0){if(!a)return console.error("Can not perform raycast from 2d point - no main camera found"),null;const h=this.raycastVectorsBuffer.get();h.x=e.x,h.y=e.y,h.z=0,(h.x>1||h.y>1||h.y<-1||h.x<-1)&&(Fo&&console.warn("Converting screenspace to raycast space",h),(o=this.context)==null||o.input.convertScreenspaceToRaycastSpace(h)),h.unproject(a),e=h}const l=e;n.origin.x=l.x,n.origin.y=l.y,n.origin.z=l.z;const c=this.raycastVectorsBuffer.get();if(i)c.set(i.x,i.y,i.z);else{if(!a)return console.error("Can not perform raycast - no camera found"),null;c.set(n.origin.x,n.origin.y,n.origin.z);const h=ri(a);c.sub(h)}return c.normalize(),n.dir.x=c.x,n.dir.y=c.y,n.dir.z=c.z,n}sphereOverlap(n,e){return this.rapierColliderArray.length=0,this.world?(this.rapierSphere||(this.rapierSphere=new QO(e)),this.rapierSphere.radius=e,(this.debugRenderRaycasts||$O)&&Nt.DrawWireSphere(n,e,3359999,1),this.world.intersectionsWithShape(n,this.rapierIdentityRotation,this.rapierSphere,i=>{const s=i[ml],r=new vse(s.gameObject,s);return this.rapierColliderArray.push(r),!0},void 0,void 0,void 0,void 0,i=>i.isSensor()?!1:i[ml].gameObject.layers.isEnabled(2)==!1),this.rapierColliderArray):this.rapierColliderArray}get world(){return this._world}get isUpdating(){return this._isUpdatingPhysicsWorld}get gravity(){var n;return((n=this.world)==null?void 0:n.gravity)??this._gravity}set gravity(n){this.world?this.world.gravity=n:this._gravity=n}clearCaches(){var n,e,i,s;this._meshCache.clear(),(n=this.eventQueue)!=null&&n.raw&&((e=this.eventQueue)==null||e.free()),(i=this.world)!=null&&i.bodies&&((s=this.world)==null||s.free())}async addBoxCollider(n,e){if(this._isInitialized||await this.initialize(n.context),!n.activeAndEnabled)return;if(!this.enabled){Fo&&console.warn("Physics are disabled");return}const i=n.gameObject,s=Dn(i,this._tempPosition).multiply(e);s.multiplyScalar(.5),s.x<0&&(s.x=Math.abs(s.x)),s.y<0&&(s.y=Math.abs(s.y)),s.z<0&&(s.z=Math.abs(s.z)),s.x==0&&(s.x=1e-7),s.y==0&&(s.y=1e-7),s.z==0&&(s.z=1e-7);const r=ds.cuboid(s.x,s.y,s.z);this.createCollider(n,r)}async addSphereCollider(n){if(this._isInitialized||await this.initialize(n.context),!n.activeAndEnabled)return;if(!this.enabled){Fo&&console.warn("Physics are disabled");return}const e=ds.ball(.5);this.createCollider(n,e),this.updateProperties(n)}async addCapsuleCollider(n,e,i){if(this._isInitialized||await this.initialize(n.context),!n.activeAndEnabled)return;if(!this.enabled){Fo&&console.warn("Physics are disabled");return}const s=n.gameObject,r=Dn(s,this._tempPosition);r.x=Math.abs(r.x),r.y=Math.abs(r.y);const o=i*r.x;e=Math.max(e,o*2);const a=lt.clamp(e*.5*r.y-i*r.x,0,Number.MAX_SAFE_INTEGER),l=ds.capsule(a,o);this.createCollider(n,l)}async addMeshCollider(n,e,i,s){var r,o,a;if(this._isInitialized||await this.initialize(n.context),!n.activeAndEnabled)return;if(!this.enabled){Fo&&console.warn("Physics are disabled");return}let l=e.geometry;if(!l){Fo&&console.warn("Missing mesh geometry",e.name);return}(o=(r=l.index)==null?void 0:r.array)!=null&&o.length||(console.warn(`Your MeshCollider is missing vertices or indices in the assined mesh "${e.name}". Consider providing an indexed geometry.`),l=LLe(l));let c=null;const h=l.getAttribute("position");if(h instanceof xa){const p=h.count;c=new Float32Array(p*3);for(let g=0;g<p;g++){const f=h.getX(g),A=h.getY(g),y=h.getZ(g);c[g*3]=f,c[g*3+1]=A,c[g*3+2]=y}}else c=h.array;const d=(a=l.index)==null?void 0:a.array;if(Math.abs(s.x-1)>1e-4||Math.abs(s.y-1)>1e-4||Math.abs(s.z-1)>1e-4){const p=l.uuid+"_"+s.x+"_"+s.y+"_"+s.z+"_"+i;if(this._meshCache.has(p))Fo&&console.warn("Use cached mesh collider"),c=this._meshCache.get(p);else{(Fo||Je())&&console.warn(`Your MeshCollider "${n.name}" is scaled: consider applying the scale to the collider mesh instead (${s.x}, ${s.y}, ${s.z})`);const g=new Float32Array(c.length);for(let f=0;f<c.length;f+=3)g[f]=c[f]*s.x,g[f+1]=c[f+1]*s.y,g[f+2]=c[f+2]*s.z;c=g,this._meshCache.set(p,g)}}const u=i?ds.convexHull(c):ds.trimesh(c,d);u&&this.createCollider(n,u)}updatePhysicsMaterial(n){if(!n)return;const e=n.sharedMaterial,i=n[Oa];if(i&&e){if(e.bounciness!==void 0&&i.setRestitution(e.bounciness),e.bounceCombine!==void 0)switch(e.bounceCombine){case Jr.Average:i.setRestitutionCombineRule(mr.Average);break;case Jr.Maximum:i.setRestitutionCombineRule(mr.Max);break;case Jr.Minimum:i.setRestitutionCombineRule(mr.Min);break;case Jr.Multiply:i.setRestitutionCombineRule(mr.Multiply);break}if(e.dynamicFriction!==void 0&&i.setFriction(e.dynamicFriction),e.frictionCombine!==void 0)switch(e.frictionCombine){case Jr.Average:i.setFrictionCombineRule(mr.Average);break;case Jr.Maximum:i.setFrictionCombineRule(mr.Max);break;case Jr.Minimum:i.setFrictionCombineRule(mr.Min);break;case Jr.Multiply:i.setFrictionCombineRule(mr.Multiply);break}}}getBody(n){return n?n[Oa]:null}getComponent(n){return n?n[ml]:null}createCollider(n,e){var i;if(!this.world)throw new Error("Physics world not initialized");const s=this._tempMatrix;let r;n.attachedRigidbody?r=this.getRigidbody(n,this._tempMatrix):(Fo&&console.log("Create collider without rigidbody",n.name),s.makeRotationFromQuaternion(fn(n.gameObject)),s.setPosition(ri(n.gameObject))),s.decompose(this._tempPosition,this._tempQuaternion,this._tempScale),this.tryApplyCenter(n,this._tempPosition),e.setTranslation(this._tempPosition.x,this._tempPosition.y,this._tempPosition.z),e.setRotation(this._tempQuaternion),e.setSensor(n.isTrigger);const o=n.sharedMaterial;if(o){if(o.bounciness!==void 0&&e.setRestitution(o.bounciness),o.bounceCombine!==void 0)switch(o.bounceCombine){case Jr.Average:e.setRestitutionCombineRule(mr.Average);break;case Jr.Maximum:e.setRestitutionCombineRule(mr.Max);break;case Jr.Minimum:e.setRestitutionCombineRule(mr.Min);break;case Jr.Multiply:e.setRestitutionCombineRule(mr.Multiply);break}if(o.dynamicFriction!==void 0&&e.setFriction(o.dynamicFriction),o.frictionCombine!==void 0)switch(o.frictionCombine){case Jr.Average:e.setFrictionCombineRule(mr.Average);break;case Jr.Maximum:e.setFrictionCombineRule(mr.Max);break;case Jr.Minimum:e.setFrictionCombineRule(mr.Min);break;case Jr.Multiply:e.setFrictionCombineRule(mr.Multiply);break}}((i=n.attachedRigidbody)==null?void 0:i.autoMass)===!1&&(e.setDensity(1e-6),e.setMass(1e-6));try{const a=this.world.createCollider(e,r);return a[ml]=n,n[Oa]=a,a.setActiveEvents(sk.COLLISION_EVENTS),a.setActiveCollisionTypes(rk.ALL),this.objects.push(n),this.bodies.push(a),this.updateColliderCollisionGroups(n),a}catch(a){return console.error('Error creating collider "'+n.name+`"
Error:`,a),null}}updateColliderCollisionGroups(n){const e=n[Oa],i=n.membership;let s=0;if(i==null)s=65535;else for(let a=0;a<i.length;a++){const l=i[a];l>31?console.error(`Rapier only supports 32 layers, layer ${l} is not supported`):s|=1<<Math.floor(l)}const r=n.filter;let o=0;if(r==null)o=65535;else for(let a=0;a<r.length;a++){const l=r[a];l>31?console.error(`Rapier only supports 32 layers, layer ${l} is not supported`):o|=1<<Math.floor(l)}e.setCollisionGroups(s<<16|o)}getRigidbody(n,e){if(!this.world)throw new Error("Physics world not initialized");let i=null;if(n.attachedRigidbody){const s=n.attachedRigidbody;if(i=s[Oa],!i){const r=s.isKinematic&&!JO;Fo&&console.log("Create rigidbody",r);const o=r?CA.RigidBodyDesc.kinematicPositionBased():CA.RigidBodyDesc.dynamic(),a=ri(n.attachedRigidbody.gameObject);o.setTranslation(a.x,a.y,a.z),o.setRotation(fn(n.attachedRigidbody.gameObject)),o.centerOfMass=new CA.Vector3(s.centerOfMass.x,s.centerOfMass.y,s.centerOfMass.z),i=this.world.createRigidBody(o),this.bodies.push(i),this.objects.push(s)}i[ml]=s,s[Oa]=i,this.internalUpdateRigidbodyProperties(s,i),this.getRigidbodyRelativeMatrix(n.gameObject,s.gameObject,e),n[Zae]=i}else{const s=CA.RigidBodyDesc.kinematicPositionBased(),r=ri(n.gameObject);s.setTranslation(r.x,r.y,r.z),s.setRotation(fn(n.gameObject)),i=this.world.createRigidBody(s),e.identity(),i[ml]=null}return i}internal_getRigidbody(n){return n.isCollider===!0?n[Zae]:n[Oa]}internalUpdateColliderProperties(n,e){const i=e.shape;let s=!1;switch(i.type){case Ys.Ball:{const u=i,p=n,g=n.gameObject,f=Dn(g,this._tempPosition),A=Math.abs(p.radius*f.x);s=u.radius!==A,u.radius=A,s&&e.setShape(u);break}case Ys.Cuboid:const r=i,o=n,a=n.gameObject,l=Dn(a,this._tempPosition),c=o.size.x*.5*l.x,h=o.size.y*.5*l.y,d=o.size.z*.5*l.z;s=r.halfExtents.x!==c||r.halfExtents.y!==h||r.halfExtents.z!==d,r.halfExtents.x=c,r.halfExtents.y=h,r.halfExtents.z=d,s&&e.setShape(r);break}if(s){const r=n.attachedRigidbody;if(r!=null&&r.autoMass){const o=this.getBody(r);o?.recomputeMassPropertiesFromColliders()}}this.updateColliderCollisionGroups(n),n.isTrigger!==e.isSensor()&&e.setSensor(n.isTrigger)}internalUpdateRigidbodyProperties(n,e){if(e.enableCcd(n.collisionDetectionMode!==gL.Discrete),e.setLinearDamping(n.drag),e.setAngularDamping(n.angularDrag),e.setGravityScale(n.useGravity?n.gravityScale:0,!0),n.dominanceGroup<=127&&n.dominanceGroup>=-127?e.setDominanceGroup(Math.floor(n.dominanceGroup)):e.setDominanceGroup(0),n.autoMass){e.setAdditionalMass(0,!1);for(let i=0;i<e.numColliders();i++)e.collider(i).setDensity(1);e.recomputeMassPropertiesFromColliders()}else{e.setAdditionalMass(n.mass,!1);for(let i=0;i<e.numColliders();i++)e.collider(i).setDensity(1e-7);e.recomputeMassPropertiesFromColliders()}e.setEnabledRotations(!n.lockRotationX,!n.lockRotationY,!n.lockRotationZ,!1),e.setEnabledTranslations(!n.lockPositionX,!n.lockPositionY,!n.lockPositionZ,!1),n.isKinematic?e.setBodyType(CA.RigidBodyType.KinematicPositionBased,!1):e.setBodyType(CA.RigidBodyType.Dynamic,!1)}step(n){if(this.world&&this.enabled){if(this._isUpdatingPhysicsWorld=!0,this.eventQueue||(this.eventQueue=new MOe(!1)),n===void 0||n<=0){this._isUpdatingPhysicsWorld=!1;return}else n!==void 0&&(this.world.timestep=lt.lerp(this.world.timestep,n,.8));try{this.world.step(this.eventQueue)}catch(e){console.warn("Error running physics step",e)}this._isUpdatingPhysicsWorld=!1}}postStep(){this.world&&this.enabled&&(this._isUpdatingPhysicsWorld=!0,this.syncObjects(),this._isUpdatingPhysicsWorld=!1,this.eventQueue&&!this.collisionHandler&&(this.collisionHandler=new LOe(this.world,this.eventQueue)),this.collisionHandler&&(this.collisionHandler.handleCollisionEvents(),this.collisionHandler.update()),this.updateDebugRendering(this.world))}updateDebugRendering(n){var e,i,s,r;if(Fo||JO||ROe||this.debugRenderColliders===!0){if(!this.lines){const a=new Cn({color:7855479,fog:!1}),l=new Rt;this.lines=new Jo(l,a),this.lines.layers.disableAll(),this.lines.layers.enable(2)}this.lines.parent!==((e=this.context)==null?void 0:e.scene)&&((i=this.context)==null||i.scene.add(this.lines));const o=n.debugRender();this.lines.geometry.setAttribute("position",new ct(o.vertices,3)),this.lines.geometry.setAttribute("color",new ct(o.colors,4)),(this.context.time.frame%30===0||((s=this.lines.geometry.boundingSphere)==null?void 0:s.radius)===0)&&this.lines.geometry.computeBoundingSphere()}else this.lines&&((r=this.context)==null||r.scene.remove(this.lines))}syncObjects(){if(!JO)for(let n=0;n<this.bodies.length;n++){const e=this.objects[n],i=this.bodies[n],s=e;if(s?.isCollider===!0&&!s.attachedRigidbody){const l=i.parent();l?this.syncPhysicsBody(e.gameObject,l,!0,!0):this.syncPhysicsBody(e.gameObject,i,!0,!0);continue}const r=i.translation(),o=i.rotation();if(Number.isNaN(r.x)||Number.isNaN(o.x)){!s.__COLLIDER_NAN&&Je()&&(console.warn("Collider has NaN values",s.name,s.gameObject,i),s.__COLLIDER_NAN=!0);continue}const a=e.center;if(a&&a.isVector3){this._tempQuaternion.set(o.x,o.y,o.z,o.w);const l=this._tempPosition.copy(a).applyQuaternion(this._tempQuaternion),c=Dn(e.gameObject);l.multiply(c),r.x-=l.x,r.y-=l.y,r.z-=l.z}o0(e.gameObject,r.x,r.y,r.z),aD(e.gameObject,o.x,o.y,o.z,o.w)}}syncPhysicsBody(n,e,i,s){if(e instanceof Tae){const r=ri(n,this._tempPosition),o=fn(n,this._tempQuaternion);switch(e.bodyType()){case B_.Fixed:case B_.KinematicPositionBased:case B_.KinematicVelocityBased:i&&e.setNextKinematicTranslation(r),s&&e.setNextKinematicRotation(o);break;default:i&&e.setTranslation(r,!1),s&&e.setRotation(o,!1);break}}else if(e instanceof Uae){n.matrixWorldNeedsUpdate&&n.updateWorldMatrix(!0,!1),n.matrixWorld.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const r=this._tempPosition,o=this._tempQuaternion,a=e[ml];if(this.tryApplyCenter(a,r),i){const l=e.translation();(l.x!==r.x||l.y!==r.y||l.z!==r.z)&&e.setTranslation(r)}if(s){const l=e.rotation();(l.x!==o.x||l.y!==o.y||l.z!==o.z||l.w!==o.w)&&e.setRotation(o)}}}tryApplyCenter(n,e){const i=n.center;i&&n.gameObject&&(i.x!==0||i.y!==0||i.z!==0)&&(this._tempCenterPos.x=i.x,this._tempCenterPos.y=i.y,this._tempCenterPos.z=i.z,Dn(n.gameObject,this._tempCenterVec),this._tempCenterPos.multiply(this._tempCenterVec),n.attachedRigidbody?this._tempCenterPos.applyQuaternion(n.gameObject.quaternion):(fn(n.gameObject,this._tempCenterQuaternion),this._tempCenterPos.applyQuaternion(this._tempCenterQuaternion)),e.x+=this._tempCenterPos.x,e.y+=this._tempCenterPos.y,e.z+=this._tempCenterPos.z)}getRigidbodyRelativeMatrix(n,e,i,s){if(s===void 0&&(s=ok._matricesBuffer,s.length=0),n===e){const r=Dn(n,this._tempPosition);i.makeScale(r.x,r.y,r.z);for(let o=s.length-1;o>=0;o--)i.multiply(s[o]);return i}return s.push(n.matrix),n.parent&&this.getRigidbodyRelativeMatrix(n.parent,e,i,s),i}addFixedJoint(n,e){if(!this.world){console.error("Physics world not initialized");return}const i=n[Oa],s=e[Oa];this.calculateJointRelativeMatrices(n.gameObject,e.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const r=Dp.fixed(ok.centerConnectionPos,ok.centerConnectionRot,this._tempPosition,this._tempQuaternion),o=this.world.createImpulseJoint(r,i,s,!0);Fo&&console.log("ADD FIXED JOINT",o)}addHingeJoint(n,e,i,s){if(!this.world){console.error("Physics world not initialized");return}const r=n[Oa],o=e[Oa];this.calculateJointRelativeMatrices(n.gameObject,e.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const a=CA.JointData.revolute(i,this._tempPosition,s),l=this.world.createImpulseJoint(a,r,o,!0);Fo&&console.log("ADD HINGE JOINT",l)}calculateJointRelativeMatrices(n,e,i){n.updateWorldMatrix(!0,!1),e.updateWorldMatrix(!0,!1);const s=n.matrixWorld,r=e.matrixWorld;s.elements[0]=1,s.elements[5]=1,s.elements[10]=1,r.elements[0]=1,r.elements[5]=1,r.elements[10]=1,i.copy(r).premultiply(s.invert()).invert()}};let k_=ok;m(k_,"_didLoadPhysicsEngine",!1),m(k_,"_matricesBuffer",[]),m(k_,"centerConnectionPos",{x:0,y:0,z:0}),m(k_,"centerConnectionRot",{x:0,y:0,z:0,w:1});class LOe{constructor(e,i){m(this,"world"),m(this,"eventQueue"),m(this,"activeCollisions",[]),m(this,"activeCollisionsStay",[]),m(this,"activeTriggers",[]),this.world=e,this.eventQueue=i}handleCollisionEvents(){this.eventQueue&&this.world&&this.eventQueue.drainCollisionEvents((e,i,s)=>{const r=this.world.getCollider(e),o=this.world.getCollider(i);if(!r||!o)return;const a=r[ml],l=o[ml];qO&&console.log("EVT",a.name,l.name,s,r,o),a&&l&&(s?(this.onCollisionStarted(a,r,l,o),this.onCollisionStarted(l,o,a,r)):(this.onCollisionEnded(a,l),this.onCollisionEnded(l,a)))})}update(){this.onHandleCollisionStay()}onCollisionStarted(e,i,s,r){let o=null;if(e.isTrigger||s.isTrigger)P0(e.gameObject,a=>{a.onTriggerEnter&&!a.destroyed&&a.onTriggerEnter(s),this.activeTriggers.push({collider:e,component:a,otherCollider:s})});else{const a=e.gameObject;this.world.contactPair(i,r,(l,c)=>{P0(a,h=>{var d;if(h.destroyed)return;const u=h.onCollisionEnter||h.onCollisionStay||h.onCollisionExit;if(u||qO){if(!o){const p=[],g=l.normal();for(let f=0;f<l.numSolverContacts();f++){const A=l.solverContactPoint(f),y=l.contactImpulse(f);if(A){const b=l.contactDist(f),v=l.solverContactFriction(f),x=l.solverContactTangentVelocity(f),w=new yse(A,b,g,y,v,x);p.push(w),qO&&Nt.DrawDirection(A,g,16711680,3,!0)}}o=new bse(a,s,p)}if(u){const p={collider:e,component:h,collision:o};this.activeCollisions.push(p),h.onCollisionStay&&this.activeCollisionsStay.push(p),(d=h.onCollisionEnter)==null||d.call(h,o)}}})})}}onHandleCollisionStay(){for(const e of this.activeCollisionsStay){const i=e.component;if(!i.destroyed&&i.activeAndEnabled&&i.onCollisionStay){if(e.collision.collider.destroyed)continue;const s=e.collision;i.onCollisionStay(s)}}for(const e of this.activeTriggers){const i=e.component;if(!i.destroyed&&i.activeAndEnabled&&i.onTriggerStay){const s=e.otherCollider;if(s.destroyed)continue;i.onTriggerStay(s)}}}onCollisionEnded(e,i){if(!(e.destroyed||i.destroyed)){for(let s=0;s<this.activeCollisions.length;s++){const r=this.activeCollisions[s],o=r.collider;if(o.destroyed||r.collision.collider.destroyed){this.activeCollisions.splice(s,1),s--;continue}if(o===e&&r.collision.collider===i){const a=r.component;if(this.activeCollisions.splice(s,1),s--,a.activeAndEnabled&&a.onCollisionExit){const l=r.collision;a.onCollisionExit(l)}}}for(let s=0;s<this.activeCollisionsStay.length;s++){const r=this.activeCollisionsStay[s],o=r.collider;if(o.destroyed||r.collision.collider.destroyed){this.activeCollisionsStay.splice(s,1),s--;continue}if(o===e&&r.collision.collider===i){const a=r.component;if(this.activeCollisionsStay.splice(s,1),s--,a.activeAndEnabled&&a.onCollisionExit){const l=r.collision;a.onCollisionExit(l)}}}for(let s=0;s<this.activeTriggers.length;s++){const r=this.activeTriggers[s],o=r.collider;if(o.destroyed||r.otherCollider.destroyed){this.activeTriggers.splice(s,1),s--;continue}if(o===e&&r.otherCollider===i){const a=r.component;if(this.activeTriggers.splice(s,1),s--,a.activeAndEnabled&&a.onTriggerExit){const l=r.otherCollider;a.onTriggerExit(l)}}}}}}class BOe{static async createComparisonScene(e){const{files:i}=e,s=await Promise.all(i.map(f=>new Mi(f).loadAssetAsync())),r=new ir;let o=0;for(const f of s)if(f instanceof Ae){f.position.y=o,r.add(f);const A=Ll([f]);o+=A.getSize(new E).y,o+=.1}const a=new Ot(20);r.add(a);const l=e.environment||"https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/studio_small_09_1k.exr";if(l){let f=null;if(l.endsWith(".hdr")){const A=(await Promise.resolve().then(()=>tGe)).RGBELoader;f=new A}else if(l.endsWith(".exr")){const A=(await Promise.resolve().then(()=>eGe)).EXRLoader;f=new A}if(f){const A=await f.loadAsync(l).catch(y=>(console.error(y),null));A&&(A.mapping=ao,A.needsUpdate=!0,r.background=A,r.environment=A,r.backgroundBlurriness=.75)}else console.warn("Unsupported environment map format",l)}const c=Ll(r.children),h=c.getCenter(new E),d=c.getSize(new E),u=Math.max(d.x,d.y,d.z)/(2*Math.tan(Math.PI*a.fov/360));a.position.set(h.x,h.y,u),a.lookAt(h);const p=new $ne(a,e.domElement||document.body);p.target=h,p.update();const g=(e.domElement||document.body).getBoundingClientRect();return a.aspect=g.width/g.height,a.updateProjectionMatrix(),{scene:r,camera:a}}}let eZ=0;function Wae(n){n?eZ++:eZ--}function kOe(){return eZ>0}class Hae{constructor(e){m(this,"writer"),this.writer=e}writeNode(e){}}class GOe extends Hae{beforeWriteNode(e,i){Nt.isGizmo(e)&&(i.keep=!1)}}class POe extends Hae{beforeWriteTexture(e,i){e.isRenderTargetTexture&&(i.newTexture=wF(new pn(1,1,1,0)))}}const NOe={binary:!0,animations:!0};async function VOe(n){if(!n.context)throw new Error("No context provided to exportAsGLTF");n.scene||(n.scene=n.context.scene);const e={...NOe,...n},{context:i}=e,s=new CB;s.register(l=>new Lre(l)),s.register(l=>new GOe(l)),s.register(l=>new POe(l)),t3(s,e.context);const r={binary:e.binary,animations:DOe(i,e.scene,[])},o=new XOe;console.log("Exporting GLTF",r),o.onBeforeExport(e),Wae(!0);const a=await s.parseAsync(e.scene,r).catch(l=>(console.error(l),null));if(Wae(!1),o.onAfterExport(e),!a)throw new Error("Failed to export GLTF");if(e.downloadAs!=null){let l=null;if(a instanceof ArrayBuffer?l=new Blob([a],{type:"application/octet-stream"}):console.error("Can not download GLTF as a blob",a),l){const c=URL.createObjectURL(l),h=document.createElement("a");h.href=c;let d=e.downloadAs;!d.endsWith(".glb")&&!d.endsWith(".gltf")&&(d+=e.binary?".glb":".gltf"),h.download=d,h.click()}}return a}const Qae=Symbol("needle:weight");class XOe{constructor(){m(this,"_undo",[])}onBeforeExport(e){e.context.animations.mixers.forEach(i=>{const s=Jb.tryGetActionsFromMixer(i);if(s)for(let r=0;r<s.length;r++){const o=s[r];o[Qae]=o.weight,o.weight=0,this._undo.push(()=>{o.weight=o[Qae]})}i.update(0)})}onAfterExport(e){this._undo.forEach(i=>i()),this._undo.length=0}}function DOe(n,e,i){n.animations.mixers.forEach(r=>{const o=Jb.tryGetActionsFromMixer(r);if(o)for(let a=0;a<o.length;a++){const l=o[a].getClip();i.push(l)}}),Array.isArray(e)||(e=[e]);for(const r of e)Jb.tryGetAnimationClipsFromObjectHierarchy(r,i);const s=new Set(i);return Array.from(s)}const Kae="needle-button",tZ=Je();var SA,_A,MA,gl,Kh,ax,iZ,Yae,nZ,jae,ak;class sZ extends HTMLElement{constructor(){super(),mc(this,iZ),mc(this,nZ),mc(this,SA,void 0),mc(this,_A,void 0),mc(this,MA,void 0),mc(this,gl,void 0),mc(this,Kh,void 0),mc(this,ax,void 0),mc(this,ak,e=>{tZ&&console.log("Needle Button clicked"),!e.defaultPrevented&&Hi(this,gl)&&Hi(this,gl).click()}),this.removeEventListener("click",Hi(this,ak)),this.addEventListener("click",Hi(this,ak))}attributeChangedCallback(e,i,s){FA(this,iZ,Yae).call(this)}}SA=new WeakMap,_A=new WeakMap,MA=new WeakMap,gl=new WeakMap,Kh=new WeakMap,ax=new WeakMap,iZ=new WeakSet,Yae=function(){var n,e;if((n=Hi(this,gl))==null||n.remove(),this.getAttribute("ar")!=null)Hi(this,Kh)??td(this,Kh,new nA),td(this,gl,Hi(this,Kh).createARButton());else if(this.getAttribute("vr")!=null)Hi(this,Kh)??td(this,Kh,new nA),td(this,gl,Hi(this,Kh).createVRButton());else if(this.getAttribute("quicklook")!=null)Hi(this,Kh)??td(this,Kh,new nA),td(this,gl,Hi(this,Kh).createQuicklookButton());else{tZ?console.warn("No button type specified for <needle-button>. Use either ar, vr or quicklook attribute."):console.debug("No button type specified for <needle-button>. Use either ar, vr or quicklook attribute.");return}Hi(this,SA)??td(this,SA,this.attachShadow({mode:"open"})),Hi(this,_A)??td(this,_A,document.createElement("slot")),Hi(this,MA)??td(this,MA,document.createElement("style")),Hi(this,MA).innerHTML=`
            button {
                all: initial;
                cursor: inherit;
                color: inherit;
                font-family: inherit;
                gap: inherit;
                white-space: nowrap;
            }
        `,this.getAttribute("unstyled")!=null||(Hi(this,MA).innerHTML+=`
            :host {
                display: inline-block;
                background: rgba(255, 255, 255, .8);
                backdrop-filter: blur(10px);
                width: fit-content;
                transition: background .2s;

                cursor: pointer;
                padding: 0.4rem .5rem;
                border-radius: 0.8rem;
                color: black;
                background: rgba(245, 245, 245, .8);
                outline: rgba(0,0,0,.05) 1px solid;
            }
            :host(:hover) {
                background: rgba(255, 255, 255, 1);
                transition: background .2s;
            }
            slot {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: .5rem;
            }
`),Hi(this,_A).innerHTML=Hi(this,gl).innerHTML,Hi(this,_A).style.cssText="display: flex; align-items: center; justify-content: center;",Hi(this,gl).innerHTML=Hi(this,_A).outerHTML,Hi(this,SA).innerHTML=Hi(this,gl).outerHTML,Hi(this,SA).prepend(Hi(this,MA)),K2(IF,{element:Hi(this,SA)}),(e=Hi(this,ax))==null||e.disconnect(),Hi(this,ax)??td(this,ax,new MutationObserver(()=>FA(this,nZ,jae).call(this))),Hi(this,ax).observe(Hi(this,gl),{attributes:!0}),tZ&&console.log("Needle Button updated")},nZ=new WeakSet,jae=function(){Hi(this,gl)&&(Hi(this,gl).style.display==="none"?this.style.display="none":this.style.display==="none"&&(this.style.display=""))},ak=new WeakMap,m(sZ,"observedAttributes",["ar","vr","quicklook"]),typeof window<"u"&&!window.customElements.get(Kae)&&window.customElements.define(Kae,sZ);const lk=q("debugmissingcamera");ji.registerCallback(nn.MissingCamera,n=>{var e,i,s;lk&&console.warn("Creating missing camera");const r=n.context.scene,o=new Ot;o.name="Default Fallback Camera",r.add(o);const a=new In;a.sourceId=((i=(e=n.files)==null?void 0:e[0])==null?void 0:i.src)??"unknown",(s=n.context.domElement.getAttribute("skybox-image"))!=null&&s.length||0>0||n.context.lightmaps.tryGetSkybox(a.sourceId)?a.clearFlags=ug.Skybox:a.clearFlags=ug.SolidColor,a.backgroundColor=new pn(.5,.5,.5,1),a.fieldOfView=35,n.context.domElement.getAttribute("transparent")!=null&&(a.clearFlags=ug.Uninitialized),a.backgroundBlurriness=.2;const l=B0(o,a,!0);o.position.x=0,o.position.y=1,o.position.z=2;const c=n.context.domElement;return c?.cameraControls!=!1&&Jae(n.context,l),l}),ji.registerCallback(nn.ContextCreated,n=>{if(!n.context.mainCamera){lk&&console.log("Will not auto-fit because a default camera exists");return}const e=n.context.domElement;if(e?.cameraControls==!0){const i=S8(n.context.mainCamera);if(i?.isCameraController==!0){lk&&console.log("Will not auto-fit because a camera controller exists");return}Jae(n.context)}});function Jae(n,e){e=e??n.mainCameraComponent;const i=e?.gameObject;if(lk&&console.log("Creating default camera controls",e?.name),i){const s=RC(i,ln);s.sourceId=e?.sourceId??"unknown";const r=n.domElement.getAttribute("auto-rotate");if(s.autoRotate=r!=null&&r!="0"&&r?.toLowerCase()!="false",s.autoRotateSpeed=.5,s.autoFit=!0,s.autoRotate&&r){const o=parseFloat(r);isNaN(o)||(s.autoRotateSpeed=o)}}else console.warn("Missing camera object, can not add orbit controls")}ji.registerCallback(nn.ContextCreated,n=>{const e=n.context.domElement.getAttribute("autoplay");if(e!==void 0&&(e===""||e==="true"||e==="1")&&n.files)for(const i of n.files)$.foreachComponent(i.file.scene,s=>{if(s.enabled!==!1){if(s instanceof ra&&s.playAutomatically||s instanceof Mo||s instanceof fg&&s.playOnAwake===!0)return!0;if(s instanceof ra)return s.playAutomatically=!0,!0;if(s instanceof fg)return s.playOnAwake=!0,!0}},!0)!==!0&&Jb.assignAnimationsFromFile(i.file,{createAnimationComponent:(s,r)=>Ul(s,ra)})});const IA={Context:$t,glTF:{loadFromURL:OO}};globalThis.Needle!==void 0&&console.warn("Needle Engine is already imported"),globalThis.Needle=IA;function qae(n){for(const e in n)IA[e]=n[e]}qae(CPe),qae(Y3e),IA.onStart=oU,IA.onUpdate=aU,IA.onBeforeRender=ese,IA.NeedleXRSession=Qt;for(const n of Object.getOwnPropertyNames($))switch(n){case"prototype":case"constructor":case"length":case"name":continue;default:IA[n]=$[n];break}globalThis.THREE?console.warn("Threejs is already imported"):globalThis.THREE=I1e;class zOe{constructor(e){if(this._retries=0,!Number.isInteger(e)||e<0)throw new Error("Backoff must be a positive integer");this.backoff=e}get retries(){return this._retries}get current(){return this.backoff}next(){return this._retries++,this.backoff}reset(){this._retries=0}}class FOe{constructor(e,i){if(this._retries=0,!Number.isInteger(e)||e<0)throw new Error("Base must be a positive integer or zero");if(i!==void 0&&(!Number.isInteger(i)||i<0))throw new Error("ExpMax must be a undefined, a positive integer or zero");this.base=e,this.expMax=i,this.i=0}get retries(){return this._retries}get current(){return this.base*Math.pow(2,this.i)}next(){return this._retries++,this.i=this.expMax===void 0?this.i+1:Math.min(this.i+1,this.expMax),this.current}reset(){this._retries=0,this.i=0}}class UOe{constructor(e,i,s){if(this.i=0,this._retries=0,e<0)throw new Error("Initial must be a positive number or zero");if(i<0)throw new Error("Increment must be a positive number or zero");if(s!==void 0&&s<0)throw new Error("Max must be undefined, a positive number or zero");if(s!==void 0&&s<e)throw new Error("Max must be undefined or greater than or equal to initial");this.initial=e,this.increment=i,this.max=s}get retries(){return this._retries}get current(){return this.max===void 0?this.initial+this.increment*this.i:Math.min(this.initial+this.increment*this.i,this.max)}next(){return this._retries++,this.i++,this.current}reset(){this._retries=0,this.i=0}}class OOe{constructor(){this.elements=[]}add(e){this.elements.push(e)}clear(){this.elements.length=0}forEach(e){this.elements.forEach(e)}length(){return this.elements.length}isEmpty(){return this.elements.length===0}peek(){return this.elements[0]}read(){return this.elements.shift()}}class ZOe{constructor(e){if(!Number.isInteger(e)||e<=0)throw new Error("Capacity must be a positive integer");this.elements=new Array(e+1),this.head=0,this.tail=0}add(e){this.elements[this.head]=e,this.head=(this.head+1)%this.elements.length,this.head===this.tail&&(this.tail=(this.tail+1)%this.elements.length)}clear(){this.head=0,this.tail=0}forEach(e){for(let i=this.tail;i!==this.head;i=(i+1)%this.elements.length)e(this.elements[i])}length(){return this.tail===this.head?0:this.tail<this.head?this.head-this.tail:this.elements.length-this.tail+this.head}isEmpty(){return this.head===this.tail}peek(){return this.isEmpty()?void 0:this.elements[this.tail]}read(){const e=this.peek();return e!==void 0&&(this.tail=(this.tail+1)%this.elements.length),e}}var Tn;(function(n){n.open="open",n.close="close",n.error="error",n.message="message",n.retry="retry",n.reconnect="reconnect"})(Tn||(Tn={}));class $ae{constructor(e,i,s){var r,o,a,l,c,h,d,u,p,g,f,A,y,b,v;this._closedByUser=!1,this.handleOpenEvent=x=>this.handleEvent(Tn.open,x),this.handleErrorEvent=x=>this.handleEvent(Tn.error,x),this.handleCloseEvent=x=>this.handleEvent(Tn.close,x),this.handleMessageEvent=x=>this.handleEvent(Tn.message,x),this._url=e,this._protocols=i,this._options={buffer:s?.buffer,retry:{maxRetries:(r=s?.retry)===null||r===void 0?void 0:r.maxRetries,instantReconnect:(o=s?.retry)===null||o===void 0?void 0:o.instantReconnect,backoff:(a=s?.retry)===null||a===void 0?void 0:a.backoff},listeners:{open:[...(c=(l=s?.listeners)===null||l===void 0?void 0:l.open)!==null&&c!==void 0?c:[]],close:[...(d=(h=s?.listeners)===null||h===void 0?void 0:h.close)!==null&&d!==void 0?d:[]],error:[...(p=(u=s?.listeners)===null||u===void 0?void 0:u.error)!==null&&p!==void 0?p:[]],message:[...(f=(g=s?.listeners)===null||g===void 0?void 0:g.message)!==null&&f!==void 0?f:[]],retry:[...(y=(A=s?.listeners)===null||A===void 0?void 0:A.retry)!==null&&y!==void 0?y:[]],reconnect:[...(v=(b=s?.listeners)===null||b===void 0?void 0:b.reconnect)!==null&&v!==void 0?v:[]]}},this._underlyingWebsocket=this.tryConnect()}get url(){return this._url}get protocols(){return this._protocols}get buffer(){return this._options.buffer}get maxRetries(){return this._options.retry.maxRetries}get instantReconnect(){return this._options.retry.instantReconnect}get backoff(){return this._options.retry.backoff}get closedByUser(){return this._closedByUser}get lastConnection(){return this._lastConnection}get underlyingWebsocket(){return this._underlyingWebsocket}get readyState(){return this._underlyingWebsocket.readyState}get bufferedAmount(){return this._underlyingWebsocket.bufferedAmount}get extensions(){return this._underlyingWebsocket.extensions}get binaryType(){return this._underlyingWebsocket.binaryType}set binaryType(e){this._underlyingWebsocket.binaryType=e}send(e){this.closedByUser||(this._underlyingWebsocket.readyState===this._underlyingWebsocket.OPEN?this._underlyingWebsocket.send(e):this.buffer!==void 0&&this.buffer.add(e))}close(e,i){this.cancelScheduledConnectionRetry(),this._closedByUser=!0,this._underlyingWebsocket.close(e,i)}addEventListener(e,i,s){this._options.listeners[e].push({listener:i,options:s})}removeEventListener(e,i,s){const r=o=>o.listener!==i||o.options!==s;this._options.listeners[e]=this._options.listeners[e].filter(r)}tryConnect(){return this._underlyingWebsocket=new WebSocket(this.url,this.protocols),this._underlyingWebsocket.addEventListener(Tn.open,this.handleOpenEvent),this._underlyingWebsocket.addEventListener(Tn.close,this.handleCloseEvent),this._underlyingWebsocket.addEventListener(Tn.error,this.handleErrorEvent),this._underlyingWebsocket.addEventListener(Tn.message,this.handleMessageEvent),this._underlyingWebsocket}clearWebsocket(){this._underlyingWebsocket.removeEventListener(Tn.open,this.handleOpenEvent),this._underlyingWebsocket.removeEventListener(Tn.close,this.handleCloseEvent),this._underlyingWebsocket.removeEventListener(Tn.error,this.handleErrorEvent),this._underlyingWebsocket.removeEventListener(Tn.message,this.handleMessageEvent),this._underlyingWebsocket.close()}dispatchEvent(e,i){const s=this._options.listeners[e],r=[];s.forEach(({listener:o,options:a})=>{o(this,i),(a===void 0||a.once===void 0||!a.once)&&r.push({listener:o,options:a})}),this._options.listeners[e]=r}handleEvent(e,i){switch(e){case Tn.close:this.dispatchEvent(e,i),this.scheduleConnectionRetryIfNeeded();break;case Tn.open:if(this.backoff!==void 0&&this._lastConnection!==void 0){const s={retries:this.backoff.retries,lastConnection:new Date(this._lastConnection)},r=new CustomEvent(Tn.reconnect,{detail:s});this.dispatchEvent(Tn.reconnect,r),this.backoff.reset()}this._lastConnection=new Date,this.dispatchEvent(e,i),this.sendBufferedData();break;case Tn.retry:this.dispatchEvent(e,i),this.clearWebsocket(),this.tryConnect();break;default:this.dispatchEvent(e,i);break}}sendBufferedData(){if(this.buffer!==void 0)for(let e=this.buffer.read();e!==void 0;e=this.buffer.read())this.send(e)}scheduleConnectionRetryIfNeeded(){if(this.closedByUser||this.backoff===void 0)return;const e=s=>{const r=new CustomEvent(Tn.retry,{detail:s});this.handleEvent(Tn.retry,r)},i={backoff:this._options.retry.instantReconnect===!0?0:this.backoff.next(),retries:this._options.retry.instantReconnect===!0?0:this.backoff.retries,lastConnection:this._lastConnection};(this._options.retry.maxRetries===void 0||i.retries<=this._options.retry.maxRetries)&&(this.retryTimeout=globalThis.setTimeout(()=>e(i),i.backoff))}cancelScheduledConnectionRetry(){globalThis.clearTimeout(this.retryTimeout)}}class WOe{constructor(e){this._url=e}get url(){return this._url}withProtocols(e){return this._protocols=e,this}get protocols(){return this._protocols}withMaxRetries(e){var i;return this._options=Object.assign(Object.assign({},this._options),{retry:Object.assign(Object.assign({},(i=this._options)===null||i===void 0?void 0:i.retry),{maxRetries:e})}),this}get maxRetries(){var e,i;return(i=(e=this._options)===null||e===void 0?void 0:e.retry)===null||i===void 0?void 0:i.maxRetries}withInstantReconnect(e){var i;return this._options=Object.assign(Object.assign({},this._options),{retry:Object.assign(Object.assign({},(i=this._options)===null||i===void 0?void 0:i.retry),{instantReconnect:e})}),this}get instantReconnect(){var e,i;return(i=(e=this._options)===null||e===void 0?void 0:e.retry)===null||i===void 0?void 0:i.instantReconnect}withBackoff(e){var i;return this._options=Object.assign(Object.assign({},this._options),{retry:Object.assign(Object.assign({},(i=this._options)===null||i===void 0?void 0:i.retry),{backoff:e})}),this}get backoff(){var e,i;return(i=(e=this._options)===null||e===void 0?void 0:e.retry)===null||i===void 0?void 0:i.backoff}withBuffer(e){return this._options=Object.assign(Object.assign({},this._options),{buffer:e}),this}get buffer(){var e;return(e=this._options)===null||e===void 0?void 0:e.buffer}onOpen(e,i){return this.addListener(Tn.open,e,i),this}onClose(e,i){return this.addListener(Tn.close,e,i),this}onError(e,i){return this.addListener(Tn.error,e,i),this}onMessage(e,i){return this.addListener(Tn.message,e,i),this}onRetry(e,i){return this.addListener(Tn.retry,e,i),this}onReconnect(e,i){return this.addListener(Tn.reconnect,e,i),this}build(){return new $ae(this._url,this._protocols,this._options)}addListener(e,i,s){var r,o,a,l,c,h,d,u,p,g,f,A,y,b,v,x,w,C,S,_,I;return this._options=Object.assign(Object.assign({},this._options),{listeners:{open:(a=(o=(r=this._options)===null||r===void 0?void 0:r.listeners)===null||o===void 0?void 0:o.open)!==null&&a!==void 0?a:[],close:(h=(c=(l=this._options)===null||l===void 0?void 0:l.listeners)===null||c===void 0?void 0:c.close)!==null&&h!==void 0?h:[],error:(p=(u=(d=this._options)===null||d===void 0?void 0:d.listeners)===null||u===void 0?void 0:u.error)!==null&&p!==void 0?p:[],message:(A=(f=(g=this._options)===null||g===void 0?void 0:g.listeners)===null||f===void 0?void 0:f.message)!==null&&A!==void 0?A:[],retry:(v=(b=(y=this._options)===null||y===void 0?void 0:y.listeners)===null||b===void 0?void 0:b.retry)!==null&&v!==void 0?v:[],reconnect:(C=(w=(x=this._options)===null||x===void 0?void 0:x.listeners)===null||w===void 0?void 0:w.reconnect)!==null&&C!==void 0?C:[],[e]:[...(I=(_=(S=this._options)===null||S===void 0?void 0:S.listeners)===null||_===void 0?void 0:_[e])!==null&&I!==void 0?I:[],{listener:i,options:s}]}}),this}}const HOe=Object.freeze(Object.defineProperty({__proto__:null,ArrayQueue:OOe,ConstantBackoff:zOe,ExponentialBackoff:FOe,LinearBackoff:UOe,RingQueue:ZOe,Websocket:$ae,WebsocketBuilder:WOe,get WebsocketEvent(){return Tn}},Symbol.toStringTag,{value:"Module"})),rZ=0,ele=1,tle=2,QOe=0,KOe=1,oZ=2,ck=1.25,aZ=1,Wg=6*4+4+4,hk=65535,YOe=Math.pow(2,-24),lZ=Symbol("SKIP_GENERATION");function ile(n){return n.index?n.index.count:n.attributes.position.count}function lx(n){return ile(n)/3}function nle(n,e=ArrayBuffer){return n>65535?new Uint32Array(new e(4*n)):new Uint16Array(new e(2*n))}function jOe(n,e){if(!n.index){const i=n.attributes.position.count,s=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r=nle(i,s);n.setIndex(new ct(r,1));for(let o=0;o<i;o++)r[o]=o}}function sle(n,e){const i=lx(n),s=e||n.drawRange,r=s.start/3,o=(s.start+s.count)/3,a=Math.max(0,r),l=Math.min(i,o)-a;return[{offset:Math.floor(a),count:Math.floor(l)}]}function rle(n,e){if(!n.groups||!n.groups.length)return sle(n,e);const i=[],s=new Set,r=e||n.drawRange,o=r.start/3,a=(r.start+r.count)/3;for(const c of n.groups){const h=c.start/3,d=(c.start+c.count)/3;s.add(Math.max(o,h)),s.add(Math.min(a,d))}const l=Array.from(s.values()).sort((c,h)=>c-h);for(let c=0;c<l.length-1;c++){const h=l[c],d=l[c+1];i.push({offset:Math.floor(h),count:Math.floor(d-h)})}return i}function JOe(n,e){const i=lx(n),s=rle(n,e).sort((a,l)=>a.offset-l.offset),r=s[s.length-1];r.count=Math.min(i-r.offset,r.count);let o=0;return s.forEach(({count:a})=>o+=a),i!==o}function cZ(n,e,i,s,r){let o=1/0,a=1/0,l=1/0,c=-1/0,h=-1/0,d=-1/0,u=1/0,p=1/0,g=1/0,f=-1/0,A=-1/0,y=-1/0;for(let b=e*6,v=(e+i)*6;b<v;b+=6){const x=n[b+0],w=n[b+1],C=x-w,S=x+w;C<o&&(o=C),S>c&&(c=S),x<u&&(u=x),x>f&&(f=x);const _=n[b+2],I=n[b+3],B=_-I,M=_+I;B<a&&(a=B),M>h&&(h=M),_<p&&(p=_),_>A&&(A=_);const R=n[b+4],k=n[b+5],G=R-k,X=R+k;G<l&&(l=G),X>d&&(d=X),R<g&&(g=R),R>y&&(y=R)}s[0]=o,s[1]=a,s[2]=l,s[3]=c,s[4]=h,s[5]=d,r[0]=u,r[1]=p,r[2]=g,r[3]=f,r[4]=A,r[5]=y}function qOe(n,e=null,i=null,s=null){const r=n.attributes.position,o=n.index?n.index.array:null,a=lx(n),l=r.normalized;let c;e===null?(c=new Float32Array(a*6),i=0,s=a):(c=e,i=i||0,s=s||a);const h=r.array,d=r.offset||0;let u=3;r.isInterleavedBufferAttribute&&(u=r.data.stride);const p=["getX","getY","getZ"];for(let g=i;g<i+s;g++){const f=g*3,A=g*6;let y=f+0,b=f+1,v=f+2;o&&(y=o[y],b=o[b],v=o[v]),l||(y=y*u+d,b=b*u+d,v=v*u+d);for(let x=0;x<3;x++){let w,C,S;l?(w=r[p[x]](y),C=r[p[x]](b),S=r[p[x]](v)):(w=h[y+x],C=h[b+x],S=h[v+x]);let _=w;C<_&&(_=C),S<_&&(_=S);let I=w;C>I&&(I=C),S>I&&(I=S);const B=(I-_)/2,M=x*2;c[A+M+0]=_+B,c[A+M+1]=B+(Math.abs(_)+B)*YOe}}return c}function Un(n,e,i){return i.min.x=e[n],i.min.y=e[n+1],i.min.z=e[n+2],i.max.x=e[n+3],i.max.y=e[n+4],i.max.z=e[n+5],i}function ole(n){let e=-1,i=-1/0;for(let s=0;s<3;s++){const r=n[s+3]-n[s];r>i&&(i=r,e=s)}return e}function ale(n,e){e.set(n)}function lle(n,e,i){let s,r;for(let o=0;o<3;o++){const a=o+3;s=n[o],r=e[o],i[o]=s<r?s:r,s=n[a],r=e[a],i[a]=s>r?s:r}}function dk(n,e,i){for(let s=0;s<3;s++){const r=e[n+2*s],o=e[n+2*s+1],a=r-o,l=r+o;a<i[s]&&(i[s]=a),l>i[s+3]&&(i[s+3]=l)}}function G_(n){const e=n[3]-n[0],i=n[4]-n[1],s=n[5]-n[2];return 2*(e*i+i*s+s*e)}const Gp=32,$Oe=(n,e)=>n.candidate-e.candidate,Hg=new Array(Gp).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),uk=new Float32Array(6);function eZe(n,e,i,s,r,o){let a=-1,l=0;if(o===rZ)a=ole(e),a!==-1&&(l=(e[a]+e[a+3])/2);else if(o===ele)a=ole(n),a!==-1&&(l=tZe(i,s,r,a));else if(o===tle){const c=G_(n);let h=ck*r;const d=s*6,u=(s+r)*6;for(let p=0;p<3;p++){const g=e[p],f=(e[p+3]-g)/Gp;if(r<Gp/4){const A=[...Hg];A.length=r;let y=0;for(let v=d;v<u;v+=6,y++){const x=A[y];x.candidate=i[v+2*p],x.count=0;const{bounds:w,leftCacheBounds:C,rightCacheBounds:S}=x;for(let _=0;_<3;_++)S[_]=1/0,S[_+3]=-1/0,C[_]=1/0,C[_+3]=-1/0,w[_]=1/0,w[_+3]=-1/0;dk(v,i,w)}A.sort($Oe);let b=r;for(let v=0;v<b;v++){const x=A[v];for(;v+1<b&&A[v+1].candidate===x.candidate;)A.splice(v+1,1),b--}for(let v=d;v<u;v+=6){const x=i[v+2*p];for(let w=0;w<b;w++){const C=A[w];x>=C.candidate?dk(v,i,C.rightCacheBounds):(dk(v,i,C.leftCacheBounds),C.count++)}}for(let v=0;v<b;v++){const x=A[v],w=x.count,C=r-x.count,S=x.leftCacheBounds,_=x.rightCacheBounds;let I=0;w!==0&&(I=G_(S)/c);let B=0;C!==0&&(B=G_(_)/c);const M=aZ+ck*(I*w+B*C);M<h&&(a=p,h=M,l=x.candidate)}}else{for(let b=0;b<Gp;b++){const v=Hg[b];v.count=0,v.candidate=g+f+b*f;const x=v.bounds;for(let w=0;w<3;w++)x[w]=1/0,x[w+3]=-1/0}for(let b=d;b<u;b+=6){let v=~~((i[b+2*p]-g)/f);v>=Gp&&(v=Gp-1);const x=Hg[v];x.count++,dk(b,i,x.bounds)}const A=Hg[Gp-1];ale(A.bounds,A.rightCacheBounds);for(let b=Gp-2;b>=0;b--){const v=Hg[b],x=Hg[b+1];lle(v.bounds,x.rightCacheBounds,v.rightCacheBounds)}let y=0;for(let b=0;b<Gp-1;b++){const v=Hg[b],x=v.count,w=v.bounds,C=Hg[b+1].rightCacheBounds;x!==0&&(y===0?ale(w,uk):lle(w,uk,uk)),y+=x;let S=0,_=0;y!==0&&(S=G_(uk)/c);const I=r-y;I!==0&&(_=G_(C)/c);const B=aZ+ck*(S*y+_*I);B<h&&(a=p,h=B,l=v.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${o} used.`);return{axis:a,pos:l}}function tZe(n,e,i,s){let r=0;for(let o=e,a=e+i;o<a;o++)r+=n[o*6+s*2];return r/i}class hZ{constructor(){this.boundingData=new Float32Array(6)}}function iZe(n,e,i,s,r,o){let a=s,l=s+r-1;const c=o.pos,h=o.axis*2;for(;;){for(;a<=l&&i[a*6+h]<c;)a++;for(;a<=l&&i[l*6+h]>=c;)l--;if(a<l){for(let d=0;d<3;d++){let u=e[a*3+d];e[a*3+d]=e[l*3+d],e[l*3+d]=u}for(let d=0;d<6;d++){let u=i[a*6+d];i[a*6+d]=i[l*6+d],i[l*6+d]=u}a++,l--}else return a}}function nZe(n,e,i,s,r,o){let a=s,l=s+r-1;const c=o.pos,h=o.axis*2;for(;;){for(;a<=l&&i[a*6+h]<c;)a++;for(;a<=l&&i[l*6+h]>=c;)l--;if(a<l){let d=n[a];n[a]=n[l],n[l]=d;for(let u=0;u<6;u++){let p=i[a*6+u];i[a*6+u]=i[l*6+u],i[l*6+u]=p}a++,l--}else return a}}function Za(n,e){return e[n+15]===65535}function fl(n,e){return e[n+6]}function hc(n,e){return e[n+14]}function jc(n){return n+8}function dc(n,e){return e[n+6]}function dZ(n,e){return e[n+7]}let cle,P_,pk,hle;const sZe=Math.pow(2,32);function uZ(n){return"count"in n?1:1+uZ(n.left)+uZ(n.right)}function rZe(n,e,i){return cle=new Float32Array(i),P_=new Uint32Array(i),pk=new Uint16Array(i),hle=new Uint8Array(i),pZ(n,e)}function pZ(n,e){const i=n/4,s=n/2,r="count"in e,o=e.boundingData;for(let a=0;a<6;a++)cle[i+a]=o[a];if(r)if(e.buffer){const a=e.buffer;hle.set(new Uint8Array(a),n);for(let l=n,c=n+a.byteLength;l<c;l+=Wg){const h=l/2;Za(h,pk)||(P_[l/4+6]+=i)}return n+a.byteLength}else{const a=e.offset,l=e.count;return P_[i+6]=a,pk[s+14]=l,pk[s+15]=hk,n+Wg}else{const a=e.left,l=e.right,c=e.splitAxis;let h;if(h=pZ(n+Wg,a),h/4>sZe)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return P_[i+6]=h/4,h=pZ(h,l),P_[i+7]=c,h}}function oZe(n,e){const i=(n.index?n.index.count:n.attributes.position.count)/3,s=i>2**16,r=s?4:2,o=e?new SharedArrayBuffer(i*r):new ArrayBuffer(i*r),a=s?new Uint32Array(o):new Uint16Array(o);for(let l=0,c=a.length;l<c;l++)a[l]=l;return a}function aZe(n,e,i,s,r){const{maxDepth:o,verbose:a,maxLeafTris:l,strategy:c,onProgress:h,indirect:d}=r,u=n._indirectBuffer,p=n.geometry,g=p.index?p.index.array:null,f=d?nZe:iZe,A=lx(p),y=new Float32Array(6);let b=!1;const v=new hZ;return cZ(e,i,s,v.boundingData,y),w(v,i,s,y),v;function x(C){h&&h(C/A)}function w(C,S,_,I=null,B=0){if(!b&&B>=o&&(b=!0,a&&(console.warn(`MeshBVH: Max depth of ${o} reached when generating BVH. Consider increasing maxDepth.`),console.warn(p))),_<=l||B>=o)return x(S+_),C.offset=S,C.count=_,C;const M=eZe(C.boundingData,I,e,S,_,c);if(M.axis===-1)return x(S+_),C.offset=S,C.count=_,C;const R=f(u,g,e,S,_,M);if(R===S||R===S+_)x(S+_),C.offset=S,C.count=_;else{C.splitAxis=M.axis;const k=new hZ,G=S,X=R-S;C.left=k,cZ(e,G,X,k.boundingData,y),w(k,G,X,y,B+1);const F=new hZ,z=R,H=_-X;C.right=F,cZ(e,z,H,F.boundingData,y),w(F,z,H,y,B+1)}return C}}function lZe(n,e){const i=n.geometry;e.indirect&&(n._indirectBuffer=oZe(i,e.useSharedArrayBuffer),JOe(i,e.range)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),n._indirectBuffer||jOe(i,e);const s=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r=qOe(i),o=e.indirect?sle(i,e.range):rle(i,e.range);n._roots=o.map(a=>{const l=aZe(n,r,a.offset,a.count,e),c=uZ(l),h=new s(Wg*c);return rZe(0,l,h),h})}class Pp{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,i){let s=1/0,r=-1/0;for(let o=0,a=e.length;o<a;o++){const l=e[o][i];s=l<s?l:s,r=l>r?l:r}this.min=s,this.max=r}setFromPoints(e,i){let s=1/0,r=-1/0;for(let o=0,a=i.length;o<a;o++){const l=i[o],c=e.dot(l);s=c<s?c:s,r=c>r?c:r}this.min=s,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}Pp.prototype.setFromBox=function(){const n=new E;return function(e,i){const s=i.min,r=i.max;let o=1/0,a=-1/0;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){n.x=s.x*l+r.x*(1-l),n.y=s.y*c+r.y*(1-c),n.z=s.z*h+r.z*(1-h);const d=e.dot(n);o=Math.min(d,o),a=Math.max(d,a)}this.min=o,this.max=a}}();const cZe=function(){const n=new E,e=new E,i=new E;return function(s,r,o){const a=s.start,l=n,c=r.start,h=e;i.subVectors(a,c),n.subVectors(s.end,s.start),e.subVectors(r.end,r.start);const d=i.dot(h),u=h.dot(l),p=h.dot(h),g=i.dot(l),f=l.dot(l)*p-u*u;let A,y;f!==0?A=(d*u-g*p)/f:A=0,y=(d+A*u)/p,o.x=A,o.y=y}}(),mZ=function(){const n=new Q,e=new E,i=new E;return function(s,r,o,a){cZe(s,r,n);let l=n.x,c=n.y;if(l>=0&&l<=1&&c>=0&&c<=1){s.at(l,o),r.at(c,a);return}else if(l>=0&&l<=1){c<0?r.at(0,a):r.at(1,a),s.closestPointToPoint(a,!0,o);return}else if(c>=0&&c<=1){l<0?s.at(0,o):s.at(1,o),r.closestPointToPoint(o,!0,a);return}else{let h;l<0?h=s.start:h=s.end;let d;c<0?d=r.start:d=r.end;const u=e,p=i;if(s.closestPointToPoint(d,!0,e),r.closestPointToPoint(h,!0,i),u.distanceToSquared(d)<=p.distanceToSquared(h)){o.copy(u),a.copy(d);return}else{o.copy(h),a.copy(p);return}}}}(),hZe=function(){const n=new E,e=new E,i=new tr,s=new vc;return function(r,o){const{radius:a,center:l}=r,{a:c,b:h,c:d}=o;if(s.start=c,s.end=h,s.closestPointToPoint(l,!0,n).distanceTo(l)<=a||(s.start=c,s.end=d,s.closestPointToPoint(l,!0,n).distanceTo(l)<=a)||(s.start=h,s.end=d,s.closestPointToPoint(l,!0,n).distanceTo(l)<=a))return!0;const u=o.getPlane(i);if(Math.abs(u.distanceToPoint(l))<=a){const p=u.projectPoint(l,e);if(o.containsPoint(p))return!0}return!1}}(),dZe=1e-15;function gZ(n){return Math.abs(n)<dZe}class Jc extends $s{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new E),this.satBounds=new Array(4).fill().map(()=>new Pp),this.points=[this.a,this.b,this.c],this.sphere=new Vn,this.plane=new tr,this.needsUpdate=!0}intersectsSphere(e){return hZe(e,this)}update(){const e=this.a,i=this.b,s=this.c,r=this.points,o=this.satAxes,a=this.satBounds,l=o[0],c=a[0];this.getNormal(l),c.setFromPoints(l,r);const h=o[1],d=a[1];h.subVectors(e,i),d.setFromPoints(h,r);const u=o[2],p=a[2];u.subVectors(i,s),p.setFromPoints(u,r);const g=o[3],f=a[3];g.subVectors(s,e),f.setFromPoints(g,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(l,e),this.needsUpdate=!1}}Jc.prototype.closestPointToSegment=function(){const n=new E,e=new E,i=new vc;return function(s,r=null,o=null){const{start:a,end:l}=s,c=this.points;let h,d=1/0;for(let u=0;u<3;u++){const p=(u+1)%3;i.start.copy(c[u]),i.end.copy(c[p]),mZ(i,s,n,e),h=n.distanceToSquared(e),h<d&&(d=h,r&&r.copy(n),o&&o.copy(e))}return this.closestPointToPoint(a,n),h=a.distanceToSquared(n),h<d&&(d=h,r&&r.copy(n),o&&o.copy(a)),this.closestPointToPoint(l,n),h=l.distanceToSquared(n),h<d&&(d=h,r&&r.copy(n),o&&o.copy(l)),Math.sqrt(d)}}(),Jc.prototype.intersectsTriangle=function(){const n=new Jc,e=new Array(3),i=new Array(3),s=new Pp,r=new Pp,o=new E,a=new E,l=new E,c=new E,h=new E,d=new vc,u=new vc,p=new vc,g=new E;function f(A,y,b){const v=A.points;let x=0,w=-1;for(let C=0;C<3;C++){const{start:S,end:_}=d;S.copy(v[C]),_.copy(v[(C+1)%3]),d.delta(a);const I=gZ(y.distanceToPoint(S));if(gZ(y.normal.dot(a))&&I){b.copy(d),x=2;break}const B=y.intersectLine(d,g);if(!B&&I&&g.copy(S),(B||I)&&!gZ(g.distanceTo(_))){if(x<=1)(x===1?b.start:b.end).copy(g),I&&(w=x);else if(x>=2){(w===1?b.start:b.end).copy(g),x=2;break}if(x++,x===2&&w===-1)break}}return x}return function(A,y=null,b=!1){this.needsUpdate&&this.update(),A.isExtendedTriangle?A.needsUpdate&&A.update():(n.copy(A),n.update(),A=n);const v=this.plane,x=A.plane;if(Math.abs(v.normal.dot(x.normal))>1-1e-10){const w=this.satBounds,C=this.satAxes;i[0]=A.a,i[1]=A.b,i[2]=A.c;for(let I=0;I<4;I++){const B=w[I],M=C[I];if(s.setFromPoints(M,i),B.isSeparated(s))return!1}const S=A.satBounds,_=A.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let I=0;I<4;I++){const B=S[I],M=_[I];if(s.setFromPoints(M,e),B.isSeparated(s))return!1}for(let I=0;I<4;I++){const B=C[I];for(let M=0;M<4;M++){const R=_[M];if(o.crossVectors(B,R),s.setFromPoints(o,e),r.setFromPoints(o,i),s.isSeparated(r))return!1}}return y&&(b||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),y.start.set(0,0,0),y.end.set(0,0,0)),!0}else{const w=f(this,x,u);if(w===1&&A.containsPoint(u.end))return y&&(y.start.copy(u.end),y.end.copy(u.end)),!0;if(w!==2)return!1;const C=f(A,v,p);if(C===1&&this.containsPoint(p.end))return y&&(y.start.copy(p.end),y.end.copy(p.end)),!0;if(C!==2)return!1;if(u.delta(l),p.delta(c),l.dot(c)<0){let k=p.start;p.start=p.end,p.end=k}const S=u.start.dot(l),_=u.end.dot(l),I=p.start.dot(l),B=p.end.dot(l),M=_<I,R=S<B;return S!==B&&I!==_&&M===R?!1:(y&&(h.subVectors(u.start,p.start),h.dot(l)>0?y.start.copy(u.start):y.start.copy(p.start),h.subVectors(u.end,p.end),h.dot(l)<0?y.end.copy(u.end):y.end.copy(p.end)),!0)}}}(),Jc.prototype.distanceToPoint=function(){const n=new E;return function(e){return this.closestPointToPoint(e,n),e.distanceTo(n)}}(),Jc.prototype.distanceToTriangle=function(){const n=new E,e=new E,i=["a","b","c"],s=new vc,r=new vc;return function(o,a=null,l=null){const c=a||l?s:null;if(this.intersectsTriangle(o,c))return(a||l)&&(a&&c.getCenter(a),l&&c.getCenter(l)),0;let h=1/0;for(let d=0;d<3;d++){let u;const p=i[d],g=o[p];this.closestPointToPoint(g,n),u=g.distanceToSquared(n),u<h&&(h=u,a&&a.copy(n),l&&l.copy(g));const f=this[p];o.closestPointToPoint(f,n),u=f.distanceToSquared(n),u<h&&(h=u,a&&a.copy(f),l&&l.copy(n))}for(let d=0;d<3;d++){const u=i[d],p=i[(d+1)%3];s.set(this[u],this[p]);for(let g=0;g<3;g++){const f=i[g],A=i[(g+1)%3];r.set(o[f],o[A]),mZ(s,r,n,e);const y=n.distanceToSquared(e);y<h&&(h=y,a&&a.copy(n),l&&l.copy(e))}}return Math.sqrt(h)}}();class ua{constructor(e,i,s){this.isOrientedBox=!0,this.min=new E,this.max=new E,this.matrix=new de,this.invMatrix=new de,this.points=new Array(8).fill().map(()=>new E),this.satAxes=new Array(3).fill().map(()=>new E),this.satBounds=new Array(3).fill().map(()=>new Pp),this.alignedSatBounds=new Array(3).fill().map(()=>new Pp),this.needsUpdate=!1,e&&this.min.copy(e),i&&this.max.copy(i),s&&this.matrix.copy(s)}set(e,i,s){this.min.copy(e),this.max.copy(i),this.matrix.copy(s),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}ua.prototype.update=function(){return function(){const n=this.matrix,e=this.min,i=this.max,s=this.points;for(let c=0;c<=1;c++)for(let h=0;h<=1;h++)for(let d=0;d<=1;d++){const u=1*c|2*h|4*d,p=s[u];p.x=c?i.x:e.x,p.y=h?i.y:e.y,p.z=d?i.z:e.z,p.applyMatrix4(n)}const r=this.satBounds,o=this.satAxes,a=s[0];for(let c=0;c<3;c++){const h=o[c],d=r[c],u=1<<c,p=s[u];h.subVectors(a,p),d.setFromPoints(h,s)}const l=this.alignedSatBounds;l[0].setFromPointsField(s,"x"),l[1].setFromPointsField(s,"y"),l[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}(),ua.prototype.intersectsBox=function(){const n=new Pp;return function(e){this.needsUpdate&&this.update();const i=e.min,s=e.max,r=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(n.min=i.x,n.max=s.x,a[0].isSeparated(n)||(n.min=i.y,n.max=s.y,a[1].isSeparated(n))||(n.min=i.z,n.max=s.z,a[2].isSeparated(n)))return!1;for(let l=0;l<3;l++){const c=o[l],h=r[l];if(n.setFromBox(c,e),h.isSeparated(n))return!1}return!0}}(),ua.prototype.intersectsTriangle=function(){const n=new Jc,e=new Array(3),i=new Pp,s=new Pp,r=new E;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(n.copy(o),n.update(),o=n);const a=this.satBounds,l=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let u=0;u<3;u++){const p=a[u],g=l[u];if(i.setFromPoints(g,e),p.isSeparated(i))return!1}const c=o.satBounds,h=o.satAxes,d=this.points;for(let u=0;u<3;u++){const p=c[u],g=h[u];if(i.setFromPoints(g,d),p.isSeparated(i))return!1}for(let u=0;u<3;u++){const p=l[u];for(let g=0;g<4;g++){const f=h[g];if(r.crossVectors(p,f),i.setFromPoints(r,e),s.setFromPoints(r,d),i.isSeparated(s))return!1}}return!0}}(),ua.prototype.closestPointToPoint=function(){return function(n,e){return this.needsUpdate&&this.update(),e.copy(n).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}(),ua.prototype.distanceToPoint=function(){const n=new E;return function(e){return this.closestPointToPoint(e,n),e.distanceTo(n)}}(),ua.prototype.distanceToBox=function(){const n=["x","y","z"],e=new Array(12).fill().map(()=>new vc),i=new Array(12).fill().map(()=>new vc),s=new E,r=new E;return function(o,a=0,l=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(l||c)&&(o.getCenter(r),this.closestPointToPoint(r,s),o.closestPointToPoint(s,r),l&&l.copy(s),c&&c.copy(r)),0;const h=a*a,d=o.min,u=o.max,p=this.points;let g=1/0;for(let A=0;A<8;A++){const y=p[A];r.copy(y).clamp(d,u);const b=y.distanceToSquared(r);if(b<g&&(g=b,l&&l.copy(y),c&&c.copy(r),b<h))return Math.sqrt(b)}let f=0;for(let A=0;A<3;A++)for(let y=0;y<=1;y++)for(let b=0;b<=1;b++){const v=(A+1)%3,x=(A+2)%3,w=y<<v|b<<x,C=1<<A|y<<v|b<<x,S=p[w],_=p[C];e[f].set(S,_);const I=n[A],B=n[v],M=n[x],R=i[f],k=R.start,G=R.end;k[I]=d[I],k[B]=y?d[B]:u[B],k[M]=b?d[M]:u[B],G[I]=u[I],G[B]=y?d[B]:u[B],G[M]=b?d[M]:u[B],f++}for(let A=0;A<=1;A++)for(let y=0;y<=1;y++)for(let b=0;b<=1;b++){r.x=A?u.x:d.x,r.y=y?u.y:d.y,r.z=b?u.z:d.z,this.closestPointToPoint(r,s);const v=r.distanceToSquared(s);if(v<g&&(g=v,l&&l.copy(s),c&&c.copy(r),v<h))return Math.sqrt(v)}for(let A=0;A<12;A++){const y=e[A];for(let b=0;b<12;b++){const v=i[b];mZ(y,v,s,r);const x=s.distanceToSquared(r);if(x<g&&(g=x,l&&l.copy(s),c&&c.copy(r),x<h))return Math.sqrt(x)}}return Math.sqrt(g)}}();class fZ{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class uZe extends fZ{constructor(){super(()=>new Jc)}}const qc=new uZe;class pZe{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let i=null;this.setBuffer=s=>{i&&e.push(i),i=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{i=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const $n=new pZe;let Qg,cx;const hx=[],mk=new fZ(()=>new gi);function mZe(n,e,i,s,r,o){Qg=mk.getPrimitive(),cx=mk.getPrimitive(),hx.push(Qg,cx),$n.setBuffer(n._roots[e]);const a=AZ(0,n.geometry,i,s,r,o);$n.clearBuffer(),mk.releasePrimitive(Qg),mk.releasePrimitive(cx),hx.pop(),hx.pop();const l=hx.length;return l>0&&(cx=hx[l-1],Qg=hx[l-2]),a}function AZ(n,e,i,s,r=null,o=0,a=0){const{float32Array:l,uint16Array:c,uint32Array:h}=$n;let d=n*2;if(Za(d,c)){const u=fl(n,h),p=hc(d,c);return Un(n,l,Qg),s(u,p,!1,a,o+n,Qg)}else{let u=function(R){const{uint16Array:k,uint32Array:G}=$n;let X=R*2;for(;!Za(X,k);)R=jc(R),X=R*2;return fl(R,G)},p=function(R){const{uint16Array:k,uint32Array:G}=$n;let X=R*2;for(;!Za(X,k);)R=dc(R,G),X=R*2;return fl(R,G)+hc(X,k)};const g=jc(n),f=dc(n,h);let A=g,y=f,b,v,x,w;if(r&&(x=Qg,w=cx,Un(A,l,x),Un(y,l,w),b=r(x),v=r(w),v<b)){A=f,y=g;const R=b;b=v,v=R,x=w}x||(x=Qg,Un(A,l,x));const C=Za(A*2,c),S=i(x,C,b,a+1,o+A);let _;if(S===oZ){const R=u(A),k=p(A)-R;_=s(R,k,!0,a+1,o+A,x)}else _=S&&AZ(A,e,i,s,r,o,a+1);if(_)return!0;w=cx,Un(y,l,w);const I=Za(y*2,c),B=i(w,I,v,a+1,o+y);let M;if(B===oZ){const R=u(y),k=p(y)-R;M=s(R,k,!0,a+1,o+y,w)}else M=B&&AZ(y,e,i,s,r,o,a+1);return!!M}}const N_=new E,yZ=new E;function gZe(n,e,i={},s=0,r=1/0){const o=s*s,a=r*r;let l=1/0,c=null;if(n.shapecast({boundsTraverseOrder:d=>(N_.copy(e).clamp(d.min,d.max),N_.distanceToSquared(e)),intersectsBounds:(d,u,p)=>p<l&&p<a,intersectsTriangle:(d,u)=>{d.closestPointToPoint(e,N_);const p=e.distanceToSquared(N_);return p<l&&(yZ.copy(N_),l=p,c=u),p<o}}),l===1/0)return null;const h=Math.sqrt(l);return i.point?i.point.copy(yZ):i.point=yZ.clone(),i.distance=h,i.faceIndex=c,i}const fZe=parseInt(fa)>=169,TA=new E,EA=new E,RA=new E,gk=new Q,fk=new Q,Ak=new Q,dle=new E,ule=new E,ple=new E,V_=new E;function AZe(n,e,i,s,r,o,a,l){let c;if(o===wn?c=n.intersectTriangle(s,i,e,!0,r):c=n.intersectTriangle(e,i,s,o!==Qi,r),c===null)return null;const h=n.origin.distanceTo(r);return h<a||h>l?null:{distance:h,point:r.clone()}}function yZe(n,e,i,s,r,o,a,l,c,h,d){TA.fromBufferAttribute(e,o),EA.fromBufferAttribute(e,a),RA.fromBufferAttribute(e,l);const u=AZe(n,TA,EA,RA,V_,c,h,d);if(u){const p=new E;$s.getBarycoord(V_,TA,EA,RA,p),s&&(gk.fromBufferAttribute(s,o),fk.fromBufferAttribute(s,a),Ak.fromBufferAttribute(s,l),u.uv=$s.getInterpolation(V_,TA,EA,RA,gk,fk,Ak,new Q)),r&&(gk.fromBufferAttribute(r,o),fk.fromBufferAttribute(r,a),Ak.fromBufferAttribute(r,l),u.uv1=$s.getInterpolation(V_,TA,EA,RA,gk,fk,Ak,new Q)),i&&(dle.fromBufferAttribute(i,o),ule.fromBufferAttribute(i,a),ple.fromBufferAttribute(i,l),u.normal=$s.getInterpolation(V_,TA,EA,RA,dle,ule,ple,new E),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const g={a:o,b:a,c:l,normal:new E,materialIndex:0};$s.getNormal(TA,EA,RA,g.normal),u.face=g,u.faceIndex=o,fZe&&(u.barycoord=p)}return u}function yk(n,e,i,s,r,o,a){const l=s*3;let c=l+0,h=l+1,d=l+2;const u=n.index;n.index&&(c=u.getX(c),h=u.getX(h),d=u.getX(d));const{position:p,normal:g,uv:f,uv1:A}=n.attributes,y=yZe(i,p,g,f,A,c,h,d,e,o,a);return y?(y.faceIndex=s,r&&r.push(y),y):null}function gr(n,e,i,s){const r=n.a,o=n.b,a=n.c;let l=e,c=e+1,h=e+2;i&&(l=i.getX(l),c=i.getX(c),h=i.getX(h)),r.x=s.getX(l),r.y=s.getY(l),r.z=s.getZ(l),o.x=s.getX(c),o.y=s.getY(c),o.z=s.getZ(c),a.x=s.getX(h),a.y=s.getY(h),a.z=s.getZ(h)}const X_=new E,D_=new E,z_=new E,mle=new Q,gle=new Q,fle=new Q;function bZe(n,e,i,s){const r=e.getIndex().array,o=e.getAttribute("position"),a=e.getAttribute("uv"),l=r[i*3],c=r[i*3+1],h=r[i*3+2];X_.fromBufferAttribute(o,l),D_.fromBufferAttribute(o,c),z_.fromBufferAttribute(o,h);let d=0;const u=e.groups,p=i*3;for(let A=0,y=u.length;A<y;A++){const b=u[A],{start:v,count:x}=b;if(p>=v&&p<v+x){d=b.materialIndex;break}}const g=s&&s.barycoord?s.barycoord:new E;$s.getBarycoord(n,X_,D_,z_,g);let f=null;return a&&(mle.fromBufferAttribute(a,l),gle.fromBufferAttribute(a,c),fle.fromBufferAttribute(a,h),s&&s.uv?f=s.uv:f=new Q,$s.getInterpolation(n,X_,D_,z_,mle,gle,fle,f)),s?(s.face||(s.face={}),s.face.a=l,s.face.b=c,s.face.c=h,s.face.materialIndex=d,s.face.normal||(s.face.normal=new E),$s.getNormal(X_,D_,z_,s.face.normal),f&&(s.uv=f),s.barycoord=g,s):{face:{a:l,b:c,c:h,materialIndex:d,normal:$s.getNormal(X_,D_,z_,new E)},uv:f,barycoord:g}}function vZe(n,e,i,s,r,o,a,l){const{geometry:c,_indirectBuffer:h}=n;for(let d=s,u=s+r;d<u;d++)yk(c,e,i,d,o,a,l)}function xZe(n,e,i,s,r,o,a){const{geometry:l,_indirectBuffer:c}=n;let h=1/0,d=null;for(let u=s,p=s+r;u<p;u++){let g;g=yk(l,e,i,u,null,o,a),g&&g.distance<h&&(d=g,h=g.distance)}return d}function wZe(n,e,i,s,r,o,a){const{geometry:l}=i,{index:c}=l,h=l.attributes.position;for(let d=n,u=e+n;d<u;d++){let p;if(p=d,gr(a,p*3,c,h),a.needsUpdate=!0,s(a,p,r,o))return!0}return!1}function CZe(n,e=null){e&&Array.isArray(e)&&(e=new Set(e));const i=n.geometry,s=i.index?i.index.array:null,r=i.attributes.position;let o,a,l,c,h=0;const d=n._roots;for(let p=0,g=d.length;p<g;p++)o=d[p],a=new Uint32Array(o),l=new Uint16Array(o),c=new Float32Array(o),u(0,h),h+=o.byteLength;function u(p,g,f=!1){const A=p*2;if(l[A+15]===hk){const y=a[p+6],b=l[A+14];let v=1/0,x=1/0,w=1/0,C=-1/0,S=-1/0,_=-1/0;for(let I=3*y,B=3*(y+b);I<B;I++){let M=s[I];const R=r.getX(M),k=r.getY(M),G=r.getZ(M);R<v&&(v=R),R>C&&(C=R),k<x&&(x=k),k>S&&(S=k),G<w&&(w=G),G>_&&(_=G)}return c[p+0]!==v||c[p+1]!==x||c[p+2]!==w||c[p+3]!==C||c[p+4]!==S||c[p+5]!==_?(c[p+0]=v,c[p+1]=x,c[p+2]=w,c[p+3]=C,c[p+4]=S,c[p+5]=_,!0):!1}else{const y=p+8,b=a[p+6],v=y+g,x=b+g;let w=f,C=!1,S=!1;e?w||(C=e.has(v),S=e.has(x),w=!C&&!S):(C=!0,S=!0);const _=w||C,I=w||S;let B=!1;_&&(B=u(y,g,w));let M=!1;I&&(M=u(b,g,w));const R=B||M;if(R)for(let k=0;k<3;k++){const G=y+k,X=b+k,F=c[G],z=c[G+3],H=c[X],Z=c[X+3];c[p+k]=F<H?F:H,c[p+k+3]=z>Z?z:Z}return R}}}function Kg(n,e,i,s,r){let o,a,l,c,h,d;const u=1/i.direction.x,p=1/i.direction.y,g=1/i.direction.z,f=i.origin.x,A=i.origin.y,y=i.origin.z;let b=e[n],v=e[n+3],x=e[n+1],w=e[n+3+1],C=e[n+2],S=e[n+3+2];return u>=0?(o=(b-f)*u,a=(v-f)*u):(o=(v-f)*u,a=(b-f)*u),p>=0?(l=(x-A)*p,c=(w-A)*p):(l=(w-A)*p,c=(x-A)*p),o>c||l>a||((l>o||isNaN(o))&&(o=l),(c<a||isNaN(a))&&(a=c),g>=0?(h=(C-y)*g,d=(S-y)*g):(h=(S-y)*g,d=(C-y)*g),o>d||h>a)?!1:((h>o||o!==o)&&(o=h),(d<a||a!==a)&&(a=d),o<=r&&a>=s)}function SZe(n,e,i,s,r,o,a,l){const{geometry:c,_indirectBuffer:h}=n;for(let d=s,u=s+r;d<u;d++){let p=h?h[d]:d;yk(c,e,i,p,o,a,l)}}function _Ze(n,e,i,s,r,o,a){const{geometry:l,_indirectBuffer:c}=n;let h=1/0,d=null;for(let u=s,p=s+r;u<p;u++){let g;g=yk(l,e,i,c?c[u]:u,null,o,a),g&&g.distance<h&&(d=g,h=g.distance)}return d}function MZe(n,e,i,s,r,o,a){const{geometry:l}=i,{index:c}=l,h=l.attributes.position;for(let d=n,u=e+n;d<u;d++){let p;if(p=i.resolveTriangleIndex(d),gr(a,p*3,c,h),a.needsUpdate=!0,s(a,p,r,o))return!0}return!1}function IZe(n,e,i,s,r,o,a){$n.setBuffer(n._roots[e]),bZ(0,n,i,s,r,o,a),$n.clearBuffer()}function bZ(n,e,i,s,r,o,a){const{float32Array:l,uint16Array:c,uint32Array:h}=$n,d=n*2;if(Za(d,c)){const u=fl(n,h),p=hc(d,c);vZe(e,i,s,u,p,r,o,a)}else{const u=jc(n);Kg(u,l,s,o,a)&&bZ(u,e,i,s,r,o,a);const p=dc(n,h);Kg(p,l,s,o,a)&&bZ(p,e,i,s,r,o,a)}}const TZe=["x","y","z"];function EZe(n,e,i,s,r,o){$n.setBuffer(n._roots[e]);const a=vZ(0,n,i,s,r,o);return $n.clearBuffer(),a}function vZ(n,e,i,s,r,o){const{float32Array:a,uint16Array:l,uint32Array:c}=$n;let h=n*2;if(Za(h,l)){const d=fl(n,c),u=hc(h,l);return xZe(e,i,s,d,u,r,o)}else{const d=dZ(n,c),u=TZe[d],p=s.direction[u]>=0;let g,f;p?(g=jc(n),f=dc(n,c)):(g=dc(n,c),f=jc(n));const A=Kg(g,a,s,r,o)?vZ(g,e,i,s,r,o):null;if(A){const b=A.point[u];if(p?b<=a[f+d]:b>=a[f+d+3])return A}const y=Kg(f,a,s,r,o)?vZ(f,e,i,s,r,o):null;return A&&y?A.distance<=y.distance?A:y:A||y||null}}const bk=new gi,dx=new Jc,ux=new Jc,F_=new de,Ale=new ua,vk=new ua;function RZe(n,e,i,s){$n.setBuffer(n._roots[e]);const r=xZ(0,n,i,s);return $n.clearBuffer(),r}function xZ(n,e,i,s,r=null){const{float32Array:o,uint16Array:a,uint32Array:l}=$n;let c=n*2;if(r===null&&(i.boundingBox||i.computeBoundingBox(),Ale.set(i.boundingBox.min,i.boundingBox.max,s),r=Ale),Za(c,a)){const h=e.geometry,d=h.index,u=h.attributes.position,p=i.index,g=i.attributes.position,f=fl(n,l),A=hc(c,a);if(F_.copy(s).invert(),i.boundsTree)return Un(n,o,vk),vk.matrix.copy(F_),vk.needsUpdate=!0,i.boundsTree.shapecast({intersectsBounds:y=>vk.intersectsBox(y),intersectsTriangle:y=>{y.a.applyMatrix4(s),y.b.applyMatrix4(s),y.c.applyMatrix4(s),y.needsUpdate=!0;for(let b=f*3,v=(A+f)*3;b<v;b+=3)if(gr(ux,b,d,u),ux.needsUpdate=!0,y.intersectsTriangle(ux))return!0;return!1}});for(let y=f*3,b=(A+f)*3;y<b;y+=3){gr(dx,y,d,u),dx.a.applyMatrix4(F_),dx.b.applyMatrix4(F_),dx.c.applyMatrix4(F_),dx.needsUpdate=!0;for(let v=0,x=p.count;v<x;v+=3)if(gr(ux,v,p,g),ux.needsUpdate=!0,dx.intersectsTriangle(ux))return!0}}else{const h=n+8,d=l[n+6];return Un(h,o,bk),!!(r.intersectsBox(bk)&&xZ(h,e,i,s,r)||(Un(d,o,bk),r.intersectsBox(bk)&&xZ(d,e,i,s,r)))}}const xk=new de,wZ=new ua,U_=new ua,LZe=new E,BZe=new E,kZe=new E,GZe=new E;function PZe(n,e,i,s={},r={},o=0,a=1/0){e.boundingBox||e.computeBoundingBox(),wZ.set(e.boundingBox.min,e.boundingBox.max,i),wZ.needsUpdate=!0;const l=n.geometry,c=l.attributes.position,h=l.index,d=e.attributes.position,u=e.index,p=qc.getPrimitive(),g=qc.getPrimitive();let f=LZe,A=BZe,y=null,b=null;r&&(y=kZe,b=GZe);let v=1/0,x=null,w=null;return xk.copy(i).invert(),U_.matrix.copy(xk),n.shapecast({boundsTraverseOrder:C=>wZ.distanceToBox(C),intersectsBounds:(C,S,_)=>_<v&&_<a?(S&&(U_.min.copy(C.min),U_.max.copy(C.max),U_.needsUpdate=!0),!0):!1,intersectsRange:(C,S)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:_=>U_.distanceToBox(_),intersectsBounds:(_,I,B)=>B<v&&B<a,intersectsRange:(_,I)=>{for(let B=_,M=_+I;B<M;B++){gr(g,3*B,u,d),g.a.applyMatrix4(i),g.b.applyMatrix4(i),g.c.applyMatrix4(i),g.needsUpdate=!0;for(let R=C,k=C+S;R<k;R++){gr(p,3*R,h,c),p.needsUpdate=!0;const G=p.distanceToTriangle(g,f,y);if(G<v&&(A.copy(f),b&&b.copy(y),v=G,x=R,w=B),G<o)return!0}}}});{const _=lx(e);for(let I=0,B=_;I<B;I++){gr(g,3*I,u,d),g.a.applyMatrix4(i),g.b.applyMatrix4(i),g.c.applyMatrix4(i),g.needsUpdate=!0;for(let M=C,R=C+S;M<R;M++){gr(p,3*M,h,c),p.needsUpdate=!0;const k=p.distanceToTriangle(g,f,y);if(k<v&&(A.copy(f),b&&b.copy(y),v=k,x=M,w=I),k<o)return!0}}}}}),qc.releasePrimitive(p),qc.releasePrimitive(g),v===1/0?null:(s.point?s.point.copy(A):s.point=A.clone(),s.distance=v,s.faceIndex=x,r&&(r.point?r.point.copy(b):r.point=b.clone(),r.point.applyMatrix4(xk),A.applyMatrix4(xk),r.distance=A.sub(r.point).length(),r.faceIndex=w),s)}function NZe(n,e=null){e&&Array.isArray(e)&&(e=new Set(e));const i=n.geometry,s=i.index?i.index.array:null,r=i.attributes.position;let o,a,l,c,h=0;const d=n._roots;for(let p=0,g=d.length;p<g;p++)o=d[p],a=new Uint32Array(o),l=new Uint16Array(o),c=new Float32Array(o),u(0,h),h+=o.byteLength;function u(p,g,f=!1){const A=p*2;if(l[A+15]===hk){const y=a[p+6],b=l[A+14];let v=1/0,x=1/0,w=1/0,C=-1/0,S=-1/0,_=-1/0;for(let I=y,B=y+b;I<B;I++){const M=3*n.resolveTriangleIndex(I);for(let R=0;R<3;R++){let k=M+R;k=s?s[k]:k;const G=r.getX(k),X=r.getY(k),F=r.getZ(k);G<v&&(v=G),G>C&&(C=G),X<x&&(x=X),X>S&&(S=X),F<w&&(w=F),F>_&&(_=F)}}return c[p+0]!==v||c[p+1]!==x||c[p+2]!==w||c[p+3]!==C||c[p+4]!==S||c[p+5]!==_?(c[p+0]=v,c[p+1]=x,c[p+2]=w,c[p+3]=C,c[p+4]=S,c[p+5]=_,!0):!1}else{const y=p+8,b=a[p+6],v=y+g,x=b+g;let w=f,C=!1,S=!1;e?w||(C=e.has(v),S=e.has(x),w=!C&&!S):(C=!0,S=!0);const _=w||C,I=w||S;let B=!1;_&&(B=u(y,g,w));let M=!1;I&&(M=u(b,g,w));const R=B||M;if(R)for(let k=0;k<3;k++){const G=y+k,X=b+k,F=c[G],z=c[G+3],H=c[X],Z=c[X+3];c[p+k]=F<H?F:H,c[p+k+3]=z>Z?z:Z}return R}}}function VZe(n,e,i,s,r,o,a){$n.setBuffer(n._roots[e]),CZ(0,n,i,s,r,o,a),$n.clearBuffer()}function CZ(n,e,i,s,r,o,a){const{float32Array:l,uint16Array:c,uint32Array:h}=$n,d=n*2;if(Za(d,c)){const u=fl(n,h),p=hc(d,c);SZe(e,i,s,u,p,r,o,a)}else{const u=jc(n);Kg(u,l,s,o,a)&&CZ(u,e,i,s,r,o,a);const p=dc(n,h);Kg(p,l,s,o,a)&&CZ(p,e,i,s,r,o,a)}}const XZe=["x","y","z"];function DZe(n,e,i,s,r,o){$n.setBuffer(n._roots[e]);const a=SZ(0,n,i,s,r,o);return $n.clearBuffer(),a}function SZ(n,e,i,s,r,o){const{float32Array:a,uint16Array:l,uint32Array:c}=$n;let h=n*2;if(Za(h,l)){const d=fl(n,c),u=hc(h,l);return _Ze(e,i,s,d,u,r,o)}else{const d=dZ(n,c),u=XZe[d],p=s.direction[u]>=0;let g,f;p?(g=jc(n),f=dc(n,c)):(g=dc(n,c),f=jc(n));const A=Kg(g,a,s,r,o)?SZ(g,e,i,s,r,o):null;if(A){const b=A.point[u];if(p?b<=a[f+d]:b>=a[f+d+3])return A}const y=Kg(f,a,s,r,o)?SZ(f,e,i,s,r,o):null;return A&&y?A.distance<=y.distance?A:y:A||y||null}}const wk=new gi,px=new Jc,mx=new Jc,O_=new de,yle=new ua,Ck=new ua;function zZe(n,e,i,s){$n.setBuffer(n._roots[e]);const r=_Z(0,n,i,s);return $n.clearBuffer(),r}function _Z(n,e,i,s,r=null){const{float32Array:o,uint16Array:a,uint32Array:l}=$n;let c=n*2;if(r===null&&(i.boundingBox||i.computeBoundingBox(),yle.set(i.boundingBox.min,i.boundingBox.max,s),r=yle),Za(c,a)){const h=e.geometry,d=h.index,u=h.attributes.position,p=i.index,g=i.attributes.position,f=fl(n,l),A=hc(c,a);if(O_.copy(s).invert(),i.boundsTree)return Un(n,o,Ck),Ck.matrix.copy(O_),Ck.needsUpdate=!0,i.boundsTree.shapecast({intersectsBounds:y=>Ck.intersectsBox(y),intersectsTriangle:y=>{y.a.applyMatrix4(s),y.b.applyMatrix4(s),y.c.applyMatrix4(s),y.needsUpdate=!0;for(let b=f,v=A+f;b<v;b++)if(gr(mx,3*e.resolveTriangleIndex(b),d,u),mx.needsUpdate=!0,y.intersectsTriangle(mx))return!0;return!1}});for(let y=f,b=A+f;y<b;y++){const v=e.resolveTriangleIndex(y);gr(px,3*v,d,u),px.a.applyMatrix4(O_),px.b.applyMatrix4(O_),px.c.applyMatrix4(O_),px.needsUpdate=!0;for(let x=0,w=p.count;x<w;x+=3)if(gr(mx,x,p,g),mx.needsUpdate=!0,px.intersectsTriangle(mx))return!0}}else{const h=n+8,d=l[n+6];return Un(h,o,wk),!!(r.intersectsBox(wk)&&_Z(h,e,i,s,r)||(Un(d,o,wk),r.intersectsBox(wk)&&_Z(d,e,i,s,r)))}}const Sk=new de,MZ=new ua,Z_=new ua,FZe=new E,UZe=new E,OZe=new E,ZZe=new E;function WZe(n,e,i,s={},r={},o=0,a=1/0){e.boundingBox||e.computeBoundingBox(),MZ.set(e.boundingBox.min,e.boundingBox.max,i),MZ.needsUpdate=!0;const l=n.geometry,c=l.attributes.position,h=l.index,d=e.attributes.position,u=e.index,p=qc.getPrimitive(),g=qc.getPrimitive();let f=FZe,A=UZe,y=null,b=null;r&&(y=OZe,b=ZZe);let v=1/0,x=null,w=null;return Sk.copy(i).invert(),Z_.matrix.copy(Sk),n.shapecast({boundsTraverseOrder:C=>MZ.distanceToBox(C),intersectsBounds:(C,S,_)=>_<v&&_<a?(S&&(Z_.min.copy(C.min),Z_.max.copy(C.max),Z_.needsUpdate=!0),!0):!1,intersectsRange:(C,S)=>{if(e.boundsTree){const _=e.boundsTree;return _.shapecast({boundsTraverseOrder:I=>Z_.distanceToBox(I),intersectsBounds:(I,B,M)=>M<v&&M<a,intersectsRange:(I,B)=>{for(let M=I,R=I+B;M<R;M++){const k=_.resolveTriangleIndex(M);gr(g,3*k,u,d),g.a.applyMatrix4(i),g.b.applyMatrix4(i),g.c.applyMatrix4(i),g.needsUpdate=!0;for(let G=C,X=C+S;G<X;G++){const F=n.resolveTriangleIndex(G);gr(p,3*F,h,c),p.needsUpdate=!0;const z=p.distanceToTriangle(g,f,y);if(z<v&&(A.copy(f),b&&b.copy(y),v=z,x=G,w=M),z<o)return!0}}}})}else{const _=lx(e);for(let I=0,B=_;I<B;I++){gr(g,3*I,u,d),g.a.applyMatrix4(i),g.b.applyMatrix4(i),g.c.applyMatrix4(i),g.needsUpdate=!0;for(let M=C,R=C+S;M<R;M++){const k=n.resolveTriangleIndex(M);gr(p,3*k,h,c),p.needsUpdate=!0;const G=p.distanceToTriangle(g,f,y);if(G<v&&(A.copy(f),b&&b.copy(y),v=G,x=M,w=I),G<o)return!0}}}}}),qc.releasePrimitive(p),qc.releasePrimitive(g),v===1/0?null:(s.point?s.point.copy(A):s.point=A.clone(),s.distance=v,s.faceIndex=x,r&&(r.point?r.point.copy(b):r.point=b.clone(),r.point.applyMatrix4(Sk),A.applyMatrix4(Sk),r.distance=A.sub(r.point).length(),r.faceIndex=w),s)}function ble(){return typeof SharedArrayBuffer<"u"}const W_=new $n.constructor,_k=new $n.constructor,Yg=new fZ(()=>new gi),gx=new gi,fx=new gi,IZ=new gi,TZ=new gi;let EZ=!1;function HZe(n,e,i,s){if(EZ)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");EZ=!0;const r=n._roots,o=e._roots;let a,l=0,c=0;const h=new de().copy(i).invert();for(let d=0,u=r.length;d<u;d++){W_.setBuffer(r[d]),c=0;const p=Yg.getPrimitive();Un(0,W_.float32Array,p),p.applyMatrix4(h);for(let g=0,f=o.length;g<f&&(_k.setBuffer(o[g]),a=Yh(0,0,i,h,s,l,c,0,0,p),_k.clearBuffer(),c+=o[g].length,!a);g++);if(Yg.releasePrimitive(p),W_.clearBuffer(),l+=r[d].length,a)break}return EZ=!1,a}function Yh(n,e,i,s,r,o=0,a=0,l=0,c=0,h=null,d=!1){let u,p;d?(u=_k,p=W_):(u=W_,p=_k);const g=u.float32Array,f=u.uint32Array,A=u.uint16Array,y=p.float32Array,b=p.uint32Array,v=p.uint16Array,x=n*2,w=e*2,C=Za(x,A),S=Za(w,v);let _=!1;if(S&&C)d?_=r(fl(e,b),hc(e*2,v),fl(n,f),hc(n*2,A),c,a+e,l,o+n):_=r(fl(n,f),hc(n*2,A),fl(e,b),hc(e*2,v),l,o+n,c,a+e);else if(S){const I=Yg.getPrimitive();Un(e,y,I),I.applyMatrix4(i);const B=jc(n),M=dc(n,f);Un(B,g,gx),Un(M,g,fx);const R=I.intersectsBox(gx),k=I.intersectsBox(fx);_=R&&Yh(e,B,s,i,r,a,o,c,l+1,I,!d)||k&&Yh(e,M,s,i,r,a,o,c,l+1,I,!d),Yg.releasePrimitive(I)}else{const I=jc(e),B=dc(e,b);Un(I,y,IZ),Un(B,y,TZ);const M=h.intersectsBox(IZ),R=h.intersectsBox(TZ);if(M&&R)_=Yh(n,I,i,s,r,o,a,l,c+1,h,d)||Yh(n,B,i,s,r,o,a,l,c+1,h,d);else if(M)if(C)_=Yh(n,I,i,s,r,o,a,l,c+1,h,d);else{const k=Yg.getPrimitive();k.copy(IZ).applyMatrix4(i);const G=jc(n),X=dc(n,f);Un(G,g,gx),Un(X,g,fx);const F=k.intersectsBox(gx),z=k.intersectsBox(fx);_=F&&Yh(I,G,s,i,r,a,o,c,l+1,k,!d)||z&&Yh(I,X,s,i,r,a,o,c,l+1,k,!d),Yg.releasePrimitive(k)}else if(R)if(C)_=Yh(n,B,i,s,r,o,a,l,c+1,h,d);else{const k=Yg.getPrimitive();k.copy(TZ).applyMatrix4(i);const G=jc(n),X=dc(n,f);Un(G,g,gx),Un(X,g,fx);const F=k.intersectsBox(gx),z=k.intersectsBox(fx);_=F&&Yh(B,G,s,i,r,a,o,c,l+1,k,!d)||z&&Yh(B,X,s,i,r,a,o,c,l+1,k,!d),Yg.releasePrimitive(k)}}return _}const Mk=new ua,vle=new gi,QZe={strategy:rZ,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class qg{static serialize(e,i={}){i={cloneBuffers:!0,...i};const s=e.geometry,r=e._roots,o=e._indirectBuffer,a=s.getIndex();let l;return i.cloneBuffers?l={roots:r.map(c=>c.slice()),index:a?a.array.slice():null,indirectBuffer:o?o.slice():null}:l={roots:r,index:a?a.array:null,indirectBuffer:o},l}static deserialize(e,i,s={}){s={setIndex:!0,indirect:!!e.indirectBuffer,...s};const{index:r,roots:o,indirectBuffer:a}=e,l=new qg(i,{...s,[lZ]:!0});if(l._roots=o,l._indirectBuffer=a||null,s.setIndex){const c=i.getIndex();if(c===null){const h=new ct(e.index,1,!1);i.setIndex(h)}else c.array!==r&&(c.array.set(r),c.needsUpdate=!0)}return l}get indirect(){return!!this._indirectBuffer}constructor(e,i={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(i=Object.assign({...QZe,[lZ]:!1},i),i.useSharedArrayBuffer&&!ble())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,i[lZ]||(lZe(this,i),!e.boundingBox&&i.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new gi))),this.resolveTriangleIndex=i.indirect?s=>this._indirectBuffer[s]:s=>s}refit(e=null){return(this.indirect?NZe:CZe)(this,e)}traverse(e,i=0){const s=this._roots[i],r=new Uint32Array(s),o=new Uint16Array(s);a(0);function a(l,c=0){const h=l*2,d=o[h+15]===hk;if(d){const u=r[l+6],p=o[h+14];e(c,d,new Float32Array(s,l*4,6),u,p)}else{const u=l+Wg/4,p=r[l+6],g=r[l+7];e(c,d,new Float32Array(s,l*4,6),g)||(a(u,c+1),a(p,c+1))}}}raycast(e,i=ms,s=0,r=1/0){const o=this._roots,a=this.geometry,l=[],c=i.isMaterial,h=Array.isArray(i),d=a.groups,u=c?i.side:i,p=this.indirect?VZe:IZe;for(let g=0,f=o.length;g<f;g++){const A=h?i[d[g].materialIndex].side:u,y=l.length;if(p(this,g,A,e,l,s,r),h){const b=d[g].materialIndex;for(let v=y,x=l.length;v<x;v++)l[v].face.materialIndex=b}}return l}raycastFirst(e,i=ms,s=0,r=1/0){const o=this._roots,a=this.geometry,l=i.isMaterial,c=Array.isArray(i);let h=null;const d=a.groups,u=l?i.side:i,p=this.indirect?DZe:EZe;for(let g=0,f=o.length;g<f;g++){const A=c?i[d[g].materialIndex].side:u,y=p(this,g,A,e,s,r);y!=null&&(h==null||y.distance<h.distance)&&(h=y,c&&(y.face.materialIndex=d[g].materialIndex))}return h}intersectsGeometry(e,i){let s=!1;const r=this._roots,o=this.indirect?zZe:RZe;for(let a=0,l=r.length;a<l&&(s=o(this,a,e,i),!s);a++);return s}shapecast(e){const i=qc.getPrimitive(),s=this.indirect?MZe:wZe;let{boundsTraverseOrder:r,intersectsBounds:o,intersectsRange:a,intersectsTriangle:l}=e;if(a&&l){const u=a;a=(p,g,f,A,y)=>u(p,g,f,A,y)?!0:s(p,g,this,l,f,A,i)}else a||(l?a=(u,p,g,f)=>s(u,p,this,l,g,f,i):a=(u,p,g)=>g);let c=!1,h=0;const d=this._roots;for(let u=0,p=d.length;u<p;u++){const g=d[u];if(c=mZe(this,u,o,a,r,h),c)break;h+=g.byteLength}return qc.releasePrimitive(i),c}bvhcast(e,i,s){let{intersectsRanges:r,intersectsTriangles:o}=s;const a=qc.getPrimitive(),l=this.geometry.index,c=this.geometry.attributes.position,h=this.indirect?f=>{const A=this.resolveTriangleIndex(f);gr(a,A*3,l,c)}:f=>{gr(a,f*3,l,c)},d=qc.getPrimitive(),u=e.geometry.index,p=e.geometry.attributes.position,g=e.indirect?f=>{const A=e.resolveTriangleIndex(f);gr(d,A*3,u,p)}:f=>{gr(d,f*3,u,p)};if(o){const f=(A,y,b,v,x,w,C,S)=>{for(let _=b,I=b+v;_<I;_++){g(_),d.a.applyMatrix4(i),d.b.applyMatrix4(i),d.c.applyMatrix4(i),d.needsUpdate=!0;for(let B=A,M=A+y;B<M;B++)if(h(B),a.needsUpdate=!0,o(a,d,B,_,x,w,C,S))return!0}return!1};if(r){const A=r;r=function(y,b,v,x,w,C,S,_){return A(y,b,v,x,w,C,S,_)?!0:f(y,b,v,x,w,C,S,_)}}else r=f}return HZe(this,e,i,r)}intersectsBox(e,i){return Mk.set(e.min,e.max,i),Mk.needsUpdate=!0,this.shapecast({intersectsBounds:s=>Mk.intersectsBox(s),intersectsTriangle:s=>Mk.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:i=>e.intersectsBox(i),intersectsTriangle:i=>i.intersectsSphere(e)})}closestPointToGeometry(e,i,s={},r={},o=0,a=1/0){return(this.indirect?WZe:PZe)(this,e,i,s,r,o,a)}closestPointToPoint(e,i={},s=0,r=1/0){return gZe(this,e,i,s,r)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(i=>{Un(0,new Float32Array(i),vle),e.union(vle)}),e}}const xle=new gi,wle=new de;class KZe extends Ae{get isMesh(){return!this.displayEdges}get isLineSegments(){return this.displayEdges}get isLine(){return this.displayEdges}getVertexPosition(...e){return pe.prototype.getVertexPosition.call(this,...e)}constructor(e,i,s=10,r=0){super(),this.material=i,this.geometry=new Rt,this.name="MeshBVHRootHelper",this.depth=s,this.displayParents=!1,this.bvh=e,this.displayEdges=!0,this._group=r}raycast(){}update(){const e=this.geometry,i=this.bvh,s=this._group;if(e.dispose(),this.visible=!1,i){const r=this.depth-1,o=this.displayParents;let a=0;i.traverse((p,g)=>{if(p>=r||g)return a++,!0;o&&a++},s);let l=0;const c=new Float32Array(8*3*a);i.traverse((p,g,f)=>{const A=p>=r||g;if(A||o){Un(0,f,xle);const{min:y,max:b}=xle;for(let v=-1;v<=1;v+=2){const x=v<0?y.x:b.x;for(let w=-1;w<=1;w+=2){const C=w<0?y.y:b.y;for(let S=-1;S<=1;S+=2){const _=S<0?y.z:b.z;c[l+0]=x,c[l+1]=C,c[l+2]=_,l+=3}}}return A}},s);let h,d;this.displayEdges?d=new Uint8Array([0,4,1,5,2,6,3,7,0,2,1,3,4,6,5,7,0,1,2,3,4,5,6,7]):d=new Uint8Array([0,1,2,2,1,3,4,6,5,6,7,5,1,4,5,0,4,1,2,3,6,3,7,6,0,2,4,2,6,4,1,5,3,3,5,7]),c.length>65535?h=new Uint32Array(d.length*a):h=new Uint16Array(d.length*a);const u=d.length;for(let p=0;p<a;p++){const g=p*8,f=p*u;for(let A=0;A<u;A++)h[f+A]=g+d[A]}e.setIndex(new ct(h,1,!1)),e.setAttribute("position",new ct(c,3,!1)),this.visible=!0}}}class HZ extends Es{get color(){return this.edgeMaterial.color}get opacity(){return this.edgeMaterial.opacity}set opacity(e){this.edgeMaterial.opacity=e,this.meshMaterial.opacity=e}constructor(e=null,i=null,s=10){e instanceof qg&&(s=i||10,i=e,e=null),typeof i=="number"&&(s=i,i=null),super(),this.name="MeshBVHHelper",this.depth=s,this.mesh=e,this.bvh=i,this.displayParents=!1,this.displayEdges=!0,this.objectIndex=0,this._roots=[];const r=new Cn({color:65416,transparent:!0,opacity:.3,depthWrite:!1}),o=new ai({color:65416,transparent:!0,opacity:.3,depthWrite:!1});o.color=r.color,this.edgeMaterial=r,this.meshMaterial=o,this.update()}update(){const e=this.mesh;let i=this.bvh||e.geometry.boundsTree||null;if(e.isBatchedMesh&&e.boundsTrees&&!i){const r=e._drawInfo[this.objectIndex];r&&(i=e.boundsTrees[r.geometryIndex]||i)}const s=i?i._roots.length:0;for(;this._roots.length>s;){const r=this._roots.pop();r.geometry.dispose(),this.remove(r)}for(let r=0;r<s;r++){const{depth:o,edgeMaterial:a,meshMaterial:l,displayParents:c,displayEdges:h}=this;if(r>=this._roots.length){const u=new KZe(i,a,o,r);this.add(u),this._roots.push(u)}const d=this._roots[r];d.bvh=i,d.depth=o,d.displayParents=c,d.displayEdges=h,d.material=h?a:l,d.update()}}updateMatrixWorld(...e){const i=this.mesh,s=this.parent;i!==null&&(i.updateWorldMatrix(!0,!1),s?this.matrix.copy(s.matrixWorld).invert().multiply(i.matrixWorld):this.matrix.copy(i.matrixWorld),(i.isInstancedMesh||i.isBatchedMesh)&&(i.getMatrixAt(this.objectIndex,wle),this.matrix.multiply(wle)),this.matrix.decompose(this.position,this.quaternion,this.scale)),super.updateMatrixWorld(...e)}copy(e){this.depth=e.depth,this.mesh=e.mesh,this.bvh=e.bvh,this.opacity=e.opacity,this.color.copy(e.color)}clone(){return new HZ(this.mesh,this.bvh,this.depth)}dispose(){this.edgeMaterial.dispose(),this.meshMaterial.dispose();const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].geometry.dispose()}}const H_=new gi,Cle=new gi,Ax=new E;function Sle(n){switch(typeof n){case"number":return 8;case"string":return n.length*2;case"boolean":return 4;default:return 0}}function YZe(n){return/(Uint|Int|Float)(8|16|32)Array/.test(n.constructor.name)}function jZe(n,e){const i={nodeCount:0,leafNodeCount:0,depth:{min:1/0,max:-1/0},tris:{min:1/0,max:-1/0},splits:[0,0,0],surfaceAreaScore:0};return n.traverse((s,r,o,a,l)=>{const c=o[3]-o[0],h=o[1+3]-o[1],d=o[2+3]-o[2],u=2*(c*h+h*d+d*c);i.nodeCount++,r?(i.leafNodeCount++,i.depth.min=Math.min(s,i.depth.min),i.depth.max=Math.max(s,i.depth.max),i.tris.min=Math.min(l,i.tris.min),i.tris.max=Math.max(l,i.tris.max),i.surfaceAreaScore+=u*ck*l):(i.splits[a]++,i.surfaceAreaScore+=u*aZ)},e),i.tris.min===1/0&&(i.tris.min=0,i.tris.max=0),i.depth.min===1/0&&(i.depth.min=0,i.depth.max=0),i}function JZe(n){return n._roots.map((e,i)=>jZe(n,i))}function qZe(n){const e=new Set,i=[n];let s=0;for(;i.length;){const r=i.pop();if(!e.has(r)){e.add(r);for(let o in r){if(!Object.hasOwn(r,o))continue;s+=Sle(o);const a=r[o];a&&(typeof a=="object"||typeof a=="function")?YZe(a)||ble()&&a instanceof SharedArrayBuffer||a instanceof ArrayBuffer?s+=a.byteLength:i.push(a):s+=Sle(a)}}}return s}function $Ze(n){const e=n.geometry,i=[],s=e.index,r=e.getAttribute("position");let o=!0;return n.traverse((a,l,c,h,d)=>{const u={depth:a,isLeaf:l,boundingData:c,offset:h,count:d};i[a]=u,Un(0,c,H_);const p=i[a-1];if(l)for(let g=h,f=h+d;g<f;g++){const A=n.resolveTriangleIndex(g);let y=3*A,b=3*A+1,v=3*A+2;s&&(y=s.getX(y),b=s.getX(b),v=s.getX(v));let x;Ax.fromBufferAttribute(r,y),x=H_.containsPoint(Ax),Ax.fromBufferAttribute(r,b),x=x&&H_.containsPoint(Ax),Ax.fromBufferAttribute(r,v),x=x&&H_.containsPoint(Ax),console.assert(x,"Leaf bounds does not fully contain triangle."),o=o&&x}if(p){Un(0,c,Cle);const g=Cle.containsBox(H_);console.assert(g,"Parent bounds does not fully contain child."),o=o&&g}}),o}function eWe(n){const e=[];return n.traverse((i,s,r,o,a)=>{const l={bounds:Un(0,r,new gi)};s?(l.count=a,l.offset=o):(l.left=null,l.right=null),e[i]=l;const c=e[i-1];c&&(c.left===null?c.left=l:c.right=l)}),e[0]}function _le(n,e,i){return n===null?null:(n.point.applyMatrix4(e.matrixWorld),n.distance=n.point.distanceTo(i.ray.origin),n.object=e,n)}const tWe=parseInt(fa)>=166,Ik=new ya,Mle=new E,Ile=new de,iWe=pe.prototype.raycast,nWe=u1.prototype.raycast,Tle=new E,Uo=new pe,Tk=[];function sWe(n,e){this.isBatchedMesh?rWe.call(this,n,e):oWe.call(this,n,e)}function rWe(n,e){if(this.boundsTrees){const i=this.boundsTrees,s=this._drawInfo||this._instanceInfo,r=this._drawRanges||this._geometryInfo,o=this.matrixWorld;Uo.material=this.material,Uo.geometry=this.geometry;const a=Uo.geometry.boundsTree,l=Uo.geometry.drawRange;Uo.geometry.boundingSphere===null&&(Uo.geometry.boundingSphere=new Vn);for(let c=0,h=s.length;c<h;c++){if(!this.getVisibleAt(c))continue;const d=s[c].geometryIndex;if(Uo.geometry.boundsTree=i[d],this.getMatrixAt(c,Uo.matrixWorld).premultiply(o),!Uo.geometry.boundsTree){this.getBoundingBoxAt(d,Uo.geometry.boundingBox),this.getBoundingSphereAt(d,Uo.geometry.boundingSphere);const u=r[d];Uo.geometry.setDrawRange(u.start,u.count)}Uo.raycast(n,Tk);for(let u=0,p=Tk.length;u<p;u++){const g=Tk[u];g.object=this,g.batchId=c,e.push(g)}Tk.length=0}Uo.geometry.boundsTree=a,Uo.geometry.drawRange=l,Uo.material=null,Uo.geometry=null}else nWe.call(this,n,e)}function oWe(n,e){if(this.geometry.boundsTree){if(this.material===void 0)return;Ile.copy(this.matrixWorld).invert(),Ik.copy(n.ray).applyMatrix4(Ile),Tle.setFromMatrixScale(this.matrixWorld),Mle.copy(Ik.direction).multiply(Tle);const i=Mle.length(),s=n.near/i,r=n.far/i,o=this.geometry.boundsTree;if(n.firstHitOnly===!0){const a=_le(o.raycastFirst(Ik,this.material,s,r),this,n);a&&e.push(a)}else{const a=o.raycast(Ik,this.material,s,r);for(let l=0,c=a.length;l<c;l++){const h=_le(a[l],this,n);h&&e.push(h)}}}else iWe.call(this,n,e)}function aWe(n={}){return this.boundsTree=new qg(this,n),this.boundsTree}function lWe(){this.boundsTree=null}function cWe(n=-1,e={}){if(!tWe)throw new Error("BatchedMesh: Three r166+ is required to compute bounds trees.");e.indirect&&console.warn('"Indirect" is set to false because it is not supported for BatchedMesh.'),e={...e,indirect:!1,range:null};const i=this._drawRanges||this._geometryInfo,s=this._geometryCount;this.boundsTrees||(this.boundsTrees=new Array(s).fill(null));const r=this.boundsTrees;for(;r.length<s;)r.push(null);if(n<0){for(let o=0;o<s;o++)e.range=i[o],r[o]=new qg(this.geometry,e);return r}else return n<i.length&&(e.range=i[n],r[n]=new qg(this.geometry,e)),r[n]||null}function hWe(n=-1){n<0?this.boundsTrees.fill(null):n<this.boundsTree.length&&(this.boundsTrees[n]=null)}function dWe(n){switch(n){case 1:return"R";case 2:return"RG";case 3:return"RGBA";case 4:return"RGBA"}throw new Error}function uWe(n){switch(n){case 1:return vl;case 2:return fc;case 3:return _i;case 4:return _i}}function Ele(n){switch(n){case 1:return KA;case 2:return YA;case 3:return uf;case 4:return uf}}class Ek extends nr{constructor(){super(),this.minFilter=si,this.magFilter=si,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){const i=this.overrideItemSize,s=e.itemSize,r=e.count;if(i!==null){if(s*r%i!==0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=i,e.count=r*s/i}const o=e.itemSize,a=e.count,l=e.normalized,c=e.array.constructor,h=c.BYTES_PER_ELEMENT;let d=this._forcedType,u=o;if(d===null)switch(c){case Float32Array:d=en;break;case Uint8Array:case Uint16Array:case Uint32Array:d=Gr;break;case Int8Array:case Int16Array:case Int32Array:d=nd;break}let p,g,f,A,y=dWe(o);switch(d){case en:f=1,g=uWe(o),l&&h===1?(A=c,y+="8",c===Uint8Array?p=Xi:(p=Lx,y+="_SNORM")):(A=Float32Array,y+="32F",p=en);break;case nd:y+=h*8+"I",f=l?Math.pow(2,c.BYTES_PER_ELEMENT*8-1):1,g=Ele(o),h===1?(A=Int8Array,p=Lx):h===2?(A=Int16Array,p=zM):(A=Int32Array,p=nd);break;case Gr:y+=h*8+"UI",f=l?Math.pow(2,c.BYTES_PER_ELEMENT*8-1):1,g=Ele(o),h===1?(A=Uint8Array,p=Xi):h===2?(A=Uint16Array,p=hf):(A=Uint32Array,p=Gr);break}u===3&&(g===_i||g===uf)&&(u=4);const b=Math.ceil(Math.sqrt(a))||1,v=u*b*b,x=new A(v),w=e.normalized;e.normalized=!1;for(let C=0;C<a;C++){const S=u*C;x[S]=e.getX(C)/f,o>=2&&(x[S+1]=e.getY(C)/f),o>=3&&(x[S+2]=e.getZ(C)/f,u===4&&(x[S+3]=1)),o>=4&&(x[S+3]=e.getW(C)/f)}e.normalized=w,this.internalFormat=y,this.format=g,this.type=p,this.image.width=b,this.image.height=b,this.image.data=x,this.needsUpdate=!0,this.dispose(),e.itemSize=s,e.count=r}}class Rle extends Ek{constructor(){super(),this._forcedType=Gr}}class pWe extends Ek{constructor(){super(),this._forcedType=nd}}class Lle extends Ek{constructor(){super(),this._forcedType=en}}class mWe{constructor(){this.index=new Rle,this.position=new Lle,this.bvhBounds=new nr,this.bvhContents=new nr,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(e){const{geometry:i}=e;if(fWe(e,this.bvhBounds,this.bvhContents),this.position.updateFrom(i.attributes.position),e.indirect){const s=e._indirectBuffer;if(this._cachedIndexAttr===null||this._cachedIndexAttr.count!==s.length)if(i.index)this._cachedIndexAttr=i.index.clone();else{const r=nle(ile(i));this._cachedIndexAttr=new ct(r,1,!1)}gWe(i,s,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(i.index)}dispose(){const{index:e,position:i,bvhBounds:s,bvhContents:r}=this;e&&e.dispose(),i&&i.dispose(),s&&s.dispose(),r&&r.dispose()}}function gWe(n,e,i){const s=i.array,r=n.index?n.index.array:null;for(let o=0,a=e.length;o<a;o++){const l=3*o,c=3*e[o];for(let h=0;h<3;h++)s[l+h]=r?r[c+h]:c+h}}function fWe(n,e,i){const s=n._roots;if(s.length!==1)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");const r=s[0],o=new Uint16Array(r),a=new Uint32Array(r),l=new Float32Array(r),c=r.byteLength/Wg,h=2*Math.ceil(Math.sqrt(c/2)),d=new Float32Array(4*h*h),u=Math.ceil(Math.sqrt(c)),p=new Uint32Array(2*u*u);for(let g=0;g<c;g++){const f=g*Wg/4,A=f*2,y=f;for(let b=0;b<3;b++)d[8*g+0+b]=l[y+0+b],d[8*g+4+b]=l[y+3+b];if(Za(A,o)){const b=hc(A,o),v=fl(f,a),x=4294901760|b;p[g*2+0]=x,p[g*2+1]=v}else{const b=4*dc(f,a)/Wg,v=dZ(f,a);p[g*2+0]=v,p[g*2+1]=b}}e.image.data=d,e.image.width=h,e.image.height=h,e.format=_i,e.type=en,e.internalFormat="RGBA32F",e.minFilter=si,e.magFilter=si,e.generateMipmaps=!1,e.needsUpdate=!0,e.dispose(),i.image.data=p,i.image.width=u,i.image.height=u,i.format=YA,i.type=Gr,i.internalFormat="RG32UI",i.minFilter=si,i.magFilter=si,i.generateMipmaps=!1,i.needsUpdate=!0,i.dispose()}const LA=new E,BA=new E,kA=new E,Ble=new $e,Rk=new E,RZ=new E,kle=new $e,Gle=new $e,Lk=new de,Ple=new de;function Q_(n,e){if(!n&&!e)return;const i=n.count===e.count,s=n.normalized===e.normalized,r=n.array.constructor===e.array.constructor,o=n.itemSize===e.itemSize;if(!i||!s||!r||!o)throw new Error}function K_(n,e=null){const i=n.array.constructor,s=n.normalized,r=n.itemSize,o=e===null?n.count:e;return new ct(new i(r*o),r,s)}function Nle(n,e,i=0){if(n.isInterleavedBufferAttribute){const s=n.itemSize;for(let r=0,o=n.count;r<o;r++){const a=r+i;e.setX(a,n.getX(r)),s>=2&&e.setY(a,n.getY(r)),s>=3&&e.setZ(a,n.getZ(r)),s>=4&&e.setW(a,n.getW(r))}}else{const s=e.array,r=s.constructor,o=s.BYTES_PER_ELEMENT*n.itemSize*i;new r(s.buffer,o,n.array.length).set(n.array)}}function AWe(n,e,i){const s=n.elements,r=e.elements;for(let o=0,a=r.length;o<a;o++)s[o]+=r[o]*i}function Vle(n,e,i){const s=n.skeleton,r=n.geometry,o=s.bones,a=s.boneInverses;kle.fromBufferAttribute(r.attributes.skinIndex,e),Gle.fromBufferAttribute(r.attributes.skinWeight,e),Lk.elements.fill(0);for(let l=0;l<4;l++){const c=Gle.getComponent(l);if(c!==0){const h=kle.getComponent(l);Ple.multiplyMatrices(o[h].matrixWorld,a[h]),AWe(Lk,Ple,c)}}return Lk.multiply(n.bindMatrix).premultiply(n.bindMatrixInverse),i.transformDirection(Lk),i}function LZ(n,e,i,s,r){Rk.set(0,0,0);for(let o=0,a=n.length;o<a;o++){const l=e[o],c=n[o];l!==0&&(RZ.fromBufferAttribute(c,s),i?Rk.addScaledVector(RZ,l):Rk.addScaledVector(RZ.sub(r),l))}r.add(Rk)}function yWe(n,e={useGroups:!1,updateIndex:!1,skipAttributes:[]},i=new Rt){const s=n[0].index!==null,{useGroups:r=!1,updateIndex:o=!1,skipAttributes:a=[]}=e,l=new Set(Object.keys(n[0].attributes)),c={};let h=0;i.clearGroups();for(let d=0;d<n.length;++d){const u=n[d];let p=0;if(s!==(u.index!==null))throw new Error("StaticGeometryGenerator: All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.");for(const g in u.attributes){if(!l.has(g))throw new Error('StaticGeometryGenerator: All geometries must have compatible attributes; make sure "'+g+'" attribute exists among all geometries, or in none of them.');c[g]===void 0&&(c[g]=[]),c[g].push(u.attributes[g]),p++}if(p!==l.size)throw new Error("StaticGeometryGenerator: Make sure all geometries have the same number of attributes.");if(r){let g;if(s)g=u.index.count;else if(u.attributes.position!==void 0)g=u.attributes.position.count;else throw new Error("StaticGeometryGenerator: The geometry must have either an index or a position attribute");i.addGroup(h,g,d),h+=g}}if(s){let d=!1;if(!i.index){let u=0;for(let p=0;p<n.length;++p)u+=n[p].index.count;i.setIndex(new ct(new Uint32Array(u),1,!1)),d=!0}if(o||d){const u=i.index;let p=0,g=0;for(let f=0;f<n.length;++f){const A=n[f],y=A.index;if(a[f]!==!0)for(let b=0;b<y.count;++b)u.setX(p,y.getX(b)+g),p++;g+=A.attributes.position.count}}}for(const d in c){const u=c[d];if(!(d in i.attributes)){let f=0;for(const A in u)f+=u[A].count;i.setAttribute(d,K_(c[d][0],f))}const p=i.attributes[d];let g=0;for(let f=0,A=u.length;f<A;f++){const y=u[f];a[f]!==!0&&Nle(y,p,g),g+=y.count}}return i}function bWe(n,e){if(n===null||e===null)return n===e;if(n.length!==e.length)return!1;for(let i=0,s=n.length;i<s;i++)if(n[i]!==e[i])return!1;return!0}function vWe(n){const{index:e,attributes:i}=n;if(e)for(let s=0,r=e.count;s<r;s+=3){const o=e.getX(s),a=e.getX(s+2);e.setX(s,a),e.setX(s+2,o)}else for(const s in i){const r=i[s],o=r.itemSize;for(let a=0,l=r.count;a<l;a+=3)for(let c=0;c<o;c++){const h=r.getComponent(a,c),d=r.getComponent(a+2,c);r.setComponent(a,c,d),r.setComponent(a+2,c,h)}}return n}class xWe{constructor(e){this.matrixWorld=new de,this.geometryHash=null,this.boneMatrices=null,this.primitiveCount=-1,this.mesh=e,this.update()}update(){const e=this.mesh,i=e.geometry,s=e.skeleton,r=(i.index?i.index.count:i.attributes.position.count)/3;if(this.matrixWorld.copy(e.matrixWorld),this.geometryHash=i.attributes.position.version,this.primitiveCount=r,s){s.boneTexture||s.computeBoneTexture(),s.update();const o=s.boneMatrices;!this.boneMatrices||this.boneMatrices.length!==o.length?this.boneMatrices=o.slice():this.boneMatrices.set(o)}else this.boneMatrices=null}didChange(){const e=this.mesh,i=e.geometry,s=(i.index?i.index.count:i.attributes.position.count)/3;return!(this.matrixWorld.equals(e.matrixWorld)&&this.geometryHash===i.attributes.position.version&&bWe(e.skeleton&&e.skeleton.boneMatrices||null,this.boneMatrices)&&this.primitiveCount===s)}}class wWe{constructor(e){Array.isArray(e)||(e=[e]);const i=[];e.forEach(s=>{s.traverseVisible(r=>{r.isMesh&&i.push(r)})}),this.meshes=i,this.useGroups=!0,this.applyWorldTransforms=!0,this.attributes=["position","normal","color","tangent","uv","uv2"],this._intermediateGeometry=new Array(i.length).fill().map(()=>new Rt),this._diffMap=new WeakMap}getMaterials(){const e=[];return this.meshes.forEach(i=>{Array.isArray(i.material)?e.push(...i.material):e.push(i.material)}),e}generate(e=new Rt){let i=[];const{meshes:s,useGroups:r,_intermediateGeometry:o,_diffMap:a}=this;for(let l=0,c=s.length;l<c;l++){const h=s[l],d=o[l],u=a.get(h);!u||u.didChange(h)?(this._convertToStaticGeometry(h,d),i.push(!1),u?u.update():a.set(h,new xWe(h))):i.push(!0)}if(o.length===0){e.setIndex(null);const l=e.attributes;for(const c in l)e.deleteAttribute(c);for(const c in this.attributes)e.setAttribute(this.attributes[c],new ct(new Float32Array(0),4,!1))}else yWe(o,{useGroups:r,skipAttributes:i},e);for(const l in e.attributes)e.attributes[l].needsUpdate=!0;return e}_convertToStaticGeometry(e,i=new Rt){const s=e.geometry,r=this.applyWorldTransforms,o=this.attributes.includes("normal"),a=this.attributes.includes("tangent"),l=s.attributes,c=i.attributes;!i.index&&s.index&&(i.index=s.index.clone()),c.position||i.setAttribute("position",K_(l.position)),o&&!c.normal&&l.normal&&i.setAttribute("normal",K_(l.normal)),a&&!c.tangent&&l.tangent&&i.setAttribute("tangent",K_(l.tangent)),Q_(s.index,i.index),Q_(l.position,c.position),o&&Q_(l.normal,c.normal),a&&Q_(l.tangent,c.tangent);const h=l.position,d=o?l.normal:null,u=a?l.tangent:null,p=s.morphAttributes.position,g=s.morphAttributes.normal,f=s.morphAttributes.tangent,A=s.morphTargetsRelative,y=e.morphTargetInfluences,b=new oi;b.getNormalMatrix(e.matrixWorld),s.index&&i.index.array.set(s.index.array);for(let v=0,x=l.position.count;v<x;v++)LA.fromBufferAttribute(h,v),d&&BA.fromBufferAttribute(d,v),u&&(Ble.fromBufferAttribute(u,v),kA.fromBufferAttribute(u,v)),y&&(p&&LZ(p,y,A,v,LA),g&&LZ(g,y,A,v,BA),f&&LZ(f,y,A,v,kA)),e.isSkinnedMesh&&(e.applyBoneTransform(v,LA),d&&Vle(e,v,BA),u&&Vle(e,v,kA)),r&&LA.applyMatrix4(e.matrixWorld),c.position.setXYZ(v,LA.x,LA.y,LA.z),d&&(r&&BA.applyNormalMatrix(b),c.normal.setXYZ(v,BA.x,BA.y,BA.z)),u&&(r&&kA.transformDirection(e.matrixWorld),c.tangent.setXYZW(v,kA.x,kA.y,kA.z,Ble.w));for(const v in this.attributes){const x=this.attributes[v];x==="position"||x==="tangent"||x==="normal"||!(x in l)||(c[x]||i.setAttribute(x,K_(l[x])),Q_(l[x],c[x]),Nle(l[x],c[x]))}return e.matrixWorld.determinant()<0&&vWe(i),i}}const Xle=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,Dle=`

float dot2( vec3 v ) {

	return dot( v, v );

}

// https://www.shadertoy.com/view/ttfGWl
vec3 closestPointToTriangle( vec3 p, vec3 v0, vec3 v1, vec3 v2, out vec3 barycoord ) {

    vec3 v10 = v1 - v0;
    vec3 v21 = v2 - v1;
    vec3 v02 = v0 - v2;

	vec3 p0 = p - v0;
	vec3 p1 = p - v1;
	vec3 p2 = p - v2;

    vec3 nor = cross( v10, v02 );

    // method 2, in barycentric space
    vec3  q = cross( nor, p0 );
    float d = 1.0 / dot2( nor );
    float u = d * dot( q, v02 );
    float v = d * dot( q, v10 );
    float w = 1.0 - u - v;

	if( u < 0.0 ) {

		w = clamp( dot( p2, v02 ) / dot2( v02 ), 0.0, 1.0 );
		u = 0.0;
		v = 1.0 - w;

	} else if( v < 0.0 ) {

		u = clamp( dot( p0, v10 ) / dot2( v10 ), 0.0, 1.0 );
		v = 0.0;
		w = 1.0 - u;

	} else if( w < 0.0 ) {

		v = clamp( dot( p1, v21 ) / dot2( v21 ), 0.0, 1.0 );
		w = 0.0;
		u = 1.0-v;

	}

	barycoord = vec3( u, v, w );
    return u * v1 + v * v2 + w * v0;

}

float distanceToTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// point and cut off range
	vec3 point, float closestDistanceSquared,

	// outputs
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord, inout float side, inout vec3 outPoint
) {

	bool found = false;
	vec3 localBarycoord;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		// get the closest point and barycoord
		vec3 closestPoint = closestPointToTriangle( point, a, b, c, localBarycoord );
		vec3 delta = point - closestPoint;
		float sqDist = dot2( delta );
		if ( sqDist < closestDistanceSquared ) {

			// set the output results
			closestDistanceSquared = sqDist;
			faceIndices = uvec4( indices.xyz, i );
			faceNormal = normalize( cross( a - b, b - c ) );
			barycoord = localBarycoord;
			outPoint = closestPoint;
			side = sign( dot( faceNormal, delta ) );

		}

	}

	return closestDistanceSquared;

}

float distanceSqToBounds( vec3 point, vec3 boundsMin, vec3 boundsMax ) {

	vec3 clampedPoint = clamp( point, boundsMin, boundsMax );
	vec3 delta = point - clampedPoint;
	return dot( delta, delta );

}

float distanceSqToBVHNodeBoundsPoint( vec3 point, sampler2D bvhBounds, uint currNodeIndex ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return distanceSqToBounds( point, boundsMin, boundsMax );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhClosestPointToPoint(		bvh,		point, faceIndices, faceNormal, barycoord, side, outPoint	)	_bvhClosestPointToPoint(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		point, faceIndices, faceNormal, barycoord, side, outPoint	)

float _bvhClosestPointToPoint(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// point to check
	vec3 point,

	// output variables
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout vec3 outPoint
 ) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float closestDistanceSquared = pow( 100000.0, 2.0 );
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance = distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, currNodeIndex );
		if ( boundsHitDistance > closestDistanceSquared ) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );
		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;
			closestDistanceSquared = distanceToTriangles(
				bvh_position, bvh_index, offset, count, point, closestDistanceSquared,

				// outputs
				faceIndices, faceNormal, barycoord, side, outPoint
			);

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;
			bool leftToRight = distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, leftIndex ) < distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, rightIndex );//rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;
			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return sqrt( closestDistanceSquared );

}
`,zle=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhIntersectFirstHit(		bvh,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)	_bvhIntersectFirstHit(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,Fle=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,CWe=Object.freeze(Object.defineProperty({__proto__:null,bvh_distance_functions:Dle,bvh_ray_functions:zle,bvh_struct_definitions:Fle,common_functions:Xle},Symbol.toStringTag,{value:"Module"})),SWe=Fle,_We=Dle,MWe=`
	${Xle}
	${zle}
`,IWe=Object.freeze(Object.defineProperty({__proto__:null,AVERAGE:ele,BVHShaderGLSL:CWe,CENTER:rZ,CONTAINED:oZ,ExtendedTriangle:Jc,FloatVertexAttributeTexture:Lle,INTERSECTED:KOe,IntVertexAttributeTexture:pWe,MeshBVH:qg,MeshBVHHelper:HZ,MeshBVHUniformStruct:mWe,NOT_INTERSECTED:QOe,OrientedBox:ua,SAH:tle,StaticGeometryGenerator:wWe,UIntVertexAttributeTexture:Rle,VertexAttributeTexture:Ek,acceleratedRaycast:sWe,computeBatchedBoundsTree:cWe,computeBoundsTree:aWe,disposeBatchedBoundsTree:hWe,disposeBoundsTree:lWe,estimateMemoryInBytes:qZe,getBVHExtremes:JZe,getJSONStructure:eWe,getTriangleHitPointInfo:bZe,shaderDistanceFunction:_We,shaderIntersectFunction:MWe,shaderStructs:SWe,validateBounds:$Ze},Symbol.toStringTag,{value:"Module"}));class TWe{constructor(e){this.name="WorkerBase",this.running=!1,this.worker=e,this.worker.onerror=i=>{throw i.message?new Error(`${this.name}: Could not create Web Worker with error "${i.message}"`):new Error(`${this.name}: Could not create Web Worker.`)}}runTask(){}generate(...e){if(this.running)throw new Error("GenerateMeshBVHWorker: Already running job.");if(this.worker===null)throw new Error("GenerateMeshBVHWorker: Worker has been disposed.");this.running=!0;const i=this.runTask(this.worker,...e);return i.finally(()=>{this.running=!1}),i}dispose(){this.worker.terminate(),this.worker=null}}const Ule="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO3ZhciBBbj10eXBlb2YgZG9jdW1lbnQ8InUiP2RvY3VtZW50LmN1cnJlbnRTY3JpcHQ6bnVsbDsvKioKICogQGxpY2Vuc2UKICogQ29weXJpZ2h0IDIwMTAtMjAyNCBUaHJlZS5qcyBBdXRob3JzCiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKICovY29uc3QgWGU9IjE2OSIsVmk9MCxVaT0xLEVvPTIsTW49MCxraT0zMDAsQ289MzAxLEZvPTMwMixIaT0xZTMsX3M9MTAwMSxxaT0xMDAyLHpzPTEwMDMsJGk9MTAwNixHaT0xMDA4LFJvPTEwMDksQm89MTAxMyxXaT0xMDE0LElvPTEwMTUsdm89MTAxNixQbz0xMDIwLExvPTEwMjMsU249MTAyNixYaT0xMDI3LFlpPTAsT289MSxicz0iIiwkdD0ic3JnYiIsRXM9InNyZ2ItbGluZWFyIixEbz0iZGlzcGxheS1wMyIsWmk9ImRpc3BsYXktcDMtbGluZWFyIixfbj0ibGluZWFyIixKaT0ic3JnYiIsamk9InJlYzcwOSIsUWk9InAzIixDcz0zNTA0NCxZZT0yZTMsem49MjAwMTtjbGFzcyBaZXthZGRFdmVudExpc3RlbmVyKHQsZSl7dGhpcy5fbGlzdGVuZXJzPT09dm9pZCAwJiYodGhpcy5fbGlzdGVuZXJzPXt9KTtjb25zdCBzPXRoaXMuX2xpc3RlbmVycztzW3RdPT09dm9pZCAwJiYoc1t0XT1bXSksc1t0XS5pbmRleE9mKGUpPT09LTEmJnNbdF0ucHVzaChlKX1oYXNFdmVudExpc3RlbmVyKHQsZSl7aWYodGhpcy5fbGlzdGVuZXJzPT09dm9pZCAwKXJldHVybiExO2NvbnN0IHM9dGhpcy5fbGlzdGVuZXJzO3JldHVybiBzW3RdIT09dm9pZCAwJiZzW3RdLmluZGV4T2YoZSkhPT0tMX1yZW1vdmVFdmVudExpc3RlbmVyKHQsZSl7aWYodGhpcy5fbGlzdGVuZXJzPT09dm9pZCAwKXJldHVybjtjb25zdCBuPXRoaXMuX2xpc3RlbmVyc1t0XTtpZihuIT09dm9pZCAwKXtjb25zdCBpPW4uaW5kZXhPZihlKTtpIT09LTEmJm4uc3BsaWNlKGksMSl9fWRpc3BhdGNoRXZlbnQodCl7aWYodGhpcy5fbGlzdGVuZXJzPT09dm9pZCAwKXJldHVybjtjb25zdCBzPXRoaXMuX2xpc3RlbmVyc1t0LnR5cGVdO2lmKHMhPT12b2lkIDApe3QudGFyZ2V0PXRoaXM7Y29uc3Qgbj1zLnNsaWNlKDApO2ZvcihsZXQgaT0wLG89bi5sZW5ndGg7aTxvO2krKyluW2ldLmNhbGwodGhpcyx0KTt0LnRhcmdldD1udWxsfX19Y29uc3Qgb3Q9WyIwMCIsIjAxIiwiMDIiLCIwMyIsIjA0IiwiMDUiLCIwNiIsIjA3IiwiMDgiLCIwOSIsIjBhIiwiMGIiLCIwYyIsIjBkIiwiMGUiLCIwZiIsIjEwIiwiMTEiLCIxMiIsIjEzIiwiMTQiLCIxNSIsIjE2IiwiMTciLCIxOCIsIjE5IiwiMWEiLCIxYiIsIjFjIiwiMWQiLCIxZSIsIjFmIiwiMjAiLCIyMSIsIjIyIiwiMjMiLCIyNCIsIjI1IiwiMjYiLCIyNyIsIjI4IiwiMjkiLCIyYSIsIjJiIiwiMmMiLCIyZCIsIjJlIiwiMmYiLCIzMCIsIjMxIiwiMzIiLCIzMyIsIjM0IiwiMzUiLCIzNiIsIjM3IiwiMzgiLCIzOSIsIjNhIiwiM2IiLCIzYyIsIjNkIiwiM2UiLCIzZiIsIjQwIiwiNDEiLCI0MiIsIjQzIiwiNDQiLCI0NSIsIjQ2IiwiNDciLCI0OCIsIjQ5IiwiNGEiLCI0YiIsIjRjIiwiNGQiLCI0ZSIsIjRmIiwiNTAiLCI1MSIsIjUyIiwiNTMiLCI1NCIsIjU1IiwiNTYiLCI1NyIsIjU4IiwiNTkiLCI1YSIsIjViIiwiNWMiLCI1ZCIsIjVlIiwiNWYiLCI2MCIsIjYxIiwiNjIiLCI2MyIsIjY0IiwiNjUiLCI2NiIsIjY3IiwiNjgiLCI2OSIsIjZhIiwiNmIiLCI2YyIsIjZkIiwiNmUiLCI2ZiIsIjcwIiwiNzEiLCI3MiIsIjczIiwiNzQiLCI3NSIsIjc2IiwiNzciLCI3OCIsIjc5IiwiN2EiLCI3YiIsIjdjIiwiN2QiLCI3ZSIsIjdmIiwiODAiLCI4MSIsIjgyIiwiODMiLCI4NCIsIjg1IiwiODYiLCI4NyIsIjg4IiwiODkiLCI4YSIsIjhiIiwiOGMiLCI4ZCIsIjhlIiwiOGYiLCI5MCIsIjkxIiwiOTIiLCI5MyIsIjk0IiwiOTUiLCI5NiIsIjk3IiwiOTgiLCI5OSIsIjlhIiwiOWIiLCI5YyIsIjlkIiwiOWUiLCI5ZiIsImEwIiwiYTEiLCJhMiIsImEzIiwiYTQiLCJhNSIsImE2IiwiYTciLCJhOCIsImE5IiwiYWEiLCJhYiIsImFjIiwiYWQiLCJhZSIsImFmIiwiYjAiLCJiMSIsImIyIiwiYjMiLCJiNCIsImI1IiwiYjYiLCJiNyIsImI4IiwiYjkiLCJiYSIsImJiIiwiYmMiLCJiZCIsImJlIiwiYmYiLCJjMCIsImMxIiwiYzIiLCJjMyIsImM0IiwiYzUiLCJjNiIsImM3IiwiYzgiLCJjOSIsImNhIiwiY2IiLCJjYyIsImNkIiwiY2UiLCJjZiIsImQwIiwiZDEiLCJkMiIsImQzIiwiZDQiLCJkNSIsImQ2IiwiZDciLCJkOCIsImQ5IiwiZGEiLCJkYiIsImRjIiwiZGQiLCJkZSIsImRmIiwiZTAiLCJlMSIsImUyIiwiZTMiLCJlNCIsImU1IiwiZTYiLCJlNyIsImU4IiwiZTkiLCJlYSIsImViIiwiZWMiLCJlZCIsImVlIiwiZWYiLCJmMCIsImYxIiwiZjIiLCJmMyIsImY0IiwiZjUiLCJmNiIsImY3IiwiZjgiLCJmOSIsImZhIiwiZmIiLCJmYyIsImZkIiwiZmUiLCJmZiJdO2xldCBLaT0xMjM0NTY3O2NvbnN0IHRyPU1hdGguUEkvMTgwLGVyPTE4MC9NYXRoLlBJO2Z1bmN0aW9uIEt0KCl7Y29uc3Qgcj1NYXRoLnJhbmRvbSgpKjQyOTQ5NjcyOTV8MCx0PU1hdGgucmFuZG9tKCkqNDI5NDk2NzI5NXwwLGU9TWF0aC5yYW5kb20oKSo0Mjk0OTY3Mjk1fDAscz1NYXRoLnJhbmRvbSgpKjQyOTQ5NjcyOTV8MDtyZXR1cm4ob3RbciYyNTVdK290W3I+PjgmMjU1XStvdFtyPj4xNiYyNTVdK290W3I+PjI0JjI1NV0rIi0iK290W3QmMjU1XStvdFt0Pj44JjI1NV0rIi0iK290W3Q+PjE2JjE1fDY0XStvdFt0Pj4yNCYyNTVdKyItIitvdFtlJjYzfDEyOF0rb3RbZT4+OCYyNTVdKyItIitvdFtlPj4xNiYyNTVdK290W2U+PjI0JjI1NV0rb3RbcyYyNTVdK290W3M+PjgmMjU1XStvdFtzPj4xNiYyNTVdK290W3M+PjI0JjI1NV0pLnRvTG93ZXJDYXNlKCl9ZnVuY3Rpb24gYXQocix0LGUpe3JldHVybiBNYXRoLm1heCh0LE1hdGgubWluKGUscikpfWZ1bmN0aW9uIGJuKHIsdCl7cmV0dXJuKHIldCt0KSV0fWZ1bmN0aW9uIFZvKHIsdCxlLHMsbil7cmV0dXJuIHMrKHItdCkqKG4tcykvKGUtdCl9ZnVuY3Rpb24gVW8ocix0LGUpe3JldHVybiByIT09dD8oZS1yKS8odC1yKTowfWZ1bmN0aW9uIEplKHIsdCxlKXtyZXR1cm4oMS1lKSpyK2UqdH1mdW5jdGlvbiBrbyhyLHQsZSxzKXtyZXR1cm4gSmUocix0LDEtTWF0aC5leHAoLWUqcykpfWZ1bmN0aW9uIEhvKHIsdD0xKXtyZXR1cm4gdC1NYXRoLmFicyhibihyLHQqMiktdCl9ZnVuY3Rpb24gcW8ocix0LGUpe3JldHVybiByPD10PzA6cj49ZT8xOihyPShyLXQpLyhlLXQpLHIqciooMy0yKnIpKX1mdW5jdGlvbiAkbyhyLHQsZSl7cmV0dXJuIHI8PXQ/MDpyPj1lPzE6KHI9KHItdCkvKGUtdCkscipyKnIqKHIqKHIqNi0xNSkrMTApKX1mdW5jdGlvbiBHbyhyLHQpe3JldHVybiByK01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoodC1yKzEpKX1mdW5jdGlvbiBXbyhyLHQpe3JldHVybiByK01hdGgucmFuZG9tKCkqKHQtcil9ZnVuY3Rpb24gWG8ocil7cmV0dXJuIHIqKC41LU1hdGgucmFuZG9tKCkpfWZ1bmN0aW9uIFlvKHIpe3IhPT12b2lkIDAmJihLaT1yKTtsZXQgdD1LaSs9MTgzMTU2NTgxMztyZXR1cm4gdD1NYXRoLmltdWwodF50Pj4+MTUsdHwxKSx0Xj10K01hdGguaW11bCh0XnQ+Pj43LHR8NjEpLCgodF50Pj4+MTQpPj4+MCkvNDI5NDk2NzI5Nn1mdW5jdGlvbiBabyhyKXtyZXR1cm4gcip0cn1mdW5jdGlvbiBKbyhyKXtyZXR1cm4gciplcn1mdW5jdGlvbiBqbyhyKXtyZXR1cm4ociZyLTEpPT09MCYmciE9PTB9ZnVuY3Rpb24gUW8ocil7cmV0dXJuIE1hdGgucG93KDIsTWF0aC5jZWlsKE1hdGgubG9nKHIpL01hdGguTE4yKSl9ZnVuY3Rpb24gS28ocil7cmV0dXJuIE1hdGgucG93KDIsTWF0aC5mbG9vcihNYXRoLmxvZyhyKS9NYXRoLkxOMikpfWZ1bmN0aW9uIHRhKHIsdCxlLHMsbil7Y29uc3QgaT1NYXRoLmNvcyxvPU1hdGguc2luLGE9aShlLzIpLGM9byhlLzIpLHU9aSgodCtzKS8yKSxoPW8oKHQrcykvMiksbD1pKCh0LXMpLzIpLGQ9bygodC1zKS8yKSxmPWkoKHMtdCkvMikscD1vKChzLXQpLzIpO3N3aXRjaChuKXtjYXNlIlhZWCI6ci5zZXQoYSpoLGMqbCxjKmQsYSp1KTticmVhaztjYXNlIllaWSI6ci5zZXQoYypkLGEqaCxjKmwsYSp1KTticmVhaztjYXNlIlpYWiI6ci5zZXQoYypsLGMqZCxhKmgsYSp1KTticmVhaztjYXNlIlhaWCI6ci5zZXQoYSpoLGMqcCxjKmYsYSp1KTticmVhaztjYXNlIllYWSI6ci5zZXQoYypmLGEqaCxjKnAsYSp1KTticmVhaztjYXNlIlpZWiI6ci5zZXQoYypwLGMqZixhKmgsYSp1KTticmVhaztkZWZhdWx0OmNvbnNvbGUud2FybigiVEhSRUUuTWF0aFV0aWxzOiAuc2V0UXVhdGVybmlvbkZyb21Qcm9wZXJFdWxlcigpIGVuY291bnRlcmVkIGFuIHVua25vd24gb3JkZXI6ICIrbil9fWZ1bmN0aW9uIEV0KHIsdCl7c3dpdGNoKHQuY29uc3RydWN0b3Ipe2Nhc2UgRmxvYXQzMkFycmF5OnJldHVybiByO2Nhc2UgVWludDMyQXJyYXk6cmV0dXJuIHIvNDI5NDk2NzI5NTtjYXNlIFVpbnQxNkFycmF5OnJldHVybiByLzY1NTM1O2Nhc2UgVWludDhBcnJheTpyZXR1cm4gci8yNTU7Y2FzZSBJbnQzMkFycmF5OnJldHVybiBNYXRoLm1heChyLzIxNDc0ODM2NDcsLTEpO2Nhc2UgSW50MTZBcnJheTpyZXR1cm4gTWF0aC5tYXgoci8zMjc2NywtMSk7Y2FzZSBJbnQ4QXJyYXk6cmV0dXJuIE1hdGgubWF4KHIvMTI3LC0xKTtkZWZhdWx0OnRocm93IG5ldyBFcnJvcigiSW52YWxpZCBjb21wb25lbnQgdHlwZS4iKX19ZnVuY3Rpb24gJChyLHQpe3N3aXRjaCh0LmNvbnN0cnVjdG9yKXtjYXNlIEZsb2F0MzJBcnJheTpyZXR1cm4gcjtjYXNlIFVpbnQzMkFycmF5OnJldHVybiBNYXRoLnJvdW5kKHIqNDI5NDk2NzI5NSk7Y2FzZSBVaW50MTZBcnJheTpyZXR1cm4gTWF0aC5yb3VuZChyKjY1NTM1KTtjYXNlIFVpbnQ4QXJyYXk6cmV0dXJuIE1hdGgucm91bmQocioyNTUpO2Nhc2UgSW50MzJBcnJheTpyZXR1cm4gTWF0aC5yb3VuZChyKjIxNDc0ODM2NDcpO2Nhc2UgSW50MTZBcnJheTpyZXR1cm4gTWF0aC5yb3VuZChyKjMyNzY3KTtjYXNlIEludDhBcnJheTpyZXR1cm4gTWF0aC5yb3VuZChyKjEyNyk7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgY29tcG9uZW50IHR5cGUuIil9fWNvbnN0IGVhPXtERUcyUkFEOnRyLFJBRDJERUc6ZXIsZ2VuZXJhdGVVVUlEOkt0LGNsYW1wOmF0LGV1Y2xpZGVhbk1vZHVsbzpibixtYXBMaW5lYXI6Vm8saW52ZXJzZUxlcnA6VW8sbGVycDpKZSxkYW1wOmtvLHBpbmdwb25nOkhvLHNtb290aHN0ZXA6cW8sc21vb3RoZXJzdGVwOiRvLHJhbmRJbnQ6R28scmFuZEZsb2F0OldvLHJhbmRGbG9hdFNwcmVhZDpYbyxzZWVkZWRSYW5kb206WW8sZGVnVG9SYWQ6Wm8scmFkVG9EZWc6Sm8saXNQb3dlck9mVHdvOmpvLGNlaWxQb3dlck9mVHdvOlFvLGZsb29yUG93ZXJPZlR3bzpLbyxzZXRRdWF0ZXJuaW9uRnJvbVByb3BlckV1bGVyOnRhLG5vcm1hbGl6ZTokLGRlbm9ybWFsaXplOkV0fTtjbGFzcyBKe2NvbnN0cnVjdG9yKHQ9MCxlPTApe0oucHJvdG90eXBlLmlzVmVjdG9yMj0hMCx0aGlzLng9dCx0aGlzLnk9ZX1nZXQgd2lkdGgoKXtyZXR1cm4gdGhpcy54fXNldCB3aWR0aCh0KXt0aGlzLng9dH1nZXQgaGVpZ2h0KCl7cmV0dXJuIHRoaXMueX1zZXQgaGVpZ2h0KHQpe3RoaXMueT10fXNldCh0LGUpe3JldHVybiB0aGlzLng9dCx0aGlzLnk9ZSx0aGlzfXNldFNjYWxhcih0KXtyZXR1cm4gdGhpcy54PXQsdGhpcy55PXQsdGhpc31zZXRYKHQpe3JldHVybiB0aGlzLng9dCx0aGlzfXNldFkodCl7cmV0dXJuIHRoaXMueT10LHRoaXN9c2V0Q29tcG9uZW50KHQsZSl7c3dpdGNoKHQpe2Nhc2UgMDp0aGlzLng9ZTticmVhaztjYXNlIDE6dGhpcy55PWU7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoImluZGV4IGlzIG91dCBvZiByYW5nZTogIit0KX1yZXR1cm4gdGhpc31nZXRDb21wb25lbnQodCl7c3dpdGNoKHQpe2Nhc2UgMDpyZXR1cm4gdGhpcy54O2Nhc2UgMTpyZXR1cm4gdGhpcy55O2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICIrdCl9fWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMueCx0aGlzLnkpfWNvcHkodCl7cmV0dXJuIHRoaXMueD10LngsdGhpcy55PXQueSx0aGlzfWFkZCh0KXtyZXR1cm4gdGhpcy54Kz10LngsdGhpcy55Kz10LnksdGhpc31hZGRTY2FsYXIodCl7cmV0dXJuIHRoaXMueCs9dCx0aGlzLnkrPXQsdGhpc31hZGRWZWN0b3JzKHQsZSl7cmV0dXJuIHRoaXMueD10LngrZS54LHRoaXMueT10LnkrZS55LHRoaXN9YWRkU2NhbGVkVmVjdG9yKHQsZSl7cmV0dXJuIHRoaXMueCs9dC54KmUsdGhpcy55Kz10LnkqZSx0aGlzfXN1Yih0KXtyZXR1cm4gdGhpcy54LT10LngsdGhpcy55LT10LnksdGhpc31zdWJTY2FsYXIodCl7cmV0dXJuIHRoaXMueC09dCx0aGlzLnktPXQsdGhpc31zdWJWZWN0b3JzKHQsZSl7cmV0dXJuIHRoaXMueD10LngtZS54LHRoaXMueT10LnktZS55LHRoaXN9bXVsdGlwbHkodCl7cmV0dXJuIHRoaXMueCo9dC54LHRoaXMueSo9dC55LHRoaXN9bXVsdGlwbHlTY2FsYXIodCl7cmV0dXJuIHRoaXMueCo9dCx0aGlzLnkqPXQsdGhpc31kaXZpZGUodCl7cmV0dXJuIHRoaXMueC89dC54LHRoaXMueS89dC55LHRoaXN9ZGl2aWRlU2NhbGFyKHQpe3JldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKDEvdCl9YXBwbHlNYXRyaXgzKHQpe2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LG49dC5lbGVtZW50cztyZXR1cm4gdGhpcy54PW5bMF0qZStuWzNdKnMrbls2XSx0aGlzLnk9blsxXSplK25bNF0qcytuWzddLHRoaXN9bWluKHQpe3JldHVybiB0aGlzLng9TWF0aC5taW4odGhpcy54LHQueCksdGhpcy55PU1hdGgubWluKHRoaXMueSx0LnkpLHRoaXN9bWF4KHQpe3JldHVybiB0aGlzLng9TWF0aC5tYXgodGhpcy54LHQueCksdGhpcy55PU1hdGgubWF4KHRoaXMueSx0LnkpLHRoaXN9Y2xhbXAodCxlKXtyZXR1cm4gdGhpcy54PU1hdGgubWF4KHQueCxNYXRoLm1pbihlLngsdGhpcy54KSksdGhpcy55PU1hdGgubWF4KHQueSxNYXRoLm1pbihlLnksdGhpcy55KSksdGhpc31jbGFtcFNjYWxhcih0LGUpe3JldHVybiB0aGlzLng9TWF0aC5tYXgodCxNYXRoLm1pbihlLHRoaXMueCkpLHRoaXMueT1NYXRoLm1heCh0LE1hdGgubWluKGUsdGhpcy55KSksdGhpc31jbGFtcExlbmd0aCh0LGUpe2NvbnN0IHM9dGhpcy5sZW5ndGgoKTtyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIoc3x8MSkubXVsdGlwbHlTY2FsYXIoTWF0aC5tYXgodCxNYXRoLm1pbihlLHMpKSl9Zmxvb3IoKXtyZXR1cm4gdGhpcy54PU1hdGguZmxvb3IodGhpcy54KSx0aGlzLnk9TWF0aC5mbG9vcih0aGlzLnkpLHRoaXN9Y2VpbCgpe3JldHVybiB0aGlzLng9TWF0aC5jZWlsKHRoaXMueCksdGhpcy55PU1hdGguY2VpbCh0aGlzLnkpLHRoaXN9cm91bmQoKXtyZXR1cm4gdGhpcy54PU1hdGgucm91bmQodGhpcy54KSx0aGlzLnk9TWF0aC5yb3VuZCh0aGlzLnkpLHRoaXN9cm91bmRUb1plcm8oKXtyZXR1cm4gdGhpcy54PU1hdGgudHJ1bmModGhpcy54KSx0aGlzLnk9TWF0aC50cnVuYyh0aGlzLnkpLHRoaXN9bmVnYXRlKCl7cmV0dXJuIHRoaXMueD0tdGhpcy54LHRoaXMueT0tdGhpcy55LHRoaXN9ZG90KHQpe3JldHVybiB0aGlzLngqdC54K3RoaXMueSp0Lnl9Y3Jvc3ModCl7cmV0dXJuIHRoaXMueCp0LnktdGhpcy55KnQueH1sZW5ndGhTcSgpe3JldHVybiB0aGlzLngqdGhpcy54K3RoaXMueSp0aGlzLnl9bGVuZ3RoKCl7cmV0dXJuIE1hdGguc3FydCh0aGlzLngqdGhpcy54K3RoaXMueSp0aGlzLnkpfW1hbmhhdHRhbkxlbmd0aCgpe3JldHVybiBNYXRoLmFicyh0aGlzLngpK01hdGguYWJzKHRoaXMueSl9bm9ybWFsaXplKCl7cmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKHRoaXMubGVuZ3RoKCl8fDEpfWFuZ2xlKCl7cmV0dXJuIE1hdGguYXRhbjIoLXRoaXMueSwtdGhpcy54KStNYXRoLlBJfWFuZ2xlVG8odCl7Y29uc3QgZT1NYXRoLnNxcnQodGhpcy5sZW5ndGhTcSgpKnQubGVuZ3RoU3EoKSk7aWYoZT09PTApcmV0dXJuIE1hdGguUEkvMjtjb25zdCBzPXRoaXMuZG90KHQpL2U7cmV0dXJuIE1hdGguYWNvcyhhdChzLC0xLDEpKX1kaXN0YW5jZVRvKHQpe3JldHVybiBNYXRoLnNxcnQodGhpcy5kaXN0YW5jZVRvU3F1YXJlZCh0KSl9ZGlzdGFuY2VUb1NxdWFyZWQodCl7Y29uc3QgZT10aGlzLngtdC54LHM9dGhpcy55LXQueTtyZXR1cm4gZSplK3Mqc31tYW5oYXR0YW5EaXN0YW5jZVRvKHQpe3JldHVybiBNYXRoLmFicyh0aGlzLngtdC54KStNYXRoLmFicyh0aGlzLnktdC55KX1zZXRMZW5ndGgodCl7cmV0dXJuIHRoaXMubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIodCl9bGVycCh0LGUpe3JldHVybiB0aGlzLngrPSh0LngtdGhpcy54KSplLHRoaXMueSs9KHQueS10aGlzLnkpKmUsdGhpc31sZXJwVmVjdG9ycyh0LGUscyl7cmV0dXJuIHRoaXMueD10LngrKGUueC10LngpKnMsdGhpcy55PXQueSsoZS55LXQueSkqcyx0aGlzfWVxdWFscyh0KXtyZXR1cm4gdC54PT09dGhpcy54JiZ0Lnk9PT10aGlzLnl9ZnJvbUFycmF5KHQsZT0wKXtyZXR1cm4gdGhpcy54PXRbZV0sdGhpcy55PXRbZSsxXSx0aGlzfXRvQXJyYXkodD1bXSxlPTApe3JldHVybiB0W2VdPXRoaXMueCx0W2UrMV09dGhpcy55LHR9ZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LGUpe3JldHVybiB0aGlzLng9dC5nZXRYKGUpLHRoaXMueT10LmdldFkoZSksdGhpc31yb3RhdGVBcm91bmQodCxlKXtjb25zdCBzPU1hdGguY29zKGUpLG49TWF0aC5zaW4oZSksaT10aGlzLngtdC54LG89dGhpcy55LXQueTtyZXR1cm4gdGhpcy54PWkqcy1vKm4rdC54LHRoaXMueT1pKm4rbypzK3QueSx0aGlzfXJhbmRvbSgpe3JldHVybiB0aGlzLng9TWF0aC5yYW5kb20oKSx0aGlzLnk9TWF0aC5yYW5kb20oKSx0aGlzfSpbU3ltYm9sLml0ZXJhdG9yXSgpe3lpZWxkIHRoaXMueCx5aWVsZCB0aGlzLnl9fWNsYXNzIEN0e2NvbnN0cnVjdG9yKHQsZSxzLG4saSxvLGEsYyx1KXtDdC5wcm90b3R5cGUuaXNNYXRyaXgzPSEwLHRoaXMuZWxlbWVudHM9WzEsMCwwLDAsMSwwLDAsMCwxXSx0IT09dm9pZCAwJiZ0aGlzLnNldCh0LGUscyxuLGksbyxhLGMsdSl9c2V0KHQsZSxzLG4saSxvLGEsYyx1KXtjb25zdCBoPXRoaXMuZWxlbWVudHM7cmV0dXJuIGhbMF09dCxoWzFdPW4saFsyXT1hLGhbM109ZSxoWzRdPWksaFs1XT1jLGhbNl09cyxoWzddPW8saFs4XT11LHRoaXN9aWRlbnRpdHkoKXtyZXR1cm4gdGhpcy5zZXQoMSwwLDAsMCwxLDAsMCwwLDEpLHRoaXN9Y29weSh0KXtjb25zdCBlPXRoaXMuZWxlbWVudHMscz10LmVsZW1lbnRzO3JldHVybiBlWzBdPXNbMF0sZVsxXT1zWzFdLGVbMl09c1syXSxlWzNdPXNbM10sZVs0XT1zWzRdLGVbNV09c1s1XSxlWzZdPXNbNl0sZVs3XT1zWzddLGVbOF09c1s4XSx0aGlzfWV4dHJhY3RCYXNpcyh0LGUscyl7cmV0dXJuIHQuc2V0RnJvbU1hdHJpeDNDb2x1bW4odGhpcywwKSxlLnNldEZyb21NYXRyaXgzQ29sdW1uKHRoaXMsMSkscy5zZXRGcm9tTWF0cml4M0NvbHVtbih0aGlzLDIpLHRoaXN9c2V0RnJvbU1hdHJpeDQodCl7Y29uc3QgZT10LmVsZW1lbnRzO3JldHVybiB0aGlzLnNldChlWzBdLGVbNF0sZVs4XSxlWzFdLGVbNV0sZVs5XSxlWzJdLGVbNl0sZVsxMF0pLHRoaXN9bXVsdGlwbHkodCl7cmV0dXJuIHRoaXMubXVsdGlwbHlNYXRyaWNlcyh0aGlzLHQpfXByZW11bHRpcGx5KHQpe3JldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXModCx0aGlzKX1tdWx0aXBseU1hdHJpY2VzKHQsZSl7Y29uc3Qgcz10LmVsZW1lbnRzLG49ZS5lbGVtZW50cyxpPXRoaXMuZWxlbWVudHMsbz1zWzBdLGE9c1szXSxjPXNbNl0sdT1zWzFdLGg9c1s0XSxsPXNbN10sZD1zWzJdLGY9c1s1XSxwPXNbOF0sbT1uWzBdLGc9blszXSx5PW5bNl0sVD1uWzFdLHc9bls0XSxNPW5bN10sTj1uWzJdLF89bls1XSxTPW5bOF07cmV0dXJuIGlbMF09byptK2EqVCtjKk4saVszXT1vKmcrYSp3K2MqXyxpWzZdPW8qeSthKk0rYypTLGlbMV09dSptK2gqVCtsKk4saVs0XT11KmcraCp3K2wqXyxpWzddPXUqeStoKk0rbCpTLGlbMl09ZCptK2YqVCtwKk4saVs1XT1kKmcrZip3K3AqXyxpWzhdPWQqeStmKk0rcCpTLHRoaXN9bXVsdGlwbHlTY2FsYXIodCl7Y29uc3QgZT10aGlzLmVsZW1lbnRzO3JldHVybiBlWzBdKj10LGVbM10qPXQsZVs2XSo9dCxlWzFdKj10LGVbNF0qPXQsZVs3XSo9dCxlWzJdKj10LGVbNV0qPXQsZVs4XSo9dCx0aGlzfWRldGVybWluYW50KCl7Y29uc3QgdD10aGlzLmVsZW1lbnRzLGU9dFswXSxzPXRbMV0sbj10WzJdLGk9dFszXSxvPXRbNF0sYT10WzVdLGM9dFs2XSx1PXRbN10saD10WzhdO3JldHVybiBlKm8qaC1lKmEqdS1zKmkqaCtzKmEqYytuKmkqdS1uKm8qY31pbnZlcnQoKXtjb25zdCB0PXRoaXMuZWxlbWVudHMsZT10WzBdLHM9dFsxXSxuPXRbMl0saT10WzNdLG89dFs0XSxhPXRbNV0sYz10WzZdLHU9dFs3XSxoPXRbOF0sbD1oKm8tYSp1LGQ9YSpjLWgqaSxmPXUqaS1vKmMscD1lKmwrcypkK24qZjtpZihwPT09MClyZXR1cm4gdGhpcy5zZXQoMCwwLDAsMCwwLDAsMCwwLDApO2NvbnN0IG09MS9wO3JldHVybiB0WzBdPWwqbSx0WzFdPShuKnUtaCpzKSptLHRbMl09KGEqcy1uKm8pKm0sdFszXT1kKm0sdFs0XT0oaCplLW4qYykqbSx0WzVdPShuKmktYSplKSptLHRbNl09ZiptLHRbN109KHMqYy11KmUpKm0sdFs4XT0obyplLXMqaSkqbSx0aGlzfXRyYW5zcG9zZSgpe2xldCB0O2NvbnN0IGU9dGhpcy5lbGVtZW50cztyZXR1cm4gdD1lWzFdLGVbMV09ZVszXSxlWzNdPXQsdD1lWzJdLGVbMl09ZVs2XSxlWzZdPXQsdD1lWzVdLGVbNV09ZVs3XSxlWzddPXQsdGhpc31nZXROb3JtYWxNYXRyaXgodCl7cmV0dXJuIHRoaXMuc2V0RnJvbU1hdHJpeDQodCkuaW52ZXJ0KCkudHJhbnNwb3NlKCl9dHJhbnNwb3NlSW50b0FycmF5KHQpe2NvbnN0IGU9dGhpcy5lbGVtZW50cztyZXR1cm4gdFswXT1lWzBdLHRbMV09ZVszXSx0WzJdPWVbNl0sdFszXT1lWzFdLHRbNF09ZVs0XSx0WzVdPWVbN10sdFs2XT1lWzJdLHRbN109ZVs1XSx0WzhdPWVbOF0sdGhpc31zZXRVdlRyYW5zZm9ybSh0LGUscyxuLGksbyxhKXtjb25zdCBjPU1hdGguY29zKGkpLHU9TWF0aC5zaW4oaSk7cmV0dXJuIHRoaXMuc2V0KHMqYyxzKnUsLXMqKGMqbyt1KmEpK28rdCwtbip1LG4qYywtbiooLXUqbytjKmEpK2ErZSwwLDAsMSksdGhpc31zY2FsZSh0LGUpe3JldHVybiB0aGlzLnByZW11bHRpcGx5KEVuLm1ha2VTY2FsZSh0LGUpKSx0aGlzfXJvdGF0ZSh0KXtyZXR1cm4gdGhpcy5wcmVtdWx0aXBseShFbi5tYWtlUm90YXRpb24oLXQpKSx0aGlzfXRyYW5zbGF0ZSh0LGUpe3JldHVybiB0aGlzLnByZW11bHRpcGx5KEVuLm1ha2VUcmFuc2xhdGlvbih0LGUpKSx0aGlzfW1ha2VUcmFuc2xhdGlvbih0LGUpe3JldHVybiB0LmlzVmVjdG9yMj90aGlzLnNldCgxLDAsdC54LDAsMSx0LnksMCwwLDEpOnRoaXMuc2V0KDEsMCx0LDAsMSxlLDAsMCwxKSx0aGlzfW1ha2VSb3RhdGlvbih0KXtjb25zdCBlPU1hdGguY29zKHQpLHM9TWF0aC5zaW4odCk7cmV0dXJuIHRoaXMuc2V0KGUsLXMsMCxzLGUsMCwwLDAsMSksdGhpc31tYWtlU2NhbGUodCxlKXtyZXR1cm4gdGhpcy5zZXQodCwwLDAsMCxlLDAsMCwwLDEpLHRoaXN9ZXF1YWxzKHQpe2NvbnN0IGU9dGhpcy5lbGVtZW50cyxzPXQuZWxlbWVudHM7Zm9yKGxldCBuPTA7bjw5O24rKylpZihlW25dIT09c1tuXSlyZXR1cm4hMTtyZXR1cm4hMH1mcm9tQXJyYXkodCxlPTApe2ZvcihsZXQgcz0wO3M8OTtzKyspdGhpcy5lbGVtZW50c1tzXT10W3MrZV07cmV0dXJuIHRoaXN9dG9BcnJheSh0PVtdLGU9MCl7Y29uc3Qgcz10aGlzLmVsZW1lbnRzO3JldHVybiB0W2VdPXNbMF0sdFtlKzFdPXNbMV0sdFtlKzJdPXNbMl0sdFtlKzNdPXNbM10sdFtlKzRdPXNbNF0sdFtlKzVdPXNbNV0sdFtlKzZdPXNbNl0sdFtlKzddPXNbN10sdFtlKzhdPXNbOF0sdH1jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmZyb21BcnJheSh0aGlzLmVsZW1lbnRzKX19Y29uc3QgRW49bmV3IEN0O2Z1bmN0aW9uIHNhKHIpe2ZvcihsZXQgdD1yLmxlbmd0aC0xO3Q+PTA7LS10KWlmKHJbdF0+PTY1NTM1KXJldHVybiEwO3JldHVybiExfWZ1bmN0aW9uIHNyKHIpe3JldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiLHIpfWNvbnN0IG5yPW5ldyBDdCgpLnNldCguODIyNDYyMSwuMTc3NTM4LDAsLjAzMzE5NDEsLjk2NjgwNTgsMCwuMDE3MDgyNywuMDcyMzk3NCwuOTEwNTE5OSksaXI9bmV3IEN0KCkuc2V0KDEuMjI0OTQwMSwtLjIyNDk0MDQsMCwtLjA0MjA1NjksMS4wNDIwNTcxLDAsLS4wMTk2Mzc2LC0uMDc4NjM2MSwxLjA5ODI3MzUpLGplPXtbRXNdOnt0cmFuc2ZlcjpfbixwcmltYXJpZXM6amksbHVtaW5hbmNlQ29lZmZpY2llbnRzOlsuMjEyNiwuNzE1MiwuMDcyMl0sdG9SZWZlcmVuY2U6cj0+cixmcm9tUmVmZXJlbmNlOnI9PnJ9LFskdF06e3RyYW5zZmVyOkppLHByaW1hcmllczpqaSxsdW1pbmFuY2VDb2VmZmljaWVudHM6Wy4yMTI2LC43MTUyLC4wNzIyXSx0b1JlZmVyZW5jZTpyPT5yLmNvbnZlcnRTUkdCVG9MaW5lYXIoKSxmcm9tUmVmZXJlbmNlOnI9PnIuY29udmVydExpbmVhclRvU1JHQigpfSxbWmldOnt0cmFuc2ZlcjpfbixwcmltYXJpZXM6UWksbHVtaW5hbmNlQ29lZmZpY2llbnRzOlsuMjI4OSwuNjkxNywuMDc5M10sdG9SZWZlcmVuY2U6cj0+ci5hcHBseU1hdHJpeDMoaXIpLGZyb21SZWZlcmVuY2U6cj0+ci5hcHBseU1hdHJpeDMobnIpfSxbRG9dOnt0cmFuc2ZlcjpKaSxwcmltYXJpZXM6UWksbHVtaW5hbmNlQ29lZmZpY2llbnRzOlsuMjI4OSwuNjkxNywuMDc5M10sdG9SZWZlcmVuY2U6cj0+ci5jb252ZXJ0U1JHQlRvTGluZWFyKCkuYXBwbHlNYXRyaXgzKGlyKSxmcm9tUmVmZXJlbmNlOnI9PnIuYXBwbHlNYXRyaXgzKG5yKS5jb252ZXJ0TGluZWFyVG9TUkdCKCl9fSxuYT1uZXcgU2V0KFtFcyxaaV0pLG10PXtlbmFibGVkOiEwLF93b3JraW5nQ29sb3JTcGFjZTpFcyxnZXQgd29ya2luZ0NvbG9yU3BhY2UoKXtyZXR1cm4gdGhpcy5fd29ya2luZ0NvbG9yU3BhY2V9LHNldCB3b3JraW5nQ29sb3JTcGFjZShyKXtpZighbmEuaGFzKHIpKXRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgd29ya2luZyBjb2xvciBzcGFjZSwgIiR7cn0iLmApO3RoaXMuX3dvcmtpbmdDb2xvclNwYWNlPXJ9LGNvbnZlcnQ6ZnVuY3Rpb24ocix0LGUpe2lmKHRoaXMuZW5hYmxlZD09PSExfHx0PT09ZXx8IXR8fCFlKXJldHVybiByO2NvbnN0IHM9amVbdF0udG9SZWZlcmVuY2Usbj1qZVtlXS5mcm9tUmVmZXJlbmNlO3JldHVybiBuKHMocikpfSxmcm9tV29ya2luZ0NvbG9yU3BhY2U6ZnVuY3Rpb24ocix0KXtyZXR1cm4gdGhpcy5jb252ZXJ0KHIsdGhpcy5fd29ya2luZ0NvbG9yU3BhY2UsdCl9LHRvV29ya2luZ0NvbG9yU3BhY2U6ZnVuY3Rpb24ocix0KXtyZXR1cm4gdGhpcy5jb252ZXJ0KHIsdCx0aGlzLl93b3JraW5nQ29sb3JTcGFjZSl9LGdldFByaW1hcmllczpmdW5jdGlvbihyKXtyZXR1cm4gamVbcl0ucHJpbWFyaWVzfSxnZXRUcmFuc2ZlcjpmdW5jdGlvbihyKXtyZXR1cm4gcj09PWJzP19uOmplW3JdLnRyYW5zZmVyfSxnZXRMdW1pbmFuY2VDb2VmZmljaWVudHM6ZnVuY3Rpb24ocix0PXRoaXMuX3dvcmtpbmdDb2xvclNwYWNlKXtyZXR1cm4gci5mcm9tQXJyYXkoamVbdF0ubHVtaW5hbmNlQ29lZmZpY2llbnRzKX19O2Z1bmN0aW9uIHhlKHIpe3JldHVybiByPC4wNDA0NT9yKi4wNzczOTkzODA4Ok1hdGgucG93KHIqLjk0Nzg2NzI5ODYrLjA1MjEzMjcwMTQsMi40KX1mdW5jdGlvbiBDbihyKXtyZXR1cm4gcjwuMDAzMTMwOD9yKjEyLjkyOjEuMDU1Kk1hdGgucG93KHIsLjQxNjY2KS0uMDU1fWxldCBUZTtjbGFzcyBpYXtzdGF0aWMgZ2V0RGF0YVVSTCh0KXtpZigvXmRhdGE6L2kudGVzdCh0LnNyYyl8fHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudD4idSIpcmV0dXJuIHQuc3JjO2xldCBlO2lmKHQgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCllPXQ7ZWxzZXtUZT09PXZvaWQgMCYmKFRlPXNyKCJjYW52YXMiKSksVGUud2lkdGg9dC53aWR0aCxUZS5oZWlnaHQ9dC5oZWlnaHQ7Y29uc3Qgcz1UZS5nZXRDb250ZXh0KCIyZCIpO3QgaW5zdGFuY2VvZiBJbWFnZURhdGE/cy5wdXRJbWFnZURhdGEodCwwLDApOnMuZHJhd0ltYWdlKHQsMCwwLHQud2lkdGgsdC5oZWlnaHQpLGU9VGV9cmV0dXJuIGUud2lkdGg+MjA0OHx8ZS5oZWlnaHQ+MjA0OD8oY29uc29sZS53YXJuKCJUSFJFRS5JbWFnZVV0aWxzLmdldERhdGFVUkw6IEltYWdlIGNvbnZlcnRlZCB0byBqcGcgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMiLHQpLGUudG9EYXRhVVJMKCJpbWFnZS9qcGVnIiwuNikpOmUudG9EYXRhVVJMKCJpbWFnZS9wbmciKX1zdGF0aWMgc1JHQlRvTGluZWFyKHQpe2lmKHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50PCJ1IiYmdCBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnR8fHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudDwidSImJnQgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudHx8dHlwZW9mIEltYWdlQml0bWFwPCJ1IiYmdCBpbnN0YW5jZW9mIEltYWdlQml0bWFwKXtjb25zdCBlPXNyKCJjYW52YXMiKTtlLndpZHRoPXQud2lkdGgsZS5oZWlnaHQ9dC5oZWlnaHQ7Y29uc3Qgcz1lLmdldENvbnRleHQoIjJkIik7cy5kcmF3SW1hZ2UodCwwLDAsdC53aWR0aCx0LmhlaWdodCk7Y29uc3Qgbj1zLmdldEltYWdlRGF0YSgwLDAsdC53aWR0aCx0LmhlaWdodCksaT1uLmRhdGE7Zm9yKGxldCBvPTA7bzxpLmxlbmd0aDtvKyspaVtvXT14ZShpW29dLzI1NSkqMjU1O3JldHVybiBzLnB1dEltYWdlRGF0YShuLDAsMCksZX1lbHNlIGlmKHQuZGF0YSl7Y29uc3QgZT10LmRhdGEuc2xpY2UoMCk7Zm9yKGxldCBzPTA7czxlLmxlbmd0aDtzKyspZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXl8fGUgaW5zdGFuY2VvZiBVaW50OENsYW1wZWRBcnJheT9lW3NdPU1hdGguZmxvb3IoeGUoZVtzXS8yNTUpKjI1NSk6ZVtzXT14ZShlW3NdKTtyZXR1cm57ZGF0YTplLHdpZHRoOnQud2lkdGgsaGVpZ2h0OnQuaGVpZ2h0fX1lbHNlIHJldHVybiBjb25zb2xlLndhcm4oIlRIUkVFLkltYWdlVXRpbHMuc1JHQlRvTGluZWFyKCk6IFVuc3VwcG9ydGVkIGltYWdlIHR5cGUuIE5vIGNvbG9yIHNwYWNlIGNvbnZlcnNpb24gYXBwbGllZC4iKSx0fX1sZXQgcmE9MDtjbGFzcyBycntjb25zdHJ1Y3Rvcih0PW51bGwpe3RoaXMuaXNTb3VyY2U9ITAsT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsImlkIix7dmFsdWU6cmErK30pLHRoaXMudXVpZD1LdCgpLHRoaXMuZGF0YT10LHRoaXMuZGF0YVJlYWR5PSEwLHRoaXMudmVyc2lvbj0wfXNldCBuZWVkc1VwZGF0ZSh0KXt0PT09ITAmJnRoaXMudmVyc2lvbisrfXRvSlNPTih0KXtjb25zdCBlPXQ9PT12b2lkIDB8fHR5cGVvZiB0PT0ic3RyaW5nIjtpZighZSYmdC5pbWFnZXNbdGhpcy51dWlkXSE9PXZvaWQgMClyZXR1cm4gdC5pbWFnZXNbdGhpcy51dWlkXTtjb25zdCBzPXt1dWlkOnRoaXMudXVpZCx1cmw6IiJ9LG49dGhpcy5kYXRhO2lmKG4hPT1udWxsKXtsZXQgaTtpZihBcnJheS5pc0FycmF5KG4pKXtpPVtdO2ZvcihsZXQgbz0wLGE9bi5sZW5ndGg7bzxhO28rKyluW29dLmlzRGF0YVRleHR1cmU/aS5wdXNoKEZuKG5bb10uaW1hZ2UpKTppLnB1c2goRm4obltvXSkpfWVsc2UgaT1GbihuKTtzLnVybD1pfXJldHVybiBlfHwodC5pbWFnZXNbdGhpcy51dWlkXT1zKSxzfX1mdW5jdGlvbiBGbihyKXtyZXR1cm4gdHlwZW9mIEhUTUxJbWFnZUVsZW1lbnQ8InUiJiZyIGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudHx8dHlwZW9mIEhUTUxDYW52YXNFbGVtZW50PCJ1IiYmciBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50fHx0eXBlb2YgSW1hZ2VCaXRtYXA8InUiJiZyIGluc3RhbmNlb2YgSW1hZ2VCaXRtYXA/aWEuZ2V0RGF0YVVSTChyKTpyLmRhdGE/e2RhdGE6QXJyYXkuZnJvbShyLmRhdGEpLHdpZHRoOnIud2lkdGgsaGVpZ2h0OnIuaGVpZ2h0LHR5cGU6ci5kYXRhLmNvbnN0cnVjdG9yLm5hbWV9Oihjb25zb2xlLndhcm4oIlRIUkVFLlRleHR1cmU6IFVuYWJsZSB0byBzZXJpYWxpemUgVGV4dHVyZS4iKSx7fSl9bGV0IG9hPTA7Y2xhc3MgRHQgZXh0ZW5kcyBaZXtjb25zdHJ1Y3Rvcih0PUR0LkRFRkFVTFRfSU1BR0UsZT1EdC5ERUZBVUxUX01BUFBJTkcscz1fcyxuPV9zLGk9JGksbz1HaSxhPUxvLGM9Um8sdT1EdC5ERUZBVUxUX0FOSVNPVFJPUFksaD1icyl7c3VwZXIoKSx0aGlzLmlzVGV4dHVyZT0hMCxPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywiaWQiLHt2YWx1ZTpvYSsrfSksdGhpcy51dWlkPUt0KCksdGhpcy5uYW1lPSIiLHRoaXMuc291cmNlPW5ldyBycih0KSx0aGlzLm1pcG1hcHM9W10sdGhpcy5tYXBwaW5nPWUsdGhpcy5jaGFubmVsPTAsdGhpcy53cmFwUz1zLHRoaXMud3JhcFQ9bix0aGlzLm1hZ0ZpbHRlcj1pLHRoaXMubWluRmlsdGVyPW8sdGhpcy5hbmlzb3Ryb3B5PXUsdGhpcy5mb3JtYXQ9YSx0aGlzLmludGVybmFsRm9ybWF0PW51bGwsdGhpcy50eXBlPWMsdGhpcy5vZmZzZXQ9bmV3IEooMCwwKSx0aGlzLnJlcGVhdD1uZXcgSigxLDEpLHRoaXMuY2VudGVyPW5ldyBKKDAsMCksdGhpcy5yb3RhdGlvbj0wLHRoaXMubWF0cml4QXV0b1VwZGF0ZT0hMCx0aGlzLm1hdHJpeD1uZXcgQ3QsdGhpcy5nZW5lcmF0ZU1pcG1hcHM9ITAsdGhpcy5wcmVtdWx0aXBseUFscGhhPSExLHRoaXMuZmxpcFk9ITAsdGhpcy51bnBhY2tBbGlnbm1lbnQ9NCx0aGlzLmNvbG9yU3BhY2U9aCx0aGlzLnVzZXJEYXRhPXt9LHRoaXMudmVyc2lvbj0wLHRoaXMub25VcGRhdGU9bnVsbCx0aGlzLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZT0hMSx0aGlzLnBtcmVtVmVyc2lvbj0wfWdldCBpbWFnZSgpe3JldHVybiB0aGlzLnNvdXJjZS5kYXRhfXNldCBpbWFnZSh0PW51bGwpe3RoaXMuc291cmNlLmRhdGE9dH11cGRhdGVNYXRyaXgoKXt0aGlzLm1hdHJpeC5zZXRVdlRyYW5zZm9ybSh0aGlzLm9mZnNldC54LHRoaXMub2Zmc2V0LnksdGhpcy5yZXBlYXQueCx0aGlzLnJlcGVhdC55LHRoaXMucm90YXRpb24sdGhpcy5jZW50ZXIueCx0aGlzLmNlbnRlci55KX1jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkodGhpcyl9Y29weSh0KXtyZXR1cm4gdGhpcy5uYW1lPXQubmFtZSx0aGlzLnNvdXJjZT10LnNvdXJjZSx0aGlzLm1pcG1hcHM9dC5taXBtYXBzLnNsaWNlKDApLHRoaXMubWFwcGluZz10Lm1hcHBpbmcsdGhpcy5jaGFubmVsPXQuY2hhbm5lbCx0aGlzLndyYXBTPXQud3JhcFMsdGhpcy53cmFwVD10LndyYXBULHRoaXMubWFnRmlsdGVyPXQubWFnRmlsdGVyLHRoaXMubWluRmlsdGVyPXQubWluRmlsdGVyLHRoaXMuYW5pc290cm9weT10LmFuaXNvdHJvcHksdGhpcy5mb3JtYXQ9dC5mb3JtYXQsdGhpcy5pbnRlcm5hbEZvcm1hdD10LmludGVybmFsRm9ybWF0LHRoaXMudHlwZT10LnR5cGUsdGhpcy5vZmZzZXQuY29weSh0Lm9mZnNldCksdGhpcy5yZXBlYXQuY29weSh0LnJlcGVhdCksdGhpcy5jZW50ZXIuY29weSh0LmNlbnRlciksdGhpcy5yb3RhdGlvbj10LnJvdGF0aW9uLHRoaXMubWF0cml4QXV0b1VwZGF0ZT10Lm1hdHJpeEF1dG9VcGRhdGUsdGhpcy5tYXRyaXguY29weSh0Lm1hdHJpeCksdGhpcy5nZW5lcmF0ZU1pcG1hcHM9dC5nZW5lcmF0ZU1pcG1hcHMsdGhpcy5wcmVtdWx0aXBseUFscGhhPXQucHJlbXVsdGlwbHlBbHBoYSx0aGlzLmZsaXBZPXQuZmxpcFksdGhpcy51bnBhY2tBbGlnbm1lbnQ9dC51bnBhY2tBbGlnbm1lbnQsdGhpcy5jb2xvclNwYWNlPXQuY29sb3JTcGFjZSx0aGlzLnVzZXJEYXRhPUpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodC51c2VyRGF0YSkpLHRoaXMubmVlZHNVcGRhdGU9ITAsdGhpc310b0pTT04odCl7Y29uc3QgZT10PT09dm9pZCAwfHx0eXBlb2YgdD09InN0cmluZyI7aWYoIWUmJnQudGV4dHVyZXNbdGhpcy51dWlkXSE9PXZvaWQgMClyZXR1cm4gdC50ZXh0dXJlc1t0aGlzLnV1aWRdO2NvbnN0IHM9e21ldGFkYXRhOnt2ZXJzaW9uOjQuNix0eXBlOiJUZXh0dXJlIixnZW5lcmF0b3I6IlRleHR1cmUudG9KU09OIn0sdXVpZDp0aGlzLnV1aWQsbmFtZTp0aGlzLm5hbWUsaW1hZ2U6dGhpcy5zb3VyY2UudG9KU09OKHQpLnV1aWQsbWFwcGluZzp0aGlzLm1hcHBpbmcsY2hhbm5lbDp0aGlzLmNoYW5uZWwscmVwZWF0Olt0aGlzLnJlcGVhdC54LHRoaXMucmVwZWF0LnldLG9mZnNldDpbdGhpcy5vZmZzZXQueCx0aGlzLm9mZnNldC55XSxjZW50ZXI6W3RoaXMuY2VudGVyLngsdGhpcy5jZW50ZXIueV0scm90YXRpb246dGhpcy5yb3RhdGlvbix3cmFwOlt0aGlzLndyYXBTLHRoaXMud3JhcFRdLGZvcm1hdDp0aGlzLmZvcm1hdCxpbnRlcm5hbEZvcm1hdDp0aGlzLmludGVybmFsRm9ybWF0LHR5cGU6dGhpcy50eXBlLGNvbG9yU3BhY2U6dGhpcy5jb2xvclNwYWNlLG1pbkZpbHRlcjp0aGlzLm1pbkZpbHRlcixtYWdGaWx0ZXI6dGhpcy5tYWdGaWx0ZXIsYW5pc290cm9weTp0aGlzLmFuaXNvdHJvcHksZmxpcFk6dGhpcy5mbGlwWSxnZW5lcmF0ZU1pcG1hcHM6dGhpcy5nZW5lcmF0ZU1pcG1hcHMscHJlbXVsdGlwbHlBbHBoYTp0aGlzLnByZW11bHRpcGx5QWxwaGEsdW5wYWNrQWxpZ25tZW50OnRoaXMudW5wYWNrQWxpZ25tZW50fTtyZXR1cm4gT2JqZWN0LmtleXModGhpcy51c2VyRGF0YSkubGVuZ3RoPjAmJihzLnVzZXJEYXRhPXRoaXMudXNlckRhdGEpLGV8fCh0LnRleHR1cmVzW3RoaXMudXVpZF09cyksc31kaXNwb3NlKCl7dGhpcy5kaXNwYXRjaEV2ZW50KHt0eXBlOiJkaXNwb3NlIn0pfXRyYW5zZm9ybVV2KHQpe2lmKHRoaXMubWFwcGluZyE9PWtpKXJldHVybiB0O2lmKHQuYXBwbHlNYXRyaXgzKHRoaXMubWF0cml4KSx0Lng8MHx8dC54PjEpc3dpdGNoKHRoaXMud3JhcFMpe2Nhc2UgSGk6dC54PXQueC1NYXRoLmZsb29yKHQueCk7YnJlYWs7Y2FzZSBfczp0Lng9dC54PDA/MDoxO2JyZWFrO2Nhc2UgcWk6TWF0aC5hYnMoTWF0aC5mbG9vcih0LngpJTIpPT09MT90Lng9TWF0aC5jZWlsKHQueCktdC54OnQueD10LngtTWF0aC5mbG9vcih0LngpO2JyZWFrfWlmKHQueTwwfHx0Lnk+MSlzd2l0Y2godGhpcy53cmFwVCl7Y2FzZSBIaTp0Lnk9dC55LU1hdGguZmxvb3IodC55KTticmVhaztjYXNlIF9zOnQueT10Lnk8MD8wOjE7YnJlYWs7Y2FzZSBxaTpNYXRoLmFicyhNYXRoLmZsb29yKHQueSklMik9PT0xP3QueT1NYXRoLmNlaWwodC55KS10Lnk6dC55PXQueS1NYXRoLmZsb29yKHQueSk7YnJlYWt9cmV0dXJuIHRoaXMuZmxpcFkmJih0Lnk9MS10LnkpLHR9c2V0IG5lZWRzVXBkYXRlKHQpe3Q9PT0hMCYmKHRoaXMudmVyc2lvbisrLHRoaXMuc291cmNlLm5lZWRzVXBkYXRlPSEwKX1zZXQgbmVlZHNQTVJFTVVwZGF0ZSh0KXt0PT09ITAmJnRoaXMucG1yZW1WZXJzaW9uKyt9fUR0LkRFRkFVTFRfSU1BR0U9bnVsbCxEdC5ERUZBVUxUX01BUFBJTkc9a2ksRHQuREVGQVVMVF9BTklTT1RST1BZPTQ7Y2xhc3MgRnR7Y29uc3RydWN0b3IodD0wLGU9MCxzPTAsbj0xKXtGdC5wcm90b3R5cGUuaXNWZWN0b3I0PSEwLHRoaXMueD10LHRoaXMueT1lLHRoaXMuej1zLHRoaXMudz1ufWdldCB3aWR0aCgpe3JldHVybiB0aGlzLnp9c2V0IHdpZHRoKHQpe3RoaXMuej10fWdldCBoZWlnaHQoKXtyZXR1cm4gdGhpcy53fXNldCBoZWlnaHQodCl7dGhpcy53PXR9c2V0KHQsZSxzLG4pe3JldHVybiB0aGlzLng9dCx0aGlzLnk9ZSx0aGlzLno9cyx0aGlzLnc9bix0aGlzfXNldFNjYWxhcih0KXtyZXR1cm4gdGhpcy54PXQsdGhpcy55PXQsdGhpcy56PXQsdGhpcy53PXQsdGhpc31zZXRYKHQpe3JldHVybiB0aGlzLng9dCx0aGlzfXNldFkodCl7cmV0dXJuIHRoaXMueT10LHRoaXN9c2V0Wih0KXtyZXR1cm4gdGhpcy56PXQsdGhpc31zZXRXKHQpe3JldHVybiB0aGlzLnc9dCx0aGlzfXNldENvbXBvbmVudCh0LGUpe3N3aXRjaCh0KXtjYXNlIDA6dGhpcy54PWU7YnJlYWs7Y2FzZSAxOnRoaXMueT1lO2JyZWFrO2Nhc2UgMjp0aGlzLno9ZTticmVhaztjYXNlIDM6dGhpcy53PWU7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoImluZGV4IGlzIG91dCBvZiByYW5nZTogIit0KX1yZXR1cm4gdGhpc31nZXRDb21wb25lbnQodCl7c3dpdGNoKHQpe2Nhc2UgMDpyZXR1cm4gdGhpcy54O2Nhc2UgMTpyZXR1cm4gdGhpcy55O2Nhc2UgMjpyZXR1cm4gdGhpcy56O2Nhc2UgMzpyZXR1cm4gdGhpcy53O2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICIrdCl9fWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMueCx0aGlzLnksdGhpcy56LHRoaXMudyl9Y29weSh0KXtyZXR1cm4gdGhpcy54PXQueCx0aGlzLnk9dC55LHRoaXMuej10LnosdGhpcy53PXQudyE9PXZvaWQgMD90Lnc6MSx0aGlzfWFkZCh0KXtyZXR1cm4gdGhpcy54Kz10LngsdGhpcy55Kz10LnksdGhpcy56Kz10LnosdGhpcy53Kz10LncsdGhpc31hZGRTY2FsYXIodCl7cmV0dXJuIHRoaXMueCs9dCx0aGlzLnkrPXQsdGhpcy56Kz10LHRoaXMudys9dCx0aGlzfWFkZFZlY3RvcnModCxlKXtyZXR1cm4gdGhpcy54PXQueCtlLngsdGhpcy55PXQueStlLnksdGhpcy56PXQueitlLnosdGhpcy53PXQudytlLncsdGhpc31hZGRTY2FsZWRWZWN0b3IodCxlKXtyZXR1cm4gdGhpcy54Kz10LngqZSx0aGlzLnkrPXQueSplLHRoaXMueis9dC56KmUsdGhpcy53Kz10LncqZSx0aGlzfXN1Yih0KXtyZXR1cm4gdGhpcy54LT10LngsdGhpcy55LT10LnksdGhpcy56LT10LnosdGhpcy53LT10LncsdGhpc31zdWJTY2FsYXIodCl7cmV0dXJuIHRoaXMueC09dCx0aGlzLnktPXQsdGhpcy56LT10LHRoaXMudy09dCx0aGlzfXN1YlZlY3RvcnModCxlKXtyZXR1cm4gdGhpcy54PXQueC1lLngsdGhpcy55PXQueS1lLnksdGhpcy56PXQuei1lLnosdGhpcy53PXQudy1lLncsdGhpc31tdWx0aXBseSh0KXtyZXR1cm4gdGhpcy54Kj10LngsdGhpcy55Kj10LnksdGhpcy56Kj10LnosdGhpcy53Kj10LncsdGhpc31tdWx0aXBseVNjYWxhcih0KXtyZXR1cm4gdGhpcy54Kj10LHRoaXMueSo9dCx0aGlzLnoqPXQsdGhpcy53Kj10LHRoaXN9YXBwbHlNYXRyaXg0KHQpe2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LG49dGhpcy56LGk9dGhpcy53LG89dC5lbGVtZW50cztyZXR1cm4gdGhpcy54PW9bMF0qZStvWzRdKnMrb1s4XSpuK29bMTJdKmksdGhpcy55PW9bMV0qZStvWzVdKnMrb1s5XSpuK29bMTNdKmksdGhpcy56PW9bMl0qZStvWzZdKnMrb1sxMF0qbitvWzE0XSppLHRoaXMudz1vWzNdKmUrb1s3XSpzK29bMTFdKm4rb1sxNV0qaSx0aGlzfWRpdmlkZVNjYWxhcih0KXtyZXR1cm4gdGhpcy5tdWx0aXBseVNjYWxhcigxL3QpfXNldEF4aXNBbmdsZUZyb21RdWF0ZXJuaW9uKHQpe3RoaXMudz0yKk1hdGguYWNvcyh0LncpO2NvbnN0IGU9TWF0aC5zcXJ0KDEtdC53KnQudyk7cmV0dXJuIGU8MWUtND8odGhpcy54PTEsdGhpcy55PTAsdGhpcy56PTApOih0aGlzLng9dC54L2UsdGhpcy55PXQueS9lLHRoaXMuej10LnovZSksdGhpc31zZXRBeGlzQW5nbGVGcm9tUm90YXRpb25NYXRyaXgodCl7bGV0IGUscyxuLGk7Y29uc3QgYz10LmVsZW1lbnRzLHU9Y1swXSxoPWNbNF0sbD1jWzhdLGQ9Y1sxXSxmPWNbNV0scD1jWzldLG09Y1syXSxnPWNbNl0seT1jWzEwXTtpZihNYXRoLmFicyhoLWQpPC4wMSYmTWF0aC5hYnMobC1tKTwuMDEmJk1hdGguYWJzKHAtZyk8LjAxKXtpZihNYXRoLmFicyhoK2QpPC4xJiZNYXRoLmFicyhsK20pPC4xJiZNYXRoLmFicyhwK2cpPC4xJiZNYXRoLmFicyh1K2YreS0zKTwuMSlyZXR1cm4gdGhpcy5zZXQoMSwwLDAsMCksdGhpcztlPU1hdGguUEk7Y29uc3Qgdz0odSsxKS8yLE09KGYrMSkvMixOPSh5KzEpLzIsXz0oaCtkKS80LFM9KGwrbSkvNCxFPShwK2cpLzQ7cmV0dXJuIHc+TSYmdz5OP3c8LjAxPyhzPTAsbj0uNzA3MTA2NzgxLGk9LjcwNzEwNjc4MSk6KHM9TWF0aC5zcXJ0KHcpLG49Xy9zLGk9Uy9zKTpNPk4/TTwuMDE/KHM9LjcwNzEwNjc4MSxuPTAsaT0uNzA3MTA2NzgxKToobj1NYXRoLnNxcnQoTSkscz1fL24saT1FL24pOk48LjAxPyhzPS43MDcxMDY3ODEsbj0uNzA3MTA2NzgxLGk9MCk6KGk9TWF0aC5zcXJ0KE4pLHM9Uy9pLG49RS9pKSx0aGlzLnNldChzLG4saSxlKSx0aGlzfWxldCBUPU1hdGguc3FydCgoZy1wKSooZy1wKSsobC1tKSoobC1tKSsoZC1oKSooZC1oKSk7cmV0dXJuIE1hdGguYWJzKFQpPC4wMDEmJihUPTEpLHRoaXMueD0oZy1wKS9ULHRoaXMueT0obC1tKS9ULHRoaXMuej0oZC1oKS9ULHRoaXMudz1NYXRoLmFjb3MoKHUrZit5LTEpLzIpLHRoaXN9c2V0RnJvbU1hdHJpeFBvc2l0aW9uKHQpe2NvbnN0IGU9dC5lbGVtZW50cztyZXR1cm4gdGhpcy54PWVbMTJdLHRoaXMueT1lWzEzXSx0aGlzLno9ZVsxNF0sdGhpcy53PWVbMTVdLHRoaXN9bWluKHQpe3JldHVybiB0aGlzLng9TWF0aC5taW4odGhpcy54LHQueCksdGhpcy55PU1hdGgubWluKHRoaXMueSx0LnkpLHRoaXMuej1NYXRoLm1pbih0aGlzLnosdC56KSx0aGlzLnc9TWF0aC5taW4odGhpcy53LHQudyksdGhpc31tYXgodCl7cmV0dXJuIHRoaXMueD1NYXRoLm1heCh0aGlzLngsdC54KSx0aGlzLnk9TWF0aC5tYXgodGhpcy55LHQueSksdGhpcy56PU1hdGgubWF4KHRoaXMueix0LnopLHRoaXMudz1NYXRoLm1heCh0aGlzLncsdC53KSx0aGlzfWNsYW1wKHQsZSl7cmV0dXJuIHRoaXMueD1NYXRoLm1heCh0LngsTWF0aC5taW4oZS54LHRoaXMueCkpLHRoaXMueT1NYXRoLm1heCh0LnksTWF0aC5taW4oZS55LHRoaXMueSkpLHRoaXMuej1NYXRoLm1heCh0LnosTWF0aC5taW4oZS56LHRoaXMueikpLHRoaXMudz1NYXRoLm1heCh0LncsTWF0aC5taW4oZS53LHRoaXMudykpLHRoaXN9Y2xhbXBTY2FsYXIodCxlKXtyZXR1cm4gdGhpcy54PU1hdGgubWF4KHQsTWF0aC5taW4oZSx0aGlzLngpKSx0aGlzLnk9TWF0aC5tYXgodCxNYXRoLm1pbihlLHRoaXMueSkpLHRoaXMuej1NYXRoLm1heCh0LE1hdGgubWluKGUsdGhpcy56KSksdGhpcy53PU1hdGgubWF4KHQsTWF0aC5taW4oZSx0aGlzLncpKSx0aGlzfWNsYW1wTGVuZ3RoKHQsZSl7Y29uc3Qgcz10aGlzLmxlbmd0aCgpO3JldHVybiB0aGlzLmRpdmlkZVNjYWxhcihzfHwxKS5tdWx0aXBseVNjYWxhcihNYXRoLm1heCh0LE1hdGgubWluKGUscykpKX1mbG9vcigpe3JldHVybiB0aGlzLng9TWF0aC5mbG9vcih0aGlzLngpLHRoaXMueT1NYXRoLmZsb29yKHRoaXMueSksdGhpcy56PU1hdGguZmxvb3IodGhpcy56KSx0aGlzLnc9TWF0aC5mbG9vcih0aGlzLncpLHRoaXN9Y2VpbCgpe3JldHVybiB0aGlzLng9TWF0aC5jZWlsKHRoaXMueCksdGhpcy55PU1hdGguY2VpbCh0aGlzLnkpLHRoaXMuej1NYXRoLmNlaWwodGhpcy56KSx0aGlzLnc9TWF0aC5jZWlsKHRoaXMudyksdGhpc31yb3VuZCgpe3JldHVybiB0aGlzLng9TWF0aC5yb3VuZCh0aGlzLngpLHRoaXMueT1NYXRoLnJvdW5kKHRoaXMueSksdGhpcy56PU1hdGgucm91bmQodGhpcy56KSx0aGlzLnc9TWF0aC5yb3VuZCh0aGlzLncpLHRoaXN9cm91bmRUb1plcm8oKXtyZXR1cm4gdGhpcy54PU1hdGgudHJ1bmModGhpcy54KSx0aGlzLnk9TWF0aC50cnVuYyh0aGlzLnkpLHRoaXMuej1NYXRoLnRydW5jKHRoaXMueiksdGhpcy53PU1hdGgudHJ1bmModGhpcy53KSx0aGlzfW5lZ2F0ZSgpe3JldHVybiB0aGlzLng9LXRoaXMueCx0aGlzLnk9LXRoaXMueSx0aGlzLno9LXRoaXMueix0aGlzLnc9LXRoaXMudyx0aGlzfWRvdCh0KXtyZXR1cm4gdGhpcy54KnQueCt0aGlzLnkqdC55K3RoaXMueip0LnordGhpcy53KnQud31sZW5ndGhTcSgpe3JldHVybiB0aGlzLngqdGhpcy54K3RoaXMueSp0aGlzLnkrdGhpcy56KnRoaXMueit0aGlzLncqdGhpcy53fWxlbmd0aCgpe3JldHVybiBNYXRoLnNxcnQodGhpcy54KnRoaXMueCt0aGlzLnkqdGhpcy55K3RoaXMueip0aGlzLnordGhpcy53KnRoaXMudyl9bWFuaGF0dGFuTGVuZ3RoKCl7cmV0dXJuIE1hdGguYWJzKHRoaXMueCkrTWF0aC5hYnModGhpcy55KStNYXRoLmFicyh0aGlzLnopK01hdGguYWJzKHRoaXMudyl9bm9ybWFsaXplKCl7cmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKHRoaXMubGVuZ3RoKCl8fDEpfXNldExlbmd0aCh0KXtyZXR1cm4gdGhpcy5ub3JtYWxpemUoKS5tdWx0aXBseVNjYWxhcih0KX1sZXJwKHQsZSl7cmV0dXJuIHRoaXMueCs9KHQueC10aGlzLngpKmUsdGhpcy55Kz0odC55LXRoaXMueSkqZSx0aGlzLnorPSh0LnotdGhpcy56KSplLHRoaXMudys9KHQudy10aGlzLncpKmUsdGhpc31sZXJwVmVjdG9ycyh0LGUscyl7cmV0dXJuIHRoaXMueD10LngrKGUueC10LngpKnMsdGhpcy55PXQueSsoZS55LXQueSkqcyx0aGlzLno9dC56KyhlLnotdC56KSpzLHRoaXMudz10LncrKGUudy10LncpKnMsdGhpc31lcXVhbHModCl7cmV0dXJuIHQueD09PXRoaXMueCYmdC55PT09dGhpcy55JiZ0Lno9PT10aGlzLnomJnQudz09PXRoaXMud31mcm9tQXJyYXkodCxlPTApe3JldHVybiB0aGlzLng9dFtlXSx0aGlzLnk9dFtlKzFdLHRoaXMuej10W2UrMl0sdGhpcy53PXRbZSszXSx0aGlzfXRvQXJyYXkodD1bXSxlPTApe3JldHVybiB0W2VdPXRoaXMueCx0W2UrMV09dGhpcy55LHRbZSsyXT10aGlzLnosdFtlKzNdPXRoaXMudyx0fWZyb21CdWZmZXJBdHRyaWJ1dGUodCxlKXtyZXR1cm4gdGhpcy54PXQuZ2V0WChlKSx0aGlzLnk9dC5nZXRZKGUpLHRoaXMuej10LmdldFooZSksdGhpcy53PXQuZ2V0VyhlKSx0aGlzfXJhbmRvbSgpe3JldHVybiB0aGlzLng9TWF0aC5yYW5kb20oKSx0aGlzLnk9TWF0aC5yYW5kb20oKSx0aGlzLno9TWF0aC5yYW5kb20oKSx0aGlzLnc9TWF0aC5yYW5kb20oKSx0aGlzfSpbU3ltYm9sLml0ZXJhdG9yXSgpe3lpZWxkIHRoaXMueCx5aWVsZCB0aGlzLnkseWllbGQgdGhpcy56LHlpZWxkIHRoaXMud319Y2xhc3Mgb3IgZXh0ZW5kcyBaZXtjb25zdHJ1Y3Rvcih0PTEsZT0xLHM9e30pe3N1cGVyKCksdGhpcy5pc1JlbmRlclRhcmdldD0hMCx0aGlzLndpZHRoPXQsdGhpcy5oZWlnaHQ9ZSx0aGlzLmRlcHRoPTEsdGhpcy5zY2lzc29yPW5ldyBGdCgwLDAsdCxlKSx0aGlzLnNjaXNzb3JUZXN0PSExLHRoaXMudmlld3BvcnQ9bmV3IEZ0KDAsMCx0LGUpO2NvbnN0IG49e3dpZHRoOnQsaGVpZ2h0OmUsZGVwdGg6MX07cz1PYmplY3QuYXNzaWduKHtnZW5lcmF0ZU1pcG1hcHM6ITEsaW50ZXJuYWxGb3JtYXQ6bnVsbCxtaW5GaWx0ZXI6JGksZGVwdGhCdWZmZXI6ITAsc3RlbmNpbEJ1ZmZlcjohMSxyZXNvbHZlRGVwdGhCdWZmZXI6ITAscmVzb2x2ZVN0ZW5jaWxCdWZmZXI6ITAsZGVwdGhUZXh0dXJlOm51bGwsc2FtcGxlczowLGNvdW50OjF9LHMpO2NvbnN0IGk9bmV3IER0KG4scy5tYXBwaW5nLHMud3JhcFMscy53cmFwVCxzLm1hZ0ZpbHRlcixzLm1pbkZpbHRlcixzLmZvcm1hdCxzLnR5cGUscy5hbmlzb3Ryb3B5LHMuY29sb3JTcGFjZSk7aS5mbGlwWT0hMSxpLmdlbmVyYXRlTWlwbWFwcz1zLmdlbmVyYXRlTWlwbWFwcyxpLmludGVybmFsRm9ybWF0PXMuaW50ZXJuYWxGb3JtYXQsdGhpcy50ZXh0dXJlcz1bXTtjb25zdCBvPXMuY291bnQ7Zm9yKGxldCBhPTA7YTxvO2ErKyl0aGlzLnRleHR1cmVzW2FdPWkuY2xvbmUoKSx0aGlzLnRleHR1cmVzW2FdLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZT0hMDt0aGlzLmRlcHRoQnVmZmVyPXMuZGVwdGhCdWZmZXIsdGhpcy5zdGVuY2lsQnVmZmVyPXMuc3RlbmNpbEJ1ZmZlcix0aGlzLnJlc29sdmVEZXB0aEJ1ZmZlcj1zLnJlc29sdmVEZXB0aEJ1ZmZlcix0aGlzLnJlc29sdmVTdGVuY2lsQnVmZmVyPXMucmVzb2x2ZVN0ZW5jaWxCdWZmZXIsdGhpcy5kZXB0aFRleHR1cmU9cy5kZXB0aFRleHR1cmUsdGhpcy5zYW1wbGVzPXMuc2FtcGxlc31nZXQgdGV4dHVyZSgpe3JldHVybiB0aGlzLnRleHR1cmVzWzBdfXNldCB0ZXh0dXJlKHQpe3RoaXMudGV4dHVyZXNbMF09dH1zZXRTaXplKHQsZSxzPTEpe2lmKHRoaXMud2lkdGghPT10fHx0aGlzLmhlaWdodCE9PWV8fHRoaXMuZGVwdGghPT1zKXt0aGlzLndpZHRoPXQsdGhpcy5oZWlnaHQ9ZSx0aGlzLmRlcHRoPXM7Zm9yKGxldCBuPTAsaT10aGlzLnRleHR1cmVzLmxlbmd0aDtuPGk7bisrKXRoaXMudGV4dHVyZXNbbl0uaW1hZ2Uud2lkdGg9dCx0aGlzLnRleHR1cmVzW25dLmltYWdlLmhlaWdodD1lLHRoaXMudGV4dHVyZXNbbl0uaW1hZ2UuZGVwdGg9czt0aGlzLmRpc3Bvc2UoKX10aGlzLnZpZXdwb3J0LnNldCgwLDAsdCxlKSx0aGlzLnNjaXNzb3Iuc2V0KDAsMCx0LGUpfWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSh0aGlzKX1jb3B5KHQpe3RoaXMud2lkdGg9dC53aWR0aCx0aGlzLmhlaWdodD10LmhlaWdodCx0aGlzLmRlcHRoPXQuZGVwdGgsdGhpcy5zY2lzc29yLmNvcHkodC5zY2lzc29yKSx0aGlzLnNjaXNzb3JUZXN0PXQuc2Npc3NvclRlc3QsdGhpcy52aWV3cG9ydC5jb3B5KHQudmlld3BvcnQpLHRoaXMudGV4dHVyZXMubGVuZ3RoPTA7Zm9yKGxldCBzPTAsbj10LnRleHR1cmVzLmxlbmd0aDtzPG47cysrKXRoaXMudGV4dHVyZXNbc109dC50ZXh0dXJlc1tzXS5jbG9uZSgpLHRoaXMudGV4dHVyZXNbc10uaXNSZW5kZXJUYXJnZXRUZXh0dXJlPSEwO2NvbnN0IGU9T2JqZWN0LmFzc2lnbih7fSx0LnRleHR1cmUuaW1hZ2UpO3JldHVybiB0aGlzLnRleHR1cmUuc291cmNlPW5ldyBycihlKSx0aGlzLmRlcHRoQnVmZmVyPXQuZGVwdGhCdWZmZXIsdGhpcy5zdGVuY2lsQnVmZmVyPXQuc3RlbmNpbEJ1ZmZlcix0aGlzLnJlc29sdmVEZXB0aEJ1ZmZlcj10LnJlc29sdmVEZXB0aEJ1ZmZlcix0aGlzLnJlc29sdmVTdGVuY2lsQnVmZmVyPXQucmVzb2x2ZVN0ZW5jaWxCdWZmZXIsdC5kZXB0aFRleHR1cmUhPT1udWxsJiYodGhpcy5kZXB0aFRleHR1cmU9dC5kZXB0aFRleHR1cmUuY2xvbmUoKSksdGhpcy5zYW1wbGVzPXQuc2FtcGxlcyx0aGlzfWRpc3Bvc2UoKXt0aGlzLmRpc3BhdGNoRXZlbnQoe3R5cGU6ImRpc3Bvc2UifSl9fWNsYXNzIFFle2NvbnN0cnVjdG9yKHQ9MCxlPTAscz0wLG49MSl7dGhpcy5pc1F1YXRlcm5pb249ITAsdGhpcy5feD10LHRoaXMuX3k9ZSx0aGlzLl96PXMsdGhpcy5fdz1ufXN0YXRpYyBzbGVycEZsYXQodCxlLHMsbixpLG8sYSl7bGV0IGM9c1tuKzBdLHU9c1tuKzFdLGg9c1tuKzJdLGw9c1tuKzNdO2NvbnN0IGQ9aVtvKzBdLGY9aVtvKzFdLHA9aVtvKzJdLG09aVtvKzNdO2lmKGE9PT0wKXt0W2UrMF09Yyx0W2UrMV09dSx0W2UrMl09aCx0W2UrM109bDtyZXR1cm59aWYoYT09PTEpe3RbZSswXT1kLHRbZSsxXT1mLHRbZSsyXT1wLHRbZSszXT1tO3JldHVybn1pZihsIT09bXx8YyE9PWR8fHUhPT1mfHxoIT09cCl7bGV0IGc9MS1hO2NvbnN0IHk9YypkK3UqZitoKnArbCptLFQ9eT49MD8xOi0xLHc9MS15Knk7aWYodz5OdW1iZXIuRVBTSUxPTil7Y29uc3QgTj1NYXRoLnNxcnQodyksXz1NYXRoLmF0YW4yKE4seSpUKTtnPU1hdGguc2luKGcqXykvTixhPU1hdGguc2luKGEqXykvTn1jb25zdCBNPWEqVDtpZihjPWMqZytkKk0sdT11KmcrZipNLGg9aCpnK3AqTSxsPWwqZyttKk0sZz09PTEtYSl7Y29uc3QgTj0xL01hdGguc3FydChjKmMrdSp1K2gqaCtsKmwpO2MqPU4sdSo9TixoKj1OLGwqPU59fXRbZV09Yyx0W2UrMV09dSx0W2UrMl09aCx0W2UrM109bH1zdGF0aWMgbXVsdGlwbHlRdWF0ZXJuaW9uc0ZsYXQodCxlLHMsbixpLG8pe2NvbnN0IGE9c1tuXSxjPXNbbisxXSx1PXNbbisyXSxoPXNbbiszXSxsPWlbb10sZD1pW28rMV0sZj1pW28rMl0scD1pW28rM107cmV0dXJuIHRbZV09YSpwK2gqbCtjKmYtdSpkLHRbZSsxXT1jKnAraCpkK3UqbC1hKmYsdFtlKzJdPXUqcCtoKmYrYSpkLWMqbCx0W2UrM109aCpwLWEqbC1jKmQtdSpmLHR9Z2V0IHgoKXtyZXR1cm4gdGhpcy5feH1zZXQgeCh0KXt0aGlzLl94PXQsdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpfWdldCB5KCl7cmV0dXJuIHRoaXMuX3l9c2V0IHkodCl7dGhpcy5feT10LHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKX1nZXQgeigpe3JldHVybiB0aGlzLl96fXNldCB6KHQpe3RoaXMuX3o9dCx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCl9Z2V0IHcoKXtyZXR1cm4gdGhpcy5fd31zZXQgdyh0KXt0aGlzLl93PXQsdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpfXNldCh0LGUscyxuKXtyZXR1cm4gdGhpcy5feD10LHRoaXMuX3k9ZSx0aGlzLl96PXMsdGhpcy5fdz1uLHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMuX3gsdGhpcy5feSx0aGlzLl96LHRoaXMuX3cpfWNvcHkodCl7cmV0dXJuIHRoaXMuX3g9dC54LHRoaXMuX3k9dC55LHRoaXMuX3o9dC56LHRoaXMuX3c9dC53LHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfXNldEZyb21FdWxlcih0LGU9ITApe2NvbnN0IHM9dC5feCxuPXQuX3ksaT10Ll96LG89dC5fb3JkZXIsYT1NYXRoLmNvcyxjPU1hdGguc2luLHU9YShzLzIpLGg9YShuLzIpLGw9YShpLzIpLGQ9YyhzLzIpLGY9YyhuLzIpLHA9YyhpLzIpO3N3aXRjaChvKXtjYXNlIlhZWiI6dGhpcy5feD1kKmgqbCt1KmYqcCx0aGlzLl95PXUqZipsLWQqaCpwLHRoaXMuX3o9dSpoKnArZCpmKmwsdGhpcy5fdz11KmgqbC1kKmYqcDticmVhaztjYXNlIllYWiI6dGhpcy5feD1kKmgqbCt1KmYqcCx0aGlzLl95PXUqZipsLWQqaCpwLHRoaXMuX3o9dSpoKnAtZCpmKmwsdGhpcy5fdz11KmgqbCtkKmYqcDticmVhaztjYXNlIlpYWSI6dGhpcy5feD1kKmgqbC11KmYqcCx0aGlzLl95PXUqZipsK2QqaCpwLHRoaXMuX3o9dSpoKnArZCpmKmwsdGhpcy5fdz11KmgqbC1kKmYqcDticmVhaztjYXNlIlpZWCI6dGhpcy5feD1kKmgqbC11KmYqcCx0aGlzLl95PXUqZipsK2QqaCpwLHRoaXMuX3o9dSpoKnAtZCpmKmwsdGhpcy5fdz11KmgqbCtkKmYqcDticmVhaztjYXNlIllaWCI6dGhpcy5feD1kKmgqbCt1KmYqcCx0aGlzLl95PXUqZipsK2QqaCpwLHRoaXMuX3o9dSpoKnAtZCpmKmwsdGhpcy5fdz11KmgqbC1kKmYqcDticmVhaztjYXNlIlhaWSI6dGhpcy5feD1kKmgqbC11KmYqcCx0aGlzLl95PXUqZipsLWQqaCpwLHRoaXMuX3o9dSpoKnArZCpmKmwsdGhpcy5fdz11KmgqbCtkKmYqcDticmVhaztkZWZhdWx0OmNvbnNvbGUud2FybigiVEhSRUUuUXVhdGVybmlvbjogLnNldEZyb21FdWxlcigpIGVuY291bnRlcmVkIGFuIHVua25vd24gb3JkZXI6ICIrbyl9cmV0dXJuIGU9PT0hMCYmdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9c2V0RnJvbUF4aXNBbmdsZSh0LGUpe2NvbnN0IHM9ZS8yLG49TWF0aC5zaW4ocyk7cmV0dXJuIHRoaXMuX3g9dC54Km4sdGhpcy5feT10Lnkqbix0aGlzLl96PXQueipuLHRoaXMuX3c9TWF0aC5jb3MocyksdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9c2V0RnJvbVJvdGF0aW9uTWF0cml4KHQpe2NvbnN0IGU9dC5lbGVtZW50cyxzPWVbMF0sbj1lWzRdLGk9ZVs4XSxvPWVbMV0sYT1lWzVdLGM9ZVs5XSx1PWVbMl0saD1lWzZdLGw9ZVsxMF0sZD1zK2ErbDtpZihkPjApe2NvbnN0IGY9LjUvTWF0aC5zcXJ0KGQrMSk7dGhpcy5fdz0uMjUvZix0aGlzLl94PShoLWMpKmYsdGhpcy5feT0oaS11KSpmLHRoaXMuX3o9KG8tbikqZn1lbHNlIGlmKHM+YSYmcz5sKXtjb25zdCBmPTIqTWF0aC5zcXJ0KDErcy1hLWwpO3RoaXMuX3c9KGgtYykvZix0aGlzLl94PS4yNSpmLHRoaXMuX3k9KG4rbykvZix0aGlzLl96PShpK3UpL2Z9ZWxzZSBpZihhPmwpe2NvbnN0IGY9MipNYXRoLnNxcnQoMSthLXMtbCk7dGhpcy5fdz0oaS11KS9mLHRoaXMuX3g9KG4rbykvZix0aGlzLl95PS4yNSpmLHRoaXMuX3o9KGMraCkvZn1lbHNle2NvbnN0IGY9MipNYXRoLnNxcnQoMStsLXMtYSk7dGhpcy5fdz0oby1uKS9mLHRoaXMuX3g9KGkrdSkvZix0aGlzLl95PShjK2gpL2YsdGhpcy5fej0uMjUqZn1yZXR1cm4gdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9c2V0RnJvbVVuaXRWZWN0b3JzKHQsZSl7bGV0IHM9dC5kb3QoZSkrMTtyZXR1cm4gczxOdW1iZXIuRVBTSUxPTj8ocz0wLE1hdGguYWJzKHQueCk+TWF0aC5hYnModC56KT8odGhpcy5feD0tdC55LHRoaXMuX3k9dC54LHRoaXMuX3o9MCx0aGlzLl93PXMpOih0aGlzLl94PTAsdGhpcy5feT0tdC56LHRoaXMuX3o9dC55LHRoaXMuX3c9cykpOih0aGlzLl94PXQueSplLnotdC56KmUueSx0aGlzLl95PXQueiplLngtdC54KmUueix0aGlzLl96PXQueCplLnktdC55KmUueCx0aGlzLl93PXMpLHRoaXMubm9ybWFsaXplKCl9YW5nbGVUbyh0KXtyZXR1cm4gMipNYXRoLmFjb3MoTWF0aC5hYnMoYXQodGhpcy5kb3QodCksLTEsMSkpKX1yb3RhdGVUb3dhcmRzKHQsZSl7Y29uc3Qgcz10aGlzLmFuZ2xlVG8odCk7aWYocz09PTApcmV0dXJuIHRoaXM7Y29uc3Qgbj1NYXRoLm1pbigxLGUvcyk7cmV0dXJuIHRoaXMuc2xlcnAodCxuKSx0aGlzfWlkZW50aXR5KCl7cmV0dXJuIHRoaXMuc2V0KDAsMCwwLDEpfWludmVydCgpe3JldHVybiB0aGlzLmNvbmp1Z2F0ZSgpfWNvbmp1Z2F0ZSgpe3JldHVybiB0aGlzLl94Kj0tMSx0aGlzLl95Kj0tMSx0aGlzLl96Kj0tMSx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCksdGhpc31kb3QodCl7cmV0dXJuIHRoaXMuX3gqdC5feCt0aGlzLl95KnQuX3krdGhpcy5feip0Ll96K3RoaXMuX3cqdC5fd31sZW5ndGhTcSgpe3JldHVybiB0aGlzLl94KnRoaXMuX3grdGhpcy5feSp0aGlzLl95K3RoaXMuX3oqdGhpcy5feit0aGlzLl93KnRoaXMuX3d9bGVuZ3RoKCl7cmV0dXJuIE1hdGguc3FydCh0aGlzLl94KnRoaXMuX3grdGhpcy5feSp0aGlzLl95K3RoaXMuX3oqdGhpcy5feit0aGlzLl93KnRoaXMuX3cpfW5vcm1hbGl6ZSgpe2xldCB0PXRoaXMubGVuZ3RoKCk7cmV0dXJuIHQ9PT0wPyh0aGlzLl94PTAsdGhpcy5feT0wLHRoaXMuX3o9MCx0aGlzLl93PTEpOih0PTEvdCx0aGlzLl94PXRoaXMuX3gqdCx0aGlzLl95PXRoaXMuX3kqdCx0aGlzLl96PXRoaXMuX3oqdCx0aGlzLl93PXRoaXMuX3cqdCksdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9bXVsdGlwbHkodCl7cmV0dXJuIHRoaXMubXVsdGlwbHlRdWF0ZXJuaW9ucyh0aGlzLHQpfXByZW11bHRpcGx5KHQpe3JldHVybiB0aGlzLm11bHRpcGx5UXVhdGVybmlvbnModCx0aGlzKX1tdWx0aXBseVF1YXRlcm5pb25zKHQsZSl7Y29uc3Qgcz10Ll94LG49dC5feSxpPXQuX3osbz10Ll93LGE9ZS5feCxjPWUuX3ksdT1lLl96LGg9ZS5fdztyZXR1cm4gdGhpcy5feD1zKmgrbyphK24qdS1pKmMsdGhpcy5feT1uKmgrbypjK2kqYS1zKnUsdGhpcy5fej1pKmgrbyp1K3MqYy1uKmEsdGhpcy5fdz1vKmgtcyphLW4qYy1pKnUsdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9c2xlcnAodCxlKXtpZihlPT09MClyZXR1cm4gdGhpcztpZihlPT09MSlyZXR1cm4gdGhpcy5jb3B5KHQpO2NvbnN0IHM9dGhpcy5feCxuPXRoaXMuX3ksaT10aGlzLl96LG89dGhpcy5fdztsZXQgYT1vKnQuX3crcyp0Ll94K24qdC5feStpKnQuX3o7aWYoYTwwPyh0aGlzLl93PS10Ll93LHRoaXMuX3g9LXQuX3gsdGhpcy5feT0tdC5feSx0aGlzLl96PS10Ll96LGE9LWEpOnRoaXMuY29weSh0KSxhPj0xKXJldHVybiB0aGlzLl93PW8sdGhpcy5feD1zLHRoaXMuX3k9bix0aGlzLl96PWksdGhpcztjb25zdCBjPTEtYSphO2lmKGM8PU51bWJlci5FUFNJTE9OKXtjb25zdCBmPTEtZTtyZXR1cm4gdGhpcy5fdz1mKm8rZSp0aGlzLl93LHRoaXMuX3g9ZipzK2UqdGhpcy5feCx0aGlzLl95PWYqbitlKnRoaXMuX3ksdGhpcy5fej1mKmkrZSp0aGlzLl96LHRoaXMubm9ybWFsaXplKCksdGhpc31jb25zdCB1PU1hdGguc3FydChjKSxoPU1hdGguYXRhbjIodSxhKSxsPU1hdGguc2luKCgxLWUpKmgpL3UsZD1NYXRoLnNpbihlKmgpL3U7cmV0dXJuIHRoaXMuX3c9bypsK3RoaXMuX3cqZCx0aGlzLl94PXMqbCt0aGlzLl94KmQsdGhpcy5feT1uKmwrdGhpcy5feSpkLHRoaXMuX3o9aSpsK3RoaXMuX3oqZCx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCksdGhpc31zbGVycFF1YXRlcm5pb25zKHQsZSxzKXtyZXR1cm4gdGhpcy5jb3B5KHQpLnNsZXJwKGUscyl9cmFuZG9tKCl7Y29uc3QgdD0yKk1hdGguUEkqTWF0aC5yYW5kb20oKSxlPTIqTWF0aC5QSSpNYXRoLnJhbmRvbSgpLHM9TWF0aC5yYW5kb20oKSxuPU1hdGguc3FydCgxLXMpLGk9TWF0aC5zcXJ0KHMpO3JldHVybiB0aGlzLnNldChuKk1hdGguc2luKHQpLG4qTWF0aC5jb3ModCksaSpNYXRoLnNpbihlKSxpKk1hdGguY29zKGUpKX1lcXVhbHModCl7cmV0dXJuIHQuX3g9PT10aGlzLl94JiZ0Ll95PT09dGhpcy5feSYmdC5fej09PXRoaXMuX3omJnQuX3c9PT10aGlzLl93fWZyb21BcnJheSh0LGU9MCl7cmV0dXJuIHRoaXMuX3g9dFtlXSx0aGlzLl95PXRbZSsxXSx0aGlzLl96PXRbZSsyXSx0aGlzLl93PXRbZSszXSx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCksdGhpc310b0FycmF5KHQ9W10sZT0wKXtyZXR1cm4gdFtlXT10aGlzLl94LHRbZSsxXT10aGlzLl95LHRbZSsyXT10aGlzLl96LHRbZSszXT10aGlzLl93LHR9ZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LGUpe3JldHVybiB0aGlzLl94PXQuZ2V0WChlKSx0aGlzLl95PXQuZ2V0WShlKSx0aGlzLl96PXQuZ2V0WihlKSx0aGlzLl93PXQuZ2V0VyhlKSx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCksdGhpc310b0pTT04oKXtyZXR1cm4gdGhpcy50b0FycmF5KCl9X29uQ2hhbmdlKHQpe3JldHVybiB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrPXQsdGhpc31fb25DaGFuZ2VDYWxsYmFjaygpe30qW1N5bWJvbC5pdGVyYXRvcl0oKXt5aWVsZCB0aGlzLl94LHlpZWxkIHRoaXMuX3kseWllbGQgdGhpcy5feix5aWVsZCB0aGlzLl93fX1jbGFzcyBBe2NvbnN0cnVjdG9yKHQ9MCxlPTAscz0wKXtBLnByb3RvdHlwZS5pc1ZlY3RvcjM9ITAsdGhpcy54PXQsdGhpcy55PWUsdGhpcy56PXN9c2V0KHQsZSxzKXtyZXR1cm4gcz09PXZvaWQgMCYmKHM9dGhpcy56KSx0aGlzLng9dCx0aGlzLnk9ZSx0aGlzLno9cyx0aGlzfXNldFNjYWxhcih0KXtyZXR1cm4gdGhpcy54PXQsdGhpcy55PXQsdGhpcy56PXQsdGhpc31zZXRYKHQpe3JldHVybiB0aGlzLng9dCx0aGlzfXNldFkodCl7cmV0dXJuIHRoaXMueT10LHRoaXN9c2V0Wih0KXtyZXR1cm4gdGhpcy56PXQsdGhpc31zZXRDb21wb25lbnQodCxlKXtzd2l0Y2godCl7Y2FzZSAwOnRoaXMueD1lO2JyZWFrO2Nhc2UgMTp0aGlzLnk9ZTticmVhaztjYXNlIDI6dGhpcy56PWU7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoImluZGV4IGlzIG91dCBvZiByYW5nZTogIit0KX1yZXR1cm4gdGhpc31nZXRDb21wb25lbnQodCl7c3dpdGNoKHQpe2Nhc2UgMDpyZXR1cm4gdGhpcy54O2Nhc2UgMTpyZXR1cm4gdGhpcy55O2Nhc2UgMjpyZXR1cm4gdGhpcy56O2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICIrdCl9fWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMueCx0aGlzLnksdGhpcy56KX1jb3B5KHQpe3JldHVybiB0aGlzLng9dC54LHRoaXMueT10LnksdGhpcy56PXQueix0aGlzfWFkZCh0KXtyZXR1cm4gdGhpcy54Kz10LngsdGhpcy55Kz10LnksdGhpcy56Kz10LnosdGhpc31hZGRTY2FsYXIodCl7cmV0dXJuIHRoaXMueCs9dCx0aGlzLnkrPXQsdGhpcy56Kz10LHRoaXN9YWRkVmVjdG9ycyh0LGUpe3JldHVybiB0aGlzLng9dC54K2UueCx0aGlzLnk9dC55K2UueSx0aGlzLno9dC56K2Uueix0aGlzfWFkZFNjYWxlZFZlY3Rvcih0LGUpe3JldHVybiB0aGlzLngrPXQueCplLHRoaXMueSs9dC55KmUsdGhpcy56Kz10LnoqZSx0aGlzfXN1Yih0KXtyZXR1cm4gdGhpcy54LT10LngsdGhpcy55LT10LnksdGhpcy56LT10LnosdGhpc31zdWJTY2FsYXIodCl7cmV0dXJuIHRoaXMueC09dCx0aGlzLnktPXQsdGhpcy56LT10LHRoaXN9c3ViVmVjdG9ycyh0LGUpe3JldHVybiB0aGlzLng9dC54LWUueCx0aGlzLnk9dC55LWUueSx0aGlzLno9dC56LWUueix0aGlzfW11bHRpcGx5KHQpe3JldHVybiB0aGlzLngqPXQueCx0aGlzLnkqPXQueSx0aGlzLnoqPXQueix0aGlzfW11bHRpcGx5U2NhbGFyKHQpe3JldHVybiB0aGlzLngqPXQsdGhpcy55Kj10LHRoaXMueio9dCx0aGlzfW11bHRpcGx5VmVjdG9ycyh0LGUpe3JldHVybiB0aGlzLng9dC54KmUueCx0aGlzLnk9dC55KmUueSx0aGlzLno9dC56KmUueix0aGlzfWFwcGx5RXVsZXIodCl7cmV0dXJuIHRoaXMuYXBwbHlRdWF0ZXJuaW9uKGFyLnNldEZyb21FdWxlcih0KSl9YXBwbHlBeGlzQW5nbGUodCxlKXtyZXR1cm4gdGhpcy5hcHBseVF1YXRlcm5pb24oYXIuc2V0RnJvbUF4aXNBbmdsZSh0LGUpKX1hcHBseU1hdHJpeDModCl7Y29uc3QgZT10aGlzLngscz10aGlzLnksbj10aGlzLnosaT10LmVsZW1lbnRzO3JldHVybiB0aGlzLng9aVswXSplK2lbM10qcytpWzZdKm4sdGhpcy55PWlbMV0qZStpWzRdKnMraVs3XSpuLHRoaXMuej1pWzJdKmUraVs1XSpzK2lbOF0qbix0aGlzfWFwcGx5Tm9ybWFsTWF0cml4KHQpe3JldHVybiB0aGlzLmFwcGx5TWF0cml4Myh0KS5ub3JtYWxpemUoKX1hcHBseU1hdHJpeDQodCl7Y29uc3QgZT10aGlzLngscz10aGlzLnksbj10aGlzLnosaT10LmVsZW1lbnRzLG89MS8oaVszXSplK2lbN10qcytpWzExXSpuK2lbMTVdKTtyZXR1cm4gdGhpcy54PShpWzBdKmUraVs0XSpzK2lbOF0qbitpWzEyXSkqbyx0aGlzLnk9KGlbMV0qZStpWzVdKnMraVs5XSpuK2lbMTNdKSpvLHRoaXMuej0oaVsyXSplK2lbNl0qcytpWzEwXSpuK2lbMTRdKSpvLHRoaXN9YXBwbHlRdWF0ZXJuaW9uKHQpe2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LG49dGhpcy56LGk9dC54LG89dC55LGE9dC56LGM9dC53LHU9MioobypuLWEqcyksaD0yKihhKmUtaSpuKSxsPTIqKGkqcy1vKmUpO3JldHVybiB0aGlzLng9ZStjKnUrbypsLWEqaCx0aGlzLnk9cytjKmgrYSp1LWkqbCx0aGlzLno9bitjKmwraSpoLW8qdSx0aGlzfXByb2plY3QodCl7cmV0dXJuIHRoaXMuYXBwbHlNYXRyaXg0KHQubWF0cml4V29ybGRJbnZlcnNlKS5hcHBseU1hdHJpeDQodC5wcm9qZWN0aW9uTWF0cml4KX11bnByb2plY3QodCl7cmV0dXJuIHRoaXMuYXBwbHlNYXRyaXg0KHQucHJvamVjdGlvbk1hdHJpeEludmVyc2UpLmFwcGx5TWF0cml4NCh0Lm1hdHJpeFdvcmxkKX10cmFuc2Zvcm1EaXJlY3Rpb24odCl7Y29uc3QgZT10aGlzLngscz10aGlzLnksbj10aGlzLnosaT10LmVsZW1lbnRzO3JldHVybiB0aGlzLng9aVswXSplK2lbNF0qcytpWzhdKm4sdGhpcy55PWlbMV0qZStpWzVdKnMraVs5XSpuLHRoaXMuej1pWzJdKmUraVs2XSpzK2lbMTBdKm4sdGhpcy5ub3JtYWxpemUoKX1kaXZpZGUodCl7cmV0dXJuIHRoaXMueC89dC54LHRoaXMueS89dC55LHRoaXMuei89dC56LHRoaXN9ZGl2aWRlU2NhbGFyKHQpe3JldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKDEvdCl9bWluKHQpe3JldHVybiB0aGlzLng9TWF0aC5taW4odGhpcy54LHQueCksdGhpcy55PU1hdGgubWluKHRoaXMueSx0LnkpLHRoaXMuej1NYXRoLm1pbih0aGlzLnosdC56KSx0aGlzfW1heCh0KXtyZXR1cm4gdGhpcy54PU1hdGgubWF4KHRoaXMueCx0LngpLHRoaXMueT1NYXRoLm1heCh0aGlzLnksdC55KSx0aGlzLno9TWF0aC5tYXgodGhpcy56LHQueiksdGhpc31jbGFtcCh0LGUpe3JldHVybiB0aGlzLng9TWF0aC5tYXgodC54LE1hdGgubWluKGUueCx0aGlzLngpKSx0aGlzLnk9TWF0aC5tYXgodC55LE1hdGgubWluKGUueSx0aGlzLnkpKSx0aGlzLno9TWF0aC5tYXgodC56LE1hdGgubWluKGUueix0aGlzLnopKSx0aGlzfWNsYW1wU2NhbGFyKHQsZSl7cmV0dXJuIHRoaXMueD1NYXRoLm1heCh0LE1hdGgubWluKGUsdGhpcy54KSksdGhpcy55PU1hdGgubWF4KHQsTWF0aC5taW4oZSx0aGlzLnkpKSx0aGlzLno9TWF0aC5tYXgodCxNYXRoLm1pbihlLHRoaXMueikpLHRoaXN9Y2xhbXBMZW5ndGgodCxlKXtjb25zdCBzPXRoaXMubGVuZ3RoKCk7cmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKHN8fDEpLm11bHRpcGx5U2NhbGFyKE1hdGgubWF4KHQsTWF0aC5taW4oZSxzKSkpfWZsb29yKCl7cmV0dXJuIHRoaXMueD1NYXRoLmZsb29yKHRoaXMueCksdGhpcy55PU1hdGguZmxvb3IodGhpcy55KSx0aGlzLno9TWF0aC5mbG9vcih0aGlzLnopLHRoaXN9Y2VpbCgpe3JldHVybiB0aGlzLng9TWF0aC5jZWlsKHRoaXMueCksdGhpcy55PU1hdGguY2VpbCh0aGlzLnkpLHRoaXMuej1NYXRoLmNlaWwodGhpcy56KSx0aGlzfXJvdW5kKCl7cmV0dXJuIHRoaXMueD1NYXRoLnJvdW5kKHRoaXMueCksdGhpcy55PU1hdGgucm91bmQodGhpcy55KSx0aGlzLno9TWF0aC5yb3VuZCh0aGlzLnopLHRoaXN9cm91bmRUb1plcm8oKXtyZXR1cm4gdGhpcy54PU1hdGgudHJ1bmModGhpcy54KSx0aGlzLnk9TWF0aC50cnVuYyh0aGlzLnkpLHRoaXMuej1NYXRoLnRydW5jKHRoaXMueiksdGhpc31uZWdhdGUoKXtyZXR1cm4gdGhpcy54PS10aGlzLngsdGhpcy55PS10aGlzLnksdGhpcy56PS10aGlzLnosdGhpc31kb3QodCl7cmV0dXJuIHRoaXMueCp0LngrdGhpcy55KnQueSt0aGlzLnoqdC56fWxlbmd0aFNxKCl7cmV0dXJuIHRoaXMueCp0aGlzLngrdGhpcy55KnRoaXMueSt0aGlzLnoqdGhpcy56fWxlbmd0aCgpe3JldHVybiBNYXRoLnNxcnQodGhpcy54KnRoaXMueCt0aGlzLnkqdGhpcy55K3RoaXMueip0aGlzLnopfW1hbmhhdHRhbkxlbmd0aCgpe3JldHVybiBNYXRoLmFicyh0aGlzLngpK01hdGguYWJzKHRoaXMueSkrTWF0aC5hYnModGhpcy56KX1ub3JtYWxpemUoKXtyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIodGhpcy5sZW5ndGgoKXx8MSl9c2V0TGVuZ3RoKHQpe3JldHVybiB0aGlzLm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKHQpfWxlcnAodCxlKXtyZXR1cm4gdGhpcy54Kz0odC54LXRoaXMueCkqZSx0aGlzLnkrPSh0LnktdGhpcy55KSplLHRoaXMueis9KHQuei10aGlzLnopKmUsdGhpc31sZXJwVmVjdG9ycyh0LGUscyl7cmV0dXJuIHRoaXMueD10LngrKGUueC10LngpKnMsdGhpcy55PXQueSsoZS55LXQueSkqcyx0aGlzLno9dC56KyhlLnotdC56KSpzLHRoaXN9Y3Jvc3ModCl7cmV0dXJuIHRoaXMuY3Jvc3NWZWN0b3JzKHRoaXMsdCl9Y3Jvc3NWZWN0b3JzKHQsZSl7Y29uc3Qgcz10Lngsbj10LnksaT10Lnosbz1lLngsYT1lLnksYz1lLno7cmV0dXJuIHRoaXMueD1uKmMtaSphLHRoaXMueT1pKm8tcypjLHRoaXMuej1zKmEtbipvLHRoaXN9cHJvamVjdE9uVmVjdG9yKHQpe2NvbnN0IGU9dC5sZW5ndGhTcSgpO2lmKGU9PT0wKXJldHVybiB0aGlzLnNldCgwLDAsMCk7Y29uc3Qgcz10LmRvdCh0aGlzKS9lO3JldHVybiB0aGlzLmNvcHkodCkubXVsdGlwbHlTY2FsYXIocyl9cHJvamVjdE9uUGxhbmUodCl7cmV0dXJuIFJuLmNvcHkodGhpcykucHJvamVjdE9uVmVjdG9yKHQpLHRoaXMuc3ViKFJuKX1yZWZsZWN0KHQpe3JldHVybiB0aGlzLnN1YihSbi5jb3B5KHQpLm11bHRpcGx5U2NhbGFyKDIqdGhpcy5kb3QodCkpKX1hbmdsZVRvKHQpe2NvbnN0IGU9TWF0aC5zcXJ0KHRoaXMubGVuZ3RoU3EoKSp0Lmxlbmd0aFNxKCkpO2lmKGU9PT0wKXJldHVybiBNYXRoLlBJLzI7Y29uc3Qgcz10aGlzLmRvdCh0KS9lO3JldHVybiBNYXRoLmFjb3MoYXQocywtMSwxKSl9ZGlzdGFuY2VUbyh0KXtyZXR1cm4gTWF0aC5zcXJ0KHRoaXMuZGlzdGFuY2VUb1NxdWFyZWQodCkpfWRpc3RhbmNlVG9TcXVhcmVkKHQpe2NvbnN0IGU9dGhpcy54LXQueCxzPXRoaXMueS10Lnksbj10aGlzLnotdC56O3JldHVybiBlKmUrcypzK24qbn1tYW5oYXR0YW5EaXN0YW5jZVRvKHQpe3JldHVybiBNYXRoLmFicyh0aGlzLngtdC54KStNYXRoLmFicyh0aGlzLnktdC55KStNYXRoLmFicyh0aGlzLnotdC56KX1zZXRGcm9tU3BoZXJpY2FsKHQpe3JldHVybiB0aGlzLnNldEZyb21TcGhlcmljYWxDb29yZHModC5yYWRpdXMsdC5waGksdC50aGV0YSl9c2V0RnJvbVNwaGVyaWNhbENvb3Jkcyh0LGUscyl7Y29uc3Qgbj1NYXRoLnNpbihlKSp0O3JldHVybiB0aGlzLng9bipNYXRoLnNpbihzKSx0aGlzLnk9TWF0aC5jb3MoZSkqdCx0aGlzLno9bipNYXRoLmNvcyhzKSx0aGlzfXNldEZyb21DeWxpbmRyaWNhbCh0KXtyZXR1cm4gdGhpcy5zZXRGcm9tQ3lsaW5kcmljYWxDb29yZHModC5yYWRpdXMsdC50aGV0YSx0LnkpfXNldEZyb21DeWxpbmRyaWNhbENvb3Jkcyh0LGUscyl7cmV0dXJuIHRoaXMueD10Kk1hdGguc2luKGUpLHRoaXMueT1zLHRoaXMuej10Kk1hdGguY29zKGUpLHRoaXN9c2V0RnJvbU1hdHJpeFBvc2l0aW9uKHQpe2NvbnN0IGU9dC5lbGVtZW50cztyZXR1cm4gdGhpcy54PWVbMTJdLHRoaXMueT1lWzEzXSx0aGlzLno9ZVsxNF0sdGhpc31zZXRGcm9tTWF0cml4U2NhbGUodCl7Y29uc3QgZT10aGlzLnNldEZyb21NYXRyaXhDb2x1bW4odCwwKS5sZW5ndGgoKSxzPXRoaXMuc2V0RnJvbU1hdHJpeENvbHVtbih0LDEpLmxlbmd0aCgpLG49dGhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKHQsMikubGVuZ3RoKCk7cmV0dXJuIHRoaXMueD1lLHRoaXMueT1zLHRoaXMuej1uLHRoaXN9c2V0RnJvbU1hdHJpeENvbHVtbih0LGUpe3JldHVybiB0aGlzLmZyb21BcnJheSh0LmVsZW1lbnRzLGUqNCl9c2V0RnJvbU1hdHJpeDNDb2x1bW4odCxlKXtyZXR1cm4gdGhpcy5mcm9tQXJyYXkodC5lbGVtZW50cyxlKjMpfXNldEZyb21FdWxlcih0KXtyZXR1cm4gdGhpcy54PXQuX3gsdGhpcy55PXQuX3ksdGhpcy56PXQuX3osdGhpc31zZXRGcm9tQ29sb3IodCl7cmV0dXJuIHRoaXMueD10LnIsdGhpcy55PXQuZyx0aGlzLno9dC5iLHRoaXN9ZXF1YWxzKHQpe3JldHVybiB0Lng9PT10aGlzLngmJnQueT09PXRoaXMueSYmdC56PT09dGhpcy56fWZyb21BcnJheSh0LGU9MCl7cmV0dXJuIHRoaXMueD10W2VdLHRoaXMueT10W2UrMV0sdGhpcy56PXRbZSsyXSx0aGlzfXRvQXJyYXkodD1bXSxlPTApe3JldHVybiB0W2VdPXRoaXMueCx0W2UrMV09dGhpcy55LHRbZSsyXT10aGlzLnosdH1mcm9tQnVmZmVyQXR0cmlidXRlKHQsZSl7cmV0dXJuIHRoaXMueD10LmdldFgoZSksdGhpcy55PXQuZ2V0WShlKSx0aGlzLno9dC5nZXRaKGUpLHRoaXN9cmFuZG9tKCl7cmV0dXJuIHRoaXMueD1NYXRoLnJhbmRvbSgpLHRoaXMueT1NYXRoLnJhbmRvbSgpLHRoaXMuej1NYXRoLnJhbmRvbSgpLHRoaXN9cmFuZG9tRGlyZWN0aW9uKCl7Y29uc3QgdD1NYXRoLnJhbmRvbSgpKk1hdGguUEkqMixlPU1hdGgucmFuZG9tKCkqMi0xLHM9TWF0aC5zcXJ0KDEtZSplKTtyZXR1cm4gdGhpcy54PXMqTWF0aC5jb3ModCksdGhpcy55PWUsdGhpcy56PXMqTWF0aC5zaW4odCksdGhpc30qW1N5bWJvbC5pdGVyYXRvcl0oKXt5aWVsZCB0aGlzLngseWllbGQgdGhpcy55LHlpZWxkIHRoaXMuen19Y29uc3QgUm49bmV3IEEsYXI9bmV3IFFlO2NsYXNzIGh0e2NvbnN0cnVjdG9yKHQ9bmV3IEEoMS8wLDEvMCwxLzApLGU9bmV3IEEoLTEvMCwtMS8wLC0xLzApKXt0aGlzLmlzQm94Mz0hMCx0aGlzLm1pbj10LHRoaXMubWF4PWV9c2V0KHQsZSl7cmV0dXJuIHRoaXMubWluLmNvcHkodCksdGhpcy5tYXguY29weShlKSx0aGlzfXNldEZyb21BcnJheSh0KXt0aGlzLm1ha2VFbXB0eSgpO2ZvcihsZXQgZT0wLHM9dC5sZW5ndGg7ZTxzO2UrPTMpdGhpcy5leHBhbmRCeVBvaW50KFJ0LmZyb21BcnJheSh0LGUpKTtyZXR1cm4gdGhpc31zZXRGcm9tQnVmZmVyQXR0cmlidXRlKHQpe3RoaXMubWFrZUVtcHR5KCk7Zm9yKGxldCBlPTAscz10LmNvdW50O2U8cztlKyspdGhpcy5leHBhbmRCeVBvaW50KFJ0LmZyb21CdWZmZXJBdHRyaWJ1dGUodCxlKSk7cmV0dXJuIHRoaXN9c2V0RnJvbVBvaW50cyh0KXt0aGlzLm1ha2VFbXB0eSgpO2ZvcihsZXQgZT0wLHM9dC5sZW5ndGg7ZTxzO2UrKyl0aGlzLmV4cGFuZEJ5UG9pbnQodFtlXSk7cmV0dXJuIHRoaXN9c2V0RnJvbUNlbnRlckFuZFNpemUodCxlKXtjb25zdCBzPVJ0LmNvcHkoZSkubXVsdGlwbHlTY2FsYXIoLjUpO3JldHVybiB0aGlzLm1pbi5jb3B5KHQpLnN1YihzKSx0aGlzLm1heC5jb3B5KHQpLmFkZChzKSx0aGlzfXNldEZyb21PYmplY3QodCxlPSExKXtyZXR1cm4gdGhpcy5tYWtlRW1wdHkoKSx0aGlzLmV4cGFuZEJ5T2JqZWN0KHQsZSl9Y2xvbmUoKXtyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KHRoaXMpfWNvcHkodCl7cmV0dXJuIHRoaXMubWluLmNvcHkodC5taW4pLHRoaXMubWF4LmNvcHkodC5tYXgpLHRoaXN9bWFrZUVtcHR5KCl7cmV0dXJuIHRoaXMubWluLng9dGhpcy5taW4ueT10aGlzLm1pbi56PTEvMCx0aGlzLm1heC54PXRoaXMubWF4Lnk9dGhpcy5tYXguej0tMS8wLHRoaXN9aXNFbXB0eSgpe3JldHVybiB0aGlzLm1heC54PHRoaXMubWluLnh8fHRoaXMubWF4Lnk8dGhpcy5taW4ueXx8dGhpcy5tYXguejx0aGlzLm1pbi56fWdldENlbnRlcih0KXtyZXR1cm4gdGhpcy5pc0VtcHR5KCk/dC5zZXQoMCwwLDApOnQuYWRkVmVjdG9ycyh0aGlzLm1pbix0aGlzLm1heCkubXVsdGlwbHlTY2FsYXIoLjUpfWdldFNpemUodCl7cmV0dXJuIHRoaXMuaXNFbXB0eSgpP3Quc2V0KDAsMCwwKTp0LnN1YlZlY3RvcnModGhpcy5tYXgsdGhpcy5taW4pfWV4cGFuZEJ5UG9pbnQodCl7cmV0dXJuIHRoaXMubWluLm1pbih0KSx0aGlzLm1heC5tYXgodCksdGhpc31leHBhbmRCeVZlY3Rvcih0KXtyZXR1cm4gdGhpcy5taW4uc3ViKHQpLHRoaXMubWF4LmFkZCh0KSx0aGlzfWV4cGFuZEJ5U2NhbGFyKHQpe3JldHVybiB0aGlzLm1pbi5hZGRTY2FsYXIoLXQpLHRoaXMubWF4LmFkZFNjYWxhcih0KSx0aGlzfWV4cGFuZEJ5T2JqZWN0KHQsZT0hMSl7dC51cGRhdGVXb3JsZE1hdHJpeCghMSwhMSk7Y29uc3Qgcz10Lmdlb21ldHJ5O2lmKHMhPT12b2lkIDApe2NvbnN0IGk9cy5nZXRBdHRyaWJ1dGUoInBvc2l0aW9uIik7aWYoZT09PSEwJiZpIT09dm9pZCAwJiZ0LmlzSW5zdGFuY2VkTWVzaCE9PSEwKWZvcihsZXQgbz0wLGE9aS5jb3VudDtvPGE7bysrKXQuaXNNZXNoPT09ITA/dC5nZXRWZXJ0ZXhQb3NpdGlvbihvLFJ0KTpSdC5mcm9tQnVmZmVyQXR0cmlidXRlKGksbyksUnQuYXBwbHlNYXRyaXg0KHQubWF0cml4V29ybGQpLHRoaXMuZXhwYW5kQnlQb2ludChSdCk7ZWxzZSB0LmJvdW5kaW5nQm94IT09dm9pZCAwPyh0LmJvdW5kaW5nQm94PT09bnVsbCYmdC5jb21wdXRlQm91bmRpbmdCb3goKSxGcy5jb3B5KHQuYm91bmRpbmdCb3gpKToocy5ib3VuZGluZ0JveD09PW51bGwmJnMuY29tcHV0ZUJvdW5kaW5nQm94KCksRnMuY29weShzLmJvdW5kaW5nQm94KSksRnMuYXBwbHlNYXRyaXg0KHQubWF0cml4V29ybGQpLHRoaXMudW5pb24oRnMpfWNvbnN0IG49dC5jaGlsZHJlbjtmb3IobGV0IGk9MCxvPW4ubGVuZ3RoO2k8bztpKyspdGhpcy5leHBhbmRCeU9iamVjdChuW2ldLGUpO3JldHVybiB0aGlzfWNvbnRhaW5zUG9pbnQodCl7cmV0dXJuIHQueD49dGhpcy5taW4ueCYmdC54PD10aGlzLm1heC54JiZ0Lnk+PXRoaXMubWluLnkmJnQueTw9dGhpcy5tYXgueSYmdC56Pj10aGlzLm1pbi56JiZ0Lno8PXRoaXMubWF4Lnp9Y29udGFpbnNCb3godCl7cmV0dXJuIHRoaXMubWluLng8PXQubWluLngmJnQubWF4Lng8PXRoaXMubWF4LngmJnRoaXMubWluLnk8PXQubWluLnkmJnQubWF4Lnk8PXRoaXMubWF4LnkmJnRoaXMubWluLno8PXQubWluLnomJnQubWF4Lno8PXRoaXMubWF4Lnp9Z2V0UGFyYW1ldGVyKHQsZSl7cmV0dXJuIGUuc2V0KCh0LngtdGhpcy5taW4ueCkvKHRoaXMubWF4LngtdGhpcy5taW4ueCksKHQueS10aGlzLm1pbi55KS8odGhpcy5tYXgueS10aGlzLm1pbi55KSwodC56LXRoaXMubWluLnopLyh0aGlzLm1heC56LXRoaXMubWluLnopKX1pbnRlcnNlY3RzQm94KHQpe3JldHVybiB0Lm1heC54Pj10aGlzLm1pbi54JiZ0Lm1pbi54PD10aGlzLm1heC54JiZ0Lm1heC55Pj10aGlzLm1pbi55JiZ0Lm1pbi55PD10aGlzLm1heC55JiZ0Lm1heC56Pj10aGlzLm1pbi56JiZ0Lm1pbi56PD10aGlzLm1heC56fWludGVyc2VjdHNTcGhlcmUodCl7cmV0dXJuIHRoaXMuY2xhbXBQb2ludCh0LmNlbnRlcixSdCksUnQuZGlzdGFuY2VUb1NxdWFyZWQodC5jZW50ZXIpPD10LnJhZGl1cyp0LnJhZGl1c31pbnRlcnNlY3RzUGxhbmUodCl7bGV0IGUscztyZXR1cm4gdC5ub3JtYWwueD4wPyhlPXQubm9ybWFsLngqdGhpcy5taW4ueCxzPXQubm9ybWFsLngqdGhpcy5tYXgueCk6KGU9dC5ub3JtYWwueCp0aGlzLm1heC54LHM9dC5ub3JtYWwueCp0aGlzLm1pbi54KSx0Lm5vcm1hbC55PjA/KGUrPXQubm9ybWFsLnkqdGhpcy5taW4ueSxzKz10Lm5vcm1hbC55KnRoaXMubWF4LnkpOihlKz10Lm5vcm1hbC55KnRoaXMubWF4Lnkscys9dC5ub3JtYWwueSp0aGlzLm1pbi55KSx0Lm5vcm1hbC56PjA/KGUrPXQubm9ybWFsLnoqdGhpcy5taW4ueixzKz10Lm5vcm1hbC56KnRoaXMubWF4LnopOihlKz10Lm5vcm1hbC56KnRoaXMubWF4Lnoscys9dC5ub3JtYWwueip0aGlzLm1pbi56KSxlPD0tdC5jb25zdGFudCYmcz49LXQuY29uc3RhbnR9aW50ZXJzZWN0c1RyaWFuZ2xlKHQpe2lmKHRoaXMuaXNFbXB0eSgpKXJldHVybiExO3RoaXMuZ2V0Q2VudGVyKEtlKSxScy5zdWJWZWN0b3JzKHRoaXMubWF4LEtlKSxOZS5zdWJWZWN0b3JzKHQuYSxLZSksd2Uuc3ViVmVjdG9ycyh0LmIsS2UpLEFlLnN1YlZlY3RvcnModC5jLEtlKSx0ZS5zdWJWZWN0b3JzKHdlLE5lKSxlZS5zdWJWZWN0b3JzKEFlLHdlKSx1ZS5zdWJWZWN0b3JzKE5lLEFlKTtsZXQgZT1bMCwtdGUueix0ZS55LDAsLWVlLnosZWUueSwwLC11ZS56LHVlLnksdGUueiwwLC10ZS54LGVlLnosMCwtZWUueCx1ZS56LDAsLXVlLngsLXRlLnksdGUueCwwLC1lZS55LGVlLngsMCwtdWUueSx1ZS54LDBdO3JldHVybiFCbihlLE5lLHdlLEFlLFJzKXx8KGU9WzEsMCwwLDAsMSwwLDAsMCwxXSwhQm4oZSxOZSx3ZSxBZSxScykpPyExOihCcy5jcm9zc1ZlY3RvcnModGUsZWUpLGU9W0JzLngsQnMueSxCcy56XSxCbihlLE5lLHdlLEFlLFJzKSl9Y2xhbXBQb2ludCh0LGUpe3JldHVybiBlLmNvcHkodCkuY2xhbXAodGhpcy5taW4sdGhpcy5tYXgpfWRpc3RhbmNlVG9Qb2ludCh0KXtyZXR1cm4gdGhpcy5jbGFtcFBvaW50KHQsUnQpLmRpc3RhbmNlVG8odCl9Z2V0Qm91bmRpbmdTcGhlcmUodCl7cmV0dXJuIHRoaXMuaXNFbXB0eSgpP3QubWFrZUVtcHR5KCk6KHRoaXMuZ2V0Q2VudGVyKHQuY2VudGVyKSx0LnJhZGl1cz10aGlzLmdldFNpemUoUnQpLmxlbmd0aCgpKi41KSx0fWludGVyc2VjdCh0KXtyZXR1cm4gdGhpcy5taW4ubWF4KHQubWluKSx0aGlzLm1heC5taW4odC5tYXgpLHRoaXMuaXNFbXB0eSgpJiZ0aGlzLm1ha2VFbXB0eSgpLHRoaXN9dW5pb24odCl7cmV0dXJuIHRoaXMubWluLm1pbih0Lm1pbiksdGhpcy5tYXgubWF4KHQubWF4KSx0aGlzfWFwcGx5TWF0cml4NCh0KXtyZXR1cm4gdGhpcy5pc0VtcHR5KCk/dGhpczooR3RbMF0uc2V0KHRoaXMubWluLngsdGhpcy5taW4ueSx0aGlzLm1pbi56KS5hcHBseU1hdHJpeDQodCksR3RbMV0uc2V0KHRoaXMubWluLngsdGhpcy5taW4ueSx0aGlzLm1heC56KS5hcHBseU1hdHJpeDQodCksR3RbMl0uc2V0KHRoaXMubWluLngsdGhpcy5tYXgueSx0aGlzLm1pbi56KS5hcHBseU1hdHJpeDQodCksR3RbM10uc2V0KHRoaXMubWluLngsdGhpcy5tYXgueSx0aGlzLm1heC56KS5hcHBseU1hdHJpeDQodCksR3RbNF0uc2V0KHRoaXMubWF4LngsdGhpcy5taW4ueSx0aGlzLm1pbi56KS5hcHBseU1hdHJpeDQodCksR3RbNV0uc2V0KHRoaXMubWF4LngsdGhpcy5taW4ueSx0aGlzLm1heC56KS5hcHBseU1hdHJpeDQodCksR3RbNl0uc2V0KHRoaXMubWF4LngsdGhpcy5tYXgueSx0aGlzLm1pbi56KS5hcHBseU1hdHJpeDQodCksR3RbN10uc2V0KHRoaXMubWF4LngsdGhpcy5tYXgueSx0aGlzLm1heC56KS5hcHBseU1hdHJpeDQodCksdGhpcy5zZXRGcm9tUG9pbnRzKEd0KSx0aGlzKX10cmFuc2xhdGUodCl7cmV0dXJuIHRoaXMubWluLmFkZCh0KSx0aGlzLm1heC5hZGQodCksdGhpc31lcXVhbHModCl7cmV0dXJuIHQubWluLmVxdWFscyh0aGlzLm1pbikmJnQubWF4LmVxdWFscyh0aGlzLm1heCl9fWNvbnN0IEd0PVtuZXcgQSxuZXcgQSxuZXcgQSxuZXcgQSxuZXcgQSxuZXcgQSxuZXcgQSxuZXcgQV0sUnQ9bmV3IEEsRnM9bmV3IGh0LE5lPW5ldyBBLHdlPW5ldyBBLEFlPW5ldyBBLHRlPW5ldyBBLGVlPW5ldyBBLHVlPW5ldyBBLEtlPW5ldyBBLFJzPW5ldyBBLEJzPW5ldyBBLGxlPW5ldyBBO2Z1bmN0aW9uIEJuKHIsdCxlLHMsbil7Zm9yKGxldCBpPTAsbz1yLmxlbmd0aC0zO2k8PW87aSs9Myl7bGUuZnJvbUFycmF5KHIsaSk7Y29uc3QgYT1uLngqTWF0aC5hYnMobGUueCkrbi55Kk1hdGguYWJzKGxlLnkpK24ueipNYXRoLmFicyhsZS56KSxjPXQuZG90KGxlKSx1PWUuZG90KGxlKSxoPXMuZG90KGxlKTtpZihNYXRoLm1heCgtTWF0aC5tYXgoYyx1LGgpLE1hdGgubWluKGMsdSxoKSk+YSlyZXR1cm4hMX1yZXR1cm4hMH1jb25zdCBhYT1uZXcgaHQsdHM9bmV3IEEsSW49bmV3IEE7Y2xhc3MgY3J7Y29uc3RydWN0b3IodD1uZXcgQSxlPS0xKXt0aGlzLmlzU3BoZXJlPSEwLHRoaXMuY2VudGVyPXQsdGhpcy5yYWRpdXM9ZX1zZXQodCxlKXtyZXR1cm4gdGhpcy5jZW50ZXIuY29weSh0KSx0aGlzLnJhZGl1cz1lLHRoaXN9c2V0RnJvbVBvaW50cyh0LGUpe2NvbnN0IHM9dGhpcy5jZW50ZXI7ZSE9PXZvaWQgMD9zLmNvcHkoZSk6YWEuc2V0RnJvbVBvaW50cyh0KS5nZXRDZW50ZXIocyk7bGV0IG49MDtmb3IobGV0IGk9MCxvPXQubGVuZ3RoO2k8bztpKyspbj1NYXRoLm1heChuLHMuZGlzdGFuY2VUb1NxdWFyZWQodFtpXSkpO3JldHVybiB0aGlzLnJhZGl1cz1NYXRoLnNxcnQobiksdGhpc31jb3B5KHQpe3JldHVybiB0aGlzLmNlbnRlci5jb3B5KHQuY2VudGVyKSx0aGlzLnJhZGl1cz10LnJhZGl1cyx0aGlzfWlzRW1wdHkoKXtyZXR1cm4gdGhpcy5yYWRpdXM8MH1tYWtlRW1wdHkoKXtyZXR1cm4gdGhpcy5jZW50ZXIuc2V0KDAsMCwwKSx0aGlzLnJhZGl1cz0tMSx0aGlzfWNvbnRhaW5zUG9pbnQodCl7cmV0dXJuIHQuZGlzdGFuY2VUb1NxdWFyZWQodGhpcy5jZW50ZXIpPD10aGlzLnJhZGl1cyp0aGlzLnJhZGl1c31kaXN0YW5jZVRvUG9pbnQodCl7cmV0dXJuIHQuZGlzdGFuY2VUbyh0aGlzLmNlbnRlciktdGhpcy5yYWRpdXN9aW50ZXJzZWN0c1NwaGVyZSh0KXtjb25zdCBlPXRoaXMucmFkaXVzK3QucmFkaXVzO3JldHVybiB0LmNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCh0aGlzLmNlbnRlcik8PWUqZX1pbnRlcnNlY3RzQm94KHQpe3JldHVybiB0LmludGVyc2VjdHNTcGhlcmUodGhpcyl9aW50ZXJzZWN0c1BsYW5lKHQpe3JldHVybiBNYXRoLmFicyh0LmRpc3RhbmNlVG9Qb2ludCh0aGlzLmNlbnRlcikpPD10aGlzLnJhZGl1c31jbGFtcFBvaW50KHQsZSl7Y29uc3Qgcz10aGlzLmNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCh0KTtyZXR1cm4gZS5jb3B5KHQpLHM+dGhpcy5yYWRpdXMqdGhpcy5yYWRpdXMmJihlLnN1Yih0aGlzLmNlbnRlcikubm9ybWFsaXplKCksZS5tdWx0aXBseVNjYWxhcih0aGlzLnJhZGl1cykuYWRkKHRoaXMuY2VudGVyKSksZX1nZXRCb3VuZGluZ0JveCh0KXtyZXR1cm4gdGhpcy5pc0VtcHR5KCk/KHQubWFrZUVtcHR5KCksdCk6KHQuc2V0KHRoaXMuY2VudGVyLHRoaXMuY2VudGVyKSx0LmV4cGFuZEJ5U2NhbGFyKHRoaXMucmFkaXVzKSx0KX1hcHBseU1hdHJpeDQodCl7cmV0dXJuIHRoaXMuY2VudGVyLmFwcGx5TWF0cml4NCh0KSx0aGlzLnJhZGl1cz10aGlzLnJhZGl1cyp0LmdldE1heFNjYWxlT25BeGlzKCksdGhpc310cmFuc2xhdGUodCl7cmV0dXJuIHRoaXMuY2VudGVyLmFkZCh0KSx0aGlzfWV4cGFuZEJ5UG9pbnQodCl7aWYodGhpcy5pc0VtcHR5KCkpcmV0dXJuIHRoaXMuY2VudGVyLmNvcHkodCksdGhpcy5yYWRpdXM9MCx0aGlzO3RzLnN1YlZlY3RvcnModCx0aGlzLmNlbnRlcik7Y29uc3QgZT10cy5sZW5ndGhTcSgpO2lmKGU+dGhpcy5yYWRpdXMqdGhpcy5yYWRpdXMpe2NvbnN0IHM9TWF0aC5zcXJ0KGUpLG49KHMtdGhpcy5yYWRpdXMpKi41O3RoaXMuY2VudGVyLmFkZFNjYWxlZFZlY3Rvcih0cyxuL3MpLHRoaXMucmFkaXVzKz1ufXJldHVybiB0aGlzfXVuaW9uKHQpe3JldHVybiB0LmlzRW1wdHkoKT90aGlzOnRoaXMuaXNFbXB0eSgpPyh0aGlzLmNvcHkodCksdGhpcyk6KHRoaXMuY2VudGVyLmVxdWFscyh0LmNlbnRlcik9PT0hMD90aGlzLnJhZGl1cz1NYXRoLm1heCh0aGlzLnJhZGl1cyx0LnJhZGl1cyk6KEluLnN1YlZlY3RvcnModC5jZW50ZXIsdGhpcy5jZW50ZXIpLnNldExlbmd0aCh0LnJhZGl1cyksdGhpcy5leHBhbmRCeVBvaW50KHRzLmNvcHkodC5jZW50ZXIpLmFkZChJbikpLHRoaXMuZXhwYW5kQnlQb2ludCh0cy5jb3B5KHQuY2VudGVyKS5zdWIoSW4pKSksdGhpcyl9ZXF1YWxzKHQpe3JldHVybiB0LmNlbnRlci5lcXVhbHModGhpcy5jZW50ZXIpJiZ0LnJhZGl1cz09PXRoaXMucmFkaXVzfWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSh0aGlzKX19Y2xhc3MgbnR7Y29uc3RydWN0b3IodCxlLHMsbixpLG8sYSxjLHUsaCxsLGQsZixwLG0sZyl7bnQucHJvdG90eXBlLmlzTWF0cml4ND0hMCx0aGlzLmVsZW1lbnRzPVsxLDAsMCwwLDAsMSwwLDAsMCwwLDEsMCwwLDAsMCwxXSx0IT09dm9pZCAwJiZ0aGlzLnNldCh0LGUscyxuLGksbyxhLGMsdSxoLGwsZCxmLHAsbSxnKX1zZXQodCxlLHMsbixpLG8sYSxjLHUsaCxsLGQsZixwLG0sZyl7Y29uc3QgeT10aGlzLmVsZW1lbnRzO3JldHVybiB5WzBdPXQseVs0XT1lLHlbOF09cyx5WzEyXT1uLHlbMV09aSx5WzVdPW8seVs5XT1hLHlbMTNdPWMseVsyXT11LHlbNl09aCx5WzEwXT1sLHlbMTRdPWQseVszXT1mLHlbN109cCx5WzExXT1tLHlbMTVdPWcsdGhpc31pZGVudGl0eSgpe3JldHVybiB0aGlzLnNldCgxLDAsMCwwLDAsMSwwLDAsMCwwLDEsMCwwLDAsMCwxKSx0aGlzfWNsb25lKCl7cmV0dXJuIG5ldyBudCgpLmZyb21BcnJheSh0aGlzLmVsZW1lbnRzKX1jb3B5KHQpe2NvbnN0IGU9dGhpcy5lbGVtZW50cyxzPXQuZWxlbWVudHM7cmV0dXJuIGVbMF09c1swXSxlWzFdPXNbMV0sZVsyXT1zWzJdLGVbM109c1szXSxlWzRdPXNbNF0sZVs1XT1zWzVdLGVbNl09c1s2XSxlWzddPXNbN10sZVs4XT1zWzhdLGVbOV09c1s5XSxlWzEwXT1zWzEwXSxlWzExXT1zWzExXSxlWzEyXT1zWzEyXSxlWzEzXT1zWzEzXSxlWzE0XT1zWzE0XSxlWzE1XT1zWzE1XSx0aGlzfWNvcHlQb3NpdGlvbih0KXtjb25zdCBlPXRoaXMuZWxlbWVudHMscz10LmVsZW1lbnRzO3JldHVybiBlWzEyXT1zWzEyXSxlWzEzXT1zWzEzXSxlWzE0XT1zWzE0XSx0aGlzfXNldEZyb21NYXRyaXgzKHQpe2NvbnN0IGU9dC5lbGVtZW50cztyZXR1cm4gdGhpcy5zZXQoZVswXSxlWzNdLGVbNl0sMCxlWzFdLGVbNF0sZVs3XSwwLGVbMl0sZVs1XSxlWzhdLDAsMCwwLDAsMSksdGhpc31leHRyYWN0QmFzaXModCxlLHMpe3JldHVybiB0LnNldEZyb21NYXRyaXhDb2x1bW4odGhpcywwKSxlLnNldEZyb21NYXRyaXhDb2x1bW4odGhpcywxKSxzLnNldEZyb21NYXRyaXhDb2x1bW4odGhpcywyKSx0aGlzfW1ha2VCYXNpcyh0LGUscyl7cmV0dXJuIHRoaXMuc2V0KHQueCxlLngscy54LDAsdC55LGUueSxzLnksMCx0LnosZS56LHMueiwwLDAsMCwwLDEpLHRoaXN9ZXh0cmFjdFJvdGF0aW9uKHQpe2NvbnN0IGU9dGhpcy5lbGVtZW50cyxzPXQuZWxlbWVudHMsbj0xL01lLnNldEZyb21NYXRyaXhDb2x1bW4odCwwKS5sZW5ndGgoKSxpPTEvTWUuc2V0RnJvbU1hdHJpeENvbHVtbih0LDEpLmxlbmd0aCgpLG89MS9NZS5zZXRGcm9tTWF0cml4Q29sdW1uKHQsMikubGVuZ3RoKCk7cmV0dXJuIGVbMF09c1swXSpuLGVbMV09c1sxXSpuLGVbMl09c1syXSpuLGVbM109MCxlWzRdPXNbNF0qaSxlWzVdPXNbNV0qaSxlWzZdPXNbNl0qaSxlWzddPTAsZVs4XT1zWzhdKm8sZVs5XT1zWzldKm8sZVsxMF09c1sxMF0qbyxlWzExXT0wLGVbMTJdPTAsZVsxM109MCxlWzE0XT0wLGVbMTVdPTEsdGhpc31tYWtlUm90YXRpb25Gcm9tRXVsZXIodCl7Y29uc3QgZT10aGlzLmVsZW1lbnRzLHM9dC54LG49dC55LGk9dC56LG89TWF0aC5jb3MocyksYT1NYXRoLnNpbihzKSxjPU1hdGguY29zKG4pLHU9TWF0aC5zaW4obiksaD1NYXRoLmNvcyhpKSxsPU1hdGguc2luKGkpO2lmKHQub3JkZXI9PT0iWFlaIil7Y29uc3QgZD1vKmgsZj1vKmwscD1hKmgsbT1hKmw7ZVswXT1jKmgsZVs0XT0tYypsLGVbOF09dSxlWzFdPWYrcCp1LGVbNV09ZC1tKnUsZVs5XT0tYSpjLGVbMl09bS1kKnUsZVs2XT1wK2YqdSxlWzEwXT1vKmN9ZWxzZSBpZih0Lm9yZGVyPT09IllYWiIpe2NvbnN0IGQ9YypoLGY9YypsLHA9dSpoLG09dSpsO2VbMF09ZCttKmEsZVs0XT1wKmEtZixlWzhdPW8qdSxlWzFdPW8qbCxlWzVdPW8qaCxlWzldPS1hLGVbMl09ZiphLXAsZVs2XT1tK2QqYSxlWzEwXT1vKmN9ZWxzZSBpZih0Lm9yZGVyPT09IlpYWSIpe2NvbnN0IGQ9YypoLGY9YypsLHA9dSpoLG09dSpsO2VbMF09ZC1tKmEsZVs0XT0tbypsLGVbOF09cCtmKmEsZVsxXT1mK3AqYSxlWzVdPW8qaCxlWzldPW0tZCphLGVbMl09LW8qdSxlWzZdPWEsZVsxMF09bypjfWVsc2UgaWYodC5vcmRlcj09PSJaWVgiKXtjb25zdCBkPW8qaCxmPW8qbCxwPWEqaCxtPWEqbDtlWzBdPWMqaCxlWzRdPXAqdS1mLGVbOF09ZCp1K20sZVsxXT1jKmwsZVs1XT1tKnUrZCxlWzldPWYqdS1wLGVbMl09LXUsZVs2XT1hKmMsZVsxMF09bypjfWVsc2UgaWYodC5vcmRlcj09PSJZWlgiKXtjb25zdCBkPW8qYyxmPW8qdSxwPWEqYyxtPWEqdTtlWzBdPWMqaCxlWzRdPW0tZCpsLGVbOF09cCpsK2YsZVsxXT1sLGVbNV09bypoLGVbOV09LWEqaCxlWzJdPS11KmgsZVs2XT1mKmwrcCxlWzEwXT1kLW0qbH1lbHNlIGlmKHQub3JkZXI9PT0iWFpZIil7Y29uc3QgZD1vKmMsZj1vKnUscD1hKmMsbT1hKnU7ZVswXT1jKmgsZVs0XT0tbCxlWzhdPXUqaCxlWzFdPWQqbCttLGVbNV09bypoLGVbOV09ZipsLXAsZVsyXT1wKmwtZixlWzZdPWEqaCxlWzEwXT1tKmwrZH1yZXR1cm4gZVszXT0wLGVbN109MCxlWzExXT0wLGVbMTJdPTAsZVsxM109MCxlWzE0XT0wLGVbMTVdPTEsdGhpc31tYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbih0KXtyZXR1cm4gdGhpcy5jb21wb3NlKGNhLHQsaGEpfWxvb2tBdCh0LGUscyl7Y29uc3Qgbj10aGlzLmVsZW1lbnRzO3JldHVybiB5dC5zdWJWZWN0b3JzKHQsZSkseXQubGVuZ3RoU3EoKT09PTAmJih5dC56PTEpLHl0Lm5vcm1hbGl6ZSgpLHNlLmNyb3NzVmVjdG9ycyhzLHl0KSxzZS5sZW5ndGhTcSgpPT09MCYmKE1hdGguYWJzKHMueik9PT0xP3l0LngrPTFlLTQ6eXQueis9MWUtNCx5dC5ub3JtYWxpemUoKSxzZS5jcm9zc1ZlY3RvcnMocyx5dCkpLHNlLm5vcm1hbGl6ZSgpLElzLmNyb3NzVmVjdG9ycyh5dCxzZSksblswXT1zZS54LG5bNF09SXMueCxuWzhdPXl0LngsblsxXT1zZS55LG5bNV09SXMueSxuWzldPXl0LnksblsyXT1zZS56LG5bNl09SXMueixuWzEwXT15dC56LHRoaXN9bXVsdGlwbHkodCl7cmV0dXJuIHRoaXMubXVsdGlwbHlNYXRyaWNlcyh0aGlzLHQpfXByZW11bHRpcGx5KHQpe3JldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXModCx0aGlzKX1tdWx0aXBseU1hdHJpY2VzKHQsZSl7Y29uc3Qgcz10LmVsZW1lbnRzLG49ZS5lbGVtZW50cyxpPXRoaXMuZWxlbWVudHMsbz1zWzBdLGE9c1s0XSxjPXNbOF0sdT1zWzEyXSxoPXNbMV0sbD1zWzVdLGQ9c1s5XSxmPXNbMTNdLHA9c1syXSxtPXNbNl0sZz1zWzEwXSx5PXNbMTRdLFQ9c1szXSx3PXNbN10sTT1zWzExXSxOPXNbMTVdLF89blswXSxTPW5bNF0sRT1uWzhdLEY9blsxMl0sUj1uWzFdLEk9bls1XSxCPW5bOV0sUD1uWzEzXSxMPW5bMl0sVj1uWzZdLEc9blsxMF0sTnQ9blsxNF0sSHQ9blszXSxxdD1uWzddLE5uPW5bMTFdLHduPW5bMTVdO3JldHVybiBpWzBdPW8qXythKlIrYypMK3UqSHQsaVs0XT1vKlMrYSpJK2MqVit1KnF0LGlbOF09bypFK2EqQitjKkcrdSpObixpWzEyXT1vKkYrYSpQK2MqTnQrdSp3bixpWzFdPWgqXytsKlIrZCpMK2YqSHQsaVs1XT1oKlMrbCpJK2QqVitmKnF0LGlbOV09aCpFK2wqQitkKkcrZipObixpWzEzXT1oKkYrbCpQK2QqTnQrZip3bixpWzJdPXAqXyttKlIrZypMK3kqSHQsaVs2XT1wKlMrbSpJK2cqVit5KnF0LGlbMTBdPXAqRSttKkIrZypHK3kqTm4saVsxNF09cCpGK20qUCtnKk50K3kqd24saVszXT1UKl8rdypSK00qTCtOKkh0LGlbN109VCpTK3cqSStNKlYrTipxdCxpWzExXT1UKkUrdypCK00qRytOKk5uLGlbMTVdPVQqRit3KlArTSpOdCtOKnduLHRoaXN9bXVsdGlwbHlTY2FsYXIodCl7Y29uc3QgZT10aGlzLmVsZW1lbnRzO3JldHVybiBlWzBdKj10LGVbNF0qPXQsZVs4XSo9dCxlWzEyXSo9dCxlWzFdKj10LGVbNV0qPXQsZVs5XSo9dCxlWzEzXSo9dCxlWzJdKj10LGVbNl0qPXQsZVsxMF0qPXQsZVsxNF0qPXQsZVszXSo9dCxlWzddKj10LGVbMTFdKj10LGVbMTVdKj10LHRoaXN9ZGV0ZXJtaW5hbnQoKXtjb25zdCB0PXRoaXMuZWxlbWVudHMsZT10WzBdLHM9dFs0XSxuPXRbOF0saT10WzEyXSxvPXRbMV0sYT10WzVdLGM9dFs5XSx1PXRbMTNdLGg9dFsyXSxsPXRbNl0sZD10WzEwXSxmPXRbMTRdLHA9dFszXSxtPXRbN10sZz10WzExXSx5PXRbMTVdO3JldHVybiBwKigraSpjKmwtbip1KmwtaSphKmQrcyp1KmQrbiphKmYtcypjKmYpK20qKCtlKmMqZi1lKnUqZCtpKm8qZC1uKm8qZituKnUqaC1pKmMqaCkrZyooK2UqdSpsLWUqYSpmLWkqbypsK3MqbypmK2kqYSpoLXMqdSpoKSt5KigtbiphKmgtZSpjKmwrZSphKmQrbipvKmwtcypvKmQrcypjKmgpfXRyYW5zcG9zZSgpe2NvbnN0IHQ9dGhpcy5lbGVtZW50cztsZXQgZTtyZXR1cm4gZT10WzFdLHRbMV09dFs0XSx0WzRdPWUsZT10WzJdLHRbMl09dFs4XSx0WzhdPWUsZT10WzZdLHRbNl09dFs5XSx0WzldPWUsZT10WzNdLHRbM109dFsxMl0sdFsxMl09ZSxlPXRbN10sdFs3XT10WzEzXSx0WzEzXT1lLGU9dFsxMV0sdFsxMV09dFsxNF0sdFsxNF09ZSx0aGlzfXNldFBvc2l0aW9uKHQsZSxzKXtjb25zdCBuPXRoaXMuZWxlbWVudHM7cmV0dXJuIHQuaXNWZWN0b3IzPyhuWzEyXT10LngsblsxM109dC55LG5bMTRdPXQueik6KG5bMTJdPXQsblsxM109ZSxuWzE0XT1zKSx0aGlzfWludmVydCgpe2NvbnN0IHQ9dGhpcy5lbGVtZW50cyxlPXRbMF0scz10WzFdLG49dFsyXSxpPXRbM10sbz10WzRdLGE9dFs1XSxjPXRbNl0sdT10WzddLGg9dFs4XSxsPXRbOV0sZD10WzEwXSxmPXRbMTFdLHA9dFsxMl0sbT10WzEzXSxnPXRbMTRdLHk9dFsxNV0sVD1sKmcqdS1tKmQqdSttKmMqZi1hKmcqZi1sKmMqeSthKmQqeSx3PXAqZCp1LWgqZyp1LXAqYypmK28qZypmK2gqYyp5LW8qZCp5LE09aCptKnUtcCpsKnUrcCphKmYtbyptKmYtaCphKnkrbypsKnksTj1wKmwqYy1oKm0qYy1wKmEqZCtvKm0qZCtoKmEqZy1vKmwqZyxfPWUqVCtzKncrbipNK2kqTjtpZihfPT09MClyZXR1cm4gdGhpcy5zZXQoMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCk7Y29uc3QgUz0xL187cmV0dXJuIHRbMF09VCpTLHRbMV09KG0qZCppLWwqZyppLW0qbipmK3MqZypmK2wqbip5LXMqZCp5KSpTLHRbMl09KGEqZyppLW0qYyppK20qbip1LXMqZyp1LWEqbip5K3MqYyp5KSpTLHRbM109KGwqYyppLWEqZCppLWwqbip1K3MqZCp1K2EqbipmLXMqYypmKSpTLHRbNF09dypTLHRbNV09KGgqZyppLXAqZCppK3AqbipmLWUqZypmLWgqbip5K2UqZCp5KSpTLHRbNl09KHAqYyppLW8qZyppLXAqbip1K2UqZyp1K28qbip5LWUqYyp5KSpTLHRbN109KG8qZCppLWgqYyppK2gqbip1LWUqZCp1LW8qbipmK2UqYypmKSpTLHRbOF09TSpTLHRbOV09KHAqbCppLWgqbSppLXAqcypmK2UqbSpmK2gqcyp5LWUqbCp5KSpTLHRbMTBdPShvKm0qaS1wKmEqaStwKnMqdS1lKm0qdS1vKnMqeStlKmEqeSkqUyx0WzExXT0oaCphKmktbypsKmktaCpzKnUrZSpsKnUrbypzKmYtZSphKmYpKlMsdFsxMl09TipTLHRbMTNdPShoKm0qbi1wKmwqbitwKnMqZC1lKm0qZC1oKnMqZytlKmwqZykqUyx0WzE0XT0ocCphKm4tbyptKm4tcCpzKmMrZSptKmMrbypzKmctZSphKmcpKlMsdFsxNV09KG8qbCpuLWgqYSpuK2gqcypjLWUqbCpjLW8qcypkK2UqYSpkKSpTLHRoaXN9c2NhbGUodCl7Y29uc3QgZT10aGlzLmVsZW1lbnRzLHM9dC54LG49dC55LGk9dC56O3JldHVybiBlWzBdKj1zLGVbNF0qPW4sZVs4XSo9aSxlWzFdKj1zLGVbNV0qPW4sZVs5XSo9aSxlWzJdKj1zLGVbNl0qPW4sZVsxMF0qPWksZVszXSo9cyxlWzddKj1uLGVbMTFdKj1pLHRoaXN9Z2V0TWF4U2NhbGVPbkF4aXMoKXtjb25zdCB0PXRoaXMuZWxlbWVudHMsZT10WzBdKnRbMF0rdFsxXSp0WzFdK3RbMl0qdFsyXSxzPXRbNF0qdFs0XSt0WzVdKnRbNV0rdFs2XSp0WzZdLG49dFs4XSp0WzhdK3RbOV0qdFs5XSt0WzEwXSp0WzEwXTtyZXR1cm4gTWF0aC5zcXJ0KE1hdGgubWF4KGUscyxuKSl9bWFrZVRyYW5zbGF0aW9uKHQsZSxzKXtyZXR1cm4gdC5pc1ZlY3RvcjM/dGhpcy5zZXQoMSwwLDAsdC54LDAsMSwwLHQueSwwLDAsMSx0LnosMCwwLDAsMSk6dGhpcy5zZXQoMSwwLDAsdCwwLDEsMCxlLDAsMCwxLHMsMCwwLDAsMSksdGhpc31tYWtlUm90YXRpb25YKHQpe2NvbnN0IGU9TWF0aC5jb3ModCkscz1NYXRoLnNpbih0KTtyZXR1cm4gdGhpcy5zZXQoMSwwLDAsMCwwLGUsLXMsMCwwLHMsZSwwLDAsMCwwLDEpLHRoaXN9bWFrZVJvdGF0aW9uWSh0KXtjb25zdCBlPU1hdGguY29zKHQpLHM9TWF0aC5zaW4odCk7cmV0dXJuIHRoaXMuc2V0KGUsMCxzLDAsMCwxLDAsMCwtcywwLGUsMCwwLDAsMCwxKSx0aGlzfW1ha2VSb3RhdGlvbloodCl7Y29uc3QgZT1NYXRoLmNvcyh0KSxzPU1hdGguc2luKHQpO3JldHVybiB0aGlzLnNldChlLC1zLDAsMCxzLGUsMCwwLDAsMCwxLDAsMCwwLDAsMSksdGhpc31tYWtlUm90YXRpb25BeGlzKHQsZSl7Y29uc3Qgcz1NYXRoLmNvcyhlKSxuPU1hdGguc2luKGUpLGk9MS1zLG89dC54LGE9dC55LGM9dC56LHU9aSpvLGg9aSphO3JldHVybiB0aGlzLnNldCh1Km8rcyx1KmEtbipjLHUqYytuKmEsMCx1KmErbipjLGgqYStzLGgqYy1uKm8sMCx1KmMtbiphLGgqYytuKm8saSpjKmMrcywwLDAsMCwwLDEpLHRoaXN9bWFrZVNjYWxlKHQsZSxzKXtyZXR1cm4gdGhpcy5zZXQodCwwLDAsMCwwLGUsMCwwLDAsMCxzLDAsMCwwLDAsMSksdGhpc31tYWtlU2hlYXIodCxlLHMsbixpLG8pe3JldHVybiB0aGlzLnNldCgxLHMsaSwwLHQsMSxvLDAsZSxuLDEsMCwwLDAsMCwxKSx0aGlzfWNvbXBvc2UodCxlLHMpe2NvbnN0IG49dGhpcy5lbGVtZW50cyxpPWUuX3gsbz1lLl95LGE9ZS5feixjPWUuX3csdT1pK2ksaD1vK28sbD1hK2EsZD1pKnUsZj1pKmgscD1pKmwsbT1vKmgsZz1vKmwseT1hKmwsVD1jKnUsdz1jKmgsTT1jKmwsTj1zLngsXz1zLnksUz1zLno7cmV0dXJuIG5bMF09KDEtKG0reSkpKk4sblsxXT0oZitNKSpOLG5bMl09KHAtdykqTixuWzNdPTAsbls0XT0oZi1NKSpfLG5bNV09KDEtKGQreSkpKl8sbls2XT0oZytUKSpfLG5bN109MCxuWzhdPShwK3cpKlMsbls5XT0oZy1UKSpTLG5bMTBdPSgxLShkK20pKSpTLG5bMTFdPTAsblsxMl09dC54LG5bMTNdPXQueSxuWzE0XT10LnosblsxNV09MSx0aGlzfWRlY29tcG9zZSh0LGUscyl7Y29uc3Qgbj10aGlzLmVsZW1lbnRzO2xldCBpPU1lLnNldChuWzBdLG5bMV0sblsyXSkubGVuZ3RoKCk7Y29uc3Qgbz1NZS5zZXQobls0XSxuWzVdLG5bNl0pLmxlbmd0aCgpLGE9TWUuc2V0KG5bOF0sbls5XSxuWzEwXSkubGVuZ3RoKCk7dGhpcy5kZXRlcm1pbmFudCgpPDAmJihpPS1pKSx0Lng9blsxMl0sdC55PW5bMTNdLHQuej1uWzE0XSxCdC5jb3B5KHRoaXMpO2NvbnN0IHU9MS9pLGg9MS9vLGw9MS9hO3JldHVybiBCdC5lbGVtZW50c1swXSo9dSxCdC5lbGVtZW50c1sxXSo9dSxCdC5lbGVtZW50c1syXSo9dSxCdC5lbGVtZW50c1s0XSo9aCxCdC5lbGVtZW50c1s1XSo9aCxCdC5lbGVtZW50c1s2XSo9aCxCdC5lbGVtZW50c1s4XSo9bCxCdC5lbGVtZW50c1s5XSo9bCxCdC5lbGVtZW50c1sxMF0qPWwsZS5zZXRGcm9tUm90YXRpb25NYXRyaXgoQnQpLHMueD1pLHMueT1vLHMuej1hLHRoaXN9bWFrZVBlcnNwZWN0aXZlKHQsZSxzLG4saSxvLGE9WWUpe2NvbnN0IGM9dGhpcy5lbGVtZW50cyx1PTIqaS8oZS10KSxoPTIqaS8ocy1uKSxsPShlK3QpLyhlLXQpLGQ9KHMrbikvKHMtbik7bGV0IGYscDtpZihhPT09WWUpZj0tKG8raSkvKG8taSkscD0tMipvKmkvKG8taSk7ZWxzZSBpZihhPT09em4pZj0tby8oby1pKSxwPS1vKmkvKG8taSk7ZWxzZSB0aHJvdyBuZXcgRXJyb3IoIlRIUkVFLk1hdHJpeDQubWFrZVBlcnNwZWN0aXZlKCk6IEludmFsaWQgY29vcmRpbmF0ZSBzeXN0ZW06ICIrYSk7cmV0dXJuIGNbMF09dSxjWzRdPTAsY1s4XT1sLGNbMTJdPTAsY1sxXT0wLGNbNV09aCxjWzldPWQsY1sxM109MCxjWzJdPTAsY1s2XT0wLGNbMTBdPWYsY1sxNF09cCxjWzNdPTAsY1s3XT0wLGNbMTFdPS0xLGNbMTVdPTAsdGhpc31tYWtlT3J0aG9ncmFwaGljKHQsZSxzLG4saSxvLGE9WWUpe2NvbnN0IGM9dGhpcy5lbGVtZW50cyx1PTEvKGUtdCksaD0xLyhzLW4pLGw9MS8oby1pKSxkPShlK3QpKnUsZj0ocytuKSpoO2xldCBwLG07aWYoYT09PVllKXA9KG8raSkqbCxtPS0yKmw7ZWxzZSBpZihhPT09em4pcD1pKmwsbT0tMSpsO2Vsc2UgdGhyb3cgbmV3IEVycm9yKCJUSFJFRS5NYXRyaXg0Lm1ha2VPcnRob2dyYXBoaWMoKTogSW52YWxpZCBjb29yZGluYXRlIHN5c3RlbTogIithKTtyZXR1cm4gY1swXT0yKnUsY1s0XT0wLGNbOF09MCxjWzEyXT0tZCxjWzFdPTAsY1s1XT0yKmgsY1s5XT0wLGNbMTNdPS1mLGNbMl09MCxjWzZdPTAsY1sxMF09bSxjWzE0XT0tcCxjWzNdPTAsY1s3XT0wLGNbMTFdPTAsY1sxNV09MSx0aGlzfWVxdWFscyh0KXtjb25zdCBlPXRoaXMuZWxlbWVudHMscz10LmVsZW1lbnRzO2ZvcihsZXQgbj0wO248MTY7bisrKWlmKGVbbl0hPT1zW25dKXJldHVybiExO3JldHVybiEwfWZyb21BcnJheSh0LGU9MCl7Zm9yKGxldCBzPTA7czwxNjtzKyspdGhpcy5lbGVtZW50c1tzXT10W3MrZV07cmV0dXJuIHRoaXN9dG9BcnJheSh0PVtdLGU9MCl7Y29uc3Qgcz10aGlzLmVsZW1lbnRzO3JldHVybiB0W2VdPXNbMF0sdFtlKzFdPXNbMV0sdFtlKzJdPXNbMl0sdFtlKzNdPXNbM10sdFtlKzRdPXNbNF0sdFtlKzVdPXNbNV0sdFtlKzZdPXNbNl0sdFtlKzddPXNbN10sdFtlKzhdPXNbOF0sdFtlKzldPXNbOV0sdFtlKzEwXT1zWzEwXSx0W2UrMTFdPXNbMTFdLHRbZSsxMl09c1sxMl0sdFtlKzEzXT1zWzEzXSx0W2UrMTRdPXNbMTRdLHRbZSsxNV09c1sxNV0sdH19Y29uc3QgTWU9bmV3IEEsQnQ9bmV3IG50LGNhPW5ldyBBKDAsMCwwKSxoYT1uZXcgQSgxLDEsMSksc2U9bmV3IEEsSXM9bmV3IEEseXQ9bmV3IEEsaHI9bmV3IG50LHVyPW5ldyBRZTtjbGFzcyB2c3tjb25zdHJ1Y3Rvcih0PTAsZT0wLHM9MCxuPXZzLkRFRkFVTFRfT1JERVIpe3RoaXMuaXNFdWxlcj0hMCx0aGlzLl94PXQsdGhpcy5feT1lLHRoaXMuX3o9cyx0aGlzLl9vcmRlcj1ufWdldCB4KCl7cmV0dXJuIHRoaXMuX3h9c2V0IHgodCl7dGhpcy5feD10LHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKX1nZXQgeSgpe3JldHVybiB0aGlzLl95fXNldCB5KHQpe3RoaXMuX3k9dCx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCl9Z2V0IHooKXtyZXR1cm4gdGhpcy5fen1zZXQgeih0KXt0aGlzLl96PXQsdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpfWdldCBvcmRlcigpe3JldHVybiB0aGlzLl9vcmRlcn1zZXQgb3JkZXIodCl7dGhpcy5fb3JkZXI9dCx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCl9c2V0KHQsZSxzLG49dGhpcy5fb3JkZXIpe3JldHVybiB0aGlzLl94PXQsdGhpcy5feT1lLHRoaXMuX3o9cyx0aGlzLl9vcmRlcj1uLHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMuX3gsdGhpcy5feSx0aGlzLl96LHRoaXMuX29yZGVyKX1jb3B5KHQpe3JldHVybiB0aGlzLl94PXQuX3gsdGhpcy5feT10Ll95LHRoaXMuX3o9dC5feix0aGlzLl9vcmRlcj10Ll9vcmRlcix0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCksdGhpc31zZXRGcm9tUm90YXRpb25NYXRyaXgodCxlPXRoaXMuX29yZGVyLHM9ITApe2NvbnN0IG49dC5lbGVtZW50cyxpPW5bMF0sbz1uWzRdLGE9bls4XSxjPW5bMV0sdT1uWzVdLGg9bls5XSxsPW5bMl0sZD1uWzZdLGY9blsxMF07c3dpdGNoKGUpe2Nhc2UiWFlaIjp0aGlzLl95PU1hdGguYXNpbihhdChhLC0xLDEpKSxNYXRoLmFicyhhKTwuOTk5OTk5OT8odGhpcy5feD1NYXRoLmF0YW4yKC1oLGYpLHRoaXMuX3o9TWF0aC5hdGFuMigtbyxpKSk6KHRoaXMuX3g9TWF0aC5hdGFuMihkLHUpLHRoaXMuX3o9MCk7YnJlYWs7Y2FzZSJZWFoiOnRoaXMuX3g9TWF0aC5hc2luKC1hdChoLC0xLDEpKSxNYXRoLmFicyhoKTwuOTk5OTk5OT8odGhpcy5feT1NYXRoLmF0YW4yKGEsZiksdGhpcy5fej1NYXRoLmF0YW4yKGMsdSkpOih0aGlzLl95PU1hdGguYXRhbjIoLWwsaSksdGhpcy5fej0wKTticmVhaztjYXNlIlpYWSI6dGhpcy5feD1NYXRoLmFzaW4oYXQoZCwtMSwxKSksTWF0aC5hYnMoZCk8Ljk5OTk5OTk/KHRoaXMuX3k9TWF0aC5hdGFuMigtbCxmKSx0aGlzLl96PU1hdGguYXRhbjIoLW8sdSkpOih0aGlzLl95PTAsdGhpcy5fej1NYXRoLmF0YW4yKGMsaSkpO2JyZWFrO2Nhc2UiWllYIjp0aGlzLl95PU1hdGguYXNpbigtYXQobCwtMSwxKSksTWF0aC5hYnMobCk8Ljk5OTk5OTk/KHRoaXMuX3g9TWF0aC5hdGFuMihkLGYpLHRoaXMuX3o9TWF0aC5hdGFuMihjLGkpKToodGhpcy5feD0wLHRoaXMuX3o9TWF0aC5hdGFuMigtbyx1KSk7YnJlYWs7Y2FzZSJZWlgiOnRoaXMuX3o9TWF0aC5hc2luKGF0KGMsLTEsMSkpLE1hdGguYWJzKGMpPC45OTk5OTk5Pyh0aGlzLl94PU1hdGguYXRhbjIoLWgsdSksdGhpcy5feT1NYXRoLmF0YW4yKC1sLGkpKToodGhpcy5feD0wLHRoaXMuX3k9TWF0aC5hdGFuMihhLGYpKTticmVhaztjYXNlIlhaWSI6dGhpcy5fej1NYXRoLmFzaW4oLWF0KG8sLTEsMSkpLE1hdGguYWJzKG8pPC45OTk5OTk5Pyh0aGlzLl94PU1hdGguYXRhbjIoZCx1KSx0aGlzLl95PU1hdGguYXRhbjIoYSxpKSk6KHRoaXMuX3g9TWF0aC5hdGFuMigtaCxmKSx0aGlzLl95PTApO2JyZWFrO2RlZmF1bHQ6Y29uc29sZS53YXJuKCJUSFJFRS5FdWxlcjogLnNldEZyb21Sb3RhdGlvbk1hdHJpeCgpIGVuY291bnRlcmVkIGFuIHVua25vd24gb3JkZXI6ICIrZSl9cmV0dXJuIHRoaXMuX29yZGVyPWUscz09PSEwJiZ0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCksdGhpc31zZXRGcm9tUXVhdGVybmlvbih0LGUscyl7cmV0dXJuIGhyLm1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKHQpLHRoaXMuc2V0RnJvbVJvdGF0aW9uTWF0cml4KGhyLGUscyl9c2V0RnJvbVZlY3RvcjModCxlPXRoaXMuX29yZGVyKXtyZXR1cm4gdGhpcy5zZXQodC54LHQueSx0LnosZSl9cmVvcmRlcih0KXtyZXR1cm4gdXIuc2V0RnJvbUV1bGVyKHRoaXMpLHRoaXMuc2V0RnJvbVF1YXRlcm5pb24odXIsdCl9ZXF1YWxzKHQpe3JldHVybiB0Ll94PT09dGhpcy5feCYmdC5feT09PXRoaXMuX3kmJnQuX3o9PT10aGlzLl96JiZ0Ll9vcmRlcj09PXRoaXMuX29yZGVyfWZyb21BcnJheSh0KXtyZXR1cm4gdGhpcy5feD10WzBdLHRoaXMuX3k9dFsxXSx0aGlzLl96PXRbMl0sdFszXSE9PXZvaWQgMCYmKHRoaXMuX29yZGVyPXRbM10pLHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfXRvQXJyYXkodD1bXSxlPTApe3JldHVybiB0W2VdPXRoaXMuX3gsdFtlKzFdPXRoaXMuX3ksdFtlKzJdPXRoaXMuX3osdFtlKzNdPXRoaXMuX29yZGVyLHR9X29uQ2hhbmdlKHQpe3JldHVybiB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrPXQsdGhpc31fb25DaGFuZ2VDYWxsYmFjaygpe30qW1N5bWJvbC5pdGVyYXRvcl0oKXt5aWVsZCB0aGlzLl94LHlpZWxkIHRoaXMuX3kseWllbGQgdGhpcy5feix5aWVsZCB0aGlzLl9vcmRlcn19dnMuREVGQVVMVF9PUkRFUj0iWFlaIjtjbGFzcyB1YXtjb25zdHJ1Y3Rvcigpe3RoaXMubWFzaz0xfXNldCh0KXt0aGlzLm1hc2s9KDE8PHR8MCk+Pj4wfWVuYWJsZSh0KXt0aGlzLm1hc2t8PTE8PHR8MH1lbmFibGVBbGwoKXt0aGlzLm1hc2s9LTF9dG9nZ2xlKHQpe3RoaXMubWFza149MTw8dHwwfWRpc2FibGUodCl7dGhpcy5tYXNrJj1+KDE8PHR8MCl9ZGlzYWJsZUFsbCgpe3RoaXMubWFzaz0wfXRlc3QodCl7cmV0dXJuKHRoaXMubWFzayZ0Lm1hc2spIT09MH1pc0VuYWJsZWQodCl7cmV0dXJuKHRoaXMubWFzayYoMTw8dHwwKSkhPT0wfX1sZXQgbGE9MDtjb25zdCBscj1uZXcgQSxTZT1uZXcgUWUsV3Q9bmV3IG50LFBzPW5ldyBBLGVzPW5ldyBBLGRhPW5ldyBBLGZhPW5ldyBRZSxkcj1uZXcgQSgxLDAsMCksZnI9bmV3IEEoMCwxLDApLHByPW5ldyBBKDAsMCwxKSxtcj17dHlwZToiYWRkZWQifSxwYT17dHlwZToicmVtb3ZlZCJ9LF9lPXt0eXBlOiJjaGlsZGFkZGVkIixjaGlsZDpudWxsfSx2bj17dHlwZToiY2hpbGRyZW1vdmVkIixjaGlsZDpudWxsfTtjbGFzcyBuZSBleHRlbmRzIFple2NvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLmlzT2JqZWN0M0Q9ITAsT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsImlkIix7dmFsdWU6bGErK30pLHRoaXMudXVpZD1LdCgpLHRoaXMubmFtZT0iIix0aGlzLnR5cGU9Ik9iamVjdDNEIix0aGlzLnBhcmVudD1udWxsLHRoaXMuY2hpbGRyZW49W10sdGhpcy51cD1uZS5ERUZBVUxUX1VQLmNsb25lKCk7Y29uc3QgdD1uZXcgQSxlPW5ldyB2cyxzPW5ldyBRZSxuPW5ldyBBKDEsMSwxKTtmdW5jdGlvbiBpKCl7cy5zZXRGcm9tRXVsZXIoZSwhMSl9ZnVuY3Rpb24gbygpe2Uuc2V0RnJvbVF1YXRlcm5pb24ocyx2b2lkIDAsITEpfWUuX29uQ2hhbmdlKGkpLHMuX29uQ2hhbmdlKG8pLE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMse3Bvc2l0aW9uOntjb25maWd1cmFibGU6ITAsZW51bWVyYWJsZTohMCx2YWx1ZTp0fSxyb3RhdGlvbjp7Y29uZmlndXJhYmxlOiEwLGVudW1lcmFibGU6ITAsdmFsdWU6ZX0scXVhdGVybmlvbjp7Y29uZmlndXJhYmxlOiEwLGVudW1lcmFibGU6ITAsdmFsdWU6c30sc2NhbGU6e2NvbmZpZ3VyYWJsZTohMCxlbnVtZXJhYmxlOiEwLHZhbHVlOm59LG1vZGVsVmlld01hdHJpeDp7dmFsdWU6bmV3IG50fSxub3JtYWxNYXRyaXg6e3ZhbHVlOm5ldyBDdH19KSx0aGlzLm1hdHJpeD1uZXcgbnQsdGhpcy5tYXRyaXhXb3JsZD1uZXcgbnQsdGhpcy5tYXRyaXhBdXRvVXBkYXRlPW5lLkRFRkFVTFRfTUFUUklYX0FVVE9fVVBEQVRFLHRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlPW5lLkRFRkFVTFRfTUFUUklYX1dPUkxEX0FVVE9fVVBEQVRFLHRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZT0hMSx0aGlzLmxheWVycz1uZXcgdWEsdGhpcy52aXNpYmxlPSEwLHRoaXMuY2FzdFNoYWRvdz0hMSx0aGlzLnJlY2VpdmVTaGFkb3c9ITEsdGhpcy5mcnVzdHVtQ3VsbGVkPSEwLHRoaXMucmVuZGVyT3JkZXI9MCx0aGlzLmFuaW1hdGlvbnM9W10sdGhpcy51c2VyRGF0YT17fX1vbkJlZm9yZVNoYWRvdygpe31vbkFmdGVyU2hhZG93KCl7fW9uQmVmb3JlUmVuZGVyKCl7fW9uQWZ0ZXJSZW5kZXIoKXt9YXBwbHlNYXRyaXg0KHQpe3RoaXMubWF0cml4QXV0b1VwZGF0ZSYmdGhpcy51cGRhdGVNYXRyaXgoKSx0aGlzLm1hdHJpeC5wcmVtdWx0aXBseSh0KSx0aGlzLm1hdHJpeC5kZWNvbXBvc2UodGhpcy5wb3NpdGlvbix0aGlzLnF1YXRlcm5pb24sdGhpcy5zY2FsZSl9YXBwbHlRdWF0ZXJuaW9uKHQpe3JldHVybiB0aGlzLnF1YXRlcm5pb24ucHJlbXVsdGlwbHkodCksdGhpc31zZXRSb3RhdGlvbkZyb21BeGlzQW5nbGUodCxlKXt0aGlzLnF1YXRlcm5pb24uc2V0RnJvbUF4aXNBbmdsZSh0LGUpfXNldFJvdGF0aW9uRnJvbUV1bGVyKHQpe3RoaXMucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIodCwhMCl9c2V0Um90YXRpb25Gcm9tTWF0cml4KHQpe3RoaXMucXVhdGVybmlvbi5zZXRGcm9tUm90YXRpb25NYXRyaXgodCl9c2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0KXt0aGlzLnF1YXRlcm5pb24uY29weSh0KX1yb3RhdGVPbkF4aXModCxlKXtyZXR1cm4gU2Uuc2V0RnJvbUF4aXNBbmdsZSh0LGUpLHRoaXMucXVhdGVybmlvbi5tdWx0aXBseShTZSksdGhpc31yb3RhdGVPbldvcmxkQXhpcyh0LGUpe3JldHVybiBTZS5zZXRGcm9tQXhpc0FuZ2xlKHQsZSksdGhpcy5xdWF0ZXJuaW9uLnByZW11bHRpcGx5KFNlKSx0aGlzfXJvdGF0ZVgodCl7cmV0dXJuIHRoaXMucm90YXRlT25BeGlzKGRyLHQpfXJvdGF0ZVkodCl7cmV0dXJuIHRoaXMucm90YXRlT25BeGlzKGZyLHQpfXJvdGF0ZVoodCl7cmV0dXJuIHRoaXMucm90YXRlT25BeGlzKHByLHQpfXRyYW5zbGF0ZU9uQXhpcyh0LGUpe3JldHVybiBsci5jb3B5KHQpLmFwcGx5UXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pLHRoaXMucG9zaXRpb24uYWRkKGxyLm11bHRpcGx5U2NhbGFyKGUpKSx0aGlzfXRyYW5zbGF0ZVgodCl7cmV0dXJuIHRoaXMudHJhbnNsYXRlT25BeGlzKGRyLHQpfXRyYW5zbGF0ZVkodCl7cmV0dXJuIHRoaXMudHJhbnNsYXRlT25BeGlzKGZyLHQpfXRyYW5zbGF0ZVoodCl7cmV0dXJuIHRoaXMudHJhbnNsYXRlT25BeGlzKHByLHQpfWxvY2FsVG9Xb3JsZCh0KXtyZXR1cm4gdGhpcy51cGRhdGVXb3JsZE1hdHJpeCghMCwhMSksdC5hcHBseU1hdHJpeDQodGhpcy5tYXRyaXhXb3JsZCl9d29ybGRUb0xvY2FsKHQpe3JldHVybiB0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCEwLCExKSx0LmFwcGx5TWF0cml4NChXdC5jb3B5KHRoaXMubWF0cml4V29ybGQpLmludmVydCgpKX1sb29rQXQodCxlLHMpe3QuaXNWZWN0b3IzP1BzLmNvcHkodCk6UHMuc2V0KHQsZSxzKTtjb25zdCBuPXRoaXMucGFyZW50O3RoaXMudXBkYXRlV29ybGRNYXRyaXgoITAsITEpLGVzLnNldEZyb21NYXRyaXhQb3NpdGlvbih0aGlzLm1hdHJpeFdvcmxkKSx0aGlzLmlzQ2FtZXJhfHx0aGlzLmlzTGlnaHQ/V3QubG9va0F0KGVzLFBzLHRoaXMudXApOld0Lmxvb2tBdChQcyxlcyx0aGlzLnVwKSx0aGlzLnF1YXRlcm5pb24uc2V0RnJvbVJvdGF0aW9uTWF0cml4KFd0KSxuJiYoV3QuZXh0cmFjdFJvdGF0aW9uKG4ubWF0cml4V29ybGQpLFNlLnNldEZyb21Sb3RhdGlvbk1hdHJpeChXdCksdGhpcy5xdWF0ZXJuaW9uLnByZW11bHRpcGx5KFNlLmludmVydCgpKSl9YWRkKHQpe2lmKGFyZ3VtZW50cy5sZW5ndGg+MSl7Zm9yKGxldCBlPTA7ZTxhcmd1bWVudHMubGVuZ3RoO2UrKyl0aGlzLmFkZChhcmd1bWVudHNbZV0pO3JldHVybiB0aGlzfXJldHVybiB0PT09dGhpcz8oY29uc29sZS5lcnJvcigiVEhSRUUuT2JqZWN0M0QuYWRkOiBvYmplY3QgY2FuJ3QgYmUgYWRkZWQgYXMgYSBjaGlsZCBvZiBpdHNlbGYuIix0KSx0aGlzKToodCYmdC5pc09iamVjdDNEPyh0LnJlbW92ZUZyb21QYXJlbnQoKSx0LnBhcmVudD10aGlzLHRoaXMuY2hpbGRyZW4ucHVzaCh0KSx0LmRpc3BhdGNoRXZlbnQobXIpLF9lLmNoaWxkPXQsdGhpcy5kaXNwYXRjaEV2ZW50KF9lKSxfZS5jaGlsZD1udWxsKTpjb25zb2xlLmVycm9yKCJUSFJFRS5PYmplY3QzRC5hZGQ6IG9iamVjdCBub3QgYW4gaW5zdGFuY2Ugb2YgVEhSRUUuT2JqZWN0M0QuIix0KSx0aGlzKX1yZW1vdmUodCl7aWYoYXJndW1lbnRzLmxlbmd0aD4xKXtmb3IobGV0IHM9MDtzPGFyZ3VtZW50cy5sZW5ndGg7cysrKXRoaXMucmVtb3ZlKGFyZ3VtZW50c1tzXSk7cmV0dXJuIHRoaXN9Y29uc3QgZT10aGlzLmNoaWxkcmVuLmluZGV4T2YodCk7cmV0dXJuIGUhPT0tMSYmKHQucGFyZW50PW51bGwsdGhpcy5jaGlsZHJlbi5zcGxpY2UoZSwxKSx0LmRpc3BhdGNoRXZlbnQocGEpLHZuLmNoaWxkPXQsdGhpcy5kaXNwYXRjaEV2ZW50KHZuKSx2bi5jaGlsZD1udWxsKSx0aGlzfXJlbW92ZUZyb21QYXJlbnQoKXtjb25zdCB0PXRoaXMucGFyZW50O3JldHVybiB0IT09bnVsbCYmdC5yZW1vdmUodGhpcyksdGhpc31jbGVhcigpe3JldHVybiB0aGlzLnJlbW92ZSguLi50aGlzLmNoaWxkcmVuKX1hdHRhY2godCl7cmV0dXJuIHRoaXMudXBkYXRlV29ybGRNYXRyaXgoITAsITEpLFd0LmNvcHkodGhpcy5tYXRyaXhXb3JsZCkuaW52ZXJ0KCksdC5wYXJlbnQhPT1udWxsJiYodC5wYXJlbnQudXBkYXRlV29ybGRNYXRyaXgoITAsITEpLFd0Lm11bHRpcGx5KHQucGFyZW50Lm1hdHJpeFdvcmxkKSksdC5hcHBseU1hdHJpeDQoV3QpLHQucmVtb3ZlRnJvbVBhcmVudCgpLHQucGFyZW50PXRoaXMsdGhpcy5jaGlsZHJlbi5wdXNoKHQpLHQudXBkYXRlV29ybGRNYXRyaXgoITEsITApLHQuZGlzcGF0Y2hFdmVudChtciksX2UuY2hpbGQ9dCx0aGlzLmRpc3BhdGNoRXZlbnQoX2UpLF9lLmNoaWxkPW51bGwsdGhpc31nZXRPYmplY3RCeUlkKHQpe3JldHVybiB0aGlzLmdldE9iamVjdEJ5UHJvcGVydHkoImlkIix0KX1nZXRPYmplY3RCeU5hbWUodCl7cmV0dXJuIHRoaXMuZ2V0T2JqZWN0QnlQcm9wZXJ0eSgibmFtZSIsdCl9Z2V0T2JqZWN0QnlQcm9wZXJ0eSh0LGUpe2lmKHRoaXNbdF09PT1lKXJldHVybiB0aGlzO2ZvcihsZXQgcz0wLG49dGhpcy5jaGlsZHJlbi5sZW5ndGg7czxuO3MrKyl7Y29uc3Qgbz10aGlzLmNoaWxkcmVuW3NdLmdldE9iamVjdEJ5UHJvcGVydHkodCxlKTtpZihvIT09dm9pZCAwKXJldHVybiBvfX1nZXRPYmplY3RzQnlQcm9wZXJ0eSh0LGUscz1bXSl7dGhpc1t0XT09PWUmJnMucHVzaCh0aGlzKTtjb25zdCBuPXRoaXMuY2hpbGRyZW47Zm9yKGxldCBpPTAsbz1uLmxlbmd0aDtpPG87aSsrKW5baV0uZ2V0T2JqZWN0c0J5UHJvcGVydHkodCxlLHMpO3JldHVybiBzfWdldFdvcmxkUG9zaXRpb24odCl7cmV0dXJuIHRoaXMudXBkYXRlV29ybGRNYXRyaXgoITAsITEpLHQuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKHRoaXMubWF0cml4V29ybGQpfWdldFdvcmxkUXVhdGVybmlvbih0KXtyZXR1cm4gdGhpcy51cGRhdGVXb3JsZE1hdHJpeCghMCwhMSksdGhpcy5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoZXMsdCxkYSksdH1nZXRXb3JsZFNjYWxlKHQpe3JldHVybiB0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCEwLCExKSx0aGlzLm1hdHJpeFdvcmxkLmRlY29tcG9zZShlcyxmYSx0KSx0fWdldFdvcmxkRGlyZWN0aW9uKHQpe3RoaXMudXBkYXRlV29ybGRNYXRyaXgoITAsITEpO2NvbnN0IGU9dGhpcy5tYXRyaXhXb3JsZC5lbGVtZW50cztyZXR1cm4gdC5zZXQoZVs4XSxlWzldLGVbMTBdKS5ub3JtYWxpemUoKX1yYXljYXN0KCl7fXRyYXZlcnNlKHQpe3QodGhpcyk7Y29uc3QgZT10aGlzLmNoaWxkcmVuO2ZvcihsZXQgcz0wLG49ZS5sZW5ndGg7czxuO3MrKyllW3NdLnRyYXZlcnNlKHQpfXRyYXZlcnNlVmlzaWJsZSh0KXtpZih0aGlzLnZpc2libGU9PT0hMSlyZXR1cm47dCh0aGlzKTtjb25zdCBlPXRoaXMuY2hpbGRyZW47Zm9yKGxldCBzPTAsbj1lLmxlbmd0aDtzPG47cysrKWVbc10udHJhdmVyc2VWaXNpYmxlKHQpfXRyYXZlcnNlQW5jZXN0b3JzKHQpe2NvbnN0IGU9dGhpcy5wYXJlbnQ7ZSE9PW51bGwmJih0KGUpLGUudHJhdmVyc2VBbmNlc3RvcnModCkpfXVwZGF0ZU1hdHJpeCgpe3RoaXMubWF0cml4LmNvbXBvc2UodGhpcy5wb3NpdGlvbix0aGlzLnF1YXRlcm5pb24sdGhpcy5zY2FsZSksdGhpcy5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlPSEwfXVwZGF0ZU1hdHJpeFdvcmxkKHQpe3RoaXMubWF0cml4QXV0b1VwZGF0ZSYmdGhpcy51cGRhdGVNYXRyaXgoKSwodGhpcy5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlfHx0KSYmKHRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlPT09ITAmJih0aGlzLnBhcmVudD09PW51bGw/dGhpcy5tYXRyaXhXb3JsZC5jb3B5KHRoaXMubWF0cml4KTp0aGlzLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXModGhpcy5wYXJlbnQubWF0cml4V29ybGQsdGhpcy5tYXRyaXgpKSx0aGlzLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGU9ITEsdD0hMCk7Y29uc3QgZT10aGlzLmNoaWxkcmVuO2ZvcihsZXQgcz0wLG49ZS5sZW5ndGg7czxuO3MrKyllW3NdLnVwZGF0ZU1hdHJpeFdvcmxkKHQpfXVwZGF0ZVdvcmxkTWF0cml4KHQsZSl7Y29uc3Qgcz10aGlzLnBhcmVudDtpZih0PT09ITAmJnMhPT1udWxsJiZzLnVwZGF0ZVdvcmxkTWF0cml4KCEwLCExKSx0aGlzLm1hdHJpeEF1dG9VcGRhdGUmJnRoaXMudXBkYXRlTWF0cml4KCksdGhpcy5tYXRyaXhXb3JsZEF1dG9VcGRhdGU9PT0hMCYmKHRoaXMucGFyZW50PT09bnVsbD90aGlzLm1hdHJpeFdvcmxkLmNvcHkodGhpcy5tYXRyaXgpOnRoaXMubWF0cml4V29ybGQubXVsdGlwbHlNYXRyaWNlcyh0aGlzLnBhcmVudC5tYXRyaXhXb3JsZCx0aGlzLm1hdHJpeCkpLGU9PT0hMCl7Y29uc3Qgbj10aGlzLmNoaWxkcmVuO2ZvcihsZXQgaT0wLG89bi5sZW5ndGg7aTxvO2krKyluW2ldLnVwZGF0ZVdvcmxkTWF0cml4KCExLCEwKX19dG9KU09OKHQpe2NvbnN0IGU9dD09PXZvaWQgMHx8dHlwZW9mIHQ9PSJzdHJpbmciLHM9e307ZSYmKHQ9e2dlb21ldHJpZXM6e30sbWF0ZXJpYWxzOnt9LHRleHR1cmVzOnt9LGltYWdlczp7fSxzaGFwZXM6e30sc2tlbGV0b25zOnt9LGFuaW1hdGlvbnM6e30sbm9kZXM6e319LHMubWV0YWRhdGE9e3ZlcnNpb246NC42LHR5cGU6Ik9iamVjdCIsZ2VuZXJhdG9yOiJPYmplY3QzRC50b0pTT04ifSk7Y29uc3Qgbj17fTtuLnV1aWQ9dGhpcy51dWlkLG4udHlwZT10aGlzLnR5cGUsdGhpcy5uYW1lIT09IiImJihuLm5hbWU9dGhpcy5uYW1lKSx0aGlzLmNhc3RTaGFkb3c9PT0hMCYmKG4uY2FzdFNoYWRvdz0hMCksdGhpcy5yZWNlaXZlU2hhZG93PT09ITAmJihuLnJlY2VpdmVTaGFkb3c9ITApLHRoaXMudmlzaWJsZT09PSExJiYobi52aXNpYmxlPSExKSx0aGlzLmZydXN0dW1DdWxsZWQ9PT0hMSYmKG4uZnJ1c3R1bUN1bGxlZD0hMSksdGhpcy5yZW5kZXJPcmRlciE9PTAmJihuLnJlbmRlck9yZGVyPXRoaXMucmVuZGVyT3JkZXIpLE9iamVjdC5rZXlzKHRoaXMudXNlckRhdGEpLmxlbmd0aD4wJiYobi51c2VyRGF0YT10aGlzLnVzZXJEYXRhKSxuLmxheWVycz10aGlzLmxheWVycy5tYXNrLG4ubWF0cml4PXRoaXMubWF0cml4LnRvQXJyYXkoKSxuLnVwPXRoaXMudXAudG9BcnJheSgpLHRoaXMubWF0cml4QXV0b1VwZGF0ZT09PSExJiYobi5tYXRyaXhBdXRvVXBkYXRlPSExKSx0aGlzLmlzSW5zdGFuY2VkTWVzaCYmKG4udHlwZT0iSW5zdGFuY2VkTWVzaCIsbi5jb3VudD10aGlzLmNvdW50LG4uaW5zdGFuY2VNYXRyaXg9dGhpcy5pbnN0YW5jZU1hdHJpeC50b0pTT04oKSx0aGlzLmluc3RhbmNlQ29sb3IhPT1udWxsJiYobi5pbnN0YW5jZUNvbG9yPXRoaXMuaW5zdGFuY2VDb2xvci50b0pTT04oKSkpLHRoaXMuaXNCYXRjaGVkTWVzaCYmKG4udHlwZT0iQmF0Y2hlZE1lc2giLG4ucGVyT2JqZWN0RnJ1c3R1bUN1bGxlZD10aGlzLnBlck9iamVjdEZydXN0dW1DdWxsZWQsbi5zb3J0T2JqZWN0cz10aGlzLnNvcnRPYmplY3RzLG4uZHJhd1Jhbmdlcz10aGlzLl9kcmF3UmFuZ2VzLG4ucmVzZXJ2ZWRSYW5nZXM9dGhpcy5fcmVzZXJ2ZWRSYW5nZXMsbi52aXNpYmlsaXR5PXRoaXMuX3Zpc2liaWxpdHksbi5hY3RpdmU9dGhpcy5fYWN0aXZlLG4uYm91bmRzPXRoaXMuX2JvdW5kcy5tYXAoYT0+KHtib3hJbml0aWFsaXplZDphLmJveEluaXRpYWxpemVkLGJveE1pbjphLmJveC5taW4udG9BcnJheSgpLGJveE1heDphLmJveC5tYXgudG9BcnJheSgpLHNwaGVyZUluaXRpYWxpemVkOmEuc3BoZXJlSW5pdGlhbGl6ZWQsc3BoZXJlUmFkaXVzOmEuc3BoZXJlLnJhZGl1cyxzcGhlcmVDZW50ZXI6YS5zcGhlcmUuY2VudGVyLnRvQXJyYXkoKX0pKSxuLm1heEluc3RhbmNlQ291bnQ9dGhpcy5fbWF4SW5zdGFuY2VDb3VudCxuLm1heFZlcnRleENvdW50PXRoaXMuX21heFZlcnRleENvdW50LG4ubWF4SW5kZXhDb3VudD10aGlzLl9tYXhJbmRleENvdW50LG4uZ2VvbWV0cnlJbml0aWFsaXplZD10aGlzLl9nZW9tZXRyeUluaXRpYWxpemVkLG4uZ2VvbWV0cnlDb3VudD10aGlzLl9nZW9tZXRyeUNvdW50LG4ubWF0cmljZXNUZXh0dXJlPXRoaXMuX21hdHJpY2VzVGV4dHVyZS50b0pTT04odCksdGhpcy5fY29sb3JzVGV4dHVyZSE9PW51bGwmJihuLmNvbG9yc1RleHR1cmU9dGhpcy5fY29sb3JzVGV4dHVyZS50b0pTT04odCkpLHRoaXMuYm91bmRpbmdTcGhlcmUhPT1udWxsJiYobi5ib3VuZGluZ1NwaGVyZT17Y2VudGVyOm4uYm91bmRpbmdTcGhlcmUuY2VudGVyLnRvQXJyYXkoKSxyYWRpdXM6bi5ib3VuZGluZ1NwaGVyZS5yYWRpdXN9KSx0aGlzLmJvdW5kaW5nQm94IT09bnVsbCYmKG4uYm91bmRpbmdCb3g9e21pbjpuLmJvdW5kaW5nQm94Lm1pbi50b0FycmF5KCksbWF4Om4uYm91bmRpbmdCb3gubWF4LnRvQXJyYXkoKX0pKTtmdW5jdGlvbiBpKGEsYyl7cmV0dXJuIGFbYy51dWlkXT09PXZvaWQgMCYmKGFbYy51dWlkXT1jLnRvSlNPTih0KSksYy51dWlkfWlmKHRoaXMuaXNTY2VuZSl0aGlzLmJhY2tncm91bmQmJih0aGlzLmJhY2tncm91bmQuaXNDb2xvcj9uLmJhY2tncm91bmQ9dGhpcy5iYWNrZ3JvdW5kLnRvSlNPTigpOnRoaXMuYmFja2dyb3VuZC5pc1RleHR1cmUmJihuLmJhY2tncm91bmQ9dGhpcy5iYWNrZ3JvdW5kLnRvSlNPTih0KS51dWlkKSksdGhpcy5lbnZpcm9ubWVudCYmdGhpcy5lbnZpcm9ubWVudC5pc1RleHR1cmUmJnRoaXMuZW52aXJvbm1lbnQuaXNSZW5kZXJUYXJnZXRUZXh0dXJlIT09ITAmJihuLmVudmlyb25tZW50PXRoaXMuZW52aXJvbm1lbnQudG9KU09OKHQpLnV1aWQpO2Vsc2UgaWYodGhpcy5pc01lc2h8fHRoaXMuaXNMaW5lfHx0aGlzLmlzUG9pbnRzKXtuLmdlb21ldHJ5PWkodC5nZW9tZXRyaWVzLHRoaXMuZ2VvbWV0cnkpO2NvbnN0IGE9dGhpcy5nZW9tZXRyeS5wYXJhbWV0ZXJzO2lmKGEhPT12b2lkIDAmJmEuc2hhcGVzIT09dm9pZCAwKXtjb25zdCBjPWEuc2hhcGVzO2lmKEFycmF5LmlzQXJyYXkoYykpZm9yKGxldCB1PTAsaD1jLmxlbmd0aDt1PGg7dSsrKXtjb25zdCBsPWNbdV07aSh0LnNoYXBlcyxsKX1lbHNlIGkodC5zaGFwZXMsYyl9fWlmKHRoaXMuaXNTa2lubmVkTWVzaCYmKG4uYmluZE1vZGU9dGhpcy5iaW5kTW9kZSxuLmJpbmRNYXRyaXg9dGhpcy5iaW5kTWF0cml4LnRvQXJyYXkoKSx0aGlzLnNrZWxldG9uIT09dm9pZCAwJiYoaSh0LnNrZWxldG9ucyx0aGlzLnNrZWxldG9uKSxuLnNrZWxldG9uPXRoaXMuc2tlbGV0b24udXVpZCkpLHRoaXMubWF0ZXJpYWwhPT12b2lkIDApaWYoQXJyYXkuaXNBcnJheSh0aGlzLm1hdGVyaWFsKSl7Y29uc3QgYT1bXTtmb3IobGV0IGM9MCx1PXRoaXMubWF0ZXJpYWwubGVuZ3RoO2M8dTtjKyspYS5wdXNoKGkodC5tYXRlcmlhbHMsdGhpcy5tYXRlcmlhbFtjXSkpO24ubWF0ZXJpYWw9YX1lbHNlIG4ubWF0ZXJpYWw9aSh0Lm1hdGVyaWFscyx0aGlzLm1hdGVyaWFsKTtpZih0aGlzLmNoaWxkcmVuLmxlbmd0aD4wKXtuLmNoaWxkcmVuPVtdO2ZvcihsZXQgYT0wO2E8dGhpcy5jaGlsZHJlbi5sZW5ndGg7YSsrKW4uY2hpbGRyZW4ucHVzaCh0aGlzLmNoaWxkcmVuW2FdLnRvSlNPTih0KS5vYmplY3QpfWlmKHRoaXMuYW5pbWF0aW9ucy5sZW5ndGg+MCl7bi5hbmltYXRpb25zPVtdO2ZvcihsZXQgYT0wO2E8dGhpcy5hbmltYXRpb25zLmxlbmd0aDthKyspe2NvbnN0IGM9dGhpcy5hbmltYXRpb25zW2FdO24uYW5pbWF0aW9ucy5wdXNoKGkodC5hbmltYXRpb25zLGMpKX19aWYoZSl7Y29uc3QgYT1vKHQuZ2VvbWV0cmllcyksYz1vKHQubWF0ZXJpYWxzKSx1PW8odC50ZXh0dXJlcyksaD1vKHQuaW1hZ2VzKSxsPW8odC5zaGFwZXMpLGQ9byh0LnNrZWxldG9ucyksZj1vKHQuYW5pbWF0aW9ucykscD1vKHQubm9kZXMpO2EubGVuZ3RoPjAmJihzLmdlb21ldHJpZXM9YSksYy5sZW5ndGg+MCYmKHMubWF0ZXJpYWxzPWMpLHUubGVuZ3RoPjAmJihzLnRleHR1cmVzPXUpLGgubGVuZ3RoPjAmJihzLmltYWdlcz1oKSxsLmxlbmd0aD4wJiYocy5zaGFwZXM9bCksZC5sZW5ndGg+MCYmKHMuc2tlbGV0b25zPWQpLGYubGVuZ3RoPjAmJihzLmFuaW1hdGlvbnM9ZikscC5sZW5ndGg+MCYmKHMubm9kZXM9cCl9cmV0dXJuIHMub2JqZWN0PW4scztmdW5jdGlvbiBvKGEpe2NvbnN0IGM9W107Zm9yKGNvbnN0IHUgaW4gYSl7Y29uc3QgaD1hW3VdO2RlbGV0ZSBoLm1ldGFkYXRhLGMucHVzaChoKX1yZXR1cm4gY319Y2xvbmUodCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSh0aGlzLHQpfWNvcHkodCxlPSEwKXtpZih0aGlzLm5hbWU9dC5uYW1lLHRoaXMudXAuY29weSh0LnVwKSx0aGlzLnBvc2l0aW9uLmNvcHkodC5wb3NpdGlvbiksdGhpcy5yb3RhdGlvbi5vcmRlcj10LnJvdGF0aW9uLm9yZGVyLHRoaXMucXVhdGVybmlvbi5jb3B5KHQucXVhdGVybmlvbiksdGhpcy5zY2FsZS5jb3B5KHQuc2NhbGUpLHRoaXMubWF0cml4LmNvcHkodC5tYXRyaXgpLHRoaXMubWF0cml4V29ybGQuY29weSh0Lm1hdHJpeFdvcmxkKSx0aGlzLm1hdHJpeEF1dG9VcGRhdGU9dC5tYXRyaXhBdXRvVXBkYXRlLHRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlPXQubWF0cml4V29ybGRBdXRvVXBkYXRlLHRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZT10Lm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUsdGhpcy5sYXllcnMubWFzaz10LmxheWVycy5tYXNrLHRoaXMudmlzaWJsZT10LnZpc2libGUsdGhpcy5jYXN0U2hhZG93PXQuY2FzdFNoYWRvdyx0aGlzLnJlY2VpdmVTaGFkb3c9dC5yZWNlaXZlU2hhZG93LHRoaXMuZnJ1c3R1bUN1bGxlZD10LmZydXN0dW1DdWxsZWQsdGhpcy5yZW5kZXJPcmRlcj10LnJlbmRlck9yZGVyLHRoaXMuYW5pbWF0aW9ucz10LmFuaW1hdGlvbnMuc2xpY2UoKSx0aGlzLnVzZXJEYXRhPUpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodC51c2VyRGF0YSkpLGU9PT0hMClmb3IobGV0IHM9MDtzPHQuY2hpbGRyZW4ubGVuZ3RoO3MrKyl7Y29uc3Qgbj10LmNoaWxkcmVuW3NdO3RoaXMuYWRkKG4uY2xvbmUoKSl9cmV0dXJuIHRoaXN9fW5lLkRFRkFVTFRfVVA9bmV3IEEoMCwxLDApLG5lLkRFRkFVTFRfTUFUUklYX0FVVE9fVVBEQVRFPSEwLG5lLkRFRkFVTFRfTUFUUklYX1dPUkxEX0FVVE9fVVBEQVRFPSEwO2NvbnN0IEl0PW5ldyBBLFh0PW5ldyBBLFBuPW5ldyBBLFl0PW5ldyBBLHplPW5ldyBBLGJlPW5ldyBBLHlyPW5ldyBBLExuPW5ldyBBLE9uPW5ldyBBLERuPW5ldyBBLFZuPW5ldyBGdCxVbj1uZXcgRnQsa249bmV3IEZ0O2NsYXNzIHd0e2NvbnN0cnVjdG9yKHQ9bmV3IEEsZT1uZXcgQSxzPW5ldyBBKXt0aGlzLmE9dCx0aGlzLmI9ZSx0aGlzLmM9c31zdGF0aWMgZ2V0Tm9ybWFsKHQsZSxzLG4pe24uc3ViVmVjdG9ycyhzLGUpLEl0LnN1YlZlY3RvcnModCxlKSxuLmNyb3NzKEl0KTtjb25zdCBpPW4ubGVuZ3RoU3EoKTtyZXR1cm4gaT4wP24ubXVsdGlwbHlTY2FsYXIoMS9NYXRoLnNxcnQoaSkpOm4uc2V0KDAsMCwwKX1zdGF0aWMgZ2V0QmFyeWNvb3JkKHQsZSxzLG4saSl7SXQuc3ViVmVjdG9ycyhuLGUpLFh0LnN1YlZlY3RvcnMocyxlKSxQbi5zdWJWZWN0b3JzKHQsZSk7Y29uc3Qgbz1JdC5kb3QoSXQpLGE9SXQuZG90KFh0KSxjPUl0LmRvdChQbiksdT1YdC5kb3QoWHQpLGg9WHQuZG90KFBuKSxsPW8qdS1hKmE7aWYobD09PTApcmV0dXJuIGkuc2V0KDAsMCwwKSxudWxsO2NvbnN0IGQ9MS9sLGY9KHUqYy1hKmgpKmQscD0obypoLWEqYykqZDtyZXR1cm4gaS5zZXQoMS1mLXAscCxmKX1zdGF0aWMgY29udGFpbnNQb2ludCh0LGUscyxuKXtyZXR1cm4gdGhpcy5nZXRCYXJ5Y29vcmQodCxlLHMsbixZdCk9PT1udWxsPyExOll0Lng+PTAmJll0Lnk+PTAmJll0LngrWXQueTw9MX1zdGF0aWMgZ2V0SW50ZXJwb2xhdGlvbih0LGUscyxuLGksbyxhLGMpe3JldHVybiB0aGlzLmdldEJhcnljb29yZCh0LGUscyxuLFl0KT09PW51bGw/KGMueD0wLGMueT0wLCJ6ImluIGMmJihjLno9MCksInciaW4gYyYmKGMudz0wKSxudWxsKTooYy5zZXRTY2FsYXIoMCksYy5hZGRTY2FsZWRWZWN0b3IoaSxZdC54KSxjLmFkZFNjYWxlZFZlY3RvcihvLFl0LnkpLGMuYWRkU2NhbGVkVmVjdG9yKGEsWXQueiksYyl9c3RhdGljIGdldEludGVycG9sYXRlZEF0dHJpYnV0ZSh0LGUscyxuLGksbyl7cmV0dXJuIFZuLnNldFNjYWxhcigwKSxVbi5zZXRTY2FsYXIoMCksa24uc2V0U2NhbGFyKDApLFZuLmZyb21CdWZmZXJBdHRyaWJ1dGUodCxlKSxVbi5mcm9tQnVmZmVyQXR0cmlidXRlKHQscyksa24uZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LG4pLG8uc2V0U2NhbGFyKDApLG8uYWRkU2NhbGVkVmVjdG9yKFZuLGkueCksby5hZGRTY2FsZWRWZWN0b3IoVW4saS55KSxvLmFkZFNjYWxlZFZlY3RvcihrbixpLnopLG99c3RhdGljIGlzRnJvbnRGYWNpbmcodCxlLHMsbil7cmV0dXJuIEl0LnN1YlZlY3RvcnMocyxlKSxYdC5zdWJWZWN0b3JzKHQsZSksSXQuY3Jvc3MoWHQpLmRvdChuKTwwfXNldCh0LGUscyl7cmV0dXJuIHRoaXMuYS5jb3B5KHQpLHRoaXMuYi5jb3B5KGUpLHRoaXMuYy5jb3B5KHMpLHRoaXN9c2V0RnJvbVBvaW50c0FuZEluZGljZXModCxlLHMsbil7cmV0dXJuIHRoaXMuYS5jb3B5KHRbZV0pLHRoaXMuYi5jb3B5KHRbc10pLHRoaXMuYy5jb3B5KHRbbl0pLHRoaXN9c2V0RnJvbUF0dHJpYnV0ZUFuZEluZGljZXModCxlLHMsbil7cmV0dXJuIHRoaXMuYS5mcm9tQnVmZmVyQXR0cmlidXRlKHQsZSksdGhpcy5iLmZyb21CdWZmZXJBdHRyaWJ1dGUodCxzKSx0aGlzLmMuZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LG4pLHRoaXN9Y2xvbmUoKXtyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KHRoaXMpfWNvcHkodCl7cmV0dXJuIHRoaXMuYS5jb3B5KHQuYSksdGhpcy5iLmNvcHkodC5iKSx0aGlzLmMuY29weSh0LmMpLHRoaXN9Z2V0QXJlYSgpe3JldHVybiBJdC5zdWJWZWN0b3JzKHRoaXMuYyx0aGlzLmIpLFh0LnN1YlZlY3RvcnModGhpcy5hLHRoaXMuYiksSXQuY3Jvc3MoWHQpLmxlbmd0aCgpKi41fWdldE1pZHBvaW50KHQpe3JldHVybiB0LmFkZFZlY3RvcnModGhpcy5hLHRoaXMuYikuYWRkKHRoaXMuYykubXVsdGlwbHlTY2FsYXIoMS8zKX1nZXROb3JtYWwodCl7cmV0dXJuIHd0LmdldE5vcm1hbCh0aGlzLmEsdGhpcy5iLHRoaXMuYyx0KX1nZXRQbGFuZSh0KXtyZXR1cm4gdC5zZXRGcm9tQ29wbGFuYXJQb2ludHModGhpcy5hLHRoaXMuYix0aGlzLmMpfWdldEJhcnljb29yZCh0LGUpe3JldHVybiB3dC5nZXRCYXJ5Y29vcmQodCx0aGlzLmEsdGhpcy5iLHRoaXMuYyxlKX1nZXRJbnRlcnBvbGF0aW9uKHQsZSxzLG4saSl7cmV0dXJuIHd0LmdldEludGVycG9sYXRpb24odCx0aGlzLmEsdGhpcy5iLHRoaXMuYyxlLHMsbixpKX1jb250YWluc1BvaW50KHQpe3JldHVybiB3dC5jb250YWluc1BvaW50KHQsdGhpcy5hLHRoaXMuYix0aGlzLmMpfWlzRnJvbnRGYWNpbmcodCl7cmV0dXJuIHd0LmlzRnJvbnRGYWNpbmcodGhpcy5hLHRoaXMuYix0aGlzLmMsdCl9aW50ZXJzZWN0c0JveCh0KXtyZXR1cm4gdC5pbnRlcnNlY3RzVHJpYW5nbGUodGhpcyl9Y2xvc2VzdFBvaW50VG9Qb2ludCh0LGUpe2NvbnN0IHM9dGhpcy5hLG49dGhpcy5iLGk9dGhpcy5jO2xldCBvLGE7emUuc3ViVmVjdG9ycyhuLHMpLGJlLnN1YlZlY3RvcnMoaSxzKSxMbi5zdWJWZWN0b3JzKHQscyk7Y29uc3QgYz16ZS5kb3QoTG4pLHU9YmUuZG90KExuKTtpZihjPD0wJiZ1PD0wKXJldHVybiBlLmNvcHkocyk7T24uc3ViVmVjdG9ycyh0LG4pO2NvbnN0IGg9emUuZG90KE9uKSxsPWJlLmRvdChPbik7aWYoaD49MCYmbDw9aClyZXR1cm4gZS5jb3B5KG4pO2NvbnN0IGQ9YypsLWgqdTtpZihkPD0wJiZjPj0wJiZoPD0wKXJldHVybiBvPWMvKGMtaCksZS5jb3B5KHMpLmFkZFNjYWxlZFZlY3Rvcih6ZSxvKTtEbi5zdWJWZWN0b3JzKHQsaSk7Y29uc3QgZj16ZS5kb3QoRG4pLHA9YmUuZG90KERuKTtpZihwPj0wJiZmPD1wKXJldHVybiBlLmNvcHkoaSk7Y29uc3QgbT1mKnUtYypwO2lmKG08PTAmJnU+PTAmJnA8PTApcmV0dXJuIGE9dS8odS1wKSxlLmNvcHkocykuYWRkU2NhbGVkVmVjdG9yKGJlLGEpO2NvbnN0IGc9aCpwLWYqbDtpZihnPD0wJiZsLWg+PTAmJmYtcD49MClyZXR1cm4geXIuc3ViVmVjdG9ycyhpLG4pLGE9KGwtaCkvKGwtaCsoZi1wKSksZS5jb3B5KG4pLmFkZFNjYWxlZFZlY3Rvcih5cixhKTtjb25zdCB5PTEvKGcrbStkKTtyZXR1cm4gbz1tKnksYT1kKnksZS5jb3B5KHMpLmFkZFNjYWxlZFZlY3Rvcih6ZSxvKS5hZGRTY2FsZWRWZWN0b3IoYmUsYSl9ZXF1YWxzKHQpe3JldHVybiB0LmEuZXF1YWxzKHRoaXMuYSkmJnQuYi5lcXVhbHModGhpcy5iKSYmdC5jLmVxdWFscyh0aGlzLmMpfX1jb25zdCBncj17YWxpY2VibHVlOjE1NzkyMzgzLGFudGlxdWV3aGl0ZToxNjQ0NDM3NSxhcXVhOjY1NTM1LGFxdWFtYXJpbmU6ODM4ODU2NCxhenVyZToxNTc5NDE3NSxiZWlnZToxNjExOTI2MCxiaXNxdWU6MTY3NzAyNDQsYmxhY2s6MCxibGFuY2hlZGFsbW9uZDoxNjc3MjA0NSxibHVlOjI1NSxibHVldmlvbGV0OjkwNTUyMDIsYnJvd246MTA4MjQyMzQsYnVybHl3b29kOjE0NTk2MjMxLGNhZGV0Ymx1ZTo2MjY2NTI4LGNoYXJ0cmV1c2U6ODM4ODM1MixjaG9jb2xhdGU6MTM3ODk0NzAsY29yYWw6MTY3NDQyNzIsY29ybmZsb3dlcmJsdWU6NjU5MTk4MSxjb3Juc2lsazoxNjc3NTM4OCxjcmltc29uOjE0NDIzMTAwLGN5YW46NjU1MzUsZGFya2JsdWU6MTM5LGRhcmtjeWFuOjM1NzIzLGRhcmtnb2xkZW5yb2Q6MTIwOTI5MzksZGFya2dyYXk6MTExMTkwMTcsZGFya2dyZWVuOjI1NjAwLGRhcmtncmV5OjExMTE5MDE3LGRhcmtraGFraToxMjQzMzI1OSxkYXJrbWFnZW50YTo5MTA5NjQzLGRhcmtvbGl2ZWdyZWVuOjU1OTc5OTksZGFya29yYW5nZToxNjc0NzUyMCxkYXJrb3JjaGlkOjEwMDQwMDEyLGRhcmtyZWQ6OTEwOTUwNCxkYXJrc2FsbW9uOjE1MzA4NDEwLGRhcmtzZWFncmVlbjo5NDE5OTE5LGRhcmtzbGF0ZWJsdWU6NDczNDM0NyxkYXJrc2xhdGVncmF5OjMxMDA0OTUsZGFya3NsYXRlZ3JleTozMTAwNDk1LGRhcmt0dXJxdW9pc2U6NTI5NDUsZGFya3Zpb2xldDo5Njk5NTM5LGRlZXBwaW5rOjE2NzE2OTQ3LGRlZXBza3libHVlOjQ5MTUxLGRpbWdyYXk6NjkwODI2NSxkaW1ncmV5OjY5MDgyNjUsZG9kZ2VyYmx1ZToyMDAzMTk5LGZpcmVicmljazoxMTY3NDE0NixmbG9yYWx3aGl0ZToxNjc3NTkyMCxmb3Jlc3RncmVlbjoyMjYzODQyLGZ1Y2hzaWE6MTY3MTE5MzUsZ2FpbnNib3JvOjE0NDc0NDYwLGdob3N0d2hpdGU6MTYzMTY2NzEsZ29sZDoxNjc2NjcyMCxnb2xkZW5yb2Q6MTQzMjkxMjAsZ3JheTo4NDIxNTA0LGdyZWVuOjMyNzY4LGdyZWVueWVsbG93OjExNDAzMDU1LGdyZXk6ODQyMTUwNCxob25leWRldzoxNTc5NDE2MCxob3RwaW5rOjE2NzM4NzQwLGluZGlhbnJlZDoxMzQ1ODUyNCxpbmRpZ286NDkxNTMzMCxpdm9yeToxNjc3NzIwMCxraGFraToxNTc4NzY2MCxsYXZlbmRlcjoxNTEzMjQxMCxsYXZlbmRlcmJsdXNoOjE2NzczMzY1LGxhd25ncmVlbjo4MTkwOTc2LGxlbW9uY2hpZmZvbjoxNjc3NTg4NSxsaWdodGJsdWU6MTEzOTMyNTQsbGlnaHRjb3JhbDoxNTc2MTUzNixsaWdodGN5YW46MTQ3NDU1OTksbGlnaHRnb2xkZW5yb2R5ZWxsb3c6MTY0NDgyMTAsbGlnaHRncmF5OjEzODgyMzIzLGxpZ2h0Z3JlZW46OTQ5ODI1NixsaWdodGdyZXk6MTM4ODIzMjMsbGlnaHRwaW5rOjE2NzU4NDY1LGxpZ2h0c2FsbW9uOjE2NzUyNzYyLGxpZ2h0c2VhZ3JlZW46MjE0Mjg5MCxsaWdodHNreWJsdWU6ODkwMDM0NixsaWdodHNsYXRlZ3JheTo3ODMzNzUzLGxpZ2h0c2xhdGVncmV5Ojc4MzM3NTMsbGlnaHRzdGVlbGJsdWU6MTE1ODQ3MzQsbGlnaHR5ZWxsb3c6MTY3NzcxODQsbGltZTo2NTI4MCxsaW1lZ3JlZW46MzMyOTMzMCxsaW5lbjoxNjQ0NTY3MCxtYWdlbnRhOjE2NzExOTM1LG1hcm9vbjo4Mzg4NjA4LG1lZGl1bWFxdWFtYXJpbmU6NjczNzMyMixtZWRpdW1ibHVlOjIwNSxtZWRpdW1vcmNoaWQ6MTIyMTE2NjcsbWVkaXVtcHVycGxlOjk2NjI2ODMsbWVkaXVtc2VhZ3JlZW46Mzk3ODA5NyxtZWRpdW1zbGF0ZWJsdWU6ODA4Nzc5MCxtZWRpdW1zcHJpbmdncmVlbjo2NDE1NCxtZWRpdW10dXJxdW9pc2U6NDc3MjMwMCxtZWRpdW12aW9sZXRyZWQ6MTMwNDcxNzMsbWlkbmlnaHRibHVlOjE2NDQ5MTIsbWludGNyZWFtOjE2MTIxODUwLG1pc3R5cm9zZToxNjc3MDI3Myxtb2NjYXNpbjoxNjc3MDIyOSxuYXZham93aGl0ZToxNjc2ODY4NSxuYXZ5OjEyOCxvbGRsYWNlOjE2NjQzNTU4LG9saXZlOjg0MjEzNzYsb2xpdmVkcmFiOjcwNDg3Mzksb3JhbmdlOjE2NzUzOTIwLG9yYW5nZXJlZDoxNjcyOTM0NCxvcmNoaWQ6MTQzMTU3MzQscGFsZWdvbGRlbnJvZDoxNTY1NzEzMCxwYWxlZ3JlZW46MTAwMjU4ODAscGFsZXR1cnF1b2lzZToxMTUyOTk2NixwYWxldmlvbGV0cmVkOjE0MzgxMjAzLHBhcGF5YXdoaXA6MTY3NzMwNzcscGVhY2hwdWZmOjE2NzY3NjczLHBlcnU6MTM0Njg5OTEscGluazoxNjc2MTAzNSxwbHVtOjE0NTI0NjM3LHBvd2RlcmJsdWU6MTE1OTE5MTAscHVycGxlOjgzODg3MzYscmViZWNjYXB1cnBsZTo2Njk3ODgxLHJlZDoxNjcxMTY4MCxyb3N5YnJvd246MTIzNTc1MTkscm95YWxibHVlOjQyODY5NDUsc2FkZGxlYnJvd246OTEyNzE4NyxzYWxtb246MTY0MTY4ODIsc2FuZHlicm93bjoxNjAzMjg2NCxzZWFncmVlbjozMDUwMzI3LHNlYXNoZWxsOjE2Nzc0NjM4LHNpZW5uYToxMDUwNjc5NyxzaWx2ZXI6MTI2MzIyNTYsc2t5Ymx1ZTo4OTAwMzMxLHNsYXRlYmx1ZTo2OTcwMDYxLHNsYXRlZ3JheTo3MzcyOTQ0LHNsYXRlZ3JleTo3MzcyOTQ0LHNub3c6MTY3NzU5MzAsc3ByaW5nZ3JlZW46NjU0MDcsc3RlZWxibHVlOjQ2MjA5ODAsdGFuOjEzODA4NzgwLHRlYWw6MzI4OTYsdGhpc3RsZToxNDIwNDg4OCx0b21hdG86MTY3MzcwOTUsdHVycXVvaXNlOjQyNTE4NTYsdmlvbGV0OjE1NjMxMDg2LHdoZWF0OjE2MTEzMzMxLHdoaXRlOjE2Nzc3MjE1LHdoaXRlc21va2U6MTYxMTkyODUseWVsbG93OjE2Nzc2OTYwLHllbGxvd2dyZWVuOjEwMTQ1MDc0fSxpZT17aDowLHM6MCxsOjB9LExzPXtoOjAsczowLGw6MH07ZnVuY3Rpb24gSG4ocix0LGUpe3JldHVybiBlPDAmJihlKz0xKSxlPjEmJihlLT0xKSxlPDEvNj9yKyh0LXIpKjYqZTplPDEvMj90OmU8Mi8zP3IrKHQtcikqNiooMi8zLWUpOnJ9Y2xhc3MgcW57Y29uc3RydWN0b3IodCxlLHMpe3JldHVybiB0aGlzLmlzQ29sb3I9ITAsdGhpcy5yPTEsdGhpcy5nPTEsdGhpcy5iPTEsdGhpcy5zZXQodCxlLHMpfXNldCh0LGUscyl7aWYoZT09PXZvaWQgMCYmcz09PXZvaWQgMCl7Y29uc3Qgbj10O24mJm4uaXNDb2xvcj90aGlzLmNvcHkobik6dHlwZW9mIG49PSJudW1iZXIiP3RoaXMuc2V0SGV4KG4pOnR5cGVvZiBuPT0ic3RyaW5nIiYmdGhpcy5zZXRTdHlsZShuKX1lbHNlIHRoaXMuc2V0UkdCKHQsZSxzKTtyZXR1cm4gdGhpc31zZXRTY2FsYXIodCl7cmV0dXJuIHRoaXMucj10LHRoaXMuZz10LHRoaXMuYj10LHRoaXN9c2V0SGV4KHQsZT0kdCl7cmV0dXJuIHQ9TWF0aC5mbG9vcih0KSx0aGlzLnI9KHQ+PjE2JjI1NSkvMjU1LHRoaXMuZz0odD4+OCYyNTUpLzI1NSx0aGlzLmI9KHQmMjU1KS8yNTUsbXQudG9Xb3JraW5nQ29sb3JTcGFjZSh0aGlzLGUpLHRoaXN9c2V0UkdCKHQsZSxzLG49bXQud29ya2luZ0NvbG9yU3BhY2Upe3JldHVybiB0aGlzLnI9dCx0aGlzLmc9ZSx0aGlzLmI9cyxtdC50b1dvcmtpbmdDb2xvclNwYWNlKHRoaXMsbiksdGhpc31zZXRIU0wodCxlLHMsbj1tdC53b3JraW5nQ29sb3JTcGFjZSl7aWYodD1ibih0LDEpLGU9YXQoZSwwLDEpLHM9YXQocywwLDEpLGU9PT0wKXRoaXMucj10aGlzLmc9dGhpcy5iPXM7ZWxzZXtjb25zdCBpPXM8PS41P3MqKDErZSk6cytlLXMqZSxvPTIqcy1pO3RoaXMucj1IbihvLGksdCsxLzMpLHRoaXMuZz1IbihvLGksdCksdGhpcy5iPUhuKG8saSx0LTEvMyl9cmV0dXJuIG10LnRvV29ya2luZ0NvbG9yU3BhY2UodGhpcyxuKSx0aGlzfXNldFN0eWxlKHQsZT0kdCl7ZnVuY3Rpb24gcyhpKXtpIT09dm9pZCAwJiZwYXJzZUZsb2F0KGkpPDEmJmNvbnNvbGUud2FybigiVEhSRUUuQ29sb3I6IEFscGhhIGNvbXBvbmVudCBvZiAiK3QrIiB3aWxsIGJlIGlnbm9yZWQuIil9bGV0IG47aWYobj0vXihcdyspXCgoW15cKV0qKVwpLy5leGVjKHQpKXtsZXQgaTtjb25zdCBvPW5bMV0sYT1uWzJdO3N3aXRjaChvKXtjYXNlInJnYiI6Y2FzZSJyZ2JhIjppZihpPS9eXHMqKFxkKylccyosXHMqKFxkKylccyosXHMqKFxkKylccyooPzosXHMqKFxkKlwuP1xkKylccyopPyQvLmV4ZWMoYSkpcmV0dXJuIHMoaVs0XSksdGhpcy5zZXRSR0IoTWF0aC5taW4oMjU1LHBhcnNlSW50KGlbMV0sMTApKS8yNTUsTWF0aC5taW4oMjU1LHBhcnNlSW50KGlbMl0sMTApKS8yNTUsTWF0aC5taW4oMjU1LHBhcnNlSW50KGlbM10sMTApKS8yNTUsZSk7aWYoaT0vXlxzKihcZCspXCVccyosXHMqKFxkKylcJVxzKixccyooXGQrKVwlXHMqKD86LFxzKihcZCpcLj9cZCspXHMqKT8kLy5leGVjKGEpKXJldHVybiBzKGlbNF0pLHRoaXMuc2V0UkdCKE1hdGgubWluKDEwMCxwYXJzZUludChpWzFdLDEwKSkvMTAwLE1hdGgubWluKDEwMCxwYXJzZUludChpWzJdLDEwKSkvMTAwLE1hdGgubWluKDEwMCxwYXJzZUludChpWzNdLDEwKSkvMTAwLGUpO2JyZWFrO2Nhc2UiaHNsIjpjYXNlImhzbGEiOmlmKGk9L15ccyooXGQqXC4/XGQrKVxzKixccyooXGQqXC4/XGQrKVwlXHMqLFxzKihcZCpcLj9cZCspXCVccyooPzosXHMqKFxkKlwuP1xkKylccyopPyQvLmV4ZWMoYSkpcmV0dXJuIHMoaVs0XSksdGhpcy5zZXRIU0wocGFyc2VGbG9hdChpWzFdKS8zNjAscGFyc2VGbG9hdChpWzJdKS8xMDAscGFyc2VGbG9hdChpWzNdKS8xMDAsZSk7YnJlYWs7ZGVmYXVsdDpjb25zb2xlLndhcm4oIlRIUkVFLkNvbG9yOiBVbmtub3duIGNvbG9yIG1vZGVsICIrdCl9fWVsc2UgaWYobj0vXlwjKFtBLUZhLWZcZF0rKSQvLmV4ZWModCkpe2NvbnN0IGk9blsxXSxvPWkubGVuZ3RoO2lmKG89PT0zKXJldHVybiB0aGlzLnNldFJHQihwYXJzZUludChpLmNoYXJBdCgwKSwxNikvMTUscGFyc2VJbnQoaS5jaGFyQXQoMSksMTYpLzE1LHBhcnNlSW50KGkuY2hhckF0KDIpLDE2KS8xNSxlKTtpZihvPT09NilyZXR1cm4gdGhpcy5zZXRIZXgocGFyc2VJbnQoaSwxNiksZSk7Y29uc29sZS53YXJuKCJUSFJFRS5Db2xvcjogSW52YWxpZCBoZXggY29sb3IgIit0KX1lbHNlIGlmKHQmJnQubGVuZ3RoPjApcmV0dXJuIHRoaXMuc2V0Q29sb3JOYW1lKHQsZSk7cmV0dXJuIHRoaXN9c2V0Q29sb3JOYW1lKHQsZT0kdCl7Y29uc3Qgcz1nclt0LnRvTG93ZXJDYXNlKCldO3JldHVybiBzIT09dm9pZCAwP3RoaXMuc2V0SGV4KHMsZSk6Y29uc29sZS53YXJuKCJUSFJFRS5Db2xvcjogVW5rbm93biBjb2xvciAiK3QpLHRoaXN9Y2xvbmUoKXtyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcy5yLHRoaXMuZyx0aGlzLmIpfWNvcHkodCl7cmV0dXJuIHRoaXMucj10LnIsdGhpcy5nPXQuZyx0aGlzLmI9dC5iLHRoaXN9Y29weVNSR0JUb0xpbmVhcih0KXtyZXR1cm4gdGhpcy5yPXhlKHQuciksdGhpcy5nPXhlKHQuZyksdGhpcy5iPXhlKHQuYiksdGhpc31jb3B5TGluZWFyVG9TUkdCKHQpe3JldHVybiB0aGlzLnI9Q24odC5yKSx0aGlzLmc9Q24odC5nKSx0aGlzLmI9Q24odC5iKSx0aGlzfWNvbnZlcnRTUkdCVG9MaW5lYXIoKXtyZXR1cm4gdGhpcy5jb3B5U1JHQlRvTGluZWFyKHRoaXMpLHRoaXN9Y29udmVydExpbmVhclRvU1JHQigpe3JldHVybiB0aGlzLmNvcHlMaW5lYXJUb1NSR0IodGhpcyksdGhpc31nZXRIZXgodD0kdCl7cmV0dXJuIG10LmZyb21Xb3JraW5nQ29sb3JTcGFjZShjdC5jb3B5KHRoaXMpLHQpLE1hdGgucm91bmQoYXQoY3QucioyNTUsMCwyNTUpKSo2NTUzNitNYXRoLnJvdW5kKGF0KGN0LmcqMjU1LDAsMjU1KSkqMjU2K01hdGgucm91bmQoYXQoY3QuYioyNTUsMCwyNTUpKX1nZXRIZXhTdHJpbmcodD0kdCl7cmV0dXJuKCIwMDAwMDAiK3RoaXMuZ2V0SGV4KHQpLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTYpfWdldEhTTCh0LGU9bXQud29ya2luZ0NvbG9yU3BhY2Upe210LmZyb21Xb3JraW5nQ29sb3JTcGFjZShjdC5jb3B5KHRoaXMpLGUpO2NvbnN0IHM9Y3QucixuPWN0LmcsaT1jdC5iLG89TWF0aC5tYXgocyxuLGkpLGE9TWF0aC5taW4ocyxuLGkpO2xldCBjLHU7Y29uc3QgaD0oYStvKS8yO2lmKGE9PT1vKWM9MCx1PTA7ZWxzZXtjb25zdCBsPW8tYTtzd2l0Y2godT1oPD0uNT9sLyhvK2EpOmwvKDItby1hKSxvKXtjYXNlIHM6Yz0obi1pKS9sKyhuPGk/NjowKTticmVhaztjYXNlIG46Yz0oaS1zKS9sKzI7YnJlYWs7Y2FzZSBpOmM9KHMtbikvbCs0O2JyZWFrfWMvPTZ9cmV0dXJuIHQuaD1jLHQucz11LHQubD1oLHR9Z2V0UkdCKHQsZT1tdC53b3JraW5nQ29sb3JTcGFjZSl7cmV0dXJuIG10LmZyb21Xb3JraW5nQ29sb3JTcGFjZShjdC5jb3B5KHRoaXMpLGUpLHQucj1jdC5yLHQuZz1jdC5nLHQuYj1jdC5iLHR9Z2V0U3R5bGUodD0kdCl7bXQuZnJvbVdvcmtpbmdDb2xvclNwYWNlKGN0LmNvcHkodGhpcyksdCk7Y29uc3QgZT1jdC5yLHM9Y3QuZyxuPWN0LmI7cmV0dXJuIHQhPT0kdD9gY29sb3IoJHt0fSAke2UudG9GaXhlZCgzKX0gJHtzLnRvRml4ZWQoMyl9ICR7bi50b0ZpeGVkKDMpfSlgOmByZ2IoJHtNYXRoLnJvdW5kKGUqMjU1KX0sJHtNYXRoLnJvdW5kKHMqMjU1KX0sJHtNYXRoLnJvdW5kKG4qMjU1KX0pYH1vZmZzZXRIU0wodCxlLHMpe3JldHVybiB0aGlzLmdldEhTTChpZSksdGhpcy5zZXRIU0woaWUuaCt0LGllLnMrZSxpZS5sK3MpfWFkZCh0KXtyZXR1cm4gdGhpcy5yKz10LnIsdGhpcy5nKz10LmcsdGhpcy5iKz10LmIsdGhpc31hZGRDb2xvcnModCxlKXtyZXR1cm4gdGhpcy5yPXQucitlLnIsdGhpcy5nPXQuZytlLmcsdGhpcy5iPXQuYitlLmIsdGhpc31hZGRTY2FsYXIodCl7cmV0dXJuIHRoaXMucis9dCx0aGlzLmcrPXQsdGhpcy5iKz10LHRoaXN9c3ViKHQpe3JldHVybiB0aGlzLnI9TWF0aC5tYXgoMCx0aGlzLnItdC5yKSx0aGlzLmc9TWF0aC5tYXgoMCx0aGlzLmctdC5nKSx0aGlzLmI9TWF0aC5tYXgoMCx0aGlzLmItdC5iKSx0aGlzfW11bHRpcGx5KHQpe3JldHVybiB0aGlzLnIqPXQucix0aGlzLmcqPXQuZyx0aGlzLmIqPXQuYix0aGlzfW11bHRpcGx5U2NhbGFyKHQpe3JldHVybiB0aGlzLnIqPXQsdGhpcy5nKj10LHRoaXMuYio9dCx0aGlzfWxlcnAodCxlKXtyZXR1cm4gdGhpcy5yKz0odC5yLXRoaXMucikqZSx0aGlzLmcrPSh0LmctdGhpcy5nKSplLHRoaXMuYis9KHQuYi10aGlzLmIpKmUsdGhpc31sZXJwQ29sb3JzKHQsZSxzKXtyZXR1cm4gdGhpcy5yPXQucisoZS5yLXQucikqcyx0aGlzLmc9dC5nKyhlLmctdC5nKSpzLHRoaXMuYj10LmIrKGUuYi10LmIpKnMsdGhpc31sZXJwSFNMKHQsZSl7dGhpcy5nZXRIU0woaWUpLHQuZ2V0SFNMKExzKTtjb25zdCBzPUplKGllLmgsTHMuaCxlKSxuPUplKGllLnMsTHMucyxlKSxpPUplKGllLmwsTHMubCxlKTtyZXR1cm4gdGhpcy5zZXRIU0wocyxuLGkpLHRoaXN9c2V0RnJvbVZlY3RvcjModCl7cmV0dXJuIHRoaXMucj10LngsdGhpcy5nPXQueSx0aGlzLmI9dC56LHRoaXN9YXBwbHlNYXRyaXgzKHQpe2NvbnN0IGU9dGhpcy5yLHM9dGhpcy5nLG49dGhpcy5iLGk9dC5lbGVtZW50cztyZXR1cm4gdGhpcy5yPWlbMF0qZStpWzNdKnMraVs2XSpuLHRoaXMuZz1pWzFdKmUraVs0XSpzK2lbN10qbix0aGlzLmI9aVsyXSplK2lbNV0qcytpWzhdKm4sdGhpc31lcXVhbHModCl7cmV0dXJuIHQucj09PXRoaXMuciYmdC5nPT09dGhpcy5nJiZ0LmI9PT10aGlzLmJ9ZnJvbUFycmF5KHQsZT0wKXtyZXR1cm4gdGhpcy5yPXRbZV0sdGhpcy5nPXRbZSsxXSx0aGlzLmI9dFtlKzJdLHRoaXN9dG9BcnJheSh0PVtdLGU9MCl7cmV0dXJuIHRbZV09dGhpcy5yLHRbZSsxXT10aGlzLmcsdFtlKzJdPXRoaXMuYix0fWZyb21CdWZmZXJBdHRyaWJ1dGUodCxlKXtyZXR1cm4gdGhpcy5yPXQuZ2V0WChlKSx0aGlzLmc9dC5nZXRZKGUpLHRoaXMuYj10LmdldFooZSksdGhpc310b0pTT04oKXtyZXR1cm4gdGhpcy5nZXRIZXgoKX0qW1N5bWJvbC5pdGVyYXRvcl0oKXt5aWVsZCB0aGlzLnIseWllbGQgdGhpcy5nLHlpZWxkIHRoaXMuYn19Y29uc3QgY3Q9bmV3IHFuO3FuLk5BTUVTPWdyO2NvbnN0IGo9bmV3IEEsT3M9bmV3IEo7Y2xhc3MgdnR7Y29uc3RydWN0b3IodCxlLHM9ITEpe2lmKEFycmF5LmlzQXJyYXkodCkpdGhyb3cgbmV3IFR5cGVFcnJvcigiVEhSRUUuQnVmZmVyQXR0cmlidXRlOiBhcnJheSBzaG91bGQgYmUgYSBUeXBlZCBBcnJheS4iKTt0aGlzLmlzQnVmZmVyQXR0cmlidXRlPSEwLHRoaXMubmFtZT0iIix0aGlzLmFycmF5PXQsdGhpcy5pdGVtU2l6ZT1lLHRoaXMuY291bnQ9dCE9PXZvaWQgMD90Lmxlbmd0aC9lOjAsdGhpcy5ub3JtYWxpemVkPXMsdGhpcy51c2FnZT1Dcyx0aGlzLnVwZGF0ZVJhbmdlcz1bXSx0aGlzLmdwdVR5cGU9SW8sdGhpcy52ZXJzaW9uPTB9b25VcGxvYWRDYWxsYmFjaygpe31zZXQgbmVlZHNVcGRhdGUodCl7dD09PSEwJiZ0aGlzLnZlcnNpb24rK31zZXRVc2FnZSh0KXtyZXR1cm4gdGhpcy51c2FnZT10LHRoaXN9YWRkVXBkYXRlUmFuZ2UodCxlKXt0aGlzLnVwZGF0ZVJhbmdlcy5wdXNoKHtzdGFydDp0LGNvdW50OmV9KX1jbGVhclVwZGF0ZVJhbmdlcygpe3RoaXMudXBkYXRlUmFuZ2VzLmxlbmd0aD0wfWNvcHkodCl7cmV0dXJuIHRoaXMubmFtZT10Lm5hbWUsdGhpcy5hcnJheT1uZXcgdC5hcnJheS5jb25zdHJ1Y3Rvcih0LmFycmF5KSx0aGlzLml0ZW1TaXplPXQuaXRlbVNpemUsdGhpcy5jb3VudD10LmNvdW50LHRoaXMubm9ybWFsaXplZD10Lm5vcm1hbGl6ZWQsdGhpcy51c2FnZT10LnVzYWdlLHRoaXMuZ3B1VHlwZT10LmdwdVR5cGUsdGhpc31jb3B5QXQodCxlLHMpe3QqPXRoaXMuaXRlbVNpemUscyo9ZS5pdGVtU2l6ZTtmb3IobGV0IG49MCxpPXRoaXMuaXRlbVNpemU7bjxpO24rKyl0aGlzLmFycmF5W3Qrbl09ZS5hcnJheVtzK25dO3JldHVybiB0aGlzfWNvcHlBcnJheSh0KXtyZXR1cm4gdGhpcy5hcnJheS5zZXQodCksdGhpc31hcHBseU1hdHJpeDModCl7aWYodGhpcy5pdGVtU2l6ZT09PTIpZm9yKGxldCBlPTAscz10aGlzLmNvdW50O2U8cztlKyspT3MuZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0aGlzLGUpLE9zLmFwcGx5TWF0cml4Myh0KSx0aGlzLnNldFhZKGUsT3MueCxPcy55KTtlbHNlIGlmKHRoaXMuaXRlbVNpemU9PT0zKWZvcihsZXQgZT0wLHM9dGhpcy5jb3VudDtlPHM7ZSsrKWouZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0aGlzLGUpLGouYXBwbHlNYXRyaXgzKHQpLHRoaXMuc2V0WFlaKGUsai54LGoueSxqLnopO3JldHVybiB0aGlzfWFwcGx5TWF0cml4NCh0KXtmb3IobGV0IGU9MCxzPXRoaXMuY291bnQ7ZTxzO2UrKylqLmZyb21CdWZmZXJBdHRyaWJ1dGUodGhpcyxlKSxqLmFwcGx5TWF0cml4NCh0KSx0aGlzLnNldFhZWihlLGoueCxqLnksai56KTtyZXR1cm4gdGhpc31hcHBseU5vcm1hbE1hdHJpeCh0KXtmb3IobGV0IGU9MCxzPXRoaXMuY291bnQ7ZTxzO2UrKylqLmZyb21CdWZmZXJBdHRyaWJ1dGUodGhpcyxlKSxqLmFwcGx5Tm9ybWFsTWF0cml4KHQpLHRoaXMuc2V0WFlaKGUsai54LGoueSxqLnopO3JldHVybiB0aGlzfXRyYW5zZm9ybURpcmVjdGlvbih0KXtmb3IobGV0IGU9MCxzPXRoaXMuY291bnQ7ZTxzO2UrKylqLmZyb21CdWZmZXJBdHRyaWJ1dGUodGhpcyxlKSxqLnRyYW5zZm9ybURpcmVjdGlvbih0KSx0aGlzLnNldFhZWihlLGoueCxqLnksai56KTtyZXR1cm4gdGhpc31zZXQodCxlPTApe3JldHVybiB0aGlzLmFycmF5LnNldCh0LGUpLHRoaXN9Z2V0Q29tcG9uZW50KHQsZSl7bGV0IHM9dGhpcy5hcnJheVt0KnRoaXMuaXRlbVNpemUrZV07cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKHM9RXQocyx0aGlzLmFycmF5KSksc31zZXRDb21wb25lbnQodCxlLHMpe3JldHVybiB0aGlzLm5vcm1hbGl6ZWQmJihzPSQocyx0aGlzLmFycmF5KSksdGhpcy5hcnJheVt0KnRoaXMuaXRlbVNpemUrZV09cyx0aGlzfWdldFgodCl7bGV0IGU9dGhpcy5hcnJheVt0KnRoaXMuaXRlbVNpemVdO3JldHVybiB0aGlzLm5vcm1hbGl6ZWQmJihlPUV0KGUsdGhpcy5hcnJheSkpLGV9c2V0WCh0LGUpe3JldHVybiB0aGlzLm5vcm1hbGl6ZWQmJihlPSQoZSx0aGlzLmFycmF5KSksdGhpcy5hcnJheVt0KnRoaXMuaXRlbVNpemVdPWUsdGhpc31nZXRZKHQpe2xldCBlPXRoaXMuYXJyYXlbdCp0aGlzLml0ZW1TaXplKzFdO3JldHVybiB0aGlzLm5vcm1hbGl6ZWQmJihlPUV0KGUsdGhpcy5hcnJheSkpLGV9c2V0WSh0LGUpe3JldHVybiB0aGlzLm5vcm1hbGl6ZWQmJihlPSQoZSx0aGlzLmFycmF5KSksdGhpcy5hcnJheVt0KnRoaXMuaXRlbVNpemUrMV09ZSx0aGlzfWdldFoodCl7bGV0IGU9dGhpcy5hcnJheVt0KnRoaXMuaXRlbVNpemUrMl07cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGU9RXQoZSx0aGlzLmFycmF5KSksZX1zZXRaKHQsZSl7cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGU9JChlLHRoaXMuYXJyYXkpKSx0aGlzLmFycmF5W3QqdGhpcy5pdGVtU2l6ZSsyXT1lLHRoaXN9Z2V0Vyh0KXtsZXQgZT10aGlzLmFycmF5W3QqdGhpcy5pdGVtU2l6ZSszXTtyZXR1cm4gdGhpcy5ub3JtYWxpemVkJiYoZT1FdChlLHRoaXMuYXJyYXkpKSxlfXNldFcodCxlKXtyZXR1cm4gdGhpcy5ub3JtYWxpemVkJiYoZT0kKGUsdGhpcy5hcnJheSkpLHRoaXMuYXJyYXlbdCp0aGlzLml0ZW1TaXplKzNdPWUsdGhpc31zZXRYWSh0LGUscyl7cmV0dXJuIHQqPXRoaXMuaXRlbVNpemUsdGhpcy5ub3JtYWxpemVkJiYoZT0kKGUsdGhpcy5hcnJheSkscz0kKHMsdGhpcy5hcnJheSkpLHRoaXMuYXJyYXlbdCswXT1lLHRoaXMuYXJyYXlbdCsxXT1zLHRoaXN9c2V0WFlaKHQsZSxzLG4pe3JldHVybiB0Kj10aGlzLml0ZW1TaXplLHRoaXMubm9ybWFsaXplZCYmKGU9JChlLHRoaXMuYXJyYXkpLHM9JChzLHRoaXMuYXJyYXkpLG49JChuLHRoaXMuYXJyYXkpKSx0aGlzLmFycmF5W3QrMF09ZSx0aGlzLmFycmF5W3QrMV09cyx0aGlzLmFycmF5W3QrMl09bix0aGlzfXNldFhZWlcodCxlLHMsbixpKXtyZXR1cm4gdCo9dGhpcy5pdGVtU2l6ZSx0aGlzLm5vcm1hbGl6ZWQmJihlPSQoZSx0aGlzLmFycmF5KSxzPSQocyx0aGlzLmFycmF5KSxuPSQobix0aGlzLmFycmF5KSxpPSQoaSx0aGlzLmFycmF5KSksdGhpcy5hcnJheVt0KzBdPWUsdGhpcy5hcnJheVt0KzFdPXMsdGhpcy5hcnJheVt0KzJdPW4sdGhpcy5hcnJheVt0KzNdPWksdGhpc31vblVwbG9hZCh0KXtyZXR1cm4gdGhpcy5vblVwbG9hZENhbGxiYWNrPXQsdGhpc31jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLmFycmF5LHRoaXMuaXRlbVNpemUpLmNvcHkodGhpcyl9dG9KU09OKCl7Y29uc3QgdD17aXRlbVNpemU6dGhpcy5pdGVtU2l6ZSx0eXBlOnRoaXMuYXJyYXkuY29uc3RydWN0b3IubmFtZSxhcnJheTpBcnJheS5mcm9tKHRoaXMuYXJyYXkpLG5vcm1hbGl6ZWQ6dGhpcy5ub3JtYWxpemVkfTtyZXR1cm4gdGhpcy5uYW1lIT09IiImJih0Lm5hbWU9dGhpcy5uYW1lKSx0aGlzLnVzYWdlIT09Q3MmJih0LnVzYWdlPXRoaXMudXNhZ2UpLHR9fWNsYXNzIG1hIGV4dGVuZHMgdnR7Y29uc3RydWN0b3IodCxlLHMpe3N1cGVyKG5ldyBVaW50MTZBcnJheSh0KSxlLHMpfX1jbGFzcyB5YSBleHRlbmRzIHZ0e2NvbnN0cnVjdG9yKHQsZSxzKXtzdXBlcihuZXcgVWludDMyQXJyYXkodCksZSxzKX19Y2xhc3MgZ2EgZXh0ZW5kcyB2dHtjb25zdHJ1Y3Rvcih0LGUscyl7c3VwZXIobmV3IEZsb2F0MzJBcnJheSh0KSxlLHMpfX1sZXQgeGE9MDtjb25zdCBBdD1uZXcgbnQsJG49bmV3IG5lLEVlPW5ldyBBLGd0PW5ldyBodCxzcz1uZXcgaHQsaXQ9bmV3IEE7Y2xhc3MgR24gZXh0ZW5kcyBaZXtjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5pc0J1ZmZlckdlb21ldHJ5PSEwLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCJpZCIse3ZhbHVlOnhhKyt9KSx0aGlzLnV1aWQ9S3QoKSx0aGlzLm5hbWU9IiIsdGhpcy50eXBlPSJCdWZmZXJHZW9tZXRyeSIsdGhpcy5pbmRleD1udWxsLHRoaXMuYXR0cmlidXRlcz17fSx0aGlzLm1vcnBoQXR0cmlidXRlcz17fSx0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlPSExLHRoaXMuZ3JvdXBzPVtdLHRoaXMuYm91bmRpbmdCb3g9bnVsbCx0aGlzLmJvdW5kaW5nU3BoZXJlPW51bGwsdGhpcy5kcmF3UmFuZ2U9e3N0YXJ0OjAsY291bnQ6MS8wfSx0aGlzLnVzZXJEYXRhPXt9fWdldEluZGV4KCl7cmV0dXJuIHRoaXMuaW5kZXh9c2V0SW5kZXgodCl7cmV0dXJuIEFycmF5LmlzQXJyYXkodCk/dGhpcy5pbmRleD1uZXcoc2EodCk/eWE6bWEpKHQsMSk6dGhpcy5pbmRleD10LHRoaXN9Z2V0QXR0cmlidXRlKHQpe3JldHVybiB0aGlzLmF0dHJpYnV0ZXNbdF19c2V0QXR0cmlidXRlKHQsZSl7cmV0dXJuIHRoaXMuYXR0cmlidXRlc1t0XT1lLHRoaXN9ZGVsZXRlQXR0cmlidXRlKHQpe3JldHVybiBkZWxldGUgdGhpcy5hdHRyaWJ1dGVzW3RdLHRoaXN9aGFzQXR0cmlidXRlKHQpe3JldHVybiB0aGlzLmF0dHJpYnV0ZXNbdF0hPT12b2lkIDB9YWRkR3JvdXAodCxlLHM9MCl7dGhpcy5ncm91cHMucHVzaCh7c3RhcnQ6dCxjb3VudDplLG1hdGVyaWFsSW5kZXg6c30pfWNsZWFyR3JvdXBzKCl7dGhpcy5ncm91cHM9W119c2V0RHJhd1JhbmdlKHQsZSl7dGhpcy5kcmF3UmFuZ2Uuc3RhcnQ9dCx0aGlzLmRyYXdSYW5nZS5jb3VudD1lfWFwcGx5TWF0cml4NCh0KXtjb25zdCBlPXRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbjtlIT09dm9pZCAwJiYoZS5hcHBseU1hdHJpeDQodCksZS5uZWVkc1VwZGF0ZT0hMCk7Y29uc3Qgcz10aGlzLmF0dHJpYnV0ZXMubm9ybWFsO2lmKHMhPT12b2lkIDApe2NvbnN0IGk9bmV3IEN0KCkuZ2V0Tm9ybWFsTWF0cml4KHQpO3MuYXBwbHlOb3JtYWxNYXRyaXgoaSkscy5uZWVkc1VwZGF0ZT0hMH1jb25zdCBuPXRoaXMuYXR0cmlidXRlcy50YW5nZW50O3JldHVybiBuIT09dm9pZCAwJiYobi50cmFuc2Zvcm1EaXJlY3Rpb24odCksbi5uZWVkc1VwZGF0ZT0hMCksdGhpcy5ib3VuZGluZ0JveCE9PW51bGwmJnRoaXMuY29tcHV0ZUJvdW5kaW5nQm94KCksdGhpcy5ib3VuZGluZ1NwaGVyZSE9PW51bGwmJnRoaXMuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCksdGhpc31hcHBseVF1YXRlcm5pb24odCl7cmV0dXJuIEF0Lm1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKHQpLHRoaXMuYXBwbHlNYXRyaXg0KEF0KSx0aGlzfXJvdGF0ZVgodCl7cmV0dXJuIEF0Lm1ha2VSb3RhdGlvblgodCksdGhpcy5hcHBseU1hdHJpeDQoQXQpLHRoaXN9cm90YXRlWSh0KXtyZXR1cm4gQXQubWFrZVJvdGF0aW9uWSh0KSx0aGlzLmFwcGx5TWF0cml4NChBdCksdGhpc31yb3RhdGVaKHQpe3JldHVybiBBdC5tYWtlUm90YXRpb25aKHQpLHRoaXMuYXBwbHlNYXRyaXg0KEF0KSx0aGlzfXRyYW5zbGF0ZSh0LGUscyl7cmV0dXJuIEF0Lm1ha2VUcmFuc2xhdGlvbih0LGUscyksdGhpcy5hcHBseU1hdHJpeDQoQXQpLHRoaXN9c2NhbGUodCxlLHMpe3JldHVybiBBdC5tYWtlU2NhbGUodCxlLHMpLHRoaXMuYXBwbHlNYXRyaXg0KEF0KSx0aGlzfWxvb2tBdCh0KXtyZXR1cm4gJG4ubG9va0F0KHQpLCRuLnVwZGF0ZU1hdHJpeCgpLHRoaXMuYXBwbHlNYXRyaXg0KCRuLm1hdHJpeCksdGhpc31jZW50ZXIoKXtyZXR1cm4gdGhpcy5jb21wdXRlQm91bmRpbmdCb3goKSx0aGlzLmJvdW5kaW5nQm94LmdldENlbnRlcihFZSkubmVnYXRlKCksdGhpcy50cmFuc2xhdGUoRWUueCxFZS55LEVlLnopLHRoaXN9c2V0RnJvbVBvaW50cyh0KXtjb25zdCBlPVtdO2ZvcihsZXQgcz0wLG49dC5sZW5ndGg7czxuO3MrKyl7Y29uc3QgaT10W3NdO2UucHVzaChpLngsaS55LGkuenx8MCl9cmV0dXJuIHRoaXMuc2V0QXR0cmlidXRlKCJwb3NpdGlvbiIsbmV3IGdhKGUsMykpLHRoaXN9Y29tcHV0ZUJvdW5kaW5nQm94KCl7dGhpcy5ib3VuZGluZ0JveD09PW51bGwmJih0aGlzLmJvdW5kaW5nQm94PW5ldyBodCk7Y29uc3QgdD10aGlzLmF0dHJpYnV0ZXMucG9zaXRpb24sZT10aGlzLm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbjtpZih0JiZ0LmlzR0xCdWZmZXJBdHRyaWJ1dGUpe2NvbnNvbGUuZXJyb3IoIlRIUkVFLkJ1ZmZlckdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ0JveCgpOiBHTEJ1ZmZlckF0dHJpYnV0ZSByZXF1aXJlcyBhIG1hbnVhbCBib3VuZGluZyBib3guIix0aGlzKSx0aGlzLmJvdW5kaW5nQm94LnNldChuZXcgQSgtMS8wLC0xLzAsLTEvMCksbmV3IEEoMS8wLDEvMCwxLzApKTtyZXR1cm59aWYodCE9PXZvaWQgMCl7aWYodGhpcy5ib3VuZGluZ0JveC5zZXRGcm9tQnVmZmVyQXR0cmlidXRlKHQpLGUpZm9yKGxldCBzPTAsbj1lLmxlbmd0aDtzPG47cysrKXtjb25zdCBpPWVbc107Z3Quc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZShpKSx0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlPyhpdC5hZGRWZWN0b3JzKHRoaXMuYm91bmRpbmdCb3gubWluLGd0Lm1pbiksdGhpcy5ib3VuZGluZ0JveC5leHBhbmRCeVBvaW50KGl0KSxpdC5hZGRWZWN0b3JzKHRoaXMuYm91bmRpbmdCb3gubWF4LGd0Lm1heCksdGhpcy5ib3VuZGluZ0JveC5leHBhbmRCeVBvaW50KGl0KSk6KHRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludChndC5taW4pLHRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludChndC5tYXgpKX19ZWxzZSB0aGlzLmJvdW5kaW5nQm94Lm1ha2VFbXB0eSgpOyhpc05hTih0aGlzLmJvdW5kaW5nQm94Lm1pbi54KXx8aXNOYU4odGhpcy5ib3VuZGluZ0JveC5taW4ueSl8fGlzTmFOKHRoaXMuYm91bmRpbmdCb3gubWluLnopKSYmY29uc29sZS5lcnJvcignVEhSRUUuQnVmZmVyR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nQm94KCk6IENvbXB1dGVkIG1pbi9tYXggaGF2ZSBOYU4gdmFsdWVzLiBUaGUgInBvc2l0aW9uIiBhdHRyaWJ1dGUgaXMgbGlrZWx5IHRvIGhhdmUgTmFOIHZhbHVlcy4nLHRoaXMpfWNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpe3RoaXMuYm91bmRpbmdTcGhlcmU9PT1udWxsJiYodGhpcy5ib3VuZGluZ1NwaGVyZT1uZXcgY3IpO2NvbnN0IHQ9dGhpcy5hdHRyaWJ1dGVzLnBvc2l0aW9uLGU9dGhpcy5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb247aWYodCYmdC5pc0dMQnVmZmVyQXR0cmlidXRlKXtjb25zb2xlLmVycm9yKCJUSFJFRS5CdWZmZXJHZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTogR0xCdWZmZXJBdHRyaWJ1dGUgcmVxdWlyZXMgYSBtYW51YWwgYm91bmRpbmcgc3BoZXJlLiIsdGhpcyksdGhpcy5ib3VuZGluZ1NwaGVyZS5zZXQobmV3IEEsMS8wKTtyZXR1cm59aWYodCl7Y29uc3Qgcz10aGlzLmJvdW5kaW5nU3BoZXJlLmNlbnRlcjtpZihndC5zZXRGcm9tQnVmZmVyQXR0cmlidXRlKHQpLGUpZm9yKGxldCBpPTAsbz1lLmxlbmd0aDtpPG87aSsrKXtjb25zdCBhPWVbaV07c3Muc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZShhKSx0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlPyhpdC5hZGRWZWN0b3JzKGd0Lm1pbixzcy5taW4pLGd0LmV4cGFuZEJ5UG9pbnQoaXQpLGl0LmFkZFZlY3RvcnMoZ3QubWF4LHNzLm1heCksZ3QuZXhwYW5kQnlQb2ludChpdCkpOihndC5leHBhbmRCeVBvaW50KHNzLm1pbiksZ3QuZXhwYW5kQnlQb2ludChzcy5tYXgpKX1ndC5nZXRDZW50ZXIocyk7bGV0IG49MDtmb3IobGV0IGk9MCxvPXQuY291bnQ7aTxvO2krKylpdC5mcm9tQnVmZmVyQXR0cmlidXRlKHQsaSksbj1NYXRoLm1heChuLHMuZGlzdGFuY2VUb1NxdWFyZWQoaXQpKTtpZihlKWZvcihsZXQgaT0wLG89ZS5sZW5ndGg7aTxvO2krKyl7Y29uc3QgYT1lW2ldLGM9dGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZTtmb3IobGV0IHU9MCxoPWEuY291bnQ7dTxoO3UrKylpdC5mcm9tQnVmZmVyQXR0cmlidXRlKGEsdSksYyYmKEVlLmZyb21CdWZmZXJBdHRyaWJ1dGUodCx1KSxpdC5hZGQoRWUpKSxuPU1hdGgubWF4KG4scy5kaXN0YW5jZVRvU3F1YXJlZChpdCkpfXRoaXMuYm91bmRpbmdTcGhlcmUucmFkaXVzPU1hdGguc3FydChuKSxpc05hTih0aGlzLmJvdW5kaW5nU3BoZXJlLnJhZGl1cykmJmNvbnNvbGUuZXJyb3IoJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOiBDb21wdXRlZCByYWRpdXMgaXMgTmFOLiBUaGUgInBvc2l0aW9uIiBhdHRyaWJ1dGUgaXMgbGlrZWx5IHRvIGhhdmUgTmFOIHZhbHVlcy4nLHRoaXMpfX1jb21wdXRlVGFuZ2VudHMoKXtjb25zdCB0PXRoaXMuaW5kZXgsZT10aGlzLmF0dHJpYnV0ZXM7aWYodD09PW51bGx8fGUucG9zaXRpb249PT12b2lkIDB8fGUubm9ybWFsPT09dm9pZCAwfHxlLnV2PT09dm9pZCAwKXtjb25zb2xlLmVycm9yKCJUSFJFRS5CdWZmZXJHZW9tZXRyeTogLmNvbXB1dGVUYW5nZW50cygpIGZhaWxlZC4gTWlzc2luZyByZXF1aXJlZCBhdHRyaWJ1dGVzIChpbmRleCwgcG9zaXRpb24sIG5vcm1hbCBvciB1dikiKTtyZXR1cm59Y29uc3Qgcz1lLnBvc2l0aW9uLG49ZS5ub3JtYWwsaT1lLnV2O3RoaXMuaGFzQXR0cmlidXRlKCJ0YW5nZW50Iik9PT0hMSYmdGhpcy5zZXRBdHRyaWJ1dGUoInRhbmdlbnQiLG5ldyB2dChuZXcgRmxvYXQzMkFycmF5KDQqcy5jb3VudCksNCkpO2NvbnN0IG89dGhpcy5nZXRBdHRyaWJ1dGUoInRhbmdlbnQiKSxhPVtdLGM9W107Zm9yKGxldCBFPTA7RTxzLmNvdW50O0UrKylhW0VdPW5ldyBBLGNbRV09bmV3IEE7Y29uc3QgdT1uZXcgQSxoPW5ldyBBLGw9bmV3IEEsZD1uZXcgSixmPW5ldyBKLHA9bmV3IEosbT1uZXcgQSxnPW5ldyBBO2Z1bmN0aW9uIHkoRSxGLFIpe3UuZnJvbUJ1ZmZlckF0dHJpYnV0ZShzLEUpLGguZnJvbUJ1ZmZlckF0dHJpYnV0ZShzLEYpLGwuZnJvbUJ1ZmZlckF0dHJpYnV0ZShzLFIpLGQuZnJvbUJ1ZmZlckF0dHJpYnV0ZShpLEUpLGYuZnJvbUJ1ZmZlckF0dHJpYnV0ZShpLEYpLHAuZnJvbUJ1ZmZlckF0dHJpYnV0ZShpLFIpLGguc3ViKHUpLGwuc3ViKHUpLGYuc3ViKGQpLHAuc3ViKGQpO2NvbnN0IEk9MS8oZi54KnAueS1wLngqZi55KTtpc0Zpbml0ZShJKSYmKG0uY29weShoKS5tdWx0aXBseVNjYWxhcihwLnkpLmFkZFNjYWxlZFZlY3RvcihsLC1mLnkpLm11bHRpcGx5U2NhbGFyKEkpLGcuY29weShsKS5tdWx0aXBseVNjYWxhcihmLngpLmFkZFNjYWxlZFZlY3RvcihoLC1wLngpLm11bHRpcGx5U2NhbGFyKEkpLGFbRV0uYWRkKG0pLGFbRl0uYWRkKG0pLGFbUl0uYWRkKG0pLGNbRV0uYWRkKGcpLGNbRl0uYWRkKGcpLGNbUl0uYWRkKGcpKX1sZXQgVD10aGlzLmdyb3VwcztULmxlbmd0aD09PTAmJihUPVt7c3RhcnQ6MCxjb3VudDp0LmNvdW50fV0pO2ZvcihsZXQgRT0wLEY9VC5sZW5ndGg7RTxGOysrRSl7Y29uc3QgUj1UW0VdLEk9Ui5zdGFydCxCPVIuY291bnQ7Zm9yKGxldCBQPUksTD1JK0I7UDxMO1ArPTMpeSh0LmdldFgoUCswKSx0LmdldFgoUCsxKSx0LmdldFgoUCsyKSl9Y29uc3Qgdz1uZXcgQSxNPW5ldyBBLE49bmV3IEEsXz1uZXcgQTtmdW5jdGlvbiBTKEUpe04uZnJvbUJ1ZmZlckF0dHJpYnV0ZShuLEUpLF8uY29weShOKTtjb25zdCBGPWFbRV07dy5jb3B5KEYpLHcuc3ViKE4ubXVsdGlwbHlTY2FsYXIoTi5kb3QoRikpKS5ub3JtYWxpemUoKSxNLmNyb3NzVmVjdG9ycyhfLEYpO2NvbnN0IEk9TS5kb3QoY1tFXSk8MD8tMToxO28uc2V0WFlaVyhFLHcueCx3Lnksdy56LEkpfWZvcihsZXQgRT0wLEY9VC5sZW5ndGg7RTxGOysrRSl7Y29uc3QgUj1UW0VdLEk9Ui5zdGFydCxCPVIuY291bnQ7Zm9yKGxldCBQPUksTD1JK0I7UDxMO1ArPTMpUyh0LmdldFgoUCswKSksUyh0LmdldFgoUCsxKSksUyh0LmdldFgoUCsyKSl9fWNvbXB1dGVWZXJ0ZXhOb3JtYWxzKCl7Y29uc3QgdD10aGlzLmluZGV4LGU9dGhpcy5nZXRBdHRyaWJ1dGUoInBvc2l0aW9uIik7aWYoZSE9PXZvaWQgMCl7bGV0IHM9dGhpcy5nZXRBdHRyaWJ1dGUoIm5vcm1hbCIpO2lmKHM9PT12b2lkIDApcz1uZXcgdnQobmV3IEZsb2F0MzJBcnJheShlLmNvdW50KjMpLDMpLHRoaXMuc2V0QXR0cmlidXRlKCJub3JtYWwiLHMpO2Vsc2UgZm9yKGxldCBkPTAsZj1zLmNvdW50O2Q8ZjtkKyspcy5zZXRYWVooZCwwLDAsMCk7Y29uc3Qgbj1uZXcgQSxpPW5ldyBBLG89bmV3IEEsYT1uZXcgQSxjPW5ldyBBLHU9bmV3IEEsaD1uZXcgQSxsPW5ldyBBO2lmKHQpZm9yKGxldCBkPTAsZj10LmNvdW50O2Q8ZjtkKz0zKXtjb25zdCBwPXQuZ2V0WChkKzApLG09dC5nZXRYKGQrMSksZz10LmdldFgoZCsyKTtuLmZyb21CdWZmZXJBdHRyaWJ1dGUoZSxwKSxpLmZyb21CdWZmZXJBdHRyaWJ1dGUoZSxtKSxvLmZyb21CdWZmZXJBdHRyaWJ1dGUoZSxnKSxoLnN1YlZlY3RvcnMobyxpKSxsLnN1YlZlY3RvcnMobixpKSxoLmNyb3NzKGwpLGEuZnJvbUJ1ZmZlckF0dHJpYnV0ZShzLHApLGMuZnJvbUJ1ZmZlckF0dHJpYnV0ZShzLG0pLHUuZnJvbUJ1ZmZlckF0dHJpYnV0ZShzLGcpLGEuYWRkKGgpLGMuYWRkKGgpLHUuYWRkKGgpLHMuc2V0WFlaKHAsYS54LGEueSxhLnopLHMuc2V0WFlaKG0sYy54LGMueSxjLnopLHMuc2V0WFlaKGcsdS54LHUueSx1LnopfWVsc2UgZm9yKGxldCBkPTAsZj1lLmNvdW50O2Q8ZjtkKz0zKW4uZnJvbUJ1ZmZlckF0dHJpYnV0ZShlLGQrMCksaS5mcm9tQnVmZmVyQXR0cmlidXRlKGUsZCsxKSxvLmZyb21CdWZmZXJBdHRyaWJ1dGUoZSxkKzIpLGguc3ViVmVjdG9ycyhvLGkpLGwuc3ViVmVjdG9ycyhuLGkpLGguY3Jvc3MobCkscy5zZXRYWVooZCswLGgueCxoLnksaC56KSxzLnNldFhZWihkKzEsaC54LGgueSxoLnopLHMuc2V0WFlaKGQrMixoLngsaC55LGgueik7dGhpcy5ub3JtYWxpemVOb3JtYWxzKCkscy5uZWVkc1VwZGF0ZT0hMH19bm9ybWFsaXplTm9ybWFscygpe2NvbnN0IHQ9dGhpcy5hdHRyaWJ1dGVzLm5vcm1hbDtmb3IobGV0IGU9MCxzPXQuY291bnQ7ZTxzO2UrKylpdC5mcm9tQnVmZmVyQXR0cmlidXRlKHQsZSksaXQubm9ybWFsaXplKCksdC5zZXRYWVooZSxpdC54LGl0LnksaXQueil9dG9Ob25JbmRleGVkKCl7ZnVuY3Rpb24gdChhLGMpe2NvbnN0IHU9YS5hcnJheSxoPWEuaXRlbVNpemUsbD1hLm5vcm1hbGl6ZWQsZD1uZXcgdS5jb25zdHJ1Y3RvcihjLmxlbmd0aCpoKTtsZXQgZj0wLHA9MDtmb3IobGV0IG09MCxnPWMubGVuZ3RoO208ZzttKyspe2EuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZT9mPWNbbV0qYS5kYXRhLnN0cmlkZSthLm9mZnNldDpmPWNbbV0qaDtmb3IobGV0IHk9MDt5PGg7eSsrKWRbcCsrXT11W2YrK119cmV0dXJuIG5ldyB2dChkLGgsbCl9aWYodGhpcy5pbmRleD09PW51bGwpcmV0dXJuIGNvbnNvbGUud2FybigiVEhSRUUuQnVmZmVyR2VvbWV0cnkudG9Ob25JbmRleGVkKCk6IEJ1ZmZlckdlb21ldHJ5IGlzIGFscmVhZHkgbm9uLWluZGV4ZWQuIiksdGhpcztjb25zdCBlPW5ldyBHbixzPXRoaXMuaW5kZXguYXJyYXksbj10aGlzLmF0dHJpYnV0ZXM7Zm9yKGNvbnN0IGEgaW4gbil7Y29uc3QgYz1uW2FdLHU9dChjLHMpO2Uuc2V0QXR0cmlidXRlKGEsdSl9Y29uc3QgaT10aGlzLm1vcnBoQXR0cmlidXRlcztmb3IoY29uc3QgYSBpbiBpKXtjb25zdCBjPVtdLHU9aVthXTtmb3IobGV0IGg9MCxsPXUubGVuZ3RoO2g8bDtoKyspe2NvbnN0IGQ9dVtoXSxmPXQoZCxzKTtjLnB1c2goZil9ZS5tb3JwaEF0dHJpYnV0ZXNbYV09Y31lLm1vcnBoVGFyZ2V0c1JlbGF0aXZlPXRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU7Y29uc3Qgbz10aGlzLmdyb3Vwcztmb3IobGV0IGE9MCxjPW8ubGVuZ3RoO2E8YzthKyspe2NvbnN0IHU9b1thXTtlLmFkZEdyb3VwKHUuc3RhcnQsdS5jb3VudCx1Lm1hdGVyaWFsSW5kZXgpfXJldHVybiBlfXRvSlNPTigpe2NvbnN0IHQ9e21ldGFkYXRhOnt2ZXJzaW9uOjQuNix0eXBlOiJCdWZmZXJHZW9tZXRyeSIsZ2VuZXJhdG9yOiJCdWZmZXJHZW9tZXRyeS50b0pTT04ifX07aWYodC51dWlkPXRoaXMudXVpZCx0LnR5cGU9dGhpcy50eXBlLHRoaXMubmFtZSE9PSIiJiYodC5uYW1lPXRoaXMubmFtZSksT2JqZWN0LmtleXModGhpcy51c2VyRGF0YSkubGVuZ3RoPjAmJih0LnVzZXJEYXRhPXRoaXMudXNlckRhdGEpLHRoaXMucGFyYW1ldGVycyE9PXZvaWQgMCl7Y29uc3QgYz10aGlzLnBhcmFtZXRlcnM7Zm9yKGNvbnN0IHUgaW4gYyljW3VdIT09dm9pZCAwJiYodFt1XT1jW3VdKTtyZXR1cm4gdH10LmRhdGE9e2F0dHJpYnV0ZXM6e319O2NvbnN0IGU9dGhpcy5pbmRleDtlIT09bnVsbCYmKHQuZGF0YS5pbmRleD17dHlwZTplLmFycmF5LmNvbnN0cnVjdG9yLm5hbWUsYXJyYXk6QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZS5hcnJheSl9KTtjb25zdCBzPXRoaXMuYXR0cmlidXRlcztmb3IoY29uc3QgYyBpbiBzKXtjb25zdCB1PXNbY107dC5kYXRhLmF0dHJpYnV0ZXNbY109dS50b0pTT04odC5kYXRhKX1jb25zdCBuPXt9O2xldCBpPSExO2Zvcihjb25zdCBjIGluIHRoaXMubW9ycGhBdHRyaWJ1dGVzKXtjb25zdCB1PXRoaXMubW9ycGhBdHRyaWJ1dGVzW2NdLGg9W107Zm9yKGxldCBsPTAsZD11Lmxlbmd0aDtsPGQ7bCsrKXtjb25zdCBmPXVbbF07aC5wdXNoKGYudG9KU09OKHQuZGF0YSkpfWgubGVuZ3RoPjAmJihuW2NdPWgsaT0hMCl9aSYmKHQuZGF0YS5tb3JwaEF0dHJpYnV0ZXM9bix0LmRhdGEubW9ycGhUYXJnZXRzUmVsYXRpdmU9dGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZSk7Y29uc3Qgbz10aGlzLmdyb3VwcztvLmxlbmd0aD4wJiYodC5kYXRhLmdyb3Vwcz1KU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG8pKSk7Y29uc3QgYT10aGlzLmJvdW5kaW5nU3BoZXJlO3JldHVybiBhIT09bnVsbCYmKHQuZGF0YS5ib3VuZGluZ1NwaGVyZT17Y2VudGVyOmEuY2VudGVyLnRvQXJyYXkoKSxyYWRpdXM6YS5yYWRpdXN9KSx0fWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSh0aGlzKX1jb3B5KHQpe3RoaXMuaW5kZXg9bnVsbCx0aGlzLmF0dHJpYnV0ZXM9e30sdGhpcy5tb3JwaEF0dHJpYnV0ZXM9e30sdGhpcy5ncm91cHM9W10sdGhpcy5ib3VuZGluZ0JveD1udWxsLHRoaXMuYm91bmRpbmdTcGhlcmU9bnVsbDtjb25zdCBlPXt9O3RoaXMubmFtZT10Lm5hbWU7Y29uc3Qgcz10LmluZGV4O3MhPT1udWxsJiZ0aGlzLnNldEluZGV4KHMuY2xvbmUoZSkpO2NvbnN0IG49dC5hdHRyaWJ1dGVzO2Zvcihjb25zdCB1IGluIG4pe2NvbnN0IGg9blt1XTt0aGlzLnNldEF0dHJpYnV0ZSh1LGguY2xvbmUoZSkpfWNvbnN0IGk9dC5tb3JwaEF0dHJpYnV0ZXM7Zm9yKGNvbnN0IHUgaW4gaSl7Y29uc3QgaD1bXSxsPWlbdV07Zm9yKGxldCBkPTAsZj1sLmxlbmd0aDtkPGY7ZCsrKWgucHVzaChsW2RdLmNsb25lKGUpKTt0aGlzLm1vcnBoQXR0cmlidXRlc1t1XT1ofXRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU9dC5tb3JwaFRhcmdldHNSZWxhdGl2ZTtjb25zdCBvPXQuZ3JvdXBzO2ZvcihsZXQgdT0wLGg9by5sZW5ndGg7dTxoO3UrKyl7Y29uc3QgbD1vW3VdO3RoaXMuYWRkR3JvdXAobC5zdGFydCxsLmNvdW50LGwubWF0ZXJpYWxJbmRleCl9Y29uc3QgYT10LmJvdW5kaW5nQm94O2EhPT1udWxsJiYodGhpcy5ib3VuZGluZ0JveD1hLmNsb25lKCkpO2NvbnN0IGM9dC5ib3VuZGluZ1NwaGVyZTtyZXR1cm4gYyE9PW51bGwmJih0aGlzLmJvdW5kaW5nU3BoZXJlPWMuY2xvbmUoKSksdGhpcy5kcmF3UmFuZ2Uuc3RhcnQ9dC5kcmF3UmFuZ2Uuc3RhcnQsdGhpcy5kcmF3UmFuZ2UuY291bnQ9dC5kcmF3UmFuZ2UuY291bnQsdGhpcy51c2VyRGF0YT10LnVzZXJEYXRhLHRoaXN9ZGlzcG9zZSgpe3RoaXMuZGlzcGF0Y2hFdmVudCh7dHlwZToiZGlzcG9zZSJ9KX19Y29uc3QgV249bmV3IEEsVGE9bmV3IEEsTmE9bmV3IEN0O2NsYXNzIFhue2NvbnN0cnVjdG9yKHQ9bmV3IEEoMSwwLDApLGU9MCl7dGhpcy5pc1BsYW5lPSEwLHRoaXMubm9ybWFsPXQsdGhpcy5jb25zdGFudD1lfXNldCh0LGUpe3JldHVybiB0aGlzLm5vcm1hbC5jb3B5KHQpLHRoaXMuY29uc3RhbnQ9ZSx0aGlzfXNldENvbXBvbmVudHModCxlLHMsbil7cmV0dXJuIHRoaXMubm9ybWFsLnNldCh0LGUscyksdGhpcy5jb25zdGFudD1uLHRoaXN9c2V0RnJvbU5vcm1hbEFuZENvcGxhbmFyUG9pbnQodCxlKXtyZXR1cm4gdGhpcy5ub3JtYWwuY29weSh0KSx0aGlzLmNvbnN0YW50PS1lLmRvdCh0aGlzLm5vcm1hbCksdGhpc31zZXRGcm9tQ29wbGFuYXJQb2ludHModCxlLHMpe2NvbnN0IG49V24uc3ViVmVjdG9ycyhzLGUpLmNyb3NzKFRhLnN1YlZlY3RvcnModCxlKSkubm9ybWFsaXplKCk7cmV0dXJuIHRoaXMuc2V0RnJvbU5vcm1hbEFuZENvcGxhbmFyUG9pbnQobix0KSx0aGlzfWNvcHkodCl7cmV0dXJuIHRoaXMubm9ybWFsLmNvcHkodC5ub3JtYWwpLHRoaXMuY29uc3RhbnQ9dC5jb25zdGFudCx0aGlzfW5vcm1hbGl6ZSgpe2NvbnN0IHQ9MS90aGlzLm5vcm1hbC5sZW5ndGgoKTtyZXR1cm4gdGhpcy5ub3JtYWwubXVsdGlwbHlTY2FsYXIodCksdGhpcy5jb25zdGFudCo9dCx0aGlzfW5lZ2F0ZSgpe3JldHVybiB0aGlzLmNvbnN0YW50Kj0tMSx0aGlzLm5vcm1hbC5uZWdhdGUoKSx0aGlzfWRpc3RhbmNlVG9Qb2ludCh0KXtyZXR1cm4gdGhpcy5ub3JtYWwuZG90KHQpK3RoaXMuY29uc3RhbnR9ZGlzdGFuY2VUb1NwaGVyZSh0KXtyZXR1cm4gdGhpcy5kaXN0YW5jZVRvUG9pbnQodC5jZW50ZXIpLXQucmFkaXVzfXByb2plY3RQb2ludCh0LGUpe3JldHVybiBlLmNvcHkodCkuYWRkU2NhbGVkVmVjdG9yKHRoaXMubm9ybWFsLC10aGlzLmRpc3RhbmNlVG9Qb2ludCh0KSl9aW50ZXJzZWN0TGluZSh0LGUpe2NvbnN0IHM9dC5kZWx0YShXbiksbj10aGlzLm5vcm1hbC5kb3Qocyk7aWYobj09PTApcmV0dXJuIHRoaXMuZGlzdGFuY2VUb1BvaW50KHQuc3RhcnQpPT09MD9lLmNvcHkodC5zdGFydCk6bnVsbDtjb25zdCBpPS0odC5zdGFydC5kb3QodGhpcy5ub3JtYWwpK3RoaXMuY29uc3RhbnQpL247cmV0dXJuIGk8MHx8aT4xP251bGw6ZS5jb3B5KHQuc3RhcnQpLmFkZFNjYWxlZFZlY3RvcihzLGkpfWludGVyc2VjdHNMaW5lKHQpe2NvbnN0IGU9dGhpcy5kaXN0YW5jZVRvUG9pbnQodC5zdGFydCkscz10aGlzLmRpc3RhbmNlVG9Qb2ludCh0LmVuZCk7cmV0dXJuIGU8MCYmcz4wfHxzPDAmJmU+MH1pbnRlcnNlY3RzQm94KHQpe3JldHVybiB0LmludGVyc2VjdHNQbGFuZSh0aGlzKX1pbnRlcnNlY3RzU3BoZXJlKHQpe3JldHVybiB0LmludGVyc2VjdHNQbGFuZSh0aGlzKX1jb3BsYW5hclBvaW50KHQpe3JldHVybiB0LmNvcHkodGhpcy5ub3JtYWwpLm11bHRpcGx5U2NhbGFyKC10aGlzLmNvbnN0YW50KX1hcHBseU1hdHJpeDQodCxlKXtjb25zdCBzPWV8fE5hLmdldE5vcm1hbE1hdHJpeCh0KSxuPXRoaXMuY29wbGFuYXJQb2ludChXbikuYXBwbHlNYXRyaXg0KHQpLGk9dGhpcy5ub3JtYWwuYXBwbHlNYXRyaXgzKHMpLm5vcm1hbGl6ZSgpO3JldHVybiB0aGlzLmNvbnN0YW50PS1uLmRvdChpKSx0aGlzfXRyYW5zbGF0ZSh0KXtyZXR1cm4gdGhpcy5jb25zdGFudC09dC5kb3QodGhpcy5ub3JtYWwpLHRoaXN9ZXF1YWxzKHQpe3JldHVybiB0Lm5vcm1hbC5lcXVhbHModGhpcy5ub3JtYWwpJiZ0LmNvbnN0YW50PT09dGhpcy5jb25zdGFudH1jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkodGhpcyl9fWNsYXNzIHhyIGV4dGVuZHMgRHR7Y29uc3RydWN0b3IodCxlLHMsbixpLG8sYSxjLHUsaD1Tbil7aWYoaCE9PVNuJiZoIT09WGkpdGhyb3cgbmV3IEVycm9yKCJEZXB0aFRleHR1cmUgZm9ybWF0IG11c3QgYmUgZWl0aGVyIFRIUkVFLkRlcHRoRm9ybWF0IG9yIFRIUkVFLkRlcHRoU3RlbmNpbEZvcm1hdCIpO3M9PT12b2lkIDAmJmg9PT1TbiYmKHM9V2kpLHM9PT12b2lkIDAmJmg9PT1YaSYmKHM9UG8pLHN1cGVyKG51bGwsbixpLG8sYSxjLGgscyx1KSx0aGlzLmlzRGVwdGhUZXh0dXJlPSEwLHRoaXMuaW1hZ2U9e3dpZHRoOnQsaGVpZ2h0OmV9LHRoaXMubWFnRmlsdGVyPWEhPT12b2lkIDA/YTp6cyx0aGlzLm1pbkZpbHRlcj1jIT09dm9pZCAwP2M6enMsdGhpcy5mbGlwWT0hMSx0aGlzLmdlbmVyYXRlTWlwbWFwcz0hMSx0aGlzLmNvbXBhcmVGdW5jdGlvbj1udWxsfWNvcHkodCl7cmV0dXJuIHN1cGVyLmNvcHkodCksdGhpcy5jb21wYXJlRnVuY3Rpb249dC5jb21wYXJlRnVuY3Rpb24sdGhpc310b0pTT04odCl7Y29uc3QgZT1zdXBlci50b0pTT04odCk7cmV0dXJuIHRoaXMuY29tcGFyZUZ1bmN0aW9uIT09bnVsbCYmKGUuY29tcGFyZUZ1bmN0aW9uPXRoaXMuY29tcGFyZUZ1bmN0aW9uKSxlfX1jbGFzcyB3YXtjb25zdHJ1Y3Rvcih0LGUpe3RoaXMuaXNJbnRlcmxlYXZlZEJ1ZmZlcj0hMCx0aGlzLmFycmF5PXQsdGhpcy5zdHJpZGU9ZSx0aGlzLmNvdW50PXQhPT12b2lkIDA/dC5sZW5ndGgvZTowLHRoaXMudXNhZ2U9Q3MsdGhpcy51cGRhdGVSYW5nZXM9W10sdGhpcy52ZXJzaW9uPTAsdGhpcy51dWlkPUt0KCl9b25VcGxvYWRDYWxsYmFjaygpe31zZXQgbmVlZHNVcGRhdGUodCl7dD09PSEwJiZ0aGlzLnZlcnNpb24rK31zZXRVc2FnZSh0KXtyZXR1cm4gdGhpcy51c2FnZT10LHRoaXN9YWRkVXBkYXRlUmFuZ2UodCxlKXt0aGlzLnVwZGF0ZVJhbmdlcy5wdXNoKHtzdGFydDp0LGNvdW50OmV9KX1jbGVhclVwZGF0ZVJhbmdlcygpe3RoaXMudXBkYXRlUmFuZ2VzLmxlbmd0aD0wfWNvcHkodCl7cmV0dXJuIHRoaXMuYXJyYXk9bmV3IHQuYXJyYXkuY29uc3RydWN0b3IodC5hcnJheSksdGhpcy5jb3VudD10LmNvdW50LHRoaXMuc3RyaWRlPXQuc3RyaWRlLHRoaXMudXNhZ2U9dC51c2FnZSx0aGlzfWNvcHlBdCh0LGUscyl7dCo9dGhpcy5zdHJpZGUscyo9ZS5zdHJpZGU7Zm9yKGxldCBuPTAsaT10aGlzLnN0cmlkZTtuPGk7bisrKXRoaXMuYXJyYXlbdCtuXT1lLmFycmF5W3Mrbl07cmV0dXJuIHRoaXN9c2V0KHQsZT0wKXtyZXR1cm4gdGhpcy5hcnJheS5zZXQodCxlKSx0aGlzfWNsb25lKHQpe3QuYXJyYXlCdWZmZXJzPT09dm9pZCAwJiYodC5hcnJheUJ1ZmZlcnM9e30pLHRoaXMuYXJyYXkuYnVmZmVyLl91dWlkPT09dm9pZCAwJiYodGhpcy5hcnJheS5idWZmZXIuX3V1aWQ9S3QoKSksdC5hcnJheUJ1ZmZlcnNbdGhpcy5hcnJheS5idWZmZXIuX3V1aWRdPT09dm9pZCAwJiYodC5hcnJheUJ1ZmZlcnNbdGhpcy5hcnJheS5idWZmZXIuX3V1aWRdPXRoaXMuYXJyYXkuc2xpY2UoMCkuYnVmZmVyKTtjb25zdCBlPW5ldyB0aGlzLmFycmF5LmNvbnN0cnVjdG9yKHQuYXJyYXlCdWZmZXJzW3RoaXMuYXJyYXkuYnVmZmVyLl91dWlkXSkscz1uZXcgdGhpcy5jb25zdHJ1Y3RvcihlLHRoaXMuc3RyaWRlKTtyZXR1cm4gcy5zZXRVc2FnZSh0aGlzLnVzYWdlKSxzfW9uVXBsb2FkKHQpe3JldHVybiB0aGlzLm9uVXBsb2FkQ2FsbGJhY2s9dCx0aGlzfXRvSlNPTih0KXtyZXR1cm4gdC5hcnJheUJ1ZmZlcnM9PT12b2lkIDAmJih0LmFycmF5QnVmZmVycz17fSksdGhpcy5hcnJheS5idWZmZXIuX3V1aWQ9PT12b2lkIDAmJih0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZD1LdCgpKSx0LmFycmF5QnVmZmVyc1t0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZF09PT12b2lkIDAmJih0LmFycmF5QnVmZmVyc1t0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZF09QXJyYXkuZnJvbShuZXcgVWludDMyQXJyYXkodGhpcy5hcnJheS5idWZmZXIpKSkse3V1aWQ6dGhpcy51dWlkLGJ1ZmZlcjp0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZCx0eXBlOnRoaXMuYXJyYXkuY29uc3RydWN0b3IubmFtZSxzdHJpZGU6dGhpcy5zdHJpZGV9fX1jb25zdCB1dD1uZXcgQTtjbGFzcyBZbntjb25zdHJ1Y3Rvcih0LGUscyxuPSExKXt0aGlzLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGU9ITAsdGhpcy5uYW1lPSIiLHRoaXMuZGF0YT10LHRoaXMuaXRlbVNpemU9ZSx0aGlzLm9mZnNldD1zLHRoaXMubm9ybWFsaXplZD1ufWdldCBjb3VudCgpe3JldHVybiB0aGlzLmRhdGEuY291bnR9Z2V0IGFycmF5KCl7cmV0dXJuIHRoaXMuZGF0YS5hcnJheX1zZXQgbmVlZHNVcGRhdGUodCl7dGhpcy5kYXRhLm5lZWRzVXBkYXRlPXR9YXBwbHlNYXRyaXg0KHQpe2ZvcihsZXQgZT0wLHM9dGhpcy5kYXRhLmNvdW50O2U8cztlKyspdXQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0aGlzLGUpLHV0LmFwcGx5TWF0cml4NCh0KSx0aGlzLnNldFhZWihlLHV0LngsdXQueSx1dC56KTtyZXR1cm4gdGhpc31hcHBseU5vcm1hbE1hdHJpeCh0KXtmb3IobGV0IGU9MCxzPXRoaXMuY291bnQ7ZTxzO2UrKyl1dC5mcm9tQnVmZmVyQXR0cmlidXRlKHRoaXMsZSksdXQuYXBwbHlOb3JtYWxNYXRyaXgodCksdGhpcy5zZXRYWVooZSx1dC54LHV0LnksdXQueik7cmV0dXJuIHRoaXN9dHJhbnNmb3JtRGlyZWN0aW9uKHQpe2ZvcihsZXQgZT0wLHM9dGhpcy5jb3VudDtlPHM7ZSsrKXV0LmZyb21CdWZmZXJBdHRyaWJ1dGUodGhpcyxlKSx1dC50cmFuc2Zvcm1EaXJlY3Rpb24odCksdGhpcy5zZXRYWVooZSx1dC54LHV0LnksdXQueik7cmV0dXJuIHRoaXN9Z2V0Q29tcG9uZW50KHQsZSl7bGV0IHM9dGhpcy5hcnJheVt0KnRoaXMuZGF0YS5zdHJpZGUrdGhpcy5vZmZzZXQrZV07cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKHM9RXQocyx0aGlzLmFycmF5KSksc31zZXRDb21wb25lbnQodCxlLHMpe3JldHVybiB0aGlzLm5vcm1hbGl6ZWQmJihzPSQocyx0aGlzLmFycmF5KSksdGhpcy5kYXRhLmFycmF5W3QqdGhpcy5kYXRhLnN0cmlkZSt0aGlzLm9mZnNldCtlXT1zLHRoaXN9c2V0WCh0LGUpe3JldHVybiB0aGlzLm5vcm1hbGl6ZWQmJihlPSQoZSx0aGlzLmFycmF5KSksdGhpcy5kYXRhLmFycmF5W3QqdGhpcy5kYXRhLnN0cmlkZSt0aGlzLm9mZnNldF09ZSx0aGlzfXNldFkodCxlKXtyZXR1cm4gdGhpcy5ub3JtYWxpemVkJiYoZT0kKGUsdGhpcy5hcnJheSkpLHRoaXMuZGF0YS5hcnJheVt0KnRoaXMuZGF0YS5zdHJpZGUrdGhpcy5vZmZzZXQrMV09ZSx0aGlzfXNldFoodCxlKXtyZXR1cm4gdGhpcy5ub3JtYWxpemVkJiYoZT0kKGUsdGhpcy5hcnJheSkpLHRoaXMuZGF0YS5hcnJheVt0KnRoaXMuZGF0YS5zdHJpZGUrdGhpcy5vZmZzZXQrMl09ZSx0aGlzfXNldFcodCxlKXtyZXR1cm4gdGhpcy5ub3JtYWxpemVkJiYoZT0kKGUsdGhpcy5hcnJheSkpLHRoaXMuZGF0YS5hcnJheVt0KnRoaXMuZGF0YS5zdHJpZGUrdGhpcy5vZmZzZXQrM109ZSx0aGlzfWdldFgodCl7bGV0IGU9dGhpcy5kYXRhLmFycmF5W3QqdGhpcy5kYXRhLnN0cmlkZSt0aGlzLm9mZnNldF07cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGU9RXQoZSx0aGlzLmFycmF5KSksZX1nZXRZKHQpe2xldCBlPXRoaXMuZGF0YS5hcnJheVt0KnRoaXMuZGF0YS5zdHJpZGUrdGhpcy5vZmZzZXQrMV07cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGU9RXQoZSx0aGlzLmFycmF5KSksZX1nZXRaKHQpe2xldCBlPXRoaXMuZGF0YS5hcnJheVt0KnRoaXMuZGF0YS5zdHJpZGUrdGhpcy5vZmZzZXQrMl07cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGU9RXQoZSx0aGlzLmFycmF5KSksZX1nZXRXKHQpe2xldCBlPXRoaXMuZGF0YS5hcnJheVt0KnRoaXMuZGF0YS5zdHJpZGUrdGhpcy5vZmZzZXQrM107cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGU9RXQoZSx0aGlzLmFycmF5KSksZX1zZXRYWSh0LGUscyl7cmV0dXJuIHQ9dCp0aGlzLmRhdGEuc3RyaWRlK3RoaXMub2Zmc2V0LHRoaXMubm9ybWFsaXplZCYmKGU9JChlLHRoaXMuYXJyYXkpLHM9JChzLHRoaXMuYXJyYXkpKSx0aGlzLmRhdGEuYXJyYXlbdCswXT1lLHRoaXMuZGF0YS5hcnJheVt0KzFdPXMsdGhpc31zZXRYWVoodCxlLHMsbil7cmV0dXJuIHQ9dCp0aGlzLmRhdGEuc3RyaWRlK3RoaXMub2Zmc2V0LHRoaXMubm9ybWFsaXplZCYmKGU9JChlLHRoaXMuYXJyYXkpLHM9JChzLHRoaXMuYXJyYXkpLG49JChuLHRoaXMuYXJyYXkpKSx0aGlzLmRhdGEuYXJyYXlbdCswXT1lLHRoaXMuZGF0YS5hcnJheVt0KzFdPXMsdGhpcy5kYXRhLmFycmF5W3QrMl09bix0aGlzfXNldFhZWlcodCxlLHMsbixpKXtyZXR1cm4gdD10KnRoaXMuZGF0YS5zdHJpZGUrdGhpcy5vZmZzZXQsdGhpcy5ub3JtYWxpemVkJiYoZT0kKGUsdGhpcy5hcnJheSkscz0kKHMsdGhpcy5hcnJheSksbj0kKG4sdGhpcy5hcnJheSksaT0kKGksdGhpcy5hcnJheSkpLHRoaXMuZGF0YS5hcnJheVt0KzBdPWUsdGhpcy5kYXRhLmFycmF5W3QrMV09cyx0aGlzLmRhdGEuYXJyYXlbdCsyXT1uLHRoaXMuZGF0YS5hcnJheVt0KzNdPWksdGhpc31jbG9uZSh0KXtpZih0PT09dm9pZCAwKXtjb25zb2xlLmxvZygiVEhSRUUuSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUuY2xvbmUoKTogQ2xvbmluZyBhbiBpbnRlcmxlYXZlZCBidWZmZXIgYXR0cmlidXRlIHdpbGwgZGUtaW50ZXJsZWF2ZSBidWZmZXIgZGF0YS4iKTtjb25zdCBlPVtdO2ZvcihsZXQgcz0wO3M8dGhpcy5jb3VudDtzKyspe2NvbnN0IG49cyp0aGlzLmRhdGEuc3RyaWRlK3RoaXMub2Zmc2V0O2ZvcihsZXQgaT0wO2k8dGhpcy5pdGVtU2l6ZTtpKyspZS5wdXNoKHRoaXMuZGF0YS5hcnJheVtuK2ldKX1yZXR1cm4gbmV3IHZ0KG5ldyB0aGlzLmFycmF5LmNvbnN0cnVjdG9yKGUpLHRoaXMuaXRlbVNpemUsdGhpcy5ub3JtYWxpemVkKX1lbHNlIHJldHVybiB0LmludGVybGVhdmVkQnVmZmVycz09PXZvaWQgMCYmKHQuaW50ZXJsZWF2ZWRCdWZmZXJzPXt9KSx0LmludGVybGVhdmVkQnVmZmVyc1t0aGlzLmRhdGEudXVpZF09PT12b2lkIDAmJih0LmludGVybGVhdmVkQnVmZmVyc1t0aGlzLmRhdGEudXVpZF09dGhpcy5kYXRhLmNsb25lKHQpKSxuZXcgWW4odC5pbnRlcmxlYXZlZEJ1ZmZlcnNbdGhpcy5kYXRhLnV1aWRdLHRoaXMuaXRlbVNpemUsdGhpcy5vZmZzZXQsdGhpcy5ub3JtYWxpemVkKX10b0pTT04odCl7aWYodD09PXZvaWQgMCl7Y29uc29sZS5sb2coIlRIUkVFLkludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlLnRvSlNPTigpOiBTZXJpYWxpemluZyBhbiBpbnRlcmxlYXZlZCBidWZmZXIgYXR0cmlidXRlIHdpbGwgZGUtaW50ZXJsZWF2ZSBidWZmZXIgZGF0YS4iKTtjb25zdCBlPVtdO2ZvcihsZXQgcz0wO3M8dGhpcy5jb3VudDtzKyspe2NvbnN0IG49cyp0aGlzLmRhdGEuc3RyaWRlK3RoaXMub2Zmc2V0O2ZvcihsZXQgaT0wO2k8dGhpcy5pdGVtU2l6ZTtpKyspZS5wdXNoKHRoaXMuZGF0YS5hcnJheVtuK2ldKX1yZXR1cm57aXRlbVNpemU6dGhpcy5pdGVtU2l6ZSx0eXBlOnRoaXMuYXJyYXkuY29uc3RydWN0b3IubmFtZSxhcnJheTplLG5vcm1hbGl6ZWQ6dGhpcy5ub3JtYWxpemVkfX1lbHNlIHJldHVybiB0LmludGVybGVhdmVkQnVmZmVycz09PXZvaWQgMCYmKHQuaW50ZXJsZWF2ZWRCdWZmZXJzPXt9KSx0LmludGVybGVhdmVkQnVmZmVyc1t0aGlzLmRhdGEudXVpZF09PT12b2lkIDAmJih0LmludGVybGVhdmVkQnVmZmVyc1t0aGlzLmRhdGEudXVpZF09dGhpcy5kYXRhLnRvSlNPTih0KSkse2lzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGU6ITAsaXRlbVNpemU6dGhpcy5pdGVtU2l6ZSxkYXRhOnRoaXMuZGF0YS51dWlkLG9mZnNldDp0aGlzLm9mZnNldCxub3JtYWxpemVkOnRoaXMubm9ybWFsaXplZH19fWNsYXNzIEFhIGV4dGVuZHMgRHR7Y29uc3RydWN0b3IodCxlKXtzdXBlcih7d2lkdGg6dCxoZWlnaHQ6ZX0pLHRoaXMuaXNGcmFtZWJ1ZmZlclRleHR1cmU9ITAsdGhpcy5tYWdGaWx0ZXI9enMsdGhpcy5taW5GaWx0ZXI9enMsdGhpcy5nZW5lcmF0ZU1pcG1hcHM9ITEsdGhpcy5uZWVkc1VwZGF0ZT0hMH19Y29uc3QgVHI9bmV3IEEsRHM9bmV3IEE7Y2xhc3MgWnR7Y29uc3RydWN0b3IodD1uZXcgQSxlPW5ldyBBKXt0aGlzLnN0YXJ0PXQsdGhpcy5lbmQ9ZX1zZXQodCxlKXtyZXR1cm4gdGhpcy5zdGFydC5jb3B5KHQpLHRoaXMuZW5kLmNvcHkoZSksdGhpc31jb3B5KHQpe3JldHVybiB0aGlzLnN0YXJ0LmNvcHkodC5zdGFydCksdGhpcy5lbmQuY29weSh0LmVuZCksdGhpc31nZXRDZW50ZXIodCl7cmV0dXJuIHQuYWRkVmVjdG9ycyh0aGlzLnN0YXJ0LHRoaXMuZW5kKS5tdWx0aXBseVNjYWxhciguNSl9ZGVsdGEodCl7cmV0dXJuIHQuc3ViVmVjdG9ycyh0aGlzLmVuZCx0aGlzLnN0YXJ0KX1kaXN0YW5jZVNxKCl7cmV0dXJuIHRoaXMuc3RhcnQuZGlzdGFuY2VUb1NxdWFyZWQodGhpcy5lbmQpfWRpc3RhbmNlKCl7cmV0dXJuIHRoaXMuc3RhcnQuZGlzdGFuY2VUbyh0aGlzLmVuZCl9YXQodCxlKXtyZXR1cm4gdGhpcy5kZWx0YShlKS5tdWx0aXBseVNjYWxhcih0KS5hZGQodGhpcy5zdGFydCl9Y2xvc2VzdFBvaW50VG9Qb2ludFBhcmFtZXRlcih0LGUpe1RyLnN1YlZlY3RvcnModCx0aGlzLnN0YXJ0KSxEcy5zdWJWZWN0b3JzKHRoaXMuZW5kLHRoaXMuc3RhcnQpO2NvbnN0IHM9RHMuZG90KERzKTtsZXQgaT1Ecy5kb3QoVHIpL3M7cmV0dXJuIGUmJihpPWF0KGksMCwxKSksaX1jbG9zZXN0UG9pbnRUb1BvaW50KHQsZSxzKXtjb25zdCBuPXRoaXMuY2xvc2VzdFBvaW50VG9Qb2ludFBhcmFtZXRlcih0LGUpO3JldHVybiB0aGlzLmRlbHRhKHMpLm11bHRpcGx5U2NhbGFyKG4pLmFkZCh0aGlzLnN0YXJ0KX1hcHBseU1hdHJpeDQodCl7cmV0dXJuIHRoaXMuc3RhcnQuYXBwbHlNYXRyaXg0KHQpLHRoaXMuZW5kLmFwcGx5TWF0cml4NCh0KSx0aGlzfWVxdWFscyh0KXtyZXR1cm4gdC5zdGFydC5lcXVhbHModGhpcy5zdGFydCkmJnQuZW5kLmVxdWFscyh0aGlzLmVuZCl9Y2xvbmUoKXtyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KHRoaXMpfX1mdW5jdGlvbiBabihyLHQ9MCl7bGV0IGU9MzczNTkyODU1OV50LHM9MTEwMzU0Nzk5MV50O2lmKHIgaW5zdGFuY2VvZiBBcnJheSlmb3IobGV0IG49MCxpO248ci5sZW5ndGg7bisrKWk9cltuXSxlPU1hdGguaW11bChlXmksMjY1NDQzNTc2MSkscz1NYXRoLmltdWwoc15pLDE1OTczMzQ2NzcpO2Vsc2UgZm9yKGxldCBuPTAsaTtuPHIubGVuZ3RoO24rKylpPXIuY2hhckNvZGVBdChuKSxlPU1hdGguaW11bChlXmksMjY1NDQzNTc2MSkscz1NYXRoLmltdWwoc15pLDE1OTczMzQ2NzcpO3JldHVybiBlPU1hdGguaW11bChlXmU+Pj4xNiwyMjQ2ODIyNTA3KSxlXj1NYXRoLmltdWwoc15zPj4+MTMsMzI2NjQ4OTkwOSkscz1NYXRoLmltdWwoc15zPj4+MTYsMjI0NjgyMjUwNyksc149TWF0aC5pbXVsKGVeZT4+PjEzLDMyNjY0ODk5MDkpLDQyOTQ5NjcyOTYqKDIwOTcxNTEmcykrKGU+Pj4wKX1jb25zdCBNYT0oLi4ucik9PlpuKHIpO2Z1bmN0aW9uIFNhKHIsdD0hMSl7Y29uc3QgZT1bXTtyLmlzTm9kZT09PSEwJiYoZS5wdXNoKHIuaWQpLHI9ci5nZXRTZWxmKCkpO2Zvcihjb25zdHtwcm9wZXJ0eTpzLGNoaWxkTm9kZTpufW9mIEpuKHIpKWUucHVzaChlLFpuKHMuc2xpY2UoMCwtNCkpLG4uZ2V0Q2FjaGVLZXkodCkpO3JldHVybiBabihlKX1mdW5jdGlvbipKbihyLHQ9ITEpe2Zvcihjb25zdCBlIGluIHIpe2lmKGUuc3RhcnRzV2l0aCgiXyIpPT09ITApY29udGludWU7Y29uc3Qgcz1yW2VdO2lmKEFycmF5LmlzQXJyYXkocyk9PT0hMClmb3IobGV0IG49MDtuPHMubGVuZ3RoO24rKyl7Y29uc3QgaT1zW25dO2kmJihpLmlzTm9kZT09PSEwfHx0JiZ0eXBlb2YgaS50b0pTT049PSJmdW5jdGlvbiIpJiYoeWllbGR7cHJvcGVydHk6ZSxpbmRleDpuLGNoaWxkTm9kZTppfSl9ZWxzZSBpZihzJiZzLmlzTm9kZT09PSEwKXlpZWxke3Byb3BlcnR5OmUsY2hpbGROb2RlOnN9O2Vsc2UgaWYodHlwZW9mIHM9PSJvYmplY3QiKWZvcihjb25zdCBuIGluIHMpe2NvbnN0IGk9c1tuXTtpJiYoaS5pc05vZGU9PT0hMHx8dCYmdHlwZW9mIGkudG9KU09OPT0iZnVuY3Rpb24iKSYmKHlpZWxke3Byb3BlcnR5OmUsaW5kZXg6bixjaGlsZE5vZGU6aX0pfX19ZnVuY3Rpb24gVnMocil7aWYocj09bnVsbClyZXR1cm4gbnVsbDtjb25zdCB0PXR5cGVvZiByO3JldHVybiByLmlzTm9kZT09PSEwPyJub2RlIjp0PT09Im51bWJlciI/ImZsb2F0Ijp0PT09ImJvb2xlYW4iPyJib29sIjp0PT09InN0cmluZyI/InN0cmluZyI6dD09PSJmdW5jdGlvbiI/InNoYWRlciI6ci5pc1ZlY3RvcjI9PT0hMD8idmVjMiI6ci5pc1ZlY3RvcjM9PT0hMD8idmVjMyI6ci5pc1ZlY3RvcjQ9PT0hMD8idmVjNCI6ci5pc01hdHJpeDM9PT0hMD8ibWF0MyI6ci5pc01hdHJpeDQ9PT0hMD8ibWF0NCI6ci5pc0NvbG9yPT09ITA/ImNvbG9yIjpyIGluc3RhbmNlb2YgQXJyYXlCdWZmZXI/IkFycmF5QnVmZmVyIjpudWxsfWZ1bmN0aW9uIE5yKHIsLi4udCl7Y29uc3QgZT1yP3Iuc2xpY2UoLTQpOnZvaWQgMDtyZXR1cm4gdC5sZW5ndGg9PT0xJiYoZT09PSJ2ZWMyIj90PVt0WzBdLHRbMF1dOmU9PT0idmVjMyI/dD1bdFswXSx0WzBdLHRbMF1dOmU9PT0idmVjNCImJih0PVt0WzBdLHRbMF0sdFswXSx0WzBdXSkpLHI9PT0iY29sb3IiP25ldyBxbiguLi50KTplPT09InZlYzIiP25ldyBKKC4uLnQpOmU9PT0idmVjMyI/bmV3IEEoLi4udCk6ZT09PSJ2ZWM0Ij9uZXcgRnQoLi4udCk6ZT09PSJtYXQzIj9uZXcgQ3QoLi4udCk6ZT09PSJtYXQ0Ij9uZXcgbnQoLi4udCk6cj09PSJib29sIj90WzBdfHwhMTpyPT09ImZsb2F0Inx8cj09PSJpbnQifHxyPT09InVpbnQiP3RbMF18fDA6cj09PSJzdHJpbmciP3RbMF18fCIiOnI9PT0iQXJyYXlCdWZmZXIiP3phKHRbMF0pOm51bGx9ZnVuY3Rpb24gX2Eocil7bGV0IHQ9IiI7Y29uc3QgZT1uZXcgVWludDhBcnJheShyKTtmb3IobGV0IHM9MDtzPGUubGVuZ3RoO3MrKyl0Kz1TdHJpbmcuZnJvbUNoYXJDb2RlKGVbc10pO3JldHVybiBidG9hKHQpfWZ1bmN0aW9uIHphKHIpe3JldHVybiBVaW50OEFycmF5LmZyb20oYXRvYihyKSx0PT50LmNoYXJDb2RlQXQoMCkpLmJ1ZmZlcn1jb25zdCB3cj17VkVSVEVYOiJ2ZXJ0ZXgiLEZSQUdNRU5UOiJmcmFnbWVudCJ9LFE9e05PTkU6Im5vbmUiLEZSQU1FOiJmcmFtZSIsUkVOREVSOiJyZW5kZXIiLE9CSkVDVDoib2JqZWN0In0sbnM9WyJ4IiwieSIsInoiLCJ3Il07bGV0IGJhPTA7Y2xhc3MgVSBleHRlbmRzIFple3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJOb2RlIn1jb25zdHJ1Y3Rvcih0PW51bGwpe3N1cGVyKCksdGhpcy5ub2RlVHlwZT10LHRoaXMudXBkYXRlVHlwZT1RLk5PTkUsdGhpcy51cGRhdGVCZWZvcmVUeXBlPVEuTk9ORSx0aGlzLnVwZGF0ZUFmdGVyVHlwZT1RLk5PTkUsdGhpcy51dWlkPWVhLmdlbmVyYXRlVVVJRCgpLHRoaXMudmVyc2lvbj0wLHRoaXMuX2NhY2hlS2V5PW51bGwsdGhpcy5fY2FjaGVLZXlWZXJzaW9uPTAsdGhpcy5nbG9iYWw9ITEsdGhpcy5pc05vZGU9ITAsT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsImlkIix7dmFsdWU6YmErK30pfXNldCBuZWVkc1VwZGF0ZSh0KXt0PT09ITAmJnRoaXMudmVyc2lvbisrfWdldCB0eXBlKCl7cmV0dXJuIHRoaXMuY29uc3RydWN0b3IudHlwZX1vblVwZGF0ZSh0LGUpe3JldHVybiB0aGlzLnVwZGF0ZVR5cGU9ZSx0aGlzLnVwZGF0ZT10LmJpbmQodGhpcy5nZXRTZWxmKCkpLHRoaXN9b25GcmFtZVVwZGF0ZSh0KXtyZXR1cm4gdGhpcy5vblVwZGF0ZSh0LFEuRlJBTUUpfW9uUmVuZGVyVXBkYXRlKHQpe3JldHVybiB0aGlzLm9uVXBkYXRlKHQsUS5SRU5ERVIpfW9uT2JqZWN0VXBkYXRlKHQpe3JldHVybiB0aGlzLm9uVXBkYXRlKHQsUS5PQkpFQ1QpfW9uUmVmZXJlbmNlKHQpe3JldHVybiB0aGlzLnVwZGF0ZVJlZmVyZW5jZT10LmJpbmQodGhpcy5nZXRTZWxmKCkpLHRoaXN9Z2V0U2VsZigpe3JldHVybiB0aGlzLnNlbGZ8fHRoaXN9dXBkYXRlUmVmZXJlbmNlKCl7cmV0dXJuIHRoaXN9aXNHbG9iYWwoKXtyZXR1cm4gdGhpcy5nbG9iYWx9KmdldENoaWxkcmVuKCl7Zm9yKGNvbnN0e2NoaWxkTm9kZTp0fW9mIEpuKHRoaXMpKXlpZWxkIHR9ZGlzcG9zZSgpe3RoaXMuZGlzcGF0Y2hFdmVudCh7dHlwZToiZGlzcG9zZSJ9KX10cmF2ZXJzZSh0KXt0KHRoaXMpO2Zvcihjb25zdCBlIG9mIHRoaXMuZ2V0Q2hpbGRyZW4oKSllLnRyYXZlcnNlKHQpfWdldENhY2hlS2V5KHQ9ITEpe3JldHVybiB0PXR8fHRoaXMudmVyc2lvbiE9PXRoaXMuX2NhY2hlS2V5VmVyc2lvbiwodD09PSEwfHx0aGlzLl9jYWNoZUtleT09PW51bGwpJiYodGhpcy5fY2FjaGVLZXk9U2EodGhpcyx0KSx0aGlzLl9jYWNoZUtleVZlcnNpb249dGhpcy52ZXJzaW9uKSx0aGlzLl9jYWNoZUtleX1nZXRTY29wZSgpe3JldHVybiB0aGlzfWdldEhhc2goKXtyZXR1cm4gdGhpcy51dWlkfWdldFVwZGF0ZVR5cGUoKXtyZXR1cm4gdGhpcy51cGRhdGVUeXBlfWdldFVwZGF0ZUJlZm9yZVR5cGUoKXtyZXR1cm4gdGhpcy51cGRhdGVCZWZvcmVUeXBlfWdldFVwZGF0ZUFmdGVyVHlwZSgpe3JldHVybiB0aGlzLnVwZGF0ZUFmdGVyVHlwZX1nZXRFbGVtZW50VHlwZSh0KXtjb25zdCBlPXRoaXMuZ2V0Tm9kZVR5cGUodCk7cmV0dXJuIHQuZ2V0RWxlbWVudFR5cGUoZSl9Z2V0Tm9kZVR5cGUodCl7Y29uc3QgZT10LmdldE5vZGVQcm9wZXJ0aWVzKHRoaXMpO3JldHVybiBlLm91dHB1dE5vZGU/ZS5vdXRwdXROb2RlLmdldE5vZGVUeXBlKHQpOnRoaXMubm9kZVR5cGV9Z2V0U2hhcmVkKHQpe2NvbnN0IGU9dGhpcy5nZXRIYXNoKHQpO3JldHVybiB0LmdldE5vZGVGcm9tSGFzaChlKXx8dGhpc31zZXR1cCh0KXtjb25zdCBlPXQuZ2V0Tm9kZVByb3BlcnRpZXModGhpcyk7bGV0IHM9MDtmb3IoY29uc3QgbiBvZiB0aGlzLmdldENoaWxkcmVuKCkpZVsibm9kZSIrcysrXT1uO3JldHVybiBudWxsfWFuYWx5emUodCl7aWYodC5pbmNyZWFzZVVzYWdlKHRoaXMpPT09MSl7Y29uc3Qgcz10LmdldE5vZGVQcm9wZXJ0aWVzKHRoaXMpO2Zvcihjb25zdCBuIG9mIE9iamVjdC52YWx1ZXMocykpbiYmbi5pc05vZGU9PT0hMCYmbi5idWlsZCh0KX19Z2VuZXJhdGUodCxlKXtjb25zdHtvdXRwdXROb2RlOnN9PXQuZ2V0Tm9kZVByb3BlcnRpZXModGhpcyk7aWYocyYmcy5pc05vZGU9PT0hMClyZXR1cm4gcy5idWlsZCh0LGUpfXVwZGF0ZUJlZm9yZSgpe2NvbnNvbGUud2FybigiQWJzdHJhY3QgZnVuY3Rpb24uIil9dXBkYXRlQWZ0ZXIoKXtjb25zb2xlLndhcm4oIkFic3RyYWN0IGZ1bmN0aW9uLiIpfXVwZGF0ZSgpe2NvbnNvbGUud2FybigiQWJzdHJhY3QgZnVuY3Rpb24uIil9YnVpbGQodCxlPW51bGwpe2NvbnN0IHM9dGhpcy5nZXRTaGFyZWQodCk7aWYodGhpcyE9PXMpcmV0dXJuIHMuYnVpbGQodCxlKTt0LmFkZE5vZGUodGhpcyksdC5hZGRDaGFpbih0aGlzKTtsZXQgbj1udWxsO2NvbnN0IGk9dC5nZXRCdWlsZFN0YWdlKCk7aWYoaT09PSJzZXR1cCIpe3RoaXMudXBkYXRlUmVmZXJlbmNlKHQpO2NvbnN0IG89dC5nZXROb2RlUHJvcGVydGllcyh0aGlzKTtpZihvLmluaXRpYWxpemVkIT09ITApe2NvbnN0IGE9dC5zdGFjay5ub2Rlcy5sZW5ndGg7by5pbml0aWFsaXplZD0hMCxvLm91dHB1dE5vZGU9dGhpcy5zZXR1cCh0KSxvLm91dHB1dE5vZGUhPT1udWxsJiZ0LnN0YWNrLm5vZGVzLmxlbmd0aDtmb3IoY29uc3QgYyBvZiBPYmplY3QudmFsdWVzKG8pKWMmJmMuaXNOb2RlPT09ITAmJmMuYnVpbGQodCl9fWVsc2UgaWYoaT09PSJhbmFseXplIil0aGlzLmFuYWx5emUodCk7ZWxzZSBpZihpPT09ImdlbmVyYXRlIilpZih0aGlzLmdlbmVyYXRlLmxlbmd0aD09PTEpe2NvbnN0IGE9dGhpcy5nZXROb2RlVHlwZSh0KSxjPXQuZ2V0RGF0YUZyb21Ob2RlKHRoaXMpO249Yy5zbmlwcGV0LG49PT12b2lkIDA/KG49dGhpcy5nZW5lcmF0ZSh0KXx8IiIsYy5zbmlwcGV0PW4pOmMuZmxvd0NvZGVzIT09dm9pZCAwJiZ0LmNvbnRleHQubm9kZUJsb2NrIT09dm9pZCAwJiZ0LmFkZEZsb3dDb2RlSGllcmFyY2h5KHRoaXMsdC5jb250ZXh0Lm5vZGVCbG9jayksbj10LmZvcm1hdChuLGEsZSl9ZWxzZSBuPXRoaXMuZ2VuZXJhdGUodCxlKXx8IiI7cmV0dXJuIHQucmVtb3ZlQ2hhaW4odGhpcyksbn1nZXRTZXJpYWxpemVDaGlsZHJlbigpe3JldHVybiBKbih0aGlzKX1zZXJpYWxpemUodCl7Y29uc3QgZT10aGlzLmdldFNlcmlhbGl6ZUNoaWxkcmVuKCkscz17fTtmb3IoY29uc3R7cHJvcGVydHk6bixpbmRleDppLGNoaWxkTm9kZTpvfW9mIGUpaSE9PXZvaWQgMD8oc1tuXT09PXZvaWQgMCYmKHNbbl09TnVtYmVyLmlzSW50ZWdlcihpKT9bXTp7fSksc1tuXVtpXT1vLnRvSlNPTih0Lm1ldGEpLnV1aWQpOnNbbl09by50b0pTT04odC5tZXRhKS51dWlkO09iamVjdC5rZXlzKHMpLmxlbmd0aD4wJiYodC5pbnB1dE5vZGVzPXMpfWRlc2VyaWFsaXplKHQpe2lmKHQuaW5wdXROb2RlcyE9PXZvaWQgMCl7Y29uc3QgZT10Lm1ldGEubm9kZXM7Zm9yKGNvbnN0IHMgaW4gdC5pbnB1dE5vZGVzKWlmKEFycmF5LmlzQXJyYXkodC5pbnB1dE5vZGVzW3NdKSl7Y29uc3Qgbj1bXTtmb3IoY29uc3QgaSBvZiB0LmlucHV0Tm9kZXNbc10pbi5wdXNoKGVbaV0pO3RoaXNbc109bn1lbHNlIGlmKHR5cGVvZiB0LmlucHV0Tm9kZXNbc109PSJvYmplY3QiKXtjb25zdCBuPXt9O2Zvcihjb25zdCBpIGluIHQuaW5wdXROb2Rlc1tzXSl7Y29uc3Qgbz10LmlucHV0Tm9kZXNbc11baV07bltpXT1lW29dfXRoaXNbc109bn1lbHNle2NvbnN0IG49dC5pbnB1dE5vZGVzW3NdO3RoaXNbc109ZVtuXX19fXRvSlNPTih0KXtjb25zdHt1dWlkOmUsdHlwZTpzfT10aGlzLG49dD09PXZvaWQgMHx8dHlwZW9mIHQ9PSJzdHJpbmciO24mJih0PXt0ZXh0dXJlczp7fSxpbWFnZXM6e30sbm9kZXM6e319KTtsZXQgaT10Lm5vZGVzW2VdO2k9PT12b2lkIDAmJihpPXt1dWlkOmUsdHlwZTpzLG1ldGE6dCxtZXRhZGF0YTp7dmVyc2lvbjo0LjYsdHlwZToiTm9kZSIsZ2VuZXJhdG9yOiJOb2RlLnRvSlNPTiJ9fSxuIT09ITAmJih0Lm5vZGVzW2kudXVpZF09aSksdGhpcy5zZXJpYWxpemUoaSksZGVsZXRlIGkubWV0YSk7ZnVuY3Rpb24gbyhhKXtjb25zdCBjPVtdO2Zvcihjb25zdCB1IGluIGEpe2NvbnN0IGg9YVt1XTtkZWxldGUgaC5tZXRhZGF0YSxjLnB1c2goaCl9cmV0dXJuIGN9aWYobil7Y29uc3QgYT1vKHQudGV4dHVyZXMpLGM9byh0LmltYWdlcyksdT1vKHQubm9kZXMpO2EubGVuZ3RoPjAmJihpLnRleHR1cmVzPWEpLGMubGVuZ3RoPjAmJihpLmltYWdlcz1jKSx1Lmxlbmd0aD4wJiYoaS5ub2Rlcz11KX1yZXR1cm4gaX19Y2xhc3MgaXMgZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJBcnJheUVsZW1lbnROb2RlIn1jb25zdHJ1Y3Rvcih0LGUpe3N1cGVyKCksdGhpcy5ub2RlPXQsdGhpcy5pbmRleE5vZGU9ZSx0aGlzLmlzQXJyYXlFbGVtZW50Tm9kZT0hMH1nZXROb2RlVHlwZSh0KXtyZXR1cm4gdGhpcy5ub2RlLmdldEVsZW1lbnRUeXBlKHQpfWdlbmVyYXRlKHQpe2NvbnN0IGU9dGhpcy5ub2RlLmJ1aWxkKHQpLHM9dGhpcy5pbmRleE5vZGUuYnVpbGQodCwidWludCIpO3JldHVybmAke2V9WyAke3N9IF1gfX1jbGFzcyBBciBleHRlbmRzIFV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIkNvbnZlcnROb2RlIn1jb25zdHJ1Y3Rvcih0LGUpe3N1cGVyKCksdGhpcy5ub2RlPXQsdGhpcy5jb252ZXJ0VG89ZX1nZXROb2RlVHlwZSh0KXtjb25zdCBlPXRoaXMubm9kZS5nZXROb2RlVHlwZSh0KTtsZXQgcz1udWxsO2Zvcihjb25zdCBuIG9mIHRoaXMuY29udmVydFRvLnNwbGl0KCJ8IikpKHM9PT1udWxsfHx0LmdldFR5cGVMZW5ndGgoZSk9PT10LmdldFR5cGVMZW5ndGgobikpJiYocz1uKTtyZXR1cm4gc31zZXJpYWxpemUodCl7c3VwZXIuc2VyaWFsaXplKHQpLHQuY29udmVydFRvPXRoaXMuY29udmVydFRvfWRlc2VyaWFsaXplKHQpe3N1cGVyLmRlc2VyaWFsaXplKHQpLHRoaXMuY29udmVydFRvPXQuY29udmVydFRvfWdlbmVyYXRlKHQsZSl7Y29uc3Qgcz10aGlzLm5vZGUsbj10aGlzLmdldE5vZGVUeXBlKHQpLGk9cy5idWlsZCh0LG4pO3JldHVybiB0LmZvcm1hdChpLG4sZSl9fWNsYXNzIGR0IGV4dGVuZHMgVXtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iVGVtcE5vZGUifWNvbnN0cnVjdG9yKHQpe3N1cGVyKHQpLHRoaXMuaXNUZW1wTm9kZT0hMH1oYXNEZXBlbmRlbmNpZXModCl7cmV0dXJuIHQuZ2V0RGF0YUZyb21Ob2RlKHRoaXMpLnVzYWdlQ291bnQ+MX1idWlsZCh0LGUpe2lmKHQuZ2V0QnVpbGRTdGFnZSgpPT09ImdlbmVyYXRlIil7Y29uc3Qgbj10LmdldFZlY3RvclR5cGUodGhpcy5nZXROb2RlVHlwZSh0LGUpKSxpPXQuZ2V0RGF0YUZyb21Ob2RlKHRoaXMpO2lmKGkucHJvcGVydHlOYW1lIT09dm9pZCAwKXJldHVybiB0LmZvcm1hdChpLnByb3BlcnR5TmFtZSxuLGUpO2lmKG4hPT0idm9pZCImJmUhPT0idm9pZCImJnRoaXMuaGFzRGVwZW5kZW5jaWVzKHQpKXtjb25zdCBvPXN1cGVyLmJ1aWxkKHQsbiksYT10LmdldFZhckZyb21Ob2RlKHRoaXMsbnVsbCxuKSxjPXQuZ2V0UHJvcGVydHlOYW1lKGEpO3JldHVybiB0LmFkZExpbmVGbG93Q29kZShgJHtjfSA9ICR7b31gLHRoaXMpLGkuc25pcHBldD1vLGkucHJvcGVydHlOYW1lPWMsdC5mb3JtYXQoaS5wcm9wZXJ0eU5hbWUsbixlKX19cmV0dXJuIHN1cGVyLmJ1aWxkKHQsZSl9fWNsYXNzIEVhIGV4dGVuZHMgZHR7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIkpvaW5Ob2RlIn1jb25zdHJ1Y3Rvcih0PVtdLGU9bnVsbCl7c3VwZXIoZSksdGhpcy5ub2Rlcz10fWdldE5vZGVUeXBlKHQpe3JldHVybiB0aGlzLm5vZGVUeXBlIT09bnVsbD90LmdldFZlY3RvclR5cGUodGhpcy5ub2RlVHlwZSk6dC5nZXRUeXBlRnJvbUxlbmd0aCh0aGlzLm5vZGVzLnJlZHVjZSgoZSxzKT0+ZSt0LmdldFR5cGVMZW5ndGgocy5nZXROb2RlVHlwZSh0KSksMCkpfWdlbmVyYXRlKHQsZSl7Y29uc3Qgcz10aGlzLmdldE5vZGVUeXBlKHQpLG49dGhpcy5ub2RlcyxpPXQuZ2V0Q29tcG9uZW50VHlwZShzKSxvPVtdO2Zvcihjb25zdCBjIG9mIG4pe2xldCB1PWMuYnVpbGQodCk7Y29uc3QgaD10LmdldENvbXBvbmVudFR5cGUoYy5nZXROb2RlVHlwZSh0KSk7aCE9PWkmJih1PXQuZm9ybWF0KHUsaCxpKSksby5wdXNoKHUpfWNvbnN0IGE9YCR7dC5nZXRUeXBlKHMpfSggJHtvLmpvaW4oIiwgIil9IClgO3JldHVybiB0LmZvcm1hdChhLHMsZSl9fWNvbnN0IENhPW5zLmpvaW4oIiIpO2NsYXNzIE1yIGV4dGVuZHMgVXtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iU3BsaXROb2RlIn1jb25zdHJ1Y3Rvcih0LGU9IngiKXtzdXBlcigpLHRoaXMubm9kZT10LHRoaXMuY29tcG9uZW50cz1lLHRoaXMuaXNTcGxpdE5vZGU9ITB9Z2V0VmVjdG9yTGVuZ3RoKCl7bGV0IHQ9dGhpcy5jb21wb25lbnRzLmxlbmd0aDtmb3IoY29uc3QgZSBvZiB0aGlzLmNvbXBvbmVudHMpdD1NYXRoLm1heChucy5pbmRleE9mKGUpKzEsdCk7cmV0dXJuIHR9Z2V0Q29tcG9uZW50VHlwZSh0KXtyZXR1cm4gdC5nZXRDb21wb25lbnRUeXBlKHRoaXMubm9kZS5nZXROb2RlVHlwZSh0KSl9Z2V0Tm9kZVR5cGUodCl7cmV0dXJuIHQuZ2V0VHlwZUZyb21MZW5ndGgodGhpcy5jb21wb25lbnRzLmxlbmd0aCx0aGlzLmdldENvbXBvbmVudFR5cGUodCkpfWdlbmVyYXRlKHQsZSl7Y29uc3Qgcz10aGlzLm5vZGUsbj10LmdldFR5cGVMZW5ndGgocy5nZXROb2RlVHlwZSh0KSk7bGV0IGk9bnVsbDtpZihuPjEpe2xldCBvPW51bGw7dGhpcy5nZXRWZWN0b3JMZW5ndGgoKT49biYmKG89dC5nZXRUeXBlRnJvbUxlbmd0aCh0aGlzLmdldFZlY3Rvckxlbmd0aCgpLHRoaXMuZ2V0Q29tcG9uZW50VHlwZSh0KSkpO2NvbnN0IGM9cy5idWlsZCh0LG8pO3RoaXMuY29tcG9uZW50cy5sZW5ndGg9PT1uJiZ0aGlzLmNvbXBvbmVudHM9PT1DYS5zbGljZSgwLHRoaXMuY29tcG9uZW50cy5sZW5ndGgpP2k9dC5mb3JtYXQoYyxvLGUpOmk9dC5mb3JtYXQoYCR7Y30uJHt0aGlzLmNvbXBvbmVudHN9YCx0aGlzLmdldE5vZGVUeXBlKHQpLGUpfWVsc2UgaT1zLmJ1aWxkKHQsZSk7cmV0dXJuIGl9c2VyaWFsaXplKHQpe3N1cGVyLnNlcmlhbGl6ZSh0KSx0LmNvbXBvbmVudHM9dGhpcy5jb21wb25lbnRzfWRlc2VyaWFsaXplKHQpe3N1cGVyLmRlc2VyaWFsaXplKHQpLHRoaXMuY29tcG9uZW50cz10LmNvbXBvbmVudHN9fWNsYXNzIEZhIGV4dGVuZHMgZHR7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIlNldE5vZGUifWNvbnN0cnVjdG9yKHQsZSxzKXtzdXBlcigpLHRoaXMuc291cmNlTm9kZT10LHRoaXMuY29tcG9uZW50cz1lLHRoaXMudGFyZ2V0Tm9kZT1zfWdldE5vZGVUeXBlKHQpe3JldHVybiB0aGlzLnNvdXJjZU5vZGUuZ2V0Tm9kZVR5cGUodCl9Z2VuZXJhdGUodCl7Y29uc3R7c291cmNlTm9kZTplLGNvbXBvbmVudHM6cyx0YXJnZXROb2RlOm59PXRoaXMsaT10aGlzLmdldE5vZGVUeXBlKHQpLG89dC5nZXRUeXBlRnJvbUxlbmd0aChzLmxlbmd0aCxuLmdldE5vZGVUeXBlKHQpKSxhPW4uYnVpbGQodCxvKSxjPWUuYnVpbGQodCxpKSx1PXQuZ2V0VHlwZUxlbmd0aChpKSxoPVtdO2ZvcihsZXQgbD0wO2w8dTtsKyspe2NvbnN0IGQ9bnNbbF07ZD09PXNbMF0/KGgucHVzaChhKSxsKz1zLmxlbmd0aC0xKTpoLnB1c2goYysiLiIrZCl9cmV0dXJuYCR7dC5nZXRUeXBlKGkpfSggJHtoLmpvaW4oIiwgIil9IClgfX1jbGFzcyBSYSBleHRlbmRzIGR0e3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJGbGlwTm9kZSJ9Y29uc3RydWN0b3IodCxlKXtzdXBlcigpLHRoaXMuc291cmNlTm9kZT10LHRoaXMuY29tcG9uZW50cz1lfWdldE5vZGVUeXBlKHQpe3JldHVybiB0aGlzLnNvdXJjZU5vZGUuZ2V0Tm9kZVR5cGUodCl9Z2VuZXJhdGUodCl7Y29uc3R7Y29tcG9uZW50czplLHNvdXJjZU5vZGU6c309dGhpcyxuPXRoaXMuZ2V0Tm9kZVR5cGUodCksaT1zLmJ1aWxkKHQpLG89dC5nZXRWYXJGcm9tTm9kZSh0aGlzKSxhPXQuZ2V0UHJvcGVydHlOYW1lKG8pO3QuYWRkTGluZUZsb3dDb2RlKGErIiA9ICIraSx0aGlzKTtjb25zdCBjPXQuZ2V0VHlwZUxlbmd0aChuKSx1PVtdO2xldCBoPTA7Zm9yKGxldCBsPTA7bDxjO2wrKyl7Y29uc3QgZD1uc1tsXTtkPT09ZVtoXT8odS5wdXNoKCIxLjAgLSAiKyhhKyIuIitkKSksaCsrKTp1LnB1c2goYSsiLiIrZCl9cmV0dXJuYCR7dC5nZXRUeXBlKG4pfSggJHt1LmpvaW4oIiwgIil9IClgfX1jbGFzcyBqbiBleHRlbmRzIFV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIklucHV0Tm9kZSJ9Y29uc3RydWN0b3IodCxlPW51bGwpe3N1cGVyKGUpLHRoaXMuaXNJbnB1dE5vZGU9ITAsdGhpcy52YWx1ZT10LHRoaXMucHJlY2lzaW9uPW51bGx9Z2V0Tm9kZVR5cGUoKXtyZXR1cm4gdGhpcy5ub2RlVHlwZT09PW51bGw/VnModGhpcy52YWx1ZSk6dGhpcy5ub2RlVHlwZX1nZXRJbnB1dFR5cGUodCl7cmV0dXJuIHRoaXMuZ2V0Tm9kZVR5cGUodCl9c2V0UHJlY2lzaW9uKHQpe3JldHVybiB0aGlzLnByZWNpc2lvbj10LHRoaXN9c2VyaWFsaXplKHQpe3N1cGVyLnNlcmlhbGl6ZSh0KSx0LnZhbHVlPXRoaXMudmFsdWUsdGhpcy52YWx1ZSYmdGhpcy52YWx1ZS50b0FycmF5JiYodC52YWx1ZT10aGlzLnZhbHVlLnRvQXJyYXkoKSksdC52YWx1ZVR5cGU9VnModGhpcy52YWx1ZSksdC5ub2RlVHlwZT10aGlzLm5vZGVUeXBlLHQudmFsdWVUeXBlPT09IkFycmF5QnVmZmVyIiYmKHQudmFsdWU9X2EodC52YWx1ZSkpLHQucHJlY2lzaW9uPXRoaXMucHJlY2lzaW9ufWRlc2VyaWFsaXplKHQpe3N1cGVyLmRlc2VyaWFsaXplKHQpLHRoaXMubm9kZVR5cGU9dC5ub2RlVHlwZSx0aGlzLnZhbHVlPUFycmF5LmlzQXJyYXkodC52YWx1ZSk/TnIodC52YWx1ZVR5cGUsLi4udC52YWx1ZSk6dC52YWx1ZSx0aGlzLnByZWNpc2lvbj10LnByZWNpc2lvbnx8bnVsbCx0aGlzLnZhbHVlJiZ0aGlzLnZhbHVlLmZyb21BcnJheSYmKHRoaXMudmFsdWU9dGhpcy52YWx1ZS5mcm9tQXJyYXkodC52YWx1ZSkpfWdlbmVyYXRlKCl7Y29uc29sZS53YXJuKCJBYnN0cmFjdCBmdW5jdGlvbi4iKX19Y2xhc3MgSnQgZXh0ZW5kcyBqbntzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iQ29uc3ROb2RlIn1jb25zdHJ1Y3Rvcih0LGU9bnVsbCl7c3VwZXIodCxlKSx0aGlzLmlzQ29uc3ROb2RlPSEwfWdlbmVyYXRlQ29uc3QodCl7cmV0dXJuIHQuZ2VuZXJhdGVDb25zdCh0aGlzLmdldE5vZGVUeXBlKHQpLHRoaXMudmFsdWUpfWdlbmVyYXRlKHQsZSl7Y29uc3Qgcz10aGlzLmdldE5vZGVUeXBlKHQpO3JldHVybiB0LmZvcm1hdCh0aGlzLmdlbmVyYXRlQ29uc3QodCkscyxlKX19bGV0IFNyPW51bGw7Y29uc3QgQ2U9bmV3IE1hcDtmdW5jdGlvbiBiKHIsdCl7aWYoQ2UuaGFzKHIpKXtjb25zb2xlLndhcm4oYFJlZGVmaW5pdGlvbiBvZiBtZXRob2QgY2hhaW5pbmcgJHtyfWApO3JldHVybn1pZih0eXBlb2YgdCE9ImZ1bmN0aW9uIil0aHJvdyBuZXcgRXJyb3IoYE5vZGUgZWxlbWVudCAke3J9IGlzIG5vdCBhIGZ1bmN0aW9uYCk7Q2Uuc2V0KHIsdCl9Y29uc3QgX3I9cj0+ci5yZXBsYWNlKC9yfHMvZywieCIpLnJlcGxhY2UoL2d8dC9nLCJ5IikucmVwbGFjZSgvYnxwL2csInoiKS5yZXBsYWNlKC9hfHEvZywidyIpLHpyPXI9Pl9yKHIpLnNwbGl0KCIiKS5zb3J0KCkuam9pbigiIiksYnI9e3NldHVwKHIsdCl7Y29uc3QgZT10LnNoaWZ0KCk7cmV0dXJuIHIoSHMoZSksLi4udCl9LGdldChyLHQsZSl7aWYodHlwZW9mIHQ9PSJzdHJpbmciJiZyW3RdPT09dm9pZCAwKXtpZihyLmlzU3RhY2tOb2RlIT09ITAmJnQ9PT0iYXNzaWduIilyZXR1cm4oLi4ucyk9PihTci5hc3NpZ24oZSwuLi5zKSxlKTtpZihDZS5oYXModCkpe2NvbnN0IHM9Q2UuZ2V0KHQpO3JldHVybiByLmlzU3RhY2tOb2RlPyguLi5uKT0+ZS5hZGQocyguLi5uKSk6KC4uLm4pPT5zKGUsLi4ubil9ZWxzZXtpZih0PT09InNlbGYiKXJldHVybiByO2lmKHQuZW5kc1dpdGgoIkFzc2lnbiIpJiZDZS5oYXModC5zbGljZSgwLHQubGVuZ3RoLTYpKSl7Y29uc3Qgcz1DZS5nZXQodC5zbGljZSgwLHQubGVuZ3RoLTYpKTtyZXR1cm4gci5pc1N0YWNrTm9kZT8oLi4ubik9PmUuYXNzaWduKG5bMF0scyguLi5uKSk6KC4uLm4pPT5lLmFzc2lnbihzKGUsLi4ubikpfWVsc2V7aWYoL15beHl6d3JnYmFzdHBxXXsxLDR9JC8udGVzdCh0KT09PSEwKXJldHVybiB0PV9yKHQpLHYobmV3IE1yKGUsdCkpO2lmKC9ec2V0W1hZWldSR0JBU1RQUV17MSw0fSQvLnRlc3QodCk9PT0hMClyZXR1cm4gdD16cih0LnNsaWNlKDMpLnRvTG93ZXJDYXNlKCkpLHM9PnYobmV3IEZhKHIsdCxzKSk7aWYoL15mbGlwW1hZWldSR0JBU1RQUV17MSw0fSQvLnRlc3QodCk9PT0hMClyZXR1cm4gdD16cih0LnNsaWNlKDQpLnRvTG93ZXJDYXNlKCkpLCgpPT52KG5ldyBSYSh2KHIpLHQpKTtpZih0PT09IndpZHRoInx8dD09PSJoZWlnaHQifHx0PT09ImRlcHRoIilyZXR1cm4gdD09PSJ3aWR0aCI/dD0ieCI6dD09PSJoZWlnaHQiP3Q9InkiOnQ9PT0iZGVwdGgiJiYodD0ieiIpLHYobmV3IE1yKHIsdCkpO2lmKC9eXGQrJC8udGVzdCh0KT09PSEwKXJldHVybiB2KG5ldyBpcyhlLG5ldyBKdChOdW1iZXIodCksInVpbnQiKSkpfX19cmV0dXJuIFJlZmxlY3QuZ2V0KHIsdCxlKX0sc2V0KHIsdCxlLHMpe3JldHVybiB0eXBlb2YgdD09InN0cmluZyImJnJbdF09PT12b2lkIDAmJigvXlt4eXp3cmdiYXN0cHFdezEsNH0kLy50ZXN0KHQpPT09ITB8fHQ9PT0id2lkdGgifHx0PT09ImhlaWdodCJ8fHQ9PT0iZGVwdGgifHwvXlxkKyQvLnRlc3QodCk9PT0hMCk/KHNbdF0uYXNzaWduKGUpLCEwKTpSZWZsZWN0LnNldChyLHQsZSxzKX19LFFuPW5ldyBXZWFrTWFwLEVyPW5ldyBXZWFrTWFwLEJhPWZ1bmN0aW9uKHIsdD1udWxsKXtjb25zdCBlPVZzKHIpO2lmKGU9PT0ibm9kZSIpe2xldCBzPVFuLmdldChyKTtyZXR1cm4gcz09PXZvaWQgMCYmKHM9bmV3IFByb3h5KHIsYnIpLFFuLnNldChyLHMpLFFuLnNldChzLHMpKSxzfWVsc2V7aWYodD09PW51bGwmJihlPT09ImZsb2F0Inx8ZT09PSJib29sZWFuIil8fGUmJmUhPT0ic2hhZGVyIiYmZSE9PSJzdHJpbmciKXJldHVybiB2KHNpKHIsdCkpO2lmKGU9PT0ic2hhZGVyIilyZXR1cm4gdHQocil9cmV0dXJuIHJ9LElhPWZ1bmN0aW9uKHIsdD1udWxsKXtmb3IoY29uc3QgZSBpbiByKXJbZV09dihyW2VdLHQpO3JldHVybiByfSx2YT1mdW5jdGlvbihyLHQ9bnVsbCl7Y29uc3QgZT1yLmxlbmd0aDtmb3IobGV0IHM9MDtzPGU7cysrKXJbc109dihyW3NdLHQpO3JldHVybiByfSxQYT1mdW5jdGlvbihyLHQ9bnVsbCxlPW51bGwscz1udWxsKXtjb25zdCBuPWk9PnYocyE9PW51bGw/T2JqZWN0LmFzc2lnbihpLHMpOmkpO3JldHVybiB0PT09bnVsbD8oLi4uaSk9Pm4obmV3IHIoLi4uRmUoaSkpKTplIT09bnVsbD8oZT12KGUpLCguLi5pKT0+bihuZXcgcih0LC4uLkZlKGkpLGUpKSk6KC4uLmkpPT5uKG5ldyByKHQsLi4uRmUoaSkpKX0sTGE9ZnVuY3Rpb24ociwuLi50KXtyZXR1cm4gdihuZXcgciguLi5GZSh0KSkpfTtjbGFzcyBPYSBleHRlbmRzIFV7Y29uc3RydWN0b3IodCxlKXtzdXBlcigpLHRoaXMuc2hhZGVyTm9kZT10LHRoaXMuaW5wdXROb2Rlcz1lfWdldE5vZGVUeXBlKHQpe3JldHVybiB0aGlzLnNoYWRlck5vZGUubm9kZVR5cGV8fHRoaXMuZ2V0T3V0cHV0Tm9kZSh0KS5nZXROb2RlVHlwZSh0KX1jYWxsKHQpe2NvbnN0e3NoYWRlck5vZGU6ZSxpbnB1dE5vZGVzOnN9PXRoaXMsbj10LmdldE5vZGVQcm9wZXJ0aWVzKGUpO2lmKG4ub25jZU91dHB1dClyZXR1cm4gbi5vbmNlT3V0cHV0O2xldCBpPW51bGw7aWYoZS5sYXlvdXQpe2xldCBvPUVyLmdldCh0LmNvbnN0cnVjdG9yKTtvPT09dm9pZCAwJiYobz1uZXcgV2Vha01hcCxFci5zZXQodC5jb25zdHJ1Y3RvcixvKSk7bGV0IGE9by5nZXQoZSk7YT09PXZvaWQgMCYmKGE9dih0LmJ1aWxkRnVuY3Rpb25Ob2RlKGUpKSxvLnNldChlLGEpKSx0LmN1cnJlbnRGdW5jdGlvbk5vZGUhPT1udWxsJiZ0LmN1cnJlbnRGdW5jdGlvbk5vZGUuaW5jbHVkZXMucHVzaChhKSxpPXYoYS5jYWxsKHMpKX1lbHNle2NvbnN0IG89ZS5qc0Z1bmMsYT1zIT09bnVsbD9vKHMsdCk6byh0KTtpPXYoYSl9cmV0dXJuIGUub25jZSYmKG4ub25jZU91dHB1dD1pKSxpfWdldE91dHB1dE5vZGUodCl7Y29uc3QgZT10LmdldE5vZGVQcm9wZXJ0aWVzKHRoaXMpO3JldHVybiBlLm91dHB1dE5vZGU9PT1udWxsJiYoZS5vdXRwdXROb2RlPXRoaXMuc2V0dXBPdXRwdXQodCkpLGUub3V0cHV0Tm9kZX1zZXR1cCh0KXtyZXR1cm4gdGhpcy5nZXRPdXRwdXROb2RlKHQpfXNldHVwT3V0cHV0KHQpe3JldHVybiB0LmFkZFN0YWNrKCksdC5zdGFjay5vdXRwdXROb2RlPXRoaXMuY2FsbCh0KSx0LnJlbW92ZVN0YWNrKCl9Z2VuZXJhdGUodCxlKXtyZXR1cm4gdGhpcy5nZXRPdXRwdXROb2RlKHQpLmJ1aWxkKHQsZSl9fWNsYXNzIERhIGV4dGVuZHMgVXtjb25zdHJ1Y3Rvcih0LGUpe3N1cGVyKGUpLHRoaXMuanNGdW5jPXQsdGhpcy5sYXlvdXQ9bnVsbCx0aGlzLmdsb2JhbD0hMCx0aGlzLm9uY2U9ITF9c2V0TGF5b3V0KHQpe3JldHVybiB0aGlzLmxheW91dD10LHRoaXN9Y2FsbCh0PW51bGwpe3JldHVybiBIcyh0KSx2KG5ldyBPYSh0aGlzLHQpKX1zZXR1cCgpe3JldHVybiB0aGlzLmNhbGwoKX19Y29uc3QgVmE9WyExLCEwXSxVYT1bMCwxLDIsM10sa2E9Wy0xLC0yXSxDcj1bLjUsMS41LDEvMywxZS02LDFlNixNYXRoLlBJLE1hdGguUEkqMiwxL01hdGguUEksMi9NYXRoLlBJLDEvKE1hdGguUEkqMiksTWF0aC5QSS8yXSxLbj1uZXcgTWFwO2Zvcihjb25zdCByIG9mIFZhKUtuLnNldChyLG5ldyBKdChyKSk7Y29uc3QgdGk9bmV3IE1hcDtmb3IoY29uc3QgciBvZiBVYSl0aS5zZXQocixuZXcgSnQociwidWludCIpKTtjb25zdCBlaT1uZXcgTWFwKFsuLi50aV0ubWFwKHI9Pm5ldyBKdChyLnZhbHVlLCJpbnQiKSkpO2Zvcihjb25zdCByIG9mIGthKWVpLnNldChyLG5ldyBKdChyLCJpbnQiKSk7Y29uc3QgVXM9bmV3IE1hcChbLi4uZWldLm1hcChyPT5uZXcgSnQoci52YWx1ZSkpKTtmb3IoY29uc3QgciBvZiBDcilVcy5zZXQocixuZXcgSnQocikpO2Zvcihjb25zdCByIG9mIENyKVVzLnNldCgtcixuZXcgSnQoLXIpKTtjb25zdCBrcz17Ym9vbDpLbix1aW50OnRpLGludHM6ZWksZmxvYXQ6VXN9LEZyPW5ldyBNYXAoWy4uLktuLC4uLlVzXSksc2k9KHIsdCk9PkZyLmhhcyhyKT9Gci5nZXQocik6ci5pc05vZGU9PT0hMD9yOm5ldyBKdChyLHQpLEhhPXI9Pnt0cnl7cmV0dXJuIHIuZ2V0Tm9kZVR5cGUoKX1jYXRjaHtyZXR1cm59fSxLPWZ1bmN0aW9uKHIsdD1udWxsKXtyZXR1cm4oLi4uZSk9PntpZigoZS5sZW5ndGg9PT0wfHwhWyJib29sIiwiZmxvYXQiLCJpbnQiLCJ1aW50Il0uaW5jbHVkZXMocikmJmUuZXZlcnkobj0+dHlwZW9mIG4hPSJvYmplY3QiKSkmJihlPVtOcihyLC4uLmUpXSksZS5sZW5ndGg9PT0xJiZ0IT09bnVsbCYmdC5oYXMoZVswXSkpcmV0dXJuIHYodC5nZXQoZVswXSkpO2lmKGUubGVuZ3RoPT09MSl7Y29uc3Qgbj1zaShlWzBdLHIpO3JldHVybiBIYShuKT09PXI/dihuKTp2KG5ldyBBcihuLHIpKX1jb25zdCBzPWUubWFwKG49PnNpKG4pKTtyZXR1cm4gdihuZXcgRWEocyxyKSl9fSxxYT1yPT5yIT1udWxsP3Iubm9kZVR5cGV8fHIuY29udmVydFRvfHwodHlwZW9mIHI9PSJzdHJpbmciP3I6bnVsbCk6bnVsbDtmdW5jdGlvbiAkYShyLHQpe3JldHVybiBuZXcgUHJveHkobmV3IERhKHIsdCksYnIpfWNvbnN0IHY9KHIsdD1udWxsKT0+QmEocix0KSxIcz0ocix0PW51bGwpPT5uZXcgSWEocix0KSxGZT0ocix0PW51bGwpPT5uZXcgdmEocix0KSxDPSguLi5yKT0+bmV3IFBhKC4uLnIpLE89KC4uLnIpPT5uZXcgTGEoLi4uciksdHQ9KHIsdCk9Pntjb25zdCBlPW5ldyAkYShyLHQpLHM9KC4uLm4pPT57bGV0IGk7cmV0dXJuIEhzKG4pLG5bMF0mJm5bMF0uaXNOb2RlP2k9Wy4uLm5dOmk9blswXSxlLmNhbGwoaSl9O3JldHVybiBzLnNoYWRlck5vZGU9ZSxzLnNldExheW91dD1uPT4oZS5zZXRMYXlvdXQobikscykscy5vbmNlPSgpPT4oZS5vbmNlPSEwLHMpLHN9O2IoInRvR2xvYmFsIixyPT4oci5nbG9iYWw9ITAscikpO2NvbnN0IG5pPSguLi5yKT0+U3IuSWYoLi4ucik7ZnVuY3Rpb24gR2Eocil7cmV0dXJuIHJ9YigiYXBwZW5kIixHYSk7Y29uc3QgV2E9bmV3IEsoImNvbG9yIikscT1uZXcgSygiZmxvYXQiLGtzLmZsb2F0KSxSZT1uZXcgSygiaW50Iixrcy5pbnRzKSxYYT1uZXcgSygidWludCIsa3MudWludCksWWE9bmV3IEsoImJvb2wiLGtzLmJvb2wpLEQ9bmV3IEsoInZlYzIiKSxaYT1uZXcgSygiaXZlYzIiKSxKYT1uZXcgSygidXZlYzIiKSxqYT1uZXcgSygiYnZlYzIiKSxrPW5ldyBLKCJ2ZWMzIiksUWE9bmV3IEsoIml2ZWMzIiksS2E9bmV3IEsoInV2ZWMzIiksdGM9bmV3IEsoImJ2ZWMzIiksQmU9bmV3IEsoInZlYzQiKSxlYz1uZXcgSygiaXZlYzQiKSxzYz1uZXcgSygidXZlYzQiKSxuYz1uZXcgSygiYnZlYzQiKSxScj1uZXcgSygibWF0MiIpLHFzPW5ldyBLKCJtYXQzIiksaWM9bmV3IEsoIm1hdDQiKTtiKCJ0b0NvbG9yIixXYSksYigidG9GbG9hdCIscSksYigidG9JbnQiLFJlKSxiKCJ0b1VpbnQiLFhhKSxiKCJ0b0Jvb2wiLFlhKSxiKCJ0b1ZlYzIiLEQpLGIoInRvSVZlYzIiLFphKSxiKCJ0b1VWZWMyIixKYSksYigidG9CVmVjMiIsamEpLGIoInRvVmVjMyIsayksYigidG9JVmVjMyIsUWEpLGIoInRvVVZlYzMiLEthKSxiKCJ0b0JWZWMzIix0YyksYigidG9WZWM0IixCZSksYigidG9JVmVjNCIsZWMpLGIoInRvVVZlYzQiLHNjKSxiKCJ0b0JWZWM0IixuYyksYigidG9NYXQyIixSciksYigidG9NYXQzIixxcyksYigidG9NYXQ0IixpYyk7Y29uc3QgcmM9Qyhpcyksb2M9KHIsdCk9PnYobmV3IEFyKHYociksdCkpO2IoImVsZW1lbnQiLHJjKSxiKCJjb252ZXJ0IixvYyk7Y2xhc3MgQnIgZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJVbmlmb3JtR3JvdXBOb2RlIn1jb25zdHJ1Y3Rvcih0LGU9ITEscz0xKXtzdXBlcigic3RyaW5nIiksdGhpcy5uYW1lPXQsdGhpcy52ZXJzaW9uPTAsdGhpcy5zaGFyZWQ9ZSx0aGlzLm9yZGVyPXMsdGhpcy5pc1VuaWZvcm1Hcm91cD0hMH1zZXQgbmVlZHNVcGRhdGUodCl7dD09PSEwJiZ0aGlzLnZlcnNpb24rK31zZXJpYWxpemUodCl7c3VwZXIuc2VyaWFsaXplKHQpLHQubmFtZT10aGlzLm5hbWUsdC52ZXJzaW9uPXRoaXMudmVyc2lvbix0LnNoYXJlZD10aGlzLnNoYXJlZH1kZXNlcmlhbGl6ZSh0KXtzdXBlci5kZXNlcmlhbGl6ZSh0KSx0aGlzLm5hbWU9dC5uYW1lLHRoaXMudmVyc2lvbj10LnZlcnNpb24sdGhpcy5zaGFyZWQ9dC5zaGFyZWR9fWNvbnN0IGFjPXI9Pm5ldyBCcihyKSxkZT0oKHIsdD0wKT0+bmV3IEJyKHIsITAsdCkpKCJyZW5kZXIiKSxjYz1hYygib2JqZWN0Iik7Y2xhc3MgSWUgZXh0ZW5kcyBqbntzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iVW5pZm9ybU5vZGUifWNvbnN0cnVjdG9yKHQsZT1udWxsKXtzdXBlcih0LGUpLHRoaXMuaXNVbmlmb3JtTm9kZT0hMCx0aGlzLm5hbWU9IiIsdGhpcy5ncm91cE5vZGU9Y2N9bGFiZWwodCl7cmV0dXJuIHRoaXMubmFtZT10LHRoaXN9c2V0R3JvdXAodCl7cmV0dXJuIHRoaXMuZ3JvdXBOb2RlPXQsdGhpc31nZXRHcm91cCgpe3JldHVybiB0aGlzLmdyb3VwTm9kZX1nZXRVbmlmb3JtSGFzaCh0KXtyZXR1cm4gdGhpcy5nZXRIYXNoKHQpfW9uVXBkYXRlKHQsZSl7Y29uc3Qgcz10aGlzLmdldFNlbGYoKTtyZXR1cm4gdD10LmJpbmQocyksc3VwZXIub25VcGRhdGUobj0+e2NvbnN0IGk9dChuLHMpO2khPT12b2lkIDAmJih0aGlzLnZhbHVlPWkpfSxlKX1nZW5lcmF0ZSh0LGUpe2NvbnN0IHM9dGhpcy5nZXROb2RlVHlwZSh0KSxuPXRoaXMuZ2V0VW5pZm9ybUhhc2godCk7bGV0IGk9dC5nZXROb2RlRnJvbUhhc2gobik7aT09PXZvaWQgMCYmKHQuc2V0SGFzaE5vZGUodGhpcyxuKSxpPXRoaXMpO2NvbnN0IG89aS5nZXRJbnB1dFR5cGUodCksYT10LmdldFVuaWZvcm1Gcm9tTm9kZShpLG8sdC5zaGFkZXJTdGFnZSx0aGlzLm5hbWV8fHQuY29udGV4dC5sYWJlbCksYz10LmdldFByb3BlcnR5TmFtZShhKTtyZXR1cm4gdC5jb250ZXh0LmxhYmVsIT09dm9pZCAwJiZkZWxldGUgdC5jb250ZXh0LmxhYmVsLHQuZm9ybWF0KGMscyxlKX19Y29uc3QgeHQ9KHIsdCk9Pntjb25zdCBlPXFhKHR8fHIpLHM9ciYmci5pc05vZGU9PT0hMD9yLm5vZGUmJnIubm9kZS52YWx1ZXx8ci52YWx1ZTpyO3JldHVybiB2KG5ldyBJZShzLGUpKX07Y2xhc3MgSXIgZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJQcm9wZXJ0eU5vZGUifWNvbnN0cnVjdG9yKHQsZT1udWxsLHM9ITEpe3N1cGVyKHQpLHRoaXMubmFtZT1lLHRoaXMudmFyeWluZz1zLHRoaXMuaXNQcm9wZXJ0eU5vZGU9ITB9Z2V0SGFzaCh0KXtyZXR1cm4gdGhpcy5uYW1lfHxzdXBlci5nZXRIYXNoKHQpfWlzR2xvYmFsKCl7cmV0dXJuITB9Z2VuZXJhdGUodCl7bGV0IGU7cmV0dXJuIHRoaXMudmFyeWluZz09PSEwPyhlPXQuZ2V0VmFyeWluZ0Zyb21Ob2RlKHRoaXMsdGhpcy5uYW1lKSxlLm5lZWRzSW50ZXJwb2xhdGlvbj0hMCk6ZT10LmdldFZhckZyb21Ob2RlKHRoaXMsdGhpcy5uYW1lKSx0LmdldFByb3BlcnR5TmFtZShlKX19Y29uc3QgdmU9KHIsdCk9PnYobmV3IElyKHIsdCkpLHZyPU8oSXIsInZlYzQiLCJEaWZmdXNlQ29sb3IiKTtjbGFzcyBoYyBleHRlbmRzIGR0e3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJBc3NpZ25Ob2RlIn1jb25zdHJ1Y3Rvcih0LGUpe3N1cGVyKCksdGhpcy50YXJnZXROb2RlPXQsdGhpcy5zb3VyY2VOb2RlPWV9aGFzRGVwZW5kZW5jaWVzKCl7cmV0dXJuITF9Z2V0Tm9kZVR5cGUodCxlKXtyZXR1cm4gZSE9PSJ2b2lkIj90aGlzLnRhcmdldE5vZGUuZ2V0Tm9kZVR5cGUodCk6InZvaWQifW5lZWRzU3BsaXRBc3NpZ24odCl7Y29uc3R7dGFyZ2V0Tm9kZTplfT10aGlzO2lmKHQuaXNBdmFpbGFibGUoInN3aXp6bGVBc3NpZ24iKT09PSExJiZlLmlzU3BsaXROb2RlJiZlLmNvbXBvbmVudHMubGVuZ3RoPjEpe2NvbnN0IHM9dC5nZXRUeXBlTGVuZ3RoKGUubm9kZS5nZXROb2RlVHlwZSh0KSk7cmV0dXJuIG5zLmpvaW4oIiIpLnNsaWNlKDAscykhPT1lLmNvbXBvbmVudHN9cmV0dXJuITF9Z2VuZXJhdGUodCxlKXtjb25zdHt0YXJnZXROb2RlOnMsc291cmNlTm9kZTpufT10aGlzLGk9dGhpcy5uZWVkc1NwbGl0QXNzaWduKHQpLG89cy5nZXROb2RlVHlwZSh0KSxhPXMuY29udGV4dCh7YXNzaWduOiEwfSkuYnVpbGQodCksYz1uLmJ1aWxkKHQsbyksdT1uLmdldE5vZGVUeXBlKHQpLGg9dC5nZXREYXRhRnJvbU5vZGUodGhpcyk7bGV0IGw7aWYoaC5pbml0aWFsaXplZD09PSEwKWUhPT0idm9pZCImJihsPWEpO2Vsc2UgaWYoaSl7Y29uc3QgZD10LmdldFZhckZyb21Ob2RlKHRoaXMsbnVsbCxvKSxmPXQuZ2V0UHJvcGVydHlOYW1lKGQpO3QuYWRkTGluZUZsb3dDb2RlKGAke2Z9ID0gJHtjfWAsdGhpcyk7Y29uc3QgcD1zLm5vZGUuY29udGV4dCh7YXNzaWduOiEwfSkuYnVpbGQodCk7Zm9yKGxldCBtPTA7bTxzLmNvbXBvbmVudHMubGVuZ3RoO20rKyl7Y29uc3QgZz1zLmNvbXBvbmVudHNbbV07dC5hZGRMaW5lRmxvd0NvZGUoYCR7cH0uJHtnfSA9ICR7Zn1bICR7bX0gXWAsdGhpcyl9ZSE9PSJ2b2lkIiYmKGw9YSl9ZWxzZSBsPWAke2F9ID0gJHtjfWAsKGU9PT0idm9pZCJ8fHU9PT0idm9pZCIpJiYodC5hZGRMaW5lRmxvd0NvZGUobCx0aGlzKSxlIT09InZvaWQiJiYobD1hKSk7cmV0dXJuIGguaW5pdGlhbGl6ZWQ9ITAsdC5mb3JtYXQobCxvLGUpfX1iKCJhc3NpZ24iLEMoaGMpKTtjbGFzcyB1YyBleHRlbmRzIGR0e3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJGdW5jdGlvbkNhbGxOb2RlIn1jb25zdHJ1Y3Rvcih0PW51bGwsZT17fSl7c3VwZXIoKSx0aGlzLmZ1bmN0aW9uTm9kZT10LHRoaXMucGFyYW1ldGVycz1lfXNldFBhcmFtZXRlcnModCl7cmV0dXJuIHRoaXMucGFyYW1ldGVycz10LHRoaXN9Z2V0UGFyYW1ldGVycygpe3JldHVybiB0aGlzLnBhcmFtZXRlcnN9Z2V0Tm9kZVR5cGUodCl7cmV0dXJuIHRoaXMuZnVuY3Rpb25Ob2RlLmdldE5vZGVUeXBlKHQpfWdlbmVyYXRlKHQpe2NvbnN0IGU9W10scz10aGlzLmZ1bmN0aW9uTm9kZSxuPXMuZ2V0SW5wdXRzKHQpLGk9dGhpcy5wYXJhbWV0ZXJzO2lmKEFycmF5LmlzQXJyYXkoaSkpZm9yKGxldCBhPTA7YTxpLmxlbmd0aDthKyspe2NvbnN0IGM9blthXSx1PWlbYV07ZS5wdXNoKHUuYnVpbGQodCxjLnR5cGUpKX1lbHNlIGZvcihjb25zdCBhIG9mIG4pe2NvbnN0IGM9aVthLm5hbWVdO2lmKGMhPT12b2lkIDApZS5wdXNoKGMuYnVpbGQodCxhLnR5cGUpKTtlbHNlIHRocm93IG5ldyBFcnJvcihgRnVuY3Rpb25DYWxsTm9kZTogSW5wdXQgJyR7YS5uYW1lfScgbm90IGZvdW5kIGluIEZ1bmN0aW9uTm9kZS5gKX1yZXR1cm5gJHtzLmJ1aWxkKHQsInByb3BlcnR5Iil9KCAke2Uuam9pbigiLCAiKX0gKWB9fWIoImNhbGwiLChyLC4uLnQpPT4odD10Lmxlbmd0aD4xfHx0WzBdJiZ0WzBdLmlzTm9kZT09PSEwP0ZlKHQpOkhzKHRbMF0pLHYobmV3IHVjKHYociksdCkpKSk7Y2xhc3MgWSBleHRlbmRzIGR0e3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJPcGVyYXRvck5vZGUifWNvbnN0cnVjdG9yKHQsZSxzLC4uLm4pe2lmKHN1cGVyKCksbi5sZW5ndGg+MCl7bGV0IGk9bmV3IFkodCxlLHMpO2ZvcihsZXQgbz0wO288bi5sZW5ndGgtMTtvKyspaT1uZXcgWSh0LGksbltvXSk7ZT1pLHM9bltuLmxlbmd0aC0xXX10aGlzLm9wPXQsdGhpcy5hTm9kZT1lLHRoaXMuYk5vZGU9c31nZXROb2RlVHlwZSh0LGUpe2NvbnN0IHM9dGhpcy5vcCxuPXRoaXMuYU5vZGUsaT10aGlzLmJOb2RlLG89bi5nZXROb2RlVHlwZSh0KSxhPXR5cGVvZiBpPCJ1Ij9pLmdldE5vZGVUeXBlKHQpOm51bGw7aWYobz09PSJ2b2lkInx8YT09PSJ2b2lkIilyZXR1cm4idm9pZCI7aWYocz09PSIlIilyZXR1cm4gbztpZihzPT09In4ifHxzPT09IiYifHxzPT09InwifHxzPT09Il4ifHxzPT09Ij4+Inx8cz09PSI8PCIpcmV0dXJuIHQuZ2V0SW50ZWdlclR5cGUobyk7aWYocz09PSIhInx8cz09PSI9PSJ8fHM9PT0iJiYifHxzPT09Inx8Inx8cz09PSJeXiIpcmV0dXJuImJvb2wiO2lmKHM9PT0iPCJ8fHM9PT0iPiJ8fHM9PT0iPD0ifHxzPT09Ij49Iil7Y29uc3QgYz1lP3QuZ2V0VHlwZUxlbmd0aChlKTpNYXRoLm1heCh0LmdldFR5cGVMZW5ndGgobyksdC5nZXRUeXBlTGVuZ3RoKGEpKTtyZXR1cm4gYz4xP2BidmVjJHtjfWA6ImJvb2wifWVsc2UgcmV0dXJuIG89PT0iZmxvYXQiJiZ0LmlzTWF0cml4KGEpP2E6dC5pc01hdHJpeChvKSYmdC5pc1ZlY3RvcihhKT90LmdldFZlY3RvckZyb21NYXRyaXgobyk6dC5pc1ZlY3RvcihvKSYmdC5pc01hdHJpeChhKT90LmdldFZlY3RvckZyb21NYXRyaXgoYSk6dC5nZXRUeXBlTGVuZ3RoKGEpPnQuZ2V0VHlwZUxlbmd0aChvKT9hOm99Z2VuZXJhdGUodCxlKXtjb25zdCBzPXRoaXMub3Asbj10aGlzLmFOb2RlLGk9dGhpcy5iTm9kZSxvPXRoaXMuZ2V0Tm9kZVR5cGUodCxlKTtsZXQgYT1udWxsLGM9bnVsbDtvIT09InZvaWQiPyhhPW4uZ2V0Tm9kZVR5cGUodCksYz10eXBlb2YgaTwidSI/aS5nZXROb2RlVHlwZSh0KTpudWxsLHM9PT0iPCJ8fHM9PT0iPiJ8fHM9PT0iPD0ifHxzPT09Ij49Inx8cz09PSI9PSI/dC5pc1ZlY3RvcihhKT9jPWE6YSE9PWMmJihhPWM9ImZsb2F0Iik6cz09PSI+PiJ8fHM9PT0iPDwiPyhhPW8sYz10LmNoYW5nZUNvbXBvbmVudFR5cGUoYywidWludCIpKTp0LmlzTWF0cml4KGEpJiZ0LmlzVmVjdG9yKGMpP2M9dC5nZXRWZWN0b3JGcm9tTWF0cml4KGEpOnQuaXNWZWN0b3IoYSkmJnQuaXNNYXRyaXgoYyk/YT10LmdldFZlY3RvckZyb21NYXRyaXgoYyk6YT1jPW8pOmE9Yz1vO2NvbnN0IHU9bi5idWlsZCh0LGEpLGg9dHlwZW9mIGk8InUiP2kuYnVpbGQodCxjKTpudWxsLGw9dC5nZXRUeXBlTGVuZ3RoKGUpLGQ9dC5nZXRGdW5jdGlvbk9wZXJhdG9yKHMpO2lmKGUhPT0idm9pZCIpcmV0dXJuIHM9PT0iPCImJmw+MT90LnVzZUNvbXBhcmlzb25NZXRob2Q/dC5mb3JtYXQoYCR7dC5nZXRNZXRob2QoImxlc3NUaGFuIixlKX0oICR7dX0sICR7aH0gKWAsbyxlKTp0LmZvcm1hdChgKCAke3V9IDwgJHtofSApYCxvLGUpOnM9PT0iPD0iJiZsPjE/dC51c2VDb21wYXJpc29uTWV0aG9kP3QuZm9ybWF0KGAke3QuZ2V0TWV0aG9kKCJsZXNzVGhhbkVxdWFsIixlKX0oICR7dX0sICR7aH0gKWAsbyxlKTp0LmZvcm1hdChgKCAke3V9IDw9ICR7aH0gKWAsbyxlKTpzPT09Ij4iJiZsPjE/dC51c2VDb21wYXJpc29uTWV0aG9kP3QuZm9ybWF0KGAke3QuZ2V0TWV0aG9kKCJncmVhdGVyVGhhbiIsZSl9KCAke3V9LCAke2h9IClgLG8sZSk6dC5mb3JtYXQoYCggJHt1fSA+ICR7aH0gKWAsbyxlKTpzPT09Ij49IiYmbD4xP3QudXNlQ29tcGFyaXNvbk1ldGhvZD90LmZvcm1hdChgJHt0LmdldE1ldGhvZCgiZ3JlYXRlclRoYW5FcXVhbCIsZSl9KCAke3V9LCAke2h9IClgLG8sZSk6dC5mb3JtYXQoYCggJHt1fSA+PSAke2h9IClgLG8sZSk6cz09PSIhInx8cz09PSJ+Ij90LmZvcm1hdChgKCR7c30ke3V9KWAsYSxlKTpkP3QuZm9ybWF0KGAke2R9KCAke3V9LCAke2h9IClgLG8sZSk6dC5mb3JtYXQoYCggJHt1fSAke3N9ICR7aH0gKWAsbyxlKTtpZihhIT09InZvaWQiKXJldHVybiBkP3QuZm9ybWF0KGAke2R9KCAke3V9LCAke2h9IClgLG8sZSk6dC5mb3JtYXQoYCR7dX0gJHtzfSAke2h9YCxvLGUpfXNlcmlhbGl6ZSh0KXtzdXBlci5zZXJpYWxpemUodCksdC5vcD10aGlzLm9wfWRlc2VyaWFsaXplKHQpe3N1cGVyLmRlc2VyaWFsaXplKHQpLHRoaXMub3A9dC5vcH19Y29uc3QgZmU9QyhZLCIrIiksJHM9QyhZLCItIiksR3M9QyhZLCIqIiksUHI9QyhZLCIvIiksTHI9QyhZLCIlIiksbGM9QyhZLCI9PSIpLGRjPUMoWSwiIT0iKSxmYz1DKFksIjwiKSxwYz1DKFksIj4iKSxtYz1DKFksIjw9IikseWM9QyhZLCI+PSIpLGdjPUMoWSwiJiYiKSx4Yz1DKFksInx8IiksVGM9QyhZLCIhIiksTmM9QyhZLCJeXiIpLHdjPUMoWSwiJiIpLEFjPUMoWSwifiIpLE1jPUMoWSwifCIpLFNjPUMoWSwiXiIpLF9jPUMoWSwiPDwiKSx6Yz1DKFksIj4+Iik7YigiYWRkIixmZSksYigic3ViIiwkcyksYigibXVsIixHcyksYigiZGl2IixQciksYigibW9kSW50IixMciksYigiZXF1YWwiLGxjKSxiKCJub3RFcXVhbCIsZGMpLGIoImxlc3NUaGFuIixmYyksYigiZ3JlYXRlclRoYW4iLHBjKSxiKCJsZXNzVGhhbkVxdWFsIixtYyksYigiZ3JlYXRlclRoYW5FcXVhbCIseWMpLGIoImFuZCIsZ2MpLGIoIm9yIix4YyksYigibm90IixUYyksYigieG9yIixOYyksYigiYml0QW5kIix3YyksYigiYml0Tm90IixBYyksYigiYml0T3IiLE1jKSxiKCJiaXRYb3IiLFNjKSxiKCJzaGlmdExlZnQiLF9jKSxiKCJzaGlmdFJpZ2h0Iix6YyksYigicmVtYWluZGVyIiwoLi4ucik9Pihjb25zb2xlLndhcm4oIlRTTC5PcGVyYXRvck5vZGU6IC5yZW1haW5kZXIoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5tb2RJbnQoKS4iKSxMciguLi5yKSkpO2NsYXNzIHggZXh0ZW5kcyBkdHtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iTWF0aE5vZGUifWNvbnN0cnVjdG9yKHQsZSxzPW51bGwsbj1udWxsKXtzdXBlcigpLHRoaXMubWV0aG9kPXQsdGhpcy5hTm9kZT1lLHRoaXMuYk5vZGU9cyx0aGlzLmNOb2RlPW59Z2V0SW5wdXRUeXBlKHQpe2NvbnN0IGU9dGhpcy5hTm9kZS5nZXROb2RlVHlwZSh0KSxzPXRoaXMuYk5vZGU/dGhpcy5iTm9kZS5nZXROb2RlVHlwZSh0KTpudWxsLG49dGhpcy5jTm9kZT90aGlzLmNOb2RlLmdldE5vZGVUeXBlKHQpOm51bGwsaT10LmlzTWF0cml4KGUpPzA6dC5nZXRUeXBlTGVuZ3RoKGUpLG89dC5pc01hdHJpeChzKT8wOnQuZ2V0VHlwZUxlbmd0aChzKSxhPXQuaXNNYXRyaXgobik/MDp0LmdldFR5cGVMZW5ndGgobik7cmV0dXJuIGk+byYmaT5hP2U6bz5hP3M6YT5pP246ZX1nZXROb2RlVHlwZSh0KXtjb25zdCBlPXRoaXMubWV0aG9kO3JldHVybiBlPT09eC5MRU5HVEh8fGU9PT14LkRJU1RBTkNFfHxlPT09eC5ET1Q/ImZsb2F0IjplPT09eC5DUk9TUz8idmVjMyI6ZT09PXguQUxMPyJib29sIjplPT09eC5FUVVBTFM/dC5jaGFuZ2VDb21wb25lbnRUeXBlKHRoaXMuYU5vZGUuZ2V0Tm9kZVR5cGUodCksImJvb2wiKTplPT09eC5NT0Q/dGhpcy5hTm9kZS5nZXROb2RlVHlwZSh0KTp0aGlzLmdldElucHV0VHlwZSh0KX1nZW5lcmF0ZSh0LGUpe2NvbnN0IHM9dGhpcy5tZXRob2Qsbj10aGlzLmdldE5vZGVUeXBlKHQpLGk9dGhpcy5nZXRJbnB1dFR5cGUodCksbz10aGlzLmFOb2RlLGE9dGhpcy5iTm9kZSxjPXRoaXMuY05vZGUsdT10LnJlbmRlcmVyLmlzV2ViR0xSZW5kZXJlcj09PSEwO2lmKHM9PT14LlRSQU5TRk9STV9ESVJFQ1RJT04pe2xldCBoPW8sbD1hO3QuaXNNYXRyaXgoaC5nZXROb2RlVHlwZSh0KSk/bD1CZShrKGwpLDApOmg9QmUoayhoKSwwKTtjb25zdCBkPUdzKGgsbCkueHl6O3JldHVybiBPcihkKS5idWlsZCh0LGUpfWVsc2V7aWYocz09PXguTkVHQVRFKXJldHVybiB0LmZvcm1hdCgiKCAtICIrby5idWlsZCh0LGkpKyIgKSIsbixlKTtpZihzPT09eC5PTkVfTUlOVVMpcmV0dXJuICRzKDEsbykuYnVpbGQodCxlKTtpZihzPT09eC5SRUNJUFJPQ0FMKXJldHVybiBQcigxLG8pLmJ1aWxkKHQsZSk7aWYocz09PXguRElGRkVSRU5DRSlyZXR1cm4gb2koJHMobyxhKSkuYnVpbGQodCxlKTt7Y29uc3QgaD1bXTtyZXR1cm4gcz09PXguQ1JPU1N8fHM9PT14Lk1PRD9oLnB1c2goby5idWlsZCh0LG4pLGEuYnVpbGQodCxuKSk6dSYmcz09PXguU1RFUD9oLnB1c2goby5idWlsZCh0LHQuZ2V0VHlwZUxlbmd0aChvLmdldE5vZGVUeXBlKHQpKT09PTE/ImZsb2F0IjppKSxhLmJ1aWxkKHQsaSkpOnUmJihzPT09eC5NSU58fHM9PT14Lk1BWCl8fHM9PT14Lk1PRD9oLnB1c2goby5idWlsZCh0LGkpLGEuYnVpbGQodCx0LmdldFR5cGVMZW5ndGgoYS5nZXROb2RlVHlwZSh0KSk9PT0xPyJmbG9hdCI6aSkpOnM9PT14LlJFRlJBQ1Q/aC5wdXNoKG8uYnVpbGQodCxpKSxhLmJ1aWxkKHQsaSksYy5idWlsZCh0LCJmbG9hdCIpKTpzPT09eC5NSVg/aC5wdXNoKG8uYnVpbGQodCxpKSxhLmJ1aWxkKHQsaSksYy5idWlsZCh0LHQuZ2V0VHlwZUxlbmd0aChjLmdldE5vZGVUeXBlKHQpKT09PTE/ImZsb2F0IjppKSk6KGgucHVzaChvLmJ1aWxkKHQsaSkpLGEhPT1udWxsJiZoLnB1c2goYS5idWlsZCh0LGkpKSxjIT09bnVsbCYmaC5wdXNoKGMuYnVpbGQodCxpKSkpLHQuZm9ybWF0KGAke3QuZ2V0TWV0aG9kKHMsbil9KCAke2guam9pbigiLCAiKX0gKWAsbixlKX19fXNlcmlhbGl6ZSh0KXtzdXBlci5zZXJpYWxpemUodCksdC5tZXRob2Q9dGhpcy5tZXRob2R9ZGVzZXJpYWxpemUodCl7c3VwZXIuZGVzZXJpYWxpemUodCksdGhpcy5tZXRob2Q9dC5tZXRob2R9fXguQUxMPSJhbGwiLHguQU5ZPSJhbnkiLHguRVFVQUxTPSJlcXVhbHMiLHguUkFESUFOUz0icmFkaWFucyIseC5ERUdSRUVTPSJkZWdyZWVzIix4LkVYUD0iZXhwIix4LkVYUDI9ImV4cDIiLHguTE9HPSJsb2ciLHguTE9HMj0ibG9nMiIseC5TUVJUPSJzcXJ0Iix4LklOVkVSU0VfU1FSVD0iaW52ZXJzZXNxcnQiLHguRkxPT1I9ImZsb29yIix4LkNFSUw9ImNlaWwiLHguTk9STUFMSVpFPSJub3JtYWxpemUiLHguRlJBQ1Q9ImZyYWN0Iix4LlNJTj0ic2luIix4LkNPUz0iY29zIix4LlRBTj0idGFuIix4LkFTSU49ImFzaW4iLHguQUNPUz0iYWNvcyIseC5BVEFOPSJhdGFuIix4LkFCUz0iYWJzIix4LlNJR049InNpZ24iLHguTEVOR1RIPSJsZW5ndGgiLHguTkVHQVRFPSJuZWdhdGUiLHguT05FX01JTlVTPSJvbmVNaW51cyIseC5ERkRYPSJkRmR4Iix4LkRGRFk9ImRGZHkiLHguUk9VTkQ9InJvdW5kIix4LlJFQ0lQUk9DQUw9InJlY2lwcm9jYWwiLHguVFJVTkM9InRydW5jIix4LkZXSURUSD0iZndpZHRoIix4LkJJVENBU1Q9ImJpdGNhc3QiLHguVFJBTlNQT1NFPSJ0cmFuc3Bvc2UiLHguQVRBTjI9ImF0YW4yIix4Lk1JTj0ibWluIix4Lk1BWD0ibWF4Iix4Lk1PRD0ibW9kIix4LlNURVA9InN0ZXAiLHguUkVGTEVDVD0icmVmbGVjdCIseC5ESVNUQU5DRT0iZGlzdGFuY2UiLHguRElGRkVSRU5DRT0iZGlmZmVyZW5jZSIseC5ET1Q9ImRvdCIseC5DUk9TUz0iY3Jvc3MiLHguUE9XPSJwb3ciLHguVFJBTlNGT1JNX0RJUkVDVElPTj0idHJhbnNmb3JtRGlyZWN0aW9uIix4Lk1JWD0ibWl4Iix4LkNMQU1QPSJjbGFtcCIseC5SRUZSQUNUPSJyZWZyYWN0Iix4LlNNT09USFNURVA9InNtb290aHN0ZXAiLHguRkFDRUZPUldBUkQ9ImZhY2Vmb3J3YXJkIjtjb25zdCBiYz1xKE1hdGguUEkpLEVjPUMoeCx4LkFMTCksQ2M9Qyh4LHguQU5ZKSxGYz1DKHgseC5FUVVBTFMpLFJjPUMoeCx4LlJBRElBTlMpLEJjPUMoeCx4LkRFR1JFRVMpLEljPUMoeCx4LkVYUCksdmM9Qyh4LHguRVhQMiksUGM9Qyh4LHguTE9HKSxMYz1DKHgseC5MT0cyKSxpaT1DKHgseC5TUVJUKSxPYz1DKHgseC5JTlZFUlNFX1NRUlQpLERjPUMoeCx4LkZMT09SKSxWYz1DKHgseC5DRUlMKSxPcj1DKHgseC5OT1JNQUxJWkUpLHJpPUMoeCx4LkZSQUNUKSxEcj1DKHgseC5TSU4pLFVjPUMoeCx4LkNPUyksa2M9Qyh4LHguVEFOKSxIYz1DKHgseC5BU0lOKSxxYz1DKHgseC5BQ09TKSwkYz1DKHgseC5BVEFOKSxvaT1DKHgseC5BQlMpLFZyPUMoeCx4LlNJR04pLEdjPUMoeCx4LkxFTkdUSCksV2M9Qyh4LHguTkVHQVRFKSxYYz1DKHgseC5PTkVfTUlOVVMpLFljPUMoeCx4LkRGRFgpLFpjPUMoeCx4LkRGRFkpLEpjPUMoeCx4LlJPVU5EKSxqYz1DKHgseC5SRUNJUFJPQ0FMKSxRYz1DKHgseC5UUlVOQyksS2M9Qyh4LHguRldJRFRIKTt4LkJJVENBU1Q7Y29uc3QgdGg9Qyh4LHguVFJBTlNQT1NFKSxlaD1DKHgseC5BVEFOMiksc2g9Qyh4LHguTUlOKSxhaT1DKHgseC5NQVgpLFVyPUMoeCx4Lk1PRCksa3I9Qyh4LHguU1RFUCksbmg9Qyh4LHguUkVGTEVDVCksaWg9Qyh4LHguRElTVEFOQ0UpLHJoPUMoeCx4LkRJRkZFUkVOQ0UpLGNpPUMoeCx4LkRPVCksb2g9Qyh4LHguQ1JPU1MpLEhyPUMoeCx4LlBPVyksYWg9Qyh4LHguUE9XLDIpLGNoPUMoeCx4LlBPVywzKSxoaD1DKHgseC5QT1csNCksdWg9Qyh4LHguVFJBTlNGT1JNX0RJUkVDVElPTiksbGg9cj0+R3MoVnIociksSHIob2kociksMS8zKSksZGg9cj0+Y2kocixyKSxyZT1DKHgseC5NSVgpLFdzPShyLHQ9MCxlPTEpPT52KG5ldyB4KHguQ0xBTVAsdihyKSx2KHQpLHYoZSkpKSxmaD1yPT5XcyhyKSxwaD1DKHgseC5SRUZSQUNUKSxoaT1DKHgseC5TTU9PVEhTVEVQKSxtaD1DKHgseC5GQUNFRk9SV0FSRCkseWg9dHQoKFtyXSk9Pntjb25zdCBzPTQzNzU4LjU0NTMsbj1jaShyLnh5LEQoMTIuOTg5OCw3OC4yMzMpKSxpPVVyKG4sYmMpO3JldHVybiByaShEcihpKS5tdWwocykpfSksZ2g9KHIsdCxlKT0+cmUodCxlLHIpLHhoPShyLHQsZSk9PmhpKHQsZSxyKTtiKCJhbGwiLEVjKSxiKCJhbnkiLENjKSxiKCJlcXVhbHMiLEZjKSxiKCJyYWRpYW5zIixSYyksYigiZGVncmVlcyIsQmMpLGIoImV4cCIsSWMpLGIoImV4cDIiLHZjKSxiKCJsb2ciLFBjKSxiKCJsb2cyIixMYyksYigic3FydCIsaWkpLGIoImludmVyc2VTcXJ0IixPYyksYigiZmxvb3IiLERjKSxiKCJjZWlsIixWYyksYigibm9ybWFsaXplIixPciksYigiZnJhY3QiLHJpKSxiKCJzaW4iLERyKSxiKCJjb3MiLFVjKSxiKCJ0YW4iLGtjKSxiKCJhc2luIixIYyksYigiYWNvcyIscWMpLGIoImF0YW4iLCRjKSxiKCJhYnMiLG9pKSxiKCJzaWduIixWciksYigibGVuZ3RoIixHYyksYigibGVuZ3RoU3EiLGRoKSxiKCJuZWdhdGUiLFdjKSxiKCJvbmVNaW51cyIsWGMpLGIoImRGZHgiLFljKSxiKCJkRmR5IixaYyksYigicm91bmQiLEpjKSxiKCJyZWNpcHJvY2FsIixqYyksYigidHJ1bmMiLFFjKSxiKCJmd2lkdGgiLEtjKSxiKCJhdGFuMiIsZWgpLGIoIm1pbiIsc2gpLGIoIm1heCIsYWkpLGIoIm1vZCIsVXIpLGIoInN0ZXAiLGtyKSxiKCJyZWZsZWN0IixuaCksYigiZGlzdGFuY2UiLGloKSxiKCJkb3QiLGNpKSxiKCJjcm9zcyIsb2gpLGIoInBvdyIsSHIpLGIoInBvdzIiLGFoKSxiKCJwb3czIixjaCksYigicG93NCIsaGgpLGIoInRyYW5zZm9ybURpcmVjdGlvbiIsdWgpLGIoIm1peCIsZ2gpLGIoImNsYW1wIixXcyksYigicmVmcmFjdCIscGgpLGIoInNtb290aHN0ZXAiLHhoKSxiKCJmYWNlRm9yd2FyZCIsbWgpLGIoImRpZmZlcmVuY2UiLHJoKSxiKCJzYXR1cmF0ZSIsZmgpLGIoImNicnQiLGxoKSxiKCJ0cmFuc3Bvc2UiLHRoKSxiKCJyYW5kIix5aCk7Y2xhc3MgVGggZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJDb25kaXRpb25hbE5vZGUifWNvbnN0cnVjdG9yKHQsZSxzPW51bGwpe3N1cGVyKCksdGhpcy5jb25kTm9kZT10LHRoaXMuaWZOb2RlPWUsdGhpcy5lbHNlTm9kZT1zfWdldE5vZGVUeXBlKHQpe2NvbnN0IGU9dGhpcy5pZk5vZGUuZ2V0Tm9kZVR5cGUodCk7aWYodGhpcy5lbHNlTm9kZSE9PW51bGwpe2NvbnN0IHM9dGhpcy5lbHNlTm9kZS5nZXROb2RlVHlwZSh0KTtpZih0LmdldFR5cGVMZW5ndGgocyk+dC5nZXRUeXBlTGVuZ3RoKGUpKXJldHVybiBzfXJldHVybiBlfXNldHVwKHQpe2NvbnN0IGU9dGhpcy5jb25kTm9kZS5jYWNoZSgpLHM9dGhpcy5pZk5vZGUuY2FjaGUoKSxuPXRoaXMuZWxzZU5vZGU/dGhpcy5lbHNlTm9kZS5jYWNoZSgpOm51bGwsaT10LmNvbnRleHQubm9kZUJsb2NrO3QuZ2V0RGF0YUZyb21Ob2RlKHMpLnBhcmVudE5vZGVCbG9jaz1pLG4hPT1udWxsJiYodC5nZXREYXRhRnJvbU5vZGUobikucGFyZW50Tm9kZUJsb2NrPWkpO2NvbnN0IG89dC5nZXROb2RlUHJvcGVydGllcyh0aGlzKTtvLmNvbmROb2RlPWUsby5pZk5vZGU9cy5jb250ZXh0KHtub2RlQmxvY2s6c30pLG8uZWxzZU5vZGU9bj9uLmNvbnRleHQoe25vZGVCbG9jazpufSk6bnVsbH1nZW5lcmF0ZSh0LGUpe2NvbnN0IHM9dGhpcy5nZXROb2RlVHlwZSh0KSxuPXQuZ2V0RGF0YUZyb21Ob2RlKHRoaXMpO2lmKG4ubm9kZVByb3BlcnR5IT09dm9pZCAwKXJldHVybiBuLm5vZGVQcm9wZXJ0eTtjb25zdHtjb25kTm9kZTppLGlmTm9kZTpvLGVsc2VOb2RlOmF9PXQuZ2V0Tm9kZVByb3BlcnRpZXModGhpcyksYz1lIT09InZvaWQiLHU9Yz92ZShzKS5idWlsZCh0KToiIjtuLm5vZGVQcm9wZXJ0eT11O2NvbnN0IGg9aS5idWlsZCh0LCJib29sIik7dC5hZGRGbG93Q29kZShgCiR7dC50YWJ9aWYgKCAke2h9ICkgewoKYCkuYWRkRmxvd1RhYigpO2xldCBsPW8uYnVpbGQodCxzKTtpZihsJiYoYz9sPXUrIiA9ICIrbCsiOyI6bD0icmV0dXJuICIrbCsiOyIpLHQucmVtb3ZlRmxvd1RhYigpLmFkZEZsb3dDb2RlKHQudGFiKyIJIitsK2AKCmArdC50YWIrIn0iKSxhIT09bnVsbCl7dC5hZGRGbG93Q29kZShgIGVsc2UgewoKYCkuYWRkRmxvd1RhYigpO2xldCBkPWEuYnVpbGQodCxzKTtkJiYoYz9kPXUrIiA9ICIrZCsiOyI6ZD0icmV0dXJuICIrZCsiOyIpLHQucmVtb3ZlRmxvd1RhYigpLmFkZEZsb3dDb2RlKHQudGFiKyIJIitkK2AKCmArdC50YWIrYH0KCmApfWVsc2UgdC5hZGRGbG93Q29kZShgCgpgKTtyZXR1cm4gdC5mb3JtYXQodSxzLGUpfX1jb25zdCB1aT1DKFRoKTtiKCJzZWxlY3QiLHVpKSxiKCJjb25kIiwoLi4ucik9Pihjb25zb2xlLndhcm4oIlRTTC5Db25kaXRpb25hbE5vZGU6IGNvbmQoKSBoYXMgYmVlbiByZW5hbWVkIHRvIHNlbGVjdCgpLiIpLHVpKC4uLnIpKSk7Y2xhc3MgTmggZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJDb250ZXh0Tm9kZSJ9Y29uc3RydWN0b3IodCxlPXt9KXtzdXBlcigpLHRoaXMuaXNDb250ZXh0Tm9kZT0hMCx0aGlzLm5vZGU9dCx0aGlzLnZhbHVlPWV9Z2V0U2NvcGUoKXtyZXR1cm4gdGhpcy5ub2RlLmdldFNjb3BlKCl9Z2V0Tm9kZVR5cGUodCl7cmV0dXJuIHRoaXMubm9kZS5nZXROb2RlVHlwZSh0KX1hbmFseXplKHQpe3RoaXMubm9kZS5idWlsZCh0KX1zZXR1cCh0KXtjb25zdCBlPXQuZ2V0Q29udGV4dCgpO3Quc2V0Q29udGV4dCh7Li4udC5jb250ZXh0LC4uLnRoaXMudmFsdWV9KTtjb25zdCBzPXRoaXMubm9kZS5idWlsZCh0KTtyZXR1cm4gdC5zZXRDb250ZXh0KGUpLHN9Z2VuZXJhdGUodCxlKXtjb25zdCBzPXQuZ2V0Q29udGV4dCgpO3Quc2V0Q29udGV4dCh7Li4udC5jb250ZXh0LC4uLnRoaXMudmFsdWV9KTtjb25zdCBuPXRoaXMubm9kZS5idWlsZCh0LGUpO3JldHVybiB0LnNldENvbnRleHQocyksbn19Y29uc3QgcXI9QyhOaCksd2g9KHIsdCk9PnFyKHIse2xhYmVsOnR9KTtiKCJjb250ZXh0IixxciksYigibGFiZWwiLHdoKTtjbGFzcyBBaCBleHRlbmRzIFV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIlZhck5vZGUifWNvbnN0cnVjdG9yKHQsZT1udWxsKXtzdXBlcigpLHRoaXMubm9kZT10LHRoaXMubmFtZT1lLHRoaXMuZ2xvYmFsPSEwLHRoaXMuaXNWYXJOb2RlPSEwfWdldEhhc2godCl7cmV0dXJuIHRoaXMubmFtZXx8c3VwZXIuZ2V0SGFzaCh0KX1nZXROb2RlVHlwZSh0KXtyZXR1cm4gdGhpcy5ub2RlLmdldE5vZGVUeXBlKHQpfWdlbmVyYXRlKHQpe2NvbnN0e25vZGU6ZSxuYW1lOnN9PXRoaXMsbj10LmdldFZhckZyb21Ob2RlKHRoaXMscyx0LmdldFZlY3RvclR5cGUodGhpcy5nZXROb2RlVHlwZSh0KSkpLGk9dC5nZXRQcm9wZXJ0eU5hbWUobiksbz1lLmJ1aWxkKHQsbi50eXBlKTtyZXR1cm4gdC5hZGRMaW5lRmxvd0NvZGUoYCR7aX0gPSAke299YCx0aGlzKSxpfX1jb25zdCAkcj1DKEFoKTtiKCJ0ZW1wIiwkciksYigidG9WYXIiLCguLi5yKT0+JHIoLi4ucikuYXBwZW5kKCkpO2NsYXNzIE1oIGV4dGVuZHMgVXtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iVmFyeWluZ05vZGUifWNvbnN0cnVjdG9yKHQsZT1udWxsKXtzdXBlcigpLHRoaXMubm9kZT10LHRoaXMubmFtZT1lLHRoaXMuaXNWYXJ5aW5nTm9kZT0hMH1pc0dsb2JhbCgpe3JldHVybiEwfWdldEhhc2godCl7cmV0dXJuIHRoaXMubmFtZXx8c3VwZXIuZ2V0SGFzaCh0KX1nZXROb2RlVHlwZSh0KXtyZXR1cm4gdGhpcy5ub2RlLmdldE5vZGVUeXBlKHQpfXNldHVwVmFyeWluZyh0KXtjb25zdCBlPXQuZ2V0Tm9kZVByb3BlcnRpZXModGhpcyk7bGV0IHM9ZS52YXJ5aW5nO2lmKHM9PT12b2lkIDApe2NvbnN0IG49dGhpcy5uYW1lLGk9dGhpcy5nZXROb2RlVHlwZSh0KTtlLnZhcnlpbmc9cz10LmdldFZhcnlpbmdGcm9tTm9kZSh0aGlzLG4saSksZS5ub2RlPXRoaXMubm9kZX1yZXR1cm4gcy5uZWVkc0ludGVycG9sYXRpb258fChzLm5lZWRzSW50ZXJwb2xhdGlvbj10LnNoYWRlclN0YWdlPT09ImZyYWdtZW50Iiksc31zZXR1cCh0KXt0aGlzLnNldHVwVmFyeWluZyh0KX1hbmFseXplKHQpe3JldHVybiB0aGlzLnNldHVwVmFyeWluZyh0KSx0aGlzLm5vZGUuYW5hbHl6ZSh0KX1nZW5lcmF0ZSh0KXtjb25zdCBlPXQuZ2V0Tm9kZVByb3BlcnRpZXModGhpcykscz10aGlzLnNldHVwVmFyeWluZyh0KTtpZihlLnByb3BlcnR5TmFtZT09PXZvaWQgMCl7Y29uc3Qgbj10aGlzLmdldE5vZGVUeXBlKHQpLGk9dC5nZXRQcm9wZXJ0eU5hbWUocyx3ci5WRVJURVgpO3QuZmxvd05vZGVGcm9tU2hhZGVyU3RhZ2Uod3IuVkVSVEVYLHRoaXMubm9kZSxuLGkpLGUucHJvcGVydHlOYW1lPWl9cmV0dXJuIHQuZ2V0UHJvcGVydHlOYW1lKHMpfX1jb25zdCBQZT1DKE1oKTtiKCJ2YXJ5aW5nIixQZSk7Y29uc3QgcnM9IldvcmtpbmdDb2xvclNwYWNlIixsaT0iT3V0cHV0Q29sb3JTcGFjZSI7ZnVuY3Rpb24gR3Iocil7bGV0IHQ9bnVsbDtyZXR1cm4gcj09PUVzP3Q9IkxpbmVhciI6cj09PSR0JiYodD0ic1JHQiIpLHR9ZnVuY3Rpb24gU2gocix0KXtyZXR1cm4gR3IocikrIlRvIitHcih0KX1jbGFzcyBYcyBleHRlbmRzIGR0e3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJDb2xvclNwYWNlTm9kZSJ9Y29uc3RydWN0b3IodCxlLHMpe3N1cGVyKCJ2ZWM0IiksdGhpcy5jb2xvck5vZGU9dCx0aGlzLnNvdXJjZT1lLHRoaXMudGFyZ2V0PXN9Z2V0Q29sb3JTcGFjZSh0LGUpe3JldHVybiBlPT09cnM/bXQud29ya2luZ0NvbG9yU3BhY2U6ZT09PWxpP3QuY29udGV4dC5vdXRwdXRDb2xvclNwYWNlfHx0LnJlbmRlcmVyLm91dHB1dENvbG9yU3BhY2U6ZX1zZXR1cCh0KXtjb25zdHtyZW5kZXJlcjplfT10LHtjb2xvck5vZGU6c309dGhpcyxuPXRoaXMuZ2V0Q29sb3JTcGFjZSh0LHRoaXMuc291cmNlKSxpPXRoaXMuZ2V0Q29sb3JTcGFjZSh0LHRoaXMudGFyZ2V0KTtpZihuPT09aSlyZXR1cm4gcztjb25zdCBvPVNoKG4saSk7bGV0IGE9bnVsbDtjb25zdCBjPWUubm9kZXMubGlicmFyeS5nZXRDb2xvclNwYWNlRnVuY3Rpb24obyk7cmV0dXJuIGMhPT1udWxsP2E9QmUoYyhzLnJnYikscy5hKTooY29uc29sZS5lcnJvcigiQ29sb3JTcGFjZU5vZGU6IFVuc3VwcG9ydGVkIENvbG9yIFNwYWNlIGNvbmZpZ3VyYXRpb24uIixvKSxhPXMpLGF9fWNvbnN0IF9oPXI9PnYobmV3IFhzKHYocikscnMsbGkpKSx6aD1yPT52KG5ldyBYcyh2KHIpLGxpLHJzKSksYmg9KHIsdCk9PnYobmV3IFhzKHYocikscnMsdCkpLFdyPShyLHQpPT52KG5ldyBYcyh2KHIpLHQscnMpKTtiKCJ0b091dHB1dENvbG9yU3BhY2UiLF9oKSxiKCJ0b1dvcmtpbmdDb2xvclNwYWNlIix6aCksYigid29ya2luZ1RvQ29sb3JTcGFjZSIsYmgpLGIoImNvbG9yU3BhY2VUb1dvcmtpbmciLFdyKTtsZXQgRWg9Y2xhc3MgZXh0ZW5kcyBpc3tzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iUmVmZXJlbmNlRWxlbWVudE5vZGUifWNvbnN0cnVjdG9yKHQsZSl7c3VwZXIodCxlKSx0aGlzLnJlZmVyZW5jZU5vZGU9dCx0aGlzLmlzUmVmZXJlbmNlRWxlbWVudE5vZGU9ITB9Z2V0Tm9kZVR5cGUoKXtyZXR1cm4gdGhpcy5yZWZlcmVuY2VOb2RlLnVuaWZvcm1UeXBlfWdlbmVyYXRlKHQpe2NvbnN0IGU9c3VwZXIuZ2VuZXJhdGUodCkscz10aGlzLnJlZmVyZW5jZU5vZGUuZ2V0Tm9kZVR5cGUoKSxuPXRoaXMuZ2V0Tm9kZVR5cGUoKTtyZXR1cm4gdC5mb3JtYXQoZSxzLG4pfX07Y2xhc3MgQ2ggZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJSZWZlcmVuY2VCYXNlTm9kZSJ9Y29uc3RydWN0b3IodCxlLHM9bnVsbCxuPW51bGwpe3N1cGVyKCksdGhpcy5wcm9wZXJ0eT10LHRoaXMudW5pZm9ybVR5cGU9ZSx0aGlzLm9iamVjdD1zLHRoaXMuY291bnQ9bix0aGlzLnByb3BlcnRpZXM9dC5zcGxpdCgiLiIpLHRoaXMucmVmZXJlbmNlPXMsdGhpcy5ub2RlPW51bGwsdGhpcy5ncm91cD1udWxsLHRoaXMudXBkYXRlVHlwZT1RLk9CSkVDVH1zZXRHcm91cCh0KXtyZXR1cm4gdGhpcy5ncm91cD10LHRoaXN9ZWxlbWVudCh0KXtyZXR1cm4gdihuZXcgRWgodGhpcyx2KHQpKSl9c2V0Tm9kZVR5cGUodCl7Y29uc3QgZT14dChudWxsLHQpLmdldFNlbGYoKTt0aGlzLmdyb3VwIT09bnVsbCYmZS5zZXRHcm91cCh0aGlzLmdyb3VwKSx0aGlzLm5vZGU9ZX1nZXROb2RlVHlwZSh0KXtyZXR1cm4gdGhpcy5ub2RlPT09bnVsbCYmKHRoaXMudXBkYXRlUmVmZXJlbmNlKHQpLHRoaXMudXBkYXRlVmFsdWUoKSksdGhpcy5ub2RlLmdldE5vZGVUeXBlKHQpfWdldFZhbHVlRnJvbVJlZmVyZW5jZSh0PXRoaXMucmVmZXJlbmNlKXtjb25zdHtwcm9wZXJ0aWVzOmV9PXRoaXM7bGV0IHM9dFtlWzBdXTtmb3IobGV0IG49MTtuPGUubGVuZ3RoO24rKylzPXNbZVtuXV07cmV0dXJuIHN9dXBkYXRlUmVmZXJlbmNlKHQpe3JldHVybiB0aGlzLnJlZmVyZW5jZT10aGlzLm9iamVjdCE9PW51bGw/dGhpcy5vYmplY3Q6dC5vYmplY3QsdGhpcy5yZWZlcmVuY2V9c2V0dXAoKXtyZXR1cm4gdGhpcy51cGRhdGVWYWx1ZSgpLHRoaXMubm9kZX11cGRhdGUoKXt0aGlzLnVwZGF0ZVZhbHVlKCl9dXBkYXRlVmFsdWUoKXt0aGlzLm5vZGU9PT1udWxsJiZ0aGlzLnNldE5vZGVUeXBlKHRoaXMudW5pZm9ybVR5cGUpO2NvbnN0IHQ9dGhpcy5nZXRWYWx1ZUZyb21SZWZlcmVuY2UoKTtBcnJheS5pc0FycmF5KHQpP3RoaXMubm9kZS5hcnJheT10OnRoaXMubm9kZS52YWx1ZT10fX1jbGFzcyBGaCBleHRlbmRzIENoe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJSZW5kZXJlclJlZmVyZW5jZU5vZGUifWNvbnN0cnVjdG9yKHQsZSxzPW51bGwpe3N1cGVyKHQsZSxzKSx0aGlzLnJlbmRlcmVyPXMsdGhpcy5zZXRHcm91cChkZSl9dXBkYXRlUmVmZXJlbmNlKHQpe3JldHVybiB0aGlzLnJlZmVyZW5jZT10aGlzLnJlbmRlcmVyIT09bnVsbD90aGlzLnJlbmRlcmVyOnQucmVuZGVyZXIsdGhpcy5yZWZlcmVuY2V9fWNvbnN0IFJoPShyLHQsZSk9PnYobmV3IEZoKHIsdCxlKSk7Y2xhc3MgQmggZXh0ZW5kcyBkdHtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iVG9uZU1hcHBpbmdOb2RlIn1jb25zdHJ1Y3Rvcih0LGU9dmgscz1udWxsKXtzdXBlcigidmVjMyIpLHRoaXMudG9uZU1hcHBpbmc9dCx0aGlzLmV4cG9zdXJlTm9kZT1lLHRoaXMuY29sb3JOb2RlPXN9Z2V0Q2FjaGVLZXkoKXtyZXR1cm4gTWEoc3VwZXIuZ2V0Q2FjaGVLZXkoKSx0aGlzLnRvbmVNYXBwaW5nKX1zZXR1cCh0KXtjb25zdCBlPXRoaXMuY29sb3JOb2RlfHx0LmNvbnRleHQuY29sb3Iscz10aGlzLnRvbmVNYXBwaW5nO2lmKHM9PT1NbilyZXR1cm4gZTtsZXQgbj1udWxsO2NvbnN0IGk9dC5yZW5kZXJlci5ub2Rlcy5saWJyYXJ5LmdldFRvbmVNYXBwaW5nRnVuY3Rpb24ocyk7cmV0dXJuIGkhPT1udWxsP249QmUoaShlLnJnYix0aGlzLmV4cG9zdXJlTm9kZSksZS5hKTooY29uc29sZS5lcnJvcigiVG9uZU1hcHBpbmdOb2RlOiBVbnN1cHBvcnRlZCBUb25lIE1hcHBpbmcgY29uZmlndXJhdGlvbi4iLHMpLG49ZSksbn19Y29uc3QgSWg9KHIsdCxlKT0+dihuZXcgQmgocix2KHQpLHYoZSkpKSx2aD1SaCgidG9uZU1hcHBpbmdFeHBvc3VyZSIsImZsb2F0Iik7YigidG9uZU1hcHBpbmciLChyLHQsZSk9PkloKHQsZSxyKSk7Y2xhc3MgUGggZXh0ZW5kcyBqbntzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iQnVmZmVyQXR0cmlidXRlTm9kZSJ9Y29uc3RydWN0b3IodCxlPW51bGwscz0wLG49MCl7c3VwZXIodCxlKSx0aGlzLmlzQnVmZmVyTm9kZT0hMCx0aGlzLmJ1ZmZlclR5cGU9ZSx0aGlzLmJ1ZmZlclN0cmlkZT1zLHRoaXMuYnVmZmVyT2Zmc2V0PW4sdGhpcy51c2FnZT1Dcyx0aGlzLmluc3RhbmNlZD0hMSx0aGlzLmF0dHJpYnV0ZT1udWxsLHRoaXMuZ2xvYmFsPSEwLHQmJnQuaXNCdWZmZXJBdHRyaWJ1dGU9PT0hMCYmKHRoaXMuYXR0cmlidXRlPXQsdGhpcy51c2FnZT10LnVzYWdlLHRoaXMuaW5zdGFuY2VkPXQuaXNJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGUpfWdldEhhc2godCl7aWYodGhpcy5idWZmZXJTdHJpZGU9PT0wJiZ0aGlzLmJ1ZmZlck9mZnNldD09PTApe2xldCBlPXQuZ2xvYmFsQ2FjaGUuZ2V0RGF0YSh0aGlzLnZhbHVlKTtyZXR1cm4gZT09PXZvaWQgMCYmKGU9e25vZGU6dGhpc30sdC5nbG9iYWxDYWNoZS5zZXREYXRhKHRoaXMudmFsdWUsZSkpLGUubm9kZS51dWlkfXJldHVybiB0aGlzLnV1aWR9Z2V0Tm9kZVR5cGUodCl7cmV0dXJuIHRoaXMuYnVmZmVyVHlwZT09PW51bGwmJih0aGlzLmJ1ZmZlclR5cGU9dC5nZXRUeXBlRnJvbUF0dHJpYnV0ZSh0aGlzLmF0dHJpYnV0ZSkpLHRoaXMuYnVmZmVyVHlwZX1zZXR1cCh0KXtpZih0aGlzLmF0dHJpYnV0ZSE9PW51bGwpcmV0dXJuO2NvbnN0IGU9dGhpcy5nZXROb2RlVHlwZSh0KSxzPXRoaXMudmFsdWUsbj10LmdldFR5cGVMZW5ndGgoZSksaT10aGlzLmJ1ZmZlclN0cmlkZXx8bixvPXRoaXMuYnVmZmVyT2Zmc2V0LGE9cy5pc0ludGVybGVhdmVkQnVmZmVyPT09ITA/czpuZXcgd2EocyxpKSxjPW5ldyBZbihhLG4sbyk7YS5zZXRVc2FnZSh0aGlzLnVzYWdlKSx0aGlzLmF0dHJpYnV0ZT1jLHRoaXMuYXR0cmlidXRlLmlzSW5zdGFuY2VkQnVmZmVyQXR0cmlidXRlPXRoaXMuaW5zdGFuY2VkfWdlbmVyYXRlKHQpe2NvbnN0IGU9dGhpcy5nZXROb2RlVHlwZSh0KSxzPXQuZ2V0QnVmZmVyQXR0cmlidXRlRnJvbU5vZGUodGhpcyxlKSxuPXQuZ2V0UHJvcGVydHlOYW1lKHMpO2xldCBpPW51bGw7cmV0dXJuIHQuc2hhZGVyU3RhZ2U9PT0idmVydGV4Inx8dC5zaGFkZXJTdGFnZT09PSJjb21wdXRlIj8odGhpcy5uYW1lPW4saT1uKTppPVBlKHRoaXMpLmJ1aWxkKHQsZSksaX1nZXRJbnB1dFR5cGUoKXtyZXR1cm4iYnVmZmVyQXR0cmlidXRlIn1zZXRVc2FnZSh0KXtyZXR1cm4gdGhpcy51c2FnZT10LHRoaXMuYXR0cmlidXRlJiZ0aGlzLmF0dHJpYnV0ZS5pc0J1ZmZlckF0dHJpYnV0ZT09PSEwJiYodGhpcy5hdHRyaWJ1dGUudXNhZ2U9dCksdGhpc31zZXRJbnN0YW5jZWQodCl7cmV0dXJuIHRoaXMuaW5zdGFuY2VkPXQsdGhpc319Y29uc3QgTGg9KHIsdCxlLHMpPT52KG5ldyBQaChyLHQsZSxzKSk7YigidG9BdHRyaWJ1dGUiLHI9PkxoKHIudmFsdWUpKTtjbGFzcyBPaCBleHRlbmRzIFV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIkNvbXB1dGVOb2RlIn1jb25zdHJ1Y3Rvcih0LGUscz1bNjRdKXtzdXBlcigidm9pZCIpLHRoaXMuaXNDb21wdXRlTm9kZT0hMCx0aGlzLmNvbXB1dGVOb2RlPXQsdGhpcy5jb3VudD1lLHRoaXMud29ya2dyb3VwU2l6ZT1zLHRoaXMuZGlzcGF0Y2hDb3VudD0wLHRoaXMudmVyc2lvbj0xLHRoaXMudXBkYXRlQmVmb3JlVHlwZT1RLk9CSkVDVCx0aGlzLnVwZGF0ZURpc3BhdGNoQ291bnQoKX1kaXNwb3NlKCl7dGhpcy5kaXNwYXRjaEV2ZW50KHt0eXBlOiJkaXNwb3NlIn0pfXNldCBuZWVkc1VwZGF0ZSh0KXt0PT09ITAmJnRoaXMudmVyc2lvbisrfXVwZGF0ZURpc3BhdGNoQ291bnQoKXtjb25zdHtjb3VudDp0LHdvcmtncm91cFNpemU6ZX09dGhpcztsZXQgcz1lWzBdO2ZvcihsZXQgbj0xO248ZS5sZW5ndGg7bisrKXMqPWVbbl07dGhpcy5kaXNwYXRjaENvdW50PU1hdGguY2VpbCh0L3MpfW9uSW5pdCgpe311cGRhdGVCZWZvcmUoe3JlbmRlcmVyOnR9KXt0LmNvbXB1dGUodGhpcyl9Z2VuZXJhdGUodCl7Y29uc3R7c2hhZGVyU3RhZ2U6ZX09dDtpZihlPT09ImNvbXB1dGUiKXtjb25zdCBzPXRoaXMuY29tcHV0ZU5vZGUuYnVpbGQodCwidm9pZCIpO3MhPT0iIiYmdC5hZGRMaW5lRmxvd0NvZGUocyx0aGlzKX19fWIoImNvbXB1dGUiLChyLHQsZSk9PnYobmV3IE9oKHYociksdCxlKSkpO2NsYXNzIERoIGV4dGVuZHMgVXtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iQ2FjaGVOb2RlIn1jb25zdHJ1Y3Rvcih0LGU9ITApe3N1cGVyKCksdGhpcy5ub2RlPXQsdGhpcy5wYXJlbnQ9ZSx0aGlzLmlzQ2FjaGVOb2RlPSEwfWdldE5vZGVUeXBlKHQpe3JldHVybiB0aGlzLm5vZGUuZ2V0Tm9kZVR5cGUodCl9YnVpbGQodCwuLi5lKXtjb25zdCBzPXQuZ2V0Q2FjaGUoKSxuPXQuZ2V0Q2FjaGVGcm9tTm9kZSh0aGlzLHRoaXMucGFyZW50KTt0LnNldENhY2hlKG4pO2NvbnN0IGk9dGhpcy5ub2RlLmJ1aWxkKHQsLi4uZSk7cmV0dXJuIHQuc2V0Q2FjaGUocyksaX19YigiY2FjaGUiLChyLC4uLnQpPT52KG5ldyBEaCh2KHIpLC4uLnQpKSk7Y2xhc3MgVmggZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJCeXBhc3NOb2RlIn1jb25zdHJ1Y3Rvcih0LGUpe3N1cGVyKCksdGhpcy5pc0J5cGFzc05vZGU9ITAsdGhpcy5vdXRwdXROb2RlPXQsdGhpcy5jYWxsTm9kZT1lfWdldE5vZGVUeXBlKHQpe3JldHVybiB0aGlzLm91dHB1dE5vZGUuZ2V0Tm9kZVR5cGUodCl9Z2VuZXJhdGUodCl7Y29uc3QgZT10aGlzLmNhbGxOb2RlLmJ1aWxkKHQsInZvaWQiKTtyZXR1cm4gZSE9PSIiJiZ0LmFkZExpbmVGbG93Q29kZShlLHRoaXMpLHRoaXMub3V0cHV0Tm9kZS5idWlsZCh0KX19YigiYnlwYXNzIixDKFZoKSk7Y2xhc3MgWHIgZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJSZW1hcE5vZGUifWNvbnN0cnVjdG9yKHQsZSxzLG49cSgwKSxpPXEoMSkpe3N1cGVyKCksdGhpcy5ub2RlPXQsdGhpcy5pbkxvd05vZGU9ZSx0aGlzLmluSGlnaE5vZGU9cyx0aGlzLm91dExvd05vZGU9bix0aGlzLm91dEhpZ2hOb2RlPWksdGhpcy5kb0NsYW1wPSEwfXNldHVwKCl7Y29uc3R7bm9kZTp0LGluTG93Tm9kZTplLGluSGlnaE5vZGU6cyxvdXRMb3dOb2RlOm4sb3V0SGlnaE5vZGU6aSxkb0NsYW1wOm99PXRoaXM7bGV0IGE9dC5zdWIoZSkuZGl2KHMuc3ViKGUpKTtyZXR1cm4gbz09PSEwJiYoYT1hLmNsYW1wKCkpLGEubXVsKGkuc3ViKG4pKS5hZGQobil9fWNvbnN0IFVoPUMoWHIsbnVsbCxudWxsLHtkb0NsYW1wOiExfSksa2g9QyhYcik7YigicmVtYXAiLFVoKSxiKCJyZW1hcENsYW1wIixraCk7Y2xhc3MgSGggZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJFeHByZXNzaW9uTm9kZSJ9Y29uc3RydWN0b3IodD0iIixlPSJ2b2lkIil7c3VwZXIoZSksdGhpcy5zbmlwcGV0PXR9Z2VuZXJhdGUodCxlKXtjb25zdCBzPXRoaXMuZ2V0Tm9kZVR5cGUodCksbj10aGlzLnNuaXBwZXQ7aWYocz09PSJ2b2lkIil0LmFkZExpbmVGbG93Q29kZShuLHRoaXMpO2Vsc2UgcmV0dXJuIHQuZm9ybWF0KGAoICR7bn0gKWAscyxlKX19Y29uc3QgWXM9QyhIaCk7YigiZGlzY2FyZCIscj0+KHI/dWkocixZcygiZGlzY2FyZCIpKTpZcygiZGlzY2FyZCIpKS5hcHBlbmQoKSk7Y2xhc3MgcWggZXh0ZW5kcyBkdHtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iUmVuZGVyT3V0cHV0Tm9kZSJ9Y29uc3RydWN0b3IodCxlLHMpe3N1cGVyKCJ2ZWM0IiksdGhpcy5jb2xvck5vZGU9dCx0aGlzLnRvbmVNYXBwaW5nPWUsdGhpcy5vdXRwdXRDb2xvclNwYWNlPXMsdGhpcy5pc1JlbmRlck91dHB1dD0hMH1zZXR1cCh7Y29udGV4dDp0fSl7bGV0IGU9dGhpcy5jb2xvck5vZGV8fHQuY29sb3I7Y29uc3Qgcz0odGhpcy50b25lTWFwcGluZyE9PW51bGw/dGhpcy50b25lTWFwcGluZzp0LnRvbmVNYXBwaW5nKXx8TW4sbj0odGhpcy5vdXRwdXRDb2xvclNwYWNlIT09bnVsbD90aGlzLm91dHB1dENvbG9yU3BhY2U6dC5vdXRwdXRDb2xvclNwYWNlKXx8YnM7cmV0dXJuIHMhPT1NbiYmKGU9ZS50b25lTWFwcGluZyhzKSksbiE9PWJzJiZuIT09bXQud29ya2luZ0NvbG9yU3BhY2UmJihlPWUud29ya2luZ1RvQ29sb3JTcGFjZShuKSksZX19YigicmVuZGVyT3V0cHV0Iiwocix0PW51bGwsZT1udWxsKT0+dihuZXcgcWgodihyKSx0LGUpKSk7Y2xhc3MgJGggZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJBdHRyaWJ1dGVOb2RlIn1jb25zdHJ1Y3Rvcih0LGU9bnVsbCl7c3VwZXIoZSksdGhpcy5nbG9iYWw9ITAsdGhpcy5fYXR0cmlidXRlTmFtZT10fWdldEhhc2godCl7cmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlTmFtZSh0KX1nZXROb2RlVHlwZSh0KXtsZXQgZT10aGlzLm5vZGVUeXBlO2lmKGU9PT1udWxsKXtjb25zdCBzPXRoaXMuZ2V0QXR0cmlidXRlTmFtZSh0KTtpZih0Lmhhc0dlb21ldHJ5QXR0cmlidXRlKHMpKXtjb25zdCBuPXQuZ2VvbWV0cnkuZ2V0QXR0cmlidXRlKHMpO2U9dC5nZXRUeXBlRnJvbUF0dHJpYnV0ZShuKX1lbHNlIGU9ImZsb2F0In1yZXR1cm4gZX1zZXRBdHRyaWJ1dGVOYW1lKHQpe3JldHVybiB0aGlzLl9hdHRyaWJ1dGVOYW1lPXQsdGhpc31nZXRBdHRyaWJ1dGVOYW1lKCl7cmV0dXJuIHRoaXMuX2F0dHJpYnV0ZU5hbWV9Z2VuZXJhdGUodCl7Y29uc3QgZT10aGlzLmdldEF0dHJpYnV0ZU5hbWUodCkscz10aGlzLmdldE5vZGVUeXBlKHQpO2lmKHQuaGFzR2VvbWV0cnlBdHRyaWJ1dGUoZSk9PT0hMCl7Y29uc3QgaT10Lmdlb21ldHJ5LmdldEF0dHJpYnV0ZShlKSxvPXQuZ2V0VHlwZUZyb21BdHRyaWJ1dGUoaSksYT10LmdldEF0dHJpYnV0ZShlLG8pO3JldHVybiB0LnNoYWRlclN0YWdlPT09InZlcnRleCI/dC5mb3JtYXQoYS5uYW1lLG8scyk6UGUodGhpcykuYnVpbGQodCxzKX1lbHNlIHJldHVybiBjb25zb2xlLndhcm4oYEF0dHJpYnV0ZU5vZGU6IFZlcnRleCBhdHRyaWJ1dGUgIiR7ZX0iIG5vdCBmb3VuZCBvbiBnZW9tZXRyeS5gKSx0LmdlbmVyYXRlQ29uc3Qocyl9c2VyaWFsaXplKHQpe3N1cGVyLnNlcmlhbGl6ZSh0KSx0Lmdsb2JhbD10aGlzLmdsb2JhbCx0Ll9hdHRyaWJ1dGVOYW1lPXRoaXMuX2F0dHJpYnV0ZU5hbWV9ZGVzZXJpYWxpemUodCl7c3VwZXIuZGVzZXJpYWxpemUodCksdGhpcy5nbG9iYWw9dC5nbG9iYWwsdGhpcy5fYXR0cmlidXRlTmFtZT10Ll9hdHRyaWJ1dGVOYW1lfX1jb25zdCBvcz0ocix0KT0+dihuZXcgJGgocix0KSksWnM9cj0+b3MoInV2Iisocj4wP3I6IiIpLCJ2ZWMyIik7Y2xhc3MgR2ggZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJUZXh0dXJlU2l6ZU5vZGUifWNvbnN0cnVjdG9yKHQsZT1udWxsKXtzdXBlcigidXZlYzIiKSx0aGlzLmlzVGV4dHVyZVNpemVOb2RlPSEwLHRoaXMudGV4dHVyZU5vZGU9dCx0aGlzLmxldmVsTm9kZT1lfWdlbmVyYXRlKHQsZSl7Y29uc3Qgcz10aGlzLnRleHR1cmVOb2RlLmJ1aWxkKHQsInByb3BlcnR5Iiksbj10aGlzLmxldmVsTm9kZT09PW51bGw/IjAiOnRoaXMubGV2ZWxOb2RlLmJ1aWxkKHQsImludCIpO3JldHVybiB0LmZvcm1hdChgJHt0LmdldE1ldGhvZCgidGV4dHVyZURpbWVuc2lvbnMiKX0oICR7c30sICR7bn0gKWAsdGhpcy5nZXROb2RlVHlwZSh0KSxlKX19Y29uc3QgWXI9QyhHaCk7Y2xhc3MgV2ggZXh0ZW5kcyBJZXtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iTWF4TWlwTGV2ZWxOb2RlIn1jb25zdHJ1Y3Rvcih0KXtzdXBlcigwKSx0aGlzLl90ZXh0dXJlTm9kZT10LHRoaXMudXBkYXRlVHlwZT1RLkZSQU1FfWdldCB0ZXh0dXJlTm9kZSgpe3JldHVybiB0aGlzLl90ZXh0dXJlTm9kZX1nZXQgdGV4dHVyZSgpe3JldHVybiB0aGlzLl90ZXh0dXJlTm9kZS52YWx1ZX11cGRhdGUoKXtjb25zdCB0PXRoaXMudGV4dHVyZSxlPXQuaW1hZ2VzLHM9ZSYmZS5sZW5ndGg+MD9lWzBdJiZlWzBdLmltYWdlfHxlWzBdOnQuaW1hZ2U7aWYocyYmcy53aWR0aCE9PXZvaWQgMCl7Y29uc3R7d2lkdGg6bixoZWlnaHQ6aX09czt0aGlzLnZhbHVlPU1hdGgubG9nMihNYXRoLm1heChuLGkpKX19fWNvbnN0IFhoPUMoV2gpO2NsYXNzIEpzIGV4dGVuZHMgSWV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIlRleHR1cmVOb2RlIn1jb25zdHJ1Y3Rvcih0LGU9bnVsbCxzPW51bGwsbj1udWxsKXtzdXBlcih0KSx0aGlzLmlzVGV4dHVyZU5vZGU9ITAsdGhpcy51dk5vZGU9ZSx0aGlzLmxldmVsTm9kZT1zLHRoaXMuYmlhc05vZGU9bix0aGlzLmNvbXBhcmVOb2RlPW51bGwsdGhpcy5kZXB0aE5vZGU9bnVsbCx0aGlzLmdyYWROb2RlPW51bGwsdGhpcy5zYW1wbGVyPSEwLHRoaXMudXBkYXRlTWF0cml4PSExLHRoaXMudXBkYXRlVHlwZT1RLk5PTkUsdGhpcy5yZWZlcmVuY2VOb2RlPW51bGwsdGhpcy5fdmFsdWU9dCx0aGlzLl9tYXRyaXhVbmlmb3JtPW51bGwsdGhpcy5zZXRVcGRhdGVNYXRyaXgoZT09PW51bGwpfXNldCB2YWx1ZSh0KXt0aGlzLnJlZmVyZW5jZU5vZGU/dGhpcy5yZWZlcmVuY2VOb2RlLnZhbHVlPXQ6dGhpcy5fdmFsdWU9dH1nZXQgdmFsdWUoKXtyZXR1cm4gdGhpcy5yZWZlcmVuY2VOb2RlP3RoaXMucmVmZXJlbmNlTm9kZS52YWx1ZTp0aGlzLl92YWx1ZX1nZXRVbmlmb3JtSGFzaCgpe3JldHVybiB0aGlzLnZhbHVlLnV1aWR9Z2V0Tm9kZVR5cGUoKXtyZXR1cm4gdGhpcy52YWx1ZS5pc0RlcHRoVGV4dHVyZT09PSEwPyJmbG9hdCI6dGhpcy52YWx1ZS50eXBlPT09V2k/InV2ZWM0Ijp0aGlzLnZhbHVlLnR5cGU9PT1Cbz8iaXZlYzQiOiJ2ZWM0In1nZXRJbnB1dFR5cGUoKXtyZXR1cm4idGV4dHVyZSJ9Z2V0RGVmYXVsdFVWKCl7cmV0dXJuIFpzKHRoaXMudmFsdWUuY2hhbm5lbCl9dXBkYXRlUmVmZXJlbmNlKCl7cmV0dXJuIHRoaXMudmFsdWV9Z2V0VHJhbnNmb3JtZWRVVih0KXtyZXR1cm4gdGhpcy5fbWF0cml4VW5pZm9ybT09PW51bGwmJih0aGlzLl9tYXRyaXhVbmlmb3JtPXh0KHRoaXMudmFsdWUubWF0cml4KSksdGhpcy5fbWF0cml4VW5pZm9ybS5tdWwoayh0LDEpKS54eX1zZXRVcGRhdGVNYXRyaXgodCl7cmV0dXJuIHRoaXMudXBkYXRlTWF0cml4PXQsdGhpcy51cGRhdGVUeXBlPXQ/US5GUkFNRTpRLk5PTkUsdGhpc31zZXR1cFVWKHQsZSl7Y29uc3Qgcz10aGlzLnZhbHVlO3JldHVybiB0LmlzRmxpcFkoKSYmKHMuaXNSZW5kZXJUYXJnZXRUZXh0dXJlPT09ITB8fHMuaXNGcmFtZWJ1ZmZlclRleHR1cmU9PT0hMHx8cy5pc0RlcHRoVGV4dHVyZT09PSEwKSYmKHRoaXMuc2FtcGxlcj9lPWUuZmxpcFkoKTplPWUuc2V0WShSZShZcih0aGlzLHRoaXMubGV2ZWxOb2RlKS55KS5zdWIoZS55KS5zdWIoMSkpKSxlfXNldHVwKHQpe2NvbnN0IGU9dC5nZXROb2RlUHJvcGVydGllcyh0aGlzKTtlLnJlZmVyZW5jZU5vZGU9dGhpcy5yZWZlcmVuY2VOb2RlO2xldCBzPXRoaXMudXZOb2RlOyhzPT09bnVsbHx8dC5jb250ZXh0LmZvcmNlVVZDb250ZXh0PT09ITApJiZ0LmNvbnRleHQuZ2V0VVYmJihzPXQuY29udGV4dC5nZXRVVih0aGlzKSksc3x8KHM9dGhpcy5nZXREZWZhdWx0VVYoKSksdGhpcy51cGRhdGVNYXRyaXg9PT0hMCYmKHM9dGhpcy5nZXRUcmFuc2Zvcm1lZFVWKHMpKSxzPXRoaXMuc2V0dXBVVih0LHMpO2xldCBuPXRoaXMubGV2ZWxOb2RlO249PT1udWxsJiZ0LmNvbnRleHQuZ2V0VGV4dHVyZUxldmVsJiYobj10LmNvbnRleHQuZ2V0VGV4dHVyZUxldmVsKHRoaXMpKSxlLnV2Tm9kZT1zLGUubGV2ZWxOb2RlPW4sZS5iaWFzTm9kZT10aGlzLmJpYXNOb2RlLGUuY29tcGFyZU5vZGU9dGhpcy5jb21wYXJlTm9kZSxlLmdyYWROb2RlPXRoaXMuZ3JhZE5vZGUsZS5kZXB0aE5vZGU9dGhpcy5kZXB0aE5vZGV9Z2VuZXJhdGVVVih0LGUpe3JldHVybiBlLmJ1aWxkKHQsdGhpcy5zYW1wbGVyPT09ITA/InZlYzIiOiJpdmVjMiIpfWdlbmVyYXRlU25pcHBldCh0LGUscyxuLGksbyxhLGMpe2NvbnN0IHU9dGhpcy52YWx1ZTtsZXQgaDtyZXR1cm4gbj9oPXQuZ2VuZXJhdGVUZXh0dXJlTGV2ZWwodSxlLHMsbixvKTppP2g9dC5nZW5lcmF0ZVRleHR1cmVCaWFzKHUsZSxzLGksbyk6Yz9oPXQuZ2VuZXJhdGVUZXh0dXJlR3JhZCh1LGUscyxjLG8pOmE/aD10LmdlbmVyYXRlVGV4dHVyZUNvbXBhcmUodSxlLHMsYSxvKTp0aGlzLnNhbXBsZXI9PT0hMT9oPXQuZ2VuZXJhdGVUZXh0dXJlTG9hZCh1LGUscyxvKTpoPXQuZ2VuZXJhdGVUZXh0dXJlKHUsZSxzLG8pLGh9Z2VuZXJhdGUodCxlKXtjb25zdCBzPXQuZ2V0Tm9kZVByb3BlcnRpZXModGhpcyksbj10aGlzLnZhbHVlO2lmKCFufHxuLmlzVGV4dHVyZSE9PSEwKXRocm93IG5ldyBFcnJvcigiVGV4dHVyZU5vZGU6IE5lZWQgYSB0aHJlZS5qcyB0ZXh0dXJlLiIpO2NvbnN0IGk9c3VwZXIuZ2VuZXJhdGUodCwicHJvcGVydHkiKTtpZihlPT09InNhbXBsZXIiKXJldHVybiBpKyJfc2FtcGxlciI7aWYodC5pc1JlZmVyZW5jZShlKSlyZXR1cm4gaTt7Y29uc3Qgbz10LmdldERhdGFGcm9tTm9kZSh0aGlzKTtsZXQgYT1vLnByb3BlcnR5TmFtZTtpZihhPT09dm9pZCAwKXtjb25zdHt1dk5vZGU6aCxsZXZlbE5vZGU6bCxiaWFzTm9kZTpkLGNvbXBhcmVOb2RlOmYsZGVwdGhOb2RlOnAsZ3JhZE5vZGU6bX09cyxnPXRoaXMuZ2VuZXJhdGVVVih0LGgpLHk9bD9sLmJ1aWxkKHQsImZsb2F0Iik6bnVsbCxUPWQ/ZC5idWlsZCh0LCJmbG9hdCIpOm51bGwsdz1wP3AuYnVpbGQodCwiaW50Iik6bnVsbCxNPWY/Zi5idWlsZCh0LCJmbG9hdCIpOm51bGwsTj1tP1ttWzBdLmJ1aWxkKHQsInZlYzIiKSxtWzFdLmJ1aWxkKHQsInZlYzIiKV06bnVsbCxfPXQuZ2V0VmFyRnJvbU5vZGUodGhpcyk7YT10LmdldFByb3BlcnR5TmFtZShfKTtjb25zdCBTPXRoaXMuZ2VuZXJhdGVTbmlwcGV0KHQsaSxnLHksVCx3LE0sTik7dC5hZGRMaW5lRmxvd0NvZGUoYCR7YX0gPSAke1N9YCx0aGlzKSxvLnNuaXBwZXQ9UyxvLnByb3BlcnR5TmFtZT1hfWxldCBjPWE7Y29uc3QgdT10aGlzLmdldE5vZGVUeXBlKHQpO3JldHVybiB0Lm5lZWRzVG9Xb3JraW5nQ29sb3JTcGFjZShuKSYmKGM9V3IoWXMoYyx1KSxuLmNvbG9yU3BhY2UpLnNldHVwKHQpLmJ1aWxkKHQsdSkpLHQuZm9ybWF0KGMsdSxlKX19c2V0U2FtcGxlcih0KXtyZXR1cm4gdGhpcy5zYW1wbGVyPXQsdGhpc31nZXRTYW1wbGVyKCl7cmV0dXJuIHRoaXMuc2FtcGxlcn11dih0KXtjb25zdCBlPXRoaXMuY2xvbmUoKTtyZXR1cm4gZS51dk5vZGU9dih0KSxlLnJlZmVyZW5jZU5vZGU9dGhpcy5nZXRTZWxmKCksdihlKX1ibHVyKHQpe2NvbnN0IGU9dGhpcy5jbG9uZSgpO3JldHVybiBlLmJpYXNOb2RlPXYodCkubXVsKFhoKGUpKSxlLnJlZmVyZW5jZU5vZGU9dGhpcy5nZXRTZWxmKCksdihlKX1sZXZlbCh0KXtjb25zdCBlPXRoaXMuY2xvbmUoKTtyZXR1cm4gZS5sZXZlbE5vZGU9dih0KSxlLnJlZmVyZW5jZU5vZGU9dGhpcy5nZXRTZWxmKCksdihlKX1zaXplKHQpe3JldHVybiBZcih0aGlzLHQpfWJpYXModCl7Y29uc3QgZT10aGlzLmNsb25lKCk7cmV0dXJuIGUuYmlhc05vZGU9dih0KSxlLnJlZmVyZW5jZU5vZGU9dGhpcy5nZXRTZWxmKCksdihlKX1jb21wYXJlKHQpe2NvbnN0IGU9dGhpcy5jbG9uZSgpO3JldHVybiBlLmNvbXBhcmVOb2RlPXYodCksZS5yZWZlcmVuY2VOb2RlPXRoaXMuZ2V0U2VsZigpLHYoZSl9Z3JhZCh0LGUpe2NvbnN0IHM9dGhpcy5jbG9uZSgpO3JldHVybiBzLmdyYWROb2RlPVt2KHQpLHYoZSldLHMucmVmZXJlbmNlTm9kZT10aGlzLmdldFNlbGYoKSx2KHMpfWRlcHRoKHQpe2NvbnN0IGU9dGhpcy5jbG9uZSgpO3JldHVybiBlLmRlcHRoTm9kZT12KHQpLGUucmVmZXJlbmNlTm9kZT10aGlzLmdldFNlbGYoKSx2KGUpfXNlcmlhbGl6ZSh0KXtzdXBlci5zZXJpYWxpemUodCksdC52YWx1ZT10aGlzLnZhbHVlLnRvSlNPTih0Lm1ldGEpLnV1aWQsdC5zYW1wbGVyPXRoaXMuc2FtcGxlcix0LnVwZGF0ZU1hdHJpeD10aGlzLnVwZGF0ZU1hdHJpeCx0LnVwZGF0ZVR5cGU9dGhpcy51cGRhdGVUeXBlfWRlc2VyaWFsaXplKHQpe3N1cGVyLmRlc2VyaWFsaXplKHQpLHRoaXMudmFsdWU9dC5tZXRhLnRleHR1cmVzW3QudmFsdWVdLHRoaXMuc2FtcGxlcj10LnNhbXBsZXIsdGhpcy51cGRhdGVNYXRyaXg9dC51cGRhdGVNYXRyaXgsdGhpcy51cGRhdGVUeXBlPXQudXBkYXRlVHlwZX11cGRhdGUoKXtjb25zdCB0PXRoaXMudmFsdWUsZT10aGlzLl9tYXRyaXhVbmlmb3JtO2UhPT1udWxsJiYoZS52YWx1ZT10Lm1hdHJpeCksdC5tYXRyaXhBdXRvVXBkYXRlPT09ITAmJnQudXBkYXRlTWF0cml4KCl9Y2xvbmUoKXtjb25zdCB0PW5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMudmFsdWUsdGhpcy51dk5vZGUsdGhpcy5sZXZlbE5vZGUsdGhpcy5iaWFzTm9kZSk7cmV0dXJuIHQuc2FtcGxlcj10aGlzLnNhbXBsZXIsdH19Y29uc3QgYXM9QyhKcyksY3M9eHQoImZsb2F0IikubGFiZWwoImNhbWVyYU5lYXIiKS5zZXRHcm91cChkZSkub25SZW5kZXJVcGRhdGUoKHtjYW1lcmE6cn0pPT5yLm5lYXIpLGhzPXh0KCJmbG9hdCIpLmxhYmVsKCJjYW1lcmFGYXIiKS5zZXRHcm91cChkZSkub25SZW5kZXJVcGRhdGUoKHtjYW1lcmE6cn0pPT5yLmZhciksanM9eHQoIm1hdDQiKS5sYWJlbCgiY2FtZXJhVmlld01hdHJpeCIpLnNldEdyb3VwKGRlKS5vblJlbmRlclVwZGF0ZSgoe2NhbWVyYTpyfSk9PnIubWF0cml4V29ybGRJbnZlcnNlKTtjbGFzcyBIIGV4dGVuZHMgVXtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iT2JqZWN0M0ROb2RlIn1jb25zdHJ1Y3Rvcih0LGU9bnVsbCl7c3VwZXIoKSx0aGlzLnNjb3BlPXQsdGhpcy5vYmplY3QzZD1lLHRoaXMudXBkYXRlVHlwZT1RLk9CSkVDVCx0aGlzLl91bmlmb3JtTm9kZT1uZXcgSWUobnVsbCl9Z2V0Tm9kZVR5cGUoKXtjb25zdCB0PXRoaXMuc2NvcGU7aWYodD09PUguV09STERfTUFUUklYKXJldHVybiJtYXQ0IjtpZih0PT09SC5QT1NJVElPTnx8dD09PUguVklFV19QT1NJVElPTnx8dD09PUguRElSRUNUSU9OfHx0PT09SC5TQ0FMRSlyZXR1cm4idmVjMyJ9dXBkYXRlKHQpe2NvbnN0IGU9dGhpcy5vYmplY3QzZCxzPXRoaXMuX3VuaWZvcm1Ob2RlLG49dGhpcy5zY29wZTtpZihuPT09SC5XT1JMRF9NQVRSSVgpcy52YWx1ZT1lLm1hdHJpeFdvcmxkO2Vsc2UgaWYobj09PUguUE9TSVRJT04pcy52YWx1ZT1zLnZhbHVlfHxuZXcgQSxzLnZhbHVlLnNldEZyb21NYXRyaXhQb3NpdGlvbihlLm1hdHJpeFdvcmxkKTtlbHNlIGlmKG49PT1ILlNDQUxFKXMudmFsdWU9cy52YWx1ZXx8bmV3IEEscy52YWx1ZS5zZXRGcm9tTWF0cml4U2NhbGUoZS5tYXRyaXhXb3JsZCk7ZWxzZSBpZihuPT09SC5ESVJFQ1RJT04pcy52YWx1ZT1zLnZhbHVlfHxuZXcgQSxlLmdldFdvcmxkRGlyZWN0aW9uKHMudmFsdWUpO2Vsc2UgaWYobj09PUguVklFV19QT1NJVElPTil7Y29uc3QgaT10LmNhbWVyYTtzLnZhbHVlPXMudmFsdWV8fG5ldyBBLHMudmFsdWUuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKGUubWF0cml4V29ybGQpLHMudmFsdWUuYXBwbHlNYXRyaXg0KGkubWF0cml4V29ybGRJbnZlcnNlKX19Z2VuZXJhdGUodCl7Y29uc3QgZT10aGlzLnNjb3BlO3JldHVybiBlPT09SC5XT1JMRF9NQVRSSVg/dGhpcy5fdW5pZm9ybU5vZGUubm9kZVR5cGU9Im1hdDQiOihlPT09SC5QT1NJVElPTnx8ZT09PUguVklFV19QT1NJVElPTnx8ZT09PUguRElSRUNUSU9OfHxlPT09SC5TQ0FMRSkmJih0aGlzLl91bmlmb3JtTm9kZS5ub2RlVHlwZT0idmVjMyIpLHRoaXMuX3VuaWZvcm1Ob2RlLmJ1aWxkKHQpfXNlcmlhbGl6ZSh0KXtzdXBlci5zZXJpYWxpemUodCksdC5zY29wZT10aGlzLnNjb3BlfWRlc2VyaWFsaXplKHQpe3N1cGVyLmRlc2VyaWFsaXplKHQpLHRoaXMuc2NvcGU9dC5zY29wZX19SC5XT1JMRF9NQVRSSVg9IndvcmxkTWF0cml4IixILlBPU0lUSU9OPSJwb3NpdGlvbiIsSC5TQ0FMRT0ic2NhbGUiLEguVklFV19QT1NJVElPTj0idmlld1Bvc2l0aW9uIixILkRJUkVDVElPTj0iZGlyZWN0aW9uIixILkRJUkVDVElPTixILldPUkxEX01BVFJJWCxILlBPU0lUSU9OLEguU0NBTEUsSC5WSUVXX1BPU0lUSU9OO2NsYXNzIFZ0IGV4dGVuZHMgSHtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iTW9kZWxOb2RlIn1jb25zdHJ1Y3Rvcih0KXtzdXBlcih0KX11cGRhdGUodCl7dGhpcy5vYmplY3QzZD10Lm9iamVjdCxzdXBlci51cGRhdGUodCl9fVZ0LkRJUkVDVElPTjtjb25zdCBZaD1PKFZ0LFZ0LldPUkxEX01BVFJJWCk7VnQuUE9TSVRJT04sVnQuU0NBTEUsVnQuVklFV19QT1NJVElPTjtjb25zdCBaaD14dChuZXcgQ3QpLm9uT2JqZWN0VXBkYXRlKCh7b2JqZWN0OnJ9LHQpPT50LnZhbHVlLmdldE5vcm1hbE1hdHJpeChyLm1hdHJpeFdvcmxkKSksWnI9anMubXVsKFloKS50b1ZhcigibW9kZWxWaWV3TWF0cml4XzIiKSxKaD1vcygicG9zaXRpb24iLCJ2ZWMzIikudmFyeWluZygicG9zaXRpb25Mb2NhbCIpLE10PVpyLm11bChKaCkueHl6LnZhcnlpbmcoInZfcG9zaXRpb25WaWV3IiksSnI9TXQubmVnYXRlKCkudmFyeWluZygidl9wb3NpdGlvblZpZXdEaXJlY3Rpb24iKS5ub3JtYWxpemUoKS50b1ZhcigicG9zaXRpb25WaWV3RGlyZWN0aW9uIik7Y2xhc3MgamggZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJGcm9udEZhY2luZ05vZGUifWNvbnN0cnVjdG9yKCl7c3VwZXIoImJvb2wiKSx0aGlzLmlzRnJvbnRGYWNpbmdOb2RlPSEwfWdlbmVyYXRlKHQpe2NvbnN0e3JlbmRlcmVyOmUsbWF0ZXJpYWw6c309dDtyZXR1cm4gZS5jb29yZGluYXRlU3lzdGVtPT09WWUmJnMuc2lkZT09PVVpPyJmYWxzZSI6dC5nZXRGcm9udEZhY2luZygpfX1jb25zdCBkaT1xKE8oamgpKS5tdWwoMikuc3ViKDEpLFFoPW9zKCJub3JtYWwiLCJ2ZWMzIiksS2g9dHQocj0+ci5nZW9tZXRyeS5oYXNBdHRyaWJ1dGUoIm5vcm1hbCIpPT09ITE/KGNvbnNvbGUud2FybignVFNMLk5vcm1hbE5vZGU6IFZlcnRleCBhdHRyaWJ1dGUgIm5vcm1hbCIgbm90IGZvdW5kIG9uIGdlb21ldHJ5LicpLGsoMCwxLDApKTpRaCwidmVjMyIpLm9uY2UoKSgpLnRvVmFyKCJub3JtYWxMb2NhbCIpLHR1PU10LmRGZHgoKS5jcm9zcyhNdC5kRmR5KCkpLm5vcm1hbGl6ZSgpLnRvVmFyKCJub3JtYWxGbGF0IiksTGU9dHQocj0+e2xldCB0O3JldHVybiByLm1hdGVyaWFsLmZsYXRTaGFkaW5nPT09ITA/dD10dTp0PVBlKFFyKEtoKSwidl9ub3JtYWxWaWV3Iikubm9ybWFsaXplKCksdH0sInZlYzMiKS5vbmNlKCkoKS50b1Zhcigibm9ybWFsVmlldyIpLGpyPXR0KHI9PnIuY29udGV4dC5zZXR1cE5vcm1hbCgpLCJ2ZWMzIikub25jZSgpKCkubXVsKGRpKS50b1ZhcigidHJhbnNmb3JtZWROb3JtYWxWaWV3IiksUXI9dHQoKFtyXSx0KT0+e2NvbnN0IGU9dC5yZW5kZXJlci5ub2Rlcy5tb2RlbE5vcm1hbFZpZXdNYXRyaXg7aWYoZSE9PW51bGwpcmV0dXJuIGUudHJhbnNmb3JtRGlyZWN0aW9uKHIpO2NvbnN0IHM9WmgubXVsKHIpO3JldHVybiBqcy50cmFuc2Zvcm1EaXJlY3Rpb24ocyl9KSxldT14dCgwKS5vblJlZmVyZW5jZSgoe21hdGVyaWFsOnJ9KT0+cikub25SZW5kZXJVcGRhdGUoKHttYXRlcmlhbDpyfSk9PnIucmVmcmFjdGlvblJhdGlvKSxzdT1Kci5uZWdhdGUoKS5yZWZsZWN0KGpyKSxudT1Kci5uZWdhdGUoKS5yZWZyYWN0KGpyLGV1KSxpdT1zdS50cmFuc2Zvcm1EaXJlY3Rpb24oanMpLnRvVmFyKCJyZWZsZWN0VmVjdG9yIikscnU9bnUudHJhbnNmb3JtRGlyZWN0aW9uKGpzKS50b1ZhcigicmVmbGVjdFZlY3RvciIpO2NsYXNzIG91IGV4dGVuZHMgSnN7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIkN1YmVUZXh0dXJlTm9kZSJ9Y29uc3RydWN0b3IodCxlPW51bGwscz1udWxsLG49bnVsbCl7c3VwZXIodCxlLHMsbiksdGhpcy5pc0N1YmVUZXh0dXJlTm9kZT0hMH1nZXRJbnB1dFR5cGUoKXtyZXR1cm4iY3ViZVRleHR1cmUifWdldERlZmF1bHRVVigpe2NvbnN0IHQ9dGhpcy52YWx1ZTtyZXR1cm4gdC5tYXBwaW5nPT09Q28/aXU6dC5tYXBwaW5nPT09Rm8/cnU6KGNvbnNvbGUuZXJyb3IoJ1RIUkVFLkN1YmVUZXh0dXJlTm9kZTogTWFwcGluZyAiJXMiIG5vdCBzdXBwb3J0ZWQuJyx0Lm1hcHBpbmcpLGsoMCwwLDApKX1zZXRVcGRhdGVNYXRyaXgoKXt9c2V0dXBVVih0LGUpe2NvbnN0IHM9dGhpcy52YWx1ZTtyZXR1cm4gdC5yZW5kZXJlci5jb29yZGluYXRlU3lzdGVtPT09em58fCFzLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZT9rKGUueC5uZWdhdGUoKSxlLnl6KTplfWdlbmVyYXRlVVYodCxlKXtyZXR1cm4gZS5idWlsZCh0LCJ2ZWMzIil9fWNvbnN0IGF1PUMob3UpO2NsYXNzIEtyIGV4dGVuZHMgSWV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIkJ1ZmZlck5vZGUifWNvbnN0cnVjdG9yKHQsZSxzPTApe3N1cGVyKHQsZSksdGhpcy5pc0J1ZmZlck5vZGU9ITAsdGhpcy5idWZmZXJUeXBlPWUsdGhpcy5idWZmZXJDb3VudD1zfWdldEVsZW1lbnRUeXBlKHQpe3JldHVybiB0aGlzLmdldE5vZGVUeXBlKHQpfWdldElucHV0VHlwZSgpe3JldHVybiJidWZmZXIifX1jb25zdCBjdT0ocix0LGUpPT52KG5ldyBLcihyLHQsZSkpO2NsYXNzIGh1IGV4dGVuZHMgaXN7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIlVuaWZvcm1BcnJheUVsZW1lbnROb2RlIn1jb25zdHJ1Y3Rvcih0LGUpe3N1cGVyKHQsZSksdGhpcy5pc0FycmF5QnVmZmVyRWxlbWVudE5vZGU9ITB9Z2VuZXJhdGUodCl7Y29uc3QgZT1zdXBlci5nZW5lcmF0ZSh0KSxzPXRoaXMuZ2V0Tm9kZVR5cGUoKTtyZXR1cm4gdC5mb3JtYXQoZSwidmVjNCIscyl9fWNsYXNzIHV1IGV4dGVuZHMgS3J7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIlVuaWZvcm1BcnJheU5vZGUifWNvbnN0cnVjdG9yKHQsZT1udWxsKXtzdXBlcihudWxsLCJ2ZWM0IiksdGhpcy5hcnJheT10LHRoaXMuZWxlbWVudFR5cGU9ZSx0aGlzLl9lbGVtZW50VHlwZT1udWxsLHRoaXMuX2VsZW1lbnRMZW5ndGg9MCx0aGlzLnVwZGF0ZVR5cGU9US5SRU5ERVIsdGhpcy5pc0FycmF5QnVmZmVyTm9kZT0hMH1nZXRFbGVtZW50VHlwZSgpe3JldHVybiB0aGlzLmVsZW1lbnRUeXBlfHx0aGlzLl9lbGVtZW50VHlwZX1nZXRFbGVtZW50TGVuZ3RoKCl7cmV0dXJuIHRoaXMuX2VsZW1lbnRMZW5ndGh9dXBkYXRlKCl7Y29uc3R7YXJyYXk6dCx2YWx1ZTplfT10aGlzLHM9dGhpcy5nZXRFbGVtZW50TGVuZ3RoKCksbj10aGlzLmdldEVsZW1lbnRUeXBlKCk7aWYocz09PTEpZm9yKGxldCBpPTA7aTx0Lmxlbmd0aDtpKyspe2NvbnN0IG89aSo0O2Vbb109dFtpXX1lbHNlIGlmKG49PT0iY29sb3IiKWZvcihsZXQgaT0wO2k8dC5sZW5ndGg7aSsrKXtjb25zdCBvPWkqNCxhPXRbaV07ZVtvXT1hLnIsZVtvKzFdPWEuZyxlW28rMl09YS5ifHwwfWVsc2UgZm9yKGxldCBpPTA7aTx0Lmxlbmd0aDtpKyspe2NvbnN0IG89aSo0LGE9dFtpXTtlW29dPWEueCxlW28rMV09YS55LGVbbysyXT1hLnp8fDAsZVtvKzNdPWEud3x8MH19c2V0dXAodCl7Y29uc3QgZT10aGlzLmFycmF5Lmxlbmd0aDt0aGlzLl9lbGVtZW50VHlwZT10aGlzLmVsZW1lbnRUeXBlPT09bnVsbD9Wcyh0aGlzLmFycmF5WzBdKTp0aGlzLmVsZW1lbnRUeXBlLHRoaXMuX2VsZW1lbnRMZW5ndGg9dC5nZXRUeXBlTGVuZ3RoKHRoaXMuX2VsZW1lbnRUeXBlKTtsZXQgcz1GbG9hdDMyQXJyYXk7cmV0dXJuIHRoaXMuX2VsZW1lbnRUeXBlLmNoYXJBdCgwKT09PSJpIj9zPUludDMyQXJyYXk6dGhpcy5fZWxlbWVudFR5cGUuY2hhckF0KDApPT09InUiJiYocz1VaW50MzJBcnJheSksdGhpcy52YWx1ZT1uZXcgcyhlKjQpLHRoaXMuYnVmZmVyQ291bnQ9ZSx0aGlzLmJ1ZmZlclR5cGU9dC5jaGFuZ2VDb21wb25lbnRUeXBlKCJ2ZWM0Iix0LmdldENvbXBvbmVudFR5cGUodGhpcy5fZWxlbWVudFR5cGUpKSxzdXBlci5zZXR1cCh0KX1lbGVtZW50KHQpe3JldHVybiB2KG5ldyBodSh0aGlzLHYodCkpKX19Y29uc3QgZmk9KHIsdCk9PnYobmV3IHV1KHIsdCkpO2NsYXNzIGx1IGV4dGVuZHMgaXN7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIlJlZmVyZW5jZUVsZW1lbnROb2RlIn1jb25zdHJ1Y3Rvcih0LGUpe3N1cGVyKHQsZSksdGhpcy5yZWZlcmVuY2VOb2RlPXQsdGhpcy5pc1JlZmVyZW5jZUVsZW1lbnROb2RlPSEwfWdldE5vZGVUeXBlKCl7cmV0dXJuIHRoaXMucmVmZXJlbmNlTm9kZS51bmlmb3JtVHlwZX1nZW5lcmF0ZSh0KXtjb25zdCBlPXN1cGVyLmdlbmVyYXRlKHQpLHM9dGhpcy5yZWZlcmVuY2VOb2RlLmdldE5vZGVUeXBlKCksbj10aGlzLmdldE5vZGVUeXBlKCk7cmV0dXJuIHQuZm9ybWF0KGUscyxuKX19Y2xhc3MgdG8gZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJSZWZlcmVuY2VOb2RlIn1jb25zdHJ1Y3Rvcih0LGUscz1udWxsLG49bnVsbCl7c3VwZXIoKSx0aGlzLnByb3BlcnR5PXQsdGhpcy51bmlmb3JtVHlwZT1lLHRoaXMub2JqZWN0PXMsdGhpcy5jb3VudD1uLHRoaXMucHJvcGVydGllcz10LnNwbGl0KCIuIiksdGhpcy5yZWZlcmVuY2U9cyx0aGlzLm5vZGU9bnVsbCx0aGlzLmdyb3VwPW51bGwsdGhpcy5uYW1lPW51bGwsdGhpcy51cGRhdGVUeXBlPVEuT0JKRUNUfWVsZW1lbnQodCl7cmV0dXJuIHYobmV3IGx1KHRoaXMsdih0KSkpfXNldEdyb3VwKHQpe3JldHVybiB0aGlzLmdyb3VwPXQsdGhpc31sYWJlbCh0KXtyZXR1cm4gdGhpcy5uYW1lPXQsdGhpc31zZXROb2RlVHlwZSh0KXtsZXQgZT1udWxsO3RoaXMuY291bnQhPT1udWxsP2U9Y3UobnVsbCx0LHRoaXMuY291bnQpOkFycmF5LmlzQXJyYXkodGhpcy5nZXRWYWx1ZUZyb21SZWZlcmVuY2UoKSk/ZT1maShudWxsLHQpOnQ9PT0idGV4dHVyZSI/ZT1hcyhudWxsKTp0PT09ImN1YmVUZXh0dXJlIj9lPWF1KG51bGwpOmU9eHQobnVsbCx0KSx0aGlzLmdyb3VwIT09bnVsbCYmZS5zZXRHcm91cCh0aGlzLmdyb3VwKSx0aGlzLm5hbWUhPT1udWxsJiZlLmxhYmVsKHRoaXMubmFtZSksdGhpcy5ub2RlPWUuZ2V0U2VsZigpfWdldE5vZGVUeXBlKHQpe3JldHVybiB0aGlzLm5vZGU9PT1udWxsJiYodGhpcy51cGRhdGVSZWZlcmVuY2UodCksdGhpcy51cGRhdGVWYWx1ZSgpKSx0aGlzLm5vZGUuZ2V0Tm9kZVR5cGUodCl9Z2V0VmFsdWVGcm9tUmVmZXJlbmNlKHQ9dGhpcy5yZWZlcmVuY2Upe2NvbnN0e3Byb3BlcnRpZXM6ZX09dGhpcztsZXQgcz10W2VbMF1dO2ZvcihsZXQgbj0xO248ZS5sZW5ndGg7bisrKXM9c1tlW25dXTtyZXR1cm4gc311cGRhdGVSZWZlcmVuY2UodCl7cmV0dXJuIHRoaXMucmVmZXJlbmNlPXRoaXMub2JqZWN0IT09bnVsbD90aGlzLm9iamVjdDp0Lm9iamVjdCx0aGlzLnJlZmVyZW5jZX1zZXR1cCgpe3JldHVybiB0aGlzLnVwZGF0ZVZhbHVlKCksdGhpcy5ub2RlfXVwZGF0ZSgpe3RoaXMudXBkYXRlVmFsdWUoKX11cGRhdGVWYWx1ZSgpe3RoaXMubm9kZT09PW51bGwmJnRoaXMuc2V0Tm9kZVR5cGUodGhpcy51bmlmb3JtVHlwZSk7Y29uc3QgdD10aGlzLmdldFZhbHVlRnJvbVJlZmVyZW5jZSgpO0FycmF5LmlzQXJyYXkodCk/dGhpcy5ub2RlLmFycmF5PXQ6dGhpcy5ub2RlLnZhbHVlPXR9fWNvbnN0IHBlPShyLHQsZSk9PnYobmV3IHRvKHIsdCxlKSk7Y2xhc3MgZHUgZXh0ZW5kcyB0b3tzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iTWF0ZXJpYWxSZWZlcmVuY2VOb2RlIn1jb25zdHJ1Y3Rvcih0LGUscz1udWxsKXtzdXBlcih0LGUscyksdGhpcy5tYXRlcmlhbD1zLHRoaXMuaXNNYXRlcmlhbFJlZmVyZW5jZU5vZGU9ITB9dXBkYXRlUmVmZXJlbmNlKHQpe3JldHVybiB0aGlzLnJlZmVyZW5jZT10aGlzLm1hdGVyaWFsIT09bnVsbD90aGlzLm1hdGVyaWFsOnQubWF0ZXJpYWwsdGhpcy5yZWZlcmVuY2V9fWNvbnN0IGZ1PShyLHQsZSk9PnYobmV3IGR1KHIsdCxlKSksZW89dHQocj0+KHIuZ2VvbWV0cnkuaGFzQXR0cmlidXRlKCJ0YW5nZW50Iik9PT0hMSYmci5nZW9tZXRyeS5jb21wdXRlVGFuZ2VudHMoKSxvcygidGFuZ2VudCIsInZlYzQiKSkpKCkscHU9ZW8ueHl6LnRvVmFyKCJ0YW5nZW50TG9jYWwiKSxzbz1aci5tdWwoQmUocHUsMCkpLnh5ei52YXJ5aW5nKCJ2X3RhbmdlbnRWaWV3Iikubm9ybWFsaXplKCkudG9WYXIoInRhbmdlbnRWaWV3IiksbXU9cXMoc28sUGUoKHI9PnIubXVsKGVvLncpLnh5eikoTGUuY3Jvc3Moc28pKSwidl9iaXRhbmdlbnRWaWV3Iikubm9ybWFsaXplKCkudG9WYXIoImJpdGFuZ2VudFZpZXciKSxMZSkseXU9dHQocj0+e2NvbnN0e2V5ZV9wb3M6dCxzdXJmX25vcm06ZSxtYXBOOnMsdXY6bn09cixpPXQuZEZkeCgpLG89dC5kRmR5KCksYT1uLmRGZHgoKSxjPW4uZEZkeSgpLHU9ZSxoPW8uY3Jvc3ModSksbD11LmNyb3NzKGkpLGQ9aC5tdWwoYS54KS5hZGQobC5tdWwoYy54KSksZj1oLm11bChhLnkpLmFkZChsLm11bChjLnkpKSxwPWQuZG90KGQpLm1heChmLmRvdChmKSksbT1kaS5tdWwocC5pbnZlcnNlU3FydCgpKTtyZXR1cm4gZmUoZC5tdWwocy54LG0pLGYubXVsKHMueSxtKSx1Lm11bChzLnopKS5ub3JtYWxpemUoKX0pO2NsYXNzIGd1IGV4dGVuZHMgZHR7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIk5vcm1hbE1hcE5vZGUifWNvbnN0cnVjdG9yKHQsZT1udWxsKXtzdXBlcigidmVjMyIpLHRoaXMubm9kZT10LHRoaXMuc2NhbGVOb2RlPWUsdGhpcy5ub3JtYWxNYXBUeXBlPVlpfXNldHVwKHQpe2NvbnN0e25vcm1hbE1hcFR5cGU6ZSxzY2FsZU5vZGU6c309dGhpcztsZXQgbj10aGlzLm5vZGUubXVsKDIpLnN1YigxKTtzIT09bnVsbCYmKG49ayhuLnh5Lm11bChzKSxuLnopKTtsZXQgaT1udWxsO3JldHVybiBlPT09T28/aT1RcihuKTplPT09WWkmJih0Lmhhc0dlb21ldHJ5QXR0cmlidXRlKCJ0YW5nZW50Iik9PT0hMD9pPW11Lm11bChuKS5ub3JtYWxpemUoKTppPXl1KHtleWVfcG9zOk10LHN1cmZfbm9ybTpMZSxtYXBOOm4sdXY6WnMoKX0pKSxpfX1jb25zdCBubz1DKGd1KSx4dT10dCgoe3RleHR1cmVOb2RlOnIsYnVtcFNjYWxlOnR9KT0+e2NvbnN0IGU9bj0+ci5jYWNoZSgpLmNvbnRleHQoe2dldFVWOmk9Pm4oaS51dk5vZGV8fFpzKCkpLGZvcmNlVVZDb250ZXh0OiEwfSkscz1xKGUobj0+bikpO3JldHVybiBEKHEoZShuPT5uLmFkZChuLmRGZHgoKSkpKS5zdWIocykscShlKG49Pm4uYWRkKG4uZEZkeSgpKSkpLnN1YihzKSkubXVsKHQpfSksVHU9dHQocj0+e2NvbnN0e3N1cmZfcG9zOnQsc3VyZl9ub3JtOmUsZEhkeHk6c309cixuPXQuZEZkeCgpLm5vcm1hbGl6ZSgpLGk9dC5kRmR5KCkubm9ybWFsaXplKCksbz1lLGE9aS5jcm9zcyhvKSxjPW8uY3Jvc3MobiksdT1uLmRvdChhKS5tdWwoZGkpLGg9dS5zaWduKCkubXVsKHMueC5tdWwoYSkuYWRkKHMueS5tdWwoYykpKTtyZXR1cm4gdS5hYnMoKS5tdWwoZSkuc3ViKGgpLm5vcm1hbGl6ZSgpfSk7Y2xhc3MgTnUgZXh0ZW5kcyBkdHtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iQnVtcE1hcE5vZGUifWNvbnN0cnVjdG9yKHQsZT1udWxsKXtzdXBlcigidmVjMyIpLHRoaXMudGV4dHVyZU5vZGU9dCx0aGlzLnNjYWxlTm9kZT1lfXNldHVwKCl7Y29uc3QgdD10aGlzLnNjYWxlTm9kZSE9PW51bGw/dGhpcy5zY2FsZU5vZGU6MSxlPXh1KHt0ZXh0dXJlTm9kZTp0aGlzLnRleHR1cmVOb2RlLGJ1bXBTY2FsZTp0fSk7cmV0dXJuIFR1KHtzdXJmX3BvczpNdCxzdXJmX25vcm06TGUsZEhkeHk6ZX0pfX1jb25zdCB3dT1DKE51KSxpbz1uZXcgTWFwO2NsYXNzIHogZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJNYXRlcmlhbE5vZGUifWNvbnN0cnVjdG9yKHQpe3N1cGVyKCksdGhpcy5zY29wZT10fWdldENhY2hlKHQsZSl7bGV0IHM9aW8uZ2V0KHQpO3JldHVybiBzPT09dm9pZCAwJiYocz1mdSh0LGUpLGlvLnNldCh0LHMpKSxzfWdldEZsb2F0KHQpe3JldHVybiB0aGlzLmdldENhY2hlKHQsImZsb2F0Iil9Z2V0Q29sb3IodCl7cmV0dXJuIHRoaXMuZ2V0Q2FjaGUodCwiY29sb3IiKX1nZXRUZXh0dXJlKHQpe3JldHVybiB0aGlzLmdldENhY2hlKHQ9PT0ibWFwIj8ibWFwIjp0KyJNYXAiLCJ0ZXh0dXJlIil9c2V0dXAodCl7Y29uc3QgZT10LmNvbnRleHQubWF0ZXJpYWwscz10aGlzLnNjb3BlO2xldCBuPW51bGw7aWYocz09PXouQ09MT1Ipe2NvbnN0IGk9ZS5jb2xvciE9PXZvaWQgMD90aGlzLmdldENvbG9yKHMpOmsoKTtlLm1hcCYmZS5tYXAuaXNUZXh0dXJlPT09ITA/bj1pLm11bCh0aGlzLmdldFRleHR1cmUoIm1hcCIpKTpuPWl9ZWxzZSBpZihzPT09ei5PUEFDSVRZKXtjb25zdCBpPXRoaXMuZ2V0RmxvYXQocyk7ZS5hbHBoYU1hcCYmZS5hbHBoYU1hcC5pc1RleHR1cmU9PT0hMD9uPWkubXVsKHRoaXMuZ2V0VGV4dHVyZSgiYWxwaGEiKSk6bj1pfWVsc2UgaWYocz09PXouU1BFQ1VMQVJfU1RSRU5HVEgpZS5zcGVjdWxhck1hcCYmZS5zcGVjdWxhck1hcC5pc1RleHR1cmU9PT0hMD9uPXRoaXMuZ2V0VGV4dHVyZSgic3BlY3VsYXIiKS5yOm49cSgxKTtlbHNlIGlmKHM9PT16LlNQRUNVTEFSX0lOVEVOU0lUWSl7Y29uc3QgaT10aGlzLmdldEZsb2F0KHMpO2Uuc3BlY3VsYXJNYXA/bj1pLm11bCh0aGlzLmdldFRleHR1cmUocykuYSk6bj1pfWVsc2UgaWYocz09PXouU1BFQ1VMQVJfQ09MT1Ipe2NvbnN0IGk9dGhpcy5nZXRDb2xvcihzKTtlLnNwZWN1bGFyQ29sb3JNYXAmJmUuc3BlY3VsYXJDb2xvck1hcC5pc1RleHR1cmU9PT0hMD9uPWkubXVsKHRoaXMuZ2V0VGV4dHVyZShzKS5yZ2IpOm49aX1lbHNlIGlmKHM9PT16LlJPVUdITkVTUyl7Y29uc3QgaT10aGlzLmdldEZsb2F0KHMpO2Uucm91Z2huZXNzTWFwJiZlLnJvdWdobmVzc01hcC5pc1RleHR1cmU9PT0hMD9uPWkubXVsKHRoaXMuZ2V0VGV4dHVyZShzKS5nKTpuPWl9ZWxzZSBpZihzPT09ei5NRVRBTE5FU1Mpe2NvbnN0IGk9dGhpcy5nZXRGbG9hdChzKTtlLm1ldGFsbmVzc01hcCYmZS5tZXRhbG5lc3NNYXAuaXNUZXh0dXJlPT09ITA/bj1pLm11bCh0aGlzLmdldFRleHR1cmUocykuYik6bj1pfWVsc2UgaWYocz09PXouRU1JU1NJVkUpe2NvbnN0IGk9dGhpcy5nZXRGbG9hdCgiZW1pc3NpdmVJbnRlbnNpdHkiKSxvPXRoaXMuZ2V0Q29sb3IocykubXVsKGkpO2UuZW1pc3NpdmVNYXAmJmUuZW1pc3NpdmVNYXAuaXNUZXh0dXJlPT09ITA/bj1vLm11bCh0aGlzLmdldFRleHR1cmUocykpOm49b31lbHNlIGlmKHM9PT16Lk5PUk1BTCllLm5vcm1hbE1hcD8obj1ubyh0aGlzLmdldFRleHR1cmUoIm5vcm1hbCIpLHRoaXMuZ2V0Q2FjaGUoIm5vcm1hbFNjYWxlIiwidmVjMiIpKSxuLm5vcm1hbE1hcFR5cGU9ZS5ub3JtYWxNYXBUeXBlKTplLmJ1bXBNYXA/bj13dSh0aGlzLmdldFRleHR1cmUoImJ1bXAiKS5yLHRoaXMuZ2V0RmxvYXQoImJ1bXBTY2FsZSIpKTpuPUxlO2Vsc2UgaWYocz09PXouQ0xFQVJDT0FUKXtjb25zdCBpPXRoaXMuZ2V0RmxvYXQocyk7ZS5jbGVhcmNvYXRNYXAmJmUuY2xlYXJjb2F0TWFwLmlzVGV4dHVyZT09PSEwP249aS5tdWwodGhpcy5nZXRUZXh0dXJlKHMpLnIpOm49aX1lbHNlIGlmKHM9PT16LkNMRUFSQ09BVF9ST1VHSE5FU1Mpe2NvbnN0IGk9dGhpcy5nZXRGbG9hdChzKTtlLmNsZWFyY29hdFJvdWdobmVzc01hcCYmZS5jbGVhcmNvYXRSb3VnaG5lc3NNYXAuaXNUZXh0dXJlPT09ITA/bj1pLm11bCh0aGlzLmdldFRleHR1cmUocykucik6bj1pfWVsc2UgaWYocz09PXouQ0xFQVJDT0FUX05PUk1BTCllLmNsZWFyY29hdE5vcm1hbE1hcD9uPW5vKHRoaXMuZ2V0VGV4dHVyZShzKSx0aGlzLmdldENhY2hlKHMrIlNjYWxlIiwidmVjMiIpKTpuPUxlO2Vsc2UgaWYocz09PXouU0hFRU4pe2NvbnN0IGk9dGhpcy5nZXRDb2xvcigic2hlZW5Db2xvciIpLm11bCh0aGlzLmdldEZsb2F0KCJzaGVlbiIpKTtlLnNoZWVuQ29sb3JNYXAmJmUuc2hlZW5Db2xvck1hcC5pc1RleHR1cmU9PT0hMD9uPWkubXVsKHRoaXMuZ2V0VGV4dHVyZSgic2hlZW5Db2xvciIpLnJnYik6bj1pfWVsc2UgaWYocz09PXouU0hFRU5fUk9VR0hORVNTKXtjb25zdCBpPXRoaXMuZ2V0RmxvYXQocyk7ZS5zaGVlblJvdWdobmVzc01hcCYmZS5zaGVlblJvdWdobmVzc01hcC5pc1RleHR1cmU9PT0hMD9uPWkubXVsKHRoaXMuZ2V0VGV4dHVyZShzKS5hKTpuPWksbj1uLmNsYW1wKC4wNywxKX1lbHNlIGlmKHM9PT16LkFOSVNPVFJPUFkpaWYoZS5hbmlzb3Ryb3B5TWFwJiZlLmFuaXNvdHJvcHlNYXAuaXNUZXh0dXJlPT09ITApe2NvbnN0IGk9dGhpcy5nZXRUZXh0dXJlKHMpO249UnIodXMueCx1cy55LHVzLnkubmVnYXRlKCksdXMueCkubXVsKGkucmcubXVsKDIpLnN1YihEKDEpKS5ub3JtYWxpemUoKS5tdWwoaS5iKSl9ZWxzZSBuPXVzO2Vsc2UgaWYocz09PXouSVJJREVTQ0VOQ0VfVEhJQ0tORVNTKXtjb25zdCBpPXBlKCIxIiwiZmxvYXQiLGUuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZSk7aWYoZS5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcCl7Y29uc3Qgbz1wZSgiMCIsImZsb2F0IixlLmlyaWRlc2NlbmNlVGhpY2tuZXNzUmFuZ2UpO249aS5zdWIobykubXVsKHRoaXMuZ2V0VGV4dHVyZShzKS5nKS5hZGQobyl9ZWxzZSBuPWl9ZWxzZSBpZihzPT09ei5UUkFOU01JU1NJT04pe2NvbnN0IGk9dGhpcy5nZXRGbG9hdChzKTtlLnRyYW5zbWlzc2lvbk1hcD9uPWkubXVsKHRoaXMuZ2V0VGV4dHVyZShzKS5yKTpuPWl9ZWxzZSBpZihzPT09ei5USElDS05FU1Mpe2NvbnN0IGk9dGhpcy5nZXRGbG9hdChzKTtlLnRoaWNrbmVzc01hcD9uPWkubXVsKHRoaXMuZ2V0VGV4dHVyZShzKS5nKTpuPWl9ZWxzZSBpZihzPT09ei5JT1Ipbj10aGlzLmdldEZsb2F0KHMpO2Vsc2UgaWYocz09PXouTElHSFRfTUFQKW49dGhpcy5nZXRUZXh0dXJlKHMpLnJnYi5tdWwodGhpcy5nZXRGbG9hdCgibGlnaHRNYXBJbnRlbnNpdHkiKSk7ZWxzZSBpZihzPT09ei5BT19NQVApbj10aGlzLmdldFRleHR1cmUocykuci5zdWIoMSkubXVsKHRoaXMuZ2V0RmxvYXQoImFvTWFwSW50ZW5zaXR5IikpLmFkZCgxKTtlbHNle2NvbnN0IGk9dGhpcy5nZXROb2RlVHlwZSh0KTtuPXRoaXMuZ2V0Q2FjaGUocyxpKX1yZXR1cm4gbn19ei5BTFBIQV9URVNUPSJhbHBoYVRlc3QiLHouQ09MT1I9ImNvbG9yIix6Lk9QQUNJVFk9Im9wYWNpdHkiLHouU0hJTklORVNTPSJzaGluaW5lc3MiLHouU1BFQ1VMQVI9InNwZWN1bGFyIix6LlNQRUNVTEFSX1NUUkVOR1RIPSJzcGVjdWxhclN0cmVuZ3RoIix6LlNQRUNVTEFSX0lOVEVOU0lUWT0ic3BlY3VsYXJJbnRlbnNpdHkiLHouU1BFQ1VMQVJfQ09MT1I9InNwZWN1bGFyQ29sb3IiLHouUkVGTEVDVElWSVRZPSJyZWZsZWN0aXZpdHkiLHouUk9VR0hORVNTPSJyb3VnaG5lc3MiLHouTUVUQUxORVNTPSJtZXRhbG5lc3MiLHouTk9STUFMPSJub3JtYWwiLHouQ0xFQVJDT0FUPSJjbGVhcmNvYXQiLHouQ0xFQVJDT0FUX1JPVUdITkVTUz0iY2xlYXJjb2F0Um91Z2huZXNzIix6LkNMRUFSQ09BVF9OT1JNQUw9ImNsZWFyY29hdE5vcm1hbCIsei5FTUlTU0lWRT0iZW1pc3NpdmUiLHouUk9UQVRJT049InJvdGF0aW9uIix6LlNIRUVOPSJzaGVlbiIsei5TSEVFTl9ST1VHSE5FU1M9InNoZWVuUm91Z2huZXNzIix6LkFOSVNPVFJPUFk9ImFuaXNvdHJvcHkiLHouSVJJREVTQ0VOQ0U9ImlyaWRlc2NlbmNlIix6LklSSURFU0NFTkNFX0lPUj0iaXJpZGVzY2VuY2VJT1IiLHouSVJJREVTQ0VOQ0VfVEhJQ0tORVNTPSJpcmlkZXNjZW5jZVRoaWNrbmVzcyIsei5JT1I9ImlvciIsei5UUkFOU01JU1NJT049InRyYW5zbWlzc2lvbiIsei5USElDS05FU1M9InRoaWNrbmVzcyIsei5BVFRFTlVBVElPTl9ESVNUQU5DRT0iYXR0ZW51YXRpb25EaXN0YW5jZSIsei5BVFRFTlVBVElPTl9DT0xPUj0iYXR0ZW51YXRpb25Db2xvciIsei5MSU5FX1NDQUxFPSJzY2FsZSIsei5MSU5FX0RBU0hfU0laRT0iZGFzaFNpemUiLHouTElORV9HQVBfU0laRT0iZ2FwU2l6ZSIsei5MSU5FX1dJRFRIPSJsaW5ld2lkdGgiLHouTElORV9EQVNIX09GRlNFVD0iZGFzaE9mZnNldCIsei5QT0lOVF9XSURUSD0icG9pbnRXaWR0aCIsei5ESVNQRVJTSU9OPSJkaXNwZXJzaW9uIix6LkxJR0hUX01BUD0ibGlnaHQiLHouQU9fTUFQPSJhbyIsei5BTFBIQV9URVNULHouQ09MT1Isei5TSElOSU5FU1Msei5FTUlTU0lWRSx6Lk9QQUNJVFksei5TUEVDVUxBUix6LlNQRUNVTEFSX0lOVEVOU0lUWSx6LlNQRUNVTEFSX0NPTE9SLHouU1BFQ1VMQVJfU1RSRU5HVEgsei5SRUZMRUNUSVZJVFksei5ST1VHSE5FU1Msei5NRVRBTE5FU1Msei5DTEVBUkNPQVQsei5DTEVBUkNPQVRfUk9VR0hORVNTLHouUk9UQVRJT04sei5TSEVFTix6LlNIRUVOX1JPVUdITkVTUyx6LkFOSVNPVFJPUFksei5JUklERVNDRU5DRSx6LklSSURFU0NFTkNFX0lPUix6LklSSURFU0NFTkNFX1RISUNLTkVTUyx6LlRSQU5TTUlTU0lPTix6LlRISUNLTkVTUyx6LklPUix6LkFUVEVOVUFUSU9OX0RJU1RBTkNFLHouQVRURU5VQVRJT05fQ09MT1Isei5MSU5FX1NDQUxFLHouTElORV9EQVNIX1NJWkUsei5MSU5FX0dBUF9TSVpFLHouTElORV9XSURUSCx6LkxJTkVfREFTSF9PRkZTRVQsei5QT0lOVF9XSURUSCx6LkRJU1BFUlNJT04sei5MSUdIVF9NQVAsei5BT19NQVA7Y29uc3QgdXM9eHQobmV3IEopLm9uUmVmZXJlbmNlKGZ1bmN0aW9uKHIpe3JldHVybiByLm1hdGVyaWFsfSkub25SZW5kZXJVcGRhdGUoZnVuY3Rpb24oe21hdGVyaWFsOnJ9KXt0aGlzLnZhbHVlLnNldChyLmFuaXNvdHJvcHkqTWF0aC5jb3Moci5hbmlzb3Ryb3B5Um90YXRpb24pLHIuYW5pc290cm9weSpNYXRoLnNpbihyLmFuaXNvdHJvcHlSb3RhdGlvbikpfSk7Y2xhc3MgVyBleHRlbmRzIFV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIkluZGV4Tm9kZSJ9Y29uc3RydWN0b3IodCl7c3VwZXIoInVpbnQiKSx0aGlzLnNjb3BlPXQsdGhpcy5pc0luc3RhbmNlSW5kZXhOb2RlPSEwfWdlbmVyYXRlKHQpe2NvbnN0IGU9dGhpcy5nZXROb2RlVHlwZSh0KSxzPXRoaXMuc2NvcGU7bGV0IG47aWYocz09PVcuVkVSVEVYKW49dC5nZXRWZXJ0ZXhJbmRleCgpO2Vsc2UgaWYocz09PVcuSU5TVEFOQ0Upbj10LmdldEluc3RhbmNlSW5kZXgoKTtlbHNlIGlmKHM9PT1XLkRSQVcpbj10LmdldERyYXdJbmRleCgpO2Vsc2UgaWYocz09PVcuSU5WT0NBVElPTl9MT0NBTCluPXQuZ2V0SW52b2NhdGlvbkxvY2FsSW5kZXgoKTtlbHNlIGlmKHM9PT1XLklOVk9DQVRJT05fU1VCR1JPVVApbj10LmdldEludm9jYXRpb25TdWJncm91cEluZGV4KCk7ZWxzZSBpZihzPT09Vy5TVUJHUk9VUCluPXQuZ2V0U3ViZ3JvdXBJbmRleCgpO2Vsc2UgdGhyb3cgbmV3IEVycm9yKCJUSFJFRS5JbmRleE5vZGU6IFVua25vd24gc2NvcGU6ICIrcyk7bGV0IGk7cmV0dXJuIHQuc2hhZGVyU3RhZ2U9PT0idmVydGV4Inx8dC5zaGFkZXJTdGFnZT09PSJjb21wdXRlIj9pPW46aT1QZSh0aGlzKS5idWlsZCh0LGUpLGl9fVcuVkVSVEVYPSJ2ZXJ0ZXgiLFcuSU5TVEFOQ0U9Imluc3RhbmNlIixXLlNVQkdST1VQPSJzdWJncm91cCIsVy5JTlZPQ0FUSU9OX0xPQ0FMPSJpbnZvY2F0aW9uTG9jYWwiLFcuSU5WT0NBVElPTl9TVUJHUk9VUD0iaW52b2NhdGlvblN1Ymdyb3VwIixXLkRSQVc9ImRyYXciLFcuVkVSVEVYLFcuSU5TVEFOQ0UsVy5TVUJHUk9VUCxXLklOVk9DQVRJT05fU1VCR1JPVVAsVy5JTlZPQ0FUSU9OX0xPQ0FMLFcuRFJBVztjbGFzcyBBdSBleHRlbmRzIFV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIkxvb3BOb2RlIn1jb25zdHJ1Y3Rvcih0PVtdKXtzdXBlcigpLHRoaXMucGFyYW1zPXR9Z2V0VmFyTmFtZSh0KXtyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSgiaSIuY2hhckNvZGVBdCgpK3QpfWdldFByb3BlcnRpZXModCl7Y29uc3QgZT10LmdldE5vZGVQcm9wZXJ0aWVzKHRoaXMpO2lmKGUuc3RhY2tOb2RlIT09dm9pZCAwKXJldHVybiBlO2NvbnN0IHM9e307Zm9yKGxldCBpPTAsbz10aGlzLnBhcmFtcy5sZW5ndGgtMTtpPG87aSsrKXtjb25zdCBhPXRoaXMucGFyYW1zW2ldLGM9YS5pc05vZGUhPT0hMCYmYS5uYW1lfHx0aGlzLmdldFZhck5hbWUoaSksdT1hLmlzTm9kZSE9PSEwJiZhLnR5cGV8fCJpbnQiO3NbY109WXMoYyx1KX1jb25zdCBuPXQuYWRkU3RhY2soKTtyZXR1cm4gZS5yZXR1cm5zTm9kZT10aGlzLnBhcmFtc1t0aGlzLnBhcmFtcy5sZW5ndGgtMV0ocyxuLHQpLGUuc3RhY2tOb2RlPW4sdC5yZW1vdmVTdGFjaygpLGV9Z2V0Tm9kZVR5cGUodCl7Y29uc3R7cmV0dXJuc05vZGU6ZX09dGhpcy5nZXRQcm9wZXJ0aWVzKHQpO3JldHVybiBlP2UuZ2V0Tm9kZVR5cGUodCk6InZvaWQifXNldHVwKHQpe3RoaXMuZ2V0UHJvcGVydGllcyh0KX1nZW5lcmF0ZSh0KXtjb25zdCBlPXRoaXMuZ2V0UHJvcGVydGllcyh0KSxzPXRoaXMucGFyYW1zLG49ZS5zdGFja05vZGU7Zm9yKGxldCBhPTAsYz1zLmxlbmd0aC0xO2E8YzthKyspe2NvbnN0IHU9c1thXTtsZXQgaD1udWxsLGw9bnVsbCxkPW51bGwsZj1udWxsLHA9bnVsbCxtPW51bGw7dS5pc05vZGU/KGY9ImludCIsZD10aGlzLmdldFZhck5hbWUoYSksaD0iMCIsbD11LmJ1aWxkKHQsZikscD0iPCIpOihmPXUudHlwZXx8ImludCIsZD11Lm5hbWV8fHRoaXMuZ2V0VmFyTmFtZShhKSxoPXUuc3RhcnQsbD11LmVuZCxwPXUuY29uZGl0aW9uLG09dS51cGRhdGUsdHlwZW9mIGg9PSJudW1iZXIiP2g9aC50b1N0cmluZygpOmgmJmguaXNOb2RlJiYoaD1oLmJ1aWxkKHQsZikpLHR5cGVvZiBsPT0ibnVtYmVyIj9sPWwudG9TdHJpbmcoKTpsJiZsLmlzTm9kZSYmKGw9bC5idWlsZCh0LGYpKSxoIT09dm9pZCAwJiZsPT09dm9pZCAwPyhoPWgrIiAtIDEiLGw9IjAiLHA9Ij49Iik6bCE9PXZvaWQgMCYmaD09PXZvaWQgMCYmKGg9IjAiLHA9IjwiKSxwPT09dm9pZCAwJiYoTnVtYmVyKGgpPk51bWJlcihsKT9wPSI+PSI6cD0iPCIpKTtjb25zdCBnPXtzdGFydDpoLGVuZDpsLGNvbmRpdGlvbjpwfSx5PWcuc3RhcnQsVD1nLmVuZDtsZXQgdz0iIixNPSIiLE49IiI7bXx8KGY9PT0iaW50Inx8Zj09PSJ1aW50Ij9wLmluY2x1ZGVzKCI8Iik/bT0iKysiOm09Ii0tIjpwLmluY2x1ZGVzKCI8Iik/bT0iKz0gMS4iOm09Ii09IDEuIiksdys9dC5nZXRWYXIoZixkKSsiID0gIit5LE0rPWQrIiAiK3ArIiAiK1QsTis9ZCsiICIrbTtjb25zdCBfPWBmb3IgKCAke3d9OyAke019OyAke059IClgO3QuYWRkRmxvd0NvZGUoKGE9PT0wP2AKYDoiIikrdC50YWIrXytgIHsKCmApLmFkZEZsb3dUYWIoKX1jb25zdCBpPW4uYnVpbGQodCwidm9pZCIpLG89ZS5yZXR1cm5zTm9kZT9lLnJldHVybnNOb2RlLmJ1aWxkKHQpOiIiO3QucmVtb3ZlRmxvd1RhYigpLmFkZEZsb3dDb2RlKGAKYCt0LnRhYitpKTtmb3IobGV0IGE9MCxjPXRoaXMucGFyYW1zLmxlbmd0aC0xO2E8YzthKyspdC5hZGRGbG93Q29kZSgoYT09PTA/IiI6dC50YWIpK2B9CgpgKS5yZW1vdmVGbG93VGFiKCk7cmV0dXJuIHQuYWRkRmxvd1RhYigpLG99fWNvbnN0IE9lPSguLi5yKT0+dihuZXcgQXUoRmUociwiaW50IikpKS5hcHBlbmQoKTtsZXQgbHMsZHM7Y2xhc3MgZXQgZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJTY3JlZW5Ob2RlIn1jb25zdHJ1Y3Rvcih0KXtzdXBlcigpLHRoaXMuc2NvcGU9dCx0aGlzLmlzVmlld3BvcnROb2RlPSEwfWdldE5vZGVUeXBlKCl7cmV0dXJuIHRoaXMuc2NvcGU9PT1ldC5WSUVXUE9SVD8idmVjNCI6InZlYzIifWdldFVwZGF0ZVR5cGUoKXtsZXQgdD1RLk5PTkU7cmV0dXJuKHRoaXMuc2NvcGU9PT1ldC5TSVpFfHx0aGlzLnNjb3BlPT09ZXQuVklFV1BPUlQpJiYodD1RLlJFTkRFUiksdGhpcy51cGRhdGVUeXBlPXQsdH11cGRhdGUoe3JlbmRlcmVyOnR9KXtjb25zdCBlPXQuZ2V0UmVuZGVyVGFyZ2V0KCk7dGhpcy5zY29wZT09PWV0LlZJRVdQT1JUP2UhPT1udWxsP2RzLmNvcHkoZS52aWV3cG9ydCk6KHQuZ2V0Vmlld3BvcnQoZHMpLGRzLm11bHRpcGx5U2NhbGFyKHQuZ2V0UGl4ZWxSYXRpbygpKSk6ZSE9PW51bGw/KGxzLndpZHRoPWUud2lkdGgsbHMuaGVpZ2h0PWUuaGVpZ2h0KTp0LmdldERyYXdpbmdCdWZmZXJTaXplKGxzKX1zZXR1cCgpe2NvbnN0IHQ9dGhpcy5zY29wZTtsZXQgZT1udWxsO3JldHVybiB0PT09ZXQuU0laRT9lPXh0KGxzfHwobHM9bmV3IEopKTp0PT09ZXQuVklFV1BPUlQ/ZT14dChkc3x8KGRzPW5ldyBGdCkpOmU9RChRcy5kaXYocm8pKSxlfWdlbmVyYXRlKHQpe2lmKHRoaXMuc2NvcGU9PT1ldC5DT09SRElOQVRFKXtsZXQgZT10LmdldEZyYWdDb29yZCgpO2lmKHQuaXNGbGlwWSgpKXtjb25zdCBzPXQuZ2V0Tm9kZVByb3BlcnRpZXMocm8pLm91dHB1dE5vZGUuYnVpbGQodCk7ZT1gJHt0LmdldFR5cGUoInZlYzIiKX0oICR7ZX0ueCwgJHtzfS55IC0gJHtlfS55IClgfXJldHVybiBlfXJldHVybiBzdXBlci5nZW5lcmF0ZSh0KX19ZXQuQ09PUkRJTkFURT0iY29vcmRpbmF0ZSIsZXQuVklFV1BPUlQ9InZpZXdwb3J0IixldC5TSVpFPSJzaXplIixldC5VVj0idXYiO2NvbnN0IHBpPU8oZXQsZXQuVVYpLHJvPU8oZXQsZXQuU0laRSksUXM9TyhldCxldC5DT09SRElOQVRFKSxvbz1PKGV0LGV0LlZJRVdQT1JUKTtvby56dyxvby54eTtjb25zdCBmcz1uZXcgSjtjbGFzcyBNdSBleHRlbmRzIEpze3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJWaWV3cG9ydFRleHR1cmVOb2RlIn1jb25zdHJ1Y3Rvcih0PXBpLGU9bnVsbCxzPW51bGwpe3M9PT1udWxsJiYocz1uZXcgQWEscy5taW5GaWx0ZXI9R2kpLHN1cGVyKHMsdCxlKSx0aGlzLmdlbmVyYXRlTWlwbWFwcz0hMSx0aGlzLmlzT3V0cHV0VGV4dHVyZU5vZGU9ITAsdGhpcy51cGRhdGVCZWZvcmVUeXBlPVEuRlJBTUV9dXBkYXRlQmVmb3JlKHQpe2NvbnN0IGU9dC5yZW5kZXJlcjtlLmdldERyYXdpbmdCdWZmZXJTaXplKGZzKTtjb25zdCBzPXRoaXMudmFsdWU7KHMuaW1hZ2Uud2lkdGghPT1mcy53aWR0aHx8cy5pbWFnZS5oZWlnaHQhPT1mcy5oZWlnaHQpJiYocy5pbWFnZS53aWR0aD1mcy53aWR0aCxzLmltYWdlLmhlaWdodD1mcy5oZWlnaHQscy5uZWVkc1VwZGF0ZT0hMCk7Y29uc3Qgbj1zLmdlbmVyYXRlTWlwbWFwcztzLmdlbmVyYXRlTWlwbWFwcz10aGlzLmdlbmVyYXRlTWlwbWFwcyxlLmNvcHlGcmFtZWJ1ZmZlclRvVGV4dHVyZShzKSxzLmdlbmVyYXRlTWlwbWFwcz1ufWNsb25lKCl7Y29uc3QgdD1uZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLnV2Tm9kZSx0aGlzLmxldmVsTm9kZSx0aGlzLnZhbHVlKTtyZXR1cm4gdC5nZW5lcmF0ZU1pcG1hcHM9dGhpcy5nZW5lcmF0ZU1pcG1hcHMsdH19bGV0IG1pPW51bGw7Y2xhc3MgU3UgZXh0ZW5kcyBNdXtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iVmlld3BvcnREZXB0aFRleHR1cmVOb2RlIn1jb25zdHJ1Y3Rvcih0PXBpLGU9bnVsbCl7bWk9PT1udWxsJiYobWk9bmV3IHhyKSxzdXBlcih0LGUsbWkpfX1jb25zdCBfdT1DKFN1KTtjbGFzcyBmdCBleHRlbmRzIFV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIlZpZXdwb3J0RGVwdGhOb2RlIn1jb25zdHJ1Y3Rvcih0LGU9bnVsbCl7c3VwZXIoImZsb2F0IiksdGhpcy5zY29wZT10LHRoaXMudmFsdWVOb2RlPWUsdGhpcy5pc1ZpZXdwb3J0RGVwdGhOb2RlPSEwfWdlbmVyYXRlKHQpe2NvbnN0e3Njb3BlOmV9PXRoaXM7cmV0dXJuIGU9PT1mdC5ERVBUSF9CQVNFP3QuZ2V0RnJhZ0RlcHRoKCk6c3VwZXIuZ2VuZXJhdGUodCl9c2V0dXAoe2NhbWVyYTp0fSl7Y29uc3R7c2NvcGU6ZX09dGhpcyxzPXRoaXMudmFsdWVOb2RlO2xldCBuPW51bGw7aWYoZT09PWZ0LkRFUFRIX0JBU0UpcyE9PW51bGwmJihuPWNvKCkuYXNzaWduKHMpKTtlbHNlIGlmKGU9PT1mdC5ERVBUSCl0LmlzUGVyc3BlY3RpdmVDYW1lcmE/bj16dShNdC56LGNzLGhzKTpuPUtzKE10LnosY3MsaHMpO2Vsc2UgaWYoZT09PWZ0LkxJTkVBUl9ERVBUSClpZihzIT09bnVsbClpZih0LmlzUGVyc3BlY3RpdmVDYW1lcmEpe2NvbnN0IGk9YW8ocyxjcyxocyk7bj1LcyhpLGNzLGhzKX1lbHNlIG49cztlbHNlIG49S3MoTXQueixjcyxocyk7cmV0dXJuIG59fWZ0LkRFUFRIX0JBU0U9ImRlcHRoQmFzZSIsZnQuREVQVEg9ImRlcHRoIixmdC5MSU5FQVJfREVQVEg9ImxpbmVhckRlcHRoIjtjb25zdCBLcz0ocix0LGUpPT5yLmFkZCh0KS5kaXYodC5zdWIoZSkpLHp1PShyLHQsZSk9PnQuYWRkKHIpLm11bChlKS5kaXYoZS5zdWIodCkubXVsKHIpKSxhbz0ocix0LGUpPT50Lm11bChlKS5kaXYoZS5zdWIodCkubXVsKHIpLnN1YihlKSksY289QyhmdCxmdC5ERVBUSF9CQVNFKSxidT1PKGZ0LGZ0LkRFUFRIKSxFdT1DKGZ0LGZ0LkxJTkVBUl9ERVBUSCk7X3UoKSxidS5hc3NpZ249cj0+Y28ocik7Y2xhc3MgcHMgZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJDbGlwcGluZ05vZGUifWNvbnN0cnVjdG9yKHQ9cHMuREVGQVVMVCl7c3VwZXIoKSx0aGlzLnNjb3BlPXR9c2V0dXAodCl7c3VwZXIuc2V0dXAodCk7Y29uc3QgZT10LmNsaXBwaW5nQ29udGV4dCx7bG9jYWxDbGlwSW50ZXJzZWN0aW9uOnMsbG9jYWxDbGlwcGluZ0NvdW50Om4sZ2xvYmFsQ2xpcHBpbmdDb3VudDppfT1lLG89aStuLGE9cz9vLW46bztyZXR1cm4gdGhpcy5zY29wZT09PXBzLkFMUEhBX1RPX0NPVkVSQUdFP3RoaXMuc2V0dXBBbHBoYVRvQ292ZXJhZ2UoZS5wbGFuZXMsbyxhKTp0aGlzLnNldHVwRGVmYXVsdChlLnBsYW5lcyxvLGEpfXNldHVwQWxwaGFUb0NvdmVyYWdlKHQsZSxzKXtyZXR1cm4gdHQoKCk9Pntjb25zdCBuPWZpKHQpLGk9dmUoImZsb2F0IiwiZGlzdGFuY2VUb1BsYW5lIiksbz12ZSgiZmxvYXQiLCJkaXN0YW5jZVRvR3JhZGllbnQiKSxhPXZlKCJmbG9hdCIsImNsaXBPcGFjaXR5Iik7YS5hc3NpZ24oMSk7bGV0IGM7aWYoT2Uocywoe2k6dX0pPT57Yz1uLmVsZW1lbnQodSksaS5hc3NpZ24oTXQuZG90KGMueHl6KS5uZWdhdGUoKS5hZGQoYy53KSksby5hc3NpZ24oaS5md2lkdGgoKS5kaXYoMikpLGEubXVsQXNzaWduKGhpKG8ubmVnYXRlKCksbyxpKSksYS5lcXVhbCgwKS5kaXNjYXJkKCl9KSxzPGUpe2NvbnN0IHU9dmUoImZsb2F0IiwidW5pb25jbGlwT3BhY2l0eSIpO3UuYXNzaWduKDEpLE9lKHtzdGFydDpzLGVuZDplfSwoe2k6aH0pPT57Yz1uLmVsZW1lbnQoaCksaS5hc3NpZ24oTXQuZG90KGMueHl6KS5uZWdhdGUoKS5hZGQoYy53KSksby5hc3NpZ24oaS5md2lkdGgoKS5kaXYoMikpLHUubXVsQXNzaWduKGhpKG8ubmVnYXRlKCksbyxpKS5vbmVNaW51cygpKX0pLGEubXVsQXNzaWduKHUub25lTWludXMoKSl9dnIuYS5tdWxBc3NpZ24oYSksdnIuYS5lcXVhbCgwKS5kaXNjYXJkKCl9KSgpfXNldHVwRGVmYXVsdCh0LGUscyl7cmV0dXJuIHR0KCgpPT57Y29uc3Qgbj1maSh0KTtsZXQgaTtpZihPZShzLCh7aTpvfSk9PntpPW4uZWxlbWVudChvKSxNdC5kb3QoaS54eXopLmdyZWF0ZXJUaGFuKGkudykuZGlzY2FyZCgpfSksczxlKXtjb25zdCBvPXZlKCJib29sIiwiY2xpcHBlZCIpO28uYXNzaWduKCEwKSxPZSh7c3RhcnQ6cyxlbmQ6ZX0sKHtpOmF9KT0+e2k9bi5lbGVtZW50KGEpLG8uYXNzaWduKE10LmRvdChpLnh5eikuZ3JlYXRlclRoYW4oaS53KS5hbmQobykpfSksby5kaXNjYXJkKCl9fSkoKX19cHMuQUxQSEFfVE9fQ09WRVJBR0U9ImFscGhhVG9Db3ZlcmFnZSIscHMuREVGQVVMVD0iZGVmYXVsdCIsayguMDQpLHEoMSk7Y29uc3QgQ3U9dHQoKFtyLHRdKT0+e2NvbnN0IGU9ci50b1ZhcigpO2UuYXNzaWduKEdzKDIsZSkuc3ViKDEpKTtjb25zdCBzPWsoZSwxKS50b1ZhcigpO3JldHVybiBuaSh0LmVxdWFsKDApLCgpPT57cy5hc3NpZ24ocy56eXgpfSkuRWxzZUlmKHQuZXF1YWwoMSksKCk9PntzLmFzc2lnbihzLnh6eSkscy54ei5tdWxBc3NpZ24oLTEpfSkuRWxzZUlmKHQuZXF1YWwoMiksKCk9PntzLngubXVsQXNzaWduKC0xKX0pLkVsc2VJZih0LmVxdWFsKDMpLCgpPT57cy5hc3NpZ24ocy56eXgpLHMueHoubXVsQXNzaWduKC0xKX0pLkVsc2VJZih0LmVxdWFsKDQpLCgpPT57cy5hc3NpZ24ocy54enkpLHMueHkubXVsQXNzaWduKC0xKX0pLkVsc2VJZih0LmVxdWFsKDUpLCgpPT57cy56Lm11bEFzc2lnbigtMSl9KSxzfSkuc2V0TGF5b3V0KHtuYW1lOiJnZXREaXJlY3Rpb24iLHR5cGU6InZlYzMiLGlucHV0czpbe25hbWU6InV2Iix0eXBlOiJ2ZWMyIn0se25hbWU6ImZhY2UiLHR5cGU6ImZsb2F0In1dfSk7dHQoKHt0ZXh0dXJlOnIsdXY6dH0pPT57Y29uc3Qgcz1rKCkudG9WYXIoKTtyZXR1cm4gbmkodC54Lmxlc3NUaGFuKDFlLTQpLCgpPT57cy5hc3NpZ24oaygxLDAsMCkpfSkuRWxzZUlmKHQueS5sZXNzVGhhbigxZS00KSwoKT0+e3MuYXNzaWduKGsoMCwxLDApKX0pLkVsc2VJZih0LnoubGVzc1RoYW4oMWUtNCksKCk9PntzLmFzc2lnbihrKDAsMCwxKSl9KS5FbHNlSWYodC54LmdyZWF0ZXJUaGFuKDEtMWUtNCksKCk9PntzLmFzc2lnbihrKC0xLDAsMCkpfSkuRWxzZUlmKHQueS5ncmVhdGVyVGhhbigxLTFlLTQpLCgpPT57cy5hc3NpZ24oaygwLC0xLDApKX0pLkVsc2VJZih0LnouZ3JlYXRlclRoYW4oMS0xZS00KSwoKT0+e3MuYXNzaWduKGsoMCwwLC0xKSl9KS5FbHNlKCgpPT57Y29uc3QgaT1yLnV2KHQuYWRkKGsoLS4wMSwwLDApKSkuci5zdWIoci51dih0LmFkZChrKC4wMSwwLDApKSkuciksbz1yLnV2KHQuYWRkKGsoMCwtLjAxLDApKSkuci5zdWIoci51dih0LmFkZChrKDAsLjAxLDApKSkuciksYT1yLnV2KHQuYWRkKGsoMCwwLC0uMDEpKSkuci5zdWIoci51dih0LmFkZChrKDAsMCwuMDEpKSkucik7cy5hc3NpZ24oayhpLG8sYSkpfSkscy5ub3JtYWxpemUoKX0pO2NvbnN0IHlpPUN1KFpzKCksb3MoImZhY2VJbmRleCIpKS5ub3JtYWxpemUoKTtrKHlpLngseWkueS5uZWdhdGUoKSx5aS56KTtjbGFzcyBQdCBleHRlbmRzIElle3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJUaW1lck5vZGUifWNvbnN0cnVjdG9yKHQ9UHQuTE9DQUwsZT0xLHM9MCl7c3VwZXIocyksdGhpcy5zY29wZT10LHRoaXMuc2NhbGU9ZSx0aGlzLnVwZGF0ZVR5cGU9US5GUkFNRX11cGRhdGUodCl7Y29uc3QgZT10aGlzLnNjb3BlLHM9dGhpcy5zY2FsZTtlPT09UHQuTE9DQUw/dGhpcy52YWx1ZSs9dC5kZWx0YVRpbWUqczplPT09UHQuREVMVEE/dGhpcy52YWx1ZT10LmRlbHRhVGltZSpzOmU9PT1QdC5GUkFNRT90aGlzLnZhbHVlPXQuZnJhbWVJZDp0aGlzLnZhbHVlPXQudGltZSpzfXNlcmlhbGl6ZSh0KXtzdXBlci5zZXJpYWxpemUodCksdC5zY29wZT10aGlzLnNjb3BlLHQuc2NhbGU9dGhpcy5zY2FsZX1kZXNlcmlhbGl6ZSh0KXtzdXBlci5kZXNlcmlhbGl6ZSh0KSx0aGlzLnNjb3BlPXQuc2NvcGUsdGhpcy5zY2FsZT10LnNjYWxlfX1QdC5MT0NBTD0ibG9jYWwiLFB0LkdMT0JBTD0iZ2xvYmFsIixQdC5ERUxUQT0iZGVsdGEiLFB0LkZSQU1FPSJmcmFtZSI7Y29uc3QgRnU9KHIsdD0wKT0+dihuZXcgUHQoUHQuTE9DQUwscix0KSk7Y2xhc3MgcnQgZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJPc2NOb2RlIn1jb25zdHJ1Y3Rvcih0PXJ0LlNJTkUsZT1GdSgpKXtzdXBlcigpLHRoaXMubWV0aG9kPXQsdGhpcy50aW1lTm9kZT1lfWdldE5vZGVUeXBlKHQpe3JldHVybiB0aGlzLnRpbWVOb2RlLmdldE5vZGVUeXBlKHQpfXNldHVwKCl7Y29uc3QgdD10aGlzLm1ldGhvZCxlPXYodGhpcy50aW1lTm9kZSk7bGV0IHM9bnVsbDtyZXR1cm4gdD09PXJ0LlNJTkU/cz1lLmFkZCguNzUpLm11bChNYXRoLlBJKjIpLnNpbigpLm11bCguNSkuYWRkKC41KTp0PT09cnQuU1FVQVJFP3M9ZS5mcmFjdCgpLnJvdW5kKCk6dD09PXJ0LlRSSUFOR0xFP3M9ZS5hZGQoLjUpLmZyYWN0KCkubXVsKDIpLnN1YigxKS5hYnMoKTp0PT09cnQuU0FXVE9PVEgmJihzPWUuZnJhY3QoKSksc31zZXJpYWxpemUodCl7c3VwZXIuc2VyaWFsaXplKHQpLHQubWV0aG9kPXRoaXMubWV0aG9kfWRlc2VyaWFsaXplKHQpe3N1cGVyLmRlc2VyaWFsaXplKHQpLHRoaXMubWV0aG9kPXQubWV0aG9kfX1ydC5TSU5FPSJzaW5lIixydC5TUVVBUkU9InNxdWFyZSIscnQuVFJJQU5HTEU9InRyaWFuZ2xlIixydC5TQVdUT09USD0ic2F3dG9vdGgiLHJ0LlNJTkUscnQuU1FVQVJFLHJ0LlRSSUFOR0xFLHJ0LlNBV1RPT1RILG5ldyBYbixuZXcgQSxuZXcgQSxuZXcgQSxuZXcgbnQsbmV3IEEoMCwwLC0xKSxuZXcgRnQsbmV3IEEsbmV3IEEsbmV3IEZ0LG5ldyBKLG5ldyBvcixwaS5mbGlwWCgpO2NsYXNzIFV0IGV4dGVuZHMgVXtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iU2NlbmVOb2RlIn1jb25zdHJ1Y3Rvcih0PVV0LkJBQ0tHUk9VTkRfQkxVUlJJTkVTUyxlPW51bGwpe3N1cGVyKCksdGhpcy5zY29wZT10LHRoaXMuc2NlbmU9ZX1zZXR1cCh0KXtjb25zdCBlPXRoaXMuc2NvcGUscz10aGlzLnNjZW5lIT09bnVsbD90aGlzLnNjZW5lOnQuc2NlbmU7bGV0IG47cmV0dXJuIGU9PT1VdC5CQUNLR1JPVU5EX0JMVVJSSU5FU1M/bj1wZSgiYmFja2dyb3VuZEJsdXJyaW5lc3MiLCJmbG9hdCIscyk6ZT09PVV0LkJBQ0tHUk9VTkRfSU5URU5TSVRZP249cGUoImJhY2tncm91bmRJbnRlbnNpdHkiLCJmbG9hdCIscyk6Y29uc29sZS5lcnJvcigiVEhSRUUuU2NlbmVOb2RlOiBVbmtub3duIHNjb3BlOiIsZSksbn19VXQuQkFDS0dST1VORF9CTFVSUklORVNTPSJiYWNrZ3JvdW5kQmx1cnJpbmVzcyIsVXQuQkFDS0dST1VORF9JTlRFTlNJVFk9ImJhY2tncm91bmRJbnRlbnNpdHkiLFV0LkJBQ0tHUk9VTkRfQkxVUlJJTkVTUyxVdC5CQUNLR1JPVU5EX0lOVEVOU0lUWTtjb25zdCBSdT1uZXcgSjtjbGFzcyBCdSBleHRlbmRzIEpze3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJQYXNzVGV4dHVyZU5vZGUifWNvbnN0cnVjdG9yKHQsZSl7c3VwZXIoZSksdGhpcy5wYXNzTm9kZT10LHRoaXMuc2V0VXBkYXRlTWF0cml4KCExKX1zZXR1cCh0KXtyZXR1cm4gdC5vYmplY3QuaXNRdWFkTWVzaCYmdGhpcy5wYXNzTm9kZS5idWlsZCh0KSxzdXBlci5zZXR1cCh0KX1jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLnBhc3NOb2RlLHRoaXMudmFsdWUpfX1jbGFzcyBobyBleHRlbmRzIEJ1e3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJQYXNzTXVsdGlwbGVUZXh0dXJlTm9kZSJ9Y29uc3RydWN0b3IodCxlLHM9ITEpe3N1cGVyKHQsbnVsbCksdGhpcy50ZXh0dXJlTmFtZT1lLHRoaXMucHJldmlvdXNUZXh0dXJlPXN9dXBkYXRlVGV4dHVyZSgpe3RoaXMudmFsdWU9dGhpcy5wcmV2aW91c1RleHR1cmU/dGhpcy5wYXNzTm9kZS5nZXRQcmV2aW91c1RleHR1cmUodGhpcy50ZXh0dXJlTmFtZSk6dGhpcy5wYXNzTm9kZS5nZXRUZXh0dXJlKHRoaXMudGV4dHVyZU5hbWUpfXNldHVwKHQpe3JldHVybiB0aGlzLnVwZGF0ZVRleHR1cmUoKSxzdXBlci5zZXR1cCh0KX1jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLnBhc3NOb2RlLHRoaXMudGV4dHVyZU5hbWUsdGhpcy5wcmV2aW91c1RleHR1cmUpfX1jbGFzcyB0biBleHRlbmRzIGR0e3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJQYXNzTm9kZSJ9Y29uc3RydWN0b3IodCxlLHMsbj17fSl7c3VwZXIoInZlYzQiKSx0aGlzLnNjb3BlPXQsdGhpcy5zY2VuZT1lLHRoaXMuY2FtZXJhPXMsdGhpcy5vcHRpb25zPW4sdGhpcy5fcGl4ZWxSYXRpbz0xLHRoaXMuX3dpZHRoPTEsdGhpcy5faGVpZ2h0PTE7Y29uc3QgaT1uZXcgeHI7aS5pc1JlbmRlclRhcmdldFRleHR1cmU9ITAsaS5uYW1lPSJkZXB0aCI7Y29uc3Qgbz1uZXcgb3IodGhpcy5fd2lkdGgqdGhpcy5fcGl4ZWxSYXRpbyx0aGlzLl9oZWlnaHQqdGhpcy5fcGl4ZWxSYXRpbyx7dHlwZTp2bywuLi5ufSk7by50ZXh0dXJlLm5hbWU9Im91dHB1dCIsby5kZXB0aFRleHR1cmU9aSx0aGlzLnJlbmRlclRhcmdldD1vLHRoaXMudXBkYXRlQmVmb3JlVHlwZT1RLkZSQU1FLHRoaXMuX3RleHR1cmVzPXtvdXRwdXQ6by50ZXh0dXJlLGRlcHRoOml9LHRoaXMuX3RleHR1cmVOb2Rlcz17fSx0aGlzLl9saW5lYXJEZXB0aE5vZGVzPXt9LHRoaXMuX3ZpZXdaTm9kZXM9e30sdGhpcy5fcHJldmlvdXNUZXh0dXJlcz17fSx0aGlzLl9wcmV2aW91c1RleHR1cmVOb2Rlcz17fSx0aGlzLl9jYW1lcmFOZWFyPXh0KDApLHRoaXMuX2NhbWVyYUZhcj14dCgwKSx0aGlzLl9tcnQ9bnVsbCx0aGlzLmlzUGFzc05vZGU9ITB9c2V0TVJUKHQpe3JldHVybiB0aGlzLl9tcnQ9dCx0aGlzfWdldE1SVCgpe3JldHVybiB0aGlzLl9tcnR9aXNHbG9iYWwoKXtyZXR1cm4hMH1nZXRUZXh0dXJlKHQpe2xldCBlPXRoaXMuX3RleHR1cmVzW3RdO3JldHVybiBlPT09dm9pZCAwJiYoZT10aGlzLnJlbmRlclRhcmdldC50ZXh0dXJlLmNsb25lKCksZS5pc1JlbmRlclRhcmdldFRleHR1cmU9ITAsZS5uYW1lPXQsdGhpcy5fdGV4dHVyZXNbdF09ZSx0aGlzLnJlbmRlclRhcmdldC50ZXh0dXJlcy5wdXNoKGUpKSxlfWdldFByZXZpb3VzVGV4dHVyZSh0KXtsZXQgZT10aGlzLl9wcmV2aW91c1RleHR1cmVzW3RdO3JldHVybiBlPT09dm9pZCAwJiYoZT10aGlzLmdldFRleHR1cmUodCkuY2xvbmUoKSxlLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZT0hMCx0aGlzLl9wcmV2aW91c1RleHR1cmVzW3RdPWUpLGV9dG9nZ2xlVGV4dHVyZSh0KXtjb25zdCBlPXRoaXMuX3ByZXZpb3VzVGV4dHVyZXNbdF07aWYoZSE9PXZvaWQgMCl7Y29uc3Qgcz10aGlzLl90ZXh0dXJlc1t0XSxuPXRoaXMucmVuZGVyVGFyZ2V0LnRleHR1cmVzLmluZGV4T2Yocyk7dGhpcy5yZW5kZXJUYXJnZXQudGV4dHVyZXNbbl09ZSx0aGlzLl90ZXh0dXJlc1t0XT1lLHRoaXMuX3ByZXZpb3VzVGV4dHVyZXNbdF09cyx0aGlzLl90ZXh0dXJlTm9kZXNbdF0udXBkYXRlVGV4dHVyZSgpLHRoaXMuX3ByZXZpb3VzVGV4dHVyZU5vZGVzW3RdLnVwZGF0ZVRleHR1cmUoKX19Z2V0VGV4dHVyZU5vZGUodD0ib3V0cHV0Iil7bGV0IGU9dGhpcy5fdGV4dHVyZU5vZGVzW3RdO3JldHVybiBlPT09dm9pZCAwJiYodGhpcy5fdGV4dHVyZU5vZGVzW3RdPWU9dihuZXcgaG8odGhpcyx0KSksdGhpcy5fdGV4dHVyZU5vZGVzW3RdLnVwZGF0ZVRleHR1cmUoKSksZX1nZXRQcmV2aW91c1RleHR1cmVOb2RlKHQ9Im91dHB1dCIpe2xldCBlPXRoaXMuX3ByZXZpb3VzVGV4dHVyZU5vZGVzW3RdO3JldHVybiBlPT09dm9pZCAwJiYodGhpcy5fdGV4dHVyZU5vZGVzW3RdPT09dm9pZCAwJiZ0aGlzLmdldFRleHR1cmVOb2RlKHQpLHRoaXMuX3ByZXZpb3VzVGV4dHVyZU5vZGVzW3RdPWU9dihuZXcgaG8odGhpcyx0LCEwKSksdGhpcy5fcHJldmlvdXNUZXh0dXJlTm9kZXNbdF0udXBkYXRlVGV4dHVyZSgpKSxlfWdldFZpZXdaTm9kZSh0PSJkZXB0aCIpe2xldCBlPXRoaXMuX3ZpZXdaTm9kZXNbdF07aWYoZT09PXZvaWQgMCl7Y29uc3Qgcz10aGlzLl9jYW1lcmFOZWFyLG49dGhpcy5fY2FtZXJhRmFyO3RoaXMuX3ZpZXdaTm9kZXNbdF09ZT1hbyh0aGlzLmdldFRleHR1cmVOb2RlKHQpLHMsbil9cmV0dXJuIGV9Z2V0TGluZWFyRGVwdGhOb2RlKHQ9ImRlcHRoIil7bGV0IGU9dGhpcy5fbGluZWFyRGVwdGhOb2Rlc1t0XTtpZihlPT09dm9pZCAwKXtjb25zdCBzPXRoaXMuX2NhbWVyYU5lYXIsbj10aGlzLl9jYW1lcmFGYXIsaT10aGlzLmdldFZpZXdaTm9kZSh0KTt0aGlzLl9saW5lYXJEZXB0aE5vZGVzW3RdPWU9S3MoaSxzLG4pfXJldHVybiBlfXNldHVwKHtyZW5kZXJlcjp0fSl7cmV0dXJuIHRoaXMucmVuZGVyVGFyZ2V0LnNhbXBsZXM9dGhpcy5vcHRpb25zLnNhbXBsZXM9PT12b2lkIDA/dC5zYW1wbGVzOnRoaXMub3B0aW9ucy5zYW1wbGVzLHQuYmFja2VuZC5pc1dlYkdMQmFja2VuZD09PSEwJiYodGhpcy5yZW5kZXJUYXJnZXQuc2FtcGxlcz0wKSx0aGlzLnJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaXNNdWx0aXNhbXBsZVJlbmRlclRhcmdldFRleHR1cmU9dGhpcy5yZW5kZXJUYXJnZXQuc2FtcGxlcz4xLHRoaXMuc2NvcGU9PT10bi5DT0xPUj90aGlzLmdldFRleHR1cmVOb2RlKCk6dGhpcy5nZXRMaW5lYXJEZXB0aE5vZGUoKX11cGRhdGVCZWZvcmUodCl7Y29uc3R7cmVuZGVyZXI6ZX09dCx7c2NlbmU6cyxjYW1lcmE6bn09dGhpczt0aGlzLl9waXhlbFJhdGlvPWUuZ2V0UGl4ZWxSYXRpbygpO2NvbnN0IGk9ZS5nZXRTaXplKFJ1KTt0aGlzLnNldFNpemUoaS53aWR0aCxpLmhlaWdodCk7Y29uc3Qgbz1lLmdldFJlbmRlclRhcmdldCgpLGE9ZS5nZXRNUlQoKTt0aGlzLl9jYW1lcmFOZWFyLnZhbHVlPW4ubmVhcix0aGlzLl9jYW1lcmFGYXIudmFsdWU9bi5mYXI7Zm9yKGNvbnN0IGMgaW4gdGhpcy5fcHJldmlvdXNUZXh0dXJlcyl0aGlzLnRvZ2dsZVRleHR1cmUoYyk7ZS5zZXRSZW5kZXJUYXJnZXQodGhpcy5yZW5kZXJUYXJnZXQpLGUuc2V0TVJUKHRoaXMuX21ydCksZS5yZW5kZXIocyxuKSxlLnNldFJlbmRlclRhcmdldChvKSxlLnNldE1SVChhKX1zZXRTaXplKHQsZSl7dGhpcy5fd2lkdGg9dCx0aGlzLl9oZWlnaHQ9ZTtjb25zdCBzPXRoaXMuX3dpZHRoKnRoaXMuX3BpeGVsUmF0aW8sbj10aGlzLl9oZWlnaHQqdGhpcy5fcGl4ZWxSYXRpbzt0aGlzLnJlbmRlclRhcmdldC5zZXRTaXplKHMsbil9c2V0UGl4ZWxSYXRpbyh0KXt0aGlzLl9waXhlbFJhdGlvPXQsdGhpcy5zZXRTaXplKHRoaXMuX3dpZHRoLHRoaXMuX2hlaWdodCl9ZGlzcG9zZSgpe3RoaXMucmVuZGVyVGFyZ2V0LmRpc3Bvc2UoKX19dG4uQ09MT1I9ImNvbG9yIix0bi5ERVBUSD0iZGVwdGgiLHR0KCh7ZGVwdGhUZXh0dXJlOnIsc2hhZG93Q29vcmQ6dH0pPT5hcyhyLHQueHkpLmNvbXBhcmUodC56KSksdHQoKHtkZXB0aFRleHR1cmU6cixzaGFkb3dDb29yZDp0LHNoYWRvdzplfSk9Pntjb25zdCBzPShtLGcpPT5hcyhyLG0pLmNvbXBhcmUoZyksbj1wZSgibWFwU2l6ZSIsInZlYzIiLGUpLnNldEdyb3VwKGRlKSxpPXBlKCJyYWRpdXMiLCJmbG9hdCIsZSkuc2V0R3JvdXAoZGUpLG89RCgxKS5kaXYobiksYT1vLngubmVnYXRlKCkubXVsKGkpLGM9by55Lm5lZ2F0ZSgpLm11bChpKSx1PW8ueC5tdWwoaSksaD1vLnkubXVsKGkpLGw9YS5kaXYoMiksZD1jLmRpdigyKSxmPXUuZGl2KDIpLHA9aC5kaXYoMik7cmV0dXJuIGZlKHModC54eS5hZGQoRChhLGMpKSx0LnopLHModC54eS5hZGQoRCgwLGMpKSx0LnopLHModC54eS5hZGQoRCh1LGMpKSx0LnopLHModC54eS5hZGQoRChsLGQpKSx0LnopLHModC54eS5hZGQoRCgwLGQpKSx0LnopLHModC54eS5hZGQoRChmLGQpKSx0LnopLHModC54eS5hZGQoRChhLDApKSx0LnopLHModC54eS5hZGQoRChsLDApKSx0LnopLHModC54eSx0LnopLHModC54eS5hZGQoRChmLDApKSx0LnopLHModC54eS5hZGQoRCh1LDApKSx0LnopLHModC54eS5hZGQoRChsLHApKSx0LnopLHModC54eS5hZGQoRCgwLHApKSx0LnopLHModC54eS5hZGQoRChmLHApKSx0LnopLHModC54eS5hZGQoRChhLGgpKSx0LnopLHModC54eS5hZGQoRCgwLGgpKSx0LnopLHModC54eS5hZGQoRCh1LGgpKSx0LnopKS5tdWwoMS8xNyl9KSx0dCgoe2RlcHRoVGV4dHVyZTpyLHNoYWRvd0Nvb3JkOnQsc2hhZG93OmV9KT0+e2NvbnN0IHM9KGgsbCk9PmFzKHIsaCkuY29tcGFyZShsKSxuPXBlKCJtYXBTaXplIiwidmVjMiIsZSkuc2V0R3JvdXAoZGUpLGk9RCgxKS5kaXYobiksbz1pLngsYT1pLnksYz10Lnh5LHU9cmkoYy5tdWwobikuYWRkKC41KSk7cmV0dXJuIGMuc3ViQXNzaWduKHUubXVsKGkpKSxmZShzKGMsdC56KSxzKGMuYWRkKEQobywwKSksdC56KSxzKGMuYWRkKEQoMCxhKSksdC56KSxzKGMuYWRkKGkpLHQueikscmUocyhjLmFkZChEKG8ubmVnYXRlKCksMCkpLHQueikscyhjLmFkZChEKG8ubXVsKDIpLDApKSx0LnopLHUueCkscmUocyhjLmFkZChEKG8ubmVnYXRlKCksYSkpLHQueikscyhjLmFkZChEKG8ubXVsKDIpLGEpKSx0LnopLHUueCkscmUocyhjLmFkZChEKDAsYS5uZWdhdGUoKSkpLHQueikscyhjLmFkZChEKDAsYS5tdWwoMikpKSx0LnopLHUueSkscmUocyhjLmFkZChEKG8sYS5uZWdhdGUoKSkpLHQueikscyhjLmFkZChEKG8sYS5tdWwoMikpKSx0LnopLHUueSkscmUocmUocyhjLmFkZChEKG8ubmVnYXRlKCksYS5uZWdhdGUoKSkpLHQueikscyhjLmFkZChEKG8ubXVsKDIpLGEubmVnYXRlKCkpKSx0LnopLHUueCkscmUocyhjLmFkZChEKG8ubmVnYXRlKCksYS5tdWwoMikpKSx0LnopLHMoYy5hZGQoRChvLm11bCgyKSxhLm11bCgyKSkpLHQueiksdS54KSx1LnkpKS5tdWwoMS85KX0pLHR0KCh7ZGVwdGhUZXh0dXJlOnIsc2hhZG93Q29vcmQ6dH0pPT57Y29uc3QgZT1xKDEpLnRvVmFyKCkscz1hcyhyKS51dih0Lnh5KS5yZyxuPWtyKHQueixzLngpO3JldHVybiBuaShuLm5vdEVxdWFsKHEoMSkpLCgpPT57Y29uc3QgaT10Lnouc3ViKHMueCksbz1haSgwLHMueS5tdWwocy55KSk7bGV0IGE9by5kaXYoby5hZGQoaS5tdWwoaSkpKTthPVdzKCRzKGEsLjMpLmRpdiguOTUtLjMpKSxlLmFzc2lnbihXcyhhaShuLGEpKSl9KSxlfSksdHQoKHtzYW1wbGVzOnIscmFkaXVzOnQsc2l6ZTplLHNoYWRvd1Bhc3M6c30pPT57Y29uc3Qgbj1xKDApLnRvVmFyKCksaT1xKDApLnRvVmFyKCksbz1yLmxlc3NUaGFuRXF1YWwocSgxKSkuc2VsZWN0KHEoMCkscSgyKS5kaXYoci5zdWIoMSkpKSxhPXIubGVzc1RoYW5FcXVhbChxKDEpKS5zZWxlY3QocSgwKSxxKC0xKSk7T2Uoe3N0YXJ0OlJlKDApLGVuZDpSZShyKSx0eXBlOiJpbnQiLGNvbmRpdGlvbjoiPCJ9LCh7aTp1fSk9Pntjb25zdCBoPWEuYWRkKHEodSkubXVsKG8pKSxsPXMudXYoZmUoUXMueHksRCgwLGgpLm11bCh0KSkuZGl2KGUpKS54O24uYWRkQXNzaWduKGwpLGkuYWRkQXNzaWduKGwubXVsKGwpKX0pLG4uZGl2QXNzaWduKHIpLGkuZGl2QXNzaWduKHIpO2NvbnN0IGM9aWkoaS5zdWIobi5tdWwobikpKTtyZXR1cm4gRChuLGMpfSksdHQoKHtzYW1wbGVzOnIscmFkaXVzOnQsc2l6ZTplLHNoYWRvd1Bhc3M6c30pPT57Y29uc3Qgbj1xKDApLnRvVmFyKCksaT1xKDApLnRvVmFyKCksbz1yLmxlc3NUaGFuRXF1YWwocSgxKSkuc2VsZWN0KHEoMCkscSgyKS5kaXYoci5zdWIoMSkpKSxhPXIubGVzc1RoYW5FcXVhbChxKDEpKS5zZWxlY3QocSgwKSxxKC0xKSk7T2Uoe3N0YXJ0OlJlKDApLGVuZDpSZShyKSx0eXBlOiJpbnQiLGNvbmRpdGlvbjoiPCJ9LCh7aTp1fSk9Pntjb25zdCBoPWEuYWRkKHEodSkubXVsKG8pKSxsPXMudXYoZmUoUXMueHksRChoLDApLm11bCh0KSkuZGl2KGUpKTtuLmFkZEFzc2lnbihsLngpLGkuYWRkQXNzaWduKGZlKGwueS5tdWwobC55KSxsLngubXVsKGwueCkpKX0pLG4uZGl2QXNzaWduKHIpLGkuZGl2QXNzaWduKHIpO2NvbnN0IGM9aWkoaS5zdWIobi5tdWwobikpKTtyZXR1cm4gRChuLGMpfSksaygxLjY2MDUsLS4xMjQ2LC0uMDE4MiksaygtLjU4NzYsMS4xMzI5LC0uMTAwNiksaygtLjA3MjgsLS4wMDgzLDEuMTE4NyksayguNjI3NCwuMDY5MSwuMDE2NCksayguMzI5MywuOTE5NSwuMDg4KSxrKC4wNDMzLC4wMTEzLC44OTU2KTtjbGFzcyBJdSBleHRlbmRzIFV7Y29uc3RydWN0b3IodCl7c3VwZXIoKSx0aGlzLnNjb3BlPXR9Z2VuZXJhdGUodCl7Y29uc3R7c2NvcGU6ZX09dGhpcyx7cmVuZGVyZXI6c309dDtzLmJhY2tlbmQuaXNXZWJHTEJhY2tlbmQ9PT0hMD90LmFkZEZsb3dDb2RlKGAJLy8gJHtlfUJhcnJpZXIgCmApOnQuYWRkTGluZUZsb3dDb2RlKGAke2V9QmFycmllcigpYCx0aGlzKX19QyhJdSk7Y2xhc3Mga3QgZXh0ZW5kcyBkdHtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iQXRvbWljRnVuY3Rpb25Ob2RlIn1jb25zdHJ1Y3Rvcih0LGUscyxuPW51bGwpe3N1cGVyKCJ1aW50IiksdGhpcy5tZXRob2Q9dCx0aGlzLnBvaW50ZXJOb2RlPWUsdGhpcy52YWx1ZU5vZGU9cyx0aGlzLnN0b3JlTm9kZT1ufWdldElucHV0VHlwZSh0KXtyZXR1cm4gdGhpcy5wb2ludGVyTm9kZS5nZXROb2RlVHlwZSh0KX1nZXROb2RlVHlwZSh0KXtyZXR1cm4gdGhpcy5nZXRJbnB1dFR5cGUodCl9Z2VuZXJhdGUodCl7Y29uc3QgZT10aGlzLm1ldGhvZCxzPXRoaXMuZ2V0Tm9kZVR5cGUodCksbj10aGlzLmdldElucHV0VHlwZSh0KSxpPXRoaXMucG9pbnRlck5vZGUsbz10aGlzLnZhbHVlTm9kZSxhPVtdO2EucHVzaChgJiR7aS5idWlsZCh0LG4pfWApLGEucHVzaChvLmJ1aWxkKHQsbikpO2NvbnN0IGM9YCR7dC5nZXRNZXRob2QoZSxzKX0oICR7YS5qb2luKCIsICIpfSApYDtpZih0aGlzLnN0b3JlTm9kZSE9PW51bGwpe2NvbnN0IHU9dGhpcy5zdG9yZU5vZGUuYnVpbGQodCxuKTt0LmFkZExpbmVGbG93Q29kZShgJHt1fSA9ICR7Y31gLHRoaXMpfWVsc2UgdC5hZGRMaW5lRmxvd0NvZGUoYyx0aGlzKX19aWYoa3QuQVRPTUlDX0xPQUQ9ImF0b21pY0xvYWQiLGt0LkFUT01JQ19TVE9SRT0iYXRvbWljU3RvcmUiLGt0LkFUT01JQ19BREQ9ImF0b21pY0FkZCIsa3QuQVRPTUlDX1NVQj0iYXRvbWljU3ViIixrdC5BVE9NSUNfTUFYPSJhdG9taWNNYXgiLGt0LkFUT01JQ19NSU49ImF0b21pY01pbiIsa3QuQVRPTUlDX0FORD0iYXRvbWljQW5kIixrdC5BVE9NSUNfT1I9ImF0b21pY09yIixrdC5BVE9NSUNfWE9SPSJhdG9taWNYb3IiLEMoa3QpLHR5cGVvZiBfX1RIUkVFX0RFVlRPT0xTX188InUiJiZfX1RIUkVFX0RFVlRPT0xTX18uZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoInJlZ2lzdGVyIix7ZGV0YWlsOntyZXZpc2lvbjpYZX19KSksdHlwZW9mIHdpbmRvdzwidSIpe3RyeXtBbiYmQW4udGFnTmFtZS50b1VwcGVyQ2FzZSgpPT09IlNDUklQVCImJkFuLnNyY3x8bmV3IFVSTCgiYXNzZXRzL2dlbmVyYXRlTWVzaEJWSC53b3JrZXItYjc3ODg5MzkuanMiLGRvY3VtZW50LmJhc2VVUkkpLmhyZWYsd2luZG93Ll9fVEhSRUVfX0lNUE9SVFNfX3x8KHdpbmRvdy5fX1RIUkVFX19JTVBPUlRTX189W10pLHdpbmRvdy5fX1RIUkVFX19JTVBPUlRTX18ucHVzaCh7dXJsOnNlbGYubG9jYXRpb24uaHJlZixyZXZpc2lvbjpYZX0pfWNhdGNoe313aW5kb3cuX19USFJFRV9fPyhjb25zb2xlLndhcm4oIldBUk5JTkc6IE11bHRpcGxlIGluc3RhbmNlcyBvZiBUaHJlZS5qcyBiZWluZyBpbXBvcnRlZC4gRXhpc3Rpbmc6ICIrd2luZG93Ll9fVEhSRUVfXysiLCBuZXc6ICIrWGUpLGNvbnNvbGUud2Fybih3aW5kb3cuX19USFJFRV9fSU1QT1JUU19fKSk6d2luZG93Ll9fVEhSRUVfXz1YZX1jb25zdCB1bz0wLHZ1PTEsUHU9Mixsbz0yLGdpPTEuMjUsZm89MSxtcz02KjQrNCs0LGVuPTY1NTM1LEx1PU1hdGgucG93KDIsLTI0KSx4aT1TeW1ib2woIlNLSVBfR0VORVJBVElPTiIpO2Z1bmN0aW9uIE91KHIpe3JldHVybiByLmluZGV4P3IuaW5kZXguY291bnQ6ci5hdHRyaWJ1dGVzLnBvc2l0aW9uLmNvdW50fWZ1bmN0aW9uIERlKHIpe3JldHVybiBPdShyKS8zfWZ1bmN0aW9uIER1KHIsdD1BcnJheUJ1ZmZlcil7cmV0dXJuIHI+NjU1MzU/bmV3IFVpbnQzMkFycmF5KG5ldyB0KDQqcikpOm5ldyBVaW50MTZBcnJheShuZXcgdCgyKnIpKX1mdW5jdGlvbiBWdShyLHQpe2lmKCFyLmluZGV4KXtjb25zdCBlPXIuYXR0cmlidXRlcy5wb3NpdGlvbi5jb3VudCxzPXQudXNlU2hhcmVkQXJyYXlCdWZmZXI/U2hhcmVkQXJyYXlCdWZmZXI6QXJyYXlCdWZmZXIsbj1EdShlLHMpO3Iuc2V0SW5kZXgobmV3IHZ0KG4sMSkpO2ZvcihsZXQgaT0wO2k8ZTtpKyspbltpXT1pfX1mdW5jdGlvbiBwbyhyLHQpe2NvbnN0IGU9RGUocikscz10fHxyLmRyYXdSYW5nZSxuPXMuc3RhcnQvMyxpPShzLnN0YXJ0K3MuY291bnQpLzMsbz1NYXRoLm1heCgwLG4pLGE9TWF0aC5taW4oZSxpKS1vO3JldHVyblt7b2Zmc2V0Ok1hdGguZmxvb3IobyksY291bnQ6TWF0aC5mbG9vcihhKX1dfWZ1bmN0aW9uIG1vKHIsdCl7aWYoIXIuZ3JvdXBzfHwhci5ncm91cHMubGVuZ3RoKXJldHVybiBwbyhyLHQpO2NvbnN0IGU9W10scz1uZXcgU2V0LG49dHx8ci5kcmF3UmFuZ2UsaT1uLnN0YXJ0LzMsbz0obi5zdGFydCtuLmNvdW50KS8zO2Zvcihjb25zdCBjIG9mIHIuZ3JvdXBzKXtjb25zdCB1PWMuc3RhcnQvMyxoPShjLnN0YXJ0K2MuY291bnQpLzM7cy5hZGQoTWF0aC5tYXgoaSx1KSkscy5hZGQoTWF0aC5taW4obyxoKSl9Y29uc3QgYT1BcnJheS5mcm9tKHMudmFsdWVzKCkpLnNvcnQoKGMsdSk9PmMtdSk7Zm9yKGxldCBjPTA7YzxhLmxlbmd0aC0xO2MrKyl7Y29uc3QgdT1hW2NdLGg9YVtjKzFdO2UucHVzaCh7b2Zmc2V0Ok1hdGguZmxvb3IodSksY291bnQ6TWF0aC5mbG9vcihoLXUpfSl9cmV0dXJuIGV9ZnVuY3Rpb24gVXUocix0KXtjb25zdCBlPURlKHIpLHM9bW8ocix0KS5zb3J0KChvLGEpPT5vLm9mZnNldC1hLm9mZnNldCksbj1zW3MubGVuZ3RoLTFdO24uY291bnQ9TWF0aC5taW4oZS1uLm9mZnNldCxuLmNvdW50KTtsZXQgaT0wO3JldHVybiBzLmZvckVhY2goKHtjb3VudDpvfSk9PmkrPW8pLGUhPT1pfWZ1bmN0aW9uIFRpKHIsdCxlLHMsbil7bGV0IGk9MS8wLG89MS8wLGE9MS8wLGM9LTEvMCx1PS0xLzAsaD0tMS8wLGw9MS8wLGQ9MS8wLGY9MS8wLHA9LTEvMCxtPS0xLzAsZz0tMS8wO2ZvcihsZXQgeT10KjYsVD0odCtlKSo2O3k8VDt5Kz02KXtjb25zdCB3PXJbeSswXSxNPXJbeSsxXSxOPXctTSxfPXcrTTtOPGkmJihpPU4pLF8+YyYmKGM9XyksdzxsJiYobD13KSx3PnAmJihwPXcpO2NvbnN0IFM9clt5KzJdLEU9clt5KzNdLEY9Uy1FLFI9UytFO0Y8byYmKG89RiksUj51JiYodT1SKSxTPGQmJihkPVMpLFM+bSYmKG09Uyk7Y29uc3QgST1yW3krNF0sQj1yW3krNV0sUD1JLUIsTD1JK0I7UDxhJiYoYT1QKSxMPmgmJihoPUwpLEk8ZiYmKGY9SSksST5nJiYoZz1JKX1zWzBdPWksc1sxXT1vLHNbMl09YSxzWzNdPWMsc1s0XT11LHNbNV09aCxuWzBdPWwsblsxXT1kLG5bMl09ZixuWzNdPXAsbls0XT1tLG5bNV09Z31mdW5jdGlvbiBrdShyLHQ9bnVsbCxlPW51bGwscz1udWxsKXtjb25zdCBuPXIuYXR0cmlidXRlcy5wb3NpdGlvbixpPXIuaW5kZXg/ci5pbmRleC5hcnJheTpudWxsLG89RGUociksYT1uLm5vcm1hbGl6ZWQ7bGV0IGM7dD09PW51bGw/KGM9bmV3IEZsb2F0MzJBcnJheShvKjYpLGU9MCxzPW8pOihjPXQsZT1lfHwwLHM9c3x8byk7Y29uc3QgdT1uLmFycmF5LGg9bi5vZmZzZXR8fDA7bGV0IGw9MztuLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUmJihsPW4uZGF0YS5zdHJpZGUpO2NvbnN0IGQ9WyJnZXRYIiwiZ2V0WSIsImdldFoiXTtmb3IobGV0IGY9ZTtmPGUrcztmKyspe2NvbnN0IHA9ZiozLG09Zio2O2xldCBnPXArMCx5PXArMSxUPXArMjtpJiYoZz1pW2ddLHk9aVt5XSxUPWlbVF0pLGF8fChnPWcqbCtoLHk9eSpsK2gsVD1UKmwraCk7Zm9yKGxldCB3PTA7dzwzO3crKyl7bGV0IE0sTixfO2E/KE09bltkW3ddXShnKSxOPW5bZFt3XV0oeSksXz1uW2Rbd11dKFQpKTooTT11W2crd10sTj11W3krd10sXz11W1Qrd10pO2xldCBTPU07TjxTJiYoUz1OKSxfPFMmJihTPV8pO2xldCBFPU07Tj5FJiYoRT1OKSxfPkUmJihFPV8pO2NvbnN0IEY9KEUtUykvMixSPXcqMjtjW20rUiswXT1TK0YsY1ttK1IrMV09RisoTWF0aC5hYnMoUykrRikqTHV9fXJldHVybiBjfWZ1bmN0aW9uIFoocix0LGUpe3JldHVybiBlLm1pbi54PXRbcl0sZS5taW4ueT10W3IrMV0sZS5taW4uej10W3IrMl0sZS5tYXgueD10W3IrM10sZS5tYXgueT10W3IrNF0sZS5tYXguej10W3IrNV0sZX1mdW5jdGlvbiB5byhyKXtsZXQgdD0tMSxlPS0xLzA7Zm9yKGxldCBzPTA7czwzO3MrKyl7Y29uc3Qgbj1yW3MrM10tcltzXTtuPmUmJihlPW4sdD1zKX1yZXR1cm4gdH1mdW5jdGlvbiBnbyhyLHQpe3Quc2V0KHIpfWZ1bmN0aW9uIHhvKHIsdCxlKXtsZXQgcyxuO2ZvcihsZXQgaT0wO2k8MztpKyspe2NvbnN0IG89aSszO3M9cltpXSxuPXRbaV0sZVtpXT1zPG4/czpuLHM9cltvXSxuPXRbb10sZVtvXT1zPm4/czpufX1mdW5jdGlvbiBzbihyLHQsZSl7Zm9yKGxldCBzPTA7czwzO3MrKyl7Y29uc3Qgbj10W3IrMipzXSxpPXRbcisyKnMrMV0sbz1uLWksYT1uK2k7bzxlW3NdJiYoZVtzXT1vKSxhPmVbcyszXSYmKGVbcyszXT1hKX19ZnVuY3Rpb24geXMocil7Y29uc3QgdD1yWzNdLXJbMF0sZT1yWzRdLXJbMV0scz1yWzVdLXJbMl07cmV0dXJuIDIqKHQqZStlKnMrcyp0KX1jb25zdCBqdD0zMixIdT0ocix0KT0+ci5jYW5kaWRhdGUtdC5jYW5kaWRhdGUsb2U9bmV3IEFycmF5KGp0KS5maWxsKCkubWFwKCgpPT4oe2NvdW50OjAsYm91bmRzOm5ldyBGbG9hdDMyQXJyYXkoNikscmlnaHRDYWNoZUJvdW5kczpuZXcgRmxvYXQzMkFycmF5KDYpLGxlZnRDYWNoZUJvdW5kczpuZXcgRmxvYXQzMkFycmF5KDYpLGNhbmRpZGF0ZTowfSkpLG5uPW5ldyBGbG9hdDMyQXJyYXkoNik7ZnVuY3Rpb24gcXUocix0LGUscyxuLGkpe2xldCBvPS0xLGE9MDtpZihpPT09dW8pbz15byh0KSxvIT09LTEmJihhPSh0W29dK3RbbyszXSkvMik7ZWxzZSBpZihpPT09dnUpbz15byhyKSxvIT09LTEmJihhPSR1KGUscyxuLG8pKTtlbHNlIGlmKGk9PT1QdSl7Y29uc3QgYz15cyhyKTtsZXQgdT1naSpuO2NvbnN0IGg9cyo2LGw9KHMrbikqNjtmb3IobGV0IGQ9MDtkPDM7ZCsrKXtjb25zdCBmPXRbZF0sZz0odFtkKzNdLWYpL2p0O2lmKG48anQvNCl7Y29uc3QgeT1bLi4ub2VdO3kubGVuZ3RoPW47bGV0IFQ9MDtmb3IobGV0IE09aDtNPGw7TSs9NixUKyspe2NvbnN0IE49eVtUXTtOLmNhbmRpZGF0ZT1lW00rMipkXSxOLmNvdW50PTA7Y29uc3R7Ym91bmRzOl8sbGVmdENhY2hlQm91bmRzOlMscmlnaHRDYWNoZUJvdW5kczpFfT1OO2ZvcihsZXQgRj0wO0Y8MztGKyspRVtGXT0xLzAsRVtGKzNdPS0xLzAsU1tGXT0xLzAsU1tGKzNdPS0xLzAsX1tGXT0xLzAsX1tGKzNdPS0xLzA7c24oTSxlLF8pfXkuc29ydChIdSk7bGV0IHc9bjtmb3IobGV0IE09MDtNPHc7TSsrKXtjb25zdCBOPXlbTV07Zm9yKDtNKzE8dyYmeVtNKzFdLmNhbmRpZGF0ZT09PU4uY2FuZGlkYXRlOyl5LnNwbGljZShNKzEsMSksdy0tfWZvcihsZXQgTT1oO008bDtNKz02KXtjb25zdCBOPWVbTSsyKmRdO2ZvcihsZXQgXz0wO188dztfKyspe2NvbnN0IFM9eVtfXTtOPj1TLmNhbmRpZGF0ZT9zbihNLGUsUy5yaWdodENhY2hlQm91bmRzKTooc24oTSxlLFMubGVmdENhY2hlQm91bmRzKSxTLmNvdW50KyspfX1mb3IobGV0IE09MDtNPHc7TSsrKXtjb25zdCBOPXlbTV0sXz1OLmNvdW50LFM9bi1OLmNvdW50LEU9Ti5sZWZ0Q2FjaGVCb3VuZHMsRj1OLnJpZ2h0Q2FjaGVCb3VuZHM7bGV0IFI9MDtfIT09MCYmKFI9eXMoRSkvYyk7bGV0IEk9MDtTIT09MCYmKEk9eXMoRikvYyk7Y29uc3QgQj1mbytnaSooUipfK0kqUyk7Qjx1JiYobz1kLHU9QixhPU4uY2FuZGlkYXRlKX19ZWxzZXtmb3IobGV0IHc9MDt3PGp0O3crKyl7Y29uc3QgTT1vZVt3XTtNLmNvdW50PTAsTS5jYW5kaWRhdGU9ZitnK3cqZztjb25zdCBOPU0uYm91bmRzO2ZvcihsZXQgXz0wO188MztfKyspTltfXT0xLzAsTltfKzNdPS0xLzB9Zm9yKGxldCB3PWg7dzxsO3crPTYpe2xldCBfPX5+KChlW3crMipkXS1mKS9nKTtfPj1qdCYmKF89anQtMSk7Y29uc3QgUz1vZVtfXTtTLmNvdW50Kyssc24odyxlLFMuYm91bmRzKX1jb25zdCB5PW9lW2p0LTFdO2dvKHkuYm91bmRzLHkucmlnaHRDYWNoZUJvdW5kcyk7Zm9yKGxldCB3PWp0LTI7dz49MDt3LS0pe2NvbnN0IE09b2Vbd10sTj1vZVt3KzFdO3hvKE0uYm91bmRzLE4ucmlnaHRDYWNoZUJvdW5kcyxNLnJpZ2h0Q2FjaGVCb3VuZHMpfWxldCBUPTA7Zm9yKGxldCB3PTA7dzxqdC0xO3crKyl7Y29uc3QgTT1vZVt3XSxOPU0uY291bnQsXz1NLmJvdW5kcyxFPW9lW3crMV0ucmlnaHRDYWNoZUJvdW5kcztOIT09MCYmKFQ9PT0wP2dvKF8sbm4pOnhvKF8sbm4sbm4pKSxUKz1OO2xldCBGPTAsUj0wO1QhPT0wJiYoRj15cyhubikvYyk7Y29uc3QgST1uLVQ7SSE9PTAmJihSPXlzKEUpL2MpO2NvbnN0IEI9Zm8rZ2kqKEYqVCtSKkkpO0I8dSYmKG89ZCx1PUIsYT1NLmNhbmRpZGF0ZSl9fX19ZWxzZSBjb25zb2xlLndhcm4oYE1lc2hCVkg6IEludmFsaWQgYnVpbGQgc3RyYXRlZ3kgdmFsdWUgJHtpfSB1c2VkLmApO3JldHVybntheGlzOm8scG9zOmF9fWZ1bmN0aW9uICR1KHIsdCxlLHMpe2xldCBuPTA7Zm9yKGxldCBpPXQsbz10K2U7aTxvO2krKyluKz1yW2kqNitzKjJdO3JldHVybiBuL2V9Y2xhc3MgTml7Y29uc3RydWN0b3IoKXt0aGlzLmJvdW5kaW5nRGF0YT1uZXcgRmxvYXQzMkFycmF5KDYpfX1mdW5jdGlvbiBHdShyLHQsZSxzLG4saSl7bGV0IG89cyxhPXMrbi0xO2NvbnN0IGM9aS5wb3MsdT1pLmF4aXMqMjtmb3IoOzspe2Zvcig7bzw9YSYmZVtvKjYrdV08YzspbysrO2Zvcig7bzw9YSYmZVthKjYrdV0+PWM7KWEtLTtpZihvPGEpe2ZvcihsZXQgaD0wO2g8MztoKyspe2xldCBsPXRbbyozK2hdO3RbbyozK2hdPXRbYSozK2hdLHRbYSozK2hdPWx9Zm9yKGxldCBoPTA7aDw2O2grKyl7bGV0IGw9ZVtvKjYraF07ZVtvKjYraF09ZVthKjYraF0sZVthKjYraF09bH1vKyssYS0tfWVsc2UgcmV0dXJuIG99fWZ1bmN0aW9uIFd1KHIsdCxlLHMsbixpKXtsZXQgbz1zLGE9cytuLTE7Y29uc3QgYz1pLnBvcyx1PWkuYXhpcyoyO2Zvcig7Oyl7Zm9yKDtvPD1hJiZlW28qNit1XTxjOylvKys7Zm9yKDtvPD1hJiZlW2EqNit1XT49YzspYS0tO2lmKG88YSl7bGV0IGg9cltvXTtyW29dPXJbYV0sclthXT1oO2ZvcihsZXQgbD0wO2w8NjtsKyspe2xldCBkPWVbbyo2K2xdO2Vbbyo2K2xdPWVbYSo2K2xdLGVbYSo2K2xdPWR9bysrLGEtLX1lbHNlIHJldHVybiBvfX1mdW5jdGlvbiBwdChyLHQpe3JldHVybiB0W3IrMTVdPT09NjU1MzV9ZnVuY3Rpb24gVHQocix0KXtyZXR1cm4gdFtyKzZdfWZ1bmN0aW9uIFN0KHIsdCl7cmV0dXJuIHRbcisxNF19ZnVuY3Rpb24gX3Qocil7cmV0dXJuIHIrOH1mdW5jdGlvbiB6dChyLHQpe3JldHVybiB0W3IrNl19ZnVuY3Rpb24gVG8ocix0KXtyZXR1cm4gdFtyKzddfWZ1bmN0aW9uIGpsKHIpe3JldHVybiByfWxldCBObyxncyxybix3bztjb25zdCBYdT1NYXRoLnBvdygyLDMyKTtmdW5jdGlvbiB3aShyKXtyZXR1cm4iY291bnQiaW4gcj8xOjErd2koci5sZWZ0KSt3aShyLnJpZ2h0KX1mdW5jdGlvbiBZdShyLHQsZSl7cmV0dXJuIE5vPW5ldyBGbG9hdDMyQXJyYXkoZSksZ3M9bmV3IFVpbnQzMkFycmF5KGUpLHJuPW5ldyBVaW50MTZBcnJheShlKSx3bz1uZXcgVWludDhBcnJheShlKSxBaShyLHQpfWZ1bmN0aW9uIEFpKHIsdCl7Y29uc3QgZT1yLzQscz1yLzIsbj0iY291bnQiaW4gdCxpPXQuYm91bmRpbmdEYXRhO2ZvcihsZXQgbz0wO288NjtvKyspTm9bZStvXT1pW29dO2lmKG4paWYodC5idWZmZXIpe2NvbnN0IG89dC5idWZmZXI7d28uc2V0KG5ldyBVaW50OEFycmF5KG8pLHIpO2ZvcihsZXQgYT1yLGM9citvLmJ5dGVMZW5ndGg7YTxjO2ErPW1zKXtjb25zdCB1PWEvMjtwdCh1LHJuKXx8KGdzW2EvNCs2XSs9ZSl9cmV0dXJuIHIrby5ieXRlTGVuZ3RofWVsc2V7Y29uc3Qgbz10Lm9mZnNldCxhPXQuY291bnQ7cmV0dXJuIGdzW2UrNl09byxybltzKzE0XT1hLHJuW3MrMTVdPWVuLHIrbXN9ZWxzZXtjb25zdCBvPXQubGVmdCxhPXQucmlnaHQsYz10LnNwbGl0QXhpcztsZXQgdTtpZih1PUFpKHIrbXMsbyksdS80Plh1KXRocm93IG5ldyBFcnJvcigiTWVzaEJWSDogQ2Fubm90IHN0b3JlIGNoaWxkIHBvaW50ZXIgZ3JlYXRlciB0aGFuIDMyIGJpdHMuIik7cmV0dXJuIGdzW2UrNl09dS80LHU9QWkodSxhKSxnc1tlKzddPWMsdX19ZnVuY3Rpb24gWnUocix0KXtjb25zdCBlPShyLmluZGV4P3IuaW5kZXguY291bnQ6ci5hdHRyaWJ1dGVzLnBvc2l0aW9uLmNvdW50KS8zLHM9ZT4yKioxNixuPXM/NDoyLGk9dD9uZXcgU2hhcmVkQXJyYXlCdWZmZXIoZSpuKTpuZXcgQXJyYXlCdWZmZXIoZSpuKSxvPXM/bmV3IFVpbnQzMkFycmF5KGkpOm5ldyBVaW50MTZBcnJheShpKTtmb3IobGV0IGE9MCxjPW8ubGVuZ3RoO2E8YzthKyspb1thXT1hO3JldHVybiBvfWZ1bmN0aW9uIEp1KHIsdCxlLHMsbil7Y29uc3R7bWF4RGVwdGg6aSx2ZXJib3NlOm8sbWF4TGVhZlRyaXM6YSxzdHJhdGVneTpjLG9uUHJvZ3Jlc3M6dSxpbmRpcmVjdDpofT1uLGw9ci5faW5kaXJlY3RCdWZmZXIsZD1yLmdlb21ldHJ5LGY9ZC5pbmRleD9kLmluZGV4LmFycmF5Om51bGwscD1oP1d1Okd1LG09RGUoZCksZz1uZXcgRmxvYXQzMkFycmF5KDYpO2xldCB5PSExO2NvbnN0IFQ9bmV3IE5pO3JldHVybiBUaSh0LGUscyxULmJvdW5kaW5nRGF0YSxnKSxNKFQsZSxzLGcpLFQ7ZnVuY3Rpb24gdyhOKXt1JiZ1KE4vbSl9ZnVuY3Rpb24gTShOLF8sUyxFPW51bGwsRj0wKXtpZigheSYmRj49aSYmKHk9ITAsbyYmKGNvbnNvbGUud2FybihgTWVzaEJWSDogTWF4IGRlcHRoIG9mICR7aX0gcmVhY2hlZCB3aGVuIGdlbmVyYXRpbmcgQlZILiBDb25zaWRlciBpbmNyZWFzaW5nIG1heERlcHRoLmApLGNvbnNvbGUud2FybihkKSkpLFM8PWF8fEY+PWkpcmV0dXJuIHcoXytTKSxOLm9mZnNldD1fLE4uY291bnQ9UyxOO2NvbnN0IFI9cXUoTi5ib3VuZGluZ0RhdGEsRSx0LF8sUyxjKTtpZihSLmF4aXM9PT0tMSlyZXR1cm4gdyhfK1MpLE4ub2Zmc2V0PV8sTi5jb3VudD1TLE47Y29uc3QgST1wKGwsZix0LF8sUyxSKTtpZihJPT09X3x8ST09PV8rUyl3KF8rUyksTi5vZmZzZXQ9XyxOLmNvdW50PVM7ZWxzZXtOLnNwbGl0QXhpcz1SLmF4aXM7Y29uc3QgQj1uZXcgTmksUD1fLEw9SS1fO04ubGVmdD1CLFRpKHQsUCxMLEIuYm91bmRpbmdEYXRhLGcpLE0oQixQLEwsZyxGKzEpO2NvbnN0IFY9bmV3IE5pLEc9SSxOdD1TLUw7Ti5yaWdodD1WLFRpKHQsRyxOdCxWLmJvdW5kaW5nRGF0YSxnKSxNKFYsRyxOdCxnLEYrMSl9cmV0dXJuIE59fWZ1bmN0aW9uIGp1KHIsdCl7Y29uc3QgZT1yLmdlb21ldHJ5O3QuaW5kaXJlY3QmJihyLl9pbmRpcmVjdEJ1ZmZlcj1adShlLHQudXNlU2hhcmVkQXJyYXlCdWZmZXIpLFV1KGUsdC5yYW5nZSkmJiF0LnZlcmJvc2UmJmNvbnNvbGUud2FybignTWVzaEJWSDogUHJvdmlkZWQgZ2VvbWV0cnkgY29udGFpbnMgZ3JvdXBzIG9yIGEgcmFuZ2UgdGhhdCBkbyBub3QgZnVsbHkgc3BhbiB0aGUgdmVydGV4IGNvbnRlbnRzIHdoaWxlIHVzaW5nIHRoZSAiaW5kaXJlY3QiIG9wdGlvbi4gQlZIIG1heSBpbmNvcnJlY3RseSByZXBvcnQgaW50ZXJzZWN0aW9ucyBvbiB1bnJlbmRlcmVkIHBvcnRpb25zIG9mIHRoZSBnZW9tZXRyeS4nKSksci5faW5kaXJlY3RCdWZmZXJ8fFZ1KGUsdCk7Y29uc3Qgcz10LnVzZVNoYXJlZEFycmF5QnVmZmVyP1NoYXJlZEFycmF5QnVmZmVyOkFycmF5QnVmZmVyLG49a3UoZSksaT10LmluZGlyZWN0P3BvKGUsdC5yYW5nZSk6bW8oZSx0LnJhbmdlKTtyLl9yb290cz1pLm1hcChvPT57Y29uc3QgYT1KdShyLG4sby5vZmZzZXQsby5jb3VudCx0KSxjPXdpKGEpLHU9bmV3IHMobXMqYyk7cmV0dXJuIFl1KDAsYSx1KSx1fSl9Y2xhc3MgUXR7Y29uc3RydWN0b3IoKXt0aGlzLm1pbj0xLzAsdGhpcy5tYXg9LTEvMH1zZXRGcm9tUG9pbnRzRmllbGQodCxlKXtsZXQgcz0xLzAsbj0tMS8wO2ZvcihsZXQgaT0wLG89dC5sZW5ndGg7aTxvO2krKyl7Y29uc3QgYz10W2ldW2VdO3M9YzxzP2M6cyxuPWM+bj9jOm59dGhpcy5taW49cyx0aGlzLm1heD1ufXNldEZyb21Qb2ludHModCxlKXtsZXQgcz0xLzAsbj0tMS8wO2ZvcihsZXQgaT0wLG89ZS5sZW5ndGg7aTxvO2krKyl7Y29uc3QgYT1lW2ldLGM9dC5kb3QoYSk7cz1jPHM/YzpzLG49Yz5uP2M6bn10aGlzLm1pbj1zLHRoaXMubWF4PW59aXNTZXBhcmF0ZWQodCl7cmV0dXJuIHRoaXMubWluPnQubWF4fHx0Lm1pbj50aGlzLm1heH19UXQucHJvdG90eXBlLnNldEZyb21Cb3g9ZnVuY3Rpb24oKXtjb25zdCByPW5ldyBBO3JldHVybiBmdW5jdGlvbihlLHMpe2NvbnN0IG49cy5taW4saT1zLm1heDtsZXQgbz0xLzAsYT0tMS8wO2ZvcihsZXQgYz0wO2M8PTE7YysrKWZvcihsZXQgdT0wO3U8PTE7dSsrKWZvcihsZXQgaD0wO2g8PTE7aCsrKXtyLng9bi54KmMraS54KigxLWMpLHIueT1uLnkqdStpLnkqKDEtdSksci56PW4ueipoK2kueiooMS1oKTtjb25zdCBsPWUuZG90KHIpO289TWF0aC5taW4obCxvKSxhPU1hdGgubWF4KGwsYSl9dGhpcy5taW49byx0aGlzLm1heD1hfX0oKTtjb25zdCBRdT1mdW5jdGlvbigpe2NvbnN0IHI9bmV3IEEsdD1uZXcgQSxlPW5ldyBBO3JldHVybiBmdW5jdGlvbihuLGksbyl7Y29uc3QgYT1uLnN0YXJ0LGM9cix1PWkuc3RhcnQsaD10O2Uuc3ViVmVjdG9ycyhhLHUpLHIuc3ViVmVjdG9ycyhuLmVuZCxuLnN0YXJ0KSx0LnN1YlZlY3RvcnMoaS5lbmQsaS5zdGFydCk7Y29uc3QgbD1lLmRvdChoKSxkPWguZG90KGMpLGY9aC5kb3QoaCkscD1lLmRvdChjKSxnPWMuZG90KGMpKmYtZCpkO2xldCB5LFQ7ZyE9PTA/eT0obCpkLXAqZikvZzp5PTAsVD0obCt5KmQpL2Ysby54PXksby55PVR9fSgpLE1pPWZ1bmN0aW9uKCl7Y29uc3Qgcj1uZXcgSix0PW5ldyBBLGU9bmV3IEE7cmV0dXJuIGZ1bmN0aW9uKG4saSxvLGEpe1F1KG4saSxyKTtsZXQgYz1yLngsdT1yLnk7aWYoYz49MCYmYzw9MSYmdT49MCYmdTw9MSl7bi5hdChjLG8pLGkuYXQodSxhKTtyZXR1cm59ZWxzZSBpZihjPj0wJiZjPD0xKXt1PDA/aS5hdCgwLGEpOmkuYXQoMSxhKSxuLmNsb3Nlc3RQb2ludFRvUG9pbnQoYSwhMCxvKTtyZXR1cm59ZWxzZSBpZih1Pj0wJiZ1PD0xKXtjPDA/bi5hdCgwLG8pOm4uYXQoMSxvKSxpLmNsb3Nlc3RQb2ludFRvUG9pbnQobywhMCxhKTtyZXR1cm59ZWxzZXtsZXQgaDtjPDA/aD1uLnN0YXJ0Omg9bi5lbmQ7bGV0IGw7dTwwP2w9aS5zdGFydDpsPWkuZW5kO2NvbnN0IGQ9dCxmPWU7aWYobi5jbG9zZXN0UG9pbnRUb1BvaW50KGwsITAsdCksaS5jbG9zZXN0UG9pbnRUb1BvaW50KGgsITAsZSksZC5kaXN0YW5jZVRvU3F1YXJlZChsKTw9Zi5kaXN0YW5jZVRvU3F1YXJlZChoKSl7by5jb3B5KGQpLGEuY29weShsKTtyZXR1cm59ZWxzZXtvLmNvcHkoaCksYS5jb3B5KGYpO3JldHVybn19fX0oKSxLdT1mdW5jdGlvbigpe2NvbnN0IHI9bmV3IEEsdD1uZXcgQSxlPW5ldyBYbixzPW5ldyBadDtyZXR1cm4gZnVuY3Rpb24oaSxvKXtjb25zdHtyYWRpdXM6YSxjZW50ZXI6Y309aSx7YTp1LGI6aCxjOmx9PW87aWYocy5zdGFydD11LHMuZW5kPWgscy5jbG9zZXN0UG9pbnRUb1BvaW50KGMsITAscikuZGlzdGFuY2VUbyhjKTw9YXx8KHMuc3RhcnQ9dSxzLmVuZD1sLHMuY2xvc2VzdFBvaW50VG9Qb2ludChjLCEwLHIpLmRpc3RhbmNlVG8oYyk8PWEpfHwocy5zdGFydD1oLHMuZW5kPWwscy5jbG9zZXN0UG9pbnRUb1BvaW50KGMsITAscikuZGlzdGFuY2VUbyhjKTw9YSkpcmV0dXJuITA7Y29uc3QgbT1vLmdldFBsYW5lKGUpO2lmKE1hdGguYWJzKG0uZGlzdGFuY2VUb1BvaW50KGMpKTw9YSl7Y29uc3QgeT1tLnByb2plY3RQb2ludChjLHQpO2lmKG8uY29udGFpbnNQb2ludCh5KSlyZXR1cm4hMH1yZXR1cm4hMX19KCksdGw9MWUtMTU7ZnVuY3Rpb24gU2kocil7cmV0dXJuIE1hdGguYWJzKHIpPHRsfWNsYXNzIEx0IGV4dGVuZHMgd3R7Y29uc3RydWN0b3IoLi4udCl7c3VwZXIoLi4udCksdGhpcy5pc0V4dGVuZGVkVHJpYW5nbGU9ITAsdGhpcy5zYXRBeGVzPW5ldyBBcnJheSg0KS5maWxsKCkubWFwKCgpPT5uZXcgQSksdGhpcy5zYXRCb3VuZHM9bmV3IEFycmF5KDQpLmZpbGwoKS5tYXAoKCk9Pm5ldyBRdCksdGhpcy5wb2ludHM9W3RoaXMuYSx0aGlzLmIsdGhpcy5jXSx0aGlzLnNwaGVyZT1uZXcgY3IsdGhpcy5wbGFuZT1uZXcgWG4sdGhpcy5uZWVkc1VwZGF0ZT0hMH1pbnRlcnNlY3RzU3BoZXJlKHQpe3JldHVybiBLdSh0LHRoaXMpfXVwZGF0ZSgpe2NvbnN0IHQ9dGhpcy5hLGU9dGhpcy5iLHM9dGhpcy5jLG49dGhpcy5wb2ludHMsaT10aGlzLnNhdEF4ZXMsbz10aGlzLnNhdEJvdW5kcyxhPWlbMF0sYz1vWzBdO3RoaXMuZ2V0Tm9ybWFsKGEpLGMuc2V0RnJvbVBvaW50cyhhLG4pO2NvbnN0IHU9aVsxXSxoPW9bMV07dS5zdWJWZWN0b3JzKHQsZSksaC5zZXRGcm9tUG9pbnRzKHUsbik7Y29uc3QgbD1pWzJdLGQ9b1syXTtsLnN1YlZlY3RvcnMoZSxzKSxkLnNldEZyb21Qb2ludHMobCxuKTtjb25zdCBmPWlbM10scD1vWzNdO2Yuc3ViVmVjdG9ycyhzLHQpLHAuc2V0RnJvbVBvaW50cyhmLG4pLHRoaXMuc3BoZXJlLnNldEZyb21Qb2ludHModGhpcy5wb2ludHMpLHRoaXMucGxhbmUuc2V0RnJvbU5vcm1hbEFuZENvcGxhbmFyUG9pbnQoYSx0KSx0aGlzLm5lZWRzVXBkYXRlPSExfX1MdC5wcm90b3R5cGUuY2xvc2VzdFBvaW50VG9TZWdtZW50PWZ1bmN0aW9uKCl7Y29uc3Qgcj1uZXcgQSx0PW5ldyBBLGU9bmV3IFp0O3JldHVybiBmdW5jdGlvbihuLGk9bnVsbCxvPW51bGwpe2NvbnN0e3N0YXJ0OmEsZW5kOmN9PW4sdT10aGlzLnBvaW50cztsZXQgaCxsPTEvMDtmb3IobGV0IGQ9MDtkPDM7ZCsrKXtjb25zdCBmPShkKzEpJTM7ZS5zdGFydC5jb3B5KHVbZF0pLGUuZW5kLmNvcHkodVtmXSksTWkoZSxuLHIsdCksaD1yLmRpc3RhbmNlVG9TcXVhcmVkKHQpLGg8bCYmKGw9aCxpJiZpLmNvcHkociksbyYmby5jb3B5KHQpKX1yZXR1cm4gdGhpcy5jbG9zZXN0UG9pbnRUb1BvaW50KGEsciksaD1hLmRpc3RhbmNlVG9TcXVhcmVkKHIpLGg8bCYmKGw9aCxpJiZpLmNvcHkociksbyYmby5jb3B5KGEpKSx0aGlzLmNsb3Nlc3RQb2ludFRvUG9pbnQoYyxyKSxoPWMuZGlzdGFuY2VUb1NxdWFyZWQociksaDxsJiYobD1oLGkmJmkuY29weShyKSxvJiZvLmNvcHkoYykpLE1hdGguc3FydChsKX19KCksTHQucHJvdG90eXBlLmludGVyc2VjdHNUcmlhbmdsZT1mdW5jdGlvbigpe2NvbnN0IHI9bmV3IEx0LHQ9bmV3IEFycmF5KDMpLGU9bmV3IEFycmF5KDMpLHM9bmV3IFF0LG49bmV3IFF0LGk9bmV3IEEsbz1uZXcgQSxhPW5ldyBBLGM9bmV3IEEsdT1uZXcgQSxoPW5ldyBadCxsPW5ldyBadCxkPW5ldyBadCxmPW5ldyBBO2Z1bmN0aW9uIHAobSxnLHkpe2NvbnN0IFQ9bS5wb2ludHM7bGV0IHc9MCxNPS0xO2ZvcihsZXQgTj0wO048MztOKyspe2NvbnN0e3N0YXJ0Ol8sZW5kOlN9PWg7Xy5jb3B5KFRbTl0pLFMuY29weShUWyhOKzEpJTNdKSxoLmRlbHRhKG8pO2NvbnN0IEU9U2koZy5kaXN0YW5jZVRvUG9pbnQoXykpO2lmKFNpKGcubm9ybWFsLmRvdChvKSkmJkUpe3kuY29weShoKSx3PTI7YnJlYWt9Y29uc3QgRj1nLmludGVyc2VjdExpbmUoaCxmKTtpZighRiYmRSYmZi5jb3B5KF8pLChGfHxFKSYmIVNpKGYuZGlzdGFuY2VUbyhTKSkpe2lmKHc8PTEpKHc9PT0xP3kuc3RhcnQ6eS5lbmQpLmNvcHkoZiksRSYmKE09dyk7ZWxzZSBpZih3Pj0yKXsoTT09PTE/eS5zdGFydDp5LmVuZCkuY29weShmKSx3PTI7YnJlYWt9aWYodysrLHc9PT0yJiZNPT09LTEpYnJlYWt9fXJldHVybiB3fXJldHVybiBmdW5jdGlvbihnLHk9bnVsbCxUPSExKXt0aGlzLm5lZWRzVXBkYXRlJiZ0aGlzLnVwZGF0ZSgpLGcuaXNFeHRlbmRlZFRyaWFuZ2xlP2cubmVlZHNVcGRhdGUmJmcudXBkYXRlKCk6KHIuY29weShnKSxyLnVwZGF0ZSgpLGc9cik7Y29uc3Qgdz10aGlzLnBsYW5lLE09Zy5wbGFuZTtpZihNYXRoLmFicyh3Lm5vcm1hbC5kb3QoTS5ub3JtYWwpKT4xLTFlLTEwKXtjb25zdCBOPXRoaXMuc2F0Qm91bmRzLF89dGhpcy5zYXRBeGVzO2VbMF09Zy5hLGVbMV09Zy5iLGVbMl09Zy5jO2ZvcihsZXQgRj0wO0Y8NDtGKyspe2NvbnN0IFI9TltGXSxJPV9bRl07aWYocy5zZXRGcm9tUG9pbnRzKEksZSksUi5pc1NlcGFyYXRlZChzKSlyZXR1cm4hMX1jb25zdCBTPWcuc2F0Qm91bmRzLEU9Zy5zYXRBeGVzO3RbMF09dGhpcy5hLHRbMV09dGhpcy5iLHRbMl09dGhpcy5jO2ZvcihsZXQgRj0wO0Y8NDtGKyspe2NvbnN0IFI9U1tGXSxJPUVbRl07aWYocy5zZXRGcm9tUG9pbnRzKEksdCksUi5pc1NlcGFyYXRlZChzKSlyZXR1cm4hMX1mb3IobGV0IEY9MDtGPDQ7RisrKXtjb25zdCBSPV9bRl07Zm9yKGxldCBJPTA7STw0O0krKyl7Y29uc3QgQj1FW0ldO2lmKGkuY3Jvc3NWZWN0b3JzKFIsQikscy5zZXRGcm9tUG9pbnRzKGksdCksbi5zZXRGcm9tUG9pbnRzKGksZSkscy5pc1NlcGFyYXRlZChuKSlyZXR1cm4hMX19cmV0dXJuIHkmJihUfHxjb25zb2xlLndhcm4oIkV4dGVuZGVkVHJpYW5nbGUuaW50ZXJzZWN0c1RyaWFuZ2xlOiBUcmlhbmdsZXMgYXJlIGNvcGxhbmFyIHdoaWNoIGRvZXMgbm90IHN1cHBvcnQgYW4gb3V0cHV0IGVkZ2UuIFNldHRpbmcgZWRnZSB0byAwLCAwLCAwLiIpLHkuc3RhcnQuc2V0KDAsMCwwKSx5LmVuZC5zZXQoMCwwLDApKSwhMH1lbHNle2NvbnN0IE49cCh0aGlzLE0sbCk7aWYoTj09PTEmJmcuY29udGFpbnNQb2ludChsLmVuZCkpcmV0dXJuIHkmJih5LnN0YXJ0LmNvcHkobC5lbmQpLHkuZW5kLmNvcHkobC5lbmQpKSwhMDtpZihOIT09MilyZXR1cm4hMTtjb25zdCBfPXAoZyx3LGQpO2lmKF89PT0xJiZ0aGlzLmNvbnRhaW5zUG9pbnQoZC5lbmQpKXJldHVybiB5JiYoeS5zdGFydC5jb3B5KGQuZW5kKSx5LmVuZC5jb3B5KGQuZW5kKSksITA7aWYoXyE9PTIpcmV0dXJuITE7aWYobC5kZWx0YShhKSxkLmRlbHRhKGMpLGEuZG90KGMpPDApe2xldCBQPWQuc3RhcnQ7ZC5zdGFydD1kLmVuZCxkLmVuZD1QfWNvbnN0IFM9bC5zdGFydC5kb3QoYSksRT1sLmVuZC5kb3QoYSksRj1kLnN0YXJ0LmRvdChhKSxSPWQuZW5kLmRvdChhKSxJPUU8RixCPVM8UjtyZXR1cm4gUyE9PVImJkYhPT1FJiZJPT09Qj8hMTooeSYmKHUuc3ViVmVjdG9ycyhsLnN0YXJ0LGQuc3RhcnQpLHUuZG90KGEpPjA/eS5zdGFydC5jb3B5KGwuc3RhcnQpOnkuc3RhcnQuY29weShkLnN0YXJ0KSx1LnN1YlZlY3RvcnMobC5lbmQsZC5lbmQpLHUuZG90KGEpPDA/eS5lbmQuY29weShsLmVuZCk6eS5lbmQuY29weShkLmVuZCkpLCEwKX19fSgpLEx0LnByb3RvdHlwZS5kaXN0YW5jZVRvUG9pbnQ9ZnVuY3Rpb24oKXtjb25zdCByPW5ldyBBO3JldHVybiBmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5jbG9zZXN0UG9pbnRUb1BvaW50KGUsciksZS5kaXN0YW5jZVRvKHIpfX0oKSxMdC5wcm90b3R5cGUuZGlzdGFuY2VUb1RyaWFuZ2xlPWZ1bmN0aW9uKCl7Y29uc3Qgcj1uZXcgQSx0PW5ldyBBLGU9WyJhIiwiYiIsImMiXSxzPW5ldyBadCxuPW5ldyBadDtyZXR1cm4gZnVuY3Rpb24obyxhPW51bGwsYz1udWxsKXtjb25zdCB1PWF8fGM/czpudWxsO2lmKHRoaXMuaW50ZXJzZWN0c1RyaWFuZ2xlKG8sdSkpcmV0dXJuKGF8fGMpJiYoYSYmdS5nZXRDZW50ZXIoYSksYyYmdS5nZXRDZW50ZXIoYykpLDA7bGV0IGg9MS8wO2ZvcihsZXQgbD0wO2w8MztsKyspe2xldCBkO2NvbnN0IGY9ZVtsXSxwPW9bZl07dGhpcy5jbG9zZXN0UG9pbnRUb1BvaW50KHAsciksZD1wLmRpc3RhbmNlVG9TcXVhcmVkKHIpLGQ8aCYmKGg9ZCxhJiZhLmNvcHkociksYyYmYy5jb3B5KHApKTtjb25zdCBtPXRoaXNbZl07by5jbG9zZXN0UG9pbnRUb1BvaW50KG0sciksZD1tLmRpc3RhbmNlVG9TcXVhcmVkKHIpLGQ8aCYmKGg9ZCxhJiZhLmNvcHkobSksYyYmYy5jb3B5KHIpKX1mb3IobGV0IGw9MDtsPDM7bCsrKXtjb25zdCBkPWVbbF0sZj1lWyhsKzEpJTNdO3Muc2V0KHRoaXNbZF0sdGhpc1tmXSk7Zm9yKGxldCBwPTA7cDwzO3ArKyl7Y29uc3QgbT1lW3BdLGc9ZVsocCsxKSUzXTtuLnNldChvW21dLG9bZ10pLE1pKHMsbixyLHQpO2NvbnN0IHk9ci5kaXN0YW5jZVRvU3F1YXJlZCh0KTt5PGgmJihoPXksYSYmYS5jb3B5KHIpLGMmJmMuY29weSh0KSl9fXJldHVybiBNYXRoLnNxcnQoaCl9fSgpO2NsYXNzIGx0e2NvbnN0cnVjdG9yKHQsZSxzKXt0aGlzLmlzT3JpZW50ZWRCb3g9ITAsdGhpcy5taW49bmV3IEEsdGhpcy5tYXg9bmV3IEEsdGhpcy5tYXRyaXg9bmV3IG50LHRoaXMuaW52TWF0cml4PW5ldyBudCx0aGlzLnBvaW50cz1uZXcgQXJyYXkoOCkuZmlsbCgpLm1hcCgoKT0+bmV3IEEpLHRoaXMuc2F0QXhlcz1uZXcgQXJyYXkoMykuZmlsbCgpLm1hcCgoKT0+bmV3IEEpLHRoaXMuc2F0Qm91bmRzPW5ldyBBcnJheSgzKS5maWxsKCkubWFwKCgpPT5uZXcgUXQpLHRoaXMuYWxpZ25lZFNhdEJvdW5kcz1uZXcgQXJyYXkoMykuZmlsbCgpLm1hcCgoKT0+bmV3IFF0KSx0aGlzLm5lZWRzVXBkYXRlPSExLHQmJnRoaXMubWluLmNvcHkodCksZSYmdGhpcy5tYXguY29weShlKSxzJiZ0aGlzLm1hdHJpeC5jb3B5KHMpfXNldCh0LGUscyl7dGhpcy5taW4uY29weSh0KSx0aGlzLm1heC5jb3B5KGUpLHRoaXMubWF0cml4LmNvcHkocyksdGhpcy5uZWVkc1VwZGF0ZT0hMH1jb3B5KHQpe3RoaXMubWluLmNvcHkodC5taW4pLHRoaXMubWF4LmNvcHkodC5tYXgpLHRoaXMubWF0cml4LmNvcHkodC5tYXRyaXgpLHRoaXMubmVlZHNVcGRhdGU9ITB9fWx0LnByb3RvdHlwZS51cGRhdGU9ZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24oKXtjb25zdCB0PXRoaXMubWF0cml4LGU9dGhpcy5taW4scz10aGlzLm1heCxuPXRoaXMucG9pbnRzO2ZvcihsZXQgdT0wO3U8PTE7dSsrKWZvcihsZXQgaD0wO2g8PTE7aCsrKWZvcihsZXQgbD0wO2w8PTE7bCsrKXtjb25zdCBkPTEqdXwyKmh8NCpsLGY9bltkXTtmLng9dT9zLng6ZS54LGYueT1oP3MueTplLnksZi56PWw/cy56OmUueixmLmFwcGx5TWF0cml4NCh0KX1jb25zdCBpPXRoaXMuc2F0Qm91bmRzLG89dGhpcy5zYXRBeGVzLGE9blswXTtmb3IobGV0IHU9MDt1PDM7dSsrKXtjb25zdCBoPW9bdV0sbD1pW3VdLGQ9MTw8dSxmPW5bZF07aC5zdWJWZWN0b3JzKGEsZiksbC5zZXRGcm9tUG9pbnRzKGgsbil9Y29uc3QgYz10aGlzLmFsaWduZWRTYXRCb3VuZHM7Y1swXS5zZXRGcm9tUG9pbnRzRmllbGQobiwieCIpLGNbMV0uc2V0RnJvbVBvaW50c0ZpZWxkKG4sInkiKSxjWzJdLnNldEZyb21Qb2ludHNGaWVsZChuLCJ6IiksdGhpcy5pbnZNYXRyaXguY29weSh0aGlzLm1hdHJpeCkuaW52ZXJ0KCksdGhpcy5uZWVkc1VwZGF0ZT0hMX19KCksbHQucHJvdG90eXBlLmludGVyc2VjdHNCb3g9ZnVuY3Rpb24oKXtjb25zdCByPW5ldyBRdDtyZXR1cm4gZnVuY3Rpb24oZSl7dGhpcy5uZWVkc1VwZGF0ZSYmdGhpcy51cGRhdGUoKTtjb25zdCBzPWUubWluLG49ZS5tYXgsaT10aGlzLnNhdEJvdW5kcyxvPXRoaXMuc2F0QXhlcyxhPXRoaXMuYWxpZ25lZFNhdEJvdW5kcztpZihyLm1pbj1zLngsci5tYXg9bi54LGFbMF0uaXNTZXBhcmF0ZWQocil8fChyLm1pbj1zLnksci5tYXg9bi55LGFbMV0uaXNTZXBhcmF0ZWQocikpfHwoci5taW49cy56LHIubWF4PW4ueixhWzJdLmlzU2VwYXJhdGVkKHIpKSlyZXR1cm4hMTtmb3IobGV0IGM9MDtjPDM7YysrKXtjb25zdCB1PW9bY10saD1pW2NdO2lmKHIuc2V0RnJvbUJveCh1LGUpLGguaXNTZXBhcmF0ZWQocikpcmV0dXJuITF9cmV0dXJuITB9fSgpLGx0LnByb3RvdHlwZS5pbnRlcnNlY3RzVHJpYW5nbGU9ZnVuY3Rpb24oKXtjb25zdCByPW5ldyBMdCx0PW5ldyBBcnJheSgzKSxlPW5ldyBRdCxzPW5ldyBRdCxuPW5ldyBBO3JldHVybiBmdW5jdGlvbihvKXt0aGlzLm5lZWRzVXBkYXRlJiZ0aGlzLnVwZGF0ZSgpLG8uaXNFeHRlbmRlZFRyaWFuZ2xlP28ubmVlZHNVcGRhdGUmJm8udXBkYXRlKCk6KHIuY29weShvKSxyLnVwZGF0ZSgpLG89cik7Y29uc3QgYT10aGlzLnNhdEJvdW5kcyxjPXRoaXMuc2F0QXhlczt0WzBdPW8uYSx0WzFdPW8uYix0WzJdPW8uYztmb3IobGV0IGQ9MDtkPDM7ZCsrKXtjb25zdCBmPWFbZF0scD1jW2RdO2lmKGUuc2V0RnJvbVBvaW50cyhwLHQpLGYuaXNTZXBhcmF0ZWQoZSkpcmV0dXJuITF9Y29uc3QgdT1vLnNhdEJvdW5kcyxoPW8uc2F0QXhlcyxsPXRoaXMucG9pbnRzO2ZvcihsZXQgZD0wO2Q8MztkKyspe2NvbnN0IGY9dVtkXSxwPWhbZF07aWYoZS5zZXRGcm9tUG9pbnRzKHAsbCksZi5pc1NlcGFyYXRlZChlKSlyZXR1cm4hMX1mb3IobGV0IGQ9MDtkPDM7ZCsrKXtjb25zdCBmPWNbZF07Zm9yKGxldCBwPTA7cDw0O3ArKyl7Y29uc3QgbT1oW3BdO2lmKG4uY3Jvc3NWZWN0b3JzKGYsbSksZS5zZXRGcm9tUG9pbnRzKG4sdCkscy5zZXRGcm9tUG9pbnRzKG4sbCksZS5pc1NlcGFyYXRlZChzKSlyZXR1cm4hMX19cmV0dXJuITB9fSgpLGx0LnByb3RvdHlwZS5jbG9zZXN0UG9pbnRUb1BvaW50PWZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMubmVlZHNVcGRhdGUmJnRoaXMudXBkYXRlKCksZS5jb3B5KHQpLmFwcGx5TWF0cml4NCh0aGlzLmludk1hdHJpeCkuY2xhbXAodGhpcy5taW4sdGhpcy5tYXgpLmFwcGx5TWF0cml4NCh0aGlzLm1hdHJpeCksZX19KCksbHQucHJvdG90eXBlLmRpc3RhbmNlVG9Qb2ludD1mdW5jdGlvbigpe2NvbnN0IHI9bmV3IEE7cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmNsb3Nlc3RQb2ludFRvUG9pbnQoZSxyKSxlLmRpc3RhbmNlVG8ocil9fSgpLGx0LnByb3RvdHlwZS5kaXN0YW5jZVRvQm94PWZ1bmN0aW9uKCl7Y29uc3Qgcj1bIngiLCJ5IiwieiJdLHQ9bmV3IEFycmF5KDEyKS5maWxsKCkubWFwKCgpPT5uZXcgWnQpLGU9bmV3IEFycmF5KDEyKS5maWxsKCkubWFwKCgpPT5uZXcgWnQpLHM9bmV3IEEsbj1uZXcgQTtyZXR1cm4gZnVuY3Rpb24obyxhPTAsYz1udWxsLHU9bnVsbCl7aWYodGhpcy5uZWVkc1VwZGF0ZSYmdGhpcy51cGRhdGUoKSx0aGlzLmludGVyc2VjdHNCb3gobykpcmV0dXJuKGN8fHUpJiYoby5nZXRDZW50ZXIobiksdGhpcy5jbG9zZXN0UG9pbnRUb1BvaW50KG4scyksby5jbG9zZXN0UG9pbnRUb1BvaW50KHMsbiksYyYmYy5jb3B5KHMpLHUmJnUuY29weShuKSksMDtjb25zdCBoPWEqYSxsPW8ubWluLGQ9by5tYXgsZj10aGlzLnBvaW50cztsZXQgcD0xLzA7Zm9yKGxldCBnPTA7Zzw4O2crKyl7Y29uc3QgeT1mW2ddO24uY29weSh5KS5jbGFtcChsLGQpO2NvbnN0IFQ9eS5kaXN0YW5jZVRvU3F1YXJlZChuKTtpZihUPHAmJihwPVQsYyYmYy5jb3B5KHkpLHUmJnUuY29weShuKSxUPGgpKXJldHVybiBNYXRoLnNxcnQoVCl9bGV0IG09MDtmb3IobGV0IGc9MDtnPDM7ZysrKWZvcihsZXQgeT0wO3k8PTE7eSsrKWZvcihsZXQgVD0wO1Q8PTE7VCsrKXtjb25zdCB3PShnKzEpJTMsTT0oZysyKSUzLE49eTw8d3xUPDxNLF89MTw8Z3x5PDx3fFQ8PE0sUz1mW05dLEU9ZltfXTt0W21dLnNldChTLEUpO2NvbnN0IFI9cltnXSxJPXJbd10sQj1yW01dLFA9ZVttXSxMPVAuc3RhcnQsVj1QLmVuZDtMW1JdPWxbUl0sTFtJXT15P2xbSV06ZFtJXSxMW0JdPVQ/bFtCXTpkW0ldLFZbUl09ZFtSXSxWW0ldPXk/bFtJXTpkW0ldLFZbQl09VD9sW0JdOmRbSV0sbSsrfWZvcihsZXQgZz0wO2c8PTE7ZysrKWZvcihsZXQgeT0wO3k8PTE7eSsrKWZvcihsZXQgVD0wO1Q8PTE7VCsrKXtuLng9Zz9kLng6bC54LG4ueT15P2QueTpsLnksbi56PVQ/ZC56Omwueix0aGlzLmNsb3Nlc3RQb2ludFRvUG9pbnQobixzKTtjb25zdCB3PW4uZGlzdGFuY2VUb1NxdWFyZWQocyk7aWYodzxwJiYocD13LGMmJmMuY29weShzKSx1JiZ1LmNvcHkobiksdzxoKSlyZXR1cm4gTWF0aC5zcXJ0KHcpfWZvcihsZXQgZz0wO2c8MTI7ZysrKXtjb25zdCB5PXRbZ107Zm9yKGxldCBUPTA7VDwxMjtUKyspe2NvbnN0IHc9ZVtUXTtNaSh5LHcscyxuKTtjb25zdCBNPXMuZGlzdGFuY2VUb1NxdWFyZWQobik7aWYoTTxwJiYocD1NLGMmJmMuY29weShzKSx1JiZ1LmNvcHkobiksTTxoKSlyZXR1cm4gTWF0aC5zcXJ0KE0pfX1yZXR1cm4gTWF0aC5zcXJ0KHApfX0oKTtjbGFzcyBfaXtjb25zdHJ1Y3Rvcih0KXt0aGlzLl9nZXROZXdQcmltaXRpdmU9dCx0aGlzLl9wcmltaXRpdmVzPVtdfWdldFByaW1pdGl2ZSgpe2NvbnN0IHQ9dGhpcy5fcHJpbWl0aXZlcztyZXR1cm4gdC5sZW5ndGg9PT0wP3RoaXMuX2dldE5ld1ByaW1pdGl2ZSgpOnQucG9wKCl9cmVsZWFzZVByaW1pdGl2ZSh0KXt0aGlzLl9wcmltaXRpdmVzLnB1c2godCl9fWNsYXNzIGVsIGV4dGVuZHMgX2l7Y29uc3RydWN0b3IoKXtzdXBlcigoKT0+bmV3IEx0KX19Y29uc3QgYnQ9bmV3IGVsO2NsYXNzIHNse2NvbnN0cnVjdG9yKCl7dGhpcy5mbG9hdDMyQXJyYXk9bnVsbCx0aGlzLnVpbnQxNkFycmF5PW51bGwsdGhpcy51aW50MzJBcnJheT1udWxsO2NvbnN0IHQ9W107bGV0IGU9bnVsbDt0aGlzLnNldEJ1ZmZlcj1zPT57ZSYmdC5wdXNoKGUpLGU9cyx0aGlzLmZsb2F0MzJBcnJheT1uZXcgRmxvYXQzMkFycmF5KHMpLHRoaXMudWludDE2QXJyYXk9bmV3IFVpbnQxNkFycmF5KHMpLHRoaXMudWludDMyQXJyYXk9bmV3IFVpbnQzMkFycmF5KHMpfSx0aGlzLmNsZWFyQnVmZmVyPSgpPT57ZT1udWxsLHRoaXMuZmxvYXQzMkFycmF5PW51bGwsdGhpcy51aW50MTZBcnJheT1udWxsLHRoaXMudWludDMyQXJyYXk9bnVsbCx0Lmxlbmd0aCE9PTAmJnRoaXMuc2V0QnVmZmVyKHQucG9wKCkpfX19Y29uc3QgWD1uZXcgc2w7bGV0IGFlLFZlO2NvbnN0IFVlPVtdLG9uPW5ldyBfaSgoKT0+bmV3IGh0KTtmdW5jdGlvbiBubChyLHQsZSxzLG4saSl7YWU9b24uZ2V0UHJpbWl0aXZlKCksVmU9b24uZ2V0UHJpbWl0aXZlKCksVWUucHVzaChhZSxWZSksWC5zZXRCdWZmZXIoci5fcm9vdHNbdF0pO2NvbnN0IG89emkoMCxyLmdlb21ldHJ5LGUscyxuLGkpO1guY2xlYXJCdWZmZXIoKSxvbi5yZWxlYXNlUHJpbWl0aXZlKGFlKSxvbi5yZWxlYXNlUHJpbWl0aXZlKFZlKSxVZS5wb3AoKSxVZS5wb3AoKTtjb25zdCBhPVVlLmxlbmd0aDtyZXR1cm4gYT4wJiYoVmU9VWVbYS0xXSxhZT1VZVthLTJdKSxvfWZ1bmN0aW9uIHppKHIsdCxlLHMsbj1udWxsLGk9MCxvPTApe2NvbnN0e2Zsb2F0MzJBcnJheTphLHVpbnQxNkFycmF5OmMsdWludDMyQXJyYXk6dX09WDtsZXQgaD1yKjI7aWYocHQoaCxjKSl7Y29uc3QgZD1UdChyLHUpLGY9U3QoaCxjKTtyZXR1cm4gWihyLGEsYWUpLHMoZCxmLCExLG8saStyLGFlKX1lbHNle2xldCBSPWZ1bmN0aW9uKEIpe2NvbnN0e3VpbnQxNkFycmF5OlAsdWludDMyQXJyYXk6TH09WDtsZXQgVj1CKjI7Zm9yKDshcHQoVixQKTspQj1fdChCKSxWPUIqMjtyZXR1cm4gVHQoQixMKX0sST1mdW5jdGlvbihCKXtjb25zdHt1aW50MTZBcnJheTpQLHVpbnQzMkFycmF5Okx9PVg7bGV0IFY9QioyO2Zvcig7IXB0KFYsUCk7KUI9enQoQixMKSxWPUIqMjtyZXR1cm4gVHQoQixMKStTdChWLFApfTtjb25zdCBkPV90KHIpLGY9enQocix1KTtsZXQgcD1kLG09ZixnLHksVCx3O2lmKG4mJihUPWFlLHc9VmUsWihwLGEsVCksWihtLGEsdyksZz1uKFQpLHk9bih3KSx5PGcpKXtwPWYsbT1kO2NvbnN0IEI9ZztnPXkseT1CLFQ9d31UfHwoVD1hZSxaKHAsYSxUKSk7Y29uc3QgTT1wdChwKjIsYyksTj1lKFQsTSxnLG8rMSxpK3ApO2xldCBfO2lmKE49PT1sbyl7Y29uc3QgQj1SKHApLEw9SShwKS1CO189cyhCLEwsITAsbysxLGkrcCxUKX1lbHNlIF89TiYmemkocCx0LGUscyxuLGksbysxKTtpZihfKXJldHVybiEwO3c9VmUsWihtLGEsdyk7Y29uc3QgUz1wdChtKjIsYyksRT1lKHcsUyx5LG8rMSxpK20pO2xldCBGO2lmKEU9PT1sbyl7Y29uc3QgQj1SKG0pLEw9SShtKS1CO0Y9cyhCLEwsITAsbysxLGkrbSx3KX1lbHNlIEY9RSYmemkobSx0LGUscyxuLGksbysxKTtyZXR1cm4hIUZ9fWNvbnN0IHhzPW5ldyBBLGJpPW5ldyBBO2Z1bmN0aW9uIGlsKHIsdCxlPXt9LHM9MCxuPTEvMCl7Y29uc3QgaT1zKnMsbz1uKm47bGV0IGE9MS8wLGM9bnVsbDtpZihyLnNoYXBlY2FzdCh7Ym91bmRzVHJhdmVyc2VPcmRlcjpoPT4oeHMuY29weSh0KS5jbGFtcChoLm1pbixoLm1heCkseHMuZGlzdGFuY2VUb1NxdWFyZWQodCkpLGludGVyc2VjdHNCb3VuZHM6KGgsbCxkKT0+ZDxhJiZkPG8saW50ZXJzZWN0c1RyaWFuZ2xlOihoLGwpPT57aC5jbG9zZXN0UG9pbnRUb1BvaW50KHQseHMpO2NvbnN0IGQ9dC5kaXN0YW5jZVRvU3F1YXJlZCh4cyk7cmV0dXJuIGQ8YSYmKGJpLmNvcHkoeHMpLGE9ZCxjPWwpLGQ8aX19KSxhPT09MS8wKXJldHVybiBudWxsO2NvbnN0IHU9TWF0aC5zcXJ0KGEpO3JldHVybiBlLnBvaW50P2UucG9pbnQuY29weShiaSk6ZS5wb2ludD1iaS5jbG9uZSgpLGUuZGlzdGFuY2U9dSxlLmZhY2VJbmRleD1jLGV9Y29uc3Qgcmw9cGFyc2VJbnQoWGUpPj0xNjksbWU9bmV3IEEseWU9bmV3IEEsZ2U9bmV3IEEsYW49bmV3IEosY249bmV3IEosaG49bmV3IEosQW89bmV3IEEsTW89bmV3IEEsU289bmV3IEEsVHM9bmV3IEE7ZnVuY3Rpb24gb2wocix0LGUscyxuLGksbyxhKXtsZXQgYztpZihpPT09VWk/Yz1yLmludGVyc2VjdFRyaWFuZ2xlKHMsZSx0LCEwLG4pOmM9ci5pbnRlcnNlY3RUcmlhbmdsZSh0LGUscyxpIT09RW8sbiksYz09PW51bGwpcmV0dXJuIG51bGw7Y29uc3QgdT1yLm9yaWdpbi5kaXN0YW5jZVRvKG4pO3JldHVybiB1PG98fHU+YT9udWxsOntkaXN0YW5jZTp1LHBvaW50Om4uY2xvbmUoKX19ZnVuY3Rpb24gYWwocix0LGUscyxuLGksbyxhLGMsdSxoKXttZS5mcm9tQnVmZmVyQXR0cmlidXRlKHQsaSkseWUuZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LG8pLGdlLmZyb21CdWZmZXJBdHRyaWJ1dGUodCxhKTtjb25zdCBsPW9sKHIsbWUseWUsZ2UsVHMsYyx1LGgpO2lmKGwpe2NvbnN0IGQ9bmV3IEE7d3QuZ2V0QmFyeWNvb3JkKFRzLG1lLHllLGdlLGQpLHMmJihhbi5mcm9tQnVmZmVyQXR0cmlidXRlKHMsaSksY24uZnJvbUJ1ZmZlckF0dHJpYnV0ZShzLG8pLGhuLmZyb21CdWZmZXJBdHRyaWJ1dGUocyxhKSxsLnV2PXd0LmdldEludGVycG9sYXRpb24oVHMsbWUseWUsZ2UsYW4sY24saG4sbmV3IEopKSxuJiYoYW4uZnJvbUJ1ZmZlckF0dHJpYnV0ZShuLGkpLGNuLmZyb21CdWZmZXJBdHRyaWJ1dGUobixvKSxobi5mcm9tQnVmZmVyQXR0cmlidXRlKG4sYSksbC51djE9d3QuZ2V0SW50ZXJwb2xhdGlvbihUcyxtZSx5ZSxnZSxhbixjbixobixuZXcgSikpLGUmJihBby5mcm9tQnVmZmVyQXR0cmlidXRlKGUsaSksTW8uZnJvbUJ1ZmZlckF0dHJpYnV0ZShlLG8pLFNvLmZyb21CdWZmZXJBdHRyaWJ1dGUoZSxhKSxsLm5vcm1hbD13dC5nZXRJbnRlcnBvbGF0aW9uKFRzLG1lLHllLGdlLEFvLE1vLFNvLG5ldyBBKSxsLm5vcm1hbC5kb3Qoci5kaXJlY3Rpb24pPjAmJmwubm9ybWFsLm11bHRpcGx5U2NhbGFyKC0xKSk7Y29uc3QgZj17YTppLGI6byxjOmEsbm9ybWFsOm5ldyBBLG1hdGVyaWFsSW5kZXg6MH07d3QuZ2V0Tm9ybWFsKG1lLHllLGdlLGYubm9ybWFsKSxsLmZhY2U9ZixsLmZhY2VJbmRleD1pLHJsJiYobC5iYXJ5Y29vcmQ9ZCl9cmV0dXJuIGx9ZnVuY3Rpb24gdW4ocix0LGUscyxuLGksbyl7Y29uc3QgYT1zKjM7bGV0IGM9YSswLHU9YSsxLGg9YSsyO2NvbnN0IGw9ci5pbmRleDtyLmluZGV4JiYoYz1sLmdldFgoYyksdT1sLmdldFgodSksaD1sLmdldFgoaCkpO2NvbnN0e3Bvc2l0aW9uOmQsbm9ybWFsOmYsdXY6cCx1djE6bX09ci5hdHRyaWJ1dGVzLGc9YWwoZSxkLGYscCxtLGMsdSxoLHQsaSxvKTtyZXR1cm4gZz8oZy5mYWNlSW5kZXg9cyxuJiZuLnB1c2goZyksZyk6bnVsbH1mdW5jdGlvbiBzdChyLHQsZSxzKXtjb25zdCBuPXIuYSxpPXIuYixvPXIuYztsZXQgYT10LGM9dCsxLHU9dCsyO2UmJihhPWUuZ2V0WChhKSxjPWUuZ2V0WChjKSx1PWUuZ2V0WCh1KSksbi54PXMuZ2V0WChhKSxuLnk9cy5nZXRZKGEpLG4uej1zLmdldFooYSksaS54PXMuZ2V0WChjKSxpLnk9cy5nZXRZKGMpLGkuej1zLmdldFooYyksby54PXMuZ2V0WCh1KSxvLnk9cy5nZXRZKHUpLG8uej1zLmdldFoodSl9ZnVuY3Rpb24gY2wocix0LGUscyxuLGksbyxhKXtjb25zdHtnZW9tZXRyeTpjLF9pbmRpcmVjdEJ1ZmZlcjp1fT1yO2ZvcihsZXQgaD1zLGw9cytuO2g8bDtoKyspdW4oYyx0LGUsaCxpLG8sYSl9ZnVuY3Rpb24gaGwocix0LGUscyxuLGksbyl7Y29uc3R7Z2VvbWV0cnk6YSxfaW5kaXJlY3RCdWZmZXI6Y309cjtsZXQgdT0xLzAsaD1udWxsO2ZvcihsZXQgbD1zLGQ9cytuO2w8ZDtsKyspe2xldCBmO2Y9dW4oYSx0LGUsbCxudWxsLGksbyksZiYmZi5kaXN0YW5jZTx1JiYoaD1mLHU9Zi5kaXN0YW5jZSl9cmV0dXJuIGh9ZnVuY3Rpb24gdWwocix0LGUscyxuLGksbyl7Y29uc3R7Z2VvbWV0cnk6YX09ZSx7aW5kZXg6Y309YSx1PWEuYXR0cmlidXRlcy5wb3NpdGlvbjtmb3IobGV0IGg9cixsPXQrcjtoPGw7aCsrKXtsZXQgZDtpZihkPWgsc3QobyxkKjMsYyx1KSxvLm5lZWRzVXBkYXRlPSEwLHMobyxkLG4saSkpcmV0dXJuITB9cmV0dXJuITF9ZnVuY3Rpb24gbGwocix0PW51bGwpe3QmJkFycmF5LmlzQXJyYXkodCkmJih0PW5ldyBTZXQodCkpO2NvbnN0IGU9ci5nZW9tZXRyeSxzPWUuaW5kZXg/ZS5pbmRleC5hcnJheTpudWxsLG49ZS5hdHRyaWJ1dGVzLnBvc2l0aW9uO2xldCBpLG8sYSxjLHU9MDtjb25zdCBoPXIuX3Jvb3RzO2ZvcihsZXQgZD0wLGY9aC5sZW5ndGg7ZDxmO2QrKylpPWhbZF0sbz1uZXcgVWludDMyQXJyYXkoaSksYT1uZXcgVWludDE2QXJyYXkoaSksYz1uZXcgRmxvYXQzMkFycmF5KGkpLGwoMCx1KSx1Kz1pLmJ5dGVMZW5ndGg7ZnVuY3Rpb24gbChkLGYscD0hMSl7Y29uc3QgbT1kKjI7aWYoYVttKzE1XT09PWVuKXtjb25zdCB5PW9bZCs2XSxUPWFbbSsxNF07bGV0IHc9MS8wLE09MS8wLE49MS8wLF89LTEvMCxTPS0xLzAsRT0tMS8wO2ZvcihsZXQgRj0zKnksUj0zKih5K1QpO0Y8UjtGKyspe2xldCBJPXNbRl07Y29uc3QgQj1uLmdldFgoSSksUD1uLmdldFkoSSksTD1uLmdldFooSSk7Qjx3JiYodz1CKSxCPl8mJihfPUIpLFA8TSYmKE09UCksUD5TJiYoUz1QKSxMPE4mJihOPUwpLEw+RSYmKEU9TCl9cmV0dXJuIGNbZCswXSE9PXd8fGNbZCsxXSE9PU18fGNbZCsyXSE9PU58fGNbZCszXSE9PV98fGNbZCs0XSE9PVN8fGNbZCs1XSE9PUU/KGNbZCswXT13LGNbZCsxXT1NLGNbZCsyXT1OLGNbZCszXT1fLGNbZCs0XT1TLGNbZCs1XT1FLCEwKTohMX1lbHNle2NvbnN0IHk9ZCs4LFQ9b1tkKzZdLHc9eStmLE09VCtmO2xldCBOPXAsXz0hMSxTPSExO3Q/Tnx8KF89dC5oYXModyksUz10LmhhcyhNKSxOPSFfJiYhUyk6KF89ITAsUz0hMCk7Y29uc3QgRT1OfHxfLEY9Tnx8UztsZXQgUj0hMTtFJiYoUj1sKHksZixOKSk7bGV0IEk9ITE7RiYmKEk9bChULGYsTikpO2NvbnN0IEI9Unx8STtpZihCKWZvcihsZXQgUD0wO1A8MztQKyspe2NvbnN0IEw9eStQLFY9VCtQLEc9Y1tMXSxOdD1jW0wrM10sSHQ9Y1tWXSxxdD1jW1YrM107Y1tkK1BdPUc8SHQ/RzpIdCxjW2QrUCszXT1OdD5xdD9OdDpxdH1yZXR1cm4gQn19fWZ1bmN0aW9uIGNlKHIsdCxlLHMsbil7bGV0IGksbyxhLGMsdSxoO2NvbnN0IGw9MS9lLmRpcmVjdGlvbi54LGQ9MS9lLmRpcmVjdGlvbi55LGY9MS9lLmRpcmVjdGlvbi56LHA9ZS5vcmlnaW4ueCxtPWUub3JpZ2luLnksZz1lLm9yaWdpbi56O2xldCB5PXRbcl0sVD10W3IrM10sdz10W3IrMV0sTT10W3IrMysxXSxOPXRbcisyXSxfPXRbciszKzJdO3JldHVybiBsPj0wPyhpPSh5LXApKmwsbz0oVC1wKSpsKTooaT0oVC1wKSpsLG89KHktcCkqbCksZD49MD8oYT0ody1tKSpkLGM9KE0tbSkqZCk6KGE9KE0tbSkqZCxjPSh3LW0pKmQpLGk+Y3x8YT5vfHwoKGE+aXx8aXNOYU4oaSkpJiYoaT1hKSwoYzxvfHxpc05hTihvKSkmJihvPWMpLGY+PTA/KHU9KE4tZykqZixoPShfLWcpKmYpOih1PShfLWcpKmYsaD0oTi1nKSpmKSxpPmh8fHU+byk/ITE6KCh1Pml8fGkhPT1pKSYmKGk9dSksKGg8b3x8byE9PW8pJiYobz1oKSxpPD1uJiZvPj1zKX1mdW5jdGlvbiBkbChyLHQsZSxzLG4saSxvLGEpe2NvbnN0e2dlb21ldHJ5OmMsX2luZGlyZWN0QnVmZmVyOnV9PXI7Zm9yKGxldCBoPXMsbD1zK247aDxsO2grKyl7bGV0IGQ9dT91W2hdOmg7dW4oYyx0LGUsZCxpLG8sYSl9fWZ1bmN0aW9uIGZsKHIsdCxlLHMsbixpLG8pe2NvbnN0e2dlb21ldHJ5OmEsX2luZGlyZWN0QnVmZmVyOmN9PXI7bGV0IHU9MS8wLGg9bnVsbDtmb3IobGV0IGw9cyxkPXMrbjtsPGQ7bCsrKXtsZXQgZjtmPXVuKGEsdCxlLGM/Y1tsXTpsLG51bGwsaSxvKSxmJiZmLmRpc3RhbmNlPHUmJihoPWYsdT1mLmRpc3RhbmNlKX1yZXR1cm4gaH1mdW5jdGlvbiBwbChyLHQsZSxzLG4saSxvKXtjb25zdHtnZW9tZXRyeTphfT1lLHtpbmRleDpjfT1hLHU9YS5hdHRyaWJ1dGVzLnBvc2l0aW9uO2ZvcihsZXQgaD1yLGw9dCtyO2g8bDtoKyspe2xldCBkO2lmKGQ9ZS5yZXNvbHZlVHJpYW5nbGVJbmRleChoKSxzdChvLGQqMyxjLHUpLG8ubmVlZHNVcGRhdGU9ITAscyhvLGQsbixpKSlyZXR1cm4hMH1yZXR1cm4hMX1mdW5jdGlvbiBtbChyLHQsZSxzLG4saSxvKXtYLnNldEJ1ZmZlcihyLl9yb290c1t0XSksRWkoMCxyLGUscyxuLGksbyksWC5jbGVhckJ1ZmZlcigpfWZ1bmN0aW9uIEVpKHIsdCxlLHMsbixpLG8pe2NvbnN0e2Zsb2F0MzJBcnJheTphLHVpbnQxNkFycmF5OmMsdWludDMyQXJyYXk6dX09WCxoPXIqMjtpZihwdChoLGMpKXtjb25zdCBkPVR0KHIsdSksZj1TdChoLGMpO2NsKHQsZSxzLGQsZixuLGksbyl9ZWxzZXtjb25zdCBkPV90KHIpO2NlKGQsYSxzLGksbykmJkVpKGQsdCxlLHMsbixpLG8pO2NvbnN0IGY9enQocix1KTtjZShmLGEscyxpLG8pJiZFaShmLHQsZSxzLG4saSxvKX19Y29uc3QgeWw9WyJ4IiwieSIsInoiXTtmdW5jdGlvbiBnbChyLHQsZSxzLG4saSl7WC5zZXRCdWZmZXIoci5fcm9vdHNbdF0pO2NvbnN0IG89Q2koMCxyLGUscyxuLGkpO3JldHVybiBYLmNsZWFyQnVmZmVyKCksb31mdW5jdGlvbiBDaShyLHQsZSxzLG4saSl7Y29uc3R7ZmxvYXQzMkFycmF5Om8sdWludDE2QXJyYXk6YSx1aW50MzJBcnJheTpjfT1YO2xldCB1PXIqMjtpZihwdCh1LGEpKXtjb25zdCBsPVR0KHIsYyksZD1TdCh1LGEpO3JldHVybiBobCh0LGUscyxsLGQsbixpKX1lbHNle2NvbnN0IGw9VG8ocixjKSxkPXlsW2xdLHA9cy5kaXJlY3Rpb25bZF0+PTA7bGV0IG0sZztwPyhtPV90KHIpLGc9enQocixjKSk6KG09enQocixjKSxnPV90KHIpKTtjb25zdCBUPWNlKG0sbyxzLG4saSk/Q2kobSx0LGUscyxuLGkpOm51bGw7aWYoVCl7Y29uc3QgTj1ULnBvaW50W2RdO2lmKHA/Tjw9b1tnK2xdOk4+PW9bZytsKzNdKXJldHVybiBUfWNvbnN0IE09Y2UoZyxvLHMsbixpKT9DaShnLHQsZSxzLG4saSk6bnVsbDtyZXR1cm4gVCYmTT9ULmRpc3RhbmNlPD1NLmRpc3RhbmNlP1Q6TTpUfHxNfHxudWxsfX1jb25zdCBsbj1uZXcgaHQsa2U9bmV3IEx0LEhlPW5ldyBMdCxOcz1uZXcgbnQsX289bmV3IGx0LGRuPW5ldyBsdDtmdW5jdGlvbiB4bChyLHQsZSxzKXtYLnNldEJ1ZmZlcihyLl9yb290c1t0XSk7Y29uc3Qgbj1GaSgwLHIsZSxzKTtyZXR1cm4gWC5jbGVhckJ1ZmZlcigpLG59ZnVuY3Rpb24gRmkocix0LGUscyxuPW51bGwpe2NvbnN0e2Zsb2F0MzJBcnJheTppLHVpbnQxNkFycmF5Om8sdWludDMyQXJyYXk6YX09WDtsZXQgYz1yKjI7aWYobj09PW51bGwmJihlLmJvdW5kaW5nQm94fHxlLmNvbXB1dGVCb3VuZGluZ0JveCgpLF9vLnNldChlLmJvdW5kaW5nQm94Lm1pbixlLmJvdW5kaW5nQm94Lm1heCxzKSxuPV9vKSxwdChjLG8pKXtjb25zdCBoPXQuZ2VvbWV0cnksbD1oLmluZGV4LGQ9aC5hdHRyaWJ1dGVzLnBvc2l0aW9uLGY9ZS5pbmRleCxwPWUuYXR0cmlidXRlcy5wb3NpdGlvbixtPVR0KHIsYSksZz1TdChjLG8pO2lmKE5zLmNvcHkocykuaW52ZXJ0KCksZS5ib3VuZHNUcmVlKXJldHVybiBaKHIsaSxkbiksZG4ubWF0cml4LmNvcHkoTnMpLGRuLm5lZWRzVXBkYXRlPSEwLGUuYm91bmRzVHJlZS5zaGFwZWNhc3Qoe2ludGVyc2VjdHNCb3VuZHM6VD0+ZG4uaW50ZXJzZWN0c0JveChUKSxpbnRlcnNlY3RzVHJpYW5nbGU6VD0+e1QuYS5hcHBseU1hdHJpeDQocyksVC5iLmFwcGx5TWF0cml4NChzKSxULmMuYXBwbHlNYXRyaXg0KHMpLFQubmVlZHNVcGRhdGU9ITA7Zm9yKGxldCB3PW0qMyxNPShnK20pKjM7dzxNO3crPTMpaWYoc3QoSGUsdyxsLGQpLEhlLm5lZWRzVXBkYXRlPSEwLFQuaW50ZXJzZWN0c1RyaWFuZ2xlKEhlKSlyZXR1cm4hMDtyZXR1cm4hMX19KTtmb3IobGV0IHk9bSozLFQ9KGcrbSkqMzt5PFQ7eSs9Myl7c3Qoa2UseSxsLGQpLGtlLmEuYXBwbHlNYXRyaXg0KE5zKSxrZS5iLmFwcGx5TWF0cml4NChOcyksa2UuYy5hcHBseU1hdHJpeDQoTnMpLGtlLm5lZWRzVXBkYXRlPSEwO2ZvcihsZXQgdz0wLE09Zi5jb3VudDt3PE07dys9MylpZihzdChIZSx3LGYscCksSGUubmVlZHNVcGRhdGU9ITAsa2UuaW50ZXJzZWN0c1RyaWFuZ2xlKEhlKSlyZXR1cm4hMH19ZWxzZXtjb25zdCBoPXIrOCxsPWFbcis2XTtyZXR1cm4gWihoLGksbG4pLCEhKG4uaW50ZXJzZWN0c0JveChsbikmJkZpKGgsdCxlLHMsbil8fChaKGwsaSxsbiksbi5pbnRlcnNlY3RzQm94KGxuKSYmRmkobCx0LGUscyxuKSkpfX1jb25zdCBmbj1uZXcgbnQsUmk9bmV3IGx0LHdzPW5ldyBsdCxUbD1uZXcgQSxObD1uZXcgQSx3bD1uZXcgQSxBbD1uZXcgQTtmdW5jdGlvbiBNbChyLHQsZSxzPXt9LG49e30saT0wLG89MS8wKXt0LmJvdW5kaW5nQm94fHx0LmNvbXB1dGVCb3VuZGluZ0JveCgpLFJpLnNldCh0LmJvdW5kaW5nQm94Lm1pbix0LmJvdW5kaW5nQm94Lm1heCxlKSxSaS5uZWVkc1VwZGF0ZT0hMDtjb25zdCBhPXIuZ2VvbWV0cnksYz1hLmF0dHJpYnV0ZXMucG9zaXRpb24sdT1hLmluZGV4LGg9dC5hdHRyaWJ1dGVzLnBvc2l0aW9uLGw9dC5pbmRleCxkPWJ0LmdldFByaW1pdGl2ZSgpLGY9YnQuZ2V0UHJpbWl0aXZlKCk7bGV0IHA9VGwsbT1ObCxnPW51bGwseT1udWxsO24mJihnPXdsLHk9QWwpO2xldCBUPTEvMCx3PW51bGwsTT1udWxsO3JldHVybiBmbi5jb3B5KGUpLmludmVydCgpLHdzLm1hdHJpeC5jb3B5KGZuKSxyLnNoYXBlY2FzdCh7Ym91bmRzVHJhdmVyc2VPcmRlcjpOPT5SaS5kaXN0YW5jZVRvQm94KE4pLGludGVyc2VjdHNCb3VuZHM6KE4sXyxTKT0+UzxUJiZTPG8/KF8mJih3cy5taW4uY29weShOLm1pbiksd3MubWF4LmNvcHkoTi5tYXgpLHdzLm5lZWRzVXBkYXRlPSEwKSwhMCk6ITEsaW50ZXJzZWN0c1JhbmdlOihOLF8pPT57aWYodC5ib3VuZHNUcmVlKXJldHVybiB0LmJvdW5kc1RyZWUuc2hhcGVjYXN0KHtib3VuZHNUcmF2ZXJzZU9yZGVyOkU9PndzLmRpc3RhbmNlVG9Cb3goRSksaW50ZXJzZWN0c0JvdW5kczooRSxGLFIpPT5SPFQmJlI8byxpbnRlcnNlY3RzUmFuZ2U6KEUsRik9Pntmb3IobGV0IFI9RSxJPUUrRjtSPEk7UisrKXtzdChmLDMqUixsLGgpLGYuYS5hcHBseU1hdHJpeDQoZSksZi5iLmFwcGx5TWF0cml4NChlKSxmLmMuYXBwbHlNYXRyaXg0KGUpLGYubmVlZHNVcGRhdGU9ITA7Zm9yKGxldCBCPU4sUD1OK187QjxQO0IrKyl7c3QoZCwzKkIsdSxjKSxkLm5lZWRzVXBkYXRlPSEwO2NvbnN0IEw9ZC5kaXN0YW5jZVRvVHJpYW5nbGUoZixwLGcpO2lmKEw8VCYmKG0uY29weShwKSx5JiZ5LmNvcHkoZyksVD1MLHc9QixNPVIpLEw8aSlyZXR1cm4hMH19fX0pO3tjb25zdCBTPURlKHQpO2ZvcihsZXQgRT0wLEY9UztFPEY7RSsrKXtzdChmLDMqRSxsLGgpLGYuYS5hcHBseU1hdHJpeDQoZSksZi5iLmFwcGx5TWF0cml4NChlKSxmLmMuYXBwbHlNYXRyaXg0KGUpLGYubmVlZHNVcGRhdGU9ITA7Zm9yKGxldCBSPU4sST1OK187UjxJO1IrKyl7c3QoZCwzKlIsdSxjKSxkLm5lZWRzVXBkYXRlPSEwO2NvbnN0IEI9ZC5kaXN0YW5jZVRvVHJpYW5nbGUoZixwLGcpO2lmKEI8VCYmKG0uY29weShwKSx5JiZ5LmNvcHkoZyksVD1CLHc9UixNPUUpLEI8aSlyZXR1cm4hMH19fX19KSxidC5yZWxlYXNlUHJpbWl0aXZlKGQpLGJ0LnJlbGVhc2VQcmltaXRpdmUoZiksVD09PTEvMD9udWxsOihzLnBvaW50P3MucG9pbnQuY29weShtKTpzLnBvaW50PW0uY2xvbmUoKSxzLmRpc3RhbmNlPVQscy5mYWNlSW5kZXg9dyxuJiYobi5wb2ludD9uLnBvaW50LmNvcHkoeSk6bi5wb2ludD15LmNsb25lKCksbi5wb2ludC5hcHBseU1hdHJpeDQoZm4pLG0uYXBwbHlNYXRyaXg0KGZuKSxuLmRpc3RhbmNlPW0uc3ViKG4ucG9pbnQpLmxlbmd0aCgpLG4uZmFjZUluZGV4PU0pLHMpfWZ1bmN0aW9uIFNsKHIsdD1udWxsKXt0JiZBcnJheS5pc0FycmF5KHQpJiYodD1uZXcgU2V0KHQpKTtjb25zdCBlPXIuZ2VvbWV0cnkscz1lLmluZGV4P2UuaW5kZXguYXJyYXk6bnVsbCxuPWUuYXR0cmlidXRlcy5wb3NpdGlvbjtsZXQgaSxvLGEsYyx1PTA7Y29uc3QgaD1yLl9yb290cztmb3IobGV0IGQ9MCxmPWgubGVuZ3RoO2Q8ZjtkKyspaT1oW2RdLG89bmV3IFVpbnQzMkFycmF5KGkpLGE9bmV3IFVpbnQxNkFycmF5KGkpLGM9bmV3IEZsb2F0MzJBcnJheShpKSxsKDAsdSksdSs9aS5ieXRlTGVuZ3RoO2Z1bmN0aW9uIGwoZCxmLHA9ITEpe2NvbnN0IG09ZCoyO2lmKGFbbSsxNV09PT1lbil7Y29uc3QgeT1vW2QrNl0sVD1hW20rMTRdO2xldCB3PTEvMCxNPTEvMCxOPTEvMCxfPS0xLzAsUz0tMS8wLEU9LTEvMDtmb3IobGV0IEY9eSxSPXkrVDtGPFI7RisrKXtjb25zdCBJPTMqci5yZXNvbHZlVHJpYW5nbGVJbmRleChGKTtmb3IobGV0IEI9MDtCPDM7QisrKXtsZXQgUD1JK0I7UD1zP3NbUF06UDtjb25zdCBMPW4uZ2V0WChQKSxWPW4uZ2V0WShQKSxHPW4uZ2V0WihQKTtMPHcmJih3PUwpLEw+XyYmKF89TCksVjxNJiYoTT1WKSxWPlMmJihTPVYpLEc8TiYmKE49RyksRz5FJiYoRT1HKX19cmV0dXJuIGNbZCswXSE9PXd8fGNbZCsxXSE9PU18fGNbZCsyXSE9PU58fGNbZCszXSE9PV98fGNbZCs0XSE9PVN8fGNbZCs1XSE9PUU/KGNbZCswXT13LGNbZCsxXT1NLGNbZCsyXT1OLGNbZCszXT1fLGNbZCs0XT1TLGNbZCs1XT1FLCEwKTohMX1lbHNle2NvbnN0IHk9ZCs4LFQ9b1tkKzZdLHc9eStmLE09VCtmO2xldCBOPXAsXz0hMSxTPSExO3Q/Tnx8KF89dC5oYXModyksUz10LmhhcyhNKSxOPSFfJiYhUyk6KF89ITAsUz0hMCk7Y29uc3QgRT1OfHxfLEY9Tnx8UztsZXQgUj0hMTtFJiYoUj1sKHksZixOKSk7bGV0IEk9ITE7RiYmKEk9bChULGYsTikpO2NvbnN0IEI9Unx8STtpZihCKWZvcihsZXQgUD0wO1A8MztQKyspe2NvbnN0IEw9eStQLFY9VCtQLEc9Y1tMXSxOdD1jW0wrM10sSHQ9Y1tWXSxxdD1jW1YrM107Y1tkK1BdPUc8SHQ/RzpIdCxjW2QrUCszXT1OdD5xdD9OdDpxdH1yZXR1cm4gQn19fWZ1bmN0aW9uIF9sKHIsdCxlLHMsbixpLG8pe1guc2V0QnVmZmVyKHIuX3Jvb3RzW3RdKSxCaSgwLHIsZSxzLG4saSxvKSxYLmNsZWFyQnVmZmVyKCl9ZnVuY3Rpb24gQmkocix0LGUscyxuLGksbyl7Y29uc3R7ZmxvYXQzMkFycmF5OmEsdWludDE2QXJyYXk6Yyx1aW50MzJBcnJheTp1fT1YLGg9cioyO2lmKHB0KGgsYykpe2NvbnN0IGQ9VHQocix1KSxmPVN0KGgsYyk7ZGwodCxlLHMsZCxmLG4saSxvKX1lbHNle2NvbnN0IGQ9X3Qocik7Y2UoZCxhLHMsaSxvKSYmQmkoZCx0LGUscyxuLGksbyk7Y29uc3QgZj16dChyLHUpO2NlKGYsYSxzLGksbykmJkJpKGYsdCxlLHMsbixpLG8pfX1jb25zdCB6bD1bIngiLCJ5IiwieiJdO2Z1bmN0aW9uIGJsKHIsdCxlLHMsbixpKXtYLnNldEJ1ZmZlcihyLl9yb290c1t0XSk7Y29uc3Qgbz1JaSgwLHIsZSxzLG4saSk7cmV0dXJuIFguY2xlYXJCdWZmZXIoKSxvfWZ1bmN0aW9uIElpKHIsdCxlLHMsbixpKXtjb25zdHtmbG9hdDMyQXJyYXk6byx1aW50MTZBcnJheTphLHVpbnQzMkFycmF5OmN9PVg7bGV0IHU9cioyO2lmKHB0KHUsYSkpe2NvbnN0IGw9VHQocixjKSxkPVN0KHUsYSk7cmV0dXJuIGZsKHQsZSxzLGwsZCxuLGkpfWVsc2V7Y29uc3QgbD1UbyhyLGMpLGQ9emxbbF0scD1zLmRpcmVjdGlvbltkXT49MDtsZXQgbSxnO3A/KG09X3QociksZz16dChyLGMpKToobT16dChyLGMpLGc9X3QocikpO2NvbnN0IFQ9Y2UobSxvLHMsbixpKT9JaShtLHQsZSxzLG4saSk6bnVsbDtpZihUKXtjb25zdCBOPVQucG9pbnRbZF07aWYocD9OPD1vW2crbF06Tj49b1tnK2wrM10pcmV0dXJuIFR9Y29uc3QgTT1jZShnLG8scyxuLGkpP0lpKGcsdCxlLHMsbixpKTpudWxsO3JldHVybiBUJiZNP1QuZGlzdGFuY2U8PU0uZGlzdGFuY2U/VDpNOlR8fE18fG51bGx9fWNvbnN0IHBuPW5ldyBodCxxZT1uZXcgTHQsJGU9bmV3IEx0LEFzPW5ldyBudCx6bz1uZXcgbHQsbW49bmV3IGx0O2Z1bmN0aW9uIEVsKHIsdCxlLHMpe1guc2V0QnVmZmVyKHIuX3Jvb3RzW3RdKTtjb25zdCBuPXZpKDAscixlLHMpO3JldHVybiBYLmNsZWFyQnVmZmVyKCksbn1mdW5jdGlvbiB2aShyLHQsZSxzLG49bnVsbCl7Y29uc3R7ZmxvYXQzMkFycmF5OmksdWludDE2QXJyYXk6byx1aW50MzJBcnJheTphfT1YO2xldCBjPXIqMjtpZihuPT09bnVsbCYmKGUuYm91bmRpbmdCb3h8fGUuY29tcHV0ZUJvdW5kaW5nQm94KCksem8uc2V0KGUuYm91bmRpbmdCb3gubWluLGUuYm91bmRpbmdCb3gubWF4LHMpLG49em8pLHB0KGMsbykpe2NvbnN0IGg9dC5nZW9tZXRyeSxsPWguaW5kZXgsZD1oLmF0dHJpYnV0ZXMucG9zaXRpb24sZj1lLmluZGV4LHA9ZS5hdHRyaWJ1dGVzLnBvc2l0aW9uLG09VHQocixhKSxnPVN0KGMsbyk7aWYoQXMuY29weShzKS5pbnZlcnQoKSxlLmJvdW5kc1RyZWUpcmV0dXJuIFoocixpLG1uKSxtbi5tYXRyaXguY29weShBcyksbW4ubmVlZHNVcGRhdGU9ITAsZS5ib3VuZHNUcmVlLnNoYXBlY2FzdCh7aW50ZXJzZWN0c0JvdW5kczpUPT5tbi5pbnRlcnNlY3RzQm94KFQpLGludGVyc2VjdHNUcmlhbmdsZTpUPT57VC5hLmFwcGx5TWF0cml4NChzKSxULmIuYXBwbHlNYXRyaXg0KHMpLFQuYy5hcHBseU1hdHJpeDQocyksVC5uZWVkc1VwZGF0ZT0hMDtmb3IobGV0IHc9bSxNPWcrbTt3PE07dysrKWlmKHN0KCRlLDMqdC5yZXNvbHZlVHJpYW5nbGVJbmRleCh3KSxsLGQpLCRlLm5lZWRzVXBkYXRlPSEwLFQuaW50ZXJzZWN0c1RyaWFuZ2xlKCRlKSlyZXR1cm4hMDtyZXR1cm4hMX19KTtmb3IobGV0IHk9bSxUPWcrbTt5PFQ7eSsrKXtjb25zdCB3PXQucmVzb2x2ZVRyaWFuZ2xlSW5kZXgoeSk7c3QocWUsMyp3LGwsZCkscWUuYS5hcHBseU1hdHJpeDQoQXMpLHFlLmIuYXBwbHlNYXRyaXg0KEFzKSxxZS5jLmFwcGx5TWF0cml4NChBcykscWUubmVlZHNVcGRhdGU9ITA7Zm9yKGxldCBNPTAsTj1mLmNvdW50O008TjtNKz0zKWlmKHN0KCRlLE0sZixwKSwkZS5uZWVkc1VwZGF0ZT0hMCxxZS5pbnRlcnNlY3RzVHJpYW5nbGUoJGUpKXJldHVybiEwfX1lbHNle2NvbnN0IGg9cis4LGw9YVtyKzZdO3JldHVybiBaKGgsaSxwbiksISEobi5pbnRlcnNlY3RzQm94KHBuKSYmdmkoaCx0LGUscyxuKXx8KFoobCxpLHBuKSxuLmludGVyc2VjdHNCb3gocG4pJiZ2aShsLHQsZSxzLG4pKSl9fWNvbnN0IHluPW5ldyBudCxQaT1uZXcgbHQsTXM9bmV3IGx0LENsPW5ldyBBLEZsPW5ldyBBLFJsPW5ldyBBLEJsPW5ldyBBO2Z1bmN0aW9uIElsKHIsdCxlLHM9e30sbj17fSxpPTAsbz0xLzApe3QuYm91bmRpbmdCb3h8fHQuY29tcHV0ZUJvdW5kaW5nQm94KCksUGkuc2V0KHQuYm91bmRpbmdCb3gubWluLHQuYm91bmRpbmdCb3gubWF4LGUpLFBpLm5lZWRzVXBkYXRlPSEwO2NvbnN0IGE9ci5nZW9tZXRyeSxjPWEuYXR0cmlidXRlcy5wb3NpdGlvbix1PWEuaW5kZXgsaD10LmF0dHJpYnV0ZXMucG9zaXRpb24sbD10LmluZGV4LGQ9YnQuZ2V0UHJpbWl0aXZlKCksZj1idC5nZXRQcmltaXRpdmUoKTtsZXQgcD1DbCxtPUZsLGc9bnVsbCx5PW51bGw7biYmKGc9UmwseT1CbCk7bGV0IFQ9MS8wLHc9bnVsbCxNPW51bGw7cmV0dXJuIHluLmNvcHkoZSkuaW52ZXJ0KCksTXMubWF0cml4LmNvcHkoeW4pLHIuc2hhcGVjYXN0KHtib3VuZHNUcmF2ZXJzZU9yZGVyOk49PlBpLmRpc3RhbmNlVG9Cb3goTiksaW50ZXJzZWN0c0JvdW5kczooTixfLFMpPT5TPFQmJlM8bz8oXyYmKE1zLm1pbi5jb3B5KE4ubWluKSxNcy5tYXguY29weShOLm1heCksTXMubmVlZHNVcGRhdGU9ITApLCEwKTohMSxpbnRlcnNlY3RzUmFuZ2U6KE4sXyk9PntpZih0LmJvdW5kc1RyZWUpe2NvbnN0IFM9dC5ib3VuZHNUcmVlO3JldHVybiBTLnNoYXBlY2FzdCh7Ym91bmRzVHJhdmVyc2VPcmRlcjpFPT5Ncy5kaXN0YW5jZVRvQm94KEUpLGludGVyc2VjdHNCb3VuZHM6KEUsRixSKT0+UjxUJiZSPG8saW50ZXJzZWN0c1JhbmdlOihFLEYpPT57Zm9yKGxldCBSPUUsST1FK0Y7UjxJO1IrKyl7Y29uc3QgQj1TLnJlc29sdmVUcmlhbmdsZUluZGV4KFIpO3N0KGYsMypCLGwsaCksZi5hLmFwcGx5TWF0cml4NChlKSxmLmIuYXBwbHlNYXRyaXg0KGUpLGYuYy5hcHBseU1hdHJpeDQoZSksZi5uZWVkc1VwZGF0ZT0hMDtmb3IobGV0IFA9TixMPU4rXztQPEw7UCsrKXtjb25zdCBWPXIucmVzb2x2ZVRyaWFuZ2xlSW5kZXgoUCk7c3QoZCwzKlYsdSxjKSxkLm5lZWRzVXBkYXRlPSEwO2NvbnN0IEc9ZC5kaXN0YW5jZVRvVHJpYW5nbGUoZixwLGcpO2lmKEc8VCYmKG0uY29weShwKSx5JiZ5LmNvcHkoZyksVD1HLHc9UCxNPVIpLEc8aSlyZXR1cm4hMH19fX0pfWVsc2V7Y29uc3QgUz1EZSh0KTtmb3IobGV0IEU9MCxGPVM7RTxGO0UrKyl7c3QoZiwzKkUsbCxoKSxmLmEuYXBwbHlNYXRyaXg0KGUpLGYuYi5hcHBseU1hdHJpeDQoZSksZi5jLmFwcGx5TWF0cml4NChlKSxmLm5lZWRzVXBkYXRlPSEwO2ZvcihsZXQgUj1OLEk9TitfO1I8STtSKyspe2NvbnN0IEI9ci5yZXNvbHZlVHJpYW5nbGVJbmRleChSKTtzdChkLDMqQix1LGMpLGQubmVlZHNVcGRhdGU9ITA7Y29uc3QgUD1kLmRpc3RhbmNlVG9UcmlhbmdsZShmLHAsZyk7aWYoUDxUJiYobS5jb3B5KHApLHkmJnkuY29weShnKSxUPVAsdz1SLE09RSksUDxpKXJldHVybiEwfX19fX0pLGJ0LnJlbGVhc2VQcmltaXRpdmUoZCksYnQucmVsZWFzZVByaW1pdGl2ZShmKSxUPT09MS8wP251bGw6KHMucG9pbnQ/cy5wb2ludC5jb3B5KG0pOnMucG9pbnQ9bS5jbG9uZSgpLHMuZGlzdGFuY2U9VCxzLmZhY2VJbmRleD13LG4mJihuLnBvaW50P24ucG9pbnQuY29weSh5KTpuLnBvaW50PXkuY2xvbmUoKSxuLnBvaW50LmFwcGx5TWF0cml4NCh5biksbS5hcHBseU1hdHJpeDQoeW4pLG4uZGlzdGFuY2U9bS5zdWIobi5wb2ludCkubGVuZ3RoKCksbi5mYWNlSW5kZXg9TSkscyl9ZnVuY3Rpb24gdmwoKXtyZXR1cm4gdHlwZW9mIFNoYXJlZEFycmF5QnVmZmVyPCJ1In1jb25zdCBTcz1uZXcgWC5jb25zdHJ1Y3Rvcixnbj1uZXcgWC5jb25zdHJ1Y3RvcixoZT1uZXcgX2koKCk9Pm5ldyBodCksR2U9bmV3IGh0LFdlPW5ldyBodCxMaT1uZXcgaHQsT2k9bmV3IGh0O2xldCBEaT0hMTtmdW5jdGlvbiBQbChyLHQsZSxzKXtpZihEaSl0aHJvdyBuZXcgRXJyb3IoIk1lc2hCVkg6IFJlY3Vyc2l2ZSBjYWxscyB0byBidmhjYXN0IG5vdCBzdXBwb3J0ZWQuIik7RGk9ITA7Y29uc3Qgbj1yLl9yb290cyxpPXQuX3Jvb3RzO2xldCBvLGE9MCxjPTA7Y29uc3QgdT1uZXcgbnQoKS5jb3B5KGUpLmludmVydCgpO2ZvcihsZXQgaD0wLGw9bi5sZW5ndGg7aDxsO2grKyl7U3Muc2V0QnVmZmVyKG5baF0pLGM9MDtjb25zdCBkPWhlLmdldFByaW1pdGl2ZSgpO1ooMCxTcy5mbG9hdDMyQXJyYXksZCksZC5hcHBseU1hdHJpeDQodSk7Zm9yKGxldCBmPTAscD1pLmxlbmd0aDtmPHAmJihnbi5zZXRCdWZmZXIoaVtmXSksbz1PdCgwLDAsZSx1LHMsYSxjLDAsMCxkKSxnbi5jbGVhckJ1ZmZlcigpLGMrPWlbZl0ubGVuZ3RoLCFvKTtmKyspO2lmKGhlLnJlbGVhc2VQcmltaXRpdmUoZCksU3MuY2xlYXJCdWZmZXIoKSxhKz1uW2hdLmxlbmd0aCxvKWJyZWFrfXJldHVybiBEaT0hMSxvfWZ1bmN0aW9uIE90KHIsdCxlLHMsbixpPTAsbz0wLGE9MCxjPTAsdT1udWxsLGg9ITEpe2xldCBsLGQ7aD8obD1nbixkPVNzKToobD1TcyxkPWduKTtjb25zdCBmPWwuZmxvYXQzMkFycmF5LHA9bC51aW50MzJBcnJheSxtPWwudWludDE2QXJyYXksZz1kLmZsb2F0MzJBcnJheSx5PWQudWludDMyQXJyYXksVD1kLnVpbnQxNkFycmF5LHc9cioyLE09dCoyLE49cHQodyxtKSxfPXB0KE0sVCk7bGV0IFM9ITE7aWYoXyYmTiloP1M9bihUdCh0LHkpLFN0KHQqMixUKSxUdChyLHApLFN0KHIqMixtKSxjLG8rdCxhLGkrcik6Uz1uKFR0KHIscCksU3QocioyLG0pLFR0KHQseSksU3QodCoyLFQpLGEsaStyLGMsbyt0KTtlbHNlIGlmKF8pe2NvbnN0IEU9aGUuZ2V0UHJpbWl0aXZlKCk7Wih0LGcsRSksRS5hcHBseU1hdHJpeDQoZSk7Y29uc3QgRj1fdChyKSxSPXp0KHIscCk7WihGLGYsR2UpLFooUixmLFdlKTtjb25zdCBJPUUuaW50ZXJzZWN0c0JveChHZSksQj1FLmludGVyc2VjdHNCb3goV2UpO1M9SSYmT3QodCxGLHMsZSxuLG8saSxjLGErMSxFLCFoKXx8QiYmT3QodCxSLHMsZSxuLG8saSxjLGErMSxFLCFoKSxoZS5yZWxlYXNlUHJpbWl0aXZlKEUpfWVsc2V7Y29uc3QgRT1fdCh0KSxGPXp0KHQseSk7WihFLGcsTGkpLFooRixnLE9pKTtjb25zdCBSPXUuaW50ZXJzZWN0c0JveChMaSksST11LmludGVyc2VjdHNCb3goT2kpO2lmKFImJkkpUz1PdChyLEUsZSxzLG4saSxvLGEsYysxLHUsaCl8fE90KHIsRixlLHMsbixpLG8sYSxjKzEsdSxoKTtlbHNlIGlmKFIpaWYoTilTPU90KHIsRSxlLHMsbixpLG8sYSxjKzEsdSxoKTtlbHNle2NvbnN0IEI9aGUuZ2V0UHJpbWl0aXZlKCk7Qi5jb3B5KExpKS5hcHBseU1hdHJpeDQoZSk7Y29uc3QgUD1fdChyKSxMPXp0KHIscCk7WihQLGYsR2UpLFooTCxmLFdlKTtjb25zdCBWPUIuaW50ZXJzZWN0c0JveChHZSksRz1CLmludGVyc2VjdHNCb3goV2UpO1M9ViYmT3QoRSxQLHMsZSxuLG8saSxjLGErMSxCLCFoKXx8RyYmT3QoRSxMLHMsZSxuLG8saSxjLGErMSxCLCFoKSxoZS5yZWxlYXNlUHJpbWl0aXZlKEIpfWVsc2UgaWYoSSlpZihOKVM9T3QocixGLGUscyxuLGksbyxhLGMrMSx1LGgpO2Vsc2V7Y29uc3QgQj1oZS5nZXRQcmltaXRpdmUoKTtCLmNvcHkoT2kpLmFwcGx5TWF0cml4NChlKTtjb25zdCBQPV90KHIpLEw9enQocixwKTtaKFAsZixHZSksWihMLGYsV2UpO2NvbnN0IFY9Qi5pbnRlcnNlY3RzQm94KEdlKSxHPUIuaW50ZXJzZWN0c0JveChXZSk7Uz1WJiZPdChGLFAscyxlLG4sbyxpLGMsYSsxLEIsIWgpfHxHJiZPdChGLEwscyxlLG4sbyxpLGMsYSsxLEIsIWgpLGhlLnJlbGVhc2VQcmltaXRpdmUoQil9fXJldHVybiBTfWNvbnN0IHhuPW5ldyBsdCxibz1uZXcgaHQsTGw9e3N0cmF0ZWd5OnVvLG1heERlcHRoOjQwLG1heExlYWZUcmlzOjEwLHVzZVNoYXJlZEFycmF5QnVmZmVyOiExLHNldEJvdW5kaW5nQm94OiEwLG9uUHJvZ3Jlc3M6bnVsbCxpbmRpcmVjdDohMSx2ZXJib3NlOiEwLHJhbmdlOm51bGx9O2NsYXNzIFRue3N0YXRpYyBzZXJpYWxpemUodCxlPXt9KXtlPXtjbG9uZUJ1ZmZlcnM6ITAsLi4uZX07Y29uc3Qgcz10Lmdlb21ldHJ5LG49dC5fcm9vdHMsaT10Ll9pbmRpcmVjdEJ1ZmZlcixvPXMuZ2V0SW5kZXgoKTtsZXQgYTtyZXR1cm4gZS5jbG9uZUJ1ZmZlcnM/YT17cm9vdHM6bi5tYXAoYz0+Yy5zbGljZSgpKSxpbmRleDpvP28uYXJyYXkuc2xpY2UoKTpudWxsLGluZGlyZWN0QnVmZmVyOmk/aS5zbGljZSgpOm51bGx9OmE9e3Jvb3RzOm4saW5kZXg6bz9vLmFycmF5Om51bGwsaW5kaXJlY3RCdWZmZXI6aX0sYX1zdGF0aWMgZGVzZXJpYWxpemUodCxlLHM9e30pe3M9e3NldEluZGV4OiEwLGluZGlyZWN0OiEhdC5pbmRpcmVjdEJ1ZmZlciwuLi5zfTtjb25zdHtpbmRleDpuLHJvb3RzOmksaW5kaXJlY3RCdWZmZXI6b309dCxhPW5ldyBUbihlLHsuLi5zLFt4aV06ITB9KTtpZihhLl9yb290cz1pLGEuX2luZGlyZWN0QnVmZmVyPW98fG51bGwscy5zZXRJbmRleCl7Y29uc3QgYz1lLmdldEluZGV4KCk7aWYoYz09PW51bGwpe2NvbnN0IHU9bmV3IHZ0KHQuaW5kZXgsMSwhMSk7ZS5zZXRJbmRleCh1KX1lbHNlIGMuYXJyYXkhPT1uJiYoYy5hcnJheS5zZXQobiksYy5uZWVkc1VwZGF0ZT0hMCl9cmV0dXJuIGF9Z2V0IGluZGlyZWN0KCl7cmV0dXJuISF0aGlzLl9pbmRpcmVjdEJ1ZmZlcn1jb25zdHJ1Y3Rvcih0LGU9e30pe2lmKHQuaXNCdWZmZXJHZW9tZXRyeSl7aWYodC5pbmRleCYmdC5pbmRleC5pc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlKXRocm93IG5ldyBFcnJvcigiTWVzaEJWSDogSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgaXMgbm90IHN1cHBvcnRlZCBmb3IgdGhlIGluZGV4IGF0dHJpYnV0ZS4iKX1lbHNlIHRocm93IG5ldyBFcnJvcigiTWVzaEJWSDogT25seSBCdWZmZXJHZW9tZXRyaWVzIGFyZSBzdXBwb3J0ZWQuIik7aWYoZT1PYmplY3QuYXNzaWduKHsuLi5MbCxbeGldOiExfSxlKSxlLnVzZVNoYXJlZEFycmF5QnVmZmVyJiYhdmwoKSl0aHJvdyBuZXcgRXJyb3IoIk1lc2hCVkg6IFNoYXJlZEFycmF5QnVmZmVyIGlzIG5vdCBhdmFpbGFibGUuIik7dGhpcy5nZW9tZXRyeT10LHRoaXMuX3Jvb3RzPW51bGwsdGhpcy5faW5kaXJlY3RCdWZmZXI9bnVsbCxlW3hpXXx8KGp1KHRoaXMsZSksIXQuYm91bmRpbmdCb3gmJmUuc2V0Qm91bmRpbmdCb3gmJih0LmJvdW5kaW5nQm94PXRoaXMuZ2V0Qm91bmRpbmdCb3gobmV3IGh0KSkpLHRoaXMucmVzb2x2ZVRyaWFuZ2xlSW5kZXg9ZS5pbmRpcmVjdD9zPT50aGlzLl9pbmRpcmVjdEJ1ZmZlcltzXTpzPT5zfXJlZml0KHQ9bnVsbCl7cmV0dXJuKHRoaXMuaW5kaXJlY3Q/U2w6bGwpKHRoaXMsdCl9dHJhdmVyc2UodCxlPTApe2NvbnN0IHM9dGhpcy5fcm9vdHNbZV0sbj1uZXcgVWludDMyQXJyYXkocyksaT1uZXcgVWludDE2QXJyYXkocyk7bygwKTtmdW5jdGlvbiBvKGEsYz0wKXtjb25zdCB1PWEqMixoPWlbdSsxNV09PT1lbjtpZihoKXtjb25zdCBsPW5bYSs2XSxkPWlbdSsxNF07dChjLGgsbmV3IEZsb2F0MzJBcnJheShzLGEqNCw2KSxsLGQpfWVsc2V7Y29uc3QgbD1hK21zLzQsZD1uW2ErNl0sZj1uW2ErN107dChjLGgsbmV3IEZsb2F0MzJBcnJheShzLGEqNCw2KSxmKXx8KG8obCxjKzEpLG8oZCxjKzEpKX19fXJheWNhc3QodCxlPVZpLHM9MCxuPTEvMCl7Y29uc3QgaT10aGlzLl9yb290cyxvPXRoaXMuZ2VvbWV0cnksYT1bXSxjPWUuaXNNYXRlcmlhbCx1PUFycmF5LmlzQXJyYXkoZSksaD1vLmdyb3VwcyxsPWM/ZS5zaWRlOmUsZD10aGlzLmluZGlyZWN0P19sOm1sO2ZvcihsZXQgZj0wLHA9aS5sZW5ndGg7ZjxwO2YrKyl7Y29uc3QgbT11P2VbaFtmXS5tYXRlcmlhbEluZGV4XS5zaWRlOmwsZz1hLmxlbmd0aDtpZihkKHRoaXMsZixtLHQsYSxzLG4pLHUpe2NvbnN0IHk9aFtmXS5tYXRlcmlhbEluZGV4O2ZvcihsZXQgVD1nLHc9YS5sZW5ndGg7VDx3O1QrKylhW1RdLmZhY2UubWF0ZXJpYWxJbmRleD15fX1yZXR1cm4gYX1yYXljYXN0Rmlyc3QodCxlPVZpLHM9MCxuPTEvMCl7Y29uc3QgaT10aGlzLl9yb290cyxvPXRoaXMuZ2VvbWV0cnksYT1lLmlzTWF0ZXJpYWwsYz1BcnJheS5pc0FycmF5KGUpO2xldCB1PW51bGw7Y29uc3QgaD1vLmdyb3VwcyxsPWE/ZS5zaWRlOmUsZD10aGlzLmluZGlyZWN0P2JsOmdsO2ZvcihsZXQgZj0wLHA9aS5sZW5ndGg7ZjxwO2YrKyl7Y29uc3QgbT1jP2VbaFtmXS5tYXRlcmlhbEluZGV4XS5zaWRlOmwsZz1kKHRoaXMsZixtLHQscyxuKTtnIT1udWxsJiYodT09bnVsbHx8Zy5kaXN0YW5jZTx1LmRpc3RhbmNlKSYmKHU9ZyxjJiYoZy5mYWNlLm1hdGVyaWFsSW5kZXg9aFtmXS5tYXRlcmlhbEluZGV4KSl9cmV0dXJuIHV9aW50ZXJzZWN0c0dlb21ldHJ5KHQsZSl7bGV0IHM9ITE7Y29uc3Qgbj10aGlzLl9yb290cyxpPXRoaXMuaW5kaXJlY3Q/RWw6eGw7Zm9yKGxldCBvPTAsYT1uLmxlbmd0aDtvPGEmJihzPWkodGhpcyxvLHQsZSksIXMpO28rKyk7cmV0dXJuIHN9c2hhcGVjYXN0KHQpe2NvbnN0IGU9YnQuZ2V0UHJpbWl0aXZlKCkscz10aGlzLmluZGlyZWN0P3BsOnVsO2xldHtib3VuZHNUcmF2ZXJzZU9yZGVyOm4saW50ZXJzZWN0c0JvdW5kczppLGludGVyc2VjdHNSYW5nZTpvLGludGVyc2VjdHNUcmlhbmdsZTphfT10O2lmKG8mJmEpe2NvbnN0IGw9bztvPShkLGYscCxtLGcpPT5sKGQsZixwLG0sZyk/ITA6cyhkLGYsdGhpcyxhLHAsbSxlKX1lbHNlIG98fChhP289KGwsZCxmLHApPT5zKGwsZCx0aGlzLGEsZixwLGUpOm89KGwsZCxmKT0+Zik7bGV0IGM9ITEsdT0wO2NvbnN0IGg9dGhpcy5fcm9vdHM7Zm9yKGxldCBsPTAsZD1oLmxlbmd0aDtsPGQ7bCsrKXtjb25zdCBmPWhbbF07aWYoYz1ubCh0aGlzLGwsaSxvLG4sdSksYylicmVhazt1Kz1mLmJ5dGVMZW5ndGh9cmV0dXJuIGJ0LnJlbGVhc2VQcmltaXRpdmUoZSksY31idmhjYXN0KHQsZSxzKXtsZXR7aW50ZXJzZWN0c1JhbmdlczpuLGludGVyc2VjdHNUcmlhbmdsZXM6aX09cztjb25zdCBvPWJ0LmdldFByaW1pdGl2ZSgpLGE9dGhpcy5nZW9tZXRyeS5pbmRleCxjPXRoaXMuZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbix1PXRoaXMuaW5kaXJlY3Q/cD0+e2NvbnN0IG09dGhpcy5yZXNvbHZlVHJpYW5nbGVJbmRleChwKTtzdChvLG0qMyxhLGMpfTpwPT57c3QobyxwKjMsYSxjKX0saD1idC5nZXRQcmltaXRpdmUoKSxsPXQuZ2VvbWV0cnkuaW5kZXgsZD10Lmdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb24sZj10LmluZGlyZWN0P3A9Pntjb25zdCBtPXQucmVzb2x2ZVRyaWFuZ2xlSW5kZXgocCk7c3QoaCxtKjMsbCxkKX06cD0+e3N0KGgscCozLGwsZCl9O2lmKGkpe2NvbnN0IHA9KG0sZyx5LFQsdyxNLE4sXyk9Pntmb3IobGV0IFM9eSxFPXkrVDtTPEU7UysrKXtmKFMpLGguYS5hcHBseU1hdHJpeDQoZSksaC5iLmFwcGx5TWF0cml4NChlKSxoLmMuYXBwbHlNYXRyaXg0KGUpLGgubmVlZHNVcGRhdGU9ITA7Zm9yKGxldCBGPW0sUj1tK2c7RjxSO0YrKylpZih1KEYpLG8ubmVlZHNVcGRhdGU9ITAsaShvLGgsRixTLHcsTSxOLF8pKXJldHVybiEwfXJldHVybiExfTtpZihuKXtjb25zdCBtPW47bj1mdW5jdGlvbihnLHksVCx3LE0sTixfLFMpe3JldHVybiBtKGcseSxULHcsTSxOLF8sUyk/ITA6cChnLHksVCx3LE0sTixfLFMpfX1lbHNlIG49cH1yZXR1cm4gUGwodGhpcyx0LGUsbil9aW50ZXJzZWN0c0JveCh0LGUpe3JldHVybiB4bi5zZXQodC5taW4sdC5tYXgsZSkseG4ubmVlZHNVcGRhdGU9ITAsdGhpcy5zaGFwZWNhc3Qoe2ludGVyc2VjdHNCb3VuZHM6cz0+eG4uaW50ZXJzZWN0c0JveChzKSxpbnRlcnNlY3RzVHJpYW5nbGU6cz0+eG4uaW50ZXJzZWN0c1RyaWFuZ2xlKHMpfSl9aW50ZXJzZWN0c1NwaGVyZSh0KXtyZXR1cm4gdGhpcy5zaGFwZWNhc3Qoe2ludGVyc2VjdHNCb3VuZHM6ZT0+dC5pbnRlcnNlY3RzQm94KGUpLGludGVyc2VjdHNUcmlhbmdsZTplPT5lLmludGVyc2VjdHNTcGhlcmUodCl9KX1jbG9zZXN0UG9pbnRUb0dlb21ldHJ5KHQsZSxzPXt9LG49e30saT0wLG89MS8wKXtyZXR1cm4odGhpcy5pbmRpcmVjdD9JbDpNbCkodGhpcyx0LGUscyxuLGksbyl9Y2xvc2VzdFBvaW50VG9Qb2ludCh0LGU9e30scz0wLG49MS8wKXtyZXR1cm4gaWwodGhpcyx0LGUscyxuKX1nZXRCb3VuZGluZ0JveCh0KXtyZXR1cm4gdC5tYWtlRW1wdHkoKSx0aGlzLl9yb290cy5mb3JFYWNoKHM9PntaKDAsbmV3IEZsb2F0MzJBcnJheShzKSxibyksdC51bmlvbihibyl9KSx0fX1vbm1lc3NhZ2U9KHtkYXRhOnJ9KT0+e2xldCB0PXBlcmZvcm1hbmNlLm5vdygpO2Z1bmN0aW9uIGUobyl7bz1NYXRoLm1pbihvLDEpO2NvbnN0IGE9cGVyZm9ybWFuY2Uubm93KCk7YS10Pj0xMCYmbyE9PTEmJihwb3N0TWVzc2FnZSh7ZXJyb3I6bnVsbCxzZXJpYWxpemVkOm51bGwscG9zaXRpb246bnVsbCxwcm9ncmVzczpvfSksdD1hKX1jb25zdHtpbmRleDpzLHBvc2l0aW9uOm4sb3B0aW9uczppfT1yO3RyeXtjb25zdCBvPW5ldyBHbjtpZihvLnNldEF0dHJpYnV0ZSgicG9zaXRpb24iLG5ldyB2dChuLDMsITEpKSxzJiZvLnNldEluZGV4KG5ldyB2dChzLDEsITEpKSxpLmluY2x1ZGVkUHJvZ3Jlc3NDYWxsYmFjayYmKGkub25Qcm9ncmVzcz1lKSxpLmdyb3Vwcyl7Y29uc3QgaD1pLmdyb3Vwcztmb3IoY29uc3QgbCBpbiBoKXtjb25zdCBkPWhbbF07by5hZGRHcm91cChkLnN0YXJ0LGQuY291bnQsZC5tYXRlcmlhbEluZGV4KX19Y29uc3QgYT1uZXcgVG4obyxpKSxjPVRuLnNlcmlhbGl6ZShhLHtjb3B5SW5kZXhCdWZmZXI6ITF9KTtsZXQgdT1bbi5idWZmZXIsLi4uYy5yb290c107Yy5pbmRleCYmdS5wdXNoKGMuaW5kZXguYnVmZmVyKSx1PXUuZmlsdGVyKGg9PnR5cGVvZiBTaGFyZWRBcnJheUJ1ZmZlcj4idSJ8fCEoaCBpbnN0YW5jZW9mIFNoYXJlZEFycmF5QnVmZmVyKSksYS5faW5kaXJlY3RCdWZmZXImJnUucHVzaChjLmluZGlyZWN0QnVmZmVyLmJ1ZmZlcikscG9zdE1lc3NhZ2Uoe2Vycm9yOm51bGwsc2VyaWFsaXplZDpjLHBvc2l0aW9uOm4scHJvZ3Jlc3M6MX0sdSl9Y2F0Y2gobyl7cG9zdE1lc3NhZ2Uoe2Vycm9yOm8sc2VyaWFsaXplZDpudWxsLHBvc2l0aW9uOm51bGwscHJvZ3Jlc3M6MX0pfX19KSgpOwo=",Ole=typeof window<"u"&&window.Blob&&new Blob([atob(Ule)],{type:"text/javascript;charset=utf-8"});function EWe(){let n;try{if(n=Ole&&(window.URL||window.webkitURL).createObjectURL(Ole),!n)throw"";return new Worker(n)}catch{return new Worker("data:application/javascript;base64,"+Ule)}finally{n&&(window.URL||window.webkitURL).revokeObjectURL(n)}}class RWe extends TWe{constructor(){super(new EWe),this.name="GenerateMeshBVHWorker"}runTask(e,i,s={}){return new Promise((r,o)=>{if(i.getAttribute("position").isInterleavedBufferAttribute||i.index&&i.index.isInterleavedBufferAttribute)throw new Error("GenerateMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.");e.onerror=h=>{o(new Error(`GenerateMeshBVHWorker: ${h.message}`))},e.onmessage=h=>{const{data:d}=h;if(d.error)o(new Error(d.error)),e.onmessage=null;else if(d.serialized){const{serialized:u,position:p}=d,g=qg.deserialize(u,i,{setIndex:!1}),f=Object.assign({setBoundingBox:!0},s);if(i.attributes.position.array=p,u.index)if(i.index)i.index.array=u.index;else{const A=new ct(u.index,1,!1);i.setIndex(A)}f.setBoundingBox&&(i.boundingBox=g.getBoundingBox(new gi)),s.onProgress&&s.onProgress(d.progress),r(g),e.onmessage=null}else s.onProgress&&s.onProgress(d.progress)};const a=i.index?i.index.array:null,l=i.attributes.position.array,c=[l];a&&c.push(a),e.postMessage({index:a,position:l,options:{...s,onProgress:null,includedProgressCallback:!!s.onProgress,groups:[...i.groups]}},c.map(h=>h.buffer).filter(h=>typeof SharedArrayBuffer>"u"||!(h instanceof SharedArrayBuffer)))})}}const LWe=Object.freeze(Object.defineProperty({__proto__:null,GenerateMeshBVHWorker:RWe},Symbol.toStringTag,{value:"Module"})),$c={node:"node",material:"material",camera:"camera",light:"light"},GA="KHR_animation_pointer",BWe={CUBICSPLINE:void 0,LINEAR:xu,STEP:qp},Zle=xi.findNode;let Wle=!1;class kWe{constructor(e){this.parser=e,this.name=GA,this.animationPointerResolver=null}setAnimationPointerResolver(e){return this.animationPointerResolver=e,this}_patchPropertyBindingFindNode(){Wle||(Wle=!0,xi.findNode=function(e,i){if(i.startsWith(".materials.")){const s=i.substring(11).substring(i.indexOf(".")),r=s.indexOf("."),o=r<0?s:s.substring(0,r);let a=null;return e.traverse(l=>{a!==null||l.type!=="Mesh"&&l.type!=="SkinnedMesh"||l.material&&(l.material.uuid===o||l.material.name===o)&&(a=l.material,a!==null&&(s.endsWith(".map")?a=a.map:s.endsWith(".emissiveMap")&&(a=a.emissiveMap)))}),a}else if(i.startsWith(".nodes.")||i.startsWith(".lights.")||i.startsWith(".cameras.")){const s=i.split(".");let r;for(let o=1;o<s.length;o++){const a=s[o];if(a.length==36)r=e.getObjectByProperty("uuid",a);else if(r&&r[a]){const l=Number.parseInt(a);let c=a;l>=0&&(c=l),r=r[c]}else{const l=e.getObjectByName(a);l&&(r=l)}}if(!r){const o=Zle(e,s[2]);return o||console.warn(GA+": Property binding not found",i,e,e.name,s),o}return r}return Zle(e,i)})}loadAnimationTargetFromChannel(e){const i=e.target,s=i.node!==void 0?i.node:i.id;return this.parser.getDependency("node",s)}loadAnimationTargetFromChannelWithAnimationPointer(e){this._havePatchedPropertyBindings||this._patchPropertyBindingFindNode();const i=e.target,s=i.extensions&&i.extensions[GA]&&i.path&&i.path==="pointer";if(!s)return null;let r,o=$c.node,a;if(s){const c=i.extensions[GA];let h=c.pointer;if(!h){console.warn("Invalid path",c,i);return}if(h.startsWith("/materials/")?o=$c.material:h.startsWith("/extensions/KHR_lights_punctual/lights/")?o=$c.light:h.startsWith("/cameras/")&&(o=$c.camera),a=this._tryResolveTargetId(h,o),a===null||isNaN(a)){console.warn("Failed resolving animation node id: "+a,h);return}switch(o){case $c.material:const u=("/materials/"+a.toString()+"/").length,p=h.substring(0,u);switch(r=h.substring(u),r){case"pbrMetallicRoughness/baseColorFactor":r="color";break;case"pbrMetallicRoughness/roughnessFactor":r="roughness";break;case"pbrMetallicRoughness/metallicFactor":r="metalness";break;case"emissiveFactor":r="emissive";break;case"alphaCutoff":r="alphaTest";break;case"occlusionTexture/strength":r="aoMapIntensity";break;case"normalTexture/scale":r="normalScale";break;case"pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale":r="map/repeat";break;case"pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset":r="map/offset";break;case"emissiveTexture/extensions/KHR_texture_transform/scale":r="emissiveMap/repeat";break;case"emissiveTexture/extensions/KHR_texture_transform/offset":r="emissiveMap/offset";break;case"extensions/KHR_materials_emissive_strength/emissiveStrength":r="emissiveIntensity";break;case"extensions/KHR_materials_transmission/transmissionFactor":r="transmission";break;case"extensions/KHR_materials_ior/ior":r="ior";break;case"extensions/KHR_materials_volume/thicknessFactor":r="thickness";break;case"extensions/KHR_materials_volume/attenuationColor":r="attenuationColor";break;case"extensions/KHR_materials_volume/attenuationDistance":r="attenuationDistance";break;case"extensions/KHR_materials_iridescence/iridescenceFactor":r="iridescence";break;case"extensions/KHR_materials_iridescence/iridescenceIor":r="iridescenceIOR";break;case"extensions/KHR_materials_iridescence/iridescenceThicknessMinimum":r="iridescenceThicknessRange[0]";break;case"extensions/KHR_materials_iridescence/iridescenceThicknessMaximum":r="iridescenceThicknessRange[1]";break;case"extensions/KHR_materials_clearcoat/clearcoatFactor":r="clearcoat";break;case"extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor":r="clearcoatRoughness";break;case"extensions/KHR_materials_sheen/sheenColorFactor":r="sheenColor";break;case"extensions/KHR_materials_sheen/sheenRoughnessFactor":r="sheenRoughness";break;case"extensions/KHR_materials_specular/specularFactor":r="specularIntensity";break;case"extensions/KHR_materials_specular/specularColorFactor":r="specularColor";break}h=p+r;break;case $c.node:const g=("/nodes/"+a.toString()+"/").length,f=h.substring(0,g);switch(r=h.substring(g),r){case"translation":r="position";break;case"rotation":r="quaternion";break;case"scale":r="scale";break;case"weights":r="morphTargetInfluences";break}h=f+r;break;case $c.light:const A=("/extensions/KHR_lights_punctual/lights/"+a.toString()+"/").length;switch(r=h.substring(A),r){case"color":break;case"intensity":break;case"spot/innerConeAngle":r="penumbra";break;case"spot/outerConeAngle":r="angle";break;case"range":r="distance";break}h="/lights/"+a.toString()+"/"+r;break;case $c.camera:const y=("/cameras/"+a.toString()+"/").length,b=h.substring(0,y);switch(r=h.substring(y),r){case"perspective/yfov":r="fov";break;case"perspective/znear":case"orthographic/znear":r="near";break;case"perspective/zfar":case"orthographic/zfar":r="far";break;case"perspective/aspect":r="aspect";break;case"orthographic/xmag":r="zoom";break;case"orthographic/ymag":r="zoom";break}h=b+r;break}const d=this.animationPointerResolver;d&&d.resolvePath&&(h=d.resolvePath(h)),i.extensions[GA].pointer=h}if(a===null||isNaN(a)){console.warn("Failed resolving animation node id: "+a,i);return}let l;return o===$c.node?l=this.parser.getDependency("node",a):o===$c.material?l=this.parser.getDependency("material",a):o===$c.light?l=this.parser.getDependency("light",a):o===$c.camera?l=this.parser.getDependency("camera",a):console.error("Unhandled type",o),l}createAnimationTracksWithAnimationPointer(e,i,s,r,o){if(!(o.extensions&&o.extensions[GA]&&o.path&&o.path==="pointer"))return null;let a=o.extensions[GA].pointer;if(!a)return null;const l=[];a=a.replaceAll("/",".");const c=a.split(".");var h=e.name!==void 0&&e.name!==null?e.name:e.uuid;if(c[2]=h,c[3]==="morphTargetInfluences"&&e.type==="Group"){for(const u of e.children)u instanceof Ka&&u.morphTargetInfluences&&(c[3]=u.name,c[4]="morphTargetInfluences",d(this.parser));return l}d(this.parser);function d(u){a=c.join(".");let p;switch(s.itemSize){case 1:p=Ru;break;case 2:case 3:p=ld;break;case 4:a.endsWith(".quaternion")?p=ad:p=mT;break}const g=r.interpolation!==void 0?BWe[r.interpolation]:xu;let f=u._getArrayFromAccessor(s);a.endsWith(".fov")&&(f=f.map(y=>y/Math.PI*180));const A=new p(a,i.array,f,g);if(g==="CUBICSPLINE"&&u._createCubicSplineTrackInterpolant(A),l.push(A),a&&s.itemSize===4&&a.startsWith(".materials.")&&a.endsWith(".color")){const y=new Float32Array(f.length/4);for(let v=0,x=f.length/4;v<x;v+=1)y[v]=f[v*4+3];const b=new p(a.replace(".color",".opacity"),i.array,y,g);g==="CUBICSPLINE"&&u._createCubicSplineTrackInterpolant(A),l.push(b)}}return l}_tryResolveTargetId(e,i){let s="";return i==="node"?s=e.substring(7):i==="material"?s=e.substring(11):i==="light"?s=e.substring(39):i==="camera"&&(s=e.substring(9)),s=s.substring(0,s.indexOf("/")),Number.parseInt(s)}loadAnimation(e){const i=this,s=this.parser.json,r=this.parser,o=s.animations[e],a=o.name?o.name:"animation_"+e,l=[],c=[],h=[],d=[],u=[];for(let p=0,g=o.channels.length;p<g;p++){const f=o.channels[p],A=o.samplers[f.sampler],y=f.target,b=o.parameters!==void 0?o.parameters[A.input]:A.input,v=o.parameters!==void 0?o.parameters[A.output]:A.output;let x=i.loadAnimationTargetFromChannelWithAnimationPointer(f);x||(x=i.loadAnimationTargetFromChannel(f)),l.push(x),c.push(r.getDependency("accessor",b)),h.push(r.getDependency("accessor",v)),d.push(A),u.push(y)}return Promise.all([Promise.all(l),Promise.all(c),Promise.all(h),Promise.all(d),Promise.all(u)]).then(function(p){const g=p[0],f=p[1],A=p[2],y=p[3],b=p[4],v=[];for(let x=0,w=g.length;x<w;x++){const C=g[x],S=f[x],_=A[x],I=y[x],B=b[x];if(C===void 0)continue;C.updateMatrix&&(C.updateMatrix(),C.matrixAutoUpdate=!0);let M=i.createAnimationTracksWithAnimationPointer(C,S,_,I,B);if(M||(M=r._createAnimationTracks(C,S,_,I,B)),M)for(let R=0;R<M.length;R++)v.push(M[R])}return new wa(a,void 0,v)})}}const GWe=Object.freeze(Object.defineProperty({__proto__:null,GLTFAnimationPointerExtension:kWe},Symbol.toStringTag,{value:"Module"}));export{IVe as $physicsKey,Wi as ActionBuilder,$F as ActionCollection,Wl as ActionModel,yie as Addressables,KC as AlignmentConstraint,$b as AmbientMode,ra as Animation,U0 as AnimationCurve,JC as AnimationExtension,TL as AnimationTrackHandler,Jb as AnimationUtils,Mo as Animator,lg as AnimatorConditionMode,uc as AnimatorController,eU as AnimatorControllerParameterType,jC as AnimatorStateInfo,uS as Antialiasing,op as Application,V2 as ApplicationEvents,ute as AssetDatabase,Mi as AssetReference,Jg as AudioExtension,mg as AudioListener,vs as AudioSource,cS as AudioTrackHandler,Ag as Avatar,W0 as AvatarBlink_Simple,Av as AvatarEyeLook_Rotation,LU as AvatarLoader,Eo as AvatarMarker,BL as AvatarModel,AS as Avatar_Brain_LookAt,vS as Avatar_MouthShapes,TU as Avatar_MustacheShake,Od as Avatar_POI,hv as Axes,yv as AxesHelper,yD as BUILD_TIME,th as BaseUIComponent,kU as BasicIKConstraint,GL as BehaviorExtension,Kr as BehaviorModel,Oe as Behaviour,N0 as BlobStorage,H0 as BloomEffect,vv as BoxCollider,K0 as BoxGizmo,Oc as BoxHelperComponent,yp as Button,lp as ButtonsFactory,wse as CallDirection,Xd as CallInfo,In as Camera,sS as CameraTargetReachedEvent,Ro as Canvas,wg as CanvasGroup,Ap as CapsuleCollider,Cv as ChangeMaterialOnClick,J0 as ChangeTransformOnClick,eA as CharacterController,vp as CharacterControllerInput,ES as ChromaticAberration,El as CircularBuffer,ug as ClearFlags,Dd as ClipExtrapolation,cl as Collider,bse as Collision,gL as CollisionDetectionMode,_g as ColorAdjustments,iA as ColorBySpeedModule,VS as ColorOverLifetimeModule,Oe as Component,vC as ComponentLifecycleEvents,zee as ConnectionEvents,yse as ContactPoint,Uh as ContactShadows,$t as Context,wGe as ContextArgs,nn as ContextEvent,ji as ContextRegistry,EL as ControlTrackHandler,kg as CustomBranding,Fh as CustomShader,H2 as DefaultReflectionMode,v3 as Deletable,ZS as DeleteBox,Oh as DepthOfField,AB as DeviceFlag,Ft as DeviceUtilities,x3 as DocumentExtension,dl as DragControls,C3 as DragMode,Ep as DropListener,yB as DropListenerAddedEvent,lA as Duplicatable,HS as EffectWrapper,Jd as EmissionModule,_v as EmphasizeOnClick,PF as EngineLoadingView,Gn as EventList,AL as EventListEvent,Fc as EventSystem,xB as EventTrigger,n3 as FieldWithDefault,N2 as FileReference,vie as FileReferenceSerializer,l5e as FileSpawnModel,vre as File_Event,T3 as FixedJoint,E3 as FlyControls,Dv as Fog,_n as FrameEvent,qE as GENERATOR,$ as GameObject,Nt as Gizmos,jS as GltfExport,P3 as GltfExportBox,xA as GltfLoadEvent,eae as GltfLoadEventType,Mg as Gradient,Y0 as Graphic,vL as GraphicRaycaster,Tc as Graphics,Uv as GridHelper,WU as GridLayoutGroup,Pd as GroundProjectedEnv,cp as GroupActionModel,rie as HideFlags,KU as HideOnStart,QS as HingeJoint,ZU as HorizontalLayoutGroup,KBe as HostData,wv as Image,G2 as ImageReference,bie as ImageReferenceSerializer,Tg as InheritVelocityModule,p$ as Input,Dl as InputEventQueue,rs as InputEvents,cA as InputField,RS as InstanceHandle,Lv as InstancingHandler,ih as InstancingUtil,Mte as InstantiateEvent,Zo as InstantiateIdProvider,qh as InstantiateOptions,b3 as Interactable,b_ as InternalScreenshotUtils,SLe as JoinedRoomResponse,B2e as KeyEventArgs,Na as Keyframe,qS as LODGroup,hA as LODModel,_Le as LeftRoomResponse,ul as Light,Zie as LightData,dr as LimitVelocityOverLifetimeModule,RGe as LoadingElementOptions,D3 as LogStats,Rl as LogType,dA as LookAt,O0 as LookAtConstraint,Bo as MainModule,fU as MarkerType,_S as MaskableGraphic,lt as Mathf,Q0 as MeshCollider,kS as MeshRenderer,Vt as MinMaxCurve,Da as MinMaxGradient,Fi as NEEDLE_progressive,rC as NEKeyboardEvent,Ju as NEPointerEvent,sZ as NeedleButtonElement,ji as NeedleEngine,ZO as NeedleEngineHTMLElement,FO as NeedleLoader,$d as NeedleMenu,sR as NeedlePatchesKey,Mne as NeedleUSDZExporter,Z5 as NeedleXRController,Qt as NeedleXRSession,Oee as NeedleXRSync,ote as NeedleXRUtils,TB as NestedGltf,Uee as NetworkConnection,Zd as NetworkedStreamEvents,eM as NetworkedStreams,Zv as Networking,Tte as NewInstanceModel,mn as NoiseModule,Ql as ObjectRaycaster,Ym as ObjectUtils,uA as OffsetConstraint,QE as OneEuroFilter,eD as OneEuroFilterXYZ,Wv as OpenURL,ln as OrbitControls,xv as Outline,Fee as OwnershipEvent,gz as OwnershipModel,Ew as PUBLIC_KEY,vg as Padding,NS as ParticleBurst,DB as ParticleSubEmitter,pr as ParticleSystem,Dg as ParticleSystemBaseBehaviour,Qc as ParticleSystemRenderer,tB as ParticleSystemShapeType,bS as PeerHandle,Xee as PeerNetworking,a2 as Physics,uB as PhysicsExtension,Jr as PhysicsMaterialCombine,o_ as PixelationEffect,$0 as PlayAnimationOnClick,Cg as PlayAudioOnClick,fg as PlayableDirector,Tx as PlayerColor,jl as PlayerState,pse as PlayerStateEvent,gv as PlayerSync,Die as PlayerView,zie as PlayerViewManager,Cx as PointerEventData,ZR as PointerType,qr as PostProcessingEffect,zB as PostProcessingHandler,qv as PostProcessingManager,Mv as PreliminaryAction,IS as PreliminaryTrigger,Gg as PreviewHelper,M0 as PrimitiveType,Ei as Progress,kE as PromiseAllWithErrors,AX as PromiseErrorResult,pn as RGBAColor,k_ as RapierPhysics,XL as RawImage,Rd as RaycastOptions,zU as Rect,aa as RectTransform,Tv as ReflectionProbe,Op as RegisteredAnimationInfo,cu as RemoteSkybox,cv as RenderTexture,sse as RenderTextureSerializer,Gs as Renderer,Oie as RendererData,LS as RendererLightmap,rn as Rigidbody,Qs as RigidbodyConstraints,pi as RoomEvents,tc as RotationBySpeedModule,Wc as RotationOverLifetimeModule,KL as SceneLightSettings,Rr as SceneSwitcher,Fg as ScreenCapture,Lp as ScreenSpaceAmbientOcclusion,Hh as ScreenSpaceAmbientOcclusionN8,Bh as SendQueue,qz as SerializationContext,q0 as SetActiveOnClick,p_ as ShadowCatcher,Ss as ShapeModule,l_ as SharpeningEffect,oS as SignalAsset,mv as SignalReceiver,pv as SignalReceiverEvent,hS as SignalTrackHandler,DU as Size,za as SizeBySpeedModule,Ig as SizeOverLifetimeModule,s3 as SkinnedMeshRenderer,Ug as SmoothFollow,dv as SpatialGrabRaycaster,m_ as SpatialHtml,A_ as SpatialTrigger,hu as SpatialTriggerReceiver,WB as SpectatorCamera,bv as SphereCollider,Lz as SphereIntersection,vse as SphereOverlapResult,qd as Sprite,_p as SpriteData,hl as SpriteRenderer,Eg as SpriteSheet,BPe as StateMachineBehaviour,MU as StreamEndedEvent,xse as StreamReceivedEvent,r_ as SubEmitterSystem,QB as SyncedCamera,Qh as SyncedRoom,Vd as SyncedTransform,YU as TapGestureTrigger,hB as TeleportTarget,RO as TestRunner,BOe as TestSceneUtils,LO as TestSimulateUserData,la as Text,pB as TextBuilder,FS as TextExtension,ko as TextureSheetAnimationModule,du as TiltShiftEffect,Hie as Time,Sg as ToneMappingEffect,aS as TrackHandler,Kl as TrackType,cs as TrailModule,bs as TransformData,AA as TransformGizmo,Yr as TriggerBuilder,sg as TriggerModel,Y as TypeStore,xL as UIRaycastUtils,iS as UIRootComponent,UF as USDDocument,ka as USDObject,_ne as USDWriter,Ms as USDZExporter,Bg as USDZText,mB as USDZUIExtension,rse as UriSerializer,OS as UsageMarker,MLe as UserJoinedOrLeftRoomModel,xh as VERSION,qF as VariantAction,_s as VelocityOverLifetimeModule,OU as VerticalLayoutGroup,Lr as VideoPlayer,ig as ViewDevice,yA as Vignette,TS as VisibilityAction,yg as Voip,qv as Volume,at as VolumeParameter,dS as VolumeProfile,Pke as WaitForFrames,Cie as WaitForPromise,wie as WaitForSeconds,Xp as Watch,v_ as WebARCameraBackground,Mp as WebARSessionRoot,Ns as WebXR,nA as WebXRButtonFactory,ex as WebXRImageTracking,uu as WebXRImageTrackingModel,Bp as WebXRPlaneTracking,$v as WebXRTrackedImage,kp as XRControllerFollow,eu as XRControllerModel,ic as XRControllerMovement,Jl as XRFlag,JB as XRRig,Xa as XRState,Ud as XRStateFlag,NO as __Ignore,Ate as __internalNotifyObjectDestroyed,Du as activeInHierarchyFieldName,m6 as addAttributeChangeCallback,Ul as addComponent,KXe as addCustomExtensionPlugin,nOe as addGltfLoadEventListener,B0 as addNewComponent,nR as addPatch,M2 as apply,gOe as applyHMRChanges,Zte as applyPrototypeExtensions,Ite as beginListenDestroy,Rte as beginListenInstantiate,Y5 as binaryIdentifierCasts,xGe as build_scene_functions,c0 as builtinComponentKeyName,kF as calculateProgress01,w6 as clearBalloonMessages,w6 as clearOverlayMessages,yNe as colorSerializer,Gte as compareAssociation,yL as componentSerializer,G8 as copyTexture,UO as createLoader,Qne as createMotion,rl as debugNet,mC as debugOwner,gw as deepClone,Ah as delay,RE as delayForFrames,b2 as deserializeObject,Ol as destroy,tie as destroyComponentInstance,zn as disposeObjectResources,Wd as disposeStream,Rw as editorGuidKeyName,uO as effectsOrder,l0 as enableSpatialConsole,vNe as euler,SNe as eventListSerializer,VOe as exportAsGLTF,rF as findByGuid,_2 as findObjectOfType,sie as findObjectsOfType,Pz as findResourceUsers,N8 as fitObjectIntoVolume,P0 as foreachComponent,B2 as foreachComponentEnumerator,O_e as forward,f6 as generateQRCode,Ete as generateSeed,Ll as getBoundingBox,S8 as getCameraController,k0 as getComponent,BC as getComponentInChildren,kC as getComponentInParent,LC as getComponents,Hb as getComponentsInChildren,S2 as getComponentsInParent,xne as getFormattedDate,_o as getIconElement,_F as getIconTexture,K1e as getIp,Y1e as getIpAndLocation,Q1e as getIpCloudflare,fh as getLoader,RC as getOrAddComponent,q as getParam,H_e as getParentHierarchyPath,k1e as getPath,vLe as getPeerOptions,Nee as getPeerjsInstance,TBe as getResourceUserCount,I8 as getTempColor,bh as getTempQuaternion,Lt as getTempVector,pw as getUrlParams,P8 as getVisibleInCustomShadowRendering,lD as getWorldDirection,cD as getWorldEuler,ri as getWorldPosition,fn as getWorldQuaternion,ww as getWorldRotation,Dn as getWorldScale,Vh as hasCommercialLicense,RF as hasIndieLicense,fL as hasPointerEventComponent,ng as hasProLicense,F8 as hideDebugConsole,Lne as imageToCanvas,Yb as instantiate,i3 as invokeAfterImportPluginHooks,d$ as invokeXRSessionEnd,h$ as invokeXRSessionStart,oie as isActiveInHierarchy,Qb as isActiveSelf,D1e as isAndroidDevice,k8 as isAnimationAction,Ase as isComponent,E1e as isDebugMode,P1e as isDesktop,G0 as isDestroyed,Je as isDevEnvironment,MBe as isDisposed,kOe as isExporting,o6 as isHostedOnGlitch,dOe as isHotReloading,V1e as isIPad,Yie as isIconElement,Ma as isLocalNetwork,F1e as isMacOS,N1e as isMobileDevice,z1e as isMozillaXR,Z1e as isQuest,mte as isResourceTrackingEnabled,O1e as isSafari,E2 as isUsingInstancing,U1e as isiOS,X1e as isiPad,OO as loadSync,jE as logHierarchy,N_e as lookAtInverse,xw as lookAtObject,L1e as makeId,d6 as makeIdFromRandomWords,Xh as makeNameSafeForUSD,aie as markAsInstancedRendered,W1e as microphonePermissionsGranted,T1e as nameof,a6 as nameofFactory,nse as objectSerializer,S2e as offXRSessionEnd,C2e as offXRSessionStart,aNe as onAfterRender,ese as onBeforeRender,rNe as onClear,oNe as onDestroy,sNe as onInitialized,oU as onStart,aU as onUpdate,O5 as onXRSessionEnd,OR as onXRSessionStart,iae as parseSync,V8 as placeOnSurface,pD as postprocessFBXMaterials,cNe as prefix,l6 as pushState,B1e as randomNumber,j5 as registerBinaryType,q2 as registerComponent,jL as registerComponentExtension,Uc as registerCustomEffectType,t3 as registerExportExtensions,JL as registerExtensions,uOe as registerHotReloadType,dX as registerLoader,Bte as registerPrefabProvider,Wte as registerPrototypeExtensions,$Be as registerType,p6 as relativePathPrefix,g6 as removeAttributeChangeCallback,sF as removeComponent,YXe as removeCustomImportExtensionType,sOe as removeGltfLoadEventListener,gTe as removePatch,Sm as resolveUrl,u6 as sanitizeString,Woe as saveImage,B3e as screenshot,kO as screenshot2,Wz as sendDestroyed,T as serializable,Xte as serializeObject,lv as serializeable,GC as setActive,v6 as setAllowBalloonMessages,$1e as setAllowOverlayMessages,nD as setAutoFitEnabled,tD as setCameraController,cie as setDestroyed,eMe as setDevEnvironment,Gz as setDisposable,Kb as setDontDestroy,mX as setOrAddParamsToUrl,R1e as setParam,mw as setParamWithoutReload,xLe as setPeerOptions,_Be as setResourceTrackingEnabled,gX as setState,uD as setVisibleInCustomShadowRendering,hD as setWorldEuler,Cr as setWorldPosition,o0 as setWorldPositionXYZ,Ic as setWorldQuaternion,aD as setWorldQuaternionXYZW,dD as setWorldRotation,Cw as setWorldRotationXYZ,ib as setWorldScale,Mw as showBalloonError,ss as showBalloonMessage,An as showBalloonWarning,AD as showDebugConsole,P_e as slerp,SC as syncDestroy,CU as syncField,Hz as syncInstantiate,Q_e as textureToCanvas,w$ as tryCastBinary,Joe as tryDetermineFileTypeFromBinary,joe as tryDetermineFileTypeFromURL,qy as tryFindObject,C$ as tryGetGuid,pOe as unregisterHotReloadType,fX as unwatchWrite,_8 as useForAutoFit,Io as validate,BE as watchWrite};
