"use strict";var oce=Object.defineProperty;var ace=(s,e,t)=>e in s?oce(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var p=(s,e,t)=>(ace(s,typeof e!="symbol"?e+"":e,t),t),fG=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var Vi=(s,e,t)=>(fG(s,e,"read from private field"),t?t.call(s):e.get(s)),ml=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},$c=(s,e,t,i)=>(fG(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t);var ng=(s,e,t)=>(fG(s,e,"access private method"),t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var Ju=typeof document<"u"?document.currentScript:null;/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const La="169",y0={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s0={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},vj=0,DF=1,_j=2,lce=3,cce=0,AU=1,yU=2,qa=3,us=0,vn=1,Zi=2,Fn=0,fp=1,sm=2,FF=3,VF=4,bU=5,Lf=100,Cj=101,wj=102,Sj=103,xU=104,Mj=200,Ij=201,Tj=202,Ej=203,$R=204,eL=205,Rj=206,Lj=207,Bj=208,Pj=209,Gj=210,kj=211,Nj=212,Dj=213,Fj=214,Mw=0,lx=1,U0=2,wp=3,rm=4,cx=5,hx=6,X0=7,Fx=0,vU=1,_U=2,Zr=0,aA=1,Vx=2,CU=3,zx=4,Vj=5,lA=6,om=7,zF="attached",zj="detached",H2=300,jl=301,zc=302,wo=303,am=304,cA=306,Mo=1e3,ea=1001,Sp=1002,qt=1003,g1=1004,hce=1004,Id=1005,dce=1005,Ot=1006,mp=1007,uce=1007,xr=1008,Uj=1008,Pi=1009,Iw=1010,Q2=1011,O0=1012,Dd=1013,Wr=1014,$i=1015,Wi=1016,K2=1017,Y2=1018,lm=1020,wU=35902,SU=1021,MU=1022,bi=1023,A1=1024,IU=1025,b0=1026,cm=1027,Vl=1028,Ux=1029,Pc=1030,Xx=1031,pce=1032,Z0=1033,GC=33776,Xb=33777,kC=33778,Ob=33779,Tw=35840,tL=35841,Ew=35842,iL=35843,Rw=36196,Lw=37492,Bw=37496,dx=37808,nL=37809,sL=37810,rL=37811,ux=37812,oL=37813,aL=37814,lL=37815,cL=37816,hL=37817,dL=37818,uL=37819,pL=37820,fL=37821,Zb=36492,mL=36494,gL=36495,TU=36283,AL=36284,yL=36285,bL=36286,Pw=2200,EU=2201,Xj=2202,hm=2300,Mp=2301,hR=2302,r0=2400,o0=2401,Gw=2402,J2=2500,RU=2501,Oj=0,LU=1,xL=2,Io=3200,j2=3201,fce=3202,mce=3203,Qd=0,BU=1,Fr="",ft="srgb",Ji="srgb-linear",y1="display-p3",Ox="display-p3-linear",kw="linear",Ln="srgb",Nw="rec709",Dw="p3",Zj=0,Sf=7680,Wj=7681,Hj=7682,Qj=7683,Kj=34055,Yj=34056,Jj=5386,UF=512,jj=513,qj=514,$j=515,e8=516,t8=517,i8=518,vL=519,n8=512,PU=513,s8=514,GU=515,r8=516,o8=517,a8=518,l8=519,px=35044,Vs=35048,gce=35040,Ace=35045,yce=35049,bce=35041,xce=35046,vce=35050,_ce=35042,Cce="100",_L="300 es",Gc=2e3,W0=2001;let Mr=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const n=i.slice(0);for(let r=0,o=n.length;r<o;r++)n[r].call(this,e);e.target=null}}};const Uo=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let sW=1234567;const x0=Math.PI/180,fx=180/Math.PI;function Hl(){const s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Uo[s&255]+Uo[s>>8&255]+Uo[s>>16&255]+Uo[s>>24&255]+"-"+Uo[e&255]+Uo[e>>8&255]+"-"+Uo[e>>16&15|64]+Uo[e>>24&255]+"-"+Uo[t&63|128]+Uo[t>>8&255]+"-"+Uo[t>>16&255]+Uo[t>>24&255]+Uo[i&255]+Uo[i>>8&255]+Uo[i>>16&255]+Uo[i>>24&255]).toLowerCase()}function ws(s,e,t){return Math.max(e,Math.min(t,s))}function kU(s,e){return(s%e+e)%e}function wce(s,e,t,i,n){return i+(s-e)*(n-i)/(t-e)}function Sce(s,e,t){return s!==e?(t-s)/(e-s):0}function NC(s,e,t){return(1-t)*s+t*e}function Mce(s,e,t,i){return NC(s,e,1-Math.exp(-t*i))}function Ice(s,e=1){return e-Math.abs(kU(s,e*2)-e)}function Tce(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*(3-2*s))}function Ece(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*s*(s*(s*6-15)+10))}function Rce(s,e){return s+Math.floor(Math.random()*(e-s+1))}function Lce(s,e){return s+Math.random()*(e-s)}function Bce(s){return s*(.5-Math.random())}function Pce(s){s!==void 0&&(sW=s);let e=sW+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Gce(s){return s*x0}function kce(s){return s*fx}function Nce(s){return(s&s-1)===0&&s!==0}function Dce(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Fce(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function Vce(s,e,t,i,n){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),c=r((e+i)/2),h=o((e+i)/2),d=r((e-i)/2),u=o((e-i)/2),f=r((i-e)/2),m=o((i-e)/2);switch(n){case"XYX":s.set(a*h,l*d,l*u,a*c);break;case"YZY":s.set(l*u,a*h,l*d,a*c);break;case"ZXZ":s.set(l*d,l*u,a*h,a*c);break;case"XZX":s.set(a*h,l*m,l*f,a*c);break;case"YXY":s.set(l*f,a*h,l*m,a*c);break;case"ZYZ":s.set(l*m,l*f,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function wa(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return s/4294967295;case Uint16Array:return s/65535;case Uint8Array:return s/255;case Int32Array:return Math.max(s/2147483647,-1);case Int16Array:return Math.max(s/32767,-1);case Int8Array:return Math.max(s/127,-1);default:throw new Error("Invalid component type.")}}function mi(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return Math.round(s*4294967295);case Uint16Array:return Math.round(s*65535);case Uint8Array:return Math.round(s*255);case Int32Array:return Math.round(s*2147483647);case Int16Array:return Math.round(s*32767);case Int8Array:return Math.round(s*127);default:throw new Error("Invalid component type.")}}const Bi={DEG2RAD:x0,RAD2DEG:fx,generateUUID:Hl,clamp:ws,euclideanModulo:kU,mapLinear:wce,inverseLerp:Sce,lerp:NC,damp:Mce,pingpong:Ice,smoothstep:Tce,smootherstep:Ece,randInt:Rce,randFloat:Lce,randFloatSpread:Bce,seededRandom:Pce,degToRad:Gce,radToDeg:kce,isPowerOfTwo:Nce,ceilPowerOfTwo:Dce,floorPowerOfTwo:Fce,setQuaternionFromProperEuler:Vce,normalize:mi,denormalize:wa};let Q=class c8{constructor(e=0,t=0){c8.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ws(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*n+e.x,this.y=r*n+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},ei=class h8{constructor(e,t,i,n,r,o,a,l,c){h8.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,n,r,o,a,l,c)}set(e,t,i,n,r,o,a,l,c){const h=this.elements;return h[0]=e,h[1]=n,h[2]=a,h[3]=t,h[4]=r,h[5]=l,h[6]=i,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],h=i[4],d=i[7],u=i[2],f=i[5],m=i[8],g=n[0],A=n[3],y=n[6],b=n[1],x=n[4],v=n[7],_=n[2],C=n[5],S=n[8];return r[0]=o*g+a*b+l*_,r[3]=o*A+a*x+l*C,r[6]=o*y+a*v+l*S,r[1]=c*g+h*b+d*_,r[4]=c*A+h*x+d*C,r[7]=c*y+h*v+d*S,r[2]=u*g+f*b+m*_,r[5]=u*A+f*x+m*C,r[8]=u*y+f*v+m*S,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t*o*h-t*a*c-i*r*h+i*a*l+n*r*c-n*o*l}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=h*o-a*c,u=a*l-h*r,f=c*r-o*l,m=t*d+i*u+n*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/m;return e[0]=d*g,e[1]=(n*c-h*i)*g,e[2]=(a*i-n*o)*g,e[3]=u*g,e[4]=(h*t-n*l)*g,e[5]=(n*r-a*t)*g,e[6]=f*g,e[7]=(i*l-c*t)*g,e[8]=(o*t-i*r)*g,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-n*c,n*l,-n*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(mG.makeScale(e,t)),this}rotate(e){return this.premultiply(mG.makeRotation(-e)),this}translate(e,t){return this.premultiply(mG.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const mG=new ei;function d8(s){for(let e=s.length-1;e>=0;--e)if(s[e]>=65535)return!0;return!1}const zce={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function xb(s,e){return new zce[s](e)}function Fw(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}function u8(){const s=Fw("canvas");return s.style.display="block",s}const rW={};function dR(s){s in rW||(rW[s]=!0,console.warn(s))}function Uce(s,e,t){return new Promise(function(i,n){function r(){switch(s.clientWaitSync(e,s.SYNC_FLUSH_COMMANDS_BIT,0)){case s.WAIT_FAILED:n();break;case s.TIMEOUT_EXPIRED:setTimeout(r,t);break;default:i()}}setTimeout(r,t)})}function Xce(s){const e=s.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function Oce(s){const e=s.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const oW=new ei().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),aW=new ei().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Fv={[Ji]:{transfer:kw,primaries:Nw,luminanceCoefficients:[.2126,.7152,.0722],toReference:s=>s,fromReference:s=>s},[ft]:{transfer:Ln,primaries:Nw,luminanceCoefficients:[.2126,.7152,.0722],toReference:s=>s.convertSRGBToLinear(),fromReference:s=>s.convertLinearToSRGB()},[Ox]:{transfer:kw,primaries:Dw,luminanceCoefficients:[.2289,.6917,.0793],toReference:s=>s.applyMatrix3(aW),fromReference:s=>s.applyMatrix3(oW)},[y1]:{transfer:Ln,primaries:Dw,luminanceCoefficients:[.2289,.6917,.0793],toReference:s=>s.convertSRGBToLinear().applyMatrix3(aW),fromReference:s=>s.applyMatrix3(oW).convertLinearToSRGB()}},Zce=new Set([Ji,Ox]),ni={enabled:!0,_workingColorSpace:Ji,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(s){if(!Zce.has(s))throw new Error(`Unsupported working color space, "${s}".`);this._workingColorSpace=s},convert:function(s,e,t){if(this.enabled===!1||e===t||!e||!t)return s;const i=Fv[e].toReference,n=Fv[t].fromReference;return n(i(s))},fromWorkingColorSpace:function(s,e){return this.convert(s,this._workingColorSpace,e)},toWorkingColorSpace:function(s,e){return this.convert(s,e,this._workingColorSpace)},getPrimaries:function(s){return Fv[s].primaries},getTransfer:function(s){return s===Fr?kw:Fv[s].transfer},getLuminanceCoefficients:function(s,e=this._workingColorSpace){return s.fromArray(Fv[e].luminanceCoefficients)}};function Wb(s){return s<.04045?s*.0773993808:Math.pow(s*.9478672986+.0521327014,2.4)}function gG(s){return s<.0031308?s*12.92:1.055*Math.pow(s,.41666)-.055}let YA,p8=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{YA===void 0&&(YA=Fw("canvas")),YA.width=e.width,YA.height=e.height;const i=YA.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=YA}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Fw("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const n=i.getImageData(0,0,e.width,e.height),r=n.data;for(let o=0;o<r.length;o++)r[o]=Wb(r[o]/255)*255;return i.putImageData(n,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Wb(t[i]/255)*255):t[i]=Wb(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},Wce=0,ap=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Wce++}),this.uuid=Hl(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let r;if(Array.isArray(n)){r=[];for(let o=0,a=n.length;o<a;o++)n[o].isDataTexture?r.push(AG(n[o].image)):r.push(AG(n[o]))}else r=AG(n);i.url=r}return t||(e.images[this.uuid]=i),i}};function AG(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap?p8.getDataURL(s):s.data?{data:Array.from(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Hce=0,si=class uR extends Mr{constructor(e=uR.DEFAULT_IMAGE,t=uR.DEFAULT_MAPPING,i=ea,n=ea,r=Ot,o=xr,a=bi,l=Pi,c=uR.DEFAULT_ANISOTROPY,h=Fr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Hce++}),this.uuid=Hl(),this.name="",this.source=new ap(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Q(0,0),this.repeat=new Q(1,1),this.center=new Q(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ei,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==H2)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Mo:e.x=e.x-Math.floor(e.x);break;case ea:e.x=e.x<0?0:1;break;case Sp:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Mo:e.y=e.y-Math.floor(e.y);break;case ea:e.y=e.y<0?0:1;break;case Sp:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}};si.DEFAULT_IMAGE=null;si.DEFAULT_MAPPING=H2;si.DEFAULT_ANISOTROPY=4;let Je=class f8{constructor(e=0,t=0,i=0,n=1){f8.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*n+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r;const l=e.elements,c=l[0],h=l[4],d=l[8],u=l[1],f=l[5],m=l[9],g=l[2],A=l[6],y=l[10];if(Math.abs(h-u)<.01&&Math.abs(d-g)<.01&&Math.abs(m-A)<.01){if(Math.abs(h+u)<.1&&Math.abs(d+g)<.1&&Math.abs(m+A)<.1&&Math.abs(c+f+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const x=(c+1)/2,v=(f+1)/2,_=(y+1)/2,C=(h+u)/4,S=(d+g)/4,M=(m+A)/4;return x>v&&x>_?x<.01?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(x),n=C/i,r=S/i):v>_?v<.01?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(v),i=C/n,r=M/n):_<.01?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(_),i=S/r,n=M/r),this.set(i,n,r,t),this}let b=Math.sqrt((A-m)*(A-m)+(d-g)*(d-g)+(u-h)*(u-h));return Math.abs(b)<.001&&(b=1),this.x=(A-m)/b,this.y=(d-g)/b,this.z=(u-h)/b,this.w=Math.acos((c+f+y-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};class vr extends Mr{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Je(0,0,e,t),this.scissorTest=!1,this.viewport=new Je(0,0,e,t);const n={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Ot,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const r=new si(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);r.flipY=!1,r.generateMipmaps=i.generateMipmaps,r.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=r.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,r=this.textures.length;n<r;n++)this.textures[n].image.width=e,this.textures[n].image.height=t,this.textures[n].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,n=e.textures.length;i<n;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new ap(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ci extends vr{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class b1 extends si{constructor(e=null,t=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=qt,this.minFilter=qt,this.wrapR=ea,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Qce extends ci{constructor(e=1,t=1,i=1,n={}){super(e,t,n),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new b1(null,e,t,i),this.texture.isRenderTargetTexture=!0}}let q2=class extends si{constructor(e=null,t=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=qt,this.minFilter=qt,this.wrapR=ea,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};class Kce extends ci{constructor(e=1,t=1,i=1,n={}){super(e,t,n),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new q2(null,e,t,i),this.texture.isRenderTargetTexture=!0}}let Ve=class{constructor(e=0,t=0,i=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,o,a){let l=i[n+0],c=i[n+1],h=i[n+2],d=i[n+3];const u=r[o+0],f=r[o+1],m=r[o+2],g=r[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d;return}if(a===1){e[t+0]=u,e[t+1]=f,e[t+2]=m,e[t+3]=g;return}if(d!==g||l!==u||c!==f||h!==m){let A=1-a;const y=l*u+c*f+h*m+d*g,b=y>=0?1:-1,x=1-y*y;if(x>Number.EPSILON){const _=Math.sqrt(x),C=Math.atan2(_,y*b);A=Math.sin(A*C)/_,a=Math.sin(a*C)/_}const v=a*b;if(l=l*A+u*v,c=c*A+f*v,h=h*A+m*v,d=d*A+g*v,A===1-a){const _=1/Math.sqrt(l*l+c*c+h*h+d*d);l*=_,c*=_,h*=_,d*=_}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,n,r,o){const a=i[n],l=i[n+1],c=i[n+2],h=i[n+3],d=r[o],u=r[o+1],f=r[o+2],m=r[o+3];return e[t]=a*m+h*d+l*f-c*u,e[t+1]=l*m+h*u+c*d-a*f,e[t+2]=c*m+h*f+a*u-l*d,e[t+3]=h*m-a*d-l*u-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,n=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(n/2),d=a(r/2),u=l(i/2),f=l(n/2),m=l(r/2);switch(o){case"XYZ":this._x=u*h*d+c*f*m,this._y=c*f*d-u*h*m,this._z=c*h*m+u*f*d,this._w=c*h*d-u*f*m;break;case"YXZ":this._x=u*h*d+c*f*m,this._y=c*f*d-u*h*m,this._z=c*h*m-u*f*d,this._w=c*h*d+u*f*m;break;case"ZXY":this._x=u*h*d-c*f*m,this._y=c*f*d+u*h*m,this._z=c*h*m+u*f*d,this._w=c*h*d-u*f*m;break;case"ZYX":this._x=u*h*d-c*f*m,this._y=c*f*d+u*h*m,this._z=c*h*m-u*f*d,this._w=c*h*d+u*f*m;break;case"YZX":this._x=u*h*d+c*f*m,this._y=c*f*d+u*h*m,this._z=c*h*m-u*f*d,this._w=c*h*d-u*f*m;break;case"XZY":this._x=u*h*d-c*f*m,this._y=c*f*d-u*h*m,this._z=c*h*m+u*f*d,this._w=c*h*d+u*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],r=t[8],o=t[1],a=t[5],l=t[9],c=t[2],h=t[6],d=t[10],u=i+a+d;if(u>0){const f=.5/Math.sqrt(u+1);this._w=.25/f,this._x=(h-l)*f,this._y=(r-c)*f,this._z=(o-n)*f}else if(i>a&&i>d){const f=2*Math.sqrt(1+i-a-d);this._w=(h-l)/f,this._x=.25*f,this._y=(n+o)/f,this._z=(r+c)/f}else if(a>d){const f=2*Math.sqrt(1+a-i-d);this._w=(r-c)/f,this._x=(n+o)/f,this._y=.25*f,this._z=(l+h)/f}else{const f=2*Math.sqrt(1+d-i-a);this._w=(o-n)/f,this._x=(r+c)/f,this._y=(l+h)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ws(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,r=e._z,o=e._w,a=t._x,l=t._y,c=t._z,h=t._w;return this._x=i*h+o*a+n*c-r*l,this._y=n*h+o*l+r*a-i*c,this._z=r*h+o*c+i*l-n*a,this._w=o*h-i*a-n*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,n=this._y,r=this._z,o=this._w;let a=o*e._w+i*e._x+n*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*i+t*this._x,this._y=f*n+t*this._y,this._z=f*r+t*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),d=Math.sin((1-t)*h)/c,u=Math.sin(t*h)/c;return this._w=o*d+this._w*u,this._x=i*d+this._x*u,this._y=n*d+this._y*u,this._z=r*d+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(n*Math.sin(e),n*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},T=class m8{constructor(e=0,t=0,i=0){m8.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(lW.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(lW.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*n-a*i),h=2*(a*t-r*n),d=2*(r*i-o*t);return this.x=t+l*c+o*d-a*h,this.y=i+l*h+a*c-r*d,this.z=n+l*d+r*h-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=n*l-r*a,this.y=r*o-i*l,this.z=i*a-n*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return yG.copy(this).projectOnVector(e),this.sub(yG)}reflect(e){return this.sub(yG.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ws(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const yG=new T,lW=new Ve;let oi=class{constructor(e=new T(1/0,1/0,1/0),t=new T(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(eh.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(eh.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=eh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const r=i.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=r.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,eh):eh.fromBufferAttribute(r,o),eh.applyMatrix4(e.matrixWorld),this.expandByPoint(eh);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),oI.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),oI.copy(i.boundingBox)),oI.applyMatrix4(e.matrixWorld),this.union(oI)}const n=e.children;for(let r=0,o=n.length;r<o;r++)this.expandByObject(n[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,eh),eh.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Vv),aI.subVectors(this.max,Vv),JA.subVectors(e.a,Vv),jA.subVectors(e.b,Vv),qA.subVectors(e.c,Vv),Wp.subVectors(jA,JA),Hp.subVectors(qA,jA),sg.subVectors(JA,qA);let t=[0,-Wp.z,Wp.y,0,-Hp.z,Hp.y,0,-sg.z,sg.y,Wp.z,0,-Wp.x,Hp.z,0,-Hp.x,sg.z,0,-sg.x,-Wp.y,Wp.x,0,-Hp.y,Hp.x,0,-sg.y,sg.x,0];return!bG(t,JA,jA,qA,aI)||(t=[1,0,0,0,1,0,0,0,1],!bG(t,JA,jA,qA,aI))?!1:(lI.crossVectors(Wp,Hp),t=[lI.x,lI.y,lI.z],bG(t,JA,jA,qA,aI))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,eh).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(eh).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(gu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),gu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),gu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),gu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),gu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),gu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),gu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),gu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(gu),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};const gu=[new T,new T,new T,new T,new T,new T,new T,new T],eh=new T,oI=new oi,JA=new T,jA=new T,qA=new T,Wp=new T,Hp=new T,sg=new T,Vv=new T,aI=new T,lI=new T,rg=new T;function bG(s,e,t,i,n){for(let r=0,o=s.length-3;r<=o;r+=3){rg.fromArray(s,r);const a=n.x*Math.abs(rg.x)+n.y*Math.abs(rg.y)+n.z*Math.abs(rg.z),l=e.dot(rg),c=t.dot(rg),h=i.dot(rg);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}const Yce=new oi,zv=new T,xG=new T;let Vn=class{constructor(e=new T,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):Yce.setFromPoints(e).getCenter(i);let n=0;for(let r=0,o=e.length;r<o;r++)n=Math.max(n,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;zv.subVectors(e,this.center);const t=zv.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),n=(i-this.radius)*.5;this.center.addScaledVector(zv,n/i),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(xG.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(zv.copy(e.center).add(xG)),this.expandByPoint(zv.copy(e.center).sub(xG))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}};const Au=new T,vG=new T,cI=new T,Qp=new T,_G=new T,hI=new T,CG=new T;let Fa=class{constructor(e=new T,t=new T(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Au)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Au.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Au.copy(this.origin).addScaledVector(this.direction,t),Au.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){vG.copy(e).add(t).multiplyScalar(.5),cI.copy(t).sub(e).normalize(),Qp.copy(this.origin).sub(vG);const r=e.distanceTo(t)*.5,o=-this.direction.dot(cI),a=Qp.dot(this.direction),l=-Qp.dot(cI),c=Qp.lengthSq(),h=Math.abs(1-o*o);let d,u,f,m;if(h>0)if(d=o*l-a,u=o*a-l,m=r*h,d>=0)if(u>=-m)if(u<=m){const g=1/h;d*=g,u*=g,f=d*(d+o*u+2*a)+u*(o*d+u+2*l)+c}else u=r,d=Math.max(0,-(o*u+a)),f=-d*d+u*(u+2*l)+c;else u=-r,d=Math.max(0,-(o*u+a)),f=-d*d+u*(u+2*l)+c;else u<=-m?(d=Math.max(0,-(-o*r+a)),u=d>0?-r:Math.min(Math.max(-r,-l),r),f=-d*d+u*(u+2*l)+c):u<=m?(d=0,u=Math.min(Math.max(-r,-l),r),f=u*(u+2*l)+c):(d=Math.max(0,-(o*r+a)),u=d>0?r:Math.min(Math.max(-r,-l),r),f=-d*d+u*(u+2*l)+c);else u=o>0?-r:r,d=Math.max(0,-(o*u+a)),f=-d*d+u*(u+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,d),n&&n.copy(vG).addScaledVector(cI,u),f}intersectSphere(e,t){Au.subVectors(e.center,this.origin);const i=Au.dot(this.direction),n=Au.dot(Au)-i*i,r=e.radius*e.radius;if(n>r)return null;const o=Math.sqrt(r-n),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,d=1/this.direction.z,u=this.origin;return c>=0?(i=(e.min.x-u.x)*c,n=(e.max.x-u.x)*c):(i=(e.max.x-u.x)*c,n=(e.min.x-u.x)*c),h>=0?(r=(e.min.y-u.y)*h,o=(e.max.y-u.y)*h):(r=(e.max.y-u.y)*h,o=(e.min.y-u.y)*h),i>o||r>n||((r>i||isNaN(i))&&(i=r),(o<n||isNaN(n))&&(n=o),d>=0?(a=(e.min.z-u.z)*d,l=(e.max.z-u.z)*d):(a=(e.max.z-u.z)*d,l=(e.min.z-u.z)*d),i>l||a>n)||((a>i||i!==i)&&(i=a),(l<n||n!==n)&&(n=l),n<0)?null:this.at(i>=0?i:n,t)}intersectsBox(e){return this.intersectBox(e,Au)!==null}intersectTriangle(e,t,i,n,r){_G.subVectors(t,e),hI.subVectors(i,e),CG.crossVectors(_G,hI);let o=this.direction.dot(CG),a;if(o>0){if(n)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Qp.subVectors(this.origin,e);const l=a*this.direction.dot(hI.crossVectors(Qp,hI));if(l<0)return null;const c=a*this.direction.dot(_G.cross(Qp));if(c<0||l+c>o)return null;const h=-a*Qp.dot(CG);return h<0?null:this.at(h/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},ce=class XF{constructor(e,t,i,n,r,o,a,l,c,h,d,u,f,m,g,A){XF.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,n,r,o,a,l,c,h,d,u,f,m,g,A)}set(e,t,i,n,r,o,a,l,c,h,d,u,f,m,g,A){const y=this.elements;return y[0]=e,y[4]=t,y[8]=i,y[12]=n,y[1]=r,y[5]=o,y[9]=a,y[13]=l,y[2]=c,y[6]=h,y[10]=d,y[14]=u,y[3]=f,y[7]=m,y[11]=g,y[15]=A,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new XF().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/$A.setFromMatrixColumn(e,0).length(),r=1/$A.setFromMatrixColumn(e,1).length(),o=1/$A.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(n),c=Math.sin(n),h=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){const u=o*h,f=o*d,m=a*h,g=a*d;t[0]=l*h,t[4]=-l*d,t[8]=c,t[1]=f+m*c,t[5]=u-g*c,t[9]=-a*l,t[2]=g-u*c,t[6]=m+f*c,t[10]=o*l}else if(e.order==="YXZ"){const u=l*h,f=l*d,m=c*h,g=c*d;t[0]=u+g*a,t[4]=m*a-f,t[8]=o*c,t[1]=o*d,t[5]=o*h,t[9]=-a,t[2]=f*a-m,t[6]=g+u*a,t[10]=o*l}else if(e.order==="ZXY"){const u=l*h,f=l*d,m=c*h,g=c*d;t[0]=u-g*a,t[4]=-o*d,t[8]=m+f*a,t[1]=f+m*a,t[5]=o*h,t[9]=g-u*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const u=o*h,f=o*d,m=a*h,g=a*d;t[0]=l*h,t[4]=m*c-f,t[8]=u*c+g,t[1]=l*d,t[5]=g*c+u,t[9]=f*c-m,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const u=o*l,f=o*c,m=a*l,g=a*c;t[0]=l*h,t[4]=g-u*d,t[8]=m*d+f,t[1]=d,t[5]=o*h,t[9]=-a*h,t[2]=-c*h,t[6]=f*d+m,t[10]=u-g*d}else if(e.order==="XZY"){const u=o*l,f=o*c,m=a*l,g=a*c;t[0]=l*h,t[4]=-d,t[8]=c*h,t[1]=u*d+g,t[5]=o*h,t[9]=f*d-m,t[2]=m*d-f,t[6]=a*h,t[10]=g*d+u}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Jce,e,jce)}lookAt(e,t,i){const n=this.elements;return gl.subVectors(e,t),gl.lengthSq()===0&&(gl.z=1),gl.normalize(),Kp.crossVectors(i,gl),Kp.lengthSq()===0&&(Math.abs(i.z)===1?gl.x+=1e-4:gl.z+=1e-4,gl.normalize(),Kp.crossVectors(i,gl)),Kp.normalize(),dI.crossVectors(gl,Kp),n[0]=Kp.x,n[4]=dI.x,n[8]=gl.x,n[1]=Kp.y,n[5]=dI.y,n[9]=gl.y,n[2]=Kp.z,n[6]=dI.z,n[10]=gl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],h=i[1],d=i[5],u=i[9],f=i[13],m=i[2],g=i[6],A=i[10],y=i[14],b=i[3],x=i[7],v=i[11],_=i[15],C=n[0],S=n[4],M=n[8],L=n[12],w=n[1],E=n[5],B=n[9],P=n[13],k=n[2],X=n[6],F=n[10],H=n[14],W=n[3],se=n[7],de=n[11],be=n[15];return r[0]=o*C+a*w+l*k+c*W,r[4]=o*S+a*E+l*X+c*se,r[8]=o*M+a*B+l*F+c*de,r[12]=o*L+a*P+l*H+c*be,r[1]=h*C+d*w+u*k+f*W,r[5]=h*S+d*E+u*X+f*se,r[9]=h*M+d*B+u*F+f*de,r[13]=h*L+d*P+u*H+f*be,r[2]=m*C+g*w+A*k+y*W,r[6]=m*S+g*E+A*X+y*se,r[10]=m*M+g*B+A*F+y*de,r[14]=m*L+g*P+A*H+y*be,r[3]=b*C+x*w+v*k+_*W,r[7]=b*S+x*E+v*X+_*se,r[11]=b*M+x*B+v*F+_*de,r[15]=b*L+x*P+v*H+_*be,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],a=e[5],l=e[9],c=e[13],h=e[2],d=e[6],u=e[10],f=e[14],m=e[3],g=e[7],A=e[11],y=e[15];return m*(+r*l*d-n*c*d-r*a*u+i*c*u+n*a*f-i*l*f)+g*(+t*l*f-t*c*u+r*o*u-n*o*f+n*c*h-r*l*h)+A*(+t*c*d-t*a*f-r*o*d+i*o*f+r*a*h-i*c*h)+y*(-n*a*h-t*l*d+t*a*u+n*o*d-i*o*u+i*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],u=e[10],f=e[11],m=e[12],g=e[13],A=e[14],y=e[15],b=d*A*c-g*u*c+g*l*f-a*A*f-d*l*y+a*u*y,x=m*u*c-h*A*c-m*l*f+o*A*f+h*l*y-o*u*y,v=h*g*c-m*d*c+m*a*f-o*g*f-h*a*y+o*d*y,_=m*d*l-h*g*l-m*a*u+o*g*u+h*a*A-o*d*A,C=t*b+i*x+n*v+r*_;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/C;return e[0]=b*S,e[1]=(g*u*r-d*A*r-g*n*f+i*A*f+d*n*y-i*u*y)*S,e[2]=(a*A*r-g*l*r+g*n*c-i*A*c-a*n*y+i*l*y)*S,e[3]=(d*l*r-a*u*r-d*n*c+i*u*c+a*n*f-i*l*f)*S,e[4]=x*S,e[5]=(h*A*r-m*u*r+m*n*f-t*A*f-h*n*y+t*u*y)*S,e[6]=(m*l*r-o*A*r-m*n*c+t*A*c+o*n*y-t*l*y)*S,e[7]=(o*u*r-h*l*r+h*n*c-t*u*c-o*n*f+t*l*f)*S,e[8]=v*S,e[9]=(m*d*r-h*g*r-m*i*f+t*g*f+h*i*y-t*d*y)*S,e[10]=(o*g*r-m*a*r+m*i*c-t*g*c-o*i*y+t*a*y)*S,e[11]=(h*a*r-o*d*r-h*i*c+t*d*c+o*i*f-t*a*f)*S,e[12]=_*S,e[13]=(h*g*n-m*d*n+m*i*u-t*g*u-h*i*A+t*d*A)*S,e[14]=(m*a*n-o*g*n-m*i*l+t*g*l+o*i*A-t*a*A)*S,e[15]=(o*d*n-h*a*n+h*i*l-t*d*l-o*i*u+t*a*u)*S,this}scale(e){const t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,a=e.y,l=e.z,c=r*o,h=r*a;return this.set(c*o+i,c*a-n*l,c*l+n*a,0,c*a+n*l,h*a+i,h*l-n*o,0,c*l-n*a,h*l+n*o,r*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,o){return this.set(1,i,r,0,e,1,o,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,c=r+r,h=o+o,d=a+a,u=r*c,f=r*h,m=r*d,g=o*h,A=o*d,y=a*d,b=l*c,x=l*h,v=l*d,_=i.x,C=i.y,S=i.z;return n[0]=(1-(g+y))*_,n[1]=(f+v)*_,n[2]=(m-x)*_,n[3]=0,n[4]=(f-v)*C,n[5]=(1-(u+y))*C,n[6]=(A+b)*C,n[7]=0,n[8]=(m+x)*S,n[9]=(A-b)*S,n[10]=(1-(u+g))*S,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let r=$A.set(n[0],n[1],n[2]).length();const o=$A.set(n[4],n[5],n[6]).length(),a=$A.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],th.copy(this);const c=1/r,h=1/o,d=1/a;return th.elements[0]*=c,th.elements[1]*=c,th.elements[2]*=c,th.elements[4]*=h,th.elements[5]*=h,th.elements[6]*=h,th.elements[8]*=d,th.elements[9]*=d,th.elements[10]*=d,t.setFromRotationMatrix(th),i.x=r,i.y=o,i.z=a,this}makePerspective(e,t,i,n,r,o,a=Gc){const l=this.elements,c=2*r/(t-e),h=2*r/(i-n),d=(t+e)/(t-e),u=(i+n)/(i-n);let f,m;if(a===Gc)f=-(o+r)/(o-r),m=-2*o*r/(o-r);else if(a===W0)f=-o/(o-r),m=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=h,l[9]=u,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,n,r,o,a=Gc){const l=this.elements,c=1/(t-e),h=1/(i-n),d=1/(o-r),u=(t+e)*c,f=(i+n)*h;let m,g;if(a===Gc)m=(o+r)*d,g=-2*d;else if(a===W0)m=r*d,g=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-u,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=g,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}};const $A=new T,th=new ce,Jce=new T(0,0,0),jce=new T(1,1,1),Kp=new T,dI=new T,gl=new T,cW=new ce,hW=new Ve;let Xi=class g8{constructor(e=0,t=0,i=0,n=g8.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const n=e.elements,r=n[0],o=n[4],a=n[8],l=n[1],c=n[5],h=n[9],d=n[2],u=n[6],f=n[10];switch(t){case"XYZ":this._y=Math.asin(ws(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(u,c),this._z=0);break;case"YXZ":this._x=Math.asin(-ws(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(ws(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-ws(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(u,f),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(ws(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-ws(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(u,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return cW.makeRotationFromQuaternion(e),this.setFromRotationMatrix(cW,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return hW.setFromEuler(this),this.setFromQuaternion(hW,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Xi.DEFAULT_ORDER="XYZ";let ta=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},qce=0;const dW=new T,ey=new Ve,yu=new ce,uI=new T,Uv=new T,$ce=new T,ehe=new Ve,uW=new T(1,0,0),pW=new T(0,1,0),fW=new T(0,0,1),mW={type:"added"},the={type:"removed"},ty={type:"childadded",child:null},wG={type:"childremoved",child:null};let ye=class pR extends Mr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:qce++}),this.uuid=Hl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=pR.DEFAULT_UP.clone();const e=new T,t=new Xi,i=new Ve,n=new T(1,1,1);function r(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new ce},normalMatrix:{value:new ei}}),this.matrix=new ce,this.matrixWorld=new ce,this.matrixAutoUpdate=pR.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=pR.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ta,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ey.setFromAxisAngle(e,t),this.quaternion.multiply(ey),this}rotateOnWorldAxis(e,t){return ey.setFromAxisAngle(e,t),this.quaternion.premultiply(ey),this}rotateX(e){return this.rotateOnAxis(uW,e)}rotateY(e){return this.rotateOnAxis(pW,e)}rotateZ(e){return this.rotateOnAxis(fW,e)}translateOnAxis(e,t){return dW.copy(e).applyQuaternion(this.quaternion),this.position.add(dW.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(uW,e)}translateY(e){return this.translateOnAxis(pW,e)}translateZ(e){return this.translateOnAxis(fW,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(yu.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?uI.copy(e):uI.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),Uv.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?yu.lookAt(Uv,uI,this.up):yu.lookAt(uI,Uv,this.up),this.quaternion.setFromRotationMatrix(yu),n&&(yu.extractRotation(n.matrixWorld),ey.setFromRotationMatrix(yu),this.quaternion.premultiply(ey.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(mW),ty.child=e,this.dispatchEvent(ty),ty.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(the),wG.child=e,this.dispatchEvent(wG),wG.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),yu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),yu.multiply(e.parent.matrixWorld)),e.applyMatrix4(yu),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(mW),ty.child=e,this.dispatchEvent(ty),ty.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const n=this.children;for(let r=0,o=n.length;r<o;r++)n[r].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Uv,e,$ce),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Uv,ehe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const n=this.children;for(let r=0,o=n.length;r<o;r++)n[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),n.maxInstanceCount=this._maxInstanceCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(n.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),this.boundingBox!==null&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()}));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const d=l[c];r(e.shapes,d)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));n.material=a}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];n.animations.push(r(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),h=o(e.images),d=o(e.shapes),u=o(e.skeletons),f=o(e.animations),m=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),h.length>0&&(i.images=h),d.length>0&&(i.shapes=d),u.length>0&&(i.skeletons=u),f.length>0&&(i.animations=f),m.length>0&&(i.nodes=m)}return i.object=n,i;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const n=e.children[i];this.add(n.clone())}return this}};ye.DEFAULT_UP=new T(0,1,0);ye.DEFAULT_MATRIX_AUTO_UPDATE=!0;ye.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ih=new T,bu=new T,SG=new T,xu=new T,iy=new T,ny=new T,gW=new T,MG=new T,IG=new T,TG=new T,EG=new Je,RG=new Je,LG=new Je;let $s=class $y{constructor(e=new T,t=new T,i=new T){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),ih.subVectors(e,t),n.cross(ih);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){ih.subVectors(n,t),bu.subVectors(i,t),SG.subVectors(e,t);const o=ih.dot(ih),a=ih.dot(bu),l=ih.dot(SG),c=bu.dot(bu),h=bu.dot(SG),d=o*c-a*a;if(d===0)return r.set(0,0,0),null;const u=1/d,f=(c*l-a*h)*u,m=(o*h-a*l)*u;return r.set(1-f-m,m,f)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,xu)===null?!1:xu.x>=0&&xu.y>=0&&xu.x+xu.y<=1}static getInterpolation(e,t,i,n,r,o,a,l){return this.getBarycoord(e,t,i,n,xu)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(r,xu.x),l.addScaledVector(o,xu.y),l.addScaledVector(a,xu.z),l)}static getInterpolatedAttribute(e,t,i,n,r,o){return EG.setScalar(0),RG.setScalar(0),LG.setScalar(0),EG.fromBufferAttribute(e,t),RG.fromBufferAttribute(e,i),LG.fromBufferAttribute(e,n),o.setScalar(0),o.addScaledVector(EG,r.x),o.addScaledVector(RG,r.y),o.addScaledVector(LG,r.z),o}static isFrontFacing(e,t,i,n){return ih.subVectors(i,t),bu.subVectors(e,t),ih.cross(bu).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ih.subVectors(this.c,this.b),bu.subVectors(this.a,this.b),ih.cross(bu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return $y.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return $y.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,n,r){return $y.getInterpolation(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return $y.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return $y.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,n=this.b,r=this.c;let o,a;iy.subVectors(n,i),ny.subVectors(r,i),MG.subVectors(e,i);const l=iy.dot(MG),c=ny.dot(MG);if(l<=0&&c<=0)return t.copy(i);IG.subVectors(e,n);const h=iy.dot(IG),d=ny.dot(IG);if(h>=0&&d<=h)return t.copy(n);const u=l*d-h*c;if(u<=0&&l>=0&&h<=0)return o=l/(l-h),t.copy(i).addScaledVector(iy,o);TG.subVectors(e,r);const f=iy.dot(TG),m=ny.dot(TG);if(m>=0&&f<=m)return t.copy(r);const g=f*c-l*m;if(g<=0&&c>=0&&m<=0)return a=c/(c-m),t.copy(i).addScaledVector(ny,a);const A=h*m-f*d;if(A<=0&&d-h>=0&&f-m>=0)return gW.subVectors(r,n),a=(d-h)/(d-h+(f-m)),t.copy(n).addScaledVector(gW,a);const y=1/(A+g+u);return o=g*y,a=u*y,t.copy(i).addScaledVector(iy,o).addScaledVector(ny,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};const A8={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Yp={h:0,s:0,l:0},pI={h:0,s:0,l:0};function BG(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*6*(2/3-t):s}let ge=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const n=e;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ft){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ni.toWorkingColorSpace(this,t),this}setRGB(e,t,i,n=ni.workingColorSpace){return this.r=e,this.g=t,this.b=i,ni.toWorkingColorSpace(this,n),this}setHSL(e,t,i,n=ni.workingColorSpace){if(e=kU(e,1),t=ws(t,0,1),i=ws(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=BG(o,r,e+1/3),this.g=BG(o,r,e),this.b=BG(o,r,e-1/3)}return ni.toWorkingColorSpace(this,n),this}setStyle(e,t=ft){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=n[1],a=n[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=n[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=ft){const i=A8[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Wb(e.r),this.g=Wb(e.g),this.b=Wb(e.b),this}copyLinearToSRGB(e){return this.r=gG(e.r),this.g=gG(e.g),this.b=gG(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ft){return ni.fromWorkingColorSpace(Xo.copy(this),e),Math.round(ws(Xo.r*255,0,255))*65536+Math.round(ws(Xo.g*255,0,255))*256+Math.round(ws(Xo.b*255,0,255))}getHexString(e=ft){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ni.workingColorSpace){ni.fromWorkingColorSpace(Xo.copy(this),t);const i=Xo.r,n=Xo.g,r=Xo.b,o=Math.max(i,n,r),a=Math.min(i,n,r);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const d=o-a;switch(c=h<=.5?d/(o+a):d/(2-o-a),o){case i:l=(n-r)/d+(n<r?6:0);break;case n:l=(r-i)/d+2;break;case r:l=(i-n)/d+4;break}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,t=ni.workingColorSpace){return ni.fromWorkingColorSpace(Xo.copy(this),t),e.r=Xo.r,e.g=Xo.g,e.b=Xo.b,e}getStyle(e=ft){ni.fromWorkingColorSpace(Xo.copy(this),e);const t=Xo.r,i=Xo.g,n=Xo.b;return e!==ft?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(n*255)})`}offsetHSL(e,t,i){return this.getHSL(Yp),this.setHSL(Yp.h+e,Yp.s+t,Yp.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Yp),e.getHSL(pI);const i=NC(Yp.h,pI.h,t),n=NC(Yp.s,pI.s,t),r=NC(Yp.l,pI.l,t);return this.setHSL(i,n,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,n=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*n,this.g=r[1]*t+r[4]*i+r[7]*n,this.b=r[2]*t+r[5]*i+r[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Xo=new ge;ge.NAMES=A8;let ihe=0,Yt=class extends Mr{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ihe++}),this.uuid=Hl(),this.name="",this.type="Material",this.blending=fp,this.side=us,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=$R,this.blendDst=eL,this.blendEquation=Lf,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ge(0,0,0),this.blendAlpha=0,this.depthFunc=wp,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=vL,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Sf,this.stencilZFail=Sf,this.stencilZPass=Sf,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const n=this[t];if(n===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==fp&&(i.blending=this.blending),this.side!==us&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==$R&&(i.blendSrc=this.blendSrc),this.blendDst!==eL&&(i.blendDst=this.blendDst),this.blendEquation!==Lf&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==wp&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==vL&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Sf&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Sf&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Sf&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function n(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(t){const r=n(e.textures),o=n(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const n=t.length;i=new Array(n);for(let r=0;r!==n;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},ii=class extends Yt{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ge(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Xi,this.combine=Fx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}};const ep=nhe();function nhe(){const s=new ArrayBuffer(4),e=new Float32Array(s),t=new Uint32Array(s),i=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(i[l]=0,i[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(i[l]=1024>>-c-14,i[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(i[l]=c+15<<10,i[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(i[l]=31744,i[l|256]=64512,n[l]=24,n[l|256]=24):(i[l]=31744,i[l|256]=64512,n[l]=13,n[l|256]=13)}const r=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,h=0;for(;!(c&8388608);)c<<=1,h-=8388608;c&=-8388609,h+=947912704,r[l]=c|h}for(let l=1024;l<2048;++l)r[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:n,mantissaTable:r,exponentTable:o,offsetTable:a}}function Za(s){Math.abs(s)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),s=ws(s,-65504,65504),ep.floatView[0]=s;const e=ep.uint32View[0],t=e>>23&511;return ep.baseTable[t]+((e&8388607)>>ep.shiftTable[t])}function sC(s){const e=s>>10;return ep.uint32View[0]=ep.mantissaTable[ep.offsetTable[e]+(s&1023)]+ep.exponentTable[e],ep.floatView[0]}const a0={toHalfFloat:Za,fromHalfFloat:sC},Hs=new T,fI=new Q;let dt=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=px,this.updateRanges=[],this.gpuType=$i,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)fI.fromBufferAttribute(this,t),fI.applyMatrix3(e),this.setXY(t,fI.x,fI.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Hs.fromBufferAttribute(this,t),Hs.applyMatrix3(e),this.setXYZ(t,Hs.x,Hs.y,Hs.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Hs.fromBufferAttribute(this,t),Hs.applyMatrix4(e),this.setXYZ(t,Hs.x,Hs.y,Hs.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Hs.fromBufferAttribute(this,t),Hs.applyNormalMatrix(e),this.setXYZ(t,Hs.x,Hs.y,Hs.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Hs.fromBufferAttribute(this,t),Hs.transformDirection(e),this.setXYZ(t,Hs.x,Hs.y,Hs.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=wa(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=mi(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=wa(t,this.array)),t}setX(e,t){return this.normalized&&(t=mi(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=wa(t,this.array)),t}setY(e,t){return this.normalized&&(t=mi(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=wa(t,this.array)),t}setZ(e,t){return this.normalized&&(t=mi(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=wa(t,this.array)),t}setW(e,t){return this.normalized&&(t=mi(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=mi(t,this.array),i=mi(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=mi(t,this.array),i=mi(i,this.array),n=mi(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=mi(t,this.array),i=mi(i,this.array),n=mi(n,this.array),r=mi(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==px&&(e.usage=this.usage),e}};class she extends dt{constructor(e,t,i){super(new Int8Array(e),t,i)}}class rhe extends dt{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class ohe extends dt{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class ahe extends dt{constructor(e,t,i){super(new Int16Array(e),t,i)}}let $2=class extends dt{constructor(e,t,i){super(new Uint16Array(e),t,i)}};class lhe extends dt{constructor(e,t,i){super(new Int32Array(e),t,i)}}let NU=class extends dt{constructor(e,t,i){super(new Uint32Array(e),t,i)}};class y8 extends dt{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=sC(this.array[e*this.itemSize]);return this.normalized&&(t=wa(t,this.array)),t}setX(e,t){return this.normalized&&(t=mi(t,this.array)),this.array[e*this.itemSize]=Za(t),this}getY(e){let t=sC(this.array[e*this.itemSize+1]);return this.normalized&&(t=wa(t,this.array)),t}setY(e,t){return this.normalized&&(t=mi(t,this.array)),this.array[e*this.itemSize+1]=Za(t),this}getZ(e){let t=sC(this.array[e*this.itemSize+2]);return this.normalized&&(t=wa(t,this.array)),t}setZ(e,t){return this.normalized&&(t=mi(t,this.array)),this.array[e*this.itemSize+2]=Za(t),this}getW(e){let t=sC(this.array[e*this.itemSize+3]);return this.normalized&&(t=wa(t,this.array)),t}setW(e,t){return this.normalized&&(t=mi(t,this.array)),this.array[e*this.itemSize+3]=Za(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=mi(t,this.array),i=mi(i,this.array)),this.array[e+0]=Za(t),this.array[e+1]=Za(i),this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=mi(t,this.array),i=mi(i,this.array),n=mi(n,this.array)),this.array[e+0]=Za(t),this.array[e+1]=Za(i),this.array[e+2]=Za(n),this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=mi(t,this.array),i=mi(i,this.array),n=mi(n,this.array),r=mi(r,this.array)),this.array[e+0]=Za(t),this.array[e+1]=Za(i),this.array[e+2]=Za(n),this.array[e+3]=Za(r),this}}let ut=class extends dt{constructor(e,t,i){super(new Float32Array(e),t,i)}},che=0;const hc=new ce,PG=new ye,sy=new T,Al=new oi,Xv=new oi,Tr=new T;let It=class b8 extends Mr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:che++}),this.uuid=Hl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(d8(e)?NU:$2)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new ei().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return hc.makeRotationFromQuaternion(e),this.applyMatrix4(hc),this}rotateX(e){return hc.makeRotationX(e),this.applyMatrix4(hc),this}rotateY(e){return hc.makeRotationY(e),this.applyMatrix4(hc),this}rotateZ(e){return hc.makeRotationZ(e),this.applyMatrix4(hc),this}translate(e,t,i){return hc.makeTranslation(e,t,i),this.applyMatrix4(hc),this}scale(e,t,i){return hc.makeScale(e,t,i),this.applyMatrix4(hc),this}lookAt(e){return PG.lookAt(e),PG.updateMatrix(),this.applyMatrix4(PG.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(sy).negate(),this.translate(sy.x,sy.y,sy.z),this}setFromPoints(e){const t=[];for(let i=0,n=e.length;i<n;i++){const r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new ut(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new oi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new T(-1/0,-1/0,-1/0),new T(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,n=t.length;i<n;i++){const r=t[i];Al.setFromBufferAttribute(r),this.morphTargetsRelative?(Tr.addVectors(this.boundingBox.min,Al.min),this.boundingBox.expandByPoint(Tr),Tr.addVectors(this.boundingBox.max,Al.max),this.boundingBox.expandByPoint(Tr)):(this.boundingBox.expandByPoint(Al.min),this.boundingBox.expandByPoint(Al.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Vn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new T,1/0);return}if(e){const i=this.boundingSphere.center;if(Al.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];Xv.setFromBufferAttribute(a),this.morphTargetsRelative?(Tr.addVectors(Al.min,Xv.min),Al.expandByPoint(Tr),Tr.addVectors(Al.max,Xv.max),Al.expandByPoint(Tr)):(Al.expandByPoint(Xv.min),Al.expandByPoint(Xv.max))}Al.getCenter(i);let n=0;for(let r=0,o=e.count;r<o;r++)Tr.fromBufferAttribute(e,r),n=Math.max(n,i.distanceToSquared(Tr));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],l=this.morphTargetsRelative;for(let c=0,h=a.count;c<h;c++)Tr.fromBufferAttribute(a,c),l&&(sy.fromBufferAttribute(e,c),Tr.add(sy)),n=Math.max(n,i.distanceToSquared(Tr))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,n=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new dt(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let M=0;M<i.count;M++)a[M]=new T,l[M]=new T;const c=new T,h=new T,d=new T,u=new Q,f=new Q,m=new Q,g=new T,A=new T;function y(M,L,w){c.fromBufferAttribute(i,M),h.fromBufferAttribute(i,L),d.fromBufferAttribute(i,w),u.fromBufferAttribute(r,M),f.fromBufferAttribute(r,L),m.fromBufferAttribute(r,w),h.sub(c),d.sub(c),f.sub(u),m.sub(u);const E=1/(f.x*m.y-m.x*f.y);isFinite(E)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(E),A.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(E),a[M].add(g),a[L].add(g),a[w].add(g),l[M].add(A),l[L].add(A),l[w].add(A))}let b=this.groups;b.length===0&&(b=[{start:0,count:e.count}]);for(let M=0,L=b.length;M<L;++M){const w=b[M],E=w.start,B=w.count;for(let P=E,k=E+B;P<k;P+=3)y(e.getX(P+0),e.getX(P+1),e.getX(P+2))}const x=new T,v=new T,_=new T,C=new T;function S(M){_.fromBufferAttribute(n,M),C.copy(_);const L=a[M];x.copy(L),x.sub(_.multiplyScalar(_.dot(L))).normalize(),v.crossVectors(C,L);const E=v.dot(l[M])<0?-1:1;o.setXYZW(M,x.x,x.y,x.z,E)}for(let M=0,L=b.length;M<L;++M){const w=b[M],E=w.start,B=w.count;for(let P=E,k=E+B;P<k;P+=3)S(e.getX(P+0)),S(e.getX(P+1)),S(e.getX(P+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new dt(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let u=0,f=i.count;u<f;u++)i.setXYZ(u,0,0,0);const n=new T,r=new T,o=new T,a=new T,l=new T,c=new T,h=new T,d=new T;if(e)for(let u=0,f=e.count;u<f;u+=3){const m=e.getX(u+0),g=e.getX(u+1),A=e.getX(u+2);n.fromBufferAttribute(t,m),r.fromBufferAttribute(t,g),o.fromBufferAttribute(t,A),h.subVectors(o,r),d.subVectors(n,r),h.cross(d),a.fromBufferAttribute(i,m),l.fromBufferAttribute(i,g),c.fromBufferAttribute(i,A),a.add(h),l.add(h),c.add(h),i.setXYZ(m,a.x,a.y,a.z),i.setXYZ(g,l.x,l.y,l.z),i.setXYZ(A,c.x,c.y,c.z)}else for(let u=0,f=t.count;u<f;u+=3)n.fromBufferAttribute(t,u+0),r.fromBufferAttribute(t,u+1),o.fromBufferAttribute(t,u+2),h.subVectors(o,r),d.subVectors(n,r),h.cross(d),i.setXYZ(u+0,h.x,h.y,h.z),i.setXYZ(u+1,h.x,h.y,h.z),i.setXYZ(u+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Tr.fromBufferAttribute(e,t),Tr.normalize(),e.setXYZ(t,Tr.x,Tr.y,Tr.z)}toNonIndexed(){function e(a,l){const c=a.array,h=a.itemSize,d=a.normalized,u=new c.constructor(l.length*h);let f=0,m=0;for(let g=0,A=l.length;g<A;g++){a.isInterleavedBufferAttribute?f=l[g]*a.data.stride+a.offset:f=l[g]*h;for(let y=0;y<h;y++)u[m++]=c[f++]}return new dt(u,h,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new b8,i=this.index.array,n=this.attributes;for(const a in n){const l=n[a],c=e(l,i);t.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const l=[],c=r[a];for(let h=0,d=c.length;h<d;h++){const u=c[h],f=e(u,i);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const n={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let d=0,u=c.length;d<u;d++){const f=c[d];h.push(f.toJSON(e.data))}h.length>0&&(n[l]=h,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const n=e.attributes;for(const c in n){const h=n[c];this.setAttribute(c,h.clone(t))}const r=e.morphAttributes;for(const c in r){const h=[],d=r[c];for(let u=0,f=d.length;u<f;u++)h.push(d[u].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,h=o.length;c<h;c++){const d=o[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const AW=new ce,og=new Fa,mI=new Vn,yW=new T,gI=new T,AI=new T,yI=new T,GG=new T,bI=new T,bW=new T,xI=new T;let fe=class extends ye{constructor(e=new It,t=new ii){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(e,t){const i=this.geometry,n=i.attributes.position,r=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(n,e);const a=this.morphTargetInfluences;if(r&&a){bI.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const h=a[l],d=r[l];h!==0&&(GG.fromBufferAttribute(d,e),o?bI.addScaledVector(GG,h):bI.addScaledVector(GG.sub(t),h))}t.add(bI)}return t}raycast(e,t){const i=this.geometry,n=this.material,r=this.matrixWorld;n!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),mI.copy(i.boundingSphere),mI.applyMatrix4(r),og.copy(e.ray).recast(e.near),!(mI.containsPoint(og.origin)===!1&&(og.intersectSphere(mI,yW)===null||og.origin.distanceToSquared(yW)>(e.far-e.near)**2))&&(AW.copy(r).invert(),og.copy(e.ray).applyMatrix4(AW),!(i.boundingBox!==null&&og.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,og)))}_computeIntersections(e,t,i){let n;const r=this.geometry,o=this.material,a=r.index,l=r.attributes.position,c=r.attributes.uv,h=r.attributes.uv1,d=r.attributes.normal,u=r.groups,f=r.drawRange;if(a!==null)if(Array.isArray(o))for(let m=0,g=u.length;m<g;m++){const A=u[m],y=o[A.materialIndex],b=Math.max(A.start,f.start),x=Math.min(a.count,Math.min(A.start+A.count,f.start+f.count));for(let v=b,_=x;v<_;v+=3){const C=a.getX(v),S=a.getX(v+1),M=a.getX(v+2);n=vI(this,y,e,i,c,h,d,C,S,M),n&&(n.faceIndex=Math.floor(v/3),n.face.materialIndex=A.materialIndex,t.push(n))}}else{const m=Math.max(0,f.start),g=Math.min(a.count,f.start+f.count);for(let A=m,y=g;A<y;A+=3){const b=a.getX(A),x=a.getX(A+1),v=a.getX(A+2);n=vI(this,o,e,i,c,h,d,b,x,v),n&&(n.faceIndex=Math.floor(A/3),t.push(n))}}else if(l!==void 0)if(Array.isArray(o))for(let m=0,g=u.length;m<g;m++){const A=u[m],y=o[A.materialIndex],b=Math.max(A.start,f.start),x=Math.min(l.count,Math.min(A.start+A.count,f.start+f.count));for(let v=b,_=x;v<_;v+=3){const C=v,S=v+1,M=v+2;n=vI(this,y,e,i,c,h,d,C,S,M),n&&(n.faceIndex=Math.floor(v/3),n.face.materialIndex=A.materialIndex,t.push(n))}}else{const m=Math.max(0,f.start),g=Math.min(l.count,f.start+f.count);for(let A=m,y=g;A<y;A+=3){const b=A,x=A+1,v=A+2;n=vI(this,o,e,i,c,h,d,b,x,v),n&&(n.faceIndex=Math.floor(A/3),t.push(n))}}}};function hhe(s,e,t,i,n,r,o,a){let l;if(e.side===vn?l=i.intersectTriangle(o,r,n,!0,a):l=i.intersectTriangle(n,r,o,e.side===us,a),l===null)return null;xI.copy(a),xI.applyMatrix4(s.matrixWorld);const c=t.ray.origin.distanceTo(xI);return c<t.near||c>t.far?null:{distance:c,point:xI.clone(),object:s}}function vI(s,e,t,i,n,r,o,a,l,c){s.getVertexPosition(a,gI),s.getVertexPosition(l,AI),s.getVertexPosition(c,yI);const h=hhe(s,e,t,i,gI,AI,yI,bW);if(h){const d=new T;$s.getBarycoord(bW,gI,AI,yI,d),n&&(h.uv=$s.getInterpolatedAttribute(n,a,l,c,d,new Q)),r&&(h.uv1=$s.getInterpolatedAttribute(r,a,l,c,d,new Q)),o&&(h.normal=$s.getInterpolatedAttribute(o,a,l,c,d,new T),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const u={a,b:l,c,normal:new T,materialIndex:0};$s.getNormal(gI,AI,yI,u.normal),h.face=u,h.barycoord=d}return h}class pn extends It{constructor(e=1,t=1,i=1,n=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:o};const a=this;n=Math.floor(n),r=Math.floor(r),o=Math.floor(o);const l=[],c=[],h=[],d=[];let u=0,f=0;m("z","y","x",-1,-1,i,t,e,o,r,0),m("z","y","x",1,-1,i,t,-e,o,r,1),m("x","z","y",1,1,e,i,t,n,o,2),m("x","z","y",1,-1,e,i,-t,n,o,3),m("x","y","z",1,-1,e,t,i,n,r,4),m("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(l),this.setAttribute("position",new ut(c,3)),this.setAttribute("normal",new ut(h,3)),this.setAttribute("uv",new ut(d,2));function m(g,A,y,b,x,v,_,C,S,M,L){const w=v/S,E=_/M,B=v/2,P=_/2,k=C/2,X=S+1,F=M+1;let H=0,W=0;const se=new T;for(let de=0;de<F;de++){const be=de*E-P;for(let Pe=0;Pe<X;Pe++){const Oe=Pe*w-B;se[g]=Oe*b,se[A]=be*x,se[y]=k,c.push(se.x,se.y,se.z),se[g]=0,se[A]=0,se[y]=C>0?1:-1,h.push(se.x,se.y,se.z),d.push(Pe/S),d.push(1-de/M),H+=1}}for(let de=0;de<M;de++)for(let be=0;be<S;be++){const Pe=u+be+X*de,Oe=u+be+X*(de+1),ae=u+(be+1)+X*(de+1),Ae=u+(be+1)+X*de;l.push(Pe,Oe,Ae),l.push(Oe,ae,Ae),W+=6}a.addGroup(f,W,L),f+=W,u+=H}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new pn(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function mx(s){const e={};for(const t in s){e[t]={};for(const i in s[t]){const n=s[t][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=n.clone():Array.isArray(n)?e[t][i]=n.slice():e[t][i]=n}}return e}function ya(s){const e={};for(let t=0;t<s.length;t++){const i=mx(s[t]);for(const n in i)e[n]=i[n]}return e}function dhe(s){const e=[];for(let t=0;t<s.length;t++)e.push(s[t].clone());return e}function x8(s){const e=s.getRenderTarget();return e===null?s.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:ni.workingColorSpace}const Zx={clone:mx,merge:ya};var uhe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,phe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ht extends Yt{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=uhe,this.fragmentShader=phe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=mx(e.uniforms),this.uniformsGroups=dhe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const o=this.uniforms[n].value;o&&o.isTexture?t.uniforms[n]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[n]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[n]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[n]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[n]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[n]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[n]={type:"m4",value:o.toArray()}:t.uniforms[n]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const n in this.extensions)this.extensions[n]===!0&&(i[n]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}let x1=class extends ye{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ce,this.projectionMatrix=new ce,this.projectionMatrixInverse=new ce,this.coordinateSystem=Gc}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const Jp=new T,xW=new Q,vW=new Q;let Xt=class extends x1{constructor(e=50,t=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=fx*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(x0*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return fx*2*Math.atan(Math.tan(x0*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){Jp.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Jp.x,Jp.y).multiplyScalar(-e/Jp.z),Jp.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Jp.x,Jp.y).multiplyScalar(-e/Jp.z)}getViewSize(e,t){return this.getViewBounds(e,xW,vW),t.subVectors(vW,xW)}setViewOffset(e,t,i,n,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(x0*.5*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*n/l,t-=o.offsetY*i/c,n*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};const ry=-90,oy=1;class eB extends ye{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new Xt(ry,oy,e,t);n.layers=this.layers,this.add(n);const r=new Xt(ry,oy,e,t);r.layers=this.layers,this.add(r);const o=new Xt(ry,oy,e,t);o.layers=this.layers,this.add(o);const a=new Xt(ry,oy,e,t);a.layers=this.layers,this.add(a);const l=new Xt(ry,oy,e,t);l.layers=this.layers,this.add(l);const c=new Xt(ry,oy,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,n,r,o,a,l]=t;for(const c of t)this.remove(c);if(e===Gc)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===W0)i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:n}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,o,a,l,c,h]=this.children,d=e.getRenderTarget(),u=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),m=e.xr.enabled;e.xr.enabled=!1;const g=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,n),e.render(t,r),e.setRenderTarget(i,1,n),e.render(t,o),e.setRenderTarget(i,2,n),e.render(t,a),e.setRenderTarget(i,3,n),e.render(t,l),e.setRenderTarget(i,4,n),e.render(t,c),i.texture.generateMipmaps=g,e.setRenderTarget(i,5,n),e.render(t,h),e.setRenderTarget(d,u,f),e.xr.enabled=m,i.texture.needsPMREMUpdate=!0}}class hA extends si{constructor(e,t,i,n,r,o,a,l,c,h){e=e!==void 0?e:[],t=t!==void 0?t:jl,super(e,t,i,n,r,o,a,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class tB extends ci{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},n=[i,i,i,i,i,i];this.texture=new hA(n,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Ot}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new pn(5,5,5),r=new Ht({name:"CubemapFromEquirect",uniforms:mx(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:vn,blending:Fn});r.uniforms.tEquirect.value=t;const o=new fe(n,r),a=t.minFilter;return t.minFilter===xr&&(t.minFilter=Ot),new eB(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,n){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,n);e.setRenderTarget(r)}}const kG=new T,fhe=new T,mhe=new ei;let js=class{constructor(e=new T(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=kG.subVectors(i,t).cross(fhe.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(kG),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||mhe.getNormalMatrix(e),n=this.coplanarPoint(kG).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const ag=new Vn,_I=new T;let H0=class{constructor(e=new js,t=new js,i=new js,n=new js,r=new js,o=new js){this.planes=[e,t,i,n,r,o]}set(e,t,i,n,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Gc){const i=this.planes,n=e.elements,r=n[0],o=n[1],a=n[2],l=n[3],c=n[4],h=n[5],d=n[6],u=n[7],f=n[8],m=n[9],g=n[10],A=n[11],y=n[12],b=n[13],x=n[14],v=n[15];if(i[0].setComponents(l-r,u-c,A-f,v-y).normalize(),i[1].setComponents(l+r,u+c,A+f,v+y).normalize(),i[2].setComponents(l+o,u+h,A+m,v+b).normalize(),i[3].setComponents(l-o,u-h,A-m,v-b).normalize(),i[4].setComponents(l-a,u-d,A-g,v-x).normalize(),t===Gc)i[5].setComponents(l+a,u+d,A+g,v+x).normalize();else if(t===W0)i[5].setComponents(a,d,g,x).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),ag.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),ag.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(ag)}intersectsSprite(e){return ag.center.set(0,0,0),ag.radius=.7071067811865476,ag.applyMatrix4(e.matrixWorld),this.intersectsSphere(ag)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(_I.x=n.normal.x>0?e.max.x:e.min.x,_I.y=n.normal.y>0?e.max.y:e.min.y,_I.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(_I)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function v8(){let s=null,e=!1,t=null,i=null;function n(r,o){t(r,o),i=s.requestAnimationFrame(n)}return{start:function(){e!==!0&&t!==null&&(i=s.requestAnimationFrame(n),e=!0)},stop:function(){s.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){s=r}}}function ghe(s){const e=new WeakMap;function t(a,l){const c=a.array,h=a.usage,d=c.byteLength,u=s.createBuffer();s.bindBuffer(l,u),s.bufferData(l,c,h),a.onUploadCallback();let f;if(c instanceof Float32Array)f=s.FLOAT;else if(c instanceof Uint16Array)a.isFloat16BufferAttribute?f=s.HALF_FLOAT:f=s.UNSIGNED_SHORT;else if(c instanceof Int16Array)f=s.SHORT;else if(c instanceof Uint32Array)f=s.UNSIGNED_INT;else if(c instanceof Int32Array)f=s.INT;else if(c instanceof Int8Array)f=s.BYTE;else if(c instanceof Uint8Array)f=s.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)f=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:u,type:f,bytesPerElement:c.BYTES_PER_ELEMENT,version:a.version,size:d}}function i(a,l,c){const h=l.array,d=l.updateRanges;if(s.bindBuffer(c,a),d.length===0)s.bufferSubData(c,0,h);else{d.sort((f,m)=>f.start-m.start);let u=0;for(let f=1;f<d.length;f++){const m=d[u],g=d[f];g.start<=m.start+m.count+1?m.count=Math.max(m.count,g.start+g.count-m.start):(++u,d[u]=g)}d.length=u+1;for(let f=0,m=d.length;f<m;f++){const g=d[f];s.bufferSubData(c,g.start*h.BYTES_PER_ELEMENT,h,g.start,g.count)}l.clearUpdateRanges()}l.onUploadCallback()}function n(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function r(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=e.get(a);l&&(s.deleteBuffer(l.buffer),e.delete(a))}function o(a,l){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const h=e.get(a);(!h||h.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const c=e.get(a);if(c===void 0)e.set(a,t(a,l));else if(c.version<a.version){if(c.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(c.buffer,a,l),c.version=a.version}}return{get:n,remove:r,update:o}}class Rs extends It{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};const r=e/2,o=t/2,a=Math.floor(i),l=Math.floor(n),c=a+1,h=l+1,d=e/a,u=t/l,f=[],m=[],g=[],A=[];for(let y=0;y<h;y++){const b=y*u-o;for(let x=0;x<c;x++){const v=x*d-r;m.push(v,-b,0),g.push(0,0,1),A.push(x/a),A.push(1-y/l)}}for(let y=0;y<l;y++)for(let b=0;b<a;b++){const x=b+c*y,v=b+c*(y+1),_=b+1+c*(y+1),C=b+1+c*y;f.push(x,v,C),f.push(v,_,C)}this.setIndex(f),this.setAttribute("position",new ut(m,3)),this.setAttribute("normal",new ut(g,3)),this.setAttribute("uv",new ut(A,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Rs(e.width,e.height,e.widthSegments,e.heightSegments)}}var Ahe=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,yhe=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,bhe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,xhe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,vhe=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,_he=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Che=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,whe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,She=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,Mhe=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,Ihe=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,The=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Ehe=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Rhe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Lhe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Bhe=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,Phe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Ghe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,khe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Nhe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Dhe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Fhe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,Vhe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,zhe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Uhe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Xhe=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Ohe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Zhe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Whe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Hhe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Qhe="gl_FragColor = linearToOutputTexel( gl_FragColor );",Khe=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Yhe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Jhe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,jhe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,qhe=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,$he=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,ede=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,tde=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,ide=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,nde=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,sde=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,rde=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,ode=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,ade=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lde=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,cde=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,hde=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,dde=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,ude=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,pde=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,fde=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,mde=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,gde=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Ade=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,yde=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,bde=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,xde=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,vde=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,_de=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,Cde=`#ifdef USE_MAP
#ifdef USE_MIPMAP_BIAS
    vec4 sampledDiffuseColor = texture2D( map, vMapUv, mipmapBias );
#else
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
#endif
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,wde=`#ifdef USE_MAP
	uniform sampler2D map;
        
#ifdef USE_MIPMAP_BIAS
    uniform float mipmapBias;
#endif
#endif`,Sde=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Mde=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Ide=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Tde=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Ede=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,Rde=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Lde=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Bde=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,Pde=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Gde=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,kde=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Nde=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Dde=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Fde=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Vde=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,zde=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Ude=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Xde=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Ode=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Zde=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Wde=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Hde=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Qde=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Kde=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Yde=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Jde=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,jde=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,qde=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,$de=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,eue=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,tue=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,iue=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,nue=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,sue=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,rue=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,oue=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,aue=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,lue=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,cue=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,hue=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,due=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uue=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,pue=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,fue=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,mue=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const gue=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Aue=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,yue=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,bue=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,xue=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,vue=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,_ue=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Cue=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,wue=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Sue=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Mue=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Iue=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Tue=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Eue=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Rue=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Lue=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Bue=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Pue=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Gue=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,kue=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Nue=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Due=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Fue=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Vue=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,zue=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Uue=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Xue=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Oue=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Zue=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Wue=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Hue=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Que=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Kue=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Yue=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Ut={alphahash_fragment:Ahe,alphahash_pars_fragment:yhe,alphamap_fragment:bhe,alphamap_pars_fragment:xhe,alphatest_fragment:vhe,alphatest_pars_fragment:_he,aomap_fragment:Che,aomap_pars_fragment:whe,batching_pars_vertex:She,batching_vertex:Mhe,begin_vertex:Ihe,beginnormal_vertex:The,bsdfs:Ehe,iridescence_fragment:Rhe,bumpmap_pars_fragment:Lhe,clipping_planes_fragment:Bhe,clipping_planes_pars_fragment:Phe,clipping_planes_pars_vertex:Ghe,clipping_planes_vertex:khe,color_fragment:Nhe,color_pars_fragment:Dhe,color_pars_vertex:Fhe,color_vertex:Vhe,common:zhe,cube_uv_reflection_fragment:Uhe,defaultnormal_vertex:Xhe,displacementmap_pars_vertex:Ohe,displacementmap_vertex:Zhe,emissivemap_fragment:Whe,emissivemap_pars_fragment:Hhe,colorspace_fragment:Qhe,colorspace_pars_fragment:Khe,envmap_fragment:Yhe,envmap_common_pars_fragment:Jhe,envmap_pars_fragment:jhe,envmap_pars_vertex:qhe,envmap_physical_pars_fragment:cde,envmap_vertex:$he,fog_vertex:ede,fog_pars_vertex:tde,fog_fragment:ide,fog_pars_fragment:nde,gradientmap_pars_fragment:sde,lightmap_pars_fragment:rde,lights_lambert_fragment:ode,lights_lambert_pars_fragment:ade,lights_pars_begin:lde,lights_toon_fragment:hde,lights_toon_pars_fragment:dde,lights_phong_fragment:ude,lights_phong_pars_fragment:pde,lights_physical_fragment:fde,lights_physical_pars_fragment:mde,lights_fragment_begin:gde,lights_fragment_maps:Ade,lights_fragment_end:yde,logdepthbuf_fragment:bde,logdepthbuf_pars_fragment:xde,logdepthbuf_pars_vertex:vde,logdepthbuf_vertex:_de,map_fragment:Cde,map_pars_fragment:wde,map_particle_fragment:Sde,map_particle_pars_fragment:Mde,metalnessmap_fragment:Ide,metalnessmap_pars_fragment:Tde,morphinstance_vertex:Ede,morphcolor_vertex:Rde,morphnormal_vertex:Lde,morphtarget_pars_vertex:Bde,morphtarget_vertex:Pde,normal_fragment_begin:Gde,normal_fragment_maps:kde,normal_pars_fragment:Nde,normal_pars_vertex:Dde,normal_vertex:Fde,normalmap_pars_fragment:Vde,clearcoat_normal_fragment_begin:zde,clearcoat_normal_fragment_maps:Ude,clearcoat_pars_fragment:Xde,iridescence_pars_fragment:Ode,opaque_fragment:Zde,packing:Wde,premultiplied_alpha_fragment:Hde,project_vertex:Qde,dithering_fragment:Kde,dithering_pars_fragment:Yde,roughnessmap_fragment:Jde,roughnessmap_pars_fragment:jde,shadowmap_pars_fragment:qde,shadowmap_pars_vertex:$de,shadowmap_vertex:eue,shadowmask_pars_fragment:tue,skinbase_vertex:iue,skinning_pars_vertex:nue,skinning_vertex:sue,skinnormal_vertex:rue,specularmap_fragment:oue,specularmap_pars_fragment:aue,tonemapping_fragment:lue,tonemapping_pars_fragment:cue,transmission_fragment:hue,transmission_pars_fragment:due,uv_pars_fragment:uue,uv_pars_vertex:pue,uv_vertex:fue,worldpos_vertex:mue,background_vert:gue,background_frag:Aue,backgroundCube_vert:yue,backgroundCube_frag:bue,cube_vert:xue,cube_frag:vue,depth_vert:_ue,depth_frag:Cue,distanceRGBA_vert:wue,distanceRGBA_frag:Sue,equirect_vert:Mue,equirect_frag:Iue,linedashed_vert:Tue,linedashed_frag:Eue,meshbasic_vert:Rue,meshbasic_frag:Lue,meshlambert_vert:Bue,meshlambert_frag:Pue,meshmatcap_vert:Gue,meshmatcap_frag:kue,meshnormal_vert:Nue,meshnormal_frag:Due,meshphong_vert:Fue,meshphong_frag:Vue,meshphysical_vert:zue,meshphysical_frag:Uue,meshtoon_vert:Xue,meshtoon_frag:Oue,points_vert:Zue,points_frag:Wue,shadow_vert:Hue,shadow_frag:Que,sprite_vert:Kue,sprite_frag:Yue},ht={common:{diffuse:{value:new ge(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new ei},alphaMap:{value:null},alphaMapTransform:{value:new ei},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new ei}},envmap:{envMap:{value:null},envMapRotation:{value:new ei},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new ei}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new ei}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new ei},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new ei},normalScale:{value:new Q(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new ei},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new ei}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new ei}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new ei}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ge(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ge(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new ei},alphaTest:{value:0},uvTransform:{value:new ei}},sprite:{diffuse:{value:new ge(16777215)},opacity:{value:1},center:{value:new Q(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new ei},alphaMap:{value:null},alphaMapTransform:{value:new ei},alphaTest:{value:0}}},Wn={basic:{uniforms:ya([ht.common,ht.specularmap,ht.envmap,ht.aomap,ht.lightmap,ht.fog]),vertexShader:Ut.meshbasic_vert,fragmentShader:Ut.meshbasic_frag},lambert:{uniforms:ya([ht.common,ht.specularmap,ht.envmap,ht.aomap,ht.lightmap,ht.emissivemap,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.fog,ht.lights,{emissive:{value:new ge(0)}}]),vertexShader:Ut.meshlambert_vert,fragmentShader:Ut.meshlambert_frag},phong:{uniforms:ya([ht.common,ht.specularmap,ht.envmap,ht.aomap,ht.lightmap,ht.emissivemap,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.fog,ht.lights,{emissive:{value:new ge(0)},specular:{value:new ge(1118481)},shininess:{value:30}}]),vertexShader:Ut.meshphong_vert,fragmentShader:Ut.meshphong_frag},standard:{uniforms:ya([ht.common,ht.envmap,ht.aomap,ht.lightmap,ht.emissivemap,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.roughnessmap,ht.metalnessmap,ht.fog,ht.lights,{emissive:{value:new ge(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ut.meshphysical_vert,fragmentShader:Ut.meshphysical_frag},toon:{uniforms:ya([ht.common,ht.aomap,ht.lightmap,ht.emissivemap,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.gradientmap,ht.fog,ht.lights,{emissive:{value:new ge(0)}}]),vertexShader:Ut.meshtoon_vert,fragmentShader:Ut.meshtoon_frag},matcap:{uniforms:ya([ht.common,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.fog,{matcap:{value:null}}]),vertexShader:Ut.meshmatcap_vert,fragmentShader:Ut.meshmatcap_frag},points:{uniforms:ya([ht.points,ht.fog]),vertexShader:Ut.points_vert,fragmentShader:Ut.points_frag},dashed:{uniforms:ya([ht.common,ht.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ut.linedashed_vert,fragmentShader:Ut.linedashed_frag},depth:{uniforms:ya([ht.common,ht.displacementmap]),vertexShader:Ut.depth_vert,fragmentShader:Ut.depth_frag},normal:{uniforms:ya([ht.common,ht.bumpmap,ht.normalmap,ht.displacementmap,{opacity:{value:1}}]),vertexShader:Ut.meshnormal_vert,fragmentShader:Ut.meshnormal_frag},sprite:{uniforms:ya([ht.sprite,ht.fog]),vertexShader:Ut.sprite_vert,fragmentShader:Ut.sprite_frag},background:{uniforms:{uvTransform:{value:new ei},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ut.background_vert,fragmentShader:Ut.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new ei}},vertexShader:Ut.backgroundCube_vert,fragmentShader:Ut.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ut.cube_vert,fragmentShader:Ut.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ut.equirect_vert,fragmentShader:Ut.equirect_frag},distanceRGBA:{uniforms:ya([ht.common,ht.displacementmap,{referencePosition:{value:new T},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ut.distanceRGBA_vert,fragmentShader:Ut.distanceRGBA_frag},shadow:{uniforms:ya([ht.lights,ht.fog,{color:{value:new ge(0)},opacity:{value:1}}]),vertexShader:Ut.shadow_vert,fragmentShader:Ut.shadow_frag}};Wn.physical={uniforms:ya([Wn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new ei},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new ei},clearcoatNormalScale:{value:new Q(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new ei},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new ei},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new ei},sheen:{value:0},sheenColor:{value:new ge(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new ei},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new ei},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new ei},transmissionSamplerSize:{value:new Q},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new ei},attenuationDistance:{value:0},attenuationColor:{value:new ge(0)},specularColor:{value:new ge(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new ei},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new ei},anisotropyVector:{value:new Q},anisotropyMap:{value:null},anisotropyMapTransform:{value:new ei}}]),vertexShader:Ut.meshphysical_vert,fragmentShader:Ut.meshphysical_frag};const CI={r:0,b:0,g:0},lg=new Xi,Jue=new ce;function jue(s,e,t,i,n,r,o){const a=new ge(0);let l=r===!0?0:1,c,h,d=null,u=0,f=null;function m(b){let x=b.isScene===!0?b.background:null;return x&&x.isTexture&&(x=(b.backgroundBlurriness>0?t:e).get(x)),x}function g(b){let x=!1;const v=m(b);v===null?y(a,l):v&&v.isColor&&(y(v,1),x=!0);const _=s.xr.getEnvironmentBlendMode();_==="additive"?i.buffers.color.setClear(0,0,0,1,o):_==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(s.autoClear||x)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil))}function A(b,x){const v=m(x);v&&(v.isCubeTexture||v.mapping===cA)?(h===void 0&&(h=new fe(new pn(1,1,1),new Ht({name:"BackgroundCubeMaterial",uniforms:mx(Wn.backgroundCube.uniforms),vertexShader:Wn.backgroundCube.vertexShader,fragmentShader:Wn.backgroundCube.fragmentShader,side:vn,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(_,C,S){this.matrixWorld.copyPosition(S.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h)),lg.copy(x.backgroundRotation),lg.x*=-1,lg.y*=-1,lg.z*=-1,v.isCubeTexture&&v.isRenderTargetTexture===!1&&(lg.y*=-1,lg.z*=-1),h.material.uniforms.envMap.value=v,h.material.uniforms.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(Jue.makeRotationFromEuler(lg)),h.material.toneMapped=ni.getTransfer(v.colorSpace)!==Ln,(d!==v||u!==v.version||f!==s.toneMapping)&&(h.material.needsUpdate=!0,d=v,u=v.version,f=s.toneMapping),h.layers.enableAll(),b.unshift(h,h.geometry,h.material,0,0,null)):v&&v.isTexture&&(c===void 0&&(c=new fe(new Rs(2,2),new Ht({name:"BackgroundMaterial",uniforms:mx(Wn.background.uniforms),vertexShader:Wn.background.vertexShader,fragmentShader:Wn.background.fragmentShader,side:us,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=v,c.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,c.material.toneMapped=ni.getTransfer(v.colorSpace)!==Ln,v.matrixAutoUpdate===!0&&v.updateMatrix(),c.material.uniforms.uvTransform.value.copy(v.matrix),(d!==v||u!==v.version||f!==s.toneMapping)&&(c.material.needsUpdate=!0,d=v,u=v.version,f=s.toneMapping),c.layers.enableAll(),b.unshift(c,c.geometry,c.material,0,0,null))}function y(b,x){b.getRGB(CI,x8(s)),i.buffers.color.setClear(CI.r,CI.g,CI.b,x,o)}return{getClearColor:function(){return a},setClearColor:function(b,x=1){a.set(b),l=x,y(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(b){l=b,y(a,l)},render:g,addToRenderList:A}}function que(s,e){const t=s.getParameter(s.MAX_VERTEX_ATTRIBS),i={},n=u(null);let r=n,o=!1;function a(w,E,B,P,k){let X=!1;const F=d(P,B,E);r!==F&&(r=F,c(r.object)),X=f(w,P,B,k),X&&m(w,P,B,k),k!==null&&e.update(k,s.ELEMENT_ARRAY_BUFFER),(X||o)&&(o=!1,v(w,E,B,P),k!==null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.get(k).buffer))}function l(){return s.createVertexArray()}function c(w){return s.bindVertexArray(w)}function h(w){return s.deleteVertexArray(w)}function d(w,E,B){const P=B.wireframe===!0;let k=i[w.id];k===void 0&&(k={},i[w.id]=k);let X=k[E.id];X===void 0&&(X={},k[E.id]=X);let F=X[P];return F===void 0&&(F=u(l()),X[P]=F),F}function u(w){const E=[],B=[],P=[];for(let k=0;k<t;k++)E[k]=0,B[k]=0,P[k]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:E,enabledAttributes:B,attributeDivisors:P,object:w,attributes:{},index:null}}function f(w,E,B,P){const k=r.attributes,X=E.attributes;let F=0;const H=B.getAttributes();for(const W in H)if(H[W].location>=0){const de=k[W];let be=X[W];if(be===void 0&&(W==="instanceMatrix"&&w.instanceMatrix&&(be=w.instanceMatrix),W==="instanceColor"&&w.instanceColor&&(be=w.instanceColor)),de===void 0||de.attribute!==be||be&&de.data!==be.data)return!0;F++}return r.attributesNum!==F||r.index!==P}function m(w,E,B,P){const k={},X=E.attributes;let F=0;const H=B.getAttributes();for(const W in H)if(H[W].location>=0){let de=X[W];de===void 0&&(W==="instanceMatrix"&&w.instanceMatrix&&(de=w.instanceMatrix),W==="instanceColor"&&w.instanceColor&&(de=w.instanceColor));const be={};be.attribute=de,de&&de.data&&(be.data=de.data),k[W]=be,F++}r.attributes=k,r.attributesNum=F,r.index=P}function g(){const w=r.newAttributes;for(let E=0,B=w.length;E<B;E++)w[E]=0}function A(w){y(w,0)}function y(w,E){const B=r.newAttributes,P=r.enabledAttributes,k=r.attributeDivisors;B[w]=1,P[w]===0&&(s.enableVertexAttribArray(w),P[w]=1),k[w]!==E&&(s.vertexAttribDivisor(w,E),k[w]=E)}function b(){const w=r.newAttributes,E=r.enabledAttributes;for(let B=0,P=E.length;B<P;B++)E[B]!==w[B]&&(s.disableVertexAttribArray(B),E[B]=0)}function x(w,E,B,P,k,X,F){F===!0?s.vertexAttribIPointer(w,E,B,k,X):s.vertexAttribPointer(w,E,B,P,k,X)}function v(w,E,B,P){g();const k=P.attributes,X=B.getAttributes(),F=E.defaultAttributeValues;for(const H in X){const W=X[H];if(W.location>=0){let se=k[H];if(se===void 0&&(H==="instanceMatrix"&&w.instanceMatrix&&(se=w.instanceMatrix),H==="instanceColor"&&w.instanceColor&&(se=w.instanceColor)),se!==void 0){const de=se.normalized,be=se.itemSize,Pe=e.get(se);if(Pe===void 0)continue;const Oe=Pe.buffer,ae=Pe.type,Ae=Pe.bytesPerElement,Se=ae===s.INT||ae===s.UNSIGNED_INT||se.gpuType===Dd;if(se.isInterleavedBufferAttribute){const Le=se.data,st=Le.stride,ot=se.offset;if(Le.isInstancedInterleavedBuffer){for(let Ct=0;Ct<W.locationSize;Ct++)y(W.location+Ct,Le.meshPerAttribute);w.isInstancedMesh!==!0&&P._maxInstanceCount===void 0&&(P._maxInstanceCount=Le.meshPerAttribute*Le.count)}else for(let Ct=0;Ct<W.locationSize;Ct++)A(W.location+Ct);s.bindBuffer(s.ARRAY_BUFFER,Oe);for(let Ct=0;Ct<W.locationSize;Ct++)x(W.location+Ct,be/W.locationSize,ae,de,st*Ae,(ot+be/W.locationSize*Ct)*Ae,Se)}else{if(se.isInstancedBufferAttribute){for(let Le=0;Le<W.locationSize;Le++)y(W.location+Le,se.meshPerAttribute);w.isInstancedMesh!==!0&&P._maxInstanceCount===void 0&&(P._maxInstanceCount=se.meshPerAttribute*se.count)}else for(let Le=0;Le<W.locationSize;Le++)A(W.location+Le);s.bindBuffer(s.ARRAY_BUFFER,Oe);for(let Le=0;Le<W.locationSize;Le++)x(W.location+Le,be/W.locationSize,ae,de,be*Ae,be/W.locationSize*Le*Ae,Se)}}else if(F!==void 0){const de=F[H];if(de!==void 0)switch(de.length){case 2:s.vertexAttrib2fv(W.location,de);break;case 3:s.vertexAttrib3fv(W.location,de);break;case 4:s.vertexAttrib4fv(W.location,de);break;default:s.vertexAttrib1fv(W.location,de)}}}}b()}function _(){M();for(const w in i){const E=i[w];for(const B in E){const P=E[B];for(const k in P)h(P[k].object),delete P[k];delete E[B]}delete i[w]}}function C(w){if(i[w.id]===void 0)return;const E=i[w.id];for(const B in E){const P=E[B];for(const k in P)h(P[k].object),delete P[k];delete E[B]}delete i[w.id]}function S(w){for(const E in i){const B=i[E];if(B[w.id]===void 0)continue;const P=B[w.id];for(const k in P)h(P[k].object),delete P[k];delete B[w.id]}}function M(){L(),o=!0,r!==n&&(r=n,c(r.object))}function L(){n.geometry=null,n.program=null,n.wireframe=!1}return{setup:a,reset:M,resetDefaultState:L,dispose:_,releaseStatesOfGeometry:C,releaseStatesOfProgram:S,initAttributes:g,enableAttribute:A,disableUnusedAttributes:b}}function $ue(s,e,t){let i;function n(c){i=c}function r(c,h){s.drawArrays(i,c,h),t.update(h,i,1)}function o(c,h,d){d!==0&&(s.drawArraysInstanced(i,c,h,d),t.update(h,i,d))}function a(c,h,d){if(d===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,c,0,h,0,d);let f=0;for(let m=0;m<d;m++)f+=h[m];t.update(f,i,1)}function l(c,h,d,u){if(d===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let m=0;m<c.length;m++)o(c[m],h[m],u[m]);else{f.multiDrawArraysInstancedWEBGL(i,c,0,h,0,u,0,d);let m=0;for(let g=0;g<d;g++)m+=h[g];for(let g=0;g<u.length;g++)t.update(m,i,u[g])}}this.setMode=n,this.render=r,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function epe(s,e,t,i){let n;function r(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const S=e.get("EXT_texture_filter_anisotropic");n=s.getParameter(S.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function o(S){return!(S!==bi&&i.convert(S)!==s.getParameter(s.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(S){const M=S===Wi&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(S!==Pi&&i.convert(S)!==s.getParameter(s.IMPLEMENTATION_COLOR_READ_TYPE)&&S!==$i&&!M)}function l(S){if(S==="highp"){if(s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision>0)return"highp";S="mediump"}return S==="mediump"&&s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const h=l(c);h!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",h,"instead."),c=h);const d=t.logarithmicDepthBuffer===!0,u=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control");if(u===!0){const S=e.get("EXT_clip_control");S.clipControlEXT(S.LOWER_LEFT_EXT,S.ZERO_TO_ONE_EXT)}const f=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),m=s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS),g=s.getParameter(s.MAX_TEXTURE_SIZE),A=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE),y=s.getParameter(s.MAX_VERTEX_ATTRIBS),b=s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS),x=s.getParameter(s.MAX_VARYING_VECTORS),v=s.getParameter(s.MAX_FRAGMENT_UNIFORM_VECTORS),_=m>0,C=s.getParameter(s.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:r,getMaxPrecision:l,textureFormatReadable:o,textureTypeReadable:a,precision:c,logarithmicDepthBuffer:d,reverseDepthBuffer:u,maxTextures:f,maxVertexTextures:m,maxTextureSize:g,maxCubemapSize:A,maxAttributes:y,maxVertexUniforms:b,maxVaryings:x,maxFragmentUniforms:v,vertexTextures:_,maxSamples:C}}function tpe(s){const e=this;let t=null,i=0,n=!1,r=!1;const o=new js,a=new ei,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,u){const f=d.length!==0||u||i!==0||n;return n=u,i=d.length,f},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(d,u){t=h(d,u,0)},this.setState=function(d,u,f){const m=d.clippingPlanes,g=d.clipIntersection,A=d.clipShadows,y=s.get(d);if(!n||m===null||m.length===0||r&&!A)r?h(null):c();else{const b=r?0:i,x=b*4;let v=y.clippingState||null;l.value=v,v=h(m,u,x,f);for(let _=0;_!==x;++_)v[_]=t[_];y.clippingState=v,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=b}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function h(d,u,f,m){const g=d!==null?d.length:0;let A=null;if(g!==0){if(A=l.value,m!==!0||A===null){const y=f+g*4,b=u.matrixWorldInverse;a.getNormalMatrix(b),(A===null||A.length<y)&&(A=new Float32Array(y));for(let x=0,v=f;x!==g;++x,v+=4)o.copy(d[x]).applyMatrix4(b,a),o.normal.toArray(A,v),A[v+3]=o.constant}l.value=A,l.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,A}}function ipe(s){let e=new WeakMap;function t(o,a){return a===wo?o.mapping=jl:a===am&&(o.mapping=zc),o}function i(o){if(o&&o.isTexture){const a=o.mapping;if(a===wo||a===am)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new tB(l.height);return c.fromEquirectangularTexture(s,o),e.set(o,c),o.addEventListener("dispose",n),t(c.texture,o.mapping)}else return null}}return o}function n(o){const a=o.target;a.removeEventListener("dispose",n);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function r(){e=new WeakMap}return{get:i,dispose:r}}let zh=class extends x1{constructor(e=-1,t=1,i=1,n=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-e,o=i+e,a=n+t,l=n-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};const vb=4,_W=[.125,.215,.35,.446,.526,.582],Yg=20,NG=new zh,CW=new ge;let DG=null,FG=0,VG=0,zG=!1;const Wg=(1+Math.sqrt(5))/2,ay=1/Wg,wW=[new T(-Wg,ay,0),new T(Wg,ay,0),new T(-ay,0,Wg),new T(ay,0,Wg),new T(0,Wg,-ay),new T(0,Wg,ay),new T(-1,1,-1),new T(1,1,-1),new T(-1,1,1),new T(1,1,1)];let OF=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){DG=this._renderer.getRenderTarget(),FG=this._renderer.getActiveCubeFace(),VG=this._renderer.getActiveMipmapLevel(),zG=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=TW(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=IW(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(DG,FG,VG),this._renderer.xr.enabled=zG,e.scissorTest=!1,wI(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===jl||e.mapping===zc?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),DG=this._renderer.getRenderTarget(),FG=this._renderer.getActiveCubeFace(),VG=this._renderer.getActiveMipmapLevel(),zG=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Ot,minFilter:Ot,generateMipmaps:!1,type:Wi,format:bi,colorSpace:Ji,depthBuffer:!1},n=MW(e,t,i),{_lodMax:r}=this;if({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=SW(r),this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=MW(e,t,i);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=SW(o)),this._blurMaterial=npe(o,e,t)}return n}_compileMaterial(e){const t=new fe(this._lodPlanes[0],e);this._renderer.compile(t,NG)}_sceneToCubeUV(e,t,i,n){const a=new Xt(90,1,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,u=h.toneMapping;h.getClearColor(CW),h.toneMapping=Zr,h.autoClear=!1;const f=new ii({name:"PMREM.Background",side:vn,depthWrite:!1,depthTest:!1}),m=new fe(new pn,f);let g=!1;const A=e.background;A?A.isColor&&(f.color.copy(A),e.background=null,g=!0):(f.color.copy(CW),g=!0);for(let y=0;y<6;y++){const b=y%3;b===0?(a.up.set(0,l[y],0),a.lookAt(c[y],0,0)):b===1?(a.up.set(0,0,l[y]),a.lookAt(0,c[y],0)):(a.up.set(0,l[y],0),a.lookAt(0,0,c[y]));const x=this._cubeSize;wI(n,b*x,y>2?x:0,x,x),h.setRenderTarget(n),g&&h.render(m,a),h.render(e,a)}m.geometry.dispose(),m.material.dispose(),h.toneMapping=u,h.autoClear=d,e.background=A}_textureToCubeUV(e,t){const i=this._renderer,n=e.mapping===jl||e.mapping===zc;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=TW()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=IW());const r=n?this._cubemapMaterial:this._equirectMaterial,o=new fe(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=e;const l=this._cubeSize;wI(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,NG)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const n=this._lodPlanes.length;for(let r=1;r<n;r++){const o=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),a=wW[(n-r-1)%wW.length];this._blur(e,r-1,r,o,a)}t.autoClear=i}_blur(e,t,i,n,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,n,"latitudinal",r),this._halfBlur(o,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,d=new fe(this._lodPlanes[n],c),u=c.uniforms,f=this._sizeLods[i]-1,m=isFinite(r)?Math.PI/(2*f):2*Math.PI/(2*Yg-1),g=r/m,A=isFinite(r)?1+Math.floor(h*g):Yg;A>Yg&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${A} samples when the maximum is set to ${Yg}`);const y=[];let b=0;for(let S=0;S<Yg;++S){const M=S/g,L=Math.exp(-M*M/2);y.push(L),S===0?b+=L:S<A&&(b+=2*L)}for(let S=0;S<y.length;S++)y[S]=y[S]/b;u.envMap.value=e.texture,u.samples.value=A,u.weights.value=y,u.latitudinal.value=o==="latitudinal",a&&(u.poleAxis.value=a);const{_lodMax:x}=this;u.dTheta.value=m,u.mipInt.value=x-i;const v=this._sizeLods[n],_=3*v*(n>x-vb?n-x+vb:0),C=4*(this._cubeSize-v);wI(t,_,C,3*v,2*v),l.setRenderTarget(t),l.render(d,NG)}};function SW(s){const e=[],t=[],i=[];let n=s;const r=s-vb+1+_W.length;for(let o=0;o<r;o++){const a=Math.pow(2,n);t.push(a);let l=1/a;o>s-vb?l=_W[o-s+vb-1]:o===0&&(l=0),i.push(l);const c=1/(a-2),h=-c,d=1+c,u=[h,h,d,h,d,d,h,h,d,d,h,d],f=6,m=6,g=3,A=2,y=1,b=new Float32Array(g*m*f),x=new Float32Array(A*m*f),v=new Float32Array(y*m*f);for(let C=0;C<f;C++){const S=C%3*2/3-1,M=C>2?0:-1,L=[S,M,0,S+2/3,M,0,S+2/3,M+1,0,S,M,0,S+2/3,M+1,0,S,M+1,0];b.set(L,g*m*C),x.set(u,A*m*C);const w=[C,C,C,C,C,C];v.set(w,y*m*C)}const _=new It;_.setAttribute("position",new dt(b,g)),_.setAttribute("uv",new dt(x,A)),_.setAttribute("faceIndex",new dt(v,y)),e.push(_),n>vb&&n--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function MW(s,e,t){const i=new ci(s,e,t);return i.texture.mapping=cA,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function wI(s,e,t,i,n){s.viewport.set(e,t,i,n),s.scissor.set(e,t,i,n)}function npe(s,e,t){const i=new Float32Array(Yg),n=new T(0,1,0);return new Ht({name:"SphericalGaussianBlur",defines:{n:Yg,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${s}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:DU(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Fn,depthTest:!1,depthWrite:!1})}function IW(){return new Ht({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:DU(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Fn,depthTest:!1,depthWrite:!1})}function TW(){return new Ht({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:DU(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Fn,depthTest:!1,depthWrite:!1})}function DU(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function spe(s){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const l=a.mapping,c=l===wo||l===am,h=l===jl||l===zc;if(c||h){let d=e.get(a);const u=d!==void 0?d.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==u)return t===null&&(t=new OF(s)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),d.texture;if(d!==void 0)return d.texture;{const f=a.image;return c&&f&&f.height>0||h&&f&&n(f)?(t=new OF(s),d=c?t.fromEquirectangular(a):t.fromCubemap(a),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),a.addEventListener("dispose",r),d.texture):null}}}return a}function n(a){let l=0;const c=6;for(let h=0;h<c;h++)a[h]!==void 0&&l++;return l===c}function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:o}}function rpe(s){const e={};function t(i){if(e[i]!==void 0)return e[i];let n;switch(i){case"WEBGL_depth_texture":n=s.getExtension("WEBGL_depth_texture")||s.getExtension("MOZ_WEBGL_depth_texture")||s.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=s.getExtension("WEBGL_compressed_texture_s3tc")||s.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=s.getExtension("WEBGL_compressed_texture_pvrtc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=s.getExtension(i)}return e[i]=n,n}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const n=t(i);return n===null&&dR("THREE.WebGLRenderer: "+i+" extension not supported."),n}}}function ope(s,e,t,i){const n={},r=new WeakMap;function o(d){const u=d.target;u.index!==null&&e.remove(u.index);for(const m in u.attributes)e.remove(u.attributes[m]);for(const m in u.morphAttributes){const g=u.morphAttributes[m];for(let A=0,y=g.length;A<y;A++)e.remove(g[A])}u.removeEventListener("dispose",o),delete n[u.id];const f=r.get(u);f&&(e.remove(f),r.delete(u)),i.releaseStatesOfGeometry(u),u.isInstancedBufferGeometry===!0&&delete u._maxInstanceCount,t.memory.geometries--}function a(d,u){return n[u.id]===!0||(u.addEventListener("dispose",o),n[u.id]=!0,t.memory.geometries++),u}function l(d){const u=d.attributes;for(const m in u)e.update(u[m],s.ARRAY_BUFFER);const f=d.morphAttributes;for(const m in f){const g=f[m];for(let A=0,y=g.length;A<y;A++)e.update(g[A],s.ARRAY_BUFFER)}}function c(d){const u=[],f=d.index,m=d.attributes.position;let g=0;if(f!==null){const b=f.array;g=f.version;for(let x=0,v=b.length;x<v;x+=3){const _=b[x+0],C=b[x+1],S=b[x+2];u.push(_,C,C,S,S,_)}}else if(m!==void 0){const b=m.array;g=m.version;for(let x=0,v=b.length/3-1;x<v;x+=3){const _=x+0,C=x+1,S=x+2;u.push(_,C,C,S,S,_)}}else return;const A=new(d8(u)?NU:$2)(u,1);A.version=g;const y=r.get(d);y&&e.remove(y),r.set(d,A)}function h(d){const u=r.get(d);if(u){const f=d.index;f!==null&&u.version<f.version&&c(d)}else c(d);return r.get(d)}return{get:a,update:l,getWireframeAttribute:h}}function ape(s,e,t){let i;function n(u){i=u}let r,o;function a(u){r=u.type,o=u.bytesPerElement}function l(u,f){s.drawElements(i,f,r,u*o),t.update(f,i,1)}function c(u,f,m){m!==0&&(s.drawElementsInstanced(i,f,r,u*o,m),t.update(f,i,m))}function h(u,f,m){if(m===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,f,0,r,u,0,m);let A=0;for(let y=0;y<m;y++)A+=f[y];t.update(A,i,1)}function d(u,f,m,g){if(m===0)return;const A=e.get("WEBGL_multi_draw");if(A===null)for(let y=0;y<u.length;y++)c(u[y]/o,f[y],g[y]);else{A.multiDrawElementsInstancedWEBGL(i,f,0,r,u,0,g,0,m);let y=0;for(let b=0;b<m;b++)y+=f[b];for(let b=0;b<g.length;b++)t.update(y,i,g[b])}}this.setMode=n,this.setIndex=a,this.render=l,this.renderInstances=c,this.renderMultiDraw=h,this.renderMultiDrawInstances=d}function lpe(s){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(r,o,a){switch(t.calls++,o){case s.TRIANGLES:t.triangles+=a*(r/3);break;case s.LINES:t.lines+=a*(r/2);break;case s.LINE_STRIP:t.lines+=a*(r-1);break;case s.LINE_LOOP:t.lines+=a*r;break;case s.POINTS:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function n(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:n,update:i}}function cpe(s,e,t){const i=new WeakMap,n=new Je;function r(o,a,l){const c=o.morphTargetInfluences,h=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,d=h!==void 0?h.length:0;let u=i.get(a);if(u===void 0||u.count!==d){let L=function(){S.dispose(),i.delete(a),a.removeEventListener("dispose",L)};u!==void 0&&u.texture.dispose();const f=a.morphAttributes.position!==void 0,m=a.morphAttributes.normal!==void 0,g=a.morphAttributes.color!==void 0,A=a.morphAttributes.position||[],y=a.morphAttributes.normal||[],b=a.morphAttributes.color||[];let x=0;f===!0&&(x=1),m===!0&&(x=2),g===!0&&(x=3);let v=a.attributes.position.count*x,_=1;v>e.maxTextureSize&&(_=Math.ceil(v/e.maxTextureSize),v=e.maxTextureSize);const C=new Float32Array(v*_*4*d),S=new b1(C,v,_,d);S.type=$i,S.needsUpdate=!0;const M=x*4;for(let w=0;w<d;w++){const E=A[w],B=y[w],P=b[w],k=v*_*4*w;for(let X=0;X<E.count;X++){const F=X*M;f===!0&&(n.fromBufferAttribute(E,X),C[k+F+0]=n.x,C[k+F+1]=n.y,C[k+F+2]=n.z,C[k+F+3]=0),m===!0&&(n.fromBufferAttribute(B,X),C[k+F+4]=n.x,C[k+F+5]=n.y,C[k+F+6]=n.z,C[k+F+7]=0),g===!0&&(n.fromBufferAttribute(P,X),C[k+F+8]=n.x,C[k+F+9]=n.y,C[k+F+10]=n.z,C[k+F+11]=P.itemSize===4?n.w:1)}}u={count:d,texture:S,size:new Q(v,_)},i.set(a,u),a.addEventListener("dispose",L)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)l.getUniforms().setValue(s,"morphTexture",o.morphTexture,t);else{let f=0;for(let g=0;g<c.length;g++)f+=c[g];const m=a.morphTargetsRelative?1:1-f;l.getUniforms().setValue(s,"morphTargetBaseInfluence",m),l.getUniforms().setValue(s,"morphTargetInfluences",c)}l.getUniforms().setValue(s,"morphTargetsTexture",u.texture,t),l.getUniforms().setValue(s,"morphTargetsTextureSize",u.size)}return{update:r}}function hpe(s,e,t,i){let n=new WeakMap;function r(l){const c=i.render.frame,h=l.geometry,d=e.get(l,h);if(n.get(d)!==c&&(e.update(d),n.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),n.get(l)!==c&&(t.update(l.instanceMatrix,s.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,s.ARRAY_BUFFER),n.set(l,c))),l.isSkinnedMesh){const u=l.skeleton;n.get(u)!==c&&(u.update(),n.set(u,c))}return d}function o(){n=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:o}}class Bp extends si{constructor(e,t,i,n,r,o,a,l,c,h=b0){if(h!==b0&&h!==cm)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===b0&&(i=Wr),i===void 0&&h===cm&&(i=lm),super(null,n,r,o,a,l,h,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:qt,this.minFilter=l!==void 0?l:qt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const _8=new si,EW=new Bp(1,1),C8=new b1,w8=new q2,S8=new hA,RW=[],LW=[],BW=new Float32Array(16),PW=new Float32Array(9),GW=new Float32Array(4);function Wx(s,e,t){const i=s[0];if(i<=0||i>0)return s;const n=e*t;let r=RW[n];if(r===void 0&&(r=new Float32Array(n),RW[n]=r),e!==0){i.toArray(r,0);for(let o=1,a=0;o!==e;++o)a+=t,s[o].toArray(r,a)}return r}function Cr(s,e){if(s.length!==e.length)return!1;for(let t=0,i=s.length;t<i;t++)if(s[t]!==e[t])return!1;return!0}function wr(s,e){for(let t=0,i=e.length;t<i;t++)s[t]=e[t]}function iB(s,e){let t=LW[e];t===void 0&&(t=new Int32Array(e),LW[e]=t);for(let i=0;i!==e;++i)t[i]=s.allocateTextureUnit();return t}function dpe(s,e){const t=this.cache;t[0]!==e&&(s.uniform1f(this.addr,e),t[0]=e)}function upe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Cr(t,e))return;s.uniform2fv(this.addr,e),wr(t,e)}}function ppe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(s.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Cr(t,e))return;s.uniform3fv(this.addr,e),wr(t,e)}}function fpe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Cr(t,e))return;s.uniform4fv(this.addr,e),wr(t,e)}}function mpe(s,e){const t=this.cache,i=e.elements;if(i===void 0){if(Cr(t,e))return;s.uniformMatrix2fv(this.addr,!1,e),wr(t,e)}else{if(Cr(t,i))return;GW.set(i),s.uniformMatrix2fv(this.addr,!1,GW),wr(t,i)}}function gpe(s,e){const t=this.cache,i=e.elements;if(i===void 0){if(Cr(t,e))return;s.uniformMatrix3fv(this.addr,!1,e),wr(t,e)}else{if(Cr(t,i))return;PW.set(i),s.uniformMatrix3fv(this.addr,!1,PW),wr(t,i)}}function Ape(s,e){const t=this.cache,i=e.elements;if(i===void 0){if(Cr(t,e))return;s.uniformMatrix4fv(this.addr,!1,e),wr(t,e)}else{if(Cr(t,i))return;BW.set(i),s.uniformMatrix4fv(this.addr,!1,BW),wr(t,i)}}function ype(s,e){const t=this.cache;t[0]!==e&&(s.uniform1i(this.addr,e),t[0]=e)}function bpe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Cr(t,e))return;s.uniform2iv(this.addr,e),wr(t,e)}}function xpe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Cr(t,e))return;s.uniform3iv(this.addr,e),wr(t,e)}}function vpe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Cr(t,e))return;s.uniform4iv(this.addr,e),wr(t,e)}}function _pe(s,e){const t=this.cache;t[0]!==e&&(s.uniform1ui(this.addr,e),t[0]=e)}function Cpe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Cr(t,e))return;s.uniform2uiv(this.addr,e),wr(t,e)}}function wpe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Cr(t,e))return;s.uniform3uiv(this.addr,e),wr(t,e)}}function Spe(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Cr(t,e))return;s.uniform4uiv(this.addr,e),wr(t,e)}}function Mpe(s,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(s.uniform1i(this.addr,n),i[0]=n);let r;this.type===s.SAMPLER_2D_SHADOW?(EW.compareFunction=GU,r=EW):r=_8,t.setTexture2D(e||r,n)}function Ipe(s,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(s.uniform1i(this.addr,n),i[0]=n),t.setTexture3D(e||w8,n)}function Tpe(s,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(s.uniform1i(this.addr,n),i[0]=n),t.setTextureCube(e||S8,n)}function Epe(s,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(s.uniform1i(this.addr,n),i[0]=n),t.setTexture2DArray(e||C8,n)}function Rpe(s){switch(s){case 5126:return dpe;case 35664:return upe;case 35665:return ppe;case 35666:return fpe;case 35674:return mpe;case 35675:return gpe;case 35676:return Ape;case 5124:case 35670:return ype;case 35667:case 35671:return bpe;case 35668:case 35672:return xpe;case 35669:case 35673:return vpe;case 5125:return _pe;case 36294:return Cpe;case 36295:return wpe;case 36296:return Spe;case 35678:case 36198:case 36298:case 36306:case 35682:return Mpe;case 35679:case 36299:case 36307:return Ipe;case 35680:case 36300:case 36308:case 36293:return Tpe;case 36289:case 36303:case 36311:case 36292:return Epe}}function Lpe(s,e){s.uniform1fv(this.addr,e)}function Bpe(s,e){const t=Wx(e,this.size,2);s.uniform2fv(this.addr,t)}function Ppe(s,e){const t=Wx(e,this.size,3);s.uniform3fv(this.addr,t)}function Gpe(s,e){const t=Wx(e,this.size,4);s.uniform4fv(this.addr,t)}function kpe(s,e){const t=Wx(e,this.size,4);s.uniformMatrix2fv(this.addr,!1,t)}function Npe(s,e){const t=Wx(e,this.size,9);s.uniformMatrix3fv(this.addr,!1,t)}function Dpe(s,e){const t=Wx(e,this.size,16);s.uniformMatrix4fv(this.addr,!1,t)}function Fpe(s,e){s.uniform1iv(this.addr,e)}function Vpe(s,e){s.uniform2iv(this.addr,e)}function zpe(s,e){s.uniform3iv(this.addr,e)}function Upe(s,e){s.uniform4iv(this.addr,e)}function Xpe(s,e){s.uniform1uiv(this.addr,e)}function Ope(s,e){s.uniform2uiv(this.addr,e)}function Zpe(s,e){s.uniform3uiv(this.addr,e)}function Wpe(s,e){s.uniform4uiv(this.addr,e)}function Hpe(s,e,t){const i=this.cache,n=e.length,r=iB(t,n);Cr(i,r)||(s.uniform1iv(this.addr,r),wr(i,r));for(let o=0;o!==n;++o)t.setTexture2D(e[o]||_8,r[o])}function Qpe(s,e,t){const i=this.cache,n=e.length,r=iB(t,n);Cr(i,r)||(s.uniform1iv(this.addr,r),wr(i,r));for(let o=0;o!==n;++o)t.setTexture3D(e[o]||w8,r[o])}function Kpe(s,e,t){const i=this.cache,n=e.length,r=iB(t,n);Cr(i,r)||(s.uniform1iv(this.addr,r),wr(i,r));for(let o=0;o!==n;++o)t.setTextureCube(e[o]||S8,r[o])}function Ype(s,e,t){const i=this.cache,n=e.length,r=iB(t,n);Cr(i,r)||(s.uniform1iv(this.addr,r),wr(i,r));for(let o=0;o!==n;++o)t.setTexture2DArray(e[o]||C8,r[o])}function Jpe(s){switch(s){case 5126:return Lpe;case 35664:return Bpe;case 35665:return Ppe;case 35666:return Gpe;case 35674:return kpe;case 35675:return Npe;case 35676:return Dpe;case 5124:case 35670:return Fpe;case 35667:case 35671:return Vpe;case 35668:case 35672:return zpe;case 35669:case 35673:return Upe;case 5125:return Xpe;case 36294:return Ope;case 36295:return Zpe;case 36296:return Wpe;case 35678:case 36198:case 36298:case 36306:case 35682:return Hpe;case 35679:case 36299:case 36307:return Qpe;case 35680:case 36300:case 36308:case 36293:return Kpe;case 36289:case 36303:case 36311:case 36292:return Ype}}class jpe{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=Rpe(t.type)}}class qpe{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=Jpe(t.type)}}class $pe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const n=this.seq;for(let r=0,o=n.length;r!==o;++r){const a=n[r];a.setValue(e,t[a.id],i)}}}const UG=/(\w+)(\])?(\[|\.)?/g;function kW(s,e){s.seq.push(e),s.map[e.id]=e}function efe(s,e,t){const i=s.name,n=i.length;for(UG.lastIndex=0;;){const r=UG.exec(i),o=UG.lastIndex;let a=r[1];const l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===n){kW(t,c===void 0?new jpe(a,s,e):new qpe(a,s,e));break}else{let d=t.map[a];d===void 0&&(d=new $pe(a),kW(t,d)),t=d}}}class fR{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){const r=e.getActiveUniform(t,n),o=e.getUniformLocation(t,r.name);efe(r,o,this)}}setValue(e,t,i,n){const r=this.map[t];r!==void 0&&r.setValue(e,i,n)}setOptional(e,t,i){const n=t[i];n!==void 0&&this.setValue(e,i,n)}static upload(e,t,i,n){for(let r=0,o=t.length;r!==o;++r){const a=t[r],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,n)}}static seqWithValue(e,t){const i=[];for(let n=0,r=e.length;n!==r;++n){const o=e[n];o.id in t&&i.push(o)}return i}}function NW(s,e,t){const i=s.createShader(e);return s.shaderSource(i,t),s.compileShader(i),i}const tfe=37297;let ife=0;function nfe(s,e){const t=s.split(`
`),i=[],n=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=n;o<r;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join(`
`)}function sfe(s){const e=ni.getPrimaries(ni.workingColorSpace),t=ni.getPrimaries(s);let i;switch(e===t?i="":e===Dw&&t===Nw?i="LinearDisplayP3ToLinearSRGB":e===Nw&&t===Dw&&(i="LinearSRGBToLinearDisplayP3"),s){case Ji:case Ox:return[i,"LinearTransferOETF"];case ft:case y1:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",s),[i,"LinearTransferOETF"]}}function DW(s,e,t){const i=s.getShaderParameter(e,s.COMPILE_STATUS),n=s.getShaderInfoLog(e).trim();if(i&&n==="")return"";const r=/ERROR: 0:(\d+)/.exec(n);if(r){const o=parseInt(r[1]);return t.toUpperCase()+`

`+n+`

`+nfe(s.getShaderSource(e),o)}else return n}function rfe(s,e){const t=sfe(e);return`vec4 ${s}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function ofe(s,e){let t;switch(e){case aA:t="Linear";break;case Vx:t="Reinhard";break;case CU:t="Cineon";break;case zx:t="ACESFilmic";break;case lA:t="AgX";break;case om:t="Neutral";break;case Vj:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+s+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const SI=new T;function afe(){ni.getLuminanceCoefficients(SI);const s=SI.x.toFixed(4),e=SI.y.toFixed(4),t=SI.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${s}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function lfe(s){return[s.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",s.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(rC).join(`
`)}function cfe(s){const e=[];for(const t in s){const i=s[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function hfe(s,e){const t={},i=s.getProgramParameter(e,s.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const r=s.getActiveAttrib(e,n),o=r.name;let a=1;r.type===s.FLOAT_MAT2&&(a=2),r.type===s.FLOAT_MAT3&&(a=3),r.type===s.FLOAT_MAT4&&(a=4),t[o]={type:r.type,location:s.getAttribLocation(e,o),locationSize:a}}return t}function rC(s){return s!==""}function FW(s,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return s.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function VW(s,e){return s.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const dfe=/^[ \t]*#include +<([\w\d./]+)>/gm;function ZF(s){return s.replace(dfe,pfe)}const ufe=new Map;function pfe(s,e){let t=Ut[e];if(t===void 0){const i=ufe.get(e);if(i!==void 0)t=Ut[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return ZF(t)}const ffe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function zW(s){return s.replace(ffe,mfe)}function mfe(s,e,t,i){let n="";for(let r=parseInt(e);r<parseInt(t);r++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return n}function UW(s){let e=`precision ${s.precision} float;
	precision ${s.precision} int;
	precision ${s.precision} sampler2D;
	precision ${s.precision} samplerCube;
	precision ${s.precision} sampler3D;
	precision ${s.precision} sampler2DArray;
	precision ${s.precision} sampler2DShadow;
	precision ${s.precision} samplerCubeShadow;
	precision ${s.precision} sampler2DArrayShadow;
	precision ${s.precision} isampler2D;
	precision ${s.precision} isampler3D;
	precision ${s.precision} isamplerCube;
	precision ${s.precision} isampler2DArray;
	precision ${s.precision} usampler2D;
	precision ${s.precision} usampler3D;
	precision ${s.precision} usamplerCube;
	precision ${s.precision} usampler2DArray;
	`;return s.precision==="highp"?e+=`
#define HIGH_PRECISION`:s.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:s.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function gfe(s){let e="SHADOWMAP_TYPE_BASIC";return s.shadowMapType===AU?e="SHADOWMAP_TYPE_PCF":s.shadowMapType===yU?e="SHADOWMAP_TYPE_PCF_SOFT":s.shadowMapType===qa&&(e="SHADOWMAP_TYPE_VSM"),e}function Afe(s){let e="ENVMAP_TYPE_CUBE";if(s.envMap)switch(s.envMapMode){case jl:case zc:e="ENVMAP_TYPE_CUBE";break;case cA:e="ENVMAP_TYPE_CUBE_UV";break}return e}function yfe(s){let e="ENVMAP_MODE_REFLECTION";if(s.envMap)switch(s.envMapMode){case zc:e="ENVMAP_MODE_REFRACTION";break}return e}function bfe(s){let e="ENVMAP_BLENDING_NONE";if(s.envMap)switch(s.combine){case Fx:e="ENVMAP_BLENDING_MULTIPLY";break;case vU:e="ENVMAP_BLENDING_MIX";break;case _U:e="ENVMAP_BLENDING_ADD";break}return e}function xfe(s){const e=s.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function vfe(s,e,t,i){const n=s.getContext(),r=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=gfe(t),c=Afe(t),h=yfe(t),d=bfe(t),u=xfe(t),f=lfe(t),m=cfe(r),g=n.createProgram();let A,y,b=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(A=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m].filter(rC).join(`
`),A.length>0&&(A+=`
`),y=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m].filter(rC).join(`
`),y.length>0&&(y+=`
`)):(A=[UW(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(rC).join(`
`),y=[UW(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+d:"",u?"#define CUBEUV_TEXEL_WIDTH "+u.texelWidth:"",u?"#define CUBEUV_TEXEL_HEIGHT "+u.texelHeight:"",u?"#define CUBEUV_MAX_MIP "+u.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Zr?"#define TONE_MAPPING":"",t.toneMapping!==Zr?Ut.tonemapping_pars_fragment:"",t.toneMapping!==Zr?ofe("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Ut.colorspace_pars_fragment,rfe("linearToOutputTexel",t.outputColorSpace),afe(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(rC).join(`
`)),o=ZF(o),o=FW(o,t),o=VW(o,t),a=ZF(a),a=FW(a,t),a=VW(a,t),o=zW(o),a=zW(a),t.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,A=[f,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+A,y=["#define varying in",t.glslVersion===_L?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===_L?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const x=b+A+o,v=b+y+a,_=NW(n,n.VERTEX_SHADER,x),C=NW(n,n.FRAGMENT_SHADER,v);n.attachShader(g,_),n.attachShader(g,C),t.index0AttributeName!==void 0?n.bindAttribLocation(g,0,t.index0AttributeName):t.morphTargets===!0&&n.bindAttribLocation(g,0,"position"),n.linkProgram(g);function S(E){if(s.debug.checkShaderErrors){const B=n.getProgramInfoLog(g).trim(),P=n.getShaderInfoLog(_).trim(),k=n.getShaderInfoLog(C).trim();let X=!0,F=!0;if(n.getProgramParameter(g,n.LINK_STATUS)===!1)if(X=!1,typeof s.debug.onShaderError=="function")s.debug.onShaderError(n,g,_,C);else{const H=DW(n,_,"vertex"),W=DW(n,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(g,n.VALIDATE_STATUS)+`

Material Name: `+E.name+`
Material Type: `+E.type+`

Program Info Log: `+B+`
`+H+`
`+W)}else B!==""?console.warn("THREE.WebGLProgram: Program Info Log:",B):(P===""||k==="")&&(F=!1);F&&(E.diagnostics={runnable:X,programLog:B,vertexShader:{log:P,prefix:A},fragmentShader:{log:k,prefix:y}})}n.deleteShader(_),n.deleteShader(C),M=new fR(n,g),L=hfe(n,g)}let M;this.getUniforms=function(){return M===void 0&&S(this),M};let L;this.getAttributes=function(){return L===void 0&&S(this),L};let w=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return w===!1&&(w=n.getProgramParameter(g,tfe)),w},this.destroy=function(){i.releaseStatesOfProgram(this),n.deleteProgram(g),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=ife++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=_,this.fragmentShader=C,this}let _fe=0;class Cfe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,n=this._getShaderStage(t),r=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(n)===!1&&(o.add(n),n.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new wfe(e),t.set(e,i)),i}}class wfe{constructor(e){this.id=_fe++,this.code=e,this.usedTimes=0}}function Sfe(s,e,t,i,n,r,o){const a=new ta,l=new Cfe,c=new Set,h=[],d=n.logarithmicDepthBuffer,u=n.reverseDepthBuffer,f=n.vertexTextures;let m=n.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function A(w){return c.add(w),w===0?"uv":`uv${w}`}function y(w,E,B,P,k){const X=P.fog,F=k.geometry,H=w.isMeshStandardMaterial?P.environment:null,W=(w.isMeshStandardMaterial?t:e).get(w.envMap||H),se=W&&W.mapping===cA?W.image.height:null,de=g[w.type];w.precision!==null&&(m=n.getMaxPrecision(w.precision),m!==w.precision&&console.warn("THREE.WebGLProgram.getParameters:",w.precision,"not supported, using",m,"instead."));const be=F.morphAttributes.position||F.morphAttributes.normal||F.morphAttributes.color,Pe=be!==void 0?be.length:0;let Oe=0;F.morphAttributes.position!==void 0&&(Oe=1),F.morphAttributes.normal!==void 0&&(Oe=2),F.morphAttributes.color!==void 0&&(Oe=3);let ae,Ae,Se,Le;if(de){const zo=Wn[de];ae=zo.vertexShader,Ae=zo.fragmentShader}else ae=w.vertexShader,Ae=w.fragmentShader,l.update(w),Se=l.getVertexShaderID(w),Le=l.getFragmentShaderID(w);const st=s.getRenderTarget(),ot=k.isInstancedMesh===!0,Ct=k.isBatchedMesh===!0,zt=!!w.map,ke=!!w.matcap,Z=!!W,Ke=!!w.aoMap,je=!!w.lightMap,We=!!w.bumpMap,nt=!!w.normalMap,Tt=!!w.displacementMap,mt=!!w.emissiveMap,O=!!w.metalnessMap,D=!!w.roughnessMap,he=w.anisotropy>0,Ee=w.clearcoat>0,Ne=w.dispersion>0,Re=w.iridescence>0,yt=w.sheen>0,et=w.transmission>0,ct=he&&!!w.anisotropyMap,Jt=Ee&&!!w.clearcoatMap,Ge=Ee&&!!w.clearcoatNormalMap,At=Ee&&!!w.clearcoatRoughnessMap,Kt=Re&&!!w.iridescenceMap,Lt=Re&&!!w.iridescenceThicknessMap,at=yt&&!!w.sheenColorMap,kt=yt&&!!w.sheenRoughnessMap,jt=!!w.specularMap,yi=!!w.specularColorMap,te=!!w.specularIntensityMap,xt=et&&!!w.transmissionMap,ie=et&&!!w.thicknessMap,Ue=!!w.gradientMap,bt=!!w.alphaMap,vt=w.alphaTest>0,Di=!!w.alphaHash,bs=!!w.extensions;let Vo=Zr;w.toneMapped&&(st===null||st.isXRRenderTarget===!0)&&(Vo=s.toneMapping);const Ki={shaderID:de,shaderType:w.type,shaderName:w.name,vertexShader:ae,fragmentShader:Ae,defines:w.defines,customVertexShaderID:Se,customFragmentShaderID:Le,isRawShaderMaterial:w.isRawShaderMaterial===!0,glslVersion:w.glslVersion,precision:m,batching:Ct,batchingColor:Ct&&k._colorsTexture!==null,instancing:ot,instancingColor:ot&&k.instanceColor!==null,instancingMorph:ot&&k.morphTexture!==null,supportsVertexTextures:f,outputColorSpace:st===null?s.outputColorSpace:st.isXRRenderTarget===!0?st.texture.colorSpace:Ji,alphaToCoverage:!!w.alphaToCoverage,map:zt,matcap:ke,envMap:Z,envMapMode:Z&&W.mapping,envMapCubeUVHeight:se,aoMap:Ke,lightMap:je,bumpMap:We,normalMap:nt,displacementMap:f&&Tt,emissiveMap:mt,normalMapObjectSpace:nt&&w.normalMapType===BU,normalMapTangentSpace:nt&&w.normalMapType===Qd,metalnessMap:O,roughnessMap:D,anisotropy:he,anisotropyMap:ct,clearcoat:Ee,clearcoatMap:Jt,clearcoatNormalMap:Ge,clearcoatRoughnessMap:At,dispersion:Ne,iridescence:Re,iridescenceMap:Kt,iridescenceThicknessMap:Lt,sheen:yt,sheenColorMap:at,sheenRoughnessMap:kt,specularMap:jt,specularColorMap:yi,specularIntensityMap:te,transmission:et,transmissionMap:xt,thicknessMap:ie,gradientMap:Ue,opaque:w.transparent===!1&&w.blending===fp&&w.alphaToCoverage===!1,alphaMap:bt,alphaTest:vt,alphaHash:Di,combine:w.combine,mapUv:zt&&A(w.map.channel),aoMapUv:Ke&&A(w.aoMap.channel),lightMapUv:je&&A(w.lightMap.channel),bumpMapUv:We&&A(w.bumpMap.channel),normalMapUv:nt&&A(w.normalMap.channel),displacementMapUv:Tt&&A(w.displacementMap.channel),emissiveMapUv:mt&&A(w.emissiveMap.channel),metalnessMapUv:O&&A(w.metalnessMap.channel),roughnessMapUv:D&&A(w.roughnessMap.channel),anisotropyMapUv:ct&&A(w.anisotropyMap.channel),clearcoatMapUv:Jt&&A(w.clearcoatMap.channel),clearcoatNormalMapUv:Ge&&A(w.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:At&&A(w.clearcoatRoughnessMap.channel),iridescenceMapUv:Kt&&A(w.iridescenceMap.channel),iridescenceThicknessMapUv:Lt&&A(w.iridescenceThicknessMap.channel),sheenColorMapUv:at&&A(w.sheenColorMap.channel),sheenRoughnessMapUv:kt&&A(w.sheenRoughnessMap.channel),specularMapUv:jt&&A(w.specularMap.channel),specularColorMapUv:yi&&A(w.specularColorMap.channel),specularIntensityMapUv:te&&A(w.specularIntensityMap.channel),transmissionMapUv:xt&&A(w.transmissionMap.channel),thicknessMapUv:ie&&A(w.thicknessMap.channel),alphaMapUv:bt&&A(w.alphaMap.channel),vertexTangents:!!F.attributes.tangent&&(nt||he),vertexColors:w.vertexColors,vertexAlphas:w.vertexColors===!0&&!!F.attributes.color&&F.attributes.color.itemSize===4,pointsUvs:k.isPoints===!0&&!!F.attributes.uv&&(zt||bt),fog:!!X,useFog:w.fog===!0,fogExp2:!!X&&X.isFogExp2,flatShading:w.flatShading===!0,sizeAttenuation:w.sizeAttenuation===!0,logarithmicDepthBuffer:d,reverseDepthBuffer:u,skinning:k.isSkinnedMesh===!0,morphTargets:F.morphAttributes.position!==void 0,morphNormals:F.morphAttributes.normal!==void 0,morphColors:F.morphAttributes.color!==void 0,morphTargetsCount:Pe,morphTextureStride:Oe,numDirLights:E.directional.length,numPointLights:E.point.length,numSpotLights:E.spot.length,numSpotLightMaps:E.spotLightMap.length,numRectAreaLights:E.rectArea.length,numHemiLights:E.hemi.length,numDirLightShadows:E.directionalShadowMap.length,numPointLightShadows:E.pointShadowMap.length,numSpotLightShadows:E.spotShadowMap.length,numSpotLightShadowsWithMaps:E.numSpotLightShadowsWithMaps,numLightProbes:E.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:w.dithering,shadowMapEnabled:s.shadowMap.enabled&&B.length>0,shadowMapType:s.shadowMap.type,toneMapping:Vo,decodeVideoTexture:zt&&w.map.isVideoTexture===!0&&ni.getTransfer(w.map.colorSpace)===Ln,premultipliedAlpha:w.premultipliedAlpha,doubleSided:w.side===Zi,flipSided:w.side===vn,useDepthPacking:w.depthPacking>=0,depthPacking:w.depthPacking||0,index0AttributeName:w.index0AttributeName,extensionClipCullDistance:bs&&w.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(bs&&w.extensions.multiDraw===!0||Ct)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:w.customProgramCacheKey()};return Ki.vertexUv1s=c.has(1),Ki.vertexUv2s=c.has(2),Ki.vertexUv3s=c.has(3),c.clear(),Ki}function b(w){const E=[];if(w.shaderID?E.push(w.shaderID):(E.push(w.customVertexShaderID),E.push(w.customFragmentShaderID)),w.defines!==void 0)for(const B in w.defines)E.push(B),E.push(w.defines[B]);return w.isRawShaderMaterial===!1&&(x(E,w),v(E,w),E.push(s.outputColorSpace)),E.push(w.customProgramCacheKey),E.join()}function x(w,E){w.push(E.precision),w.push(E.outputColorSpace),w.push(E.envMapMode),w.push(E.envMapCubeUVHeight),w.push(E.mapUv),w.push(E.alphaMapUv),w.push(E.lightMapUv),w.push(E.aoMapUv),w.push(E.bumpMapUv),w.push(E.normalMapUv),w.push(E.displacementMapUv),w.push(E.emissiveMapUv),w.push(E.metalnessMapUv),w.push(E.roughnessMapUv),w.push(E.anisotropyMapUv),w.push(E.clearcoatMapUv),w.push(E.clearcoatNormalMapUv),w.push(E.clearcoatRoughnessMapUv),w.push(E.iridescenceMapUv),w.push(E.iridescenceThicknessMapUv),w.push(E.sheenColorMapUv),w.push(E.sheenRoughnessMapUv),w.push(E.specularMapUv),w.push(E.specularColorMapUv),w.push(E.specularIntensityMapUv),w.push(E.transmissionMapUv),w.push(E.thicknessMapUv),w.push(E.combine),w.push(E.fogExp2),w.push(E.sizeAttenuation),w.push(E.morphTargetsCount),w.push(E.morphAttributeCount),w.push(E.numDirLights),w.push(E.numPointLights),w.push(E.numSpotLights),w.push(E.numSpotLightMaps),w.push(E.numHemiLights),w.push(E.numRectAreaLights),w.push(E.numDirLightShadows),w.push(E.numPointLightShadows),w.push(E.numSpotLightShadows),w.push(E.numSpotLightShadowsWithMaps),w.push(E.numLightProbes),w.push(E.shadowMapType),w.push(E.toneMapping),w.push(E.numClippingPlanes),w.push(E.numClipIntersection),w.push(E.depthPacking)}function v(w,E){a.disableAll(),E.supportsVertexTextures&&a.enable(0),E.instancing&&a.enable(1),E.instancingColor&&a.enable(2),E.instancingMorph&&a.enable(3),E.matcap&&a.enable(4),E.envMap&&a.enable(5),E.normalMapObjectSpace&&a.enable(6),E.normalMapTangentSpace&&a.enable(7),E.clearcoat&&a.enable(8),E.iridescence&&a.enable(9),E.alphaTest&&a.enable(10),E.vertexColors&&a.enable(11),E.vertexAlphas&&a.enable(12),E.vertexUv1s&&a.enable(13),E.vertexUv2s&&a.enable(14),E.vertexUv3s&&a.enable(15),E.vertexTangents&&a.enable(16),E.anisotropy&&a.enable(17),E.alphaHash&&a.enable(18),E.batching&&a.enable(19),E.dispersion&&a.enable(20),E.batchingColor&&a.enable(21),w.push(a.mask),a.disableAll(),E.fog&&a.enable(0),E.useFog&&a.enable(1),E.flatShading&&a.enable(2),E.logarithmicDepthBuffer&&a.enable(3),E.reverseDepthBuffer&&a.enable(4),E.skinning&&a.enable(5),E.morphTargets&&a.enable(6),E.morphNormals&&a.enable(7),E.morphColors&&a.enable(8),E.premultipliedAlpha&&a.enable(9),E.shadowMapEnabled&&a.enable(10),E.doubleSided&&a.enable(11),E.flipSided&&a.enable(12),E.useDepthPacking&&a.enable(13),E.dithering&&a.enable(14),E.transmission&&a.enable(15),E.sheen&&a.enable(16),E.opaque&&a.enable(17),E.pointsUvs&&a.enable(18),E.decodeVideoTexture&&a.enable(19),E.alphaToCoverage&&a.enable(20),w.push(a.mask)}function _(w){const E=g[w.type];let B;if(E){const P=Wn[E];B=Zx.clone(P.uniforms)}else B=w.uniforms;return B}function C(w,E){let B;for(let P=0,k=h.length;P<k;P++){const X=h[P];if(X.cacheKey===E){B=X,++B.usedTimes;break}}return B===void 0&&(B=new vfe(s,E,w,r),h.push(B)),B}function S(w){if(--w.usedTimes===0){const E=h.indexOf(w);h[E]=h[h.length-1],h.pop(),w.destroy()}}function M(w){l.remove(w)}function L(){l.dispose()}return{getParameters:y,getProgramCacheKey:b,getUniforms:_,acquireProgram:C,releaseProgram:S,releaseShaderCache:M,programs:h,dispose:L}}function Mfe(){let s=new WeakMap;function e(o){return s.has(o)}function t(o){let a=s.get(o);return a===void 0&&(a={},s.set(o,a)),a}function i(o){s.delete(o)}function n(o,a,l){s.get(o)[a]=l}function r(){s=new WeakMap}return{has:e,get:t,remove:i,update:n,dispose:r}}function Ife(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.material.id!==e.material.id?s.material.id-e.material.id:s.z!==e.z?s.z-e.z:s.id-e.id}function XW(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.z!==e.z?e.z-s.z:s.id-e.id}function OW(){const s=[];let e=0;const t=[],i=[],n=[];function r(){e=0,t.length=0,i.length=0,n.length=0}function o(d,u,f,m,g,A){let y=s[e];return y===void 0?(y={id:d.id,object:d,geometry:u,material:f,groupOrder:m,renderOrder:d.renderOrder,z:g,group:A},s[e]=y):(y.id=d.id,y.object=d,y.geometry=u,y.material=f,y.groupOrder=m,y.renderOrder=d.renderOrder,y.z=g,y.group=A),e++,y}function a(d,u,f,m,g,A){const y=o(d,u,f,m,g,A);f.transmission>0?i.push(y):f.transparent===!0?n.push(y):t.push(y)}function l(d,u,f,m,g,A){const y=o(d,u,f,m,g,A);f.transmission>0?i.unshift(y):f.transparent===!0?n.unshift(y):t.unshift(y)}function c(d,u){t.length>1&&t.sort(d||Ife),i.length>1&&i.sort(u||XW),n.length>1&&n.sort(u||XW)}function h(){for(let d=e,u=s.length;d<u;d++){const f=s[d];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:t,transmissive:i,transparent:n,init:r,push:a,unshift:l,finish:h,sort:c}}function Tfe(){let s=new WeakMap;function e(i,n){const r=s.get(i);let o;return r===void 0?(o=new OW,s.set(i,[o])):n>=r.length?(o=new OW,r.push(o)):o=r[n],o}function t(){s=new WeakMap}return{get:e,dispose:t}}function Efe(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new T,color:new ge};break;case"SpotLight":t={position:new T,direction:new T,color:new ge,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new T,color:new ge,distance:0,decay:0};break;case"HemisphereLight":t={direction:new T,skyColor:new ge,groundColor:new ge};break;case"RectAreaLight":t={color:new ge,position:new T,halfWidth:new T,halfHeight:new T};break}return s[e.id]=t,t}}}function Rfe(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Q};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Q};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Q,shadowCameraNear:1,shadowCameraFar:1e3};break}return s[e.id]=t,t}}}let Lfe=0;function Bfe(s,e){return(e.castShadow?2:0)-(s.castShadow?2:0)+(e.map?1:0)-(s.map?1:0)}function Pfe(s){const e=new Efe,t=Rfe(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)i.probe.push(new T);const n=new T,r=new ce,o=new ce;function a(c){let h=0,d=0,u=0;for(let L=0;L<9;L++)i.probe[L].set(0,0,0);let f=0,m=0,g=0,A=0,y=0,b=0,x=0,v=0,_=0,C=0,S=0;c.sort(Bfe);for(let L=0,w=c.length;L<w;L++){const E=c[L],B=E.color,P=E.intensity,k=E.distance,X=E.shadow&&E.shadow.map?E.shadow.map.texture:null;if(E.isAmbientLight)h+=B.r*P,d+=B.g*P,u+=B.b*P;else if(E.isLightProbe){for(let F=0;F<9;F++)i.probe[F].addScaledVector(E.sh.coefficients[F],P);S++}else if(E.isDirectionalLight){const F=e.get(E);if(F.color.copy(E.color).multiplyScalar(E.intensity),E.castShadow){const H=E.shadow,W=t.get(E);W.shadowIntensity=H.intensity,W.shadowBias=H.bias,W.shadowNormalBias=H.normalBias,W.shadowRadius=H.radius,W.shadowMapSize=H.mapSize,i.directionalShadow[f]=W,i.directionalShadowMap[f]=X,i.directionalShadowMatrix[f]=E.shadow.matrix,b++}i.directional[f]=F,f++}else if(E.isSpotLight){const F=e.get(E);F.position.setFromMatrixPosition(E.matrixWorld),F.color.copy(B).multiplyScalar(P),F.distance=k,F.coneCos=Math.cos(E.angle),F.penumbraCos=Math.cos(E.angle*(1-E.penumbra)),F.decay=E.decay,i.spot[g]=F;const H=E.shadow;if(E.map&&(i.spotLightMap[_]=E.map,_++,H.updateMatrices(E),E.castShadow&&C++),i.spotLightMatrix[g]=H.matrix,E.castShadow){const W=t.get(E);W.shadowIntensity=H.intensity,W.shadowBias=H.bias,W.shadowNormalBias=H.normalBias,W.shadowRadius=H.radius,W.shadowMapSize=H.mapSize,i.spotShadow[g]=W,i.spotShadowMap[g]=X,v++}g++}else if(E.isRectAreaLight){const F=e.get(E);F.color.copy(B).multiplyScalar(P),F.halfWidth.set(E.width*.5,0,0),F.halfHeight.set(0,E.height*.5,0),i.rectArea[A]=F,A++}else if(E.isPointLight){const F=e.get(E);if(F.color.copy(E.color).multiplyScalar(E.intensity),F.distance=E.distance,F.decay=E.decay,E.castShadow){const H=E.shadow,W=t.get(E);W.shadowIntensity=H.intensity,W.shadowBias=H.bias,W.shadowNormalBias=H.normalBias,W.shadowRadius=H.radius,W.shadowMapSize=H.mapSize,W.shadowCameraNear=H.camera.near,W.shadowCameraFar=H.camera.far,i.pointShadow[m]=W,i.pointShadowMap[m]=X,i.pointShadowMatrix[m]=E.shadow.matrix,x++}i.point[m]=F,m++}else if(E.isHemisphereLight){const F=e.get(E);F.skyColor.copy(E.color).multiplyScalar(P),F.groundColor.copy(E.groundColor).multiplyScalar(P),i.hemi[y]=F,y++}}A>0&&(s.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=ht.LTC_FLOAT_1,i.rectAreaLTC2=ht.LTC_FLOAT_2):(i.rectAreaLTC1=ht.LTC_HALF_1,i.rectAreaLTC2=ht.LTC_HALF_2)),i.ambient[0]=h,i.ambient[1]=d,i.ambient[2]=u;const M=i.hash;(M.directionalLength!==f||M.pointLength!==m||M.spotLength!==g||M.rectAreaLength!==A||M.hemiLength!==y||M.numDirectionalShadows!==b||M.numPointShadows!==x||M.numSpotShadows!==v||M.numSpotMaps!==_||M.numLightProbes!==S)&&(i.directional.length=f,i.spot.length=g,i.rectArea.length=A,i.point.length=m,i.hemi.length=y,i.directionalShadow.length=b,i.directionalShadowMap.length=b,i.pointShadow.length=x,i.pointShadowMap.length=x,i.spotShadow.length=v,i.spotShadowMap.length=v,i.directionalShadowMatrix.length=b,i.pointShadowMatrix.length=x,i.spotLightMatrix.length=v+_-C,i.spotLightMap.length=_,i.numSpotLightShadowsWithMaps=C,i.numLightProbes=S,M.directionalLength=f,M.pointLength=m,M.spotLength=g,M.rectAreaLength=A,M.hemiLength=y,M.numDirectionalShadows=b,M.numPointShadows=x,M.numSpotShadows=v,M.numSpotMaps=_,M.numLightProbes=S,i.version=Lfe++)}function l(c,h){let d=0,u=0,f=0,m=0,g=0;const A=h.matrixWorldInverse;for(let y=0,b=c.length;y<b;y++){const x=c[y];if(x.isDirectionalLight){const v=i.directional[d];v.direction.setFromMatrixPosition(x.matrixWorld),n.setFromMatrixPosition(x.target.matrixWorld),v.direction.sub(n),v.direction.transformDirection(A),d++}else if(x.isSpotLight){const v=i.spot[f];v.position.setFromMatrixPosition(x.matrixWorld),v.position.applyMatrix4(A),v.direction.setFromMatrixPosition(x.matrixWorld),n.setFromMatrixPosition(x.target.matrixWorld),v.direction.sub(n),v.direction.transformDirection(A),f++}else if(x.isRectAreaLight){const v=i.rectArea[m];v.position.setFromMatrixPosition(x.matrixWorld),v.position.applyMatrix4(A),o.identity(),r.copy(x.matrixWorld),r.premultiply(A),o.extractRotation(r),v.halfWidth.set(x.width*.5,0,0),v.halfHeight.set(0,x.height*.5,0),v.halfWidth.applyMatrix4(o),v.halfHeight.applyMatrix4(o),m++}else if(x.isPointLight){const v=i.point[u];v.position.setFromMatrixPosition(x.matrixWorld),v.position.applyMatrix4(A),u++}else if(x.isHemisphereLight){const v=i.hemi[g];v.direction.setFromMatrixPosition(x.matrixWorld),v.direction.transformDirection(A),g++}}}return{setup:a,setupView:l,state:i}}function ZW(s){const e=new Pfe(s),t=[],i=[];function n(h){c.camera=h,t.length=0,i.length=0}function r(h){t.push(h)}function o(h){i.push(h)}function a(){e.setup(t)}function l(h){e.setupView(t,h)}const c={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:n,state:c,setupLights:a,setupLightsView:l,pushLight:r,pushShadow:o}}function Gfe(s){let e=new WeakMap;function t(n,r=0){const o=e.get(n);let a;return o===void 0?(a=new ZW(s),e.set(n,[a])):r>=o.length?(a=new ZW(s),o.push(a)):a=o[r],a}function i(){e=new WeakMap}return{get:t,dispose:i}}class v1 extends Yt{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Io,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class FU extends Yt{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const kfe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Nfe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Dfe(s,e,t){let i=new H0;const n=new Q,r=new Q,o=new Je,a=new v1({depthPacking:j2}),l=new FU,c={},h=t.maxTextureSize,d={[us]:vn,[vn]:us,[Zi]:Zi},u=new Ht({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Q},radius:{value:4}},vertexShader:kfe,fragmentShader:Nfe}),f=u.clone();f.defines.HORIZONTAL_PASS=1;const m=new It;m.setAttribute("position",new dt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new fe(m,u),A=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=AU;let y=this.type;this.render=function(C,S,M){if(A.enabled===!1||A.autoUpdate===!1&&A.needsUpdate===!1||C.length===0)return;const L=s.getRenderTarget(),w=s.getActiveCubeFace(),E=s.getActiveMipmapLevel(),B=s.state;B.setBlending(Fn),B.buffers.color.setClear(1,1,1,1),B.buffers.depth.setTest(!0),B.setScissorTest(!1);const P=y!==qa&&this.type===qa,k=y===qa&&this.type!==qa;for(let X=0,F=C.length;X<F;X++){const H=C[X],W=H.shadow;if(W===void 0){console.warn("THREE.WebGLShadowMap:",H,"has no shadow.");continue}if(W.autoUpdate===!1&&W.needsUpdate===!1)continue;n.copy(W.mapSize);const se=W.getFrameExtents();if(n.multiply(se),r.copy(W.mapSize),(n.x>h||n.y>h)&&(n.x>h&&(r.x=Math.floor(h/se.x),n.x=r.x*se.x,W.mapSize.x=r.x),n.y>h&&(r.y=Math.floor(h/se.y),n.y=r.y*se.y,W.mapSize.y=r.y)),W.map===null||P===!0||k===!0){const be=this.type!==qa?{minFilter:qt,magFilter:qt}:{};W.map!==null&&W.map.dispose(),W.map=new ci(n.x,n.y,be),W.map.texture.name=H.name+".shadowMap",W.camera.updateProjectionMatrix()}s.setRenderTarget(W.map),s.clear();const de=W.getViewportCount();for(let be=0;be<de;be++){const Pe=W.getViewport(be);o.set(r.x*Pe.x,r.y*Pe.y,r.x*Pe.z,r.y*Pe.w),B.viewport(o),W.updateMatrices(H,be),i=W.getFrustum(),v(S,M,W.camera,H,this.type)}W.isPointLightShadow!==!0&&this.type===qa&&b(W,M),W.needsUpdate=!1}y=this.type,A.needsUpdate=!1,s.setRenderTarget(L,w,E)};function b(C,S){const M=e.update(g);u.defines.VSM_SAMPLES!==C.blurSamples&&(u.defines.VSM_SAMPLES=C.blurSamples,f.defines.VSM_SAMPLES=C.blurSamples,u.needsUpdate=!0,f.needsUpdate=!0),C.mapPass===null&&(C.mapPass=new ci(n.x,n.y)),u.uniforms.shadow_pass.value=C.map.texture,u.uniforms.resolution.value=C.mapSize,u.uniforms.radius.value=C.radius,s.setRenderTarget(C.mapPass),s.clear(),s.renderBufferDirect(S,null,M,u,g,null),f.uniforms.shadow_pass.value=C.mapPass.texture,f.uniforms.resolution.value=C.mapSize,f.uniforms.radius.value=C.radius,s.setRenderTarget(C.map),s.clear(),s.renderBufferDirect(S,null,M,f,g,null)}function x(C,S,M,L){let w=null;const E=M.isPointLight===!0?C.customDistanceMaterial:C.customDepthMaterial;if(E!==void 0)w=E;else if(w=M.isPointLight===!0?l:a,s.localClippingEnabled&&S.clipShadows===!0&&Array.isArray(S.clippingPlanes)&&S.clippingPlanes.length!==0||S.displacementMap&&S.displacementScale!==0||S.alphaMap&&S.alphaTest>0||S.map&&S.alphaTest>0){const B=w.uuid,P=S.uuid;let k=c[B];k===void 0&&(k={},c[B]=k);let X=k[P];X===void 0&&(X=w.clone(),k[P]=X,S.addEventListener("dispose",_)),w=X}if(w.visible=S.visible,w.wireframe=S.wireframe,L===qa?w.side=S.shadowSide!==null?S.shadowSide:S.side:w.side=S.shadowSide!==null?S.shadowSide:d[S.side],w.alphaMap=S.alphaMap,w.alphaTest=S.alphaTest,w.map=S.map,w.clipShadows=S.clipShadows,w.clippingPlanes=S.clippingPlanes,w.clipIntersection=S.clipIntersection,w.displacementMap=S.displacementMap,w.displacementScale=S.displacementScale,w.displacementBias=S.displacementBias,w.wireframeLinewidth=S.wireframeLinewidth,w.linewidth=S.linewidth,M.isPointLight===!0&&w.isMeshDistanceMaterial===!0){const B=s.properties.get(w);B.light=M}return w}function v(C,S,M,L,w){if(C.visible===!1)return;if(C.layers.test(S.layers)&&(C.isMesh||C.isLine||C.isPoints)&&(C.castShadow||C.receiveShadow&&w===qa)&&(!C.frustumCulled||i.intersectsObject(C))){C.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,C.matrixWorld);const P=e.update(C),k=C.material;if(Array.isArray(k)){const X=P.groups;for(let F=0,H=X.length;F<H;F++){const W=X[F],se=k[W.materialIndex];if(se&&se.visible){const de=x(C,se,L,w);C.onBeforeShadow(s,C,S,M,P,de,W),s.renderBufferDirect(M,null,P,de,C,W),C.onAfterShadow(s,C,S,M,P,de,W)}}}else if(k.visible){const X=x(C,k,L,w);C.onBeforeShadow(s,C,S,M,P,X,null),s.renderBufferDirect(M,null,P,X,C,null),C.onAfterShadow(s,C,S,M,P,X,null)}}const B=C.children;for(let P=0,k=B.length;P<k;P++)v(B[P],S,M,L,w)}function _(C){C.target.removeEventListener("dispose",_);for(const M in c){const L=c[M],w=C.target.uuid;w in L&&(L[w].dispose(),delete L[w])}}}const Ffe={[Mw]:lx,[U0]:hx,[rm]:X0,[wp]:cx,[lx]:Mw,[hx]:U0,[X0]:rm,[cx]:wp};function Vfe(s){function e(){let te=!1;const xt=new Je;let ie=null;const Ue=new Je(0,0,0,0);return{setMask:function(bt){ie!==bt&&!te&&(s.colorMask(bt,bt,bt,bt),ie=bt)},setLocked:function(bt){te=bt},setClear:function(bt,vt,Di,bs,Vo){Vo===!0&&(bt*=bs,vt*=bs,Di*=bs),xt.set(bt,vt,Di,bs),Ue.equals(xt)===!1&&(s.clearColor(bt,vt,Di,bs),Ue.copy(xt))},reset:function(){te=!1,ie=null,Ue.set(-1,0,0,0)}}}function t(){let te=!1,xt=!1,ie=null,Ue=null,bt=null;return{setReversed:function(vt){xt=vt},setTest:function(vt){vt?Se(s.DEPTH_TEST):Le(s.DEPTH_TEST)},setMask:function(vt){ie!==vt&&!te&&(s.depthMask(vt),ie=vt)},setFunc:function(vt){if(xt&&(vt=Ffe[vt]),Ue!==vt){switch(vt){case Mw:s.depthFunc(s.NEVER);break;case lx:s.depthFunc(s.ALWAYS);break;case U0:s.depthFunc(s.LESS);break;case wp:s.depthFunc(s.LEQUAL);break;case rm:s.depthFunc(s.EQUAL);break;case cx:s.depthFunc(s.GEQUAL);break;case hx:s.depthFunc(s.GREATER);break;case X0:s.depthFunc(s.NOTEQUAL);break;default:s.depthFunc(s.LEQUAL)}Ue=vt}},setLocked:function(vt){te=vt},setClear:function(vt){bt!==vt&&(s.clearDepth(vt),bt=vt)},reset:function(){te=!1,ie=null,Ue=null,bt=null}}}function i(){let te=!1,xt=null,ie=null,Ue=null,bt=null,vt=null,Di=null,bs=null,Vo=null;return{setTest:function(Ki){te||(Ki?Se(s.STENCIL_TEST):Le(s.STENCIL_TEST))},setMask:function(Ki){xt!==Ki&&!te&&(s.stencilMask(Ki),xt=Ki)},setFunc:function(Ki,zo,jc){(ie!==Ki||Ue!==zo||bt!==jc)&&(s.stencilFunc(Ki,zo,jc),ie=Ki,Ue=zo,bt=jc)},setOp:function(Ki,zo,jc){(vt!==Ki||Di!==zo||bs!==jc)&&(s.stencilOp(Ki,zo,jc),vt=Ki,Di=zo,bs=jc)},setLocked:function(Ki){te=Ki},setClear:function(Ki){Vo!==Ki&&(s.clearStencil(Ki),Vo=Ki)},reset:function(){te=!1,xt=null,ie=null,Ue=null,bt=null,vt=null,Di=null,bs=null,Vo=null}}}const n=new e,r=new t,o=new i,a=new WeakMap,l=new WeakMap;let c={},h={},d=new WeakMap,u=[],f=null,m=!1,g=null,A=null,y=null,b=null,x=null,v=null,_=null,C=new ge(0,0,0),S=0,M=!1,L=null,w=null,E=null,B=null,P=null;const k=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let X=!1,F=0;const H=s.getParameter(s.VERSION);H.indexOf("WebGL")!==-1?(F=parseFloat(/^WebGL (\d)/.exec(H)[1]),X=F>=1):H.indexOf("OpenGL ES")!==-1&&(F=parseFloat(/^OpenGL ES (\d)/.exec(H)[1]),X=F>=2);let W=null,se={};const de=s.getParameter(s.SCISSOR_BOX),be=s.getParameter(s.VIEWPORT),Pe=new Je().fromArray(de),Oe=new Je().fromArray(be);function ae(te,xt,ie,Ue){const bt=new Uint8Array(4),vt=s.createTexture();s.bindTexture(te,vt),s.texParameteri(te,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(te,s.TEXTURE_MAG_FILTER,s.NEAREST);for(let Di=0;Di<ie;Di++)te===s.TEXTURE_3D||te===s.TEXTURE_2D_ARRAY?s.texImage3D(xt,0,s.RGBA,1,1,Ue,0,s.RGBA,s.UNSIGNED_BYTE,bt):s.texImage2D(xt+Di,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,bt);return vt}const Ae={};Ae[s.TEXTURE_2D]=ae(s.TEXTURE_2D,s.TEXTURE_2D,1),Ae[s.TEXTURE_CUBE_MAP]=ae(s.TEXTURE_CUBE_MAP,s.TEXTURE_CUBE_MAP_POSITIVE_X,6),Ae[s.TEXTURE_2D_ARRAY]=ae(s.TEXTURE_2D_ARRAY,s.TEXTURE_2D_ARRAY,1,1),Ae[s.TEXTURE_3D]=ae(s.TEXTURE_3D,s.TEXTURE_3D,1,1),n.setClear(0,0,0,1),r.setClear(1),o.setClear(0),Se(s.DEPTH_TEST),r.setFunc(wp),je(!1),We(DF),Se(s.CULL_FACE),Z(Fn);function Se(te){c[te]!==!0&&(s.enable(te),c[te]=!0)}function Le(te){c[te]!==!1&&(s.disable(te),c[te]=!1)}function st(te,xt){return h[te]!==xt?(s.bindFramebuffer(te,xt),h[te]=xt,te===s.DRAW_FRAMEBUFFER&&(h[s.FRAMEBUFFER]=xt),te===s.FRAMEBUFFER&&(h[s.DRAW_FRAMEBUFFER]=xt),!0):!1}function ot(te,xt){let ie=u,Ue=!1;if(te){ie=d.get(xt),ie===void 0&&(ie=[],d.set(xt,ie));const bt=te.textures;if(ie.length!==bt.length||ie[0]!==s.COLOR_ATTACHMENT0){for(let vt=0,Di=bt.length;vt<Di;vt++)ie[vt]=s.COLOR_ATTACHMENT0+vt;ie.length=bt.length,Ue=!0}}else ie[0]!==s.BACK&&(ie[0]=s.BACK,Ue=!0);Ue&&s.drawBuffers(ie)}function Ct(te){return f!==te?(s.useProgram(te),f=te,!0):!1}const zt={[Lf]:s.FUNC_ADD,[Cj]:s.FUNC_SUBTRACT,[wj]:s.FUNC_REVERSE_SUBTRACT};zt[Sj]=s.MIN,zt[xU]=s.MAX;const ke={[Mj]:s.ZERO,[Ij]:s.ONE,[Tj]:s.SRC_COLOR,[$R]:s.SRC_ALPHA,[Gj]:s.SRC_ALPHA_SATURATE,[Bj]:s.DST_COLOR,[Rj]:s.DST_ALPHA,[Ej]:s.ONE_MINUS_SRC_COLOR,[eL]:s.ONE_MINUS_SRC_ALPHA,[Pj]:s.ONE_MINUS_DST_COLOR,[Lj]:s.ONE_MINUS_DST_ALPHA,[kj]:s.CONSTANT_COLOR,[Nj]:s.ONE_MINUS_CONSTANT_COLOR,[Dj]:s.CONSTANT_ALPHA,[Fj]:s.ONE_MINUS_CONSTANT_ALPHA};function Z(te,xt,ie,Ue,bt,vt,Di,bs,Vo,Ki){if(te===Fn){m===!0&&(Le(s.BLEND),m=!1);return}if(m===!1&&(Se(s.BLEND),m=!0),te!==bU){if(te!==g||Ki!==M){if((A!==Lf||x!==Lf)&&(s.blendEquation(s.FUNC_ADD),A=Lf,x=Lf),Ki)switch(te){case fp:s.blendFuncSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case sm:s.blendFunc(s.ONE,s.ONE);break;case FF:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case VF:s.blendFuncSeparate(s.ZERO,s.SRC_COLOR,s.ZERO,s.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",te);break}else switch(te){case fp:s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case sm:s.blendFunc(s.SRC_ALPHA,s.ONE);break;case FF:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case VF:s.blendFunc(s.ZERO,s.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",te);break}y=null,b=null,v=null,_=null,C.set(0,0,0),S=0,g=te,M=Ki}return}bt=bt||xt,vt=vt||ie,Di=Di||Ue,(xt!==A||bt!==x)&&(s.blendEquationSeparate(zt[xt],zt[bt]),A=xt,x=bt),(ie!==y||Ue!==b||vt!==v||Di!==_)&&(s.blendFuncSeparate(ke[ie],ke[Ue],ke[vt],ke[Di]),y=ie,b=Ue,v=vt,_=Di),(bs.equals(C)===!1||Vo!==S)&&(s.blendColor(bs.r,bs.g,bs.b,Vo),C.copy(bs),S=Vo),g=te,M=!1}function Ke(te,xt){te.side===Zi?Le(s.CULL_FACE):Se(s.CULL_FACE);let ie=te.side===vn;xt&&(ie=!ie),je(ie),te.blending===fp&&te.transparent===!1?Z(Fn):Z(te.blending,te.blendEquation,te.blendSrc,te.blendDst,te.blendEquationAlpha,te.blendSrcAlpha,te.blendDstAlpha,te.blendColor,te.blendAlpha,te.premultipliedAlpha),r.setFunc(te.depthFunc),r.setTest(te.depthTest),r.setMask(te.depthWrite),n.setMask(te.colorWrite);const Ue=te.stencilWrite;o.setTest(Ue),Ue&&(o.setMask(te.stencilWriteMask),o.setFunc(te.stencilFunc,te.stencilRef,te.stencilFuncMask),o.setOp(te.stencilFail,te.stencilZFail,te.stencilZPass)),Tt(te.polygonOffset,te.polygonOffsetFactor,te.polygonOffsetUnits),te.alphaToCoverage===!0?Se(s.SAMPLE_ALPHA_TO_COVERAGE):Le(s.SAMPLE_ALPHA_TO_COVERAGE)}function je(te){L!==te&&(te?s.frontFace(s.CW):s.frontFace(s.CCW),L=te)}function We(te){te!==vj?(Se(s.CULL_FACE),te!==w&&(te===DF?s.cullFace(s.BACK):te===_j?s.cullFace(s.FRONT):s.cullFace(s.FRONT_AND_BACK))):Le(s.CULL_FACE),w=te}function nt(te){te!==E&&(X&&s.lineWidth(te),E=te)}function Tt(te,xt,ie){te?(Se(s.POLYGON_OFFSET_FILL),(B!==xt||P!==ie)&&(s.polygonOffset(xt,ie),B=xt,P=ie)):Le(s.POLYGON_OFFSET_FILL)}function mt(te){te?Se(s.SCISSOR_TEST):Le(s.SCISSOR_TEST)}function O(te){te===void 0&&(te=s.TEXTURE0+k-1),W!==te&&(s.activeTexture(te),W=te)}function D(te,xt,ie){ie===void 0&&(W===null?ie=s.TEXTURE0+k-1:ie=W);let Ue=se[ie];Ue===void 0&&(Ue={type:void 0,texture:void 0},se[ie]=Ue),(Ue.type!==te||Ue.texture!==xt)&&(W!==ie&&(s.activeTexture(ie),W=ie),s.bindTexture(te,xt||Ae[te]),Ue.type=te,Ue.texture=xt)}function he(){const te=se[W];te!==void 0&&te.type!==void 0&&(s.bindTexture(te.type,null),te.type=void 0,te.texture=void 0)}function Ee(){try{s.compressedTexImage2D.apply(s,arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function Ne(){try{s.compressedTexImage3D.apply(s,arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function Re(){try{s.texSubImage2D.apply(s,arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function yt(){try{s.texSubImage3D.apply(s,arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function et(){try{s.compressedTexSubImage2D.apply(s,arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function ct(){try{s.compressedTexSubImage3D.apply(s,arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function Jt(){try{s.texStorage2D.apply(s,arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function Ge(){try{s.texStorage3D.apply(s,arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function At(){try{s.texImage2D.apply(s,arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function Kt(){try{s.texImage3D.apply(s,arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function Lt(te){Pe.equals(te)===!1&&(s.scissor(te.x,te.y,te.z,te.w),Pe.copy(te))}function at(te){Oe.equals(te)===!1&&(s.viewport(te.x,te.y,te.z,te.w),Oe.copy(te))}function kt(te,xt){let ie=l.get(xt);ie===void 0&&(ie=new WeakMap,l.set(xt,ie));let Ue=ie.get(te);Ue===void 0&&(Ue=s.getUniformBlockIndex(xt,te.name),ie.set(te,Ue))}function jt(te,xt){const Ue=l.get(xt).get(te);a.get(xt)!==Ue&&(s.uniformBlockBinding(xt,Ue,te.__bindingPointIndex),a.set(xt,Ue))}function yi(){s.disable(s.BLEND),s.disable(s.CULL_FACE),s.disable(s.DEPTH_TEST),s.disable(s.POLYGON_OFFSET_FILL),s.disable(s.SCISSOR_TEST),s.disable(s.STENCIL_TEST),s.disable(s.SAMPLE_ALPHA_TO_COVERAGE),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ONE,s.ZERO),s.blendFuncSeparate(s.ONE,s.ZERO,s.ONE,s.ZERO),s.blendColor(0,0,0,0),s.colorMask(!0,!0,!0,!0),s.clearColor(0,0,0,0),s.depthMask(!0),s.depthFunc(s.LESS),s.clearDepth(1),s.stencilMask(4294967295),s.stencilFunc(s.ALWAYS,0,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.KEEP),s.clearStencil(0),s.cullFace(s.BACK),s.frontFace(s.CCW),s.polygonOffset(0,0),s.activeTexture(s.TEXTURE0),s.bindFramebuffer(s.FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.useProgram(null),s.lineWidth(1),s.scissor(0,0,s.canvas.width,s.canvas.height),s.viewport(0,0,s.canvas.width,s.canvas.height),c={},W=null,se={},h={},d=new WeakMap,u=[],f=null,m=!1,g=null,A=null,y=null,b=null,x=null,v=null,_=null,C=new ge(0,0,0),S=0,M=!1,L=null,w=null,E=null,B=null,P=null,Pe.set(0,0,s.canvas.width,s.canvas.height),Oe.set(0,0,s.canvas.width,s.canvas.height),n.reset(),r.reset(),o.reset()}return{buffers:{color:n,depth:r,stencil:o},enable:Se,disable:Le,bindFramebuffer:st,drawBuffers:ot,useProgram:Ct,setBlending:Z,setMaterial:Ke,setFlipSided:je,setCullFace:We,setLineWidth:nt,setPolygonOffset:Tt,setScissorTest:mt,activeTexture:O,bindTexture:D,unbindTexture:he,compressedTexImage2D:Ee,compressedTexImage3D:Ne,texImage2D:At,texImage3D:Kt,updateUBOMapping:kt,uniformBlockBinding:jt,texStorage2D:Jt,texStorage3D:Ge,texSubImage2D:Re,texSubImage3D:yt,compressedTexSubImage2D:et,compressedTexSubImage3D:ct,scissor:Lt,viewport:at,reset:yi}}function zfe(s,e){const t=s.image&&s.image.width?s.image.width/s.image.height:1;return t>e?(s.repeat.x=1,s.repeat.y=t/e,s.offset.x=0,s.offset.y=(1-s.repeat.y)/2):(s.repeat.x=e/t,s.repeat.y=1,s.offset.x=(1-s.repeat.x)/2,s.offset.y=0),s}function Ufe(s,e){const t=s.image&&s.image.width?s.image.width/s.image.height:1;return t>e?(s.repeat.x=e/t,s.repeat.y=1,s.offset.x=(1-s.repeat.x)/2,s.offset.y=0):(s.repeat.x=1,s.repeat.y=t/e,s.offset.x=0,s.offset.y=(1-s.repeat.y)/2),s}function Xfe(s){return s.repeat.x=1,s.repeat.y=1,s.offset.x=0,s.offset.y=0,s}function WF(s,e,t,i){const n=Ofe(i);switch(t){case SU:return s*e;case A1:return s*e;case IU:return s*e*2;case Vl:return s*e/n.components*n.byteLength;case Ux:return s*e/n.components*n.byteLength;case Pc:return s*e*2/n.components*n.byteLength;case Xx:return s*e*2/n.components*n.byteLength;case MU:return s*e*3/n.components*n.byteLength;case bi:return s*e*4/n.components*n.byteLength;case Z0:return s*e*4/n.components*n.byteLength;case GC:case Xb:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*8;case kC:case Ob:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case tL:case iL:return Math.max(s,16)*Math.max(e,8)/4;case Tw:case Ew:return Math.max(s,8)*Math.max(e,8)/2;case Rw:case Lw:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*8;case Bw:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case dx:return Math.floor((s+3)/4)*Math.floor((e+3)/4)*16;case nL:return Math.floor((s+4)/5)*Math.floor((e+3)/4)*16;case sL:return Math.floor((s+4)/5)*Math.floor((e+4)/5)*16;case rL:return Math.floor((s+5)/6)*Math.floor((e+4)/5)*16;case ux:return Math.floor((s+5)/6)*Math.floor((e+5)/6)*16;case oL:return Math.floor((s+7)/8)*Math.floor((e+4)/5)*16;case aL:return Math.floor((s+7)/8)*Math.floor((e+5)/6)*16;case lL:return Math.floor((s+7)/8)*Math.floor((e+7)/8)*16;case cL:return Math.floor((s+9)/10)*Math.floor((e+4)/5)*16;case hL:return Math.floor((s+9)/10)*Math.floor((e+5)/6)*16;case dL:return Math.floor((s+9)/10)*Math.floor((e+7)/8)*16;case uL:return Math.floor((s+9)/10)*Math.floor((e+9)/10)*16;case pL:return Math.floor((s+11)/12)*Math.floor((e+9)/10)*16;case fL:return Math.floor((s+11)/12)*Math.floor((e+11)/12)*16;case Zb:case mL:case gL:return Math.ceil(s/4)*Math.ceil(e/4)*16;case TU:case AL:return Math.ceil(s/4)*Math.ceil(e/4)*8;case yL:case bL:return Math.ceil(s/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function Ofe(s){switch(s){case Pi:case Iw:return{byteLength:1,components:1};case O0:case Q2:case Wi:return{byteLength:2,components:1};case K2:case Y2:return{byteLength:2,components:4};case Wr:case Dd:case $i:return{byteLength:4,components:1};case wU:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${s}.`)}const Zfe={contain:zfe,cover:Ufe,fill:Xfe,getByteLength:WF};function Wfe(s,e,t,i,n,r,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new Q,h=new WeakMap;let d;const u=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(O,D){return f?new OffscreenCanvas(O,D):Fw("canvas")}function g(O,D,he){let Ee=1;const Ne=mt(O);if((Ne.width>he||Ne.height>he)&&(Ee=he/Math.max(Ne.width,Ne.height)),Ee<1)if(typeof HTMLImageElement<"u"&&O instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&O instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&O instanceof ImageBitmap||typeof VideoFrame<"u"&&O instanceof VideoFrame){const Re=Math.floor(Ee*Ne.width),yt=Math.floor(Ee*Ne.height);d===void 0&&(d=m(Re,yt));const et=D?m(Re,yt):d;return et.width=Re,et.height=yt,et.getContext("2d").drawImage(O,0,0,Re,yt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ne.width+"x"+Ne.height+") to ("+Re+"x"+yt+")."),et}else return"data"in O&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ne.width+"x"+Ne.height+")."),O;return O}function A(O){return O.generateMipmaps&&O.minFilter!==qt&&O.minFilter!==Ot}function y(O){s.generateMipmap(O)}function b(O,D,he,Ee,Ne=!1){if(O!==null){if(s[O]!==void 0)return s[O];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+O+"'")}let Re=D;if(D===s.RED&&(he===s.FLOAT&&(Re=s.R32F),he===s.HALF_FLOAT&&(Re=s.R16F),he===s.UNSIGNED_BYTE&&(Re=s.R8)),D===s.RED_INTEGER&&(he===s.UNSIGNED_BYTE&&(Re=s.R8UI),he===s.UNSIGNED_SHORT&&(Re=s.R16UI),he===s.UNSIGNED_INT&&(Re=s.R32UI),he===s.BYTE&&(Re=s.R8I),he===s.SHORT&&(Re=s.R16I),he===s.INT&&(Re=s.R32I)),D===s.RG&&(he===s.FLOAT&&(Re=s.RG32F),he===s.HALF_FLOAT&&(Re=s.RG16F),he===s.UNSIGNED_BYTE&&(Re=s.RG8)),D===s.RG_INTEGER&&(he===s.UNSIGNED_BYTE&&(Re=s.RG8UI),he===s.UNSIGNED_SHORT&&(Re=s.RG16UI),he===s.UNSIGNED_INT&&(Re=s.RG32UI),he===s.BYTE&&(Re=s.RG8I),he===s.SHORT&&(Re=s.RG16I),he===s.INT&&(Re=s.RG32I)),D===s.RGB_INTEGER&&(he===s.UNSIGNED_BYTE&&(Re=s.RGB8UI),he===s.UNSIGNED_SHORT&&(Re=s.RGB16UI),he===s.UNSIGNED_INT&&(Re=s.RGB32UI),he===s.BYTE&&(Re=s.RGB8I),he===s.SHORT&&(Re=s.RGB16I),he===s.INT&&(Re=s.RGB32I)),D===s.RGBA_INTEGER&&(he===s.UNSIGNED_BYTE&&(Re=s.RGBA8UI),he===s.UNSIGNED_SHORT&&(Re=s.RGBA16UI),he===s.UNSIGNED_INT&&(Re=s.RGBA32UI),he===s.BYTE&&(Re=s.RGBA8I),he===s.SHORT&&(Re=s.RGBA16I),he===s.INT&&(Re=s.RGBA32I)),D===s.RGB&&he===s.UNSIGNED_INT_5_9_9_9_REV&&(Re=s.RGB9_E5),D===s.RGBA){const yt=Ne?kw:ni.getTransfer(Ee);he===s.FLOAT&&(Re=s.RGBA32F),he===s.HALF_FLOAT&&(Re=s.RGBA16F),he===s.UNSIGNED_BYTE&&(Re=yt===Ln?s.SRGB8_ALPHA8:s.RGBA8),he===s.UNSIGNED_SHORT_4_4_4_4&&(Re=s.RGBA4),he===s.UNSIGNED_SHORT_5_5_5_1&&(Re=s.RGB5_A1)}return(Re===s.R16F||Re===s.R32F||Re===s.RG16F||Re===s.RG32F||Re===s.RGBA16F||Re===s.RGBA32F)&&e.get("EXT_color_buffer_float"),Re}function x(O,D){let he;return O?D===null||D===Wr||D===lm?he=s.DEPTH24_STENCIL8:D===$i?he=s.DEPTH32F_STENCIL8:D===O0&&(he=s.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):D===null||D===Wr||D===lm?he=s.DEPTH_COMPONENT24:D===$i?he=s.DEPTH_COMPONENT32F:D===O0&&(he=s.DEPTH_COMPONENT16),he}function v(O,D){return A(O)===!0||O.isFramebufferTexture&&O.minFilter!==qt&&O.minFilter!==Ot?Math.log2(Math.max(D.width,D.height))+1:O.mipmaps!==void 0&&O.mipmaps.length>0?O.mipmaps.length:O.isCompressedTexture&&Array.isArray(O.image)?D.mipmaps.length:1}function _(O){const D=O.target;D.removeEventListener("dispose",_),S(D),D.isVideoTexture&&h.delete(D)}function C(O){const D=O.target;D.removeEventListener("dispose",C),L(D)}function S(O){const D=i.get(O);if(D.__webglInit===void 0)return;const he=O.source,Ee=u.get(he);if(Ee){const Ne=Ee[D.__cacheKey];Ne.usedTimes--,Ne.usedTimes===0&&M(O),Object.keys(Ee).length===0&&u.delete(he)}i.remove(O)}function M(O){const D=i.get(O);s.deleteTexture(D.__webglTexture);const he=O.source,Ee=u.get(he);delete Ee[D.__cacheKey],o.memory.textures--}function L(O){const D=i.get(O);if(O.depthTexture&&O.depthTexture.dispose(),O.isWebGLCubeRenderTarget)for(let Ee=0;Ee<6;Ee++){if(Array.isArray(D.__webglFramebuffer[Ee]))for(let Ne=0;Ne<D.__webglFramebuffer[Ee].length;Ne++)s.deleteFramebuffer(D.__webglFramebuffer[Ee][Ne]);else s.deleteFramebuffer(D.__webglFramebuffer[Ee]);D.__webglDepthbuffer&&s.deleteRenderbuffer(D.__webglDepthbuffer[Ee])}else{if(Array.isArray(D.__webglFramebuffer))for(let Ee=0;Ee<D.__webglFramebuffer.length;Ee++)s.deleteFramebuffer(D.__webglFramebuffer[Ee]);else s.deleteFramebuffer(D.__webglFramebuffer);if(D.__webglDepthbuffer&&s.deleteRenderbuffer(D.__webglDepthbuffer),D.__webglMultisampledFramebuffer&&s.deleteFramebuffer(D.__webglMultisampledFramebuffer),D.__webglColorRenderbuffer)for(let Ee=0;Ee<D.__webglColorRenderbuffer.length;Ee++)D.__webglColorRenderbuffer[Ee]&&s.deleteRenderbuffer(D.__webglColorRenderbuffer[Ee]);D.__webglDepthRenderbuffer&&s.deleteRenderbuffer(D.__webglDepthRenderbuffer)}const he=O.textures;for(let Ee=0,Ne=he.length;Ee<Ne;Ee++){const Re=i.get(he[Ee]);Re.__webglTexture&&(s.deleteTexture(Re.__webglTexture),o.memory.textures--),i.remove(he[Ee])}i.remove(O)}let w=0;function E(){w=0}function B(){const O=w;return O>=n.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+O+" texture units while this GPU supports only "+n.maxTextures),w+=1,O}function P(O){const D=[];return D.push(O.wrapS),D.push(O.wrapT),D.push(O.wrapR||0),D.push(O.magFilter),D.push(O.minFilter),D.push(O.anisotropy),D.push(O.internalFormat),D.push(O.format),D.push(O.type),D.push(O.generateMipmaps),D.push(O.premultiplyAlpha),D.push(O.flipY),D.push(O.unpackAlignment),D.push(O.colorSpace),D.join()}function k(O,D){const he=i.get(O);if(O.isVideoTexture&&nt(O),O.isRenderTargetTexture===!1&&O.version>0&&he.__version!==O.version){const Ee=O.image;if(Ee===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ee.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Oe(he,O,D);return}}t.bindTexture(s.TEXTURE_2D,he.__webglTexture,s.TEXTURE0+D)}function X(O,D){const he=i.get(O);if(O.version>0&&he.__version!==O.version){Oe(he,O,D);return}t.bindTexture(s.TEXTURE_2D_ARRAY,he.__webglTexture,s.TEXTURE0+D)}function F(O,D){const he=i.get(O);if(O.version>0&&he.__version!==O.version){Oe(he,O,D);return}t.bindTexture(s.TEXTURE_3D,he.__webglTexture,s.TEXTURE0+D)}function H(O,D){const he=i.get(O);if(O.version>0&&he.__version!==O.version){ae(he,O,D);return}t.bindTexture(s.TEXTURE_CUBE_MAP,he.__webglTexture,s.TEXTURE0+D)}const W={[Mo]:s.REPEAT,[ea]:s.CLAMP_TO_EDGE,[Sp]:s.MIRRORED_REPEAT},se={[qt]:s.NEAREST,[g1]:s.NEAREST_MIPMAP_NEAREST,[Id]:s.NEAREST_MIPMAP_LINEAR,[Ot]:s.LINEAR,[mp]:s.LINEAR_MIPMAP_NEAREST,[xr]:s.LINEAR_MIPMAP_LINEAR},de={[n8]:s.NEVER,[l8]:s.ALWAYS,[PU]:s.LESS,[GU]:s.LEQUAL,[s8]:s.EQUAL,[a8]:s.GEQUAL,[r8]:s.GREATER,[o8]:s.NOTEQUAL};function be(O,D){if(D.type===$i&&e.has("OES_texture_float_linear")===!1&&(D.magFilter===Ot||D.magFilter===mp||D.magFilter===Id||D.magFilter===xr||D.minFilter===Ot||D.minFilter===mp||D.minFilter===Id||D.minFilter===xr)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),s.texParameteri(O,s.TEXTURE_WRAP_S,W[D.wrapS]),s.texParameteri(O,s.TEXTURE_WRAP_T,W[D.wrapT]),(O===s.TEXTURE_3D||O===s.TEXTURE_2D_ARRAY)&&s.texParameteri(O,s.TEXTURE_WRAP_R,W[D.wrapR]),s.texParameteri(O,s.TEXTURE_MAG_FILTER,se[D.magFilter]),s.texParameteri(O,s.TEXTURE_MIN_FILTER,se[D.minFilter]),D.compareFunction&&(s.texParameteri(O,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(O,s.TEXTURE_COMPARE_FUNC,de[D.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(D.magFilter===qt||D.minFilter!==Id&&D.minFilter!==xr||D.type===$i&&e.has("OES_texture_float_linear")===!1)return;if(D.anisotropy>1||i.get(D).__currentAnisotropy){const he=e.get("EXT_texture_filter_anisotropic");s.texParameterf(O,he.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(D.anisotropy,n.getMaxAnisotropy())),i.get(D).__currentAnisotropy=D.anisotropy}}}function Pe(O,D){let he=!1;O.__webglInit===void 0&&(O.__webglInit=!0,D.addEventListener("dispose",_));const Ee=D.source;let Ne=u.get(Ee);Ne===void 0&&(Ne={},u.set(Ee,Ne));const Re=P(D);if(Re!==O.__cacheKey){Ne[Re]===void 0&&(Ne[Re]={texture:s.createTexture(),usedTimes:0},o.memory.textures++,he=!0),Ne[Re].usedTimes++;const yt=Ne[O.__cacheKey];yt!==void 0&&(Ne[O.__cacheKey].usedTimes--,yt.usedTimes===0&&M(D)),O.__cacheKey=Re,O.__webglTexture=Ne[Re].texture}return he}function Oe(O,D,he){let Ee=s.TEXTURE_2D;(D.isDataArrayTexture||D.isCompressedArrayTexture)&&(Ee=s.TEXTURE_2D_ARRAY),D.isData3DTexture&&(Ee=s.TEXTURE_3D);const Ne=Pe(O,D),Re=D.source;t.bindTexture(Ee,O.__webglTexture,s.TEXTURE0+he);const yt=i.get(Re);if(Re.version!==yt.__version||Ne===!0){t.activeTexture(s.TEXTURE0+he);const et=ni.getPrimaries(ni.workingColorSpace),ct=D.colorSpace===Fr?null:ni.getPrimaries(D.colorSpace),Jt=D.colorSpace===Fr||et===ct?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,D.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,D.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,D.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,Jt);let Ge=g(D.image,!1,n.maxTextureSize);Ge=Tt(D,Ge);const At=r.convert(D.format,D.colorSpace),Kt=r.convert(D.type);let Lt=b(D.internalFormat,At,Kt,D.colorSpace,D.isVideoTexture);be(Ee,D);let at;const kt=D.mipmaps,jt=D.isVideoTexture!==!0,yi=yt.__version===void 0||Ne===!0,te=Re.dataReady,xt=v(D,Ge);if(D.isDepthTexture)Lt=x(D.format===cm,D.type),yi&&(jt?t.texStorage2D(s.TEXTURE_2D,1,Lt,Ge.width,Ge.height):t.texImage2D(s.TEXTURE_2D,0,Lt,Ge.width,Ge.height,0,At,Kt,null));else if(D.isDataTexture)if(kt.length>0){jt&&yi&&t.texStorage2D(s.TEXTURE_2D,xt,Lt,kt[0].width,kt[0].height);for(let ie=0,Ue=kt.length;ie<Ue;ie++)at=kt[ie],jt?te&&t.texSubImage2D(s.TEXTURE_2D,ie,0,0,at.width,at.height,At,Kt,at.data):t.texImage2D(s.TEXTURE_2D,ie,Lt,at.width,at.height,0,At,Kt,at.data);D.generateMipmaps=!1}else jt?(yi&&t.texStorage2D(s.TEXTURE_2D,xt,Lt,Ge.width,Ge.height),te&&t.texSubImage2D(s.TEXTURE_2D,0,0,0,Ge.width,Ge.height,At,Kt,Ge.data)):t.texImage2D(s.TEXTURE_2D,0,Lt,Ge.width,Ge.height,0,At,Kt,Ge.data);else if(D.isCompressedTexture)if(D.isCompressedArrayTexture){jt&&yi&&t.texStorage3D(s.TEXTURE_2D_ARRAY,xt,Lt,kt[0].width,kt[0].height,Ge.depth);for(let ie=0,Ue=kt.length;ie<Ue;ie++)if(at=kt[ie],D.format!==bi)if(At!==null)if(jt){if(te)if(D.layerUpdates.size>0){const bt=WF(at.width,at.height,D.format,D.type);for(const vt of D.layerUpdates){const Di=at.data.subarray(vt*bt/at.data.BYTES_PER_ELEMENT,(vt+1)*bt/at.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,ie,0,0,vt,at.width,at.height,1,At,Di,0,0)}D.clearLayerUpdates()}else t.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,ie,0,0,0,at.width,at.height,Ge.depth,At,at.data,0,0)}else t.compressedTexImage3D(s.TEXTURE_2D_ARRAY,ie,Lt,at.width,at.height,Ge.depth,0,at.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else jt?te&&t.texSubImage3D(s.TEXTURE_2D_ARRAY,ie,0,0,0,at.width,at.height,Ge.depth,At,Kt,at.data):t.texImage3D(s.TEXTURE_2D_ARRAY,ie,Lt,at.width,at.height,Ge.depth,0,At,Kt,at.data)}else{jt&&yi&&t.texStorage2D(s.TEXTURE_2D,xt,Lt,kt[0].width,kt[0].height);for(let ie=0,Ue=kt.length;ie<Ue;ie++)at=kt[ie],D.format!==bi?At!==null?jt?te&&t.compressedTexSubImage2D(s.TEXTURE_2D,ie,0,0,at.width,at.height,At,at.data):t.compressedTexImage2D(s.TEXTURE_2D,ie,Lt,at.width,at.height,0,at.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):jt?te&&t.texSubImage2D(s.TEXTURE_2D,ie,0,0,at.width,at.height,At,Kt,at.data):t.texImage2D(s.TEXTURE_2D,ie,Lt,at.width,at.height,0,At,Kt,at.data)}else if(D.isDataArrayTexture)if(jt){if(yi&&t.texStorage3D(s.TEXTURE_2D_ARRAY,xt,Lt,Ge.width,Ge.height,Ge.depth),te)if(D.layerUpdates.size>0){const ie=WF(Ge.width,Ge.height,D.format,D.type);for(const Ue of D.layerUpdates){const bt=Ge.data.subarray(Ue*ie/Ge.data.BYTES_PER_ELEMENT,(Ue+1)*ie/Ge.data.BYTES_PER_ELEMENT);t.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,Ue,Ge.width,Ge.height,1,At,Kt,bt)}D.clearLayerUpdates()}else t.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,0,Ge.width,Ge.height,Ge.depth,At,Kt,Ge.data)}else t.texImage3D(s.TEXTURE_2D_ARRAY,0,Lt,Ge.width,Ge.height,Ge.depth,0,At,Kt,Ge.data);else if(D.isData3DTexture)jt?(yi&&t.texStorage3D(s.TEXTURE_3D,xt,Lt,Ge.width,Ge.height,Ge.depth),te&&t.texSubImage3D(s.TEXTURE_3D,0,0,0,0,Ge.width,Ge.height,Ge.depth,At,Kt,Ge.data)):t.texImage3D(s.TEXTURE_3D,0,Lt,Ge.width,Ge.height,Ge.depth,0,At,Kt,Ge.data);else if(D.isFramebufferTexture){if(yi)if(jt)t.texStorage2D(s.TEXTURE_2D,xt,Lt,Ge.width,Ge.height);else{let ie=Ge.width,Ue=Ge.height;for(let bt=0;bt<xt;bt++)t.texImage2D(s.TEXTURE_2D,bt,Lt,ie,Ue,0,At,Kt,null),ie>>=1,Ue>>=1}}else if(kt.length>0){if(jt&&yi){const ie=mt(kt[0]);t.texStorage2D(s.TEXTURE_2D,xt,Lt,ie.width,ie.height)}for(let ie=0,Ue=kt.length;ie<Ue;ie++)at=kt[ie],jt?te&&t.texSubImage2D(s.TEXTURE_2D,ie,0,0,At,Kt,at):t.texImage2D(s.TEXTURE_2D,ie,Lt,At,Kt,at);D.generateMipmaps=!1}else if(jt){if(yi){const ie=mt(Ge);t.texStorage2D(s.TEXTURE_2D,xt,Lt,ie.width,ie.height)}te&&t.texSubImage2D(s.TEXTURE_2D,0,0,0,At,Kt,Ge)}else t.texImage2D(s.TEXTURE_2D,0,Lt,At,Kt,Ge);A(D)&&y(Ee),yt.__version=Re.version,D.onUpdate&&D.onUpdate(D)}O.__version=D.version}function ae(O,D,he){if(D.image.length!==6)return;const Ee=Pe(O,D),Ne=D.source;t.bindTexture(s.TEXTURE_CUBE_MAP,O.__webglTexture,s.TEXTURE0+he);const Re=i.get(Ne);if(Ne.version!==Re.__version||Ee===!0){t.activeTexture(s.TEXTURE0+he);const yt=ni.getPrimaries(ni.workingColorSpace),et=D.colorSpace===Fr?null:ni.getPrimaries(D.colorSpace),ct=D.colorSpace===Fr||yt===et?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,D.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,D.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,D.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,ct);const Jt=D.isCompressedTexture||D.image[0].isCompressedTexture,Ge=D.image[0]&&D.image[0].isDataTexture,At=[];for(let Ue=0;Ue<6;Ue++)!Jt&&!Ge?At[Ue]=g(D.image[Ue],!0,n.maxCubemapSize):At[Ue]=Ge?D.image[Ue].image:D.image[Ue],At[Ue]=Tt(D,At[Ue]);const Kt=At[0],Lt=r.convert(D.format,D.colorSpace),at=r.convert(D.type),kt=b(D.internalFormat,Lt,at,D.colorSpace),jt=D.isVideoTexture!==!0,yi=Re.__version===void 0||Ee===!0,te=Ne.dataReady;let xt=v(D,Kt);be(s.TEXTURE_CUBE_MAP,D);let ie;if(Jt){jt&&yi&&t.texStorage2D(s.TEXTURE_CUBE_MAP,xt,kt,Kt.width,Kt.height);for(let Ue=0;Ue<6;Ue++){ie=At[Ue].mipmaps;for(let bt=0;bt<ie.length;bt++){const vt=ie[bt];D.format!==bi?Lt!==null?jt?te&&t.compressedTexSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,bt,0,0,vt.width,vt.height,Lt,vt.data):t.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,bt,kt,vt.width,vt.height,0,vt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):jt?te&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,bt,0,0,vt.width,vt.height,Lt,at,vt.data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,bt,kt,vt.width,vt.height,0,Lt,at,vt.data)}}}else{if(ie=D.mipmaps,jt&&yi){ie.length>0&&xt++;const Ue=mt(At[0]);t.texStorage2D(s.TEXTURE_CUBE_MAP,xt,kt,Ue.width,Ue.height)}for(let Ue=0;Ue<6;Ue++)if(Ge){jt?te&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,0,0,0,At[Ue].width,At[Ue].height,Lt,at,At[Ue].data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,0,kt,At[Ue].width,At[Ue].height,0,Lt,at,At[Ue].data);for(let bt=0;bt<ie.length;bt++){const Di=ie[bt].image[Ue].image;jt?te&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,bt+1,0,0,Di.width,Di.height,Lt,at,Di.data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,bt+1,kt,Di.width,Di.height,0,Lt,at,Di.data)}}else{jt?te&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,0,0,0,Lt,at,At[Ue]):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,0,kt,Lt,at,At[Ue]);for(let bt=0;bt<ie.length;bt++){const vt=ie[bt];jt?te&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,bt+1,0,0,Lt,at,vt.image[Ue]):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,bt+1,kt,Lt,at,vt.image[Ue])}}}A(D)&&y(s.TEXTURE_CUBE_MAP),Re.__version=Ne.version,D.onUpdate&&D.onUpdate(D)}O.__version=D.version}function Ae(O,D,he,Ee,Ne,Re){const yt=r.convert(he.format,he.colorSpace),et=r.convert(he.type),ct=b(he.internalFormat,yt,et,he.colorSpace);if(!i.get(D).__hasExternalTextures){const Ge=Math.max(1,D.width>>Re),At=Math.max(1,D.height>>Re);Ne===s.TEXTURE_3D||Ne===s.TEXTURE_2D_ARRAY?t.texImage3D(Ne,Re,ct,Ge,At,D.depth,0,yt,et,null):t.texImage2D(Ne,Re,ct,Ge,At,0,yt,et,null)}t.bindFramebuffer(s.FRAMEBUFFER,O),We(D)?a.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,Ee,Ne,i.get(he).__webglTexture,0,je(D)):(Ne===s.TEXTURE_2D||Ne>=s.TEXTURE_CUBE_MAP_POSITIVE_X&&Ne<=s.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&s.framebufferTexture2D(s.FRAMEBUFFER,Ee,Ne,i.get(he).__webglTexture,Re),t.bindFramebuffer(s.FRAMEBUFFER,null)}function Se(O,D,he){if(s.bindRenderbuffer(s.RENDERBUFFER,O),D.depthBuffer){const Ee=D.depthTexture,Ne=Ee&&Ee.isDepthTexture?Ee.type:null,Re=x(D.stencilBuffer,Ne),yt=D.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,et=je(D);We(D)?a.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,et,Re,D.width,D.height):he?s.renderbufferStorageMultisample(s.RENDERBUFFER,et,Re,D.width,D.height):s.renderbufferStorage(s.RENDERBUFFER,Re,D.width,D.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,yt,s.RENDERBUFFER,O)}else{const Ee=D.textures;for(let Ne=0;Ne<Ee.length;Ne++){const Re=Ee[Ne],yt=r.convert(Re.format,Re.colorSpace),et=r.convert(Re.type),ct=b(Re.internalFormat,yt,et,Re.colorSpace),Jt=je(D);he&&We(D)===!1?s.renderbufferStorageMultisample(s.RENDERBUFFER,Jt,ct,D.width,D.height):We(D)?a.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,Jt,ct,D.width,D.height):s.renderbufferStorage(s.RENDERBUFFER,ct,D.width,D.height)}}s.bindRenderbuffer(s.RENDERBUFFER,null)}function Le(O,D){if(D&&D.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(s.FRAMEBUFFER,O),!(D.depthTexture&&D.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(D.depthTexture).__webglTexture||D.depthTexture.image.width!==D.width||D.depthTexture.image.height!==D.height)&&(D.depthTexture.image.width=D.width,D.depthTexture.image.height=D.height,D.depthTexture.needsUpdate=!0),k(D.depthTexture,0);const Ee=i.get(D.depthTexture).__webglTexture,Ne=je(D);if(D.depthTexture.format===b0)We(D)?a.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,Ee,0,Ne):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,Ee,0);else if(D.depthTexture.format===cm)We(D)?a.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,Ee,0,Ne):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,Ee,0);else throw new Error("Unknown depthTexture format")}function st(O){const D=i.get(O),he=O.isWebGLCubeRenderTarget===!0;if(D.__boundDepthTexture!==O.depthTexture){const Ee=O.depthTexture;if(D.__depthDisposeCallback&&D.__depthDisposeCallback(),Ee){const Ne=()=>{delete D.__boundDepthTexture,delete D.__depthDisposeCallback,Ee.removeEventListener("dispose",Ne)};Ee.addEventListener("dispose",Ne),D.__depthDisposeCallback=Ne}D.__boundDepthTexture=Ee}if(O.depthTexture&&!D.__autoAllocateDepthBuffer){if(he)throw new Error("target.depthTexture not supported in Cube render targets");Le(D.__webglFramebuffer,O)}else if(he){D.__webglDepthbuffer=[];for(let Ee=0;Ee<6;Ee++)if(t.bindFramebuffer(s.FRAMEBUFFER,D.__webglFramebuffer[Ee]),D.__webglDepthbuffer[Ee]===void 0)D.__webglDepthbuffer[Ee]=s.createRenderbuffer(),Se(D.__webglDepthbuffer[Ee],O,!1);else{const Ne=O.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,Re=D.__webglDepthbuffer[Ee];s.bindRenderbuffer(s.RENDERBUFFER,Re),s.framebufferRenderbuffer(s.FRAMEBUFFER,Ne,s.RENDERBUFFER,Re)}}else if(t.bindFramebuffer(s.FRAMEBUFFER,D.__webglFramebuffer),D.__webglDepthbuffer===void 0)D.__webglDepthbuffer=s.createRenderbuffer(),Se(D.__webglDepthbuffer,O,!1);else{const Ee=O.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,Ne=D.__webglDepthbuffer;s.bindRenderbuffer(s.RENDERBUFFER,Ne),s.framebufferRenderbuffer(s.FRAMEBUFFER,Ee,s.RENDERBUFFER,Ne)}t.bindFramebuffer(s.FRAMEBUFFER,null)}function ot(O,D,he){const Ee=i.get(O);D!==void 0&&Ae(Ee.__webglFramebuffer,O,O.texture,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,0),he!==void 0&&st(O)}function Ct(O){const D=O.texture,he=i.get(O),Ee=i.get(D);O.addEventListener("dispose",C);const Ne=O.textures,Re=O.isWebGLCubeRenderTarget===!0,yt=Ne.length>1;if(yt||(Ee.__webglTexture===void 0&&(Ee.__webglTexture=s.createTexture()),Ee.__version=D.version,o.memory.textures++),Re){he.__webglFramebuffer=[];for(let et=0;et<6;et++)if(D.mipmaps&&D.mipmaps.length>0){he.__webglFramebuffer[et]=[];for(let ct=0;ct<D.mipmaps.length;ct++)he.__webglFramebuffer[et][ct]=s.createFramebuffer()}else he.__webglFramebuffer[et]=s.createFramebuffer()}else{if(D.mipmaps&&D.mipmaps.length>0){he.__webglFramebuffer=[];for(let et=0;et<D.mipmaps.length;et++)he.__webglFramebuffer[et]=s.createFramebuffer()}else he.__webglFramebuffer=s.createFramebuffer();if(yt)for(let et=0,ct=Ne.length;et<ct;et++){const Jt=i.get(Ne[et]);Jt.__webglTexture===void 0&&(Jt.__webglTexture=s.createTexture(),o.memory.textures++)}if(O.samples>0&&We(O)===!1){he.__webglMultisampledFramebuffer=s.createFramebuffer(),he.__webglColorRenderbuffer=[],t.bindFramebuffer(s.FRAMEBUFFER,he.__webglMultisampledFramebuffer);for(let et=0;et<Ne.length;et++){const ct=Ne[et];he.__webglColorRenderbuffer[et]=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,he.__webglColorRenderbuffer[et]);const Jt=r.convert(ct.format,ct.colorSpace),Ge=r.convert(ct.type),At=b(ct.internalFormat,Jt,Ge,ct.colorSpace,O.isXRRenderTarget===!0),Kt=je(O);s.renderbufferStorageMultisample(s.RENDERBUFFER,Kt,At,O.width,O.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+et,s.RENDERBUFFER,he.__webglColorRenderbuffer[et])}s.bindRenderbuffer(s.RENDERBUFFER,null),O.depthBuffer&&(he.__webglDepthRenderbuffer=s.createRenderbuffer(),Se(he.__webglDepthRenderbuffer,O,!0)),t.bindFramebuffer(s.FRAMEBUFFER,null)}}if(Re){t.bindTexture(s.TEXTURE_CUBE_MAP,Ee.__webglTexture),be(s.TEXTURE_CUBE_MAP,D);for(let et=0;et<6;et++)if(D.mipmaps&&D.mipmaps.length>0)for(let ct=0;ct<D.mipmaps.length;ct++)Ae(he.__webglFramebuffer[et][ct],O,D,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+et,ct);else Ae(he.__webglFramebuffer[et],O,D,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+et,0);A(D)&&y(s.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(yt){for(let et=0,ct=Ne.length;et<ct;et++){const Jt=Ne[et],Ge=i.get(Jt);t.bindTexture(s.TEXTURE_2D,Ge.__webglTexture),be(s.TEXTURE_2D,Jt),Ae(he.__webglFramebuffer,O,Jt,s.COLOR_ATTACHMENT0+et,s.TEXTURE_2D,0),A(Jt)&&y(s.TEXTURE_2D)}t.unbindTexture()}else{let et=s.TEXTURE_2D;if((O.isWebGL3DRenderTarget||O.isWebGLArrayRenderTarget)&&(et=O.isWebGL3DRenderTarget?s.TEXTURE_3D:s.TEXTURE_2D_ARRAY),t.bindTexture(et,Ee.__webglTexture),be(et,D),D.mipmaps&&D.mipmaps.length>0)for(let ct=0;ct<D.mipmaps.length;ct++)Ae(he.__webglFramebuffer[ct],O,D,s.COLOR_ATTACHMENT0,et,ct);else Ae(he.__webglFramebuffer,O,D,s.COLOR_ATTACHMENT0,et,0);A(D)&&y(et),t.unbindTexture()}O.depthBuffer&&st(O)}function zt(O){const D=O.textures;for(let he=0,Ee=D.length;he<Ee;he++){const Ne=D[he];if(A(Ne)){const Re=O.isWebGLCubeRenderTarget?s.TEXTURE_CUBE_MAP:s.TEXTURE_2D,yt=i.get(Ne).__webglTexture;t.bindTexture(Re,yt),y(Re),t.unbindTexture()}}}const ke=[],Z=[];function Ke(O){if(O.samples>0){if(We(O)===!1){const D=O.textures,he=O.width,Ee=O.height;let Ne=s.COLOR_BUFFER_BIT;const Re=O.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,yt=i.get(O),et=D.length>1;if(et)for(let ct=0;ct<D.length;ct++)t.bindFramebuffer(s.FRAMEBUFFER,yt.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+ct,s.RENDERBUFFER,null),t.bindFramebuffer(s.FRAMEBUFFER,yt.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+ct,s.TEXTURE_2D,null,0);t.bindFramebuffer(s.READ_FRAMEBUFFER,yt.__webglMultisampledFramebuffer),t.bindFramebuffer(s.DRAW_FRAMEBUFFER,yt.__webglFramebuffer);for(let ct=0;ct<D.length;ct++){if(O.resolveDepthBuffer&&(O.depthBuffer&&(Ne|=s.DEPTH_BUFFER_BIT),O.stencilBuffer&&O.resolveStencilBuffer&&(Ne|=s.STENCIL_BUFFER_BIT)),et){s.framebufferRenderbuffer(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,yt.__webglColorRenderbuffer[ct]);const Jt=i.get(D[ct]).__webglTexture;s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,Jt,0)}s.blitFramebuffer(0,0,he,Ee,0,0,he,Ee,Ne,s.NEAREST),l===!0&&(ke.length=0,Z.length=0,ke.push(s.COLOR_ATTACHMENT0+ct),O.depthBuffer&&O.resolveDepthBuffer===!1&&(ke.push(Re),Z.push(Re),s.invalidateFramebuffer(s.DRAW_FRAMEBUFFER,Z)),s.invalidateFramebuffer(s.READ_FRAMEBUFFER,ke))}if(t.bindFramebuffer(s.READ_FRAMEBUFFER,null),t.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),et)for(let ct=0;ct<D.length;ct++){t.bindFramebuffer(s.FRAMEBUFFER,yt.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+ct,s.RENDERBUFFER,yt.__webglColorRenderbuffer[ct]);const Jt=i.get(D[ct]).__webglTexture;t.bindFramebuffer(s.FRAMEBUFFER,yt.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+ct,s.TEXTURE_2D,Jt,0)}t.bindFramebuffer(s.DRAW_FRAMEBUFFER,yt.__webglMultisampledFramebuffer)}else if(O.depthBuffer&&O.resolveDepthBuffer===!1&&l){const D=O.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT;s.invalidateFramebuffer(s.DRAW_FRAMEBUFFER,[D])}}}function je(O){return Math.min(n.maxSamples,O.samples)}function We(O){const D=i.get(O);return O.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&D.__useRenderToTexture!==!1}function nt(O){const D=o.render.frame;h.get(O)!==D&&(h.set(O,D),O.update())}function Tt(O,D){const he=O.colorSpace,Ee=O.format,Ne=O.type;return O.isCompressedTexture===!0||O.isVideoTexture===!0||he!==Ji&&he!==Fr&&(ni.getTransfer(he)===Ln?(Ee!==bi||Ne!==Pi)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",he)),D}function mt(O){return typeof HTMLImageElement<"u"&&O instanceof HTMLImageElement?(c.width=O.naturalWidth||O.width,c.height=O.naturalHeight||O.height):typeof VideoFrame<"u"&&O instanceof VideoFrame?(c.width=O.displayWidth,c.height=O.displayHeight):(c.width=O.width,c.height=O.height),c}this.allocateTextureUnit=B,this.resetTextureUnits=E,this.setTexture2D=k,this.setTexture2DArray=X,this.setTexture3D=F,this.setTextureCube=H,this.rebindTextures=ot,this.setupRenderTarget=Ct,this.updateRenderTargetMipmap=zt,this.updateMultisampleRenderTarget=Ke,this.setupDepthRenderbuffer=st,this.setupFrameBufferTexture=Ae,this.useMultisampledRTT=We}function M8(s,e){function t(i,n=Fr){let r;const o=ni.getTransfer(n);if(i===Pi)return s.UNSIGNED_BYTE;if(i===K2)return s.UNSIGNED_SHORT_4_4_4_4;if(i===Y2)return s.UNSIGNED_SHORT_5_5_5_1;if(i===wU)return s.UNSIGNED_INT_5_9_9_9_REV;if(i===Iw)return s.BYTE;if(i===Q2)return s.SHORT;if(i===O0)return s.UNSIGNED_SHORT;if(i===Dd)return s.INT;if(i===Wr)return s.UNSIGNED_INT;if(i===$i)return s.FLOAT;if(i===Wi)return s.HALF_FLOAT;if(i===SU)return s.ALPHA;if(i===MU)return s.RGB;if(i===bi)return s.RGBA;if(i===A1)return s.LUMINANCE;if(i===IU)return s.LUMINANCE_ALPHA;if(i===b0)return s.DEPTH_COMPONENT;if(i===cm)return s.DEPTH_STENCIL;if(i===Vl)return s.RED;if(i===Ux)return s.RED_INTEGER;if(i===Pc)return s.RG;if(i===Xx)return s.RG_INTEGER;if(i===Z0)return s.RGBA_INTEGER;if(i===GC||i===Xb||i===kC||i===Ob)if(o===Ln)if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(i===GC)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Xb)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===kC)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Ob)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=e.get("WEBGL_compressed_texture_s3tc"),r!==null){if(i===GC)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Xb)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===kC)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Ob)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===Tw||i===tL||i===Ew||i===iL)if(r=e.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(i===Tw)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===tL)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===Ew)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===iL)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===Rw||i===Lw||i===Bw)if(r=e.get("WEBGL_compressed_texture_etc"),r!==null){if(i===Rw||i===Lw)return o===Ln?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(i===Bw)return o===Ln?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===dx||i===nL||i===sL||i===rL||i===ux||i===oL||i===aL||i===lL||i===cL||i===hL||i===dL||i===uL||i===pL||i===fL)if(r=e.get("WEBGL_compressed_texture_astc"),r!==null){if(i===dx)return o===Ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===nL)return o===Ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===sL)return o===Ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===rL)return o===Ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===ux)return o===Ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===oL)return o===Ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===aL)return o===Ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===lL)return o===Ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===cL)return o===Ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===hL)return o===Ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===dL)return o===Ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===uL)return o===Ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===pL)return o===Ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===fL)return o===Ln?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===Zb||i===mL||i===gL)if(r=e.get("EXT_texture_compression_bptc"),r!==null){if(i===Zb)return o===Ln?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===mL)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===gL)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===TU||i===AL||i===yL||i===bL)if(r=e.get("EXT_texture_compression_rgtc"),r!==null){if(i===Zb)return r.COMPRESSED_RED_RGTC1_EXT;if(i===AL)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===yL)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===bL)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===lm?s.UNSIGNED_INT_24_8:s[i]!==void 0?s[i]:null}return{convert:t}}class VU extends Xt{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}let Ms=class extends ye{constructor(){super(),this.isGroup=!0,this.type="Group"}};const Hfe={type:"move"};class XG{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Ms,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Ms,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new T,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new T),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Ms,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new T,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new T),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const g of e.hand.values()){const A=t.getJointPose(g,i),y=this._getHandJoint(c,g);A!==null&&(y.matrix.fromArray(A.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.matrixWorldNeedsUpdate=!0,y.jointRadius=A.radius),y.visible=A!==null}const h=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],u=h.position.distanceTo(d.position),f=.02,m=.005;c.inputState.pinching&&u>f+m?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&u<=f-m&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(n=t.getPose(e.targetRaySpace,i),n===null&&r!==null&&(n=r),n!==null&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Hfe)))}return a!==null&&(a.visible=n!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new Ms;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}const Qfe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Kfe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Yfe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const n=new si,r=e.properties.get(n);r.__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=n}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new Ht({vertexShader:Qfe,fragmentShader:Kfe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new fe(new Rs(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Jfe extends Mr{constructor(e,t){super();const i=this;let n=null,r=1,o=null,a="local-floor",l=1,c=null,h=null,d=null,u=null,f=null,m=null;const g=new Yfe,A=t.getContextAttributes();let y=null,b=null;const x=[],v=[],_=new Q;let C=null;const S=new Xt;S.layers.enable(1),S.viewport=new Je;const M=new Xt;M.layers.enable(2),M.viewport=new Je;const L=[S,M],w=new VU;w.layers.enable(1),w.layers.enable(2);let E=null,B=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.controllerAutoUpdate=!0,this.getController=function(ae){let Ae=x[ae];return Ae===void 0&&(Ae=new XG,x[ae]=Ae),Ae.getTargetRaySpace()},this.getControllerGrip=function(ae){let Ae=x[ae];return Ae===void 0&&(Ae=new XG,x[ae]=Ae),Ae.getGripSpace()},this.getHand=function(ae){let Ae=x[ae];return Ae===void 0&&(Ae=new XG,x[ae]=Ae),Ae.getHandSpace()};function P(ae){const Ae=v.indexOf(ae.inputSource);if(Ae===-1)return;const Se=x[Ae];Se!==void 0&&(Se.update(ae.inputSource,ae.frame,c||o),Se.dispatchEvent({type:ae.type,data:ae.inputSource}))}function k(){n.removeEventListener("select",P),n.removeEventListener("selectstart",P),n.removeEventListener("selectend",P),n.removeEventListener("squeeze",P),n.removeEventListener("squeezestart",P),n.removeEventListener("squeezeend",P),n.removeEventListener("end",k),n.removeEventListener("inputsourceschange",X);for(let ae=0;ae<x.length;ae++){const Ae=v[ae];Ae!==null&&(v[ae]=null,x[ae]&&x[ae].disconnect(Ae))}E=null,B=null,g.reset(),e.setRenderTarget(y),f=null,u=null,d=null,n=null,b=null,Oe.stop(),i.isPresenting=!1,e.setPixelRatio(C),e.setSize(_.width,_.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ae){r=ae,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ae){a=ae,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(ae){c=ae},this.getBaseLayer=function(){return u!==null?u:f},this.getBinding=function(){return d},this.getFrame=function(){return m},this.getSession=function(){return n},this.setSession=async function(ae){if(n=ae,n!==null){if(y=e.getRenderTarget(),n.addEventListener("select",P),n.addEventListener("selectstart",P),n.addEventListener("selectend",P),n.addEventListener("squeeze",P),n.addEventListener("squeezestart",P),n.addEventListener("squeezeend",P),n.addEventListener("end",k),n.addEventListener("inputsourceschange",X),A.xrCompatible!==!0&&await t.makeXRCompatible(),C=e.getPixelRatio(),e.getSize(_),n.renderState.layers===void 0){const Ae={antialias:A.antialias,alpha:!0,depth:A.depth,stencil:A.stencil,framebufferScaleFactor:r};f=new XRWebGLLayer(n,t,Ae),n.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),b=new ci(f.framebufferWidth,f.framebufferHeight,{format:bi,type:Pi,colorSpace:e.outputColorSpace,stencilBuffer:A.stencil})}else{let Ae=null,Se=null,Le=null;A.depth&&(Le=A.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Ae=A.stencil?cm:b0,Se=A.stencil?lm:Wr);const st={colorFormat:t.RGBA8,depthFormat:Le,scaleFactor:r};d=new XRWebGLBinding(n,t),u=d.createProjectionLayer(st),n.updateRenderState({layers:[u]}),e.setPixelRatio(1),e.setSize(u.textureWidth,u.textureHeight,!1),b=new ci(u.textureWidth,u.textureHeight,{format:bi,type:Pi,depthTexture:new Bp(u.textureWidth,u.textureHeight,Se,void 0,void 0,void 0,void 0,void 0,void 0,Ae),stencilBuffer:A.stencil,colorSpace:e.outputColorSpace,samples:A.antialias?4:0,resolveDepthBuffer:u.ignoreDepthValues===!1})}b.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await n.requestReferenceSpace(a),Oe.setContext(n),Oe.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(n!==null)return n.environmentBlendMode},this.getDepthTexture=function(){return g.getDepthTexture()};function X(ae){for(let Ae=0;Ae<ae.removed.length;Ae++){const Se=ae.removed[Ae],Le=v.indexOf(Se);Le>=0&&(v[Le]=null,x[Le]&&x[Le].disconnect(Se))}for(let Ae=0;Ae<ae.added.length;Ae++){const Se=ae.added[Ae];let Le=v.indexOf(Se);if(Le===-1){for(let ot=0;ot<x.length;ot++)if(ot>=v.length){v.push(Se),Le=ot;break}else if(v[ot]===null){v[ot]=Se,Le=ot;break}if(Le===-1)break}const st=x[Le];st&&st.connect(Se)}}const F=new T,H=new T;function W(ae,Ae,Se){F.setFromMatrixPosition(Ae.matrixWorld),H.setFromMatrixPosition(Se.matrixWorld);const Le=F.distanceTo(H),st=Ae.projectionMatrix.elements,ot=Se.projectionMatrix.elements,Ct=st[14]/(st[10]-1),zt=st[14]/(st[10]+1),ke=(st[9]+1)/st[5],Z=(st[9]-1)/st[5],Ke=(st[8]-1)/st[0],je=(ot[8]+1)/ot[0],We=Ct*Ke,nt=Ct*je,Tt=Le/(-Ke+je),mt=Tt*-Ke;if(Ae.matrixWorld.decompose(ae.position,ae.quaternion,ae.scale),ae.translateX(mt),ae.translateZ(Tt),ae.matrixWorld.compose(ae.position,ae.quaternion,ae.scale),ae.matrixWorldInverse.copy(ae.matrixWorld).invert(),st[10]===-1)ae.projectionMatrix.copy(Ae.projectionMatrix),ae.projectionMatrixInverse.copy(Ae.projectionMatrixInverse);else{const O=Ct+Tt,D=zt+Tt,he=We-mt,Ee=nt+(Le-mt),Ne=ke*zt/D*O,Re=Z*zt/D*O;ae.projectionMatrix.makePerspective(he,Ee,Ne,Re,O,D),ae.projectionMatrixInverse.copy(ae.projectionMatrix).invert()}}function se(ae,Ae){Ae===null?ae.matrixWorld.copy(ae.matrix):ae.matrixWorld.multiplyMatrices(Ae.matrixWorld,ae.matrix),ae.matrixWorldInverse.copy(ae.matrixWorld).invert()}this.updateCamera=function(ae){if(n===null)return;let Ae=ae.near,Se=ae.far;g.texture!==null&&(g.depthNear>0&&(Ae=g.depthNear),g.depthFar>0&&(Se=g.depthFar)),w.near=M.near=S.near=Ae,w.far=M.far=S.far=Se,(E!==w.near||B!==w.far)&&(n.updateRenderState({depthNear:w.near,depthFar:w.far}),E=w.near,B=w.far);const Le=ae.parent,st=w.cameras;se(w,Le);for(let ot=0;ot<st.length;ot++)se(st[ot],Le);st.length===2?W(w,S,M):w.projectionMatrix.copy(S.projectionMatrix),de(ae,w,Le)};function de(ae,Ae,Se){Se===null?ae.matrix.copy(Ae.matrixWorld):(ae.matrix.copy(Se.matrixWorld),ae.matrix.invert(),ae.matrix.multiply(Ae.matrixWorld)),ae.matrix.decompose(ae.position,ae.quaternion,ae.scale),ae.updateMatrixWorld(!0),ae.projectionMatrix.copy(Ae.projectionMatrix),ae.projectionMatrixInverse.copy(Ae.projectionMatrixInverse),ae.isPerspectiveCamera&&(ae.fov=fx*2*Math.atan(1/ae.projectionMatrix.elements[5]),ae.zoom=1)}this.getCamera=function(){return w},this.getFoveation=function(){if(!(u===null&&f===null))return l},this.setFoveation=function(ae){l=ae,u!==null&&(u.fixedFoveation=ae),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=ae)},this.hasDepthSensing=function(){return g.texture!==null},this.getDepthSensingMesh=function(){return g.getMesh(w)};let be=null;function Pe(ae,Ae){if(h=Ae.getViewerPose(c||o),m=Ae,h!==null){const Se=h.views;f!==null&&(e.setRenderTargetFramebuffer(b,f.framebuffer),e.setRenderTarget(b));let Le=!1;Se.length!==w.cameras.length&&(w.cameras.length=0,Le=!0);for(let ot=0;ot<Se.length;ot++){const Ct=Se[ot];let zt=null;if(f!==null)zt=f.getViewport(Ct);else{const Z=d.getViewSubImage(u,Ct);zt=Z.viewport,ot===0&&(e.setRenderTargetTextures(b,Z.colorTexture,u.ignoreDepthValues?void 0:Z.depthStencilTexture),e.setRenderTarget(b))}let ke=L[ot];ke===void 0&&(ke=new Xt,ke.layers.enable(ot),ke.viewport=new Je,L[ot]=ke),ke.matrix.fromArray(Ct.transform.matrix),ke.matrix.decompose(ke.position,ke.quaternion,ke.scale),ke.projectionMatrix.fromArray(Ct.projectionMatrix),ke.projectionMatrixInverse.copy(ke.projectionMatrix).invert(),ke.viewport.set(zt.x,zt.y,zt.width,zt.height),ot===0&&(w.matrix.copy(ke.matrix),w.matrix.decompose(w.position,w.quaternion,w.scale)),Le===!0&&w.cameras.push(ke)}const st=n.enabledFeatures;if(st&&st.includes("depth-sensing")){const ot=d.getDepthInformation(Se[0]);ot&&ot.isValid&&ot.texture&&g.init(e,ot,n.renderState)}}if(i.controllerAutoUpdate)for(let Se=0;Se<x.length;Se++){const Le=v[Se],st=x[Se];Le!==null&&st!==void 0&&st.update(Le,Ae,c||o)}be&&be(ae,Ae),Ae.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:Ae}),m=null}const Oe=new v8;Oe.setAnimationLoop(Pe),this.setAnimationLoop=function(ae){be=ae},this.dispose=function(){}}}const cg=new Xi,jfe=new ce;function qfe(s,e){function t(A,y){A.matrixAutoUpdate===!0&&A.updateMatrix(),y.value.copy(A.matrix)}function i(A,y){y.color.getRGB(A.fogColor.value,x8(s)),y.isFog?(A.fogNear.value=y.near,A.fogFar.value=y.far):y.isFogExp2&&(A.fogDensity.value=y.density)}function n(A,y,b,x,v){y.isMeshBasicMaterial||y.isMeshLambertMaterial?r(A,y):y.isMeshToonMaterial?(r(A,y),d(A,y)):y.isMeshPhongMaterial?(r(A,y),h(A,y)):y.isMeshStandardMaterial?(r(A,y),u(A,y),y.isMeshPhysicalMaterial&&f(A,y,v)):y.isMeshMatcapMaterial?(r(A,y),m(A,y)):y.isMeshDepthMaterial?r(A,y):y.isMeshDistanceMaterial?(r(A,y),g(A,y)):y.isMeshNormalMaterial?r(A,y):y.isLineBasicMaterial?(o(A,y),y.isLineDashedMaterial&&a(A,y)):y.isPointsMaterial?l(A,y,b,x):y.isSpriteMaterial?c(A,y):y.isShadowMaterial?(A.color.value.copy(y.color),A.opacity.value=y.opacity):y.isShaderMaterial&&(y.uniformsNeedUpdate=!1)}function r(A,y){A.opacity.value=y.opacity,y.color&&A.diffuse.value.copy(y.color),y.emissive&&A.emissive.value.copy(y.emissive).multiplyScalar(y.emissiveIntensity),y.map&&(A.map.value=y.map,t(y.map,A.mapTransform)),y.alphaMap&&(A.alphaMap.value=y.alphaMap,t(y.alphaMap,A.alphaMapTransform)),y.bumpMap&&(A.bumpMap.value=y.bumpMap,t(y.bumpMap,A.bumpMapTransform),A.bumpScale.value=y.bumpScale,y.side===vn&&(A.bumpScale.value*=-1)),y.normalMap&&(A.normalMap.value=y.normalMap,t(y.normalMap,A.normalMapTransform),A.normalScale.value.copy(y.normalScale),y.side===vn&&A.normalScale.value.negate()),y.displacementMap&&(A.displacementMap.value=y.displacementMap,t(y.displacementMap,A.displacementMapTransform),A.displacementScale.value=y.displacementScale,A.displacementBias.value=y.displacementBias),y.emissiveMap&&(A.emissiveMap.value=y.emissiveMap,t(y.emissiveMap,A.emissiveMapTransform)),y.specularMap&&(A.specularMap.value=y.specularMap,t(y.specularMap,A.specularMapTransform)),y.alphaTest>0&&(A.alphaTest.value=y.alphaTest);const b=e.get(y),x=b.envMap,v=b.envMapRotation;x&&(A.envMap.value=x,cg.copy(v),cg.x*=-1,cg.y*=-1,cg.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(cg.y*=-1,cg.z*=-1),A.envMapRotation.value.setFromMatrix4(jfe.makeRotationFromEuler(cg)),A.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,A.reflectivity.value=y.reflectivity,A.ior.value=y.ior,A.refractionRatio.value=y.refractionRatio),y.lightMap&&(A.lightMap.value=y.lightMap,A.lightMapIntensity.value=y.lightMapIntensity,t(y.lightMap,A.lightMapTransform)),y.aoMap&&(A.aoMap.value=y.aoMap,A.aoMapIntensity.value=y.aoMapIntensity,t(y.aoMap,A.aoMapTransform))}function o(A,y){A.diffuse.value.copy(y.color),A.opacity.value=y.opacity,y.map&&(A.map.value=y.map,t(y.map,A.mapTransform))}function a(A,y){A.dashSize.value=y.dashSize,A.totalSize.value=y.dashSize+y.gapSize,A.scale.value=y.scale}function l(A,y,b,x){A.diffuse.value.copy(y.color),A.opacity.value=y.opacity,A.size.value=y.size*b,A.scale.value=x*.5,y.map&&(A.map.value=y.map,t(y.map,A.uvTransform)),y.alphaMap&&(A.alphaMap.value=y.alphaMap,t(y.alphaMap,A.alphaMapTransform)),y.alphaTest>0&&(A.alphaTest.value=y.alphaTest)}function c(A,y){A.diffuse.value.copy(y.color),A.opacity.value=y.opacity,A.rotation.value=y.rotation,y.map&&(A.map.value=y.map,t(y.map,A.mapTransform)),y.alphaMap&&(A.alphaMap.value=y.alphaMap,t(y.alphaMap,A.alphaMapTransform)),y.alphaTest>0&&(A.alphaTest.value=y.alphaTest)}function h(A,y){A.specular.value.copy(y.specular),A.shininess.value=Math.max(y.shininess,1e-4)}function d(A,y){y.gradientMap&&(A.gradientMap.value=y.gradientMap)}function u(A,y){A.metalness.value=y.metalness,y.metalnessMap&&(A.metalnessMap.value=y.metalnessMap,t(y.metalnessMap,A.metalnessMapTransform)),A.roughness.value=y.roughness,y.roughnessMap&&(A.roughnessMap.value=y.roughnessMap,t(y.roughnessMap,A.roughnessMapTransform)),y.envMap&&(A.envMapIntensity.value=y.envMapIntensity)}function f(A,y,b){A.ior.value=y.ior,y.sheen>0&&(A.sheenColor.value.copy(y.sheenColor).multiplyScalar(y.sheen),A.sheenRoughness.value=y.sheenRoughness,y.sheenColorMap&&(A.sheenColorMap.value=y.sheenColorMap,t(y.sheenColorMap,A.sheenColorMapTransform)),y.sheenRoughnessMap&&(A.sheenRoughnessMap.value=y.sheenRoughnessMap,t(y.sheenRoughnessMap,A.sheenRoughnessMapTransform))),y.clearcoat>0&&(A.clearcoat.value=y.clearcoat,A.clearcoatRoughness.value=y.clearcoatRoughness,y.clearcoatMap&&(A.clearcoatMap.value=y.clearcoatMap,t(y.clearcoatMap,A.clearcoatMapTransform)),y.clearcoatRoughnessMap&&(A.clearcoatRoughnessMap.value=y.clearcoatRoughnessMap,t(y.clearcoatRoughnessMap,A.clearcoatRoughnessMapTransform)),y.clearcoatNormalMap&&(A.clearcoatNormalMap.value=y.clearcoatNormalMap,t(y.clearcoatNormalMap,A.clearcoatNormalMapTransform),A.clearcoatNormalScale.value.copy(y.clearcoatNormalScale),y.side===vn&&A.clearcoatNormalScale.value.negate())),y.dispersion>0&&(A.dispersion.value=y.dispersion),y.iridescence>0&&(A.iridescence.value=y.iridescence,A.iridescenceIOR.value=y.iridescenceIOR,A.iridescenceThicknessMinimum.value=y.iridescenceThicknessRange[0],A.iridescenceThicknessMaximum.value=y.iridescenceThicknessRange[1],y.iridescenceMap&&(A.iridescenceMap.value=y.iridescenceMap,t(y.iridescenceMap,A.iridescenceMapTransform)),y.iridescenceThicknessMap&&(A.iridescenceThicknessMap.value=y.iridescenceThicknessMap,t(y.iridescenceThicknessMap,A.iridescenceThicknessMapTransform))),y.transmission>0&&(A.transmission.value=y.transmission,A.transmissionSamplerMap.value=b.texture,A.transmissionSamplerSize.value.set(b.width,b.height),y.transmissionMap&&(A.transmissionMap.value=y.transmissionMap,t(y.transmissionMap,A.transmissionMapTransform)),A.thickness.value=y.thickness,y.thicknessMap&&(A.thicknessMap.value=y.thicknessMap,t(y.thicknessMap,A.thicknessMapTransform)),A.attenuationDistance.value=y.attenuationDistance,A.attenuationColor.value.copy(y.attenuationColor)),y.anisotropy>0&&(A.anisotropyVector.value.set(y.anisotropy*Math.cos(y.anisotropyRotation),y.anisotropy*Math.sin(y.anisotropyRotation)),y.anisotropyMap&&(A.anisotropyMap.value=y.anisotropyMap,t(y.anisotropyMap,A.anisotropyMapTransform))),A.specularIntensity.value=y.specularIntensity,A.specularColor.value.copy(y.specularColor),y.specularColorMap&&(A.specularColorMap.value=y.specularColorMap,t(y.specularColorMap,A.specularColorMapTransform)),y.specularIntensityMap&&(A.specularIntensityMap.value=y.specularIntensityMap,t(y.specularIntensityMap,A.specularIntensityMapTransform))}function m(A,y){y.matcap&&(A.matcap.value=y.matcap)}function g(A,y){const b=e.get(y).light;A.referencePosition.value.setFromMatrixPosition(b.matrixWorld),A.nearDistance.value=b.shadow.camera.near,A.farDistance.value=b.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:n}}function $fe(s,e,t,i){let n={},r={},o=[];const a=s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS);function l(b,x){const v=x.program;i.uniformBlockBinding(b,v)}function c(b,x){let v=n[b.id];v===void 0&&(m(b),v=h(b),n[b.id]=v,b.addEventListener("dispose",A));const _=x.program;i.updateUBOMapping(b,_);const C=e.render.frame;r[b.id]!==C&&(u(b),r[b.id]=C)}function h(b){const x=d();b.__bindingPointIndex=x;const v=s.createBuffer(),_=b.__size,C=b.usage;return s.bindBuffer(s.UNIFORM_BUFFER,v),s.bufferData(s.UNIFORM_BUFFER,_,C),s.bindBuffer(s.UNIFORM_BUFFER,null),s.bindBufferBase(s.UNIFORM_BUFFER,x,v),v}function d(){for(let b=0;b<a;b++)if(o.indexOf(b)===-1)return o.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function u(b){const x=n[b.id],v=b.uniforms,_=b.__cache;s.bindBuffer(s.UNIFORM_BUFFER,x);for(let C=0,S=v.length;C<S;C++){const M=Array.isArray(v[C])?v[C]:[v[C]];for(let L=0,w=M.length;L<w;L++){const E=M[L];if(f(E,C,L,_)===!0){const B=E.__offset,P=Array.isArray(E.value)?E.value:[E.value];let k=0;for(let X=0;X<P.length;X++){const F=P[X],H=g(F);typeof F=="number"||typeof F=="boolean"?(E.__data[0]=F,s.bufferSubData(s.UNIFORM_BUFFER,B+k,E.__data)):F.isMatrix3?(E.__data[0]=F.elements[0],E.__data[1]=F.elements[1],E.__data[2]=F.elements[2],E.__data[3]=0,E.__data[4]=F.elements[3],E.__data[5]=F.elements[4],E.__data[6]=F.elements[5],E.__data[7]=0,E.__data[8]=F.elements[6],E.__data[9]=F.elements[7],E.__data[10]=F.elements[8],E.__data[11]=0):(F.toArray(E.__data,k),k+=H.storage/Float32Array.BYTES_PER_ELEMENT)}s.bufferSubData(s.UNIFORM_BUFFER,B,E.__data)}}}s.bindBuffer(s.UNIFORM_BUFFER,null)}function f(b,x,v,_){const C=b.value,S=x+"_"+v;if(_[S]===void 0)return typeof C=="number"||typeof C=="boolean"?_[S]=C:_[S]=C.clone(),!0;{const M=_[S];if(typeof C=="number"||typeof C=="boolean"){if(M!==C)return _[S]=C,!0}else if(M.equals(C)===!1)return M.copy(C),!0}return!1}function m(b){const x=b.uniforms;let v=0;const _=16;for(let S=0,M=x.length;S<M;S++){const L=Array.isArray(x[S])?x[S]:[x[S]];for(let w=0,E=L.length;w<E;w++){const B=L[w],P=Array.isArray(B.value)?B.value:[B.value];for(let k=0,X=P.length;k<X;k++){const F=P[k],H=g(F),W=v%_,se=W%H.boundary,de=W+se;v+=se,de!==0&&_-de<H.storage&&(v+=_-de),B.__data=new Float32Array(H.storage/Float32Array.BYTES_PER_ELEMENT),B.__offset=v,v+=H.storage}}}const C=v%_;return C>0&&(v+=_-C),b.__size=v,b.__cache={},this}function g(b){const x={boundary:0,storage:0};return typeof b=="number"||typeof b=="boolean"?(x.boundary=4,x.storage=4):b.isVector2?(x.boundary=8,x.storage=8):b.isVector3||b.isColor?(x.boundary=16,x.storage=12):b.isVector4?(x.boundary=16,x.storage=16):b.isMatrix3?(x.boundary=48,x.storage=48):b.isMatrix4?(x.boundary=64,x.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),x}function A(b){const x=b.target;x.removeEventListener("dispose",A);const v=o.indexOf(x.__bindingPointIndex);o.splice(v,1),s.deleteBuffer(n[x.id]),delete n[x.id],delete r[x.id]}function y(){for(const b in n)s.deleteBuffer(n[b]);o=[],n={},r={}}return{bind:l,update:c,dispose:y}}class Mm{constructor(e={}){const{canvas:t=u8(),context:i=null,depth:n=!0,stencil:r=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:d=!1}=e;this.isWebGLRenderer=!0;let u;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");u=i.getContextAttributes().alpha}else u=o;const f=new Uint32Array(4),m=new Int32Array(4);let g=null,A=null;const y=[],b=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=ft,this.toneMapping=Zr,this.toneMappingExposure=1;const x=this;let v=!1,_=0,C=0,S=null,M=-1,L=null;const w=new Je,E=new Je;let B=null;const P=new ge(0);let k=0,X=t.width,F=t.height,H=1,W=null,se=null;const de=new Je(0,0,X,F),be=new Je(0,0,X,F);let Pe=!1;const Oe=new H0;let ae=!1,Ae=!1;const Se=new ce,Le=new ce,st=new T,ot=new Je,Ct={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let zt=!1;function ke(){return S===null?H:1}let Z=i;function Ke(z,R){return t.getContext(z,R)}try{const z={alpha:!0,depth:n,stencil:r,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${La}`),t.addEventListener("webglcontextlost",Ue,!1),t.addEventListener("webglcontextrestored",bt,!1),t.addEventListener("webglcontextcreationerror",vt,!1),Z===null){const R="webgl2";if(Z=Ke(R,z),Z===null)throw Ke(R)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(z){throw console.error("THREE.WebGLRenderer: "+z.message),z}let je,We,nt,Tt,mt,O,D,he,Ee,Ne,Re,yt,et,ct,Jt,Ge,At,Kt,Lt,at,kt,jt,yi,te;function xt(){je=new rpe(Z),je.init(),jt=new M8(Z,je),We=new epe(Z,je,e,jt),nt=new Vfe(Z),We.reverseDepthBuffer&&nt.buffers.depth.setReversed(!0),Tt=new lpe(Z),mt=new Mfe,O=new Wfe(Z,je,nt,mt,We,jt,Tt),D=new ipe(x),he=new spe(x),Ee=new ghe(Z),yi=new que(Z,Ee),Ne=new ope(Z,Ee,Tt,yi),Re=new hpe(Z,Ne,Ee,Tt),Lt=new cpe(Z,We,O),Ge=new tpe(mt),yt=new Sfe(x,D,he,je,We,yi,Ge),et=new qfe(x,mt),ct=new Tfe,Jt=new Gfe(je),Kt=new jue(x,D,he,nt,Re,u,l),At=new Dfe(x,Re,We),te=new $fe(Z,Tt,We,nt),at=new $ue(Z,je,Tt),kt=new ape(Z,je,Tt),Tt.programs=yt.programs,x.capabilities=We,x.extensions=je,x.properties=mt,x.renderLists=ct,x.shadowMap=At,x.state=nt,x.info=Tt}xt();const ie=new Jfe(x,Z);this.xr=ie,this.getContext=function(){return Z},this.getContextAttributes=function(){return Z.getContextAttributes()},this.forceContextLoss=function(){const z=je.get("WEBGL_lose_context");z&&z.loseContext()},this.forceContextRestore=function(){const z=je.get("WEBGL_lose_context");z&&z.restoreContext()},this.getPixelRatio=function(){return H},this.setPixelRatio=function(z){z!==void 0&&(H=z,this.setSize(X,F,!1))},this.getSize=function(z){return z.set(X,F)},this.setSize=function(z,R,G=!0){if(ie.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}X=z,F=R,t.width=Math.floor(z*H),t.height=Math.floor(R*H),G===!0&&(t.style.width=z+"px",t.style.height=R+"px"),this.setViewport(0,0,z,R)},this.getDrawingBufferSize=function(z){return z.set(X*H,F*H).floor()},this.setDrawingBufferSize=function(z,R,G){X=z,F=R,H=G,t.width=Math.floor(z*G),t.height=Math.floor(R*G),this.setViewport(0,0,z,R)},this.getCurrentViewport=function(z){return z.copy(w)},this.getViewport=function(z){return z.copy(de)},this.setViewport=function(z,R,G,N){z.isVector4?de.set(z.x,z.y,z.z,z.w):de.set(z,R,G,N),nt.viewport(w.copy(de).multiplyScalar(H).round())},this.getScissor=function(z){return z.copy(be)},this.setScissor=function(z,R,G,N){z.isVector4?be.set(z.x,z.y,z.z,z.w):be.set(z,R,G,N),nt.scissor(E.copy(be).multiplyScalar(H).round())},this.getScissorTest=function(){return Pe},this.setScissorTest=function(z){nt.setScissorTest(Pe=z)},this.setOpaqueSort=function(z){W=z},this.setTransparentSort=function(z){se=z},this.getClearColor=function(z){return z.copy(Kt.getClearColor())},this.setClearColor=function(){Kt.setClearColor.apply(Kt,arguments)},this.getClearAlpha=function(){return Kt.getClearAlpha()},this.setClearAlpha=function(){Kt.setClearAlpha.apply(Kt,arguments)},this.clear=function(z=!0,R=!0,G=!0){let N=0;if(z){let V=!1;if(S!==null){const q=S.texture.format;V=q===Z0||q===Xx||q===Ux}if(V){const q=S.texture.type,j=q===Pi||q===Wr||q===O0||q===lm||q===K2||q===Y2,ue=Kt.getClearColor(),Ce=Kt.getClearAlpha(),xe=ue.r,ve=ue.g,pe=ue.b;j?(f[0]=xe,f[1]=ve,f[2]=pe,f[3]=Ce,Z.clearBufferuiv(Z.COLOR,0,f)):(m[0]=xe,m[1]=ve,m[2]=pe,m[3]=Ce,Z.clearBufferiv(Z.COLOR,0,m))}else N|=Z.COLOR_BUFFER_BIT}R&&(N|=Z.DEPTH_BUFFER_BIT,Z.clearDepth(this.capabilities.reverseDepthBuffer?0:1)),G&&(N|=Z.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Z.clear(N)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ue,!1),t.removeEventListener("webglcontextrestored",bt,!1),t.removeEventListener("webglcontextcreationerror",vt,!1),ct.dispose(),Jt.dispose(),mt.dispose(),D.dispose(),he.dispose(),Re.dispose(),yi.dispose(),te.dispose(),yt.dispose(),ie.dispose(),ie.removeEventListener("sessionstart",$M),ie.removeEventListener("sessionend",eI),fu.stop()};function Ue(z){z.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function bt(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;const z=Tt.autoReset,R=At.enabled,G=At.autoUpdate,N=At.needsUpdate,V=At.type;xt(),Tt.autoReset=z,At.enabled=R,At.autoUpdate=G,At.needsUpdate=N,At.type=V}function vt(z){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",z.statusMessage)}function Di(z){const R=z.target;R.removeEventListener("dispose",Di),bs(R)}function bs(z){Vo(z),mt.remove(z)}function Vo(z){const R=mt.get(z).programs;R!==void 0&&(R.forEach(function(G){yt.releaseProgram(G)}),z.isShaderMaterial&&yt.releaseShaderCache(z))}this.renderBufferDirect=function(z,R,G,N,V,q){R===null&&(R=Ct);const j=V.isMesh&&V.matrixWorld.determinant()<0,ue=sI(z,R,G,N,V);nt.setMaterial(N,j);let Ce=G.index,xe=1;if(N.wireframe===!0){if(Ce=Ne.getWireframeAttribute(G),Ce===void 0)return;xe=2}const ve=G.drawRange,pe=G.attributes.position;let Ze=ve.start*xe,Ye=(ve.start+ve.count)*xe;q!==null&&(Ze=Math.max(Ze,q.start*xe),Ye=Math.min(Ye,(q.start+q.count)*xe)),Ce!==null?(Ze=Math.max(Ze,0),Ye=Math.min(Ye,Ce.count)):pe!=null&&(Ze=Math.max(Ze,0),Ye=Math.min(Ye,pe.count));const qe=Ye-Ze;if(qe<0||qe===1/0)return;yi.setup(V,N,ue,G,Ce);let wt,He=at;if(Ce!==null&&(wt=Ee.get(Ce),He=kt,He.setIndex(wt)),V.isMesh)N.wireframe===!0?(nt.setLineWidth(N.wireframeLinewidth*ke()),He.setMode(Z.LINES)):He.setMode(Z.TRIANGLES);else if(V.isLine){let De=N.linewidth;De===void 0&&(De=1),nt.setLineWidth(De*ke()),V.isLineSegments?He.setMode(Z.LINES):V.isLineLoop?He.setMode(Z.LINE_LOOP):He.setMode(Z.LINE_STRIP)}else V.isPoints?He.setMode(Z.POINTS):V.isSprite&&He.setMode(Z.TRIANGLES);if(V.isBatchedMesh)if(V._multiDrawInstances!==null)He.renderMultiDrawInstances(V._multiDrawStarts,V._multiDrawCounts,V._multiDrawCount,V._multiDrawInstances);else if(je.get("WEBGL_multi_draw"))He.renderMultiDraw(V._multiDrawStarts,V._multiDrawCounts,V._multiDrawCount);else{const De=V._multiDrawStarts,Nt=V._multiDrawCounts,Dt=V._multiDrawCount,Fi=Ce?Ee.get(Ce).bytesPerElement:1,Ws=mt.get(N).currentProgram.getUniforms();for(let xi=0;xi<Dt;xi++)Ws.setValue(Z,"_gl_DrawID",xi),He.render(De[xi]/Fi,Nt[xi])}else if(V.isInstancedMesh)He.renderInstances(Ze,qe,V.count);else if(G.isInstancedBufferGeometry){const De=G._maxInstanceCount!==void 0?G._maxInstanceCount:1/0,Nt=Math.min(G.instanceCount,De);He.renderInstances(Ze,qe,Nt)}else He.render(Ze,qe)};function Ki(z,R,G){z.transparent===!0&&z.side===Zi&&z.forceSinglePass===!1?(z.side=vn,z.needsUpdate=!0,KA(z,R,G),z.side=us,z.needsUpdate=!0,KA(z,R,G),z.side=Zi):KA(z,R,G)}this.compile=function(z,R,G=null){G===null&&(G=z),A=Jt.get(G),A.init(R),b.push(A),G.traverseVisible(function(V){V.isLight&&V.layers.test(R.layers)&&(A.pushLight(V),V.castShadow&&A.pushShadow(V))}),z!==G&&z.traverseVisible(function(V){V.isLight&&V.layers.test(R.layers)&&(A.pushLight(V),V.castShadow&&A.pushShadow(V))}),A.setupLights();const N=new Set;return z.traverse(function(V){if(!(V.isMesh||V.isPoints||V.isLine||V.isSprite))return;const q=V.material;if(q)if(Array.isArray(q))for(let j=0;j<q.length;j++){const ue=q[j];Ki(ue,G,V),N.add(ue)}else Ki(q,G,V),N.add(q)}),b.pop(),A=null,N},this.compileAsync=function(z,R,G=null){const N=this.compile(z,R,G);return new Promise(V=>{function q(){if(N.forEach(function(j){mt.get(j).currentProgram.isReady()&&N.delete(j)}),N.size===0){V(z);return}setTimeout(q,10)}je.get("KHR_parallel_shader_compile")!==null?q():setTimeout(q,10)})};let zo=null;function jc(z){zo&&zo(z)}function $M(){fu.stop()}function eI(){fu.start()}const fu=new v8;fu.setAnimationLoop(jc),typeof self<"u"&&fu.setContext(self),this.setAnimationLoop=function(z){zo=z,ie.setAnimationLoop(z),z===null?fu.stop():fu.start()},ie.addEventListener("sessionstart",$M),ie.addEventListener("sessionend",eI),this.render=function(z,R){if(R!==void 0&&R.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v===!0)return;if(z.matrixWorldAutoUpdate===!0&&z.updateMatrixWorld(),R.parent===null&&R.matrixWorldAutoUpdate===!0&&R.updateMatrixWorld(),ie.enabled===!0&&ie.isPresenting===!0&&(ie.cameraAutoUpdate===!0&&ie.updateCamera(R),R=ie.getCamera()),z.isScene===!0&&z.onBeforeRender(x,z,R,S),A=Jt.get(z,b.length),A.init(R),b.push(A),Le.multiplyMatrices(R.projectionMatrix,R.matrixWorldInverse),Oe.setFromProjectionMatrix(Le),Ae=this.localClippingEnabled,ae=Ge.init(this.clippingPlanes,Ae),g=ct.get(z,y.length),g.init(),y.push(g),ie.enabled===!0&&ie.isPresenting===!0){const q=x.xr.getDepthSensingMesh();q!==null&&kv(q,R,-1/0,x.sortObjects)}kv(z,R,0,x.sortObjects),g.finish(),x.sortObjects===!0&&g.sort(W,se),zt=ie.enabled===!1||ie.isPresenting===!1||ie.hasDepthSensing()===!1,zt&&Kt.addToRenderList(g,z),this.info.render.frame++,ae===!0&&Ge.beginShadows();const G=A.state.shadowsArray;At.render(G,z,R),ae===!0&&Ge.endShadows(),this.info.autoReset===!0&&this.info.reset();const N=g.opaque,V=g.transmissive;if(A.setupLights(),R.isArrayCamera){const q=R.cameras;if(V.length>0)for(let j=0,ue=q.length;j<ue;j++){const Ce=q[j];Nv(N,V,z,Ce)}zt&&Kt.render(z);for(let j=0,ue=q.length;j<ue;j++){const Ce=q[j];tI(g,z,Ce,Ce.viewport)}}else V.length>0&&Nv(N,V,z,R),zt&&Kt.render(z),tI(g,z,R);S!==null&&(O.updateMultisampleRenderTarget(S),O.updateRenderTargetMipmap(S)),z.isScene===!0&&z.onAfterRender(x,z,R),yi.resetDefaultState(),M=-1,L=null,b.pop(),b.length>0?(A=b[b.length-1],ae===!0&&Ge.setGlobalState(x.clippingPlanes,A.state.camera)):A=null,y.pop(),y.length>0?g=y[y.length-1]:g=null};function kv(z,R,G,N){if(z.visible===!1)return;if(z.layers.test(R.layers)){if(z.isGroup)G=z.renderOrder;else if(z.isLOD)z.autoUpdate===!0&&z.update(R);else if(z.isLight)A.pushLight(z),z.castShadow&&A.pushShadow(z);else if(z.isSprite){if(!z.frustumCulled||Oe.intersectsSprite(z)){N&&ot.setFromMatrixPosition(z.matrixWorld).applyMatrix4(Le);const j=Re.update(z),ue=z.material;ue.visible&&g.push(z,j,ue,G,ot.z,null)}}else if((z.isMesh||z.isLine||z.isPoints)&&(!z.frustumCulled||Oe.intersectsObject(z))){const j=Re.update(z),ue=z.material;if(N&&(z.boundingSphere!==void 0?(z.boundingSphere===null&&z.computeBoundingSphere(),ot.copy(z.boundingSphere.center)):(j.boundingSphere===null&&j.computeBoundingSphere(),ot.copy(j.boundingSphere.center)),ot.applyMatrix4(z.matrixWorld).applyMatrix4(Le)),Array.isArray(ue)){const Ce=j.groups;for(let xe=0,ve=Ce.length;xe<ve;xe++){const pe=Ce[xe],Ze=ue[pe.materialIndex];Ze&&Ze.visible&&g.push(z,j,Ze,G,ot.z,pe)}}else ue.visible&&g.push(z,j,ue,G,ot.z,null)}}const q=z.children;for(let j=0,ue=q.length;j<ue;j++)kv(q[j],R,G,N)}function tI(z,R,G,N){const V=z.opaque,q=z.transmissive,j=z.transparent;A.setupLightsView(G),ae===!0&&Ge.setGlobalState(x.clippingPlanes,G),N&&nt.viewport(w.copy(N)),V.length>0&&QA(V,R,G),q.length>0&&QA(q,R,G),j.length>0&&QA(j,R,G),nt.buffers.depth.setTest(!0),nt.buffers.depth.setMask(!0),nt.buffers.color.setMask(!0),nt.setPolygonOffset(!1)}function Nv(z,R,G,N){if((G.isScene===!0?G.overrideMaterial:null)!==null)return;A.state.transmissionRenderTarget[N.id]===void 0&&(A.state.transmissionRenderTarget[N.id]=new ci(1,1,{generateMipmaps:!0,type:je.has("EXT_color_buffer_half_float")||je.has("EXT_color_buffer_float")?Wi:Pi,minFilter:xr,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ni.workingColorSpace}));const q=A.state.transmissionRenderTarget[N.id],j=N.viewport||w;q.setSize(j.z,j.w);const ue=x.getRenderTarget();x.setRenderTarget(q),x.getClearColor(P),k=x.getClearAlpha(),k<1&&x.setClearColor(16777215,.5),x.clear(),zt&&Kt.render(G);const Ce=x.toneMapping;x.toneMapping=Zr;const xe=N.viewport;if(N.viewport!==void 0&&(N.viewport=void 0),A.setupLightsView(N),ae===!0&&Ge.setGlobalState(x.clippingPlanes,N),QA(z,G,N),O.updateMultisampleRenderTarget(q),O.updateRenderTargetMipmap(q),je.has("WEBGL_multisampled_render_to_texture")===!1){let ve=!1;for(let pe=0,Ze=R.length;pe<Ze;pe++){const Ye=R[pe],qe=Ye.object,wt=Ye.geometry,He=Ye.material,De=Ye.group;if(He.side===Zi&&qe.layers.test(N.layers)){const Nt=He.side;He.side=vn,He.needsUpdate=!0,iI(qe,G,N,wt,He,De),He.side=Nt,He.needsUpdate=!0,ve=!0}}ve===!0&&(O.updateMultisampleRenderTarget(q),O.updateRenderTargetMipmap(q))}x.setRenderTarget(ue),x.setClearColor(P,k),xe!==void 0&&(N.viewport=xe),x.toneMapping=Ce}function QA(z,R,G){const N=R.isScene===!0?R.overrideMaterial:null;for(let V=0,q=z.length;V<q;V++){const j=z[V],ue=j.object,Ce=j.geometry,xe=N===null?j.material:N,ve=j.group;ue.layers.test(G.layers)&&iI(ue,R,G,Ce,xe,ve)}}function iI(z,R,G,N,V,q){z.onBeforeRender(x,R,G,N,V,q),z.modelViewMatrix.multiplyMatrices(G.matrixWorldInverse,z.matrixWorld),z.normalMatrix.getNormalMatrix(z.modelViewMatrix),V.onBeforeRender(x,R,G,N,z,q),V.transparent===!0&&V.side===Zi&&V.forceSinglePass===!1?(V.side=vn,V.needsUpdate=!0,x.renderBufferDirect(G,R,N,V,z,q),V.side=us,V.needsUpdate=!0,x.renderBufferDirect(G,R,N,V,z,q),V.side=Zi):x.renderBufferDirect(G,R,N,V,z,q),z.onAfterRender(x,R,G,N,V,q)}function KA(z,R,G){R.isScene!==!0&&(R=Ct);const N=mt.get(z),V=A.state.lights,q=A.state.shadowsArray,j=V.state.version,ue=yt.getParameters(z,V.state,q,R,G),Ce=yt.getProgramCacheKey(ue);let xe=N.programs;N.environment=z.isMeshStandardMaterial?R.environment:null,N.fog=R.fog,N.envMap=(z.isMeshStandardMaterial?he:D).get(z.envMap||N.environment),N.envMapRotation=N.environment!==null&&z.envMap===null?R.environmentRotation:z.envMapRotation,xe===void 0&&(z.addEventListener("dispose",Di),xe=new Map,N.programs=xe);let ve=xe.get(Ce);if(ve!==void 0){if(N.currentProgram===ve&&N.lightsStateVersion===j)return Dv(z,ue),ve}else ue.uniforms=yt.getUniforms(z),z.onBuild(G,ue,x),z.onBeforeCompile(ue,x),ve=yt.acquireProgram(ue,Ce),xe.set(Ce,ve),N.uniforms=ue.uniforms;const pe=N.uniforms;return(!z.isShaderMaterial&&!z.isRawShaderMaterial||z.clipping===!0)&&(pe.clippingPlanes=Ge.uniform),Dv(z,ue),N.needsLights=mu(z),N.lightsStateVersion=j,N.needsLights&&(pe.ambientLightColor.value=V.state.ambient,pe.lightProbe.value=V.state.probe,pe.directionalLights.value=V.state.directional,pe.directionalLightShadows.value=V.state.directionalShadow,pe.spotLights.value=V.state.spot,pe.spotLightShadows.value=V.state.spotShadow,pe.rectAreaLights.value=V.state.rectArea,pe.ltc_1.value=V.state.rectAreaLTC1,pe.ltc_2.value=V.state.rectAreaLTC2,pe.pointLights.value=V.state.point,pe.pointLightShadows.value=V.state.pointShadow,pe.hemisphereLights.value=V.state.hemi,pe.directionalShadowMap.value=V.state.directionalShadowMap,pe.directionalShadowMatrix.value=V.state.directionalShadowMatrix,pe.spotShadowMap.value=V.state.spotShadowMap,pe.spotLightMatrix.value=V.state.spotLightMatrix,pe.spotLightMap.value=V.state.spotLightMap,pe.pointShadowMap.value=V.state.pointShadowMap,pe.pointShadowMatrix.value=V.state.pointShadowMatrix),N.currentProgram=ve,N.uniformsList=null,ve}function nI(z){if(z.uniformsList===null){const R=z.currentProgram.getUniforms();z.uniformsList=fR.seqWithValue(R.seq,z.uniforms)}return z.uniformsList}function Dv(z,R){const G=mt.get(z);G.outputColorSpace=R.outputColorSpace,G.batching=R.batching,G.batchingColor=R.batchingColor,G.instancing=R.instancing,G.instancingColor=R.instancingColor,G.instancingMorph=R.instancingMorph,G.skinning=R.skinning,G.morphTargets=R.morphTargets,G.morphNormals=R.morphNormals,G.morphColors=R.morphColors,G.morphTargetsCount=R.morphTargetsCount,G.numClippingPlanes=R.numClippingPlanes,G.numIntersection=R.numClipIntersection,G.vertexAlphas=R.vertexAlphas,G.vertexTangents=R.vertexTangents,G.toneMapping=R.toneMapping}function sI(z,R,G,N,V){R.isScene!==!0&&(R=Ct),O.resetTextureUnits();const q=R.fog,j=N.isMeshStandardMaterial?R.environment:null,ue=S===null?x.outputColorSpace:S.isXRRenderTarget===!0?S.texture.colorSpace:Ji,Ce=(N.isMeshStandardMaterial?he:D).get(N.envMap||j),xe=N.vertexColors===!0&&!!G.attributes.color&&G.attributes.color.itemSize===4,ve=!!G.attributes.tangent&&(!!N.normalMap||N.anisotropy>0),pe=!!G.morphAttributes.position,Ze=!!G.morphAttributes.normal,Ye=!!G.morphAttributes.color;let qe=Zr;N.toneMapped&&(S===null||S.isXRRenderTarget===!0)&&(qe=x.toneMapping);const wt=G.morphAttributes.position||G.morphAttributes.normal||G.morphAttributes.color,He=wt!==void 0?wt.length:0,De=mt.get(N),Nt=A.state.lights;if(ae===!0&&(Ae===!0||z!==L)){const fi=z===L&&N.id===M;Ge.setState(N,z,fi)}let Dt=!1;N.version===De.__version?(De.needsLights&&De.lightsStateVersion!==Nt.state.version||De.outputColorSpace!==ue||V.isBatchedMesh&&De.batching===!1||!V.isBatchedMesh&&De.batching===!0||V.isBatchedMesh&&De.batchingColor===!0&&V.colorTexture===null||V.isBatchedMesh&&De.batchingColor===!1&&V.colorTexture!==null||V.isInstancedMesh&&De.instancing===!1||!V.isInstancedMesh&&De.instancing===!0||V.isSkinnedMesh&&De.skinning===!1||!V.isSkinnedMesh&&De.skinning===!0||V.isInstancedMesh&&De.instancingColor===!0&&V.instanceColor===null||V.isInstancedMesh&&De.instancingColor===!1&&V.instanceColor!==null||V.isInstancedMesh&&De.instancingMorph===!0&&V.morphTexture===null||V.isInstancedMesh&&De.instancingMorph===!1&&V.morphTexture!==null||De.envMap!==Ce||N.fog===!0&&De.fog!==q||De.numClippingPlanes!==void 0&&(De.numClippingPlanes!==Ge.numPlanes||De.numIntersection!==Ge.numIntersection)||De.vertexAlphas!==xe||De.vertexTangents!==ve||De.morphTargets!==pe||De.morphNormals!==Ze||De.morphColors!==Ye||De.toneMapping!==qe||De.morphTargetsCount!==He)&&(Dt=!0):(Dt=!0,De.__version=N.version);let Fi=De.currentProgram;Dt===!0&&(Fi=KA(N,R,V));let Ws=!1,xi=!1,Si=!1;const Ai=Fi.getUniforms(),Bs=De.uniforms;if(nt.useProgram(Fi.program)&&(Ws=!0,xi=!0,Si=!0),N.id!==M&&(M=N.id,xi=!0),Ws||L!==z){We.reverseDepthBuffer?(Se.copy(z.projectionMatrix),Xce(Se),Oce(Se),Ai.setValue(Z,"projectionMatrix",Se)):Ai.setValue(Z,"projectionMatrix",z.projectionMatrix),Ai.setValue(Z,"viewMatrix",z.matrixWorldInverse);const fi=Ai.map.cameraPosition;fi!==void 0&&fi.setValue(Z,st.setFromMatrixPosition(z.matrixWorld)),We.logarithmicDepthBuffer&&Ai.setValue(Z,"logDepthBufFC",2/(Math.log(z.far+1)/Math.LN2)),(N.isMeshPhongMaterial||N.isMeshToonMaterial||N.isMeshLambertMaterial||N.isMeshBasicMaterial||N.isMeshStandardMaterial||N.isShaderMaterial)&&Ai.setValue(Z,"isOrthographic",z.isOrthographicCamera===!0),L!==z&&(L=z,xi=!0,Si=!0)}if(V.isSkinnedMesh){Ai.setOptional(Z,V,"bindMatrix"),Ai.setOptional(Z,V,"bindMatrixInverse");const fi=V.skeleton;fi&&(fi.boneTexture===null&&fi.computeBoneTexture(),Ai.setValue(Z,"boneTexture",fi.boneTexture,O))}V.isBatchedMesh&&(Ai.setOptional(Z,V,"batchingTexture"),Ai.setValue(Z,"batchingTexture",V._matricesTexture,O),Ai.setOptional(Z,V,"batchingIdTexture"),Ai.setValue(Z,"batchingIdTexture",V._indirectTexture,O),Ai.setOptional(Z,V,"batchingColorTexture"),V._colorsTexture!==null&&Ai.setValue(Z,"batchingColorTexture",V._colorsTexture,O));const xs=G.morphAttributes;if((xs.position!==void 0||xs.normal!==void 0||xs.color!==void 0)&&Lt.update(V,G,Fi),(xi||De.receiveShadow!==V.receiveShadow)&&(De.receiveShadow=V.receiveShadow,Ai.setValue(Z,"receiveShadow",V.receiveShadow)),N.isMeshGouraudMaterial&&N.envMap!==null&&(Bs.envMap.value=Ce,Bs.flipEnvMap.value=Ce.isCubeTexture&&Ce.isRenderTargetTexture===!1?-1:1),N.isMeshStandardMaterial&&N.envMap===null&&R.environment!==null&&(Bs.envMapIntensity.value=R.environmentIntensity),xi&&(Ai.setValue(Z,"toneMappingExposure",x.toneMappingExposure),De.needsLights&&pG(Bs,Si),q&&N.fog===!0&&et.refreshFogUniforms(Bs,q),et.refreshMaterialUniforms(Bs,N,H,F,A.state.transmissionRenderTarget[z.id]),fR.upload(Z,nI(De),Bs,O)),N.isShaderMaterial&&N.uniformsNeedUpdate===!0&&(fR.upload(Z,nI(De),Bs,O),N.uniformsNeedUpdate=!1),N.isSpriteMaterial&&Ai.setValue(Z,"center",V.center),Ai.setValue(Z,"modelViewMatrix",V.modelViewMatrix),Ai.setValue(Z,"normalMatrix",V.normalMatrix),Ai.setValue(Z,"modelMatrix",V.matrixWorld),N.isShaderMaterial||N.isRawShaderMaterial){const fi=N.uniformsGroups;for(let an=0,qc=fi.length;an<qc;an++){const Zp=fi[an];te.update(Zp,Fi),te.bind(Zp,Fi)}}return Fi}function pG(z,R){z.ambientLightColor.needsUpdate=R,z.lightProbe.needsUpdate=R,z.directionalLights.needsUpdate=R,z.directionalLightShadows.needsUpdate=R,z.pointLights.needsUpdate=R,z.pointLightShadows.needsUpdate=R,z.spotLights.needsUpdate=R,z.spotLightShadows.needsUpdate=R,z.rectAreaLights.needsUpdate=R,z.hemisphereLights.needsUpdate=R}function mu(z){return z.isMeshLambertMaterial||z.isMeshToonMaterial||z.isMeshPhongMaterial||z.isMeshStandardMaterial||z.isShadowMaterial||z.isShaderMaterial&&z.lights===!0}this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return C},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(z,R,G){mt.get(z.texture).__webglTexture=R,mt.get(z.depthTexture).__webglTexture=G;const N=mt.get(z);N.__hasExternalTextures=!0,N.__autoAllocateDepthBuffer=G===void 0,N.__autoAllocateDepthBuffer||je.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),N.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(z,R){const G=mt.get(z);G.__webglFramebuffer=R,G.__useDefaultFramebuffer=R===void 0},this.setRenderTarget=function(z,R=0,G=0){S=z,_=R,C=G;let N=!0,V=null,q=!1,j=!1;if(z){const Ce=mt.get(z);if(Ce.__useDefaultFramebuffer!==void 0)nt.bindFramebuffer(Z.FRAMEBUFFER,null),N=!1;else if(Ce.__webglFramebuffer===void 0)O.setupRenderTarget(z);else if(Ce.__hasExternalTextures)O.rebindTextures(z,mt.get(z.texture).__webglTexture,mt.get(z.depthTexture).__webglTexture);else if(z.depthBuffer){const pe=z.depthTexture;if(Ce.__boundDepthTexture!==pe){if(pe!==null&&mt.has(pe)&&(z.width!==pe.image.width||z.height!==pe.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");O.setupDepthRenderbuffer(z)}}const xe=z.texture;(xe.isData3DTexture||xe.isDataArrayTexture||xe.isCompressedArrayTexture)&&(j=!0);const ve=mt.get(z).__webglFramebuffer;z.isWebGLCubeRenderTarget?(Array.isArray(ve[R])?V=ve[R][G]:V=ve[R],q=!0):z.samples>0&&O.useMultisampledRTT(z)===!1?V=mt.get(z).__webglMultisampledFramebuffer:Array.isArray(ve)?V=ve[G]:V=ve,w.copy(z.viewport),E.copy(z.scissor),B=z.scissorTest}else w.copy(de).multiplyScalar(H).floor(),E.copy(be).multiplyScalar(H).floor(),B=Pe;if(nt.bindFramebuffer(Z.FRAMEBUFFER,V)&&N&&nt.drawBuffers(z,V),nt.viewport(w),nt.scissor(E),nt.setScissorTest(B),q){const Ce=mt.get(z.texture);Z.framebufferTexture2D(Z.FRAMEBUFFER,Z.COLOR_ATTACHMENT0,Z.TEXTURE_CUBE_MAP_POSITIVE_X+R,Ce.__webglTexture,G)}else if(j){const Ce=mt.get(z.texture),xe=R||0;Z.framebufferTextureLayer(Z.FRAMEBUFFER,Z.COLOR_ATTACHMENT0,Ce.__webglTexture,G||0,xe)}M=-1},this.readRenderTargetPixels=function(z,R,G,N,V,q,j){if(!(z&&z.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ue=mt.get(z).__webglFramebuffer;if(z.isWebGLCubeRenderTarget&&j!==void 0&&(ue=ue[j]),ue){nt.bindFramebuffer(Z.FRAMEBUFFER,ue);try{const Ce=z.texture,xe=Ce.format,ve=Ce.type;if(!We.textureFormatReadable(xe)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!We.textureTypeReadable(ve)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}R>=0&&R<=z.width-N&&G>=0&&G<=z.height-V&&Z.readPixels(R,G,N,V,jt.convert(xe),jt.convert(ve),q)}finally{const Ce=S!==null?mt.get(S).__webglFramebuffer:null;nt.bindFramebuffer(Z.FRAMEBUFFER,Ce)}}},this.readRenderTargetPixelsAsync=async function(z,R,G,N,V,q,j){if(!(z&&z.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ue=mt.get(z).__webglFramebuffer;if(z.isWebGLCubeRenderTarget&&j!==void 0&&(ue=ue[j]),ue){const Ce=z.texture,xe=Ce.format,ve=Ce.type;if(!We.textureFormatReadable(xe))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!We.textureTypeReadable(ve))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(R>=0&&R<=z.width-N&&G>=0&&G<=z.height-V){nt.bindFramebuffer(Z.FRAMEBUFFER,ue);const pe=Z.createBuffer();Z.bindBuffer(Z.PIXEL_PACK_BUFFER,pe),Z.bufferData(Z.PIXEL_PACK_BUFFER,q.byteLength,Z.STREAM_READ),Z.readPixels(R,G,N,V,jt.convert(xe),jt.convert(ve),0);const Ze=S!==null?mt.get(S).__webglFramebuffer:null;nt.bindFramebuffer(Z.FRAMEBUFFER,Ze);const Ye=Z.fenceSync(Z.SYNC_GPU_COMMANDS_COMPLETE,0);return Z.flush(),await Uce(Z,Ye,4),Z.bindBuffer(Z.PIXEL_PACK_BUFFER,pe),Z.getBufferSubData(Z.PIXEL_PACK_BUFFER,0,q),Z.deleteBuffer(pe),Z.deleteSync(Ye),q}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(z,R=null,G=0){z.isTexture!==!0&&(dR("WebGLRenderer: copyFramebufferToTexture function signature has changed."),R=arguments[0]||null,z=arguments[1]);const N=Math.pow(2,-G),V=Math.floor(z.image.width*N),q=Math.floor(z.image.height*N),j=R!==null?R.x:0,ue=R!==null?R.y:0;O.setTexture2D(z,0),Z.copyTexSubImage2D(Z.TEXTURE_2D,G,0,0,j,ue,V,q),nt.unbindTexture()},this.copyTextureToTexture=function(z,R,G=null,N=null,V=0){z.isTexture!==!0&&(dR("WebGLRenderer: copyTextureToTexture function signature has changed."),N=arguments[0]||null,z=arguments[1],R=arguments[2],V=arguments[3]||0,G=null);let q,j,ue,Ce,xe,ve;G!==null?(q=G.max.x-G.min.x,j=G.max.y-G.min.y,ue=G.min.x,Ce=G.min.y):(q=z.image.width,j=z.image.height,ue=0,Ce=0),N!==null?(xe=N.x,ve=N.y):(xe=0,ve=0);const pe=jt.convert(R.format),Ze=jt.convert(R.type);O.setTexture2D(R,0),Z.pixelStorei(Z.UNPACK_FLIP_Y_WEBGL,R.flipY),Z.pixelStorei(Z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,R.premultiplyAlpha),Z.pixelStorei(Z.UNPACK_ALIGNMENT,R.unpackAlignment);const Ye=Z.getParameter(Z.UNPACK_ROW_LENGTH),qe=Z.getParameter(Z.UNPACK_IMAGE_HEIGHT),wt=Z.getParameter(Z.UNPACK_SKIP_PIXELS),He=Z.getParameter(Z.UNPACK_SKIP_ROWS),De=Z.getParameter(Z.UNPACK_SKIP_IMAGES),Nt=z.isCompressedTexture?z.mipmaps[V]:z.image;Z.pixelStorei(Z.UNPACK_ROW_LENGTH,Nt.width),Z.pixelStorei(Z.UNPACK_IMAGE_HEIGHT,Nt.height),Z.pixelStorei(Z.UNPACK_SKIP_PIXELS,ue),Z.pixelStorei(Z.UNPACK_SKIP_ROWS,Ce),z.isDataTexture?Z.texSubImage2D(Z.TEXTURE_2D,V,xe,ve,q,j,pe,Ze,Nt.data):z.isCompressedTexture?Z.compressedTexSubImage2D(Z.TEXTURE_2D,V,xe,ve,Nt.width,Nt.height,pe,Nt.data):Z.texSubImage2D(Z.TEXTURE_2D,V,xe,ve,q,j,pe,Ze,Nt),Z.pixelStorei(Z.UNPACK_ROW_LENGTH,Ye),Z.pixelStorei(Z.UNPACK_IMAGE_HEIGHT,qe),Z.pixelStorei(Z.UNPACK_SKIP_PIXELS,wt),Z.pixelStorei(Z.UNPACK_SKIP_ROWS,He),Z.pixelStorei(Z.UNPACK_SKIP_IMAGES,De),V===0&&R.generateMipmaps&&Z.generateMipmap(Z.TEXTURE_2D),nt.unbindTexture()},this.copyTextureToTexture3D=function(z,R,G=null,N=null,V=0){z.isTexture!==!0&&(dR("WebGLRenderer: copyTextureToTexture3D function signature has changed."),G=arguments[0]||null,N=arguments[1]||null,z=arguments[2],R=arguments[3],V=arguments[4]||0);let q,j,ue,Ce,xe,ve,pe,Ze,Ye;const qe=z.isCompressedTexture?z.mipmaps[V]:z.image;G!==null?(q=G.max.x-G.min.x,j=G.max.y-G.min.y,ue=G.max.z-G.min.z,Ce=G.min.x,xe=G.min.y,ve=G.min.z):(q=qe.width,j=qe.height,ue=qe.depth,Ce=0,xe=0,ve=0),N!==null?(pe=N.x,Ze=N.y,Ye=N.z):(pe=0,Ze=0,Ye=0);const wt=jt.convert(R.format),He=jt.convert(R.type);let De;if(R.isData3DTexture)O.setTexture3D(R,0),De=Z.TEXTURE_3D;else if(R.isDataArrayTexture||R.isCompressedArrayTexture)O.setTexture2DArray(R,0),De=Z.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Z.pixelStorei(Z.UNPACK_FLIP_Y_WEBGL,R.flipY),Z.pixelStorei(Z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,R.premultiplyAlpha),Z.pixelStorei(Z.UNPACK_ALIGNMENT,R.unpackAlignment);const Nt=Z.getParameter(Z.UNPACK_ROW_LENGTH),Dt=Z.getParameter(Z.UNPACK_IMAGE_HEIGHT),Fi=Z.getParameter(Z.UNPACK_SKIP_PIXELS),Ws=Z.getParameter(Z.UNPACK_SKIP_ROWS),xi=Z.getParameter(Z.UNPACK_SKIP_IMAGES);Z.pixelStorei(Z.UNPACK_ROW_LENGTH,qe.width),Z.pixelStorei(Z.UNPACK_IMAGE_HEIGHT,qe.height),Z.pixelStorei(Z.UNPACK_SKIP_PIXELS,Ce),Z.pixelStorei(Z.UNPACK_SKIP_ROWS,xe),Z.pixelStorei(Z.UNPACK_SKIP_IMAGES,ve),z.isDataTexture||z.isData3DTexture?Z.texSubImage3D(De,V,pe,Ze,Ye,q,j,ue,wt,He,qe.data):R.isCompressedArrayTexture?Z.compressedTexSubImage3D(De,V,pe,Ze,Ye,q,j,ue,wt,qe.data):Z.texSubImage3D(De,V,pe,Ze,Ye,q,j,ue,wt,He,qe),Z.pixelStorei(Z.UNPACK_ROW_LENGTH,Nt),Z.pixelStorei(Z.UNPACK_IMAGE_HEIGHT,Dt),Z.pixelStorei(Z.UNPACK_SKIP_PIXELS,Fi),Z.pixelStorei(Z.UNPACK_SKIP_ROWS,Ws),Z.pixelStorei(Z.UNPACK_SKIP_IMAGES,xi),V===0&&R.generateMipmaps&&Z.generateMipmap(De),nt.unbindTexture()},this.initRenderTarget=function(z){mt.get(z).__webglFramebuffer===void 0&&O.setupRenderTarget(z)},this.initTexture=function(z){z.isCubeTexture?O.setTextureCube(z,0):z.isData3DTexture?O.setTexture3D(z,0):z.isDataArrayTexture||z.isCompressedArrayTexture?O.setTexture2DArray(z,0):O.setTexture2D(z,0),nt.unbindTexture()},this.resetState=function(){_=0,C=0,S=null,nt.reset(),yi.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Gc}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===y1?"display-p3":"srgb",t.unpackColorSpace=ni.workingColorSpace===Ox?"display-p3":"srgb"}}class nB{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new ge(e),this.density=t}clone(){return new nB(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}let sB=class I8{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new ge(e),this.near=t,this.far=i}clone(){return new I8(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}};class sr extends ye{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Xi,this.environmentIntensity=1,this.environmentRotation=new Xi,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}let Hx=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=px,this.updateRanges=[],this.version=0,this.uuid=Hl()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Hl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Hl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};const ha=new T;let Ma=class T8{constructor(e,t,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)ha.fromBufferAttribute(this,t),ha.applyMatrix4(e),this.setXYZ(t,ha.x,ha.y,ha.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ha.fromBufferAttribute(this,t),ha.applyNormalMatrix(e),this.setXYZ(t,ha.x,ha.y,ha.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ha.fromBufferAttribute(this,t),ha.transformDirection(e),this.setXYZ(t,ha.x,ha.y,ha.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=wa(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=mi(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=mi(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=mi(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=mi(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=mi(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=wa(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=wa(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=wa(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=wa(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=mi(t,this.array),i=mi(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=mi(t,this.array),i=mi(i,this.array),n=mi(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=mi(t,this.array),i=mi(i,this.array),n=mi(n,this.array),r=mi(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return new dt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new T8(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};class _1 extends Yt{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ge(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let ly;const Ov=new T,cy=new T,hy=new T,dy=new Q,Zv=new Q,E8=new ce,MI=new T,Wv=new T,II=new T,WW=new Q,OG=new Q,HW=new Q;let zU=class extends ye{constructor(e=new _1){if(super(),this.isSprite=!0,this.type="Sprite",ly===void 0){ly=new It;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Hx(t,5);ly.setIndex([0,1,2,0,2,3]),ly.setAttribute("position",new Ma(i,3,0,!1)),ly.setAttribute("uv",new Ma(i,2,3,!1))}this.geometry=ly,this.material=e,this.center=new Q(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),cy.setFromMatrixScale(this.matrixWorld),E8.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),hy.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&cy.multiplyScalar(-hy.z);const i=this.material.rotation;let n,r;i!==0&&(r=Math.cos(i),n=Math.sin(i));const o=this.center;TI(MI.set(-.5,-.5,0),hy,o,cy,n,r),TI(Wv.set(.5,-.5,0),hy,o,cy,n,r),TI(II.set(.5,.5,0),hy,o,cy,n,r),WW.set(0,0),OG.set(1,0),HW.set(1,1);let a=e.ray.intersectTriangle(MI,Wv,II,!1,Ov);if(a===null&&(TI(Wv.set(-.5,.5,0),hy,o,cy,n,r),OG.set(0,1),a=e.ray.intersectTriangle(MI,II,Wv,!1,Ov),a===null))return;const l=e.ray.origin.distanceTo(Ov);l<e.near||l>e.far||t.push({distance:l,point:Ov.clone(),uv:$s.getInterpolation(Ov,MI,Wv,II,WW,OG,HW,new Q),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}};function TI(s,e,t,i,n,r){dy.subVectors(s,t).addScalar(.5).multiply(i),n!==void 0?(Zv.x=r*dy.x-n*dy.y,Zv.y=n*dy.x+r*dy.y):Zv.copy(dy),s.copy(e),s.x+=Zv.x,s.y+=Zv.y,s.applyMatrix4(E8)}const EI=new T,QW=new T;let UU=class extends ye{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,n=t.length;i<n;i++){const r=t[i];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const n=this.levels;let r;for(r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let i=0;i<t.length;i++)if(t[i].distance===e){const n=t.splice(i,1);return this.remove(n[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,n;for(i=1,n=t.length;i<n;i++){let r=t[i].distance;if(t[i].object.visible&&(r-=r*t[i].hysteresis),e<r)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){EI.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(EI);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){EI.setFromMatrixPosition(e.matrixWorld),QW.setFromMatrixPosition(this.matrixWorld);const i=EI.distanceTo(QW)/e.zoom;t[0].object.visible=!0;let n,r;for(n=1,r=t.length;n<r;n++){let o=t[n].distance;if(t[n].object.visible&&(o-=o*t[n].hysteresis),i>=o)t[n-1].object.visible=!1,t[n].object.visible=!0;else break}for(this._currentLevel=n-1;n<r;n++)t[n].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let n=0,r=i.length;n<r;n++){const o=i[n];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}};const KW=new T,YW=new Je,JW=new Je,eme=new T,jW=new ce,RI=new T,ZG=new Vn,qW=new ce,WG=new Fa;let ol=class extends fe{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=zF,this.bindMatrix=new ce,this.bindMatrixInverse=new ce,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new oi),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,RI),this.boundingBox.expandByPoint(RI)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Vn),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,RI),this.boundingSphere.expandByPoint(RI)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,n=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ZG.copy(this.boundingSphere),ZG.applyMatrix4(n),e.ray.intersectsSphere(ZG)!==!1&&(qW.copy(n).invert(),WG.copy(e.ray).applyMatrix4(qW),!(this.boundingBox!==null&&WG.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,WG)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Je,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.fromBufferAttribute(t,i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===zF?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===zj?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,n=this.geometry;YW.fromBufferAttribute(n.attributes.skinIndex,e),JW.fromBufferAttribute(n.attributes.skinWeight,e),KW.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=JW.getComponent(r);if(o!==0){const a=YW.getComponent(r);jW.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(eme.copy(KW).applyMatrix4(jW),o)}}return t.applyMatrix4(this.bindMatrixInverse)}},Q0=class extends ye{constructor(){super(),this.isBone=!0,this.type="Bone"}},ir=class extends si{constructor(e=null,t=1,i=1,n,r,o,a,l,c=qt,h=qt,d,u){super(null,o,a,l,c,h,n,r,d,u),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};const $W=new ce,tme=new ce;let C1=class R8{constructor(e=[],t=[]){this.uuid=Hl(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,n=this.bones.length;i<n;i++)this.boneInverses.push(new ce)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new ce;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const a=e[r]?e[r].matrixWorld:tme;$W.multiplyMatrices(a,t[r]),$W.toArray(i,r*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new R8(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new ir(t,e,e,bi,$i);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){const r=e.bones[i];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new Q0),this.bones.push(o),this.boneInverses.push(new ce().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++){const o=t[n];e.bones.push(o.uuid);const a=i[n];e.boneInverses.push(a.toArray())}return e}},$o=class extends dt{constructor(e,t,i,n=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}};const uy=new ce,eH=new ce,LI=[],tH=new oi,ime=new ce,Hv=new fe,Qv=new Vn;let XU=class extends fe{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new $o(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let n=0;n<i;n++)this.setMatrixAt(n,ime)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new oi),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,uy),tH.copy(e.boundingBox).applyMatrix4(uy),this.boundingBox.union(tH)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Vn),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,uy),Qv.copy(e.boundingSphere).applyMatrix4(uy),this.boundingSphere.union(Qv)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,n=this.morphTexture.source.data.data,r=i.length+1,o=e*r+1;for(let a=0;a<i.length;a++)i[a]=n[o+a]}raycast(e,t){const i=this.matrixWorld,n=this.count;if(Hv.geometry=this.geometry,Hv.material=this.material,Hv.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Qv.copy(this.boundingSphere),Qv.applyMatrix4(i),e.ray.intersectsSphere(Qv)!==!1))for(let r=0;r<n;r++){this.getMatrixAt(r,uy),eH.multiplyMatrices(i,uy),Hv.matrixWorld=eH,Hv.raycast(e,LI);for(let o=0,a=LI.length;o<a;o++){const l=LI[o];l.instanceId=r,l.object=this,t.push(l)}LI.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new $o(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,n=i.length+1;this.morphTexture===null&&(this.morphTexture=new ir(new Float32Array(n*this.count),n,this.count,Vl,$i));const r=this.morphTexture.source.data.data;let o=0;for(let c=0;c<i.length;c++)o+=i[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=n*e;r[l]=a,r.set(i,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}};function nme(s,e){return s.z-e.z}function sme(s,e){return e.z-s.z}class rme{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,i){const n=this.pool,r=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1,index:-1});const o=n[this.index];r.push(o),this.index++,o.start=e.start,o.count=e.count,o.z=t,o.index=i}reset(){this.list.length=0,this.index=0}}const jp=new ce,HG=new ce,ome=new ce,ame=new ge(1,1,1),iH=new ce,QG=new H0,BI=new oi,hg=new Vn,Kv=new T,nH=new T,lme=new T,KG=new rme,Oo=new fe,PI=[];function cme(s,e,t=0){const i=e.itemSize;if(s.isInterleavedBufferAttribute||s.array.constructor!==e.array.constructor){const n=s.count;for(let r=0;r<n;r++)for(let o=0;o<i;o++)e.setComponent(r+t,o,s.getComponent(r,o))}else e.array.set(s.array,t*i);e.needsUpdate=!0}class Vw extends fe{get maxInstanceCount(){return this._maxInstanceCount}constructor(e,t,i=t*2,n){super(new It,n),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawInfo=[],this._availableInstanceIds=[],this._drawRanges=[],this._reservedRanges=[],this._bounds=[],this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=i,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),i=new ir(t,e,e,bi,$i);this._matricesTexture=i}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),i=new ir(t,e,e,Ux,Wr);this._indirectTexture=i}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),i=new ir(t,e,e,bi,$i);i.colorSpace=ni.workingColorSpace,this._colorsTexture=i}_initializeGeometry(e){const t=this.geometry,i=this._maxVertexCount,n=this._maxIndexCount;if(this._geometryInitialized===!1){for(const r in e.attributes){const o=e.getAttribute(r),{array:a,itemSize:l,normalized:c}=o,h=new a.constructor(i*l),d=new dt(h,l,c);t.setAttribute(r,d)}if(e.getIndex()!==null){const r=i>65535?new Uint32Array(n):new Uint16Array(n);t.setIndex(new dt(r,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const i in t.attributes){if(!e.hasAttribute(i))throw new Error(`BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`);const n=e.getAttribute(i),r=t.getAttribute(i);if(n.itemSize!==r.itemSize||n.normalized!==r.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new oi);const e=this.boundingBox,t=this._drawInfo;e.makeEmpty();for(let i=0,n=t.length;i<n;i++){if(t[i].active===!1)continue;const r=t[i].geometryIndex;this.getMatrixAt(i,jp),this.getBoundingBoxAt(r,BI).applyMatrix4(jp),e.union(BI)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Vn);const e=this.boundingSphere,t=this._drawInfo;e.makeEmpty();for(let i=0,n=t.length;i<n;i++){if(t[i].active===!1)continue;const r=t[i].geometryIndex;this.getMatrixAt(i,jp),this.getBoundingSphereAt(r,hg).applyMatrix4(jp),e.union(hg)}}addInstance(e){if(this._drawInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("BatchedMesh: Maximum item count reached.");const i={visible:!0,active:!0,geometryIndex:e};let n=null;this._availableInstanceIds.length>0?(n=this._availableInstanceIds.pop(),this._drawInfo[n]=i):(n=this._drawInfo.length,this._drawInfo.push(i));const r=this._matricesTexture,o=r.image.data;ome.toArray(o,n*16),r.needsUpdate=!0;const a=this._colorsTexture;return a&&(ame.toArray(a.image.data,n*4),a.needsUpdate=!0),n}addGeometry(e,t=-1,i=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._drawInfo.length>=this._maxInstanceCount)throw new Error("BatchedMesh: Maximum item count reached.");const n={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let r=null;const o=this._reservedRanges,a=this._drawRanges,l=this._bounds;this._geometryCount!==0&&(r=o[o.length-1]),t===-1?n.vertexCount=e.getAttribute("position").count:n.vertexCount=t,r===null?n.vertexStart=0:n.vertexStart=r.vertexStart+r.vertexCount;const c=e.getIndex(),h=c!==null;if(h&&(i===-1?n.indexCount=c.count:n.indexCount=i,r===null?n.indexStart=0:n.indexStart=r.indexStart+r.indexCount),n.indexStart!==-1&&n.indexStart+n.indexCount>this._maxIndexCount||n.vertexStart+n.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const d=this._geometryCount;return this._geometryCount++,o.push(n),a.push({start:h?n.indexStart:n.vertexStart,count:-1}),l.push({boxInitialized:!1,box:new oi,sphereInitialized:!1,sphere:new Vn}),this.setGeometryAt(d,e),d}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const i=this.geometry,n=i.getIndex()!==null,r=i.getIndex(),o=t.getIndex(),a=this._reservedRanges[e];if(n&&o.count>a.indexCount||t.attributes.position.count>a.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const l=a.vertexStart,c=a.vertexCount;for(const f in i.attributes){const m=t.getAttribute(f),g=i.getAttribute(f);cme(m,g,l);const A=m.itemSize;for(let y=m.count,b=c;y<b;y++){const x=l+y;for(let v=0;v<A;v++)g.setComponent(x,v,0)}g.needsUpdate=!0,g.addUpdateRange(l*A,c*A)}if(n){const f=a.indexStart;for(let m=0;m<o.count;m++)r.setX(f+m,l+o.getX(m));for(let m=o.count,g=a.indexCount;m<g;m++)r.setX(f+m,l);r.needsUpdate=!0,r.addUpdateRange(f,a.indexCount)}const h=this._bounds[e];t.boundingBox!==null?(h.box.copy(t.boundingBox),h.boxInitialized=!0):h.boxInitialized=!1,t.boundingSphere!==null?(h.sphere.copy(t.boundingSphere),h.sphereInitialized=!0):h.sphereInitialized=!1;const d=this._drawRanges[e],u=t.getAttribute("position");return d.count=n?o.count:u.count,this._visibilityChanged=!0,e}deleteInstance(e){const t=this._drawInfo;return e>=t.length||t[e].active===!1?this:(t[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this)}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const i=this._bounds[e],n=i.box,r=this.geometry;if(i.boxInitialized===!1){n.makeEmpty();const o=r.index,a=r.attributes.position,l=this._drawRanges[e];for(let c=l.start,h=l.start+l.count;c<h;c++){let d=c;o&&(d=o.getX(d)),n.expandByPoint(Kv.fromBufferAttribute(a,d))}i.boxInitialized=!0}return t.copy(n),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const i=this._bounds[e],n=i.sphere,r=this.geometry;if(i.sphereInitialized===!1){n.makeEmpty(),this.getBoundingBoxAt(e,BI),BI.getCenter(n.center);const o=r.index,a=r.attributes.position,l=this._drawRanges[e];let c=0;for(let h=l.start,d=l.start+l.count;h<d;h++){let u=h;o&&(u=o.getX(u)),Kv.fromBufferAttribute(a,u),c=Math.max(c,n.center.distanceToSquared(Kv))}n.radius=Math.sqrt(c),i.sphereInitialized=!0}return t.copy(n),t}setMatrixAt(e,t){const i=this._drawInfo,n=this._matricesTexture,r=this._matricesTexture.image.data;return e>=i.length||i[e].active===!1?this:(t.toArray(r,e*16),n.needsUpdate=!0,this)}getMatrixAt(e,t){const i=this._drawInfo,n=this._matricesTexture.image.data;return e>=i.length||i[e].active===!1?null:t.fromArray(n,e*16)}setColorAt(e,t){this._colorsTexture===null&&this._initColorsTexture();const i=this._colorsTexture,n=this._colorsTexture.image.data,r=this._drawInfo;return e>=r.length||r[e].active===!1?this:(t.toArray(n,e*4),i.needsUpdate=!0,this)}getColorAt(e,t){const i=this._colorsTexture.image.data,n=this._drawInfo;return e>=n.length||n[e].active===!1?null:t.fromArray(i,e*4)}setVisibleAt(e,t){const i=this._drawInfo;return e>=i.length||i[e].active===!1||i[e].visible===t?this:(i[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){const t=this._drawInfo;return e>=t.length||t[e].active===!1?!1:t[e].visible}setGeometryIdAt(e,t){const i=this._drawInfo;return e>=i.length||i[e].active===!1||t<0||t>=this._geometryCount?null:(i[e].geometryIndex=t,this)}getGeometryIdAt(e){const t=this._drawInfo;return e>=t.length||t[e].active===!1?-1:t[e].geometryIndex}getGeometryRangeAt(e,t={}){if(e<0||e>=this._geometryCount)return null;const i=this._drawRanges[e];return t.start=i.start,t.count=i.count,t}raycast(e,t){const i=this._drawInfo,n=this._drawRanges,r=this.matrixWorld,o=this.geometry;Oo.material=this.material,Oo.geometry.index=o.index,Oo.geometry.attributes=o.attributes,Oo.geometry.boundingBox===null&&(Oo.geometry.boundingBox=new oi),Oo.geometry.boundingSphere===null&&(Oo.geometry.boundingSphere=new Vn);for(let a=0,l=i.length;a<l;a++){if(!i[a].visible||!i[a].active)continue;const c=i[a].geometryIndex,h=n[c];Oo.geometry.setDrawRange(h.start,h.count),this.getMatrixAt(a,Oo.matrixWorld).premultiply(r),this.getBoundingBoxAt(c,Oo.geometry.boundingBox),this.getBoundingSphereAt(c,Oo.geometry.boundingSphere),Oo.raycast(e,PI);for(let d=0,u=PI.length;d<u;d++){const f=PI[d];f.object=this,f.batchId=a,t.push(f)}PI.length=0}Oo.material=null,Oo.geometry.index=null,Oo.geometry.attributes={},Oo.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(t=>({...t})),this._reservedRanges=e._reservedRanges.map(t=>({...t})),this._drawInfo=e._drawInfo.map(t=>({...t})),this._bounds=e._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,t,i,n,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=n.getIndex(),a=o===null?1:o.array.BYTES_PER_ELEMENT,l=this._drawInfo,c=this._multiDrawStarts,h=this._multiDrawCounts,d=this._drawRanges,u=this.perObjectFrustumCulled,f=this._indirectTexture,m=f.image.data;u&&(iH.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),QG.setFromProjectionMatrix(iH,e.coordinateSystem));let g=0;if(this.sortObjects){HG.copy(this.matrixWorld).invert(),Kv.setFromMatrixPosition(i.matrixWorld).applyMatrix4(HG),nH.set(0,0,-1).transformDirection(i.matrixWorld).transformDirection(HG);for(let b=0,x=l.length;b<x;b++)if(l[b].visible&&l[b].active){const v=l[b].geometryIndex;this.getMatrixAt(b,jp),this.getBoundingSphereAt(v,hg).applyMatrix4(jp);let _=!1;if(u&&(_=!QG.intersectsSphere(hg)),!_){const C=lme.subVectors(hg.center,Kv).dot(nH);KG.push(d[v],C,b)}}const A=KG.list,y=this.customSort;y===null?A.sort(r.transparent?sme:nme):y.call(this,A,i);for(let b=0,x=A.length;b<x;b++){const v=A[b];c[g]=v.start*a,h[g]=v.count,m[g]=v.index,g++}KG.reset()}else for(let A=0,y=l.length;A<y;A++)if(l[A].visible&&l[A].active){const b=l[A].geometryIndex;let x=!1;if(u&&(this.getMatrixAt(A,jp),this.getBoundingSphereAt(b,hg).applyMatrix4(jp),x=!QG.intersectsSphere(hg)),!x){const v=d[b];c[g]=v.start*a,h[g]=v.count,m[g]=A,g++}}f.needsUpdate=!0,this._multiDrawCount=g,this._visibilityChanged=!1}onBeforeShadow(e,t,i,n,r,o){this.onBeforeRender(e,null,n,r,o)}}let _n=class extends Yt{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ge(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}};const CL=new T,wL=new T,sH=new ce,Yv=new Fa,GI=new Vn,YG=new T,rH=new T;let ts=class extends ye{constructor(e=new It,t=new _n){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let n=1,r=t.count;n<r;n++)CL.fromBufferAttribute(t,n-1),wL.fromBufferAttribute(t,n),i[n]=i[n-1],i[n]+=CL.distanceTo(wL);e.setAttribute("lineDistance",new ut(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),GI.copy(i.boundingSphere),GI.applyMatrix4(n),GI.radius+=r,e.ray.intersectsSphere(GI)===!1)return;sH.copy(n).invert(),Yv.copy(e.ray).applyMatrix4(sH);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=this.isLineSegments?2:1,h=i.index,u=i.attributes.position;if(h!==null){const f=Math.max(0,o.start),m=Math.min(h.count,o.start+o.count);for(let g=f,A=m-1;g<A;g+=c){const y=h.getX(g),b=h.getX(g+1),x=kI(this,e,Yv,l,y,b);x&&t.push(x)}if(this.isLineLoop){const g=h.getX(m-1),A=h.getX(f),y=kI(this,e,Yv,l,g,A);y&&t.push(y)}}else{const f=Math.max(0,o.start),m=Math.min(u.count,o.start+o.count);for(let g=f,A=m-1;g<A;g+=c){const y=kI(this,e,Yv,l,g,g+1);y&&t.push(y)}if(this.isLineLoop){const g=kI(this,e,Yv,l,m-1,f);g&&t.push(g)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}};function kI(s,e,t,i,n,r){const o=s.geometry.attributes.position;if(CL.fromBufferAttribute(o,n),wL.fromBufferAttribute(o,r),t.distanceSqToSegment(CL,wL,YG,rH)>i)return;YG.applyMatrix4(s.matrixWorld);const l=e.ray.origin.distanceTo(YG);if(!(l<e.near||l>e.far))return{distance:l,point:rH.clone().applyMatrix4(s.matrixWorld),index:n,face:null,faceIndex:null,barycoord:null,object:s}}const oH=new T,aH=new T;let sa=class extends ts{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let n=0,r=t.count;n<r;n+=2)oH.fromBufferAttribute(t,n),aH.fromBufferAttribute(t,n+1),i[n]=n===0?0:i[n-1],i[n+1]=i[n]+oH.distanceTo(aH);e.setAttribute("lineDistance",new ut(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},OU=class extends ts{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}},Td=class extends Yt{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ge(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}};const lH=new ce,HF=new Fa,NI=new Vn,DI=new T;let Hb=class extends ye{constructor(e=new It,t=new Td){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),NI.copy(i.boundingSphere),NI.applyMatrix4(n),NI.radius+=r,e.ray.intersectsSphere(NI)===!1)return;lH.copy(n).invert(),HF.copy(e.ray).applyMatrix4(lH);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,d=i.attributes.position;if(c!==null){const u=Math.max(0,o.start),f=Math.min(c.count,o.start+o.count);for(let m=u,g=f;m<g;m++){const A=c.getX(m);DI.fromBufferAttribute(d,A),cH(DI,A,l,n,e,t,this)}}else{const u=Math.max(0,o.start),f=Math.min(d.count,o.start+o.count);for(let m=u,g=f;m<g;m++)DI.fromBufferAttribute(d,m),cH(DI,m,l,n,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}};function cH(s,e,t,i,n,r,o){const a=HF.distanceSqToPoint(s);if(a<t){const l=new T;HF.closestPointToPoint(s,l),l.applyMatrix4(i);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class L8 extends si{constructor(e,t,i,n,r,o,a,l,c){super(e,t,i,n,r,o,a,l,c),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:Ot,this.magFilter=r!==void 0?r:Ot,this.generateMipmaps=!1;const h=this;function d(){h.needsUpdate=!0,e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class ZU extends si{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=qt,this.minFilter=qt,this.generateMipmaps=!1,this.needsUpdate=!0}}let Fd=class extends si{constructor(e,t,i,n,r,o,a,l,c,h,d,u){super(null,o,a,l,c,h,n,r,d,u),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}},B8=class extends Fd{constructor(e,t,i,n,r,o){super(e,t,i,r,o),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=ea,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}},WU=class extends Fd{constructor(e,t,i){super(void 0,e[0].width,e[0].height,t,i,jl),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}};class HU extends si{constructor(e,t,i,n,r,o,a,l,c){super(e,t,i,n,r,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Zc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,n=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),r+=i.distanceTo(n),t.push(r),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let n=0;const r=i.length;let o;t?o=t:o=e*i[r-1];let a=0,l=r-1,c;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),c=i[n]-o,c<0)a=n+1;else if(c>0)l=n-1;else{l=n;break}if(n=l,i[n]===o)return n/(r-1);const h=i[n],u=i[n+1]-h,f=(o-h)/u;return(n+f)/(r-1)}getTangent(e,t){let n=e-1e-4,r=e+1e-4;n<0&&(n=0),r>1&&(r=1);const o=this.getPoint(n),a=this.getPoint(r),l=t||(o.isVector2?new Q:new T);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new T,n=[],r=[],o=[],a=new T,l=new ce;for(let f=0;f<=e;f++){const m=f/e;n[f]=this.getTangentAt(m,new T)}r[0]=new T,o[0]=new T;let c=Number.MAX_VALUE;const h=Math.abs(n[0].x),d=Math.abs(n[0].y),u=Math.abs(n[0].z);h<=c&&(c=h,i.set(1,0,0)),d<=c&&(c=d,i.set(0,1,0)),u<=c&&i.set(0,0,1),a.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],a),o[0].crossVectors(n[0],r[0]);for(let f=1;f<=e;f++){if(r[f]=r[f-1].clone(),o[f]=o[f-1].clone(),a.crossVectors(n[f-1],n[f]),a.length()>Number.EPSILON){a.normalize();const m=Math.acos(ws(n[f-1].dot(n[f]),-1,1));r[f].applyMatrix4(l.makeRotationAxis(a,m))}o[f].crossVectors(n[f],r[f])}if(t===!0){let f=Math.acos(ws(r[0].dot(r[e]),-1,1));f/=e,n[0].dot(a.crossVectors(r[0],r[e]))>0&&(f=-f);for(let m=1;m<=e;m++)r[m].applyMatrix4(l.makeRotationAxis(n[m],f*m)),o[m].crossVectors(n[m],r[m])}return{tangents:n,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class rB extends Zc{constructor(e=0,t=0,i=1,n=1,r=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t=new Q){const i=t,n=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(o?r=0:r=n),this.aClockwise===!0&&!o&&(r===n?r=-n:r=r-n);const a=this.aStartAngle+e*r;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const h=Math.cos(this.aRotation),d=Math.sin(this.aRotation),u=l-this.aX,f=c-this.aY;l=u*h-f*d+this.aX,c=u*d+f*h+this.aY}return i.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class P8 extends rB{constructor(e,t,i,n,r,o){super(e,t,i,i,n,r,o),this.isArcCurve=!0,this.type="ArcCurve"}}function QU(){let s=0,e=0,t=0,i=0;function n(r,o,a,l){s=r,e=a,t=-3*r+3*o-2*a-l,i=2*r-2*o+a+l}return{initCatmullRom:function(r,o,a,l,c){n(o,a,c*(a-r),c*(l-o))},initNonuniformCatmullRom:function(r,o,a,l,c,h,d){let u=(o-r)/c-(a-r)/(c+h)+(a-o)/h,f=(a-o)/h-(l-o)/(h+d)+(l-a)/d;u*=h,f*=h,n(o,a,u,f)},calc:function(r){const o=r*r,a=o*r;return s+e*r+t*o+i*a}}}const FI=new T,JG=new QU,jG=new QU,qG=new QU;class G8 extends Zc{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new T){const i=t,n=this.points,r=n.length,o=(r-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:l===0&&a===r-1&&(a=r-2,l=1);let c,h;this.closed||a>0?c=n[(a-1)%r]:(FI.subVectors(n[0],n[1]).add(n[0]),c=FI);const d=n[a%r],u=n[(a+1)%r];if(this.closed||a+2<r?h=n[(a+2)%r]:(FI.subVectors(n[r-1],n[r-2]).add(n[r-1]),h=FI),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let m=Math.pow(c.distanceToSquared(d),f),g=Math.pow(d.distanceToSquared(u),f),A=Math.pow(u.distanceToSquared(h),f);g<1e-4&&(g=1),m<1e-4&&(m=g),A<1e-4&&(A=g),JG.initNonuniformCatmullRom(c.x,d.x,u.x,h.x,m,g,A),jG.initNonuniformCatmullRom(c.y,d.y,u.y,h.y,m,g,A),qG.initNonuniformCatmullRom(c.z,d.z,u.z,h.z,m,g,A)}else this.curveType==="catmullrom"&&(JG.initCatmullRom(c.x,d.x,u.x,h.x,this.tension),jG.initCatmullRom(c.y,d.y,u.y,h.y,this.tension),qG.initCatmullRom(c.z,d.z,u.z,h.z,this.tension));return i.set(JG.calc(l),jG.calc(l),qG.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(new T().fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function hH(s,e,t,i,n){const r=(i-e)*.5,o=(n-t)*.5,a=s*s,l=s*a;return(2*t-2*i+r+o)*l+(-3*t+3*i-2*r-o)*a+r*s+t}function hme(s,e){const t=1-s;return t*t*e}function dme(s,e){return 2*(1-s)*s*e}function ume(s,e){return s*s*e}function DC(s,e,t,i){return hme(s,e)+dme(s,t)+ume(s,i)}function pme(s,e){const t=1-s;return t*t*t*e}function fme(s,e){const t=1-s;return 3*t*t*s*e}function mme(s,e){return 3*(1-s)*s*s*e}function gme(s,e){return s*s*s*e}function FC(s,e,t,i,n){return pme(s,e)+fme(s,t)+mme(s,i)+gme(s,n)}class KU extends Zc{constructor(e=new Q,t=new Q,i=new Q,n=new Q){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new Q){const i=t,n=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(FC(e,n.x,r.x,o.x,a.x),FC(e,n.y,r.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class k8 extends Zc{constructor(e=new T,t=new T,i=new T,n=new T){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new T){const i=t,n=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(FC(e,n.x,r.x,o.x,a.x),FC(e,n.y,r.y,o.y,a.y),FC(e,n.z,r.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class YU extends Zc{constructor(e=new Q,t=new Q){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Q){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Q){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class N8 extends Zc{constructor(e=new T,t=new T){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new T){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new T){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class JU extends Zc{constructor(e=new Q,t=new Q,i=new Q){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Q){const i=t,n=this.v0,r=this.v1,o=this.v2;return i.set(DC(e,n.x,r.x,o.x),DC(e,n.y,r.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class jU extends Zc{constructor(e=new T,t=new T,i=new T){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new T){const i=t,n=this.v0,r=this.v1,o=this.v2;return i.set(DC(e,n.x,r.x,o.x),DC(e,n.y,r.y,o.y),DC(e,n.z,r.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class qU extends Zc{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Q){const i=t,n=this.points,r=(n.length-1)*e,o=Math.floor(r),a=r-o,l=n[o===0?o:o-1],c=n[o],h=n[o>n.length-2?n.length-1:o+1],d=n[o>n.length-3?n.length-1:o+2];return i.set(hH(a,l.x,c.x,h.x,d.x),hH(a,l.y,c.y,h.y,d.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(new Q().fromArray(n))}return this}}var SL=Object.freeze({__proto__:null,ArcCurve:P8,CatmullRomCurve3:G8,CubicBezierCurve:KU,CubicBezierCurve3:k8,EllipseCurve:rB,LineCurve:YU,LineCurve3:N8,QuadraticBezierCurve:JU,QuadraticBezierCurve3:jU,SplineCurve:qU});class D8 extends Zc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const i=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new SL[i](t,e))}return this}getPoint(e,t){const i=e*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const o=n[r]-i,a=this.curves[r],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const o=r[n],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const h=l[c];i&&i.equals(h)||(t.push(h),i=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const n=e.curves[t];this.curves.push(new SL[n.type]().fromJSON(n))}return this}}class zw extends D8{constructor(e){super(),this.type="Path",this.currentPoint=new Q,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new YU(this.currentPoint.clone(),new Q(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){const r=new JU(this.currentPoint.clone(),new Q(e,t),new Q(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,r,o){const a=new KU(this.currentPoint.clone(),new Q(e,t),new Q(i,n),new Q(r,o));return this.curves.push(a),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new qU(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,r,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,i,n,r,o),this}absarc(e,t,i,n,r,o){return this.absellipse(e,t,i,i,n,r,o),this}ellipse(e,t,i,n,r,o,a,l){const c=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+c,t+h,i,n,r,o,a,l),this}absellipse(e,t,i,n,r,o,a,l){const c=new rB(e,t,i,n,r,o,a,l);if(this.curves.length>0){const d=c.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(c);const h=c.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class w1 extends It{constructor(e=[new Q(0,-.5),new Q(.5,0),new Q(0,.5)],t=12,i=0,n=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=ws(n,0,Math.PI*2);const r=[],o=[],a=[],l=[],c=[],h=1/t,d=new T,u=new Q,f=new T,m=new T,g=new T;let A=0,y=0;for(let b=0;b<=e.length-1;b++)switch(b){case 0:A=e[b+1].x-e[b].x,y=e[b+1].y-e[b].y,f.x=y*1,f.y=-A,f.z=y*0,g.copy(f),f.normalize(),l.push(f.x,f.y,f.z);break;case e.length-1:l.push(g.x,g.y,g.z);break;default:A=e[b+1].x-e[b].x,y=e[b+1].y-e[b].y,f.x=y*1,f.y=-A,f.z=y*0,m.copy(f),f.x+=g.x,f.y+=g.y,f.z+=g.z,f.normalize(),l.push(f.x,f.y,f.z),g.copy(m)}for(let b=0;b<=t;b++){const x=i+b*h*n,v=Math.sin(x),_=Math.cos(x);for(let C=0;C<=e.length-1;C++){d.x=e[C].x*v,d.y=e[C].y,d.z=e[C].x*_,o.push(d.x,d.y,d.z),u.x=b/t,u.y=C/(e.length-1),a.push(u.x,u.y);const S=l[3*C+0]*v,M=l[3*C+1],L=l[3*C+0]*_;c.push(S,M,L)}}for(let b=0;b<t;b++)for(let x=0;x<e.length-1;x++){const v=x+b*e.length,_=v,C=v+e.length,S=v+e.length+1,M=v+1;r.push(_,C,M),r.push(S,M,C)}this.setIndex(r),this.setAttribute("position",new ut(o,3)),this.setAttribute("uv",new ut(a,2)),this.setAttribute("normal",new ut(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new w1(e.points,e.segments,e.phiStart,e.phiLength)}}class oB extends w1{constructor(e=1,t=1,i=4,n=8){const r=new zw;r.absarc(0,-t/2,e,Math.PI*1.5,0),r.absarc(0,t/2,e,0,Math.PI*.5),super(r.getPoints(i),n),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:i,radialSegments:n}}static fromJSON(e){return new oB(e.radius,e.length,e.capSegments,e.radialSegments)}}class aB extends It{constructor(e=1,t=32,i=0,n=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},t=Math.max(3,t);const r=[],o=[],a=[],l=[],c=new T,h=new Q;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let d=0,u=3;d<=t;d++,u+=3){const f=i+d/t*n;c.x=e*Math.cos(f),c.y=e*Math.sin(f),o.push(c.x,c.y,c.z),a.push(0,0,1),h.x=(o[u]/e+1)/2,h.y=(o[u+1]/e+1)/2,l.push(h.x,h.y)}for(let d=1;d<=t;d++)r.push(d,d+1,0);this.setIndex(r),this.setAttribute("position",new ut(o,3)),this.setAttribute("normal",new ut(a,3)),this.setAttribute("uv",new ut(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new aB(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Ns extends It{constructor(e=1,t=1,i=1,n=32,r=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l};const c=this;n=Math.floor(n),r=Math.floor(r);const h=[],d=[],u=[],f=[];let m=0;const g=[],A=i/2;let y=0;b(),o===!1&&(e>0&&x(!0),t>0&&x(!1)),this.setIndex(h),this.setAttribute("position",new ut(d,3)),this.setAttribute("normal",new ut(u,3)),this.setAttribute("uv",new ut(f,2));function b(){const v=new T,_=new T;let C=0;const S=(t-e)/i;for(let M=0;M<=r;M++){const L=[],w=M/r,E=w*(t-e)+e;for(let B=0;B<=n;B++){const P=B/n,k=P*l+a,X=Math.sin(k),F=Math.cos(k);_.x=E*X,_.y=-w*i+A,_.z=E*F,d.push(_.x,_.y,_.z),v.set(X,S,F).normalize(),u.push(v.x,v.y,v.z),f.push(P,1-w),L.push(m++)}g.push(L)}for(let M=0;M<n;M++)for(let L=0;L<r;L++){const w=g[L][M],E=g[L+1][M],B=g[L+1][M+1],P=g[L][M+1];e>0&&(h.push(w,E,P),C+=3),t>0&&(h.push(E,B,P),C+=3)}c.addGroup(y,C,0),y+=C}function x(v){const _=m,C=new Q,S=new T;let M=0;const L=v===!0?e:t,w=v===!0?1:-1;for(let B=1;B<=n;B++)d.push(0,A*w,0),u.push(0,w,0),f.push(.5,.5),m++;const E=m;for(let B=0;B<=n;B++){const k=B/n*l+a,X=Math.cos(k),F=Math.sin(k);S.x=L*F,S.y=A*w,S.z=L*X,d.push(S.x,S.y,S.z),u.push(0,w,0),C.x=X*.5+.5,C.y=F*.5*w+.5,f.push(C.x,C.y),m++}for(let B=0;B<n;B++){const P=_+B,k=E+B;v===!0?h.push(k,k+1,P):h.push(k+1,k,P),M+=3}c.addGroup(y,M,v===!0?1:2),y+=M}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ns(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class lB extends Ns{constructor(e=1,t=1,i=32,n=1,r=!1,o=0,a=Math.PI*2){super(0,e,t,i,n,r,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:a}}static fromJSON(e){return new lB(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Im extends It{constructor(e=[],t=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};const r=[],o=[];a(n),c(i),h(),this.setAttribute("position",new ut(r,3)),this.setAttribute("normal",new ut(r.slice(),3)),this.setAttribute("uv",new ut(o,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function a(b){const x=new T,v=new T,_=new T;for(let C=0;C<t.length;C+=3)f(t[C+0],x),f(t[C+1],v),f(t[C+2],_),l(x,v,_,b)}function l(b,x,v,_){const C=_+1,S=[];for(let M=0;M<=C;M++){S[M]=[];const L=b.clone().lerp(v,M/C),w=x.clone().lerp(v,M/C),E=C-M;for(let B=0;B<=E;B++)B===0&&M===C?S[M][B]=L:S[M][B]=L.clone().lerp(w,B/E)}for(let M=0;M<C;M++)for(let L=0;L<2*(C-M)-1;L++){const w=Math.floor(L/2);L%2===0?(u(S[M][w+1]),u(S[M+1][w]),u(S[M][w])):(u(S[M][w+1]),u(S[M+1][w+1]),u(S[M+1][w]))}}function c(b){const x=new T;for(let v=0;v<r.length;v+=3)x.x=r[v+0],x.y=r[v+1],x.z=r[v+2],x.normalize().multiplyScalar(b),r[v+0]=x.x,r[v+1]=x.y,r[v+2]=x.z}function h(){const b=new T;for(let x=0;x<r.length;x+=3){b.x=r[x+0],b.y=r[x+1],b.z=r[x+2];const v=A(b)/2/Math.PI+.5,_=y(b)/Math.PI+.5;o.push(v,1-_)}m(),d()}function d(){for(let b=0;b<o.length;b+=6){const x=o[b+0],v=o[b+2],_=o[b+4],C=Math.max(x,v,_),S=Math.min(x,v,_);C>.9&&S<.1&&(x<.2&&(o[b+0]+=1),v<.2&&(o[b+2]+=1),_<.2&&(o[b+4]+=1))}}function u(b){r.push(b.x,b.y,b.z)}function f(b,x){const v=b*3;x.x=e[v+0],x.y=e[v+1],x.z=e[v+2]}function m(){const b=new T,x=new T,v=new T,_=new T,C=new Q,S=new Q,M=new Q;for(let L=0,w=0;L<r.length;L+=9,w+=6){b.set(r[L+0],r[L+1],r[L+2]),x.set(r[L+3],r[L+4],r[L+5]),v.set(r[L+6],r[L+7],r[L+8]),C.set(o[w+0],o[w+1]),S.set(o[w+2],o[w+3]),M.set(o[w+4],o[w+5]),_.copy(b).add(x).add(v).divideScalar(3);const E=A(_);g(C,w+0,b,E),g(S,w+2,x,E),g(M,w+4,v,E)}}function g(b,x,v,_){_<0&&b.x===1&&(o[x]=b.x-1),v.x===0&&v.z===0&&(o[x]=_/2/Math.PI+.5)}function A(b){return Math.atan2(b.z,-b.x)}function y(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Im(e.vertices,e.indices,e.radius,e.details)}}class cB extends Im{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,n=1/i,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new cB(e.radius,e.detail)}}const VI=new T,zI=new T,$G=new T,UI=new $s;class $U extends It{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const n=Math.pow(10,4),r=Math.cos(x0*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],h=["a","b","c"],d=new Array(3),u={},f=[];for(let m=0;m<l;m+=3){o?(c[0]=o.getX(m),c[1]=o.getX(m+1),c[2]=o.getX(m+2)):(c[0]=m,c[1]=m+1,c[2]=m+2);const{a:g,b:A,c:y}=UI;if(g.fromBufferAttribute(a,c[0]),A.fromBufferAttribute(a,c[1]),y.fromBufferAttribute(a,c[2]),UI.getNormal($G),d[0]=`${Math.round(g.x*n)},${Math.round(g.y*n)},${Math.round(g.z*n)}`,d[1]=`${Math.round(A.x*n)},${Math.round(A.y*n)},${Math.round(A.z*n)}`,d[2]=`${Math.round(y.x*n)},${Math.round(y.y*n)},${Math.round(y.z*n)}`,!(d[0]===d[1]||d[1]===d[2]||d[2]===d[0]))for(let b=0;b<3;b++){const x=(b+1)%3,v=d[b],_=d[x],C=UI[h[b]],S=UI[h[x]],M=`${v}_${_}`,L=`${_}_${v}`;L in u&&u[L]?($G.dot(u[L].normal)<=r&&(f.push(C.x,C.y,C.z),f.push(S.x,S.y,S.z)),u[L]=null):M in u||(u[M]={index0:c[b],index1:c[x],normal:$G.clone()})}}for(const m in u)if(u[m]){const{index0:g,index1:A}=u[m];VI.fromBufferAttribute(a,g),zI.fromBufferAttribute(a,A),f.push(VI.x,VI.y,VI.z),f.push(zI.x,zI.y,zI.z)}this.setAttribute("position",new ut(f,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Xf extends zw{constructor(e){super(e),this.uuid=Hl(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const n=e.holes[t];this.holes.push(new zw().fromJSON(n))}return this}}const Ame={triangulate:function(s,e,t=2){const i=e&&e.length,n=i?e[0]*t:s.length;let r=F8(s,0,n,t,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c,h,d,u,f;if(i&&(r=_me(s,e,r,t)),s.length>80*t){a=c=s[0],l=h=s[1];for(let m=t;m<n;m+=t)d=s[m],u=s[m+1],d<a&&(a=d),u<l&&(l=u),d>c&&(c=d),u>h&&(h=u);f=Math.max(c-a,h-l),f=f!==0?32767/f:0}return Uw(r,o,t,a,l,f,0),o}};function F8(s,e,t,i,n){let r,o;if(n===Pme(s,e,t,i)>0)for(r=e;r<t;r+=i)o=dH(r,s[r],s[r+1],o);else for(r=t-i;r>=e;r-=i)o=dH(r,s[r],s[r+1],o);return o&&hB(o,o.next)&&(Ow(o),o=o.next),o}function K0(s,e){if(!s)return s;e||(e=s);let t=s,i;do if(i=!1,!t.steiner&&(hB(t,t.next)||hs(t.prev,t,t.next)===0)){if(Ow(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Uw(s,e,t,i,n,r,o){if(!s)return;!o&&r&&Ime(s,i,n,r);let a=s,l,c;for(;s.prev!==s.next;){if(l=s.prev,c=s.next,r?bme(s,i,n,r):yme(s)){e.push(l.i/t|0),e.push(s.i/t|0),e.push(c.i/t|0),Ow(s),s=c.next,a=c.next;continue}if(s=c,s===a){o?o===1?(s=xme(K0(s),e,t),Uw(s,e,t,i,n,r,2)):o===2&&vme(s,e,t,i,n,r):Uw(K0(s),e,t,i,n,r,1);break}}}function yme(s){const e=s.prev,t=s,i=s.next;if(hs(e,t,i)>=0)return!1;const n=e.x,r=t.x,o=i.x,a=e.y,l=t.y,c=i.y,h=n<r?n<o?n:o:r<o?r:o,d=a<l?a<c?a:c:l<c?l:c,u=n>r?n>o?n:o:r>o?r:o,f=a>l?a>c?a:c:l>c?l:c;let m=i.next;for(;m!==e;){if(m.x>=h&&m.x<=u&&m.y>=d&&m.y<=f&&_b(n,a,r,l,o,c,m.x,m.y)&&hs(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function bme(s,e,t,i){const n=s.prev,r=s,o=s.next;if(hs(n,r,o)>=0)return!1;const a=n.x,l=r.x,c=o.x,h=n.y,d=r.y,u=o.y,f=a<l?a<c?a:c:l<c?l:c,m=h<d?h<u?h:u:d<u?d:u,g=a>l?a>c?a:c:l>c?l:c,A=h>d?h>u?h:u:d>u?d:u,y=QF(f,m,e,t,i),b=QF(g,A,e,t,i);let x=s.prevZ,v=s.nextZ;for(;x&&x.z>=y&&v&&v.z<=b;){if(x.x>=f&&x.x<=g&&x.y>=m&&x.y<=A&&x!==n&&x!==o&&_b(a,h,l,d,c,u,x.x,x.y)&&hs(x.prev,x,x.next)>=0||(x=x.prevZ,v.x>=f&&v.x<=g&&v.y>=m&&v.y<=A&&v!==n&&v!==o&&_b(a,h,l,d,c,u,v.x,v.y)&&hs(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;x&&x.z>=y;){if(x.x>=f&&x.x<=g&&x.y>=m&&x.y<=A&&x!==n&&x!==o&&_b(a,h,l,d,c,u,x.x,x.y)&&hs(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;v&&v.z<=b;){if(v.x>=f&&v.x<=g&&v.y>=m&&v.y<=A&&v!==n&&v!==o&&_b(a,h,l,d,c,u,v.x,v.y)&&hs(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function xme(s,e,t){let i=s;do{const n=i.prev,r=i.next.next;!hB(n,r)&&V8(n,i,i.next,r)&&Xw(n,r)&&Xw(r,n)&&(e.push(n.i/t|0),e.push(i.i/t|0),e.push(r.i/t|0),Ow(i),Ow(i.next),i=s=r),i=i.next}while(i!==s);return K0(i)}function vme(s,e,t,i,n,r){let o=s;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&Rme(o,a)){let l=z8(o,a);o=K0(o,o.next),l=K0(l,l.next),Uw(o,e,t,i,n,r,0),Uw(l,e,t,i,n,r,0);return}a=a.next}o=o.next}while(o!==s)}function _me(s,e,t,i){const n=[];let r,o,a,l,c;for(r=0,o=e.length;r<o;r++)a=e[r]*i,l=r<o-1?e[r+1]*i:s.length,c=F8(s,a,l,i,!1),c===c.next&&(c.steiner=!0),n.push(Eme(c));for(n.sort(Cme),r=0;r<n.length;r++)t=wme(n[r],t);return t}function Cme(s,e){return s.x-e.x}function wme(s,e){const t=Sme(s,e);if(!t)return e;const i=z8(t,s);return K0(i,i.next),K0(t,t.next)}function Sme(s,e){let t=e,i=-1/0,n;const r=s.x,o=s.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const u=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(u<=r&&u>i&&(i=u,n=t.x<t.next.x?t:t.next,u===r))return n}t=t.next}while(t!==e);if(!n)return null;const a=n,l=n.x,c=n.y;let h=1/0,d;t=n;do r>=t.x&&t.x>=l&&r!==t.x&&_b(o<c?r:i,o,l,c,o<c?i:r,o,t.x,t.y)&&(d=Math.abs(o-t.y)/(r-t.x),Xw(t,s)&&(d<h||d===h&&(t.x>n.x||t.x===n.x&&Mme(n,t)))&&(n=t,h=d)),t=t.next;while(t!==a);return n}function Mme(s,e){return hs(s.prev,s,e.prev)<0&&hs(e.next,s,s.next)<0}function Ime(s,e,t,i){let n=s;do n.z===0&&(n.z=QF(n.x,n.y,e,t,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==s);n.prevZ.nextZ=null,n.prevZ=null,Tme(n)}function Tme(s){let e,t,i,n,r,o,a,l,c=1;do{for(t=s,s=null,r=null,o=0;t;){for(o++,i=t,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||t.z<=i.z)?(n=t,t=t.nextZ,a--):(n=i,i=i.nextZ,l--),r?r.nextZ=n:s=n,n.prevZ=r,r=n;t=i}r.nextZ=null,c*=2}while(o>1);return s}function QF(s,e,t,i,n){return s=(s-t)*n|0,e=(e-i)*n|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,s|e<<1}function Eme(s){let e=s,t=s;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==s);return t}function _b(s,e,t,i,n,r,o,a){return(n-o)*(e-a)>=(s-o)*(r-a)&&(s-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(r-a)>=(n-o)*(i-a)}function Rme(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!Lme(s,e)&&(Xw(s,e)&&Xw(e,s)&&Bme(s,e)&&(hs(s.prev,s,e.prev)||hs(s,e.prev,e))||hB(s,e)&&hs(s.prev,s,s.next)>0&&hs(e.prev,e,e.next)>0)}function hs(s,e,t){return(e.y-s.y)*(t.x-e.x)-(e.x-s.x)*(t.y-e.y)}function hB(s,e){return s.x===e.x&&s.y===e.y}function V8(s,e,t,i){const n=OI(hs(s,e,t)),r=OI(hs(s,e,i)),o=OI(hs(t,i,s)),a=OI(hs(t,i,e));return!!(n!==r&&o!==a||n===0&&XI(s,t,e)||r===0&&XI(s,i,e)||o===0&&XI(t,s,i)||a===0&&XI(t,e,i))}function XI(s,e,t){return e.x<=Math.max(s.x,t.x)&&e.x>=Math.min(s.x,t.x)&&e.y<=Math.max(s.y,t.y)&&e.y>=Math.min(s.y,t.y)}function OI(s){return s>0?1:s<0?-1:0}function Lme(s,e){let t=s;do{if(t.i!==s.i&&t.next.i!==s.i&&t.i!==e.i&&t.next.i!==e.i&&V8(t,t.next,s,e))return!0;t=t.next}while(t!==s);return!1}function Xw(s,e){return hs(s.prev,s,s.next)<0?hs(s,e,s.next)>=0&&hs(s,s.prev,e)>=0:hs(s,e,s.prev)<0||hs(s,s.next,e)<0}function Bme(s,e){let t=s,i=!1;const n=(s.x+e.x)/2,r=(s.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&n<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==s);return i}function z8(s,e){const t=new KF(s.i,s.x,s.y),i=new KF(e.i,e.x,e.y),n=s.next,r=e.prev;return s.next=e,e.prev=s,t.next=n,n.prev=t,i.next=t,t.prev=i,r.next=i,i.prev=r,i}function dH(s,e,t,i){const n=new KF(s,e,t);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Ow(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function KF(s,e,t){this.i=s,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Pme(s,e,t,i){let n=0;for(let r=e,o=t-i;r<t;r+=i)n+=(s[o]-s[r])*(s[r+1]+s[o+1]),o=r;return n}class Sh{static area(e){const t=e.length;let i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return i*.5}static isClockWise(e){return Sh.area(e)<0}static triangulateShape(e,t){const i=[],n=[],r=[];uH(e),pH(i,e);let o=e.length;t.forEach(uH);for(let l=0;l<t.length;l++)n.push(o),o+=t[l].length,pH(i,t[l]);const a=Ame.triangulate(i,n);for(let l=0;l<a.length;l+=3)r.push(a.slice(l,l+3));return r}}function uH(s){const e=s.length;e>2&&s[e-1].equals(s[0])&&s.pop()}function pH(s,e){for(let t=0;t<e.length;t++)s.push(e[t].x),s.push(e[t].y)}class Qx extends It{constructor(e=new Xf([new Q(.5,.5),new Q(-.5,.5),new Q(-.5,-.5),new Q(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,n=[],r=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new ut(n,3)),this.setAttribute("uv",new ut(r,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1,d=t.depth!==void 0?t.depth:1;let u=t.bevelEnabled!==void 0?t.bevelEnabled:!0,f=t.bevelThickness!==void 0?t.bevelThickness:.2,m=t.bevelSize!==void 0?t.bevelSize:f-.1,g=t.bevelOffset!==void 0?t.bevelOffset:0,A=t.bevelSegments!==void 0?t.bevelSegments:3;const y=t.extrudePath,b=t.UVGenerator!==void 0?t.UVGenerator:Gme;let x,v=!1,_,C,S,M;y&&(x=y.getSpacedPoints(h),v=!0,u=!1,_=y.computeFrenetFrames(h,!1),C=new T,S=new T,M=new T),u||(A=0,f=0,m=0,g=0);const L=a.extractPoints(c);let w=L.shape;const E=L.holes;if(!Sh.isClockWise(w)){w=w.reverse();for(let ke=0,Z=E.length;ke<Z;ke++){const Ke=E[ke];Sh.isClockWise(Ke)&&(E[ke]=Ke.reverse())}}const P=Sh.triangulateShape(w,E),k=w;for(let ke=0,Z=E.length;ke<Z;ke++){const Ke=E[ke];w=w.concat(Ke)}function X(ke,Z,Ke){return Z||console.error("THREE.ExtrudeGeometry: vec does not exist"),ke.clone().addScaledVector(Z,Ke)}const F=w.length,H=P.length;function W(ke,Z,Ke){let je,We,nt;const Tt=ke.x-Z.x,mt=ke.y-Z.y,O=Ke.x-ke.x,D=Ke.y-ke.y,he=Tt*Tt+mt*mt,Ee=Tt*D-mt*O;if(Math.abs(Ee)>Number.EPSILON){const Ne=Math.sqrt(he),Re=Math.sqrt(O*O+D*D),yt=Z.x-mt/Ne,et=Z.y+Tt/Ne,ct=Ke.x-D/Re,Jt=Ke.y+O/Re,Ge=((ct-yt)*D-(Jt-et)*O)/(Tt*D-mt*O);je=yt+Tt*Ge-ke.x,We=et+mt*Ge-ke.y;const At=je*je+We*We;if(At<=2)return new Q(je,We);nt=Math.sqrt(At/2)}else{let Ne=!1;Tt>Number.EPSILON?O>Number.EPSILON&&(Ne=!0):Tt<-Number.EPSILON?O<-Number.EPSILON&&(Ne=!0):Math.sign(mt)===Math.sign(D)&&(Ne=!0),Ne?(je=-mt,We=Tt,nt=Math.sqrt(he)):(je=Tt,We=mt,nt=Math.sqrt(he/2))}return new Q(je/nt,We/nt)}const se=[];for(let ke=0,Z=k.length,Ke=Z-1,je=ke+1;ke<Z;ke++,Ke++,je++)Ke===Z&&(Ke=0),je===Z&&(je=0),se[ke]=W(k[ke],k[Ke],k[je]);const de=[];let be,Pe=se.concat();for(let ke=0,Z=E.length;ke<Z;ke++){const Ke=E[ke];be=[];for(let je=0,We=Ke.length,nt=We-1,Tt=je+1;je<We;je++,nt++,Tt++)nt===We&&(nt=0),Tt===We&&(Tt=0),be[je]=W(Ke[je],Ke[nt],Ke[Tt]);de.push(be),Pe=Pe.concat(be)}for(let ke=0;ke<A;ke++){const Z=ke/A,Ke=f*Math.cos(Z*Math.PI/2),je=m*Math.sin(Z*Math.PI/2)+g;for(let We=0,nt=k.length;We<nt;We++){const Tt=X(k[We],se[We],je);Le(Tt.x,Tt.y,-Ke)}for(let We=0,nt=E.length;We<nt;We++){const Tt=E[We];be=de[We];for(let mt=0,O=Tt.length;mt<O;mt++){const D=X(Tt[mt],be[mt],je);Le(D.x,D.y,-Ke)}}}const Oe=m+g;for(let ke=0;ke<F;ke++){const Z=u?X(w[ke],Pe[ke],Oe):w[ke];v?(S.copy(_.normals[0]).multiplyScalar(Z.x),C.copy(_.binormals[0]).multiplyScalar(Z.y),M.copy(x[0]).add(S).add(C),Le(M.x,M.y,M.z)):Le(Z.x,Z.y,0)}for(let ke=1;ke<=h;ke++)for(let Z=0;Z<F;Z++){const Ke=u?X(w[Z],Pe[Z],Oe):w[Z];v?(S.copy(_.normals[ke]).multiplyScalar(Ke.x),C.copy(_.binormals[ke]).multiplyScalar(Ke.y),M.copy(x[ke]).add(S).add(C),Le(M.x,M.y,M.z)):Le(Ke.x,Ke.y,d/h*ke)}for(let ke=A-1;ke>=0;ke--){const Z=ke/A,Ke=f*Math.cos(Z*Math.PI/2),je=m*Math.sin(Z*Math.PI/2)+g;for(let We=0,nt=k.length;We<nt;We++){const Tt=X(k[We],se[We],je);Le(Tt.x,Tt.y,d+Ke)}for(let We=0,nt=E.length;We<nt;We++){const Tt=E[We];be=de[We];for(let mt=0,O=Tt.length;mt<O;mt++){const D=X(Tt[mt],be[mt],je);v?Le(D.x,D.y+x[h-1].y,x[h-1].x+Ke):Le(D.x,D.y,d+Ke)}}}ae(),Ae();function ae(){const ke=n.length/3;if(u){let Z=0,Ke=F*Z;for(let je=0;je<H;je++){const We=P[je];st(We[2]+Ke,We[1]+Ke,We[0]+Ke)}Z=h+A*2,Ke=F*Z;for(let je=0;je<H;je++){const We=P[je];st(We[0]+Ke,We[1]+Ke,We[2]+Ke)}}else{for(let Z=0;Z<H;Z++){const Ke=P[Z];st(Ke[2],Ke[1],Ke[0])}for(let Z=0;Z<H;Z++){const Ke=P[Z];st(Ke[0]+F*h,Ke[1]+F*h,Ke[2]+F*h)}}i.addGroup(ke,n.length/3-ke,0)}function Ae(){const ke=n.length/3;let Z=0;Se(k,Z),Z+=k.length;for(let Ke=0,je=E.length;Ke<je;Ke++){const We=E[Ke];Se(We,Z),Z+=We.length}i.addGroup(ke,n.length/3-ke,1)}function Se(ke,Z){let Ke=ke.length;for(;--Ke>=0;){const je=Ke;let We=Ke-1;We<0&&(We=ke.length-1);for(let nt=0,Tt=h+A*2;nt<Tt;nt++){const mt=F*nt,O=F*(nt+1),D=Z+je+mt,he=Z+We+mt,Ee=Z+We+O,Ne=Z+je+O;ot(D,he,Ee,Ne)}}}function Le(ke,Z,Ke){l.push(ke),l.push(Z),l.push(Ke)}function st(ke,Z,Ke){Ct(ke),Ct(Z),Ct(Ke);const je=n.length/3,We=b.generateTopUV(i,n,je-3,je-2,je-1);zt(We[0]),zt(We[1]),zt(We[2])}function ot(ke,Z,Ke,je){Ct(ke),Ct(Z),Ct(je),Ct(Z),Ct(Ke),Ct(je);const We=n.length/3,nt=b.generateSideWallUV(i,n,We-6,We-3,We-2,We-1);zt(nt[0]),zt(nt[1]),zt(nt[3]),zt(nt[1]),zt(nt[2]),zt(nt[3])}function Ct(ke){n.push(l[ke*3+0]),n.push(l[ke*3+1]),n.push(l[ke*3+2])}function zt(ke){r.push(ke.x),r.push(ke.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return kme(t,i,e)}static fromJSON(e,t){const i=[];for(let r=0,o=e.shapes.length;r<o;r++){const a=t[e.shapes[r]];i.push(a)}const n=e.options.extrudePath;return n!==void 0&&(e.options.extrudePath=new SL[n.type]().fromJSON(n)),new Qx(i,e.options)}}const Gme={generateTopUV:function(s,e,t,i,n){const r=e[t*3],o=e[t*3+1],a=e[i*3],l=e[i*3+1],c=e[n*3],h=e[n*3+1];return[new Q(r,o),new Q(a,l),new Q(c,h)]},generateSideWallUV:function(s,e,t,i,n,r){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[i*3],h=e[i*3+1],d=e[i*3+2],u=e[n*3],f=e[n*3+1],m=e[n*3+2],g=e[r*3],A=e[r*3+1],y=e[r*3+2];return Math.abs(a-h)<Math.abs(o-c)?[new Q(o,1-l),new Q(c,1-d),new Q(u,1-m),new Q(g,1-y)]:[new Q(a,1-l),new Q(h,1-d),new Q(f,1-m),new Q(A,1-y)]}};function kme(s,e,t){if(t.shapes=[],Array.isArray(s))for(let i=0,n=s.length;i<n;i++){const r=s[i];t.shapes.push(r.uuid)}else t.shapes.push(s.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class dB extends Im{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,n=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(n,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new dB(e.radius,e.detail)}}class lp extends Im{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,n,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new lp(e.radius,e.detail)}}class S1 extends It{constructor(e=.5,t=1,i=32,n=1,r=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:o},i=Math.max(3,i),n=Math.max(1,n);const a=[],l=[],c=[],h=[];let d=e;const u=(t-e)/n,f=new T,m=new Q;for(let g=0;g<=n;g++){for(let A=0;A<=i;A++){const y=r+A/i*o;f.x=d*Math.cos(y),f.y=d*Math.sin(y),l.push(f.x,f.y,f.z),c.push(0,0,1),m.x=(f.x/t+1)/2,m.y=(f.y/t+1)/2,h.push(m.x,m.y)}d+=u}for(let g=0;g<n;g++){const A=g*(i+1);for(let y=0;y<i;y++){const b=y+A,x=b,v=b+i+1,_=b+i+2,C=b+1;a.push(x,v,C),a.push(v,_,C)}}this.setIndex(a),this.setAttribute("position",new ut(l,3)),this.setAttribute("normal",new ut(c,3)),this.setAttribute("uv",new ut(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new S1(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class uB extends It{constructor(e=new Xf([new Q(0,.5),new Q(-.5,-.5),new Q(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],n=[],r=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let h=0;h<e.length;h++)c(e[h]),this.addGroup(a,l,h),a+=l,l=0;this.setIndex(i),this.setAttribute("position",new ut(n,3)),this.setAttribute("normal",new ut(r,3)),this.setAttribute("uv",new ut(o,2));function c(h){const d=n.length/3,u=h.extractPoints(t);let f=u.shape;const m=u.holes;Sh.isClockWise(f)===!1&&(f=f.reverse());for(let A=0,y=m.length;A<y;A++){const b=m[A];Sh.isClockWise(b)===!0&&(m[A]=b.reverse())}const g=Sh.triangulateShape(f,m);for(let A=0,y=m.length;A<y;A++){const b=m[A];f=f.concat(b)}for(let A=0,y=f.length;A<y;A++){const b=f[A];n.push(b.x,b.y,0),r.push(0,0,1),o.push(b.x,b.y)}for(let A=0,y=g.length;A<y;A++){const b=g[A],x=b[0]+d,v=b[1]+d,_=b[2]+d;i.push(x,v,_),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return Nme(t,e)}static fromJSON(e,t){const i=[];for(let n=0,r=e.shapes.length;n<r;n++){const o=t[e.shapes[n]];i.push(o)}return new uB(i,e.curveSegments)}}function Nme(s,e){if(e.shapes=[],Array.isArray(s))for(let t=0,i=s.length;t<i;t++){const n=s[t];e.shapes.push(n.uuid)}else e.shapes.push(s.uuid);return e}class Wc extends It{constructor(e=1,t=32,i=16,n=0,r=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let c=0;const h=[],d=new T,u=new T,f=[],m=[],g=[],A=[];for(let y=0;y<=i;y++){const b=[],x=y/i;let v=0;y===0&&o===0?v=.5/t:y===i&&l===Math.PI&&(v=-.5/t);for(let _=0;_<=t;_++){const C=_/t;d.x=-e*Math.cos(n+C*r)*Math.sin(o+x*a),d.y=e*Math.cos(o+x*a),d.z=e*Math.sin(n+C*r)*Math.sin(o+x*a),m.push(d.x,d.y,d.z),u.copy(d).normalize(),g.push(u.x,u.y,u.z),A.push(C+v,1-x),b.push(c++)}h.push(b)}for(let y=0;y<i;y++)for(let b=0;b<t;b++){const x=h[y][b+1],v=h[y][b],_=h[y+1][b],C=h[y+1][b+1];(y!==0||o>0)&&f.push(x,v,C),(y!==i-1||l<Math.PI)&&f.push(v,_,C)}this.setIndex(f),this.setAttribute("position",new ut(m,3)),this.setAttribute("normal",new ut(g,3)),this.setAttribute("uv",new ut(A,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wc(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class pB extends Im{constructor(e=1,t=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,n,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new pB(e.radius,e.detail)}}class tp extends It{constructor(e=1,t=.4,i=12,n=48,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);const o=[],a=[],l=[],c=[],h=new T,d=new T,u=new T;for(let f=0;f<=i;f++)for(let m=0;m<=n;m++){const g=m/n*r,A=f/i*Math.PI*2;d.x=(e+t*Math.cos(A))*Math.cos(g),d.y=(e+t*Math.cos(A))*Math.sin(g),d.z=t*Math.sin(A),a.push(d.x,d.y,d.z),h.x=e*Math.cos(g),h.y=e*Math.sin(g),u.subVectors(d,h).normalize(),l.push(u.x,u.y,u.z),c.push(m/n),c.push(f/i)}for(let f=1;f<=i;f++)for(let m=1;m<=n;m++){const g=(n+1)*f+m-1,A=(n+1)*(f-1)+m-1,y=(n+1)*(f-1)+m,b=(n+1)*f+m;o.push(g,A,b),o.push(A,y,b)}this.setIndex(o),this.setAttribute("position",new ut(a,3)),this.setAttribute("normal",new ut(l,3)),this.setAttribute("uv",new ut(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new tp(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class fB extends It{constructor(e=1,t=.4,i=64,n=8,r=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:o},i=Math.floor(i),n=Math.floor(n);const a=[],l=[],c=[],h=[],d=new T,u=new T,f=new T,m=new T,g=new T,A=new T,y=new T;for(let x=0;x<=i;++x){const v=x/i*r*Math.PI*2;b(v,r,o,e,f),b(v+.01,r,o,e,m),A.subVectors(m,f),y.addVectors(m,f),g.crossVectors(A,y),y.crossVectors(g,A),g.normalize(),y.normalize();for(let _=0;_<=n;++_){const C=_/n*Math.PI*2,S=-t*Math.cos(C),M=t*Math.sin(C);d.x=f.x+(S*y.x+M*g.x),d.y=f.y+(S*y.y+M*g.y),d.z=f.z+(S*y.z+M*g.z),l.push(d.x,d.y,d.z),u.subVectors(d,f).normalize(),c.push(u.x,u.y,u.z),h.push(x/i),h.push(_/n)}}for(let x=1;x<=i;x++)for(let v=1;v<=n;v++){const _=(n+1)*(x-1)+(v-1),C=(n+1)*x+(v-1),S=(n+1)*x+v,M=(n+1)*(x-1)+v;a.push(_,C,M),a.push(C,S,M)}this.setIndex(a),this.setAttribute("position",new ut(l,3)),this.setAttribute("normal",new ut(c,3)),this.setAttribute("uv",new ut(h,2));function b(x,v,_,C,S){const M=Math.cos(x),L=Math.sin(x),w=_/v*x,E=Math.cos(w);S.x=C*(2+E)*.5*M,S.y=C*(2+E)*L*.5,S.z=C*Math.sin(w)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fB(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class mB extends It{constructor(e=new jU(new T(-1,-1,0),new T(-1,1,0),new T(1,1,0)),t=64,i=1,n=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:r};const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new T,l=new T,c=new Q;let h=new T;const d=[],u=[],f=[],m=[];g(),this.setIndex(m),this.setAttribute("position",new ut(d,3)),this.setAttribute("normal",new ut(u,3)),this.setAttribute("uv",new ut(f,2));function g(){for(let x=0;x<t;x++)A(x);A(r===!1?t:0),b(),y()}function A(x){h=e.getPointAt(x/t,h);const v=o.normals[x],_=o.binormals[x];for(let C=0;C<=n;C++){const S=C/n*Math.PI*2,M=Math.sin(S),L=-Math.cos(S);l.x=L*v.x+M*_.x,l.y=L*v.y+M*_.y,l.z=L*v.z+M*_.z,l.normalize(),u.push(l.x,l.y,l.z),a.x=h.x+i*l.x,a.y=h.y+i*l.y,a.z=h.z+i*l.z,d.push(a.x,a.y,a.z)}}function y(){for(let x=1;x<=t;x++)for(let v=1;v<=n;v++){const _=(n+1)*(x-1)+(v-1),C=(n+1)*x+(v-1),S=(n+1)*x+v,M=(n+1)*(x-1)+v;m.push(_,C,M),m.push(C,S,M)}}function b(){for(let x=0;x<=t;x++)for(let v=0;v<=n;v++)c.x=x/t,c.y=v/n,f.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new mB(new SL[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class eX extends It{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],i=new Set,n=new T,r=new T;if(e.index!==null){const o=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let c=0,h=l.length;c<h;++c){const d=l[c],u=d.start,f=d.count;for(let m=u,g=u+f;m<g;m+=3)for(let A=0;A<3;A++){const y=a.getX(m+A),b=a.getX(m+(A+1)%3);n.fromBufferAttribute(o,y),r.fromBufferAttribute(o,b),fH(n,r,i)===!0&&(t.push(n.x,n.y,n.z),t.push(r.x,r.y,r.z))}}}else{const o=e.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let c=0;c<3;c++){const h=3*a+c,d=3*a+(c+1)%3;n.fromBufferAttribute(o,h),r.fromBufferAttribute(o,d),fH(n,r,i)===!0&&(t.push(n.x,n.y,n.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new ut(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function fH(s,e,t){const i=`${s.x},${s.y},${s.z}-${e.x},${e.y},${e.z}`,n=`${e.x},${e.y},${e.z}-${s.x},${s.y},${s.z}`;return t.has(i)===!0||t.has(n)===!0?!1:(t.add(i),t.add(n),!0)}var mH=Object.freeze({__proto__:null,BoxGeometry:pn,CapsuleGeometry:oB,CircleGeometry:aB,ConeGeometry:lB,CylinderGeometry:Ns,DodecahedronGeometry:cB,EdgesGeometry:$U,ExtrudeGeometry:Qx,IcosahedronGeometry:dB,LatheGeometry:w1,OctahedronGeometry:lp,PlaneGeometry:Rs,PolyhedronGeometry:Im,RingGeometry:S1,ShapeGeometry:uB,SphereGeometry:Wc,TetrahedronGeometry:pB,TorusGeometry:tp,TorusKnotGeometry:fB,TubeGeometry:mB,WireframeGeometry:eX});class M1 extends Yt{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ge(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class gB extends Ht{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}let Us=class extends Yt{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ge(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ge(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qd,this.normalScale=new Q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Xi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}},To=class extends Us{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Q(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ws(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ge(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ge(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ge(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}};class Of extends Yt{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ge(16777215),this.specular=new ge(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ge(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qd,this.normalScale=new Q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Xi,this.combine=Fx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class tX extends Yt{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ge(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ge(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qd,this.normalScale=new Q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class I1 extends Yt{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qd,this.normalScale=new Q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class AB extends Yt{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ge(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ge(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qd,this.normalScale=new Q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Xi,this.combine=Fx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class iX extends Yt{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ge(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qd,this.normalScale=new Q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class yB extends _n{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function l0(s,e,t){return!s||!t&&s.constructor===e?s:typeof e.BYTES_PER_ELEMENT=="number"?new e(s):Array.prototype.slice.call(s)}function U8(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function X8(s){function e(n,r){return s[n]-s[r]}const t=s.length,i=new Array(t);for(let n=0;n!==t;++n)i[n]=n;return i.sort(e),i}function YF(s,e,t){const i=s.length,n=new s.constructor(i);for(let r=0,o=0;o!==i;++r){const a=t[r]*e;for(let l=0;l!==e;++l)n[o++]=s[a+l]}return n}function nX(s,e,t,i){let n=1,r=s[0];for(;r!==void 0&&r[i]===void 0;)r=s[n++];if(r===void 0)return;let o=r[i];if(o!==void 0)if(Array.isArray(o))do o=r[i],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=s[n++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[i],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=s[n++];while(r!==void 0);else do o=r[i],o!==void 0&&(e.push(r.time),t.push(o)),r=s[n++];while(r!==void 0)}function Dme(s,e,t,i,n=30){const r=s.clone();r.name=e;const o=[];for(let l=0;l<r.tracks.length;++l){const c=r.tracks[l],h=c.getValueSize(),d=[],u=[];for(let f=0;f<c.times.length;++f){const m=c.times[f]*n;if(!(m<t||m>=i)){d.push(c.times[f]);for(let g=0;g<h;++g)u.push(c.values[f*h+g])}}d.length!==0&&(c.times=l0(d,c.times.constructor),c.values=l0(u,c.values.constructor),o.push(c))}r.tracks=o;let a=1/0;for(let l=0;l<r.tracks.length;++l)a>r.tracks[l].times[0]&&(a=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*a);return r.resetDuration(),r}function Fme(s,e=0,t=s,i=30){i<=0&&(i=30);const n=t.tracks.length,r=e/i;for(let o=0;o<n;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=s.tracks.find(function(y){return y.name===a.name&&y.ValueTypeName===l});if(c===void 0)continue;let h=0;const d=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=d/3);let u=0;const f=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=f/3);const m=a.times.length-1;let g;if(r<=a.times[0]){const y=h,b=d-h;g=a.values.slice(y,b)}else if(r>=a.times[m]){const y=m*d+h,b=y+d-h;g=a.values.slice(y,b)}else{const y=a.createInterpolant(),b=h,x=d-h;y.evaluate(r),g=y.resultBuffer.slice(b,x)}l==="quaternion"&&new Ve().fromArray(g).normalize().conjugate().toArray(g);const A=c.times.length;for(let y=0;y<A;++y){const b=y*f+u;if(l==="quaternion")Ve.multiplyQuaternionsFlat(c.values,b,g,0,c.values,b);else{const x=f-u*2;for(let v=0;v<x;++v)c.values[b+v]-=g[v]}}}return s.blendMode=RU,s}const Vme={convertArray:l0,isTypedArray:U8,getKeyframeOrder:X8,sortedArray:YF,flattenJSON:nX,subclip:Dme,makeClipAdditive:Fme};let Kx=class{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let o;i:{n:if(!(e<n)){for(let a=i+2;;){if(n===void 0){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=n,n=t[++i],e<n)break t}o=t.length;break i}if(!(e>=r)){const a=t[1];e<a&&(i=2,r=a);for(let l=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(n=r,r=t[--i-1],e>=r)break t}o=i,i=0;break i}break e}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(n=t[i],r=t[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let o=0;o!==n;++o)t[o]=i[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},O8=class extends Kx{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:r0,endingEnd:r0}}intervalChanged_(e,t,i){const n=this.parameterPositions;let r=e-2,o=e+1,a=n[r],l=n[o];if(a===void 0)switch(this.getSettings_().endingStart){case o0:r=e,a=2*t-i;break;case Gw:r=n.length-2,a=t+n[r]-n[r+1];break;default:r=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case o0:o=e,l=2*i-t;break;case Gw:o=1,l=i+n[1]-n[0];break;default:o=e-1,l=t}const c=(i-t)*.5,h=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=r*h,this._offsetNext=o*h}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=this._offsetPrev,d=this._offsetNext,u=this._weightPrev,f=this._weightNext,m=(i-t)/(n-t),g=m*m,A=g*m,y=-u*A+2*u*g-u*m,b=(1+u)*A+(-1.5-2*u)*g+(-.5+u)*m+1,x=(-1-f)*A+(1.5+f)*g+.5*m,v=f*A-f*g;for(let _=0;_!==a;++_)r[_]=y*o[h+_]+b*o[c+_]+x*o[l+_]+v*o[d+_];return r}},sX=class extends Kx{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=(i-t)/(n-t),d=1-h;for(let u=0;u!==a;++u)r[u]=o[c+u]*d+o[l+u]*h;return r}},Z8=class extends Kx{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}},Uh=class{constructor(e,t,i,n){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=l0(t,this.TimeBufferType),this.values=l0(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:l0(e.times,Array),values:l0(e.values,Array)};const n=e.getInterpolation();n!==e.DefaultInterpolation&&(i.interpolation=n)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new Z8(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new sX(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new O8(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case hm:t=this.InterpolantFactoryMethodDiscrete;break;case Mp:t=this.InterpolantFactoryMethodLinear;break;case hR:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return hm;case this.InterpolantFactoryMethodLinear:return Mp;case this.InterpolantFactoryMethodSmooth:return hR}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){const i=this.times,n=i.length;let r=0,o=n-1;for(;r!==n&&i[r]<e;)++r;for(;o!==-1&&i[o]>t;)--o;if(++o,r!==0||o!==n){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=i.slice(r,o),this.values=this.values.slice(r*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,n=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(n!==void 0&&U8(n))for(let a=0,l=n.length;a!==l;++a){const c=n[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),n=this.getInterpolation()===hR,r=e.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=e[a],h=e[a+1];if(c!==h&&(a!==1||c!==e[0]))if(n)l=!0;else{const d=a*i,u=d-i,f=d+i;for(let m=0;m!==i;++m){const g=t[d+m];if(g!==t[u+m]||g!==t[f+m]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const d=a*i,u=o*i;for(let f=0;f!==i;++f)t[u+f]=t[d+f]}++o}}if(r>0){e[o]=e[r];for(let a=r*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,n=new i(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}};Uh.prototype.TimeBufferType=Float32Array;Uh.prototype.ValueBufferType=Float32Array;Uh.prototype.DefaultInterpolation=Mp;let dA=class extends Uh{constructor(e,t,i){super(e,t,i)}};dA.prototype.ValueTypeName="bool";dA.prototype.ValueBufferType=Array;dA.prototype.DefaultInterpolation=hm;dA.prototype.InterpolantFactoryMethodLinear=void 0;dA.prototype.InterpolantFactoryMethodSmooth=void 0;let bB=class extends Uh{};bB.prototype.ValueTypeName="color";let Ip=class extends Uh{};Ip.prototype.ValueTypeName="number";let W8=class extends Kx{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(n-t);let c=e*a;for(let h=c+a;c!==h;c+=4)Ve.slerpFlat(r,0,o,c-a,o,c,l);return r}},Kd=class extends Uh{InterpolantFactoryMethodLinear(e){return new W8(this.times,this.values,this.getValueSize(),e)}};Kd.prototype.ValueTypeName="quaternion";Kd.prototype.InterpolantFactoryMethodSmooth=void 0;let uA=class extends Uh{constructor(e,t,i){super(e,t,i)}};uA.prototype.ValueTypeName="string";uA.prototype.ValueBufferType=Array;uA.prototype.DefaultInterpolation=hm;uA.prototype.InterpolantFactoryMethodLinear=void 0;uA.prototype.InterpolantFactoryMethodSmooth=void 0;let Yd=class extends Uh{};Yd.prototype.ValueTypeName="vector";let Ba=class{constructor(e="",t=-1,i=[],n=J2){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=Hl(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(Ume(i[o]).scale(n));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=i.length;r!==o;++r)t.push(Uh.toJSON(i[r]));return n}static CreateFromMorphTargetSequence(e,t,i,n){const r=t.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const h=X8(l);l=YF(l,1,h),c=YF(c,1,h),!n&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new Ip(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const n=e;i=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],h=c.name.match(r);if(h&&h.length>1){const d=h[1];let u=n[d];u||(n[d]=u=[]),u.push(c)}}const o=[];for(const a in n)o.push(this.CreateFromMorphTargetSequence(a,n[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(d,u,f,m,g){if(f.length!==0){const A=[],y=[];nX(f,A,y,m),A.length!==0&&g.push(new d(u,A,y))}},n=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const u=c[d].keys;if(!(!u||u.length===0))if(u[0].morphTargets){const f={};let m;for(m=0;m<u.length;m++)if(u[m].morphTargets)for(let g=0;g<u[m].morphTargets.length;g++)f[u[m].morphTargets[g]]=-1;for(const g in f){const A=[],y=[];for(let b=0;b!==u[m].morphTargets.length;++b){const x=u[m];A.push(x.time),y.push(x.morphTarget===g?1:0)}n.push(new Ip(".morphTargetInfluence["+g+"]",A,y))}l=f.length*o}else{const f=".bones["+t[d].name+"]";i(Yd,f+".position",u,"pos",n),i(Kd,f+".quaternion",u,"rot",n),i(Yd,f+".scale",u,"scl",n)}}return n.length===0?null:new this(r,l,n,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,n=e.length;i!==n;++i){const r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function zme(s){switch(s.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ip;case"vector":case"vector2":case"vector3":case"vector4":return Yd;case"color":return bB;case"quaternion":return Kd;case"bool":case"boolean":return dA;case"string":return uA}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+s)}function Ume(s){if(s.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=zme(s.type);if(s.times===void 0){const t=[],i=[];nX(s.keys,t,i,"value"),s.times=t,s.values=i}return e.parse!==void 0?e.parse(s):new e(s.name,s.times,s.values,s.interpolation)}const cp={enabled:!1,files:{},add:function(s,e){this.enabled!==!1&&(this.files[s]=e)},get:function(s){if(this.enabled!==!1)return this.files[s]},remove:function(s){delete this.files[s]},clear:function(){this.files={}}};let xB=class{constructor(e,t,i){const n=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(h){a++,r===!1&&n.onStart!==void 0&&n.onStart(h,o,a),r=!0},this.itemEnd=function(h){o++,n.onProgress!==void 0&&n.onProgress(h,o,a),o===a&&(r=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(h){n.onError!==void 0&&n.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,d){return c.push(h,d),this},this.removeHandler=function(h){const d=c.indexOf(h);return d!==-1&&c.splice(d,2),this},this.getHandler=function(h){for(let d=0,u=c.length;d<u;d+=2){const f=c[d],m=c[d+1];if(f.global&&(f.lastIndex=0),f.test(h))return m}return null}}};const rX=new xB;let ps=class{constructor(e){this.manager=e!==void 0?e:rX,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(n,r){i.load(e,n,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}};ps.DEFAULT_MATERIAL_NAME="__DEFAULT";const vu={};let Xme=class extends Error{constructor(e,t){super(e),this.response=t}},Is=class extends ps{constructor(e){super(e)}load(e,t,i,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=cp.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(vu[e]!==void 0){vu[e].push({onLoad:t,onProgress:i,onError:n});return}vu[e]=[],vu[e].push({onLoad:t,onProgress:i,onError:n});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=vu[e],d=c.body.getReader(),u=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),f=u?parseInt(u):0,m=f!==0;let g=0;const A=new ReadableStream({start(y){b();function b(){d.read().then(({done:x,value:v})=>{if(x)y.close();else{g+=v.byteLength;const _=new ProgressEvent("progress",{lengthComputable:m,loaded:g,total:f});for(let C=0,S=h.length;C<S;C++){const M=h[C];M.onProgress&&M.onProgress(_)}y.enqueue(v),b()}},x=>{y.error(x)})}}});return new Response(A)}else throw new Xme(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return c.json();default:if(a===void 0)return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),u=d&&d[1]?d[1].toLowerCase():void 0,f=new TextDecoder(u);return c.arrayBuffer().then(m=>f.decode(m))}}}).then(c=>{cp.add(e,c);const h=vu[e];delete vu[e];for(let d=0,u=h.length;d<u;d++){const f=h[d];f.onLoad&&f.onLoad(c)}}).catch(c=>{const h=vu[e];if(h===void 0)throw this.manager.itemError(e),c;delete vu[e];for(let d=0,u=h.length;d<u;d++){const f=h[d];f.onError&&f.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}};class Ome extends ps{constructor(e){super(e)}load(e,t,i,n){const r=this,o=new Is(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){n?n(l):console.error(l),r.manager.itemError(e)}},i,n)}parse(e){const t=[];for(let i=0;i<e.length;i++){const n=Ba.parse(e[i]);t.push(n)}return t}}class Zme extends ps{constructor(e){super(e)}load(e,t,i,n){const r=this,o=[],a=new Fd,l=new Is(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(r.withCredentials);let c=0;function h(d){l.load(e[d],function(u){const f=r.parse(u,!0);o[d]={width:f.width,height:f.height,format:f.format,mipmaps:f.mipmaps},c+=1,c===6&&(f.mipmapCount===1&&(a.minFilter=Ot),a.image=o,a.format=f.format,a.needsUpdate=!0,t&&t(a))},i,n)}if(Array.isArray(e))for(let d=0,u=e.length;d<u;++d)h(d);else l.load(e,function(d){const u=r.parse(d,!0);if(u.isCubemap){const f=u.mipmaps.length/u.mipmapCount;for(let m=0;m<f;m++){o[m]={mipmaps:[]};for(let g=0;g<u.mipmapCount;g++)o[m].mipmaps.push(u.mipmaps[m*u.mipmapCount+g]),o[m].format=u.format,o[m].width=u.width,o[m].height=u.height}a.image=o}else a.image.width=u.width,a.image.height=u.height,a.mipmaps=u.mipmaps;u.mipmapCount===1&&(a.minFilter=Ot),a.format=u.format,a.needsUpdate=!0,t&&t(a)},i,n);return a}}let Zw=class extends ps{constructor(e){super(e)}load(e,t,i,n){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=cp.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a=Fw("img");function l(){h(),cp.add(e,this),t&&t(this),r.manager.itemEnd(e)}function c(d){h(),n&&n(d),r.manager.itemError(e),r.manager.itemEnd(e)}function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}};class Wme extends ps{constructor(e){super(e)}load(e,t,i,n){const r=new hA;r.colorSpace=ft;const o=new Zw(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(h){r.images[c]=h,a++,a===6&&(r.needsUpdate=!0,t&&t(r))},void 0,n)}for(let c=0;c<e.length;++c)l(c);return r}}class oX extends ps{constructor(e){super(e)}load(e,t,i,n){const r=this,o=new ir,a=new Is(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,function(l){let c;try{c=r.parse(l)}catch(h){if(n!==void 0)n(h);else{console.error(h);return}}c.image!==void 0?o.image=c.image:c.data!==void 0&&(o.image.width=c.width,o.image.height=c.height,o.image.data=c.data),o.wrapS=c.wrapS!==void 0?c.wrapS:ea,o.wrapT=c.wrapT!==void 0?c.wrapT:ea,o.magFilter=c.magFilter!==void 0?c.magFilter:Ot,o.minFilter=c.minFilter!==void 0?c.minFilter:Ot,o.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(o.colorSpace=c.colorSpace),c.flipY!==void 0&&(o.flipY=c.flipY),c.format!==void 0&&(o.format=c.format),c.type!==void 0&&(o.type=c.type),c.mipmaps!==void 0&&(o.mipmaps=c.mipmaps,o.minFilter=xr),c.mipmapCount===1&&(o.minFilter=Ot),c.generateMipmaps!==void 0&&(o.generateMipmaps=c.generateMipmaps),o.needsUpdate=!0,t&&t(o,c)},i,n),o}}let Mh=class extends ps{constructor(e){super(e)}load(e,t,i,n){const r=new si,o=new Zw(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){r.image=a,r.needsUpdate=!0,t!==void 0&&t(r)},i,n),r}},Tm=class extends ye{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ge(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}};class vB extends Tm{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ye.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ge(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const ek=new ce,gH=new T,AH=new T;let aX=class{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Q(512,512),this.map=null,this.mapPass=null,this.matrix=new ce,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new H0,this._frameExtents=new Q(1,1),this._viewportCount=1,this._viewports=[new Je(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;gH.setFromMatrixPosition(e.matrixWorld),t.position.copy(gH),AH.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(AH),t.updateMatrixWorld(),ek.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ek),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(ek)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},Hme=class extends aX{constructor(){super(new Xt(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=fx*2*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||n!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},pA=class extends Tm{constructor(e,t,i=0,n=Math.PI/3,r=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ye.DEFAULT_UP),this.updateMatrix(),this.target=new ye,this.distance=i,this.angle=n,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new Hme}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};const yH=new ce,Jv=new T,tk=new T;let Qme=class extends aX{constructor(){super(new Xt(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Q(4,2),this._viewportCount=6,this._viewports=[new Je(2,1,1,1),new Je(0,1,1,1),new Je(3,1,1,1),new Je(1,1,1,1),new Je(3,0,1,1),new Je(1,0,1,1)],this._cubeDirections=[new T(1,0,0),new T(-1,0,0),new T(0,0,1),new T(0,0,-1),new T(0,1,0),new T(0,-1,0)],this._cubeUps=[new T(0,1,0),new T(0,1,0),new T(0,1,0),new T(0,1,0),new T(0,0,1),new T(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Jv.setFromMatrixPosition(e.matrixWorld),i.position.copy(Jv),tk.copy(i.position),tk.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(tk),i.updateMatrixWorld(),n.makeTranslation(-Jv.x,-Jv.y,-Jv.z),yH.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yH)}},dm=class extends Tm{constructor(e,t,i=0,n=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new Qme}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},Kme=class extends aX{constructor(){super(new zh(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},um=class extends Tm{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ye.DEFAULT_UP),this.updateMatrix(),this.target=new ye,this.shadow=new Kme}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};class T1 extends Tm{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class lX extends Tm{constructor(e,t,i=10,n=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class H8{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new T)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,n=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*n),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],1.092548*(i*n)),t.addScaledVector(o[5],1.092548*(n*r)),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],1.092548*(i*r)),t.addScaledVector(o[8],.546274*(i*i-n*n)),t}getIrradianceAt(e,t){const i=e.x,n=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*n),t.addScaledVector(o[2],2*.511664*r),t.addScaledVector(o[3],2*.511664*i),t.addScaledVector(o[4],2*.429043*i*n),t.addScaledVector(o[5],2*.429043*n*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],2*.429043*i*r),t.addScaledVector(o[8],.429043*(i*i-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(e,t+n*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(e,t+n*3);return e}static getBasisAt(e,t){const i=e.x,n=e.y,r=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*r,t[3]=.488603*i,t[4]=1.092548*i*n,t[5]=1.092548*n*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*i*r,t[8]=.546274*(i*i-n*n)}}class cX extends Tm{constructor(e=new H8,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class E1 extends ps{constructor(e){super(e),this.textures={}}load(e,t,i,n){const r=this,o=new Is(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){n?n(l):console.error(l),r.manager.itemError(e)}},i,n)}parse(e){const t=this.textures;function i(r){return t[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),t[r]}const n=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(n.uuid=e.uuid),e.name!==void 0&&(n.name=e.name),e.color!==void 0&&n.color!==void 0&&n.color.setHex(e.color),e.roughness!==void 0&&(n.roughness=e.roughness),e.metalness!==void 0&&(n.metalness=e.metalness),e.sheen!==void 0&&(n.sheen=e.sheen),e.sheenColor!==void 0&&(n.sheenColor=new ge().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(n.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&n.emissive!==void 0&&n.emissive.setHex(e.emissive),e.specular!==void 0&&n.specular!==void 0&&n.specular.setHex(e.specular),e.specularIntensity!==void 0&&(n.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&n.specularColor!==void 0&&n.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(n.shininess=e.shininess),e.clearcoat!==void 0&&(n.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(n.dispersion=e.dispersion),e.iridescence!==void 0&&(n.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(n.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(n.transmission=e.transmission),e.thickness!==void 0&&(n.thickness=e.thickness),e.attenuationDistance!==void 0&&(n.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&n.attenuationColor!==void 0&&n.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(n.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(n.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(n.fog=e.fog),e.flatShading!==void 0&&(n.flatShading=e.flatShading),e.blending!==void 0&&(n.blending=e.blending),e.combine!==void 0&&(n.combine=e.combine),e.side!==void 0&&(n.side=e.side),e.shadowSide!==void 0&&(n.shadowSide=e.shadowSide),e.opacity!==void 0&&(n.opacity=e.opacity),e.transparent!==void 0&&(n.transparent=e.transparent),e.alphaTest!==void 0&&(n.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(n.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(n.depthFunc=e.depthFunc),e.depthTest!==void 0&&(n.depthTest=e.depthTest),e.depthWrite!==void 0&&(n.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(n.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(n.blendSrc=e.blendSrc),e.blendDst!==void 0&&(n.blendDst=e.blendDst),e.blendEquation!==void 0&&(n.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(n.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(n.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(n.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&n.blendColor!==void 0&&n.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(n.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(n.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(n.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(n.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(n.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(n.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(n.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(n.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(n.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(n.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(n.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(n.rotation=e.rotation),e.linewidth!==void 0&&(n.linewidth=e.linewidth),e.dashSize!==void 0&&(n.dashSize=e.dashSize),e.gapSize!==void 0&&(n.gapSize=e.gapSize),e.scale!==void 0&&(n.scale=e.scale),e.polygonOffset!==void 0&&(n.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(n.dithering=e.dithering),e.alphaToCoverage!==void 0&&(n.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(n.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(n.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(n.visible=e.visible),e.toneMapped!==void 0&&(n.toneMapped=e.toneMapped),e.userData!==void 0&&(n.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const r in e.uniforms){const o=e.uniforms[r];switch(n.uniforms[r]={},o.type){case"t":n.uniforms[r].value=i(o.value);break;case"c":n.uniforms[r].value=new ge().setHex(o.value);break;case"v2":n.uniforms[r].value=new Q().fromArray(o.value);break;case"v3":n.uniforms[r].value=new T().fromArray(o.value);break;case"v4":n.uniforms[r].value=new Je().fromArray(o.value);break;case"m3":n.uniforms[r].value=new ei().fromArray(o.value);break;case"m4":n.uniforms[r].value=new ce().fromArray(o.value);break;default:n.uniforms[r].value=o.value}}if(e.defines!==void 0&&(n.defines=e.defines),e.vertexShader!==void 0&&(n.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(n.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(n.glslVersion=e.glslVersion),e.extensions!==void 0)for(const r in e.extensions)n.extensions[r]=e.extensions[r];if(e.lights!==void 0&&(n.lights=e.lights),e.clipping!==void 0&&(n.clipping=e.clipping),e.size!==void 0&&(n.size=e.size),e.sizeAttenuation!==void 0&&(n.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(n.map=i(e.map)),e.matcap!==void 0&&(n.matcap=i(e.matcap)),e.alphaMap!==void 0&&(n.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(n.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(n.bumpScale=e.bumpScale),e.normalMap!==void 0&&(n.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(n.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),n.normalScale=new Q().fromArray(r)}return e.displacementMap!==void 0&&(n.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(n.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(n.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(n.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(n.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(n.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(n.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(n.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(n.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(n.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(n.envMap=i(e.envMap)),e.envMapRotation!==void 0&&n.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(n.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(n.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(n.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(n.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(n.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(n.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(n.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(n.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(n.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(n.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(n.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(n.clearcoatNormalScale=new Q().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(n.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(n.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(n.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(n.thicknessMap=i(e.thicknessMap)),e.anisotropyMap!==void 0&&(n.anisotropyMap=i(e.anisotropyMap)),e.sheenColorMap!==void 0&&(n.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(n.sheenRoughnessMap=i(e.sheenRoughnessMap)),n}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return E1.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:M1,SpriteMaterial:_1,RawShaderMaterial:gB,ShaderMaterial:Ht,PointsMaterial:Td,MeshPhysicalMaterial:To,MeshStandardMaterial:Us,MeshPhongMaterial:Of,MeshToonMaterial:tX,MeshNormalMaterial:I1,MeshLambertMaterial:AB,MeshDepthMaterial:v1,MeshDistanceMaterial:FU,MeshBasicMaterial:ii,MeshMatcapMaterial:iX,LineDashedMaterial:yB,LineBasicMaterial:_n,Material:Yt};return new t[e]}}let Vd=class{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}};class _B extends It{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Q8 extends ps{constructor(e){super(e)}load(e,t,i,n){const r=this,o=new Is(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){n?n(l):console.error(l),r.manager.itemError(e)}},i,n)}parse(e){const t={},i={};function n(f,m){if(t[m]!==void 0)return t[m];const A=f.interleavedBuffers[m],y=r(f,A.buffer),b=xb(A.type,y),x=new Hx(b,A.stride);return x.uuid=A.uuid,t[m]=x,x}function r(f,m){if(i[m]!==void 0)return i[m];const A=f.arrayBuffers[m],y=new Uint32Array(A).buffer;return i[m]=y,y}const o=e.isInstancedBufferGeometry?new _B:new It,a=e.data.index;if(a!==void 0){const f=xb(a.type,a.array);o.setIndex(new dt(f,1))}const l=e.data.attributes;for(const f in l){const m=l[f];let g;if(m.isInterleavedBufferAttribute){const A=n(e.data,m.data);g=new Ma(A,m.itemSize,m.offset,m.normalized)}else{const A=xb(m.type,m.array),y=m.isInstancedBufferAttribute?$o:dt;g=new y(A,m.itemSize,m.normalized)}m.name!==void 0&&(g.name=m.name),m.usage!==void 0&&g.setUsage(m.usage),o.setAttribute(f,g)}const c=e.data.morphAttributes;if(c)for(const f in c){const m=c[f],g=[];for(let A=0,y=m.length;A<y;A++){const b=m[A];let x;if(b.isInterleavedBufferAttribute){const v=n(e.data,b.data);x=new Ma(v,b.itemSize,b.offset,b.normalized)}else{const v=xb(b.type,b.array);x=new dt(v,b.itemSize,b.normalized)}b.name!==void 0&&(x.name=b.name),g.push(x)}o.morphAttributes[f]=g}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const d=e.data.groups||e.data.drawcalls||e.data.offsets;if(d!==void 0)for(let f=0,m=d.length;f!==m;++f){const g=d[f];o.addGroup(g.start,g.count,g.materialIndex)}const u=e.data.boundingSphere;if(u!==void 0){const f=new T;u.center!==void 0&&f.fromArray(u.center),o.boundingSphere=new Vn(f,u.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class K8 extends ps{constructor(e){super(e)}load(e,t,i,n){const r=this,o=this.path===""?Vd.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new Is(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(d){n!==void 0&&n(d),console.error("THREE:ObjectLoader: Can't parse "+e+".",d.message);return}const h=c.metadata;if(h===void 0||h.type===void 0||h.type.toLowerCase()==="geometry"){n!==void 0&&n(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(c,t)},i,n)}async loadAsync(e,t){const i=this,n=this.path===""?Vd.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const r=new Is(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const o=await r.loadAsync(e,t),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(a)}parse(e,t){const i=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),o=this.parseImages(e.images,function(){t!==void 0&&t(c)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,r,l,a,i),h=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,h),this.bindLightTargets(c),t!==void 0){let d=!1;for(const u in o)if(o[u].data instanceof HTMLImageElement){d=!0;break}d===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,i),r=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,n,a,o,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),this.bindLightTargets(l),l}parseShapes(e){const t={};if(e!==void 0)for(let i=0,n=e.length;i<n;i++){const r=new Xf().fromJSON(e[i]);t[r.uuid]=r}return t}parseSkeletons(e,t){const i={},n={};if(t.traverse(function(r){r.isBone&&(n[r.uuid]=r)}),e!==void 0)for(let r=0,o=e.length;r<o;r++){const a=new C1().fromJSON(e[r],n);i[a.uuid]=a}return i}parseGeometries(e,t){const i={};if(e!==void 0){const n=new Q8;for(let r=0,o=e.length;r<o;r++){let a;const l=e[r];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=n.parse(l);break;default:l.type in mH?a=mH[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),i[l.uuid]=a}}return i}parseMaterials(e,t){const i={},n={};if(e!==void 0){const r=new E1;r.setTextures(t);for(let o=0,a=e.length;o<a;o++){const l=e[o];i[l.uuid]===void 0&&(i[l.uuid]=r.parse(l)),n[l.uuid]=i[l.uuid]}}return n}parseAnimations(e){const t={};if(e!==void 0)for(let i=0;i<e.length;i++){const n=e[i],r=Ba.parse(n);t[r.uuid]=r}return t}parseImages(e,t){const i=this,n={};let r;function o(l){return i.manager.itemStart(l),r.load(l,function(){i.manager.itemEnd(l)},void 0,function(){i.manager.itemError(l),i.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const c=l,h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:i.resourcePath+c;return o(h)}else return l.data?{data:xb(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new xB(t);r=new Zw(l),r.setCrossOrigin(this.crossOrigin);for(let c=0,h=e.length;c<h;c++){const d=e[c],u=d.url;if(Array.isArray(u)){const f=[];for(let m=0,g=u.length;m<g;m++){const A=u[m],y=a(A);y!==null&&(y instanceof HTMLImageElement?f.push(y):f.push(new ir(y.data,y.width,y.height)))}n[d.uuid]=new ap(f)}else{const f=a(d.url);n[d.uuid]=new ap(f)}}}return n}async parseImagesAsync(e){const t=this,i={};let n;async function r(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await n.loadAsync(l)}else return o.data?{data:xb(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){n=new Zw(this.manager),n.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const l=e[o],c=l.url;if(Array.isArray(c)){const h=[];for(let d=0,u=c.length;d<u;d++){const f=c[d],m=await r(f);m!==null&&(m instanceof HTMLImageElement?h.push(m):h.push(new ir(m.data,m.width,m.height)))}i[l.uuid]=new ap(h)}else{const h=await r(l.url);i[l.uuid]=new ap(h)}}}return i}parseTextures(e,t){function i(r,o){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),o[r])}const n={};if(e!==void 0)for(let r=0,o=e.length;r<o;r++){const a=e[r];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=t[a.image],c=l.data;let h;Array.isArray(c)?(h=new hA,c.length===6&&(h.needsUpdate=!0)):(c&&c.data?h=new ir:h=new si,c&&(h.needsUpdate=!0)),h.source=l,h.uuid=a.uuid,a.name!==void 0&&(h.name=a.name),a.mapping!==void 0&&(h.mapping=i(a.mapping,Yme)),a.channel!==void 0&&(h.channel=a.channel),a.offset!==void 0&&h.offset.fromArray(a.offset),a.repeat!==void 0&&h.repeat.fromArray(a.repeat),a.center!==void 0&&h.center.fromArray(a.center),a.rotation!==void 0&&(h.rotation=a.rotation),a.wrap!==void 0&&(h.wrapS=i(a.wrap[0],bH),h.wrapT=i(a.wrap[1],bH)),a.format!==void 0&&(h.format=a.format),a.internalFormat!==void 0&&(h.internalFormat=a.internalFormat),a.type!==void 0&&(h.type=a.type),a.colorSpace!==void 0&&(h.colorSpace=a.colorSpace),a.minFilter!==void 0&&(h.minFilter=i(a.minFilter,xH)),a.magFilter!==void 0&&(h.magFilter=i(a.magFilter,xH)),a.anisotropy!==void 0&&(h.anisotropy=a.anisotropy),a.flipY!==void 0&&(h.flipY=a.flipY),a.generateMipmaps!==void 0&&(h.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(h.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(h.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(h.compareFunction=a.compareFunction),a.userData!==void 0&&(h.userData=a.userData),n[a.uuid]=h}return n}parseObject(e,t,i,n,r){let o;function a(u){return t[u]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",u),t[u]}function l(u){if(u!==void 0){if(Array.isArray(u)){const f=[];for(let m=0,g=u.length;m<g;m++){const A=u[m];i[A]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",A),f.push(i[A])}return f}return i[u]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",u),i[u]}}function c(u){return n[u]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",u),n[u]}let h,d;switch(e.type){case"Scene":o=new sr,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new ge(e.background):o.background=c(e.background)),e.environment!==void 0&&(o.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new sB(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new nB(e.fog.color,e.fog.density)),e.fog.name!==""&&(o.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&o.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(o.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&o.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":o=new Xt(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new zh(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new T1(e.color,e.intensity);break;case"DirectionalLight":o=new um(e.color,e.intensity),o.target=e.target||"";break;case"PointLight":o=new dm(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new lX(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new pA(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),o.target=e.target||"";break;case"HemisphereLight":o=new vB(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new cX().fromJSON(e);break;case"SkinnedMesh":h=a(e.geometry),d=l(e.material),o=new ol(h,d),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":h=a(e.geometry),d=l(e.material),o=new fe(h,d);break;case"InstancedMesh":h=a(e.geometry),d=l(e.material);const u=e.count,f=e.instanceMatrix,m=e.instanceColor;o=new XU(h,d,u),o.instanceMatrix=new $o(new Float32Array(f.array),16),m!==void 0&&(o.instanceColor=new $o(new Float32Array(m.array),m.itemSize));break;case"BatchedMesh":h=a(e.geometry),d=l(e.material),o=new Vw(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,d),o.geometry=h,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._visibility=e.visibility,o._active=e.active,o._bounds=e.bounds.map(g=>{const A=new oi;A.min.fromArray(g.boxMin),A.max.fromArray(g.boxMax);const y=new Vn;return y.radius=g.sphereRadius,y.center.fromArray(g.sphereCenter),{boxInitialized:g.boxInitialized,box:A,sphereInitialized:g.sphereInitialized,sphere:y}}),o._maxInstanceCount=e.maxInstanceCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._geometryCount=e.geometryCount,o._matricesTexture=c(e.matricesTexture.uuid),e.colorsTexture!==void 0&&(o._colorsTexture=c(e.colorsTexture.uuid));break;case"LOD":o=new UU;break;case"Line":o=new ts(a(e.geometry),l(e.material));break;case"LineLoop":o=new OU(a(e.geometry),l(e.material));break;case"LineSegments":o=new sa(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new Hb(a(e.geometry),l(e.material));break;case"Sprite":o=new zU(l(e.material));break;case"Group":o=new Ms;break;case"Bone":o=new Q0;break;default:o=new ye}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(o.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const u=e.children;for(let f=0;f<u.length;f++)o.add(this.parseObject(u[f],t,i,n,r))}if(e.animations!==void 0){const u=e.animations;for(let f=0;f<u.length;f++){const m=u[f];o.animations.push(r[m])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const u=e.levels;for(let f=0;f<u.length;f++){const m=u[f],g=o.getObjectByProperty("uuid",m.object);g!==void 0&&o.addLevel(g,m.distance,m.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const n=t[i.skeleton];n===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(n,i.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const i=t.target,n=e.getObjectByProperty("uuid",i);n!==void 0?t.target=n:t.target=new ye}})}}const Yme={UVMapping:H2,CubeReflectionMapping:jl,CubeRefractionMapping:zc,EquirectangularReflectionMapping:wo,EquirectangularRefractionMapping:am,CubeUVReflectionMapping:cA},bH={RepeatWrapping:Mo,ClampToEdgeWrapping:ea,MirroredRepeatWrapping:Sp},xH={NearestFilter:qt,NearestMipmapNearestFilter:g1,NearestMipmapLinearFilter:Id,LinearFilter:Ot,LinearMipmapNearestFilter:mp,LinearMipmapLinearFilter:xr};let Y8=class extends ps{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=cp.get(e);if(o!==void 0){if(r.manager.itemStart(e),o.then){o.then(c=>{t&&t(c),r.manager.itemEnd(e)}).catch(c=>{n&&n(c)});return}return setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(c){return cp.add(e,c),t&&t(c),r.manager.itemEnd(e),c}).catch(function(c){n&&n(c),cp.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)});cp.add(e,l),r.manager.itemStart(e)}},ZI;class CB{static getContext(){return ZI===void 0&&(ZI=new(window.AudioContext||window.webkitAudioContext)),ZI}static setContext(e){ZI=e}}class ML extends ps{constructor(e){super(e)}load(e,t,i,n){const r=this,o=new Is(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const c=l.slice(0);CB.getContext().decodeAudioData(c,function(d){t(d)}).catch(a)}catch(c){a(c)}},i,n);function a(l){n?n(l):console.error(l),r.manager.itemError(e)}}}const vH=new ce,_H=new ce,dg=new ce;class hX{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Xt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Xt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,dg.copy(e.projectionMatrix);const n=t.eyeSep/2,r=n*t.near/t.focus,o=t.near*Math.tan(x0*t.fov*.5)/t.zoom;let a,l;_H.elements[12]=-n,vH.elements[12]=n,a=-o*t.aspect+r,l=o*t.aspect+r,dg.elements[0]=2*t.near/(l-a),dg.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(dg),a=-o*t.aspect-r,l=o*t.aspect-r,dg.elements[0]=2*t.near/(l-a),dg.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(dg)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(_H),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(vH)}}let dX=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=CH(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=CH();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function CH(){return performance.now()}const jh=new T,wH=new Ve,Jme=new T,ug=new T;let J8=class extends ye{constructor(){super(),this.type="AudioListener",this.context=CB.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new dX}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(jh,wH,Jme),!(!Number.isFinite(jh.x)||!Number.isFinite(jh.y)||!Number.isFinite(jh.z)))if(ug.set(0,0,-1).applyQuaternion(wH),t.positionX){const n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(jh.x,n),t.positionY.linearRampToValueAtTime(jh.y,n),t.positionZ.linearRampToValueAtTime(jh.z,n),t.forwardX.linearRampToValueAtTime(ug.x,n),t.forwardY.linearRampToValueAtTime(ug.y,n),t.forwardZ.linearRampToValueAtTime(ug.z,n),t.upX.linearRampToValueAtTime(i.x,n),t.upY.linearRampToValueAtTime(i.y,n),t.upZ.linearRampToValueAtTime(i.z,n)}else t.setPosition(jh.x,jh.y,jh.z),t.setOrientation(ug.x,ug.y,ug.z,i.x,i.y,i.z)}},uX=class extends ye{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||(this.buffer?this.buffer.duration:Number.MAX_VALUE))),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}};const pg=new T,SH=new Ve,jme=new T,fg=new T;class j8 extends uX{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(pg,SH,jme),fg.set(0,0,1).applyQuaternion(SH);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(pg.x,i),t.positionY.linearRampToValueAtTime(pg.y,i),t.positionZ.linearRampToValueAtTime(pg.z,i),t.orientationX.linearRampToValueAtTime(fg.x,i),t.orientationY.linearRampToValueAtTime(fg.y,i),t.orientationZ.linearRampToValueAtTime(fg.z,i)}else t.setPosition(pg.x,pg.y,pg.z),t.setOrientation(fg.x,fg.y,fg.z)}}class qme{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class q8{constructor(e,t,i){this.binding=e,this.valueSize=i;let n,r,o;switch(t){case"quaternion":n=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:n=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,n=this.valueSize,r=e*n+n;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==n;++a)i[r+a]=i[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(i,r,0,a,n)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,n=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const l=t*this._origIndex;this._mixBufferRegion(i,n,l,1-r,t)}o>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(i[l]!==i[l+t]){a.setValue(i,n);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let r=i,o=n;r!==o;++r)t[r]=t[n+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,r){if(n>=.5)for(let o=0;o!==r;++o)e[t+o]=e[i+o]}_slerp(e,t,i,n){Ve.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,r){const o=this._workIndex*r;Ve.multiplyQuaternionsFlat(e,o,e,t,e,i),Ve.slerpFlat(e,t,e,t,e,o,n)}_lerp(e,t,i,n,r){const o=1-n;for(let a=0;a!==r;++a){const l=t+a;e[l]=e[l]*o+e[i+a]*n}}_lerpAdditive(e,t,i,n,r){for(let o=0;o!==r;++o){const a=t+o;e[a]=e[a]+e[i+o]*n}}}const pX="\\[\\]\\.:\\/",$me=new RegExp("["+pX+"]","g"),fX="[^"+pX+"]",ege="[^"+pX.replace("\\.","")+"]",tge=/((?:WC+[\/:])*)/.source.replace("WC",fX),ige=/(WCOD+)?/.source.replace("WCOD",ege),nge=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",fX),sge=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",fX),rge=new RegExp("^"+tge+ige+nge+sge+"$"),oge=["material","materials","bones","map"];let age=class{constructor(e,t,i){const n=i||di.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];n!==void 0&&n.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},di=class eb{constructor(e,t,i){this.path=t,this.parsedPath=i||eb.parseTrackName(t),this.node=eb.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new eb.Composite(e,t,i):new eb(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace($me,"")}static parseTrackName(e){const t=rge.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const r=i.nodeName.substring(n+1);oge.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(r,o){for(let a=0;a<r.length;a++){const l=r[a];if(!o&&(l.name===t||l.uuid===t))return l;if(o&&l.userData&&l.userData.name===t)return l;const c=i(l.children,o);if(c)return c}return null},n=i(e.children);if(n)return n;{const r=i(e.children,!0);if(r)return r}}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let r=t.propertyIndex;if(e||(e=eb.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[n];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(n==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};di.Composite=age;di.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};di.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};di.prototype.GetterByBindingType=[di.prototype._getValue_direct,di.prototype._getValue_array,di.prototype._getValue_arrayElement,di.prototype._getValue_toArray];di.prototype.SetterByBindingTypeAndVersioning=[[di.prototype._setValue_direct,di.prototype._setValue_direct_setNeedsUpdate,di.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[di.prototype._setValue_array,di.prototype._setValue_array_setNeedsUpdate,di.prototype._setValue_array_setMatrixWorldNeedsUpdate],[di.prototype._setValue_arrayElement,di.prototype._setValue_arrayElement_setNeedsUpdate,di.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[di.prototype._setValue_fromArray,di.prototype._setValue_fromArray_setNeedsUpdate,di.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class lge{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Hl(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,n=arguments.length;i!==n;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,n=this._parsedPaths,r=this._bindings,o=r.length;let a,l=e.length,c=this.nCachedObjects_;for(let h=0,d=arguments.length;h!==d;++h){const u=arguments[h],f=u.uuid;let m=t[f];if(m===void 0){m=l++,t[f]=m,e.push(u);for(let g=0,A=o;g!==A;++g)r[g].push(new di(u,i[g],n[g]))}else if(m<c){a=e[m];const g=--c,A=e[g];t[A.uuid]=m,e[m]=A,t[f]=g,e[g]=u;for(let y=0,b=o;y!==b;++y){const x=r[y],v=x[g];let _=x[m];x[m]=v,_===void 0&&(_=new di(u,i[y],n[y])),x[g]=_}}else e[m]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],c=l.uuid,h=t[c];if(h!==void 0&&h>=r){const d=r++,u=e[d];t[u.uuid]=h,e[h]=u,t[c]=d,e[d]=l;for(let f=0,m=n;f!==m;++f){const g=i[f],A=g[d],y=g[h];g[h]=A,g[d]=y}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_,o=e.length;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],h=c.uuid,d=t[h];if(d!==void 0)if(delete t[h],d<r){const u=--r,f=e[u],m=--o,g=e[m];t[f.uuid]=d,e[d]=f,t[g.uuid]=u,e[u]=g,e.pop();for(let A=0,y=n;A!==y;++A){const b=i[A],x=b[u],v=b[m];b[d]=x,b[u]=v,b.pop()}}else{const u=--o,f=e[u];u>0&&(t[f.uuid]=d),e[d]=f,e.pop();for(let m=0,g=n;m!==g;++m){const A=i[m];A[d]=A[u],A.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const i=this._bindingsIndicesByPath;let n=i[e];const r=this._bindings;if(n!==void 0)return r[n];const o=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,h=this.nCachedObjects_,d=new Array(c);n=r.length,i[e]=n,o.push(e),a.push(t),r.push(d);for(let u=h,f=l.length;u!==f;++u){const m=l[u];d[u]=new di(m,e,t)}return d}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const n=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],c=e[a];t[c]=i,o[i]=l,o.pop(),r[i]=r[a],r.pop(),n[i]=n[a],n.pop()}}}class $8{constructor(e,t,i=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;const r=t.tracks,o=r.length,a=new Array(o),l={endingStart:r0,endingEnd:r0};for(let c=0;c!==o;++c){const h=r[c].createInterpolant(null);a[c]=h,h.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=EU,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const n=this._clip.duration,r=e._clip.duration,o=r/n,a=n/r;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const n=this._mixer,r=n.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=r,l[1]=r+i,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const l=(e-r)*i;l<0||i===0?t=0:(this._startTime=null,t=i*l)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case RU:for(let h=0,d=l.length;h!==d;++h)l[h].evaluate(o),c[h].accumulateAdditive(a);break;case J2:default:for(let h=0,d=l.length;h!==d;++h)l[h].evaluate(o),c[h].accumulate(n,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let n=this.time+e,r=this._loopCount;const o=i===Xj;if(e===0)return r===-1?n:o&&(r&1)===1?t-n:n;if(i===Pw){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),n>=t||n<0){const a=Math.floor(n/t);n-=t*a,r+=Math.abs(a);const l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=n;if(o&&(r&1)===1)return t-n}return n}_setEndings(e,t,i){const n=this._interpolantSettings;i?(n.endingStart=o0,n.endingEnd=o0):(e?n.endingStart=this.zeroSlopeAtStart?o0:r0:n.endingStart=Gw,t?n.endingEnd=this.zeroSlopeAtEnd?o0:r0:n.endingEnd=Gw)}_scheduleFading(e,t,i){const n=this._mixer,r=n.time;let o=this._weightInterpolant;o===null&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,l[0]=t,a[1]=r+e,l[1]=i,this}}const cge=new Float32Array(1);class wB extends Mr{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,o=e._propertyBindings,a=e._interpolants,l=i.uuid,c=this._bindingsByRootAndName;let h=c[l];h===void 0&&(h={},c[l]=h);for(let d=0;d!==r;++d){const u=n[d],f=u.name;let m=h[f];if(m!==void 0)++m.referenceCount,o[d]=m;else{if(m=o[d],m!==void 0){m._cacheIndex===null&&(++m.referenceCount,this._addInactiveBinding(m,l,f));continue}const g=t&&t._propertyBindings[d].binding.parsedPath;m=new q8(di.create(i,f,g),u.ValueTypeName,u.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,l,f),o[d]=m}a[d].resultBuffer=m.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,i)}const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const r=t[i];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const r=t[i];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const n=this._actions,r=this._actionsByClip;let o=r[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=n.length,n.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,a=o[r],l=a.knownActions,c=l[l.length-1],h=e._byClipCacheIndex;c._byClipCacheIndex=h,l[h]=c,l.pop(),e._byClipCacheIndex=null;const d=a.actionByRoot,u=(e._localRoot||this._root).uuid;delete d[u],l.length===0&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const r=t[i];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){const n=this._bindingsByRootAndName,r=this._bindings;let o=n[t];o===void 0&&(o={},n[t]=o),o[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,o=this._bindingsByRootAndName,a=o[n],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[r],Object.keys(a).length===0&&delete o[n]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new sX(new Float32Array(2),new Float32Array(2),1,cge),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){const n=t||this._root,r=n.uuid;let o=typeof e=="string"?Ba.findByName(n,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let c=null;if(i===void 0&&(o!==null?i=o.blendMode:i=J2),l!==void 0){const d=l.actionByRoot[r];if(d!==void 0&&d.blendMode===i)return d;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const h=new $8(this,o,t,i);return this._bindAction(h,c),this._addInactiveAction(h,a,r),h}existingAction(e,t){const i=t||this._root,n=i.uuid,r=typeof e=="string"?Ba.findByName(i,e):e,o=r?r.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[n]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==i;++c)t[c]._update(n,e,r,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(r!==void 0){const o=r.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const h=c._cacheIndex,d=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,d._cacheIndex=h,t[h]=d,t.pop(),this._removeInactiveBindingsForAction(c)}delete n[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const o in i){const a=i[o].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const n=this._bindingsByRootAndName,r=n[t];if(r!==void 0)for(const o in r){const a=r[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}let Te=class e6{constructor(e){this.value=e}clone(){return new e6(this.value.clone===void 0?this.value:this.value.clone())}},hge=0;class dge extends Mr{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:hge++}),this.name="",this.usage=px,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let i=0,n=t.length;i<n;i++){const r=Array.isArray(t[i])?t[i]:[t[i]];for(let o=0;o<r.length;o++)this.uniforms.push(r[o].clone())}return this}clone(){return new this.constructor().copy(this)}}class Ww extends Hx{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class uge{constructor(e,t,i,n,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const MH=new ce;let Em=class{constructor(e,t,i=0,n=1/0){this.ray=new Fa(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new ta,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return MH.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(MH),this}intersectObject(e,t=!0,i=[]){return JF(e,this,i,t),i.sort(IH),i}intersectObjects(e,t=!0,i=[]){for(let n=0,r=e.length;n<r;n++)JF(e[n],this,i,t);return i.sort(IH),i}};function IH(s,e){return s.distance-e.distance}function JF(s,e,t,i){let n=!0;if(s.layers.test(e.layers)&&s.raycast(e,t)===!1&&(n=!1),n===!0&&i===!0){const r=s.children;for(let o=0,a=r.length;o<a;o++)JF(r[o],e,t,!0)}}class jF{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(ws(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class pge{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}class mX{constructor(e,t,i,n){mX.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,i,n)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let i=0;i<4;i++)this.elements[i]=e[i+t];return this}set(e,t,i,n){const r=this.elements;return r[0]=e,r[2]=t,r[1]=i,r[3]=n,this}}const TH=new Q;class fge{constructor(e=new Q(1/0,1/0),t=new Q(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=TH.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,TH).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const EH=new T,WI=new T;class Fc{constructor(e=new T,t=new T){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){EH.subVectors(e,this.start),WI.subVectors(this.end,this.start);const i=WI.dot(WI);let r=WI.dot(EH)/i;return t&&(r=ws(r,0,1)),r}closestPointToPoint(e,t,i){const n=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const RH=new T;class mge extends ye{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const i=new It,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,h=a/l*Math.PI*2;n.push(Math.cos(c),Math.sin(c),1,Math.cos(h),Math.sin(h),1)}i.setAttribute("position",new ut(n,3));const r=new _n({fog:!1,toneMapped:!1});this.cone=new sa(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),RH.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(RH),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const qp=new T,HI=new ce,ik=new ce;class gge extends sa{constructor(e){const t=t6(e),i=new It,n=[],r=[],o=new ge(0,0,1),a=new ge(0,1,0);for(let c=0;c<t.length;c++){const h=t[c];h.parent&&h.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}i.setAttribute("position",new ut(n,3)),i.setAttribute("color",new ut(r,3));const l=new _n({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,n=i.getAttribute("position");ik.copy(this.root.matrixWorld).invert();for(let r=0,o=0;r<t.length;r++){const a=t[r];a.parent&&a.parent.isBone&&(HI.multiplyMatrices(ik,a.matrixWorld),qp.setFromMatrixPosition(HI),n.setXYZ(o,qp.x,qp.y,qp.z),HI.multiplyMatrices(ik,a.parent.matrixWorld),qp.setFromMatrixPosition(HI),n.setXYZ(o+1,qp.x,qp.y,qp.z),o+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function t6(s){const e=[];s.isBone===!0&&e.push(s);for(let t=0;t<s.children.length;t++)e.push.apply(e,t6(s.children[t]));return e}class Age extends fe{constructor(e,t,i){const n=new Wc(t,4,2),r=new ii({wireframe:!0,fog:!1,toneMapped:!1});super(n,r),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const yge=new T,LH=new ge,BH=new ge;class bge extends ye{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const n=new lp(t);n.rotateY(Math.PI*.5),this.material=new ii({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=n.getAttribute("position"),o=new Float32Array(r.count*3);n.setAttribute("color",new dt(o,3)),this.add(new fe(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");LH.copy(this.light.color),BH.copy(this.light.groundColor);for(let i=0,n=t.count;i<n;i++){const r=i<n/2?LH:BH;t.setXYZ(i,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(yge.setFromMatrixPosition(this.light.matrixWorld).negate())}}let SB=class extends sa{constructor(e=10,t=10,i=4473924,n=8947848){i=new ge(i),n=new ge(n);const r=t/2,o=e/t,a=e/2,l=[],c=[];for(let u=0,f=0,m=-a;u<=t;u++,m+=o){l.push(-a,0,m,a,0,m),l.push(m,0,-a,m,0,a);const g=u===r?i:n;g.toArray(c,f),f+=3,g.toArray(c,f),f+=3,g.toArray(c,f),f+=3,g.toArray(c,f),f+=3}const h=new It;h.setAttribute("position",new ut(l,3)),h.setAttribute("color",new ut(c,3));const d=new _n({vertexColors:!0,toneMapped:!1});super(h,d),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}};class xge extends sa{constructor(e=10,t=16,i=8,n=64,r=4473924,o=8947848){r=new ge(r),o=new ge(o);const a=[],l=[];if(t>1)for(let d=0;d<t;d++){const u=d/t*(Math.PI*2),f=Math.sin(u)*e,m=Math.cos(u)*e;a.push(0,0,0),a.push(f,0,m);const g=d&1?r:o;l.push(g.r,g.g,g.b),l.push(g.r,g.g,g.b)}for(let d=0;d<i;d++){const u=d&1?r:o,f=e-e/i*d;for(let m=0;m<n;m++){let g=m/n*(Math.PI*2),A=Math.sin(g)*f,y=Math.cos(g)*f;a.push(A,0,y),l.push(u.r,u.g,u.b),g=(m+1)/n*(Math.PI*2),A=Math.sin(g)*f,y=Math.cos(g)*f,a.push(A,0,y),l.push(u.r,u.g,u.b)}}const c=new It;c.setAttribute("position",new ut(a,3)),c.setAttribute("color",new ut(l,3));const h=new _n({vertexColors:!0,toneMapped:!1});super(c,h),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const PH=new T,QI=new T,GH=new T;class i6 extends ye{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let n=new It;n.setAttribute("position",new ut([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new _n({fog:!1,toneMapped:!1});this.lightPlane=new ts(n,r),this.add(this.lightPlane),n=new It,n.setAttribute("position",new ut([0,0,0,0,0,1],3)),this.targetLine=new ts(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),PH.setFromMatrixPosition(this.light.matrixWorld),QI.setFromMatrixPosition(this.light.target.matrixWorld),GH.subVectors(QI,PH),this.lightPlane.lookAt(QI),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(QI),this.targetLine.scale.z=GH.length()}}const KI=new T,vs=new x1;class n6 extends sa{constructor(e){const t=new It,i=new _n({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(m,g){l(m),l(g)}function l(m){n.push(0,0,0),r.push(0,0,0),o[m]===void 0&&(o[m]=[]),o[m].push(n.length/3-1)}t.setAttribute("position",new ut(n,3)),t.setAttribute("color",new ut(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new ge(16755200),h=new ge(16711680),d=new ge(43775),u=new ge(16777215),f=new ge(3355443);this.setColors(c,h,d,u,f)}setColors(e,t,i,n,r){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,n.r,n.g,n.b),a.setXYZ(39,n.r,n.g,n.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,i=1,n=1;vs.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ps("c",t,e,vs,0,0,-1),Ps("t",t,e,vs,0,0,1),Ps("n1",t,e,vs,-i,-n,-1),Ps("n2",t,e,vs,i,-n,-1),Ps("n3",t,e,vs,-i,n,-1),Ps("n4",t,e,vs,i,n,-1),Ps("f1",t,e,vs,-i,-n,1),Ps("f2",t,e,vs,i,-n,1),Ps("f3",t,e,vs,-i,n,1),Ps("f4",t,e,vs,i,n,1),Ps("u1",t,e,vs,i*.7,n*1.1,-1),Ps("u2",t,e,vs,-i*.7,n*1.1,-1),Ps("u3",t,e,vs,0,n*2,-1),Ps("cf1",t,e,vs,-i,0,1),Ps("cf2",t,e,vs,i,0,1),Ps("cf3",t,e,vs,0,-n,1),Ps("cf4",t,e,vs,0,n,1),Ps("cn1",t,e,vs,-i,0,-1),Ps("cn2",t,e,vs,i,0,-1),Ps("cn3",t,e,vs,0,-n,-1),Ps("cn4",t,e,vs,0,n,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ps(s,e,t,i,n,r,o){KI.set(n,r,o).unproject(i);const a=e[s];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,h=a.length;c<h;c++)l.setXYZ(a[c],KI.x,KI.y,KI.z)}}const YI=new oi;class s6 extends sa{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(8*3),r=new It;r.setIndex(new dt(i,1)),r.setAttribute("position",new dt(n,3)),super(r,new _n({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&YI.setFromObject(this.object),YI.isEmpty())return;const t=YI.min,i=YI.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=t.x,r[4]=i.y,r[5]=i.z,r[6]=t.x,r[7]=t.y,r[8]=i.z,r[9]=i.x,r[10]=t.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=t.z,r[15]=t.x,r[16]=i.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=i.x,r[22]=t.y,r[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class gX extends sa{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new It;r.setIndex(new dt(i,1)),r.setAttribute("position",new ut(n,3)),super(r,new _n({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class vge extends ts{constructor(e,t=1,i=16776960){const n=i,r=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new It;o.setAttribute("position",new ut(r,3)),o.computeBoundingSphere(),super(o,new _n({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new It;l.setAttribute("position",new ut(a,3)),l.computeBoundingSphere(),this.add(new fe(l,new ii({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const kH=new T;let JI,nk;class _ge extends ye{constructor(e=new T(0,0,1),t=new T(0,0,0),i=1,n=16776960,r=i*.2,o=r*.2){super(),this.type="ArrowHelper",JI===void 0&&(JI=new It,JI.setAttribute("position",new ut([0,0,0,0,1,0],3)),nk=new Ns(0,.5,1,5,1),nk.translate(0,-.5,0)),this.position.copy(t),this.line=new ts(JI,new _n({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new fe(nk,new ii({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{kH.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(kH,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}let al=class extends sa{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new It;n.setAttribute("position",new ut(t,3)),n.setAttribute("color",new ut(i,3));const r=new _n({vertexColors:!0,toneMapped:!1});super(n,r),this.type="AxesHelper"}setColors(e,t,i){const n=new ge,r=this.geometry.attributes.color.array;return n.set(e),n.toArray(r,0),n.toArray(r,3),n.set(t),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}};class r6{constructor(){this.type="ShapePath",this.color=new ge,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new zw,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,n){return this.currentPath.quadraticCurveTo(e,t,i,n),this}bezierCurveTo(e,t,i,n,r,o){return this.currentPath.bezierCurveTo(e,t,i,n,r,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(y){const b=[];for(let x=0,v=y.length;x<v;x++){const _=y[x],C=new Xf;C.curves=_.curves,b.push(C)}return b}function i(y,b){const x=b.length;let v=!1;for(let _=x-1,C=0;C<x;_=C++){let S=b[_],M=b[C],L=M.x-S.x,w=M.y-S.y;if(Math.abs(w)>Number.EPSILON){if(w<0&&(S=b[C],L=-L,M=b[_],w=-w),y.y<S.y||y.y>M.y)continue;if(y.y===S.y){if(y.x===S.x)return!0}else{const E=w*(y.x-S.x)-L*(y.y-S.y);if(E===0)return!0;if(E<0)continue;v=!v}}else{if(y.y!==S.y)continue;if(M.x<=y.x&&y.x<=S.x||S.x<=y.x&&y.x<=M.x)return!0}}return v}const n=Sh.isClockWise,r=this.subPaths;if(r.length===0)return[];let o,a,l;const c=[];if(r.length===1)return a=r[0],l=new Xf,l.curves=a.curves,c.push(l),c;let h=!n(r[0].getPoints());h=e?!h:h;const d=[],u=[];let f=[],m=0,g;u[m]=void 0,f[m]=[];for(let y=0,b=r.length;y<b;y++)a=r[y],g=a.getPoints(),o=n(g),o=e?!o:o,o?(!h&&u[m]&&m++,u[m]={s:new Xf,p:g},u[m].s.curves=a.curves,h&&m++,f[m]=[]):f[m].push({h:a,p:g[0]});if(!u[0])return t(r);if(u.length>1){let y=!1,b=0;for(let x=0,v=u.length;x<v;x++)d[x]=[];for(let x=0,v=u.length;x<v;x++){const _=f[x];for(let C=0;C<_.length;C++){const S=_[C];let M=!0;for(let L=0;L<u.length;L++)i(S.p,u[L].p)&&(x!==L&&b++,M?(M=!1,d[L].push(S)):y=!0);M&&d[x].push(S)}}b>0&&y===!1&&(f=d)}let A;for(let y=0,b=u.length;y<b;y++){l=u[y].s,c.push(l),A=f[y];for(let x=0,v=A.length;x<v;x++)l.holes.push(A[x].h)}return c}}class MB extends Mr{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}class Cge extends ci{constructor(e=1,t=1,i=1,n={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(e,t,{...n,count:i}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}const wge=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class o6{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=wge,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}getRenderObjectData(e){let t=this.renderObjects.get(e);return t===void 0&&(t={material:this.getMaterialData(e.material),worldMatrix:e.object.matrixWorld.clone()},e.object.center&&(t.center=e.object.center.clone()),e.object.morphTargetInfluences&&(t.morphTargetInfluences=e.object.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),this.renderObjects.set(e,t)),t}containsNode(e){const t=e.material;for(const i in t)if(t[i]&&t[i].isNode)return!0;return e.renderer.nodes.modelViewMatrix!==null||e.renderer.nodes.modelNormalViewMatrix!==null}getMaterialData(e){const t={};for(const i of this.refreshUniforms){const n=e[i];n!=null&&(typeof n=="object"&&n.clone!==void 0?n.isTexture===!0?t[i]={id:n.id,version:n.version}:t[i]=n.clone():t[i]=n)}return t}equals(e){const{object:t,material:i}=e,n=this.getRenderObjectData(e);if(n.worldMatrix.equals(t.matrixWorld)!==!0)return n.worldMatrix.copy(t.matrixWorld),!1;const r=n.material;for(const o in r){const a=r[o],l=i[o];if(a.equals!==void 0){if(a.equals(l)===!1)return a.copy(l),!1}else if(l.isTexture===!0){if(a.id!==l.id||a.version!==l.version)return a.id=l.id,a.version=l.version,!1}else if(a!==l)return r[o]=l,!1}if(n.morphTargetInfluences){let o=!1;for(let a=0;a<n.morphTargetInfluences.length;a++)n.morphTargetInfluences[a]!==t.morphTargetInfluences[a]&&(o=!0);if(o)return!0}return n.center&&n.center.equals(t.center)===!1?(n.center.copy(t.center),!0):(e.bundle!==null&&(n.version=e.bundle.version),!0)}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e))return!0;const{renderId:i}=t;if(this.renderId!==i)return this.renderId=i,!0;const n=e.object.static===!0,r=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;return n||r?!1:this.equals(e)!==!0}}function Hw(s,e=0){let t=3735928559^e,i=1103547991^e;if(s instanceof Array)for(let n=0,r;n<s.length;n++)r=s[n],t=Math.imul(t^r,2654435761),i=Math.imul(i^r,1597334677);else for(let n=0,r;n<s.length;n++)r=s.charCodeAt(n),t=Math.imul(t^r,2654435761),i=Math.imul(i^r,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&i)+(t>>>0)}const a6=s=>Hw(s),l6=s=>Hw(s),AX=(...s)=>Hw(s);function yX(s,e=!1){const t=[];s.isNode===!0&&(t.push(s.id),s=s.getSelf());for(const{property:i,childNode:n}of Qw(s))t.push(t,Hw(i.slice(0,-4)),n.getCacheKey(e));return Hw(t)}function*Qw(s,e=!1){for(const t in s){if(t.startsWith("_")===!0)continue;const i=s[t];if(Array.isArray(i)===!0)for(let n=0;n<i.length;n++){const r=i[n];r&&(r.isNode===!0||e&&typeof r.toJSON=="function")&&(yield{property:t,index:n,childNode:r})}else if(i&&i.isNode===!0)yield{property:t,childNode:i};else if(typeof i=="object")for(const n in i){const r=i[n];r&&(r.isNode===!0||e&&typeof r.toJSON=="function")&&(yield{property:t,index:n,childNode:r})}}}function hp(s){if(s==null)return null;const e=typeof s;return s.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":s.isVector2===!0?"vec2":s.isVector3===!0?"vec3":s.isVector4===!0?"vec4":s.isMatrix3===!0?"mat3":s.isMatrix4===!0?"mat4":s.isColor===!0?"color":s instanceof ArrayBuffer?"ArrayBuffer":null}function bX(s,...e){const t=s?s.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),s==="color"?new ge(...e):t==="vec2"?new Q(...e):t==="vec3"?new T(...e):t==="vec4"?new Je(...e):t==="mat3"?new ei(...e):t==="mat4"?new ce(...e):s==="bool"?e[0]||!1:s==="float"||s==="int"||s==="uint"?e[0]||0:s==="string"?e[0]||"":s==="ArrayBuffer"?vX(e[0]):null}function xX(s){let e="";const t=new Uint8Array(s);for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function vX(s){return Uint8Array.from(atob(s),e=>e.charCodeAt(0)).buffer}var Sge=Object.freeze({__proto__:null,arrayBufferToBase64:xX,base64ToArrayBuffer:vX,getCacheKey:yX,getNodeChildren:Qw,getValueFromType:bX,getValueType:hp,hash:AX,hashArray:l6,hashString:a6});const qF={VERTEX:"vertex",FRAGMENT:"fragment"},Zt={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Mge={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},c6=["fragment","vertex"],$F=["setup","analyze","generate"],eV=[...c6,"compute"],Yx=["x","y","z","w"];let Ige=0,Qt=class extends Mr{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=Zt.NONE,this.updateBeforeType=Zt.NONE,this.updateAfterType=Zt.NONE,this.uuid=Bi.generateUUID(),this.version=0,this._cacheKey=null,this._cacheKeyVersion=0,this.global=!1,this.isNode=!0,Object.defineProperty(this,"id",{value:Ige++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,Zt.FRAME)}onRenderUpdate(e){return this.onUpdate(e,Zt.RENDER)}onObjectUpdate(e){return this.onUpdate(e,Zt.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of Qw(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=yX(this,e),this._cacheKeyVersion=this.version),this._cacheKey}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);let i=0;for(const n of this.getChildren())t["node"+i++]=n;return null}analyze(e){if(e.increaseUsage(this)===1){const i=e.getNodeProperties(this);for(const n of Object.values(i))n&&n.isNode===!0&&n.build(e)}}generate(e,t){const{outputNode:i}=e.getNodeProperties(this);if(i&&i.isNode===!0)return i.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const i=this.getShared(e);if(this!==i)return i.build(e,t);e.addNode(this),e.addChain(this);let n=null;const r=e.getBuildStage();if(r==="setup"){this.updateReference(e);const o=e.getNodeProperties(this);if(o.initialized!==!0){const a=e.stack.nodes.length;o.initialized=!0,o.outputNode=this.setup(e),o.outputNode!==null&&e.stack.nodes.length;for(const l of Object.values(o))l&&l.isNode===!0&&l.build(e)}}else if(r==="analyze")this.analyze(e);else if(r==="generate")if(this.generate.length===1){const a=this.getNodeType(e),l=e.getDataFromNode(this);n=l.snippet,n===void 0?(n=this.generate(e)||"",l.snippet=n):l.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),n=e.format(n,a,t)}else n=this.generate(e,t)||"";return e.removeChain(this),n}getSerializeChildren(){return Qw(this)}serialize(e){const t=this.getSerializeChildren(),i={};for(const{property:n,index:r,childNode:o}of t)r!==void 0?(i[n]===void 0&&(i[n]=Number.isInteger(r)?[]:{}),i[n][r]=o.toJSON(e.meta).uuid):i[n]=o.toJSON(e.meta).uuid;Object.keys(i).length>0&&(e.inputNodes=i)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const i in e.inputNodes)if(Array.isArray(e.inputNodes[i])){const n=[];for(const r of e.inputNodes[i])n.push(t[r]);this[i]=n}else if(typeof e.inputNodes[i]=="object"){const n={};for(const r in e.inputNodes[i]){const o=e.inputNodes[i][r];n[r]=t[o]}this[i]=n}else{const n=e.inputNodes[i];this[i]=t[n]}}}toJSON(e){const{uuid:t,type:i}=this,n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{},nodes:{}});let r=e.nodes[t];r===void 0&&(r={uuid:t,type:i,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},n!==!0&&(e.nodes[r.uuid]=r),this.serialize(r),delete r.meta);function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}if(n){const a=o(e.textures),l=o(e.images),c=o(e.nodes);a.length>0&&(r.textures=a),l.length>0&&(r.images=l),c.length>0&&(r.nodes=c)}return r}};class Rm extends Qt{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.node.build(e),i=this.indexNode.build(e,"uint");return`${t}[ ${i} ]`}}class _X extends Qt{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let i=null;for(const n of this.convertTo.split("|"))(i===null||e.getTypeLength(t)===e.getTypeLength(n))&&(i=n);return i}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const i=this.node,n=this.getNodeType(e),r=i.build(e,n);return e.format(r,n,t)}}class wi extends Qt{static get type(){return"TempNode"}constructor(e){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const n=e.getVectorType(this.getNodeType(e,t)),r=e.getDataFromNode(this);if(r.propertyName!==void 0)return e.format(r.propertyName,n,t);if(n!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,n),a=e.getVarFromNode(this,null,n),l=e.getPropertyName(a);return e.addLineFlowCode(`${l} = ${o}`,this),r.snippet=o,r.propertyName=l,e.format(r.propertyName,n,t)}}return super.build(e,t)}}class h6 extends wi{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,i)=>t+e.getTypeLength(i.getNodeType(e)),0))}generate(e,t){const i=this.getNodeType(e),n=this.nodes,r=e.getComponentType(i),o=[];for(const l of n){let c=l.build(e);const h=e.getComponentType(l.getNodeType(e));h!==r&&(c=e.format(c,h,r)),o.push(c)}const a=`${e.getType(i)}( ${o.join(", ")} )`;return e.format(a,i,t)}}const Tge=Yx.join("");class IL extends Qt{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Yx.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const i=this.node,n=e.getTypeLength(i.getNodeType(e));let r=null;if(n>1){let o=null;this.getVectorLength()>=n&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const l=i.build(e,o);this.components.length===n&&this.components===Tge.slice(0,this.components.length)?r=e.format(l,o,t):r=e.format(`${l}.${this.components}`,this.getNodeType(e),t)}else r=i.build(e,t);return r}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class d6 extends wi{static get type(){return"SetNode"}constructor(e,t,i){super(),this.sourceNode=e,this.components=t,this.targetNode=i}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:i,targetNode:n}=this,r=this.getNodeType(e),o=e.getTypeFromLength(i.length,n.getNodeType(e)),a=n.build(e,o),l=t.build(e,r),c=e.getTypeLength(r),h=[];for(let d=0;d<c;d++){const u=Yx[d];u===i[0]?(h.push(a),d+=i.length-1):h.push(l+"."+u)}return`${e.getType(r)}( ${h.join(", ")} )`}}class Ege extends wi{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:i}=this,n=this.getNodeType(e),r=i.build(e),o=e.getVarFromNode(this),a=e.getPropertyName(o);e.addLineFlowCode(a+" = "+r,this);const l=e.getTypeLength(n),c=[];let h=0;for(let d=0;d<l;d++){const u=Yx[d];u===t[h]?(c.push("1.0 - "+(a+"."+u)),h++):c.push(a+"."+u)}return`${e.getType(n)}( ${c.join(", ")} )`}}class CX extends Qt{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?hp(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=hp(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=xX(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?bX(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}class Hc extends CX{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const i=this.getNodeType(e);return e.format(this.generateConst(e),i,t)}}let gx=null;const Cb=new Map;function Be(s,e){if(Cb.has(s)){console.warn(`Redefinition of method chaining ${s}`);return}if(typeof e!="function")throw new Error(`Node element ${s} is not a function`);Cb.set(s,e)}const u6=s=>s.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),NH=s=>u6(s).split("").sort().join(""),p6={setup(s,e){const t=e.shift();return s(R1(t),...e)},get(s,e,t){if(typeof e=="string"&&s[e]===void 0){if(s.isStackNode!==!0&&e==="assign")return(...i)=>(gx.assign(t,...i),t);if(Cb.has(e)){const i=Cb.get(e);return s.isStackNode?(...n)=>t.add(i(...n)):(...n)=>i(t,...n)}else{if(e==="self")return s;if(e.endsWith("Assign")&&Cb.has(e.slice(0,e.length-6))){const i=Cb.get(e.slice(0,e.length-6));return s.isStackNode?(...n)=>t.assign(n[0],i(...n)):(...n)=>t.assign(i(t,...n))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=u6(e),me(new IL(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=NH(e.slice(3).toLowerCase()),i=>me(new d6(s,e,i));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=NH(e.slice(4).toLowerCase()),()=>me(new Ege(me(s),e));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),me(new IL(s,e));if(/^\d+$/.test(e)===!0)return me(new Rm(t,new Hc(Number(e),"uint")))}}}return Reflect.get(s,e,t)},set(s,e,t,i){return typeof e=="string"&&s[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(i[e].assign(t),!0):Reflect.set(s,e,t,i)}},sk=new WeakMap,DH=new WeakMap,Rge=function(s,e=null){const t=hp(s);if(t==="node"){let i=sk.get(s);return i===void 0&&(i=new Proxy(s,p6),sk.set(s,i),sk.set(i,i)),i}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return me(tV(s,e));if(t==="shader")return ne(s)}return s},Lge=function(s,e=null){for(const t in s)s[t]=me(s[t],e);return s},Bge=function(s,e=null){const t=s.length;for(let i=0;i<t;i++)s[i]=me(s[i],e);return s},Pge=function(s,e=null,t=null,i=null){const n=r=>me(i!==null?Object.assign(r,i):r);return e===null?(...r)=>n(new s(...v0(r))):t!==null?(t=me(t),(...r)=>n(new s(e,...v0(r),t))):(...r)=>n(new s(e,...v0(r)))},Gge=function(s,...e){return me(new s(...v0(e)))};class kge extends Qt{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}call(e){const{shaderNode:t,inputNodes:i}=this,n=e.getNodeProperties(t);if(n.onceOutput)return n.onceOutput;let r=null;if(t.layout){let o=DH.get(e.constructor);o===void 0&&(o=new WeakMap,DH.set(e.constructor,o));let a=o.get(t);a===void 0&&(a=me(e.buildFunctionNode(t)),o.set(t,a)),e.currentFunctionNode!==null&&e.currentFunctionNode.includes.push(a),r=me(a.call(i))}else{const o=t.jsFunc,a=i!==null?o(i,e):o(e);r=me(a)}return t.once&&(n.onceOutput=r),r}getOutputNode(e){const t=e.getNodeProperties(this);return t.outputNode===null&&(t.outputNode=this.setupOutput(e)),t.outputNode}setup(e){return this.getOutputNode(e)}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){return this.getOutputNode(e).build(e,t)}}class Nge extends Qt{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(e=null){return R1(e),me(new kge(this,e))}setup(){return this.call()}}const Dge=[!1,!0],Fge=[0,1,2,3],Vge=[-1,-2],f6=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],wX=new Map;for(const s of Dge)wX.set(s,new Hc(s));const SX=new Map;for(const s of Fge)SX.set(s,new Hc(s,"uint"));const MX=new Map([...SX].map(s=>new Hc(s.value,"int")));for(const s of Vge)MX.set(s,new Hc(s,"int"));const IB=new Map([...MX].map(s=>new Hc(s.value)));for(const s of f6)IB.set(s,new Hc(s));for(const s of f6)IB.set(-s,new Hc(-s));const TB={bool:wX,uint:SX,ints:MX,float:IB},FH=new Map([...wX,...IB]),tV=(s,e)=>FH.has(s)?FH.get(s):s.isNode===!0?s:new Hc(s,e),zge=s=>{try{return s.getNodeType()}catch{return}},or=function(s,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(s)&&t.every(n=>typeof n!="object"))&&(t=[bX(s,...t)]),t.length===1&&e!==null&&e.has(t[0]))return me(e.get(t[0]));if(t.length===1){const n=tV(t[0],s);return zge(n)===s?me(n):me(new _X(n,s))}const i=t.map(n=>tV(n));return me(new h6(i,s))}},Kw=s=>typeof s=="object"&&s!==null?s.value:s,m6=s=>s!=null?s.nodeType||s.convertTo||(typeof s=="string"?s:null):null;function VC(s,e){return new Proxy(new Nge(s,e),p6)}const me=(s,e=null)=>Rge(s,e),R1=(s,e=null)=>new Lge(s,e),v0=(s,e=null)=>new Bge(s,e),we=(...s)=>new Pge(...s),tt=(...s)=>new Gge(...s),ne=(s,e)=>{const t=new VC(s,e),i=(...n)=>{let r;return R1(n),n[0]&&n[0].isNode?r=[...n]:r=n[0],t.call(r)};return i.shaderNode=t,i.setLayout=n=>(t.setLayout(n),i),i.once=()=>(t.once=!0,i),i},Uge=(...s)=>(console.warn("TSL.ShaderNode: tslFn() has been renamed to Fn()."),ne(...s));Be("toGlobal",s=>(s.global=!0,s));const Yw=s=>{gx=s},IX=()=>gx,Rt=(...s)=>gx.If(...s);function g6(s){return gx&&gx.add(s),s}Be("append",g6);const A6=new or("color"),U=new or("float",TB.float),K=new or("int",TB.ints),pt=new or("uint",TB.uint),pm=new or("bool",TB.bool),le=new or("vec2"),pd=new or("ivec2"),y6=new or("uvec2"),b6=new or("bvec2"),J=new or("vec3"),x6=new or("ivec3"),Jx=new or("uvec3"),TX=new or("bvec3"),Xe=new or("vec4"),v6=new or("ivec4"),_6=new or("uvec4"),C6=new or("bvec4"),L1=new or("mat2"),Qr=new or("mat3"),_0=new or("mat4"),Xge=(s="")=>me(new Hc(s,"string")),Oge=s=>me(new Hc(s,"ArrayBuffer"));Be("toColor",A6);Be("toFloat",U);Be("toInt",K);Be("toUint",pt);Be("toBool",pm);Be("toVec2",le);Be("toIVec2",pd);Be("toUVec2",y6);Be("toBVec2",b6);Be("toVec3",J);Be("toIVec3",x6);Be("toUVec3",Jx);Be("toBVec3",TX);Be("toVec4",Xe);Be("toIVec4",v6);Be("toUVec4",_6);Be("toBVec4",C6);Be("toMat2",L1);Be("toMat3",Qr);Be("toMat4",_0);const w6=we(Rm),S6=(s,e)=>me(new _X(me(s),e)),Zge=(s,e)=>me(new IL(me(s),e));Be("element",w6);Be("convert",S6);class EX extends Qt{static get type(){return"UniformGroupNode"}constructor(e,t=!1,i=1){super("string"),this.name=e,this.version=0,this.shared=t,this.order=i,this.isUniformGroup=!0}set needsUpdate(e){e===!0&&this.version++}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const M6=s=>new EX(s),RX=(s,e=0)=>new EX(s,!0,e),Wge=RX("frame"),Ui=RX("render"),I6=M6("object");class fA extends CX{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=I6}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const i=this.getSelf();return e=e.bind(i),super.onUpdate(n=>{const r=e(n,i);r!==void 0&&(this.value=r)},t)}generate(e,t){const i=this.getNodeType(e),n=this.getUniformHash(e);let r=e.getNodeFromHash(n);r===void 0&&(e.setHashNode(this,n),r=this);const o=r.getInputType(e),a=e.getUniformFromNode(r,o,e.shaderStage,this.name||e.context.label),l=e.getPropertyName(a);return e.context.label!==void 0&&delete e.context.label,e.format(l,i,t)}}const $e=(s,e)=>{const t=m6(e||s),i=s&&s.isNode===!0?s.node&&s.node.value||s.value:s;return me(new fA(i,t))};class tn extends Qt{static get type(){return"PropertyNode"}constructor(e,t=null,i=!1){super(e),this.name=t,this.varying=i,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const el=(s,e)=>me(new tn(s,e)),bh=(s,e)=>me(new tn(s,e,!0)),rn=tt(tn,"vec4","DiffuseColor"),iV=tt(tn,"vec3","EmissiveColor"),vd=tt(tn,"float","Roughness"),Jw=tt(tn,"float","Metalness"),TL=tt(tn,"float","Clearcoat"),jw=tt(tn,"float","ClearcoatRoughness"),c0=tt(tn,"vec3","Sheen"),EB=tt(tn,"float","SheenRoughness"),RB=tt(tn,"float","Iridescence"),LX=tt(tn,"float","IridescenceIOR"),BX=tt(tn,"float","IridescenceThickness"),EL=tt(tn,"float","AlphaT"),Mf=tt(tn,"float","Anisotropy"),zC=tt(tn,"vec3","AnisotropyT"),C0=tt(tn,"vec3","AnisotropyB"),ja=tt(tn,"color","SpecularColor"),qw=tt(tn,"float","SpecularF90"),RL=tt(tn,"float","Shininess"),PX=tt(tn,"vec4","Output"),w0=tt(tn,"float","dashSize"),$w=tt(tn,"float","gapSize"),Hge=tt(tn,"float","pointWidth"),UC=tt(tn,"float","IOR"),LL=tt(tn,"float","Transmission"),GX=tt(tn,"float","Thickness"),kX=tt(tn,"float","AttenuationDistance"),NX=tt(tn,"color","AttenuationColor"),DX=tt(tn,"float","Dispersion");class T6 extends wi{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const i=e.getTypeLength(t.node.getNodeType(e));return Yx.join("").slice(0,i)!==t.components}return!1}generate(e,t){const{targetNode:i,sourceNode:n}=this,r=this.needsSplitAssign(e),o=i.getNodeType(e),a=i.context({assign:!0}).build(e),l=n.build(e,o),c=n.getNodeType(e),h=e.getDataFromNode(this);let d;if(h.initialized===!0)t!=="void"&&(d=a);else if(r){const u=e.getVarFromNode(this,null,o),f=e.getPropertyName(u);e.addLineFlowCode(`${f} = ${l}`,this);const m=i.node.context({assign:!0}).build(e);for(let g=0;g<i.components.length;g++){const A=i.components[g];e.addLineFlowCode(`${m}.${A} = ${f}[ ${g} ]`,this)}t!=="void"&&(d=a)}else d=`${a} = ${l}`,(t==="void"||c==="void")&&(e.addLineFlowCode(d,this),t!=="void"&&(d=a));return h.initialized=!0,e.format(d,o,t)}}const E6=we(T6);Be("assign",E6);class R6 extends wi{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],i=this.functionNode,n=i.getInputs(e),r=this.parameters;if(Array.isArray(r))for(let a=0;a<r.length;a++){const l=n[a],c=r[a];t.push(c.build(e,l.type))}else for(const a of n){const l=r[a.name];if(l!==void 0)t.push(l.build(e,a.type));else throw new Error(`FunctionCallNode: Input '${a.name}' not found in FunctionNode.`)}return`${i.build(e,"property")}( ${t.join(", ")} )`}}const L6=(s,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?v0(e):R1(e[0]),me(new R6(me(s),e)));Be("call",L6);class ns extends wi{static get type(){return"OperatorNode"}constructor(e,t,i,...n){if(super(),n.length>0){let r=new ns(e,t,i);for(let o=0;o<n.length-1;o++)r=new ns(e,r,n[o]);t=r,i=n[n.length-1]}this.op=e,this.aNode=t,this.bNode=i}getNodeType(e,t){const i=this.op,n=this.aNode,r=this.bNode,o=n.getNodeType(e),a=typeof r<"u"?r.getNodeType(e):null;if(o==="void"||a==="void")return"void";if(i==="%")return o;if(i==="~"||i==="&"||i==="|"||i==="^"||i===">>"||i==="<<")return e.getIntegerType(o);if(i==="!"||i==="=="||i==="&&"||i==="||"||i==="^^")return"bool";if(i==="<"||i===">"||i==="<="||i===">="){const l=t?e.getTypeLength(t):Math.max(e.getTypeLength(o),e.getTypeLength(a));return l>1?`bvec${l}`:"bool"}else return o==="float"&&e.isMatrix(a)?a:e.isMatrix(o)&&e.isVector(a)?e.getVectorFromMatrix(o):e.isVector(o)&&e.isMatrix(a)?e.getVectorFromMatrix(a):e.getTypeLength(a)>e.getTypeLength(o)?a:o}generate(e,t){const i=this.op,n=this.aNode,r=this.bNode,o=this.getNodeType(e,t);let a=null,l=null;o!=="void"?(a=n.getNodeType(e),l=typeof r<"u"?r.getNodeType(e):null,i==="<"||i===">"||i==="<="||i===">="||i==="=="?e.isVector(a)?l=a:a!==l&&(a=l="float"):i===">>"||i==="<<"?(a=o,l=e.changeComponentType(l,"uint")):e.isMatrix(a)&&e.isVector(l)?l=e.getVectorFromMatrix(a):e.isVector(a)&&e.isMatrix(l)?a=e.getVectorFromMatrix(l):a=l=o):a=l=o;const c=n.build(e,a),h=typeof r<"u"?r.build(e,l):null,d=e.getTypeLength(t),u=e.getFunctionOperator(i);if(t!=="void")return i==="<"&&d>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThan",t)}( ${c}, ${h} )`,o,t):e.format(`( ${c} < ${h} )`,o,t):i==="<="&&d>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThanEqual",t)}( ${c}, ${h} )`,o,t):e.format(`( ${c} <= ${h} )`,o,t):i===">"&&d>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThan",t)}( ${c}, ${h} )`,o,t):e.format(`( ${c} > ${h} )`,o,t):i===">="&&d>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThanEqual",t)}( ${c}, ${h} )`,o,t):e.format(`( ${c} >= ${h} )`,o,t):i==="!"||i==="~"?e.format(`(${i}${c})`,a,t):u?e.format(`${u}( ${c}, ${h} )`,o,t):e.format(`( ${c} ${i} ${h} )`,o,t);if(a!=="void")return u?e.format(`${u}( ${c}, ${h} )`,o,t):e.format(`${c} ${i} ${h}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Yn=we(ns,"+"),In=we(ns,"-"),pi=we(ns,"*"),Ph=we(ns,"/"),FX=we(ns,"%"),B6=we(ns,"=="),P6=we(ns,"!="),G6=we(ns,"<"),VX=we(ns,">"),k6=we(ns,"<="),N6=we(ns,">="),D6=we(ns,"&&"),F6=we(ns,"||"),V6=we(ns,"!"),z6=we(ns,"^^"),U6=we(ns,"&"),X6=we(ns,"~"),O6=we(ns,"|"),Z6=we(ns,"^"),W6=we(ns,"<<"),H6=we(ns,">>");Be("add",Yn);Be("sub",In);Be("mul",pi);Be("div",Ph);Be("modInt",FX);Be("equal",B6);Be("notEqual",P6);Be("lessThan",G6);Be("greaterThan",VX);Be("lessThanEqual",k6);Be("greaterThanEqual",N6);Be("and",D6);Be("or",F6);Be("not",V6);Be("xor",z6);Be("bitAnd",U6);Be("bitNot",X6);Be("bitOr",O6);Be("bitXor",Z6);Be("shiftLeft",W6);Be("shiftRight",H6);const Q6=(...s)=>(console.warn("TSL.OperatorNode: .remainder() has been renamed to .modInt()."),FX(...s));Be("remainder",Q6);class oe extends wi{static get type(){return"MathNode"}constructor(e,t,i=null,n=null){super(),this.method=e,this.aNode=t,this.bNode=i,this.cNode=n}getInputType(e){const t=this.aNode.getNodeType(e),i=this.bNode?this.bNode.getNodeType(e):null,n=this.cNode?this.cNode.getNodeType(e):null,r=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(i)?0:e.getTypeLength(i),a=e.isMatrix(n)?0:e.getTypeLength(n);return r>o&&r>a?t:o>a?i:a>r?n:t}getNodeType(e){const t=this.method;return t===oe.LENGTH||t===oe.DISTANCE||t===oe.DOT?"float":t===oe.CROSS?"vec3":t===oe.ALL?"bool":t===oe.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):t===oe.MOD?this.aNode.getNodeType(e):this.getInputType(e)}generate(e,t){const i=this.method,n=this.getNodeType(e),r=this.getInputType(e),o=this.aNode,a=this.bNode,l=this.cNode,c=e.renderer.isWebGLRenderer===!0;if(i===oe.TRANSFORM_DIRECTION){let h=o,d=a;e.isMatrix(h.getNodeType(e))?d=Xe(J(d),0):h=Xe(J(h),0);const u=pi(h,d).xyz;return Bl(u).build(e,t)}else{if(i===oe.NEGATE)return e.format("( - "+o.build(e,r)+" )",n,t);if(i===oe.ONE_MINUS)return In(1,o).build(e,t);if(i===oe.RECIPROCAL)return Ph(1,o).build(e,t);if(i===oe.DIFFERENCE)return xn(In(o,a)).build(e,t);{const h=[];return i===oe.CROSS||i===oe.MOD?h.push(o.build(e,n),a.build(e,n)):c&&i===oe.STEP?h.push(o.build(e,e.getTypeLength(o.getNodeType(e))===1?"float":r),a.build(e,r)):c&&(i===oe.MIN||i===oe.MAX)||i===oe.MOD?h.push(o.build(e,r),a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":r)):i===oe.REFRACT?h.push(o.build(e,r),a.build(e,r),l.build(e,"float")):i===oe.MIX?h.push(o.build(e,r),a.build(e,r),l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":r)):(h.push(o.build(e,r)),a!==null&&h.push(a.build(e,r)),l!==null&&h.push(l.build(e,r))),e.format(`${e.getMethod(i,n)}( ${h.join(", ")} )`,n,t)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}oe.ALL="all";oe.ANY="any";oe.EQUALS="equals";oe.RADIANS="radians";oe.DEGREES="degrees";oe.EXP="exp";oe.EXP2="exp2";oe.LOG="log";oe.LOG2="log2";oe.SQRT="sqrt";oe.INVERSE_SQRT="inversesqrt";oe.FLOOR="floor";oe.CEIL="ceil";oe.NORMALIZE="normalize";oe.FRACT="fract";oe.SIN="sin";oe.COS="cos";oe.TAN="tan";oe.ASIN="asin";oe.ACOS="acos";oe.ATAN="atan";oe.ABS="abs";oe.SIGN="sign";oe.LENGTH="length";oe.NEGATE="negate";oe.ONE_MINUS="oneMinus";oe.DFDX="dFdx";oe.DFDY="dFdy";oe.ROUND="round";oe.RECIPROCAL="reciprocal";oe.TRUNC="trunc";oe.FWIDTH="fwidth";oe.BITCAST="bitcast";oe.TRANSPOSE="transpose";oe.ATAN2="atan2";oe.MIN="min";oe.MAX="max";oe.MOD="mod";oe.STEP="step";oe.REFLECT="reflect";oe.DISTANCE="distance";oe.DIFFERENCE="difference";oe.DOT="dot";oe.CROSS="cross";oe.POW="pow";oe.TRANSFORM_DIRECTION="transformDirection";oe.MIX="mix";oe.CLAMP="clamp";oe.REFRACT="refract";oe.SMOOTHSTEP="smoothstep";oe.FACEFORWARD="faceforward";const K6=U(1e-6),Qge=U(1e6),Y0=U(Math.PI),Kge=U(Math.PI*2),zX=we(oe,oe.ALL),Y6=we(oe,oe.ANY),J6=we(oe,oe.EQUALS),j6=we(oe,oe.RADIANS),q6=we(oe,oe.DEGREES),UX=we(oe,oe.EXP),BL=we(oe,oe.EXP2),XX=we(oe,oe.LOG),B1=we(oe,oe.LOG2),Xh=we(oe,oe.SQRT),$6=we(oe,oe.INVERSE_SQRT),Lm=we(oe,oe.FLOOR),OX=we(oe,oe.CEIL),Bl=we(oe,oe.NORMALIZE),Bm=we(oe,oe.FRACT),yo=we(oe,oe.SIN),Pl=we(oe,oe.COS),e7=we(oe,oe.TAN),t7=we(oe,oe.ASIN),PL=we(oe,oe.ACOS),i7=we(oe,oe.ATAN),xn=we(oe,oe.ABS),P1=we(oe,oe.SIGN),S0=we(oe,oe.LENGTH),n7=we(oe,oe.NEGATE),s7=we(oe,oe.ONE_MINUS),r7=we(oe,oe.DFDX),o7=we(oe,oe.DFDY),a7=we(oe,oe.ROUND),l7=we(oe,oe.RECIPROCAL),ZX=we(oe,oe.TRUNC),c7=we(oe,oe.FWIDTH),Yge=we(oe,oe.BITCAST),h7=we(oe,oe.TRANSPOSE),d7=we(oe,oe.ATAN2),Vr=we(oe,oe.MIN),Ri=we(oe,oe.MAX),LB=we(oe,oe.MOD),G1=we(oe,oe.STEP),u7=we(oe,oe.REFLECT),p7=we(oe,oe.DISTANCE),f7=we(oe,oe.DIFFERENCE),ls=we(oe,oe.DOT),Qb=we(oe,oe.CROSS),Ia=we(oe,oe.POW),WX=we(oe,oe.POW,2),m7=we(oe,oe.POW,3),g7=we(oe,oe.POW,4),A7=we(oe,oe.TRANSFORM_DIRECTION),y7=s=>pi(P1(s),Ia(xn(s),1/3)),HX=s=>ls(s,s),li=we(oe,oe.MIX),qs=(s,e=0,t=1)=>me(new oe(oe.CLAMP,me(s),me(e),me(t))),b7=s=>qs(s),QX=we(oe,oe.REFRACT),Ga=we(oe,oe.SMOOTHSTEP),x7=we(oe,oe.FACEFORWARD),KX=ne(([s])=>{const i=43758.5453,n=ls(s.xy,le(12.9898,78.233)),r=LB(n,Y0);return Bm(yo(r).mul(i))}),v7=(s,e,t)=>li(e,t,s),_7=(s,e,t)=>Ga(e,t,s);Be("all",zX);Be("any",Y6);Be("equals",J6);Be("radians",j6);Be("degrees",q6);Be("exp",UX);Be("exp2",BL);Be("log",XX);Be("log2",B1);Be("sqrt",Xh);Be("inverseSqrt",$6);Be("floor",Lm);Be("ceil",OX);Be("normalize",Bl);Be("fract",Bm);Be("sin",yo);Be("cos",Pl);Be("tan",e7);Be("asin",t7);Be("acos",PL);Be("atan",i7);Be("abs",xn);Be("sign",P1);Be("length",S0);Be("lengthSq",HX);Be("negate",n7);Be("oneMinus",s7);Be("dFdx",r7);Be("dFdy",o7);Be("round",a7);Be("reciprocal",l7);Be("trunc",ZX);Be("fwidth",c7);Be("atan2",d7);Be("min",Vr);Be("max",Ri);Be("mod",LB);Be("step",G1);Be("reflect",u7);Be("distance",p7);Be("dot",ls);Be("cross",Qb);Be("pow",Ia);Be("pow2",WX);Be("pow3",m7);Be("pow4",g7);Be("transformDirection",A7);Be("mix",v7);Be("clamp",qs);Be("refract",QX);Be("smoothstep",_7);Be("faceForward",x7);Be("difference",f7);Be("saturate",b7);Be("cbrt",y7);Be("transpose",h7);Be("rand",KX);class Jge extends Qt{static get type(){return"ConditionalNode"}constructor(e,t,i=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=i}getNodeType(e){const t=this.ifNode.getNodeType(e);if(this.elseNode!==null){const i=this.elseNode.getNodeType(e);if(e.getTypeLength(i)>e.getTypeLength(t))return i}return t}setup(e){const t=this.condNode.cache(),i=this.ifNode.cache(),n=this.elseNode?this.elseNode.cache():null,r=e.context.nodeBlock;e.getDataFromNode(i).parentNodeBlock=r,n!==null&&(e.getDataFromNode(n).parentNodeBlock=r);const o=e.getNodeProperties(this);o.condNode=t,o.ifNode=i.context({nodeBlock:i}),o.elseNode=n?n.context({nodeBlock:n}):null}generate(e,t){const i=this.getNodeType(e),n=e.getDataFromNode(this);if(n.nodeProperty!==void 0)return n.nodeProperty;const{condNode:r,ifNode:o,elseNode:a}=e.getNodeProperties(this),l=t!=="void",c=l?el(i).build(e):"";n.nodeProperty=c;const h=r.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${h} ) {

`).addFlowTab();let d=o.build(e,i);if(d&&(l?d=c+" = "+d+";":d="return "+d+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+d+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let u=a.build(e,i);u&&(l?u=c+" = "+u+";":u="return "+u+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+u+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(c,i,t)}}const vo=we(Jge);Be("select",vo);const C7=(...s)=>(console.warn("TSL.ConditionalNode: cond() has been renamed to select()."),vo(...s));Be("cond",C7);class YX extends Qt{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){this.node.build(e)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.value});const i=this.node.build(e);return e.setContext(t),i}generate(e,t){const i=e.getContext();e.setContext({...e.context,...this.value});const n=this.node.build(e,t);return e.setContext(i),n}}const JX=we(YX),w7=(s,e)=>JX(s,{label:e});Be("context",JX);Be("label",w7);class S7 extends Qt{static get type(){return"VarNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:i}=this,n=e.getVarFromNode(this,i,e.getVectorType(this.getNodeType(e))),r=e.getPropertyName(n),o=t.build(e,n.type);return e.addLineFlowCode(`${r} = ${o}`,this),r}}const jX=we(S7);Be("temp",jX);Be("toVar",(...s)=>jX(...s).append());class M7 extends Qt{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let i=t.varying;if(i===void 0){const n=this.name,r=this.getNodeType(e);t.varying=i=e.getVaryingFromNode(this,n,r),t.node=this.node}return i.needsInterpolation||(i.needsInterpolation=e.shaderStage==="fragment"),i}setup(e){this.setupVarying(e)}analyze(e){return this.setupVarying(e),this.node.analyze(e)}generate(e){const t=e.getNodeProperties(this),i=this.setupVarying(e);if(t.propertyName===void 0){const n=this.getNodeType(e),r=e.getPropertyName(i,qF.VERTEX);e.flowNodeFromShaderStage(qF.VERTEX,this.node,n,r),t.propertyName=r}return e.getPropertyName(i)}}const Eo=we(M7);Be("varying",Eo);const k1="WorkingColorSpace",qX="OutputColorSpace";function VH(s){let e=null;return s===Ji?e="Linear":s===ft&&(e="sRGB"),e}function GL(s,e){return VH(s)+"To"+VH(e)}class N1 extends wi{static get type(){return"ColorSpaceNode"}constructor(e,t,i){super("vec4"),this.colorNode=e,this.source=t,this.target=i}getColorSpace(e,t){return t===k1?ni.workingColorSpace:t===qX?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{renderer:t}=e,{colorNode:i}=this,n=this.getColorSpace(e,this.source),r=this.getColorSpace(e,this.target);if(n===r)return i;const o=GL(n,r);let a=null;const l=t.nodes.library.getColorSpaceFunction(o);return l!==null?a=Xe(l(i.rgb),i.a):(console.error("ColorSpaceNode: Unsupported Color Space configuration.",o),a=i),a}}const I7=s=>me(new N1(me(s),k1,qX)),T7=s=>me(new N1(me(s),qX,k1)),E7=(s,e)=>me(new N1(me(s),k1,e)),$X=(s,e)=>me(new N1(me(s),e,k1));Be("toOutputColorSpace",I7);Be("toWorkingColorSpace",T7);Be("workingToColorSpace",E7);Be("colorSpaceToWorking",$X);let jge=class extends Rm{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),i=this.referenceNode.getNodeType(),n=this.getNodeType();return e.format(t,i,n)}};class R7 extends Qt{static get type(){return"ReferenceBaseNode"}constructor(e,t,i=null,n=null){super(),this.property=e,this.uniformType=t,this.object=i,this.count=n,this.properties=e.split("."),this.reference=i,this.node=null,this.group=null,this.updateType=Zt.OBJECT}setGroup(e){return this.group=e,this}element(e){return me(new jge(this,me(e)))}setNodeType(e){const t=$e(null,e).getSelf();this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let i=e[t[0]];for(let n=1;n<t.length;n++)i=i[t[n]];return i}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const qge=(s,e,t)=>me(new R7(s,e,t));class L7 extends R7{static get type(){return"RendererReferenceNode"}constructor(e,t,i=null){super(e,t,i),this.renderer=i,this.setGroup(Ui)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const B7=(s,e,t)=>me(new L7(s,e,t));class P7 extends wi{static get type(){return"ToneMappingNode"}constructor(e,t=k7,i=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=i}getCacheKey(){return AX(super.getCacheKey(),this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,i=this.toneMapping;if(i===Zr)return t;let n=null;const r=e.renderer.nodes.library.getToneMappingFunction(i);return r!==null?n=Xe(r(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",i),n=t),n}}const G7=(s,e,t)=>me(new P7(s,me(e),me(t))),k7=B7("toneMappingExposure","float");Be("toneMapping",(s,e,t)=>G7(e,t,s));class N7 extends CX{static get type(){return"BufferAttributeNode"}constructor(e,t=null,i=0,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=i,this.bufferOffset=n,this.usage=px,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),i=this.value,n=e.getTypeLength(t),r=this.bufferStride||n,o=this.bufferOffset,a=i.isInterleavedBuffer===!0?i:new Hx(i,r),l=new Ma(a,n,o);a.setUsage(this.usage),this.attribute=l,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),i=e.getBufferAttributeFromNode(this,t),n=e.getPropertyName(i);let r=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=n,r=n):r=Eo(this).build(e,t),r}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const D1=(s,e,t,i)=>me(new N7(s,e,t,i)),D7=(s,e,t,i)=>D1(s,e,t,i).setUsage(Vs),kL=(s,e,t,i)=>D1(s,e,t,i).setInstanced(!0),nV=(s,e,t,i)=>D7(s,e,t,i).setInstanced(!0);Be("toAttribute",s=>D1(s.value));class F7 extends Qt{static get type(){return"ComputeNode"}constructor(e,t,i=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=i,this.dispatchCount=0,this.version=1,this.updateBeforeType=Zt.OBJECT,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let i=t[0];for(let n=1;n<t.length;n++)i*=t[n];this.dispatchCount=Math.ceil(e/i)}onInit(){}updateBefore({renderer:e}){e.compute(this)}generate(e){const{shaderStage:t}=e;if(t==="compute"){const i=this.computeNode.build(e,"void");i!==""&&e.addLineFlowCode(i,this)}}}const V7=(s,e,t)=>me(new F7(me(s),e,t));Be("compute",V7);class z7 extends Qt{static get type(){return"CacheNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){return this.node.getNodeType(e)}build(e,...t){const i=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const r=this.node.build(e,...t);return e.setCache(i),r}}const XC=(s,...e)=>me(new z7(me(s),...e));Be("cache",XC);class U7 extends Qt{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const X7=we(U7);Be("bypass",X7);class e3 extends Qt{static get type(){return"RemapNode"}constructor(e,t,i,n=U(0),r=U(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=i,this.outLowNode=n,this.outHighNode=r,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:i,outLowNode:n,outHighNode:r,doClamp:o}=this;let a=e.sub(t).div(i.sub(t));return o===!0&&(a=a.clamp()),a.mul(r.sub(n)).add(n)}}const O7=we(e3,null,null,{doClamp:!1}),Z7=we(e3);Be("remap",O7);Be("remapClamp",Z7);class W7 extends Qt{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const i=this.getNodeType(e),n=this.snippet;if(i==="void")e.addLineFlowCode(n,this);else return e.format(`( ${n} )`,i,t)}}const fm=we(W7),H7=s=>(s?vo(s,fm("discard")):fm("discard")).append(),$ge=()=>fm("return").append();Be("discard",H7);class Q7 extends wi{static get type(){return"RenderOutputNode"}constructor(e,t,i){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=i,this.isRenderOutput=!0}setup({context:e}){let t=this.colorNode||e.color;const i=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||Zr,n=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Fr;return i!==Zr&&(t=t.toneMapping(i)),n!==Fr&&n!==ni.workingColorSpace&&(t=t.workingToColorSpace(n)),t}}const K7=(s,e=null,t=null)=>me(new Q7(me(s),e,t));Be("renderOutput",K7);function e0e(s){console.warn("THREE.TSLBase: AddNodeElement has been removed in favor of tree-shaking. Trying add",s)}class t3 extends Qt{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const i=this.getAttributeName(e);if(e.hasGeometryAttribute(i)){const n=e.geometry.getAttribute(i);t=e.getTypeFromAttribute(n)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),i=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const r=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(r),a=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(a.name,o,i):Eo(this).build(e,i)}else return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(i)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const Dr=(s,e)=>me(new t3(s,e)),hi=s=>Dr("uv"+(s>0?s:""),"vec2");class Y7 extends Qt{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const i=this.textureNode.build(e,"property"),n=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${i}, ${n} )`,this.getNodeType(e),t)}}const Zf=we(Y7);class J7 extends fA{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=Zt.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,i=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(i&&i.width!==void 0){const{width:n,height:r}=i;this.value=Math.log2(Math.max(n,r))}}}const j7=we(J7);class Jd extends fA{static get type(){return"TextureNode"}constructor(e,t=null,i=null,n=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=i,this.biasNode=n,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Zt.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Wr?"uvec4":this.value.type===Dd?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return hi(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=$e(this.value.matrix)),this._matrixUniform.mul(J(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?Zt.FRAME:Zt.NONE,this}setupUV(e,t){const i=this.value;return e.isFlipY()&&(i.isRenderTargetTexture===!0||i.isFramebufferTexture===!0||i.isDepthTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(K(Zf(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;let i=this.uvNode;(i===null||e.context.forceUVContext===!0)&&e.context.getUV&&(i=e.context.getUV(this)),i||(i=this.getDefaultUV()),this.updateMatrix===!0&&(i=this.getTransformedUV(i)),i=this.setupUV(e,i);let n=this.levelNode;n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),t.uvNode=i,t.levelNode=n,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,i,n,r,o,a,l){const c=this.value;let h;return n?h=e.generateTextureLevel(c,t,i,n,o):r?h=e.generateTextureBias(c,t,i,r,o):l?h=e.generateTextureGrad(c,t,i,l,o):a?h=e.generateTextureCompare(c,t,i,a,o):this.sampler===!1?h=e.generateTextureLoad(c,t,i,o):h=e.generateTexture(c,t,i,o),h}generate(e,t){const i=e.getNodeProperties(this),n=this.value;if(!n||n.isTexture!==!0)throw new Error("TextureNode: Need a three.js texture.");const r=super.generate(e,"property");if(t==="sampler")return r+"_sampler";if(e.isReference(t))return r;{const o=e.getDataFromNode(this);let a=o.propertyName;if(a===void 0){const{uvNode:h,levelNode:d,biasNode:u,compareNode:f,depthNode:m,gradNode:g}=i,A=this.generateUV(e,h),y=d?d.build(e,"float"):null,b=u?u.build(e,"float"):null,x=m?m.build(e,"int"):null,v=f?f.build(e,"float"):null,_=g?[g[0].build(e,"vec2"),g[1].build(e,"vec2")]:null,C=e.getVarFromNode(this);a=e.getPropertyName(C);const S=this.generateSnippet(e,r,A,y,b,x,v,_);e.addLineFlowCode(`${a} = ${S}`,this),o.snippet=S,o.propertyName=a}let l=a;const c=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(l=$X(fm(l,c),n.colorSpace).setup(e).build(e,c)),e.format(l,c,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){const t=this.clone();return t.uvNode=me(e),t.referenceNode=this.getSelf(),me(t)}blur(e){const t=this.clone();return t.biasNode=me(e).mul(j7(t)),t.referenceNode=this.getSelf(),me(t)}level(e){const t=this.clone();return t.levelNode=me(e),t.referenceNode=this.getSelf(),me(t)}size(e){return Zf(this,e)}bias(e){const t=this.clone();return t.biasNode=me(e),t.referenceNode=this.getSelf(),me(t)}compare(e){const t=this.clone();return t.compareNode=me(e),t.referenceNode=this.getSelf(),me(t)}grad(e,t){const i=this.clone();return i.gradNode=[me(e),me(t)],i.referenceNode=this.getSelf(),me(i)}depth(e){const t=this.clone();return t.depthNode=me(e),t.referenceNode=this.getSelf(),me(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e}}const Gi=we(Jd),vc=(...s)=>Gi(...s).setSampler(!1),t0e=s=>(s.isNode===!0?s:Gi(s)).convert("sampler"),tb=$e("float").label("cameraNear").setGroup(Ui).onRenderUpdate(({camera:s})=>s.near),ib=$e("float").label("cameraFar").setGroup(Ui).onRenderUpdate(({camera:s})=>s.far),q7=$e("float").label("cameraLogDepth").setGroup(Ui).onRenderUpdate(({camera:s})=>2/(Math.log(s.far+1)/Math.LN2)),tl=$e("mat4").label("cameraProjectionMatrix").setGroup(Ui).onRenderUpdate(({camera:s})=>s.projectionMatrix),i0e=$e("mat4").label("cameraProjectionMatrixInverse").setGroup(Ui).onRenderUpdate(({camera:s})=>s.projectionMatrixInverse),hl=$e("mat4").label("cameraViewMatrix").setGroup(Ui).onRenderUpdate(({camera:s})=>s.matrixWorldInverse),n0e=$e("mat4").label("cameraWorldMatrix").setGroup(Ui).onRenderUpdate(({camera:s})=>s.matrixWorld),s0e=$e("mat3").label("cameraNormalMatrix").setGroup(Ui).onRenderUpdate(({camera:s})=>s.normalMatrix),i3=$e(new T).label("cameraPosition").setGroup(Ui).onRenderUpdate(({camera:s},e)=>e.value.setFromMatrixPosition(s.matrixWorld));class Yi extends Qt{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Zt.OBJECT,this._uniformNode=new fA(null)}getNodeType(){const e=this.scope;if(e===Yi.WORLD_MATRIX)return"mat4";if(e===Yi.POSITION||e===Yi.VIEW_POSITION||e===Yi.DIRECTION||e===Yi.SCALE)return"vec3"}update(e){const t=this.object3d,i=this._uniformNode,n=this.scope;if(n===Yi.WORLD_MATRIX)i.value=t.matrixWorld;else if(n===Yi.POSITION)i.value=i.value||new T,i.value.setFromMatrixPosition(t.matrixWorld);else if(n===Yi.SCALE)i.value=i.value||new T,i.value.setFromMatrixScale(t.matrixWorld);else if(n===Yi.DIRECTION)i.value=i.value||new T,t.getWorldDirection(i.value);else if(n===Yi.VIEW_POSITION){const r=e.camera;i.value=i.value||new T,i.value.setFromMatrixPosition(t.matrixWorld),i.value.applyMatrix4(r.matrixWorldInverse)}}generate(e){const t=this.scope;return t===Yi.WORLD_MATRIX?this._uniformNode.nodeType="mat4":(t===Yi.POSITION||t===Yi.VIEW_POSITION||t===Yi.DIRECTION||t===Yi.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Yi.WORLD_MATRIX="worldMatrix";Yi.POSITION="position";Yi.SCALE="scale";Yi.VIEW_POSITION="viewPosition";Yi.DIRECTION="direction";const r0e=we(Yi,Yi.DIRECTION),o0e=we(Yi,Yi.WORLD_MATRIX),a0e=we(Yi,Yi.POSITION),l0e=we(Yi,Yi.SCALE),c0e=we(Yi,Yi.VIEW_POSITION);class Gh extends Yi{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const h0e=tt(Gh,Gh.DIRECTION),kc=tt(Gh,Gh.WORLD_MATRIX),d0e=tt(Gh,Gh.POSITION),u0e=tt(Gh,Gh.SCALE),p0e=tt(Gh,Gh.VIEW_POSITION),$7=$e(new ei).onObjectUpdate(({object:s},e)=>e.value.getNormalMatrix(s.matrixWorld)),eq=$e(new ce).onObjectUpdate(({object:s},e)=>e.value.copy(s.matrixWorld).invert()),jd=hl.mul(kc).toVar("modelViewMatrix_2"),f0e=ne(s=>(s.context.isHighPrecisionModelViewMatrix=!0,$e("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highPrecisionModelViewMatrix"),m0e=ne(s=>{const e=s.context.isHighPrecisionModelViewMatrix;return $e("mat3").onObjectUpdate(({object:t,camera:i})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highPrecisionModelNormalMatrix"),uo=Dr("position","vec3"),Ts=uo.varying("positionLocal"),NL=uo.varying("positionPrevious"),DL=kc.mul(Ts).xyz.varying("v_positionWorld"),n3=Ts.transformDirection(kc).varying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),_o=jd.mul(Ts).xyz.varying("v_positionView"),Gn=_o.negate().varying("v_positionViewDirection").normalize().toVar("positionViewDirection");class tq extends Qt{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:t,material:i}=e;return t.coordinateSystem===Gc&&i.side===vn?"false":e.getFrontFacing()}}const iq=tt(tq),F1=U(iq).mul(2).sub(1),BB=Dr("normal","vec3"),ll=ne(s=>s.geometry.hasAttribute("normal")===!1?(console.warn('TSL.NormalNode: Vertex attribute "normal" not found on geometry.'),J(0,1,0)):BB,"vec3").once()().toVar("normalLocal"),nq=_o.dFdx().cross(_o.dFdy()).normalize().toVar("normalFlat"),ql=ne(s=>{let e;return s.material.flatShading===!0?e=nq:e=Eo(r3(ll),"v_normalView").normalize(),e},"vec3").once()().toVar("normalView"),PB=Eo(ql.transformDirection(hl),"v_normalWorld").normalize().toVar("normalWorld"),cs=ne(s=>s.context.setupNormal(),"vec3").once()().mul(F1).toVar("transformedNormalView"),s3=cs.transformDirection(hl).toVar("transformedNormalWorld"),wb=ne(s=>s.context.setupClearcoatNormal(),"vec3").once()().mul(F1).toVar("transformedClearcoatNormalView"),sq=ne(([s,e=kc])=>{const t=Qr(e),i=s.div(J(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(i).xyz}),r3=ne(([s],e)=>{const t=e.renderer.nodes.modelNormalViewMatrix;if(t!==null)return t.transformDirection(s);const i=$7.mul(s);return hl.transformDirection(i)}),rq=$e(0).onReference(({material:s})=>s).onRenderUpdate(({material:s})=>s.refractionRatio),oq=Gn.negate().reflect(cs),aq=Gn.negate().refract(cs,rq),lq=oq.transformDirection(hl).toVar("reflectVector"),cq=aq.transformDirection(hl).toVar("reflectVector");class hq extends Jd{static get type(){return"CubeTextureNode"}constructor(e,t=null,i=null,n=null){super(e,t,i,n),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===jl?lq:e.mapping===zc?cq:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),J(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const i=this.value;return e.renderer.coordinateSystem===W0||!i.isRenderTargetTexture?J(t.x.negate(),t.yz):t}generateUV(e,t){return t.build(e,"vec3")}}const GB=we(hq);class kB extends fA{static get type(){return"BufferNode"}constructor(e,t,i=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=i}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const V1=(s,e,t)=>me(new kB(s,e,t));class g0e extends Rm{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),i=this.getNodeType();return e.format(t,"vec4",i)}}class o3 extends kB{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null,"vec4"),this.array=e,this.elementType=t,this._elementType=null,this._elementLength=0,this.updateType=Zt.RENDER,this.isArrayBufferNode=!0}getElementType(){return this.elementType||this._elementType}getElementLength(){return this._elementLength}update(){const{array:e,value:t}=this,i=this.getElementLength(),n=this.getElementType();if(i===1)for(let r=0;r<e.length;r++){const o=r*4;t[o]=e[r]}else if(n==="color")for(let r=0;r<e.length;r++){const o=r*4,a=e[r];t[o]=a.r,t[o+1]=a.g,t[o+2]=a.b||0}else for(let r=0;r<e.length;r++){const o=r*4,a=e[r];t[o]=a.x,t[o+1]=a.y,t[o+2]=a.z||0,t[o+3]=a.w||0}}setup(e){const t=this.array.length;this._elementType=this.elementType===null?hp(this.array[0]):this.elementType,this._elementLength=e.getTypeLength(this._elementType);let i=Float32Array;return this._elementType.charAt(0)==="i"?i=Int32Array:this._elementType.charAt(0)==="u"&&(i=Uint32Array),this.value=new i(t*4),this.bufferCount=t,this.bufferType=e.changeComponentType("vec4",e.getComponentType(this._elementType)),super.setup(e)}element(e){return me(new g0e(this,me(e)))}}const zd=(s,e)=>me(new o3(s,e)),A0e=(s,e)=>(console.warn("TSL.UniformArrayNode: uniforms() has been renamed to uniformArray()."),me(new o3(s,e)));class y0e extends Rm{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),i=this.referenceNode.getNodeType(),n=this.getNodeType();return e.format(t,i,n)}}class z1 extends Qt{static get type(){return"ReferenceNode"}constructor(e,t,i=null,n=null){super(),this.property=e,this.uniformType=t,this.object=i,this.count=n,this.properties=e.split("."),this.reference=i,this.node=null,this.group=null,this.name=null,this.updateType=Zt.OBJECT}element(e){return me(new y0e(this,me(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let t=null;this.count!==null?t=V1(null,e,this.count):Array.isArray(this.getValueFromReference())?t=zd(null,e):e==="texture"?t=Gi(null):e==="cubeTexture"?t=GB(null):t=$e(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.label(this.name),this.node=t.getSelf()}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let i=e[t[0]];for(let n=1;n<t.length;n++)i=i[t[n]];return i}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Ar=(s,e,t)=>me(new z1(s,e,t)),sV=(s,e,t,i)=>me(new z1(s,e,i,t));class dq extends z1{static get type(){return"MaterialReferenceNode"}constructor(e,t,i=null){super(e,t,i),this.material=i,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const xh=(s,e,t)=>me(new dq(s,e,t)),NB=ne(s=>(s.geometry.hasAttribute("tangent")===!1&&s.geometry.computeTangents(),Dr("tangent","vec4")))(),U1=NB.xyz.toVar("tangentLocal"),X1=jd.mul(Xe(U1,0)).xyz.varying("v_tangentView").normalize().toVar("tangentView"),uq=X1.transformDirection(hl).varying("v_tangentWorld").normalize().toVar("tangentWorld"),a3=X1.toVar("transformedTangentView"),b0e=a3.transformDirection(hl).normalize().toVar("transformedTangentWorld"),O1=s=>s.mul(NB.w).xyz,x0e=Eo(O1(BB.cross(NB)),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),v0e=Eo(O1(ll.cross(U1)),"v_bitangentLocal").normalize().toVar("bitangentLocal"),pq=Eo(O1(ql.cross(X1)),"v_bitangentView").normalize().toVar("bitangentView"),_0e=Eo(O1(PB.cross(uq)),"v_bitangentWorld").normalize().toVar("bitangentWorld"),fq=O1(cs.cross(a3)).normalize().toVar("transformedBitangentView"),C0e=fq.transformDirection(hl).normalize().toVar("transformedBitangentWorld"),h0=Qr(X1,pq,ql),mq=Gn.mul(h0),w0e=(s,e)=>s.sub(mq.mul(e)),gq=(()=>{let s=C0.cross(Gn);return s=s.cross(C0).normalize(),s=li(s,cs,Mf.mul(vd.oneMinus()).oneMinus().pow2().pow2()).normalize(),s})(),S0e=ne(s=>{const{eye_pos:e,surf_norm:t,mapN:i,uv:n}=s,r=e.dFdx(),o=e.dFdy(),a=n.dFdx(),l=n.dFdy(),c=t,h=o.cross(c),d=c.cross(r),u=h.mul(a.x).add(d.mul(l.x)),f=h.mul(a.y).add(d.mul(l.y)),m=u.dot(u).max(f.dot(f)),g=F1.mul(m.inverseSqrt());return Yn(u.mul(i.x,g),f.mul(i.y,g),c.mul(i.z)).normalize()});class Aq extends wi{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=Qd}setup(e){const{normalMapType:t,scaleNode:i}=this;let n=this.node.mul(2).sub(1);i!==null&&(n=J(n.xy.mul(i),n.z));let r=null;return t===BU?r=r3(n):t===Qd&&(e.hasGeometryAttribute("tangent")===!0?r=h0.mul(n).normalize():r=S0e({eye_pos:_o,surf_norm:ql,mapN:n,uv:hi()})),r}}const rV=we(Aq),M0e=ne(({textureNode:s,bumpScale:e})=>{const t=n=>s.cache().context({getUV:r=>n(r.uvNode||hi()),forceUVContext:!0}),i=U(t(n=>n));return le(U(t(n=>n.add(n.dFdx()))).sub(i),U(t(n=>n.add(n.dFdy()))).sub(i)).mul(e)}),I0e=ne(s=>{const{surf_pos:e,surf_norm:t,dHdxy:i}=s,n=e.dFdx().normalize(),r=e.dFdy().normalize(),o=t,a=r.cross(o),l=o.cross(n),c=n.dot(a).mul(F1),h=c.sign().mul(i.x.mul(a).add(i.y.mul(l)));return c.abs().mul(t).sub(h).normalize()});class yq extends wi{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=M0e({textureNode:this.textureNode,bumpScale:e});return I0e({surf_pos:_o,surf_norm:ql,dHdxy:t})}}const bq=we(yq),zH=new Map;class Me extends Qt{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let i=zH.get(e);return i===void 0&&(i=xh(e,t),zH.set(e,i)),i}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,i=this.scope;let n=null;if(i===Me.COLOR){const r=t.color!==void 0?this.getColor(i):J();t.map&&t.map.isTexture===!0?n=r.mul(this.getTexture("map")):n=r}else if(i===Me.OPACITY){const r=this.getFloat(i);t.alphaMap&&t.alphaMap.isTexture===!0?n=r.mul(this.getTexture("alpha")):n=r}else if(i===Me.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?n=this.getTexture("specular").r:n=U(1);else if(i===Me.SPECULAR_INTENSITY){const r=this.getFloat(i);t.specularMap?n=r.mul(this.getTexture(i).a):n=r}else if(i===Me.SPECULAR_COLOR){const r=this.getColor(i);t.specularColorMap&&t.specularColorMap.isTexture===!0?n=r.mul(this.getTexture(i).rgb):n=r}else if(i===Me.ROUGHNESS){const r=this.getFloat(i);t.roughnessMap&&t.roughnessMap.isTexture===!0?n=r.mul(this.getTexture(i).g):n=r}else if(i===Me.METALNESS){const r=this.getFloat(i);t.metalnessMap&&t.metalnessMap.isTexture===!0?n=r.mul(this.getTexture(i).b):n=r}else if(i===Me.EMISSIVE){const r=this.getFloat("emissiveIntensity"),o=this.getColor(i).mul(r);t.emissiveMap&&t.emissiveMap.isTexture===!0?n=o.mul(this.getTexture(i)):n=o}else if(i===Me.NORMAL)t.normalMap?(n=rV(this.getTexture("normal"),this.getCache("normalScale","vec2")),n.normalMapType=t.normalMapType):t.bumpMap?n=bq(this.getTexture("bump").r,this.getFloat("bumpScale")):n=ql;else if(i===Me.CLEARCOAT){const r=this.getFloat(i);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?n=r.mul(this.getTexture(i).r):n=r}else if(i===Me.CLEARCOAT_ROUGHNESS){const r=this.getFloat(i);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?n=r.mul(this.getTexture(i).r):n=r}else if(i===Me.CLEARCOAT_NORMAL)t.clearcoatNormalMap?n=rV(this.getTexture(i),this.getCache(i+"Scale","vec2")):n=ql;else if(i===Me.SHEEN){const r=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?n=r.mul(this.getTexture("sheenColor").rgb):n=r}else if(i===Me.SHEEN_ROUGHNESS){const r=this.getFloat(i);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?n=r.mul(this.getTexture(i).a):n=r,n=n.clamp(.07,1)}else if(i===Me.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const r=this.getTexture(i);n=L1(nb.x,nb.y,nb.y.negate(),nb.x).mul(r.rg.mul(2).sub(le(1)).normalize().mul(r.b))}else n=nb;else if(i===Me.IRIDESCENCE_THICKNESS){const r=Ar("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=Ar("0","float",t.iridescenceThicknessRange);n=r.sub(o).mul(this.getTexture(i).g).add(o)}else n=r}else if(i===Me.TRANSMISSION){const r=this.getFloat(i);t.transmissionMap?n=r.mul(this.getTexture(i).r):n=r}else if(i===Me.THICKNESS){const r=this.getFloat(i);t.thicknessMap?n=r.mul(this.getTexture(i).g):n=r}else if(i===Me.IOR)n=this.getFloat(i);else if(i===Me.LIGHT_MAP)n=this.getTexture(i).rgb.mul(this.getFloat("lightMapIntensity"));else if(i===Me.AO_MAP)n=this.getTexture(i).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const r=this.getNodeType(e);n=this.getCache(i,r)}return n}}Me.ALPHA_TEST="alphaTest";Me.COLOR="color";Me.OPACITY="opacity";Me.SHININESS="shininess";Me.SPECULAR="specular";Me.SPECULAR_STRENGTH="specularStrength";Me.SPECULAR_INTENSITY="specularIntensity";Me.SPECULAR_COLOR="specularColor";Me.REFLECTIVITY="reflectivity";Me.ROUGHNESS="roughness";Me.METALNESS="metalness";Me.NORMAL="normal";Me.CLEARCOAT="clearcoat";Me.CLEARCOAT_ROUGHNESS="clearcoatRoughness";Me.CLEARCOAT_NORMAL="clearcoatNormal";Me.EMISSIVE="emissive";Me.ROTATION="rotation";Me.SHEEN="sheen";Me.SHEEN_ROUGHNESS="sheenRoughness";Me.ANISOTROPY="anisotropy";Me.IRIDESCENCE="iridescence";Me.IRIDESCENCE_IOR="iridescenceIOR";Me.IRIDESCENCE_THICKNESS="iridescenceThickness";Me.IOR="ior";Me.TRANSMISSION="transmission";Me.THICKNESS="thickness";Me.ATTENUATION_DISTANCE="attenuationDistance";Me.ATTENUATION_COLOR="attenuationColor";Me.LINE_SCALE="scale";Me.LINE_DASH_SIZE="dashSize";Me.LINE_GAP_SIZE="gapSize";Me.LINE_WIDTH="linewidth";Me.LINE_DASH_OFFSET="dashOffset";Me.POINT_WIDTH="pointWidth";Me.DISPERSION="dispersion";Me.LIGHT_MAP="light";Me.AO_MAP="ao";const xq=tt(Me,Me.ALPHA_TEST),Ax=tt(Me,Me.COLOR),vq=tt(Me,Me.SHININESS),_q=tt(Me,Me.EMISSIVE),DB=tt(Me,Me.OPACITY),Cq=tt(Me,Me.SPECULAR),oV=tt(Me,Me.SPECULAR_INTENSITY),wq=tt(Me,Me.SPECULAR_COLOR),OC=tt(Me,Me.SPECULAR_STRENGTH),mR=tt(Me,Me.REFLECTIVITY),Sq=tt(Me,Me.ROUGHNESS),Mq=tt(Me,Me.METALNESS),Iq=tt(Me,Me.NORMAL).context({getUV:null}),Tq=tt(Me,Me.CLEARCOAT),Eq=tt(Me,Me.CLEARCOAT_ROUGHNESS),Rq=tt(Me,Me.CLEARCOAT_NORMAL).context({getUV:null}),Lq=tt(Me,Me.ROTATION),Bq=tt(Me,Me.SHEEN),Pq=tt(Me,Me.SHEEN_ROUGHNESS),Gq=tt(Me,Me.ANISOTROPY),kq=tt(Me,Me.IRIDESCENCE),Nq=tt(Me,Me.IRIDESCENCE_IOR),Dq=tt(Me,Me.IRIDESCENCE_THICKNESS),Fq=tt(Me,Me.TRANSMISSION),Vq=tt(Me,Me.THICKNESS),zq=tt(Me,Me.IOR),Uq=tt(Me,Me.ATTENUATION_DISTANCE),Xq=tt(Me,Me.ATTENUATION_COLOR),FL=tt(Me,Me.LINE_SCALE),l3=tt(Me,Me.LINE_DASH_SIZE),c3=tt(Me,Me.LINE_GAP_SIZE),gR=tt(Me,Me.LINE_WIDTH),aV=tt(Me,Me.LINE_DASH_OFFSET),Oq=tt(Me,Me.POINT_WIDTH),Zq=tt(Me,Me.DISPERSION),h3=tt(Me,Me.LIGHT_MAP),Wq=tt(Me,Me.AO_MAP),nb=$e(new Q).onReference(function(s){return s.material}).onRenderUpdate(function({material:s}){this.value.set(s.anisotropy*Math.cos(s.anisotropyRotation),s.anisotropy*Math.sin(s.anisotropyRotation))});class Hq extends wi{static get type(){return"ModelViewProjectionNode"}constructor(e=null){super("vec4"),this.positionNode=e}setup(e){if(e.shaderStage==="fragment")return Eo(e.context.mvp);const t=this.positionNode||Ts,i=e.renderer.nodes.modelViewMatrix||jd;return tl.mul(i).mul(t)}}const lV=we(Hq);class Nn extends Qt{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isInstanceIndexNode=!0}generate(e){const t=this.getNodeType(e),i=this.scope;let n;if(i===Nn.VERTEX)n=e.getVertexIndex();else if(i===Nn.INSTANCE)n=e.getInstanceIndex();else if(i===Nn.DRAW)n=e.getDrawIndex();else if(i===Nn.INVOCATION_LOCAL)n=e.getInvocationLocalIndex();else if(i===Nn.INVOCATION_SUBGROUP)n=e.getInvocationSubgroupIndex();else if(i===Nn.SUBGROUP)n=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+i);let r;return e.shaderStage==="vertex"||e.shaderStage==="compute"?r=n:r=Eo(this).build(e,t),r}}Nn.VERTEX="vertex";Nn.INSTANCE="instance";Nn.SUBGROUP="subgroup";Nn.INVOCATION_LOCAL="invocationLocal";Nn.INVOCATION_SUBGROUP="invocationSubgroup";Nn.DRAW="draw";const Qq=tt(Nn,Nn.VERTEX),Z1=tt(Nn,Nn.INSTANCE),T0e=tt(Nn,Nn.SUBGROUP),E0e=tt(Nn,Nn.INVOCATION_SUBGROUP),R0e=tt(Nn,Nn.INVOCATION_LOCAL),Kq=tt(Nn,Nn.DRAW);class Yq extends Qt{static get type(){return"InstanceNode"}constructor(e){super("void"),this.instanceMesh=e,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Zt.FRAME,this.buffer=null,this.bufferColor=null}setup(e){let t=this.instanceMatrixNode,i=this.instanceColorNode;const n=this.instanceMesh;if(t===null){const a=n.instanceMatrix;if(n.count<=1e3)t=V1(a.array,"mat4",Math.max(n.count,1)).element(Z1);else{const l=new Ww(a.array,16,1);this.buffer=l;const c=a.usage===Vs?nV:kL,h=[c(l,"vec4",16,0),c(l,"vec4",16,4),c(l,"vec4",16,8),c(l,"vec4",16,12)];t=_0(...h)}this.instanceMatrixNode=t}const r=n.instanceColor;if(r&&i===null){const a=new $o(r.array,3),l=r.usage===Vs?nV:kL;this.bufferColor=a,i=J(l(a,"vec3",3,0)),this.instanceColorNode=i}const o=t.mul(Ts).xyz;if(Ts.assign(o),e.hasGeometryAttribute("normal")){const a=sq(ll,t);ll.assign(a)}this.instanceColorNode!==null&&bh("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMesh.instanceMatrix.usage!==Vs&&this.buffer!=null&&this.instanceMesh.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMesh.instanceMatrix.version),this.instanceMesh.instanceColor&&this.instanceMesh.instanceColor.usage!==Vs&&this.bufferColor!=null&&this.instanceMesh.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceMesh.instanceColor.version)}}const Jq=we(Yq);class jq extends Qt{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=Z1:this.batchingIdNode=Kq);const i=ne(([m])=>{const g=Zf(vc(this.batchMesh._indirectTexture),0),A=K(m).modInt(K(g)),y=K(m).div(K(g));return vc(this.batchMesh._indirectTexture,pd(A,y)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(K(this.batchingIdNode)),n=this.batchMesh._matricesTexture,r=Zf(vc(n),0),o=U(i).mul(4).toInt().toVar(),a=o.modInt(r),l=o.div(K(r)),c=_0(vc(n,pd(a,l)),vc(n,pd(a.add(1),l)),vc(n,pd(a.add(2),l)),vc(n,pd(a.add(3),l))),h=this.batchMesh._colorsTexture;if(h!==null){const g=ne(([A])=>{const y=Zf(vc(h),0).x,b=A,x=b.modInt(y),v=b.div(y);return vc(h,pd(x,v)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(i);bh("vec3","vBatchColor").assign(g)}const d=Qr(c);Ts.assign(c.mul(Ts));const u=ll.div(J(d[0].dot(d[0]),d[1].dot(d[1]),d[2].dot(d[2]))),f=d.mul(u).xyz;ll.assign(f),e.hasGeometryAttribute("tangent")&&U1.mulAssign(d)}}const qq=we(jq),UH=new WeakMap;class d3 extends Qt{static get type(){return"SkinningNode"}constructor(e,t=!1){super("void"),this.skinnedMesh=e,this.useReference=t,this.updateType=Zt.OBJECT,this.skinIndexNode=Dr("skinIndex","uvec4"),this.skinWeightNode=Dr("skinWeight","vec4");let i,n,r;t?(i=Ar("bindMatrix","mat4"),n=Ar("bindMatrixInverse","mat4"),r=sV("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(i=$e(e.bindMatrix,"mat4"),n=$e(e.bindMatrixInverse,"mat4"),r=V1(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=i,this.bindMatrixInverseNode=n,this.boneMatricesNode=r,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=Ts){const{skinIndexNode:i,skinWeightNode:n,bindMatrixNode:r,bindMatrixInverseNode:o}=this,a=e.element(i.x),l=e.element(i.y),c=e.element(i.z),h=e.element(i.w),d=r.mul(t),u=Yn(a.mul(n.x).mul(d),l.mul(n.y).mul(d),c.mul(n.z).mul(d),h.mul(n.w).mul(d));return o.mul(u).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=ll){const{skinIndexNode:i,skinWeightNode:n,bindMatrixNode:r,bindMatrixInverseNode:o}=this,a=e.element(i.x),l=e.element(i.y),c=e.element(i.z),h=e.element(i.w);let d=Yn(n.x.mul(a),n.y.mul(l),n.z.mul(c),n.w.mul(h));return d=o.mul(d).mul(r),d.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=sV("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,NL)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")}setup(e){this.needsPreviousBoneMatrices(e)&&NL.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(Ts.assign(t),e.hasGeometryAttribute("normal")){const i=this.getSkinnedNormal();ll.assign(i),e.hasGeometryAttribute("tangent")&&U1.assign(i)}}generate(e,t){if(t!=="void")return Ts.build(e,t)}update(e){const i=(this.useReference?e.object:this.skinnedMesh).skeleton;UH.get(i)!==e.frameId&&(UH.set(i,e.frameId),this.previousBoneMatricesNode!==null&&i.previousBoneMatrices.set(i.boneMatrices),i.update())}}const L0e=s=>me(new d3(s)),$q=s=>me(new d3(s,!0));class e$ extends Qt{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode("i".charCodeAt()+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const i={};for(let r=0,o=this.params.length-1;r<o;r++){const a=this.params[r],l=a.isNode!==!0&&a.name||this.getVarName(r),c=a.isNode!==!0&&a.type||"int";i[l]=fm(l,c)}const n=e.addStack();return t.returnsNode=this.params[this.params.length-1](i,n,e),t.stackNode=n,e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),i=this.params,n=t.stackNode;for(let a=0,l=i.length-1;a<l;a++){const c=i[a];let h=null,d=null,u=null,f=null,m=null,g=null;c.isNode?(f="int",u=this.getVarName(a),h="0",d=c.build(e,f),m="<"):(f=c.type||"int",u=c.name||this.getVarName(a),h=c.start,d=c.end,m=c.condition,g=c.update,typeof h=="number"?h=h.toString():h&&h.isNode&&(h=h.build(e,f)),typeof d=="number"?d=d.toString():d&&d.isNode&&(d=d.build(e,f)),h!==void 0&&d===void 0?(h=h+" - 1",d="0",m=">="):d!==void 0&&h===void 0&&(h="0",m="<"),m===void 0&&(Number(h)>Number(d)?m=">=":m="<"));const A={start:h,end:d,condition:m},y=A.start,b=A.end;let x="",v="",_="";g||(f==="int"||f==="uint"?m.includes("<")?g="++":g="--":m.includes("<")?g="+= 1.":g="-= 1."),x+=e.getVar(f,u)+" = "+y,v+=u+" "+m+" "+b,_+=u+" "+g;const C=`for ( ${x}; ${v}; ${_} )`;e.addFlowCode((a===0?`
`:"")+e.tab+C+` {

`).addFlowTab()}const r=n.build(e,"void"),o=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+r);for(let a=0,l=this.params.length-1;a<l;a++)e.addFlowCode((a===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),o}}const Li=(...s)=>me(new e$(v0(s,"int"))).append(),B0e=()=>fm("continue").append(),FB=()=>fm("break").append(),P0e=(...s)=>(console.warn("TSL.LoopNode: loop() has been renamed to Loop()."),Li(...s)),rk=new WeakMap,yl=new Je,XH=ne(({bufferMap:s,influence:e,stride:t,width:i,depth:n,offset:r})=>{const o=K(Qq).mul(t).add(r),a=o.div(i),l=o.sub(a.mul(i));return vc(s,pd(l,a)).depth(n).mul(e)});function G0e(s){const e=s.morphAttributes.position!==void 0,t=s.morphAttributes.normal!==void 0,i=s.morphAttributes.color!==void 0,n=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,r=n!==void 0?n.length:0;let o=rk.get(s);if(o===void 0||o.count!==r){let y=function(){g.dispose(),rk.delete(s),s.removeEventListener("dispose",y)};o!==void 0&&o.texture.dispose();const a=s.morphAttributes.position||[],l=s.morphAttributes.normal||[],c=s.morphAttributes.color||[];let h=0;e===!0&&(h=1),t===!0&&(h=2),i===!0&&(h=3);let d=s.attributes.position.count*h,u=1;const f=4096;d>f&&(u=Math.ceil(d/f),d=f);const m=new Float32Array(d*u*4*r),g=new b1(m,d,u,r);g.type=$i,g.needsUpdate=!0;const A=h*4;for(let b=0;b<r;b++){const x=a[b],v=l[b],_=c[b],C=d*u*4*b;for(let S=0;S<x.count;S++){const M=S*A;e===!0&&(yl.fromBufferAttribute(x,S),m[C+M+0]=yl.x,m[C+M+1]=yl.y,m[C+M+2]=yl.z,m[C+M+3]=0),t===!0&&(yl.fromBufferAttribute(v,S),m[C+M+4]=yl.x,m[C+M+5]=yl.y,m[C+M+6]=yl.z,m[C+M+7]=0),i===!0&&(yl.fromBufferAttribute(_,S),m[C+M+8]=yl.x,m[C+M+9]=yl.y,m[C+M+10]=yl.z,m[C+M+11]=_.itemSize===4?yl.w:1)}}o={count:r,texture:g,stride:h,size:new Q(d,u)},rk.set(s,o),s.addEventListener("dispose",y)}return o}class t$ extends Qt{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=$e(1),this.updateType=Zt.OBJECT}setup(e){const{geometry:t}=e,i=t.morphAttributes.position!==void 0,n=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,r=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=r!==void 0?r.length:0,{texture:a,stride:l,size:c}=G0e(t);i===!0&&Ts.mulAssign(this.morphBaseInfluence),n===!0&&ll.mulAssign(this.morphBaseInfluence);const h=K(c.width);Li(o,({i:d})=>{const u=U(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?u.assign(vc(this.mesh.morphTexture,pd(K(d).add(1),K(Z1))).r):u.assign(Ar("morphTargetInfluences","float").element(d).toVar()),i===!0&&Ts.addAssign(XH({bufferMap:a,influence:u,stride:l,width:h,depth:d,offset:K(0)})),n===!0&&ll.addAssign(XH({bufferMap:a,influence:u,stride:l,width:h,depth:d,offset:K(1)}))})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,i)=>t+i,0)}}const i$=we(t$),k0e=s=>s.sort((e,t)=>e.id-t.id),N0e=(s,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===s)return t;return null},ok=new WeakMap;class n$ extends Qt{static get type(){return"LightsNode"}constructor(e=[]){super("vec3"),this.totalDiffuseNode=J().toVar("totalDiffuse"),this.totalSpecularNode=J().toVar("totalSpecular"),this.outgoingLightNode=J().toVar("outgoingLight"),this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this.global=!0}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const i of this._lightNodes)t.push(i.getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getDataFromNode(this);for(const i of t.nodes)i.build(e)}setupLightsNode(e){const t=[],i=this._lightNodes,n=k0e(this._lights),r=e.renderer.nodes.library;for(const o of n)if(o.isNode)t.push(me(o));else{let a=null;if(i!==null&&(a=N0e(o.id,i)),a===null){const l=r.getLightNodeClass(o.constructor);if(l===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let c=null;ok.has(o)?c=ok.get(o):(c=new l(o),ok.set(o,c)),t.push(c)}}this._lightNodes=t}setup(e){this._lightNodes===null&&this.setupLightsNode(e);const t=e.context,i=t.lightingModel;let n=this.outgoingLightNode;if(i){const{_lightNodes:r,totalDiffuseNode:o,totalSpecularNode:a}=this;t.outgoingLight=n;const l=e.addStack(),c=e.getDataFromNode(this);c.nodes=l.nodes,i.start(t,l,e);for(const y of r)y.build(e);i.indirect(t,l,e);const{backdrop:h,backdropAlpha:d}=t,{directDiffuse:u,directSpecular:f,indirectDiffuse:m,indirectSpecular:g}=t.reflectedLight;let A=u.add(m);h!==null&&(d!==null?A=J(d.mix(A,h)):A=J(h),t.material.transparent=!0),o.assign(A),a.assign(f.add(g)),n.assign(o.add(a)),i.finish(t,l,e),n=n.bypass(e.removeStack())}return n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}}const s$=we(n$);class mA extends Qt{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}generate(){console.warn("Abstract function.")}}class r$ extends mA{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class o$ extends YX{static get type(){return"LightingContextNode"}constructor(e,t=null,i=null,n=null){super(e),this.lightingModel=t,this.backdropNode=i,this.backdropAlphaNode=n,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,i=J().toVar("directDiffuse"),n=J().toVar("directSpecular"),r=J().toVar("indirectDiffuse"),o=J().toVar("indirectSpecular"),a={directDiffuse:i,directSpecular:n,indirectDiffuse:r,indirectSpecular:o};return{radiance:J().toVar("radiance"),irradiance:J().toVar("irradiance"),iblIrradiance:J().toVar("iblIrradiance"),ambientOcclusion:U(1).toVar("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const a$=we(o$);class l$ extends mA{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let jv,qv;class zs extends Qt{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===zs.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Zt.NONE;return(this.scope===zs.SIZE||this.scope===zs.VIEWPORT)&&(e=Zt.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===zs.VIEWPORT?t!==null?qv.copy(t.viewport):(e.getViewport(qv),qv.multiplyScalar(e.getPixelRatio())):t!==null?(jv.width=t.width,jv.height=t.height):e.getDrawingBufferSize(jv)}setup(){const e=this.scope;let t=null;return e===zs.SIZE?t=$e(jv||(jv=new Q)):e===zs.VIEWPORT?t=$e(qv||(qv=new Je)):t=le(jx.div(yx)),t}generate(e){if(this.scope===zs.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const i=e.getNodeProperties(yx).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${i}.y - ${t}.y )`}return t}return super.generate(e)}}zs.COORDINATE="coordinate";zs.VIEWPORT="viewport";zs.SIZE="size";zs.UV="uv";const Pm=tt(zs,zs.UV),yx=tt(zs,zs.SIZE),jx=tt(zs,zs.COORDINATE),gp=tt(zs,zs.VIEWPORT),c$=gp.zw,h$=jx.sub(gp.xy),D0e=h$.div(c$),F0e=ne(()=>(console.warn('TSL.ViewportNode: "viewportResolution" is deprecated. Use "screenSize" instead.'),yx),"vec2").once()(),V0e=ne(()=>(console.warn('TSL.ViewportNode: "viewportTopLeft" is deprecated. Use "screenUV" instead.'),Pm),"vec2").once()(),z0e=ne(()=>(console.warn('TSL.ViewportNode: "viewportBottomLeft" is deprecated. Use "screenUV.flipY()" instead.'),Pm.flipY()),"vec2").once()(),$v=new Q;class W1 extends Jd{static get type(){return"ViewportTextureNode"}constructor(e=Pm,t=null,i=null){i===null&&(i=new ZU,i.minFilter=xr),super(i,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=Zt.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize($v);const i=this.value;(i.image.width!==$v.width||i.image.height!==$v.height)&&(i.image.width=$v.width,i.image.height=$v.height,i.needsUpdate=!0);const n=i.generateMipmaps;i.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(i),i.generateMipmaps=n}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const U0e=we(W1),d$=we(W1,null,null,{generateMipmaps:!0});let ak=null;class u$ extends W1{static get type(){return"ViewportDepthTextureNode"}constructor(e=Pm,t=null){ak===null&&(ak=new Bp),super(e,t,ak)}}const u3=we(u$);class Ta extends Qt{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===Ta.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,i=this.valueNode;let n=null;if(t===Ta.DEPTH_BASE)i!==null&&(n=f$().assign(i));else if(t===Ta.DEPTH)e.isPerspectiveCamera?n=p$(_o.z,tb,ib):n=ZC(_o.z,tb,ib);else if(t===Ta.LINEAR_DEPTH)if(i!==null)if(e.isPerspectiveCamera){const r=p3(i,tb,ib);n=ZC(r,tb,ib)}else n=i;else n=ZC(_o.z,tb,ib);return n}}Ta.DEPTH_BASE="depthBase";Ta.DEPTH="depth";Ta.LINEAR_DEPTH="linearDepth";const ZC=(s,e,t)=>s.add(e).div(e.sub(t)),X0e=(s,e,t)=>e.sub(t).mul(s).sub(e),p$=(s,e,t)=>e.add(s).mul(t).div(t.sub(e).mul(s)),p3=(s,e,t)=>e.mul(t).div(t.sub(e).mul(s).sub(t)),f$=we(Ta,Ta.DEPTH_BASE),f3=tt(Ta,Ta.DEPTH),VL=we(Ta,Ta.LINEAR_DEPTH),O0e=VL(u3());f3.assign=s=>f$(s);class mm extends Qt{static get type(){return"ClippingNode"}constructor(e=mm.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{localClipIntersection:i,localClippingCount:n,globalClippingCount:r}=t,o=r+n,a=i?o-n:o;return this.scope===mm.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(t.planes,o,a):this.setupDefault(t.planes,o,a)}setupAlphaToCoverage(e,t,i){return ne(()=>{const n=zd(e),r=el("float","distanceToPlane"),o=el("float","distanceToGradient"),a=el("float","clipOpacity");a.assign(1);let l;if(Li(i,({i:c})=>{l=n.element(c),r.assign(_o.dot(l.xyz).negate().add(l.w)),o.assign(r.fwidth().div(2)),a.mulAssign(Ga(o.negate(),o,r)),a.equal(0).discard()}),i<t){const c=el("float","unionclipOpacity");c.assign(1),Li({start:i,end:t},({i:h})=>{l=n.element(h),r.assign(_o.dot(l.xyz).negate().add(l.w)),o.assign(r.fwidth().div(2)),c.mulAssign(Ga(o.negate(),o,r).oneMinus())}),a.mulAssign(c.oneMinus())}rn.a.mulAssign(a),rn.a.equal(0).discard()})()}setupDefault(e,t,i){return ne(()=>{const n=zd(e);let r;if(Li(i,({i:o})=>{r=n.element(o),_o.dot(r.xyz).greaterThan(r.w).discard()}),i<t){const o=el("bool","clipped");o.assign(!0),Li({start:i,end:t},({i:a})=>{r=n.element(a),o.assign(_o.dot(r.xyz).greaterThan(r.w).and(o))}),o.discard()}})()}}mm.ALPHA_TO_COVERAGE="alphaToCoverage";mm.DEFAULT="default";const Z0e=()=>me(new mm),W0e=()=>me(new mm(mm.ALPHA_TO_COVERAGE));class Hi extends Yt{static get type(){return"NodeMaterial"}constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.type,this.forceSinglePass=!1,this.fog=!0,this.lights=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.depthNode=null,this.shadowNode=null,this.shadowPositionNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+yX(this)}build(e){this.setup(e)}setupObserver(e){return new o6(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.addStack(),e.stack.outputNode=this.vertexNode||this.setupPosition(e),e.addFlow("vertex",e.removeStack()),e.addStack();let t;const i=this.setupClipping(e);if(this.depthWrite===!0&&this.setupDepth(e),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const n=this.setupLighting(e);i!==null&&e.stack.add(i);const r=Xe(n,rn.a).max(0);if(t=this.setupOutput(e,r),PX.assign(t),this.outputNode!==null&&(t=this.outputNode),e.renderer.getRenderTarget()!==null){const a=e.renderer.getMRT(),l=this.mrtNode;a!==null?(t=a,l!==null&&(t=a.merge(l))):l!==null&&(t=l)}}else{let n=this.fragmentNode;n.isOutputStructNode!==!0&&(n=Xe(n)),t=this.setupOutput(e,n)}e.stack.outputNode=t,e.addFlow("fragment",e.removeStack()),e.monitor=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{globalClippingCount:t,localClippingCount:i}=e.clippingContext;let n=null;if(t||i){const r=e.renderer.samples;this.alphaToCoverage&&r>1?n=W0e():e.stack.add(Z0e())}return n}setupDepth(e){const{renderer:t}=e;let i=this.depthNode;if(i===null){const n="getMRT"in t&&t.getMRT();n&&n.has("depth")?i=n.get("depth"):t.logarithmicDepthBuffer===!0&&(i=lV().w.add(1).log2().mul(q7).mul(.5))}i!==null&&f3.assign(i).append()}setupPosition(e){const{object:t}=e,i=t.geometry;if(e.addStack(),(i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color)&&i$(t).append(),t.isSkinnedMesh===!0&&$q(t).append(),this.displacementMap){const r=xh("displacementMap","texture"),o=xh("displacementScale","float"),a=xh("displacementBias","float");Ts.addAssign(ll.normalize().mul(r.x.mul(o).add(a)))}t.isBatchedMesh&&qq(t).append(),t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&Jq(t).append(),this.positionNode!==null&&Ts.assign(this.positionNode);const n=lV();return e.context.vertex=e.removeStack(),e.context.mvp=n,n}setupDiffuseColor({object:e,geometry:t}){let i=this.colorNode?Xe(this.colorNode):Ax;this.vertexColors===!0&&t.hasAttribute("color")&&(i=Xe(i.xyz.mul(Dr("color","vec3")),i.a)),e.instanceColor&&(i=bh("vec3","vInstanceColor").mul(i)),e.isBatchedMesh&&e._colorsTexture&&(i=bh("vec3","vBatchColor").mul(i)),rn.assign(i);const n=this.opacityNode?U(this.opacityNode):DB;if(rn.a.assign(rn.a.mul(n)),this.alphaTestNode!==null||this.alphaTest>0){const r=this.alphaTestNode!==null?U(this.alphaTestNode):xq;rn.a.lessThanEqual(r).discard()}this.transparent===!1&&this.blending===fp&&this.alphaToCoverage===!1&&rn.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?J(0):rn.rgb}setupNormal(){return this.normalNode?J(this.normalNode):Iq}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?xh("envMap","cubeTexture"):xh("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new l$(h3)),t}setupLights(e){const t=[],i=this.setupEnvironment(e);i&&i.isLightingNode&&t.push(i);const n=this.setupLightMap(e);if(n&&n.isLightingNode&&t.push(n),this.aoNode!==null||e.material.aoMap){const o=this.aoNode!==null?this.aoNode:Wq;t.push(new r$(o))}let r=this.lightsNode||e.lightsNode;return t.length>0&&(r=s$([...r.getLights(),...t])),r}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:i,backdropAlphaNode:n,emissiveNode:r}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let l=this.setupOutgoingLight(e);if(a&&a.getScope().getLights().length>0){const c=this.setupLightingModel(e);l=a$(a,c,i,n)}else i!==null&&(l=J(n!==null?li(l,i,n):i));return(r&&r.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(iV.assign(J(r||_q)),l=l.add(iV)),l}setupOutput(e,t){if(this.fog===!0){const i=e.fogNode;i&&(t=Xe(i.mix(t.rgb,i.colorNode),t.a))}return t}setDefaultValues(e){for(const i in e){const n=e[i];this[i]===void 0&&(this[i]=n,n&&n.clone&&(this[i]=n.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const i in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,i)===void 0&&t[i].get!==void 0&&Object.defineProperty(this.constructor.prototype,i,t[i])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const i=Yt.prototype.toJSON.call(this,e),n=Qw(this);i.inputNodes={};for(const{property:o,childNode:a}of n)i.inputNodes[o]=a.toJSON(e).uuid;function r(o){const a=[];for(const l in o){const c=o[l];delete c.metadata,a.push(c)}return a}if(t){const o=r(e.textures),a=r(e.images),l=r(e.nodes);o.length>0&&(i.textures=o),a.length>0&&(i.images=a),l.length>0&&(i.nodes=l)}return i}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.depthNode=e.depthNode,this.shadowNode=e.shadowNode,this.shadowPositionNode=e.shadowPositionNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const H0e=new Td;class Q0e extends Hi{static get type(){return"InstancedPointsNodeMaterial"}constructor(e={}){super(),this.lights=!1,this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.pointWidth=1,this.pointColorNode=null,this.pointWidthNode=null,this.setDefaultValues(H0e),this.setValues(e)}setup(e){this.setupShaders(e),super.setup(e)}setupShaders({renderer:e}){const t=this.alphaToCoverage,i=this.useColor;this.vertexNode=ne(()=>{const n=Dr("instancePosition").xyz,r=Xe(jd.mul(Xe(n,1))),o=gp.z.div(gp.w),a=tl.mul(r),l=uo.xy.toVar();return l.mulAssign(this.pointWidthNode?this.pointWidthNode:Oq),l.assign(l.div(gp.z)),l.y.assign(l.y.mul(o)),l.assign(l.mul(a.w)),a.addAssign(Xe(l,0,0)),a})(),this.fragmentNode=ne(()=>{const n=U(1).toVar(),r=HX(hi().mul(2).sub(1));if(t&&e.samples>1){const a=U(r.fwidth()).toVar();n.assign(Ga(a.oneMinus(),a.add(1),r).oneMinus())}else r.greaterThan(1).discard();let o;return this.pointColorNode?o=this.pointColorNode:i?o=Dr("instanceColor").mul(Ax):o=Ax,n.mulAssign(DB),Xe(o,n)})()}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.needsUpdate=!0)}}const K0e=new _n;class Y0e extends Hi{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(K0e),this.setValues(e)}}const J0e=new yB;class j0e extends Hi{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.setDefaultValues(J0e),this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode,t=this.dashScaleNode?U(this.dashScaleNode):FL,i=this.dashSizeNode?U(this.dashSizeNode):l3,n=this.dashSizeNode?U(this.dashGapNode):c3;w0.assign(i),$w.assign(n);const r=Eo(Dr("lineDistance").mul(t));(e?r.add(e):r).mod(w0.add($w)).greaterThan(w0).discard()}}const q0e=new yB;class $0e extends Hi{static get type(){return"Line2NodeMaterial"}constructor(e={}){super(),this.lights=!1,this.setDefaultValues(q0e),this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.useDash=e.dashed,this.useWorldUnits=!1,this.dashOffset=0,this.lineWidth=1,this.lineColorNode=null,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setup(e){this.setupShaders(e),super.setup(e)}setupShaders({renderer:e}){const t=this.alphaToCoverage,i=this.useColor,n=this.dashed,r=this.worldUnits,o=ne(({start:l,end:c})=>{const h=tl.element(2).element(2),f=tl.element(3).element(2).mul(-.5).div(h).sub(l.z).div(c.z.sub(l.z));return Xe(li(l.xyz,c.xyz,f),c.w)}).setLayout({name:"trimSegment",type:"vec4",inputs:[{name:"start",type:"vec4"},{name:"end",type:"vec4"}]});this.vertexNode=ne(()=>{const l=Dr("instanceStart"),c=Dr("instanceEnd"),h=Xe(jd.mul(Xe(l,1))).toVar("start"),d=Xe(jd.mul(Xe(c,1))).toVar("end");r&&(bh("vec3","worldStart").assign(h.xyz),bh("vec3","worldEnd").assign(d.xyz));const u=gp.z.div(gp.w),f=tl.element(2).element(3).equal(-1);Rt(f,()=>{Rt(h.z.lessThan(0).and(d.z.greaterThan(0)),()=>{d.assign(o({start:h,end:d}))}).ElseIf(d.z.lessThan(0).and(h.z.greaterThanEqual(0)),()=>{h.assign(o({start:d,end:h}))})});const m=tl.mul(h),g=tl.mul(d),A=m.xyz.div(m.w),y=g.xyz.div(g.w),b=y.xy.sub(A.xy).toVar();b.x.assign(b.x.mul(u)),b.assign(b.normalize());const x=Xe().toVar();if(r){const v=d.xyz.sub(h.xyz).normalize(),_=li(h.xyz,d.xyz,.5).normalize(),C=v.cross(_).normalize(),S=v.cross(C),M=bh("vec4","worldPos");M.assign(uo.y.lessThan(.5).select(h,d));const L=gR.mul(.5);M.addAssign(Xe(uo.x.lessThan(0).select(C.mul(L),C.mul(L).negate()),0)),n||(M.addAssign(Xe(uo.y.lessThan(.5).select(v.mul(L).negate(),v.mul(L)),0)),M.addAssign(Xe(S.mul(L),0)),Rt(uo.y.greaterThan(1).or(uo.y.lessThan(0)),()=>{M.subAssign(Xe(S.mul(2).mul(L),0))})),x.assign(tl.mul(M));const w=J().toVar();w.assign(uo.y.lessThan(.5).select(A,y)),x.z.assign(w.z.mul(x.w))}else{const v=le(b.y,b.x.negate()).toVar("offset");b.x.assign(b.x.div(u)),v.x.assign(v.x.div(u)),v.assign(uo.x.lessThan(0).select(v.negate(),v)),Rt(uo.y.lessThan(0),()=>{v.assign(v.sub(b))}).ElseIf(uo.y.greaterThan(1),()=>{v.assign(v.add(b))}),v.assign(v.mul(gR)),v.assign(v.div(gp.w)),x.assign(uo.y.lessThan(.5).select(m,g)),v.assign(v.mul(x.w)),x.assign(x.add(Xe(v,0,0)))}return x})();const a=ne(({p1:l,p2:c,p3:h,p4:d})=>{const u=l.sub(h),f=d.sub(h),m=c.sub(l),g=u.dot(f),A=f.dot(m),y=u.dot(m),b=f.dot(f),v=m.dot(m).mul(b).sub(A.mul(A)),C=g.mul(A).sub(y.mul(b)).div(v).clamp(),S=g.add(A.mul(C)).div(b).clamp();return le(C,S)});this.fragmentNode=ne(()=>{const l=hi();if(n){const d=this.offsetNode?U(this.offsetNodeNode):aV,u=this.dashScaleNode?U(this.dashScaleNode):FL,f=this.dashSizeNode?U(this.dashSizeNode):l3,m=this.dashSizeNode?U(this.dashGapNode):c3;w0.assign(f),$w.assign(m);const g=Dr("instanceDistanceStart"),A=Dr("instanceDistanceEnd"),y=uo.y.lessThan(.5).select(u.mul(g),FL.mul(A)),b=Eo(y.add(aV)),x=d?b.add(d):b;l.y.lessThan(-1).or(l.y.greaterThan(1)).discard(),x.mod(w0.add($w)).greaterThan(w0).discard()}const c=U(1).toVar("alpha");if(r){const d=bh("vec3","worldStart"),u=bh("vec3","worldEnd"),f=bh("vec4","worldPos").xyz.normalize().mul(1e5),m=u.sub(d),g=a({p1:d,p2:u,p3:J(0,0,0),p4:f}),A=d.add(m.mul(g.x)),y=f.mul(g.y),v=A.sub(y).length().div(gR);if(!n)if(t&&e.samples>1){const _=v.fwidth();c.assign(Ga(_.negate().add(.5),_.add(.5),v).oneMinus())}else v.greaterThan(.5).discard()}else if(t&&e.samples>1){const d=l.x,u=l.y.greaterThan(0).select(l.y.sub(1),l.y.add(1)),f=d.mul(d).add(u.mul(u)),m=U(f.fwidth()).toVar("dlen");Rt(l.y.abs().greaterThan(1),()=>{c.assign(Ga(m.oneMinus(),m.add(1),f).oneMinus())})}else Rt(l.y.abs().greaterThan(1),()=>{const d=l.x,u=l.y.greaterThan(0).select(l.y.sub(1),l.y.add(1));d.mul(d).add(u.mul(u)).greaterThan(1).discard()});let h;if(this.lineColorNode)h=this.lineColorNode;else if(i){const d=Dr("instanceColorStart"),u=Dr("instanceColorEnd");h=uo.y.lessThan(.5).select(d,u).mul(Ax)}else h=Ax;return Xe(h,c)})()}get worldUnits(){return this.useWorldUnits}set worldUnits(e){this.useWorldUnits!==e&&(this.useWorldUnits=e,this.needsUpdate=!0)}get dashed(){return this.useDash}set dashed(e){this.useDash!==e&&(this.useDash=e,this.needsUpdate=!0)}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.needsUpdate=!0)}}const m$=s=>me(s).mul(.5).add(.5),eAe=s=>me(s).mul(2).sub(1),tAe=new I1;class iAe extends Hi{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.lights=!1,this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(tAe),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?U(this.opacityNode):DB;rn.assign(Xe(m$(cs),e))}}class g$ extends wi{static get type(){return"EquirectUVNode"}constructor(e=n3){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan2(e.x).mul(1/(Math.PI*2)).add(.5),i=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return le(t,i)}}const m3=we(g$);class A$ extends tB{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const i=t.minFilter,n=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r=new pn(5,5,5),o=m3(n3),a=new Hi;a.colorNode=Gi(t,o,0),a.side=vn,a.blending=Fn;const l=new fe(r,a),c=new sr;c.add(l),t.minFilter===xr&&(t.minFilter=Ot);const h=new eB(1,10,this),d=e.getMRT();return e.setMRT(null),h.update(e,c),e.setMRT(d),t.minFilter=i,t.currentGenerateMipmaps=n,l.geometry.dispose(),l.material.dispose(),this}}const WC=new WeakMap;class nAe extends wi{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=GB();const t=new hA;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=Zt.RENDER}updateBefore(e){const{renderer:t,material:i}=e,n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const r=n.isTextureNode?n.value:i[n.property];if(r&&r.isTexture){const o=r.mapping;if(o===wo||o===am){if(WC.has(r)){const a=WC.get(r);OH(a,r.mapping),this._cubeTexture=a}else{const a=r.image;if(sAe(a)){const l=new A$(a.height);l.fromEquirectangularTexture(t,r),OH(l.texture,r.mapping),this._cubeTexture=l.texture,WC.set(r,l.texture),r.addEventListener("dispose",y$)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function sAe(s){return s==null?!1:s.height>0}function y$(s){const e=s.target;e.removeEventListener("dispose",y$);const t=WC.get(e);t!==void 0&&(WC.delete(e),t.dispose())}function OH(s,e){e===wo?s.mapping=jl:e===am&&(s.mapping=zc)}const rAe=we(nAe);class VB extends mA{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=rAe(this.envNode)}}class oAe extends mA{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=U(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class H1{start(){}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class b$ extends H1{constructor(){super()}indirect(e,t,i){const n=e.ambientOcclusion,r=e.reflectedLight,o=i.context.irradianceLightMap;r.indirectDiffuse.assign(Xe(0)),o?r.indirectDiffuse.addAssign(o):r.indirectDiffuse.addAssign(Xe(1,1,1,0)),r.indirectDiffuse.mulAssign(n),r.indirectDiffuse.mulAssign(rn.rgb)}finish(e,t,i){const n=i.material,r=e.outgoingLight,o=i.context.environment;if(o)switch(n.combine){case Fx:r.rgb.assign(li(r.rgb,r.rgb.mul(o.rgb),OC.mul(mR)));break;case vU:r.rgb.assign(li(r.rgb,o.rgb,OC.mul(mR)));break;case _U:r.rgb.addAssign(o.rgb.mul(OC.mul(mR)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",n.combine);break}}}const aAe=new ii;class lAe extends Hi{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(aAe),this.setValues(e)}setupNormal(){return ql}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new VB(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new oAe(h3)),t}setupOutgoingLight(){return rn.rgb}setupLightingModel(){return new b$}}const bx=ne(({f0:s,f90:e,dotVH:t})=>{const i=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return s.mul(i.oneMinus()).add(e.mul(i))}),J0=ne(s=>s.diffuseColor.mul(1/Math.PI)),cAe=()=>U(.25),hAe=ne(({dotNH:s})=>RL.mul(U(.5)).add(1).mul(U(1/Math.PI)).mul(s.pow(RL))),dAe=ne(({lightDirection:s})=>{const e=s.add(Gn).normalize(),t=cs.dot(e).clamp(),i=Gn.dot(e).clamp(),n=bx({f0:ja,f90:1,dotVH:i}),r=cAe(),o=hAe({dotNH:t});return n.mul(r).mul(o)});class g3 extends b${constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:i}){const r=cs.dot(e).clamp().mul(t);i.directDiffuse.addAssign(r.mul(J0({diffuseColor:rn.rgb}))),this.specular===!0&&i.directSpecular.addAssign(r.mul(dAe({lightDirection:e})).mul(OC))}indirect({ambientOcclusion:e,irradiance:t,reflectedLight:i}){i.indirectDiffuse.addAssign(t.mul(J0({diffuseColor:rn}))),i.indirectDiffuse.mulAssign(e)}}const uAe=new AB;class pAe extends Hi{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(uAe),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new VB(t):null}setupLightingModel(){return new g3(!1)}}const fAe=new Of;class mAe extends Hi{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(fAe),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new VB(t):null}setupLightingModel(){return new g3}setupVariants(){const e=(this.shininessNode?U(this.shininessNode):vq).max(1e-4);RL.assign(e);const t=this.specularNode||Cq;ja.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const x$=ne(()=>{const s=ql.dFdx().abs().max(ql.dFdy().abs());return s.x.max(s.y).max(s.z)}),A3=ne(s=>{const{roughness:e}=s,t=x$();let i=e.max(.0525);return i=i.add(t),i=i.min(1),i}),v$=ne(({alpha:s,dotNL:e,dotNV:t})=>{const i=s.pow2(),n=e.mul(i.add(i.oneMinus().mul(t.pow2())).sqrt()),r=t.mul(i.add(i.oneMinus().mul(e.pow2())).sqrt());return Ph(.5,n.add(r).max(K6))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),gAe=ne(({alphaT:s,alphaB:e,dotTV:t,dotBV:i,dotTL:n,dotBL:r,dotNV:o,dotNL:a})=>{const l=a.mul(J(s.mul(t),e.mul(i),o).length()),c=o.mul(J(s.mul(n),e.mul(r),a).length());return Ph(.5,l.add(c)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),_$=ne(({alpha:s,dotNH:e})=>{const t=s.pow2(),i=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(i.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),AAe=U(1/Math.PI),yAe=ne(({alphaT:s,alphaB:e,dotNH:t,dotTH:i,dotBH:n})=>{const r=s.mul(e),o=J(e.mul(i),s.mul(n),r.mul(t)),a=o.dot(o),l=r.div(a);return AAe.mul(r.mul(l.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),cV=ne(s=>{const{lightDirection:e,f0:t,f90:i,roughness:n,f:r,USE_IRIDESCENCE:o,USE_ANISOTROPY:a}=s,l=s.normalView||cs,c=n.pow2(),h=e.add(Gn).normalize(),d=l.dot(e).clamp(),u=l.dot(Gn).clamp(),f=l.dot(h).clamp(),m=Gn.dot(h).clamp();let g=bx({f0:t,f90:i,dotVH:m}),A,y;if(Kw(o)&&(g=RB.mix(g,r)),Kw(a)){const b=zC.dot(e),x=zC.dot(Gn),v=zC.dot(h),_=C0.dot(e),C=C0.dot(Gn),S=C0.dot(h);A=gAe({alphaT:EL,alphaB:c,dotTV:x,dotBV:C,dotTL:b,dotBL:_,dotNV:u,dotNL:d}),y=yAe({alphaT:EL,alphaB:c,dotNH:f,dotTH:v,dotBH:S})}else A=v$({alpha:c,dotNL:d,dotNV:u}),y=_$({alpha:c,dotNH:f});return g.mul(A).mul(y)}),y3=ne(({roughness:s,dotNV:e})=>{const t=Xe(-1,-.0275,-.572,.022),i=Xe(1,.0425,1.04,-.04),n=s.mul(t).add(i),r=n.x.mul(n.x).min(e.mul(-9.28).exp2()).mul(n.x).add(n.y);return le(-1.04,1.04).mul(r).add(n.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),C$=ne(s=>{const{dotNV:e,specularColor:t,specularF90:i,roughness:n}=s,r=y3({dotNV:e,roughness:n});return t.mul(r.x).add(i.mul(r.y))}),w$=ne(({f:s,f90:e,dotVH:t})=>{const i=t.oneMinus().saturate(),n=i.mul(i),r=i.mul(n,n).clamp(0,.9999);return s.sub(J(e).mul(r)).div(r.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),bAe=ne(({roughness:s,dotNH:e})=>{const t=s.pow2(),i=U(1).div(t),r=e.pow2().oneMinus().max(.0078125);return U(2).add(i).mul(r.pow(i.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),xAe=ne(({dotNV:s,dotNL:e})=>U(1).div(U(4).mul(e.add(s).sub(e.mul(s))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),vAe=ne(({lightDirection:s})=>{const e=s.add(Gn).normalize(),t=cs.dot(s).clamp(),i=cs.dot(Gn).clamp(),n=cs.dot(e).clamp(),r=bAe({roughness:EB,dotNH:n}),o=xAe({dotNV:i,dotNL:t});return c0.mul(r).mul(o)}),_Ae=ne(({N:s,V:e,roughness:t})=>{const r=.0078125,o=s.dot(e).saturate(),a=le(t,o.oneMinus().sqrt());return a.assign(a.mul(.984375).add(r)),a}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),CAe=ne(({f:s})=>{const e=s.length();return Ri(e.mul(e).add(s.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),jI=ne(({v1:s,v2:e})=>{const t=s.dot(e),i=t.abs().toVar(),n=i.mul(.0145206).add(.4965155).mul(i).add(.8543985).toVar(),r=i.add(4.1616724).mul(i).add(3.417594).toVar(),o=n.div(r),a=t.greaterThan(0).select(o,Ri(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return s.cross(e).mul(a)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),ZH=ne(({N:s,V:e,P:t,mInv:i,p0:n,p1:r,p2:o,p3:a})=>{const l=r.sub(n).toVar(),c=a.sub(n).toVar(),h=l.cross(c),d=J().toVar();return Rt(h.dot(t.sub(n)).greaterThanEqual(0),()=>{const u=e.sub(s.mul(e.dot(s))).normalize(),f=s.cross(u).negate(),m=i.mul(Qr(u,f,s).transpose()).toVar(),g=m.mul(n.sub(t)).normalize().toVar(),A=m.mul(r.sub(t)).normalize().toVar(),y=m.mul(o.sub(t)).normalize().toVar(),b=m.mul(a.sub(t)).normalize().toVar(),x=J(0).toVar();x.addAssign(jI({v1:g,v2:A})),x.addAssign(jI({v1:A,v2:y})),x.addAssign(jI({v1:y,v2:b})),x.addAssign(jI({v1:b,v2:g})),d.assign(J(CAe({f:x})))}),d}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),zB=1/6,S$=s=>pi(zB,pi(s,pi(s,s.negate().add(3)).sub(3)).add(1)),hV=s=>pi(zB,pi(s,pi(s,pi(3,s).sub(6))).add(4)),M$=s=>pi(zB,pi(s,pi(s,pi(-3,s).add(3)).add(3)).add(1)),dV=s=>pi(zB,Ia(s,3)),WH=s=>S$(s).add(hV(s)),HH=s=>M$(s).add(dV(s)),QH=s=>Yn(-1,hV(s).div(S$(s).add(hV(s)))),KH=s=>Yn(1,dV(s).div(M$(s).add(dV(s)))),YH=(s,e,t)=>{const i=s.uvNode,n=pi(i,e.zw).add(.5),r=Lm(n),o=Bm(n),a=WH(o.x),l=HH(o.x),c=QH(o.x),h=KH(o.x),d=QH(o.y),u=KH(o.y),f=le(r.x.add(c),r.y.add(d)).sub(.5).mul(e.xy),m=le(r.x.add(h),r.y.add(d)).sub(.5).mul(e.xy),g=le(r.x.add(c),r.y.add(u)).sub(.5).mul(e.xy),A=le(r.x.add(h),r.y.add(u)).sub(.5).mul(e.xy),y=WH(o.y).mul(Yn(a.mul(s.uv(f).level(t)),l.mul(s.uv(m).level(t)))),b=HH(o.y).mul(Yn(a.mul(s.uv(g).level(t)),l.mul(s.uv(A).level(t))));return y.add(b)},I$=ne(([s,e=U(3)])=>{const t=le(s.size(K(e))),i=le(s.size(K(e.add(1)))),n=Ph(1,t),r=Ph(1,i),o=YH(s,Xe(n,t),Lm(e)),a=YH(s,Xe(r,i),OX(e));return Bm(e).mix(o,a)}),JH=ne(([s,e,t,i,n])=>{const r=J(QX(e.negate(),Bl(s),Ph(1,i))),o=J(S0(n[0].xyz),S0(n[1].xyz),S0(n[2].xyz));return Bl(r).mul(t.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),wAe=ne(([s,e])=>s.mul(qs(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),SAe=d$(),jH=ne(([s,e,t])=>{const i=SAe.uv(s),n=B1(U(yx.x)).mul(wAe(e,t));return I$(i,n)}),qH=ne(([s,e,t])=>(Rt(t.notEqual(0),()=>{const i=XX(e).negate().div(t);return UX(i.negate().mul(s))}),J(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),MAe=ne(([s,e,t,i,n,r,o,a,l,c,h,d,u,f,m])=>{let g,A;if(m){g=Xe().toVar(),A=J().toVar();const _=h.sub(1).mul(m.mul(.025)),C=J(h.sub(_),h,h.add(_));Li({start:0,end:3},({i:S})=>{const M=C.element(S),L=JH(s,e,d,M,a),w=o.add(L),E=c.mul(l.mul(Xe(w,1))),B=le(E.xy.div(E.w)).toVar();B.addAssign(1),B.divAssign(2),B.assign(le(B.x,B.y.oneMinus()));const P=jH(B,t,M);g.element(S).assign(P.element(S)),g.a.addAssign(P.a),A.element(S).assign(i.element(S).mul(qH(S0(L),u,f).element(S)))}),g.a.divAssign(3)}else{const _=JH(s,e,d,h,a),C=o.add(_),S=c.mul(l.mul(Xe(C,1))),M=le(S.xy.div(S.w)).toVar();M.addAssign(1),M.divAssign(2),M.assign(le(M.x,M.y.oneMinus())),g=jH(M,t,h),A=i.mul(qH(S0(_),u,f))}const y=A.rgb.mul(g.rgb),b=s.dot(e).clamp(),x=J(C$({dotNV:b,specularColor:n,specularF90:r,roughness:t})),v=A.r.add(A.g,A.b).div(3);return Xe(x.oneMinus().mul(y),g.a.oneMinus().mul(v).oneMinus())}),IAe=Qr(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),TAe=s=>{const e=s.sqrt();return J(1).add(e).div(J(1).sub(e))},$H=(s,e)=>s.sub(e).div(s.add(e)).pow2(),EAe=(s,e)=>{const t=s.mul(2*Math.PI*1e-9),i=J(54856e-17,44201e-17,52481e-17),n=J(1681e3,1795300,2208400),r=J(43278e5,93046e5,66121e5),o=U(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=i.mul(r.mul(2*Math.PI).sqrt()).mul(n.mul(t).add(e).cos()).mul(t.pow2().negate().mul(r).exp());return a=J(a.x.add(o),a.y,a.z).div(10685e-11),IAe.mul(a)},RAe=ne(({outsideIOR:s,eta2:e,cosTheta1:t,thinFilmThickness:i,baseF0:n})=>{const r=li(s,e,Ga(0,.03,i)),o=s.div(r).pow2().mul(U(1).sub(t.pow2())),l=U(1).sub(o).sqrt(),c=$H(r,s),h=bx({f0:c,f90:1,dotVH:t}),d=h.oneMinus(),u=r.lessThan(s).select(Math.PI,0),f=U(Math.PI).sub(u),m=TAe(n.clamp(0,.9999)),g=$H(m,r.toVec3()),A=bx({f0:g,f90:1,dotVH:l}),y=J(m.x.lessThan(r).select(Math.PI,0),m.y.lessThan(r).select(Math.PI,0),m.z.lessThan(r).select(Math.PI,0)),b=r.mul(i,l,2),x=J(f).add(y),v=h.mul(A).clamp(1e-5,.9999),_=v.sqrt(),C=d.pow2().mul(A).div(J(1).sub(v));let M=h.add(C),L=C.sub(d);for(let w=1;w<=2;++w){L=L.mul(_);const E=EAe(U(w).mul(b),U(w).mul(x)).mul(2);M=M.add(L.mul(E))}return M.max(J(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),LAe=ne(({normal:s,viewDir:e,roughness:t})=>{const i=s.dot(e).saturate(),n=t.pow2(),r=vo(t.lessThan(.25),U(-339.2).mul(n).add(U(161.4).mul(t)).sub(25.9),U(-8.48).mul(n).add(U(14.3).mul(t)).sub(9.95)),o=vo(t.lessThan(.25),U(44).mul(n).sub(U(23.7).mul(t)).add(3.26),U(1.97).mul(n).sub(U(3.27).mul(t)).add(.72));return vo(t.lessThan(.25),0,U(.1).mul(t).sub(.025)).add(r.mul(i).add(o).exp()).mul(1/Math.PI).saturate()}),lk=J(.04),ck=U(1);class UB extends H1{constructor(e=!1,t=!1,i=!1,n=!1,r=!1,o=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=i,this.anisotropy=n,this.transmission=r,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=J().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=J().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=J().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=J().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=J().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=cs.dot(Gn).clamp();this.iridescenceFresnel=RAe({outsideIOR:U(1),eta2:LX,cosTheta1:t,thinFilmThickness:BX,baseF0:ja}),this.iridescenceF0=w$({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=DL,i=i3.sub(DL).normalize(),n=s3;e.backdrop=MAe(n,i,vd,rn,ja,qw,t,kc,hl,tl,UC,GX,NX,kX,this.dispersion?DX:null),e.backdropAlpha=LL,rn.a.mulAssign(li(1,e.backdrop.a,LL))}}computeMultiscattering(e,t,i){const n=cs.dot(Gn).clamp(),r=y3({roughness:vd,dotNV:n}),a=(this.iridescenceF0?RB.mix(ja,this.iridescenceF0):ja).mul(r.x).add(i.mul(r.y)),c=r.x.add(r.y).oneMinus(),h=ja.add(ja.oneMinus().mul(.047619)),d=a.mul(h).div(c.mul(h).oneMinus());e.addAssign(a),t.addAssign(d.mul(c))}direct({lightDirection:e,lightColor:t,reflectedLight:i}){const r=cs.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(r.mul(vAe({lightDirection:e}))),this.clearcoat===!0){const a=wb.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(cV({lightDirection:e,f0:lk,f90:ck,roughness:jw,normalView:wb})))}i.directDiffuse.addAssign(r.mul(J0({diffuseColor:rn.rgb}))),i.directSpecular.addAssign(r.mul(cV({lightDirection:e,f0:ja,f90:1,roughness:vd,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:i,halfHeight:n,reflectedLight:r,ltc_1:o,ltc_2:a}){const l=t.add(i).sub(n),c=t.sub(i).sub(n),h=t.sub(i).add(n),d=t.add(i).add(n),u=cs,f=Gn,m=_o.toVar(),g=_Ae({N:u,V:f,roughness:vd}),A=o.uv(g).toVar(),y=a.uv(g).toVar(),b=Qr(J(A.x,0,A.y),J(0,1,0),J(A.z,0,A.w)).toVar(),x=ja.mul(y.x).add(ja.oneMinus().mul(y.y)).toVar();r.directSpecular.addAssign(e.mul(x).mul(ZH({N:u,V:f,P:m,mInv:b,p0:l,p1:c,p2:h,p3:d}))),r.directDiffuse.addAssign(e.mul(rn).mul(ZH({N:u,V:f,P:m,mInv:Qr(1,0,0,0,1,0,0,0,1),p0:l,p1:c,p2:h,p3:d})))}indirect(e,t,i){this.indirectDiffuse(e,t,i),this.indirectSpecular(e,t,i),this.ambientOcclusion(e,t,i)}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(J0({diffuseColor:rn})))}indirectSpecular({radiance:e,iblIrradiance:t,reflectedLight:i}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(t.mul(c0,LAe({normal:cs,viewDir:Gn,roughness:EB}))),this.clearcoat===!0){const c=wb.dot(Gn).clamp(),h=C$({dotNV:c,specularColor:lk,specularF90:ck,roughness:jw});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(h))}const n=J().toVar("singleScattering"),r=J().toVar("multiScattering"),o=t.mul(1/Math.PI);this.computeMultiscattering(n,r,qw);const a=n.add(r),l=rn.mul(a.r.max(a.g).max(a.b).oneMinus());i.indirectSpecular.addAssign(e.mul(n)),i.indirectSpecular.addAssign(r.mul(o)),i.indirectDiffuse.addAssign(l.mul(o))}ambientOcclusion({ambientOcclusion:e,reflectedLight:t}){const n=cs.dot(Gn).clamp().add(e),r=vd.mul(-16).oneMinus().negate().exp2(),o=e.sub(n.pow(r).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(e),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(e),t.indirectDiffuse.mulAssign(e),t.indirectSpecular.mulAssign(o)}finish(e){const{outgoingLight:t}=e;if(this.clearcoat===!0){const i=wb.dot(Gn).clamp(),n=bx({dotVH:i,f0:lk,f90:ck}),r=t.mul(TL.mul(n).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(TL));t.assign(r)}if(this.sheen===!0){const i=c0.r.max(c0.g).max(c0.b).mul(.157).oneMinus(),n=t.mul(i).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(n)}}}const e9=U(1),uV=U(-2),qI=U(.8),hk=U(-1),$I=U(.4),dk=U(2),eT=U(.305),uk=U(3),t9=U(.21),BAe=U(4),i9=U(4),PAe=U(16),GAe=ne(([s])=>{const e=J(xn(s)).toVar(),t=U(-1).toVar();return Rt(e.x.greaterThan(e.z),()=>{Rt(e.x.greaterThan(e.y),()=>{t.assign(vo(s.x.greaterThan(0),0,3))}).Else(()=>{t.assign(vo(s.y.greaterThan(0),1,4))})}).Else(()=>{Rt(e.z.greaterThan(e.y),()=>{t.assign(vo(s.z.greaterThan(0),2,5))}).Else(()=>{t.assign(vo(s.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),kAe=ne(([s,e])=>{const t=le().toVar();return Rt(e.equal(0),()=>{t.assign(le(s.z,s.y).div(xn(s.x)))}).ElseIf(e.equal(1),()=>{t.assign(le(s.x.negate(),s.z.negate()).div(xn(s.y)))}).ElseIf(e.equal(2),()=>{t.assign(le(s.x.negate(),s.y).div(xn(s.z)))}).ElseIf(e.equal(3),()=>{t.assign(le(s.z.negate(),s.y).div(xn(s.x)))}).ElseIf(e.equal(4),()=>{t.assign(le(s.x.negate(),s.z).div(xn(s.y)))}).Else(()=>{t.assign(le(s.x,s.y).div(xn(s.z)))}),pi(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),NAe=ne(([s])=>{const e=U(0).toVar();return Rt(s.greaterThanEqual(qI),()=>{e.assign(e9.sub(s).mul(hk.sub(uV)).div(e9.sub(qI)).add(uV))}).ElseIf(s.greaterThanEqual($I),()=>{e.assign(qI.sub(s).mul(dk.sub(hk)).div(qI.sub($I)).add(hk))}).ElseIf(s.greaterThanEqual(eT),()=>{e.assign($I.sub(s).mul(uk.sub(dk)).div($I.sub(eT)).add(dk))}).ElseIf(s.greaterThanEqual(t9),()=>{e.assign(eT.sub(s).mul(BAe.sub(uk)).div(eT.sub(t9)).add(uk))}).Else(()=>{e.assign(U(-2).mul(B1(pi(1.16,s))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),T$=ne(([s,e])=>{const t=s.toVar();t.assign(pi(2,t).sub(1));const i=J(t,1).toVar();return Rt(e.equal(0),()=>{i.assign(i.zyx)}).ElseIf(e.equal(1),()=>{i.assign(i.xzy),i.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{i.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{i.assign(i.zyx),i.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{i.assign(i.xzy),i.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{i.z.mulAssign(-1)}),i}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),E$=ne(([s,e,t,i,n,r])=>{const o=U(t),a=J(e),l=qs(NAe(o),uV,r),c=Bm(l),h=Lm(l),d=J(pV(s,a,h,i,n,r)).toVar();return Rt(c.notEqual(0),()=>{const u=J(pV(s,a,h.add(1),i,n,r)).toVar();d.assign(li(d,u,c))}),d}),pV=ne(([s,e,t,i,n,r])=>{const o=U(t).toVar(),a=J(e),l=U(GAe(a)).toVar(),c=U(Ri(i9.sub(o),0)).toVar();o.assign(Ri(o,i9));const h=U(BL(o)).toVar(),d=le(kAe(a,l).mul(h.sub(2)).add(1)).toVar();return Rt(l.greaterThan(2),()=>{d.y.addAssign(h),l.subAssign(3)}),d.x.addAssign(l.mul(h)),d.x.addAssign(c.mul(pi(3,PAe))),d.y.addAssign(pi(4,BL(r).sub(h))),d.x.mulAssign(i),d.y.mulAssign(n),s.uv(d).grad(le(),le())}),pk=ne(({envMap:s,mipInt:e,outputDirection:t,theta:i,axis:n,CUBEUV_TEXEL_WIDTH:r,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const l=Pl(i),c=t.mul(l).add(n.cross(t).mul(yo(i))).add(n.mul(n.dot(t).mul(l.oneMinus())));return pV(s,c,e,r,o,a)}),R$=ne(({n:s,latitudinal:e,poleAxis:t,outputDirection:i,weights:n,samples:r,dTheta:o,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:d})=>{const u=J(vo(e,t,Qb(t,i))).toVar();Rt(zX(u.equals(J(0))),()=>{u.assign(J(i.z,0,i.x.negate()))}),u.assign(Bl(u));const f=J().toVar();return f.addAssign(n.element(K(0)).mul(pk({theta:0,axis:u,outputDirection:i,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:d}))),Li({start:K(1),end:s},({i:m})=>{Rt(m.greaterThanEqual(r),()=>{FB()});const g=U(o.mul(U(m))).toVar();f.addAssign(n.element(m).mul(pk({theta:g.mul(-1),axis:u,outputDirection:i,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:d}))),f.addAssign(n.element(m).mul(pk({theta:g,axis:u,outputDirection:i,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:d})))}),Xe(f,1)});let zL=null;const n9=new WeakMap;function DAe(s){const e=Math.log2(s)-2,t=1/s;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:t,maxMip:e}}function FAe(s){let e=n9.get(s);if((e!==void 0?e.pmremVersion:-1)!==s.pmremVersion){const i=s.image;if(s.isCubeTexture)if(VAe(i))e=zL.fromCubemap(s,e);else return null;else if(zAe(i))e=zL.fromEquirectangular(s,e);else return null;e.pmremVersion=s.pmremVersion,n9.set(s,e)}return e.texture}class L$ extends wi{static get type(){return"PMREMNode"}constructor(e,t=null,i=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=i,this._generator=null;const n=new si;n.isRenderTargetTexture=!0,this._texture=Gi(n),this._width=$e(0),this._height=$e(0),this._maxMip=$e(0),this.updateBeforeType=Zt.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=DAe(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(){let e=this._pmrem;const t=e?e.pmremVersion:-1,i=this._value;t!==i.pmremVersion&&(i.isPMREMTexture===!0?e=i:e=FAe(i),e!==null&&(this._pmrem=e,this.updateFromTexture(e)))}setup(e){zL===null&&(zL=e.createPMREMGenerator()),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this));const i=this.value;e.renderer.coordinateSystem===Gc&&i.isPMREMTexture!==!0&&i.isRenderTargetTexture===!0&&(t=J(t.x.negate(),t.yz));let n=this.levelNode;return n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),E$(this._texture,t,n,this._width,this._height,this._maxMip)}}function VAe(s){if(s==null)return!1;let e=0;const t=6;for(let i=0;i<t;i++)s[i]!==void 0&&e++;return e===t}function zAe(s){return s==null?!1:s.height>0}const B$=we(L$),s9=new WeakMap;class P$ extends mA{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let i=this.envNode;if(i.isTextureNode||i.isMaterialReferenceNode){const f=i.isTextureNode?i.value:t[i.property];let m=s9.get(f);m===void 0&&(m=B$(f),s9.set(f,m)),i=m}const r=t.envMap?Ar("envMapIntensity","float",e.material):Ar("environmentIntensity","float",e.scene),a=t.useAnisotropy===!0||t.anisotropy>0?gq:cs,l=i.context(r9(vd,a)).mul(r),c=i.context(UAe(s3)).mul(Math.PI).mul(r),h=XC(l),d=XC(c);e.context.radiance.addAssign(h),e.context.iblIrradiance.addAssign(d);const u=e.context.lightingModel.clearcoatRadiance;if(u){const f=i.context(r9(jw,wb)).mul(r),m=XC(f);u.addAssign(m)}}}const r9=(s,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Gn.negate().reflect(e),t=s.mul(s).mix(t,e).normalize(),t=t.transformDirection(hl)),t),getTextureLevel:()=>s}},UAe=s=>({getUV:()=>s,getTextureLevel:()=>U(1)}),XAe=new Us;class G$ extends Hi{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(XAe),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new P$(t):null}setupLightingModel(){return new UB}setupSpecular(){const e=li(J(.04),rn.rgb,Jw);ja.assign(e),qw.assign(1)}setupVariants(){const e=this.metalnessNode?U(this.metalnessNode):Mq;Jw.assign(e);let t=this.roughnessNode?U(this.roughnessNode):Sq;t=A3({roughness:t}),vd.assign(t),this.setupSpecular(),rn.assign(Xe(rn.rgb.mul(e.oneMinus()),rn.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const OAe=new To;class k$ extends G${static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(OAe),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?U(this.iorNode):zq;UC.assign(e),ja.assign(li(Vr(WX(UC.sub(1).div(UC.add(1))).mul(wq),J(1)).mul(oV),rn.rgb,Jw)),qw.assign(li(oV,1,Jw))}setupLightingModel(){return new UB(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?U(this.clearcoatNode):Tq,i=this.clearcoatRoughnessNode?U(this.clearcoatRoughnessNode):Eq;TL.assign(t),jw.assign(A3({roughness:i}))}if(this.useSheen){const t=this.sheenNode?J(this.sheenNode):Bq,i=this.sheenRoughnessNode?U(this.sheenRoughnessNode):Pq;c0.assign(t),EB.assign(i)}if(this.useIridescence){const t=this.iridescenceNode?U(this.iridescenceNode):kq,i=this.iridescenceIORNode?U(this.iridescenceIORNode):Nq,n=this.iridescenceThicknessNode?U(this.iridescenceThicknessNode):Dq;RB.assign(t),LX.assign(i),BX.assign(n)}if(this.useAnisotropy){const t=(this.anisotropyNode?le(this.anisotropyNode):Gq).toVar();Mf.assign(t.length()),Rt(Mf.equal(0),()=>{t.assign(le(1,0))}).Else(()=>{t.divAssign(le(Mf)),Mf.assign(Mf.saturate())}),EL.assign(Mf.pow2().mix(vd.pow2(),1)),zC.assign(h0[0].mul(t.x).add(h0[1].mul(t.y))),C0.assign(h0[1].mul(t.x).sub(h0[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?U(this.transmissionNode):Fq,i=this.thicknessNode?U(this.thicknessNode):Vq,n=this.attenuationDistanceNode?U(this.attenuationDistanceNode):Uq,r=this.attenuationColorNode?J(this.attenuationColorNode):Xq;if(LL.assign(t),GX.assign(i),kX.assign(n),NX.assign(r),this.useDispersion){const o=this.dispersionNode?U(this.dispersionNode):Zq;DX.assign(o)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?J(this.clearcoatNormalNode):Rq}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}class ZAe extends UB{constructor(e,t,i,n){super(e,t,i),this.useSSS=n}direct({lightDirection:e,lightColor:t,reflectedLight:i},n,r){if(this.useSSS===!0){const o=r.material,{thicknessColorNode:a,thicknessDistortionNode:l,thicknessAmbientNode:c,thicknessAttenuationNode:h,thicknessPowerNode:d,thicknessScaleNode:u}=o,f=e.add(cs.mul(l)).normalize(),m=U(Gn.dot(f.negate()).saturate().pow(d).mul(u)),g=J(m.add(c).mul(a));i.directDiffuse.addAssign(g.mul(h.mul(t)))}super.direct({lightDirection:e,lightColor:t,reflectedLight:i},n,r)}}class WAe extends k${static get type(){return"MeshSSSNodeMaterial"}constructor(e){super(e),this.thicknessColorNode=null,this.thicknessDistortionNode=U(.1),this.thicknessAmbientNode=U(0),this.thicknessAttenuationNode=U(.1),this.thicknessPowerNode=U(2),this.thicknessScaleNode=U(10)}get useSSS(){return this.thicknessColorNode!==null}setupLightingModel(){return new ZAe(this.useClearcoat,this.useSheen,this.useIridescence,this.useSSS)}copy(e){return this.thicknessColorNode=e.thicknessColorNode,this.thicknessDistortionNode=e.thicknessDistortionNode,this.thicknessAmbientNode=e.thicknessAmbientNode,this.thicknessAttenuationNode=e.thicknessAttenuationNode,this.thicknessPowerNode=e.thicknessPowerNode,this.thicknessScaleNode=e.thicknessScaleNode,super.copy(e)}}const HAe=ne(({normal:s,lightDirection:e,builder:t})=>{const i=s.dot(e),n=le(i.mul(.5).add(.5),0);if(t.material.gradientMap){const r=xh("gradientMap","texture").context({getUV:()=>n});return J(r.r)}else{const r=n.fwidth().mul(.5);return li(J(.7),J(1),Ga(U(.7).sub(r.x),U(.7).add(r.x),n.x))}});class QAe extends H1{direct({lightDirection:e,lightColor:t,reflectedLight:i},n,r){const o=HAe({normal:BB,lightDirection:e,builder:r}).mul(t);i.directDiffuse.addAssign(o.mul(J0({diffuseColor:rn.rgb})))}indirect({ambientOcclusion:e,irradiance:t,reflectedLight:i}){i.indirectDiffuse.addAssign(t.mul(J0({diffuseColor:rn}))),i.indirectDiffuse.mulAssign(e)}}const KAe=new tX;class YAe extends Hi{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(KAe),this.setValues(e)}setupLightingModel(){return new QAe}}class N$ extends wi{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=J(Gn.z,0,Gn.x.negate()).normalize(),t=Gn.cross(e);return le(e.dot(cs),t.dot(cs)).mul(.495).add(.5)}}const D$=tt(N$),JAe=new iX;class jAe extends Hi{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.lights=!1,this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(JAe),this.setValues(e)}setupVariants(e){const t=D$;let i;e.material.matcap?i=xh("matcap","texture").context({getUV:()=>t}):i=J(li(.2,.8,t.y)),rn.rgb.mulAssign(i.rgb)}}const qAe=new Td;class $Ae extends Hi{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(qAe),this.setValues(e)}copy(e){return this.sizeNode=e.sizeNode,super.copy(e)}}class F$ extends wi{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:i}=this;if(this.getNodeType(e)==="vec2"){const r=t.cos(),o=t.sin();return L1(r,o,o.negate(),r).mul(i)}else{const r=t,o=_0(Xe(1,0,0,0),Xe(0,Pl(r.x),yo(r.x).negate(),0),Xe(0,yo(r.x),Pl(r.x),0),Xe(0,0,0,1)),a=_0(Xe(Pl(r.y),0,yo(r.y),0),Xe(0,1,0,0),Xe(yo(r.y).negate(),0,Pl(r.y),0),Xe(0,0,0,1)),l=_0(Xe(Pl(r.z),yo(r.z).negate(),0,0),Xe(yo(r.z),Pl(r.z),0,0),Xe(0,0,1,0),Xe(0,0,0,1));return o.mul(a).mul(l).mul(Xe(i,1)).xyz}}}const b3=we(F$),eye=new _1;class tye extends Hi{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(eye),this.setValues(e)}setupPosition({object:e,camera:t,context:i}){const n=this.sizeAttenuation,{positionNode:r,rotationNode:o,scaleNode:a}=this,l=Ts;let c=jd.mul(J(r||0)),h=le(kc[0].xyz.length(),kc[1].xyz.length());a!==null&&(h=h.mul(a)),!n&&t.isPerspectiveCamera&&(h=h.mul(c.z.negate()));let d=l.xy;if(e.center&&e.center.isVector2===!0){const g=qge("center","vec2");d=d.sub(g.sub(.5))}d=d.mul(h);const u=U(o||Lq),f=b3(d,u);c=Xe(c.xy.add(f),c.zw);const m=tl.mul(c);return i.vertex=l,m}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}class iye extends H1{constructor(){super(),this.shadowNode=U(1).toVar("shadowMask")}direct({shadowMask:e}){this.shadowNode.mulAssign(e)}finish(e){rn.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(rn.rgb)}}const nye=new M1;class sye extends Hi{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(nye),this.setValues(e)}setupLightingModel(){return new iye}}const rye=ne(({texture:s,uv:e})=>{const i=J().toVar();return Rt(e.x.lessThan(1e-4),()=>{i.assign(J(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{i.assign(J(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{i.assign(J(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{i.assign(J(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{i.assign(J(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{i.assign(J(0,0,-1))}).Else(()=>{const r=s.uv(e.add(J(-.01,0,0))).r.sub(s.uv(e.add(J(.01,0,0))).r),o=s.uv(e.add(J(0,-.01,0))).r.sub(s.uv(e.add(J(0,.01,0))).r),a=s.uv(e.add(J(0,0,-.01))).r.sub(s.uv(e.add(J(0,0,.01))).r);i.assign(J(r,o,a))}),i.normalize()});class V$ extends Jd{static get type(){return"Texture3DNode"}constructor(e,t=null,i=null){super(e,t,i),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return J(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){return t}generateUV(e,t){return t.build(e,"vec3")}normal(e){return rye({texture:this,uv:e})}}const z$=we(V$);class oye extends Hi{static get type(){return"VolumeNodeMaterial"}constructor(e={}){super(),this.lights=!1,this.isVolumeNodeMaterial=!0,this.testNode=null,this.setValues(e)}setup(e){const t=z$(this.map,null,0),i=ne(({orig:n,dir:r})=>{const o=J(-.5),a=J(.5),l=r.reciprocal(),c=o.sub(n).mul(l),h=a.sub(n).mul(l),d=Vr(c,h),u=Ri(c,h),f=Ri(d.x,Ri(d.y,d.z)),m=Vr(u.x,Vr(u.y,u.z));return le(f,m)});this.fragmentNode=ne(()=>{const n=Eo(J(eq.mul(Xe(i3,1)))),o=Eo(uo.sub(n)).normalize(),a=le(i({orig:n,dir:o})).toVar();a.x.greaterThan(a.y).discard(),a.assign(le(Ri(a.x,0),a.y));const l=J(n.add(a.x.mul(o))).toVar(),c=J(o.abs().reciprocal()).toVar(),h=U(Vr(c.x,Vr(c.y,c.z))).toVar("delta");h.divAssign(xh("steps","float"));const d=Xe(xh("base","color"),0).toVar();return Li({type:"float",start:a.x,end:a.y,update:"+= delta"},()=>{const u=el("float","d").assign(t.uv(l.add(.5)).r);this.testNode!==null?this.testNode({map:t,mapValue:u,probe:l,finalColor:d}).append():(d.a.assign(1),FB()),l.addAssign(o.mul(h))}),d.a.equal(0).discard(),Xe(d)})(),super.setup(e)}}class U$ extends ps{constructor(e){super(e),this.textures={},this.nodes={}}load(e,t,i,n){const r=new Is(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,o=>{try{t(this.parse(JSON.parse(o)))}catch(a){n?n(a):console.error(a),this.manager.itemError(e)}},i,n)}parseNodes(e){const t={};if(e!==void 0){for(const n of e){const{uuid:r,type:o}=n;t[r]=this.createNodeFromType(o),t[r].uuid=r}const i={nodes:t,textures:this.textures};for(const n of e)n.meta=i,t[n.uuid].deserialize(n),delete n.meta}return t}parse(e){const t=this.createNodeFromType(e.type);t.uuid=e.uuid;const n={nodes:this.parseNodes(e.nodes),textures:this.textures};return e.meta=n,t.deserialize(e),delete e.meta,t}setTextures(e){return this.textures=e,this}setNodes(e){return this.nodes=e,this}createNodeFromType(e){return this.nodes[e]===void 0?(console.error("THREE.NodeLoader: Node type not found:",e),U()):me(new this.nodes[e])}}class X$ extends E1{constructor(e){super(e),this.nodes={},this.nodeMaterials={}}parse(e){const t=super.parse(e),i=this.nodes,n=e.inputNodes;for(const r in n){const o=n[r];t[r]=i[o]}return t}setNodes(e){return this.nodes=e,this}setNodeMaterials(e){return this.nodeMaterials=e,this}createMaterialFromType(e){const t=this.nodeMaterials[e];return t!==void 0?new t:super.createMaterialFromType(e)}}class aye extends K8{constructor(e){super(e),this.nodes={},this.nodeMaterials={},this._nodesJSON=null}setNodes(e){return this.nodes=e,this}setNodeMaterials(e){return this.nodeMaterials=e,this}parse(e,t){this._nodesJSON=e.nodes;const i=super.parse(e,t);return this._nodesJSON=null,i}parseNodes(e,t){if(e!==void 0){const i=new U$;return i.setNodes(this.nodes),i.setTextures(t),i.parseNodes(e)}return{}}parseMaterials(e,t){const i={};if(e!==void 0){const n=this.parseNodes(this._nodesJSON,t),r=new X$;r.setTextures(t),r.setNodes(n),r.setNodeMaterials(this.nodeMaterials);for(let o=0,a=e.length;o<a;o++){const l=e[o];i[l.uuid]=r.parse(l)}}return i}}class fV{constructor(e,t,i=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=i}}class O${constructor(e,t,i){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=i.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class x3{constructor(e,t){this.isNodeVar=!0,this.name=e,this.type=t}}class Z$ extends x3{constructor(e,t){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0}}class W${constructor(e,t,i=""){this.name=e,this.type=t,this.code=i,Object.defineProperty(this,"isNodeCode",{value:!0})}}let lye=0;class AR{constructor(e=null){this.id=lye++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class v3 extends tn{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}const cye=(s,e)=>me(new v3(s,e));class _3 extends Qt{static get type(){return"CodeNode"}constructor(e="",t=[],i=""){super("code"),this.isCodeNode=!0,this.code=e,this.language=i,this.includes=t}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const n of t)n.build(e);const i=e.getCodeFromNode(this,this.getNodeType(e));return i.code=this.code,i.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}const XB=we(_3),hye=(s,e)=>XB(s,e,"js"),dye=(s,e)=>XB(s,e,"wgsl"),uye=(s,e)=>XB(s,e,"glsl");class C3 extends _3{static get type(){return"FunctionNode"}constructor(e="",t=[],i=""){super(e,t,i)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let i=t.nodeFunction;return i===void 0&&(i=e.parser.parseFunction(this.code),t.nodeFunction=i),i}generate(e,t){super.generate(e);const i=this.getNodeFunction(e),n=i.name,r=i.type,o=e.getCodeFromNode(this,r);n!==""&&(o.name=n);const a=e.getPropertyName(o),l=this.getNodeFunction(e).getCode(a);return o.code=l+`
`,t==="property"?a:e.format(`${a}()`,r,t)}}const H$=(s,e=[],t="")=>{for(let r=0;r<e.length;r++){const o=e[r];typeof o=="function"&&(e[r]=o.functionNode)}const i=me(new C3(s,e,t)),n=(...r)=>i.call(...r);return n.functionNode=i,n},pye=(s,e)=>H$(s,e,"glsl"),fye=(s,e)=>H$(s,e,"wgsl");class gA{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class mye extends gA{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class gye extends gA{constructor(e,t=new Q){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class Aye extends gA{constructor(e,t=new T){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class yye extends gA{constructor(e,t=new Je){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class bye extends gA{constructor(e,t=new ge){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class xye extends gA{constructor(e,t=new ei){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class vye extends gA{constructor(e,t=new ce){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class _ye extends mye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Cye extends gye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class wye extends Aye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Sye extends yye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Mye extends bye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Iye extends xye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Tye extends vye{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}}class Q$ extends Qt{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}If(e,t){const i=new VC(t);return this._currentCond=vo(e,i),this.add(this._currentCond)}ElseIf(e,t){const i=new VC(t),n=vo(e,i);return this._currentCond.elseNode=n,this._currentCond=n,this}Else(e){return this._currentCond.elseNode=new VC(e),this}build(e,...t){const i=IX();Yw(this);for(const n of this.nodes)n.build(e,"void");return Yw(i),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}else(...e){return console.warn("TSL.StackNode: .else() has been renamed to .Else()."),this.Else(...e)}elseif(...e){return console.warn("TSL.StackNode: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...e)}}const yR=we(Q$);class Eye{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let i=0;i<e.length;i++)if(t=t.get(e[i]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let i=this.weakMap;for(let n=0;n<e.length;n++){const r=e[n];i.has(r)===!1&&i.set(r,new WeakMap),i=i.get(r)}return i.set(e[e.length-1],t)}delete(e){let t=this.weakMap;for(let i=0;i<e.length;i++)if(t=t.get(e[i]),t===void 0)return!1;return t.delete(e[e.length-1])}}const Sb=4,o9=[.125,.215,.35,.446,.526,.582],Jg=20,fk=new zh(-1,1,1,-1,0,1),Rye=new Xt(90,1),a9=new ge;let mk=null,gk=0,Ak=0;const Hg=(1+Math.sqrt(5))/2,py=1/Hg,l9=[new T(-Hg,py,0),new T(Hg,py,0),new T(-py,0,Hg),new T(py,0,Hg),new T(0,Hg,-py),new T(0,Hg,py),new T(-1,1,-1),new T(1,1,-1),new T(-1,1,1),new T(1,1,1)],Lye=[3,1,5,0,4,2],yk=T$(hi(),Dr("faceIndex")).normalize(),w3=J(yk.x,yk.y.negate(),yk.z);class Bye{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}fromScene(e,t=0,i=.1,n=100){mk=this._renderer.getRenderTarget(),gk=this._renderer.getActiveCubeFace(),Ak=this._renderer.getActiveMipmapLevel(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=h9(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=d9(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(mk,gk,Ak),e.scissorTest=!1,tT(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===jl||e.mapping===zc?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),mk=this._renderer.getRenderTarget(),gk=this._renderer.getActiveCubeFace(),Ak=this._renderer.getActiveMipmapLevel();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Ot,minFilter:Ot,generateMipmaps:!1,type:Wi,format:bi,colorSpace:Ji},n=c9(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=c9(e,t,i);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=Pye(r)),this._blurMaterial=Gye(r,e,t)}return n}async _compileMaterial(e){const t=new fe(this._lodPlanes[0],e);await this._renderer.compile(t,fk)}_sceneToCubeUV(e,t,i,n){const r=Rye;r.near=t,r.far=i;const o=[-1,1,-1,-1,-1,-1],a=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear;l.getClearColor(a9),l.autoClear=!1;let h=this._backgroundBox;if(h===null){const f=new ii({name:"PMREM.Background",side:vn,depthWrite:!1,depthTest:!1});h=new fe(new pn,f)}let d=!1;const u=e.background;u?u.isColor&&(h.material.color.copy(u),e.background=null,d=!0):(h.material.color.copy(a9),d=!0),l.setRenderTarget(n),l.clear(),d&&l.render(h,r);for(let f=0;f<6;f++){const m=f%3;m===0?(r.up.set(0,o[f],0),r.lookAt(a[f],0,0)):m===1?(r.up.set(0,0,o[f]),r.lookAt(0,a[f],0)):(r.up.set(0,o[f],0),r.lookAt(0,0,a[f]));const g=this._cubeSize;tT(n,m*g,f>2?g:0,g,g),l.render(e,r)}l.autoClear=c,e.background=u}_textureToCubeUV(e,t){const i=this._renderer,n=e.mapping===jl||e.mapping===zc;n?this._cubemapMaterial===null&&(this._cubemapMaterial=h9(e)):this._equirectMaterial===null&&(this._equirectMaterial=d9(e));const r=n?this._cubemapMaterial:this._equirectMaterial;r.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=r;const a=this._cubeSize;tT(t,0,0,3*a,2*a),i.setRenderTarget(t),i.render(o,fk)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const n=this._lodPlanes.length;for(let r=1;r<n;r++){const o=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),a=l9[(n-r-1)%l9.length];this._blur(e,r-1,r,o,a)}t.autoClear=i}_blur(e,t,i,n,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,n,"latitudinal",r),this._halfBlur(o,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,d=this._lodMeshes[n];d.material=c;const u=c.uniforms,f=this._sizeLods[i]-1,m=isFinite(r)?Math.PI/(2*f):2*Math.PI/(2*Jg-1),g=r/m,A=isFinite(r)?1+Math.floor(h*g):Jg;A>Jg&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${A} samples when the maximum is set to ${Jg}`);const y=[];let b=0;for(let S=0;S<Jg;++S){const M=S/g,L=Math.exp(-M*M/2);y.push(L),S===0?b+=L:S<A&&(b+=2*L)}for(let S=0;S<y.length;S++)y[S]=y[S]/b;e.texture.frame=(e.texture.frame||0)+1,u.envMap.value=e.texture,u.samples.value=A,u.weights.array=y,u.latitudinal.value=o==="latitudinal"?1:0,a&&(u.poleAxis.value=a);const{_lodMax:x}=this;u.dTheta.value=m,u.mipInt.value=x-i;const v=this._sizeLods[n],_=3*v*(n>x-Sb?n-x+Sb:0),C=4*(this._cubeSize-v);tT(t,_,C,3*v,2*v),l.setRenderTarget(t),l.render(d,fk)}}function Pye(s){const e=[],t=[],i=[],n=[];let r=s;const o=s-Sb+1+o9.length;for(let a=0;a<o;a++){const l=Math.pow(2,r);t.push(l);let c=1/l;a>s-Sb?c=o9[a-s+Sb-1]:a===0&&(c=0),i.push(c);const h=1/(l-2),d=-h,u=1+h,f=[d,d,u,d,u,u,d,d,u,u,d,u],m=6,g=6,A=3,y=2,b=1,x=new Float32Array(A*g*m),v=new Float32Array(y*g*m),_=new Float32Array(b*g*m);for(let S=0;S<m;S++){const M=S%3*2/3-1,L=S>2?0:-1,w=[M,L,0,M+2/3,L,0,M+2/3,L+1,0,M,L,0,M+2/3,L+1,0,M,L+1,0],E=Lye[S];x.set(w,A*g*E),v.set(f,y*g*E);const B=[E,E,E,E,E,E];_.set(B,b*g*E)}const C=new It;C.setAttribute("position",new dt(x,A)),C.setAttribute("uv",new dt(v,y)),C.setAttribute("faceIndex",new dt(_,b)),e.push(C),n.push(new fe(C,null)),r>Sb&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i,lodMeshes:n}}function c9(s,e,t){const i=new vr(s,e,t);return i.texture.mapping=cA,i.texture.name="PMREM.cubeUv",i.texture.isPMREMTexture=!0,i.scissorTest=!0,i}function tT(s,e,t,i,n){s.viewport.set(e,t,i,n),s.scissor.set(e,t,i,n)}function S3(s){const e=new Hi;return e.depthTest=!1,e.depthWrite=!1,e.blending=Fn,e.name=`PMREM_${s}`,e}function Gye(s,e,t){const i=zd(new Array(Jg).fill(0)),n=$e(new T(0,1,0)),r=$e(0),o=U(Jg),a=$e(0),l=$e(1),c=Gi(null),h=$e(0),d=U(1/e),u=U(1/t),f=U(s),m={n:o,latitudinal:a,weights:i,poleAxis:n,outputDirection:w3,dTheta:r,samples:l,envMap:c,mipInt:h,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:f},g=S3("blur");return g.uniforms=m,g.fragmentNode=R$({...m,latitudinal:a.equal(1)}),g}function h9(s){const e=S3("cubemap");return e.fragmentNode=GB(s,w3),e}function d9(s){const e=S3("equirect");return e.fragmentNode=Gi(s,m3(w3),0),e}let kye=0;class u9{constructor(e="",t=[],i=0,n=[]){this.name=e,this.bindings=t,this.index=i,this.bindingsReference=n,this.id=kye++}}const p9=new WeakMap,Nye=new Map([[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),Dye=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),iT=s=>(s=Number(s),s+(s%1?"":".0"));class Fye{constructor(e,t,i){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=i,this.scene=null,this.camera=null,this.nodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.monitor=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.flow={code:""},this.chaining=[],this.stack=yR(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new AR,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.useComparisonMethod=!1}getBindGroupsCache(){let e=p9.get(this.renderer);return e===void 0&&(e=new Eye,p9.set(this.renderer,e)),e}createRenderTarget(e,t,i){return new vr(e,t,i)}createCubeRenderTarget(e,t){return new A$(e,t)}createPMREMGenerator(){return new Bye(this.renderer)}includes(e){return this.nodes.includes(e)}_getBindGroup(e,t){const i=this.getBindGroupsCache(),n=[];let r=!0;for(const a of t)n.push(a),r=r&&a.groupNode.shared!==!0;let o;return r?(o=i.get(n),o===void 0&&(o=new u9(e,n,this.bindingsIndexes[e].group,n),i.set(n,o))):o=new u9(e,n,this.bindingsIndexes[e].group,n),o}getBindGroupArray(e,t){const i=this.bindings[t];let n=i[e];return n===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),i[e]=n=[]),n}getBindings(){let e=this.bindGroups;if(e===null){const t={},i=this.bindings;for(const n of eV)for(const r in i[n]){const o=i[n][r];(t[r]||(t[r]=[])).push(...o)}e=[];for(const n in t){const r=t[n],o=this._getBindGroup(n,r);e.push(o)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,i)=>t.bindings[0].groupNode.order-i.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const i=e[t];this.bindingsIndexes[i.name].group=t,i.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}buildUpdateNodes(){for(const e of this.nodes){const t=e.getUpdateType(),i=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==Zt.NONE&&this.updateNodes.push(e.getSelf()),i!==Zt.NONE&&this.updateBeforeNodes.push(e.getSelf()),n!==Zt.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Ot||e.magFilter===mp||e.magFilter===Id||e.magFilter===xr||e.minFilter===Ot||e.minFilter===mp||e.minFilter===Id||e.minFilter===xr}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const i=this.getDataFromNode(e);return i.cache===void 0&&(i.cache=new AR(t?this.getCache():null)),i.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new ge:e==="vec2"?t=new Q:e==="vec3"?t=new T:e==="vec4"&&(t=new Je)),e==="float")return iT(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${iT(t.r)}, ${iT(t.g)}, ${iT(t.b)} )`;const i=this.getTypeLength(e),n=this.getComponentType(e),r=o=>this.generateConst(n,o);if(i===2)return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)} )`;if(i===3)return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)}, ${r(t.z)} )`;if(i===4)return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)}, ${r(t.z)}, ${r(t.w)} )`;if(i>4&&t&&(t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(r).join(", ")} )`;if(i>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const i=this.attributes;for(const r of i)if(r.name===e)return r;const n=new fV(e,t);return i.push(n),n}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Dd)return"int";if(t===Wr)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;const i=Nye.get(e);return(t==="float"?"":t[0])+i}getTypeFromArray(e){return Dye.get(e.constructor)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const i=t.array,n=e.itemSize,r=e.normalized;let o;return!(e instanceof y8)&&r!==!0&&(o=this.getTypeFromArray(i)),this.getTypeFromLength(n,o)}getTypeLength(e){const t=this.getVectorType(e),i=/vec([2-4])/.exec(t);return i!==null?Number(i[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}addStack(){return this.stack=yR(this.stack),this.stacks.push(IX()||this.stack),Yw(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,Yw(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,i=null){i=i===null?e.isGlobal(this)?this.globalCache:this.cache:i;let n=i.getData(e);return n===void 0&&(n={},i.setData(e,n)),n[t]===void 0&&(n[t]={}),n[t]}getNodeProperties(e,t="any"){const i=this.getDataFromNode(e,t);return i.properties||(i.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const i=this.getDataFromNode(e);let n=i.bufferAttribute;if(n===void 0){const r=this.uniforms.index++;n=new fV("nodeAttribute"+r,t,e),this.bufferAttributes.push(n),i.bufferAttribute=n}return n}getStructTypeFromNode(e,t=this.shaderStage){const i=this.getDataFromNode(e,t);if(i.structType===void 0){const n=this.structs.index++;e.name=`StructType${n}`,this.structs[t].push(e),i.structType=e}return e}getUniformFromNode(e,t,i=this.shaderStage,n=null){n==="in"&&(console.warn('NodeBuilder: "in" is a reserved word, using "inValue" instead.',e,n),e.name="inValue",n=e.name);const r=this.getDataFromNode(e,i,this.globalCache);let o=r.uniform;if(o===void 0){const a=this.uniforms.index++;o=new O$(n||"nodeUniform"+a,t,e),this.uniforms[i].push(o),r.uniform=o}return o}getVarFromNode(e,t=null,i=e.getNodeType(this),n=this.shaderStage){const r=this.getDataFromNode(e,n);let o=r.variable;if(o===void 0){const a=this.vars[n]||(this.vars[n]=[]);t===null&&(t="nodeVar"+a.length),o=new x3(t,i),a.push(o),r.variable=o}return o}getVaryingFromNode(e,t=null,i=e.getNodeType(this)){const n=this.getDataFromNode(e,"any");let r=n.varying;if(r===void 0){const o=this.varyings,a=o.length;t===null&&(t="nodeVarying"+a),r=new Z$(t,i),o.push(r),n.varying=r}return r}getCodeFromNode(e,t,i=this.shaderStage){const n=this.getDataFromNode(e);let r=n.code;if(r===void 0){const o=this.codes[i]||(this.codes[i]=[]),a=o.length;r=new W$("nodeCode"+a,t),o.push(r),n.code=r}return r}addFlowCodeHierarchy(e,t){const{flowCodes:i,flowCodeBlock:n}=this.getDataFromNode(e);let r=!0,o=t;for(;o;){if(n.get(o)===!0){r=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(r)for(const a of i)this.addLineFlowCode(a)}addLineFlowCodeBlock(e,t,i){const n=this.getDataFromNode(e),r=n.flowCodes||(n.flowCodes=[]),o=n.flowCodeBlock||(n.flowCodeBlock=new WeakMap);r.push(t),o.set(i,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),i=this.flowChildNode(e,t);return this.flowsData.set(e,i),i}buildFunctionNode(e){const t=new C3,i=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=i,t}flowShaderNode(e){const t=e.layout,i={[Symbol.iterator](){let o=0;const a=Object.values(this);return{next:()=>({value:a[o],done:o++>=a.length})}}};for(const o of t.inputs)i[o.name]=new v3(o.type,o.name);e.layout=null;const n=e.call(i),r=this.flowStagesNode(n,t.type);return e.layout=t,r}flowStagesNode(e,t=null){const i=this.flow,n=this.vars,r=this.cache,o=this.buildStage,a=this.stack,l={code:""};this.flow=l,this.vars={},this.cache=new AR,this.stack=yR();for(const c of $F)this.setBuildStage(c),l.result=e.build(this,t);return l.vars=this.getVars(this.shaderStage),this.flow=i,this.vars=n,this.cache=r,this.stack=a,this.setBuildStage(o),l}getFunctionOperator(){return null}flowChildNode(e,t=null){const i=this.flow,n={code:""};return this.flow=n,n.result=e.build(this,t),this.flow=i,n}flowNodeFromShaderStage(e,t,i=null,n=null){const r=this.shaderStage;this.setShaderStage(e);const o=this.flowChildNode(t,i);return n!==null&&(o.code+=`${this.tab+n} = ${o.result};
`),this.flowCode[e]=this.flowCode[e]+o.code,this.setShaderStage(r),o}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,t){return`${this.getType(e)} ${t}`}getVars(e){let t="";const i=this.vars[e];if(i!==void 0)for(const n of i)t+=`${this.getVar(n.type,n.name)}; `;return t}getUniforms(){console.warn("Abstract function.")}getCodes(e){const t=this.codes[e];let i="";if(t!==void 0)for(const n of t)i+=n.code+`
`;return i}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:t,renderer:i}=this;if(t!==null){let n=i.nodes.library.fromMaterial(t);n===null&&(console.error(`NodeMaterial: Material "${t.type}" is not compatible.`),n=new Hi),n.build(this)}else this.addFlow("compute",e);for(const n of $F){this.setBuildStage(n),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const r of eV){this.setShaderStage(r);const o=this.flowNodes[r];for(const a of o)n==="generate"?this.flowNode(a):a.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if(t==="float"||t==="int"||t==="uint")return new _ye(e);if(t==="vec2"||t==="ivec2"||t==="uvec2")return new Cye(e);if(t==="vec3"||t==="ivec3"||t==="uvec3")return new wye(e);if(t==="vec4"||t==="ivec4"||t==="uvec4")return new Sye(e);if(t==="color")return new Mye(e);if(t==="mat3")return new Iye(e);if(t==="mat4")return new Tye(e);throw new Error(`Uniform "${t}" not declared.`)}createNodeMaterial(e="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${e}() instead.`)}format(e,t,i){if(t=this.getVectorType(t),i=this.getVectorType(i),t===i||i===null||this.isReference(i))return e;const n=this.getTypeLength(t),r=this.getTypeLength(i);return n===16&&r===9?`${this.getType(i)}(${e}[0].xyz, ${e}[1].xyz, ${e}[2].xyz)`:n===9&&r===4?`${this.getType(i)}(${e}[0].xy, ${e}[1].xy)`:n>4||r>4||r===0?e:n===r?`${this.getType(i)}( ${e} )`:n>r?this.format(`${e}.${"xyz".slice(0,r)}`,this.getTypeFromLength(r,this.getComponentType(t)),i):r===4&&n>1?`${this.getType(i)}( ${this.format(e,t,"vec3")}, 1.0 )`:n===2?`${this.getType(i)}( ${this.format(e,t,"vec2")}, 0.0 )`:(n===1&&r>1&&t!==this.getComponentType(i)&&(e=`${this.getType(this.getComponentType(i))}( ${e} )`),`${this.getType(i)}( ${e} )`)}getSignature(){return`// Three.js r${La} - Node System
`}}class K${constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.startTime=null,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let i=e.get(t);return i===void 0&&(i={renderMap:new WeakMap,frameMap:new WeakMap},e.set(t,i)),i}updateBeforeNode(e){const t=e.getUpdateBeforeType(),i=e.updateReference(this);if(t===Zt.FRAME){const{frameMap:n}=this._getMaps(this.updateBeforeMap,i);n.get(i)!==this.frameId&&e.updateBefore(this)!==!1&&n.set(i,this.frameId)}else if(t===Zt.RENDER){const{renderMap:n}=this._getMaps(this.updateBeforeMap,i);n.get(i)!==this.renderId&&e.updateBefore(this)!==!1&&n.set(i,this.renderId)}else t===Zt.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),i=e.updateReference(this);if(t===Zt.FRAME){const{frameMap:n}=this._getMaps(this.updateAfterMap,i);n.get(i)!==this.frameId&&e.updateAfter(this)!==!1&&n.set(i,this.frameId)}else if(t===Zt.RENDER){const{renderMap:n}=this._getMaps(this.updateAfterMap,i);n.get(i)!==this.renderId&&e.updateAfter(this)!==!1&&n.set(i,this.renderId)}else t===Zt.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),i=e.updateReference(this);if(t===Zt.FRAME){const{frameMap:n}=this._getMaps(this.updateMap,i);n.get(i)!==this.frameId&&e.update(this)!==!1&&n.set(i,this.frameId)}else if(t===Zt.RENDER){const{renderMap:n}=this._getMaps(this.updateMap,i);n.get(i)!==this.renderId&&e.update(this)!==!1&&n.set(i,this.renderId)}else t===Zt.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class M3{constructor(e,t,i=null,n="",r=!1){this.type=e,this.name=t,this.count=i,this.qualifier=n,this.isConst=r}}M3.isNodeFunctionInput=!0;class Vye extends Qt{static get type(){return"StructTypeNode"}constructor(e){super(),this.types=e,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}class I3 extends Qt{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}setup(e){super.setup(e);const t=this.members,i=[];for(let n=0;n<t.length;n++)i.push(t[n].getNodeType(e));this.nodeType=e.getStructTypeFromNode(new Vye(i)).name}generate(e,t){const i=e.getOutputStructName(),n=this.members,r=i!==""?i+".":"";for(let o=0;o<n.length;o++){const a=n[o].build(e,t);e.addLineFlowCode(`${r}m${o} = ${a}`,this)}return i}}const zye=we(I3);function T3(s,e){for(let t=0;t<s.length;t++)if(s[t].name===e)return t;return-1}class Y$ extends I3{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.isMRTNode=!0}has(e){return this.outputNodes[e]!==void 0}get(e){return this.outputNodes[e]}merge(e){const t={...this.outputNodes,...e.outputNodes};return OB(t)}setup(e){const t=this.outputNodes,i=e.renderer.getRenderTarget(),n=[],r=i.textures;for(const o in t){const a=T3(r,o);n[a]=Xe(t[o])}return this.members=n,super.setup(e)}}const OB=we(Y$);class J$ extends Qt{static get type(){return"FunctionOverloadingNode"}constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFnCall=null,this.global=!0}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(e){const t=this.parametersNodes;let i=this._candidateFnCall;if(i===null){let n=null,r=-1;for(const o of this.functionNodes){const l=o.shaderNode.layout;if(l===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const c=l.inputs;if(t.length===c.length){let h=0;for(let d=0;d<t.length;d++){const u=t[d],f=c[d];u.getNodeType(e)===f.type?h++:h=0}h>r&&(n=o,r=h)}}this._candidateFnCall=i=n(...t)}return i}}const Uye=we(J$),Bo=s=>(...e)=>Uye(s,...e);class Xr extends fA{static get type(){return"TimerNode"}constructor(e=Xr.LOCAL,t=1,i=0){super(i),this.scope=e,this.scale=t,this.updateType=Zt.FRAME}update(e){const t=this.scope,i=this.scale;t===Xr.LOCAL?this.value+=e.deltaTime*i:t===Xr.DELTA?this.value=e.deltaTime*i:t===Xr.FRAME?this.value=e.frameId:this.value=e.time*i}serialize(e){super.serialize(e),e.scope=this.scope,e.scale=this.scale}deserialize(e){super.deserialize(e),this.scope=e.scope,this.scale=e.scale}}Xr.LOCAL="local";Xr.GLOBAL="global";Xr.DELTA="delta";Xr.FRAME="frame";const E3=(s,e=0)=>me(new Xr(Xr.LOCAL,s,e)),Xye=(s,e=0)=>me(new Xr(Xr.GLOBAL,s,e)),Oye=(s,e=0)=>me(new Xr(Xr.DELTA,s,e)),Zye=tt(Xr,Xr.FRAME).toUint();class yr extends Qt{static get type(){return"OscNode"}constructor(e=yr.SINE,t=E3()){super(),this.method=e,this.timeNode=t}getNodeType(e){return this.timeNode.getNodeType(e)}setup(){const e=this.method,t=me(this.timeNode);let i=null;return e===yr.SINE?i=t.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5):e===yr.SQUARE?i=t.fract().round():e===yr.TRIANGLE?i=t.add(.5).fract().mul(2).sub(1).abs():e===yr.SAWTOOTH&&(i=t.fract()),i}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}yr.SINE="sine";yr.SQUARE="square";yr.TRIANGLE="triangle";yr.SAWTOOTH="sawtooth";const Wye=we(yr,yr.SINE),Hye=we(yr,yr.SQUARE),Qye=we(yr,yr.TRIANGLE),Kye=we(yr,yr.SAWTOOTH);class j$ extends Qt{static get type(){return"SpriteSheetUVNode"}constructor(e,t=hi(),i=U(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=i}setup(){const{frameNode:e,uvNode:t,countNode:i}=this,{width:n,height:r}=i,o=e.mod(n.mul(r)).floor(),a=o.mod(n),l=r.sub(o.add(1).div(n).ceil()),c=i.reciprocal(),h=le(a,l);return t.add(h).mul(c)}}const Yye=we(j$);class q$ extends Rm{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}setup(e){return e.isAvailable("storageBuffer")===!1&&this.node.bufferObject===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let i;const n=e.context.assign;if(e.isAvailable("storageBuffer")===!1?this.node.bufferObject===!0&&n!==!0?i=e.generatePBO(this):i=this.node.build(e):i=super.generate(e),n!==!0){const r=this.getNodeType(e);i=e.format(i,r,t)}return i}}const Jye=we(q$);class $$ extends Qt{static get type(){return"TriplanarTexturesNode"}constructor(e,t=null,i=null,n=U(1),r=Ts,o=ll){super("vec4"),this.textureXNode=e,this.textureYNode=t,this.textureZNode=i,this.scaleNode=n,this.positionNode=r,this.normalNode=o}setup(){const{textureXNode:e,textureYNode:t,textureZNode:i,scaleNode:n,positionNode:r,normalNode:o}=this;let a=o.abs().normalize();a=a.div(a.dot(J(1)));const l=r.yz.mul(n),c=r.zx.mul(n),h=r.xy.mul(n),d=e.value,u=t!==null?t.value:d,f=i!==null?i.value:d,m=Gi(d,l).mul(a.x),g=Gi(u,c).mul(a.y),A=Gi(f,h).mul(a.z);return Yn(m,g,A)}}const eee=we($$),jye=(...s)=>eee(...s),fy=new js,mg=new T,my=new T,bk=new T,e_=new ce,nT=new T(0,0,-1),_u=new Je,t_=new T,sT=new T,i_=new Je,rT=new Q,f9=new vr,qye=Pm.flipX();let xk=!1;class tee extends Jd{static get type(){return"ReflectorNode"}constructor(e={}){super(f9.texture,qye);const{target:t=new ye,resolution:i=1,generateMipmaps:n=!1,bounces:r=!0}=e;this.target=t,this.resolution=i,this.generateMipmaps=n,this.bounces=r,this.updateBeforeType=r?Zt.RENDER:Zt.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new WeakMap}_updateResolution(e,t){const i=this.resolution;t.getDrawingBufferSize(rT),e.setSize(Math.round(rT.width*i),Math.round(rT.height*i))}setup(e){return this._updateResolution(f9,e.renderer),super.setup(e)}getTextureNode(){return this.textureNode}getVirtualCamera(e){let t=this.virtualCameras.get(e);return t===void 0&&(t=e.clone(),this.virtualCameras.set(e,t)),t}getRenderTarget(e){let t=this.renderTargets.get(e);return t===void 0&&(t=new vr(0,0,{type:Wi}),this.generateMipmaps===!0&&(t.texture.minFilter=Uj,t.texture.generateMipmaps=!0),this.renderTargets.set(e,t)),t}updateBefore(e){if(this.bounces===!1&&xk)return!1;xk=!0;const{scene:t,camera:i,renderer:n,material:r}=e,{target:o}=this,a=this.getVirtualCamera(i),l=this.getRenderTarget(a);if(n.getDrawingBufferSize(rT),this._updateResolution(l,n),my.setFromMatrixPosition(o.matrixWorld),bk.setFromMatrixPosition(i.matrixWorld),e_.extractRotation(o.matrixWorld),mg.set(0,0,1),mg.applyMatrix4(e_),t_.subVectors(my,bk),t_.dot(mg)>0)return;t_.reflect(mg).negate(),t_.add(my),e_.extractRotation(i.matrixWorld),nT.set(0,0,-1),nT.applyMatrix4(e_),nT.add(bk),sT.subVectors(my,nT),sT.reflect(mg).negate(),sT.add(my),a.coordinateSystem=i.coordinateSystem,a.position.copy(t_),a.up.set(0,1,0),a.up.applyMatrix4(e_),a.up.reflect(mg),a.lookAt(sT),a.near=i.near,a.far=i.far,a.updateMatrixWorld(),a.projectionMatrix.copy(i.projectionMatrix),fy.setFromNormalAndCoplanarPoint(mg,my),fy.applyMatrix4(a.matrixWorldInverse),_u.set(fy.normal.x,fy.normal.y,fy.normal.z,fy.constant);const c=a.projectionMatrix;i_.x=(Math.sign(_u.x)+c.elements[8])/c.elements[0],i_.y=(Math.sign(_u.y)+c.elements[9])/c.elements[5],i_.z=-1,i_.w=(1+c.elements[10])/c.elements[14],_u.multiplyScalar(1/_u.dot(i_));const h=0;c.elements[2]=_u.x,c.elements[6]=_u.y,c.elements[10]=_u.z-h,c.elements[14]=_u.w,this.value=l.texture,r.visible=!1;const d=n.getRenderTarget(),u=n.getMRT();n.setMRT(null),n.setRenderTarget(l),n.render(t,a),n.setMRT(u),n.setRenderTarget(d),r.visible=!0,xk=!1}}const $ye=s=>me(new tee(s)),vk=new zh(-1,1,1,-1,0,1);class ebe extends It{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new ut([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new ut(t,2))}}const tbe=new ebe;class iu extends fe{constructor(e=null){super(tbe,e),this.camera=vk,this.isQuadMesh=!0}renderAsync(e){return e.renderAsync(this,vk)}render(e){e.render(this,vk)}}const ibe=new Q;class iee extends Jd{static get type(){return"RTTNode"}constructor(e,t=null,i=null,n={type:Wi}){const r=new vr(t,i,n);super(r.texture,hi()),this.node=e,this.width=t,this.height=i,this.renderTarget=r,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this.updateMap=new WeakMap,this._rttNode=null,this._quadMesh=new iu(new Hi),this.updateBeforeType=Zt.RENDER}get autoSize(){return this.width===null}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,t){this.width=e,this.height=t;const i=e*this.pixelRatio,n=t*this.pixelRatio;this.renderTarget.setSize(i,n),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoSize===!0){this.pixelRatio=e.getPixelRatio();const i=e.getSize(ibe);this.setSize(i.width,i.height)}this._quadMesh.material.fragmentNode=this._rttNode;const t=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(t)}clone(){const e=new Jd(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}}const nee=(s,...e)=>me(new iee(me(s),...e)),Pa=(s,...e)=>s.isTextureNode?s:nee(s,...e);class see extends t3{static get type(){return"VertexColorNode"}constructor(e=0){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),i=e.hasGeometryAttribute(t);let n;return i===!0?n=super.generate(e):n=e.generateConst(this.nodeType,new Je(1,1,1,1)),n}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const nbe=(...s)=>me(new see(...s));class ree extends Qt{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const sbe=tt(ree);class Ih extends Qt{static get type(){return"SceneNode"}constructor(e=Ih.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,i=this.scene!==null?this.scene:e.scene;let n;return t===Ih.BACKGROUND_BLURRINESS?n=Ar("backgroundBlurriness","float",i):t===Ih.BACKGROUND_INTENSITY?n=Ar("backgroundIntensity","float",i):console.error("THREE.SceneNode: Unknown scope:",t),n}}Ih.BACKGROUND_BLURRINESS="backgroundBlurriness";Ih.BACKGROUND_INTENSITY="backgroundIntensity";const rbe=tt(Ih,Ih.BACKGROUND_BLURRINESS),obe=tt(Ih,Ih.BACKGROUND_INTENSITY),m9={Uniform:"uniform",Storage:"storage",ReadOnlyStorage:"read-only-storage"},_k={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"};class R3 extends kB{static get type(){return"StorageBufferNode"}constructor(e,t,i=0){super(e,t,i),this.isStorageBufferNode=!0,this.access=m9.Storage,this.isAtomic=!1,this.bufferObject=!1,this.bufferCount=i,this._attribute=null,this._varying=null,this.global=!0,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(this.bufferCount===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return"storageBuffer"}element(e){return Jye(this,e)}setBufferObject(e){return this.bufferObject=e,this}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(m9.ReadOnlyStorage)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}generate(e){if(e.isAvailable("storageBuffer"))return super.generate(e);const t=this.getNodeType(e);this._attribute===null&&(this._attribute=D1(this.value),this._varying=Eo(this._attribute));const i=this._varying.build(e,t);return e.registerTransform(i,this._attribute),i}}const abe=(s,e,t)=>me(new R3(s,e,t)),lbe=(s,e,t)=>me(new R3(s,e,t).setBufferObject(!0));class oee extends Jd{static get type(){return"StorageTextureNode"}constructor(e,t,i=null){super(e,t),this.storeNode=i,this.isStorageTextureNode=!0,this.access=_k.WriteOnly}getInputType(){return"storageTexture"}setup(e){super.setup(e);const t=e.getNodeProperties(this);t.storeNode=this.storeNode}setAccess(e){return this.access=e,this}generate(e,t){let i;return this.storeNode!==null?i=this.generateStore(e):i=super.generate(e,t),i}toReadOnly(){return this.setAccess(_k.ReadOnly)}toWriteOnly(){return this.setAccess(_k.WriteOnly)}generateStore(e){const t=e.getNodeProperties(this),{uvNode:i,storeNode:n}=t,r=super.generate(e,"property"),o=i.build(e,"uvec2"),a=n.build(e,"vec4"),l=e.generateTextureStore(e,r,o,a);e.addLineFlowCode(l,this)}}const aee=we(oee),cbe=(s,e,t)=>{const i=aee(s,e,t);return t!==null&&i.append(),i};class lee extends z1{static get type(){return"UserDataNode"}constructor(e,t,i=null){super(e,t,i),this.userData=i}updateReference(e){return this.reference=this.userData!==null?this.userData:e.object.userData,this.reference}}const hbe=(s,e,t)=>me(new lee(s,e,t));class cee extends wi{static get type(){return"PosterizeNode"}constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const dbe=we(cee);let Ck=null;class hee extends W1{static get type(){return"ViewportSharedTextureNode"}constructor(e=Pm,t=null){Ck===null&&(Ck=new ZU),super(e,t,Ck)}updateReference(){return this}}const ube=we(hee),pbe=new Q;class dee extends Jd{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class g9 extends dee{static get type(){return"PassMultipleTextureNode"}constructor(e,t,i=!1){super(e,null),this.textureName=t,this.previousTexture=i}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class Kr extends wi{static get type(){return"PassNode"}constructor(e,t,i,n={}){super("vec4"),this.scope=e,this.scene=t,this.camera=i,this.options=n,this._pixelRatio=1,this._width=1,this._height=1;const r=new Bp;r.isRenderTargetTexture=!0,r.name="depth";const o=new vr(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Wi,...n});o.texture.name="output",o.depthTexture=r,this.renderTarget=o,this.updateBeforeType=Zt.FRAME,this._textures={output:o.texture,depth:r},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=$e(0),this._cameraFar=$e(0),this._mrt=null,this.isPassNode=!0}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.isRenderTargetTexture=!0,t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),t.isRenderTargetTexture=!0,this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const i=this._textures[e],n=this.renderTarget.textures.indexOf(i);this.renderTarget.textures[n]=t,this._textures[e]=t,this._previousTextures[e]=i,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(this._textureNodes[e]=t=me(new g9(this,e)),this._textureNodes[e].updateTexture()),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),this._previousTextureNodes[e]=t=me(new g9(this,e,!0)),this._previousTextureNodes[e].updateTexture()),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const i=this._cameraNear,n=this._cameraFar;this._viewZNodes[e]=t=p3(this.getTextureNode(e),i,n)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const i=this._cameraNear,n=this._cameraFar,r=this.getViewZNode(e);this._linearDepthNodes[e]=t=ZC(r,i,n)}return t}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,e.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.renderTarget.depthTexture.isMultisampleRenderTargetTexture=this.renderTarget.samples>1,this.scope===Kr.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:i,camera:n}=this;this._pixelRatio=t.getPixelRatio();const r=t.getSize(pbe);this.setSize(r.width,r.height);const o=t.getRenderTarget(),a=t.getMRT();this._cameraNear.value=n.near,this._cameraFar.value=n.far;for(const l in this._previousTextures)this.toggleTexture(l);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(i,n),t.setRenderTarget(o),t.setMRT(a)}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget.setSize(i,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Kr.COLOR="color";Kr.DEPTH="depth";const fbe=(s,e,t)=>me(new Kr(Kr.COLOR,s,e,t)),qx=(s,e)=>me(new dee(s,e)),mbe=(s,e)=>me(new Kr(Kr.DEPTH,s,e)),A9=new iu,y9=new iu;class uee extends wi{static get type(){return"GaussianBlurNode"}constructor(e,t=null,i=2){super("vec4"),this.textureNode=e,this.directionNode=t,this.sigma=i,this._invSize=$e(new Q),this._passDirection=$e(new Q),this._horizontalRT=new vr,this._horizontalRT.texture.name="GaussianBlurNode.horizontal",this._verticalRT=new vr,this._verticalRT.texture.name="GaussianBlurNode.vertical",this._textureNode=qx(this,this._verticalRT.texture),this.updateBeforeType=Zt.RENDER,this.resolution=new Q(1,1)}setSize(e,t){e=Math.max(Math.round(e*this.resolution.x),1),t=Math.max(Math.round(t*this.resolution.y),1),this._invSize.value.set(1/e,1/t),this._horizontalRT.setSize(e,t),this._verticalRT.setSize(e,t)}updateBefore(e){const{renderer:t}=e,i=this.textureNode,n=i.value,r=t.getRenderTarget(),o=t.getMRT(),a=i.value;A9.material=this._material,y9.material=this._material,this.setSize(n.image.width,n.image.height);const l=n.type;this._horizontalRT.texture.type=l,this._verticalRT.texture.type=l,t.setMRT(null),t.setRenderTarget(this._horizontalRT),this._passDirection.value.set(1,0),A9.render(t),i.value=this._horizontalRT.texture,t.setRenderTarget(this._verticalRT),this._passDirection.value.set(0,1),y9.render(t),t.setRenderTarget(r),t.setMRT(o),i.value=a}getTextureNode(){return this._textureNode}setup(e){const t=this.textureNode;if(t.isTextureNode!==!0)return console.error("GaussianBlurNode requires a TextureNode."),Xe();const i=t.uvNode||hi(),n=le(this.directionNode||1),r=c=>t.uv(c),o=ne(()=>{const c=3+2*this.sigma,h=this._getCoefficients(c),d=this._invSize,u=n.mul(this._passDirection),f=U(h[0]).toVar(),m=Xe(r(i).mul(f)).toVar();for(let g=1;g<c;g++){const A=U(g),y=U(h[g]),b=le(u.mul(d.mul(A))).toVar(),x=Xe(r(i.add(b))),v=Xe(r(i.sub(b)));m.addAssign(x.add(v).mul(y)),f.addAssign(pi(2,y))}return m.div(f)}),a=this._material||(this._material=new Hi);a.fragmentNode=o().context(e.getSharedContext()),a.name="Gaussian_blur",a.needsUpdate=!0;const l=e.getNodeProperties(this);return l.textureNode=t,this._textureNode}dispose(){this._horizontalRT.dispose(),this._verticalRT.dispose()}_getCoefficients(e){const t=[];for(let i=0;i<e;i++)t.push(.39894*Math.exp(-.5*i*i/(e*e))/e);return t}}const gbe=(s,e,t)=>me(new uee(Pa(s),e,t)),wk=new Q,b9=new iu;class pee extends wi{static get type(){return"AfterImageNode"}constructor(e,t=.96){super(e),this.textureNode=e,this.textureNodeOld=Gi(),this.damp=$e(t),this._compRT=new vr,this._compRT.texture.name="AfterImageNode.comp",this._oldRT=new vr,this._oldRT.texture.name="AfterImageNode.old",this._textureNode=qx(this,this._compRT.texture),this.updateBeforeType=Zt.RENDER}getTextureNode(){return this._textureNode}setSize(e,t){this._compRT.setSize(e,t),this._oldRT.setSize(e,t)}updateBefore(e){const{renderer:t}=e,i=this.textureNode,r=i.value.type;this._compRT.texture.type=r,this._oldRT.texture.type=r,t.getDrawingBufferSize(wk),this.setSize(wk.x,wk.y);const o=t.getRenderTarget(),a=i.value;this.textureNodeOld.value=this._oldRT.texture,t.setRenderTarget(this._compRT),b9.render(t);const l=this._oldRT;this._oldRT=this._compRT,this._compRT=l,t.setRenderTarget(o),i.value=a}setup(e){const t=this.textureNode,i=this.textureNodeOld,n=t.uvNode||hi();i.uvNode=n;const r=h=>t.uv(h),o=ne(([h,d])=>{const u=U(d).toVar(),f=Xe(h).toVar();return Ri(P1(f.sub(u)),0)}),a=ne(()=>{const h=Xe(i),d=Xe(r(n));return h.mulAssign(this.damp.mul(o(h,.1))),Ri(d,h)}),l=this._materialComposed||(this._materialComposed=new Hi);l.name="AfterImage",l.fragmentNode=a(),b9.material=l;const c=e.getNodeProperties(this);return c.textureNode=t,this._textureNode}dispose(){this._compRT.dispose(),this._oldRT.dispose()}}const Abe=(s,e)=>me(new pee(Pa(s),e)),ybe=ne(([s])=>go(s.rgb)),bbe=ne(([s,e=U(1)])=>e.mix(go(s.rgb),s.rgb)),xbe=ne(([s,e=U(1)])=>{const t=Yn(s.r,s.g,s.b).div(3),i=s.r.max(s.g.max(s.b)),n=i.sub(t).mul(e).mul(-3);return li(s.rgb,i,n)}),vbe=ne(([s,e=U(1)])=>{const t=J(.57735,.57735,.57735),i=e.cos();return J(s.rgb.mul(i).add(t.cross(s.rgb).mul(e.sin()).add(t.mul(ls(t,s.rgb).mul(i.oneMinus())))))}),_be=new T,go=(s,e=J(...ni.getLuminanceCoefficients(_be)))=>ls(s,e),fee=(s,e)=>li(J(0),s,go(s).sub(e).max(0)),x9=new iu;class mee extends wi{static get type(){return"AnamorphicNode"}constructor(e,t,i,n){super("vec4"),this.textureNode=e,this.tresholdNode=t,this.scaleNode=i,this.colorNode=J(.1,0,1),this.samples=n,this.resolution=new Q(1,1),this._renderTarget=new vr,this._renderTarget.texture.name="anamorphic",this._invSize=$e(new Q),this._textureNode=qx(this,this._renderTarget.texture),this.updateBeforeType=Zt.RENDER}getTextureNode(){return this._textureNode}setSize(e,t){this._invSize.value.set(1/e,1/t),e=Math.max(Math.round(e*this.resolution.x),1),t=Math.max(Math.round(t*this.resolution.y),1),this._renderTarget.setSize(e,t)}updateBefore(e){const{renderer:t}=e,i=this.textureNode,n=i.value;this._renderTarget.texture.type=n.type;const r=t.getRenderTarget(),o=i.value;x9.material=this._material,this.setSize(n.image.width,n.image.height),t.setRenderTarget(this._renderTarget),x9.render(t),t.setRenderTarget(r),i.value=o}setup(e){const t=this.textureNode,i=t.uvNode||hi(),n=l=>t.uv(l),r=ne(()=>{const l=this.samples,c=Math.floor(l/2),h=J(0).toVar();return Li({start:-c,end:c},({i:d})=>{const u=U(d).abs().div(c).oneMinus(),f=le(i.x.add(this._invSize.x.mul(d).mul(this.scaleNode)),i.y),m=n(f),g=fee(m,this.tresholdNode).mul(u);h.addAssign(g)}),h.mul(this.colorNode)}),o=this._material||(this._material=new Hi);o.name="Anamorphic",o.fragmentNode=r();const a=e.getNodeProperties(this);return a.textureNode=t,this._textureNode}dispose(){this._renderTarget.dispose()}}const Cbe=(s,e=.9,t=3,i=32)=>me(new mee(Pa(s),me(e),me(t),i));class gee extends wi{static get type(){return"SobelOperatorNode"}constructor(e){super(),this.textureNode=e,this.updateBeforeType=Zt.RENDER,this._invSize=$e(new Q)}updateBefore(){const e=this.textureNode.value;this._invSize.value.set(1/e.image.width,1/e.image.height)}setup(){const{textureNode:e}=this,t=e.uvNode||hi(),i=o=>e.uv(o);return ne(()=>{const o=this._invSize,a=Qr(-1,-2,-1,0,0,0,1,2,1),l=Qr(-1,0,1,-2,0,2,-1,0,1),c=go(i(t.add(o.mul(le(-1,-1)))).xyz),h=go(i(t.add(o.mul(le(-1,0)))).xyz),d=go(i(t.add(o.mul(le(-1,1)))).xyz),u=go(i(t.add(o.mul(le(0,-1)))).xyz),f=go(i(t.add(o.mul(le(0,0)))).xyz),m=go(i(t.add(o.mul(le(0,1)))).xyz),g=go(i(t.add(o.mul(le(1,-1)))).xyz),A=go(i(t.add(o.mul(le(1,0)))).xyz),y=go(i(t.add(o.mul(le(1,1)))).xyz),b=Yn(a[0][0].mul(c),a[1][0].mul(u),a[2][0].mul(g),a[0][1].mul(h),a[1][1].mul(f),a[2][1].mul(A),a[0][2].mul(d),a[1][2].mul(m),a[2][2].mul(y)),x=Yn(l[0][0].mul(c),l[1][0].mul(u),l[2][0].mul(g),l[0][1].mul(h),l[1][1].mul(f),l[2][1].mul(A),l[0][2].mul(d),l[1][2].mul(m),l[2][2].mul(y)),v=b.mul(b).add(x.mul(x)).sqrt();return Xe(J(v),1)})()}}const wbe=s=>me(new gee(Pa(s)));class Aee extends wi{static get type(){return"DepthOfFieldNode"}constructor(e,t,i,n,r){super(),this.textureNode=e,this.viewZNode=t,this.focusNode=i,this.apertureNode=n,this.maxblurNode=r,this._aspect=$e(0),this.updateBeforeType=Zt.RENDER}updateBefore(){const e=this.textureNode.value;this._aspect.value=e.image.width/e.image.height}setup(){const e=this.textureNode,t=e.uvNode||hi(),i=o=>e.uv(o);return ne(()=>{const o=le(1,this._aspect),a=this.focusNode.add(this.viewZNode),l=le(qs(a.mul(this.apertureNode),this.maxblurNode.negate(),this.maxblurNode)),c=l.mul(.9),h=l.mul(.7),d=l.mul(.4);let u=Xe(0);return u=u.add(i(t)),u=u.add(i(t.add(le(0,.4).mul(o).mul(l)))),u=u.add(i(t.add(le(.15,.37).mul(o).mul(l)))),u=u.add(i(t.add(le(.29,.29).mul(o).mul(l)))),u=u.add(i(t.add(le(-.37,.15).mul(o).mul(l)))),u=u.add(i(t.add(le(.4,0).mul(o).mul(l)))),u=u.add(i(t.add(le(.37,-.15).mul(o).mul(l)))),u=u.add(i(t.add(le(.29,-.29).mul(o).mul(l)))),u=u.add(i(t.add(le(-.15,-.37).mul(o).mul(l)))),u=u.add(i(t.add(le(0,-.4).mul(o).mul(l)))),u=u.add(i(t.add(le(-.15,.37).mul(o).mul(l)))),u=u.add(i(t.add(le(-.29,.29).mul(o).mul(l)))),u=u.add(i(t.add(le(.37,.15).mul(o).mul(l)))),u=u.add(i(t.add(le(-.4,0).mul(o).mul(l)))),u=u.add(i(t.add(le(-.37,-.15).mul(o).mul(l)))),u=u.add(i(t.add(le(-.29,-.29).mul(o).mul(l)))),u=u.add(i(t.add(le(.15,-.37).mul(o).mul(l)))),u=u.add(i(t.add(le(.15,.37).mul(o).mul(c)))),u=u.add(i(t.add(le(-.37,.15).mul(o).mul(c)))),u=u.add(i(t.add(le(.37,-.15).mul(o).mul(c)))),u=u.add(i(t.add(le(-.15,-.37).mul(o).mul(c)))),u=u.add(i(t.add(le(-.15,.37).mul(o).mul(c)))),u=u.add(i(t.add(le(.37,.15).mul(o).mul(c)))),u=u.add(i(t.add(le(-.37,-.15).mul(o).mul(c)))),u=u.add(i(t.add(le(.15,-.37).mul(o).mul(c)))),u=u.add(i(t.add(le(.29,.29).mul(o).mul(h)))),u=u.add(i(t.add(le(.4,0).mul(o).mul(h)))),u=u.add(i(t.add(le(.29,-.29).mul(o).mul(h)))),u=u.add(i(t.add(le(0,-.4).mul(o).mul(h)))),u=u.add(i(t.add(le(-.29,.29).mul(o).mul(h)))),u=u.add(i(t.add(le(-.4,0).mul(o).mul(h)))),u=u.add(i(t.add(le(-.29,-.29).mul(o).mul(h)))),u=u.add(i(t.add(le(0,.4).mul(o).mul(h)))),u=u.add(i(t.add(le(.29,.29).mul(o).mul(d)))),u=u.add(i(t.add(le(.4,0).mul(o).mul(d)))),u=u.add(i(t.add(le(.29,-.29).mul(o).mul(d)))),u=u.add(i(t.add(le(0,-.4).mul(o).mul(d)))),u=u.add(i(t.add(le(-.29,.29).mul(o).mul(d)))),u=u.add(i(t.add(le(-.4,0).mul(o).mul(d)))),u=u.add(i(t.add(le(-.29,-.29).mul(o).mul(d)))),u=u.add(i(t.add(le(0,.4).mul(o).mul(d)))),u=u.div(41),u.a=1,Xe(u)})()}}const Sbe=(s,e,t=1,i=.025,n=1)=>me(new Aee(Pa(s),me(e),me(t),me(i),me(n)));class yee extends wi{static get type(){return"DotScreenNode"}constructor(e,t=new Q(.5,.5),i=1.57,n=1){super("vec4"),this.inputNode=e,this.center=$e(t),this.angle=$e(i),this.scale=$e(n)}setup(){const e=this.inputNode,t=ne(()=>{const r=yo(this.angle),o=Pl(this.angle),a=hi().mul(yx).sub(this.center),l=le(o.mul(a.x).sub(r.mul(a.y)),r.mul(a.x).add(o.mul(a.y))).mul(this.scale);return yo(l.x).mul(yo(l.y)).mul(4)});return ne(()=>{const r=e,o=Yn(r.r,r.g,r.b).div(3);return Xe(J(o.mul(10).sub(5).add(t())),r.a)})()}}const Mbe=(s,e,t,i)=>me(new yee(me(s),e,t,i));class bee extends wi{static get type(){return"RGBShiftNode"}constructor(e,t=.005,i=0){super("vec4"),this.textureNode=e,this.amount=$e(t),this.angle=$e(i)}setup(){const{textureNode:e}=this,t=e.uvNode||hi(),i=r=>e.uv(r);return ne(()=>{const r=le(Pl(this.angle),yo(this.angle)).mul(this.amount),o=i(t.add(r)),a=i(t),l=i(t.sub(r));return Xe(o.r,a.g,l.b,a.a)})()}}const Ibe=(s,e,t)=>me(new bee(Pa(s),e,t));class xee extends wi{static get type(){return"FilmNode"}constructor(e,t=null,i=null){super(),this.inputNode=e,this.intensityNode=t,this.uvNode=i}setup(){const e=this.uvNode||hi();return ne(()=>{const n=this.inputNode.rgb,r=KX(Bm(e.add(E3())));let o=n.add(n.mul(qs(r.add(.1),0,1)));return this.intensityNode!==null&&(o=li(n,o,this.intensityNode)),Xe(o,this.inputNode.a)})()}}const Tbe=we(xee);class vee extends wi{static get type(){return"Lut3DNode"}constructor(e,t,i,n){super(),this.inputNode=e,this.lutNode=t,this.size=$e(i),this.intensityNode=n}setup(){const{inputNode:e,lutNode:t}=this,i=o=>t.uv(o);return ne(()=>{const o=e,a=U(1).div(this.size),l=U(.5).div(this.size),c=J(l).add(o.rgb.mul(U(1).sub(a))),h=Xe(i(c).rgb,o.a);return Xe(li(o,h,this.intensityNode))})()}}const Ebe=(s,e,t,i)=>me(new vee(me(s),me(e),t,me(i))),v9=new iu,_9=new ge,Rbe=new Q;class _ee extends wi{static get type(){return"GTAONode"}constructor(e,t,i){super(),this.depthNode=e,this.normalNode=t,this.radius=$e(.25),this.resolution=$e(new Q),this.thickness=$e(1),this.distanceExponent=$e(1),this.distanceFallOff=$e(1),this.scale=$e(1),this.noiseNode=Gi(Lbe()),this.cameraProjectionMatrix=$e(i.projectionMatrix),this.cameraProjectionMatrixInverse=$e(i.projectionMatrixInverse),this.SAMPLES=$e(16),this._aoRenderTarget=new vr,this._aoRenderTarget.texture.name="GTAONode.AO",this._material=null,this._textureNode=qx(this,this._aoRenderTarget.texture),this.updateBeforeType=Zt.FRAME}getTextureNode(){return this._textureNode}setSize(e,t){this.resolution.value.set(e,t),this._aoRenderTarget.setSize(e,t)}updateBefore(e){const{renderer:t}=e,i=t.getDrawingBufferSize(Rbe),n=t.getRenderTarget(),r=t.getMRT();t.getClearColor(_9);const o=t.getClearAlpha();v9.material=this._material,this.setSize(i.width,i.height),t.setMRT(null),t.setClearColor(16777215,1),t.setRenderTarget(this._aoRenderTarget),v9.render(t),t.setRenderTarget(n),t.setMRT(r),t.setClearColor(_9,o)}setup(e){const t=hi(),i=c=>this.depthNode.uv(c).x,n=c=>this.noiseNode.uv(c),r=ne(([c])=>{const h=this.cameraProjectionMatrix.mul(Xe(c,1));let d=h.xy.div(h.w).mul(.5).add(.5).toVar();d=le(d.x,d.y.oneMinus());const u=i(d);return J(d,u)}),o=ne(([c,h])=>{c=le(c.x,c.y.oneMinus()).mul(2).sub(1);const d=Xe(J(c,h),1),u=Xe(this.cameraProjectionMatrixInverse.mul(d));return u.xyz.div(u.w)}),a=ne(()=>{const c=i(t);c.greaterThanEqual(1).discard();const h=o(t,c),d=this.normalNode.rgb.normalize(),u=this.radius,f=Zf(this.noiseNode,0);let m=le(t.x,t.y.oneMinus());m=m.mul(this.resolution.div(f));const g=n(m),A=g.xyz.mul(2).sub(1),y=J(A.xy,0).normalize(),b=J(y.y.mul(-1),y.x,0),x=Qr(y,b,J(0,0,1)),v=this.SAMPLES.lessThan(30).select(3,5),_=Yn(this.SAMPLES,v.sub(1)).div(v),C=U(0).toVar();return Li({start:K(0),end:v,type:"int",condition:"<"},({i:S})=>{const M=U(S).div(U(v)).mul(Y0),L=Xe(Pl(M),yo(M),0,Yn(.5,pi(.5,g.w)));L.xyz=Bl(x.mul(L.xyz));const w=Bl(h.xyz.negate()),E=Bl(Qb(L.xyz,w)),B=Qb(E,w),P=Bl(d.sub(E.mul(ls(d,E)))),k=Qb(P,E),X=le(ls(w,k),ls(w,k.negate())).toVar();Li({end:_,type:"int",name:"j",condition:"<"},({j:Pe})=>{const Oe=L.xyz.mul(u).mul(L.w).mul(Ia(Ph(U(Pe).add(1),U(_)),this.distanceExponent)),ae=r(h.add(Oe)),Se=o(ae.xy,ae.z).sub(h);Rt(xn(Se.z).lessThan(this.thickness),()=>{const Ct=ls(w,Bl(Se));X.x.addAssign(Ri(0,pi(Ct.sub(X.x),li(1,U(2).div(U(Pe).add(2)),this.distanceFallOff))))});const Le=r(h.sub(Oe)),ot=o(Le.xy,Le.z).sub(h);Rt(xn(ot.z).lessThan(this.thickness),()=>{const Ct=ls(w,Bl(ot));X.y.addAssign(Ri(0,pi(Ct.sub(X.y),li(1,U(2).div(U(Pe).add(2)),this.distanceFallOff))))})});const F=Xh(In(1,X.mul(X))),H=ls(P,B),W=ls(P,w),se=pi(.5,PL(X.y).sub(PL(X.x)).add(F.x.mul(X.x).sub(F.y.mul(X.y)))),de=pi(.5,In(2,X.x.mul(X.x)).sub(X.y.mul(X.y))),be=H.mul(se).add(W.mul(de));C.addAssign(be)}),C.assign(qs(C.div(v),0,1)),C.assign(Ia(C,this.scale)),Xe(J(C),1)}),l=this._material||(this._material=new Hi);return l.fragmentNode=a().context(e.getSharedContext()),l.name="GTAO",l.needsUpdate=!0,this._textureNode}dispose(){this._aoRenderTarget.dispose()}}function Lbe(s=5){const e=Math.floor(s)%2===0?Math.floor(s)+1:Math.floor(s),t=Bbe(e),i=t.length,n=new Uint8Array(i*4);for(let o=0;o<i;++o){const a=t[o],l=2*Math.PI*a/i,c=new T(Math.cos(l),Math.sin(l),0).normalize();n[o*4]=(c.x*.5+.5)*255,n[o*4+1]=(c.y*.5+.5)*255,n[o*4+2]=127,n[o*4+3]=255}const r=new ir(n,e,e);return r.wrapS=Mo,r.wrapT=Mo,r.needsUpdate=!0,r}function Bbe(s){const e=Math.floor(s)%2===0?Math.floor(s)+1:Math.floor(s),t=e*e,i=Array(t).fill(0);let n=Math.floor(e/2),r=e-1;for(let o=1;o<=t;){if(n===-1&&r===e?(r=e-2,n=0):(r===e&&(r=0),n<0&&(n=e-1)),i[n*e+r]!==0){r-=2,n++;continue}else i[n*e+r]=o++;r++,n--}return i}const Pbe=(s,e,t)=>me(new _ee(me(s),me(e),t));class Cee extends wi{static get type(){return"DenoiseNode"}constructor(e,t,i,n,r){super(),this.textureNode=e,this.depthNode=t,this.normalNode=i,this.noiseNode=n,this.cameraProjectionMatrixInverse=$e(r.projectionMatrixInverse),this.lumaPhi=$e(5),this.depthPhi=$e(5),this.normalPhi=$e(5),this.radius=$e(5),this.index=$e(0),this._resolution=$e(new Q),this._sampleVectors=zd(Gbe(16,2,1)),this.updateBeforeType=Zt.RENDER}updateBefore(){const e=this.textureNode.value;this._resolution.value.set(e.image.width,e.image.height)}setup(){const e=hi(),t=d=>this.textureNode.uv(d),i=d=>this.depthNode.uv(d).x,n=d=>this.normalNode.uv(d),r=d=>this.noiseNode.uv(d),o=ne(([d,u])=>{d=le(d.x,d.y.oneMinus()).mul(2).sub(1);const f=Xe(J(d,u),1),m=Xe(this.cameraProjectionMatrixInverse.mul(f));return m.xyz.div(m.w)}),a=ne(([d,u,f,m])=>{const g=t(m),A=i(m),y=n(m).rgb.normalize(),b=g.rgb,x=o(m,A),v=ls(u,y).toVar(),_=Ia(Ri(v,0),this.normalPhi).toVar(),C=xn(go(b).sub(go(d))).toVar(),S=Ri(U(1).sub(C.div(this.lumaPhi)),0).toVar(),M=xn(ls(f.sub(x),u)).toVar(),L=Ri(U(1).sub(M.div(this.depthPhi)),0),w=S.mul(L).mul(_);return Xe(b.mul(w),w)}),l=ne(([d])=>{const u=i(d),f=n(d).rgb.normalize(),m=t(d);Rt(u.greaterThanEqual(1).or(ls(f,f).equal(0)),()=>m);const g=J(m.rgb),A=o(d,u),y=Zf(this.noiseNode,0);let b=le(d.x,d.y.oneMinus());b=b.mul(this._resolution.div(y));const x=r(b),v=yo(x.element(this.index.mod(4).mul(2).mul(Y0))),_=Pl(x.element(this.index.mod(4).mul(2).mul(Y0))),C=le(v,_),S=L1(C.x,C.y.negate(),C.x,C.y),M=U(1).toVar(),L=J(m.rgb).toVar();return Li({start:K(0),end:K(16),type:"int",condition:"<"},({i:w})=>{const E=this._sampleVectors.element(w).toVar(),B=S.mul(E.xy.mul(U(1).add(E.z.mul(this.radius.sub(1))))).div(this._resolution).toVar(),P=d.add(B).toVar(),k=a(g,f,A,P);L.addAssign(k.xyz),M.addAssign(k.w)}),Rt(M.greaterThan(U(0)),()=>{L.divAssign(M)}),Xe(L,m.a)}).setLayout({name:"denoise",type:"vec4",inputs:[{name:"uv",type:"vec2"}]});return ne(()=>l(e))()}}function Gbe(s,e,t){const i=kbe(s,e,t),n=[];for(let r=0;r<s;r++){const o=i[r];n.push(o)}return n}function kbe(s,e,t){const i=[];for(let n=0;n<s;n++){const r=2*Math.PI*e*n/s,o=Math.pow(n/(s-1),t);i.push(new T(Math.cos(r),Math.sin(r),o))}return i}const Nbe=(s,e,t,i,n)=>me(new Cee(Pa(s),me(e),me(t),me(i),n));class wee extends wi{static get type(){return"FXAANode"}constructor(e){super(),this.textureNode=e,this.updateBeforeType=Zt.RENDER,this._invSize=$e(new Q)}updateBefore(){const e=this.textureNode.value;this._invSize.value.set(1/e.image.width,1/e.image.height)}setup(){const e=this.textureNode.bias(-100),t=e.uvNode||hi(),i=h=>e.uv(h),n=(h,d,u)=>e.uv(h.add(d.mul(u))),r=K(5),o=ne(([h,d])=>{const u=Xe(d).toVar(),f=Xe(h).toVar(),m=Xe(xn(f.sub(u))).toVar();return Ri(Ri(Ri(m.r,m.g),m.b),m.a)}),a=ne(([h,d,u,f])=>{const m=i(h).toVar(),g=n(h,le(0,-1),d.xy).toVar(),A=n(h,le(1,0),d.xy).toVar(),y=n(h,le(0,1),d.xy).toVar(),b=n(h,le(-1,0),d.xy).toVar(),x=o(m,y).toVar(),v=o(m,g).toVar(),_=o(m,A).toVar(),C=o(m,b).toVar(),S=Ri(x,Ri(v,Ri(_,C))).toVar();Rt(S.lessThan(u),()=>m);const M=In(x.add(v),_.add(C)).toVar();M.mulAssign(f),Rt(xn(M).lessThan(.3),()=>{const Oe=_.greaterThan(C).select(1,-1).toVar(),ae=v.greaterThan(x).select(1,-1).toVar(),Ae=le(Oe,ae).toVar(),Se=n(h,le(Ae.x,Ae.y),d.xy),Le=o(m,Se).toVar(),st=n(h,le(Ae.x.negate(),Ae.y.negate()),d.xy),ot=o(m,st).toVar();M.assign(ot.sub(Le)),M.mulAssign(f),Rt(xn(M).lessThan(.3),()=>{const Ct=y.add(g).add(A).add(b);return li(m,Ct.mul(.25),.4)})});const L=le().toVar();Rt(M.lessThanEqual(0),()=>{y.assign(b),g.assign(A),L.x.assign(0),L.y.assign(d.y)}).Else(()=>{L.x.assign(d.x),L.y.assign(0)});const w=o(m,y).toVar(),E=o(m,g).toVar();Rt(w.lessThanEqual(E),()=>{y.assign(g)});const B=K(0).toVar(),P=K(0).toVar(),k=U(0).toVar(),X=U(0).toVar(),F=le(h).toVar(),H=le(h).toVar(),W=K(0).toVar(),se=K(0).toVar();Li(r,({i:Oe})=>{const ae=Oe.add(1).toVar();Rt(B.equal(0),()=>{k.addAssign(ae),F.assign(h.add(L.mul(k)));const Ae=i(F.xy),Se=o(Ae,m).toVar(),Le=o(Ae,y).toVar();Rt(Se.greaterThan(Le),()=>{B.assign(1)}),W.assign(Oe)}),Rt(P.equal(0),()=>{X.addAssign(ae),H.assign(h.sub(L.mul(X)));const Ae=i(H.xy),Se=o(Ae,m).toVar(),Le=o(Ae,y).toVar();Rt(Se.greaterThan(Le),()=>{P.assign(1)}),se.assign(Oe)}),Rt(B.equal(1).or(P.equal(1)),()=>{FB()})}),Rt(B.equal(0).and(P.equal(0)),()=>m);const de=U(1).toVar(),be=U(1).toVar();Rt(B.equal(1),()=>{de.assign(U(W).div(U(r.sub(1))))}),Rt(P.equal(1),()=>{be.assign(U(se).div(U(r.sub(1))))});const Pe=Vr(de,be);return Pe.assign(Ia(Pe,.5)),Pe.assign(U(1).sub(Pe)),li(m,y,Pe.mul(.5))}).setLayout({name:"FxaaPixelShader",type:"vec4",inputs:[{name:"uv",type:"vec2"},{name:"fxaaQualityRcpFrame",type:"vec2"},{name:"fxaaQualityEdgeThreshold",type:"float"},{name:"fxaaQualityinvEdgeThreshold",type:"float"}]});return ne(()=>{const h=U(.2),d=U(1).div(h);return a(t,this._invSize,h,d)})()}}const Dbe=s=>me(new wee(Pa(s))),gg=new iu,Fbe=new ge(0,0,0),C9=new ge,Vbe=new Q,zbe=new Q(1,0),Ube=new Q(0,1);class See extends wi{static get type(){return"BloomNode"}constructor(e,t=1,i=0,n=0){super(),this.inputNode=e,this.strength=$e(t),this.radius=$e(i),this.threshold=$e(n),this.smoothWidth=$e(.01),this._renderTargetsHorizontal=[],this._renderTargetsVertical=[],this._nMips=5,this._renderTargetBright=new vr(1,1,{type:Wi}),this._renderTargetBright.texture.name="UnrealBloomPass.bright",this._renderTargetBright.texture.generateMipmaps=!1;for(let r=0;r<this._nMips;r++){const o=new vr(1,1,{type:Wi});o.texture.name="UnrealBloomPass.h"+r,o.texture.generateMipmaps=!1,this._renderTargetsHorizontal.push(o);const a=new vr(1,1,{type:Wi});a.texture.name="UnrealBloomPass.v"+r,a.texture.generateMipmaps=!1,this._renderTargetsVertical.push(a)}this._compositeMaterial=null,this._highPassFilterMaterial=null,this._separableBlurMaterials=[],this._textureNodeBright=Gi(this._renderTargetBright.texture),this._textureNodeBlur0=Gi(this._renderTargetsVertical[0].texture),this._textureNodeBlur1=Gi(this._renderTargetsVertical[1].texture),this._textureNodeBlur2=Gi(this._renderTargetsVertical[2].texture),this._textureNodeBlur3=Gi(this._renderTargetsVertical[3].texture),this._textureNodeBlur4=Gi(this._renderTargetsVertical[4].texture),this._textureOutput=qx(this,this._renderTargetsHorizontal[0].texture),this.updateBeforeType=Zt.FRAME}getTextureNode(){return this._textureOutput}setSize(e,t){let i=Math.round(e/2),n=Math.round(t/2);this._renderTargetBright.setSize(i,n);for(let r=0;r<this._nMips;r++)this._renderTargetsHorizontal[r].setSize(i,n),this._renderTargetsVertical[r].setSize(i,n),this._separableBlurMaterials[r].invSize.value.set(1/i,1/n),i=Math.round(i/2),n=Math.round(n/2)}updateBefore(e){const{renderer:t}=e,i=t.getDrawingBufferSize(Vbe);this.setSize(i.width,i.height);const n=t.getRenderTarget(),r=t.getMRT();t.getClearColor(C9);const o=t.getClearAlpha();this.setSize(i.width,i.height),t.setMRT(null),t.setClearColor(Fbe,0),t.setRenderTarget(this._renderTargetBright),gg.material=this._highPassFilterMaterial,gg.render(t);let a=this._renderTargetBright;for(let l=0;l<this._nMips;l++)gg.material=this._separableBlurMaterials[l],this._separableBlurMaterials[l].colorTexture.value=a.texture,this._separableBlurMaterials[l].direction.value=zbe,t.setRenderTarget(this._renderTargetsHorizontal[l]),t.clear(),gg.render(t),this._separableBlurMaterials[l].colorTexture.value=this._renderTargetsHorizontal[l].texture,this._separableBlurMaterials[l].direction.value=Ube,t.setRenderTarget(this._renderTargetsVertical[l]),t.clear(),gg.render(t),a=this._renderTargetsVertical[l];t.setRenderTarget(this._renderTargetsHorizontal[0]),t.clear(),gg.material=this._compositeMaterial,gg.render(t),t.setRenderTarget(n),t.setMRT(r),t.setClearColor(C9,o)}setup(e){const t=ne(()=>{const l=this.inputNode,c=go(l.rgb),h=Ga(this.threshold,this.threshold.add(this.smoothWidth),c);return li(Xe(0),l,h)});this._highPassFilterMaterial=this._highPassFilterMaterial||new Hi,this._highPassFilterMaterial.fragmentNode=t().context(e.getSharedContext()),this._highPassFilterMaterial.name="Bloom_highPass",this._highPassFilterMaterial.needsUpdate=!0;const i=[3,5,7,9,11];for(let l=0;l<this._nMips;l++)this._separableBlurMaterials.push(this._getSeperableBlurMaterial(e,i[l]));const n=zd([1,.8,.6,.4,.2]),r=zd([new T(1,1,1),new T(1,1,1),new T(1,1,1),new T(1,1,1),new T(1,1,1)]),o=ne(([l,c])=>{const h=U(1.2).sub(l);return li(l,h,c)}).setLayout({name:"lerpBloomFactor",type:"float",inputs:[{name:"factor",type:"float"},{name:"radius",type:"float"}]}),a=ne(()=>{const l=o(n.element(0),this.radius).mul(Xe(r.element(0),1)).mul(this._textureNodeBlur0),c=o(n.element(1),this.radius).mul(Xe(r.element(1),1)).mul(this._textureNodeBlur1),h=o(n.element(2),this.radius).mul(Xe(r.element(2),1)).mul(this._textureNodeBlur2),d=o(n.element(3),this.radius).mul(Xe(r.element(3),1)).mul(this._textureNodeBlur3),u=o(n.element(4),this.radius).mul(Xe(r.element(4),1)).mul(this._textureNodeBlur4);return l.add(c).add(h).add(d).add(u).mul(this.strength)});return this._compositeMaterial=this._compositeMaterial||new Hi,this._compositeMaterial.fragmentNode=a().context(e.getSharedContext()),this._compositeMaterial.name="Bloom_comp",this._compositeMaterial.needsUpdate=!0,this._textureOutput}dispose(){for(let e=0;e<this._renderTargetsHorizontal.length;e++)this._renderTargetsHorizontal[e].dispose();for(let e=0;e<this._renderTargetsVertical.length;e++)this._renderTargetsVertical[e].dispose();this._renderTargetBright.dispose()}_getSeperableBlurMaterial(e,t){const i=[];for(let u=0;u<t;u++)i.push(.39894*Math.exp(-.5*u*u/(t*t))/t);const n=Gi(),r=zd(i),o=$e(new Q),a=$e(new Q(.5,.5)),l=hi(),c=u=>n.uv(u),h=ne(()=>{const u=r.element(0).toVar(),f=c(l).rgb.mul(u).toVar();return Li({start:K(1),end:K(t),type:"int",condition:"<"},({i:m})=>{const g=U(m),A=r.element(m),y=a.mul(o).mul(g),b=c(l.add(y)).rgb,x=c(l.sub(y)).rgb;f.addAssign(Yn(b,x).mul(A)),u.addAssign(U(2).mul(A))}),Xe(f.div(u),1)}),d=new Hi;return d.fragmentNode=h().context(e.getSharedContext()),d.name="Bloom_seperable",d.needsUpdate=!0,d.colorTexture=n,d.direction=a,d.invSize=o,d}}const Xbe=(s,e,t,i)=>me(new See(me(s),e,t,i));class Mee extends wi{static get type(){return"TransitionNode"}constructor(e,t,i,n,r,o){super(),this.textureNodeA=e,this.textureNodeB=t,this.mixTextureNode=i,this.mixRatioNode=n,this.thresholdNode=r,this.useTextureNode=o}setup(){const{textureNodeA:e,textureNodeB:t,mixTextureNode:i,mixRatioNode:n,thresholdNode:r,useTextureNode:o}=this,a=h=>{const d=h.uvNode||hi();return h.uv(d)};return ne(()=>{const h=a(e),d=a(t),u=Xe().toVar();return Rt(o.equal(K(1)),()=>{const f=a(i),m=n.mul(r.mul(2).add(1)).sub(r),g=qs(In(f.r,m).mul(U(1).div(r)),0,1);u.assign(li(h,d,g))}).Else(()=>{u.assign(li(d,h,n))}),u})()}}const Obe=(s,e,t,i=0,n=.1,r=0)=>me(new Mee(Pa(s),Pa(e),Pa(t),me(i),me(n),me(r)));class Zbe extends wi{static get type(){return"PixelationNode"}constructor(e,t,i,n,r,o){super(),this.textureNode=e,this.depthNode=t,this.normalNode=i,this.pixelSize=n,this.normalEdgeStrength=r,this.depthEdgeStrength=o,this._resolution=$e(new Je),this.updateBeforeType=Zt.RENDER}updateBefore(){const e=this.textureNode.value,t=e.image.width,i=e.image.height;this._resolution.value.set(t,i,1/t,1/i)}setup(){const{textureNode:e,depthNode:t,normalNode:i}=this,n=e.uvNode||hi(),r=t.uvNode||hi(),o=i.uvNode||hi(),a=()=>e.uv(n),l=(g,A)=>t.uv(r.add(le(g,A).mul(this._resolution.zw))).r,c=(g,A)=>i.uv(o.add(le(g,A).mul(this._resolution.zw))).rgb.normalize(),h=g=>{const A=el("float","diff");return A.addAssign(qs(l(1,0).sub(g))),A.addAssign(qs(l(-1,0).sub(g))),A.addAssign(qs(l(0,1).sub(g))),A.addAssign(qs(l(0,-1).sub(g))),Lm(Ga(.01,.02,A).mul(2)).div(2)},d=(g,A,y,b)=>{const x=l(g,A).sub(y),v=c(g,A),_=J(1,1,1),C=ls(b.sub(v),_),S=qs(Ga(-.01,.01,C),0,1),M=qs(P1(x.mul(.25).add(.0025)),0,1);return U(1).sub(ls(b,v)).mul(M).mul(S)},u=(g,A)=>{const y=el("float","indicator");return y.addAssign(d(0,-1,g,A)),y.addAssign(d(0,1,g,A)),y.addAssign(d(-1,0,g,A)),y.addAssign(d(1,0,g,A)),G1(.1,y)};return ne(()=>{const g=a(),A=el("float","depth"),y=el("vec3","normal");Rt(this.depthEdgeStrength.greaterThan(0).or(this.normalEdgeStrength.greaterThan(0)),()=>{A.assign(l(0,0)),y.assign(c(0,0))});const b=el("float","dei");Rt(this.depthEdgeStrength.greaterThan(0),()=>{b.assign(h(A))});const x=el("float","nei");Rt(this.normalEdgeStrength.greaterThan(0),()=>{x.assign(u(A,y))});const v=b.greaterThan(0).select(U(1).sub(b.mul(this.depthEdgeStrength)),x.mul(this.normalEdgeStrength).add(1));return g.mul(v)})()}}const Wbe=(s,e,t,i=6,n=.3,r=.4)=>me(new Zbe(Pa(s),Pa(e),Pa(t),me(i),me(n),me(r)));class Iee extends Kr{static get type(){return"PixelationPassNode"}constructor(e,t,i=6,n=.3,r=.4){super("color",e,t,{minFilter:qt,magFilter:qt}),this.pixelSize=i,this.normalEdgeStrength=n,this.depthEdgeStrength=r,this.isPixelationPassNode=!0,this._mrt=OB({output:PX,normal:ql})}setSize(e,t){const i=this.pixelSize.value?this.pixelSize.value:this.pixelSize,n=Math.floor(e/i),r=Math.floor(t/i);super.setSize(n,r)}setup(){const e=super.getTextureNode("output"),t=super.getTextureNode("depth"),i=super.getTextureNode("normal");return Wbe(e,t,i,this.pixelSize,this.normalEdgeStrength,this.depthEdgeStrength)}}const Hbe=(s,e,t,i,n)=>me(new Iee(s,e,t,i,n)),Qbe=new Q;class Tee extends Kr{static get type(){return"SSAAPassNode"}constructor(e,t){super(Kr.COLOR,e,t),this.isSSAAPassNode=!0,this.sampleLevel=4,this.unbiased=!0,this.clearColor=new ge(0),this.clearAlpha=0,this._currentClearColor=new ge,this.sampleWeight=$e(1),this.sampleRenderTarget=null,this._quadMesh=new iu}updateBefore(e){const{renderer:t}=e,{scene:i,camera:n}=this;this._pixelRatio=t.getPixelRatio();const r=t.getSize(Qbe);this.setSize(r.width,r.height),this.sampleRenderTarget.setSize(this.renderTarget.width,this.renderTarget.height),t.getClearColor(this._currentClearColor);const o=t.getClearAlpha(),a=t.getRenderTarget(),l=t.getMRT(),c=t.autoClear;this._cameraNear.value=n.near,this._cameraFar.value=n.far,t.setMRT(this.getMRT()),t.autoClear=!1;const h=Kbe[Math.max(0,Math.min(this.sampleLevel,5))],d=1/h.length,u=1/32,f={fullWidth:this.renderTarget.width,fullHeight:this.renderTarget.height,offsetX:0,offsetY:0,width:this.renderTarget.width,height:this.renderTarget.height},m=Object.assign({},n.view);m.enabled&&Object.assign(f,m);for(let g=0;g<h.length;g++){const A=h[g];if(n.setViewOffset&&n.setViewOffset(f.fullWidth,f.fullHeight,f.offsetX+A[0]*.0625,f.offsetY+A[1]*.0625,f.width,f.height),this.sampleWeight.value=d,this.unbiased){const y=-.5+(g+.5)/h.length;this.sampleWeight.value+=u*y}t.setClearColor(this.clearColor,this.clearAlpha),t.setRenderTarget(this.sampleRenderTarget),t.clear(),t.render(i,n),t.setRenderTarget(this.renderTarget),g===0&&(t.setClearColor(0,0),t.clear()),this._quadMesh.render(t)}t.copyTextureToTexture(this.sampleRenderTarget.depthTexture,this.renderTarget.depthTexture),n.setViewOffset&&m.enabled?n.setViewOffset(m.fullWidth,m.fullHeight,m.offsetX,m.offsetY,m.width,m.height):n.clearViewOffset&&n.clearViewOffset(),t.setRenderTarget(a),t.setMRT(l),t.autoClear=c,t.setClearColor(this._currentClearColor,o)}setup(e){this.sampleRenderTarget===null&&(this.sampleRenderTarget=this.renderTarget.clone());let t;const i=this.getMRT();if(i!==null){const n={};for(const r in i.outputNodes){const o=T3(this.sampleRenderTarget.textures,r);o>=0&&(n[r]=Gi(this.sampleRenderTarget.textures[o]).mul(this.sampleWeight))}t=OB(n)}else t=Gi(this.sampleRenderTarget.texture).mul(this.sampleWeight);return this._quadMesh.material=new Hi,this._quadMesh.material.fragmentNode=t,this._quadMesh.material.transparent=!0,this._quadMesh.material.depthTest=!1,this._quadMesh.material.depthWrite=!1,this._quadMesh.material.premultipliedAlpha=!0,this._quadMesh.material.blending=sm,this._quadMesh.material.normals=!1,this._quadMesh.material.name="SSAA",super.setup(e)}dispose(){super.dispose(),this.sampleRenderTarget!==null&&this.sampleRenderTarget.dispose()}}const Kbe=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]],Ybe=(s,e)=>me(new Tee(s,e)),Jbe=new Q;class Eee extends Kr{static get type(){return"StereoPassNode"}constructor(e,t){super(Kr.COLOR,e,t),this.isStereoPassNode=!0,this.stereo=new hX,this.stereo.aspect=.5}updateBefore(e){const{renderer:t}=e,{scene:i,camera:n,stereo:r,renderTarget:o}=this;this._pixelRatio=t.getPixelRatio(),r.cameraL.coordinateSystem=t.coordinateSystem,r.cameraR.coordinateSystem=t.coordinateSystem,r.update(n);const a=t.getSize(Jbe);this.setSize(a.width,a.height);const l=t.autoClear;t.autoClear=!1;const c=t.getRenderTarget(),h=t.getMRT();this._cameraNear.value=n.near,this._cameraFar.value=n.far;for(const d in this._previousTextures)this.toggleTexture(d);t.setRenderTarget(o),t.setMRT(this._mrt),t.clear(),o.scissorTest=!0,o.scissor.set(0,0,o.width/2,o.height),o.viewport.set(0,0,o.width/2,o.height),t.render(i,r.cameraL),o.scissor.set(o.width/2,0,o.width/2,o.height),o.viewport.set(o.width/2,0,o.width/2,o.height),t.render(i,r.cameraR),o.scissorTest=!1,t.setRenderTarget(c),t.setMRT(h),t.autoClear=l}}const jbe=(s,e)=>me(new Eee(s,e)),qbe=new Q,w9=new iu;class Ree extends Kr{static get type(){return"StereoCompositePassNode"}constructor(e,t){super(Kr.COLOR,e,t),this.isStereoCompositePassNode=!0,this.stereo=new hX;const i={minFilter:Ot,magFilter:qt,type:Wi};this._renderTargetL=new vr(1,1,i),this._renderTargetR=new vr(1,1,i),this._mapLeft=Gi(this._renderTargetL.texture),this._mapRight=Gi(this._renderTargetR.texture),this._material=null}updateStereoCamera(e){this.stereo.cameraL.coordinateSystem=e,this.stereo.cameraR.coordinateSystem=e,this.stereo.update(this.camera)}setSize(e,t){super.setSize(e,t),this._renderTargetL.setSize(this.renderTarget.width,this.renderTarget.height),this._renderTargetR.setSize(this.renderTarget.width,this.renderTarget.height)}updateBefore(e){const{renderer:t}=e,{scene:i,stereo:n,renderTarget:r}=this;this._pixelRatio=t.getPixelRatio(),this.updateStereoCamera(t.coordinateSystem);const o=t.getSize(qbe);this.setSize(o.width,o.height);const a=t.getRenderTarget();t.setRenderTarget(this._renderTargetL),t.render(i,n.cameraL),t.setRenderTarget(this._renderTargetR),t.render(i,n.cameraR),t.setRenderTarget(r),w9.material=this._material,w9.render(t),t.setRenderTarget(a)}dispose(){super.dispose(),this._renderTargetL.dispose(),this._renderTargetR.dispose(),this._material!==null&&this._material.dispose()}}class Lee extends Ree{static get type(){return"AnaglyphPassNode"}constructor(e,t){super(e,t),this.isAnaglyphPassNode=!0,this._colorMatrixLeft=$e(new ei().fromArray([.4561,-.0400822,-.0152161,.500484,-.0378246,-.0205971,.176381,-.0157589,-.00546856])),this._colorMatrixRight=$e(new ei().fromArray([-.0434706,.378476,-.0721527,-.0879388,.73364,-.112961,-.00155529,-.0184503,1.2264]))}setup(e){const t=hi(),i=ne(()=>{const r=this._mapLeft.uv(t),o=this._mapRight.uv(t),a=qs(this._colorMatrixLeft.mul(r.rgb).add(this._colorMatrixRight.mul(o.rgb)));return Xe(a.rgb,Ri(r.a,o.a))}),n=this._material||(this._material=new Hi);return n.fragmentNode=i().context(e.getSharedContext()),n.name="Anaglyph",n.needsUpdate=!0,super.setup(e)}}const $be=(s,e)=>me(new Lee(s,e));class Bee extends Ree{static get type(){return"ParallaxBarrierPassNode"}constructor(e,t){super(e,t),this.isParallaxBarrierPassNode=!0}setup(e){const t=hi(),i=ne(()=>{const r=Xe().toVar();return Rt(LB(jx.y,2).greaterThan(1),()=>{r.assign(this._mapLeft.uv(t))}).Else(()=>{r.assign(this._mapRight.uv(t))}),r}),n=this._material||(this._material=new Hi);return n.fragmentNode=i().context(e.getSharedContext()),n.needsUpdate=!0,super.setup(e)}}const exe=(s,e)=>me(new Bee(s,e));class Pee extends Kr{static get type(){return"ToonOutlinePassNode"}constructor(e,t,i,n,r){super(Kr.COLOR,e,t),this.colorNode=i,this.thicknessNode=n,this.alphaNode=r,this._materialCache=new WeakMap}updateBefore(e){const{renderer:t}=e,i=t.getRenderObjectFunction();t.setRenderObjectFunction((n,r,o,a,l,c,h)=>{if((l.isMeshToonMaterial||l.isMeshToonNodeMaterial)&&l.wireframe===!1){const d=this._getOutlineMaterial(l);t.renderObject(n,r,o,a,d,c,h)}t.renderObject(n,r,o,a,l,c,h)}),super.updateBefore(e),t.setRenderObjectFunction(i)}_createMaterial(){const e=new Hi;e.isMeshToonOutlineMaterial=!0,e.name="Toon_Outline",e.side=vn;const t=ll.negate(),i=tl.mul(jd),n=U(1),r=i.mul(Xe(Ts,1)),o=i.mul(Xe(Ts.add(t),1)),a=Bl(r.sub(o));return e.vertexNode=r.add(a.mul(this.thicknessNode).mul(r.w).mul(n)),e.colorNode=Xe(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let t=this._materialCache.get(e);return t===void 0&&(t=this._createMaterial(),this._materialCache.set(e,t)),t}}const txe=(s,e,t=new ge(0,0,0),i=.003,n=1)=>me(new Pee(s,e,me(t),me(i),me(n)));class Gee extends Qt{static get type(){return"ScriptableValueNode"}constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outpuType=null,this.events=new Mr,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:U()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=xX(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;e.value!==null&&(e.inputType==="ArrayBuffer"?t=vX(e.value):e.inputType==="Texture"?t=e.meta.textures[e.value]:t=e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const bR=we(Gee);class kee extends Map{get(e,t=null,...i){if(this.has(e))return super.get(e);if(t!==null){const n=t(...i);return this.set(e,n),n}}}class ixe{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const xR=new kee;class Nee extends Qt{static get type(){return"ScriptableNode"}constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new kee,this._output=bR(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const i=this._outputs;return i[e]===void 0?i[e]=bR(t):i[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const i=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),i[e]=t,i[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),i[e]=t,i[e].events.addEventListener("refresh",this.onRefresh)):i[e]===void 0?(i[e]=bR(t),i[e].events.addEventListener("refresh",this.onRefresh)):i[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const n=this.getObject()[e];if(typeof n=="function")return n(...t)}async callAsync(e,...t){const n=this.getObject()[e];if(typeof n=="function")return n.constructor.name==="AsyncFunction"?await n(...t):n(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),t=(c,h)=>this.setOutput(c,h),i=new ixe(this),n=xR.get("THREE"),r=xR.get("TSL"),o=this.getMethod(this.codeNode),a=[i,this._local,xR,e,t,n,r];this._object=o(...a);const l=this._object.layout;if(l&&(l.cache===!1&&this._local.clear(),this._output.outputType=l.outputType||null,Array.isArray(l.elements)))for(const c of l.elements){const h=c.id||c.name;c.inputType&&(this.getParameter(h)===void 0&&this.setParameter(h,null),this.getParameter(h).inputType=c.inputType),c.outputType&&(this.getOutput(h)===void 0&&this.setOutput(h,null),this.getOutput(h).outputType=c.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let i=this.parameters[t];i.isScriptableNode&&(i=i.getDefaultOutput()),i.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:U()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],i=["layout","init","main","dispose"].join(", "),n="var "+i+`; var output = {};
`,r=`
return { ...output, `+i+" };",o=n+this.codeNode.code+r;return this._method=new Function(...e,o),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(e){const t=[a6(this.source),this.getDefaultOutputNode().getCacheKey(e)];for(const i in this.parameters)t.push(this.parameters[i].getCacheKey(e));return l6(t)}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const nxe=we(Nee);class ZB extends Qt{static get type(){return"FogNode"}constructor(e,t){super("float"),this.isFogNode=!0,this.colorNode=e,this.factorNode=t}getViewZNode(e){let t;const i=e.context.getViewZ;return i!==void 0&&(t=i(this)),(t||_o.z).negate()}setup(){return this.factorNode}}const sxe=we(ZB);class Dee extends ZB{static get type(){return"FogRangeNode"}constructor(e,t,i){super(e),this.isFogRangeNode=!0,this.nearNode=t,this.farNode=i}setup(e){const t=this.getViewZNode(e);return Ga(this.nearNode,this.farNode,t)}}const rxe=we(Dee);class Fee extends ZB{static get type(){return"FogExp2Node"}constructor(e,t){super(e),this.isFogExp2Node=!0,this.densityNode=t}setup(e){const t=this.getViewZNode(e),i=this.densityNode;return i.mul(i,t,t).negate().exp().oneMinus()}}const oxe=we(Fee);let Ag=null,yg=null;class Vee extends Qt{static get type(){return"RangeNode"}constructor(e=U(),t=U()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=e.getTypeLength(hp(this.minNode.value)),i=e.getTypeLength(hp(this.maxNode.value));return t>i?t:i}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}setup(e){const t=e.object;let i=null;if(t.count>1){const n=this.minNode.value,r=this.maxNode.value,o=e.getTypeLength(hp(n)),a=e.getTypeLength(hp(r));Ag=Ag||new Je,yg=yg||new Je,Ag.setScalar(0),yg.setScalar(0),o===1?Ag.setScalar(n):n.isColor?Ag.set(n.r,n.g,n.b):Ag.set(n.x,n.y,n.z||0,n.w||0),a===1?yg.setScalar(r):r.isColor?yg.set(r.r,r.g,r.b):yg.set(r.x,r.y,r.z||0,r.w||0);const l=4,c=l*t.count,h=new Float32Array(c);for(let u=0;u<c;u++){const f=u%l,m=Ag.getComponent(f),g=yg.getComponent(f);h[u]=Bi.lerp(m,g,Math.random())}const d=this.getNodeType(e);if(t.count<=4096)i=V1(h,"vec4",t.count).element(Z1).convert(d);else{const u=new $o(h,4);e.geometry.setAttribute("__range"+this.id,u),i=kL(u).convert(d)}}else i=U(0);return i}}const axe=we(Vee),lxe=ne(({depthTexture:s,shadowCoord:e})=>Gi(s,e.xy).compare(e.z)),cxe=ne(({depthTexture:s,shadowCoord:e,shadow:t})=>{const i=(g,A)=>Gi(s,g).compare(A),n=Ar("mapSize","vec2",t).setGroup(Ui),r=Ar("radius","float",t).setGroup(Ui),o=le(1).div(n),a=o.x.negate().mul(r),l=o.y.negate().mul(r),c=o.x.mul(r),h=o.y.mul(r),d=a.div(2),u=l.div(2),f=c.div(2),m=h.div(2);return Yn(i(e.xy.add(le(a,l)),e.z),i(e.xy.add(le(0,l)),e.z),i(e.xy.add(le(c,l)),e.z),i(e.xy.add(le(d,u)),e.z),i(e.xy.add(le(0,u)),e.z),i(e.xy.add(le(f,u)),e.z),i(e.xy.add(le(a,0)),e.z),i(e.xy.add(le(d,0)),e.z),i(e.xy,e.z),i(e.xy.add(le(f,0)),e.z),i(e.xy.add(le(c,0)),e.z),i(e.xy.add(le(d,m)),e.z),i(e.xy.add(le(0,m)),e.z),i(e.xy.add(le(f,m)),e.z),i(e.xy.add(le(a,h)),e.z),i(e.xy.add(le(0,h)),e.z),i(e.xy.add(le(c,h)),e.z)).mul(1/17)}),hxe=ne(({depthTexture:s,shadowCoord:e,shadow:t})=>{const i=(h,d)=>Gi(s,h).compare(d),n=Ar("mapSize","vec2",t).setGroup(Ui),r=le(1).div(n),o=r.x,a=r.y,l=e.xy,c=Bm(l.mul(n).add(.5));return l.subAssign(c.mul(r)),Yn(i(l,e.z),i(l.add(le(o,0)),e.z),i(l.add(le(0,a)),e.z),i(l.add(r),e.z),li(i(l.add(le(o.negate(),0)),e.z),i(l.add(le(o.mul(2),0)),e.z),c.x),li(i(l.add(le(o.negate(),a)),e.z),i(l.add(le(o.mul(2),a)),e.z),c.x),li(i(l.add(le(0,a.negate())),e.z),i(l.add(le(0,a.mul(2))),e.z),c.y),li(i(l.add(le(o,a.negate())),e.z),i(l.add(le(o,a.mul(2))),e.z),c.y),li(li(i(l.add(le(o.negate(),a.negate())),e.z),i(l.add(le(o.mul(2),a.negate())),e.z),c.x),li(i(l.add(le(o.negate(),a.mul(2))),e.z),i(l.add(le(o.mul(2),a.mul(2))),e.z),c.x),c.y)).mul(1/9)}),dxe=ne(({depthTexture:s,shadowCoord:e})=>{const t=U(1).toVar(),i=Gi(s).uv(e.xy).rg,n=G1(e.z,i.x);return Rt(n.notEqual(U(1)),()=>{const r=e.z.sub(i.x),o=Ri(0,i.y.mul(i.y));let a=o.div(o.add(r.mul(r)));a=qs(In(a,.3).div(.95-.3)),t.assign(qs(Ri(n,a)))}),t}),uxe=ne(({samples:s,radius:e,size:t,shadowPass:i})=>{const n=U(0).toVar(),r=U(0).toVar(),o=s.lessThanEqual(U(1)).select(U(0),U(2).div(s.sub(1))),a=s.lessThanEqual(U(1)).select(U(0),U(-1));Li({start:K(0),end:K(s),type:"int",condition:"<"},({i:c})=>{const h=a.add(U(c).mul(o)),d=i.uv(Yn(jx.xy,le(0,h).mul(e)).div(t)).x;n.addAssign(d),r.addAssign(d.mul(d))}),n.divAssign(s),r.divAssign(s);const l=Xh(r.sub(n.mul(n)));return le(n,l)}),pxe=ne(({samples:s,radius:e,size:t,shadowPass:i})=>{const n=U(0).toVar(),r=U(0).toVar(),o=s.lessThanEqual(U(1)).select(U(0),U(2).div(s.sub(1))),a=s.lessThanEqual(U(1)).select(U(0),U(-1));Li({start:K(0),end:K(s),type:"int",condition:"<"},({i:c})=>{const h=a.add(U(c).mul(o)),d=i.uv(Yn(jx.xy,le(h,0).mul(e)).div(t));n.addAssign(d.x),r.addAssign(Yn(d.y.mul(d.y),d.x.mul(d.x)))}),n.divAssign(s),r.divAssign(s);const l=Xh(r.sub(n.mul(n)));return le(n,l)}),fxe=[lxe,cxe,hxe,dxe];let gy=null;const oT=new iu;class Gm extends mA{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.updateType=Zt.FRAME,this.light=e,this.color=new ge,this.colorNode=$e(this.color).setGroup(Ui),this.baseColorNode=null,this.shadowMap=null,this.shadowNode=null,this.shadowColorNode=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this.isAnalyticLightNode=!0}getCacheKey(){return AX(super.getCacheKey(),this.light.id,this.light.castShadow?1:0)}getHash(){return this.light.uuid}setupShadow(e){const{object:t,renderer:i}=e;if(i.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){gy===null&&(gy=new Hi,gy.fragmentNode=Xe(0,0,0,1),gy.isShadowNodeMaterial=!0,gy.name="ShadowMaterial");const r=i.shadowMap.type,o=this.light.shadow,a=new Bp;a.compareFunction=PU;const l=e.createRenderTarget(o.mapSize.width,o.mapSize.height);if(l.depthTexture=a,o.camera.updateProjectionMatrix(),r===qa){a.compareFunction=null,this.vsmShadowMapVertical=e.createRenderTarget(o.mapSize.width,o.mapSize.height,{format:Pc,type:Wi}),this.vsmShadowMapHorizontal=e.createRenderTarget(o.mapSize.width,o.mapSize.height,{format:Pc,type:Wi});const x=Gi(a),v=Gi(this.vsmShadowMapVertical.texture),_=Ar("blurSamples","float",o).setGroup(Ui),C=Ar("radius","float",o).setGroup(Ui),S=Ar("mapSize","vec2",o).setGroup(Ui);let M=this.vsmMaterialVertical||(this.vsmMaterialVertical=new Hi);M.fragmentNode=uxe({samples:_,radius:C,size:S,shadowPass:x}).context(e.getSharedContext()),M.name="VSMVertical",M=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new Hi),M.fragmentNode=pxe({samples:_,radius:C,size:S,shadowPass:v}).context(e.getSharedContext()),M.name="VSMHorizontal"}const c=Ar("intensity","float",o).setGroup(Ui),h=Ar("bias","float",o).setGroup(Ui),d=Ar("normalBias","float",o).setGroup(Ui),u=t.material.shadowPositionNode||DL;let f=$e(o.matrix).setGroup(Ui).mul(u.add(PB.mul(d)));f=f.xyz.div(f.w);let m=f.z.add(h);i.coordinateSystem===W0&&(m=m.mul(2).sub(1)),f=J(f.x,f.y.oneMinus(),m);const g=f.x.greaterThanEqual(0).and(f.x.lessThanEqual(1)).and(f.y.greaterThanEqual(0)).and(f.y.lessThanEqual(1)).and(f.z.lessThanEqual(1)),A=o.filterNode||fxe[i.shadowMap.type]||null;if(A===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const y=Gi(l.texture,f),b=g.select(A({depthTexture:r===qa?this.vsmShadowMapHorizontal.texture:a,shadowCoord:f,shadow:o}),U(1));this.shadowMap=l,this.light.shadow.map=l,this.shadowNode=b,this.shadowColorNode=n=this.colorNode.mul(li(1,b.rgb.mix(y,1),c.mul(y.a))),this.baseColorNode=this.colorNode}this.colorNode=n,this.updateBeforeType=Zt.RENDER}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&this.disposeShadow()}updateShadow(e){const{shadowMap:t,light:i}=this,{renderer:n,scene:r,camera:o}=e,a=n.shadowMap.type,l=t.depthTexture.version;this._depthVersionCached=l;const c=r.overrideMaterial;r.overrideMaterial=gy,t.setSize(i.shadow.mapSize.width,i.shadow.mapSize.height),i.shadow.updateMatrices(i),i.shadow.camera.layers.mask=o.layers.mask;const h=n.getRenderTarget(),d=n.getRenderObjectFunction();n.setRenderObjectFunction((u,...f)=>{(u.castShadow===!0||u.receiveShadow&&a===qa)&&n.renderObject(u,...f)}),n.setRenderTarget(t),n.render(r,i.shadow.camera),n.setRenderObjectFunction(d),i.isPointLight!==!0&&a===qa&&this.vsmPass(e,i),n.setRenderTarget(h),r.overrideMaterial=c}vsmPass(e,t){const{renderer:i}=e;this.vsmShadowMapVertical.setSize(t.shadow.mapSize.width,t.shadow.mapSize.height),this.vsmShadowMapHorizontal.setSize(t.shadow.mapSize.width,t.shadow.mapSize.height),i.setRenderTarget(this.vsmShadowMapVertical),oT.material=this.vsmMaterialVertical,oT.render(i),i.setRenderTarget(this.vsmShadowMapHorizontal),oT.material=this.vsmMaterialHorizontal,oT.render(i)}disposeShadow(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),this.shadowNode=null,this.shadowColorNode=null,this.baseColorNode=null,this.updateBeforeType=Zt.NONE}updateBefore(e){const t=this.light.shadow;(t.needsUpdate||t.autoUpdate)&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const L3=ne(s=>{const{lightDistance:e,cutoffDistance:t,decayExponent:i}=s,n=e.pow(i).max(.01).reciprocal();return t.greaterThan(0).select(n.mul(e.div(t).pow4().oneMinus().clamp().pow2()),n)});let aT;function B3(s){aT=aT||new WeakMap;let e=aT.get(s);return e===void 0&&aT.set(s,e={}),e}function P3(s){const e=B3(s);return e.position||(e.position=$e(new T).setGroup(Ui).onRenderUpdate((t,i)=>i.value.setFromMatrixPosition(s.matrixWorld)))}function zee(s){const e=B3(s);return e.targetPosition||(e.targetPosition=$e(new T).setGroup(Ui).onRenderUpdate((t,i)=>i.value.setFromMatrixPosition(s.target.matrixWorld)))}function WB(s){const e=B3(s);return e.viewPosition||(e.viewPosition=$e(new T).setGroup(Ui).onRenderUpdate(({camera:t},i)=>{i.value=i.value||new T,i.value.setFromMatrixPosition(s.matrixWorld),i.value.applyMatrix4(t.matrixWorldInverse)}))}const G3=s=>hl.transformDirection(P3(s).sub(zee(s))),mxe=ne(([s])=>{const e=s.toUint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).toFloat().mul(1/2**32)}),mV=(s,e)=>Ia(pi(4,s.mul(In(1,s))),e),gxe=(s,e)=>s.lessThan(.5)?mV(s.mul(2),e).div(2):In(1,mV(pi(In(1,s),2),e).div(2)),Axe=(s,e,t)=>Ia(Ph(Ia(s,e),Yn(Ia(s,e),Ia(In(1,s),t))),1/e),yxe=(s,e)=>yo(Y0.mul(e.mul(s).sub(1))).div(Y0.mul(e.mul(s).sub(1))),fd=ne(([s])=>s.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),Uee=ne(([s])=>J(fd(s.z.add(fd(s.y.mul(1)))),fd(s.z.add(fd(s.x.mul(1)))),fd(s.y.add(fd(s.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),bxe=ne(([s,e,t])=>{const i=J(s).toVar(),n=U(1.4).toVar(),r=U(0).toVar(),o=J(i).toVar();return Li({start:U(0),end:U(3),type:"float",condition:"<="},()=>{const a=J(Uee(o.mul(2))).toVar();i.addAssign(a.add(t.mul(U(.1).mul(e)))),o.mulAssign(1.8),n.mulAssign(1.5),i.mulAssign(1.2);const l=U(fd(i.z.add(fd(i.x.add(fd(i.y)))))).toVar();r.addAssign(l.div(n)),o.addAssign(.14)}),r}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"p",type:"vec3"},{name:"spd",type:"float"},{name:"time",type:"float"}]}),xxe=ne(([s,e,t=le(.5)])=>b3(s.sub(t),e).add(t)),vxe=ne(([s,e,t=le(.5)])=>{const i=s.sub(t),n=i.dot(i),o=n.mul(n).mul(e);return s.add(i.mul(o))}),_xe=ne(({position:s=null,horizontal:e=!0,vertical:t=!1})=>{let i;s!==null?(i=kc.toVar(),i[3][0]=s.x,i[3][1]=s.y,i[3][2]=s.z):i=kc;const n=hl.mul(i);return Kw(e)&&(n[0][0]=kc[0].length(),n[0][1]=0,n[0][2]=0),Kw(t)&&(n[1][0]=0,n[1][1]=kc[1].length(),n[1][2]=0),n[2][0]=0,n[2][1]=0,n[2][2]=1,tl.mul(n).mul(Ts)}),Cxe=ne(([s=null])=>{const e=VL();return VL(u3(s)).sub(e).lessThan(0).select(Pm,s)}),S9=new WeakMap;class wxe extends wi{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.updateType=Zt.OBJECT,this.updateAfterType=Zt.OBJECT,this.previousModelWorldMatrix=$e(new ce),this.previousProjectionMatrix=$e(new ce).setGroup(Ui),this.previousCameraViewMatrix=$e(new ce)}update({frameId:e,camera:t,object:i}){const n=M9(i);this.previousModelWorldMatrix.value.copy(n);const r=Xee(t);r.frameId!==e&&(r.frameId=e,r.previousProjectionMatrix===void 0?(r.previousProjectionMatrix=new ce,r.previousCameraViewMatrix=new ce,r.currentProjectionMatrix=new ce,r.currentCameraViewMatrix=new ce,r.previousProjectionMatrix.copy(t.projectionMatrix),r.previousCameraViewMatrix.copy(t.matrixWorldInverse)):(r.previousProjectionMatrix.copy(r.currentProjectionMatrix),r.previousCameraViewMatrix.copy(r.currentCameraViewMatrix)),r.currentProjectionMatrix.copy(t.projectionMatrix),r.currentCameraViewMatrix.copy(t.matrixWorldInverse),this.previousProjectionMatrix.value.copy(r.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(r.previousCameraViewMatrix))}updateAfter({object:e}){M9(e).copy(e.matrixWorld)}setup(){const e=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),t=tl.mul(jd).mul(Ts),i=this.previousProjectionMatrix.mul(e).mul(NL),n=t.xy.div(t.w),r=i.xy.div(i.w);return In(n,r)}}function Xee(s){let e=S9.get(s);return e===void 0&&(e={},S9.set(s,e)),e}function M9(s,e=0){const t=Xee(s);let i=t[e];return i===void 0&&(t[e]=i=new ce),i}const Sxe=tt(wxe),Mxe=ne(([s,e])=>Vr(1,s.oneMinus().div(e)).oneMinus()).setLayout({name:"burnBlend",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Ixe=ne(([s,e])=>Vr(s.div(e.oneMinus()),1)).setLayout({name:"dodgeBlend",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Txe=ne(([s,e])=>s.oneMinus().mul(e.oneMinus()).oneMinus()).setLayout({name:"screenBlend",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Exe=ne(([s,e])=>li(s.mul(2).mul(e),s.oneMinus().mul(2).mul(e.oneMinus()).oneMinus(),G1(.5,s))).setLayout({name:"overlayBlend",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Rxe=ne(([s,e,t=K(16)])=>{const i=a=>s.uv(a),n=hi(),r=i(n).toVar(),o=U(t);return Li({start:K(1),end:t,type:"int",condition:"<="},({i:a})=>{const l=e.mul(U(a).div(o.sub(1)).sub(.5));r.addAssign(i(n.add(l)))}),r.divAssign(o),r}),Lxe=ne(([s,e=1])=>{const t=s,i=go(t.rgb),n=J(i),r=Vr(1,Ri(0,U(10).mul(i.sub(.45)))),o=n.mul(t.rgb).mul(2),a=U(2).mul(n.oneMinus()).mul(t.rgb.oneMinus()).oneMinus(),l=li(o,a,r),c=t.a.mul(e),h=c.mul(l.rgb);return h.addAssign(t.rgb.mul(c.oneMinus())),Xe(h,t.a)}),Bxe=ne(([s])=>{const e=J(s);return Xe(ls(e,J(.393,.769,.189)),ls(e,J(.349,.686,.168)),ls(e,J(.272,.534,.131)),s.a)}),Oee=ne(([s])=>{const e=s.mul(.9478672986).add(.0521327014).pow(2.4),t=s.mul(.0773993808),i=s.lessThanEqual(.04045);return li(e,t,i)}).setLayout({name:"sRGBToLinearSRGB",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Zee=ne(([s])=>{const e=s.pow(.41666).mul(1.055).sub(.055),t=s.mul(12.92),i=s.lessThanEqual(.0031308);return li(e,t,i)}).setLayout({name:"linearSRGBTosRGB",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Wee=ne(([s,e])=>s.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Hee=ne(([s,e])=>(s=s.mul(e),s.div(s.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Qee=ne(([s,e])=>{s=s.mul(e),s=s.sub(.004).max(0);const t=s.mul(s.mul(6.2).add(.5)),i=s.mul(s.mul(6.2).add(1.7)).add(.06);return t.div(i).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Pxe=ne(([s])=>{const e=s.mul(s.add(.0245786)).sub(90537e-9),t=s.mul(s.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),Kee=ne(([s,e])=>{const t=Qr(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),i=Qr(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return s=s.mul(e).div(.6),s=t.mul(s),s=Pxe(s),s=i.mul(s),s.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Gxe=Qr(J(1.6605,-.1246,-.0182),J(-.5876,1.1329,-.1006),J(-.0728,-.0083,1.1187)),kxe=Qr(J(.6274,.0691,.0164),J(.3293,.9195,.088),J(.0433,.0113,.8956)),Nxe=ne(([s])=>{const e=J(s).toVar(),t=J(e.mul(e)).toVar(),i=J(t.mul(t)).toVar();return U(15.5).mul(i.mul(t)).sub(pi(40.14,i.mul(e))).add(pi(31.96,i).sub(pi(6.868,t.mul(e))).add(pi(.4298,t).add(pi(.1191,e).sub(.00232))))}),Yee=ne(([s,e])=>{const t=J(s).toVar(),i=Qr(J(.856627153315983,.137318972929847,.11189821299995),J(.0951212405381588,.761241990602591,.0767994186031903),J(.0482516061458583,.101439036467562,.811302368396859)),n=Qr(J(1.1271005818144368,-.1413297634984383,-.14132976349843826),J(-.11060664309660323,1.157823702216272,-.11060664309660294),J(-.016493938717834573,-.016493938717834257,1.2519364065950405)),r=U(-12.47393),o=U(4.026069);return t.mulAssign(e),t.assign(kxe.mul(t)),t.assign(i.mul(t)),t.assign(Ri(t,1e-10)),t.assign(B1(t)),t.assign(t.sub(r).div(o.sub(r))),t.assign(qs(t,0,1)),t.assign(Nxe(t)),t.assign(n.mul(t)),t.assign(Ia(Ri(J(0),t),J(2.2))),t.assign(Gxe.mul(t)),t.assign(qs(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Jee=ne(([s,e])=>{const t=U(.76),i=U(.15);s=s.mul(e);const n=Vr(s.r,Vr(s.g,s.b)),r=vo(n.lessThan(.08),n.sub(pi(6.25,n.mul(n))),.04);s.subAssign(r);const o=Ri(s.r,Ri(s.g,s.b));Rt(o.lessThan(t),()=>s);const a=In(1,t),l=In(1,a.mul(a).div(o.add(a.sub(t))));s.mulAssign(l.div(o));const c=In(1,Ph(1,i.mul(o.sub(l)).add(1)));return li(s,J(l),c)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Dxe extends Qt{static get type(){return"ComputeBuiltinNode"}constructor(e,t){super(t),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){e.hasBuiltin(this._builtinName)}generate(e,t){const i=this.getBuiltinName(e),n=this.getNodeType(e);return e.shaderStage==="compute"?e.format(i,n,t):(console.warn(`ComputeBuiltinNode: Compute built-in value ${i} can not be accessed in the ${e.shaderStage} stage`),e.generateConst(n))}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}}const HB=(s,e)=>me(new Dxe(s,e)),Fxe=HB("numWorkgroups","uvec3"),Vxe=HB("workgroupId","uvec3"),zxe=HB("localId","uvec3"),Uxe=HB("subgroupSize","uint");class Xxe extends Qt{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:i}=e;i.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}const k3=we(Xxe),Oxe=()=>k3("workgroup").append(),Zxe=()=>k3("storage").append(),Wxe=()=>k3("texture").append();class Hxe extends Rm{constructor(e,t){super(e,t),this.isWorkgroupInfoElementNode=!0}generate(e,t){let i;const n=e.context.assign;if(i=super.generate(e),n!==!0){const r=this.getNodeType(e);i=e.format(i,r,t)}return i}}class Qxe extends Qt{constructor(e,t,i=0){super(t),this.bufferType=t,this.bufferCount=i,this.isWorkgroupInfoNode=!0,this.scope=e}label(e){return this.name=e,this}getHash(){return this.uuid}setScope(e){return this.scope=e,this}getInputType(){return`${this.scope}Array`}element(e){return me(new Hxe(this,e))}generate(e){return e.getScopedArray(this.name||`${this.scope}Array_${this.id}`,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}const Kxe=(s,e)=>me(new Qxe("Workgroup",s,e));class Yr extends wi{static get type(){return"AtomicFunctionNode"}constructor(e,t,i,n=null){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=i,this.storeNode=n}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=this.method,i=this.getNodeType(e),n=this.getInputType(e),r=this.pointerNode,o=this.valueNode,a=[];a.push(`&${r.build(e,n)}`),a.push(o.build(e,n));const l=`${e.getMethod(t,i)}( ${a.join(", ")} )`;if(this.storeNode!==null){const c=this.storeNode.build(e,n);e.addLineFlowCode(`${c} = ${l}`,this)}else e.addLineFlowCode(l,this)}}Yr.ATOMIC_LOAD="atomicLoad";Yr.ATOMIC_STORE="atomicStore";Yr.ATOMIC_ADD="atomicAdd";Yr.ATOMIC_SUB="atomicSub";Yr.ATOMIC_MAX="atomicMax";Yr.ATOMIC_MIN="atomicMin";Yr.ATOMIC_AND="atomicAnd";Yr.ATOMIC_OR="atomicOr";Yr.ATOMIC_XOR="atomicXor";const Yxe=we(Yr),Pp=(s,e,t,i)=>{const n=Yxe(s,e,t,i);return n.append(),n},Jxe=(s,e,t=null)=>Pp(Yr.ATOMIC_STORE,s,e,t),jxe=(s,e,t=null)=>Pp(Yr.ATOMIC_ADD,s,e,t),qxe=(s,e,t=null)=>Pp(Yr.ATOMIC_SUB,s,e,t),$xe=(s,e,t=null)=>Pp(Yr.ATOMIC_MAX,s,e,t),eve=(s,e,t=null)=>Pp(Yr.ATOMIC_MIN,s,e,t),tve=(s,e,t=null)=>Pp(Yr.ATOMIC_AND,s,e,t),ive=(s,e,t=null)=>Pp(Yr.ATOMIC_OR,s,e,t),nve=(s,e,t=null)=>Pp(Yr.ATOMIC_XOR,s,e,t),sve=ne(([s=hi()])=>{const e=s.mul(2),t=e.x.floor(),i=e.y.floor();return t.add(i).mod(2).sign()}),HC=ne(([s,e,t])=>{const i=U(t).toVar(),n=U(e).toVar(),r=pm(s).toVar();return vo(r,n,i)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),UL=ne(([s,e])=>{const t=pm(e).toVar(),i=U(s).toVar();return vo(t,i.negate(),i)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),Xs=ne(([s])=>{const e=U(s).toVar();return K(Lm(e))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),Qn=ne(([s,e])=>{const t=U(s).toVar();return e.assign(Xs(t)),t.sub(U(e))}),rve=ne(([s,e,t,i,n,r])=>{const o=U(r).toVar(),a=U(n).toVar(),l=U(i).toVar(),c=U(t).toVar(),h=U(e).toVar(),d=U(s).toVar(),u=U(In(1,a)).toVar();return In(1,o).mul(d.mul(u).add(h.mul(a))).add(o.mul(c.mul(u).add(l.mul(a))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),ove=ne(([s,e,t,i,n,r])=>{const o=U(r).toVar(),a=U(n).toVar(),l=J(i).toVar(),c=J(t).toVar(),h=J(e).toVar(),d=J(s).toVar(),u=U(In(1,a)).toVar();return In(1,o).mul(d.mul(u).add(h.mul(a))).add(o.mul(c.mul(u).add(l.mul(a))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),jee=Bo([rve,ove]),ave=ne(([s,e,t,i,n,r,o,a,l,c,h])=>{const d=U(h).toVar(),u=U(c).toVar(),f=U(l).toVar(),m=U(a).toVar(),g=U(o).toVar(),A=U(r).toVar(),y=U(n).toVar(),b=U(i).toVar(),x=U(t).toVar(),v=U(e).toVar(),_=U(s).toVar(),C=U(In(1,f)).toVar(),S=U(In(1,u)).toVar();return U(In(1,d)).toVar().mul(S.mul(_.mul(C).add(v.mul(f))).add(u.mul(x.mul(C).add(b.mul(f))))).add(d.mul(S.mul(y.mul(C).add(A.mul(f))).add(u.mul(g.mul(C).add(m.mul(f))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),lve=ne(([s,e,t,i,n,r,o,a,l,c,h])=>{const d=U(h).toVar(),u=U(c).toVar(),f=U(l).toVar(),m=J(a).toVar(),g=J(o).toVar(),A=J(r).toVar(),y=J(n).toVar(),b=J(i).toVar(),x=J(t).toVar(),v=J(e).toVar(),_=J(s).toVar(),C=U(In(1,f)).toVar(),S=U(In(1,u)).toVar();return U(In(1,d)).toVar().mul(S.mul(_.mul(C).add(v.mul(f))).add(u.mul(x.mul(C).add(b.mul(f))))).add(d.mul(S.mul(y.mul(C).add(A.mul(f))).add(u.mul(g.mul(C).add(m.mul(f))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),qee=Bo([ave,lve]),cve=ne(([s,e,t])=>{const i=U(t).toVar(),n=U(e).toVar(),r=pt(s).toVar(),o=pt(r.bitAnd(pt(7))).toVar(),a=U(HC(o.lessThan(pt(4)),n,i)).toVar(),l=U(pi(2,HC(o.lessThan(pt(4)),i,n))).toVar();return UL(a,pm(o.bitAnd(pt(1)))).add(UL(l,pm(o.bitAnd(pt(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),hve=ne(([s,e,t,i])=>{const n=U(i).toVar(),r=U(t).toVar(),o=U(e).toVar(),a=pt(s).toVar(),l=pt(a.bitAnd(pt(15))).toVar(),c=U(HC(l.lessThan(pt(8)),o,r)).toVar(),h=U(HC(l.lessThan(pt(4)),r,HC(l.equal(pt(12)).or(l.equal(pt(14))),o,n))).toVar();return UL(c,pm(l.bitAnd(pt(1)))).add(UL(h,pm(l.bitAnd(pt(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),Nr=Bo([cve,hve]),dve=ne(([s,e,t])=>{const i=U(t).toVar(),n=U(e).toVar(),r=Jx(s).toVar();return J(Nr(r.x,n,i),Nr(r.y,n,i),Nr(r.z,n,i))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),uve=ne(([s,e,t,i])=>{const n=U(i).toVar(),r=U(t).toVar(),o=U(e).toVar(),a=Jx(s).toVar();return J(Nr(a.x,o,r,n),Nr(a.y,o,r,n),Nr(a.z,o,r,n))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),Mc=Bo([dve,uve]),pve=ne(([s])=>{const e=U(s).toVar();return pi(.6616,e)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),fve=ne(([s])=>{const e=U(s).toVar();return pi(.982,e)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),mve=ne(([s])=>{const e=J(s).toVar();return pi(.6616,e)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),$ee=Bo([pve,mve]),gve=ne(([s])=>{const e=J(s).toVar();return pi(.982,e)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),ete=Bo([fve,gve]),Ll=ne(([s,e])=>{const t=K(e).toVar(),i=pt(s).toVar();return i.shiftLeft(t).bitOr(i.shiftRight(K(32).sub(t)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),tte=ne(([s,e,t])=>{s.subAssign(t),s.bitXorAssign(Ll(t,K(4))),t.addAssign(e),e.subAssign(s),e.bitXorAssign(Ll(s,K(6))),s.addAssign(t),t.subAssign(e),t.bitXorAssign(Ll(e,K(8))),e.addAssign(s),s.subAssign(t),s.bitXorAssign(Ll(t,K(16))),t.addAssign(e),e.subAssign(s),e.bitXorAssign(Ll(s,K(19))),s.addAssign(t),t.subAssign(e),t.bitXorAssign(Ll(e,K(4))),e.addAssign(s)}),Q1=ne(([s,e,t])=>{const i=pt(t).toVar(),n=pt(e).toVar(),r=pt(s).toVar();return i.bitXorAssign(n),i.subAssign(Ll(n,K(14))),r.bitXorAssign(i),r.subAssign(Ll(i,K(11))),n.bitXorAssign(r),n.subAssign(Ll(r,K(25))),i.bitXorAssign(n),i.subAssign(Ll(n,K(16))),r.bitXorAssign(i),r.subAssign(Ll(i,K(4))),n.bitXorAssign(r),n.subAssign(Ll(r,K(14))),i.bitXorAssign(n),i.subAssign(Ll(n,K(24))),i}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),ia=ne(([s])=>{const e=pt(s).toVar();return U(e).div(U(pt(K(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),Ud=ne(([s])=>{const e=U(s).toVar();return e.mul(e).mul(e).mul(e.mul(e.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),Ave=ne(([s])=>{const e=K(s).toVar(),t=pt(pt(1)).toVar(),i=pt(pt(K(3735928559)).add(t.shiftLeft(pt(2))).add(pt(13))).toVar();return Q1(i.add(pt(e)),i,i)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),yve=ne(([s,e])=>{const t=K(e).toVar(),i=K(s).toVar(),n=pt(pt(2)).toVar(),r=pt().toVar(),o=pt().toVar(),a=pt().toVar();return r.assign(o.assign(a.assign(pt(K(3735928559)).add(n.shiftLeft(pt(2))).add(pt(13))))),r.addAssign(pt(i)),o.addAssign(pt(t)),Q1(r,o,a)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),bve=ne(([s,e,t])=>{const i=K(t).toVar(),n=K(e).toVar(),r=K(s).toVar(),o=pt(pt(3)).toVar(),a=pt().toVar(),l=pt().toVar(),c=pt().toVar();return a.assign(l.assign(c.assign(pt(K(3735928559)).add(o.shiftLeft(pt(2))).add(pt(13))))),a.addAssign(pt(r)),l.addAssign(pt(n)),c.addAssign(pt(i)),Q1(a,l,c)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),xve=ne(([s,e,t,i])=>{const n=K(i).toVar(),r=K(t).toVar(),o=K(e).toVar(),a=K(s).toVar(),l=pt(pt(4)).toVar(),c=pt().toVar(),h=pt().toVar(),d=pt().toVar();return c.assign(h.assign(d.assign(pt(K(3735928559)).add(l.shiftLeft(pt(2))).add(pt(13))))),c.addAssign(pt(a)),h.addAssign(pt(o)),d.addAssign(pt(r)),tte(c,h,d),c.addAssign(pt(n)),Q1(c,h,d)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),vve=ne(([s,e,t,i,n])=>{const r=K(n).toVar(),o=K(i).toVar(),a=K(t).toVar(),l=K(e).toVar(),c=K(s).toVar(),h=pt(pt(5)).toVar(),d=pt().toVar(),u=pt().toVar(),f=pt().toVar();return d.assign(u.assign(f.assign(pt(K(3735928559)).add(h.shiftLeft(pt(2))).add(pt(13))))),d.addAssign(pt(c)),u.addAssign(pt(l)),f.addAssign(pt(a)),tte(d,u,f),d.addAssign(pt(o)),u.addAssign(pt(r)),Q1(d,u,f)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),ln=Bo([Ave,yve,bve,xve,vve]),_ve=ne(([s,e])=>{const t=K(e).toVar(),i=K(s).toVar(),n=pt(ln(i,t)).toVar(),r=Jx().toVar();return r.x.assign(n.bitAnd(K(255))),r.y.assign(n.shiftRight(K(8)).bitAnd(K(255))),r.z.assign(n.shiftRight(K(16)).bitAnd(K(255))),r}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),Cve=ne(([s,e,t])=>{const i=K(t).toVar(),n=K(e).toVar(),r=K(s).toVar(),o=pt(ln(r,n,i)).toVar(),a=Jx().toVar();return a.x.assign(o.bitAnd(K(255))),a.y.assign(o.shiftRight(K(8)).bitAnd(K(255))),a.z.assign(o.shiftRight(K(16)).bitAnd(K(255))),a}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),Ic=Bo([_ve,Cve]),wve=ne(([s])=>{const e=le(s).toVar(),t=K().toVar(),i=K().toVar(),n=U(Qn(e.x,t)).toVar(),r=U(Qn(e.y,i)).toVar(),o=U(Ud(n)).toVar(),a=U(Ud(r)).toVar(),l=U(jee(Nr(ln(t,i),n,r),Nr(ln(t.add(K(1)),i),n.sub(1),r),Nr(ln(t,i.add(K(1))),n,r.sub(1)),Nr(ln(t.add(K(1)),i.add(K(1))),n.sub(1),r.sub(1)),o,a)).toVar();return $ee(l)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),Sve=ne(([s])=>{const e=J(s).toVar(),t=K().toVar(),i=K().toVar(),n=K().toVar(),r=U(Qn(e.x,t)).toVar(),o=U(Qn(e.y,i)).toVar(),a=U(Qn(e.z,n)).toVar(),l=U(Ud(r)).toVar(),c=U(Ud(o)).toVar(),h=U(Ud(a)).toVar(),d=U(qee(Nr(ln(t,i,n),r,o,a),Nr(ln(t.add(K(1)),i,n),r.sub(1),o,a),Nr(ln(t,i.add(K(1)),n),r,o.sub(1),a),Nr(ln(t.add(K(1)),i.add(K(1)),n),r.sub(1),o.sub(1),a),Nr(ln(t,i,n.add(K(1))),r,o,a.sub(1)),Nr(ln(t.add(K(1)),i,n.add(K(1))),r.sub(1),o,a.sub(1)),Nr(ln(t,i.add(K(1)),n.add(K(1))),r,o.sub(1),a.sub(1)),Nr(ln(t.add(K(1)),i.add(K(1)),n.add(K(1))),r.sub(1),o.sub(1),a.sub(1)),l,c,h)).toVar();return ete(d)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),N3=Bo([wve,Sve]),Mve=ne(([s])=>{const e=le(s).toVar(),t=K().toVar(),i=K().toVar(),n=U(Qn(e.x,t)).toVar(),r=U(Qn(e.y,i)).toVar(),o=U(Ud(n)).toVar(),a=U(Ud(r)).toVar(),l=J(jee(Mc(Ic(t,i),n,r),Mc(Ic(t.add(K(1)),i),n.sub(1),r),Mc(Ic(t,i.add(K(1))),n,r.sub(1)),Mc(Ic(t.add(K(1)),i.add(K(1))),n.sub(1),r.sub(1)),o,a)).toVar();return $ee(l)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),Ive=ne(([s])=>{const e=J(s).toVar(),t=K().toVar(),i=K().toVar(),n=K().toVar(),r=U(Qn(e.x,t)).toVar(),o=U(Qn(e.y,i)).toVar(),a=U(Qn(e.z,n)).toVar(),l=U(Ud(r)).toVar(),c=U(Ud(o)).toVar(),h=U(Ud(a)).toVar(),d=J(qee(Mc(Ic(t,i,n),r,o,a),Mc(Ic(t.add(K(1)),i,n),r.sub(1),o,a),Mc(Ic(t,i.add(K(1)),n),r,o.sub(1),a),Mc(Ic(t.add(K(1)),i.add(K(1)),n),r.sub(1),o.sub(1),a),Mc(Ic(t,i,n.add(K(1))),r,o,a.sub(1)),Mc(Ic(t.add(K(1)),i,n.add(K(1))),r.sub(1),o,a.sub(1)),Mc(Ic(t,i.add(K(1)),n.add(K(1))),r,o.sub(1),a.sub(1)),Mc(Ic(t.add(K(1)),i.add(K(1)),n.add(K(1))),r.sub(1),o.sub(1),a.sub(1)),l,c,h)).toVar();return ete(d)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),D3=Bo([Mve,Ive]),Tve=ne(([s])=>{const e=U(s).toVar(),t=K(Xs(e)).toVar();return ia(ln(t))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),Eve=ne(([s])=>{const e=le(s).toVar(),t=K(Xs(e.x)).toVar(),i=K(Xs(e.y)).toVar();return ia(ln(t,i))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),Rve=ne(([s])=>{const e=J(s).toVar(),t=K(Xs(e.x)).toVar(),i=K(Xs(e.y)).toVar(),n=K(Xs(e.z)).toVar();return ia(ln(t,i,n))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),Lve=ne(([s])=>{const e=Xe(s).toVar(),t=K(Xs(e.x)).toVar(),i=K(Xs(e.y)).toVar(),n=K(Xs(e.z)).toVar(),r=K(Xs(e.w)).toVar();return ia(ln(t,i,n,r))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),Bve=Bo([Tve,Eve,Rve,Lve]),Pve=ne(([s])=>{const e=U(s).toVar(),t=K(Xs(e)).toVar();return J(ia(ln(t,K(0))),ia(ln(t,K(1))),ia(ln(t,K(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),Gve=ne(([s])=>{const e=le(s).toVar(),t=K(Xs(e.x)).toVar(),i=K(Xs(e.y)).toVar();return J(ia(ln(t,i,K(0))),ia(ln(t,i,K(1))),ia(ln(t,i,K(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),kve=ne(([s])=>{const e=J(s).toVar(),t=K(Xs(e.x)).toVar(),i=K(Xs(e.y)).toVar(),n=K(Xs(e.z)).toVar();return J(ia(ln(t,i,n,K(0))),ia(ln(t,i,n,K(1))),ia(ln(t,i,n,K(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),Nve=ne(([s])=>{const e=Xe(s).toVar(),t=K(Xs(e.x)).toVar(),i=K(Xs(e.y)).toVar(),n=K(Xs(e.z)).toVar(),r=K(Xs(e.w)).toVar();return J(ia(ln(t,i,n,r,K(0))),ia(ln(t,i,n,r,K(1))),ia(ln(t,i,n,r,K(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),ite=Bo([Pve,Gve,kve,Nve]),XL=ne(([s,e,t,i])=>{const n=U(i).toVar(),r=U(t).toVar(),o=K(e).toVar(),a=J(s).toVar(),l=U(0).toVar(),c=U(1).toVar();return Li(o,()=>{l.addAssign(c.mul(N3(a))),c.mulAssign(n),a.mulAssign(r)}),l}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),nte=ne(([s,e,t,i])=>{const n=U(i).toVar(),r=U(t).toVar(),o=K(e).toVar(),a=J(s).toVar(),l=J(0).toVar(),c=U(1).toVar();return Li(o,()=>{l.addAssign(c.mul(D3(a))),c.mulAssign(n),a.mulAssign(r)}),l}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Dve=ne(([s,e,t,i])=>{const n=U(i).toVar(),r=U(t).toVar(),o=K(e).toVar(),a=J(s).toVar();return le(XL(a,o,r,n),XL(a.add(J(K(19),K(193),K(17))),o,r,n))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Fve=ne(([s,e,t,i])=>{const n=U(i).toVar(),r=U(t).toVar(),o=K(e).toVar(),a=J(s).toVar(),l=J(nte(a,o,r,n)).toVar(),c=U(XL(a.add(J(K(19),K(193),K(17))),o,r,n)).toVar();return Xe(l,c)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Vve=ne(([s,e,t,i,n,r,o])=>{const a=K(o).toVar(),l=U(r).toVar(),c=K(n).toVar(),h=K(i).toVar(),d=K(t).toVar(),u=K(e).toVar(),f=le(s).toVar(),m=J(ite(le(u.add(h),d.add(c)))).toVar(),g=le(m.x,m.y).toVar();g.subAssign(.5),g.mulAssign(l),g.addAssign(.5);const A=le(le(U(u),U(d)).add(g)).toVar(),y=le(A.sub(f)).toVar();return Rt(a.equal(K(2)),()=>xn(y.x).add(xn(y.y))),Rt(a.equal(K(3)),()=>Ri(xn(y.x),xn(y.y))),ls(y,y)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),zve=ne(([s,e,t,i,n,r,o,a,l])=>{const c=K(l).toVar(),h=U(a).toVar(),d=K(o).toVar(),u=K(r).toVar(),f=K(n).toVar(),m=K(i).toVar(),g=K(t).toVar(),A=K(e).toVar(),y=J(s).toVar(),b=J(ite(J(A.add(f),g.add(u),m.add(d)))).toVar();b.subAssign(.5),b.mulAssign(h),b.addAssign(.5);const x=J(J(U(A),U(g),U(m)).add(b)).toVar(),v=J(x.sub(y)).toVar();return Rt(c.equal(K(2)),()=>xn(v.x).add(xn(v.y)).add(xn(v.z))),Rt(c.equal(K(3)),()=>Ri(Ri(xn(v.x),xn(v.y)),xn(v.z))),ls(v,v)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),$x=Bo([Vve,zve]),Uve=ne(([s,e,t])=>{const i=K(t).toVar(),n=U(e).toVar(),r=le(s).toVar(),o=K().toVar(),a=K().toVar(),l=le(Qn(r.x,o),Qn(r.y,a)).toVar(),c=U(1e6).toVar();return Li({start:-1,end:K(1),name:"x",condition:"<="},({x:h})=>{Li({start:-1,end:K(1),name:"y",condition:"<="},({y:d})=>{const u=U($x(l,h,d,o,a,n,i)).toVar();c.assign(Vr(c,u))})}),Rt(i.equal(K(0)),()=>{c.assign(Xh(c))}),c}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Xve=ne(([s,e,t])=>{const i=K(t).toVar(),n=U(e).toVar(),r=le(s).toVar(),o=K().toVar(),a=K().toVar(),l=le(Qn(r.x,o),Qn(r.y,a)).toVar(),c=le(1e6,1e6).toVar();return Li({start:-1,end:K(1),name:"x",condition:"<="},({x:h})=>{Li({start:-1,end:K(1),name:"y",condition:"<="},({y:d})=>{const u=U($x(l,h,d,o,a,n,i)).toVar();Rt(u.lessThan(c.x),()=>{c.y.assign(c.x),c.x.assign(u)}).ElseIf(u.lessThan(c.y),()=>{c.y.assign(u)})})}),Rt(i.equal(K(0)),()=>{c.assign(Xh(c))}),c}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Ove=ne(([s,e,t])=>{const i=K(t).toVar(),n=U(e).toVar(),r=le(s).toVar(),o=K().toVar(),a=K().toVar(),l=le(Qn(r.x,o),Qn(r.y,a)).toVar(),c=J(1e6,1e6,1e6).toVar();return Li({start:-1,end:K(1),name:"x",condition:"<="},({x:h})=>{Li({start:-1,end:K(1),name:"y",condition:"<="},({y:d})=>{const u=U($x(l,h,d,o,a,n,i)).toVar();Rt(u.lessThan(c.x),()=>{c.z.assign(c.y),c.y.assign(c.x),c.x.assign(u)}).ElseIf(u.lessThan(c.y),()=>{c.z.assign(c.y),c.y.assign(u)}).ElseIf(u.lessThan(c.z),()=>{c.z.assign(u)})})}),Rt(i.equal(K(0)),()=>{c.assign(Xh(c))}),c}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Zve=ne(([s,e,t])=>{const i=K(t).toVar(),n=U(e).toVar(),r=J(s).toVar(),o=K().toVar(),a=K().toVar(),l=K().toVar(),c=J(Qn(r.x,o),Qn(r.y,a),Qn(r.z,l)).toVar(),h=U(1e6).toVar();return Li({start:-1,end:K(1),name:"x",condition:"<="},({x:d})=>{Li({start:-1,end:K(1),name:"y",condition:"<="},({y:u})=>{Li({start:-1,end:K(1),name:"z",condition:"<="},({z:f})=>{const m=U($x(c,d,u,f,o,a,l,n,i)).toVar();h.assign(Vr(h,m))})})}),Rt(i.equal(K(0)),()=>{h.assign(Xh(h))}),h}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Wve=Bo([Uve,Zve]),Hve=ne(([s,e,t])=>{const i=K(t).toVar(),n=U(e).toVar(),r=J(s).toVar(),o=K().toVar(),a=K().toVar(),l=K().toVar(),c=J(Qn(r.x,o),Qn(r.y,a),Qn(r.z,l)).toVar(),h=le(1e6,1e6).toVar();return Li({start:-1,end:K(1),name:"x",condition:"<="},({x:d})=>{Li({start:-1,end:K(1),name:"y",condition:"<="},({y:u})=>{Li({start:-1,end:K(1),name:"z",condition:"<="},({z:f})=>{const m=U($x(c,d,u,f,o,a,l,n,i)).toVar();Rt(m.lessThan(h.x),()=>{h.y.assign(h.x),h.x.assign(m)}).ElseIf(m.lessThan(h.y),()=>{h.y.assign(m)})})})}),Rt(i.equal(K(0)),()=>{h.assign(Xh(h))}),h}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Qve=Bo([Xve,Hve]),Kve=ne(([s,e,t])=>{const i=K(t).toVar(),n=U(e).toVar(),r=J(s).toVar(),o=K().toVar(),a=K().toVar(),l=K().toVar(),c=J(Qn(r.x,o),Qn(r.y,a),Qn(r.z,l)).toVar(),h=J(1e6,1e6,1e6).toVar();return Li({start:-1,end:K(1),name:"x",condition:"<="},({x:d})=>{Li({start:-1,end:K(1),name:"y",condition:"<="},({y:u})=>{Li({start:-1,end:K(1),name:"z",condition:"<="},({z:f})=>{const m=U($x(c,d,u,f,o,a,l,n,i)).toVar();Rt(m.lessThan(h.x),()=>{h.z.assign(h.y),h.y.assign(h.x),h.x.assign(m)}).ElseIf(m.lessThan(h.y),()=>{h.z.assign(h.y),h.y.assign(m)}).ElseIf(m.lessThan(h.z),()=>{h.z.assign(m)})})})}),Rt(i.equal(K(0)),()=>{h.assign(Xh(h))}),h}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Yve=Bo([Ove,Kve]),Jve=ne(([s])=>{const e=s.y,t=s.z,i=J().toVar();return Rt(e.lessThan(1e-4),()=>{i.assign(J(t,t,t))}).Else(()=>{let n=s.x;n=n.sub(Lm(n)).mul(6).toVar();const r=K(ZX(n)),o=n.sub(U(r)),a=t.mul(e.oneMinus()),l=t.mul(e.mul(o).oneMinus()),c=t.mul(e.mul(o.oneMinus()).oneMinus());Rt(r.equal(K(0)),()=>{i.assign(J(t,c,a))}).ElseIf(r.equal(K(1)),()=>{i.assign(J(l,t,a))}).ElseIf(r.equal(K(2)),()=>{i.assign(J(a,t,c))}).ElseIf(r.equal(K(3)),()=>{i.assign(J(a,l,t))}).ElseIf(r.equal(K(4)),()=>{i.assign(J(c,a,t))}).Else(()=>{i.assign(J(t,a,l))})}),i}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),jve=ne(([s])=>{const e=J(s).toVar(),t=U(e.x).toVar(),i=U(e.y).toVar(),n=U(e.z).toVar(),r=U(Vr(t,Vr(i,n))).toVar(),o=U(Ri(t,Ri(i,n))).toVar(),a=U(o.sub(r)).toVar(),l=U().toVar(),c=U().toVar(),h=U().toVar();return h.assign(o),Rt(o.greaterThan(0),()=>{c.assign(a.div(o))}).Else(()=>{c.assign(0)}),Rt(c.lessThanEqual(0),()=>{l.assign(0)}).Else(()=>{Rt(t.greaterThanEqual(o),()=>{l.assign(i.sub(n).div(a))}).ElseIf(i.greaterThanEqual(o),()=>{l.assign(Yn(2,n.sub(t).div(a)))}).Else(()=>{l.assign(Yn(4,t.sub(i).div(a)))}),l.mulAssign(1/6),Rt(l.lessThan(0),()=>{l.addAssign(1)})}),J(l,c,h)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),qve=ne(([s])=>{const e=J(s).toVar(),t=TX(VX(e,J(.04045))).toVar(),i=J(e.div(12.92)).toVar(),n=J(Ia(Ri(e.add(J(.055)),J(0)).div(1.055),J(2.4))).toVar();return li(i,n,t)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),ste=(s,e)=>{s=U(s),e=U(e);const t=le(e.dFdx(),e.dFdy()).length().mul(.7071067811865476);return Ga(s.sub(t),s.add(t),e)},rte=(s,e,t,i)=>li(s,e,t[i].clamp()),$ve=(s,e,t=hi())=>rte(s,e,t,"x"),e_e=(s,e,t=hi())=>rte(s,e,t,"y"),ote=(s,e,t,i,n)=>li(s,e,ste(t,i[n])),t_e=(s,e,t,i=hi())=>ote(s,e,t,i,"x"),i_e=(s,e,t,i=hi())=>ote(s,e,t,i,"y"),n_e=(s=1,e=0,t=hi())=>t.mul(s).add(e),s_e=(s,e=1)=>(s=U(s),s.abs().pow(e).mul(s.sign())),r_e=(s,e=1,t=.5)=>U(s).sub(t).mul(e).add(t),o_e=(s=hi(),e=1,t=0)=>N3(s.convert("vec2|vec3")).mul(e).add(t),a_e=(s=hi(),e=1,t=0)=>D3(s.convert("vec2|vec3")).mul(e).add(t),l_e=(s=hi(),e=1,t=0)=>(s=s.convert("vec2|vec3"),Xe(D3(s),N3(s.add(le(19,73)))).mul(e).add(t)),c_e=(s=hi(),e=1)=>Wve(s.convert("vec2|vec3"),e,K(1)),h_e=(s=hi(),e=1)=>Qve(s.convert("vec2|vec3"),e,K(1)),d_e=(s=hi(),e=1)=>Yve(s.convert("vec2|vec3"),e,K(1)),u_e=(s=hi())=>Bve(s.convert("vec2|vec3")),p_e=(s=hi(),e=3,t=2,i=.5,n=1)=>XL(s,K(e),t,i).mul(n),f_e=(s=hi(),e=3,t=2,i=.5,n=1)=>Dve(s,K(e),t,i).mul(n),m_e=(s=hi(),e=3,t=2,i=.5,n=1)=>nte(s,K(e),t,i).mul(n),g_e=(s=hi(),e=3,t=2,i=.5,n=1)=>Fve(s,K(e),t,i).mul(n),ate=ne(([s,e])=>{const t=s.x,i=s.y,n=s.z;let r=e.element(0).mul(.886227);return r=r.add(e.element(1).mul(2*.511664).mul(i)),r=r.add(e.element(2).mul(2*.511664).mul(n)),r=r.add(e.element(3).mul(2*.511664).mul(t)),r=r.add(e.element(4).mul(2*.429043).mul(t).mul(i)),r=r.add(e.element(5).mul(2*.429043).mul(i).mul(n)),r=r.add(e.element(6).mul(n.mul(n).mul(.743125).sub(.247708))),r=r.add(e.element(7).mul(2*.429043).mul(t).mul(n)),r=r.add(e.element(8).mul(.429043).mul(pi(t,t).sub(pi(i,i)))),r});class lte extends Gm{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=$e(0).setGroup(Ui),this.decayExponentNode=$e(0).setGroup(Ui)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setup(e){const{colorNode:t,cutoffDistanceNode:i,decayExponentNode:n,light:r}=this,o=e.context.lightingModel,a=WB(r).sub(_o),l=a.normalize(),c=a.length(),h=L3({lightDistance:c,cutoffDistance:i,decayExponent:n}),d=t.mul(h),u=e.context.reflectedLight;o.direct({lightDirection:l,lightColor:d,reflectedLight:u},e.stack,e)}}class cte extends Gm{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setup(e){super.setup(e);const t=e.context.lightingModel,i=this.colorNode,n=G3(this.light),r=e.context.reflectedLight;t.direct({lightDirection:n,lightColor:i,reflectedLight:r},e.stack,e)}}const Sk=new ce,lT=new ce;let n_=null;class hte extends Gm{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=$e(new T).setGroup(Ui),this.halfWidth=$e(new T).setGroup(Ui)}update(e){super.update(e);const{light:t}=this,i=e.camera.matrixWorldInverse;lT.identity(),Sk.copy(t.matrixWorld),Sk.premultiply(i),lT.extractRotation(Sk),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(lT),this.halfHeight.value.applyMatrix4(lT)}setup(e){super.setup(e);let t,i;e.isAvailable("float32Filterable")?(t=Gi(n_.LTC_FLOAT_1),i=Gi(n_.LTC_FLOAT_2)):(t=Gi(n_.LTC_HALF_1),i=Gi(n_.LTC_HALF_2));const{colorNode:n,light:r}=this,o=e.context.lightingModel,a=WB(r),l=e.context.reflectedLight;o.directRectArea({lightColor:n,lightPosition:a,halfWidth:this.halfWidth,halfHeight:this.halfHeight,reflectedLight:l,ltc_1:t,ltc_2:i},e.stack,e)}static setLTC(e){n_=e}}class F3 extends Gm{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=$e(0).setGroup(Ui),this.penumbraCosNode=$e(0).setGroup(Ui),this.cutoffDistanceNode=$e(0).setGroup(Ui),this.decayExponentNode=$e(0).setGroup(Ui)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e){const{coneCosNode:t,penumbraCosNode:i}=this;return Ga(t,i,e)}setup(e){super.setup(e);const t=e.context.lightingModel,{colorNode:i,cutoffDistanceNode:n,decayExponentNode:r,light:o}=this,a=WB(o).sub(_o),l=a.normalize(),c=l.dot(G3(o)),h=this.getSpotAttenuation(c),d=a.length(),u=L3({lightDistance:d,cutoffDistance:n,decayExponent:r}),f=i.mul(h).mul(u),m=e.context.reflectedLight;t.direct({lightDirection:l,lightColor:f,reflectedLight:m},e.stack,e)}}class dte extends F3{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e){const t=this.light.iesMap;let i=null;if(t&&t.isTexture===!0){const n=e.acos().mul(1/Math.PI);i=Gi(t,le(n,0),0).r}else i=super.getSpotAttenuation(e);return i}}class ute extends Gm{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class pte extends Gm{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=P3(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=$e(new ge).setGroup(Ui)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:i,lightDirectionNode:n}=this,o=ql.dot(n).mul(.5).add(.5),a=li(i,t,o);e.context.irradiance.addAssign(a)}}class fte extends Gm{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let i=0;i<9;i++)t.push(new T);this.lightProbe=zd(t)}update(e){const{light:t}=this;super.update(e);for(let i=0;i<9;i++)this.lightProbe.array[i].copy(t.sh.coefficients[i]).multiplyScalar(t.intensity)}setup(e){const t=ate(PB,this.lightProbe);e.context.irradiance.addAssign(t)}}class A_e{parseFunction(){console.warn("Abstract function.")}}class mte{constructor(e,t,i="",n=""){this.type=e,this.inputs=t,this.name=i,this.precision=n}getCode(){console.warn("Abstract function.")}}mte.isNodeFunction=!0;const y_e=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,b_e=/[a-z_0-9]+/ig,I9="#pragma main",x_e=s=>{s=s.trim();const e=s.indexOf(I9),t=e!==-1?s.slice(e+I9.length):s,i=t.match(y_e);if(i!==null&&i.length===5){const n=i[4],r=[];let o=null;for(;(o=b_e.exec(n))!==null;)r.push(o);const a=[];let l=0;for(;l<r.length;){const m=r[l][0]==="const";m===!0&&l++;let g=r[l][0];g==="in"||g==="out"||g==="inout"?l++:g="";const A=r[l++][0];let y=Number.parseInt(r[l][0]);Number.isNaN(y)===!1?l++:y=null;const b=r[l++][0];a.push(new M3(A,b,y,g,m))}const c=t.substring(i[0].length),h=i[3]!==void 0?i[3]:"",d=i[2],u=i[1]!==void 0?i[1]:"",f=e!==-1?s.slice(0,e):"";return{type:d,inputs:a,name:h,precision:u,inputsCode:n,blockCode:c,headerCode:f}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class v_e extends mte{constructor(e){const{type:t,inputs:i,name:n,precision:r,inputsCode:o,blockCode:a,headerCode:l}=x_e(e);super(t,i,n,r),this.inputsCode=o,this.blockCode=a,this.headerCode=l}getCode(e=this.name){let t;const i=this.blockCode;if(i!==""){const{type:n,inputsCode:r,headerCode:o,precision:a}=this;let l=`${n} ${e} ( ${r.trim()} )`;a!==""&&(l=`${a} ${l}`),t=o+l+i}else t="";return t}}class __e extends A_e{parseFunction(e){return new v_e(e)}}class C_e{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map,this.colorSpaceNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const i=this.getMaterialNodeClass(e.type);if(i!==null){t=new i;for(const n in e)t[n]=e[n]}return t}addColorSpace(e,t){this.addType(e,t,this.colorSpaceNodes)}getColorSpaceFunction(e){return this.colorSpaceNodes.get(e)||null}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t.name,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,i){if(i.has(t)){console.warn(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);i.set(t,e)}addClass(e,t,i){if(i.has(t)){console.warn(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);i.set(t,e)}}class w_e extends pA{constructor(e,t,i,n,r,o){super(e,t,i,n,r,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class gte extends C_e{constructor(){super(),this.addLight(lte,dm),this.addLight(cte,um),this.addLight(hte,lX),this.addLight(F3,pA),this.addLight(ute,T1),this.addLight(pte,vB),this.addLight(fte,cX),this.addLight(dte,w_e),this.addToneMapping(Wee,aA),this.addToneMapping(Hee,Vx),this.addToneMapping(Qee,CU),this.addToneMapping(Kee,zx),this.addToneMapping(Yee,lA),this.addToneMapping(Jee,om),this.addColorSpace(Zee,GL(Ji,ft)),this.addColorSpace(Oee,GL(ft,Ji))}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:La}}));if(typeof window<"u"){try{typeof document>"u"?require("url").pathToFileURL(__filename).href:Ju&&Ju.tagName.toUpperCase()==="SCRIPT"&&Ju.src||new URL("dist/needle-engine.light.umd.cjs",document.baseURI).href,window.__THREE__IMPORTS__||(window.__THREE__IMPORTS__=[]),window.__THREE__IMPORTS__.push({url:typeof document>"u"?require("url").pathToFileURL(__filename).href:Ju&&Ju.tagName.toUpperCase()==="SCRIPT"&&Ju.src||new URL("dist/needle-engine.light.umd.cjs",document.baseURI).href,revision:La})}catch{}window.__THREE__?(console.warn("WARNING: Multiple instances of Three.js being imported. Existing: "+window.__THREE__+", new: "+La),console.warn(window.__THREE__IMPORTS__)):window.__THREE__=La}const S_e=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:zx,AONode:r$,AddEquation:Lf,AddOperation:_U,AdditiveAnimationBlendMode:RU,AdditiveBlending:sm,AfterImageNode:pee,AgXToneMapping:lA,AlphaFormat:SU,AlwaysCompare:l8,AlwaysDepth:lx,AlwaysStencilFunc:vL,AmbientLight:T1,AmbientLightNode:ute,AnaglyphPassNode:Lee,AnalyticLightNode:Gm,AnamorphicNode:mee,AnimationAction:$8,AnimationClip:Ba,AnimationLoader:Ome,AnimationMixer:wB,AnimationObjectGroup:lge,AnimationUtils:Vme,ArcCurve:P8,ArrayCamera:VU,ArrayElementNode:Rm,ArrowHelper:_ge,AssignNode:T6,AttachedBindMode:zF,AttributeNode:t3,Audio:uX,AudioAnalyser:qme,AudioContext:CB,AudioListener:J8,AudioLoader:ML,AxesHelper:al,BRDF_GGX:cV,BRDF_Lambert:J0,BackSide:vn,BasicDepthPacking:Io,BasicEnvironmentNode:VB,BasicNodeLibrary:gte,BasicShadowMap:cce,BatchNode:jq,BatchedMesh:Vw,BloomNode:See,Bone:Q0,BooleanKeyframeTrack:dA,Box2:fge,Box3:oi,Box3Helper:gX,BoxGeometry:pn,BoxHelper:s6,Break:FB,BufferAttribute:dt,BufferAttributeNode:N7,BufferGeometry:It,BufferGeometryLoader:Q8,BufferNode:kB,BumpMapNode:yq,BypassNode:U7,ByteType:Iw,Cache:cp,CacheNode:z7,Camera:x1,CameraHelper:n6,CanvasTexture:HU,CapsuleGeometry:oB,CatmullRomCurve3:G8,CineonToneMapping:CU,CircleGeometry:aB,ClampToEdgeWrapping:ea,Clock:dX,CodeNode:_3,Color:ge,ColorKeyframeTrack:bB,ColorManagement:ni,ColorSpaceNode:N1,CompressedArrayTexture:B8,CompressedCubeTexture:WU,CompressedTexture:Fd,CompressedTextureLoader:Zme,ComputeNode:F7,ConeGeometry:lB,ConstNode:Hc,ConstantAlphaFactor:Dj,ConstantColorFactor:kj,ContextNode:YX,Continue:B0e,Controls:MB,ConvertNode:_X,CubeCamera:eB,CubeReflectionMapping:jl,CubeRefractionMapping:zc,CubeTexture:hA,CubeTextureLoader:Wme,CubeTextureNode:hq,CubeUVReflectionMapping:cA,CubicBezierCurve:KU,CubicBezierCurve3:k8,CubicInterpolant:O8,CullFaceBack:DF,CullFaceFront:_j,CullFaceFrontBack:lce,CullFaceNone:vj,Curve:Zc,CurvePath:D8,CustomBlending:bU,CustomToneMapping:Vj,CylinderGeometry:Ns,Cylindrical:pge,DFGApprox:y3,D_GGX:_$,Data3DTexture:q2,DataArrayTexture:b1,DataTexture:ir,DataTextureLoader:oX,DataUtils:a0,DecrementStencilOp:Qj,DecrementWrapStencilOp:Yj,DefaultLoadingManager:rX,DenoiseNode:Cee,DepthFormat:b0,DepthOfFieldNode:Aee,DepthStencilFormat:cm,DepthTexture:Bp,DetachedBindMode:zj,DirectionalLight:um,DirectionalLightHelper:i6,DirectionalLightNode:cte,Discard:H7,DiscreteInterpolant:Z8,DisplayP3ColorSpace:y1,DodecahedronGeometry:cB,DotScreenNode:yee,DoubleSide:Zi,DstAlphaFactor:Rj,DstColorFactor:Bj,DynamicCopyUsage:vce,DynamicDrawUsage:Vs,DynamicReadUsage:yce,EPSILON:K6,EdgesGeometry:$U,EllipseCurve:rB,EnvironmentNode:P$,EqualCompare:s8,EqualDepth:rm,EqualStencilFunc:qj,EquirectUVNode:g$,EquirectangularReflectionMapping:wo,EquirectangularRefractionMapping:am,Euler:Xi,EventDispatcher:Mr,ExpressionNode:W7,ExtrudeGeometry:Qx,FXAANode:wee,F_Schlick:bx,FileLoader:Is,FilmNode:xee,Float16BufferAttribute:y8,Float32BufferAttribute:ut,FloatType:$i,Fn:ne,Fog:sB,FogExp2:nB,FogExp2Node:Fee,FogNode:ZB,FogRangeNode:Dee,FramebufferTexture:ZU,FrontFacingNode:tq,FrontSide:us,Frustum:H0,FunctionCallNode:R6,FunctionNode:C3,FunctionOverloadingNode:J$,GLBufferAttribute:uge,GLSL1:Cce,GLSL3:_L,GLSLNodeParser:__e,GTAONode:_ee,GaussianBlurNode:uee,GreaterCompare:r8,GreaterDepth:hx,GreaterEqualCompare:a8,GreaterEqualDepth:cx,GreaterEqualStencilFunc:i8,GreaterStencilFunc:e8,GridHelper:SB,Group:Ms,HalfFloatType:Wi,HemisphereLight:vB,HemisphereLightHelper:bge,HemisphereLightNode:pte,IESSpotLightNode:dte,INFINITY:Qge,IcosahedronGeometry:dB,If:Rt,ImageBitmapLoader:Y8,ImageLoader:Zw,ImageUtils:p8,IncrementStencilOp:Hj,IncrementWrapStencilOp:Kj,IndexNode:Nn,InstanceNode:Yq,InstancedBufferAttribute:$o,InstancedBufferGeometry:_B,InstancedInterleavedBuffer:Ww,InstancedMesh:XU,InstancedPointsNodeMaterial:Q0e,Int16BufferAttribute:ahe,Int32BufferAttribute:lhe,Int8BufferAttribute:she,IntType:Dd,InterleavedBuffer:Hx,InterleavedBufferAttribute:Ma,Interpolant:Kx,InterpolateDiscrete:hm,InterpolateLinear:Mp,InterpolateSmooth:hR,InvertStencilOp:Jj,IrradianceNode:l$,JoinNode:h6,KeepStencilOp:Sf,KeyframeTrack:Uh,LOD:UU,LatheGeometry:w1,Layers:ta,LessCompare:PU,LessDepth:U0,LessEqualCompare:GU,LessEqualDepth:wp,LessEqualStencilFunc:$j,LessStencilFunc:jj,Light:Tm,LightProbe:cX,LightProbeNode:fte,LightingContextNode:o$,LightingModel:H1,LightingNode:mA,LightsNode:n$,Line:ts,Line2NodeMaterial:$0e,Line3:Fc,LineBasicMaterial:_n,LineBasicNodeMaterial:Y0e,LineCurve:YU,LineCurve3:N8,LineDashedMaterial:yB,LineDashedNodeMaterial:j0e,LineLoop:OU,LineSegments:sa,LinearDisplayP3ColorSpace:Ox,LinearFilter:Ot,LinearInterpolant:sX,LinearMipMapLinearFilter:Uj,LinearMipMapNearestFilter:uce,LinearMipmapLinearFilter:xr,LinearMipmapNearestFilter:mp,LinearSRGBColorSpace:Ji,LinearToneMapping:aA,LinearTransfer:kw,Loader:ps,LoaderUtils:Vd,LoadingManager:xB,Loop:Li,LoopNode:e$,LoopOnce:Pw,LoopPingPong:Xj,LoopRepeat:EU,LuminanceAlphaFormat:IU,LuminanceFormat:A1,Lut3DNode:vee,MOUSE:y0,MRTNode:Y$,MatcapUVNode:N$,Material:Yt,MaterialLoader:E1,MaterialNode:Me,MaterialReferenceNode:dq,MathUtils:Bi,Matrix2:mX,Matrix3:ei,Matrix4:ce,MaxEquation:xU,MaxMipLevelNode:J7,Mesh:fe,MeshBasicMaterial:ii,MeshBasicNodeMaterial:lAe,MeshDepthMaterial:v1,MeshDistanceMaterial:FU,MeshLambertMaterial:AB,MeshLambertNodeMaterial:pAe,MeshMatcapMaterial:iX,MeshMatcapNodeMaterial:jAe,MeshNormalMaterial:I1,MeshNormalNodeMaterial:iAe,MeshPhongMaterial:Of,MeshPhongNodeMaterial:mAe,MeshPhysicalMaterial:To,MeshPhysicalNodeMaterial:k$,MeshSSSNodeMaterial:WAe,MeshStandardMaterial:Us,MeshStandardNodeMaterial:G$,MeshToonMaterial:tX,MeshToonNodeMaterial:YAe,MinEquation:Sj,MirroredRepeatWrapping:Sp,MixOperation:vU,ModelNode:Gh,ModelViewProjectionNode:Hq,MorphNode:t$,MultiplyBlending:VF,MultiplyOperation:Fx,NearestFilter:qt,NearestMipMapLinearFilter:dce,NearestMipMapNearestFilter:hce,NearestMipmapLinearFilter:Id,NearestMipmapNearestFilter:g1,NeutralToneMapping:om,NeverCompare:n8,NeverDepth:Mw,NeverStencilFunc:UF,NoBlending:Fn,NoColorSpace:Fr,NoToneMapping:Zr,Node:Qt,NodeAttribute:fV,NodeBuilder:Fye,NodeCache:AR,NodeCode:W$,NodeFrame:K$,NodeFunctionInput:M3,NodeLoader:U$,NodeMaterial:Hi,NodeMaterialLoader:X$,NodeMaterialObserver:o6,NodeObjectLoader:aye,NodeShaderStage:qF,NodeType:Mge,NodeUniform:O$,NodeUpdateType:Zt,NodeUtils:Sge,NodeVar:x3,NodeVarying:Z$,NormalAnimationBlendMode:J2,NormalBlending:fp,NormalMapNode:Aq,NotEqualCompare:o8,NotEqualDepth:X0,NotEqualStencilFunc:t8,NumberKeyframeTrack:Ip,Object3D:ye,Object3DNode:Yi,ObjectLoader:K8,ObjectSpaceNormalMap:BU,OctahedronGeometry:lp,OneFactor:Ij,OneMinusConstantAlphaFactor:Fj,OneMinusConstantColorFactor:Nj,OneMinusDstAlphaFactor:Lj,OneMinusDstColorFactor:Pj,OneMinusSrcAlphaFactor:eL,OneMinusSrcColorFactor:Ej,OrthographicCamera:zh,OscNode:yr,OutputStructNode:I3,P3Primaries:Dw,PCFShadowMap:AU,PCFSoftShadowMap:yU,PI:Y0,PI2:Kge,PMREMGenerator:OF,PMREMNode:L$,ParallaxBarrierPassNode:Bee,ParameterNode:v3,PassNode:Kr,Path:zw,PerspectiveCamera:Xt,PhongLightingModel:g3,PhysicalLightingModel:UB,PixelationPassNode:Iee,Plane:js,PlaneGeometry:Rs,PlaneHelper:vge,PointLight:dm,PointLightHelper:Age,PointLightNode:lte,PointUVNode:ree,Points:Hb,PointsMaterial:Td,PointsNodeMaterial:$Ae,PolarGridHelper:xge,PolyhedronGeometry:Im,PositionalAudio:j8,PosterizeNode:cee,PropertyBinding:di,PropertyMixer:q8,PropertyNode:tn,QuadraticBezierCurve:JU,QuadraticBezierCurve3:jU,Quaternion:Ve,QuaternionKeyframeTrack:Kd,QuaternionLinearInterpolant:W8,RED_GREEN_RGTC2_Format:yL,RED_RGTC1_Format:TU,REVISION:La,RGBADepthPacking:j2,RGBAFormat:bi,RGBAIntegerFormat:Z0,RGBA_ASTC_10x10_Format:uL,RGBA_ASTC_10x5_Format:cL,RGBA_ASTC_10x6_Format:hL,RGBA_ASTC_10x8_Format:dL,RGBA_ASTC_12x10_Format:pL,RGBA_ASTC_12x12_Format:fL,RGBA_ASTC_4x4_Format:dx,RGBA_ASTC_5x4_Format:nL,RGBA_ASTC_5x5_Format:sL,RGBA_ASTC_6x5_Format:rL,RGBA_ASTC_6x6_Format:ux,RGBA_ASTC_8x5_Format:oL,RGBA_ASTC_8x6_Format:aL,RGBA_ASTC_8x8_Format:lL,RGBA_BPTC_Format:Zb,RGBA_ETC2_EAC_Format:Bw,RGBA_PVRTC_2BPPV1_Format:iL,RGBA_PVRTC_4BPPV1_Format:Ew,RGBA_S3TC_DXT1_Format:Xb,RGBA_S3TC_DXT3_Format:kC,RGBA_S3TC_DXT5_Format:Ob,RGBDepthPacking:fce,RGBFormat:MU,RGBIntegerFormat:pce,RGBShiftNode:bee,RGB_BPTC_SIGNED_Format:mL,RGB_BPTC_UNSIGNED_Format:gL,RGB_ETC1_Format:Rw,RGB_ETC2_Format:Lw,RGB_PVRTC_2BPPV1_Format:tL,RGB_PVRTC_4BPPV1_Format:Tw,RGB_S3TC_DXT1_Format:GC,RGDepthPacking:mce,RGFormat:Pc,RGIntegerFormat:Xx,RTTNode:iee,RangeNode:Vee,RawShaderMaterial:gB,Ray:Fa,Raycaster:Em,Rec709Primaries:Nw,RectAreaLight:lX,RectAreaLightNode:hte,RedFormat:Vl,RedIntegerFormat:Ux,ReferenceNode:z1,ReflectorNode:tee,ReinhardToneMapping:Vx,RemapNode:e3,RenderOutputNode:Q7,RenderTarget:vr,RendererReferenceNode:L7,RepeatWrapping:Mo,ReplaceStencilOp:Wj,Return:$ge,ReverseSubtractEquation:wj,RingGeometry:S1,RotateNode:F$,SIGNED_RED_GREEN_RGTC2_Format:bL,SIGNED_RED_RGTC1_Format:AL,SRGBColorSpace:ft,SRGBTransfer:Ln,SSAAPassNode:Tee,Scene:sr,SceneNode:Ih,Schlick_to_F0:w$,ScreenNode:zs,ScriptableNode:Nee,ScriptableValueNode:Gee,SetNode:d6,ShaderChunk:Ut,ShaderLib:Wn,ShaderMaterial:Ht,ShaderNode:VC,ShadowMaterial:M1,ShadowNodeMaterial:sye,Shape:Xf,ShapeGeometry:uB,ShapePath:r6,ShapeUtils:Sh,ShortType:Q2,Skeleton:C1,SkeletonHelper:gge,SkinnedMesh:ol,SkinningNode:d3,SobelOperatorNode:gee,Source:ap,Sphere:Vn,SphereGeometry:Wc,Spherical:jF,SphericalHarmonics3:H8,SplineCurve:qU,SplitNode:IL,SpotLight:pA,SpotLightHelper:mge,SpotLightNode:F3,Sprite:zU,SpriteMaterial:_1,SpriteNodeMaterial:tye,SpriteSheetUVNode:j$,SrcAlphaFactor:$R,SrcAlphaSaturateFactor:Gj,SrcColorFactor:Tj,StackNode:Q$,StaticCopyUsage:xce,StaticDrawUsage:px,StaticReadUsage:Ace,StereoCamera:hX,StereoPassNode:Eee,StorageArrayElementNode:q$,StorageBufferNode:R3,StorageTextureNode:oee,StreamCopyUsage:_ce,StreamDrawUsage:gce,StreamReadUsage:bce,StringKeyframeTrack:uA,SubtractEquation:Cj,SubtractiveBlending:FF,TBNViewMatrix:h0,TOUCH:s0,TangentSpaceNormalMap:Qd,TempNode:wi,TetrahedronGeometry:pB,Texture:si,Texture3DNode:V$,TextureLoader:Mh,TextureNode:Jd,TextureSizeNode:Y7,TextureUtils:Zfe,TimerNode:Xr,ToneMappingNode:P7,ToonOutlinePassNode:Pee,TorusGeometry:tp,TorusKnotGeometry:fB,TransitionNode:Mee,Triangle:$s,TriangleFanDrawMode:xL,TriangleStripDrawMode:LU,TrianglesDrawMode:Oj,TriplanarTexturesNode:$$,TubeGeometry:mB,UVMapping:H2,Uint16BufferAttribute:$2,Uint32BufferAttribute:NU,Uint8BufferAttribute:rhe,Uint8ClampedBufferAttribute:ohe,Uniform:Te,UniformArrayNode:o3,UniformGroupNode:EX,UniformNode:fA,UniformsGroup:dge,UniformsLib:ht,UniformsUtils:Zx,UnsignedByteType:Pi,UnsignedInt248Type:lm,UnsignedInt5999Type:wU,UnsignedIntType:Wr,UnsignedShort4444Type:K2,UnsignedShort5551Type:Y2,UnsignedShortType:O0,UserDataNode:lee,VSMShadowMap:qa,V_GGX_SmithCorrelated:v$,VarNode:S7,VaryingNode:M7,Vector2:Q,Vector3:T,Vector4:Je,VectorKeyframeTrack:Yd,VertexColorNode:see,VideoTexture:L8,ViewportDepthNode:Ta,ViewportDepthTextureNode:u$,ViewportSharedTextureNode:hee,ViewportTextureNode:W1,VolumeNodeMaterial:oye,WebGL3DRenderTarget:Kce,WebGLArrayRenderTarget:Qce,WebGLCoordinateSystem:Gc,WebGLCubeRenderTarget:tB,WebGLMultipleRenderTargets:Cge,WebGLRenderTarget:ci,WebGLRenderer:Mm,WebGLUtils:M8,WebGPUCoordinateSystem:W0,WireframeGeometry:eX,WrapAroundEnding:Gw,ZeroCurvatureEnding:r0,ZeroFactor:Mj,ZeroSlopeEnding:o0,ZeroStencilOp:Zj,abs:xn,acesFilmicToneMapping:Kee,acos:PL,add:Yn,addMethodChaining:Be,addNodeElement:e0e,afterImage:Abe,agxToneMapping:Yee,all:zX,alphaT:EL,anaglyphPass:$be,anamorphic:Cbe,and:D6,anisotropy:Mf,anisotropyB:C0,anisotropyT:zC,any:Y6,ao:Pbe,append:g6,arrayBuffer:Oge,asin:t7,assign:E6,atan:i7,atan2:d7,atomicAdd:jxe,atomicAnd:tve,atomicFunc:Pp,atomicMax:$xe,atomicMin:eve,atomicOr:ive,atomicStore:Jxe,atomicSub:qxe,atomicXor:nve,attenuationColor:NX,attenuationDistance:kX,attribute:Dr,backgroundBlurriness:rbe,backgroundIntensity:obe,batch:qq,billboarding:_xe,bitAnd:U6,bitNot:X6,bitOr:O6,bitXor:Z6,bitangentGeometry:x0e,bitangentLocal:v0e,bitangentView:pq,bitangentWorld:_0e,bitcast:Yge,bleach:Lxe,bloom:Xbe,blur:R$,bool:pm,buffer:V1,bufferAttribute:D1,bumpMap:bq,burn:Mxe,bvec2:b6,bvec3:TX,bvec4:C6,bypass:X7,cache:XC,call:L6,cameraFar:ib,cameraLogDepth:q7,cameraNear:tb,cameraNormalMatrix:s0e,cameraPosition:i3,cameraProjectionMatrix:tl,cameraProjectionMatrixInverse:i0e,cameraViewMatrix:hl,cameraWorldMatrix:n0e,cbrt:y7,ceil:OX,checker:sve,cineonToneMapping:Qee,clamp:qs,clearcoat:TL,clearcoatRoughness:jw,code:XB,color:A6,colorSpaceToWorking:$X,colorToDirection:eAe,compute:V7,cond:C7,context:JX,convert:S6,convertToTexture:Pa,cos:Pl,createCanvasElement:u8,cross:Qb,cubeTexture:GB,dFdx:r7,dFdy:o7,dashSize:w0,defaultBuildStages:$F,defaultShaderStages:c6,defined:Kw,degrees:q6,denoise:Nbe,densityFog:oxe,depth:f3,depthPass:mbe,difference:f7,diffuseColor:rn,directionToColor:m$,dispersion:DX,distance:p7,div:Ph,dodge:Ixe,dof:Sbe,dot:ls,dotScreen:Mbe,drawIndex:Kq,dynamicBufferAttribute:D7,element:w6,emissive:iV,equal:B6,equals:J6,equirectUV:m3,exp:UX,exp2:BL,expression:fm,faceDirection:F1,faceForward:x7,film:Tbe,float:U,floor:Lm,fog:sxe,fract:Bm,frameGroup:Wge,frameId:Zye,frontFacing:iq,fwidth:c7,fxaa:Dbe,gain:gxe,gapSize:$w,gaussianBlur:gbe,getColorSpaceMethod:GL,getConstNodeType:m6,getCurrentStack:IX,getDirection:T$,getDistanceAttenuation:L3,getGeometryRoughness:x$,getRoughness:A3,getShIrradianceAt:ate,getTextureIndex:T3,global:xR,glsl:uye,glslFn:pye,grayscale:ybe,greaterThan:VX,greaterThanEqual:N6,hash:mxe,highPrecisionModelNormalViewMatrix:m0e,highPrecisionModelViewMatrix:f0e,hue:vbe,instance:Jq,instanceIndex:Z1,instancedBufferAttribute:kL,instancedDynamicBufferAttribute:nV,int:K,inverseSqrt:$6,invocationLocalIndex:R0e,invocationSubgroupIndex:E0e,ior:UC,iridescence:RB,iridescenceIOR:LX,iridescenceThickness:BX,ivec2:pd,ivec3:x6,ivec4:v6,js:hye,label:w7,length:S0,lengthSq:HX,lessThan:G6,lessThanEqual:k6,lightPosition:P3,lightTargetDirection:G3,lightTargetPosition:zee,lightViewPosition:WB,lightingContext:a$,lights:s$,linearDepth:VL,linearSRGBTosRGB:Zee,linearToneMapping:Wee,localId:zxe,log:XX,log2:B1,loop:P0e,luminance:go,lut3D:Ebe,mat2:L1,mat3:Qr,mat4:_0,matcapUV:D$,materialAOMap:Wq,materialAlphaTest:xq,materialAnisotropy:Gq,materialAnisotropyVector:nb,materialAttenuationColor:Xq,materialAttenuationDistance:Uq,materialClearcoat:Tq,materialClearcoatNormal:Rq,materialClearcoatRoughness:Eq,materialColor:Ax,materialDispersion:Zq,materialEmissive:_q,materialIOR:zq,materialIridescence:kq,materialIridescenceIOR:Nq,materialIridescenceThickness:Dq,materialLightMap:h3,materialLineDashOffset:aV,materialLineDashSize:l3,materialLineGapSize:c3,materialLineScale:FL,materialLineWidth:gR,materialMetalness:Mq,materialNormal:Iq,materialOpacity:DB,materialPointWidth:Oq,materialReference:xh,materialReflectivity:mR,materialRefractionRatio:rq,materialRotation:Lq,materialRoughness:Sq,materialSheen:Bq,materialSheenRoughness:Pq,materialShininess:vq,materialSpecular:Cq,materialSpecularColor:wq,materialSpecularIntensity:oV,materialSpecularStrength:OC,materialThickness:Vq,materialTransmission:Fq,max:Ri,maxMipLevel:j7,metalness:Jw,min:Vr,mix:li,mixElement:v7,mod:LB,modInt:FX,modelDirection:h0e,modelNormalMatrix:$7,modelPosition:d0e,modelScale:u0e,modelViewMatrix:jd,modelViewPosition:p0e,modelViewProjection:lV,modelWorldMatrix:kc,modelWorldMatrixInverse:eq,morphReference:i$,motionBlur:Rxe,mrt:OB,mul:pi,mx_aastep:ste,mx_cell_noise_float:u_e,mx_contrast:r_e,mx_fractal_noise_float:p_e,mx_fractal_noise_vec2:f_e,mx_fractal_noise_vec3:m_e,mx_fractal_noise_vec4:g_e,mx_hsvtorgb:Jve,mx_noise_float:o_e,mx_noise_vec3:a_e,mx_noise_vec4:l_e,mx_ramplr:$ve,mx_ramptb:e_e,mx_rgbtohsv:jve,mx_safepower:s_e,mx_splitlr:t_e,mx_splittb:i_e,mx_srgb_texture_to_lin_rec709:qve,mx_transform_uv:n_e,mx_worley_noise_float:c_e,mx_worley_noise_vec2:h_e,mx_worley_noise_vec3:d_e,negate:n7,neutralToneMapping:Jee,nodeArray:v0,nodeImmutable:tt,nodeObject:me,nodeObjects:R1,nodeProxy:we,normalFlat:nq,normalGeometry:BB,normalLocal:ll,normalMap:rV,normalView:ql,normalWorld:PB,normalize:Bl,not:V6,notEqual:P6,numWorkgroups:Fxe,objectDirection:r0e,objectGroup:I6,objectPosition:a0e,objectScale:l0e,objectViewPosition:c0e,objectWorldMatrix:o0e,oneMinus:s7,or:F6,orthographicDepthToViewZ:X0e,oscSawtooth:Kye,oscSine:Wye,oscSquare:Hye,oscTriangle:Qye,output:PX,outputStruct:zye,overlay:Exe,overloadingFn:Bo,parabola:mV,parallaxBarrierPass:exe,parallaxDirection:mq,parallaxUV:w0e,parameter:cye,pass:fbe,passTexture:qx,pcurve:Axe,perspectiveDepthToViewZ:p3,pixelationPass:Hbe,pmremTexture:B$,pointUV:sbe,pointWidth:Hge,positionGeometry:uo,positionLocal:Ts,positionPrevious:NL,positionView:_o,positionViewDirection:Gn,positionWorld:DL,positionWorldDirection:n3,posterize:dbe,pow:Ia,pow2:WX,pow3:m7,pow4:g7,property:el,radians:j6,rand:KX,range:axe,rangeFog:rxe,reciprocal:l7,reference:Ar,referenceBuffer:sV,reflect:u7,reflectVector:lq,reflectView:oq,reflector:$ye,refract:QX,refractVector:cq,refractView:aq,reinhardToneMapping:Hee,remainder:Q6,remap:O7,remapClamp:Z7,renderGroup:Ui,renderOutput:K7,rendererReference:B7,rgbShift:Ibe,rotate:b3,rotateUV:xxe,roughness:vd,round:a7,rtt:nee,sRGBToLinearSRGB:Oee,sampler:t0e,saturate:b7,saturation:bbe,screen:Txe,screenCoordinate:jx,screenSize:yx,screenUV:Pm,scriptable:nxe,scriptableValue:bR,select:vo,sepia:Bxe,setCurrentStack:Yw,shaderStages:eV,sharedUniformGroup:RX,sheen:c0,sheenRoughness:EB,shiftLeft:W6,shiftRight:H6,shininess:RL,sign:P1,sin:yo,sinc:yxe,skinning:L0e,skinningReference:$q,smoothstep:Ga,smoothstepElement:_7,sobel:wbe,specularColor:ja,specularF90:qw,spherizeUV:vxe,split:Zge,spritesheetUV:Yye,sqrt:Xh,ssaaPass:Ybe,stack:yR,step:G1,stereoPass:jbe,storage:abe,storageBarrier:Zxe,storageObject:lbe,storageTexture:aee,string:Xge,sub:In,subgroupIndex:T0e,subgroupSize:Uxe,tan:e7,tangentGeometry:NB,tangentLocal:U1,tangentView:X1,tangentWorld:uq,temp:jX,texture:Gi,texture3D:z$,textureBarrier:Wxe,textureBicubic:I$,textureCubeUV:E$,textureLoad:vc,textureSize:Zf,textureStore:cbe,thickness:GX,threshold:fee,timerDelta:Oye,timerGlobal:Xye,timerLocal:E3,toOutputColorSpace:I7,toWorkingColorSpace:T7,toneMapping:G7,toneMappingExposure:k7,toonOutlinePass:txe,transformDirection:A7,transformNormal:sq,transformNormalToView:r3,transformedBentNormalView:gq,transformedBitangentView:fq,transformedBitangentWorld:C0e,transformedClearcoatNormalView:wb,transformedNormalView:cs,transformedNormalWorld:s3,transformedTangentView:a3,transformedTangentWorld:b0e,transition:Obe,transmission:LL,transpose:h7,tri:fd,tri3:Uee,triNoise3D:bxe,triplanarTexture:jye,triplanarTextures:eee,trunc:ZX,tslFn:Uge,uint:pt,uniform:$e,uniformArray:zd,uniformGroup:M6,uniforms:A0e,userData:hbe,uv:hi,uvec2:y6,uvec3:Jx,uvec4:_6,varying:Eo,varyingProperty:bh,vec2:le,vec3:J,vec4:Xe,vectorComponents:Yx,velocity:Sxe,vertexColor:nbe,vertexIndex:Qq,vibrance:xbe,viewZToOrthographicDepth:ZC,viewZToPerspectiveDepth:p$,viewport:gp,viewportBottomLeft:z0e,viewportCoordinate:h$,viewportDepthTexture:u3,viewportLinearDepth:O0e,viewportMipTexture:d$,viewportResolution:F0e,viewportSafeUV:Cxe,viewportSharedTexture:ube,viewportSize:c$,viewportTexture:U0e,viewportTopLeft:V0e,viewportUV:D0e,wgsl:dye,wgslFn:fye,workgroupArray:Kxe,workgroupBarrier:Oxe,workgroupId:Vxe,workingToColorSpace:E7,xor:z6},Symbol.toStringTag,{value:"Module"}));let Ate,T9=null;function kh(){return Ate}function V3(s){if(s==null){console.warn("Oh no: someone tried registering a non-existend gltf-loader. When you see this log it might mean that needle-engine is being imported multiple times. Please check your project setup.");return}T9!==s&&(T9=s,Ate=new s)}const Mk=new Map;function ka(s=(e=>(e=globalThis.location)==null?void 0:e.hostname)()){if(Mk.has(s))return Mk.get(s);const t=/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|localhost/.test(s);return Mk.set(s,t),t===!0}function yte(){return window.location.hostname.includes("glitch.me")}var ji=(s=>(s.ContextRegistered="ContextRegistered",s.ContextCreationStart="ContextCreationStart",s.ContextCreated="ContextCreated",s.ContextFirstFrameRendered="ContextFirstFrameRendered",s.ContextDestroying="ContextDestroying",s.ContextDestroyed="ContextDestroyed",s.MissingCamera="MissingCamera",s.ContextClearing="ContextClearing",s.ContextCleared="ContextCleared",s))(ji||{});class Oi{static get Current(){return globalThis["NeedleEngine.Context.Current"]}static set Current(e){globalThis["NeedleEngine.Context.Current"]=e}static get All(){return this.Registered}static register(e){this.Registered.push(e),this.dispatchCallback("ContextRegistered",e)}static unregister(e){const t=this.Registered.indexOf(e);t!==-1&&this.Registered.splice(t,1)}static registerCallback(e,t){this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t)}static unregisterCallback(e,t){if(!this._callbacks[e])return;const i=this._callbacks[e].indexOf(t);i!==-1&&this._callbacks[e].splice(i,1)}static dispatchCallback(e,t,i){if(!this._callbacks[e])return!0;const n={event:e,context:t};if(i)for(const o in i)n[o]=i[o];const r=new Array;return this._callbacks[e].forEach(o=>{const a=o(n);a instanceof Promise&&r.push(a)}),Promise.all(r)}static addContextCreatedCallback(e){this.registerCallback("ContextCreated",e)}static addContextDestroyedCallback(e){this.registerCallback("ContextDestroyed",e)}}p(Oi,"Registered",[]),p(Oi,"_callbacks",{});const bte=()=>s=>s;function M_e(s){return bte()(s)}function I_e(){return!!ee("debug")}class $l{constructor(e,t){p(this,"_factory");p(this,"_cache",[]);p(this,"_maxSize");p(this,"_index",0);this._factory=e,this._maxSize=t}get(){const e=this._index%this._maxSize;return this._index++,this._cache.length<=e&&(this._cache[e]=this._factory()),this._cache[e]}}let jg=!1;const gV=new Array;typeof window<"u"&&setTimeout(()=>{if(jg){const s={},e=new URL(window.location.href),t=new URL(e);t.searchParams.append("console","");const i=t.toString().replace(/=$|=(?=&)/g,"");for(const r of gV){const o=new URL(e);o.searchParams.append(r,""),s[r]=o.toString().replace(/=$|=(?=&)/g,"")}console.log(`🌵 ?help: Debug Options for Needle Engine.
Append any of these parameters to the URL to enable specific debug options.
Example: ${i} will show an onscreen console window.`);const n=jg===!0?"":` (containing "${jg}")`;console.group("Available URL parameters:"+n);for(const r of Object.keys(s).sort())typeof jg=="string"&&!r.toLowerCase().includes(jg.toLowerCase())||(console.groupCollapsed(r),console.log("Reload with this flag enabled:"),console.log(s[r]),console.groupEnd());console.groupEnd()}},100);function K1(){var s;return new URLSearchParams((s=globalThis.location)==null?void 0:s.search)}function ee(s){jg&&!gV.includes(s)&&gV.push(s);const e=K1();if(e.has(s)){const t=e.get(s);if(t){const i=Number(t);return isNaN(i)?t:i}else return!0}return!1}jg=ee("help");function T_e(s,e){const t=K1();t.has(s)?t.set(s,e):t.append(s,e),document.location.search=t.toString()}function eS(s,e,t=!0){const i=K1();i.has(s)?e===null?i.delete(s):i.set(s,e):e!==null&&i.append(s,e),t?xte(s,i):z3(s,i)}function AV(s,e,t){s.has(e)?s.set(e,t.toString()):s.append(e,t.toString())}function xte(s,e,t){window.history.pushState(t,s,"?"+e.toString())}function z3(s,e,t){window.history.replaceState(t,s,"?"+e.toString())}function E_e(s){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=t.length,n=0;n<s;n++)e+=t.charAt(Math.floor(Math.random()*i));return e}function R_e(s,e){return Math.floor(Math.random()*(e-s+1))+s}const E9=["smol","tiny","giant","interesting","smart","bright","dull","extreme","beautiful","pretty","dark","epic","salty","silly","funny","lame","lazy","loud","lucky","mad","mean","mighty","mysterious","nasty","odd","old","powerful","quiet","rapid","scary","shiny","shy","silly","smooth","sour","spicy","stupid","sweet","tasty","terrible","ugly","unusual","vast","wet","wild","witty","wrong","zany","zealous","zippy","zombie","zorro"],R9=["cat","dog","mouse","pig","cow","horse","sheep","chicken","duck","goat","panda","tiger","lion","elephant","monkey","bird","fish","snake","frog","turtle","hamster","penguin","kangaroo","whale","dolphin","crocodile","snail","ant","bee","beetle","butterfly","dragon","eagle","fish","giraffe","lizard","panda","penguin","rabbit","snake","spider","tiger","zebra"];function vte(){const s=E9[Math.floor(Math.random()*E9.length)],e=R9[Math.floor(Math.random()*R9.length)];return s+"_"+e}function _te(s){return s=s.replace(/[^a-z0-9áéíóúñü \.,_-]/gim,""),s.trim()}function xx(s,e,t=!0,i=!1){var n;if(e==null)return null;if(e.userData&&e.userData.guid===s)return e;if(e.guid==s)return e;if(i&&(n=e.userData)!=null&&n.components){for(const r of e.userData.components)if(r.guid===s)return r}if(t){if(e.scenes)for(const r in e.scenes){const o=e.scenes[r],a=xx(s,o,t,i);if(a)return a}if(e.children)for(const r in e.children){const o=e.children[r],a=xx(s,o,t,i);if(a)return a}}}function Y1(s,e){if(s!=null&&typeof s=="object"){let t;Array.isArray(s)?t=[]:(t=Object.create(s),Object.assign(t,s));for(const i of Object.keys(s)){const n=s[i];e&&!e(s,i,n)?t[i]=n:(n==null?void 0:n.clone)!==void 0&&typeof n.clone=="function"?t[i]=n.clone():t[i]=Y1(n,e)}return t}return s}function Nh(s){return new Promise((e,t)=>{setTimeout(e,s)})}function QB(s,e){if(s<=0)return Promise.resolve();if(e||(e=Oi.Current),!e)return Promise.reject("No context");const t=e.time.frameCount+s;return new Promise((i,n)=>{if(!e)return n("No context");const r=()=>{e.time.frameCount>=t&&(e.pre_update_callbacks.splice(e.pre_update_callbacks.indexOf(r),1),i())};e.pre_update_callbacks.push(r)})}const cT=ee("debugresolveurl"),Cte="rel:";function L_e(s,e){return km(s,e)}function km(s,e){if(e===void 0)return cT&&console.warn("getPath: uri is undefined, returning uri",e),e;if(e.startsWith("./"))return e;if(e.startsWith("http"))return cT&&console.warn("getPath: uri is absolute, returning uri",e),e;if(s===void 0)return cT&&console.warn("getPath: source is undefined, returning uri",e),e;e.startsWith(Cte)&&(e=e.substring(4));const t=s.lastIndexOf("/");if(t>=0){const i=s.substring(0,t+1);for(;i.endsWith("/")&&e.startsWith("/");)e=e.substring(1);const n=i+e;return cT&&console.log("source:",s,`changed uri 
from`,e,`
to `,n,`
basePath: `+i),n}return e}class B_e{constructor(e,t){p(this,"writeCallbacks",[]);p(this,"_applied",!1);p(this,"_object");p(this,"_prop");p(this,"_wrapperProp");this._object=e,this._prop=t,this._wrapperProp=Symbol("$"+t),this.apply()}subscribeWrite(e){this.writeCallbacks.push(e)}unsubscribeWrite(e){const t=this.writeCallbacks.indexOf(e);t!==-1&&this.writeCallbacks.splice(t,1)}apply(){if(this._applied||!this._object)return;const e=this._object,t=this._prop;if(e[t]===void 0)return;this._applied=!0,e[this._wrapperProp]!==void 0&&console.warn("Watcher is being applied to an object that already has a wrapper property. This is not (yet) supported");const i=e[t];e[this._wrapperProp]=i,Object.defineProperty(e,t,{get:()=>e[this._wrapperProp],set:o=>{e[this._wrapperProp]=o;for(const a of this.writeCallbacks)a(o,this._prop)}})}revoke(){if(!this._applied||!this._object)return;this._applied=!1;const e=this._object,t=this._prop;Reflect.deleteProperty(e,t);const i=e[this._wrapperProp];e[t]=i,Reflect.deleteProperty(e,this._wrapperProp)}dispose(){this.revoke(),this.writeCallbacks.length=0,this._object=null}}class Ap{constructor(e,t){p(this,"_watches",[]);if(Array.isArray(t))for(const i of t)this._watches.push(new Ap(e,i));else this._watches.push(new B_e(e,t))}subscribeWrite(e){for(const t of this._watches)t.subscribeWrite(e)}unsubscribeWrite(e){for(const t of this._watches)t.unsubscribeWrite(e)}apply(){for(const e of this._watches)e.apply()}revoke(){for(const e of this._watches)e.revoke()}dispose(){for(const e of this._watches)e.dispose();this._watches.length=0}}const sb=Symbol("needle:watches");function KB(s,e){if(!s[sb])if(s instanceof Q)s[sb]=new Ap(s,["x","y"]);else if(s instanceof T)s[sb]=new Ap(s,["x","y","z"]);else if(s instanceof Je||s instanceof Ve)s[sb]=new Ap(s,["x","y","z","w"]);else return!1;return s[sb].subscribeWrite(e),!0}function U3(s,e){if(!s)return;const t=s[sb];t&&t.unsubscribeWrite(e)}exports.DeviceUtilities=void 0;(s=>{let e;function t(){if(e!==void 0)return e;const B=window.navigator.userAgent,P=/Windows|MacOS|Mac OS/.test(B),k=/Windows NT/.test(B)&&/Edg/.test(B)&&!/Win64/.test(B);return e=P&&!k&&!A()}s.isDesktop=t;let i;function n(){return i!==void 0?i:typeof window.orientation<"u"||navigator.userAgent.indexOf("IEMobile")!==-1?i=!0:i=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent)}s.isMobileDevice=n;function r(){return a()}s.isIPad=r;let o;function a(){return o!==void 0?o:o=/iPad/.test(navigator.userAgent)}s.isiPad=a;let l;function c(){return l!==void 0?l:l=/Android/.test(navigator.userAgent)}s.isAndroidDevice=c;let h;function d(){return h!==void 0?h:h=/WebXRViewer\//i.test(navigator.userAgent)}s.isMozillaXR=d;let u;function f(){if(u!==void 0)return u;if(navigator.userAgentData)return u=navigator.userAgentData.platform==="macOS";{const B=navigator.userAgent.toLowerCase();return u=B.includes("mac os x")||B.includes("macintosh")}}s.isMacOS=f;let m;const g=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];function A(){return m!==void 0?m:m=g.includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}s.isiOS=A;let y;function b(){return y!==void 0||(y=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),y}s.isSafari=b;let x;function v(){return x!==void 0?x:x=navigator.userAgent.includes("OculusBrowser")}s.isQuest=v;let _;function C(){return _!==void 0||(_=document.createElement("a").relList.supports("ar")),_}s.supportsQuickLookAR=C;async function S(){try{return(await navigator.permissions.query({name:"microphone"})).state!=="denied"}catch(B){return console.error("Error querying `microphone` permissions.",B),!1}}s.microphonePermissionsGranted=S;let M;function L(){if(M!==void 0)return M;const B=navigator.userAgent.match(/iPhone OS (\d+_\d+)/);if(B&&(M=B[1].replace("_",".")),!M){const P=navigator.userAgent.match(/(?:\(Macintosh;|iPhone;|iPad;).*Version\/(\d+\.\d+)/);P&&(M=P[1])}return M||(M=null),M}s.getiOSVersion=L;let w;function E(){if(w!==void 0)return w;const B=navigator.userAgent.match(/(?:CriOS|Chrome)\/(\d+\.\d+\.\d+\.\d+)/);return B?w=B[1].replace("_","."):w=null,w}s.getChromeVersion=E})(exports.DeviceUtilities||(exports.DeviceUtilities={}));function P_e(){return exports.DeviceUtilities.isDesktop()}function G_e(){return exports.DeviceUtilities.isMobileDevice()}function k_e(){return exports.DeviceUtilities.isiPad()}function N_e(){return exports.DeviceUtilities.isiPad()}function D_e(){return exports.DeviceUtilities.isAndroidDevice()}function F_e(){return exports.DeviceUtilities.isMozillaXR()}function V_e(){return exports.DeviceUtilities.isMacOS()}function z_e(){return exports.DeviceUtilities.isiOS()}function U_e(){return exports.DeviceUtilities.isSafari()}function X_e(){return exports.DeviceUtilities.isQuest()}async function O_e(){return exports.DeviceUtilities.microphonePermissionsGranted()}const Z_e=/ip=(?<ip>.+?)\n/s;async function W_e(){const e=await(await fetch("https://www.cloudflare.com/cdn-cgi/trace")).text(),t=Z_e.exec(e);return t?t[1]:null}async function H_e(){const s=await fetch("https://api.db-ip.com/v2/free/self").catch(()=>null);return s?(await s.json()).ipAddress:void 0}async function Q_e(){const s=await fetch("https://api.db-ip.com/v2/free/self").catch(()=>null);return s?await s.json():void 0}const Pf=new WeakMap;function wte(s,e,t){if(!Pf.get(s)){const n=new MutationObserver(r=>{K_e(s,r)});Pf.set(s,{observer:n,attributeChangedListeners:new Map}),n.observe(s,{attributes:!0})}const i=Pf.get(s).attributeChangedListeners;i.has(e)||i.set(e,[]),i.get(e).push(t)}function Ste(s,e,t){if(!Pf.get(s))return;const i=Pf.get(s).attributeChangedListeners;if(!i.has(e))return;const n=i.get(e),r=n.indexOf(t);if(r!==-1&&(n.splice(r,1),n.length<=0)){i.delete(e);const o=Pf.get(s);o==null||o.observer.disconnect(),Pf.delete(s)}}function K_e(s,e){const t=Pf.get(s).attributeChangedListeners;for(const i of e)if(i.type==="attributes"){const n=i.attributeName,r=s.getAttribute(n);if(t.has(n))for(const o of t.get(n))o(r)}}class yV{constructor(e){p(this,"reason");this.reason=e}}async function YB(s){const e=await Promise.allSettled(s).catch(n=>[new yV(n.message)]);let t=!1;const i=e.map(n=>"value"in n?n.value:(t=!0,new yV(n.reason)));return{anyFailed:t,results:i}}async function Mte(s){if(!globalThis.QRCode){const i="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js";let n=document.head.querySelector(`script[src="${i}"]`);n||(n=document.createElement("script"),n.src=i,document.head.appendChild(n)),await new Promise((r,o)=>{n.addEventListener("load",()=>{r(!0)})})}const e=globalThis.QRCode,t=s.domElement??document.createElement("div");return new e(t,{width:s.width??256,height:s.height??256,colorDark:"#000000",colorLight:"#ffffff",correctLevel:e.CorrectLevel.M,...s}),t}const Ite=ee("debugdebug");let tS=!1;(ee("noerrors")||ee("nooverlaymessages"))&&(tS=!0);const Ik="needle_engine_global_error_container";var zl=(s=>(s[s.Log=0]="Log",s[s.Warn=1]="Warn",s[s.Error=2]="Error",s))(zl||{});function X3(){return Lte}const bV=new Array;function Y_e(s){bV.push(s)}let Tk=!1;function J_e(...s){if(!Tk){Tk=!0;try{for(let e=0;e<bV.length;e++)bV[e](...s)}catch(e){console.error(e)}Tk=!1}}const Tte=console.error,Ete=function(...s){Tte.apply(console,s),$_e(s),Ed(2,s),xV(...s)};function Rte(s){tS=!s,s?console.error=Ete:console.error=Tte}function j_e(s){return Rte(s)}function q_e(){tS||(Ite&&console.warn("Patch console",window.location.hostname),console.error=Ete,window.addEventListener("error",s=>{if(!s)return;const e=s.error;if(e===void 0){ka()&&console.warn("Received unknown error",s,s.target);return}Ed(2,e,s.filename,s.lineno),xV(s)},!0),window.addEventListener("unhandledrejection",s=>{tS||s&&(s.reason?Ed(2,s.reason.message,s.reason.stack):Ed(2,"unhandled rejection"),xV(s))}))}let Lte=0;function xV(...s){Lte+=1,J_e(...s)}function $_e(s){if(Array.isArray(s))for(let e=0;e<s.length;e++){const t=s[e];typeof t=="string"&&t.startsWith("THREE.PropertyBinding: Trying to update node for track:")&&(s[e]="Some animated objects couldn't be found: see console for details")}}function Ed(s,e,t,i){if(tS)return;const n=Oi.Current,r=(n==null?void 0:n.domElement)??document.querySelector("needle-engine");if(r){if(Array.isArray(e)){let o="";for(let a=0;a<e.length;a++){let l=e[a];l instanceof Error&&(l=l.message),typeof l!="object"&&(a>0&&(o+=" "),o+=l)}e=o}!e||e.length<=0||eCe(s,r,e)}}const QC=new Map;function eCe(s,e,t){if(t==null)return;const i=iCe(e);if(i.childElementCount>=20){const a=i.lastElementChild;L9(a)}t.length>400&&(t=t.substring(0,400)+"...");const n=t;if(QC.has(n))return;const r=nCe(s,t);i.prepend(r);const o=()=>{QC.delete(n),L9(r)};QC.set(n,o),setTimeout(o,1e4)}function Bte(){Ite&&console.log("Clearing messages");for(const s of QC.values())s==null||s.call(s);QC.clear()}const tCe=`

@import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

div[data-needle_engine_debug_overlay] {
    font-family: 'Roboto Flex', sans-serif;
    font-weight: 400;
    font-size: 16px;
}

div[data-needle_engine_debug_overlay] strong {
    font-weight: 700;
}

div[data-needle_engine_debug_overlay] a {
    color: white;
    text-decoration: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
}

div[data-needle_engine_debug_overlay] a:hover {
    text-decoration: none;
    border: none;
}

div[data-needle_engine_debug_overlay] .log strong {
    color: rgba(200,200,200,.9);
}

div[data-needle_engine_debug_overlay] .warn strong {
    color: rgba(255,255,230, 1);
}

div[data-needle_engine_debug_overlay] .error strong {
    color: rgba(255,100,120, 1);
}
`;function iCe(s){globalThis[Ik]||(globalThis[Ik]=new Map);const e=globalThis[Ik];if(e.has(s))return e.get(s);{const t=document.createElement("div");e.set(s,t),t.setAttribute("data-needle_engine_debug_overlay",""),t.classList.add("debug-container"),t.style.cssText=`
            position: absolute;
            top: 0;
            right: 5px;
            padding-top: 0px;
            max-width: 70%;
            max-height: calc(100% - 5px);
            z-index: 9999999999;
            pointer-events: scroll;
            display: flex;
            align-items: end;
            flex-direction: column;
            color: white;
            overflow: auto;
            word-break: break-word;
        `,s.shadowRoot?s.shadowRoot.appendChild(t):s.appendChild(t);const i=document.createElement("style");return i.innerHTML=tCe,t.appendChild(i),t}}const Pte=Symbol("logtype"),OL=new Map;function L9(s){s.remove();const e=s[Pte],t=OL.get(e)??[];t.push(s),OL.set(e,t)}function nCe(s,e){if(OL.has(s)){const i=OL.get(s);if(i.length>0){const n=i.pop();return n.innerHTML=e,n}}const t=document.createElement("div");switch(t.setAttribute("data-id","__needle_engine_debug_overlay"),t.style.marginRight="5px",t.style.padding=".5em",t.style.backgroundColor="rgba(0,0,0,.9)",t.style.marginTop="5px",t.style.marginBottom="3px",t.style.borderRadius="8px",t.style.pointerEvents="all",t.style.userSelect="text",t.style.maxWidth="250px",t.style.whiteSpace="pre-wrap",t.style["backdrop-filter"]="blur(10px)",t.style["-webkit-backdrop-filter"]="blur(10px)",t.style.backgroundColor="rgba(20,20,20,.8)",t.style.boxShadow="inset 0 0 80px rgba(0,0,0,.2), 0 0 5px rgba(0,0,0,.2)",t.style.border="1px solid rgba(160,160,160,.2)",t[Pte]=s,s){case 0:t.classList.add("log"),t.style.color="rgba(200,200,200,.7)",t.style.backgroundColor="rgba(40,40,40,.7)";break;case 1:t.classList.add("warn"),t.style.color="rgb(255, 255, 150)",t.style.backgroundColor="rgba(50,50,20,.8)";break;case 2:t.classList.add("error"),t.style.color="rgb(255, 50, 50",t.style.backgroundColor="rgba(50,20,20,.8)";break}return t.title="Open the browser console (F12) for more information",t.innerHTML=e,t}var Th={};Th.d=(s,e)=>{for(var t in e)Th.o(e,t)&&!Th.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:e[t]})};Th.o=(s,e)=>Object.prototype.hasOwnProperty.call(s,e);Th.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})};var ar={};Th.d(ar,{ti:()=>dn,nS:()=>yie,eB:()=>sS,Yp:()=>O3,VB:()=>j0,BC:()=>J1,zN:()=>AA,cV:()=>_x,hW:()=>oS,k2:()=>Dte,K6:()=>Tc,M7:()=>Z3,ls:()=>j1,Hi:()=>eie,EY:()=>rS,MR:()=>Hte,zf:()=>Nte,Ay:()=>y1e,yo:()=>bie});var O3={};Th.r(O3);Th.d(O3,{get:()=>Gte,set:()=>sCe});var Z3={};Th.r(Z3);Th.d(Z3,{alphaTestTransformer:()=>jB,asPreprocessorValueTransformer:()=>Qte,toPreprocessorTriggerTransformer:()=>tO,toUserDataTransformer:()=>mwe,uniformOrUserDataTransformer:()=>_c});const vV={fontFamily:null,fontSize:.05,fontKerning:"auto",fontStyle:"normal",fontWeight:"normal",offset:.005,lineHeight:1.2,lineBreak:`- ,.:?!
`,whiteSpace:"pre-line",flexDirection:"column",justifyContent:"start",alignItems:"start",backgroundImage:null,textAlign:"left",boxSizing:"content-box",position:"static",color:16777215,fontColor:16777215,fontOpacity:1,opacity:1,fontPXRange:4,fontSupersampling:!0,fontSmooth:"antialiased",borderRadius:0,borderWidth:0,borderColor:"black",borderOpacity:1,backgroundSize:"cover",backgroundColor:0,backgroundOpacity:0,overflow:"visible",letterSpacing:0,invertAlpha:!1,segments:1},sCe=function(s){for(const e in s)vV[e]=s[e]},Gte=function(s){return Object.prototype.hasOwnProperty.call(vV,s)||console.warn(`ThreeMeshUI::DefaultValues is trying to retrieve non-existing property '${s}'`),vV[s]};class dn{constructor(e,t=null,i=!0){this._id=e,this._value=t,this._needsUpdate=!0,this._needsProcess=!1,this._needsRender=!1,this._isPrimitive=i}get id(){return this._id}get value(){return this._value}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}update(e,t){this.output(t)}output(e){}_outputValue(e){e[this._id]=this._value}process(e){}render(e){}getInheritedInput(e){if(this._value!=="inherit")return this._value;const t=e._parent._value;return t&&t[`_${this._id}`]?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}getDefaultValue(){return Gte(this._id)}isValid(e){return!0}emptyStrategyLogic(){throw new Error(`ThreeMeshUI::${this.constructor.name} has empty strategy. Update has not been processed.`)}requestUpdate(){this._needsUpdate=!0}requestProcess(){this._needsProcess=!1}requestRender(){this._needsRender=!1}}class rCe extends dn{constructor(){super("renderOrder","auto",!0),this.output=this._outputValue,this._actualValue=0}set value(e){this.isValid(e)&&(this._value=e,this._needsUpdate=!0)}update(e,t){if(this._value!=="auto")this._actualValue=this._value;else{const i=e._parent._value;if(i!==null){const n=i._renderOrder._actualValue,r=1+i._children._uis.indexOf(e);this._actualValue=n+r}}for(const i of e._children._uis)i._renderOrder._value==="auto"&&(i._renderOrder._needsUpdate=!0);this._outputValue(t)}_outputValue(e){e[this._id]=this._actualValue}get value(){return this._value}}class AA extends dn{constructor(e,t=null,i=!0){super(e,t,i),this.output=this._outputValue,this._notInheritedValue=null}update(e,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(e)),this.propagate(e),this._outputValue(t)}propagate(e){for(const t of e._children._uis){const i=t[`_${this._id}`];i!==void 0&&i._value==="inherit"&&(t[`_${this._id}`]._needsUpdate=!0)}}_outputValue(e){e[this._id]=this._notInheritedValue}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class oCe extends AA{constructor(){super("offset","inherit",!1)}update(e,t){super.update(e,t),e._parent._value!==null&&(e.position.z=this._notInheritedValue)}}class aCe extends AA{constructor(){super("fontSmooth","inherit",!0),this._needsUpdate=!1,this.isValid=cCe,this.output=this._outputValue}}const lCe=["inherit","none","antialiased"];function cCe(s){return lCe.indexOf(s)===-1?(console.warn(`.fontSmoothing value '${s}' is not valid. Aborted`),!1):!0}var hCe=s=>{var e={};return Th.d(e,s),e};const it=hCe({BackSide:()=>vn,BufferAttribute:()=>dt,BufferGeometry:()=>It,Color:()=>ge,DoubleSide:()=>Zi,EventDispatcher:()=>Mr,FileLoader:()=>Is,FrontSide:()=>us,LinearFilter:()=>Ot,Mesh:()=>fe,MeshBasicMaterial:()=>ii,Object3D:()=>ye,Plane:()=>js,PlaneGeometry:()=>Rs,ShaderMaterial:()=>Ht,Texture:()=>si,TextureLoader:()=>Mh,Vector2:()=>Q,Vector3:()=>T,Vector4:()=>Je});class ss extends dn{constructor(e,t,i=!0){super(e,"unset",i),this._input="inherit",this._allowsInherit=!0,this._inheritedInput=void 0,this._inline=void 0}update(e,t){this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const i of e._children._uis){const n=i[`_${this._id}`];(n._input?n._input:n._value)==="inherit"&&(i[`_${this._id}`]._needsUpdate=!0)}this.output(t)}computeOutputValue(e){this._value=this._input}_computeFromInherited(e){this._value=this._inheritedInput}set value(e){console.warn(".(style) sub-property cannot be directly set. It must comes from inline or computed setter.")}set inline(e){this.isValidValue(e)&&e!==this._inline&&(this._input=this._inline=e,this._needsUpdate=!0)}get inline(){return this._inline}isValidValue(e){return!0}getInheritedInput(e){if(this._input!=="inherit")return this._input;const t=e._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}}class JB extends ss{constructor(e,t){super(e,t,!1),this._input=new it.Vector4(0,0,0,0),this._inline=null,this._value=new it.Vector4(0,0,0,0)}get value(){return this._value}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input)}set inline(e){this._vector4ValueSetter(this._input,e),!this._input.equals(this._value)&&(this._needsUpdate=!0)}set top(e){this._input.x!==e&&(this._input.x=e,this._needsUpdate=!0)}get top(){return this._input.x}set right(e){this._input.y!==e&&(this._input.y=e,this._needsUpdate=!0)}get right(){return this._input.y}set bottom(e){this._input.z!==e&&(this._input.z=e,this._needsUpdate=!0)}get bottom(){return this._input.z}set left(e){this._input.w!==e&&(this._input.w=e,this._needsUpdate=!0)}get left(){return this._input.w}dispose(){this._computed=null,this._inline=null,this._input=null,this._output=null}_vector4ValueSetter(e,t){if(t instanceof it.Vector4){e.copy(t);return}if((typeof t=="string"||t instanceof String)&&(t=t.split(" ")),Array.isArray(t))switch(t=t.map(i=>parseFloat(i)),t.length){case 1:e.setScalar(t[0]);return;case 2:e.x=e.z=t[0],e.y=e.w=t[1];return;case 3:e.x=t[0],e.y=t[1],e.z=t[2];return;case 4:e.x=t[0],e.y=t[1],e.z=t[2],e.w=t[3];return;default:console.error("StyleVector4Property::set() Four Dimension property had more than four values");return}isNaN(t)||e.setScalar(t)}}class dCe extends JB{constructor(){super("padding",new it.Vector4(0,0,0,0))}computeOutputValue(e){super.computeOutputValue(e),e._bounds._needsUpdate=!0,e._bounds._needsRender=!0,e._layouter._needsProcess=!0,e._renderer._needsRender=!0,e._parent._value&&(e._parent._value._layouter._needsProcess=!0)}}class uCe extends JB{constructor(){super("margin",new it.Vector4(0,0,0,0))}computeOutputValue(e){super.computeOutputValue(e),e._renderer._needsRender=!0,e._parent._value&&(e._parent._value._flexDirection._needsProcess=!0)}}const B9=function(s,e,t){s[e]=t},pCe=function(s,e,t){t!==null&&(s[e]=t)};class hT{constructor(e){this._definition=e}set definition(e){this._definition=e}mediate(e,t,i,n=null){for(const r in this._definition){const o=this._definition[r];if(i[r]!==void 0){const a=o.t?o.t:B9;a(t,o.m,i[r]),n&&a(n,o.m,i[r])}}}static mediate(e,t,i,n,r=null){if(t)for(const o in n){const a=n[o];if(i[o]!==void 0){const l=a.t?a.t:B9;l(t,a.m,i[o]),r&&l(r,a.m,i[o])}}}}class fCe extends dn{constructor(){super("parent",null,!1)}update(e,t){e.parent&&e.parent.isUI?this._value=e.parent:this._value=null}set value(e){console.warn("ParentProperty is readonly")}get value(){return this._value}find(e){return this._value?e(this._value)?this._value:this._value._parent.find(e):null}dispose(){this._value=null}}const _V=function(s,e,t=6){return s.toFixed(t)===e.toFixed(t)};class P9 extends dn{constructor(e,t){super(e,t,!0),this.output=this._outputValue}set value(e){this.isValid(e)&&(_V(this._value,e)||(this._value=e,this._needsUpdate=!0))}get value(){return this._value}}class G9 extends AA{constructor(e){super(e,"inherit",!0),this.isValid=gCe}}const mCe=[it.FrontSide,it.BackSide,it.DoubleSide];function gCe(s){return mCe.indexOf(s)===-1?(console.warn(`SideProperty value '${s}' is not valid. Abort`),!1):!0}class kte{constructor(){this._offsetX=0,this._offsetY=0,this._lineBreak=null,this._kerning=0,this._fontFactor=1,this._fontSize=0,this._cumulativeWidth=0,this._paddingLeft=0,this._paddingRight=0,this._marginLeft=0,this._marginRight=0}resetOffsets(){this._offsetX=this._offsetY=0,this._cumulativeWidth=0}get xadvance(){return 0}get xoffset(){return 0}get yoffset(){return 0}get width(){return 0}get height(){return 0}set lineBreak(e){this._lineBreak=e}get lineBreak(){return this._lineBreak}get anchor(){return 0}get kerning(){return this._kerning*this._fontFactor}set kerning(e){this._kerning=e}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e}get lineHeight(){return 0}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e}get cumulativeWidth(){return this._cumulativeWidth}set cumulativeWidth(e){this._cumulativeWidth=e}get marginLeft(){return this._marginLeft}set marginLeft(e){this._marginLeft=e}get marginRight(){return this._marginRight}set marginRight(e){this._marginRight=e}get paddingLeft(){return this._paddingLeft}set paddingLeft(e){this._paddingLeft=e}get paddingRight(){return this._paddingRight}set paddingRight(e){this._paddingRight=e}get lineBase(){return 0}set fontFactor(e){this._fontFactor=e}get fontFactor(){return this._fontFactor}}class Nte{constructor(e){this._char="",this._width=1,this._heigth=1,this._xadvance=1,this._xoffset=0,this._yoffset=0,this._font=e}get font(){return this._font}get char(){return this._char}get width(){return this._width}get height(){return this._heigth}get xadvance(){return this._xadvance}get xoffset(){return this._xoffset}get yoffset(){return this._yoffset}set yoffset(e){this._yoffset=e}clone(e){throw new Error("Abstract... Need to be implemented")}asInlineGlyph(){throw new Error("Abstract... Need to be implemented")}}class Dte extends kte{constructor(e){super(),this._typographic=e}get typographic(){return this._typographic}get xadvance(){return this._typographic.xadvance*this._fontFactor}get xoffset(){return this._typographic.xoffset*this._fontFactor}get yoffset(){return this._typographic.yoffset*this._fontFactor}get width(){return this._typographic.width*this._fontFactor}get height(){return this._typographic.height*this._fontFactor}get char(){return this._typographic.char}get anchor(){return this.yoffset}get lineHeight(){return this._typographic.font.lineHeight*this._fontFactor}get lineBase(){return this._typographic.font.lineBase*this._fontFactor}}const ACe={light:"100",normal:"400",bold:"700",bolder:"900"};function W3(s){if(!isNaN(s))return s.toString();const e=ACe[s];return e||s}class yCe extends it.EventDispatcher{constructor(e,t){super(),this._isReady=!1,this._weight=W3(e),this._style=t,this._size=42,this._lineHeight=42,this._lineBase=42,this._font=null}get typographic(){return this._font}get isReady(){return this._isReady}get weight(){return this._weight}get style(){return this._style}get texture(){return this._texture}set fontMaterial(e){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get fontMaterial(){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get id(){return`${this._name}(w:${this.weight},s:${this.style})`}getTypographicGlyph(e){let t=this._chars[e];if(t)return t;if(e.match(/\s/))return this._chars[" "];const i=this._getFallbackCharacter(e);if(i&&(t=this._chars[i],t))return t;throw Error(`FontVariant('${this.id}')::getTypographicGlyph() - character('${e}') and/or fallback character were not found in provided msdf charset.`)}_getFallbackCharacter(e){throw new Error(`FontVariant(${typeof this})::_getFallbackCharacter() is abstract and should therefore be overridden.`)}getGeometricGlyph(e,t){throw new Error(`FontVariant(${typeof this})::getGeometryCharacter() is abstract and should therefore be overridden.`)}getKerningAmount(e){return this._kernings[e]?this._kernings[e]:0}adjustTypographicGlyphs(e){for(const t in e){const i=this.getTypographicGlyph(t),n=e[t];for(const r in n)i["_"+r]=e[t][r]}}_checkReadiness(){this._readyCondition()&&xCe(this)}_alterElementProperties(e){throw new Error(`FontVariant(${typeof this})::_alterElementProperties() is abstract and should therefore be overridden.`)}_readyCondition(){throw new Error(`FontVariant(${typeof this})::_readyCondition() is abstract and should therefore be overridden.`)}}const bCe={type:"ready"};function xCe(s){s._isReady=!0,s.dispatchEvent(bCe)}const J1=yCe;class vCe extends dn{constructor(e=null){super("font",e,!1),this._needsUpdate=!1,this._fontVariant=null,this._handleFontReadyClosure=null,this.isValid=_Ce}output(e){e[this._id]=this._fontVariant}update(e,t){if(this._fontVariant&&!this._fontVariant.isReady&&this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._value&&this._value instanceof J1)this._fontVariant=this._value;else{const i=e._fontFamily._value;i&&(this._fontVariant=i.getVariant(e._fontWeight._value,e._fontStyle._value))}this._fontVariant&&(this._fontVariant._alterElementProperties(e),this._handleFontReadyClosure=CCe(e,this),this._fontVariant.isReady?this._handleFontReadyClosure():this._fontVariant.addEventListener("ready",this._handleFontReadyClosure),(!e._fontMaterial._defaultMaterial||!(e._fontMaterial._defaultMaterial instanceof this._fontVariant.fontMaterial))&&(e._fontMaterial._defaultMaterial=new this._fontVariant.fontMaterial,e._fontMaterial._needsUpdate=!0))}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value}get fontVariant(){return this._fontVariant}dispose(){this._handleFontReadyClosure&&(this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._handleFontReadyClosure=null),this._value=null,this._fontVariant=null}}function _Ce(s){return s instanceof J1?!0:(console.warn(`.font value '${s}' is not valid. It requires a FontVariant instance. Aborted`),!1)}function CCe(s,e){return function(){e._needsUpdate=!0,s._glyphs._needsProcess=!0,e._fontVariant.removeEventListener("ready",e._handleFontReadyClosure),e._handleFontReadyClosure=null}}class wCe extends ss{constructor(e){super("display",e),this._value="flex",this._allowsInherit=!1,this._needsUpdate=!1,this.isValidValue=MCe}computeOutputValue(e){e._visible._value=this._output!=="none"}}const SCe=["none","flex"];function MCe(s){return SCe.indexOf(s)===-1?(console.warn(`(.style) display value '${s}' is not valid. Aborted`),!1):!0}class ICe extends ss{constructor(e){super("boxSizing",e),this._allowsInherit=!1,this.isValidValue=ECe}computeOutputValue(e){this._value=this._inheritedInput,e._bounds._needsUpdate=!0}}const TCe=["border-box","content-box"];function ECe(s){return TCe.indexOf(s)===-1?(console.warn(`(.style) boxSizing value '${s}' is not valid. Aborted`),!1):!0}class iS extends ss{constructor(e,t){super(e,t,!1),this._value=new it.Color,this.output=this._outputValue}computeOutputValue(e){this._input!=="inherit"&&this._value.set(this._input)}set inline(e){this._input=this._inline=e,this._needsUpdate=!0}}class Ek extends ss{constructor(e,t){super(e,t,!0),this.isValidValue=RCe,this._allowsInherit=!1,this._input=t,this._value=t,this.output=this._outputValue,this.computeOutputValue=this._computeFromInherited}_outputValue(e){e[this._id]=this._inheritedInput}}function RCe(s){return s<0&&s>1?(console.warn(`(.style) styleFactorProperty('${this.id}') value '${s}' is not valid)`),!1):!0}class LCe extends ss{constructor(e){super("backgroundImage",e,!0),this._input=null,this._allowsInherit=!1,this._textureSize=new it.Vector2(1,1),this.isValidValue=BCe}get value(){return this._value}output(e){e[this._id]=this._value,e.tSize=this._textureSize}computeOutputValue(e){if(this._value=this._inheritedInput,this._value instanceof it.Texture&&!this._value.image){console.warn("ThreeMeshUI - .backgroundImage :: Please provide preloaded texture in order to have accurate sizing.");return}this._needsProcess=!0}process(e){this._value?this._textureSize.set(this._value.image.width,this._value.image.height):this._textureSize.set(1,1)}}function BCe(s){return!0}class PCe extends ss{constructor(e){super("backgroundSize",e,!0),this.isValidValue=kCe,this.output=this._outputValue}}const GCe=["cover","contain","stretch"];function kCe(s){return GCe.indexOf(s)===-1?(console.warn(`(.style) backgroundSize value '${s}' is not valid. Aborted`),!1):!0}class NCe extends ss{constructor(e){super("overflow",e,!0),this.isValidValue=FCe,this._clippingPlanes=null,this._renderStrategy=this._emptyRender}update(e,t){this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0&&(this._input=this._computed),this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const i of e._children._uis)i._overflow._needsUpdate=!0;this.output(t)}output(e){e.clippingPlanes=this._clippingPlanes}computeOutputValue(e){super.computeOutputValue(e),this._value==="hidden"?this._renderStrategy=this._propagateRender:(this._renderStrategy=this._emptyRender,this._clippingPlanes=null);const t=e._parent._value;if(t!==null){const i=t._overflow;if((i._value==="hidden"||i._clippingPlanes!==null)&&!this._clippingPlanes){this._clippingPlanes=[new it.Plane(new it.Vector3(0,-1,0),1),new it.Plane(new it.Vector3(-1,0,0),1),new it.Plane(new it.Vector3(0,1,0),1),new it.Plane(new it.Vector3(1,0,0),1)];for(let n=0;n<this._clippingPlanes.length;n++)this._clippingPlanes[n].parent=t;i._clippingPlanes!==null&&this._clippingPlanes.push(...i._clippingPlanes),this._renderStrategy=this._hiddenRender,this._needsRender=!0}else(i._value==="visible"||i._clippingPlanes===null)&&this._clippingPlanes!==null&&(this._clippingPlanes=null,this._renderStrategy=this._emptyRender,this._needsRender=!0)}}render(e){this._renderStrategy(e)}_emptyRender(e){}_hiddenRender(e){const t=e._parent._value,i=t._bounds._offsetHeight,n=t._bounds._offsetWidth,r=t._padding._value,o=t._borderWidth._value;for(let a=0;a<4&&a<this._clippingPlanes.length;a++){const l=this._clippingPlanes[a];switch(a%4){case 0:l.constant=i/2-(r.x+o.x);break;case 1:l.constant=n/2-(r.y+o.y);break;case 2:l.constant=i/2-(r.z+o.z);break;case 3:l.constant=n/2-(r.w+o.w);break}l.applyMatrix4(t.matrixWorld)}for(let a=0;a<e._children._uis.length;a++){const l=e._children._uis[a];l._overflow._needsRender=!0}}_propagateRender(e){for(let t=0;t<e._children._uis.length;t++){const i=e._children._uis[t];i._overflow._needsRender=!0}}}const DCe=["visible","hidden"];function FCe(s){return DCe.indexOf(s)===-1?(console.warn(`(.style) overflow value '${s}' is not valid. Aborted`),!1):!0}const vx="rem",Fte="em",ZL="%",VCe=[vx,Fte,ZL],Vte=function(s){return VCe.indexOf(s)===-1?vx:s};class zCe extends JB{constructor(e){super("borderRadius",e),this._valueUV=this._value.clone(),this._input=new it.Vector4(0,0,0,0),this._mediation=!0,this._cornerTL=new it.Vector2(0,1),this._cornerTR=new it.Vector2(1,1),this._cornerBR=new it.Vector2(1,0),this._cornerBL=new it.Vector2(0,0);const t=new dT(this._valueUV,["x","y"]),i=new dT(this._valueUV,["z","w"]),n=new dT(this._valueUV,["x","w"]),r=new dT(this._valueUV,["y","z"]);t.complementaryMediation=i,i.complementaryMediation=t,n.complementaryMediation=r,r.complementaryMediation=n,this._sideMediators=[t,i,n,r],this._units=vx}set units(e){this._units=Vte(e),this._needsProcess=!0}get units(){return this._units}set mediation(e){e!==this._mediation&&(this._mediation=e,this._needsUpdate=!0)}get mediation(){return this._mediation}output(e){e.cornerTL=this._cornerTL,e.cornerTR=this._cornerTR,e.cornerBR=this._cornerBR,e.cornerBL=this._cornerBL}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0}process(e){this._needsRender=!0}render(e){this._valueUV.copy(this._value);const t=e._bounds._offsetWidth,i=e._bounds._offsetHeight;if(this._units===ZL&&this._valueUV.divideScalar(100),this._units===vx&&this._valueUV.divideScalar(Math.min(t,i)),this._mediation)do this._sideMediators.forEach(o=>o.computeValue()),this._sideMediators.sort((o,a)=>o.value<a.value?1:-1),this._sideMediators[0].value>1&&this._sideMediators[0].mediate();while(this._sideMediators[0].value>1);let n=t>i?i/t:1,r=t<i?t/i:1;this._units===ZL&&(n=r=1),this._cornerTL.x=this._valueUV.x*n,this._cornerTL.y=1-this._valueUV.x*r,this._cornerTR.x=1-this._valueUV.y*n,this._cornerTR.y=1-this._valueUV.y*r,this._cornerBR.x=1-this._valueUV.z*n,this._cornerBR.y=this._valueUV.z*r,this._cornerBL.x=this._valueUV.w*n,this._cornerBL.y=this._valueUV.w*r}dispose(){for(const e of this._sideMediators)e.dispose();this._sideMediators=null,this._cornerTL=null,this._cornerTR=null,this._cornerBR=null,this._cornerBL=null,super.dispose()}set topLeft(e){this._input.x!==e&&(this._input.x=e,this._needsUpdate=!0)}get topLeft(){return this._input.x}set topRight(e){this._input.y!==e&&(this._input.y=e,this._needsUpdate=!0)}get topRight(){return this._input.y}set bottomRight(e){this._input.z!==e&&(this._input.z=e,this._needsUpdate=!0)}get bottomRight(){return this._input.z}set bottomLeft(e){this._input.w!==e&&(this._input.w=e,this._needsUpdate=!0)}get bottomLeft(){return this._input.w}set top(e){this._input.x===e&&this._input.y===e||(this._input.x=this._input.y=e,this._needsUpdate=!0)}get top(){return(this._input.x+this._input.y)/2}set right(e){this._input.y===e&&this._input.z===e||(this._input.y=this._input.z=e,this._needsUpdate=!0)}get right(){return(this._input.y+this._input.z)/2}set bottom(e){this._input.z===e&&this._input.w===e||(this._input.z=this._input.w=e,this._needsUpdate=!0)}get bottom(){return(this._input.z+this._input.w)/2}set left(e){this._input.w===e&&this._input.x===e||(this._input.w=this._input.x=e,this._needsUpdate=!0)}get left(){return(this._input.w+this._input.x)/2}}class dT{constructor(e,t){this._borderRadiuses=e,this._sideProperties=t,this._complementaryMediation=null,this._value=0}get value(){return this._value}set complementaryMediation(e){this._complementaryMediation=e}computeValue(){let e=0;for(const t of this._sideProperties)e+=this._borderRadiuses[t];this._value=e}mediate(e=!0){if(!(this._value<1)){for(const t of this._sideProperties)this._borderRadiuses[t]/=this._value;e&&this._complementaryMediation.mediate(!1)}}dispose(){this._complementaryMediation=null,this._borderRadiuses=null}}class UCe extends JB{constructor(e){super("borderWidth",e,!1),this._valueUV=this._value.clone(),this.output=this._outputValue,this._units=vx}set units(e){this._units=Vte(e),this._needsUpdate=!0}get units(){return this._units}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0,e._bounds._needsUpdate=!0,e._layouter._needsUpdate=!0}_outputValue(e){e[this._id]=this._valueUV}process(e){this._needsRender=!0,e._borderRadius._needsRender=!0}render(e){this._valueUV.copy(this._value);const t=e._bounds._offsetWidth,i=e._bounds._offsetHeight;if(this._units===ZL&&(console.log("Percent"),console.log(this._valueUV)),this._units===vx)t!==0&&(this._valueUV.w/=t,this._valueUV.y/=t),i!==0&&(this._valueUV.x/=i,this._valueUV.z/=i);else if(this._units===Fte){if(t!==0){const n=t>i?i/t:1;this._valueUV.y*=n,this._valueUV.w*=n}if(i!==0){const n=t<i?t/i:1;this._valueUV.x*=n,this._valueUV.z*=n}}}}class XCe extends dn{constructor(e,t=!0){super("visible",t,!0),this._needsUpdate=!1}update(e,t){e.visible=this._value,e._parent._value&&(e._parent._value._children._needsUpdate=!0)}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value}}class zte extends iS{constructor(e){super("backgroundColor",e,!1),this._input="transparent",this._allowsInherit=!1}computeOutputValue(e){e._backgroundMesh.visible=!(this._input==="none"||this._input==="transparent"),this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._input==="transparent"||this._input==="none"||this._value.set(this._input)}}class Nu extends dn{constructor(e="untitled"){super(e,void 0,!1)}update(e,t){}output(e){}}class OCe extends dn{constructor(){super("inlineJustificator",null,!1),this._value=null}update(e,t){}process(e){const t=e._bounds._innerHeight,i=e._layouter._value,n=Math.abs(i.height);let r=(()=>{switch(e._alignItems._value){case"inherit":case"start":return t/2;case"end":return n-t/2;case"stretch":case"center":return n/2}})();const o=e._padding._value,a=e._borderWidth._value;r+=(-o.x+o.z)/2+(-a.x+a.z)/2,i.forEach(l=>{l.y+=r,l.forEach(c=>{c.offsetY+=r})})}}const ZCe=["start","center","end","stretch"],WCe=function(s){return ZCe.indexOf(s)===-1?(console.warn(`(.style) alignItems value '${s}' is not valid. Aborted`),!1):!0};class H3 extends ss{constructor(){super("alignItems","inherit",!0),this.isValidValue=WCe}}class Q3 extends ss{constructor(){super("textAlign","inherit",!0),this.isValidValue=QCe}}const HCe=["left","right","center","justify","justify-left","justify-right","justify-center"],QCe=function(s){return HCe.indexOf(s)===-1?(console.warn(`(.style) textAlign value '${s}' is not valid. Aborted`),!1):!0};class K3 extends ss{constructor(){super("flexDirection","inherit",!0),this.isValid=YCe}}const KCe=["row","row-reverse","column","column-reverse"];function YCe(s){return KCe.indexOf(s)===-1?(console.warn(`(.style) flexDirection value '${s}' is not valid. Aborted`),!1):!0}class Y3 extends ss{constructor(){super("justifyContent","inherit",!0),this.isValidValue=jCe}}const JCe=["start","center","end","space-between","space-around","space-evenly"];function jCe(s){return JCe.indexOf(s)===-1?(console.warn(`(.style) justifyContent value '${s}' is not valid. Aborted`),!1):!0}class qCe extends ss{constructor(){super("order",0,!0),this._value=0,this._input=0,this._allowsInherit=!1}computeOutputValue(e){this._value=this._inheritedInput,e._parent._value&&(e._parent._value._children._needsProcess=!0)}}class Ute extends ss{constructor(){super("position","static",!0),this._allowsInherit=!1,this._value="static",this._needsUpdate=!1,this.computeOutputValue=this._computeFromInherited,this.isValidValue=ewe}_computeFromInherited(e){super._computeFromInherited(e),e._parent._value&&(e._parent._value._children._needsProcess=!0)}}const $Ce=["static","absolute"];function ewe(s){return $Ce.indexOf(s)===-1?(console.warn(`(.style) position value '${s}' is not valid. Aborted`),!1):!0}class Xte extends ss{constructor(e,t=null){super(e,t,!0),this._input="auto",this._auto=!0,this._relative=!1,this._updateRequired=!0}set inline(e){this.isValidValue(e)&&e!==this._inline&&(this._inline=e,this._input!==this._inline&&this._parseInput())}get inline(){return this._inline}_parseInput(){let e=!0;if(this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0?(this._computed===this._input&&(e=!1),this._input=this._computed):e=this._input==="inherit",e){if(this._auto=!this._input||this._input==="auto",this._auto)this._relative=!1;else if((typeof this._input=="string"||this._input instanceof String)&&this._input.endsWith("%")){this._relative=!0,this._value=0;const t=parseFloat(this._input.replace("%","").trim());isNaN(t)||(this._value=t/100)}else this._relative=!1,this._value=this._input;this._needsUpdate=this._updateRequired=e}}update(e,t){if(this._updateRequired){this._updateRequired=!1,this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const i of e._children._uis)i[`_${this._id}`]._needsUpdate=!0;this.output(t),e._parent._value&&(e._parent._value._layouter._needsProcess=!0)}}computeOutputValue(e){e._bounds._needsUpdate=!0,e._renderer._needsRender=!0}getInheritedInput(e){if(this._input!=="inherit"&&!this._auto)return this._input;const t=e._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}getDefaultValue(){return 0}get value(){return this._value}}class twe extends Xte{constructor(){super("width")}}class iwe extends Xte{constructor(){super("height")}computeOutputValue(e){super.computeOutputValue(e)}}class Ote extends Nu{constructor(){super("textContent"),this._needsUpdate=!1}set value(e){}process(e){let t="";for(let i=0;i<e.children.length;i++){const n=e.children[i];n.isUI&&(t+=n.textContent)}this._value=t}}class Zte extends ss{constructor(e){super("fontStyle",e,!0),this.isValidValue=swe}}const nwe=["normal","italic"];function swe(s){return nwe.indexOf(s)===-1?(console.warn(`(.style) fontStyle value '${s}' is not valid. Aborted`),!1):!0}class Wte extends ss{constructor(){super("fontWeight","inherit",!0),this.isValid=owe}}const rwe=["100","200","300","400","500","600","700","800","900","light","normal","bold","bolder"];function owe(s){return rwe.indexOf(s.toString())===-1?(console.warn(`(.style) fontWeight value '${s}' is not valid. Aborted`),!1):!0}class Hte{constructor(){this._size=42,this._lineHeight=42,this._lineBase=38,this._name="-",this._charset=""}get size(){return this._size}get lineHeight(){return this._lineHeight}get lineBase(){return this._lineBase}get name(){return this._name}get charset(){return this._charset}}class awe extends Hte{constructor(e){super(),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._name=e.info.face,this._textureWidth=e.common.scaleW,this._textureHeight=e.common.scaleH,this._charset=e.chars.map(t=>t.char).join("")}get textureWidth(){return this._textureWidth}get textureHeight(){return this._textureHeight}}class lwe extends Dte{constructor(e){super(e)}get uv(){return this.typographic.uv}}class WL extends Nte{constructor(e,t){super(e),this._char=t.char,this._width=t.width,this._heigth=t.height,this._xadvance=t.xadvance?t.xadvance:this._width,this._xoffset=t.xoffset?t.xoffset:0,this._yoffset=t.yoffset?t.yoffset:0,this._uv=t.uv?t.uv:null,isNaN(t.x)||(this._uv={left:t.x/e.textureWidth,right:(t.x+t.width)/e.textureWidth,top:1-(t.y+t.height)/e.textureHeight,bottom:1-t.y/e.textureHeight})}get uv(){return this._uv}clone(e){return new WL(this._font,{char:e,width:this._width,height:this._heigth,xadvance:this._xadvance,xoffset:this._xoffset,yoffset:this._yoffset,uv:null})}asInlineGlyph(){return new lwe(this)}}class cwe extends it.PlaneGeometry{constructor(e,t){let i=1,n=1;const r=e.typographic.font.size,o=t._segments.value;i=Math.ceil(e.typographic.width/r*o),n=Math.ceil(e.typographic.height/r*o),super(e.width,e.height,i,n),e.uv?(this._mapUVs(e),this._transformGeometry(e)):(this._nullifyUVs(),this.scale(0,0,1),this.translate(0,e.fontSize/2,0)),this.name="GlyphGeometry"}_mapUVs(e){const t=e.uv.right-e.uv.left,i=e.uv.bottom-e.uv.top,n=this.getAttribute("uv").array.slice(),r=[];for(let o=0;o<n.length;o+=2){const a=n[o],l=n[o+1];r.push(e.uv.left+t*a),r.push(e.uv.top+i*l)}this.setAttribute("uvG",new it.BufferAttribute(new Float32Array(r),2))}_nullifyUVs(){const e=[],t=this.getAttribute("uv").array.length;for(let i=0;i<t;i++)e.push(0);this.setAttribute("uvG",new it.BufferAttribute(new Float32Array(e),2))}_transformGeometry(e){this.translate(e.width/2,-e.height/2,0)}}const hwe=`
attribute vec2 uvG;
varying vec2 vUvG;
`,J3=hwe,dwe=`
vUvG = uvG;
`,j3=dwe,uwe=`
gl_Position.z -= 0.00001;
`,q3=uwe,pwe=`
varying vec2 vUvG;
uniform sampler2D glyphMap;
uniform vec2 unitRange;
// functions from the original msdf repo:
// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field
float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}
float screenPxRange() {

	// precomputed unitRange as recommended by Chlumsky
	// vec2 unitRange = vec2(pxRange)/vec2(textureSize(glyphMap, 0));
	vec2 screenTexSize = vec2(1.0)/fwidth(vUvG);
	return max(0.5*dot(unitRange, screenTexSize), 1.0);
}
float tap(vec2 offsetUV) {
	vec3 msd = texture( glyphMap, offsetUV ).rgb;
	float sd = median(msd.r, msd.g, msd.b);
	float screenPxDistance = screenPxRange() * (sd - 0.5);
	float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
	return alpha;
}
`,$3=pwe,fwe=`
	float alpha;
#ifdef NO_RGSS

	alpha = tap( vUvG );

#else

	// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec
	// per pixel partial derivatives
	vec2 dx = dFdx(vUvG);
	vec2 dy = dFdy(vUvG);
	// rotated grid uv offsets
	vec2 uvOffsets = vec2(0.125, 0.375);
	vec2 offsetUV = vec2(0.0, 0.0);
	// supersampled using 2x2 rotated grid
	alpha = 0.0;
	offsetUV.xy = vUvG + uvOffsets.x * dx + uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.x * dx - uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG + uvOffsets.y * dx - uvOffsets.x * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.y * dx + uvOffsets.x * dy;
	alpha += tap(offsetUV);
	alpha *= 0.25;

#endif

	alpha = clamp( alpha, 0.0, 1.0 );

#ifdef INVERT_ALPHA

	alpha = 1.0 - alpha;

#endif

	diffuseColor.a *= alpha;
`,eO=fwe,jB=function(s,e,t){s.alphaTest=t,tO(s,"USE_ALPHATEST",t>0)},tO=function(s,e,t){s.defines&&(t?s.defines[e]===void 0&&(s.defines[e]="",s.needsUpdate=!0):s.defines[e]!==void 0&&(delete s.defines[e],s.needsUpdate=!0))},Qte=function(s,e,t){s.defines[e]&&s.defines[e]===t||(s.defines[e]=t,s.needsUpdate=!0)},_c=function(s,e,t){s.userData[e]?s.userData[e].value=t:s.uniforms[e].value=t},mwe=function(s,e,t){s.userData[e].value=t};class Tc{static ensureMaterialOptions(e){e.transparent=!0,e.alphaTest=e.alphaTest||.02}static ensureDefines(e){e.defines||(e.defines={})}static ensureUserData(e,t){e.userData.glyphMap={value:t.glyphMap},e.userData.unitRange={value:new it.Vector2}}static bindUniformsWithUserData(e,t){e.uniforms.glyphMap=t.userData.glyphMap,e.uniforms.unitRange=t.userData.unitRange}static injectShaderChunks(e){Tc.injectVertexShaderChunks(e),Tc.injectFragmentShaderChunks(e)}static injectVertexShaderChunks(e){e.vertexShader=e.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+J3),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+j3),e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
`+q3)}static injectFragmentShaderChunks(e){e.fragmentShader=e.fragmentShader.replace("#include <uv_pars_fragment>",`#include <uv_pars_fragment>
`+$3),e.fragmentShader=e.fragmentShader.replace("#include <alphamap_fragment>",`#include <alphamap_fragment>
`+eO)}static from(e){return class extends e{constructor(i={}){Tc.ensureMaterialOptions(i);super(i);p(this,"_cumulativeOnBeforeCompile",i=>{Tc.bindUniformsWithUserData(i,this),Tc.injectShaderChunks(i),this._userDefinedOnBeforeCompile(i)});Tc.ensureDefines(this),Tc.ensureUserData(this,i),this._userDefinedOnBeforeCompile=n=>{},this._onBeforeCompile=this._cumulativeOnBeforeCompile}static get fontMaterialProperties(){return Tc.mediation}set onBeforeCompile(i){this._userDefinedOnBeforeCompile=i}get onBeforeCompile(){return this._onBeforeCompile}}}static get mediation(){return ywe}}const gwe=function(s,e,t){const i=t?t.texture:null,n=t?t.unitRange:new it.Vector2;if(s[e]!==void 0){s.glyphMap=i,s.unitRange=n;return}s.userData&&s.userData.glyphMap&&(s.userData.glyphMap.value=i,s.userData.unitRange.value=n)},Awe=function(s,e,t){t&&t!=="antialiased"?s.defines.NO_RGSS="":delete s.defines.NO_RGSS,s.needsUpdate=!0},ywe={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:jB},fontSide:{m:"side"},font:{m:"glyphMap",t:gwe},color:{m:"color"},fontOpacity:{m:"opacity"},fontSmooth:{m:"NO_RGSS",t:Awe},invertAlpha:{m:"INVERT_ALPHA",t:tO}},bwe=`
${J3}
#include <clipping_planes_pars_vertex>
void main() {
	${j3}
	#include <begin_vertex>
	#include <project_vertex>
	${q3}
	#include <clipping_planes_vertex>
}
`,xwe=`
uniform vec3 diffuse;
uniform float opacity;
${$3}
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	// instead of <color_fragment> : vec4 diffuseColor
	vec4 diffuseColor = vec4( diffuse, opacity );
	${eO}
	#include <alphatest_fragment>
	// instead of <output_fragment>
	gl_FragColor = diffuseColor;
	#include <clipping_planes_fragment>
}
`,vwe=.02;class iO extends it.ShaderMaterial{static get mediation(){return Tc.mediation}constructor(e={}){super({uniforms:{glyphMap:{value:null},diffuse:{value:null},opacity:{value:1},unitRange:{value:new it.Vector2(0,0)},alphaTest:{value:vwe}},transparent:!0,clipping:!0,vertexShader:bwe,fragmentShader:xwe,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0,this.noRGSS=e.noRGSS||!1}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get opacity(){return this.uniforms.opacity.value}get unitRange(){return this.uniforms.unitRange.value}set unitRange(e){this.uniforms.unitRange.value.copy(e)}get glyphMap(){return this.uniforms.glyphMap.value}set glyphMap(e){this.uniforms.glyphMap.value=e}get isDefault(){return this.constructor===iO}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(e){this.uniforms.alphaTest.value=e}}class _we extends J1{constructor(e,t,i,n){if(super(e,t),this._unitRange=new it.Vector2(1,1),i.pages?this._buildData(i):Cwe(this,i),n instanceof it.Texture)this._texture=n,this._buildTexture(n);else if(typeof n=="string"||n instanceof String)wwe(this,n);else throw new Error(`ThreeMeshUI::MSDFVariant provided 'texture' parameter is '${typeof n}'. Only Texture and String allowed.`);this._defaultMaterialClass=iO,this._checkReadiness()}get texture(){return this._texture}get unitRange(){return this._unitRange}set fontMaterial(e){this._defaultMaterialClass=e}get fontMaterial(){return this._defaultMaterialClass}_buildData(e){this._font=new awe(e),this._kernings=this._buildKerningPairs(e),this._chars=this._buildCharacters(e),this._chars[" "]=this._buildCharacterWhite(e),this._chars[`
`]=this._buildCharacterWhite(e,`
`,.001,1),this._chars["	"]=this._buildCharacterWhite(e,"	",4,1),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._distanceRange=e.distanceField.distanceRange,this._unitRange=new it.Vector2(this._distanceRange,this._distanceRange).divide(new it.Vector2(e.common.scaleW,e.common.scaleH))}_buildTexture(e){e.generateMipmaps=!1,e.minFilter=it.LinearFilter,e.magFilter=it.LinearFilter,e.needsUpdate=!0}_getFallbackCharacter(e){return j0.missingCharacter(this,e)}getGeometricGlyph(e,t){return new cwe(e,t)}_readyCondition(){return this._chars&&this._texture&&this._texture.image}_buildKerningPairs(e){const t={};for(let i=0;i<e.kernings.length;i++){const n=e.kernings[i];if(n.amount===0)continue;const r=String.fromCharCode(n.first,n.second);t[r]=n.amount}return t}_buildCharacters(e){const t={};for(let i=0;i<e.chars.length;i++){const n=e.chars[i];t[n.char]=new WL(this._font,n)}return t}_buildCharacterWhite(e,t=" ",i=1,n=1){return new WL(this._font,{char:t,width:e.info.size/3*i,height:e.info.size*.7*n})}_alterElementProperties(e){}}function Cwe(s,e){new it.FileLoader().setResponseType("json").load(e,t=>{s._buildData(t),s._checkReadiness()})}function wwe(s,e){s._texture=new it.TextureLoader().load(e,t=>{s._buildTexture(t),s._checkReadiness()})}class qB extends it.EventDispatcher{constructor(t){super();p(this,"_checkReadiness",()=>{this._variants.every(t=>t.isReady)&&Mwe(this)});this._name=t,this._variants=[],this._isReady=!1}get isReady(){return this._isReady}addVariant(t,i,n,r,o=!1){if(o||!this.getVariant(t,i)){this._isReady=!1;const a=new _we(t,i,n,r);this._variants.push(a),a.isReady?this._checkReadiness():a.addEventListener("ready",this._checkReadiness)}else console.warn(`FontFamily('${this._name}')::addVariant() - Variant(${t}, ${i}) already exists.`);return this}addCustomImplementationVariant(t,i=!1){return i||!this.getVariant(t.weight,t.style)?(this._isReady=!1,this._variants.push(t),t.isReady?this._checkReadiness():t.addEventListener("ready",this._checkReadiness)):console.warn(`FontFamily('${this._name}')::addCustomImplementationVariant() - Variant(${t.weight}, ${t.style}) already exists.`),this}getVariant(t,i){return t=W3(t),this._variants.find(n=>n.weight===t&&n.style===i)}get name(){return this._name}}const Swe={type:"ready"};function Mwe(s){s._isReady=!0,s.dispatchEvent(Swe)}const vR={},Iwe=function(s){const e=[...arguments];e.forEach(i=>{if(!(i instanceof qB))throw new Error(`FontLibrary::prepare() - One of the provided parameter is not a FontFamily. Instead ${typeof i} given.`)});const t=function(){return e.every(i=>i.isReady)};return new Promise((i,n)=>{if(t())i();else for(let r=0;r<e.length;r++){const o=e[r];o.isReady||o.addEventListener("ready",()=>{t()&&i()})}})},Twe=function(s){return vR[s]&&console.error(`FontLibrary::addFontFamily - Font('${s}') is already registered`),vR[s]=new qB(s),vR[s]},Ewe=function(s){return vR[s]},Rwe=function(s){Kte=s};let Kte=function(s,e){return console.error(`The character '${e}' is not included in the font characters set.`)," "};function Lwe(s,e){return Kte(s,e)}const Bwe={addFontFamily:Twe,getFontFamily:Ewe,prepare:Iwe,setMissingCharacterHandler:Rwe,missingCharacter:Lwe},j0=Bwe;class Yte extends ss{constructor(){super("fontFamily","inherit",!0)}computeOutputValue(e){if(this._input instanceof qB)this._value=this._input;else if(this._input!=="inherit")if(typeof this._input=="string"){const t=j0.getFontFamily(this._input);t?this._value=t:console.warn(`(.style) fontFamily, the font '${this._input}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}getInheritedInput(e){if(this._input!=="inherit")return this._input;const t=e._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}}class Jte extends ss{constructor(){super("lineHeight","inherit",!0)}update(e,t){super.update(e,t),e._layouter._needsProcess=!0}}class jte extends ss{constructor(){super("whiteSpace","inherit"),this.isValidValue=Gwe}}const Pwe=["normal","nowrap","pre","pre-line","pre-wrap"];function Gwe(s){return Pwe.indexOf(s)===-1?(console.warn(`(.style) whiteSpace value '${s}' is not valid. Aborted`),!1):!0}class qte extends ss{constructor(){super("letterSpacing","inherit",!0)}}class kwe extends ss{constructor(){super("fontSize","inherit",!0)}}class $te extends dn{constructor(){super("segments",1,!1)}}class Nwe extends AA{constructor(){super("invertAlpha","inherit")}}class $B extends ss{constructor(){super("fontKerning","inherit"),this.isValidValue=Fwe}}const Dwe=["normal","none","inherit"];function Fwe(s){return Dwe.indexOf(s)===-1?(console.warn(`(.style) fontKerning value '${s}' is not valid. Aborted`),!1):!0}class uT extends AA{constructor(e){super(e,"inherit",!0)}}class k9 extends AA{constructor(e){super(e,"inherit",!1),this._mediation={},this._defaultMaterial=null}update(e,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"?this._notInheritedValue=this.getInheritedInput(e):this.propagate(e),this._notInheritedValue?this._notInheritedValue.constructor.mediation?this._mediation={...this._notInheritedValue.constructor.mediation}:this._mediation={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:jB},fontSide:{m:"side"},color:{m:"color"},fontOpacity:{m:"opacity"}}:this._mediation={},e._transferToFontMaterial(),this._outputValue(t)}getInheritedInput(e){if(this._value!=="inherit")return this._value;let t=e,i=null;for(;t._parent._value;)if(t=t._parent._value,t[`_${this._id}`]._value!=="inherit"){i=t[`_${this._id}`]._value;break}return i!==null?i:this.getDefaultValue()}getDefaultValue(){return this._defaultMaterial}}const Vwe=function(s,e,t){s.traverse(i=>{i.renderOrder=t})};class j1 extends it.Object3D{constructor(t,i){super();p(this,"_rebuildParentUI",()=>{this._parent._needsUpdate=!0,this.parent&&!this.parent.isUI?(HL.register(this),this.activatePseudoState("root")):(HL.remove(this),this.deactivatePseudoState("root"))});Object.defineProperties(this,{isUI:{configurable:!1,enumerable:!0,value:!0}}),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundCustomDepthMaterial=null,this._backgroundMaterialMediation={},this._backgroundMeshMediation={backgroundCastShadow:{m:"castShadow"},backgroundReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder",t:Vwe}},this._fontMesh=null,this._fontMaterial=new k9("fontMaterial"),this._fontCustomDepthMaterial=new k9("fontCustomDepthMaterial"),this._fontMeshMediation={fontMaterial:{m:"material"},fontCustomDepthMaterial:{m:"customDepthMaterial",t:pCe},fontCastShadow:{m:"castShadow"},fontReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder"}},this._children=t.children?new t.children:new Nu("children"),this._parent=new fCe,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI),this._backgroundSide=new G9("backgroundSide"),this._fontSide=new G9("fontSide"),this._backgroundAlphaTest=new P9("backgroundAlphaTest",.02),this._fontAlphaTest=new P9("fontAlphaTest",.02),this._visible=new XCe("visible",!0),this._backgroundCastShadow=new uT("backgroundCastShadow"),this._fontCastShadow=new uT("fontCastShadow"),this._backgroundReceiveShadow=new uT("backgroundReceiveShadow"),this._fontReceiveShadow=new uT("fontReceiveShadow"),this._renderOrder=new rCe,this._segments=t.segments?new t.segments:new $te,this._bounds=t.bounds?new t.bounds:new Nu("bounds"),this._order=new qCe,this._padding=new dCe,this._margin=new uCe,this._position=new Ute,this._flexDirection=t.flexDirection?new t.flexDirection:new K3,this._justifyContent=t.justifyContent?new t.justifyContent:new Y3,this._alignItems=t.alignItems?new t.alignItems:new H3,this._display=new wCe("flex"),this._boxSizing=new ICe("border-box"),this._width=new twe,this._height=new iwe,this._backgroundColor=t.backgroundColor?new t.backgroundColor:new zte,this._backgroundOpacity=new Ek("backgroundOpacity",.5),this._backgroundImage=new LCe,this._backgroundSize=new PCe("cover"),this._color=t.color?new t.color:new iS("color","inherit"),this._fontOpacity=new Ek("fontOpacity","inherit"),this._whiteSpace=t.whiteSpace?new t.whiteSpace:new jte,this._fontFamily=t.fontFamily?new t.fontFamily:new Yte,this._fontStyle=t.fontStyle?new t.fontStyle:new Zte("normal"),this._fontWeight=t.fontWeight?new t.fontWeight:new Wte,this._fontSize=t.fontSize?new t.fontSize:new kwe,this._lineHeight=t.lineHeight?new t.lineHeight:new Jte,this._fontKerning=t.fontKerning?new t.fontKerning:new $B,this._letterSpacing=t.letterSpacing?new t.letterSpacing:new qte,this._overflow=new NCe("visible"),this._borderRadius=new zCe(0),this._borderWidth=new UCe(0),this._borderColor=new iS("borderColor",16711935),this._borderOpacity=new Ek("borderOpacity",1),this._font=new vCe,this._lineBreak=t.lineBreak?new t.lineBreak:new Nu("lineBreak"),this._textContent=t.textContent?new t.textContent:new Ote,this._glyphs=t.glyphs?new t.glyphs:new Nu("glyphs"),this._inlines=t.inlines?new t.inlines:new Nu("inlines"),this._layouter=t.layouter?new t.layouter:new Nu("layouter"),this._inlineJustificator=new OCe,this._textAlign=t.textAlign?new t.textAlign:new Q3,this._autoSize=t.autoSize?new t.autoSize:new Nu("autoSize"),this._renderer=t.renderer?new t.renderer:new Nu("renderer"),this._offset=new oCe,this._invertAlpha=new Nwe,this._fontSmooth=t.fontSmooth?new t.fontSmooth:new aCe,this._components=[this._textContent,this._children,this._parent,this._autoSize,this._fontFamily,this._fontStyle,this._fontWeight,this._font,this._whiteSpace,this._glyphs,this._inlines,this._visible,this._backgroundSide,this._fontSide,this._backgroundAlphaTest,this._fontAlphaTest,this._backgroundCastShadow,this._fontCastShadow,this._backgroundReceiveShadow,this._fontReceiveShadow,this._renderOrder,this._segments,this._padding,this._margin,this._width,this._height,this._borderWidth,this._boxSizing,this._bounds,this._position,this._flexDirection,this._justifyContent,this._alignItems,this._order,this._display,this._backgroundColor,this._backgroundOpacity,this._backgroundImage,this._backgroundSize,this._fontOpacity,this._color,this._fontSize,this._lineHeight,this._fontKerning,this._letterSpacing,this._borderRadius,this._borderColor,this._borderOpacity,this._lineBreak,this._offset,this._layouter,this._inlineJustificator,this._textAlign,this._invertAlpha,this._fontSmooth,this._fontMaterial,this._fontCustomDepthMaterial,this._overflow,this._renderer],this._onAfterUpdates=[],i.backgroundSide||(i.backgroundSide=0),i&&this.set(i)}update(){const t={};for(const i of this._components)i._needsUpdate&&(i.update(this,t),i._needsUpdate=!1);this._transferToBackgroundMesh(t),this._transferToFontMesh(t),this._transferToBackgroundMaterial(t),this._transferToFontMaterial(t);for(const i of this._children._uis)i.update()}process(){for(const t of this._children._uis)t.process();for(const t of this._components)t._needsProcess&&(t.process(this),t._needsProcess=!1)}render(){for(let t=0;t<this._components.length;t++){const i=this._components[t];i._needsRender&&(i.render(this),i._needsRender=!1)}for(const t of this._children._uis)t.render()}set(t){if(t.fontTexture&&(console.warn("ThreeMeshUI::set( {fontTexture} ) is deprecated. Please use fontLibrary to register font families and variants."),t.fontFamily)){const i=t.fontFamily.pages?t.fontFamily.info.face:t.fontFamily;let n=j0.getFontFamily(i);if(!n){const r=t.fontStyle?t.fontStyle:"normal",o=t.fontWeight?t.fontWeight:"400";n=j0.addFontFamily(i).addVariant(o,r,t.fontFamily,t.fontTexture)}t.fontFamily=n,delete t.fontTexture}for(let i of Object.keys(t)){const n=t[i];switch(i){case"contentDirection":console.warn("ThreeMeshUI v7xx: property `contentDirection` is deprecated and has been renamed as `flexDirection`"),i="flexDirection";break;case"interLine":console.warn("ThreeMeshUI v7xx: property `interLine` is deprecated and has been renamed as `lineHeight`"),i="lineHeight";break;case"content":console.warn("ThreeMeshUI v7xx: property `content` is deprecated and has been renamed as `textContent`"),i="textContent";break;case"fontColor":console.warn("ThreeMeshUI v7xx: property `fontColor` is deprecated and has been renamed as `color`"),i="color";break;case"hiddenOverflow":console.warn("ThreeMeshUI v7xx: property `hiddenOverflow` is deprecated and has been renamed as `overflow`"),i="overflow";break;case"backgroundTexture":console.warn("ThreeMeshUI v7xx: property `backgroundTexture` is deprecated and has been renamed as `backgroundImage`"),i="backgroundImage";break;case"alignContent":console.warn("ThreeMeshUI v7xx: property `alignContent` is deprecated and has been renamed as `alignItems`"),i="alignItems";break;case"borderTopColor":case"borderBottomColor":case"borderLeftColor":case"borderRightColor":i="borderColor";break}switch(i){case"fontSmooth":case"renderOrder":case"segments":case"visible":case"offset":this[`_${i}`].value=n;break;case"flexDirection":case"justifyContent":case"alignItems":case"color":case"fontFamily":case"fontOpacity":case"fontKerning":case"fontSize":case"fontStyle":case"fontWeight":case"textAlign":case"letterSpacing":case"lineHeight":case"whiteSpace":case"breakOn":case"width":case"height":case"padding":case"margin":case"backgroundColor":case"backgroundOpacity":case"backgroundImage":case"backgroundSize":case"borderColor":case"borderOpacity":case"borderRadius":case"borderWidth":case"overflow":case"order":case"boxSizing":this[`_${i}`]&&(this[`_${i}`].inline=n);break;case"paddingTop":this._padding.top=n;break;case"paddingRight":this._padding.right=n;break;case"paddingBottom":this._padding.bottom=n;break;case"paddingLeft":this._padding.left=n;break;case"marginTop":this._margin.top=n;break;case"marginRight":this._margin.right=n;break;case"marginBottom":this._margin.bottom=n;break;case"marginLeft":this._margin.left=n;break;case"borderTopWidth":this._borderWidth.top=n;break;case"borderRightWidth":this._borderWidth.right=n;break;case"borderBottomWidth":this._borderWidth.bottom=n;break;case"borderLeftWidth":this._borderWidth.left=n;break;case"borderTopLeftRadius":this._borderRadius.topLeft=n;break;case"borderTopRightRadius":this._borderRadius.topRight=n;break;case"borderBottomRightRadius":this._borderRadius.bottomRight=n;break;case"borderBottomLeftRadius":this._borderRadius.bottomLeft=n;break;case"side":case"castShadow":case"receiveShadow":const r=i.charAt(0).toUpperCase()+i.substr(1);this[`_background${r}`].value=n,this[`_font${r}`].value=n;break;case"fontSide":case"backgroundSide":case"fontCastShadow":case"backgroundCastShadow":case"fontReceiveShadow":case"backgroundReceiveShadow":case"fontMaterial":case"fontCustomDepthMaterial":this[`_${i}`].value=n;break;default:this[`_${i}`]!==void 0?this[`_${i}`].value=n:this[i]=n}}}get(t){switch(t){case"overflow":case"width":case"height":return this[`_${t}`].inline}}_rebuildChildrenLists(){this._children._needsUpdate=!0}add(t){let i=!1;for(let n=0;n<arguments.length;n++)super.add(arguments[n]),arguments[n].isUI&&(i=!0);return i&&this._rebuildChildrenLists(),this}remove(t){for(const i of Object.keys(arguments))arguments[i].isInline&&this.update(null,!0);return super.remove(...arguments),this._rebuildChildrenLists(),this}clear(){return this.removeFromParent(),this.traverse(t=>{t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose()}),super.clear(),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundMaterialMediation=null,this._backgroundMeshMediation=null,this._children.dispose(),this._children=null,this._parent.dispose(),this._parent=null,this._backgroundSide=null,this._backgroundAlphaTest=null,this._visible=null,this._backgroundCastShadow=null,this._backgroundReceiveShadow=null,this._renderOrder=null,this._segments=null,this._bounds=null,this._boxSizing=null,this._padding=null,this._margin=null,this._position=null,this._flexDirection=null,this._justifyContent=null,this._alignItems=null,this._display=null,this._backgroundColor=null,this._backgroundOpacity=null,this._backgroundSize=null,this._fontOpacity=null,this._color=null,this._whiteSpace=null,this._fontFamily=null,this._fontStyle=null,this._fontWeight=null,this._lineHeight=null,this._fontKerning=null,this._letterSpacing=null,this._overflow=null,this._textAlign=null,this._font=null,this._lineBreak=null,this._layouter=null,this}get textContent(){return this._textContent.process(this),this._textContent._value}get backgroundMaterial(){return this._backgroundMaterial}set backgroundMaterial(t){this._backgroundMaterial=t,this._backgroundMaterialMediation={...t.constructor.mediation},this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.material=this._backgroundMaterial,_c(t,"frameSize",this._backgroundMesh.scale))}set backgroundCustomDepthMaterial(t){this._backgroundCustomDepthMaterial=t,this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial)}get backgroundCustomDepthMaterial(){return this._backgroundCustomDepthMaterial}_transferToBackgroundMaterial(t=null){if(!t){t={};for(const i of this._components)i.output(t)}hT.mediate(this,this._backgroundMaterial,t,this._backgroundMaterialMediation,this._backgroundCustomDepthMaterial)}set backgroundSide(t){this._backgroundSide.value=t,this._backgroundMaterial&&(this._backgroundMaterial.side=t)}get backgroundSide(){return this._backgroundSide.value}set backgroundAlphaTest(t){this._backgroundAlphaTest.value=t,this._backgroundMaterial&&(this._backgroundMaterial.alphaTest=t)}get backgroundAlphaTest(){return this._backgroundAlphaTest.value}get fontMaterial(){return this._fontMaterial.value}set fontMaterial(t){this._fontMaterial.value=t}set fontCustomDepthMaterial(t){this._fontCustomDepthMaterial.value=t}get fontCustomDepthMaterial(){return this._fontCustomDepthMaterial.value}_transferToFontMaterial(t=null){const i=this._fontMaterial.value;if(i){if(!t){t={};for(const n of this._components)n.output(t)}hT.mediate(this,i,t,this._fontMaterial._mediation,this._fontCustomDepthMaterial.value)}}set fontSide(t){this._fontSide.value=t}get fontSide(){return this._fontSide.value}set fontAlphaTest(t){this._fontAlphaTest.value=t}get fontAlphaTest(){return this._fontAlphaTest.value}_transferToBackgroundMesh(t=null){if(!t){t={};for(const i of this._components)i.output(t)}hT.mediate(this,this._backgroundMesh,t,this._backgroundMeshMediation)}setBackgroundMesh(t){this._backgroundMesh&&(this.remove(this._backgroundMesh),this.unbindBackgroundMeshProperties()),this._backgroundMesh=t,this._backgroundMesh&&(this.bindBackgroundMeshProperties(),this._backgroundCustomDepthMaterial&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial),this._backgroundMaterial&&_c(this._backgroundMaterial,"frameSize",this._backgroundMesh.scale),this._transferToBackgroundMesh(),this.add(this._backgroundMesh))}bindBackgroundMeshProperties(){}unbindBackgroundMeshProperties(){}activatePseudoState(t){}deactivatePseudoState(t){}togglePseudoState(t){}hasPseudoState(t){return!1}set borderRadiusMediation(t){this._borderRadius.mediation=t}set backgroundCastShadow(t){this._backgroundCastShadow&&(this._backgroundCastShadow.value=t)}get backgroundCastShadow(){return this._backgroundCastShadow}set backgroundReceiveShadow(t){this._backgroundReceiveShadow&&(this._backgroundReceiveShadow.value=t)}get backgroundReceiveShadow(){return this._backgroundReceiveShadow}set renderOrder(t){this._renderOrder&&(this._renderOrder.value=t)}get renderOrder(){return this._renderOrder.value}_transferToFontMesh(t=null){if(this._fontMesh){if(!t){t={};for(const i of this._components)i.output(t)}hT.mediate(this,this._fontMesh,t,this._fontMeshMediation)}}setFontMesh(t){this._fontMesh&&(this.remove(this._fontMesh),this._fontMesh.material&&this._fontMesh.material.dispose(),this._fontMesh.geometry&&this._fontMesh.geometry.dispose(),this._fontMesh=null,this.unbindFontMeshProperties()),this._fontMesh=t,this._fontMesh&&(this._fontMesh.raycast=()=>{},this.bindFontMeshProperties(),this._transferToFontMaterial(),this._transferToFontMesh(),this.add(this._fontMesh))}bindFontMeshProperties(){}unbindFontMeshProperties(){}set fontCastShadow(t){this._fontCastShadow&&(this._fontCastShadow.value=t)}get fontCastShadow(){return this._fontCastShadow}set fontReceiveShadow(t){this._fontReceiveShadow&&(this._fontReceiveShadow.value=t)}get fontReceiveShadow(){return this._fontReceiveShadow}set segments(t){this._segments.value=t}get segments(){return this._segments.value}set onAfterUpdate(t){console.warn("ThreeMeshUI v7xx : `onAfterUpdate()` property has been deprecated, please rely on `addAfterUpdate` instead."),this.addAfterUpdate(t)}addAfterUpdate(t){this._onAfterUpdates.push(t)}removeAfterUpdate(t){const i=this._onAfterUpdates.indexOf(t);i!==-1&&this._onAfterUpdates.splice(i,1)}performAfterUpdate(){for(let t=0;t<this._onAfterUpdates.length;t++)this._onAfterUpdates[t]()}getProperty(t){return this[`_${t}`]?this[`_${t}`]:null}appendProperty(t,i){this[`_${t}`]=i,this._components.push(i)}replaceProperty(t,i){const n=this[`_${t}`],r=this._components.indexOf(n);return this._components[r]=this[`_${t}`]=i,i.needsUpdate=!0,n}}class HL{static register(e){this.elements.includes(e)||this.elements.push(e)}static remove(e){const t=this.elements.indexOf(e);t!==-1&&this.elements.splice(t,1)}static update(){for(const e of this.elements)e.update(),e.process(),e.process(),e.render()}}HL.elements=[];const zwe=`

// FrameBorder vertex pars
attribute vec2 uvB;
varying vec2 vUvB;

`,nO=zwe,Uwe=`

	// FrameBorder vertex shader
	vUvB = uvB;

`,sO=Uwe,Xwe=`

// borders sequences are : x:TOP, y:RIGHT, z:BOTTOM, w:LEFT
uniform vec4 borderWidth;
uniform vec3 borderColor;
uniform float borderOpacity;
uniform vec4 borderRadius;

uniform vec2 cornerTL;
uniform vec2 cornerTR;
uniform vec2 cornerBR;
uniform vec2 cornerBL;

varying vec2 vUvB;

float getEllipticFactor( vec2 uv, vec2 center, float radiusX, float radiusY )
{

		float edx = uv.x - center.x;
		float edy = uv.y - center.y;

		float ddx = (edx * edx) / (radiusX * radiusX);
		float ddy = (edy * edy) / (radiusY * radiusY);

		return ddx + ddy;

}

`,rO=Xwe,Owe=`

vec4 borderColor = vec4( borderColor, borderOpacity );

// This could be tweak to produce more smoothing
float mult = 1.0;

// Step 1 ----------------------------------------------
// Draw the four borders ( top - right - bottom - left )
// Without worrying about radiuses ( Straight boorders )

// Top
float topBorderUVy = 1.0 - borderWidth.x;
if( borderWidth.x > 0.0 && vUvB.y > topBorderUVy )
{

	float w = fwidth( 1.0 - vUvB.y ) * mult;
	float step = smoothstep( topBorderUVy , topBorderUVy + w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Left
float leftBorderUVx = borderWidth.w;
if( borderWidth.w > 0.0 && vUvB.x < leftBorderUVx )
{

	float w = fwidth( vUvB.x ) * mult ;
	float step = smoothstep( leftBorderUVx , leftBorderUVx - w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Bottom
float bottomBorderUVy = borderWidth.z;
if( borderWidth.z > 0.0 && vUvB.y < bottomBorderUVy )
{
	float w = fwidth( vUvB.y ) * mult;
	float step = smoothstep( bottomBorderUVy , bottomBorderUVy - w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );
}

// Right
float rightBorderUVx = 1.0 - borderWidth.y;
if( borderWidth.y > 0.0 && vUvB.x > rightBorderUVx )
{
	float w = fwidth( 1.0 - vUvB.x ) * mult;
	float step = smoothstep( rightBorderUVx , rightBorderUVx + w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );
}


// Step 2 ----------------------------------------------
// Process each corners ( topLeft, topRight, bottomRight, bottomLeft )
// To transparentize outside radiuses
// To draw ellipse border on the corner


// Top Left corner
if( vUvB.x < cornerTL.x && vUvB.y > cornerTL.y ) {

		// Only draw border if width is set
		if( borderWidth.w + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x - borderWidth.w,  ( 1.0 - cornerTL.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		// Then then radius
		float radiusFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x, 1.0 - cornerTL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Left
if( vUvB.x < cornerBL.x && vUvB.y < cornerBL.y ) {

		if( borderWidth.w + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x - borderWidth.w,  cornerBL.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}


		float radiusFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x, cornerBL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Top Right
if( vUvB.x > cornerTR.x && vUvB.y > cornerTR.y ) {

		if( borderWidth.y + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTR, ( 1.0 - cornerTR.x ) - borderWidth.y,  ( 1.0 - cornerTR.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerTR, 1.0 - cornerTR.x, 1.0 - cornerTR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Right
if( vUvB.x > cornerBR.x && vUvB.y < cornerBR.y ) {

		if( borderWidth.y + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBR, ( 1.0 - cornerBR.x ) - borderWidth.y,  cornerBR.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerBR, 1.0 - cornerBR.x, cornerBR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}

`,oO=Owe,Zwe=`

// To be removed - required for both border and background
uniform vec3 frameSize;
uniform vec2 textureSize;

`,aO=Zwe,Wwe=`

#ifdef USE_MAP

vec4 sampleTexture() {

	vec2 uv = vUv;

	// default stretch
	#if BACKGROUND_MAPPING != 0

	float textureRatio = textureSize.x / textureSize.y;
	float panelRatio = frameSize.x / frameSize.y;
	float ratio = panelRatio / textureRatio;
	float ratio2 = textureRatio / panelRatio;

		// contain
		#if BACKGROUND_MAPPING == 1
		if ( textureRatio < panelRatio ) { // repeat on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		} else { // repeat on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		}
		#else
		// cover
		if ( textureRatio < panelRatio ) { // stretch on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		} else { // stretch on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		}

		#endif

	#endif

	return texture2D( map, uv );

}
#endif
`,lO=Wwe,Hwe=`
#ifdef USE_MAP

	vec4 textureSample = sampleTexture();
	diffuseColor *= textureSample;

#endif
`,cO=Hwe,eie={msdfAlphaglyphParsVertexGlsl:J3,msdfAlphaglyphVertexGlsl:j3,msdfOffsetglyphVertexGlsl:q3,msdfAlphaglyphParsFragmentGlsl:$3,msdfAlphaglyphFragmentGlsl:eO,frameBorderParsVertexGlsl:nO,frameBorderVertexGlsl:sO,frameCommonParsFragmentGlsl:aO,frameBorderParsFragmentGlsl:rO,frameBorderFragmentGlsl:oO,frameBackgroundParsFragmentGlsl:lO,frameBackgroundFragmentGlsl:cO},Qwe=`
// Would be automatic on three materials and from USE_UV
#ifdef USE_MAP
varying vec2 vUv;
#endif

${nO}

#include <clipping_planes_pars_vertex>

void main() {

	#ifdef USE_MAP
	vUv = uv;
	#endif

	${sO}

	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;

	#include <clipping_planes_vertex>

}
`,Kwe=`

// Basic
uniform vec3 diffuse;
uniform float opacity;

#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif

${aO}

${rO}


#ifdef USE_MAP
varying vec2 vUv;
uniform sampler2D map;
#endif

${lO}

#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );

	// map
	${cO}

	${oO}

	#ifdef USE_ALPHATEST

	if ( diffuseColor.a < alphaTest ) discard;

	#endif

	// output
	gl_FragColor = diffuseColor;


	#include <clipping_planes_fragment>
}
`;class QL{static get mediation(){return Jwe}static ensureMaterialOptions(e){e.transparent=!0,e.alphaTest=e.alphaTest||.02}static ensureDefines(e){e.defines||(e.defines={})}static ensureUserData(e,t){e.userData.borderColor={value:null},e.userData.borderRadius={value:new it.Vector4(0,0,0,0)},e.userData.cornerTL={value:new it.Vector2(0,1)},e.userData.cornerTR={value:new it.Vector2(1,1)},e.userData.cornerBR={value:new it.Vector2(1,0)},e.userData.cornerBL={value:new it.Vector2(0,0)},e.userData.borderWidth={value:new it.Vector4(0,0,0,0)},e.userData.borderOpacity={value:null},e.userData.frameSize={value:new it.Vector3(1,1,1)},e.userData.textureSize={value:new it.Vector2(1,1)}}static bindUniformsWithUserData(e,t){e.uniforms.borderColor=t.userData.borderColor,e.uniforms.borderRadius=t.userData.borderRadius,e.uniforms.cornerTL=t.userData.cornerTL,e.uniforms.cornerTR=t.userData.cornerTR,e.uniforms.cornerBR=t.userData.cornerBR,e.uniforms.cornerBL=t.userData.cornerBL,e.uniforms.borderWidth=t.userData.borderWidth,e.uniforms.borderOpacity=t.userData.borderOpacity,e.uniforms.frameSize=t.userData.frameSize,e.uniforms.textureSize=t.userData.textureSize}static injectShaderChunks(e){QL.injectVertexShaderChunks(e),QL.injectFragmentShaderChunks(e)}static injectVertexShaderChunks(e){e.vertexShader=e.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+nO),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+sO)}static injectFragmentShaderChunks(e){e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+lO),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+rO),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+aO),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",cO),e.fragmentShader=e.fragmentShader.replace("#include <alphamap_fragment>",oO+`
#include <alphamap_fragment>`)}}const Ywe=function(s,e,t){t=["stretch","contain","cover"].indexOf(t),Qte(s,"BACKGROUND_MAPPING",t)},Jwe={clippingPlanes:{m:"clippingPlanes"},backgroundAlphaTest:{m:"alphaTest",t:jB},backgroundSide:{m:"side"},backgroundImage:{m:"map"},backgroundColor:{m:"color"},backgroundOpacity:{m:"opacity"},backgroundSize:{m:"computedBackgroundSize",t:Ywe},borderWidth:{m:"borderWidth",t:_c},borderColor:{m:"borderColor",t:_c},cornerTL:{m:"cornerTL",t:_c},cornerTR:{m:"cornerTR",t:_c},cornerBR:{m:"cornerBR",t:_c},cornerBL:{m:"cornerBL",t:_c},borderOpacity:{m:"borderOpacity",t:_c},size:{m:"frameSize",t:_c},tSize:{m:"textureSize",t:_c}};class tie extends it.ShaderMaterial{static get mediation(){return QL.mediation}constructor(){super({uniforms:{alphaTest:{value:.02},map:{value:null},diffuse:{value:new it.Color(16777215)},opacity:{value:1},borderColor:{value:new it.Color(0)},borderOpacity:{value:0},borderRadius:{value:new it.Vector4(0,0,0,0)},cornerTL:{value:new it.Vector2(0,1)},cornerTR:{value:new it.Vector2(1,1)},cornerBR:{value:new it.Vector2(1,0)},cornerBL:{value:new it.Vector2(0,0)},borderWidth:{value:new it.Vector4(0,0,0,0)},frameSize:{value:new it.Vector3(1,1,1)},textureSize:{value:new it.Vector2(1,1)}},side:it.FrontSide,transparent:!0,clipping:!0,vertexShader:Qwe,fragmentShader:Kwe,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0}set map(e){this.uniforms.map.value=e,e?this.defines.USE_UV===void 0&&(this.defines.USE_UV="",this.needsUpdate=!0):this.defines.USE_UV!==void 0&&(delete this.defines.USE_UV,this.needsUpdate=!0),this.needsUpdate=!0}get map(){return this.uniforms.map.value}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(e){this.uniforms.alphaTest.value=e}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get opacity(){return this.uniforms.opacity.value}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}}class jwe extends dn{constructor(){super("children",null,!1);p(this,"_sortOrder",(t,i)=>t._order._value<i._order._value?-1:t._order._value>i._order._value?1:this._uis.indexOf(t)<this._uis.indexOf(i)?-1:1);this._uis=[],this._boxes=[]}update(t,i){this._compute(t),t._layouter._needsUpdate=!0,t._renderOrder._needsUpdate=!0}process(t){this._compute(t),t._flexDirection._needsProcess=!0,t._layouter._needsProcess=!0,t._overflow._needsRender=!0}_compute(t){this._uis=t.children.filter(i=>i.visible&&i.isUI),this._boxes=this._uis.filter(i=>i.isBox).sort(this._sortOrder)}dispose(){this._uis=null,this._boxes=null}}class iie extends dn{constructor(){super("bounds",null,!1),this._size=new it.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0,this._centerX=.5,this._centerY=.5,this._needsProcess=!0}setReferenceWidth(e,t){const i=e._width,n=e._padding._value,r=e._borderWidth._value,o=e._margin._value,a=i._auto?1:i._value,l=t*a-(o.y+o.w);_V(l,this._offsetWidth)||(this._offsetWidth=l,this._innerWidth=this._offsetWidth-(n.y+n.w+r.y+r.w),this._centerX=Rk(e),this._propagateWidth(e),this._triggerCascadingDependencies(e))}setReferenceHeight(e,t){const i=e._height,n=e._padding._value,r=e._borderWidth._value,o=e._margin._value,a=i._auto?1:i._value,l=t*a-(o.x+o.z);_V(l,this._offsetHeight)||(this._offsetHeight=l,this._innerHeight=this._offsetHeight-(n.x+n.z+r.x+r.z),this._centerY=Lk(e),this._propagateHeight(e),this._triggerCascadingDependencies(e))}setChildrenWidth(e,t){const i=e._padding._value,n=e._borderWidth._value;this._innerWidth=t,this._offsetWidth=this._innerWidth+(i.y+i.w+n.y+n.w),this._centerX=Rk(e),this._propagateWidth(e),this._triggerCascadingDependencies(e)}setChildrenHeight(e,t){const i=e._padding._value,n=e._borderWidth._value;this._innerHeight=t,this._offsetHeight=this._innerHeight+(i.x+i.z+n.x+n.z),this._centerY=Lk(e),this._propagateHeight(e),this._triggerCascadingDependencies(e)}update(e,t){const i=e._padding._value,n=e._borderWidth._value,r=e._width;!r._auto&&!r._relative&&(e._boxSizing._value==="content-box"?(this._innerWidth=r._value,this._offsetWidth=this._innerWidth+i.y+i.w+n.y+n.w):(this._offsetWidth=r._value,this._innerWidth=this._offsetWidth-(i.y+i.w+n.y+n.w)),this._centerX=Rk(e),this._needsProcess=!0,this._propagateWidth(e),this._triggerCascadingDependencies(e));const o=e._height;!o._auto&&!o._relative&&(e._boxSizing._value==="content-box"?(this._innerHeight=o._value,this._offsetHeight=this._innerHeight+i.x+i.z+n.x+n.z):(this._offsetHeight=o._value,this._innerHeight=this._offsetHeight-(i.x+i.z+n.x+n.z)),this._centerY=Lk(e),this._needsProcess=!0,this._propagateHeight(e),this._triggerCascadingDependencies(e))}render(e){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight,e._backgroundMesh&&e._backgroundMesh.updateScale(),e._renderer._needsRender=!0}output(e){e.size=this._size}process(e){e._overflow._needsRender=!0}_computeChildrenSideWidth(e){return qwe(e)}_computeChildrenSideHeight(e){return $we(e)}_propagateWidth(e){for(let t=0;t<e._children._boxes.length;t++){const i=e._children._boxes[t];i._width._relative&&i._bounds.setReferenceWidth(i,this._innerWidth)}}_propagateHeight(e){for(let t=0;t<e._children._boxes.length;t++){const i=e._children._boxes[t];i._height._relative&&i._bounds.setReferenceHeight(i,this._innerHeight)}}_triggerCascadingDependencies(e){e._parent._value&&(e._parent._value._autoSize._needsProcess=!0),e._flexDirection._needsProcess=!0,e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0,this._needsRender=!0,e._borderWidth._needsRender=!0,e._borderRadius._needsRender=!0,e._overflow._needsRender=!0}}function Rk(s){const e=s._padding._value,t=s._borderWidth._value,i=e.w+t.w,n=e.y+t.y;return(i-n)/2}function Lk(s){const e=s._padding._value,t=s._borderWidth._value,i=e.x+t.x;return(e.z+t.z-i)/2}function qwe(s){return s._children._boxes.reduce((e,t)=>{const i=t._margin._value,n=t._bounds._offsetWidth+i.y+i.w;return e+n},0)}function $we(s){return s._children._boxes.reduce((e,t)=>{const i=t._margin._value,n=t._bounds._offsetHeight+i.x+i.z;return e+n},0)}class eSe extends H3{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._process=this.emptyStrategyLogic,this._childAlign=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,e._flexDirection._value){case"row":case"row-reverse":switch(this._process=oSe,this._value){case"start":this._childAlign=iSe;break;case"end":this._childAlign=tSe;break;default:this._childAlign=N9}break;case"column":case"column-reverse":switch(this._process=rSe,this._value){case"start":this._childAlign=sSe;break;case"end":this._childAlign=nSe;break;default:this._childAlign=N9}break}this._needsProcess=!0,e._autoSize._needsProcess=!0,e._flexDirection._needsProcess=!0,e._justifyContent._needsProcess=!0,this._needsProcess=!0,e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0}process(e){this._process(e,this._childAlign);let t="center",i="center",n="center";const r=e._padding._value,o=e._borderWidth._value;e._flexDirection._value.indexOf("column")!==-1?this._value==="start"?t=i="left":this._value==="end"?t=i="right":t="centerX":this._value==="start"?t=n="top":this._value==="end"?t=n="bottom":t="centerY";let a=-(r.x-r.z)/2-(o.x-o.z)/2,l=-(r.y-r.w)/2-(o.y-o.w)/2;i==="left"?l=(r.w-r.y)/2+(o.w-o.y)/2:i==="right"&&(l=-(r.y-r.w)/2-(o.y-o.w)/2),n==="top"?a=-(r.x-r.z)/2-(o.x-o.z)/2:n==="bottom"&&(a=(r.z-r.x)/2+(o.z-o.x)/2),e._children._boxes.forEach(c=>{let h=0,d=0;t==="top"?d=-c._margin._value.x:t==="bottom"?d=c._margin._value.z:t==="left"?h=c._margin._value.w:t==="right"?h=-c._margin._value.y:t==="centerX"?h=(c._margin._value.w-c._margin._value.y)/2:t==="centerY"&&(d=(-c._margin._value.x+c._margin._value.z)/2),e._layouter._childrenPos[c.id].x+=l+h,e._layouter._childrenPos[c.id].y+=a+d})}}function N9(){return 0}function tSe(s,e){return-e+s._bounds._offsetHeight/2}function iSe(s,e){return e-s._bounds._offsetHeight/2}function nSe(s,e){return e-s._bounds._offsetWidth/2}function sSe(s,e){return-e+s._bounds._offsetWidth/2}function rSe(s,e){const t=s._bounds._innerWidth/2;s._children._boxes.forEach(i=>{s._layouter._childrenPos[i.id].x=e(i,t)})}function oSe(s,e){const t=s._bounds._innerHeight/2;s._children._boxes.forEach(i=>{s._layouter._childrenPos[i.id].y=e(i,t)})}class aSe extends K3{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._offset=0,this._reverse=1,this._process=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,this._value){case"row":this._process=lSe;break;case"row-reverse":this._process=cSe;break;case"column":this._process=hSe;break;case"column-reverse":this._process=dSe;break}e._justifyContent._needsUpdate||e._justifyContent.computeOutputValue(e),e._alignItems._needsUpdate||e._alignItems.computeOutputValue(e),this._needsProcess=!0}process(e){switch(this._value){case"row":this._offset=-e._bounds._innerWidth/2;break;case"row-reverse":this._offset=e._bounds._innerWidth/2;break;case"column":this._offset=e._bounds._innerHeight/2;break;case"column-reverse":this._offset=-e._bounds._innerHeight/2;break}this._reverse=-Math.sign(this._offset),this._reverse===0&&(this._reverse=1),this._process(e),e._justifyContent._needsProcess=!0,e._layouter._needsProcess=!0}}function lSe(s){let e=s._flexDirection._offset;const t=s._flexDirection._reverse,i=s._children._boxes;for(let n=0;n<i.length;n++){const r=i[n],o=r.id,a=r._bounds._offsetWidth;e+=r._margin._value.w*t;const l=s._layouter._childrenPos[o];l.x=e+a/2*t,l.y=0,e+=t*(a+r._margin._value.y)}}function cSe(s){let e=s._flexDirection._offset;const t=s._flexDirection._reverse,i=s._children._boxes;for(let n=0;n<i.length;n++){const r=i[n],o=r.id,a=r._bounds._offsetWidth;e+=r._margin._value.y*t;const l=s._layouter._childrenPos[o];l.x=e+a/2*t,l.y=0,e+=(a+r._margin._value.w)*t}}function hSe(s){let e=s._flexDirection._offset;const t=s._flexDirection._reverse,i=s._children._boxes;for(let n=0;n<i.length;n++){const r=i[n],o=r.id,a=r._bounds._offsetHeight;e+=r._margin._value.x*t;const l=s._layouter._childrenPos[o];l.x=0,l.y=e+a/2*t,e+=(a+r._margin._value.z)*t}}function dSe(s){let e=s._flexDirection._offset;const t=s._flexDirection._reverse,i=s._children._boxes;for(let n=0;n<i.length;n++){const r=i[n],o=r.id,a=r._bounds._offsetHeight;e+=r._margin._value.z*t;const l=s._layouter._childrenPos[o];l.x=0,l.y=e+a/2*t,e+=(a+r._margin._value.x)*t}}class uSe extends Y3{constructor(e){super("justifyContent",e,!0),this._allowsInherit=!1,this._needsUpdate=!0,this._computeOffset=this.emptyStrategyLogic,this._computeMargin=this.emptyStrategyLogic,this._process=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,e._flexDirection._value){case"column-reverse":case"column":this._process=fSe.bind(this);break;case"row-reverse":case"row":this._process=pSe.bind(this);break}switch(this._value){case"end":this._computeOffset=ASe,this._computeMargin=Bk;break;case"center":this._computeOffset=ySe,this._computeMargin=Bk;break;case"start":this._computeOffset=pT,this._computeMargin=Bk;break;case"space-between":this._computeOffset=pT,this._computeMargin=bSe;break;case"space-around":this._computeOffset=pT,this._computeMargin=vSe;break;case"space-evenly":this._computeOffset=pT,this._computeMargin=xSe;break}e._flexDirection._needsProcess=!0}process(e){this._process(e),e._alignItems._needsProcess=!0}}function pSe(s){const e=s._flexDirection._offset,{usedDirectionSpace:t,remainingSpace:i}=mSe(s),n=e*2-t*Math.sign(e),r=this._computeOffset(n),o=this._computeMargin(s,i,s._flexDirection._reverse);s._children._boxes.forEach((a,l)=>{s._layouter._childrenPos[a.id].x-=r-o[l]})}function fSe(s){const e=s._flexDirection._offset,{usedDirectionSpace:t,remainingSpace:i}=gSe(s),n=e*2-t*Math.sign(e),r=this._computeOffset(n),o=this._computeMargin(s,i,s._flexDirection._reverse);s._children._boxes.forEach((a,l)=>{s._layouter._childrenPos[a.id].y-=r-o[l]})}function mSe(s){const e=s._bounds._computeChildrenSideWidth(s);return{usedDirectionSpace:e,remainingSpace:s._bounds._innerWidth-e}}function gSe(s){const e=s._bounds._computeChildrenSideHeight(s);return{usedDirectionSpace:e,remainingSpace:s._bounds._innerHeight-e}}function pT(s){return 0}function ASe(s){return s}function ySe(s){return s/2}function Bk(s,e=0,t=1){return Array(s._children._boxes.length).fill(0)}function bSe(s,e=0,t=1){const n=s._children._boxes.length,r=Array(n).fill(0);if(e>0&&n>1){const o=e/(n-1)*t;r[0]=0;for(let a=1;a<n;a++)r[a]=o*a}return r}function xSe(s,e=0,t=1){const n=s._children._boxes.length,r=Array(n).fill(0);if(e>0){const o=e/(n+1)*t;for(let a=0;a<n;a++)r[a]=o*(a+1)}return r}function vSe(s,e=0,t=1){const n=s._children._boxes.length,r=Array(n).fill(0);if(e>0){const o=e/n*t,a=o/2;r[0]=a;for(let l=1;l<n;l++)r[l]=a+o*l}return r}let Pk;class nie extends it.Mesh{constructor(e){const t=e.slice,i={};let n=1,r=1;if(t){if(n=t.width?t.width:1,r=t.height?t.height:1,t.top){if(t.left){const u=new it.PlaneGeometry(t.left*n,t.top*r,1,1);Cu(u,0,t.left,1-t.top,1),u.translate(t.left*n/2,-t.top*r/2,0),i.topLeft=u}const d=new it.PlaneGeometry(1,t.top*r,1,1);if(Cu(d,t.left,1-t.right,1-t.top,1),d.translate(0,-t.top*r/2,0),i.top=d,t.right){const u=new it.PlaneGeometry(t.right*n,t.top*r,1,1);Cu(u,1-t.right,1,1-t.top,1),u.translate(-t.right*n/2,-t.top*r/2,0),i.topRight=u}}if(t.left){const d=new it.PlaneGeometry(t.left*n,1,1,1);Cu(d,0,t.left,t.bottom,1-t.top),d.translate(t.left*n/2,0,0),i.left=d}const h=new it.PlaneGeometry(1,1,1,1);if(Cu(h,t.left,1-t.right,t.bottom,1-t.top),i.middle=h,t.right){const d=new it.PlaneGeometry(t.right*n,1,1,1);Cu(d,1-t.right,1,t.bottom,1-t.top),d.translate(-t.right*n/2,0,0),i.right=d}if(t.bottom){if(t.left){const u=new it.PlaneGeometry(t.left*n,t.bottom*r,1,1);Cu(u,0,t.left,0,t.bottom),u.translate(t.left*n/2,t.bottom*r/2,0),i.bottomLeft=u}const d=new it.PlaneGeometry(1,t.bottom*r,1,1);if(Cu(d,t.left,1-t.right,0,t.bottom),d.translate(0,t.bottom*r/2,0),i.bottom=d,t.right){const u=new it.PlaneGeometry(t.right*n,t.bottom*r,1,1);Cu(u,1-t.right,1,0,t.bottom),u.translate(-t.right*n/2,t.bottom*r/2,0),i.bottomRight=u}}}let o=e.backgroundMaterial;t&&(Pk||(Pk=new it.MeshBasicMaterial({alphaTest:1.1})),o=Pk);const a=new it.PlaneGeometry(1,1,e._segments.value,e._segments.value),l=new it.BufferAttribute(new Float32Array(a.getAttribute("uv").array),2);if(a.setAttribute("uvB",l).name="uvB",super(a,o),this.name="UIBackgroundBox",t){this.slice=t,this.sliceSize=new it.Vector3(1-(t.left+t.right),1-(t.bottom+t.top),1),this.sliceScale=new it.Vector3(n,r,1);for(const c in i){const h=new it.Mesh(i[c],e.backgroundMaterial);this.add(h),i[c]=h}this.updateScale=this.updateScaleSlice,this.slices=i}}updateScale(){}updateScaleSlice(){const e=new it.Vector3(1,1,1);this.scale.x<(this.slice.left+this.slice.right)*this.sliceScale.x&&(e.x=this.scale.x/((this.slice.left+this.slice.right)*this.sliceScale.x)),this.scale.y<(this.slice.bottom+this.slice.top)*this.sliceScale.y&&(e.y=this.scale.y/((this.slice.bottom+this.slice.top)*this.sliceScale.y));for(const t in this.slices){const i=this.slices[t];i.scale.set(1/this.scale.x,1/this.scale.y,this.scale.y);const n=_Se[t];for(const o in n)i.position[o]=this.scale[o]*n[o]*i.scale[o];const r=CSe[t];if(r){r.x&&(i.position.x=this.sliceScale.x*.5*(this.slice.left-this.slice.right)*(1/this.scale.x)),r.y&&(i.position.y=this.sliceScale.y*.5*(this.slice.bottom-this.slice.top)*(1/this.scale.y));for(const o in r){const a=this.scale[o]-(1-this.sliceSize[o])*this.sliceScale[o];i.scale[o]=Math.max(0,a*(1/this.scale[o]))}}}e.x!==1&&(this.slices.left.scale.x*=e.x,this.slices.topLeft.scale.x*=e.x,this.slices.bottomLeft.scale.x*=e.x,this.slices.right.scale.x*=e.x,this.slices.topRight.scale.x*=e.x,this.slices.bottomRight.scale.x*=e.x),e.y!==1&&(this.slices.top.scale.y*=e.y,this.slices.topLeft.scale.y*=e.y,this.slices.topRight.scale.y*=e.y,this.slices.bottom.scale.y*=e.y,this.slices.bottomLeft.scale.y*=e.y,this.slices.bottomRight.scale.y*=e.y)}}const _Se={topLeft:{x:-.5,y:.5},top:{y:.5},topRight:{x:.5,y:.5},left:{x:-.5},right:{x:.5},bottomLeft:{x:-.5,y:-.5},bottom:{y:-.5},bottomRight:{x:.5,y:-.5}},CSe={top:{x:1},left:{y:1},right:{y:1},bottom:{x:1},middle:{x:1,y:1}};function Cu(s,e,t,i,n){const r=t-e,o=n-i,a=s.attributes.uv;for(let c=0;c<a.count;c++){const h=a.getX(c),d=a.getY(c);a.setXY(c,e+h*r,i+d*o)}const l=new it.BufferAttribute(new Float32Array(s.getAttribute("uv").array),2);s.setAttribute("uvB",l).name="uvB"}class sie extends dn{constructor(){super("renderer")}render(e){e._backgroundMesh||e.setBackgroundMesh(new nie(e)),e.performAfterUpdate()}}class wSe extends Ute{constructor(){super("position")}update(e,t){super.update(e,t),this._needsProcess=!0}}class SSe extends dn{constructor(){super("autosize"),this._needsProcess=!0}process(e){e._width._auto&&MSe(e),e._height._auto&&ISe(e);const t=e._alignItems._value==="stretch",i=t&&e._flexDirection._value.indexOf("column")!==-1,n=t&&!i;for(const r of e._children._boxes)(r._width._auto&&i||r._width._relative)&&r._bounds.setReferenceWidth(r,e._bounds._innerWidth),(r._height._auto&&n||r._height._relative)&&r._bounds.setReferenceHeight(r,e._bounds._innerHeight)}}function MSe(s){s._bounds.setChildrenWidth(s,ESe(s))}function ISe(s){s._bounds.setChildrenHeight(s,TSe(s))}function TSe(s){switch(s._flexDirection._value){case"row":case"row-reverse":return PSe(s);case"column":case"column-reverse":return LSe(s)}}function ESe(s){switch(s._flexDirection._value){case"row":case"row-reverse":return RSe(s);case"column":case"column-reverse":return BSe(s)}}function RSe(s){let e=0;for(const t of s._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,n=t._bounds._offsetWidth+i.y+i.w;e+=n}return e}function LSe(s){let e=0;for(const t of s._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,n=t._bounds._offsetHeight+i.x+i.z;e+=n}return e}function BSe(s){let e=0;for(const t of s._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,n=t._bounds._offsetWidth+i.y+i.w;n>e&&(e=n)}return e}function PSe(s){let e=0;for(const t of s._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,n=t._bounds._offsetHeight+i.x+i.z;n>e&&(e=n)}return e}class nS extends j1{constructor(e,t){nS.definePropertiesValues(e,t),super(e,t),nS.init(this)}bindBackgroundMeshProperties(){this._bounds._size=this._backgroundMesh.scale,this._bounds._needsProcess=!0}unbindBackgroundMeshProperties(){this._bounds._size=new it.Vector3(1,1,1),this._bounds._needsProcess=!0}static definePropertiesValues(e,t){e.children||(e.children=jwe),e.bounds||(e.bounds=iie),e.flexDirection||(e.flexDirection=aSe),e.justifyContent||(e.justifyContent=uSe),e.alignItems||(e.alignItems=eSe),e.position||(e.position=wSe),e.autoSize||(e.autoSize=SSe),e.renderer||(e.renderer=sie),t.fontSide||(t.fontSide=0),t.invertAlpha||(t.invertAlpha=!1),t.fontCastShadow||(t.fontCastShadow=!1),t.fontReceiveShadow||(t.fontReceiveShadow=!1),t.backgroundCastShadow||(t.backgroundCastShadow=!1),t.backgroundReceiveShadow||(t.backgroundReceiveShadow=!1)}static init(e){Object.defineProperties(e,{isBox:{configurable:!1,enumerable:!0,value:!0}}),e.backgroundMaterial=new tie,e._renderer.render(e),e._backgroundMesh.visible=!1}}let D9=class extends Array{constructor(...e){super(...e),this.width=0,this.lineBase=0,this.lineHeight=0,this.y=0}};class GSe extends dn{constructor(){super("layouter",null,!1),this._needsUpdate=!0,this._childrenPos={}}update(e,t){this._childrenPos={};for(const i of e._children._boxes)i._position._value==="static"&&(this._childrenPos[i.id]=i.position)}process(e){}}class sS extends nS{constructor(e={}){const t={};sS.definePropertiesValues(t,e),super(t,e),sS.init(this)}add(e){const t=[];for(let i=0;i<arguments.length;i++){const n=arguments[i];!n.isUI||n.isBox?t.push(n):console.warn("Block element can only contain Box elements.",n)}return super.add(...t)}static definePropertiesValues(e,t){e.layouter=GSe}static init(e){Object.defineProperties(e,{isBlock:{configurable:!1,enumerable:!0,value:!0}})}}class kSe extends dn{constructor(){super("textContent",null,!1)}update(e,t){e._glyphs._needsUpdate=!0,e._whiteSpace._needsProcess=!0}}class NSe extends dn{constructor(){super("inlines",null,!1),this._value=null}process(e){if(this._value=e._glyphs._value.map(t=>t.asInlineGlyph()),this._value.length){this._value[0].paddingLeft=e._padding._value.w,this._value[0].marginLeft=e._margin._value.w;const t=this._value.length-1;this._value[t].paddingRight=e._padding._value.y,this._value[t].marginRight=e._margin._value.y}e._fontSize._needsProcess=!0,e._lineBreak._needsProcess=!0,e._fontKerning._needsProcess=!0,e._layouter._needsProcess=!0}get value(){return this._value}}class DSe extends dn{constructor(){super("glyphs",null,!1),this._needsUpdate=!1,this._value=null}process(e){e._font._fontVariant&&e._font._fontVariant.isReady&&(this._value=e._whiteSpace._whiteSpacedContent.split("").map(t=>e._font._fontVariant.getTypographicGlyph(t)),this._value&&(e._inlines._needsProcess=!0))}get value(){return this._value}}class FSe extends iS{constructor(){super("color","inherit",!1),this.output=this._outputValue}computeOutputValue(e){this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._value.set(this._input)}}class rie extends dn{constructor(e=`- ,.:?!
`){super("lineBreak",e,!0),this._newLineBreakability=null}update(e,t){this._needsProcess=!0}process(e){const t=e._whiteSpace._newLineBreakability;if(e._inlines._value)for(let i=0;i<e._inlines._value.length;i++){const n=e._inlines._value[i],r=n.char;let o=null;r!==void 0&&(t!=="nowrap"&&(this._value.includes(r)||r.match(/\s/g))&&(o="possible"),r.match(/\n/g)&&(o=t)),n.lineBreak=o}}get value(){return this._value}}class oie extends dn{constructor(){super("layouter",null,!1),this._value=null}update(e,t){this._value=e._parent.find(i=>i.isUI&&i.isText),this._needsProcess=!0}process(e){this._value&&(this._value._layouter._needsProcess=!0)}}class VSe extends iS{constructor(e){super("backgroundColor",e,!1),this._allowsInherit=!1,this._input=0}computeOutputValue(e){this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._value.set(this._input)}}class aie extends Zte{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class lie extends Wte{constructor(){super()}computeOutputValue(e){this._value=W3(this.getInheritedInput(e))}}class cie extends Yte{constructor(){super("fontFamily","inherit",!0),this._input="inherit",this._needsUpdate=!0,this._allowsInherit=!1}computeOutputValue(e){let t=this._inheritedInput;if(t==="inherit"&&(t=this.getInheritedInput(e)),t instanceof qB)this._value=t,e._font._needsUpdate=!0;else if(typeof t=="string"){const i=j0.getFontFamily(t);i?(this._value=i,e._font._needsUpdate=!0):console.warn(`(.style) fontFamily, the font '${t}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}}class hO extends jte{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited,this._whiteSpacedContent="",this._stringCollapser=this.emptyStrategyLogic,this._inlineCollapser=this.emptyStrategyLogic,this._inlineWrapper=this.emptyStrategyLogic}_computeFromInherited(e){switch(super._computeFromInherited(e),this._newLineBreakability=zSe(this._value),this._value){case"nowrap":case"normal":this._stringCollapser=USe;break;case"pre-line":this._stringCollapser=hie;break;default:this._stringCollapser=XSe}switch(this._value){case"pre-line":case"nowrap":case"normal":this._inlineCollapser=QSe;break;case"pre-wrap":this._inlineCollapser=HSe;break;default:this._inlineCollapser=KSe}switch(this._value){case"pre-line":case"pre-wrap":case"normal":this._inlineWrapper=OSe;break;case"pre":this._inlineWrapper=ZSe;break;default:this._inlineWrapper=WSe}this._needsProcess=!0}process(e){e.isInline&&!e.isInlineBlock&&(this._whiteSpacedContent=this._stringCollapser(e._textContent._value),e._glyphs._needsProcess=!0)}}const F9={"	":"	","\n":`
`,"\r":"\r"," ":" "},zSe=function(s){switch(s){case"pre":case"pre-wrap":case"pre-line":return"mandatory"}return null};function USe(s){return hie(s.replace(/\n/g," "))}function hie(s){return s.replace(/[ ]{2,}/g," ")}function XSe(s){return s}function OSe(s,e,t,i){const n=s[e];if(n.lineBreak==="mandatory"||t+n.xadvance+n.xoffset+n.kerning>i.INNER_WIDTH)return!0;const r=pie(s,e,i);return YSe(s[e-1],t,r,i)}function ZSe(s,e,t,i){return s[e].lineBreak==="mandatory"}function WSe(){return!1}function HSe(s){if(!s[0])return 0;const e=s[0],t=s[s.length-1];return e.char&&e.char===`
`&&s.length>1&&uie([e],s[1]),t.char&&t.char===`
`&&s.length>1&&die([t],s[s.length-2]),e.offsetX}function QSe(s){if(!s[0])return 0;let e=[],t;for(let i=0;i<s.length;i++){const n=s[i];if(n.char&&F9[n.char]&&s.length>i){e.push(n),t=s[i+1];continue}break}uie(e,t),e=[],t=null;for(let i=s.length-1;i>0;i--){const n=s[i];if(n.char&&F9[n.char]&&i>0){e.push(n),t=s[i-1];continue}break}return die(e,t),s[0].offsetX}function KSe(s){return s[0]?s[0].offsetX:0}function die(s,e){if(e)for(let t=0;t<s.length;t++){const i=s[t];i.fontFactor=0,i.offsetX=e.offsetX+e.cumulativeWidth,i.cumulativeWidth=0}}function uie(s,e){if(e)for(let t=0;t<s.length;t++){const i=s[t];i.fontFactor=0,i.offsetX=e.offsetX,i.cumulativeWidth=0}}function pie(s,e,t,i){if(i=i||0,!s[e])return i;const n=s[e];return n.lineBreak?i+n.xadvance:pie(s,e+1,t,i+n.xadvance+n.xoffset+n.kerning+t.LETTERSPACING)}function YSe(s,e,t,i){return!s||!s.char||e+t<i.INNER_WIDTH?!1:i.BREAKON.indexOf(s.char)>-1}class fie extends qte{constructor(){super(),this._input="inherit",this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e),e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0}}class mie extends ss{constructor(){super("fontSize","inherit",!0),this._allowsInherit=!1}computeOutputValue(e){this._value=this._inheritedInput,e._font._fontVariant&&(e._bounds._needsProcess=!0,e._layouter._needsProcess=!0)}process(e){if(!e._font._fontVariant||!e._font._fontVariant.isReady)return;const t=this._value/e._font._fontVariant.typographic.size,i=e._inlines._value;for(let n=0;n<i.length;n++){const r=i[n];r.resetOffsets(),r.fontSize=this._value,r.fontFactor=t}}get value(){return this._value}}class gie extends $te{constructor(){super("segments",1,!1),this._notInheritedValue=void 0}update(e,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(e)),e._layouter._needsUpdate=!0}set value(e){this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class JSe extends gie{constructor(){super(),this._value="inherit"}}class jSe extends $B{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e),e._parent._value._layouter._needsProcess=!1}process(e){if(this._value!=="none"){const t=e._whiteSpace._whiteSpacedContent,i=e._inlines._value;for(let n=1;n<i.length;n++){const r=t[n-1]+t[n];i[n].kerning=e._font._fontVariant.getKerningAmount(r)}}}}class Aie extends dn{constructor(){super("children",null,!1),this._uis=[]}update(e,t){}process(e){}_compute(e){}dispose(){}}function qSe(s,e=!1){const t=s[0].index!==null,i=new Set(Object.keys(s[0].attributes)),n=new Set(Object.keys(s[0].morphAttributes)),r={},o={},a=s[0].morphTargetsRelative,l=new it.BufferGeometry;let c=0;for(let h=0;h<s.length;++h){const d=s[h];let u=0;if(t!==(d.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const f in d.attributes){if(!i.has(f))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.'),null;r[f]===void 0&&(r[f]=[]),r[f].push(d.attributes[f]),u++}if(u!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(a!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const f in d.morphAttributes){if(!n.has(f))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;o[f]===void 0&&(o[f]=[]),o[f].push(d.morphAttributes[f])}if(e){let f;if(t)f=d.index.count;else if(d.attributes.position!==void 0)f=d.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,f,h),c+=f}}if(t){let h=0;const d=[];for(let u=0;u<s.length;++u){const f=s[u].index;for(let m=0;m<f.count;++m)d.push(f.getX(m)+h);h+=s[u].attributes.position.count}l.setIndex(d)}for(const h in r){const d=V9(r[h]);if(!d)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+h+" attribute."),null;l.setAttribute(h,d)}for(const h in o){const d=o[h][0].length;if(d===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[h]=[];for(let u=0;u<d;++u){const f=[];for(let g=0;g<o[h].length;++g)f.push(o[h][g][u]);const m=V9(f);if(!m)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+h+" morphAttribute."),null;l.morphAttributes[h].push(m)}}return l}function V9(s){let e,t,i,n=-1,r=0;for(let c=0;c<s.length;++c){const h=s[c];if(e===void 0&&(e=h.array.constructor),e!==h.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=h.itemSize),t!==h.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=h.normalized),i!==h.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(n===-1&&(n=h.gpuType),n!==h.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;r+=h.count*t}const o=new e(r),a=new it.BufferAttribute(o,t,i);let l=0;for(let c=0;c<s.length;++c){const h=s[c];if(h.isInterleavedBufferAttribute){const d=l/t;for(let u=0,f=h.count;u<f;u++)for(let m=0;m<t;m++){const g=h.getComponent(u,m);a.setComponent(u+d,m,g)}}else o.set(h.array,l);l+=h.count*t}return n!==void 0&&(a.gpuType=n),a}class $Se extends dn{constructor(){super("renderer")}render(e){if(!e._inlines._value||!e._inlines._value.length)return;const t=e._inlines._value.map(n=>e._font._fontVariant.getGeometricGlyph(n,e).translate(n.offsetX,n.offsetY,0)),i=qSe(t);e.setFontMesh(new it.Mesh(i,e.fontMaterial)),e._fontMesh.renderOrder=1/0}}class e1e extends Q3{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!1}computeOutputValue(e){this._value=this._inheritedInput,e._layouter._needsProcess=!0}}class _x extends j1{constructor(t={}){const i={};_x.definePropertiesValues(i,t);super(i,t);p(this,"_rebuildParentUI",()=>{super._rebuildParentUI(),this._layouter._needsUpdate=!0});_x.init(this)}add(t){const i=[];for(let n=0;n<arguments.length;n++){const r=arguments[n];!r.isUI||r.isInline?(i.push(r),r.position.z=.005):console.warn("Block element can only contain Box elements.",r)}return super.add(...i)}set textContent(t){this._textContent.value=t}get textContent(){return this._textContent._value}set invertAlpha(t){this._invertAlpha.value=t}get invertAlpha(){return this._invertAlpha._value}static definePropertiesValues(t,i){t.children||(t.children=Aie),t.textContent||(t.textContent=kSe),t.glyphs||(t.glyphs=DSe),t.inlines||(t.inlines=NSe),t.layouter||(t.layouter=oie),t.renderer||(t.renderer=$Se),t.fontFamily||(t.fontFamily=cie),t.fontWeight||(t.fontWeight=lie),t.fontStyle||(t.fontStyle=aie),t.fontSize||(t.fontSize=mie),t.color||(t.color=FSe),t.backgroundColor||(t.backgroundColor=VSe),t.lineBreak||(t.lineBreak=rie),t.letterSpacing||(t.letterSpacing=fie),t.whiteSpace||(t.whiteSpace=hO),t.segments||(t.segments=JSe),t.textAlign||(t.textAlign=e1e),t.fontKerning||(t.fontKerning=jSe)}static init(t){Object.defineProperties(t,{isInline:{configurable:!1,enumerable:!0,value:!0}})}}class t1e extends Ote{constructor(){super("textContent",null,!1),this._needsUpdate=!1}set value(e){this._value!==e&&(this._value=e,this._needsUpdate=!0)}update(e,t){this._needsUpdate=!1;for(let i=e.children.length-1;i>=0;i--){const n=e.children[i];n.isUI&&(e.remove(n),n.clear())}e._children._uis=[],this._value&&e.add(new _x({name:"anonymousInline",textContent:this._value}))}}class i1e extends Array{constructor(...e){super(...e),this.width=0,this.height=0}}class n1e extends dn{constructor(){super("layouter",null,!1),this._value=null}update(e,t){}process(e){let t=e._width._value;e._width._auto?t=1/0:t=e._bounds._innerWidth;const i=e._lineHeight._value,n=new i1e(new D9);let r=0;e._children._inlines.forEach(d=>{if(!d._inlines.value)return;this._resetInlines(d);const u=d._fontSize._value,f=d._letterSpacing._value*u,m=d._whiteSpace._value,g=d._lineBreak._value,A={WHITESPACE:m,LETTERSPACING:f,BREAKON:g,INNER_WIDTH:t},y=d._whiteSpace._inlineWrapper;r+=d._margin._value.w+d._padding._value.w,d._inlines.value.forEach((b,x,v)=>{const _=n[n.length-1];if(y(v,x,r,A)){if(n.push(new D9(b)),b.offsetX=b.xoffset,b.width===0){r=0;return}b.cumulativeWidth=b.xadvance+f,r=b.cumulativeWidth;return}n[n.length-1].push(b),b.offsetX=r+b.xoffset+b.kerning,b.cumulativeWidth=b.xadvance+b.kerning+f,r+=b.cumulativeWidth,_.length-1===1&&_[_.length-2].width===0&&(b.offsetX-=b.xoffset,r-=b.xoffset)}),r+=d._margin._value.y+d._padding._value.y});const o=e._whiteSpace._inlineCollapser;let a=0,l=0,c=0;n.forEach((d,u)=>{const f=o(d);let m=0,g=0;if(d.forEach(A=>{m=Math.max(m,A.lineHeight),g=Math.max(g,A.lineBase),A.offsetX-=f}),d.lineHeight=m,d.lineBase=g,u===0?c=-(m*i-m)*.5:c-=n[u-1].lineHeight*i,d.y=c,d.x=0,d.forEach(A=>{A.offsetY=c-A.anchor,A.lineHeight<d.lineHeight&&(A.offsetY-=d.lineBase-A.lineBase)}),l+=d.lineHeight*i,d.width=0,d[0]){const A=d[d.length-1];d.width=A.offsetX+A.cumulativeWidth+A.paddingRight+A.marginRight+d[0].offsetX,a=Math.max(a,d.width)}}),n.height=l,n.width=a,this._value=n,t===1/0&&e._bounds.setChildrenWidth(e,n.width),e._height._auto&&e._bounds.setChildrenHeight(e,n.height);const h=e._parent._value;h&&(h._autoSize._needsProcess=!0,h._flexDirection._needsProcess=!0),e._inlineJustificator._needsProcess=!0,e._textAlign._needsProcess=!0,e._overflow._needsUpdate=!0}_resetInlines(e){e._fontSize.process(e)}}class s1e extends Q3{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(e){this._value=this._inheritedInput,this._needsProcess=!0}process(e){r1e(e),e._renderer._needsRender=!0}}function r1e(s){const e=s._layouter._value,t=s._textAlign._value,i=s._bounds._innerWidth;for(let n=0;n<e.length;n++){const r=e[n],o=o1e(s,r,n===e.length-1),a=s._padding._value,l=s._borderWidth._value,c=(-a.w+a.y)/2+(-l.w+l.y)/2;r.x+=o;for(let h=0;h<r.length;h++)r[h].offsetX+=o-c}if(t.indexOf("justify")===0)for(let n=0;n<e.length;n++){const r=e[n];if(t.indexOf("-")!==-1&&n===e.length-1)return;const o=i-r.width;if(o<=0)return;let a=0;for(let d=1;d<r.length-1;d++)a+=r[d].char===" "?1:0;const l=o/a;let c=1;t==="justify-right"&&(r.reverse(),c=-1);let h=0;for(let d=1;d<=r.length-1;d++){const u=r[d];u.offsetX+=h*c,h+=u.char===" "?l:0}t==="justify-right"&&r.reverse()}}function o1e(s,e,t){switch(s._textAlign._value){case"justify-left":case"justify":case"left":return-s._bounds._innerWidth/2;case"justify-right":case"right":return-e.width+s._bounds._innerWidth/2;case"center":return-e.width/2;case"justify-center":return t?-e.width/2:-s._bounds._innerWidth/2;default:console.warn(`textAlign: '${s._textAlign._value}' is not valid`)}}class a1e extends K3{constructor(){super(),this._value=this._input="column",this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(e){this._value=this._inheritedInput}}class l1e extends Jte{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class c1e extends $B{constructor(){super(),this._value=this._input=this.getDefaultValue(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e)}}class h1e extends iie{constructor(){super(),this._innerWidth=1/0,this._innerHeight=0}}class d1e extends dn{constructor(){super("children",null,!1);p(this,"_sortOrder",(t,i)=>t._order._value<i._order._value?-1:t._order._value>i._order._value?1:this._uis.indexOf(t)<this._uis.indexOf(i)?-1:1);this._uis=[],this._inlines=[],this._boxes=[]}update(t,i){this._compute(t),this._needsProcess=!0}process(t){this._compute(t),t._overflow._needsRender=!0}_compute(t){this._uis=t.children.filter(i=>i.visible&&i.isUI),this._inlines=this._uis.filter(i=>i.isInline).sort(this._sortOrder)}dispose(){this._inlines=null}}class u1e extends dn{constructor(){super("autosize")}process(e){if(e._layouter._value&&e._layouter._value.length){const t=e._layouter._value,i=e._padding._value,n=e._borderWidth._value;e._width._auto&&e._bounds.setOffsetWidth(e,t.width+i.w+i.y+n.w+n.y),e._height._auto&&e._bounds.setOffsetHeight(e,t.height+i.x+i.z+n.x+n.z)}}}class p1e extends sie{constructor(){super("renderer"),this._needsUpdate=!1}render(e){super.render(e);for(const t of e._children._inlines)t._renderer.render(t);e.performAfterUpdate()}}class rS extends nS{constructor(e={},t={}){rS.definePropertiesValues(t,e),super(t,e),rS.init(this)}add(e){const t=[];let i=!1;for(let n=0;n<arguments.length;n++){const r=arguments[n];!r.isUI||r.isInline?(r.isInline&&(i=!0),t.push(r)):console.warn("Block element can only contain Box elements.",r)}return t.length>0&&super.add(...t),i&&(this._children._needsUpdate=!0,this._layouter._needsProcess=!0),this}set textContent(e){this._textContent.value=e}get textContent(){return super.textContent}set invertAlpha(e){this._invertAlpha.value=e}get invertAlpha(){return this._invertAlpha._value}get lines(){return this._layouter._value}static definePropertiesValues(e,t){e.flexDirection=a1e,e.justifyContent=Y3,e.alignItems=H3,e.bounds=h1e,e.autoSize=u1e,e.renderer=p1e,e.children||(e.children=d1e),e.textContent||(e.textContent=t1e),e.layouter||(e.layouter=n1e),e.lineHeight||(e.lineHeight=l1e),e.textAlign||(e.textAlign=s1e),e.whiteSpace||(e.whiteSpace=hO),e.fontKerning||(e.fontKerning=c1e),e.segments||(e.segments=gie),t.width||(t.width="100%"),t.fontSide||(t.fontSide=0)}static init(e){Object.defineProperties(e,{isText:{configurable:!1,enumerable:!0,value:!0}})}}class f1e extends dn{constructor(){super("inlines",null,!1),this._value=[]}process(e){this._value[0].paddingLeft=e._padding._value.w,this._value[0].marginLeft=e._margin._value.w;const t=this._value.length-1;this._value[t].paddingRight=e._padding._value.y,this._value[t].marginRight=e._margin._value.y}}class m1e extends dn{constructor(){super("renderer")}render(e){e._backgroundMesh||e.setBackgroundMesh(new nie(e)),e._backgroundMesh.position.x=e._inlines._value[0].offsetX+e._inlines._value[0].width/2,e._backgroundMesh.position.y=e._inlines._value[0].offsetY+e._inlines._value[0].lineBase/2,e._bounds.render(e)}}class g1e extends dn{constructor(){super("bounds",null,!1),this._size=new it.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0}update(e,t){this.output(t),this._needsProcess=!0}process(e){this._offsetWidth=this._innerWidth=e._inlines._value[0].width,this._offsetHeight=this._innerHeight=e._inlines._value[0].height,this._needsRender=!0,e._borderWidth._needsRender=!0,e._borderRadius._needsRender=!0}render(e){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight}output(e){e.size=this._size}}class oS extends j1{constructor(e={}){const t={};oS.definePropertiesValues(t,e),super(t,e),oS.init(this)}clear(){for(const e of this._inlines._value)e.clear();return super.clear()}bindBackgroundMeshProperties(){this._backgroundMesh.raycast=()=>{},this._bounds._size=this._backgroundMesh.scale,this._bounds._needsUpdate=!0}unbindBackgroundMeshProperties(){this._bounds._size=new it.Vector3(1,1,1),this._bounds._needsUpdate=!0}add(e){const t=[];for(let i=0;i<arguments.length;i++){const n=arguments[i];n.isUI?console.warn("ThreeMeshUI::InlineBlockElement cannot contains UI Elements.",n):(t.push(n),n.position.z=.005)}return super.add(...t)}static definePropertiesValues(e,t){e.children||(e.children=Aie),e.bounds||(e.bounds=g1e),e.inlines||(e.inlines=f1e),e.layouter||(e.layouter=oie),e.renderer||(e.renderer=m1e),e.fontFamily||(e.fontFamily=cie),e.fontWeight||(e.fontWeight=lie),e.fontStyle||(e.fontStyle=aie),e.fontSize||(e.fontSize=mie),e.backgroundColor||(e.backgroundColor=zte),e.lineBreak||(e.lineBreak=rie),e.letterSpacing||(e.letterSpacing=fie),e.whiteSpace||(e.whiteSpace=hO),e.fontKerning||(e.fontKerning=$B),t.backgroundSize||(t.backgroundSize="cover"),t.width||(t.width="100%"),t.height||(t.height="100%"),t.boxSizing||(t.boxSizing="border-box")}static init(e){Object.defineProperties(e,{isInline:{configurable:!1,enumerable:!0,value:!0},isInlineBlock:{configurable:!1,enumerable:!0,value:!0}}),e._inlines._value=[new A1e(e)],e.backgroundMaterial=new tie,e._renderer.render(e)}}class A1e extends kte{constructor(e){super(),this._uiElement=e}get xadvance(){const e=this._uiElement._padding._value,t=this._uiElement._width;return t._relative?t._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.w+e.y+t.value}get width(){const e=this._uiElement._width;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get height(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get anchor(){return this.height}get lineHeight(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get lineBase(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}clear(){this._uiElement=null}}class yie{constructor(e){this._subject=e}attach(){console.error(`Behavior::attach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}act(){throw new Error(`Behavior::act() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}detach(){console.error(`Behavior::detach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}clear(){}}const bie=()=>HL.update(),xie={BaseProperty:dn,Block:sS,Text:rS,Inline:_x,InlineBlock:oS,MeshUIBaseElement:j1,FontLibrary:j0,update:bie,MSDFFontMaterialUtils:Tc,ShaderChunkUI:eie,Behavior:yie,FontVariant:J1};typeof global<"u"&&(global.ThreeMeshUI=xie);const y1e=xie;var b1e=ar.ti,vie=ar.nS,dO=ar.eB,x1e=ar.Yp,CV=ar.VB,v1e=ar.BC,_1e=ar.zN,_R=ar.cV,C1e=ar.hW,w1e=ar.k2,S1e=ar.K6,M1e=ar.M7,I1e=ar.ls,T1e=ar.Hi,uO=ar.EY,E1e=ar.MR,R1e=ar.zf,Mn=ar.Ay,_ie=ar.yo;const z9=Object.freeze(Object.defineProperty({__proto__:null,BaseProperty:b1e,Behavior:vie,Block:dO,DefaultValues:x1e,FontLibrary:CV,FontVariant:v1e,InheritableProperty:_1e,Inline:_R,InlineBlock:C1e,InlineGlyph:w1e,MSDFFontMaterialUtils:S1e,MaterialTransformers:M1e,MeshUIBaseElement:I1e,ShaderChunkUI:T1e,Text:uO,TypographicFont:E1e,TypographicGlyph:R1e,default:Mn,update:_ie},Symbol.toStringTag,{value:"Module"}));class L1e{constructor(){p(this,"Rad2Deg",180/Math.PI);p(this,"Deg2Rad",Math.PI/180);p(this,"Epsilon",1e-5)}random(e,t){return Array.isArray(e)?e.length<=0?null:e[Math.floor(Math.random()*e.length)]:e!==void 0&&t!==void 0?Math.random()*(t-e)+e:Math.random()}randomVector3(e,t=0,i=1){e.x=this.random(t,i),e.y=this.random(t,i),e.z=this.random(t,i)}clamp(e,t,i){return e<t?t:e>i?i:e}clamp01(e){return this.clamp(e,0,1)}lerp(e,t,i){return i=i<0?0:i,i=i>1?1:i,e+(t-e)*i}inverseLerp(e,t,i){return(i-e)/(t-e)}remap(e,t,i,n,r){return n+(r-n)*(e-t)/(i-t)}moveTowards(e,t,i){return e+=i,(i<0&&e<t||i>0&&e>t)&&(e=t),e}toDegrees(e){return e*180/Math.PI}toRadians(e){return e*Math.PI/180}tan(e){return Math.tan(e)}gammaToLinear(e){return Math.pow(e,2.2)}linearToGamma(e){return Math.pow(e,1/2.2)}approximately(e,t,i=Number.EPSILON){for(const n of B1e){const r=e[n],o=t[n];if(r===void 0||o===void 0)break;if(Math.abs(r-o)>i)return!1}return!0}easeInOutCubic(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}}const B1e=["x","y","z","w"],lt=new L1e;class U9{constructor(e){p(this,"y");p(this,"s");p(this,"alpha",0);this.setAlpha(e),this.y=null,this.s=null}setAlpha(e){if(e<=0||e>1)throw new Error;this.alpha=e}filter(e,t){t&&this.setAlpha(t);let i;return this.y?i=this.alpha*e+(1-this.alpha)*this.s:i=e,this.y=e,this.s=i,i}lastValue(){return this.y}reset(e){this.y=e,this.s=e}}class CR{constructor(e,t=1,i=0,n=1){p(this,"freq");p(this,"minCutOff");p(this,"beta");p(this,"dCutOff");p(this,"x");p(this,"dx");p(this,"lasttime");if(e<=0||t<=0||n<=0)throw new Error;this.freq=e,this.minCutOff=t,this.beta=i,this.dCutOff=n,this.x=new U9(this.alpha(this.minCutOff)),this.dx=new U9(this.alpha(this.dCutOff)),this.lasttime=null}alpha(e){const t=1/this.freq;return 1/(1+1/(2*Math.PI*e)/t)}filter(e,t=null){this.lasttime&&t&&(this.freq=1/(t-this.lasttime)),this.lasttime=t;const i=this.x.lastValue(),n=i?(e-i)*this.freq:0,r=this.dx.filter(n,this.alpha(this.dCutOff)),o=this.minCutOff+this.beta*Math.abs(r);return this.x.filter(e,this.alpha(o))}reset(e){e!=null&&this.x.reset(e),this.x.alpha=this.alpha(this.minCutOff),this.dx.alpha=this.alpha(this.dCutOff),this.lasttime=null}}class pO{constructor(e,t=1,i=0,n=1){p(this,"x");p(this,"y");p(this,"z");this.x=new CR(e,t,i,n),this.y=new CR(e,t,i,n),this.z=new CR(e,t,i,n)}filter(e,t,i=null){t.x=this.x.filter(e.x,i),t.y=this.y.filter(e.y,i),t.z=this.z.filter(e.z,i)}reset(e){this.x.reset(e==null?void 0:e.x),this.y.reset(e==null?void 0:e.y),this.z.reset(e==null?void 0:e.z)}}class Cx extends fe{constructor(e,t,i,n=128){if(t<=0||i<=0||n<=0)throw new Error("GroundedSkybox height, radius, and resolution must be positive.");const r=new Wc(i,2*n,n);r.scale(1,1,-1);const o=r.getAttribute("position"),a=new T;for(let l=0;l<o.count;++l)if(a.fromBufferAttribute(o,l),a.y<0){const c=-t*3/2,h=a.y<c?-t/a.y:1-a.y*a.y/(3*c*c);a.multiplyScalar(h),a.toArray(o.array,3*l)}o.needsUpdate=!0,super(r,new ii({map:e,depthWrite:!1}))}}const wR="needle:cameraController";function Cie(s){return s[wR]}function wV(s,e,t){t?s[wR]=e:s[wR]===e&&(s[wR]=null)}const SV="needle:autofit";function wie(s){return s[SV]===void 0?!0:s[SV]!==!1}function MV(s,e){s[SV]=e}function P1e(s,e,t){const i=s.length(),n=e.length(),r=lt.lerp(i,n,t);return s.lerp(e,t).normalize().multiplyScalar(r)}const Gk=new Ve,Sie=new Ve().setFromAxisAngle(new T(0,1,0),Math.PI);function G1e(s,e){s.lookAt(e),s.quaternion.multiply(Sie)}function q1(s,e,t=!0,i=!1){if(s===e)return;Gk.copy(s.quaternion);const n=$t(e),r=$t(s);if(i){if(Uc(s,gn(e)),t){const o=r.y,a=r.sub(gO(s));a.y=o,s.lookAt(a),s.quaternion.multiply(Sie)}Number.isNaN(s.quaternion.x)&&s.quaternion.copy(Gk);return}t&&(n.y=r.y),s.lookAt(n),Number.isNaN(s.quaternion.x)&&s.quaternion.copy(Gk)}const k1e=new $l(()=>new T,100);function St(s,e,t){const i=k1e.get();return i.set(0,0,0),s instanceof T?i.copy(s):Array.isArray(s)?i.set(s[0],s[1],s[2]):s instanceof DOMPointReadOnly?i.set(s.x,s.y,s.z):typeof s=="number"?(i.x=s,i.y=e!==void 0?e:i.x,i.z=t!==void 0?t:i.x):typeof s=="object"&&(i.x=s.x,i.y=s.y,i.z=s.z),i}const N1e=new $l(()=>new ge,30);function Mie(s){const e=N1e.get();return s?e.copy(s):e.set(0,0,0),e}const D1e=new $l(()=>new Ve,100);function Ah(s){const e=D1e.get();return e.identity(),s instanceof Ve?e.copy(s):s instanceof DOMPointReadOnly&&e.set(s.x,s.y,s.z,s.w),e}const fO=new $l(()=>new T,100),X9=Symbol("lastMatrixWorldUpdateKey");function $t(s,e=null,t=!0){const i=e??fO.get();return s?s.parent?(t&&s.updateWorldMatrix(!0,!1),s.matrixWorldNeedsUpdate&&s[X9]!==Date.now()&&(s[X9]=Date.now(),s.updateMatrixWorld()),i.setFromMatrixPosition(s.matrixWorld),i):i.copy(s.position):i.set(0,0,0)}function _r(s,e){if(!s)return s;const t=fO.get();return e!==t&&t.copy(e),((s==null?void 0:s.parent)??s).worldToLocal(t),s.position.set(t.x,t.y,t.z),s}function q0(s,e,t,i){const n=fO.get();return n.set(e,t,i),_r(s,n),s}const KL=new $l(()=>new Ve,100),M0=new Ve,kk=new Ve;function gn(s,e=null){if(!s)return KL.get().identity();const t=e??KL.get();return s.parent?(s.getWorldQuaternion(t),t):t.copy(s.quaternion)}function Uc(s,e){if(!s)return;e!==M0&&M0.copy(e);const t=M0,i=s==null?void 0:s.parent;i==null||i.getWorldQuaternion(kk),kk.invert();const n=kk.multiply(t);s.quaternion.set(n.x,n.y,n.z,n.w)}function mO(s,e,t,i,n){M0.set(e,t,i,n),Uc(s,M0)}const F1e=new $l(()=>new T,100),V1e=new T;function kn(s,e=null){return e||(e=F1e.get()),s?s.parent?(s.getWorldScale(e),e):e.copy(s.scale):e.set(0,0,0)}function wx(s,e){if(!s)return;if(!s.parent){s.scale.copy(e);return}const t=V1e;s.parent.getWorldScale(t),s.scale.copy(e),s.scale.divide(t)}const z1e=new T,O9=new Ve;function U1e(s){return gn(s,O9),z1e.set(0,0,1).applyQuaternion(O9)}const X1e=new $l(()=>new T,100),Z9=new Ve;function gO(s,e){return e||(e=X1e.get().set(0,0,1)),gn(s,Z9),e.applyQuaternion(Z9)}const W9=new Xi,H9=new Xi,O1e=new T;function AO(s){const e=KL.get();return s.getWorldQuaternion(e),H9.setFromQuaternion(e),H9}function yO(s,e){const t=KL.get();Uc(s,t.setFromEuler(e))}function $1(s){const e=AO(s),t=O1e;return t.set(e.x,e.y,e.z),t.x=lt.toDegrees(t.x),t.y=lt.toDegrees(t.y),t.z=lt.toDegrees(t.z),t}function bO(s,e){eM(s,e.x,e.y,e.z,!0)}function eM(s,e,t,i,n=!0){n&&(e=lt.toRadians(e),t=lt.toRadians(t),i=lt.toRadians(i)),W9.set(e,t,i),M0.setFromEuler(W9),Uc(s,M0)}function YL(s,e=!0){s&&(e?function t(i){console.groupCollapsed((i.name?i.name:"(no name : "+i.type+")")+" %o",i),i.children.forEach(t),console.groupEnd()}(s):s.traverse(function(t){for(var i="|___",n=t;n.parent!==null;)i="	"+i,n=n.parent;console.log(i+t.name+" <"+t.type+">")}))}function Z1e(s){let e=(s==null?void 0:s.name)||"";if(!s)return e;let t=s.parent;for(;t;)e=t.name+"/"+e,t=t.parent;return e}function Iie(s){if(s){const e=s;return e.blendMode!==void 0&&e.clampWhenFinished!==void 0&&e.enabled!==void 0&&e.fadeIn!==void 0&&e.getClip!==void 0}return!1}class Ec{static createBlitMaterial(e){return new Ht({uniforms:{map:new Te(null)},vertexShader:this.vertex,fragmentShader:e})}static copyTexture(e,t){const i=t??this.blipMaterial;i.uniforms.map.value=e,i.needsUpdate=!0,i.uniformsNeedUpdate=!0,this.blipMaterial||(this.blipMaterial=new Ht({uniforms:{map:new Te(null)},vertexShader:this.vertex,fragmentShader:this.fragment}));const n=i.vertexShader;i.vertexShader=this.vertex,this.mesh||(this.mesh=new fe(this.planeGeometry,this.blipMaterial));const r=this.mesh;r.material=i,r.frustumCulled=!1,this.scene.children.length=0,this.scene.add(r),this.renderer||(this.renderer=new Mm({antialias:!1})),this.renderer.setSize(e.image.width,e.image.height),this.renderer.clear(),this.renderer.render(this.scene,this.perspectiveCam);const o=new si(this.renderer.domElement);return o.name="Copy",o.needsUpdate=!0,i.vertexShader=n,o}static textureToCanvas(e,t){if(!e)return null;(t===!0||e.isCompressedTexture===!0)&&(e=Tie(e));const i=e.image;if(H1e(i)){const n=document.createElement("canvas");n.width=i.width,n.height=i.height;const r=n.getContext("2d");return r?(r.drawImage(i,0,0,i.width,i.height,0,0,n.width,n.height),n):(console.error("Failed getting canvas 2d context"),null)}return null}}p(Ec,"planeGeometry",new Rs(2,2,1,1)),p(Ec,"renderer"),p(Ec,"perspectiveCam",new Xt),p(Ec,"scene",new sr),p(Ec,"vertex",`
    varying vec2 vUv;
    void main(){
        vUv = uv;
        gl_Position = vec4(position.xy * 1.0,0.,.999999);
    }`),p(Ec,"fragment",`
    uniform sampler2D map; 
    varying vec2 vUv;
    void main(){ 
        vec2 uv = vUv;
        uv.y = 1.0 - uv.y;
        gl_FragColor = texture2D( map, uv);
        // gl_FragColor = vec4(uv.xy, 0, 1);
    }`),p(Ec,"blipMaterial"),p(Ec,"mesh");function Tie(s){return Ec.copyTexture(s)}function W1e(s,e=!1){return Ec.textureToCanvas(s,e)}function H1e(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&s instanceof ImageBitmap}function Q1e(s){const e=s.type;return e==="Mesh"||e==="SkinnedMesh"}function xO(s,e){e?s["needle:rendercustomshadow"]=!0:s["needle:rendercustomshadow"]=!1}function Eie(s){if(s){if(s["needle:rendercustomshadow"]===!0)return!0;if(s["needle:rendercustomshadow"]==null)return!0}return!1}function ec(s,e=void 0,t=void 0,i=void 0){const n=i||new oi;n.makeEmpty();const r=[];function o(l){let c=!0;if(l.visible&&wie(l)!==!1&&!(l.type==="TransformControlsGizmo"||l.type==="TransformControlsPlane")){if(l instanceof gX&&(c=!1),l instanceof SB&&(c=!1),l instanceof Cx&&(c=!1),l.isGizmo===!0&&(c=!1),l.material instanceof M1&&(c=!1),Q1e(l)||(c=!1),t&&l.layers.test(t)===!1&&(c=!1),c){if(e&&Array.isArray(e)&&(e!=null&&e.includes(l)))return;if(typeof e=="function"&&e(l)===!0)return}if(l.isUI!==!0){if(c){const h=l.children;l.children=r;const d=l.position,u=l.scale;if(Number.isNaN(d.x)||Number.isNaN(d.y)||Number.isNaN(d.z)){console.warn(`Object "${l.name}" has NaN values in position or scale.... will ignore it`,d,u);return}n.expandByObject(l,!0),l.children=h}for(const h of l.children)o(h)}}}let a=!1;for(const l of s)l&&(a=!0,l.updateMatrixWorld(),o(l));return a||console.warn("No objects to fit camera to..."),n}function Rie(s,e,t){const i=ec([s],t==null?void 0:t.ignore),n=new T;i.getSize(n);const r=new T;i.getCenter(r);const o=new T;e.getSize(o);const a=new T;e.getCenter(a);const l=new T;l.set(o.x/n.x,o.y/n.y,o.z/n.z);const c=Math.min(l.x,l.y,l.z),h=(t==null?void 0:t.scale)!==!1;if(h&&wx(s,kn(s).multiplyScalar(c)),(t==null?void 0:t.position)!==!1){const d=new T;i.getCenter(d),d.y=i.min.y;const u=new T;e.getCenter(u),u.y=e.min.y;const f=u.clone().sub(d);h&&f.multiplyScalar(c),_r(s,$t(s).add(f))}return{boundsBefore:i,scale:l}}function Lie(s,e){const t=ec([s]),i=new T;t.getCenter(i),i.y=t.min.y;const n=e.clone().sub(i),r=$t(s);return _r(s,r.add(n)),{offset:n,bounds:t}}function vO(s,e,t,i){if(Array.isArray(e)){let o=!0;for(let a=0;a<e.length;a++)vO(s,e[a],a,e)||(o=!1);return o}if(e.type==="MeshStandardMaterial")return!1;if(e["material:fbx"]!=null)return!0;const n=new Us;n["material:fbx"]=e;const r=e;return r&&(r.map?n.color.set(1,1,1):n.color.copyLinearToSRGB(r.color),n.emissive.copyLinearToSRGB(r.emissive),n.emissiveIntensity=r.emissiveIntensity,n.opacity=r.opacity,n.displacementScale=r.displacementScale,n.transparent=r.transparent,n.bumpMap=r.bumpMap,n.aoMap=r.aoMap,n.map=r.map,n.displacementMap=r.displacementMap,n.emissiveMap=r.emissiveMap,n.normalMap=r.normalMap,n.envMap=r.envMap,n.alphaMap=r.alphaMap,n.metalness=r.reflectivity,r.shininess&&(n.roughness=1-Math.sqrt(r.shininess)/10),n.needsUpdate=!0),t===void 0?s.material=n:i[t]=n,!0}let fT=!1;Y_e((...s)=>{var e;Qe()&&((e=Oi.Current)!=null&&e.isInXR)&&(I0(!0),Bie("error",...s))});function I0(s){if(s){if(fT)return;fT=!0,Y1e()}else{if(!fT)return;fT=!1,J1e()}}const KC={log:void 0,warn:void 0,error:void 0};class K1e{constructor(){p(this,"familyName","needle-xr");p(this,"root",null);p(this,"context",null);p(this,"defaultFontSize",.06);p(this,"targetObject",new ye);p(this,"userForwardViewPoint",new T);p(this,"oneEuroFilter",new pO(90,.8));p(this,"_lastElementRemoveTime",0);p(this,"onBeforeRender",()=>{var t,i;const e=(t=this.context)==null?void 0:t.mainCamera;if(this.context&&e instanceof Xt){const n=this.getRoot();Number.isNaN(n.position.x)&&n.position.set(0,0,0),Number.isNaN(n.quaternion.x)&&n.quaternion.set(0,0,0,1),this.context.scene.add(this.targetObject);const r=((i=this.context.xr)==null?void 0:i.rigScale)??1,o=3.5*r,a=e.worldForward;a.y=0,a.normalize().multiplyScalar(o),this.userForwardViewPoint.copy(e.worldPosition).sub(a),this.targetObject.position.distanceTo(this.userForwardViewPoint)>2*r&&(this.targetObject.position.copy(this.userForwardViewPoint),q1(this.targetObject,e,!0,!0),this.targetObject.rotateY(Math.PI)),this.oneEuroFilter.filter(this.targetObject.position,n.position,this.context.time.time);const c=this.context.time.deltaTime;if(n.quaternion.slerp(this.targetObject.quaternion,c*5),n.scale.setScalar(r),this.targetObject.removeFromParent(),this.context.scene.add(n),this.context.time.time-this._lastElementRemoveTime>.1){this._lastElementRemoveTime=this.context.time.time;const h=Date.now();for(let d=0;d<this._activeTexts.length;d++){const u=this._activeTexts[d];if(u instanceof Mn.Text&&h-u._activatedTime>2e4){u.removeFromParent(),this._textBuffer.push(u),this._activeTexts.splice(d,1);break}}}}});p(this,"textOptions",{fontSize:this.defaultFontSize,fontFamily:this.familyName,padding:.03,margin:.005,color:0,backgroundColor:16777215,backgroundOpacity:.4,borderRadius:.03,offset:.025});p(this,"_textBuffer",[]);p(this,"_activeTexts",[]);this.ensureFont()}onEnable(){this.context=Oi.Current||Oi.All[0],this.context.pre_render_callbacks.push(this.onBeforeRender)}onDisable(){var e,t,i;(t=this.context)==null||t.pre_render_callbacks.splice((e=this.context)==null?void 0:e.pre_render_callbacks.indexOf(this.onBeforeRender),1),(i=this.root)==null||i.removeFromParent()}addLog(e,t){const i=this.getRoot(),n=this.getText();let r=16777215,o=0;switch(e){case"log":r=16777215,o=0;break;case"warn":r=16772761,o=4465152;break;case"error":r=16755370,o=7798784;break}t.length>1e3&&(t=t.substring(0,1e3)+"...");const a=new Date().toISOString().split("T")[1].split(".")[0];n.textContent="["+a+"] "+t,n.visible=!0,n._activatedTime=Date.now(),i.add(n),this._activeTexts.push(n),this.context&&this.context.scene.add(i),n.set({backgroundColor:r,color:o}),Mn.update()}ensureFont(){let e=Mn.FontLibrary.getFontFamily(this.familyName);if(!e){e=Mn.FontLibrary.addFontFamily(this.familyName);const t=e.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");t==null||t.addEventListener("ready",()=>{Mn.update()})}}getText(){const e=this.getRoot();if(this._textBuffer.length>0){const i=this._textBuffer.pop();return i.visible=!0,setTimeout(()=>this.disableDepthTestRecursive(i),100),i}if(e.children.length>20&&this._activeTexts.length>0)return this._activeTexts.shift();const t=new Mn.Text(this.textOptions);return setTimeout(()=>this.disableDepthTestRecursive(t),500),setTimeout(()=>this.disableDepthTestRecursive(t),1500),t}disableDepthTestRecursive(e,t=0){for(let n=0;n<e.children.length;n++){const r=e.children[n];r instanceof ye&&this.disableDepthTestRecursive(r,t+1)}e.renderOrder=10*t,e.layers.set(2);const i=e.material;i&&(i.depthWrite=!1,i.depthTest=!1,i.transparent=!0),t===0&&Mn.update()}getRoot(){if(this.root)return this.root;const e=this.defaultFontSize,t={boxSizing:"border-box",fontFamily:this.familyName,width:"2.6",fontSize:e,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:0,whiteSpace:"pre-wrap",flexDirection:"column-reverse"};return this.root=new Mn.Block(t),this.root}}let va=null;function Y1e(){va||(va=new K1e),va.onEnable();for(const s in KC){KC[s]=console[s];let e=!1;console[s]=function(){var t;if((t=KC[s])==null||t.apply(console,arguments),!e)try{e=!0,Bie(s,...arguments)}finally{e=!1}}}}function J1e(){va==null||va.onDisable();for(const s in KC)console[s]=KC[s]}const s_=new Map;function Bie(s,...e){try{switch(s_.clear(),s){case"log":va==null||va.addLog("log",t());break;case"warn":va==null||va.addLog("warn",t());break;case"error":va==null||va.addLog("error",t());break}}catch(r){console.error("Error in spatial console",r)}finally{s_.clear()}function t(){let r="";for(let o=0;o<e.length;o++){const a=e[o];r+=i(a),o<e.length-1&&(r+=", ")}return r}function i(r,o=0){if(typeof r=="string")return'"'+r+'"';if(typeof r=="number"){if(r%1!==0){const l=r.toFixed(5),c=l.indexOf(".");let h=l.length-1;for(;h>c&&l[h]==="0";)h--;return l.substring(0,h+1)}return r.toString()}else if(Array.isArray(r)){let a="[";for(let l=0;l<r.length;l++){const c=r[l];a+=i(c,o+1),l<r.length-1&&(a+=", ")}return a+="]",a}else{if(r===null)return"null";if(r===void 0)return"undefined";if(typeof r=="function")return r.name+"()"}if(r instanceof Q)return`(${i(r.x)}, ${i(r.y)})`;if(r instanceof T)return`(${i(r.x)}, ${i(r.y)}, ${i(r.z)})`;if(r instanceof Je)return`(${i(r.x)}, ${i(r.y)}, ${i(r.z)}, ${i(r.w)})`;if(r instanceof Ve)return`(${i(r.x)}, ${i(r.y)}, ${i(r.z)}, ${i(r.w)})`;if(r instanceof Yt||r instanceof si)return r.name;if(r instanceof ei)return`[${r.elements.join(", ")}]`;if(r instanceof ce)return`[${r.elements.join(", ")}]`;if(r instanceof ta)return r.mask.toString();if(typeof r=="object"){if(s_.has(r))return"*";let a=`{
`;a+=n(o);const l=Object.keys(r);let c="";for(let h=0;h<l.length;h++){const d=l[h],u=r[d];if(s_.has(u)){c+="";continue}s_.set(u,!0),c+=d+":"+i(u,o+1),h<l.length-1&&(c+=", "),c.length>=60&&(c+=`
`,c+=n(o),a+=c,c="")}return a+=c,a+=`
}`,a}return r}function n(r){let o="";for(let a=0;a<r;a++)o+=" ";return o}}const j1e=ee("nodevlogs");function is(s,e=zl.Log){Ed(e,s)}function An(s){is(s,zl.Warn)}function tM(s){is(s,zl.Error)}let IV,Nk;function Qe(){if(j1e)return!1;if(IV!==void 0)return IV;if(Nk!==void 0)return Nk;let s=ka();return s||(s=window.location.hostname.endsWith(".local-credentialless.webcontainer.io")),Nk=s,s}function q1e(s){IV=s}let Ca,El=null,Rd=null,r_=!1,Q9=null;const Pie="terminal",oC=ee("console"),$1e=ee("noerrors")||ee("noconsole")||window.crossOriginIsolated;oC&&_O();if(!$1e&&(oC||ka())){if(ka()&&!oC){const e=new URL(window.location.href);e.searchParams.set("console","1"),console.log('🌵 Tip: You can add the "?console" query parameter to the url to show the debug console (on mobile it will automatically open in the bottom right corner when your get errors during development. In VR a spatial console will appear.)',`
Open this page to get the console: `+e.toString())}const s=exports.DeviceUtilities.isMobileDevice()||exports.DeviceUtilities.isQuest()&&Qe();if((s||oC)&&(q_e(),kie(),Nie(!0),s)){const e=document.querySelector("needle-engine");e==null||e.addEventListener("enter-ar",()=>{(oC||Ca||X3()>0)&&ee("noerrors")}),e==null||e.addEventListener("exit-ar",()=>{nMe()})}}const TV=Symbol("consoleParent");function _O(){if(Ca){Ca.showSwitch();return}Nie()}function Gie(){Ca&&(Ca.hide(),Ca.hideSwitch())}function kie(){Q9||(Q9=setInterval(eMe,500))}let K9=0;function eMe(){const s=X3(),e=s!==K9;K9=s,e&&tMe()}function tMe(){_O(),Rd&&(Rd.setAttribute("error","true"),Rd.innerText="🤬")}function iMe(){Rd&&(Rd.removeAttribute("error"),Rd.innerText=Pie)}function nMe(){El&&El[TV]&&El[TV].appendChild(El)}function Nie(s=!1){if(Ca!==void 0||r_)return;r_=!0;const e=document.createElement("script");e.onload=()=>{if(!globalThis.VConsole){console.warn("🌵 Debug console failed to load."),r_=!1,Ca=null;return}r_=!1,kie(),Ca=new VConsole({pluginOrder:["default","needle-console"]});const t=globalThis["needle:codegen_files"];if(t&&t.length>0&&Ca.addPlugin(sMe()),El=oMe(),El&&(El[TV]=El.parentElement,El.style.position="absolute",El.style.zIndex=Number.MAX_SAFE_INTEGER.toString()),Ca.setSwitchPosition(20,30),Rd=rMe(),Rd){Rd.innerText=Pie,Rd.addEventListener("click",iMe);const i=document.createElement("style"),n=40;i.innerHTML=`
                #__vconsole .vc-switch {
                    border: 1px solid rgba(255, 255, 255, .1);
                    border-radius: 50%;
                    width: ${n}px;
                    height: ${n}px;
                    padding: 0;
                    line-height: ${n}px;
                    font-size: ${n*.4}px;
                    text-align: center;
                    background: #ffffff5c;
                    backdrop-filter: blur(16px);
                    -webkit-backdrop-filter: blur(16px);
                    user-select: none;
                    pointer-events: auto;
                    transition: transform .2s ease-in-out;
                    box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);

                    font-family: 'Material Symbols Outlined';
                    color: black;
                    font-size: 2.3em;
                    font-weight: 100;
                }
                #__vconsole .vc-switch:hover {
                    cursor: pointer;
                    transform: scale(1.1);
                    transition: transform .1s ease-in-out, background .1s linear;
                    background: rgba(245, 245, 245, .8);
                    outline: rgba(0, 0, 0, .05) 1px solid;
                }
                #__vconsole .vc-switch[error] {
                    background: rgba(255,0,0,.2);
                    animation: vconsole-notify 1s ease-in-out;
                    line-height: 35px;
                }
                @keyframes vconsole-notify {
                    from {
                        transform: scale(1, 1);
                    }
                    10% {
                        transform: scale(1.3, 1.3);
                    }
                    70% {
                        transform: scale(1.4, 1.4);
                    }
                    to {
                        transform: scale(1, 1);
                    }
                }
                #__vconsole .vc-panel {
                    font-family: monospace;
                    font-size: 11px;
                }
                #__vconsole .vc-plugin-box.vc-actived {
                    height: 100%;
                }
                #__vconsole .vc-mask {
                    overflow: hidden;
                }
            `,El==null||El.prepend(i),s===!0&&X3()<=0&&Gie(),console.log("🌵 Debug console has loaded")}},e.onerror=()=>{console.warn("🌵 Debug console failed to load."+(window.crossOriginIsolated?"This page is using cross-origin isolation, so external scripts can't be loaded.":"")),r_=!1,Ca=null},e.src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js",document.body.appendChild(e)}function sMe(){if(!globalThis.VConsole)return;const s=new VConsole.VConsolePlugin("needle-console","🌵 Inspect glTF"),e=()=>document.querySelector("#__vc_plug_"+s._id+" iframe");return s.on("renderTab",function(t){const i=globalThis["needle:codegen_files"];if(!i||i.length===0)return;let n=globalThis["needle:codegen_files"][0];const r=n.indexOf("?");r>-1&&(n=n.substring(0,r));const a=location.protocol+"//"+location.host+location.pathname+"/"+n,l=encodeURIComponent(a);s.fullUrl="https://viewer.needle.tools?inspect&file="+l;var c='<iframe src="" style="width: 100%; height: 99%; border: none;"></iframe>';t(c)}),s.on("show",function(){const t=e();t&&t.src!==s.fullUrl&&(t.src=s.fullUrl)}),s.on("hide",function(){const t=e();t&&(t.src="")}),s.on("addTopBar",function(t){var i=new Array;i.push({name:"Open in new window ↗",onClick:function(n){window.open(s.fullUrl,"_blank"),Ca==null||Ca.hide()}}),i.push({name:"Reload",onClick:function(n){const r=e();r&&(r.src=s.fullUrl)}}),i.push({name:"Fullscreen",onClick:function(n){const r=e();r.requestFullscreen?r.requestFullscreen():r.webkitRequestFullscreen instanceof Function&&r.webkitRequestFullscreen()}}),t(i)}),s}function rMe(){const s=document.querySelector("#__vconsole .vc-switch");return s||null}function oMe(){const s=document.querySelector("#__vconsole");return s||null}const Die=ee("debugdefines");Nm('if(!globalThis[""4.1.0-alpha.9""]) globalThis[""4.1.0-alpha.9""] = "0.0.0";');Nm('if(!globalThis[""undefined""]) globalThis[""undefined""] = "unknown";');Nm('if(!globalThis[""Wed Jan 15 2025 09:56:43 GMT+0100 (Central European Standard Time)""]) globalThis[""Wed Jan 15 2025 09:56:43 GMT+0100 (Central European Standard Time)""] = "unknown";');Nm('if(!globalThis[""npk_74222a9fbd1b42572cdd3bf7f639eeb17a07d07f40a6185fac5f722e8fd34df9""]) globalThis[""npk_74222a9fbd1b42572cdd3bf7f639eeb17a07d07f40a6185fac5f722e8fd34df9""] = "unknown";');Nm('globalThis["__NEEDLE_ENGINE_VERSION__"] = "4.1.0-alpha.9";');Nm('globalThis["__NEEDLE_ENGINE_GENERATOR__"] = "undefined";');Nm('globalThis["__NEEDLE_PROJECT_BUILD_TIME__"] = "Wed Jan 15 2025 09:56:43 GMT+0100 (Central European Standard Time)";');Nm('globalThis["__NEEDLE_PUBLIC_KEY__"] = "npk_74222a9fbd1b42572cdd3bf7f639eeb17a07d07f40a6185fac5f722e8fd34df9";');const Eh="4.1.0-alpha.9",eP="undefined",CO="Wed Jan 15 2025 09:56:43 GMT+0100 (Central European Standard Time)";Die&&console.log(`Engine version: ${Eh} (generator: ${eP})
Project built at ${CO}`);const YC="npk_74222a9fbd1b42572cdd3bf7f639eeb17a07d07f40a6185fac5f722e8fd34df9",yp="needle_isActiveInHierarchy",qg="builtin_components",JC="needle_editor_guid";function Nm(s){try{(0,eval)(s)}catch(e){Die&&console.error(e)}}const aMe='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 160 187.74"><defs><linearGradient id="a" x1="89.64" y1="184.81" x2="90.48" y2="21.85" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#62d399"/><stop offset=".51" stop-color="#acd842"/><stop offset=".9" stop-color="#d7db0a"/></linearGradient><linearGradient id="b" x1="69.68" y1="178.9" x2="68.08" y2="16.77" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0ba398"/><stop offset=".5" stop-color="#4ca352"/><stop offset="1" stop-color="#76a30a"/></linearGradient><linearGradient id="c" x1="36.6" y1="152.17" x2="34.7" y2="84.19" gradientUnits="userSpaceOnUse"><stop offset=".19" stop-color="#36a382"/><stop offset=".54" stop-color="#49a459"/><stop offset="1" stop-color="#76a30b"/></linearGradient><linearGradient id="d" x1="15.82" y1="153.24" x2="18" y2="90.86" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#267880"/><stop offset=".51" stop-color="#457a5c"/><stop offset="1" stop-color="#717516"/></linearGradient><linearGradient id="e" x1="135.08" y1="135.43" x2="148.93" y2="63.47" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b0d939"/><stop offset="1" stop-color="#eadb04"/></linearGradient><linearGradient id="f" x1="-4163.25" y1="2285.12" x2="-4160.81" y2="2215.34" gradientTransform="rotate(20 4088.49 13316.712)" gradientUnits="userSpaceOnUse"><stop offset=".17" stop-color="#74af52"/><stop offset=".48" stop-color="#99be32"/><stop offset="1" stop-color="#c0c40a"/></linearGradient><symbol id="g" viewBox="0 0 160 187.74"><path style="fill:url(#a)" d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75z"/><path style="fill:url(#b)" d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98z"/><path style="fill:url(#c)" d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z"/><path style="fill:url(#d)" d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04z"/><path style="fill:#9c3" d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5z"/><path style="fill:url(#e)" d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59z"/><path style="fill:url(#f)" d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z"/><path style="fill:#ffe113" d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1z"/><path style="fill:#f3e600" d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75z"/></symbol></defs><use width="160" height="187.74" xlink:href="#g"/></svg>',lMe=btoa(aMe),cMe="data:image/svg+xml;base64,"+lMe,hMe=cMe,dMe=`<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'> <svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" version="1.1" viewBox="0 0 1014 282" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m665.95 132.73v44.88l-10.56-8.4c-0.8-0.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18 0.4-6.06 1.2s-3.54 1.8-4.98 3-2.56 2.5-3.36 3.9-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c0.32 0.24 0.56 0.44 0.72 0.6s0.36 0.32 0.6 0.48c0.96-1.2 2.14-2.28 3.54-3.24s2.92-1.76 4.56-2.4 3.34-1.14 5.1-1.5 3.44-0.54 5.04-0.54c1.44 0 2.92 0.04 4.44 0.12s2.84 0.28 3.96 0.6c4.56 1.12 7.8 3.12 9.72 6s2.88 6.56 2.88 11.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m732.38 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m795.93 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m858.57 97.21c0.64 0.48 0.96 1.16 0.96 2.04v74.88c-0.08 1.04-0.12 2.12-0.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18s-2.06-1.66-2.46-1.98c-1.76 2.48-4.26 4.44-7.5 5.88s-7.02 2.16-11.34 2.16c-3.84 0-7.4-0.7-10.68-2.1s-6.14-3.44-8.58-6.12-4.34-5.94-5.7-9.78-2.04-8.16-2.04-12.96c0-4.32 0.78-8.34 2.34-12.06s3.6-6.92 6.12-9.6 5.38-4.78 8.58-6.3 6.48-2.28 9.84-2.28c2.56 0 4.82 0.22 6.78 0.66s3.68 1.06 5.16 1.86 2.78 1.74 3.9 2.82 2.16 2.22 3.12 3.42v-35.04l10.68 8.64zm-27.96 67.92c3.6 0 6.52-0.68 8.76-2.04s3.98-3.06 5.22-5.1 2.1-4.22 2.58-6.54 0.72-4.44 0.72-6.36v-1.2c0-1.12-0.22-2.7-0.66-4.74s-1.28-4.06-2.52-6.06-3-3.7-5.28-5.1-5.22-2.02-8.82-1.86c-3.44 0-6.26 0.74-8.46 2.22s-3.96 3.26-5.28 5.34-2.24 4.2-2.76 6.36-0.78 3.92-0.78 5.28c0 1.84 0.24 3.92 0.72 6.24s1.36 4.48 2.64 6.48 3.04 3.68 5.28 5.04 5.12 2.04 8.64 2.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m882.81 97.09c0.64 0.48 0.96 1.12 0.96 1.92l-0.12 41.04v37.08l-10.56-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-77.88l10.8 8.64z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m950.36 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.8559 0 0 .7642 45.348 36.475)"> <g transform="translate(2.7114)"> <path d="m3.935 173.02c-0.331 0-0.497-0.402-0.497-1.207v-51.002c0-0.738 0.138-1.107 0.414-1.107h1.781c0.277 0 0.415 0.335 0.415 1.006v5.935c0 0.336 0.027 0.553 0.083 0.654 0.055 0.101 0.151-0.017 0.289-0.352 0.912-1.744 1.754-3.236 2.527-4.477 0.773-1.24 1.554-2.179 2.341-2.816s1.65-0.956 2.588-0.956c1.685 0 3.011 0.922 3.977 2.766 0.967 1.845 1.602 3.84 1.905 5.986 0.056 0.268 0.139 0.369 0.249 0.302s0.221-0.235 0.331-0.503c0.939-1.811 1.802-3.353 2.589-4.628 0.787-1.274 1.581-2.246 2.382-2.917s1.671-1.006 2.61-1.006c2.016 0 3.569 1.392 4.66 4.175 1.09 2.783 1.636 6.421 1.636 10.915v37.925c0 0.871-0.18 1.307-0.539 1.307h-1.739c-0.138 0-0.249-0.1-0.332-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.338-6.321-1.015-8.3-0.676-1.978-1.76-2.967-3.251-2.967-0.884 0-1.726 0.386-2.527 1.157s-1.519 1.727-2.154 2.867-1.201 2.213-1.699 3.219c-0.248 0.469-0.421 0.905-0.517 1.308-0.097 0.402-0.145 0.972-0.145 1.71v37.221c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.166 0-0.29-0.1-0.373-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.332-6.321-0.994-8.3-0.663-1.978-1.754-2.967-3.273-2.967-1.242 0-2.375 0.704-3.396 2.112-1.022 1.409-2.223 3.555-3.604 6.439v39.031c0 0.805-0.18 1.207-0.539 1.207h-1.698z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m53.642 166.28c-1.077 2.549-2.237 4.477-3.479 5.785-1.243 1.307-2.61 1.961-4.101 1.961-2.154 0-3.853-1.324-5.095-3.973-1.243-2.649-1.864-6.187-1.864-10.613 0-3.488 0.4-6.489 1.201-9.004s1.988-4.51 3.562-5.985c1.574-1.476 3.521-2.414 5.841-2.817l3.686-0.704c0.221-0.067 0.394-0.218 0.518-0.453 0.124-0.234 0.187-0.587 0.187-1.056v-2.917c0-3.89-0.504-6.975-1.512-9.255s-2.354-3.42-4.039-3.42c-1.298 0-2.472 0.72-3.521 2.162s-2.002 3.572-2.858 6.388c-0.083 0.268-0.159 0.453-0.228 0.554-0.069 0.1-0.172 0.083-0.311-0.051l-1.698-1.71c-0.083-0.134-0.138-0.285-0.166-0.453-0.027-0.167 0.014-0.452 0.125-0.855 0.856-3.353 2.009-6.052 3.459-8.098 1.449-2.045 3.224-3.068 5.322-3.068 1.74 0 3.211 0.687 4.412 2.062s2.112 3.37 2.734 5.986c0.621 2.615 0.932 5.7 0.932 9.255v35.712c0 0.536-0.035 0.888-0.104 1.056s-0.2 0.251-0.393 0.251h-1.533c-0.166 0-0.29-0.117-0.373-0.352-0.083-0.234-0.124-0.553-0.124-0.955l-0.083-5.231c-0.055-0.939-0.221-1.006-0.497-0.202zm0.456-19.314c0-1.14-0.194-1.643-0.58-1.509l-3.107 0.603c-1.436 0.202-2.686 0.638-3.749 1.308-1.063 0.671-1.953 1.543-2.671 2.616s-1.257 2.33-1.616 3.772-0.538 3.102-0.538 4.98c0 3.152 0.455 5.616 1.367 7.393 0.911 1.778 2.14 2.666 3.686 2.666 0.939 0 1.85-0.419 2.734-1.257s1.671-1.895 2.361-3.169c0.663-1.408 1.181-2.85 1.553-4.326 0.373-1.475 0.56-2.883 0.56-4.225v-8.852z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m79.034 173.02c-0.166 0-0.297-0.117-0.394-0.352-0.096-0.234-0.145-0.553-0.145-0.955v-4.628c0-0.536-0.041-0.838-0.124-0.905s-0.207 0.1-0.373 0.503c-0.276 0.67-0.69 1.593-1.242 2.766-0.553 1.174-1.271 2.23-2.154 3.169-0.884 0.939-1.961 1.408-3.231 1.408-1.74 0-3.314-0.989-4.722-2.967-1.409-1.979-2.534-4.963-3.376-8.953-0.843-3.991-1.264-8.937-1.264-14.838 0-5.701 0.415-10.68 1.243-14.939s1.988-7.595 3.479-10.009c1.492-2.415 3.204-3.622 5.137-3.622 1.436 0 2.616 0.57 3.541 1.71 0.926 1.14 1.719 2.381 2.382 3.722 0.249 0.47 0.414 0.637 0.497 0.503s0.125-0.536 0.125-1.207v-23.841c0-0.805 0.151-1.208 0.455-1.208h1.864c0.276 0 0.414 0.369 0.414 1.107v72.128c0 0.537-0.041 0.905-0.124 1.107-0.083 0.201-0.235 0.301-0.455 0.301h-1.533zm-0.621-42.049c-0.939-2.213-1.885-3.94-2.838-5.181s-2.009-1.861-3.169-1.861c-1.463 0-2.768 0.889-3.914 2.666s-2.044 4.376-2.693 7.796-0.973 7.578-0.973 12.474c0 5.097 0.338 9.272 1.015 12.524 0.676 3.253 1.567 5.651 2.672 7.193 1.104 1.543 2.305 2.314 3.603 2.314 1.188 0 2.258-0.704 3.211-2.113 0.952-1.408 1.705-3.118 2.257-5.13s0.829-3.957 0.829-5.835v-24.847z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m89.514 149.38c0 3.42 0.345 6.606 1.035 9.557 0.691 2.951 1.609 5.315 2.755 7.092s2.437 2.666 3.873 2.666c1.519 0 2.837-0.738 3.956-2.213 1.118-1.476 2.064-3.655 2.837-6.539 0.083-0.336 0.166-0.52 0.249-0.554 0.083-0.033 0.179 0.017 0.29 0.151l1.408 1.912c0.221 0.268 0.235 0.67 0.041 1.207-0.69 2.548-1.47 4.661-2.34 6.337-0.87 1.677-1.857 2.935-2.962 3.773-1.104 0.838-2.319 1.257-3.645 1.257-2.043 0-3.838-1.14-5.385-3.42-1.546-2.28-2.761-5.482-3.645-9.607-0.884-4.124-1.325-8.836-1.325-14.134 0-5.901 0.455-10.931 1.367-15.089 0.911-4.158 2.14-7.377 3.686-9.658 1.547-2.28 3.3-3.42 5.261-3.42 1.988 0 3.714 1.073 5.178 3.219 1.463 2.146 2.595 5.231 3.396 9.255s1.201 8.886 1.201 14.587c0 0.469-0.02 0.939-0.062 1.408-0.041 0.469-0.214 0.704-0.517 0.704h-16.362c-0.083 0-0.152 0.151-0.207 0.453-0.056 0.302-0.083 0.654-0.083 1.056zm13.752-6.237c0.304 0 0.497-0.1 0.58-0.302 0.083-0.201 0.124-0.57 0.124-1.106 0-3.219-0.283-6.187-0.849-8.903s-1.367-4.896-2.402-6.539c-1.036-1.643-2.272-2.464-3.708-2.464-1.629 0-2.996 0.955-4.101 2.867-1.104 1.911-1.94 4.342-2.506 7.293s-0.849 6.002-0.849 9.154h13.711z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m148.54 119.7c0.165 0 0.283 0.117 0.352 0.352s0.076 0.52 0.02 0.855l-6.254 50.902c-0.028 0.47-0.104 0.788-0.228 0.956s-0.297 0.251-0.518 0.251h-1.615c-0.442 0-0.718-0.402-0.829-1.207l-5.26-40.138c-0.111-0.604-0.201-0.905-0.27-0.905s-0.131 0.301-0.186 0.905l-5.012 40.138c-0.028 0.47-0.097 0.788-0.207 0.956-0.111 0.168-0.277 0.251-0.497 0.251h-1.74c-0.442 0-0.718-0.402-0.829-1.207l-6.503-50.801c-0.055-0.403-0.048-0.721 0.021-0.956s0.2-0.352 0.393-0.352h1.823c0.166 0 0.297 0.067 0.393 0.201 0.097 0.134 0.159 0.403 0.187 0.805l5.302 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.219-41.949c0.055-0.268 0.124-0.47 0.207-0.604s0.193-0.201 0.331-0.201h1.533c0.138 0 0.262 0.067 0.373 0.201 0.11 0.134 0.179 0.403 0.207 0.805l5.468 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.053-41.849c0.055-0.335 0.138-0.57 0.249-0.704 0.11-0.134 0.234-0.201 0.373-0.201h1.284z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m156.49 171.51c0 0.604-0.042 1.006-0.125 1.208-0.082 0.201-0.262 0.301-0.538 0.301h-1.533c-0.221 0-0.366-0.083-0.435-0.251s-0.103-0.486-0.103-0.956v-50.902c0-0.805 0.152-1.207 0.456-1.207h1.822c0.304 0 0.456 0.402 0.456 1.207v50.6zm0.165-63.979c0 1.207-0.207 1.811-0.621 1.811h-1.905c-0.221 0-0.366-0.135-0.435-0.403s-0.104-0.67-0.104-1.207v-7.847c0-1.006 0.18-1.509 0.539-1.509h1.988c0.359 0 0.538 0.47 0.538 1.409v7.746z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m168.3 124.83c-0.221 0-0.331 0.269-0.331 0.805v33.801c0 3.42 0.221 5.667 0.663 6.74 0.441 1.073 1.09 1.609 1.946 1.609h3.024c0.138 0 0.242 0.084 0.311 0.252 0.069 0.167 0.103 0.419 0.103 0.754v2.716c0 0.537-0.138 0.906-0.414 1.107-0.248 0.067-0.614 0.134-1.098 0.201-0.483 0.067-0.959 0.118-1.429 0.151-0.469 0.034-0.828 0.05-1.077 0.05-1.712 0-2.934-0.955-3.665-2.867-0.732-1.911-1.098-5.013-1.098-9.305v-35.108c0-0.604-0.124-0.906-0.373-0.906h-3.521c-0.248 0-0.373-0.268-0.373-0.804v-3.521c0-0.537 0.111-0.805 0.332-0.805h3.686c0.166 0 0.263-0.268 0.29-0.805l0.415-16.095c0-0.805 0.124-1.207 0.372-1.207h1.492c0.303 0 0.455 0.436 0.455 1.307v15.995c0 0.537 0.097 0.805 0.29 0.805h5.468c0.221 0 0.331 0.268 0.331 0.805v3.521c0 0.536-0.124 0.804-0.373 0.804h-5.426z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m179.4 173.02c-0.331 0-0.497-0.402-0.497-1.207v-72.329c0-0.738 0.138-1.107 0.414-1.107h1.782c0.276 0 0.414 0.336 0.414 1.006v27.162c0 0.335 0.034 0.536 0.103 0.603s0.159-0.033 0.27-0.302c0.994-1.81 1.898-3.319 2.713-4.526 0.814-1.208 1.629-2.113 2.444-2.717 0.814-0.603 1.691-0.905 2.63-0.905 2.182 0 3.839 1.375 4.971 4.125 1.132 2.749 1.698 6.404 1.698 10.965v37.925c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.165 0-0.29-0.1-0.373-0.301-0.082-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.366-6.321-1.097-8.3-0.732-1.978-1.899-2.967-3.501-2.967-0.883 0-1.705 0.318-2.464 0.956-0.76 0.637-1.526 1.576-2.299 2.816-0.773 1.241-1.643 2.834-2.61 4.779v39.031c0 0.805-0.179 1.207-0.538 1.207h-1.699z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> </g> <g transform="matrix(.80638 0 0 .80638 452.53 65.421)" fill-rule="nonzero"> <path d="m79.32 36.98v150.76l15.68-13.2 6.59-156.31-22.27 18.75z" fill="url(#f)"/> <path d="m79.32 36.98-22.27-18.75 6.59 156.31 15.68 13.2v-150.76z" fill="url(#e)"/> <path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z" fill="url(#d)"/> <path d="m25.19 104.83-25.19-14.59 16.97 53.86 16.85 9.77-8.63-49.04z" fill="url(#c)"/> <path d="M43.86,82.5L18.69,67.98L0,90.24L25.18,104.83L43.86,82.5Z" fill="#9c3"/> <path d="m134.82 78.69-9.97 56.5 15.58-9.04 19.57-62.05-25.18 14.59z" fill="url(#b)"/> <path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z" fill="url(#a)"/> <path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33 25.19-14.59z" fill="#ffe113"/> <path d="M101.59,18.23L79.32,0L57.05,18.23L79.32,36.98L101.59,18.23Z" fill="#f3e600"/> </g> <defs> <linearGradient id="f" x2="1" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)" gradientUnits="userSpaceOnUse"><stop stop-color="#62d399" offset="0"/><stop stop-color="#acd842" offset=".51"/><stop stop-color="#d7db0a" offset=".9"/><stop stop-color="#d7db0a" offset="1"/></linearGradient> <linearGradient id="e" x2="1" gradientTransform="matrix(-1.6,-162.13,162.13,-1.6,69.68,178.9)" gradientUnits="userSpaceOnUse"><stop stop-color="#0ba398" offset="0"/><stop stop-color="#4ca352" offset=".5"/><stop stop-color="#76a30a" offset="1"/></linearGradient> <linearGradient id="d" x2="1" gradientTransform="matrix(-1.9,-67.98,67.98,-1.9,36.6,152.17)" gradientUnits="userSpaceOnUse"><stop stop-color="#36a382" offset="0"/><stop stop-color="#36a382" offset=".19"/><stop stop-color="#49a459" offset=".54"/><stop stop-color="#76a30b" offset="1"/></linearGradient> <linearGradient id="c" x2="1" gradientTransform="matrix(2.18,-62.38,62.38,2.18,15.82,153.24)" gradientUnits="userSpaceOnUse"><stop stop-color="#267880" offset="0"/><stop stop-color="#457a5c" offset=".51"/><stop stop-color="#717516" offset="1"/></linearGradient> <linearGradient id="b" x2="1" gradientTransform="matrix(13.85,-71.96,71.96,13.85,135.08,135.43)" gradientUnits="userSpaceOnUse"><stop stop-color="#b0d939" offset="0"/><stop stop-color="#eadb04" offset="1"/></linearGradient> <linearGradient id="a" x2="1" gradientTransform="matrix(26.159 -64.737 64.737 26.159 107.42 128.14)" gradientUnits="userSpaceOnUse"><stop stop-color="#74af52" offset="0"/><stop stop-color="#74af52" offset=".17"/><stop stop-color="#99be32" offset=".48"/><stop stop-color="#c0c40a" offset="1"/></linearGradient> </defs> </svg>`;btoa(dMe);const uMe='<svg viewBox="0 0 509 154" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><path d="M665.95 132.73v44.88l-10.56-8.4c-.8-.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18.4-6.06 1.2-1.88.8-3.54 1.8-4.98 3-1.44 1.2-2.56 2.5-3.36 3.9-.8 1.4-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-.72-.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c.32.24.56.44.72.6.16.16.36.32.6.48.96-1.2 2.14-2.28 3.54-3.24 1.4-.96 2.92-1.76 4.56-2.4 1.64-.64 3.34-1.14 5.1-1.5 1.76-.36 3.44-.54 5.04-.54 1.44 0 2.92.04 4.44.12 1.52.08 2.84.28 3.96.6 4.56 1.12 7.8 3.12 9.72 6 1.92 2.88 2.88 6.56 2.88 11.04ZM732.38 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM795.93 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM858.57 97.21c.64.48.96 1.16.96 2.04v74.88c-.08 1.04-.12 2.12-.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18-1.24-1-2.06-1.66-2.46-1.98-1.76 2.48-4.26 4.44-7.5 5.88-3.24 1.44-7.02 2.16-11.34 2.16-3.84 0-7.4-.7-10.68-2.1-3.28-1.4-6.14-3.44-8.58-6.12-2.44-2.68-4.34-5.94-5.7-9.78-1.36-3.84-2.04-8.16-2.04-12.96 0-4.32.78-8.34 2.34-12.06 1.56-3.72 3.6-6.92 6.12-9.6 2.52-2.68 5.38-4.78 8.58-6.3 3.2-1.52 6.48-2.28 9.84-2.28 2.56 0 4.82.22 6.78.66 1.96.44 3.68 1.06 5.16 1.86s2.78 1.74 3.9 2.82a35.92 35.92 0 0 1 3.12 3.42V88.57l10.68 8.64Zm-27.96 67.92c3.6 0 6.52-.68 8.76-2.04 2.24-1.36 3.98-3.06 5.22-5.1a20.5 20.5 0 0 0 2.58-6.54c.48-2.32.72-4.44.72-6.36v-1.2c0-1.12-.22-2.7-.66-4.74-.44-2.04-1.28-4.06-2.52-6.06s-3-3.7-5.28-5.1c-2.28-1.4-5.22-2.02-8.82-1.86-3.44 0-6.26.74-8.46 2.22-2.2 1.48-3.96 3.26-5.28 5.34-1.32 2.08-2.24 4.2-2.76 6.36-.52 2.16-.78 3.92-.78 5.28 0 1.84.24 3.92.72 6.24.48 2.32 1.36 4.48 2.64 6.48s3.04 3.68 5.28 5.04c2.24 1.36 5.12 2.04 8.64 2.04ZM882.81 97.09c.64.48.96 1.12.96 1.92l-.12 41.04v37.08l-10.56-8.4c-.72-.64-1.08-1.44-1.08-2.4V88.45l10.8 8.64ZM950.36 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14Z" style="fill-rule:nonzero" transform="translate(-452.406 -63.709) scale(1.00797)"/><path d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75Z" style="fill:url(#a);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98Z" style="fill:url(#b);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33Z" style="fill:url(#c);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04Z" style="fill:url(#d);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5Z" style="fill:#9c3;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59Z" style="fill:url(#e);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5Z" style="fill:url(#f);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1Z" style="fill:#ffe113;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75Z" style="fill:#f3e600;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><defs><linearGradient id="a" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)"><stop offset="0" style="stop-color:#62d399;stop-opacity:1"/><stop offset=".51" style="stop-color:#acd842;stop-opacity:1"/><stop offset=".9" style="stop-color:#d7db0a;stop-opacity:1"/><stop offset="1" style="stop-color:#d7db0a;stop-opacity:1"/></linearGradient><linearGradient id="b" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-90.565 123.412 54.953) scale(162.14)"><stop offset="0" style="stop-color:#0ba398;stop-opacity:1"/><stop offset=".5" style="stop-color:#4ca352;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30a;stop-opacity:1"/></linearGradient><linearGradient id="c" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="scale(-68) rotate(88.4 .881 -1.396)"><stop offset="0" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".19" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".54" style="stop-color:#49a459;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30b;stop-opacity:1"/></linearGradient><linearGradient id="d" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-88 87.255 68.431) scale(62.42)"><stop offset="0" style="stop-color:#267880;stop-opacity:1"/><stop offset=".51" style="stop-color:#457a5c;stop-opacity:1"/><stop offset="1" style="stop-color:#717516;stop-opacity:1"/></linearGradient><linearGradient id="e" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-79.1 149.53 -14.065) scale(73.28)"><stop offset="0" style="stop-color:#b0d939;stop-opacity:1"/><stop offset="1" style="stop-color:#eadb04;stop-opacity:1"/></linearGradient><linearGradient id="f" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-67.997 148.705 -15.558) scale(69.8226)"><stop offset="0" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".17" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".48" style="stop-color:#99be32;stop-opacity:1"/><stop offset="1" style="stop-color:#c0c40a;stop-opacity:1"/></linearGradient></defs></svg>',pMe=btoa(uMe),fMe="data:image/svg+xml;charset=utf-8;base64,"+pMe,mMe=fMe;/**
 * postprocessing v6.36.6 build Tue Dec 31 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van Rüschen
 * @license Zlib
 */var Dk=1/1e3,gMe=1e3,AMe=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(s){typeof document<"u"&&document.hidden!==void 0&&(s?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=s)}get delta(){return this._delta*Dk}get fixedDelta(){return this._fixedDelta*Dk}set fixedDelta(s){this._fixedDelta=s*gMe}get elapsed(){return this._elapsed*Dk}update(s){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(s!==void 0?s:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(s){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},yMe=(()=>{const s=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),t=new It;return t.setAttribute("position",new dt(s,3)),t.setAttribute("uv",new dt(e,2)),t})(),Jr=class EV{static get fullscreenGeometry(){return yMe}constructor(e="Pass",t=new sr,i=new x1){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new fe(EV.fullscreenGeometry,e),t.frustumCulled=!1,this.scene===null&&(this.scene=new sr),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=Io){}render(e,t,i,n,r){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof ci||t instanceof Yt||t instanceof si||t instanceof EV)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},bMe=class extends Jr{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(s,e,t,i,n){const r=s.state.buffers.stencil;r.setLocked(!1),r.setTest(!1)}},xMe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,yA="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Fie=class extends Ht{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Te(null),opacity:new Te(1)},blending:Fn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:xMe,vertexShader:yA})}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}getOpacity(s){return this.uniforms.opacity.value}setOpacity(s){this.uniforms.opacity.value=s}},Vie=class extends Jr{constructor(s,e=!0){super("CopyPass"),this.fullscreenMaterial=new Fie,this.needsSwap=!1,this.renderTarget=s,s===void 0&&(this.renderTarget=new ci(1,1,{minFilter:Ot,magFilter:Ot,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(s){this.autoResize=s}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(s){this.autoResize=s}render(s,e,t,i,n){this.fullscreenMaterial.inputBuffer=e.texture,s.setRenderTarget(this.renderToScreen?null:this.renderTarget),s.render(this.scene,this.camera)}setSize(s,e){this.autoResize&&this.renderTarget.setSize(s,e)}initialize(s,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==Pi?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":s!==null&&s.outputColorSpace===ft&&(this.renderTarget.texture.colorSpace=ft))}},Y9=new ge,tP=class extends Jr{constructor(s=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=s,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(s,e,t){this.color=s,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(s){this.overrideClearColor=s}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(s){this.overrideClearAlpha=s}render(s,e,t,i,n){const r=this.overrideClearColor,o=this.overrideClearAlpha,a=s.getClearAlpha(),l=r!==null,c=o>=0;l?(s.getClearColor(Y9),s.setClearColor(r,c?o:a)):c&&s.setClearAlpha(o),s.setRenderTarget(this.renderToScreen?null:e),s.clear(this.color,this.depth,this.stencil),l?s.setClearColor(Y9,a):c&&s.setClearAlpha(a)}},vMe=class extends Jr{constructor(s,e){super("MaskPass",s,e),this.needsSwap=!1,this.clearPass=new tP(!1,!1,!0),this.inverse=!1}set mainScene(s){this.scene=s}set mainCamera(s){this.camera=s}get inverted(){return this.inverse}set inverted(s){this.inverse=s}get clear(){return this.clearPass.enabled}set clear(s){this.clearPass.enabled=s}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(s){this.inverted=s}render(s,e,t,i,n){const r=s.getContext(),o=s.state.buffers,a=this.scene,l=this.camera,c=this.clearPass,h=this.inverted?0:1,d=1-h;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),o.stencil.setFunc(r.ALWAYS,h,4294967295),o.stencil.setClear(d),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(s,null):(c.render(s,e),c.render(s,t))),this.renderToScreen?(s.setRenderTarget(null),s.render(a,l)):(s.setRenderTarget(e),s.render(a,l),s.setRenderTarget(t),s.render(a,l)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(r.EQUAL,1,4294967295),o.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),o.stencil.setLocked(!0)}},wO=class{constructor(s=null,{depthBuffer:e=!0,stencilBuffer:t=!1,multisampling:i=0,frameBufferType:n}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,t,n,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Vie,this.depthTexture=null,this.passes=[],this.timer=new AMe,this.autoRenderToScreen=!0,this.setRenderer(s)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(s){const e=this.inputBuffer,t=this.multisampling;t>0&&s>0?(this.inputBuffer.samples=s,this.outputBuffer.samples=s,this.inputBuffer.dispose(),this.outputBuffer.dispose()):t!==s&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,s),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(s){if(this.renderer=s,s!==null){const e=s.getSize(new Q),t=s.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===Pi&&s.outputColorSpace===ft&&(this.inputBuffer.texture.colorSpace=ft,this.outputBuffer.texture.colorSpace=ft,this.inputBuffer.dispose(),this.outputBuffer.dispose()),s.autoClear=!1,this.setSize(e.width,e.height);for(const n of this.passes)n.initialize(s,t,i)}}replaceRenderer(s,e=!0){const t=this.renderer,i=t.domElement.parentNode;return this.setRenderer(s),e&&i!==null&&(i.removeChild(t.domElement),i.appendChild(s.domElement)),t}createDepthTexture(){const s=this.depthTexture=new Bp;return this.inputBuffer.depthTexture=s,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(s.format=cm,s.type=lm):s.type=Wr,s}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const s of this.passes)s.setDepthTexture(null)}}createBuffer(s,e,t,i){const n=this.renderer,r=n===null?new Q:n.getDrawingBufferSize(new Q),o={minFilter:Ot,magFilter:Ot,stencilBuffer:e,depthBuffer:s,type:t},a=new ci(r.width,r.height,o);return i>0&&(a.ignoreDepthForMultisampleCopy=!1,a.samples=i),t===Pi&&n!==null&&n.outputColorSpace===ft&&(a.texture.colorSpace=ft),a.texture.name="EffectComposer.Buffer",a.texture.generateMipmaps=!1,a}setMainScene(s){for(const e of this.passes)e.mainScene=s}setMainCamera(s){for(const e of this.passes)e.mainCamera=s}addPass(s,e){const t=this.passes,i=this.renderer,n=i.getDrawingBufferSize(new Q),r=i.getContext().getContextAttributes().alpha,o=this.inputBuffer.texture.type;if(s.setRenderer(i),s.setSize(n.width,n.height),s.initialize(i,r,o),this.autoRenderToScreen&&(t.length>0&&(t[t.length-1].renderToScreen=!1),s.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?t.splice(e,0,s):t.push(s),this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!0),s.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const a=this.createDepthTexture();for(s of t)s.setDepthTexture(a)}else s.setDepthTexture(this.depthTexture)}removePass(s){const e=this.passes,t=e.indexOf(s);if(t!==-1&&e.splice(t,1).length>0){if(this.depthTexture!==null){const r=(a,l)=>a||l.needsDepthTexture;e.reduce(r,!1)||(s.getDepthTexture()===this.depthTexture&&s.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&t===e.length&&(s.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const s=this.passes;this.deleteDepthTexture(),s.length>0&&(this.autoRenderToScreen&&(s[s.length-1].renderToScreen=!1),this.passes=[])}render(s){const e=this.renderer,t=this.copyPass;let i=this.inputBuffer,n=this.outputBuffer,r=!1,o,a,l;s===void 0&&(this.timer.update(),s=this.timer.getDelta());for(const c of this.passes)c.enabled&&(c.render(e,i,n,s,r),c.needsSwap&&(r&&(t.renderToScreen=c.renderToScreen,o=e.getContext(),a=e.state.buffers.stencil,a.setFunc(o.NOTEQUAL,1,4294967295),t.render(e,i,n,s,r),a.setFunc(o.EQUAL,1,4294967295)),l=i,i=n,n=l),c instanceof vMe?r=!0:c instanceof bMe&&(r=!1))}setSize(s,e,t){const i=this.renderer,n=i.getSize(new Q);(s===void 0||e===void 0)&&(s=n.width,e=n.height),(n.width!==s||n.height!==e)&&i.setSize(s,e,t);const r=i.getDrawingBufferSize(new Q);this.inputBuffer.setSize(r.width,r.height),this.outputBuffer.setSize(r.width,r.height);for(const o of this.passes)o.setSize(r.width,r.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const s of this.passes)s.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Jr.fullscreenGeometry.dispose()}},Ql={NONE:0,DEPTH:1,CONVOLUTION:2},qi={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},_Me=class{constructor(){this.shaderParts=new Map([[qi.FRAGMENT_HEAD,null],[qi.FRAGMENT_MAIN_UV,null],[qi.FRAGMENT_MAIN_IMAGE,null],[qi.VERTEX_HEAD,null],[qi.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Ql.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Ji}},Fk=!1,J9=class{constructor(s=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(s),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case Zi:t=this.materialsFlatShadedDoubleSide;break;case vn:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case Zi:t=this.materialsDoubleSide;break;case vn:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(s){if(!(s instanceof Ht))return s.clone();const e=s.uniforms,t=new Map;for(const n in e){const r=e[n].value;r.isRenderTargetTexture&&(e[n].value=null,t.set(n,r))}const i=s.clone();for(const n of t)e[n[0]].value=n[1],i.uniforms[n[0]].value=n[1];return i}setMaterial(s){if(this.disposeMaterials(),this.material=s,s!==null){const e=this.materials=[this.cloneMaterial(s),this.cloneMaterial(s),this.cloneMaterial(s)];for(const t of e)t.uniforms=Object.assign({},s.uniforms),t.side=us;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},s.uniforms),i.side=vn,i}),this.materialsDoubleSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},s.uniforms),i.side=Zi,i}),this.materialsFlatShaded=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},s.uniforms),i.flatShading=!0,i}),this.materialsFlatShadedBackSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},s.uniforms),i.flatShading=!0,i.side=vn,i}),this.materialsFlatShadedDoubleSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},s.uniforms),i.flatShading=!0,i.side=Zi,i})}}render(s,e,t){const i=s.shadowMap.enabled;if(s.shadowMap.enabled=!1,Fk){const n=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),s.render(e,t);for(const r of n)r[0].material=r[1];this.meshCount!==n.size&&n.clear()}else{const n=e.overrideMaterial;e.overrideMaterial=this.material,s.render(e,t),e.overrideMaterial=n}s.shadowMap.enabled=i}disposeMaterials(){if(this.material!==null){const s=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of s)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Fk}static set workaroundEnabled(s){Fk=s}},$p=-1,cn=class extends Mr{constructor(s,e=$p,t=$p,i=1){super(),this.resizable=s,this.baseSize=new Q(1,1),this.preferredSize=new Q(e,t),this.target=this.preferredSize,this.s=i,this.effectiveSize=new Q,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const s=this.baseSize,e=this.preferredSize,t=this.effectiveSize,i=this.scale;e.width!==$p?t.width=e.width:e.height!==$p?t.width=Math.round(e.height*(s.width/Math.max(s.height,1))):t.width=Math.round(s.width*i),e.height!==$p?t.height=e.height:e.width!==$p?t.height=Math.round(e.width/Math.max(s.width/Math.max(s.height,1),1)):t.height=Math.round(s.height*i)}get width(){return this.effectiveSize.width}set width(s){this.preferredWidth=s}get height(){return this.effectiveSize.height}set height(s){this.preferredHeight=s}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(s){this.s!==s&&(this.s=s,this.preferredSize.setScalar($p),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(s){this.scale=s}get baseWidth(){return this.baseSize.width}set baseWidth(s){this.baseSize.width!==s&&(this.baseSize.width=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(s){this.baseWidth=s}get baseHeight(){return this.baseSize.height}set baseHeight(s){this.baseSize.height!==s&&(this.baseSize.height=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(s){this.baseHeight=s}setBaseSize(s,e){(this.baseSize.width!==s||this.baseSize.height!==e)&&(this.baseSize.set(s,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(s){this.preferredSize.width!==s&&(this.preferredSize.width=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(s){this.preferredWidth=s}get preferredHeight(){return this.preferredSize.height}set preferredHeight(s){this.preferredSize.height!==s&&(this.preferredSize.height=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(s){this.preferredHeight=s}setPreferredSize(s,e){(this.preferredSize.width!==s||this.preferredSize.height!==e)&&(this.preferredSize.set(s,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(s){this.s=s.scale,this.baseSize.set(s.baseWidth,s.baseHeight),this.preferredSize.set(s.preferredWidth,s.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return $p}},CMe=class{constructor(s=0){this.nextId=s}getNextId(){return this.nextId++}reset(s=0){return this.nextId=s,this}},Vk=new CMe(2),wMe=class extends Set{constructor(s,e=Vk.getNextId()){super(),this.exclusive=!1,this._layer=e,(this._layer<1||this._layer>31)&&(console.warn("Layer out of range, resetting to 2"),Vk.reset(2),this._layer=Vk.getNextId()),s!==void 0&&this.set(s)}get layer(){return this._layer}set layer(s){const e=this._layer;for(const t of this)t.layers.disable(e),t.layers.enable(s);this._layer=s}getLayer(){return this.layer}setLayer(s){this.layer=s}isExclusive(){return this.exclusive}setExclusive(s){this.exclusive=s}clear(){const s=this.layer;for(const e of this)e.layers.disable(s);return super.clear()}set(s){this.clear();for(const e of s)this.add(e);return this}indexOf(s){return this.has(s)?0:-1}add(s){return this.exclusive?s.layers.set(this.layer):s.layers.enable(this.layer),super.add(s)}delete(s){return this.has(s)&&s.layers.disable(this.layer),super.delete(s)}toggle(s){let e;return this.has(s)?(this.delete(s),e=!1):(this.add(s),e=!0),e}setVisible(s){for(const e of this)s?e.layers.enable(0):e.layers.disable(0);return this}},ai={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},SMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",MMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",IMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",TMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",EMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",RMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",LMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",BMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",PMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",GMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",kMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",NMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",DMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",FMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",VMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",zMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",UMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",XMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",OMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",ZMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",WMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",HMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",QMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",KMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",YMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",JMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",jMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",qMe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",$Me="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",eIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",tIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",iIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",nIe=new Map([[ai.ADD,SMe],[ai.ALPHA,MMe],[ai.AVERAGE,IMe],[ai.COLOR,TMe],[ai.COLOR_BURN,EMe],[ai.COLOR_DODGE,RMe],[ai.DARKEN,LMe],[ai.DIFFERENCE,BMe],[ai.DIVIDE,PMe],[ai.DST,null],[ai.EXCLUSION,GMe],[ai.HARD_LIGHT,kMe],[ai.HARD_MIX,NMe],[ai.HUE,DMe],[ai.INVERT,FMe],[ai.INVERT_RGB,VMe],[ai.LIGHTEN,zMe],[ai.LINEAR_BURN,UMe],[ai.LINEAR_DODGE,XMe],[ai.LINEAR_LIGHT,OMe],[ai.LUMINOSITY,ZMe],[ai.MULTIPLY,WMe],[ai.NEGATION,HMe],[ai.NORMAL,QMe],[ai.OVERLAY,KMe],[ai.PIN_LIGHT,YMe],[ai.REFLECT,JMe],[ai.SATURATION,jMe],[ai.SCREEN,qMe],[ai.SOFT_LIGHT,$Me],[ai.SRC,eIe],[ai.SUBTRACT,tIe],[ai.VIVID_LIGHT,iIe]]),sIe=class extends Mr{constructor(s,e=1){super(),this._blendFunction=s,this.opacity=new Te(e)}getOpacity(){return this.opacity.value}setOpacity(s){this.opacity.value=s}get blendFunction(){return this._blendFunction}set blendFunction(s){this._blendFunction=s,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(s){this.blendFunction=s}getShaderCode(){return nIe.get(this.blendFunction)}},Xd={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},rIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,oIe="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",aIe=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],zie=class extends Ht{constructor(s=new Je){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Te(null),texelSize:new Te(new Je),scale:new Te(1),kernel:new Te(0)},blending:Fn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:rIe,vertexShader:oIe}),this.setTexelSize(s.x,s.y),this.kernelSize=Xd.MEDIUM}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.inputBuffer=s}get kernelSequence(){return aIe[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(s){this.uniforms.scale.value=s}getScale(){return this.uniforms.scale.value}setScale(s){this.uniforms.scale.value=s}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(s){this.uniforms.kernel.value=s}setKernel(s){this.kernel=s}setTexelSize(s,e){this.uniforms.texelSize.value.set(s,e,s*.5,e*.5)}setSize(s,e){const t=1/s,i=1/e;this.uniforms.texelSize.value.set(t,i,t*.5,i*.5)}},SO=class extends Jr{constructor({kernelSize:s=Xd.MEDIUM,resolutionScale:e=.5,width:t=cn.AUTO_SIZE,height:i=cn.AUTO_SIZE,resolutionX:n=t,resolutionY:r=i}={}){super("KawaseBlurPass"),this.renderTargetA=new ci(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new cn(this,n,r,e);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new zie,this._blurMaterial.kernelSize=s,this.copyMaterial=new Fie}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(s){this._blurMaterial=s}get dithering(){return this.copyMaterial.dithering}set dithering(s){this.copyMaterial.dithering=s}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(s){this.blurMaterial.kernelSize=s}get width(){return this.resolution.width}set width(s){this.resolution.preferredWidth=s}get height(){return this.resolution.height}set height(s){this.resolution.preferredHeight=s}get scale(){return this.blurMaterial.scale}set scale(s){this.blurMaterial.scale=s}getScale(){return this.blurMaterial.scale}setScale(s){this.blurMaterial.scale=s}getKernelSize(){return this.kernelSize}setKernelSize(s){this.kernelSize=s}getResolutionScale(){return this.resolution.scale}setResolutionScale(s){this.resolution.scale=s}render(s,e,t,i,n){const r=this.scene,o=this.camera,a=this.renderTargetA,l=this.renderTargetB,c=this.blurMaterial,h=c.kernelSequence;let d=e;this.fullscreenMaterial=c;for(let u=0,f=h.length;u<f;++u){const m=u&1?l:a;c.kernel=h[u],c.inputBuffer=d.texture,s.setRenderTarget(m),s.render(r,o),d=m}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=d.texture,s.setRenderTarget(this.renderToScreen?null:t),s.render(r,o)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e);const i=t.width,n=t.height;this.renderTargetA.setSize(i,n),this.renderTargetB.setSize(i,n),this.blurMaterial.setSize(s,e)}initialize(s,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==Pi?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):s!==null&&s.outputColorSpace===ft&&(this.renderTargetA.texture.colorSpace=ft,this.renderTargetB.texture.colorSpace=ft))}static get AUTO_SIZE(){return cn.AUTO_SIZE}},lIe=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l)*l;
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);
#else
gl_FragColor=vec4(l);
#endif
}`,cIe=class extends Ht{constructor(s=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:La.replace(/\D+/g,"")},uniforms:{inputBuffer:new Te(null),threshold:new Te(0),smoothing:new Te(1),range:new Te(null)},blending:Fn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:lIe,vertexShader:yA}),this.colorOutput=s,this.luminanceRange=e}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}get threshold(){return this.uniforms.threshold.value}set threshold(s){this.smoothing>0||s>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=s}getThreshold(){return this.threshold}setThreshold(s){this.threshold=s}get smoothing(){return this.uniforms.smoothing.value}set smoothing(s){this.threshold>0||s>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=s}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(s){this.smoothing=s}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(s){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(s){s?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(s){return this.colorOutput}setColorOutputEnabled(s){this.colorOutput=s}get useRange(){return this.luminanceRange!==null}set useRange(s){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(s){s!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=s,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(s){this.luminanceRange=s}},Uie=class extends Jr{constructor({renderTarget:s,luminanceRange:e,colorOutput:t,resolutionScale:i=1,width:n=cn.AUTO_SIZE,height:r=cn.AUTO_SIZE,resolutionX:o=n,resolutionY:a=r}={}){super("LuminancePass"),this.fullscreenMaterial=new cIe(t,e),this.needsSwap=!1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new ci(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const l=this.resolution=new cn(this,o,a,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(s,e,t,i,n){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,s.setRenderTarget(this.renderToScreen?null:this.renderTarget),s.render(this.scene,this.camera)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e),this.renderTarget.setSize(t.width,t.height)}initialize(s,e,t){t!==void 0&&t!==Pi&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},hIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,dIe="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",uIe=class extends Ht{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new Te(null),texelSize:new Te(new Q)},blending:Fn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:hIe,vertexShader:dIe})}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setSize(s,e){this.uniforms.texelSize.value.set(1/s,1/e)}},pIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,fIe="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",mIe=class extends Ht{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new Te(null),supportBuffer:new Te(null),texelSize:new Te(new Q),radius:new Te(.85)},blending:Fn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:pIe,vertexShader:fIe})}set inputBuffer(s){this.uniforms.inputBuffer.value=s}set supportBuffer(s){this.uniforms.supportBuffer.value=s}get radius(){return this.uniforms.radius.value}set radius(s){this.uniforms.radius.value=s}setSize(s,e){this.uniforms.texelSize.value.set(1/s,1/e)}},gIe=class extends Jr{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new ci(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new uIe,this.upsamplingMaterial=new mIe,this.resolution=new Q}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(s){if(this.levels!==s){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<s;++t){const i=e.clone();i.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(i)}this.upsamplingMipmaps.push(e);for(let t=1,i=s-1;t<i;++t){const n=e.clone();n.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(n)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(s){this.upsamplingMaterial.radius=s}render(s,e,t,i,n){const{scene:r,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:l}=this,{downsamplingMipmaps:c,upsamplingMipmaps:h}=this;let d=e;this.fullscreenMaterial=a;for(let u=0,f=c.length;u<f;++u){const m=c[u];a.setSize(d.width,d.height),a.inputBuffer=d.texture,s.setRenderTarget(m),s.render(r,o),d=m}this.fullscreenMaterial=l;for(let u=h.length-1;u>=0;--u){const f=h[u];l.setSize(d.width,d.height),l.inputBuffer=d.texture,l.supportBuffer=c[u].texture,s.setRenderTarget(f),s.render(r,o),d=f}}setSize(s,e){const t=this.resolution;t.set(s,e);let i=t.width,n=t.height;for(let r=0,o=this.downsamplingMipmaps.length;r<o;++r)i=Math.round(i*.5),n=Math.round(n*.5),this.downsamplingMipmaps[r].setSize(i,n),r<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[r].setSize(i,n)}initialize(s,e,t){if(t!==void 0){const i=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const n of i)n.texture.type=t;if(t!==Pi)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(s!==null&&s.outputColorSpace===ft)for(const n of i)n.texture.colorSpace=ft}}dispose(){super.dispose();for(const s of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))s.dispose()}},Na=class extends Mr{constructor(s,e,{attributes:t=Ql.NONE,blendFunction:i=ai.NORMAL,defines:n=new Map,uniforms:r=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=s,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=a,this.defines=n,this.uniforms=r,this.extensions=o,this.blendMode=new sIe(i),this.blendMode.addEventListener("change",l=>this.setChanged()),this._inputColorSpace=Ji,this._outputColorSpace=Fr}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(s){this._inputColorSpace=s,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(s){this._outputColorSpace=s,this.setChanged()}set mainScene(s){}set mainCamera(s){}getName(){return this.name}setRenderer(s){this.renderer=s}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(s){this.attributes=s,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(s){this.fragmentShader=s,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(s){this.vertexShader=s,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(s,e=Io){}update(s,e,t){}setSize(s,e){}initialize(s,e,t){}dispose(){for(const s of Object.keys(this)){const e=this[s];(e instanceof ci||e instanceof Yt||e instanceof si||e instanceof Jr)&&this[s].dispose()}}},AIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,MO=class extends Na{constructor({blendFunction:e=ai.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,mipmapBlur:n=!1,intensity:r=1,radius:o=.85,levels:a=8,kernelSize:l=Xd.LARGE,resolutionScale:c=.5,width:h=cn.AUTO_SIZE,height:d=cn.AUTO_SIZE,resolutionX:u=h,resolutionY:f=d}={}){super("BloomEffect",AIe,{blendFunction:e,uniforms:new Map([["map",new Te(null)],["intensity",new Te(r)]])}),this.renderTarget=new ci(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new SO({kernelSize:l}),this.luminancePass=new Uie({colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothing=i,this.mipmapBlurPass=new gIe,this.mipmapBlurPass.enabled=n,this.mipmapBlurPass.radius=o,this.mipmapBlurPass.levels=a,this.uniforms.get("map").value=n?this.mipmapBlurPass.texture:this.renderTarget.texture;const m=this.resolution=new cn(this,u,f,c);m.addEventListener("change",g=>this.setSize(m.baseWidth,m.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){const n=this.renderTarget,r=this.luminancePass;r.enabled?(r.render(e,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,r.renderTarget):this.blurPass.render(e,r.renderTarget,n)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,t):this.blurPass.render(e,t,n)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i),this.luminancePass.setSize(e,t),this.mipmapBlurPass.setSize(e,t)}initialize(e,t,i){this.blurPass.initialize(e,t,i),this.luminancePass.initialize(e,t,i),this.mipmapBlurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e!==null&&e.outputColorSpace===ft&&(this.renderTarget.texture.colorSpace=ft))}},yIe="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(color+vec3(0.5),inputColor.a);}",Xie=class extends Na{constructor({blendFunction:s=ai.SRC,brightness:e=0,contrast:t=0}={}){super("BrightnessContrastEffect",yIe,{blendFunction:s,uniforms:new Map([["brightness",new Te(e)],["contrast",new Te(t)]])}),this.inputColorSpace=ft}get brightness(){return this.uniforms.get("brightness").value}set brightness(s){this.uniforms.get("brightness").value=s}getBrightness(){return this.brightness}setBrightness(s){this.brightness=s}get contrast(){return this.uniforms.get("contrast").value}set contrast(s){this.uniforms.get("contrast").value=s}getContrast(){return this.contrast}setContrast(s){this.contrast=s}},bIe=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,xIe="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",Oie=class extends Na{constructor({offset:s=new Q(.001,5e-4),radialModulation:e=!1,modulationOffset:t=.15}={}){super("ChromaticAberrationEffect",bIe,{vertexShader:xIe,attributes:Ql.CONVOLUTION,uniforms:new Map([["offset",new Te(s)],["modulationOffset",new Te(t)]])}),this.radialModulation=e}get offset(){return this.uniforms.get("offset").value}set offset(s){this.uniforms.get("offset").value=s}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(s){s?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(s){this.uniforms.get("modulationOffset").value=s}getOffset(){return this.offset}setOffset(s){this.offset=s}},Zie={RED:0,GREEN:1,BLUE:2,ALPHA:3},Wie={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},vIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,mT=class extends Ht{constructor(s=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:s?"2":"1"},uniforms:{inputBuffer:new Te(null),cocBuffer:new Te(null),texelSize:new Te(new Q),kernel64:new Te(null),kernel16:new Te(null),scale:new Te(1)},blending:Fn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:vIe,vertexShader:yA}),e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}set cocBuffer(s){this.uniforms.cocBuffer.value=s}setCoCBuffer(s){this.uniforms.cocBuffer.value=s}get scale(){return this.uniforms.scale.value}set scale(s){this.uniforms.scale.value=s}getScale(s){return this.scale}setScale(s){this.scale=s}generateKernel(){const s=2.39996323,e=new Float64Array(128),t=new Float64Array(32);let i=0,n=0;for(let r=0,o=Math.sqrt(80);r<80;++r){const a=r*s,l=Math.sqrt(r)/o,c=l*Math.cos(a),h=l*Math.sin(a);r%5===0?(t[n++]=c,t[n++]=h):(e[i++]=c,e[i++]=h)}this.uniforms.kernel64.value=e,this.uniforms.kernel16.value=t}setTexelSize(s,e){this.uniforms.texelSize.value.set(s,e)}setSize(s,e){this.uniforms.texelSize.value.set(1/s,1/e)}};function Mb(s,e,t){return s*(e-t)-e}function d0(s,e,t){return Math.min(Math.max((s+e)/(e-t),0),1)}var _Ie=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#ifdef LOG_DEPTH
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,CIe=class extends Ht{constructor(s){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Te(null),focusDistance:new Te(0),focusRange:new Te(0),cameraNear:new Te(.3),cameraFar:new Te(1e3)},blending:Fn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:_Ie,vertexShader:yA}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(s)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(s){this.uniforms.depthBuffer.value=s}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,e=Io){this.depthBuffer=s,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(s){this.uniforms.focusDistance.value=s}get worldFocusDistance(){return-Mb(this.focusDistance,this.near,this.far)}set worldFocusDistance(s){this.focusDistance=d0(-s,this.near,this.far)}getFocusDistance(s){this.uniforms.focusDistance.value=s}setFocusDistance(s){this.uniforms.focusDistance.value=s}get focalLength(){return this.focusRange}set focalLength(s){this.focusRange=s}get focusRange(){return this.uniforms.focusRange.value}set focusRange(s){this.uniforms.focusRange.value=s}get worldFocusRange(){return-Mb(this.focusRange,this.near,this.far)}set worldFocusRange(s){this.focusRange=d0(-s,this.near,this.far)}getFocalLength(s){return this.focusRange}setFocalLength(s){this.focusRange=s}adoptCameraSettings(s){this.copyCameraSettings(s)}copyCameraSettings(s){s&&(this.uniforms.cameraNear.value=s.near,this.uniforms.cameraFar.value=s.far,s instanceof Xt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},wIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,SIe=class extends Ht{constructor(s=null){super({name:"MaskMaterial",uniforms:{maskTexture:new Te(s),inputBuffer:new Te(null),strength:new Te(1)},blending:Fn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:wIe,vertexShader:yA}),this.colorChannel=Zie.RED,this.maskFunction=Wie.DISCARD}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}set maskTexture(s){this.uniforms.maskTexture.value=s,delete this.defines.MASK_PRECISION_HIGH,s.type!==Pi&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(s){this.maskTexture=s}set colorChannel(s){this.defines.COLOR_CHANNEL=s.toFixed(0),this.needsUpdate=!0}setColorChannel(s){this.colorChannel=s}set maskFunction(s){this.defines.MASK_FUNCTION=s.toFixed(0),this.needsUpdate=!0}setMaskFunction(s){this.maskFunction=s}get inverted(){return this.defines.INVERTED!==void 0}set inverted(s){this.inverted&&!s?delete this.defines.INVERTED:s&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(s){this.inverted=s}get strength(){return this.uniforms.strength.value}set strength(s){this.uniforms.strength.value=s}getStrength(){return this.strength}setStrength(s){this.strength=s}},md=class extends Jr{constructor(s,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=s,this.input=e}setInput(s){this.input=s}render(s,e,t,i,n){const r=this.fullscreenMaterial.uniforms;e!==null&&r!==void 0&&r[this.input]!==void 0&&(r[this.input].value=e.texture),s.setRenderTarget(this.renderToScreen?null:t),s.render(this.scene,this.camera)}initialize(s,e,t){t!==void 0&&t!==Pi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},MIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform lowp sampler2D farCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,Hie=class extends Na{constructor(s,{blendFunction:e,worldFocusDistance:t,worldFocusRange:i,focusDistance:n=0,focalLength:r=.1,focusRange:o=r,bokehScale:a=1,resolutionScale:l=1,width:c=cn.AUTO_SIZE,height:h=cn.AUTO_SIZE,resolutionX:d=c,resolutionY:u=h}={}){super("DepthOfFieldEffect",MIe,{blendFunction:e,attributes:Ql.DEPTH,uniforms:new Map([["nearColorBuffer",new Te(null)],["farColorBuffer",new Te(null)],["nearCoCBuffer",new Te(null)],["farCoCBuffer",new Te(null)],["scale",new Te(1)]])}),this.camera=s,this.renderTarget=new ci(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new md(new CIe(s));const f=this.cocMaterial;f.focusDistance=n,f.focusRange=o,t!==void 0&&(f.worldFocusDistance=t),i!==void 0&&(f.worldFocusRange=i),this.blurPass=new SO({resolutionScale:l,resolutionX:d,resolutionY:u,kernelSize:Xd.MEDIUM}),this.maskPass=new md(new SIe(this.renderTargetCoC.texture));const m=this.maskPass.fullscreenMaterial;m.colorChannel=Zie.GREEN,this.maskFunction=Wie.MULTIPLY_RGB,this.bokehNearBasePass=new md(new mT(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new md(new mT(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new md(new mT(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new md(new mT(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const g=this.resolution=new cn(this,d,u,l);g.addEventListener("change",A=>this.setSize(g.baseWidth,g.baseHeight)),this.bokehScale=a}set mainCamera(s){this.camera=s,this.cocMaterial.copyCameraSettings(s)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(s){this.maskFunction!==s&&(this.defines.set("MASK_FUNCTION",s.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=s,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(s){this.bokehNearBasePass.fullscreenMaterial.scale=s,this.bokehNearFillPass.fullscreenMaterial.scale=s,this.bokehFarBasePass.fullscreenMaterial.scale=s,this.bokehFarFillPass.fullscreenMaterial.scale=s,this.maskPass.fullscreenMaterial.strength=s,this.uniforms.get("scale").value=s}getBokehScale(){return this.bokehScale}setBokehScale(s){this.bokehScale=s}getTarget(){return this.target}setTarget(s){this.target=s}calculateFocusDistance(s){const e=this.camera,t=e.position.distanceTo(s);return d0(-t,e.near,e.far)}setDepthTexture(s,e=Io){this.cocMaterial.depthBuffer=s,this.cocMaterial.depthPacking=e}update(s,e,t){const i=this.renderTarget,n=this.renderTargetCoC,r=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(this.target!==null){const a=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=a}this.cocPass.render(s,null,n),this.blurPass.render(s,n,r),this.maskPass.render(s,e,o),this.bokehFarBasePass.render(s,o,i),this.bokehFarFillPass.render(s,i,this.renderTargetFar),this.bokehNearBasePass.render(s,e,i),this.bokehNearFillPass.render(s,i,this.renderTargetNear)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e);const i=t.width,n=t.height;this.cocPass.setSize(s,e),this.blurPass.setSize(s,e),this.maskPass.setSize(s,e),this.renderTargetFar.setSize(s,e),this.renderTargetCoC.setSize(s,e),this.renderTargetMasked.setSize(s,e),this.renderTarget.setSize(i,n),this.renderTargetNear.setSize(i,n),this.renderTargetCoCBlurred.setSize(i,n),this.bokehNearBasePass.fullscreenMaterial.setSize(s,e),this.bokehNearFillPass.fullscreenMaterial.setSize(s,e),this.bokehFarBasePass.fullscreenMaterial.setSize(s,e),this.bokehFarFillPass.fullscreenMaterial.setSize(s,e)}initialize(s,e,t){this.cocPass.initialize(s,e,t),this.maskPass.initialize(s,e,t),this.bokehNearBasePass.initialize(s,e,t),this.bokehNearFillPass.initialize(s,e,t),this.bokehFarBasePass.initialize(s,e,t),this.bokehFarFillPass.initialize(s,e,t),this.blurPass.initialize(s,e,Pi),s.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),t!==void 0&&(this.renderTarget.texture.type=t,this.renderTargetNear.texture.type=t,this.renderTargetFar.texture.type=t,this.renderTargetMasked.texture.type=t,s!==null&&s.outputColorSpace===ft&&(this.renderTarget.texture.colorSpace=ft,this.renderTargetNear.texture.colorSpace=ft,this.renderTargetFar.texture.colorSpace=ft,this.renderTargetMasked.texture.colorSpace=ft))}};function IIe(s,e,t){const i=new Map([[A1,1],[Vl,1],[Pc,2],[bi,4]]);let n;if(i.has(e)||console.error("Invalid noise texture format"),t===Pi){n=new Uint8Array(s*i.get(e));for(let r=0,o=n.length;r<o;++r)n[r]=Math.random()*255+.5}else{n=new Float32Array(s*i.get(e));for(let r=0,o=n.length;r<o;++r)n[r]=Math.random()}return n}var TIe=class extends ir{constructor(s,e,t=A1,i=Pi){super(IIe(s*e,t,i),s,e,t,i),this.needsUpdate=!0}},jC={DEFAULT:0,KEEP_MAX_DEPTH:1,DISCARD_MAX_DEPTH:2},EIe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer0;uniform highp sampler2D depthBuffer1;
#else
uniform mediump sampler2D depthBuffer0;uniform mediump sampler2D depthBuffer1;
#endif
uniform sampler2D inputBuffer;uniform vec2 cameraNearFar;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}varying vec2 vUv;void main(){vec2 depth;
#if DEPTH_PACKING_0 == 3201
depth.x=unpackRGBAToDepth(texture2D(depthBuffer0,vUv));
#else
depth.x=texture2D(depthBuffer0,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.x*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.x=a+b/d;
#endif
#endif
#if DEPTH_PACKING_1 == 3201
depth.y=unpackRGBAToDepth(texture2D(depthBuffer1,vUv));
#else
depth.y=texture2D(depthBuffer1,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.y*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.y=a+b/d;
#endif
#endif
bool isMaxDepth=(depth.x==1.0);
#ifdef PERSPECTIVE_CAMERA
depth.x=viewZToOrthographicDepth(getViewZ(depth.x),cameraNearFar.x,cameraNearFar.y);depth.y=viewZToOrthographicDepth(getViewZ(depth.y),cameraNearFar.x,cameraNearFar.y);
#endif
#if DEPTH_TEST_STRATEGY == 0
bool keep=depthTest(depth.x,depth.y);
#elif DEPTH_TEST_STRATEGY == 1
bool keep=isMaxDepth||depthTest(depth.x,depth.y);
#else
bool keep=!isMaxDepth&&depthTest(depth.x,depth.y);
#endif
if(keep){gl_FragColor=texture2D(inputBuffer,vUv);}else{discard;}}`,RIe=class extends Ht{constructor(){super({name:"DepthMaskMaterial",defines:{DEPTH_EPSILON:"0.0001",DEPTH_PACKING_0:"0",DEPTH_PACKING_1:"0",DEPTH_TEST_STRATEGY:jC.KEEP_MAX_DEPTH},uniforms:{inputBuffer:new Te(null),depthBuffer0:new Te(null),depthBuffer1:new Te(null),cameraNearFar:new Te(new Q(1,1))},blending:Fn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:EIe,vertexShader:yA}),this.depthMode=U0}set depthBuffer0(s){this.uniforms.depthBuffer0.value=s}set depthPacking0(s){this.defines.DEPTH_PACKING_0=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer0(s,e=Io){this.depthBuffer0=s,this.depthPacking0=e}set depthBuffer1(s){this.uniforms.depthBuffer1.value=s}set depthPacking1(s){this.defines.DEPTH_PACKING_1=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer1(s,e=Io){this.depthBuffer1=s,this.depthPacking1=e}get maxDepthStrategy(){return Number(this.defines.DEPTH_TEST_STRATEGY)}set maxDepthStrategy(s){this.defines.DEPTH_TEST_STRATEGY=s.toFixed(0),this.needsUpdate=!0}get keepFar(){return this.maxDepthStrategy}set keepFar(s){this.maxDepthStrategy=s?jC.KEEP_MAX_DEPTH:jC.DISCARD_MAX_DEPTH}getMaxDepthStrategy(){return this.maxDepthStrategy}setMaxDepthStrategy(s){this.maxDepthStrategy=s}get epsilon(){return Number(this.defines.DEPTH_EPSILON)}set epsilon(s){this.defines.DEPTH_EPSILON=s.toFixed(16),this.needsUpdate=!0}getEpsilon(){return this.epsilon}setEpsilon(s){this.epsilon=s}get depthMode(){return Number(this.defines.DEPTH_MODE)}set depthMode(s){let e;switch(s){case Mw:e="false";break;case lx:e="true";break;case rm:e="abs(d1 - d0) <= DEPTH_EPSILON";break;case X0:e="abs(d1 - d0) > DEPTH_EPSILON";break;case U0:e="d0 > d1";break;case wp:e="d0 >= d1";break;case cx:e="d0 <= d1";break;case hx:default:e="d0 < d1";break}this.defines.DEPTH_MODE=s.toFixed(0),this.defines["depthTest(d0, d1)"]=e,this.needsUpdate=!0}getDepthMode(){return this.depthMode}setDepthMode(s){this.depthMode=s}adoptCameraSettings(s){this.copyCameraSettings(s)}copyCameraSettings(s){s&&(this.uniforms.cameraNearFar.value.set(s.near,s.far),s instanceof Xt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},iP=class extends Jr{constructor(s,e,t=null){super("RenderPass",s,e),this.needsSwap=!1,this.clearPass=new tP,this.overrideMaterialManager=t===null?null:new J9(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(s){this.scene=s}set mainCamera(s){this.camera=s}get renderToScreen(){return super.renderToScreen}set renderToScreen(s){super.renderToScreen=s,this.clearPass.renderToScreen=s}get overrideMaterial(){const s=this.overrideMaterialManager;return s!==null?s.material:null}set overrideMaterial(s){const e=this.overrideMaterialManager;s!==null?e!==null?e.setMaterial(s):this.overrideMaterialManager=new J9(s):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(s){this.overrideMaterial=s}get clear(){return this.clearPass.enabled}set clear(s){this.clearPass.enabled=s}getSelection(){return this.selection}setSelection(s){this.selection=s}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(s){this.ignoreBackground=s}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(s){this.skipShadowMapUpdate=s}getClearPass(){return this.clearPass}render(s,e,t,i,n){const r=this.scene,o=this.camera,a=this.selection,l=o.layers.mask,c=r.background,h=s.shadowMap.autoUpdate,d=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(s.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(r.background=null),this.clearPass.enabled&&this.clearPass.render(s,e),s.setRenderTarget(d),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(s,r,o):s.render(r,o),o.layers.mask=l,r.background=c,s.shadowMap.autoUpdate=h}},LIe="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",Qie=class extends Na{constructor({blendFunction:s=ai.SRC,hue:e=0,saturation:t=0}={}){super("HueSaturationEffect",LIe,{blendFunction:s,uniforms:new Map([["hue",new Te(new T)],["saturation",new Te(t)]])}),this.hue=e}get saturation(){return this.uniforms.get("saturation").value}set saturation(s){this.uniforms.get("saturation").value=s}getSaturation(){return this.saturation}setSaturation(s){this.saturation=s}get hue(){const s=this.uniforms.get("hue").value;return Math.acos((s.x*3-1)/2)}set hue(s){const e=Math.sin(s),t=Math.cos(s);this.uniforms.get("hue").value.set((2*t+1)/3,(-Math.sqrt(3)*e-t+1)/3,(Math.sqrt(3)*e-t+1)/3)}getHue(){return this.hue}setHue(s){this.hue=s}},IO={DEPTH:0,LUMA:1,COLOR:2},BIe={DISABLED:0,DEPTH:1,CUSTOM:2},$g={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},gr={LINEAR:0,REINHARD:1,REINHARD2:2,REINHARD2_ADAPTIVE:3,UNCHARTED2:4,OPTIMIZED_CINEON:5,CINEON:5,ACES_FILMIC:6,AGX:7,NEUTRAL:8},o_={DEFAULT:0,ESKIL:1},PIe=class extends Jr{constructor(s,e,{renderTarget:t,resolutionScale:i=1,width:n=cn.AUTO_SIZE,height:r=cn.AUTO_SIZE,resolutionX:o=n,resolutionY:a=r}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new iP(s,e,new v1({depthPacking:j2}));const l=this.renderPass;l.skipShadowMapUpdate=!0,l.ignoreBackground=!0;const c=l.clearPass;c.overrideClearColor=new ge(16777215),c.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new ci(1,1,{minFilter:qt,magFilter:qt}),this.renderTarget.texture.name="DepthPass.Target");const h=this.resolution=new cn(this,o,a,i);h.addEventListener("change",d=>this.setSize(h.baseWidth,h.baseHeight))}set mainScene(s){this.renderPass.mainScene=s}set mainCamera(s){this.renderPass.mainCamera=s}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(s){this.resolution.scale=s}render(s,e,t,i,n){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(s,r)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e),this.renderTarget.setSize(t.width,t.height)}},GIe="uniform bool active;uniform vec4 d;void mainUv(inout vec2 uv){if(active){uv=d.xy*(floor(uv*d.zw)+0.5);}}",Kie=class extends Na{constructor(e=30){super("PixelationEffect",GIe,{uniforms:new Map([["active",new Te(!1)],["d",new Te(new Je)]])}),this.resolution=new Q,this._granularity=0,this.granularity=e}get granularity(){return this._granularity}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this._granularity=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){const i=this.resolution;i.set(e,t);const n=this.granularity,r=n/i.x,o=n/i.y;this.uniforms.get("d").value.set(r,o,1/r,1/o)}},Yie=class extends MO{constructor(s,e,t){super(t),this.setAttributes(this.getAttributes()|Ql.DEPTH),this.camera=e,this.depthPass=new PIe(s,e),this.clearPass=new tP(!0,!1,!1),this.clearPass.overrideClearColor=new ge(0),this.depthMaskPass=new md(new RIe);const i=this.depthMaskMaterial;i.copyCameraSettings(e),i.depthBuffer1=this.depthPass.texture,i.depthPacking1=j2,i.depthMode=rm,this.renderTargetMasked=new ci(1,1,{depthBuffer:!1}),this.renderTargetMasked.texture.name="Bloom.Masked",this.selection=new wMe,this._inverted=!1,this._ignoreBackground=!1}set mainScene(s){this.depthPass.mainScene=s}set mainCamera(s){this.camera=s,this.depthPass.mainCamera=s,this.depthMaskMaterial.copyCameraSettings(s)}getSelection(){return this.selection}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get inverted(){return this._inverted}set inverted(s){this._inverted=s,this.depthMaskMaterial.depthMode=s?X0:rm}isInverted(){return this.inverted}setInverted(s){this.inverted=s}get ignoreBackground(){return this._ignoreBackground}set ignoreBackground(s){this._ignoreBackground=s,this.depthMaskMaterial.maxDepthStrategy=s?jC.DISCARD_MAX_DEPTH:jC.KEEP_MAX_DEPTH}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(s){this.ignoreBackground=s}setDepthTexture(s,e=Io){this.depthMaskMaterial.depthBuffer0=s,this.depthMaskMaterial.depthPacking0=e}update(s,e,t){const i=this.camera,n=this.selection,r=this.inverted;let o=e;if(this.ignoreBackground||!r||n.size>0){const a=i.layers.mask;i.layers.set(n.layer),this.depthPass.render(s),i.layers.mask=a,o=this.renderTargetMasked,this.clearPass.render(s,o),this.depthMaskPass.render(s,e,o)}super.update(s,o,t)}setSize(s,e){super.setSize(s,e),this.renderTargetMasked.setSize(s,e),this.depthPass.setSize(s,e)}initialize(s,e,t){super.initialize(s,e,t),this.clearPass.initialize(s,e,t),this.depthPass.initialize(s,e,t),this.depthMaskPass.initialize(s,e,t),s!==null&&s.capabilities.logarithmicDepthBuffer&&(this.depthMaskPass.fullscreenMaterial.defines.LOG_DEPTH="1"),t!==void 0&&(this.renderTargetMasked.texture.type=t,s!==null&&s.outputColorSpace===ft&&(this.renderTargetMasked.texture.colorSpace=ft))}},kIe=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,NIe=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,DIe=class extends Ht{constructor(s=new Q,e=IO.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:La.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new Te(null),depthBuffer:new Te(null),predicationBuffer:new Te(null),texelSize:new Te(s)},blending:Fn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:kIe,vertexShader:NIe}),this.edgeDetectionMode=e}set depthBuffer(s){this.uniforms.depthBuffer.value=s}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,e=Io){this.depthBuffer=s,this.depthPacking=e}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(s){this.defines.EDGE_DETECTION_MODE=s.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(s){this.edgeDetectionMode=s}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(s){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=s.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(s){this.localContrastAdaptationFactor=s}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(s){this.defines.EDGE_THRESHOLD=s.toFixed("6"),this.defines.DEPTH_THRESHOLD=(s*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(s){this.edgeDetectionThreshold=s}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(s){this.defines.PREDICATION_MODE=s.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(s){this.predicationMode=s}set predicationBuffer(s){this.uniforms.predicationBuffer.value=s}setPredicationBuffer(s){this.uniforms.predicationBuffer.value=s}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(s){this.defines.PREDICATION_THRESHOLD=s.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(s){this.predicationThreshold=s}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(s){this.defines.PREDICATION_SCALE=s.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(s){this.predicationScale=s}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(s){this.defines.PREDICATION_STRENGTH=s.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(s){this.predicationStrength=s}setSize(s,e){this.uniforms.texelSize.value.set(1/s,1/e)}},FIe=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,VIe="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",zIe=class extends Ht{constructor(s=new Q,e=new Q){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new Te(null),searchTexture:new Te(null),areaTexture:new Te(null),resolution:new Te(e),texelSize:new Te(s)},blending:Fn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:FIe,vertexShader:VIe})}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(s){this.uniforms.searchTexture.value=s}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(s){this.uniforms.areaTexture.value=s}setLookupTextures(s,e){this.searchTexture=s,this.areaTexture=e}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(s){const e=Math.min(Math.max(s,0),112);this.defines.MAX_SEARCH_STEPS_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(s){this.orthogonalSearchSteps=s}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(s){const e=Math.min(Math.max(s,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(s){this.diagonalSearchSteps=s}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(s){s?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(s){this.diagonalDetection=s}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(s){const e=Math.min(Math.max(s,0),100);this.defines.CORNER_ROUNDING=e.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(e/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(s){this.cornerRounding=s}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(s){s?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(s){this.cornerDetection=s}setSize(s,e){const t=this.uniforms;t.texelSize.value.set(1/s,1/e),t.resolution.value.set(s,e)}},j9="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",q9="data:image/png;base64,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",UIe="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",XIe="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",Jie=class extends Na{constructor({blendFunction:s=ai.SRC,preset:e=$g.MEDIUM,edgeDetectionMode:t=IO.COLOR,predicationMode:i=BIe.DISABLED}={}){super("SMAAEffect",UIe,{vertexShader:XIe,blendFunction:s,attributes:Ql.CONVOLUTION|Ql.DEPTH,uniforms:new Map([["weightMap",new Te(null)]])});let n,r;arguments.length>1&&(n=arguments[0],r=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new ci(1,1,{depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new tP(!0,!1,!1),this.clearPass.overrideClearColor=new ge(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new md(new DIe),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new md(new zIe);const o=new xB;o.onLoad=()=>{const a=new si(n);a.name="SMAA.Search",a.magFilter=qt,a.minFilter=qt,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;const l=new si(r);l.name="SMAA.Area",l.magFilter=Ot,l.minFilter=Ot,l.generateMipmaps=!1,l.needsUpdate=!0,l.flipY=!1,this.weightsMaterial.areaTexture=l,this.dispatchEvent({type:"load"})},o.itemStart("search"),o.itemStart("area"),n!==void 0&&r!==void 0?(o.itemEnd("search"),o.itemEnd("area")):typeof Image<"u"&&(n=new Image,r=new Image,n.addEventListener("load",()=>o.itemEnd("search")),r.addEventListener("load",()=>o.itemEnd("area")),n.src=j9,r.src=q9),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(s){this.edgeDetectionMaterial.edgeDetectionThreshold=s}setOrthogonalSearchSteps(s){this.weightsMaterial.orthogonalSearchSteps=s}applyPreset(s){const e=this.edgeDetectionMaterial,t=this.weightsMaterial;switch(s){case $g.LOW:e.edgeDetectionThreshold=.15,t.orthogonalSearchSteps=4,t.diagonalDetection=!1,t.cornerDetection=!1;break;case $g.MEDIUM:e.edgeDetectionThreshold=.1,t.orthogonalSearchSteps=8,t.diagonalDetection=!1,t.cornerDetection=!1;break;case $g.HIGH:e.edgeDetectionThreshold=.1,t.orthogonalSearchSteps=16,t.diagonalSearchSteps=8,t.cornerRounding=25,t.diagonalDetection=!0,t.cornerDetection=!0;break;case $g.ULTRA:e.edgeDetectionThreshold=.05,t.orthogonalSearchSteps=32,t.diagonalSearchSteps=16,t.cornerRounding=25,t.diagonalDetection=!0,t.cornerDetection=!0;break}}setDepthTexture(s,e=Io){this.edgeDetectionMaterial.depthBuffer=s,this.edgeDetectionMaterial.depthPacking=e}update(s,e,t){this.clearPass.render(s,this.renderTargetEdges),this.edgeDetectionPass.render(s,e,this.renderTargetEdges),this.weightsPass.render(s,this.renderTargetEdges,this.renderTargetWeights)}setSize(s,e){this.edgeDetectionMaterial.setSize(s,e),this.weightsMaterial.setSize(s,e),this.renderTargetEdges.setSize(s,e),this.renderTargetWeights.setSize(s,e)}dispose(){const{searchTexture:s,areaTexture:e}=this.weightsMaterial;s!==null&&e!==null&&(s.dispose(),e.dispose()),super.dispose()}static get searchImageDataURL(){return j9}static get areaImageDataURL(){return q9}},OIe=`#include <common>
#include <packing>
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}
#else
uniform lowp sampler2D normalBuffer;
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
uniform lowp sampler2D noiseTexture;uniform mat4 inverseProjectionMatrix;uniform mat4 projectionMatrix;uniform vec2 texelSize;uniform vec2 cameraNearFar;uniform float intensity;uniform float minRadiusScale;uniform float fade;uniform float bias;uniform vec2 distanceCutoff;uniform vec2 proximityCutoff;varying vec2 vUv;varying vec2 vUv2;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(inverseProjectionMatrix*clipPosition).xyz;}float getAmbientOcclusion(const in vec3 p,const in vec3 n,const in float depth,const in vec2 uv){float radiusScale=1.0-smoothstep(0.0,distanceCutoff.y,depth);radiusScale=radiusScale*(1.0-minRadiusScale)+minRadiusScale;float radius=RADIUS*radiusScale;float noise=texture2D(noiseTexture,vUv2).r;float baseAngle=noise*PI2;float rings=SPIRAL_TURNS*PI2;float occlusion=0.0;int taps=0;for(int i=0;i<SAMPLES_INT;++i){float alpha=(float(i)+0.5)*INV_SAMPLES_FLOAT;float angle=alpha*rings+baseAngle;vec2 rotation=vec2(cos(angle),sin(angle));vec2 coords=alpha*radius*rotation*texelSize+uv;if(coords.s<0.0||coords.s>1.0||coords.t<0.0||coords.t>1.0){continue;}float sampleDepth=readDepth(coords);float viewZ=getViewZ(sampleDepth);
#ifdef PERSPECTIVE_CAMERA
float linearSampleDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearSampleDepth=sampleDepth;
#endif
float proximity=abs(depth-linearSampleDepth);if(proximity<proximityCutoff.y){float falloff=1.0-smoothstep(proximityCutoff.x,proximityCutoff.y,proximity);vec3 Q=getViewPosition(coords,sampleDepth,viewZ);vec3 v=Q-p;float vv=dot(v,v);float vn=dot(v,n)-bias;float f=max(RADIUS_SQ-vv,0.0)/RADIUS_SQ;occlusion+=(f*f*f*max(vn/(fade+vv),0.0))*falloff;}++taps;}return occlusion/(4.0*max(float(taps),1.0));}void main(){
#ifdef NORMAL_DEPTH
vec4 normalDepth=texture2D(normalDepthBuffer,vUv);
#else
vec4 normalDepth=vec4(texture2D(normalBuffer,vUv).xyz,readDepth(vUv));
#endif
float ao=0.0;float depth=normalDepth.a;float viewZ=getViewZ(depth);
#ifdef PERSPECTIVE_CAMERA
float linearDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearDepth=depth;
#endif
if(linearDepth<distanceCutoff.y){vec3 viewPosition=getViewPosition(vUv,depth,viewZ);vec3 viewNormal=unpackRGBToNormal(normalDepth.rgb);ao+=getAmbientOcclusion(viewPosition,viewNormal,linearDepth,vUv);float d=smoothstep(distanceCutoff.x,distanceCutoff.y,linearDepth);ao=mix(ao,0.0,d);
#ifdef LEGACY_INTENSITY
ao=clamp(1.0-pow(1.0-ao,abs(intensity)),0.0,1.0);
#endif
}gl_FragColor.r=ao;}`,ZIe="uniform vec2 noiseScale;varying vec2 vUv;varying vec2 vUv2;void main(){vUv=position.xy*0.5+0.5;vUv2=vUv*noiseScale;gl_Position=vec4(position.xy,1.0,1.0);}",WIe=class extends Ht{constructor(s){super({name:"SSAOMaterial",defines:{SAMPLES_INT:"0",INV_SAMPLES_FLOAT:"0.0",SPIRAL_TURNS:"0.0",RADIUS:"1.0",RADIUS_SQ:"1.0",DISTANCE_SCALING:"1",DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Te(null),normalBuffer:new Te(null),normalDepthBuffer:new Te(null),noiseTexture:new Te(null),inverseProjectionMatrix:new Te(new ce),projectionMatrix:new Te(new ce),texelSize:new Te(new Q),cameraNearFar:new Te(new Q),distanceCutoff:new Te(new Q),proximityCutoff:new Te(new Q),noiseScale:new Te(new Q),minRadiusScale:new Te(.33),intensity:new Te(1),fade:new Te(.01),bias:new Te(0)},blending:Fn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:OIe,vertexShader:ZIe}),this.copyCameraSettings(s),this.resolution=new Q,this.r=1}get near(){return this.uniforms.cameraNearFar.value.x}get far(){return this.uniforms.cameraNearFar.value.y}set normalDepthBuffer(s){this.uniforms.normalDepthBuffer.value=s,s!==null?this.defines.NORMAL_DEPTH="1":delete this.defines.NORMAL_DEPTH,this.needsUpdate=!0}setNormalDepthBuffer(s){this.normalDepthBuffer=s}set normalBuffer(s){this.uniforms.normalBuffer.value=s}setNormalBuffer(s){this.uniforms.normalBuffer.value=s}set depthBuffer(s){this.uniforms.depthBuffer.value=s}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,e=Io){this.depthBuffer=s,this.depthPacking=e}set noiseTexture(s){this.uniforms.noiseTexture.value=s}setNoiseTexture(s){this.uniforms.noiseTexture.value=s}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(s){this.defines.SAMPLES_INT=s.toFixed(0),this.defines.INV_SAMPLES_FLOAT=(1/s).toFixed(9),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(s){this.samples=s}get rings(){return Number(this.defines.SPIRAL_TURNS)}set rings(s){this.defines.SPIRAL_TURNS=s.toFixed(1),this.needsUpdate=!0}getRings(){return this.rings}setRings(s){this.rings=s}get intensity(){return this.uniforms.intensity.value}set intensity(s){this.uniforms.intensity.value=s,this.defines.LEGACY_INTENSITY===void 0&&(this.defines.LEGACY_INTENSITY="1",this.needsUpdate=!0)}getIntensity(){return this.uniforms.intensity.value}setIntensity(s){this.uniforms.intensity.value=s}get fade(){return this.uniforms.fade.value}set fade(s){this.uniforms.fade.value=s}getFade(){return this.uniforms.fade.value}setFade(s){this.uniforms.fade.value=s}get bias(){return this.uniforms.bias.value}set bias(s){this.uniforms.bias.value=s}getBias(){return this.uniforms.bias.value}setBias(s){this.uniforms.bias.value=s}get minRadiusScale(){return this.uniforms.minRadiusScale.value}set minRadiusScale(s){this.uniforms.minRadiusScale.value=s}getMinRadiusScale(){return this.uniforms.minRadiusScale.value}setMinRadiusScale(s){this.uniforms.minRadiusScale.value=s}updateRadius(){const s=this.r*this.resolution.height;this.defines.RADIUS=s.toFixed(11),this.defines.RADIUS_SQ=(s*s).toFixed(11),this.needsUpdate=!0}get radius(){return this.r}set radius(s){this.r=Math.min(Math.max(s,1e-6),1),this.updateRadius()}getRadius(){return this.radius}setRadius(s){this.radius=s}get distanceScaling(){return!0}set distanceScaling(s){}isDistanceScalingEnabled(){return this.distanceScaling}setDistanceScalingEnabled(s){this.distanceScaling=s}get distanceThreshold(){return this.uniforms.distanceCutoff.value.x}set distanceThreshold(s){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(s,0),1),Math.min(Math.max(s+this.distanceFalloff,0),1))}get worldDistanceThreshold(){return-Mb(this.distanceThreshold,this.near,this.far)}set worldDistanceThreshold(s){this.distanceThreshold=d0(-s,this.near,this.far)}get distanceFalloff(){return this.uniforms.distanceCutoff.value.y-this.distanceThreshold}set distanceFalloff(s){this.uniforms.distanceCutoff.value.y=Math.min(Math.max(this.distanceThreshold+s,0),1)}get worldDistanceFalloff(){return-Mb(this.distanceFalloff,this.near,this.far)}set worldDistanceFalloff(s){this.distanceFalloff=d0(-s,this.near,this.far)}setDistanceCutoff(s,e){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(s,0),1),Math.min(Math.max(s+e,0),1))}get proximityThreshold(){return this.uniforms.proximityCutoff.value.x}set proximityThreshold(s){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(s,0),1),Math.min(Math.max(s+this.proximityFalloff,0),1))}get worldProximityThreshold(){return-Mb(this.proximityThreshold,this.near,this.far)}set worldProximityThreshold(s){this.proximityThreshold=d0(-s,this.near,this.far)}get proximityFalloff(){return this.uniforms.proximityCutoff.value.y-this.proximityThreshold}set proximityFalloff(s){this.uniforms.proximityCutoff.value.y=Math.min(Math.max(this.proximityThreshold+s,0),1)}get worldProximityFalloff(){return-Mb(this.proximityFalloff,this.near,this.far)}set worldProximityFalloff(s){this.proximityFalloff=d0(-s,this.near,this.far)}setProximityCutoff(s,e){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(s,0),1),Math.min(Math.max(s+e,0),1))}setTexelSize(s,e){this.uniforms.texelSize.value.set(s,e)}adoptCameraSettings(s){this.copyCameraSettings(s)}copyCameraSettings(s){s&&(this.uniforms.cameraNearFar.value.set(s.near,s.far),this.uniforms.projectionMatrix.value.copy(s.projectionMatrix),this.uniforms.inverseProjectionMatrix.value.copy(s.projectionMatrix).invert(),s instanceof Xt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(s,e){const t=this.uniforms,i=t.noiseTexture.value;i!==null&&t.noiseScale.value.set(s/i.image.width,e/i.image.height),t.texelSize.value.set(1/s,1/e),this.resolution.set(s,e),this.updateRadius()}},HIe=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,QIe="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",KIe=class extends Ht{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Te(null),normalBuffer:new Te(null),texelSize:new Te(new Q)},blending:Fn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:HIe,vertexShader:QIe})}set depthBuffer(s){this.uniforms.depthBuffer.value=s}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,e=Io){this.depthBuffer=s,this.depthPacking=e}set normalBuffer(s){this.uniforms.normalBuffer.value=s,s!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(s){this.normalBuffer=s}setTexelSize(s,e){this.uniforms.texelSize.value.set(s,e)}setSize(s,e){this.uniforms.texelSize.value.set(1/s,1/e)}},TO=class extends Jr{constructor({normalBuffer:s=null,resolutionScale:e=.5,width:t=cn.AUTO_SIZE,height:i=cn.AUTO_SIZE,resolutionX:n=t,resolutionY:r=i}={}){super("DepthDownsamplingPass");const o=new KIe;o.normalBuffer=s,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new ci(1,1,{minFilter:qt,magFilter:qt,depthBuffer:!1,type:$i}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new cn(this,n,r,e);a.addEventListener("change",l=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(s,e=Io){this.fullscreenMaterial.depthBuffer=s,this.fullscreenMaterial.depthPacking=e}render(s,e,t,i,n){s.setRenderTarget(this.renderToScreen?null:this.renderTarget),s.render(this.scene,this.camera)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e),this.renderTarget.setSize(t.width,t.height),this.fullscreenMaterial.setSize(s,e)}initialize(s,e,t){const i=s.getContext();if(!(i.getExtension("EXT_color_buffer_float")||i.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},YIe=`uniform lowp sampler2D aoBuffer;uniform float luminanceInfluence;uniform float intensity;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH)
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
#endif
#ifdef COLORIZE
uniform vec3 color;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){float aoLinear=texture2D(aoBuffer,uv).r;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH) && __VERSION__ == 300
vec4 normalDepth[4];normalDepth[0]=textureOffset(normalDepthBuffer,uv,ivec2(0,0));normalDepth[1]=textureOffset(normalDepthBuffer,uv,ivec2(0,1));normalDepth[2]=textureOffset(normalDepthBuffer,uv,ivec2(1,0));normalDepth[3]=textureOffset(normalDepthBuffer,uv,ivec2(1,1));float dot01=dot(normalDepth[0].rgb,normalDepth[1].rgb);float dot02=dot(normalDepth[0].rgb,normalDepth[2].rgb);float dot03=dot(normalDepth[0].rgb,normalDepth[3].rgb);float minDot=min(dot01,min(dot02,dot03));float s=step(THRESHOLD,minDot);float smallestDistance=1.0;int index;for(int i=0;i<4;++i){float distance=abs(depth-normalDepth[i].a);if(distance<smallestDistance){smallestDistance=distance;index=i;}}ivec2 offsets[4];offsets[0]=ivec2(0,0);offsets[1]=ivec2(0,1);offsets[2]=ivec2(1,0);offsets[3]=ivec2(1,1);ivec2 coord=ivec2(uv*vec2(textureSize(aoBuffer,0)))+offsets[index];float aoNearest=texelFetch(aoBuffer,coord,0).r;float ao=mix(aoNearest,aoLinear,s);
#else
float ao=aoLinear;
#endif
float l=luminance(inputColor.rgb);ao=mix(ao,0.0,l*luminanceInfluence);ao=clamp(ao*intensity,0.0,1.0);
#ifdef COLORIZE
outputColor=vec4(1.0-ao*(1.0-color),inputColor.a);
#else
outputColor=vec4(vec3(1.0-ao),inputColor.a);
#endif
}`,$9=64,jie=class extends Na{constructor(s,e,{blendFunction:t=ai.MULTIPLY,samples:i=9,rings:n=7,normalDepthBuffer:r=null,depthAwareUpsampling:o=!0,worldDistanceThreshold:a,worldDistanceFalloff:l,worldProximityThreshold:c,worldProximityFalloff:h,distanceThreshold:d=.97,distanceFalloff:u=.03,rangeThreshold:f=5e-4,rangeFalloff:m=.001,minRadiusScale:g=.1,luminanceInfluence:A=.7,radius:y=.1825,intensity:b=1,bias:x=.025,fade:v=.01,color:_=null,resolutionScale:C=1,width:S=cn.AUTO_SIZE,height:M=cn.AUTO_SIZE,resolutionX:L=S,resolutionY:w=M}={}){super("SSAOEffect",YIe,{blendFunction:t,attributes:Ql.DEPTH,defines:new Map([["THRESHOLD","0.997"]]),uniforms:new Map([["aoBuffer",new Te(null)],["normalDepthBuffer",new Te(r)],["luminanceInfluence",new Te(A)],["color",new Te(null)],["intensity",new Te(b)],["scale",new Te(0)]])}),this.renderTarget=new ci(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="AO.Target",this.uniforms.get("aoBuffer").value=this.renderTarget.texture;const E=this.resolution=new cn(this,L,w,C);E.addEventListener("change",k=>this.setSize(E.baseWidth,E.baseHeight)),this.camera=s,this.depthDownsamplingPass=new TO({normalBuffer:e,resolutionScale:C}),this.depthDownsamplingPass.enabled=r===null,this.ssaoPass=new md(new WIe(s));const B=new TIe($9,$9,bi);B.wrapS=B.wrapT=Mo;const P=this.ssaoMaterial;P.normalBuffer=e,P.noiseTexture=B,P.minRadiusScale=g,P.samples=i,P.radius=y,P.rings=n,P.fade=v,P.bias=x,P.distanceThreshold=d,P.distanceFalloff=u,P.proximityThreshold=f,P.proximityFalloff=m,a!==void 0&&(P.worldDistanceThreshold=a),l!==void 0&&(P.worldDistanceFalloff=l),c!==void 0&&(P.worldProximityThreshold=c),h!==void 0&&(P.worldProximityFalloff=h),r!==null&&(this.ssaoMaterial.normalDepthBuffer=r,this.defines.set("NORMAL_DEPTH","1")),this.depthAwareUpsampling=o,this.color=_}set mainCamera(s){this.camera=s,this.ssaoMaterial.copyCameraSettings(s)}get normalBuffer(){return this.ssaoMaterial.normalBuffer}set normalBuffer(s){this.ssaoMaterial.normalBuffer=s,this.depthDownsamplingPass.fullscreenMaterial.normalBuffer=s}getResolution(){return this.resolution}get ssaoMaterial(){return this.ssaoPass.fullscreenMaterial}getSSAOMaterial(){return this.ssaoMaterial}get samples(){return this.ssaoMaterial.samples}set samples(s){this.ssaoMaterial.samples=s}get rings(){return this.ssaoMaterial.rings}set rings(s){this.ssaoMaterial.rings=s}get radius(){return this.ssaoMaterial.radius}set radius(s){this.ssaoMaterial.radius=s}get depthAwareUpsampling(){return this.defines.has("DEPTH_AWARE_UPSAMPLING")}set depthAwareUpsampling(s){this.depthAwareUpsampling!==s&&(s?this.defines.set("DEPTH_AWARE_UPSAMPLING","1"):this.defines.delete("DEPTH_AWARE_UPSAMPLING"),this.setChanged())}isDepthAwareUpsamplingEnabled(){return this.depthAwareUpsampling}setDepthAwareUpsamplingEnabled(s){this.depthAwareUpsampling=s}get distanceScaling(){return!0}set distanceScaling(s){}get color(){return this.uniforms.get("color").value}set color(s){const e=this.uniforms,t=this.defines;s!==null?t.has("COLORIZE")?e.get("color").value.set(s):(t.set("COLORIZE","1"),e.get("color").value=new ge(s),this.setChanged()):t.has("COLORIZE")&&(t.delete("COLORIZE"),e.get("color").value=null,this.setChanged())}get luminanceInfluence(){return this.uniforms.get("luminanceInfluence").value}set luminanceInfluence(s){this.uniforms.get("luminanceInfluence").value=s}get intensity(){return this.uniforms.get("intensity").value}set intensity(s){this.uniforms.get("intensity").value=s}getColor(){return this.color}setColor(s){this.color=s}setDistanceCutoff(s,e){this.ssaoMaterial.distanceThreshold=s,this.ssaoMaterial.distanceFalloff=e}setProximityCutoff(s,e){this.ssaoMaterial.proximityThreshold=s,this.ssaoMaterial.proximityFalloff=e}setDepthTexture(s,e=Io){this.depthDownsamplingPass.setDepthTexture(s,e),this.ssaoMaterial.depthBuffer=s,this.ssaoMaterial.depthPacking=e}update(s,e,t){const i=this.renderTarget;this.depthDownsamplingPass.enabled&&this.depthDownsamplingPass.render(s),this.ssaoPass.render(s,null,i)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e);const i=t.width,n=t.height;this.ssaoMaterial.copyCameraSettings(this.camera),this.ssaoMaterial.setSize(i,n),this.renderTarget.setSize(i,n),this.depthDownsamplingPass.resolution.scale=t.scale,this.depthDownsamplingPass.setSize(s,e)}initialize(s,e,t){try{let i=this.uniforms.get("normalDepthBuffer").value;i===null&&(this.depthDownsamplingPass.initialize(s,e,t),i=this.depthDownsamplingPass.texture,this.uniforms.get("normalDepthBuffer").value=i,this.ssaoMaterial.normalDepthBuffer=i,this.defines.set("NORMAL_DEPTH","1"))}catch{this.depthDownsamplingPass.enabled=!1}}},JIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform vec4 maskParams;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;float linearGradientMask(const in float x){return smoothstep(maskParams.x,maskParams.y,x)-smoothstep(maskParams.w,maskParams.z,x);}void main(){vec2 dUv=vOffset*(1.0-linearGradientMask(vUv2.y));vec4 sum=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y-dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y-dUv.y));gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,jIe="uniform vec4 texelSize;uniform float kernel;uniform float scale;uniform float aspect;uniform vec2 rotation;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;void main(){vec2 uv=position.xy*0.5+0.5;vUv=uv;vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));vOffset=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;gl_Position=vec4(position.xy,1.0,1.0);}",qIe=class extends zie{constructor({kernelSize:s=Xd.MEDIUM,offset:e=0,rotation:t=0,focusArea:i=.4,feather:n=.3}={}){super(),this.fragmentShader=JIe,this.vertexShader=jIe,this.kernelSize=s,this.uniforms.aspect=new Te(1),this.uniforms.rotation=new Te(new Q),this.uniforms.maskParams=new Te(new Je),this._offset=e,this._focusArea=i,this._feather=n,this.rotation=t,this.updateParams()}updateParams(){const s=this.uniforms.maskParams.value,e=Math.max(this.focusArea,0),t=Math.max(e-this.feather,0);s.set(this.offset-e,this.offset-t,this.offset+e,this.offset+t)}get rotation(){return Math.acos(this.uniforms.rotation.value.x)}set rotation(s){this.uniforms.rotation.value.set(Math.cos(s),Math.sin(s))}get offset(){return this._offset}set offset(s){this._offset=s,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(s){this._focusArea=s,this.updateParams()}get feather(){return this._feather}set feather(s){this._feather=s,this.updateParams()}setSize(s,e){super.setSize(s,e),this.uniforms.aspect.value=s/e}},$Ie=class extends SO{constructor({offset:s=0,rotation:e=0,focusArea:t=.4,feather:i=.3,kernelSize:n=Xd.MEDIUM,resolutionScale:r=.5,resolutionX:o=cn.AUTO_SIZE,resolutionY:a=cn.AUTO_SIZE}={}){super({kernelSize:n,resolutionScale:r,resolutionX:o,resolutionY:a}),this.blurMaterial=new qIe({kernelSize:n,offset:s,rotation:e,focusArea:t,feather:i})}},eTe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform vec2 maskParams;varying vec2 vUv2;float linearGradientMask(const in float x){return step(maskParams.x,x)-step(maskParams.y,x);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float mask=linearGradientMask(vUv2.y);vec4 texel=texture2D(map,uv);outputColor=mix(texel,inputColor,mask);}`,tTe="uniform vec2 rotation;varying vec2 vUv2;void mainSupport(const in vec2 uv){vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));}",qie=class extends Na{constructor({blendFunction:e,offset:t=0,rotation:i=0,focusArea:n=.4,feather:r=.3,kernelSize:o=Xd.MEDIUM,resolutionScale:a=.5,resolutionX:l=cn.AUTO_SIZE,resolutionY:c=cn.AUTO_SIZE}={}){super("TiltShiftEffect",eTe,{vertexShader:tTe,blendFunction:e,uniforms:new Map([["rotation",new Te(new Q)],["maskParams",new Te(new Q)],["map",new Te(null)]])}),this._offset=t,this._focusArea=n,this._feather=r,this.renderTarget=new ci(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="TiltShift.Target",this.uniforms.get("map").value=this.renderTarget.texture,this.blurPass=new $Ie({kernelSize:o,resolutionScale:a,resolutionX:l,resolutionY:c,offset:t,rotation:i,focusArea:n,feather:r});const h=this.resolution=new cn(this,l,c,a);h.addEventListener("change",d=>this.setSize(h.baseWidth,h.baseHeight)),this.rotation=i,this.updateParams()}updateParams(){const e=this.uniforms.get("maskParams").value,t=Math.max(this.focusArea-this.feather,0);e.set(this.offset-t,this.offset+t)}get rotation(){return Math.acos(this.uniforms.get("rotation").value.x)}set rotation(e){this.uniforms.get("rotation").value.set(Math.cos(e),Math.sin(e)),this.blurPass.blurMaterial.rotation=e}get offset(){return this._offset}set offset(e){this._offset=e,this.blurPass.blurMaterial.offset=e,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(e){this._focusArea=e,this.blurPass.blurMaterial.focusArea=e,this.updateParams()}get feather(){return this._feather}set feather(e){this._feather=e,this.blurPass.blurMaterial.feather=e,this.updateParams()}get bias(){return 0}set bias(e){}update(e,t,i){this.blurPass.render(e,t,this.renderTarget)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e!==null&&e.outputColorSpace===ft&&(this.renderTarget.texture.colorSpace=ft))}},iTe=`#include <packing>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
uniform lowp sampler2D luminanceBuffer0;uniform lowp sampler2D luminanceBuffer1;uniform float minLuminance;uniform float deltaTime;uniform float tau;varying vec2 vUv;void main(){float l0=unpackRGBAToFloat(texture2D(luminanceBuffer0,vUv));
#if __VERSION__ < 300
float l1=texture2DLodEXT(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#else
float l1=textureLod(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#endif
l0=max(minLuminance,l0);l1=max(minLuminance,l1);float adaptedLum=l0+(l1-l0)*(1.0-exp(-deltaTime*tau));gl_FragColor=(adaptedLum==1.0)?vec4(1.0):packFloatToRGBA(adaptedLum);}`,nTe=class extends Ht{constructor(){super({name:"AdaptiveLuminanceMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{luminanceBuffer0:new Te(null),luminanceBuffer1:new Te(null),minLuminance:new Te(.01),deltaTime:new Te(0),tau:new Te(1)},extensions:{shaderTextureLOD:!0},blending:Fn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:iTe,vertexShader:yA})}set luminanceBuffer0(s){this.uniforms.luminanceBuffer0.value=s}setLuminanceBuffer0(s){this.uniforms.luminanceBuffer0.value=s}set luminanceBuffer1(s){this.uniforms.luminanceBuffer1.value=s}setLuminanceBuffer1(s){this.uniforms.luminanceBuffer1.value=s}set mipLevel1x1(s){this.defines.MIP_LEVEL_1X1=s.toFixed(1),this.needsUpdate=!0}setMipLevel1x1(s){this.mipLevel1x1=s}set deltaTime(s){this.uniforms.deltaTime.value=s}setDeltaTime(s){this.uniforms.deltaTime.value=s}get minLuminance(){return this.uniforms.minLuminance.value}set minLuminance(s){this.uniforms.minLuminance.value=s}getMinLuminance(){return this.uniforms.minLuminance.value}setMinLuminance(s){this.uniforms.minLuminance.value=s}get adaptationRate(){return this.uniforms.tau.value}set adaptationRate(s){this.uniforms.tau.value=s}getAdaptationRate(){return this.uniforms.tau.value}setAdaptationRate(s){this.uniforms.tau.value=s}},sTe=class extends Jr{constructor(s,{minLuminance:e=.01,adaptationRate:t=1}={}){super("AdaptiveLuminancePass"),this.fullscreenMaterial=new nTe,this.needsSwap=!1,this.renderTargetPrevious=new ci(1,1,{minFilter:qt,magFilter:qt,depthBuffer:!1}),this.renderTargetPrevious.texture.name="Luminance.Previous";const i=this.fullscreenMaterial;i.luminanceBuffer0=this.renderTargetPrevious.texture,i.luminanceBuffer1=s,i.minLuminance=e,i.adaptationRate=t,this.renderTargetAdapted=this.renderTargetPrevious.clone(),this.renderTargetAdapted.texture.name="Luminance.Adapted",this.copyPass=new Vie(this.renderTargetPrevious,!1)}get texture(){return this.renderTargetAdapted.texture}getTexture(){return this.renderTargetAdapted.texture}set mipLevel1x1(s){this.fullscreenMaterial.mipLevel1x1=s}get adaptationRate(){return this.fullscreenMaterial.adaptationRate}set adaptationRate(s){this.fullscreenMaterial.adaptationRate=s}render(s,e,t,i,n){this.fullscreenMaterial.deltaTime=i,s.setRenderTarget(this.renderToScreen?null:this.renderTargetAdapted),s.render(this.scene,this.camera),this.copyPass.render(s,this.renderTargetAdapted)}},rTe=`#include <tonemapping_pars_fragment>
uniform float whitePoint;
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
uniform float middleGrey;
#if TONE_MAPPING_MODE == 3
uniform lowp sampler2D luminanceBuffer;
#else
uniform float averageLuminance;
#endif
vec3 Reinhard2ToneMapping(vec3 color){color*=toneMappingExposure;float l=luminance(color);
#if TONE_MAPPING_MODE == 3
float lumAvg=unpackRGBAToFloat(texture2D(luminanceBuffer,vec2(0.5)));
#else
float lumAvg=averageLuminance;
#endif
float lumScaled=(l*middleGrey)/max(lumAvg,1e-6);float lumCompressed=lumScaled*(1.0+lumScaled/(whitePoint*whitePoint));lumCompressed/=(1.0+lumScaled);return clamp(lumCompressed*color,0.0,1.0);}
#elif TONE_MAPPING_MODE == 4
#define A 0.15
#define B 0.50
#define C 0.10
#define D 0.20
#define E 0.02
#define F 0.30
vec3 Uncharted2Helper(const in vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return clamp(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitePoint)),0.0,1.0);}
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
outputColor=vec4(Reinhard2ToneMapping(inputColor.rgb),inputColor.a);
#elif TONE_MAPPING_MODE == 4
outputColor=vec4(Uncharted2ToneMapping(inputColor.rgb),inputColor.a);
#else
outputColor=vec4(toneMapping(inputColor.rgb),inputColor.a);
#endif
}`,JL=class extends Na{constructor({blendFunction:e=ai.SRC,adaptive:t=!1,mode:i=t?gr.REINHARD2_ADAPTIVE:gr.AGX,resolution:n=256,maxLuminance:r=4,whitePoint:o=r,middleGrey:a=.6,minLuminance:l=.01,averageLuminance:c=1,adaptationRate:h=1}={}){super("ToneMappingEffect",rTe,{blendFunction:e,uniforms:new Map([["luminanceBuffer",new Te(null)],["maxLuminance",new Te(r)],["whitePoint",new Te(o)],["middleGrey",new Te(a)],["averageLuminance",new Te(c)]])}),this.renderTargetLuminance=new ci(1,1,{minFilter:xr,depthBuffer:!1}),this.renderTargetLuminance.texture.generateMipmaps=!0,this.renderTargetLuminance.texture.name="Luminance",this.luminancePass=new Uie({renderTarget:this.renderTargetLuminance}),this.adaptiveLuminancePass=new sTe(this.luminancePass.texture,{minLuminance:l,adaptationRate:h}),this.uniforms.get("luminanceBuffer").value=this.adaptiveLuminancePass.texture,this.resolution=n,this.mode=i}get mode(){return Number(this.defines.get("TONE_MAPPING_MODE"))}set mode(e){if(this.mode===e)return;const i=La.replace(/\D+/g,"")>=168?"CineonToneMapping(texel)":"OptimizedCineonToneMapping(texel)";switch(this.defines.clear(),this.defines.set("TONE_MAPPING_MODE",e.toFixed(0)),e){case gr.LINEAR:this.defines.set("toneMapping(texel)","LinearToneMapping(texel)");break;case gr.REINHARD:this.defines.set("toneMapping(texel)","ReinhardToneMapping(texel)");break;case gr.CINEON:case gr.OPTIMIZED_CINEON:this.defines.set("toneMapping(texel)",i);break;case gr.ACES_FILMIC:this.defines.set("toneMapping(texel)","ACESFilmicToneMapping(texel)");break;case gr.AGX:this.defines.set("toneMapping(texel)","AgXToneMapping(texel)");break;case gr.NEUTRAL:this.defines.set("toneMapping(texel)","NeutralToneMapping(texel)");break;default:this.defines.set("toneMapping(texel)","texel");break}this.adaptiveLuminancePass.enabled=e===gr.REINHARD2_ADAPTIVE,this.setChanged()}getMode(){return this.mode}setMode(e){this.mode=e}get whitePoint(){return this.uniforms.get("whitePoint").value}set whitePoint(e){this.uniforms.get("whitePoint").value=e}get middleGrey(){return this.uniforms.get("middleGrey").value}set middleGrey(e){this.uniforms.get("middleGrey").value=e}get averageLuminance(){return this.uniforms.get("averageLuminance").value}set averageLuminance(e){this.uniforms.get("averageLuminance").value=e}get adaptiveLuminanceMaterial(){return this.adaptiveLuminancePass.fullscreenMaterial}getAdaptiveLuminanceMaterial(){return this.adaptiveLuminanceMaterial}get resolution(){return this.luminancePass.resolution.width}set resolution(e){const t=Math.max(0,Math.ceil(Math.log2(e))),i=Math.pow(2,t);this.luminancePass.resolution.setPreferredSize(i,i),this.adaptiveLuminanceMaterial.mipLevel1x1=t}getResolution(){return this.resolution}setResolution(e){this.resolution=e}get adaptive(){return this.mode===gr.REINHARD2_ADAPTIVE}set adaptive(e){this.mode=e?gr.REINHARD2_ADAPTIVE:gr.REINHARD2}get adaptationRate(){return this.adaptiveLuminanceMaterial.adaptationRate}set adaptationRate(e){this.adaptiveLuminanceMaterial.adaptationRate=e}get distinction(){return console.warn(this.name,"distinction was removed."),1}set distinction(e){console.warn(this.name,"distinction was removed.")}update(e,t,i){this.adaptiveLuminancePass.enabled&&(this.luminancePass.render(e,t),this.adaptiveLuminancePass.render(e,null,null,i))}initialize(e,t,i){this.adaptiveLuminancePass.initialize(e,t,i)}},oTe=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,$ie=class extends Na{constructor({blendFunction:s,eskil:e=!1,technique:t=e?o_.ESKIL:o_.DEFAULT,offset:i=.5,darkness:n=.5}={}){super("VignetteEffect",oTe,{blendFunction:s,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new Te(i)],["darkness",new Te(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(s){this.technique!==s&&(this.defines.set("VIGNETTE_TECHNIQUE",s.toFixed(0)),this.setChanged())}get eskil(){return this.technique===o_.ESKIL}set eskil(s){this.technique=s?o_.ESKIL:o_.DEFAULT}getTechnique(){return this.technique}setTechnique(s){this.technique=s}get offset(){return this.uniforms.get("offset").value}set offset(s){this.uniforms.get("offset").value=s}getOffset(){return this.offset}setOffset(s){this.offset=s}get darkness(){return this.uniforms.get("darkness").value}set darkness(s){this.uniforms.get("darkness").value=s}getDarkness(){return this.darkness}setDarkness(s){this.darkness=s}},aTe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,lTe="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",cTe=class extends Ht{constructor(s,e,t,i,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:La.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Te(null),depthBuffer:new Te(null),resolution:new Te(new Q),texelSize:new Te(new Q),cameraNear:new Te(.3),cameraFar:new Te(1e3),aspect:new Te(1),time:new Te(0)},blending:Fn,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:n}),s&&this.setShaderParts(s),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(i)}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(s){this.uniforms.depthBuffer.value=s}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,e=Io){this.depthBuffer=s,this.depthPacking=e}setShaderData(s){this.setShaderParts(s.shaderParts),this.setDefines(s.defines),this.setUniforms(s.uniforms),this.setExtensions(s.extensions)}setShaderParts(s){return this.fragmentShader=aTe.replace(qi.FRAGMENT_HEAD,s.get(qi.FRAGMENT_HEAD)||"").replace(qi.FRAGMENT_MAIN_UV,s.get(qi.FRAGMENT_MAIN_UV)||"").replace(qi.FRAGMENT_MAIN_IMAGE,s.get(qi.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=lTe.replace(qi.VERTEX_HEAD,s.get(qi.VERTEX_HEAD)||"").replace(qi.VERTEX_MAIN_SUPPORT,s.get(qi.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(s){for(const e of s.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(s){for(const e of s.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(s){this.extensions={};for(const e of s)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(s){this.encodeOutput!==s&&(s?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(s){return this.encodeOutput}setOutputEncodingEnabled(s){this.encodeOutput=s}get time(){return this.uniforms.time.value}set time(s){this.uniforms.time.value=s}setDeltaTime(s){this.uniforms.time.value+=s}adoptCameraSettings(s){this.copyCameraSettings(s)}copyCameraSettings(s){s&&(this.uniforms.cameraNear.value=s.near,this.uniforms.cameraFar.value=s.far,s instanceof Xt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(s,e){const t=this.uniforms;t.resolution.value.set(s,e),t.texelSize.value.set(1/s,1/e),t.aspect.value=s/e}static get Section(){return qi}};function eQ(s,e,t){for(const i of e){const n="$1"+s+i.charAt(0).toUpperCase()+i.slice(1),r=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(const o of t.entries())o[1]!==null&&t.set(o[0],o[1].replace(r,n))}}function hTe(s,e,t){let i=e.getFragmentShader(),n=e.getVertexShader();const r=i!==void 0&&/mainImage/.test(i),o=i!==void 0&&/mainUv/.test(i);if(t.attributes|=e.getAttributes(),i===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&t.attributes&Ql.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!r&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=t.shaderParts;let c=l.get(qi.FRAGMENT_HEAD)||"",h=l.get(qi.FRAGMENT_MAIN_UV)||"",d=l.get(qi.FRAGMENT_MAIN_IMAGE)||"",u=l.get(qi.VERTEX_HEAD)||"",f=l.get(qi.VERTEX_MAIN_SUPPORT)||"";const m=new Set,g=new Set;if(o&&(h+=`	${s}MainUv(UV);
`,t.uvTransformation=!0),n!==null&&/mainSupport/.test(n)){const b=/mainSupport *\([\w\s]*?uv\s*?\)/.test(n);f+=`	${s}MainSupport(`,f+=b?`vUv);
`:`);
`;for(const x of n.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const v of x[1].split(/\s*,\s*/))t.varyings.add(v),m.add(v),g.add(v);for(const x of n.matchAll(a))g.add(x[1])}for(const b of i.matchAll(a))g.add(b[1]);for(const b of e.defines.keys())g.add(b.replace(/\([\w\s,]*\)/g,""));for(const b of e.uniforms.keys())g.add(b);g.delete("while"),g.delete("for"),g.delete("if"),e.uniforms.forEach((b,x)=>t.uniforms.set(s+x.charAt(0).toUpperCase()+x.slice(1),b)),e.defines.forEach((b,x)=>t.defines.set(s+x.charAt(0).toUpperCase()+x.slice(1),b));const A=new Map([["fragment",i],["vertex",n]]);eQ(s,g,t.defines),eQ(s,g,A),i=A.get("fragment"),n=A.get("vertex");const y=e.blendMode;if(t.blendModes.set(y.blendFunction,y),r){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(d+=e.inputColorSpace===ft?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==Fr?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const b=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;d+=`${s}MainImage(color0, UV, `,t.attributes&Ql.DEPTH&&b.test(i)&&(d+="depth, ",t.readDepth=!0),d+=`color1);
	`;const x=s+"BlendOpacity";t.uniforms.set(x,y.opacity),d+=`color0 = blend${y.blendFunction}(color0, color1, ${x});

	`,c+=`uniform float ${x};

`}if(c+=i+`
`,n!==null&&(u+=n+`
`),l.set(qi.FRAGMENT_HEAD,c),l.set(qi.FRAGMENT_MAIN_UV,h),l.set(qi.FRAGMENT_MAIN_IMAGE,d),l.set(qi.VERTEX_HEAD,u),l.set(qi.VERTEX_MAIN_SUPPORT,f),e.extensions!==null)for(const b of e.extensions)t.extensions.add(b)}}var tQ=class extends Jr{constructor(s,...e){super("EffectPass"),this.fullscreenMaterial=new cTe(null,null,null,s),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(s){for(const e of this.effects)e.mainScene=s}set mainCamera(s){this.fullscreenMaterial.copyCameraSettings(s);for(const e of this.effects)e.mainCamera=s}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(s){this.fullscreenMaterial.encodeOutput=s}get dithering(){return this.fullscreenMaterial.dithering}set dithering(s){const e=this.fullscreenMaterial;e.dithering=s,e.needsUpdate=!0}setEffects(s){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=s.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const s=new _Me;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===ai.DST)s.attributes|=o.getAttributes()&Ql.DEPTH;else{if(s.attributes&o.getAttributes()&Ql.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${o.name})`);hTe("e"+e++,o,s)}let t=s.shaderParts.get(qi.FRAGMENT_HEAD),i=s.shaderParts.get(qi.FRAGMENT_MAIN_IMAGE),n=s.shaderParts.get(qi.FRAGMENT_MAIN_UV);const r=/\bblend\b/g;for(const o of s.blendModes.values())t+=o.getShaderCode().replace(r,`blend${o.blendFunction}`)+`
`;s.attributes&Ql.DEPTH?(s.readDepth&&(i=`float depth = readDepth(UV);

	`+i),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,s.colorSpace===ft&&(i+=`color0 = sRGBToLinear(color0);
	`),s.uvTransformation?(n=`vec2 transformedUv = vUv;
`+n,s.defines.set("UV","transformedUv")):s.defines.set("UV","vUv"),s.shaderParts.set(qi.FRAGMENT_HEAD,t),s.shaderParts.set(qi.FRAGMENT_MAIN_IMAGE,i),s.shaderParts.set(qi.FRAGMENT_MAIN_UV,n);for(const[o,a]of s.shaderParts)a!==null&&s.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(s)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(s,e=Io){this.fullscreenMaterial.depthBuffer=s,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(s,e)}render(s,e,t,i,n){for(const r of this.effects)r.update(s,e,i);if(!this.skipRendering||this.renderToScreen){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,r.time+=i*this.timeScale,s.setRenderTarget(this.renderToScreen?null:t),s.render(this.scene,this.camera)}}setSize(s,e){this.fullscreenMaterial.setSize(s,e);for(const t of this.effects)t.setSize(s,e)}initialize(s,e,t){this.renderer=s;for(const i of this.effects)i.initialize(s,e,t);this.updateMaterial(),t!==void 0&&t!==Pi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const s of this.effects)s.removeEventListener("change",this.listener),s.dispose()}handleEvent(s){switch(s.type){case"change":this.recompile();break}}},ene=class extends Jr{constructor(s,e,{renderTarget:t,resolutionScale:i=1,width:n=cn.AUTO_SIZE,height:r=cn.AUTO_SIZE,resolutionX:o=n,resolutionY:a=r}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new iP(s,e,new I1);const l=this.renderPass;l.ignoreBackground=!0,l.skipShadowMapUpdate=!0;const c=l.getClearPass();c.overrideClearColor=new ge(7829503),c.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new ci(1,1,{minFilter:qt,magFilter:qt}),this.renderTarget.texture.name="NormalPass.Target");const h=this.resolution=new cn(this,o,a,i);h.addEventListener("change",d=>this.setSize(h.baseWidth,h.baseHeight))}set mainScene(s){this.renderPass.mainScene=s}set mainCamera(s){this.renderPass.mainCamera=s}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(s){this.resolution.scale=s}render(s,e,t,i,n){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(s,r,r)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e),this.renderTarget.setSize(t.width,t.height)}},qC=function(){var s=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(h){h.preventDefault(),i(++s%e.children.length)},!1);function t(h){return e.appendChild(h.dom),h}function i(h){for(var d=0;d<e.children.length;d++)e.children[d].style.display=d===h?"block":"none";s=h}var n=(performance||Date).now(),r=n,o=0,a=t(new qC.Panel("FPS","#0ff","#002")),l=t(new qC.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new qC.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:e,addPanel:t,showPanel:i,begin:function(){n=(performance||Date).now()},end:function(){o++;var h=(performance||Date).now();if(l.update(h-n,200),h>=r+1e3&&(a.update(o*1e3/(h-r),100),r=h,o=0,c)){var d=performance.memory;c.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return h},update:function(){n=this.end()},domElement:e,setMode:i}};qC.Panel=function(s,e,t){var i=1/0,n=0,r=Math.round,o=r(window.devicePixelRatio||1),a=80*o,l=48*o,c=3*o,h=2*o,d=3*o,u=15*o,f=74*o,m=30*o,g=document.createElement("canvas");g.width=a,g.height=l,g.style.cssText="width:80px;height:48px";var A=g.getContext("2d");return A.font="bold "+9*o+"px Helvetica,Arial,sans-serif",A.textBaseline="top",A.fillStyle=t,A.fillRect(0,0,a,l),A.fillStyle=e,A.fillText(s,c,h),A.fillRect(d,u,f,m),A.fillStyle=t,A.globalAlpha=.9,A.fillRect(d,u,f,m),{dom:g,update:function(y,b){i=Math.min(i,y),n=Math.max(n,y),A.fillStyle=t,A.globalAlpha=1,A.fillRect(0,0,a,u),A.fillStyle=e,A.fillText(r(y)+" "+s+" ("+r(i)+"-"+r(n)+")",c,h),A.drawImage(g,d+o,u,f-o,m,d,u,f-o,m),A.fillRect(d+f-o,u,o,m),A.fillStyle=t,A.globalAlpha=.9,A.fillRect(d+f-o,u,o,r((1-y/b)*m))}}};const dTe=qC,tne=new K$;tne.camera=new Xt;Wn.basic,Wn.basic,Wn.points,Wn.standard,Wn.physical,Wn.phong;const uTe=ee("debugpatch");function nP(s,e,t,i){const n=uTe===e;if(!t&&!i)return;const r=e+"___needle";fTe(s,e,t,i);const o=Object.getOwnPropertyDescriptor(s,e),a=s[e];n&&console.log("Patch",s.constructor.name,e,o,a),o?(n&&console.log("Apply patch with existing descriptor",s.constructor.name,e,o),typeof o.value=="function"&&(s[e]=nQ(o.value,s,e))):(n&&console.log("Create patch with new property",s.constructor.name,e,o),Object.defineProperty(s,e,{set:function(l){if(typeof l=="function")this[r]=nQ(l,s,e);else{const c=this[r];ine(s,e,this,c,l),this[r]=l,nne(s,e,this,c,l)}},get:function(){const l=this[r];return typeof l=="function"&&l[r]?l[r]:l}}))}function pTe(s,e,t){const i=EO(s,e);if(i)for(let n=i.length-1;n>=0;n--){const r=i[n];r.prefix===t&&(r.prefix=null),r.postfix===t&&(r.postfix=null),!r.prefix&&!r.postfix&&i.splice(n,1)}}const iQ=Symbol("Needle:Patches:WrappedFunction");function nQ(s,e,t){if(s[iQ])return s;const i=function(...n){ine(e,t,this,...n);const r=s.apply(this,n);return nne(e,t,this,r,...n),r};return i[iQ]=!0,i}const SR="Needle:Patches";function RV(){return globalThis[SR]||(globalThis[SR]=new WeakMap),globalThis[SR]}function EO(s,e){const t=RV().get(s);return t?t.get(e):null}function fTe(s,e,t,i){let n=RV().get(s);n||(n=new Map,RV().set(s,n));let r=n.get(e);r||(r=[],n.set(e,r)),r.push({prefix:t,postfix:i})}function ine(s,e,t,...i){var r;if(!t)return;const n=EO(s,e);if(n)for(const o of n)(r=o.prefix)==null||r.call(t,...i)}function nne(s,e,t,i,...n){var o;if(!t)return;const r=EO(s,e);if(r)for(const a of r)(o=a.postfix)==null||o.call(t,i,...n)}const sne="";globalThis.GLTF_PROGRESSIVE_VERSION=sne;console.debug(`[gltf-progressive] version ${sne}`);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const rne="172",jL=0,mTe=1,gTe=2,sQ=1,rQ=100,oQ=204,aQ=205,lQ=3,ATe=0,cQ="attached",yTe="detached",one=300,bTe=301,aS=1e3,u0=1001,LV=1002,Sx=1003,xTe=1004,vTe=1005,gm=1006,_Te=1007,iM=1008,cd=1009,Wf=1015,Ib=1016,Gf=1023,Tb=1028,aC=1030,CTe=33777,wTe=33779,STe=35840,MTe=35842,ITe=36196,TTe=37492,ETe=37496,ane=37808,hQ=37812,RTe=36492,LTe=36495,lS=2300,cS=2301,zk=2302,dQ=2400,uQ=2401,pQ=2402,BTe=2500,PTe=0,lne=1,BV=2,GTe=0,qL="",Js="srgb",tc="srgb-linear",fQ="linear",Uk="srgb",Ay=7680,mQ=519,PV=35044,p0=2e3,GV=2001;class sP{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const n=i.slice(0);for(let r=0,o=n.length;r<o;r++)n[r].call(this,e);e.target=null}}}const Zo=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let gQ=1234567;const $C=Math.PI/180,hS=180/Math.PI;function Rh(){const s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Zo[s&255]+Zo[s>>8&255]+Zo[s>>16&255]+Zo[s>>24&255]+"-"+Zo[e&255]+Zo[e>>8&255]+"-"+Zo[e>>16&15|64]+Zo[e>>24&255]+"-"+Zo[t&63|128]+Zo[t>>8&255]+"-"+Zo[t>>16&255]+Zo[t>>24&255]+Zo[i&255]+Zo[i>>8&255]+Zo[i>>16&255]+Zo[i>>24&255]).toLowerCase()}function Ii(s,e,t){return Math.max(e,Math.min(t,s))}function RO(s,e){return(s%e+e)%e}function kTe(s,e,t,i,n){return i+(s-e)*(n-i)/(t-e)}function NTe(s,e,t){return s!==e?(t-s)/(e-s):0}function ew(s,e,t){return(1-t)*s+t*e}function DTe(s,e,t,i){return ew(s,e,1-Math.exp(-t*i))}function FTe(s,e=1){return e-Math.abs(RO(s,e*2)-e)}function VTe(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*(3-2*s))}function zTe(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*s*(s*(s*6-15)+10))}function UTe(s,e){return s+Math.floor(Math.random()*(e-s+1))}function XTe(s,e){return s+Math.random()*(e-s)}function OTe(s){return s*(.5-Math.random())}function ZTe(s){s!==void 0&&(gQ=s);let e=gQ+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function WTe(s){return s*$C}function HTe(s){return s*hS}function QTe(s){return(s&s-1)===0&&s!==0}function KTe(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function YTe(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function JTe(s,e,t,i,n){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),c=r((e+i)/2),h=o((e+i)/2),d=r((e-i)/2),u=o((e-i)/2),f=r((i-e)/2),m=o((i-e)/2);switch(n){case"XYX":s.set(a*h,l*d,l*u,a*c);break;case"YZY":s.set(l*u,a*h,l*d,a*c);break;case"ZXZ":s.set(l*d,l*u,a*h,a*c);break;case"XZX":s.set(a*h,l*m,l*f,a*c);break;case"YXY":s.set(l*f,a*h,l*m,a*c);break;case"ZYZ":s.set(l*m,l*f,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function vh(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return s/4294967295;case Uint16Array:return s/65535;case Uint8Array:return s/255;case Int32Array:return Math.max(s/2147483647,-1);case Int16Array:return Math.max(s/32767,-1);case Int8Array:return Math.max(s/127,-1);default:throw new Error("Invalid component type.")}}function fn(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return Math.round(s*4294967295);case Uint16Array:return Math.round(s*65535);case Uint8Array:return Math.round(s*255);case Int32Array:return Math.round(s*2147483647);case Int16Array:return Math.round(s*32767);case Int8Array:return Math.round(s*127);default:throw new Error("Invalid component type.")}}const jTe={DEG2RAD:$C,RAD2DEG:hS,generateUUID:Rh,clamp:Ii,euclideanModulo:RO,mapLinear:kTe,inverseLerp:NTe,lerp:ew,damp:DTe,pingpong:FTe,smoothstep:VTe,smootherstep:zTe,randInt:UTe,randFloat:XTe,randFloatSpread:OTe,seededRandom:ZTe,degToRad:WTe,radToDeg:HTe,isPowerOfTwo:QTe,ceilPowerOfTwo:KTe,floorPowerOfTwo:YTe,setQuaternionFromProperEuler:JTe,normalize:fn,denormalize:vh};let Hr=class cne{constructor(e=0,t=0){cne.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Ii(this.x,e.x,t.x),this.y=Ii(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Ii(this.x,e,t),this.y=Ii(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Ii(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Ii(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*n+e.x,this.y=r*n+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},bA=class hne{constructor(e,t,i,n,r,o,a,l,c){hne.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,n,r,o,a,l,c)}set(e,t,i,n,r,o,a,l,c){const h=this.elements;return h[0]=e,h[1]=n,h[2]=a,h[3]=t,h[4]=r,h[5]=l,h[6]=i,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],h=i[4],d=i[7],u=i[2],f=i[5],m=i[8],g=n[0],A=n[3],y=n[6],b=n[1],x=n[4],v=n[7],_=n[2],C=n[5],S=n[8];return r[0]=o*g+a*b+l*_,r[3]=o*A+a*x+l*C,r[6]=o*y+a*v+l*S,r[1]=c*g+h*b+d*_,r[4]=c*A+h*x+d*C,r[7]=c*y+h*v+d*S,r[2]=u*g+f*b+m*_,r[5]=u*A+f*x+m*C,r[8]=u*y+f*v+m*S,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t*o*h-t*a*c-i*r*h+i*a*l+n*r*c-n*o*l}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=h*o-a*c,u=a*l-h*r,f=c*r-o*l,m=t*d+i*u+n*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/m;return e[0]=d*g,e[1]=(n*c-h*i)*g,e[2]=(a*i-n*o)*g,e[3]=u*g,e[4]=(h*t-n*l)*g,e[5]=(n*r-a*t)*g,e[6]=f*g,e[7]=(i*l-c*t)*g,e[8]=(o*t-i*r)*g,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-n*c,n*l,-n*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(Xk.makeScale(e,t)),this}rotate(e){return this.premultiply(Xk.makeRotation(-e)),this}translate(e,t){return this.premultiply(Xk.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const Xk=new bA;function qTe(s){for(let e=s.length-1;e>=0;--e)if(s[e]>=65535)return!0;return!1}function kV(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}const AQ=new bA().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),yQ=new bA().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function $Te(){const s={enabled:!0,workingColorSpace:tc,spaces:{},convert:function(n,r,o){return this.enabled===!1||r===o||!r||!o||(this.spaces[r].transfer===Uk&&(n.r=bp(n.r),n.g=bp(n.g),n.b=bp(n.b)),this.spaces[r].primaries!==this.spaces[o].primaries&&(n.applyMatrix3(this.spaces[r].toXYZ),n.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Uk&&(n.r=Kb(n.r),n.g=Kb(n.g),n.b=Kb(n.b))),n},fromWorkingColorSpace:function(n,r){return this.convert(n,this.workingColorSpace,r)},toWorkingColorSpace:function(n,r){return this.convert(n,r,this.workingColorSpace)},getPrimaries:function(n){return this.spaces[n].primaries},getTransfer:function(n){return n===qL?fQ:this.spaces[n].transfer},getLuminanceCoefficients:function(n,r=this.workingColorSpace){return n.fromArray(this.spaces[r].luminanceCoefficients)},define:function(n){Object.assign(this.spaces,n)},_getMatrix:function(n,r,o){return n.copy(this.spaces[r].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(n){return this.spaces[n].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(n=this.workingColorSpace){return this.spaces[n].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],i=[.3127,.329];return s.define({[tc]:{primaries:e,whitePoint:i,transfer:fQ,toXYZ:AQ,fromXYZ:yQ,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Js},outputColorSpaceConfig:{drawingBufferColorSpace:Js}},[Js]:{primaries:e,whitePoint:i,transfer:Uk,toXYZ:AQ,fromXYZ:yQ,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Js}}}),s}const Ka=$Te();function bp(s){return s<.04045?s*.0773993808:Math.pow(s*.9478672986+.0521327014,2.4)}function Kb(s){return s<.0031308?s*12.92:1.055*Math.pow(s,.41666)-.055}let yy;class eEe{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{yy===void 0&&(yy=kV("canvas")),yy.width=e.width,yy.height=e.height;const i=yy.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=yy}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=kV("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const n=i.getImageData(0,0,e.width,e.height),r=n.data;for(let o=0;o<r.length;o++)r[o]=bp(r[o]/255)*255;return i.putImageData(n,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(bp(t[i]/255)*255):t[i]=bp(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let tEe=0;class iEe{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:tEe++}),this.uuid=Rh(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let r;if(Array.isArray(n)){r=[];for(let o=0,a=n.length;o<a;o++)n[o].isDataTexture?r.push(Ok(n[o].image)):r.push(Ok(n[o]))}else r=Ok(n);i.url=r}return t||(e.images[this.uuid]=i),i}}function Ok(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap?eEe.getDataURL(s):s.data?{data:Array.from(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let nEe=0;class zr extends sP{constructor(e=zr.DEFAULT_IMAGE,t=zr.DEFAULT_MAPPING,i=u0,n=u0,r=gm,o=iM,a=Gf,l=cd,c=zr.DEFAULT_ANISOTROPY,h=qL){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:nEe++}),this.uuid=Rh(),this.name="",this.source=new iEe(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Hr(0,0),this.repeat=new Hr(1,1),this.center=new Hr(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new bA,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==one)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case aS:e.x=e.x-Math.floor(e.x);break;case u0:e.x=e.x<0?0:1;break;case LV:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case aS:e.y=e.y-Math.floor(e.y);break;case u0:e.y=e.y<0?0:1;break;case LV:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}zr.DEFAULT_IMAGE=null;zr.DEFAULT_MAPPING=one;zr.DEFAULT_ANISOTROPY=1;let Gl=class dne{constructor(e=0,t=0,i=0,n=1){dne.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*n+o[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r;const l=e.elements,c=l[0],h=l[4],d=l[8],u=l[1],f=l[5],m=l[9],g=l[2],A=l[6],y=l[10];if(Math.abs(h-u)<.01&&Math.abs(d-g)<.01&&Math.abs(m-A)<.01){if(Math.abs(h+u)<.1&&Math.abs(d+g)<.1&&Math.abs(m+A)<.1&&Math.abs(c+f+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const x=(c+1)/2,v=(f+1)/2,_=(y+1)/2,C=(h+u)/4,S=(d+g)/4,M=(m+A)/4;return x>v&&x>_?x<.01?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(x),n=C/i,r=S/i):v>_?v<.01?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(v),i=C/n,r=M/n):_<.01?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(_),i=S/r,n=M/r),this.set(i,n,r,t),this}let b=Math.sqrt((A-m)*(A-m)+(d-g)*(d-g)+(u-h)*(u-h));return Math.abs(b)<.001&&(b=1),this.x=(A-m)/b,this.y=(d-g)/b,this.z=(u-h)/b,this.w=Math.acos((c+f+y-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Ii(this.x,e.x,t.x),this.y=Ii(this.y,e.y,t.y),this.z=Ii(this.z,e.z,t.z),this.w=Ii(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Ii(this.x,e,t),this.y=Ii(this.y,e,t),this.z=Ii(this.z,e,t),this.w=Ii(this.w,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Ii(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};class sEe extends zr{constructor(e=null,t=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=Sx,this.minFilter=Sx,this.wrapR=u0,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let Dm=class{constructor(e=0,t=0,i=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,o,a){let l=i[n+0],c=i[n+1],h=i[n+2],d=i[n+3];const u=r[o+0],f=r[o+1],m=r[o+2],g=r[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d;return}if(a===1){e[t+0]=u,e[t+1]=f,e[t+2]=m,e[t+3]=g;return}if(d!==g||l!==u||c!==f||h!==m){let A=1-a;const y=l*u+c*f+h*m+d*g,b=y>=0?1:-1,x=1-y*y;if(x>Number.EPSILON){const _=Math.sqrt(x),C=Math.atan2(_,y*b);A=Math.sin(A*C)/_,a=Math.sin(a*C)/_}const v=a*b;if(l=l*A+u*v,c=c*A+f*v,h=h*A+m*v,d=d*A+g*v,A===1-a){const _=1/Math.sqrt(l*l+c*c+h*h+d*d);l*=_,c*=_,h*=_,d*=_}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,n,r,o){const a=i[n],l=i[n+1],c=i[n+2],h=i[n+3],d=r[o],u=r[o+1],f=r[o+2],m=r[o+3];return e[t]=a*m+h*d+l*f-c*u,e[t+1]=l*m+h*u+c*d-a*f,e[t+2]=c*m+h*f+a*u-l*d,e[t+3]=h*m-a*d-l*u-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,n=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(n/2),d=a(r/2),u=l(i/2),f=l(n/2),m=l(r/2);switch(o){case"XYZ":this._x=u*h*d+c*f*m,this._y=c*f*d-u*h*m,this._z=c*h*m+u*f*d,this._w=c*h*d-u*f*m;break;case"YXZ":this._x=u*h*d+c*f*m,this._y=c*f*d-u*h*m,this._z=c*h*m-u*f*d,this._w=c*h*d+u*f*m;break;case"ZXY":this._x=u*h*d-c*f*m,this._y=c*f*d+u*h*m,this._z=c*h*m+u*f*d,this._w=c*h*d-u*f*m;break;case"ZYX":this._x=u*h*d-c*f*m,this._y=c*f*d+u*h*m,this._z=c*h*m-u*f*d,this._w=c*h*d+u*f*m;break;case"YZX":this._x=u*h*d+c*f*m,this._y=c*f*d+u*h*m,this._z=c*h*m-u*f*d,this._w=c*h*d-u*f*m;break;case"XZY":this._x=u*h*d-c*f*m,this._y=c*f*d-u*h*m,this._z=c*h*m+u*f*d,this._w=c*h*d+u*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],r=t[8],o=t[1],a=t[5],l=t[9],c=t[2],h=t[6],d=t[10],u=i+a+d;if(u>0){const f=.5/Math.sqrt(u+1);this._w=.25/f,this._x=(h-l)*f,this._y=(r-c)*f,this._z=(o-n)*f}else if(i>a&&i>d){const f=2*Math.sqrt(1+i-a-d);this._w=(h-l)/f,this._x=.25*f,this._y=(n+o)/f,this._z=(r+c)/f}else if(a>d){const f=2*Math.sqrt(1+a-i-d);this._w=(r-c)/f,this._x=(n+o)/f,this._y=.25*f,this._z=(l+h)/f}else{const f=2*Math.sqrt(1+d-i-a);this._w=(o-n)/f,this._x=(r+c)/f,this._y=(l+h)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ii(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,r=e._z,o=e._w,a=t._x,l=t._y,c=t._z,h=t._w;return this._x=i*h+o*a+n*c-r*l,this._y=n*h+o*l+r*a-i*c,this._z=r*h+o*c+i*l-n*a,this._w=o*h-i*a-n*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,n=this._y,r=this._z,o=this._w;let a=o*e._w+i*e._x+n*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*i+t*this._x,this._y=f*n+t*this._y,this._z=f*r+t*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),d=Math.sin((1-t)*h)/c,u=Math.sin(t*h)/c;return this._w=o*d+this._w*u,this._x=i*d+this._x*u,this._y=n*d+this._y*u,this._z=r*d+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(n*Math.sin(e),n*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},_e=class une{constructor(e=0,t=0,i=0){une.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(bQ.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(bQ.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*n-a*i),h=2*(a*t-r*n),d=2*(r*i-o*t);return this.x=t+l*c+o*d-a*h,this.y=i+l*h+a*c-r*d,this.z=n+l*d+r*h-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Ii(this.x,e.x,t.x),this.y=Ii(this.y,e.y,t.y),this.z=Ii(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Ii(this.x,e,t),this.y=Ii(this.y,e,t),this.z=Ii(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Ii(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=n*l-r*a,this.y=r*o-i*l,this.z=i*a-n*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Zk.copy(this).projectOnVector(e),this.sub(Zk)}reflect(e){return this.sub(Zk.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Ii(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const Zk=new _e,bQ=new Dm;class Dh{constructor(e=new _e(1/0,1/0,1/0),t=new _e(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(nh.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(nh.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=nh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const r=i.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=r.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,nh):nh.fromBufferAttribute(r,o),nh.applyMatrix4(e.matrixWorld),this.expandByPoint(nh);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),gT.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),gT.copy(i.boundingBox)),gT.applyMatrix4(e.matrixWorld),this.union(gT)}const n=e.children;for(let r=0,o=n.length;r<o;r++)this.expandByObject(n[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,nh),nh.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(a_),AT.subVectors(this.max,a_),by.subVectors(e.a,a_),xy.subVectors(e.b,a_),vy.subVectors(e.c,a_),ef.subVectors(xy,by),tf.subVectors(vy,xy),bg.subVectors(by,vy);let t=[0,-ef.z,ef.y,0,-tf.z,tf.y,0,-bg.z,bg.y,ef.z,0,-ef.x,tf.z,0,-tf.x,bg.z,0,-bg.x,-ef.y,ef.x,0,-tf.y,tf.x,0,-bg.y,bg.x,0];return!Wk(t,by,xy,vy,AT)||(t=[1,0,0,0,1,0,0,0,1],!Wk(t,by,xy,vy,AT))?!1:(yT.crossVectors(ef,tf),t=[yT.x,yT.y,yT.z],Wk(t,by,xy,vy,AT))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,nh).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(nh).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(wu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),wu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),wu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),wu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),wu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),wu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),wu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),wu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(wu),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const wu=[new _e,new _e,new _e,new _e,new _e,new _e,new _e,new _e],nh=new _e,gT=new Dh,by=new _e,xy=new _e,vy=new _e,ef=new _e,tf=new _e,bg=new _e,a_=new _e,AT=new _e,yT=new _e,xg=new _e;function Wk(s,e,t,i,n){for(let r=0,o=s.length-3;r<=o;r+=3){xg.fromArray(s,r);const a=n.x*Math.abs(xg.x)+n.y*Math.abs(xg.y)+n.z*Math.abs(xg.z),l=e.dot(xg),c=t.dot(xg),h=i.dot(xg);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}const rEe=new Dh,l_=new _e,Hk=new _e;class Oh{constructor(e=new _e,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):rEe.setFromPoints(e).getCenter(i);let n=0;for(let r=0,o=e.length;r<o;r++)n=Math.max(n,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;l_.subVectors(e,this.center);const t=l_.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),n=(i-this.radius)*.5;this.center.addScaledVector(l_,n/i),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Hk.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(l_.copy(e.center).add(Hk)),this.expandByPoint(l_.copy(e.center).sub(Hk))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Su=new _e,Qk=new _e,bT=new _e,nf=new _e,Kk=new _e,xT=new _e,Yk=new _e;class rP{constructor(e=new _e,t=new _e(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Su)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Su.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Su.copy(this.origin).addScaledVector(this.direction,t),Su.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){Qk.copy(e).add(t).multiplyScalar(.5),bT.copy(t).sub(e).normalize(),nf.copy(this.origin).sub(Qk);const r=e.distanceTo(t)*.5,o=-this.direction.dot(bT),a=nf.dot(this.direction),l=-nf.dot(bT),c=nf.lengthSq(),h=Math.abs(1-o*o);let d,u,f,m;if(h>0)if(d=o*l-a,u=o*a-l,m=r*h,d>=0)if(u>=-m)if(u<=m){const g=1/h;d*=g,u*=g,f=d*(d+o*u+2*a)+u*(o*d+u+2*l)+c}else u=r,d=Math.max(0,-(o*u+a)),f=-d*d+u*(u+2*l)+c;else u=-r,d=Math.max(0,-(o*u+a)),f=-d*d+u*(u+2*l)+c;else u<=-m?(d=Math.max(0,-(-o*r+a)),u=d>0?-r:Math.min(Math.max(-r,-l),r),f=-d*d+u*(u+2*l)+c):u<=m?(d=0,u=Math.min(Math.max(-r,-l),r),f=u*(u+2*l)+c):(d=Math.max(0,-(o*r+a)),u=d>0?r:Math.min(Math.max(-r,-l),r),f=-d*d+u*(u+2*l)+c);else u=o>0?-r:r,d=Math.max(0,-(o*u+a)),f=-d*d+u*(u+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,d),n&&n.copy(Qk).addScaledVector(bT,u),f}intersectSphere(e,t){Su.subVectors(e.center,this.origin);const i=Su.dot(this.direction),n=Su.dot(Su)-i*i,r=e.radius*e.radius;if(n>r)return null;const o=Math.sqrt(r-n),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,d=1/this.direction.z,u=this.origin;return c>=0?(i=(e.min.x-u.x)*c,n=(e.max.x-u.x)*c):(i=(e.max.x-u.x)*c,n=(e.min.x-u.x)*c),h>=0?(r=(e.min.y-u.y)*h,o=(e.max.y-u.y)*h):(r=(e.max.y-u.y)*h,o=(e.min.y-u.y)*h),i>o||r>n||((r>i||isNaN(i))&&(i=r),(o<n||isNaN(n))&&(n=o),d>=0?(a=(e.min.z-u.z)*d,l=(e.max.z-u.z)*d):(a=(e.max.z-u.z)*d,l=(e.min.z-u.z)*d),i>l||a>n)||((a>i||i!==i)&&(i=a),(l<n||n!==n)&&(n=l),n<0)?null:this.at(i>=0?i:n,t)}intersectsBox(e){return this.intersectBox(e,Su)!==null}intersectTriangle(e,t,i,n,r){Kk.subVectors(t,e),xT.subVectors(i,e),Yk.crossVectors(Kk,xT);let o=this.direction.dot(Yk),a;if(o>0){if(n)return null;a=1}else if(o<0)a=-1,o=-o;else return null;nf.subVectors(this.origin,e);const l=a*this.direction.dot(xT.crossVectors(nf,xT));if(l<0)return null;const c=a*this.direction.dot(Kk.cross(nf));if(c<0||l+c>o)return null;const h=-a*nf.dot(Yk);return h<0?null:this.at(h/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}let Qi=class NV{constructor(e,t,i,n,r,o,a,l,c,h,d,u,f,m,g,A){NV.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,n,r,o,a,l,c,h,d,u,f,m,g,A)}set(e,t,i,n,r,o,a,l,c,h,d,u,f,m,g,A){const y=this.elements;return y[0]=e,y[4]=t,y[8]=i,y[12]=n,y[1]=r,y[5]=o,y[9]=a,y[13]=l,y[2]=c,y[6]=h,y[10]=d,y[14]=u,y[3]=f,y[7]=m,y[11]=g,y[15]=A,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new NV().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/_y.setFromMatrixColumn(e,0).length(),r=1/_y.setFromMatrixColumn(e,1).length(),o=1/_y.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(n),c=Math.sin(n),h=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){const u=o*h,f=o*d,m=a*h,g=a*d;t[0]=l*h,t[4]=-l*d,t[8]=c,t[1]=f+m*c,t[5]=u-g*c,t[9]=-a*l,t[2]=g-u*c,t[6]=m+f*c,t[10]=o*l}else if(e.order==="YXZ"){const u=l*h,f=l*d,m=c*h,g=c*d;t[0]=u+g*a,t[4]=m*a-f,t[8]=o*c,t[1]=o*d,t[5]=o*h,t[9]=-a,t[2]=f*a-m,t[6]=g+u*a,t[10]=o*l}else if(e.order==="ZXY"){const u=l*h,f=l*d,m=c*h,g=c*d;t[0]=u-g*a,t[4]=-o*d,t[8]=m+f*a,t[1]=f+m*a,t[5]=o*h,t[9]=g-u*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const u=o*h,f=o*d,m=a*h,g=a*d;t[0]=l*h,t[4]=m*c-f,t[8]=u*c+g,t[1]=l*d,t[5]=g*c+u,t[9]=f*c-m,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const u=o*l,f=o*c,m=a*l,g=a*c;t[0]=l*h,t[4]=g-u*d,t[8]=m*d+f,t[1]=d,t[5]=o*h,t[9]=-a*h,t[2]=-c*h,t[6]=f*d+m,t[10]=u-g*d}else if(e.order==="XZY"){const u=o*l,f=o*c,m=a*l,g=a*c;t[0]=l*h,t[4]=-d,t[8]=c*h,t[1]=u*d+g,t[5]=o*h,t[9]=f*d-m,t[2]=m*d-f,t[6]=a*h,t[10]=g*d+u}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(oEe,e,aEe)}lookAt(e,t,i){const n=this.elements;return bl.subVectors(e,t),bl.lengthSq()===0&&(bl.z=1),bl.normalize(),sf.crossVectors(i,bl),sf.lengthSq()===0&&(Math.abs(i.z)===1?bl.x+=1e-4:bl.z+=1e-4,bl.normalize(),sf.crossVectors(i,bl)),sf.normalize(),vT.crossVectors(bl,sf),n[0]=sf.x,n[4]=vT.x,n[8]=bl.x,n[1]=sf.y,n[5]=vT.y,n[9]=bl.y,n[2]=sf.z,n[6]=vT.z,n[10]=bl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],h=i[1],d=i[5],u=i[9],f=i[13],m=i[2],g=i[6],A=i[10],y=i[14],b=i[3],x=i[7],v=i[11],_=i[15],C=n[0],S=n[4],M=n[8],L=n[12],w=n[1],E=n[5],B=n[9],P=n[13],k=n[2],X=n[6],F=n[10],H=n[14],W=n[3],se=n[7],de=n[11],be=n[15];return r[0]=o*C+a*w+l*k+c*W,r[4]=o*S+a*E+l*X+c*se,r[8]=o*M+a*B+l*F+c*de,r[12]=o*L+a*P+l*H+c*be,r[1]=h*C+d*w+u*k+f*W,r[5]=h*S+d*E+u*X+f*se,r[9]=h*M+d*B+u*F+f*de,r[13]=h*L+d*P+u*H+f*be,r[2]=m*C+g*w+A*k+y*W,r[6]=m*S+g*E+A*X+y*se,r[10]=m*M+g*B+A*F+y*de,r[14]=m*L+g*P+A*H+y*be,r[3]=b*C+x*w+v*k+_*W,r[7]=b*S+x*E+v*X+_*se,r[11]=b*M+x*B+v*F+_*de,r[15]=b*L+x*P+v*H+_*be,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],a=e[5],l=e[9],c=e[13],h=e[2],d=e[6],u=e[10],f=e[14],m=e[3],g=e[7],A=e[11],y=e[15];return m*(+r*l*d-n*c*d-r*a*u+i*c*u+n*a*f-i*l*f)+g*(+t*l*f-t*c*u+r*o*u-n*o*f+n*c*h-r*l*h)+A*(+t*c*d-t*a*f-r*o*d+i*o*f+r*a*h-i*c*h)+y*(-n*a*h-t*l*d+t*a*u+n*o*d-i*o*u+i*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],u=e[10],f=e[11],m=e[12],g=e[13],A=e[14],y=e[15],b=d*A*c-g*u*c+g*l*f-a*A*f-d*l*y+a*u*y,x=m*u*c-h*A*c-m*l*f+o*A*f+h*l*y-o*u*y,v=h*g*c-m*d*c+m*a*f-o*g*f-h*a*y+o*d*y,_=m*d*l-h*g*l-m*a*u+o*g*u+h*a*A-o*d*A,C=t*b+i*x+n*v+r*_;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/C;return e[0]=b*S,e[1]=(g*u*r-d*A*r-g*n*f+i*A*f+d*n*y-i*u*y)*S,e[2]=(a*A*r-g*l*r+g*n*c-i*A*c-a*n*y+i*l*y)*S,e[3]=(d*l*r-a*u*r-d*n*c+i*u*c+a*n*f-i*l*f)*S,e[4]=x*S,e[5]=(h*A*r-m*u*r+m*n*f-t*A*f-h*n*y+t*u*y)*S,e[6]=(m*l*r-o*A*r-m*n*c+t*A*c+o*n*y-t*l*y)*S,e[7]=(o*u*r-h*l*r+h*n*c-t*u*c-o*n*f+t*l*f)*S,e[8]=v*S,e[9]=(m*d*r-h*g*r-m*i*f+t*g*f+h*i*y-t*d*y)*S,e[10]=(o*g*r-m*a*r+m*i*c-t*g*c-o*i*y+t*a*y)*S,e[11]=(h*a*r-o*d*r-h*i*c+t*d*c+o*i*f-t*a*f)*S,e[12]=_*S,e[13]=(h*g*n-m*d*n+m*i*u-t*g*u-h*i*A+t*d*A)*S,e[14]=(m*a*n-o*g*n-m*i*l+t*g*l+o*i*A-t*a*A)*S,e[15]=(o*d*n-h*a*n+h*i*l-t*d*l-o*i*u+t*a*u)*S,this}scale(e){const t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,a=e.y,l=e.z,c=r*o,h=r*a;return this.set(c*o+i,c*a-n*l,c*l+n*a,0,c*a+n*l,h*a+i,h*l-n*o,0,c*l-n*a,h*l+n*o,r*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,o){return this.set(1,i,r,0,e,1,o,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,c=r+r,h=o+o,d=a+a,u=r*c,f=r*h,m=r*d,g=o*h,A=o*d,y=a*d,b=l*c,x=l*h,v=l*d,_=i.x,C=i.y,S=i.z;return n[0]=(1-(g+y))*_,n[1]=(f+v)*_,n[2]=(m-x)*_,n[3]=0,n[4]=(f-v)*C,n[5]=(1-(u+y))*C,n[6]=(A+b)*C,n[7]=0,n[8]=(m+x)*S,n[9]=(A-b)*S,n[10]=(1-(u+g))*S,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let r=_y.set(n[0],n[1],n[2]).length();const o=_y.set(n[4],n[5],n[6]).length(),a=_y.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],sh.copy(this);const c=1/r,h=1/o,d=1/a;return sh.elements[0]*=c,sh.elements[1]*=c,sh.elements[2]*=c,sh.elements[4]*=h,sh.elements[5]*=h,sh.elements[6]*=h,sh.elements[8]*=d,sh.elements[9]*=d,sh.elements[10]*=d,t.setFromRotationMatrix(sh),i.x=r,i.y=o,i.z=a,this}makePerspective(e,t,i,n,r,o,a=p0){const l=this.elements,c=2*r/(t-e),h=2*r/(i-n),d=(t+e)/(t-e),u=(i+n)/(i-n);let f,m;if(a===p0)f=-(o+r)/(o-r),m=-2*o*r/(o-r);else if(a===GV)f=-o/(o-r),m=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=h,l[9]=u,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,n,r,o,a=p0){const l=this.elements,c=1/(t-e),h=1/(i-n),d=1/(o-r),u=(t+e)*c,f=(i+n)*h;let m,g;if(a===p0)m=(o+r)*d,g=-2*d;else if(a===GV)m=r*d,g=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-u,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=g,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}};const _y=new _e,sh=new Qi,oEe=new _e(0,0,0),aEe=new _e(1,1,1),sf=new _e,vT=new _e,bl=new _e,xQ=new Qi,vQ=new Dm;let oP=class pne{constructor(e=0,t=0,i=0,n=pne.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const n=e.elements,r=n[0],o=n[4],a=n[8],l=n[1],c=n[5],h=n[9],d=n[2],u=n[6],f=n[10];switch(t){case"XYZ":this._y=Math.asin(Ii(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(u,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Ii(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(Ii(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-Ii(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(u,f),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Ii(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-Ii(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(u,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return xQ.makeRotationFromQuaternion(e),this.setFromRotationMatrix(xQ,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return vQ.setFromEuler(this),this.setFromQuaternion(vQ,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};oP.DEFAULT_ORDER="XYZ";class lEe{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let cEe=0;const _Q=new _e,Cy=new Dm,Mu=new Qi,_T=new _e,c_=new _e,hEe=new _e,dEe=new Dm,CQ=new _e(1,0,0),wQ=new _e(0,1,0),SQ=new _e(0,0,1),MQ={type:"added"},uEe={type:"removed"},wy={type:"childadded",child:null},Jk={type:"childremoved",child:null};class Os extends sP{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:cEe++}),this.uuid=Rh(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Os.DEFAULT_UP.clone();const e=new _e,t=new oP,i=new Dm,n=new _e(1,1,1);function r(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Qi},normalMatrix:{value:new bA}}),this.matrix=new Qi,this.matrixWorld=new Qi,this.matrixAutoUpdate=Os.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Os.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new lEe,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Cy.setFromAxisAngle(e,t),this.quaternion.multiply(Cy),this}rotateOnWorldAxis(e,t){return Cy.setFromAxisAngle(e,t),this.quaternion.premultiply(Cy),this}rotateX(e){return this.rotateOnAxis(CQ,e)}rotateY(e){return this.rotateOnAxis(wQ,e)}rotateZ(e){return this.rotateOnAxis(SQ,e)}translateOnAxis(e,t){return _Q.copy(e).applyQuaternion(this.quaternion),this.position.add(_Q.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(CQ,e)}translateY(e){return this.translateOnAxis(wQ,e)}translateZ(e){return this.translateOnAxis(SQ,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Mu.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?_T.copy(e):_T.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),c_.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Mu.lookAt(c_,_T,this.up):Mu.lookAt(_T,c_,this.up),this.quaternion.setFromRotationMatrix(Mu),n&&(Mu.extractRotation(n.matrixWorld),Cy.setFromRotationMatrix(Mu),this.quaternion.premultiply(Cy.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(MQ),wy.child=e,this.dispatchEvent(wy),wy.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(uEe),Jk.child=e,this.dispatchEvent(Jk),Jk.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Mu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Mu.multiply(e.parent.matrixWorld)),e.applyMatrix4(Mu),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(MQ),wy.child=e,this.dispatchEvent(wy),wy.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const n=this.children;for(let r=0,o=n.length;r<o;r++)n[r].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(c_,e,hEe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(c_,dEe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const n=this.children;for(let r=0,o=n.length;r<o;r++)n[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),n.maxInstanceCount=this._maxInstanceCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(n.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),this.boundingBox!==null&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()}));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const d=l[c];r(e.shapes,d)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));n.material=a}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];n.animations.push(r(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),h=o(e.images),d=o(e.shapes),u=o(e.skeletons),f=o(e.animations),m=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),h.length>0&&(i.images=h),d.length>0&&(i.shapes=d),u.length>0&&(i.skeletons=u),f.length>0&&(i.animations=f),m.length>0&&(i.nodes=m)}return i.object=n,i;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const n=e.children[i];this.add(n.clone())}return this}}Os.DEFAULT_UP=new _e(0,1,0);Os.DEFAULT_MATRIX_AUTO_UPDATE=!0;Os.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const rh=new _e,Iu=new _e,jk=new _e,Tu=new _e,Sy=new _e,My=new _e,IQ=new _e,qk=new _e,$k=new _e,eN=new _e,tN=new Gl,iN=new Gl,nN=new Gl;class _h{constructor(e=new _e,t=new _e,i=new _e){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),rh.subVectors(e,t),n.cross(rh);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){rh.subVectors(n,t),Iu.subVectors(i,t),jk.subVectors(e,t);const o=rh.dot(rh),a=rh.dot(Iu),l=rh.dot(jk),c=Iu.dot(Iu),h=Iu.dot(jk),d=o*c-a*a;if(d===0)return r.set(0,0,0),null;const u=1/d,f=(c*l-a*h)*u,m=(o*h-a*l)*u;return r.set(1-f-m,m,f)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,Tu)===null?!1:Tu.x>=0&&Tu.y>=0&&Tu.x+Tu.y<=1}static getInterpolation(e,t,i,n,r,o,a,l){return this.getBarycoord(e,t,i,n,Tu)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(r,Tu.x),l.addScaledVector(o,Tu.y),l.addScaledVector(a,Tu.z),l)}static getInterpolatedAttribute(e,t,i,n,r,o){return tN.setScalar(0),iN.setScalar(0),nN.setScalar(0),tN.fromBufferAttribute(e,t),iN.fromBufferAttribute(e,i),nN.fromBufferAttribute(e,n),o.setScalar(0),o.addScaledVector(tN,r.x),o.addScaledVector(iN,r.y),o.addScaledVector(nN,r.z),o}static isFrontFacing(e,t,i,n){return rh.subVectors(i,t),Iu.subVectors(e,t),rh.cross(Iu).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return rh.subVectors(this.c,this.b),Iu.subVectors(this.a,this.b),rh.cross(Iu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return _h.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return _h.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,n,r){return _h.getInterpolation(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return _h.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return _h.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,n=this.b,r=this.c;let o,a;Sy.subVectors(n,i),My.subVectors(r,i),qk.subVectors(e,i);const l=Sy.dot(qk),c=My.dot(qk);if(l<=0&&c<=0)return t.copy(i);$k.subVectors(e,n);const h=Sy.dot($k),d=My.dot($k);if(h>=0&&d<=h)return t.copy(n);const u=l*d-h*c;if(u<=0&&l>=0&&h<=0)return o=l/(l-h),t.copy(i).addScaledVector(Sy,o);eN.subVectors(e,r);const f=Sy.dot(eN),m=My.dot(eN);if(m>=0&&f<=m)return t.copy(r);const g=f*c-l*m;if(g<=0&&c>=0&&m<=0)return a=c/(c-m),t.copy(i).addScaledVector(My,a);const A=h*m-f*d;if(A<=0&&d-h>=0&&f-m>=0)return IQ.subVectors(r,n),a=(d-h)/(d-h+(f-m)),t.copy(n).addScaledVector(IQ,a);const y=1/(A+g+u);return o=g*y,a=u*y,t.copy(i).addScaledVector(Sy,o).addScaledVector(My,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const fne={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},rf={h:0,s:0,l:0},CT={h:0,s:0,l:0};function sN(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*6*(2/3-t):s}class nr{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const n=e;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Js){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ka.toWorkingColorSpace(this,t),this}setRGB(e,t,i,n=Ka.workingColorSpace){return this.r=e,this.g=t,this.b=i,Ka.toWorkingColorSpace(this,n),this}setHSL(e,t,i,n=Ka.workingColorSpace){if(e=RO(e,1),t=Ii(t,0,1),i=Ii(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=sN(o,r,e+1/3),this.g=sN(o,r,e),this.b=sN(o,r,e-1/3)}return Ka.toWorkingColorSpace(this,n),this}setStyle(e,t=Js){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=n[1],a=n[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=n[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Js){const i=fne[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=bp(e.r),this.g=bp(e.g),this.b=bp(e.b),this}copyLinearToSRGB(e){return this.r=Kb(e.r),this.g=Kb(e.g),this.b=Kb(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Js){return Ka.fromWorkingColorSpace(Wo.copy(this),e),Math.round(Ii(Wo.r*255,0,255))*65536+Math.round(Ii(Wo.g*255,0,255))*256+Math.round(Ii(Wo.b*255,0,255))}getHexString(e=Js){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ka.workingColorSpace){Ka.fromWorkingColorSpace(Wo.copy(this),t);const i=Wo.r,n=Wo.g,r=Wo.b,o=Math.max(i,n,r),a=Math.min(i,n,r);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const d=o-a;switch(c=h<=.5?d/(o+a):d/(2-o-a),o){case i:l=(n-r)/d+(n<r?6:0);break;case n:l=(r-i)/d+2;break;case r:l=(i-n)/d+4;break}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,t=Ka.workingColorSpace){return Ka.fromWorkingColorSpace(Wo.copy(this),t),e.r=Wo.r,e.g=Wo.g,e.b=Wo.b,e}getStyle(e=Js){Ka.fromWorkingColorSpace(Wo.copy(this),e);const t=Wo.r,i=Wo.g,n=Wo.b;return e!==Js?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(n*255)})`}offsetHSL(e,t,i){return this.getHSL(rf),this.setHSL(rf.h+e,rf.s+t,rf.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(rf),e.getHSL(CT);const i=ew(rf.h,CT.h,t),n=ew(rf.s,CT.s,t),r=ew(rf.l,CT.l,t);return this.setHSL(i,n,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,n=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*n,this.g=r[1]*t+r[4]*i+r[7]*n,this.b=r[2]*t+r[5]*i+r[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Wo=new nr;nr.NAMES=fne;let pEe=0;class Hf extends sP{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:pEe++}),this.uuid=Rh(),this.name="",this.type="Material",this.blending=sQ,this.side=jL,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=oQ,this.blendDst=aQ,this.blendEquation=rQ,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new nr(0,0,0),this.blendAlpha=0,this.depthFunc=lQ,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=mQ,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ay,this.stencilZFail=Ay,this.stencilZPass=Ay,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const n=this[t];if(n===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==sQ&&(i.blending=this.blending),this.side!==jL&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==oQ&&(i.blendSrc=this.blendSrc),this.blendDst!==aQ&&(i.blendDst=this.blendDst),this.blendEquation!==rQ&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==lQ&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==mQ&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Ay&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Ay&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Ay&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function n(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(t){const r=n(e.textures),o=n(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const n=t.length;i=new Array(n);for(let r=0;r!==n;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Eb extends Hf{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new nr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new oP,this.combine=ATe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Qs=new _e,wT=new Hr;class Kl{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=PV,this.updateRanges=[],this.gpuType=Wf,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)wT.fromBufferAttribute(this,t),wT.applyMatrix3(e),this.setXY(t,wT.x,wT.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Qs.fromBufferAttribute(this,t),Qs.applyMatrix3(e),this.setXYZ(t,Qs.x,Qs.y,Qs.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Qs.fromBufferAttribute(this,t),Qs.applyMatrix4(e),this.setXYZ(t,Qs.x,Qs.y,Qs.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Qs.fromBufferAttribute(this,t),Qs.applyNormalMatrix(e),this.setXYZ(t,Qs.x,Qs.y,Qs.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Qs.fromBufferAttribute(this,t),Qs.transformDirection(e),this.setXYZ(t,Qs.x,Qs.y,Qs.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=vh(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=fn(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=vh(t,this.array)),t}setX(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=vh(t,this.array)),t}setY(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=vh(t,this.array)),t}setZ(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=vh(t,this.array)),t}setW(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=fn(t,this.array),i=fn(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=fn(t,this.array),i=fn(i,this.array),n=fn(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=fn(t,this.array),i=fn(i,this.array),n=fn(n,this.array),r=fn(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==PV&&(e.usage=this.usage),e}}class fEe extends Kl{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class mEe extends Kl{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class LO extends Kl{constructor(e,t,i){super(new Float32Array(e),t,i)}}let gEe=0;const dc=new Qi,rN=new Os,Iy=new _e,xl=new Dh,h_=new Dh,Er=new _e;class Fh extends sP{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:gEe++}),this.uuid=Rh(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(qTe(e)?mEe:fEe)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new bA().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return dc.makeRotationFromQuaternion(e),this.applyMatrix4(dc),this}rotateX(e){return dc.makeRotationX(e),this.applyMatrix4(dc),this}rotateY(e){return dc.makeRotationY(e),this.applyMatrix4(dc),this}rotateZ(e){return dc.makeRotationZ(e),this.applyMatrix4(dc),this}translate(e,t,i){return dc.makeTranslation(e,t,i),this.applyMatrix4(dc),this}scale(e,t,i){return dc.makeScale(e,t,i),this.applyMatrix4(dc),this}lookAt(e){return rN.lookAt(e),rN.updateMatrix(),this.applyMatrix4(rN.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Iy).negate(),this.translate(Iy.x,Iy.y,Iy.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const i=[];for(let n=0,r=e.length;n<r;n++){const o=e[n];i.push(o.x,o.y,o.z||0)}this.setAttribute("position",new LO(i,3))}else{const i=Math.min(e.length,t.count);for(let n=0;n<i;n++){const r=e[n];t.setXYZ(n,r.x,r.y,r.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Dh);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new _e(-1/0,-1/0,-1/0),new _e(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,n=t.length;i<n;i++){const r=t[i];xl.setFromBufferAttribute(r),this.morphTargetsRelative?(Er.addVectors(this.boundingBox.min,xl.min),this.boundingBox.expandByPoint(Er),Er.addVectors(this.boundingBox.max,xl.max),this.boundingBox.expandByPoint(Er)):(this.boundingBox.expandByPoint(xl.min),this.boundingBox.expandByPoint(xl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Oh);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new _e,1/0);return}if(e){const i=this.boundingSphere.center;if(xl.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];h_.setFromBufferAttribute(a),this.morphTargetsRelative?(Er.addVectors(xl.min,h_.min),xl.expandByPoint(Er),Er.addVectors(xl.max,h_.max),xl.expandByPoint(Er)):(xl.expandByPoint(h_.min),xl.expandByPoint(h_.max))}xl.getCenter(i);let n=0;for(let r=0,o=e.count;r<o;r++)Er.fromBufferAttribute(e,r),n=Math.max(n,i.distanceToSquared(Er));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],l=this.morphTargetsRelative;for(let c=0,h=a.count;c<h;c++)Er.fromBufferAttribute(a,c),l&&(Iy.fromBufferAttribute(e,c),Er.add(Iy)),n=Math.max(n,i.distanceToSquared(Er))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,n=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Kl(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let M=0;M<i.count;M++)a[M]=new _e,l[M]=new _e;const c=new _e,h=new _e,d=new _e,u=new Hr,f=new Hr,m=new Hr,g=new _e,A=new _e;function y(M,L,w){c.fromBufferAttribute(i,M),h.fromBufferAttribute(i,L),d.fromBufferAttribute(i,w),u.fromBufferAttribute(r,M),f.fromBufferAttribute(r,L),m.fromBufferAttribute(r,w),h.sub(c),d.sub(c),f.sub(u),m.sub(u);const E=1/(f.x*m.y-m.x*f.y);isFinite(E)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(E),A.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(E),a[M].add(g),a[L].add(g),a[w].add(g),l[M].add(A),l[L].add(A),l[w].add(A))}let b=this.groups;b.length===0&&(b=[{start:0,count:e.count}]);for(let M=0,L=b.length;M<L;++M){const w=b[M],E=w.start,B=w.count;for(let P=E,k=E+B;P<k;P+=3)y(e.getX(P+0),e.getX(P+1),e.getX(P+2))}const x=new _e,v=new _e,_=new _e,C=new _e;function S(M){_.fromBufferAttribute(n,M),C.copy(_);const L=a[M];x.copy(L),x.sub(_.multiplyScalar(_.dot(L))).normalize(),v.crossVectors(C,L);const E=v.dot(l[M])<0?-1:1;o.setXYZW(M,x.x,x.y,x.z,E)}for(let M=0,L=b.length;M<L;++M){const w=b[M],E=w.start,B=w.count;for(let P=E,k=E+B;P<k;P+=3)S(e.getX(P+0)),S(e.getX(P+1)),S(e.getX(P+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Kl(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let u=0,f=i.count;u<f;u++)i.setXYZ(u,0,0,0);const n=new _e,r=new _e,o=new _e,a=new _e,l=new _e,c=new _e,h=new _e,d=new _e;if(e)for(let u=0,f=e.count;u<f;u+=3){const m=e.getX(u+0),g=e.getX(u+1),A=e.getX(u+2);n.fromBufferAttribute(t,m),r.fromBufferAttribute(t,g),o.fromBufferAttribute(t,A),h.subVectors(o,r),d.subVectors(n,r),h.cross(d),a.fromBufferAttribute(i,m),l.fromBufferAttribute(i,g),c.fromBufferAttribute(i,A),a.add(h),l.add(h),c.add(h),i.setXYZ(m,a.x,a.y,a.z),i.setXYZ(g,l.x,l.y,l.z),i.setXYZ(A,c.x,c.y,c.z)}else for(let u=0,f=t.count;u<f;u+=3)n.fromBufferAttribute(t,u+0),r.fromBufferAttribute(t,u+1),o.fromBufferAttribute(t,u+2),h.subVectors(o,r),d.subVectors(n,r),h.cross(d),i.setXYZ(u+0,h.x,h.y,h.z),i.setXYZ(u+1,h.x,h.y,h.z),i.setXYZ(u+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Er.fromBufferAttribute(e,t),Er.normalize(),e.setXYZ(t,Er.x,Er.y,Er.z)}toNonIndexed(){function e(a,l){const c=a.array,h=a.itemSize,d=a.normalized,u=new c.constructor(l.length*h);let f=0,m=0;for(let g=0,A=l.length;g<A;g++){a.isInterleavedBufferAttribute?f=l[g]*a.data.stride+a.offset:f=l[g]*h;for(let y=0;y<h;y++)u[m++]=c[f++]}return new Kl(u,h,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Fh,i=this.index.array,n=this.attributes;for(const a in n){const l=n[a],c=e(l,i);t.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const l=[],c=r[a];for(let h=0,d=c.length;h<d;h++){const u=c[h],f=e(u,i);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const n={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let d=0,u=c.length;d<u;d++){const f=c[d];h.push(f.toJSON(e.data))}h.length>0&&(n[l]=h,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const n=e.attributes;for(const c in n){const h=n[c];this.setAttribute(c,h.clone(t))}const r=e.morphAttributes;for(const c in r){const h=[],d=r[c];for(let u=0,f=d.length;u<f;u++)h.push(d[u].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,h=o.length;c<h;c++){const d=o[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const TQ=new Qi,vg=new rP,ST=new Oh,EQ=new _e,MT=new _e,IT=new _e,TT=new _e,oN=new _e,ET=new _e,RQ=new _e,RT=new _e;class Qf extends Os{constructor(e=new Fh,t=new Eb){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(e,t){const i=this.geometry,n=i.attributes.position,r=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(n,e);const a=this.morphTargetInfluences;if(r&&a){ET.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const h=a[l],d=r[l];h!==0&&(oN.fromBufferAttribute(d,e),o?ET.addScaledVector(oN,h):ET.addScaledVector(oN.sub(t),h))}t.add(ET)}return t}raycast(e,t){const i=this.geometry,n=this.material,r=this.matrixWorld;n!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),ST.copy(i.boundingSphere),ST.applyMatrix4(r),vg.copy(e.ray).recast(e.near),!(ST.containsPoint(vg.origin)===!1&&(vg.intersectSphere(ST,EQ)===null||vg.origin.distanceToSquared(EQ)>(e.far-e.near)**2))&&(TQ.copy(r).invert(),vg.copy(e.ray).applyMatrix4(TQ),!(i.boundingBox!==null&&vg.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,vg)))}_computeIntersections(e,t,i){let n;const r=this.geometry,o=this.material,a=r.index,l=r.attributes.position,c=r.attributes.uv,h=r.attributes.uv1,d=r.attributes.normal,u=r.groups,f=r.drawRange;if(a!==null)if(Array.isArray(o))for(let m=0,g=u.length;m<g;m++){const A=u[m],y=o[A.materialIndex],b=Math.max(A.start,f.start),x=Math.min(a.count,Math.min(A.start+A.count,f.start+f.count));for(let v=b,_=x;v<_;v+=3){const C=a.getX(v),S=a.getX(v+1),M=a.getX(v+2);n=LT(this,y,e,i,c,h,d,C,S,M),n&&(n.faceIndex=Math.floor(v/3),n.face.materialIndex=A.materialIndex,t.push(n))}}else{const m=Math.max(0,f.start),g=Math.min(a.count,f.start+f.count);for(let A=m,y=g;A<y;A+=3){const b=a.getX(A),x=a.getX(A+1),v=a.getX(A+2);n=LT(this,o,e,i,c,h,d,b,x,v),n&&(n.faceIndex=Math.floor(A/3),t.push(n))}}else if(l!==void 0)if(Array.isArray(o))for(let m=0,g=u.length;m<g;m++){const A=u[m],y=o[A.materialIndex],b=Math.max(A.start,f.start),x=Math.min(l.count,Math.min(A.start+A.count,f.start+f.count));for(let v=b,_=x;v<_;v+=3){const C=v,S=v+1,M=v+2;n=LT(this,y,e,i,c,h,d,C,S,M),n&&(n.faceIndex=Math.floor(v/3),n.face.materialIndex=A.materialIndex,t.push(n))}}else{const m=Math.max(0,f.start),g=Math.min(l.count,f.start+f.count);for(let A=m,y=g;A<y;A+=3){const b=A,x=A+1,v=A+2;n=LT(this,o,e,i,c,h,d,b,x,v),n&&(n.faceIndex=Math.floor(A/3),t.push(n))}}}}function AEe(s,e,t,i,n,r,o,a){let l;if(e.side===mTe?l=i.intersectTriangle(o,r,n,!0,a):l=i.intersectTriangle(n,r,o,e.side===jL,a),l===null)return null;RT.copy(a),RT.applyMatrix4(s.matrixWorld);const c=t.ray.origin.distanceTo(RT);return c<t.near||c>t.far?null:{distance:c,point:RT.clone(),object:s}}function LT(s,e,t,i,n,r,o,a,l,c){s.getVertexPosition(a,MT),s.getVertexPosition(l,IT),s.getVertexPosition(c,TT);const h=AEe(s,e,t,i,MT,IT,TT,RQ);if(h){const d=new _e;_h.getBarycoord(RQ,MT,IT,TT,d),n&&(h.uv=_h.getInterpolatedAttribute(n,a,l,c,d,new Hr)),r&&(h.uv1=_h.getInterpolatedAttribute(r,a,l,c,d,new Hr)),o&&(h.normal=_h.getInterpolatedAttribute(o,a,l,c,d,new _e),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const u={a,b:l,c,normal:new _e,materialIndex:0};_h.getNormal(MT,IT,TT,u.normal),h.face=u,h.barycoord=d}return h}let mne=class extends Os{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Qi,this.projectionMatrix=new Qi,this.projectionMatrixInverse=new Qi,this.coordinateSystem=p0}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const of=new _e,LQ=new Hr,BQ=new Hr;class BO extends mne{constructor(e=50,t=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=hS*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan($C*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return hS*2*Math.atan(Math.tan($C*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){of.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(of.x,of.y).multiplyScalar(-e/of.z),of.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(of.x,of.y).multiplyScalar(-e/of.z)}getViewSize(e,t){return this.getViewBounds(e,LQ,BQ),t.subVectors(BQ,LQ)}setViewOffset(e,t,i,n,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan($C*.5*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*n/l,t-=o.offsetY*i/c,n*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class yEe{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=PV,this.updateRanges=[],this.version=0,this.uuid=Rh()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Rh()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Rh()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const da=new _e;class PO{constructor(e,t,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)da.fromBufferAttribute(this,t),da.applyMatrix4(e),this.setXYZ(t,da.x,da.y,da.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)da.fromBufferAttribute(this,t),da.applyNormalMatrix(e),this.setXYZ(t,da.x,da.y,da.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)da.fromBufferAttribute(this,t),da.transformDirection(e),this.setXYZ(t,da.x,da.y,da.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=vh(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=fn(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=fn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=fn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=fn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=fn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=vh(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=vh(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=vh(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=vh(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=fn(t,this.array),i=fn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=fn(t,this.array),i=fn(i,this.array),n=fn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=fn(t,this.array),i=fn(i,this.array),n=fn(n,this.array),r=fn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return new Kl(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new PO(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const PQ=new _e,GQ=new Gl,kQ=new Gl,bEe=new _e,NQ=new Qi,BT=new _e,aN=new Oh,DQ=new Qi,lN=new rP;class xEe extends Qf{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=cQ,this.bindMatrix=new Qi,this.bindMatrixInverse=new Qi,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Dh),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,BT),this.boundingBox.expandByPoint(BT)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Oh),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,BT),this.boundingSphere.expandByPoint(BT)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,n=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),aN.copy(this.boundingSphere),aN.applyMatrix4(n),e.ray.intersectsSphere(aN)!==!1&&(DQ.copy(n).invert(),lN.copy(e.ray).applyMatrix4(DQ),!(this.boundingBox!==null&&lN.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,lN)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Gl,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.fromBufferAttribute(t,i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===cQ?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===yTe?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,n=this.geometry;GQ.fromBufferAttribute(n.attributes.skinIndex,e),kQ.fromBufferAttribute(n.attributes.skinWeight,e),PQ.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=kQ.getComponent(r);if(o!==0){const a=GQ.getComponent(r);NQ.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(bEe.copy(PQ).applyMatrix4(NQ),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class gne extends Os{constructor(){super(),this.isBone=!0,this.type="Bone"}}class GO extends zr{constructor(e=null,t=1,i=1,n,r,o,a,l,c=Sx,h=Sx,d,u){super(null,o,a,l,c,h,n,r,d,u),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const FQ=new Qi,vEe=new Qi;class kO{constructor(e=[],t=[]){this.uuid=Rh(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,n=this.bones.length;i<n;i++)this.boneInverses.push(new Qi)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new Qi;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const a=e[r]?e[r].matrixWorld:vEe;FQ.multiplyMatrices(a,t[r]),FQ.toArray(i,r*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new kO(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new GO(t,e,e,Gf,Wf);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){const r=e.bones[i];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new gne),this.bones.push(o),this.boneInverses.push(new Qi().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++){const o=t[n];e.bones.push(o.uuid);const a=i[n];e.boneInverses.push(a.toArray())}return e}}class DV extends Kl{constructor(e,t,i,n=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Ty=new Qi,VQ=new Qi,PT=[],zQ=new Dh,_Ee=new Qi,d_=new Qf,u_=new Oh;class CEe extends Qf{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new DV(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let n=0;n<i;n++)this.setMatrixAt(n,_Ee)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Dh),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Ty),zQ.copy(e.boundingBox).applyMatrix4(Ty),this.boundingBox.union(zQ)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Oh),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Ty),u_.copy(e.boundingSphere).applyMatrix4(Ty),this.boundingSphere.union(u_)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,n=this.morphTexture.source.data.data,r=i.length+1,o=e*r+1;for(let a=0;a<i.length;a++)i[a]=n[o+a]}raycast(e,t){const i=this.matrixWorld,n=this.count;if(d_.geometry=this.geometry,d_.material=this.material,d_.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),u_.copy(this.boundingSphere),u_.applyMatrix4(i),e.ray.intersectsSphere(u_)!==!1))for(let r=0;r<n;r++){this.getMatrixAt(r,Ty),VQ.multiplyMatrices(i,Ty),d_.matrixWorld=VQ,d_.raycast(e,PT);for(let o=0,a=PT.length;o<a;o++){const l=PT[o];l.instanceId=r,l.object=this,t.push(l)}PT.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new DV(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,n=i.length+1;this.morphTexture===null&&(this.morphTexture=new GO(new Float32Array(n*this.count),n,this.count,Tb,Wf));const r=this.morphTexture.source.data.data;let o=0;for(let c=0;c<i.length;c++)o+=i[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=n*e;r[l]=a,r.set(i,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}const cN=new _e,wEe=new _e,SEe=new bA;class Ey{constructor(e=new _e(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=cN.subVectors(i,t).cross(wEe.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(cN),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||SEe.getNormalMatrix(e),n=this.coplanarPoint(cN).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _g=new Oh,GT=new _e;class MEe{constructor(e=new Ey,t=new Ey,i=new Ey,n=new Ey,r=new Ey,o=new Ey){this.planes=[e,t,i,n,r,o]}set(e,t,i,n,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=p0){const i=this.planes,n=e.elements,r=n[0],o=n[1],a=n[2],l=n[3],c=n[4],h=n[5],d=n[6],u=n[7],f=n[8],m=n[9],g=n[10],A=n[11],y=n[12],b=n[13],x=n[14],v=n[15];if(i[0].setComponents(l-r,u-c,A-f,v-y).normalize(),i[1].setComponents(l+r,u+c,A+f,v+y).normalize(),i[2].setComponents(l+o,u+h,A+m,v+b).normalize(),i[3].setComponents(l-o,u-h,A-m,v-b).normalize(),i[4].setComponents(l-a,u-d,A-g,v-x).normalize(),t===p0)i[5].setComponents(l+a,u+d,A+g,v+x).normalize();else if(t===GV)i[5].setComponents(a,d,g,x).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),_g.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),_g.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(_g)}intersectsSprite(e){return _g.center.set(0,0,0),_g.radius=.7071067811865476,_g.applyMatrix4(e.matrixWorld),this.intersectsSphere(_g)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(GT.x=n.normal.x>0?e.max.x:e.min.x,GT.y=n.normal.y>0?e.max.y:e.min.y,GT.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(GT)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class Ane extends Hf{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new nr(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const $L=new _e,e2=new _e,UQ=new Qi,p_=new rP,kT=new Oh,hN=new _e,XQ=new _e;class NO extends Os{constructor(e=new Fh,t=new Ane){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let n=1,r=t.count;n<r;n++)$L.fromBufferAttribute(t,n-1),e2.fromBufferAttribute(t,n),i[n]=i[n-1],i[n]+=$L.distanceTo(e2);e.setAttribute("lineDistance",new LO(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),kT.copy(i.boundingSphere),kT.applyMatrix4(n),kT.radius+=r,e.ray.intersectsSphere(kT)===!1)return;UQ.copy(n).invert(),p_.copy(e.ray).applyMatrix4(UQ);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=this.isLineSegments?2:1,h=i.index,u=i.attributes.position;if(h!==null){const f=Math.max(0,o.start),m=Math.min(h.count,o.start+o.count);for(let g=f,A=m-1;g<A;g+=c){const y=h.getX(g),b=h.getX(g+1),x=NT(this,e,p_,l,y,b);x&&t.push(x)}if(this.isLineLoop){const g=h.getX(m-1),A=h.getX(f),y=NT(this,e,p_,l,g,A);y&&t.push(y)}}else{const f=Math.max(0,o.start),m=Math.min(u.count,o.start+o.count);for(let g=f,A=m-1;g<A;g+=c){const y=NT(this,e,p_,l,g,g+1);y&&t.push(y)}if(this.isLineLoop){const g=NT(this,e,p_,l,m-1,f);g&&t.push(g)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function NT(s,e,t,i,n,r){const o=s.geometry.attributes.position;if($L.fromBufferAttribute(o,n),e2.fromBufferAttribute(o,r),t.distanceSqToSegment($L,e2,hN,XQ)>i)return;hN.applyMatrix4(s.matrixWorld);const l=e.ray.origin.distanceTo(hN);if(!(l<e.near||l>e.far))return{distance:l,point:XQ.clone().applyMatrix4(s.matrixWorld),index:n,face:null,faceIndex:null,barycoord:null,object:s}}const OQ=new _e,ZQ=new _e;class IEe extends NO{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let n=0,r=t.count;n<r;n+=2)OQ.fromBufferAttribute(t,n),ZQ.fromBufferAttribute(t,n+1),i[n]=n===0?0:i[n-1],i[n+1]=i[n]+OQ.distanceTo(ZQ);e.setAttribute("lineDistance",new LO(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class TEe extends NO{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class yne extends Hf{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new nr(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const WQ=new Qi,FV=new rP,DT=new Oh,FT=new _e;class EEe extends Os{constructor(e=new Fh,t=new yne){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),DT.copy(i.boundingSphere),DT.applyMatrix4(n),DT.radius+=r,e.ray.intersectsSphere(DT)===!1)return;WQ.copy(n).invert(),FV.copy(e.ray).applyMatrix4(WQ);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,d=i.attributes.position;if(c!==null){const u=Math.max(0,o.start),f=Math.min(c.count,o.start+o.count);for(let m=u,g=f;m<g;m++){const A=c.getX(m);FT.fromBufferAttribute(d,A),HQ(FT,A,l,n,e,t,this)}}else{const u=Math.max(0,o.start),f=Math.min(d.count,o.start+o.count);for(let m=u,g=f;m<g;m++)FT.fromBufferAttribute(d,m),HQ(FT,m,l,n,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function HQ(s,e,t,i,n,r,o){const a=FV.distanceSqToPoint(s);if(a<t){const l=new _e;FV.closestPointToPoint(s,l),l.applyMatrix4(i);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class dN extends Os{constructor(){super(),this.isGroup=!0,this.type="Group"}}class aP extends zr{constructor(e,t,i,n,r,o,a,l,c,h,d,u){super(null,o,a,l,c,h,n,r,d,u),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class REe extends aP{constructor(e,t,i,n,r,o){super(e,t,i,r,o),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=u0,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class LEe extends aP{constructor(e,t,i){super(void 0,e[0].width,e[0].height,t,i,bTe),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class lP extends Hf{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new nr(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=GTe,this.normalScale=new Hr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new oP,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nu extends lP{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Hr(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ii(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new nr(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new nr(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new nr(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function VT(s,e,t){return!s||!t&&s.constructor===e?s:typeof e.BYTES_PER_ELEMENT=="number"?new e(s):Array.prototype.slice.call(s)}function BEe(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function PEe(s){function e(n,r){return s[n]-s[r]}const t=s.length,i=new Array(t);for(let n=0;n!==t;++n)i[n]=n;return i.sort(e),i}function QQ(s,e,t){const i=s.length,n=new s.constructor(i);for(let r=0,o=0;o!==i;++r){const a=t[r]*e;for(let l=0;l!==e;++l)n[o++]=s[a+l]}return n}function bne(s,e,t,i){let n=1,r=s[0];for(;r!==void 0&&r[i]===void 0;)r=s[n++];if(r===void 0)return;let o=r[i];if(o!==void 0)if(Array.isArray(o))do o=r[i],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=s[n++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[i],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=s[n++];while(r!==void 0);else do o=r[i],o!==void 0&&(e.push(r.time),t.push(o)),r=s[n++];while(r!==void 0)}class nM{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let o;i:{n:if(!(e<n)){for(let a=i+2;;){if(n===void 0){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=n,n=t[++i],e<n)break t}o=t.length;break i}if(!(e>=r)){const a=t[1];e<a&&(i=2,r=a);for(let l=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(n=r,r=t[--i-1],e>=r)break t}o=i,i=0;break i}break e}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(n=t[i],r=t[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let o=0;o!==n;++o)t[o]=i[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class GEe extends nM{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:dQ,endingEnd:dQ}}intervalChanged_(e,t,i){const n=this.parameterPositions;let r=e-2,o=e+1,a=n[r],l=n[o];if(a===void 0)switch(this.getSettings_().endingStart){case uQ:r=e,a=2*t-i;break;case pQ:r=n.length-2,a=t+n[r]-n[r+1];break;default:r=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case uQ:o=e,l=2*i-t;break;case pQ:o=1,l=i+n[1]-n[0];break;default:o=e-1,l=t}const c=(i-t)*.5,h=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=r*h,this._offsetNext=o*h}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=this._offsetPrev,d=this._offsetNext,u=this._weightPrev,f=this._weightNext,m=(i-t)/(n-t),g=m*m,A=g*m,y=-u*A+2*u*g-u*m,b=(1+u)*A+(-1.5-2*u)*g+(-.5+u)*m+1,x=(-1-f)*A+(1.5+f)*g+.5*m,v=f*A-f*g;for(let _=0;_!==a;++_)r[_]=y*o[h+_]+b*o[c+_]+x*o[l+_]+v*o[d+_];return r}}class kEe extends nM{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=(i-t)/(n-t),d=1-h;for(let u=0;u!==a;++u)r[u]=o[c+u]*d+o[l+u]*h;return r}}class NEe extends nM{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class su{constructor(e,t,i,n){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=VT(t,this.TimeBufferType),this.values=VT(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:VT(e.times,Array),values:VT(e.values,Array)};const n=e.getInterpolation();n!==e.DefaultInterpolation&&(i.interpolation=n)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new NEe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new kEe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new GEe(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case lS:t=this.InterpolantFactoryMethodDiscrete;break;case cS:t=this.InterpolantFactoryMethodLinear;break;case zk:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return lS;case this.InterpolantFactoryMethodLinear:return cS;case this.InterpolantFactoryMethodSmooth:return zk}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){const i=this.times,n=i.length;let r=0,o=n-1;for(;r!==n&&i[r]<e;)++r;for(;o!==-1&&i[o]>t;)--o;if(++o,r!==0||o!==n){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=i.slice(r,o),this.values=this.values.slice(r*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,n=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(n!==void 0&&BEe(n))for(let a=0,l=n.length;a!==l;++a){const c=n[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),n=this.getInterpolation()===zk,r=e.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=e[a],h=e[a+1];if(c!==h&&(a!==1||c!==e[0]))if(n)l=!0;else{const d=a*i,u=d-i,f=d+i;for(let m=0;m!==i;++m){const g=t[d+m];if(g!==t[u+m]||g!==t[f+m]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const d=a*i,u=o*i;for(let f=0;f!==i;++f)t[u+f]=t[d+f]}++o}}if(r>0){e[o]=e[r];for(let a=r*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,n=new i(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}su.prototype.TimeBufferType=Float32Array;su.prototype.ValueBufferType=Float32Array;su.prototype.DefaultInterpolation=cS;class ev extends su{constructor(e,t,i){super(e,t,i)}}ev.prototype.ValueTypeName="bool";ev.prototype.ValueBufferType=Array;ev.prototype.DefaultInterpolation=lS;ev.prototype.InterpolantFactoryMethodLinear=void 0;ev.prototype.InterpolantFactoryMethodSmooth=void 0;class xne extends su{}xne.prototype.ValueTypeName="color";class Mx extends su{}Mx.prototype.ValueTypeName="number";class DEe extends nM{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(n-t);let c=e*a;for(let h=c+a;c!==h;c+=4)Dm.slerpFlat(r,0,o,c-a,o,c,l);return r}}class Ix extends su{InterpolantFactoryMethodLinear(e){return new DEe(this.times,this.values,this.getValueSize(),e)}}Ix.prototype.ValueTypeName="quaternion";Ix.prototype.InterpolantFactoryMethodSmooth=void 0;class tv extends su{constructor(e,t,i){super(e,t,i)}}tv.prototype.ValueTypeName="string";tv.prototype.ValueBufferType=Array;tv.prototype.DefaultInterpolation=lS;tv.prototype.InterpolantFactoryMethodLinear=void 0;tv.prototype.InterpolantFactoryMethodSmooth=void 0;class Tx extends su{}Tx.prototype.ValueTypeName="vector";class FEe{constructor(e="",t=-1,i=[],n=BTe){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=Rh(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(zEe(i[o]).scale(n));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=i.length;r!==o;++r)t.push(su.toJSON(i[r]));return n}static CreateFromMorphTargetSequence(e,t,i,n){const r=t.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const h=PEe(l);l=QQ(l,1,h),c=QQ(c,1,h),!n&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new Mx(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const n=e;i=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],h=c.name.match(r);if(h&&h.length>1){const d=h[1];let u=n[d];u||(n[d]=u=[]),u.push(c)}}const o=[];for(const a in n)o.push(this.CreateFromMorphTargetSequence(a,n[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(d,u,f,m,g){if(f.length!==0){const A=[],y=[];bne(f,A,y,m),A.length!==0&&g.push(new d(u,A,y))}},n=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const u=c[d].keys;if(!(!u||u.length===0))if(u[0].morphTargets){const f={};let m;for(m=0;m<u.length;m++)if(u[m].morphTargets)for(let g=0;g<u[m].morphTargets.length;g++)f[u[m].morphTargets[g]]=-1;for(const g in f){const A=[],y=[];for(let b=0;b!==u[m].morphTargets.length;++b){const x=u[m];A.push(x.time),y.push(x.morphTarget===g?1:0)}n.push(new Mx(".morphTargetInfluence["+g+"]",A,y))}l=f.length*o}else{const f=".bones["+t[d].name+"]";i(Tx,f+".position",u,"pos",n),i(Ix,f+".quaternion",u,"rot",n),i(Tx,f+".scale",u,"scl",n)}}return n.length===0?null:new this(r,l,n,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,n=e.length;i!==n;++i){const r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function VEe(s){switch(s.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Mx;case"vector":case"vector2":case"vector3":case"vector4":return Tx;case"color":return xne;case"quaternion":return Ix;case"bool":case"boolean":return ev;case"string":return tv}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+s)}function zEe(s){if(s.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=VEe(s.type);if(s.times===void 0){const t=[],i=[];bne(s.keys,t,i,"value"),s.times=t,s.values=i}return e.parse!==void 0?e.parse(s):new e(s.name,s.times,s.values,s.interpolation)}const kf={enabled:!1,files:{},add:function(s,e){this.enabled!==!1&&(this.files[s]=e)},get:function(s){if(this.enabled!==!1)return this.files[s]},remove:function(s){delete this.files[s]},clear:function(){this.files={}}};class UEe{constructor(e,t,i){const n=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(h){a++,r===!1&&n.onStart!==void 0&&n.onStart(h,o,a),r=!0},this.itemEnd=function(h){o++,n.onProgress!==void 0&&n.onProgress(h,o,a),o===a&&(r=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(h){n.onError!==void 0&&n.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,d){return c.push(h,d),this},this.removeHandler=function(h){const d=c.indexOf(h);return d!==-1&&c.splice(d,2),this},this.getHandler=function(h){for(let d=0,u=c.length;d<u;d+=2){const f=c[d],m=c[d+1];if(f.global&&(f.lastIndex=0),f.test(h))return m}return null}}}const XEe=new UEe;class Fm{constructor(e){this.manager=e!==void 0?e:XEe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(n,r){i.load(e,n,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Fm.DEFAULT_MATERIAL_NAME="__DEFAULT";const Eu={};class OEe extends Error{constructor(e,t){super(e),this.response=t}}class T0 extends Fm{constructor(e){super(e)}load(e,t,i,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=kf.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(Eu[e]!==void 0){Eu[e].push({onLoad:t,onProgress:i,onError:n});return}Eu[e]=[],Eu[e].push({onLoad:t,onProgress:i,onError:n});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=Eu[e],d=c.body.getReader(),u=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),f=u?parseInt(u):0,m=f!==0;let g=0;const A=new ReadableStream({start(y){b();function b(){d.read().then(({done:x,value:v})=>{if(x)y.close();else{g+=v.byteLength;const _=new ProgressEvent("progress",{lengthComputable:m,loaded:g,total:f});for(let C=0,S=h.length;C<S;C++){const M=h[C];M.onProgress&&M.onProgress(_)}y.enqueue(v),b()}},x=>{y.error(x)})}}});return new Response(A)}else throw new OEe(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return c.json();default:if(a===void 0)return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),u=d&&d[1]?d[1].toLowerCase():void 0,f=new TextDecoder(u);return c.arrayBuffer().then(m=>f.decode(m))}}}).then(c=>{kf.add(e,c);const h=Eu[e];delete Eu[e];for(let d=0,u=h.length;d<u;d++){const f=h[d];f.onLoad&&f.onLoad(c)}}).catch(c=>{const h=Eu[e];if(h===void 0)throw this.manager.itemError(e),c;delete Eu[e];for(let d=0,u=h.length;d<u;d++){const f=h[d];f.onError&&f.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class ZEe extends Fm{constructor(e){super(e)}load(e,t,i,n){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=kf.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a=kV("img");function l(){h(),kf.add(e,this),t&&t(this),r.manager.itemEnd(e)}function c(d){h(),n&&n(d),r.manager.itemError(e),r.manager.itemEnd(e)}function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class vne extends Fm{constructor(e){super(e)}load(e,t,i,n){const r=new zr,o=new ZEe(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){r.image=a,r.needsUpdate=!0,t!==void 0&&t(r)},i,n),r}}let DO=class extends Os{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new nr(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}};const uN=new Qi,KQ=new _e,YQ=new _e;class FO{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Hr(512,512),this.map=null,this.mapPass=null,this.matrix=new Qi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new MEe,this._frameExtents=new Hr(1,1),this._viewportCount=1,this._viewports=[new Gl(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;KQ.setFromMatrixPosition(e.matrixWorld),t.position.copy(KQ),YQ.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(YQ),t.updateMatrixWorld(),uN.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(uN),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(uN)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class WEe extends FO{constructor(){super(new BO(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=hS*2*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||n!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class HEe extends DO{constructor(e,t,i=0,n=Math.PI/3,r=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Os.DEFAULT_UP),this.updateMatrix(),this.target=new Os,this.distance=i,this.angle=n,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new WEe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const JQ=new Qi,f_=new _e,pN=new _e;class QEe extends FO{constructor(){super(new BO(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Hr(4,2),this._viewportCount=6,this._viewports=[new Gl(2,1,1,1),new Gl(0,1,1,1),new Gl(3,1,1,1),new Gl(1,1,1,1),new Gl(3,0,1,1),new Gl(1,0,1,1)],this._cubeDirections=[new _e(1,0,0),new _e(-1,0,0),new _e(0,0,1),new _e(0,0,-1),new _e(0,1,0),new _e(0,-1,0)],this._cubeUps=[new _e(0,1,0),new _e(0,1,0),new _e(0,1,0),new _e(0,1,0),new _e(0,0,1),new _e(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),f_.setFromMatrixPosition(e.matrixWorld),i.position.copy(f_),pN.copy(i.position),pN.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(pN),i.updateMatrixWorld(),n.makeTranslation(-f_.x,-f_.y,-f_.z),JQ.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(JQ)}}class KEe extends DO{constructor(e,t,i=0,n=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new QEe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class _ne extends mne{constructor(e=-1,t=1,i=1,n=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-e,o=i+e,a=n+t,l=n-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class YEe extends FO{constructor(){super(new _ne(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class JEe extends DO{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Os.DEFAULT_UP),this.updateMatrix(),this.target=new Os,this.shadow=new YEe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class tw{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class jEe extends Fm{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=kf.get(e);if(o!==void 0){if(r.manager.itemStart(e),o.then){o.then(c=>{t&&t(c),r.manager.itemEnd(e)}).catch(c=>{n&&n(c)});return}return setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(c){return kf.add(e,c),t&&t(c),r.manager.itemEnd(e),c}).catch(function(c){n&&n(c),kf.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)});kf.add(e,l),r.manager.itemStart(e)}}class qEe{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=jQ(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=jQ();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function jQ(){return performance.now()}const VO="\\[\\]\\.:\\/",$Ee=new RegExp("["+VO+"]","g"),zO="[^"+VO+"]",eRe="[^"+VO.replace("\\.","")+"]",tRe=/((?:WC+[\/:])*)/.source.replace("WC",zO),iRe=/(WCOD+)?/.source.replace("WCOD",eRe),nRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",zO),sRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",zO),rRe=new RegExp("^"+tRe+iRe+nRe+sRe+"$"),oRe=["material","materials","bones","map"];class aRe{constructor(e,t,i){const n=i||mn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];n!==void 0&&n.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class mn{constructor(e,t,i){this.path=t,this.parsedPath=i||mn.parseTrackName(t),this.node=mn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new mn.Composite(e,t,i):new mn(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace($Ee,"")}static parseTrackName(e){const t=rRe.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const r=i.nodeName.substring(n+1);oRe.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(r){for(let o=0;o<r.length;o++){const a=r[o];if(a.name===t||a.uuid===t)return a;const l=i(a.children);if(l)return l}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let r=t.propertyIndex;if(e||(e=mn.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[n];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?a=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(n==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}mn.Composite=aRe;mn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};mn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};mn.prototype.GetterByBindingType=[mn.prototype._getValue_direct,mn.prototype._getValue_array,mn.prototype._getValue_arrayElement,mn.prototype._getValue_toArray];mn.prototype.SetterByBindingTypeAndVersioning=[[mn.prototype._setValue_direct,mn.prototype._setValue_direct_setNeedsUpdate,mn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[mn.prototype._setValue_array,mn.prototype._setValue_array_setNeedsUpdate,mn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[mn.prototype._setValue_arrayElement,mn.prototype._setValue_arrayElement_setNeedsUpdate,mn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[mn.prototype._setValue_fromArray,mn.prototype._setValue_fromArray_setNeedsUpdate,mn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:rne}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=rne);function qQ(s,e){if(e===PTe)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),s;if(e===BV||e===lne){let t=s.getIndex();if(t===null){const o=[],a=s.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);s.setIndex(o),t=s.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),s}const i=t.count-2,n=[];if(e===BV)for(let o=1;o<=i;o++)n.push(t.getX(0)),n.push(t.getX(o)),n.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(n.push(t.getX(o)),n.push(t.getX(o+1)),n.push(t.getX(o+2))):(n.push(t.getX(o+2)),n.push(t.getX(o+1)),n.push(t.getX(o)));n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=s.clone();return r.setIndex(n),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),s}let UO=class extends Fm{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new uRe(t)}),this.register(function(t){return new pRe(t)}),this.register(function(t){return new _Re(t)}),this.register(function(t){return new CRe(t)}),this.register(function(t){return new wRe(t)}),this.register(function(t){return new mRe(t)}),this.register(function(t){return new gRe(t)}),this.register(function(t){return new ARe(t)}),this.register(function(t){return new yRe(t)}),this.register(function(t){return new dRe(t)}),this.register(function(t){return new bRe(t)}),this.register(function(t){return new fRe(t)}),this.register(function(t){return new vRe(t)}),this.register(function(t){return new xRe(t)}),this.register(function(t){return new cRe(t)}),this.register(function(t){return new SRe(t)}),this.register(function(t){return new MRe(t)})}load(e,t,i,n){const r=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=tw.extractUrlBase(e);o=tw.resolveURL(c,this.path)}else o=tw.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){n?n(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},l=new T0(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,o,function(h){t(h),r.manager.itemEnd(e)},a)}catch(h){a(h)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let r;const o={},a={},l=new TextDecoder;if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===Cne){try{o[Ti.KHR_BINARY_GLTF]=new IRe(e)}catch(d){n&&n(d);return}r=JSON.parse(o[Ti.KHR_BINARY_GLTF].content)}else r=JSON.parse(l.decode(e));else r=e;if(r.asset===void 0||r.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new zRe(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const d=this.pluginCallbacks[h](c);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[d.name]=d,o[d.name]=!0}if(r.extensionsUsed)for(let h=0;h<r.extensionsUsed.length;++h){const d=r.extensionsUsed[h],u=r.extensionsRequired||[];switch(d){case Ti.KHR_MATERIALS_UNLIT:o[d]=new hRe;break;case Ti.KHR_DRACO_MESH_COMPRESSION:o[d]=new TRe(r,this.dracoLoader);break;case Ti.KHR_TEXTURE_TRANSFORM:o[d]=new ERe;break;case Ti.KHR_MESH_QUANTIZATION:o[d]=new RRe;break;default:u.indexOf(d)>=0&&a[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,n)}parseAsync(e,t){const i=this;return new Promise(function(n,r){i.parse(e,t,n,r)})}};function lRe(){let s={};return{get:function(e){return s[e]},add:function(e,t){s[e]=t},remove:function(e){delete s[e]},removeAll:function(){s={}}}}const Ti={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};let cRe=class{constructor(e){this.parser=e,this.name=Ti.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const r=t[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let n=t.cache.get(i);if(n)return n;const r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let c;const h=new nr(16777215);l.color!==void 0&&h.setRGB(l.color[0],l.color[1],l.color[2],tc);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new JEe(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new KEe(h),c.distance=d;break;case"spot":c=new HEe(h),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,Zu(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),n=Promise.resolve(c),t.cache.add(i,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,r=i.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}},hRe=class{constructor(){this.name=Ti.KHR_MATERIALS_UNLIT}getMaterialType(){return Eb}extendParams(e,t,i){const n=[];e.color=new nr(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],tc),e.opacity=o[3]}r.baseColorTexture!==void 0&&n.push(i.assignTexture(e,"map",r.baseColorTexture,Js))}return Promise.all(n)}},dRe=class{constructor(e){this.parser=e,this.name=Ti.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}},uRe=class{constructor(e){this.parser=e,this.name=Ti.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:nu}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Hr(a,a)}return Promise.all(r)}},pRe=class{constructor(e){this.parser=e,this.name=Ti.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:nu}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}},fRe=class{constructor(e){this.parser=e,this.name=Ti.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:nu}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}},mRe=class{constructor(e){this.parser=e,this.name=Ti.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:nu}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new nr(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=n.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],tc)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,Js)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}},gRe=class{constructor(e){this.parser=e,this.name=Ti.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:nu}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}},ARe=class{constructor(e){this.parser=e,this.name=Ti.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:nu}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new nr().setRGB(a[0],a[1],a[2],tc),Promise.all(r)}},yRe=class{constructor(e){this.parser=e,this.name=Ti.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:nu}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}},bRe=class{constructor(e){this.parser=e,this.name=Ti.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:nu}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new nr().setRGB(a[0],a[1],a[2],tc),o.specularColorTexture!==void 0&&r.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,Js)),Promise.all(r)}},xRe=class{constructor(e){this.parser=e,this.name=Ti.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:nu}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(i.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(r)}},vRe=class{constructor(e){this.parser=e,this.name=Ti.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:nu}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}},_Re=class{constructor(e){this.parser=e,this.name=Ti.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const r=n.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}},CRe=class{constructor(e){this.parser=e,this.name=Ti.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=n.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},wRe=class{constructor(e){this.parser=e,this.name=Ti.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=n.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},SRe=class{constructor(e){this.name=Ti.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const n=i.extensions[this.name],r=this.parser.getDependency("buffer",n.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const l=n.byteOffset||0,c=n.byteLength||0,h=n.count,d=n.byteStride,u=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,d,u,n.mode,n.filter).then(function(f){return f.buffer}):o.ready.then(function(){const f=new ArrayBuffer(h*d);return o.decodeGltfBuffer(new Uint8Array(f),h,d,u,n.mode,n.filter),f})})}else return null}},MRe=class{constructor(e){this.name=Ti.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const n=t.meshes[i.mesh];for(const c of n.primitives)if(c.mode!==Cc.TRIANGLES&&c.mode!==Cc.TRIANGLE_STRIP&&c.mode!==Cc.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(h=>(l[c]=h,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const h=c.pop(),d=h.isGroup?h.children:[h],u=c[0].count,f=[];for(const m of d){const g=new Qi,A=new _e,y=new Dm,b=new _e(1,1,1),x=new CEe(m.geometry,m.material,u);for(let v=0;v<u;v++)l.TRANSLATION&&A.fromBufferAttribute(l.TRANSLATION,v),l.ROTATION&&y.fromBufferAttribute(l.ROTATION,v),l.SCALE&&b.fromBufferAttribute(l.SCALE,v),x.setMatrixAt(v,g.compose(A,y,b));for(const v in l)if(v==="_COLOR_0"){const _=l[v];x.instanceColor=new DV(_.array,_.itemSize,_.normalized)}else v!=="TRANSLATION"&&v!=="ROTATION"&&v!=="SCALE"&&m.geometry.setAttribute(v,l[v]);Os.prototype.copy.call(x,m),this.parser.assignFinalMaterial(x),f.push(x)}return h.isGroup?(h.clear(),h.add(...f),h):f[0]}))}};const Cne="glTF",m_=12,$Q={JSON:1313821514,BIN:5130562};let IRe=class{constructor(e){this.name=Ti.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,m_),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Cne)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-m_,r=new DataView(e,m_);let o=0;for(;o<n;){const a=r.getUint32(o,!0);o+=4;const l=r.getUint32(o,!0);if(o+=4,l===$Q.JSON){const c=new Uint8Array(e,m_+o,a);this.content=i.decode(c)}else if(l===$Q.BIN){const c=m_+o;this.body=e.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},TRe=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ti.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const h in o){const d=VV[h]||h.toLowerCase();a[d]=o[h]}for(const h in e.attributes){const d=VV[h]||h.toLowerCase();if(o[h]!==void 0){const u=i.accessors[e.attributes[h]],f=Yb[u.componentType];c[d]=f.name,l[d]=u.normalized===!0}}return t.getDependency("bufferView",r).then(function(h){return new Promise(function(d,u){n.decodeDracoFile(h,function(f){for(const m in f.attributes){const g=f.attributes[m],A=l[m];A!==void 0&&(g.normalized=A)}d(f)},a,c,tc,u)})})}},ERe=class{constructor(){this.name=Ti.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},RRe=class{constructor(){this.name=Ti.KHR_MESH_QUANTIZATION}},wne=class extends nM{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n*3+n;for(let o=0;o!==n;o++)t[o]=i[r+o];return t}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,h=n-t,d=(i-t)/h,u=d*d,f=u*d,m=e*c,g=m-c,A=-2*f+3*u,y=f-u,b=1-A,x=y-u+d;for(let v=0;v!==a;v++){const _=o[g+v+a],C=o[g+v+l]*h,S=o[m+v+a],M=o[m+v]*h;r[v]=b*_+x*C+A*S+y*M}return r}};const LRe=new Dm;let BRe=class extends wne{interpolate_(e,t,i,n){const r=super.interpolate_(e,t,i,n);return LRe.fromArray(r).normalize().toArray(r),r}};const Cc={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Yb={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},e4={9728:Sx,9729:gm,9984:xTe,9985:_Te,9986:vTe,9987:iM},t4={33071:u0,33648:LV,10497:aS},fN={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},VV={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},af={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},PRe={CUBICSPLINE:void 0,LINEAR:cS,STEP:lS},mN={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function GRe(s){return s.DefaultMaterial===void 0&&(s.DefaultMaterial=new lP({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:jL})),s.DefaultMaterial}function Cg(s,e,t){for(const i in t.extensions)s[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Zu(s,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(s.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function kRe(s,e,t){let i=!1,n=!1,r=!1;for(let c=0,h=e.length;c<h;c++){const d=e[c];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(n=!0),d.COLOR_0!==void 0&&(r=!0),i&&n&&r)break}if(!i&&!n&&!r)return Promise.resolve(s);const o=[],a=[],l=[];for(let c=0,h=e.length;c<h;c++){const d=e[c];if(i){const u=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):s.attributes.position;o.push(u)}if(n){const u=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):s.attributes.normal;a.push(u)}if(r){const u=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):s.attributes.color;l.push(u)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const h=c[0],d=c[1],u=c[2];return i&&(s.morphAttributes.position=h),n&&(s.morphAttributes.normal=d),r&&(s.morphAttributes.color=u),s.morphTargetsRelative=!0,s})}function NRe(s,e){if(s.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)s.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(s.morphTargetInfluences.length===t.length){s.morphTargetDictionary={};for(let i=0,n=t.length;i<n;i++)s.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function DRe(s){let e;const t=s.extensions&&s.extensions[Ti.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+gN(t.attributes):e=s.indices+":"+gN(s.attributes)+":"+s.mode,s.targets!==void 0)for(let i=0,n=s.targets.length;i<n;i++)e+=":"+gN(s.targets[i]);return e}function gN(s){let e="";const t=Object.keys(s).sort();for(let i=0,n=t.length;i<n;i++)e+=t[i]+":"+s[t[i]]+";";return e}function zV(s){switch(s){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function FRe(s){return s.search(/\.jpe?g($|\?)/i)>0||s.search(/^data\:image\/jpeg/)===0?"image/jpeg":s.search(/\.webp($|\?)/i)>0||s.search(/^data\:image\/webp/)===0?"image/webp":s.search(/\.ktx2($|\?)/i)>0||s.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const VRe=new Qi;let zRe=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new lRe,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=-1,r=!1,o=-1;if(typeof navigator<"u"){const a=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(a)===!0;const l=a.match(/Version\/(\d+)/);n=i&&l?parseInt(l[1],10):-1,r=a.indexOf("Firefox")>-1,o=r?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&n<17||r&&o<98?this.textureLoader=new vne(this.options.manager):this.textureLoader=new jEe(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new T0(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][n.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:n.asset,parser:i,userData:{}};return Cg(r,a,n),Zu(a,n),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){const o=t[n].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let n=0,r=e.length;n<r;n++){const o=e[n];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),r=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,h]of o.children.entries())r(h,a.children[c])};return r(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const r=e(t[n]);r&&i.push(r)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":n=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(r,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Ti.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(r,o){i.load(tw.resolveURL(t.uri,n.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const n=t.byteLength||0,r=t.byteOffset||0;return i.slice(r,r+n)})}loadAccessor(e){const t=this,i=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const o=fN[n.type],a=Yb[n.componentType],l=n.normalized===!0,c=new a(n.count*o);return Promise.resolve(new Kl(c,o,l))}const r=[];return n.bufferView!==void 0?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),n.sparse!==void 0&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=fN[n.type],c=Yb[n.componentType],h=c.BYTES_PER_ELEMENT,d=h*l,u=n.byteOffset||0,f=n.bufferView!==void 0?i.bufferViews[n.bufferView].byteStride:void 0,m=n.normalized===!0;let g,A;if(f&&f!==d){const y=Math.floor(u/f),b="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+y+":"+n.count;let x=t.cache.get(b);x||(g=new c(a,y*f,n.count*f/h),x=new yEe(g,f/h),t.cache.add(b,x)),A=new PO(x,l,u%f/h,m)}else a===null?g=new c(n.count*l):g=new c(a,u,n.count*l),A=new Kl(g,l,m);if(n.sparse!==void 0){const y=fN.SCALAR,b=Yb[n.sparse.indices.componentType],x=n.sparse.indices.byteOffset||0,v=n.sparse.values.byteOffset||0,_=new b(o[1],x,n.sparse.count*y),C=new c(o[2],v,n.sparse.count*l);a!==null&&(A=new Kl(A.array.slice(),A.itemSize,A.normalized)),A.normalized=!1;for(let S=0,M=_.length;S<M;S++){const L=_[S];if(A.setX(L,C[S*l]),l>=2&&A.setY(L,C[S*l+1]),l>=3&&A.setZ(L,C[S*l+2]),l>=4&&A.setW(L,C[S*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}A.normalized=m}return A})}loadTexture(e){const t=this.json,i=this.options,r=t.textures[e].source,o=t.images[r];let a=this.textureLoader;if(o.uri){const l=i.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,i){const n=this,r=this.json,o=r.textures[e],a=r.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then(function(h){h.flipY=!1,h.name=o.name||a.name||"",h.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(h.name=a.uri);const u=(r.samplers||{})[o.sampler]||{};return h.magFilter=e4[u.magFilter]||gm,h.minFilter=e4[u.minFilter]||iM,h.wrapS=t4[u.wrapS]||aS,h.wrapT=t4[u.wrapT]||aS,h.generateMipmaps=!h.isCompressedTexture&&h.minFilter!==Sx&&h.minFilter!==gm,n.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const i=this,n=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const o=n.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(d){c=!0;const u=new Blob([d],{type:o.mimeType});return l=a.createObjectURL(u),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(d){return new Promise(function(u,f){let m=u;t.isImageBitmapLoader===!0&&(m=function(g){const A=new zr(g);A.needsUpdate=!0,u(A)}),t.load(tw.resolveURL(d,r.path),m,void 0,f)})}).then(function(d){return c===!0&&a.revokeObjectURL(l),Zu(d,o),d.userData.mimeType=o.mimeType||FRe(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=h,h}assignTexture(e,t,i,n){const r=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),r.extensions[Ti.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[Ti.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=r.associations.get(o);o=r.extensions[Ti.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,l)}}return n!==void 0&&(o.colorSpace=n),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const n=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new yne,Hf.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new Ane,Hf.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(n||r||o){let a="ClonedMaterial:"+i.uuid+":";n&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),n&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return lP}loadMaterial(e){const t=this,i=this.json,n=this.extensions,r=i.materials[e];let o;const a={},l=r.extensions||{},c=[];if(l[Ti.KHR_MATERIALS_UNLIT]){const d=n[Ti.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),c.push(d.extendParams(a,r,t))}else{const d=r.pbrMetallicRoughness||{};if(a.color=new nr(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const u=d.baseColorFactor;a.color.setRGB(u[0],u[1],u[2],tc),a.opacity=u[3]}d.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",d.baseColorTexture,Js)),a.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,a.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(u){return u.getMaterialType&&u.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(u){return u.extendMaterialParams&&u.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=gTe);const h=r.alphaMode||mN.OPAQUE;if(h===mN.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===mN.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==Eb&&(c.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new Hr(1,1),r.normalTexture.scale!==void 0)){const d=r.normalTexture.scale;a.normalScale.set(d,d)}if(r.occlusionTexture!==void 0&&o!==Eb&&(c.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==Eb){const d=r.emissiveFactor;a.emissive=new nr().setRGB(d[0],d[1],d[2],tc)}return r.emissiveTexture!==void 0&&o!==Eb&&c.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,Js)),Promise.all(c).then(function(){const d=new o(a);return r.name&&(d.name=r.name),Zu(d,r),t.associations.set(d,{materials:e}),r.extensions&&Cg(n,d,r),d})}createUniqueName(e){const t=mn.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,n=this.primitiveCache;function r(a){return i[Ti.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return i4(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],h=DRe(c),d=n[h];if(d)o.push(d.promise);else{let u;c.extensions&&c.extensions[Ti.KHR_DRACO_MESH_COMPRESSION]?u=r(c):u=i4(new Fh,c,t),n[h]={primitive:c,promise:u},o.push(u)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,n=this.extensions,r=i.meshes[e],o=r.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const h=o[l].material===void 0?GRe(this.cache):this.getDependency("material",o[l].material);a.push(h)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],d=[];for(let f=0,m=h.length;f<m;f++){const g=h[f],A=o[f];let y;const b=c[f];if(A.mode===Cc.TRIANGLES||A.mode===Cc.TRIANGLE_STRIP||A.mode===Cc.TRIANGLE_FAN||A.mode===void 0)y=r.isSkinnedMesh===!0?new xEe(g,b):new Qf(g,b),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),A.mode===Cc.TRIANGLE_STRIP?y.geometry=qQ(y.geometry,lne):A.mode===Cc.TRIANGLE_FAN&&(y.geometry=qQ(y.geometry,BV));else if(A.mode===Cc.LINES)y=new IEe(g,b);else if(A.mode===Cc.LINE_STRIP)y=new NO(g,b);else if(A.mode===Cc.LINE_LOOP)y=new TEe(g,b);else if(A.mode===Cc.POINTS)y=new EEe(g,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+A.mode);Object.keys(y.geometry.morphAttributes).length>0&&NRe(y,r),y.name=t.createUniqueName(r.name||"mesh_"+e),Zu(y,r),A.extensions&&Cg(n,y,A),t.assignFinalMaterial(y),d.push(y)}for(let f=0,m=d.length;f<m;f++)t.associations.set(d[f],{meshes:e,primitives:f});if(d.length===1)return r.extensions&&Cg(n,d[0],r),d[0];const u=new dN;r.extensions&&Cg(n,u,r),t.associations.set(u,{meshes:e});for(let f=0,m=d.length;f<m;f++)u.add(d[f]);return u})}loadCamera(e){let t;const i=this.json.cameras[e],n=i[i.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new BO(jTe.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):i.type==="orthographic"&&(t=new _ne(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Zu(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let n=0,r=t.joints.length;n<r;n++)i.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(n){const r=n.pop(),o=n,a=[],l=[];for(let c=0,h=o.length;c<h;c++){const d=o[c];if(d){a.push(d);const u=new Qi;r!==null&&u.fromArray(r.array,c*16),l.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new kO(a,l)})}loadAnimation(e){const t=this.json,i=this,n=t.animations[e],r=n.name?n.name:"animation_"+e,o=[],a=[],l=[],c=[],h=[];for(let d=0,u=n.channels.length;d<u;d++){const f=n.channels[d],m=n.samplers[f.sampler],g=f.target,A=g.node,y=n.parameters!==void 0?n.parameters[m.input]:m.input,b=n.parameters!==void 0?n.parameters[m.output]:m.output;g.node!==void 0&&(o.push(this.getDependency("node",A)),a.push(this.getDependency("accessor",y)),l.push(this.getDependency("accessor",b)),c.push(m),h.push(g))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(d){const u=d[0],f=d[1],m=d[2],g=d[3],A=d[4],y=[];for(let b=0,x=u.length;b<x;b++){const v=u[b],_=f[b],C=m[b],S=g[b],M=A[b];if(v===void 0)continue;v.updateMatrix&&v.updateMatrix();const L=i._createAnimationTracks(v,_,C,S,M);if(L)for(let w=0;w<L.length;w++)y.push(L[w])}return new FEe(r,void 0,y)})}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return n.mesh===void 0?null:i.getDependency("mesh",n.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,n.mesh,r);return n.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=n.weights.length;l<c;l++)a.morphTargetInfluences[l]=n.weights[l]}),o})}loadNode(e){const t=this.json,i=this,n=t.nodes[e],r=i._loadNodeShallow(e),o=[],a=n.children||[];for(let c=0,h=a.length;c<h;c++)o.push(i.getDependency("node",a[c]));const l=n.skin===void 0?Promise.resolve(null):i.getDependency("skin",n.skin);return Promise.all([r,Promise.all(o),l]).then(function(c){const h=c[0],d=c[1],u=c[2];u!==null&&h.traverse(function(f){f.isSkinnedMesh&&f.bind(u,VRe)});for(let f=0,m=d.length;f<m;f++)h.add(d[f]);return h})}_loadNodeShallow(e){const t=this.json,i=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],o=r.name?n.createUniqueName(r.name):"",a=[],l=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),r.camera!==void 0&&a.push(n.getDependency("camera",r.camera).then(function(c){return n._getNodeRef(n.cameraCache,r.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let h;if(r.isBone===!0?h=new gne:c.length>1?h=new dN:c.length===1?h=c[0]:h=new Os,h!==c[0])for(let d=0,u=c.length;d<u;d++)h.add(c[d]);if(r.name&&(h.userData.name=r.name,h.name=o),Zu(h,r),r.extensions&&Cg(i,h,r),r.matrix!==void 0){const d=new Qi;d.fromArray(r.matrix),h.applyMatrix4(d)}else r.translation!==void 0&&h.position.fromArray(r.translation),r.rotation!==void 0&&h.quaternion.fromArray(r.rotation),r.scale!==void 0&&h.scale.fromArray(r.scale);return n.associations.has(h)||n.associations.set(h,{}),n.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],n=this,r=new dN;i.name&&(r.name=n.createUniqueName(i.name)),Zu(r,i),i.extensions&&Cg(t,r,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(n.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let h=0,d=l.length;h<d;h++)r.add(l[h]);const c=h=>{const d=new Map;for(const[u,f]of n.associations)(u instanceof Hf||u instanceof zr)&&d.set(u,f);return h.traverse(u=>{const f=n.associations.get(u);f!=null&&d.set(u,f)}),d};return n.associations=c(r),r})}_createAnimationTracks(e,t,i,n,r){const o=[],a=e.name?e.name:e.uuid,l=[];af[r.path]===af.weights?e.traverse(function(u){u.morphTargetInfluences&&l.push(u.name?u.name:u.uuid)}):l.push(a);let c;switch(af[r.path]){case af.weights:c=Mx;break;case af.rotation:c=Ix;break;case af.position:case af.scale:c=Tx;break;default:switch(i.itemSize){case 1:c=Mx;break;case 2:case 3:default:c=Tx;break}break}const h=n.interpolation!==void 0?PRe[n.interpolation]:cS,d=this._getArrayFromAccessor(i);for(let u=0,f=l.length;u<f;u++){const m=new c(l[u]+"."+af[r.path],t.array,d,h);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=zV(t.constructor),n=new Float32Array(t.length);for(let r=0,o=t.length;r<o;r++)n[r]=t[r]*i;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const n=this instanceof Ix?BRe:wne;return new n(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function URe(s,e,t){const i=e.attributes,n=new Dh;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(n.set(new _e(l[0],l[1],l[2]),new _e(c[0],c[1],c[2])),a.normalized){const h=zV(Yb[a.componentType]);n.min.multiplyScalar(h),n.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new _e,l=new _e;for(let c=0,h=r.length;c<h;c++){const d=r[c];if(d.POSITION!==void 0){const u=t.json.accessors[d.POSITION],f=u.min,m=u.max;if(f!==void 0&&m!==void 0){if(l.setX(Math.max(Math.abs(f[0]),Math.abs(m[0]))),l.setY(Math.max(Math.abs(f[1]),Math.abs(m[1]))),l.setZ(Math.max(Math.abs(f[2]),Math.abs(m[2]))),u.normalized){const g=zV(Yb[u.componentType]);l.multiplyScalar(g)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(a)}s.boundingBox=n;const o=new Oh;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,s.boundingSphere=o}function i4(s,e,t){const i=e.attributes,n=[];function r(o,a){return t.getDependency("accessor",o).then(function(l){s.setAttribute(a,l)})}for(const o in i){const a=VV[o]||o.toLowerCase();a in s.attributes||n.push(r(i[o],a))}if(e.indices!==void 0&&!s.index){const o=t.getDependency("accessor",e.indices).then(function(a){s.setIndex(a)});n.push(o)}return Ka.workingColorSpace!==tc&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Ka.workingColorSpace}" not supported.`),Zu(s,e),URe(s,e,t),Promise.all(n).then(function(){return e.targets!==void 0?kRe(s,e.targets,t):s})}var XRe=function(){var s="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",e="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var n=WebAssembly.validate(t)?e:s,r,o=WebAssembly.instantiate(a(n),{}).then(function(y){r=y.instance,r.exports.__wasm_call_ctors()});function a(y){for(var b=new Uint8Array(y.length),x=0;x<y.length;++x){var v=y.charCodeAt(x);b[x]=v>96?v-97:v>64?v-39:v+4}for(var _=0,x=0;x<y.length;++x)b[_++]=b[x]<60?i[b[x]]:(b[x]-60)*64+b[++x];return b.buffer.slice(0,_)}function l(y,b,x,v,_,C){var S=r.exports.sbrk,M=x+3&-4,L=S(M*v),w=S(_.length),E=new Uint8Array(r.exports.memory.buffer);E.set(_,w);var B=y(L,x,v,w,_.length);if(B==0&&C&&C(L,M,v),b.set(E.subarray(L,L+x*v)),S(L-S(0)),B!=0)throw new Error("Malformed buffer data: "+B)}var c={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},d=[],u=0;function f(y){var b={object:new Worker(y),pending:0,requests:{}};return b.object.onmessage=function(x){var v=x.data;b.pending-=v.count,b.requests[v.id][v.action](v.value),delete b.requests[v.id]},b}function m(y){for(var b="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(n))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+l.toString()+A.toString(),x=new Blob([b],{type:"text/javascript"}),v=URL.createObjectURL(x),_=0;_<y;++_)d[_]=f(v);URL.revokeObjectURL(v)}function g(y,b,x,v,_){for(var C=d[0],S=1;S<d.length;++S)d[S].pending<C.pending&&(C=d[S]);return new Promise(function(M,L){var w=new Uint8Array(x),E=u++;C.pending+=y,C.requests[E]={resolve:M,reject:L},C.object.postMessage({id:E,count:y,size:b,source:w,mode:v,filter:_},[w.buffer])})}function A(y){o.then(function(){var b=y.data;try{var x=new Uint8Array(b.count*b.size);l(r.exports[b.mode],x,b.count,b.size,b.source,r.exports[b.filter]),self.postMessage({id:b.id,count:b.count,action:"resolve",value:x},[x.buffer])}catch(v){self.postMessage({id:b.id,count:b.count,action:"reject",value:v})}})}return{ready:o,supported:!0,useWorkers:function(y){m(y)},decodeVertexBuffer:function(y,b,x,v,_){l(r.exports.meshopt_decodeVertexBuffer,y,b,x,v,r.exports[c[_]])},decodeIndexBuffer:function(y,b,x,v){l(r.exports.meshopt_decodeIndexBuffer,y,b,x,v)},decodeIndexSequence:function(y,b,x,v){l(r.exports.meshopt_decodeIndexSequence,y,b,x,v)},decodeGltfBuffer:function(y,b,x,v,_,C){l(r.exports[h[_]],y,b,x,v,r.exports[c[C]])},decodeGltfBufferAsync:function(y,b,x,v,_){return d.length>0?g(y,b,x,h[v],c[_]):o.then(function(){var C=new Uint8Array(y*b);return l(r.exports[h[v]],C,y,b,x,r.exports[c[_]]),C})}}}();const AN=new WeakMap;class ORe extends Fm{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,n){const r=new T0(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,o=>{this.parse(o,t,n)},i,n)}parse(e,t,i=()=>{}){this.decodeDracoFile(e,t,null,null,Js,i).catch(i)}decodeDracoFile(e,t,i,n,r=tc,o=()=>{}){const a={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:r};return this.decodeGeometry(e,a).then(t).catch(o)}decodeGeometry(e,t){const i=JSON.stringify(t);if(AN.has(e)){const l=AN.get(e);if(l.key===i)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const r=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(r,o).then(l=>(n=l,new Promise((c,h)=>{n._callbacks[r]={resolve:c,reject:h},n.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return a.catch(()=>!0).then(()=>{n&&r&&this._releaseTask(n,r)}),AN.set(e,{key:i,promise:a}),a}_createGeometry(e){const t=new Fh;e.index&&t.setIndex(new Kl(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const n=e.attributes[i],r=n.name,o=n.array,a=n.itemSize,l=new Kl(o,a);r==="color"&&(this._assignVertexColorSpace(l,n.vertexColorSpace),l.normalized=!(o instanceof Float32Array)),t.setAttribute(r,l)}return t}_assignVertexColorSpace(e,t){if(t!==Js)return;const i=new nr;for(let n=0,r=e.count;n<r;n++)i.fromBufferAttribute(e,n),Ka.toWorkingColorSpace(i,Js),e.setXYZ(n,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new T0(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((n,r)=>{i.load(e,n,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const n=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const r=ZRe.toString(),o=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(r){const o=r.data;switch(o.type){case"decode":n._callbacks[o.id].resolve(o);break;case"error":n._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,r){return n._taskLoad>r._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function ZRe(){let s,e;onmessage=function(o){const a=o.data;switch(a.type){case"init":s=a.decoderConfig,e=new Promise(function(h){s.onModuleLoaded=function(d){h({draco:d})},DracoDecoderModule(s)});break;case"decode":const l=a.buffer,c=a.taskConfig;e.then(h=>{const d=h.draco,u=new d.Decoder;try{const f=t(d,u,new Int8Array(l),c),m=f.attributes.map(g=>g.array.buffer);f.index&&m.push(f.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:f},m)}catch(f){console.error(f),self.postMessage({type:"error",id:a.id,error:f.message})}finally{d.destroy(u)}});break}};function t(o,a,l,c){const h=c.attributeIDs,d=c.attributeTypes;let u,f;const m=a.GetEncodedGeometryType(l);if(m===o.TRIANGULAR_MESH)u=new o.Mesh,f=a.DecodeArrayToMesh(l,l.byteLength,u);else if(m===o.POINT_CLOUD)u=new o.PointCloud,f=a.DecodeArrayToPointCloud(l,l.byteLength,u);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||u.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());const g={index:null,attributes:[]};for(const A in h){const y=self[d[A]];let b,x;if(c.useUniqueIDs)x=h[A],b=a.GetAttributeByUniqueId(u,x);else{if(x=a.GetAttributeId(u,o[h[A]]),x===-1)continue;b=a.GetAttribute(u,x)}const v=n(o,a,u,A,y,b);A==="color"&&(v.vertexColorSpace=c.vertexColorSpace),g.attributes.push(v)}return m===o.TRIANGULAR_MESH&&(g.index=i(o,a,u)),o.destroy(u),g}function i(o,a,l){const h=l.num_faces()*3,d=h*4,u=o._malloc(d);a.GetTrianglesUInt32Array(l,d,u);const f=new Uint32Array(o.HEAPF32.buffer,u,h).slice();return o._free(u),{array:f,itemSize:1}}function n(o,a,l,c,h,d){const u=d.num_components(),m=l.num_points()*u,g=m*h.BYTES_PER_ELEMENT,A=r(o,h),y=o._malloc(g);a.GetAttributeDataArrayForAllPoints(l,d,A,g,y);const b=new h(o.HEAPF32.buffer,y,m).slice();return o._free(y),{name:c,array:b,itemSize:u}}function r(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}let WRe=class{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:n,msg:r,transfer:o}=this.queue.shift();this.workersResolve[e]=n,this.workers[e].postMessage(r,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(i=>{const n=this._getIdleWorker();n!==-1?(this._initWorker(n),this.workerStatus|=1<<n,this.workersResolve[n]=i,this.workers[n].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}};const HRe=0,n4=2,QRe=1,s4=2,KRe=0,YRe=1,JRe=10,jRe=0,Sne=9,Mne=15,Ine=16,Tne=22,Ene=37,Rne=43,Lne=76,Bne=83,Pne=97,Gne=100,kne=103,Nne=109,Dne=165,Fne=166,XO=1000066e3;let qRe=class{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}},g_=class{constructor(e,t,i,n){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=n,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){t===void 0&&(t=0);const i=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==t&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,n)}};const ua=[171,75,84,88,32,50,48,187,13,10,26,10];function r4(s){return new TextDecoder().decode(s)}function $Re(s){const e=new Uint8Array(s.buffer,s.byteOffset,ua.length);if(e[0]!==ua[0]||e[1]!==ua[1]||e[2]!==ua[2]||e[3]!==ua[3]||e[4]!==ua[4]||e[5]!==ua[5]||e[6]!==ua[6]||e[7]!==ua[7]||e[8]!==ua[8]||e[9]!==ua[9]||e[10]!==ua[10]||e[11]!==ua[11])throw new Error("Missing KTX 2.0 identifier.");const t=new qRe,i=17*Uint32Array.BYTES_PER_ELEMENT,n=new g_(s,ua.length,i,!0);t.vkFormat=n._nextUint32(),t.typeSize=n._nextUint32(),t.pixelWidth=n._nextUint32(),t.pixelHeight=n._nextUint32(),t.pixelDepth=n._nextUint32(),t.layerCount=n._nextUint32(),t.faceCount=n._nextUint32();const r=n._nextUint32();t.supercompressionScheme=n._nextUint32();const o=n._nextUint32(),a=n._nextUint32(),l=n._nextUint32(),c=n._nextUint32(),h=n._nextUint64(),d=n._nextUint64(),u=new g_(s,ua.length+i,3*r*8,!0);for(let H=0;H<r;H++)t.levels.push({levelData:new Uint8Array(s.buffer,s.byteOffset+u._nextUint64(),u._nextUint64()),uncompressedByteLength:u._nextUint64()});const f=new g_(s,o,a,!0),m={vendorId:f._skip(4)._nextUint16(),descriptorType:f._nextUint16(),versionNumber:f._nextUint16(),descriptorBlockSize:f._nextUint16(),colorModel:f._nextUint8(),colorPrimaries:f._nextUint8(),transferFunction:f._nextUint8(),flags:f._nextUint8(),texelBlockDimension:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],bytesPlane:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],samples:[]},g=(m.descriptorBlockSize/4-6)/4;for(let H=0;H<g;H++){const W={bitOffset:f._nextUint16(),bitLength:f._nextUint8(),channelType:f._nextUint8(),samplePosition:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&W.channelType?(W.sampleLower=f._nextInt32(),W.sampleUpper=f._nextInt32()):(W.sampleLower=f._nextUint32(),W.sampleUpper=f._nextUint32()),m.samples[H]=W}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(m);const A=new g_(s,l,c,!0);for(;A._offset<c;){const H=A._nextUint32(),W=A._scan(H),se=r4(W);if(t.keyValue[se]=A._nextUint8Array(H-W.byteLength-1),se.match(/^ktx/i)){const de=r4(t.keyValue[se]);t.keyValue[se]=de.substring(0,de.lastIndexOf("\0"))}A._skip(H%4?4-H%4:0)}if(d<=0)return t;const y=new g_(s,h,d,!0),b=y._nextUint16(),x=y._nextUint16(),v=y._nextUint32(),_=y._nextUint32(),C=y._nextUint32(),S=y._nextUint32(),M=[];for(let H=0;H<r;H++)M.push({imageFlags:y._nextUint32(),rgbSliceByteOffset:y._nextUint32(),rgbSliceByteLength:y._nextUint32(),alphaSliceByteOffset:y._nextUint32(),alphaSliceByteLength:y._nextUint32()});const L=h+y._offset,w=L+v,E=w+_,B=E+C,P=new Uint8Array(s.buffer,s.byteOffset+L,v),k=new Uint8Array(s.buffer,s.byteOffset+w,_),X=new Uint8Array(s.buffer,s.byteOffset+E,C),F=new Uint8Array(s.buffer,s.byteOffset+B,S);return t.globalData={endpointCount:b,selectorCount:x,imageDescs:M,endpointsData:P,selectorsData:k,tablesData:X,extendedData:F},t}let yN,Du,UV;const bN={env:{emscripten_notify_memory_growth:function(s){UV=new Uint8Array(Du.exports.memory.buffer)}}};let eLe=class{init(){return yN||(yN=typeof fetch<"u"?fetch("data:application/wasm;base64,"+o4).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,bN)).then(this._init):WebAssembly.instantiate(Buffer.from(o4,"base64"),bN).then(this._init),yN)}_init(e){Du=e.instance,bN.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Du)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,n=Du.exports.malloc(i);UV.set(e,n),t=t||Number(Du.exports.ZSTD_findDecompressedSize(n,i));const r=Du.exports.malloc(t),o=Du.exports.ZSTD_decompress(r,t,n,i),a=UV.slice(r,r+o);return Du.exports.free(n),Du.exports.free(r),a}};const o4="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",tLe="display-p3",iLe="display-p3-linear",xN=new WeakMap;let vN=0,_N,iv=class rb extends Fm{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new WRe,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new T0(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),i=new T0(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const n=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,n]).then(([r,o])=>{const a=rb.BasisWorker.toString(),l=["/* constants */","let _EngineFormat = "+JSON.stringify(rb.EngineFormat),"let _EngineType = "+JSON.stringify(rb.EngineType),"let _TranscoderFormat = "+JSON.stringify(rb.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(rb.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const c=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return c.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),c})}),vN>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),vN++}return this.transcoderPending}load(e,t,i,n){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new T0(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(e,o=>{this.parse(o,t,n)},i,n)}parse(e,t,i){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(xN.has(e))return xN.get(e).promise.then(t).catch(i);this._createTexture(e).then(n=>t?t(n):null).catch(i)}_createTextureFrom(e,t){const{type:i,error:n,data:{faces:r,width:o,height:a,format:l,type:c,dfdFlags:h}}=e;if(i==="error")return Promise.reject(n);let d;if(t.faceCount===6)d=new LEe(r,l,c);else{const u=r[0].mipmaps;d=t.layerCount>1?new REe(u,o,a,t.layerCount,l,c):new aP(u,o,a,l,c)}return d.minFilter=r[0].mipmaps.length===1?gm:iM,d.magFilter=gm,d.generateMipmaps=!1,d.needsUpdate=!0,d.colorSpace=Vne(t),d.premultiplyAlpha=!!(h&QRe),d}async _createTexture(e,t={}){const i=$Re(new Uint8Array(e)),n=i.vkFormat===XO&&i.dataFormatDescriptor[0].colorModel===167;if(!(i.vkFormat===jRe||n&&!this.workerConfig.astcHDRSupported))return sLe(i);const o=t,a=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:o},[e])).then(l=>this._createTextureFrom(l.data,i));return xN.set(e,{promise:a}),a}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),vN--,this}};iv.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2};iv.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25};iv.EngineFormat={RGBAFormat:Gf,RGBA_ASTC_4x4_Format:ane,RGB_BPTC_UNSIGNED_Format:LTe,RGBA_BPTC_Format:RTe,RGBA_ETC2_EAC_Format:ETe,RGBA_PVRTC_4BPPV1_Format:MTe,RGBA_S3TC_DXT5_Format:wTe,RGB_ETC1_Format:ITe,RGB_ETC2_Format:TTe,RGB_PVRTC_4BPPV1_Format:STe,RGBA_S3TC_DXT1_Format:CTe};iv.EngineType={UnsignedByteType:cd,HalfFloatType:Ib,FloatType:Wf};iv.BasisWorker=function(){let s,e,t;const i=_EngineFormat,n=_EngineType,r=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",function(m){const g=m.data;switch(g.type){case"init":s=g.config,a(g.transcoderBinary);break;case"transcode":e.then(()=>{try{const{faces:A,buffers:y,width:b,height:x,hasAlpha:v,format:_,type:C,dfdFlags:S}=l(g.buffer);self.postMessage({type:"transcode",id:g.id,data:{faces:A,width:b,height:x,hasAlpha:v,format:_,type:C,dfdFlags:S}},y)}catch(A){console.error(A),self.postMessage({type:"error",id:g.id,error:A.message})}});break}});function a(m){e=new Promise(g=>{t={wasmBinary:m,onRuntimeInitialized:g},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function l(m){const g=new t.KTX2File(new Uint8Array(m));function A(){g.close(),g.delete()}if(!g.isValid())throw A(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let y;if(g.isUASTC())y=o.UASTC;else if(g.isETC1S())y=o.ETC1S;else if(g.isHDR())y=o.UASTC_HDR;else throw new Error("THREE.KTX2Loader: Unknown Basis encoding");const b=g.getWidth(),x=g.getHeight(),v=g.getLayers()||1,_=g.getLevels(),C=g.getFaces(),S=g.getHasAlpha(),M=g.getDFDFlags(),{transcoderFormat:L,engineFormat:w,engineType:E}=d(y,b,x,S);if(!b||!x||!_)throw A(),new Error("THREE.KTX2Loader:	Invalid texture");if(!g.startTranscoding())throw A(),new Error("THREE.KTX2Loader: .startTranscoding failed");const B=[],P=[];for(let k=0;k<C;k++){const X=[];for(let F=0;F<_;F++){const H=[];let W,se;for(let be=0;be<v;be++){const Pe=g.getImageLevelInfo(F,be,k);k===0&&F===0&&be===0&&(Pe.origWidth%4!==0||Pe.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),_>1?(W=Pe.origWidth,se=Pe.origHeight):(W=Pe.width,se=Pe.height);let Oe=new Uint8Array(g.getImageTranscodedSizeInBytes(F,be,0,L));const ae=g.transcodeImage(Oe,F,be,k,L,0,-1,-1);if(E===n.HalfFloatType&&(Oe=new Uint16Array(Oe.buffer,Oe.byteOffset,Oe.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!ae)throw A(),new Error("THREE.KTX2Loader: .transcodeImage failed.");H.push(Oe)}const de=f(H);X.push({data:de,width:W,height:se}),P.push(de.buffer)}B.push({mipmaps:X,width:b,height:x,format:w,type:E})}return A(),{faces:B,buffers:P,width:b,height:x,hasAlpha:S,dfdFlags:M,format:w,type:E}}const c=[{if:"astcSupported",basisFormat:[o.UASTC],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],engineType:[n.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],engineType:[n.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.BC1,r.BC3],engineFormat:[i.RGBA_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],engineType:[n.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],engineType:[n.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.ETC1],engineFormat:[i.RGB_ETC1_Format],engineType:[n.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],engineType:[n.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[o.UASTC_HDR],transcoderFormat:[r.BC6H],engineFormat:[i.RGB_BPTC_UNSIGNED_Format],engineType:[n.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.RGBA32,r.RGBA32],engineFormat:[i.RGBAFormat,i.RGBAFormat],engineType:[n.UnsignedByteType,n.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[o.UASTC_HDR],transcoderFormat:[r.RGBA_HALF],engineFormat:[i.RGBAFormat],engineType:[n.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],h={[o.ETC1S]:c.filter(m=>m.basisFormat.includes(o.ETC1S)).sort((m,g)=>m.priorityUASTC-g.priorityUASTC),[o.UASTC]:c.filter(m=>m.basisFormat.includes(o.UASTC)).sort((m,g)=>m.priorityUASTC-g.priorityUASTC),[o.UASTC_HDR]:c.filter(m=>m.basisFormat.includes(o.UASTC_HDR)).sort((m,g)=>m.priorityHDR-g.priorityHDR)};function d(m,g,A,y){const b=h[m];for(let x=0;x<b.length;x++){const v=b[x];if(v.if&&!s[v.if]||!v.basisFormat.includes(m)||y&&v.transcoderFormat.length<2||v.needsPowerOfTwo&&!(u(g)&&u(A)))continue;const _=v.transcoderFormat[y?1:0],C=v.engineFormat[y?1:0],S=v.engineType[0];return{transcoderFormat:_,engineFormat:C,engineType:S}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}function u(m){return m<=2?!0:(m&m-1)===0&&m!==0}function f(m){if(m.length===1)return m[0];let g=0;for(let b=0;b<m.length;b++){const x=m[b];g+=x.byteLength}const A=new Uint8Array(g);let y=0;for(let b=0;b<m.length;b++){const x=m[b];A.set(x,y),y+=x.byteLength}return A}};const nLe=new Set([Gf,aC,Tb]),CN={[Nne]:Gf,[Pne]:Gf,[Ene]:Gf,[Rne]:Gf,[kne]:aC,[Bne]:aC,[Ine]:aC,[Tne]:aC,[Gne]:Tb,[Lne]:Tb,[Mne]:Tb,[Sne]:Tb,[XO]:ane,[Fne]:hQ,[Dne]:hQ},wN={[Nne]:Wf,[Pne]:Ib,[Ene]:cd,[Rne]:cd,[kne]:Wf,[Bne]:Ib,[Ine]:cd,[Tne]:cd,[Gne]:Wf,[Lne]:Ib,[Mne]:cd,[Sne]:cd,[XO]:Ib,[Fne]:cd,[Dne]:cd};async function sLe(s){const{vkFormat:e}=s;if(CN[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let t;s.supercompressionScheme===n4&&(_N||(_N=new Promise(async r=>{const o=new eLe;await o.init(),r(o)})),t=await _N);const i=[];for(let r=0;r<s.levels.length;r++){const o=Math.max(1,s.pixelWidth>>r),a=Math.max(1,s.pixelHeight>>r),l=s.pixelDepth?Math.max(1,s.pixelDepth>>r):0,c=s.levels[r];let h;if(s.supercompressionScheme===HRe)h=c.levelData;else if(s.supercompressionScheme===n4)h=t.decode(c.levelData,c.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let d;wN[e]===Wf?d=new Float32Array(h.buffer,h.byteOffset,h.byteLength/Float32Array.BYTES_PER_ELEMENT):wN[e]===Ib?d=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT):d=h,i.push({data:d,width:o,height:a,depth:l})}let n;if(nLe.has(CN[e]))n=s.pixelDepth===0?new GO(i[0].data,s.pixelWidth,s.pixelHeight):new sEe(i[0].data,s.pixelWidth,s.pixelHeight,s.pixelDepth);else{if(s.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");n=new aP(i,s.pixelWidth,s.pixelHeight),n.minFilter=i.length===1?gm:iM,n.magFilter=gm}return n.mipmaps=i,n.type=wN[e],n.format=CN[e],n.colorSpace=Vne(s),n.needsUpdate=!0,Promise.resolve(n)}function Vne(s){const e=s.dataFormatDescriptor[0];return e.colorPrimaries===YRe?e.transferFunction===s4?Js:tc:e.colorPrimaries===JRe?e.transferFunction===s4?tLe:iLe:(e.colorPrimaries===KRe||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),qL)}let Jb="https://www.gstatic.com/draco/versioned/decoders/1.5.7/",dS="https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";const rLe=Jb,oLe=dS;fetch(Jb+"draco_decoder.js",{method:"head"}).catch(s=>{Jb===rLe&&(Jb="./include/draco/"),dS===oLe&&(dS="./include/ktx2/")});function aLe(s){Jb=s}function lLe(s){dS=s}let ob,MR,ab;function cP(s){return ob||(ob=new ORe,ob.setDecoderPath(Jb),ob.setDecoderConfig({type:"js"})),ab||(ab=new iv,ab.setTranscoderPath(dS)),MR||(MR=XRe),s?ab.detectSupport(s):s!==null&&console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures might fail"),{dracoLoader:ob,ktx2Loader:ab,meshoptDecoder:MR}}function zne(s){s.dracoLoader||s.setDRACOLoader(ob),s.ktx2Loader||s.setKTX2Loader(ab),s.meshoptDecoder||s.setMeshoptDecoder(MR)}const XV=new WeakMap;function cLe(s,e){let t=XV.get(s);t?t=Object.assign(t,e):t=e,XV.set(s,t)}const SN=UO.prototype.load;function hLe(...s){const e=XV.get(this);let t=s[0];const i=new URL(t,window.location.href);if(i.hostname.endsWith("needle.tools")){const r=(e==null?void 0:e.progressive)!==void 0?e.progressive:!0,o=e!=null&&e.usecase?e.usecase:"default";r?this.requestHeader.Accept=`*/*;progressive=allowed;usecase=${o}`:this.requestHeader.Accept=`*/*;usecase=${o}`,t=i.toString()}return s[0]=t,SN==null?void 0:SN.call(this,...s)}UO.prototype.load=hLe;sM("debugprogressive");function sM(s){if(typeof window>"u")return!1;const t=new URL(window.location.href).searchParams.get(s);return t==null||t==="0"||t==="false"?!1:t===""?!0:t}function dLe(s,e){if(e===void 0||e.startsWith("./")||e.startsWith("http")||s===void 0)return e;const t=s.lastIndexOf("/");if(t>=0){const i=s.substring(0,t+1);for(;i.endsWith("/")&&e.startsWith("/");)e=e.substring(1);return i+e}return e}let A_;function uLe(){return A_!==void 0||(A_=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent),sM("debugprogressive")&&console.log("[glTF Progressive]: isMobileDevice",A_)),A_}const OV=Symbol("needle:raycast-mesh");function rM(s){return(s==null?void 0:s[OV])instanceof Fh?s[OV]:null}function pLe(s,e){if((s.type==="Mesh"||s.type==="SkinnedMesh")&&!rM(s)){const i=fLe(e);i.userData={isRaycastMesh:!0},s[OV]=i}}function fLe(s){const e=new Fh;for(const t in s.attributes)e.setAttribute(t,s.getAttribute(t));return e.setIndex(s.getIndex()),e}const If=new Array,ju="NEEDLE_progressive",Un=sM("debugprogressive"),ZV=Symbol("needle-progressive-texture"),iw=new Map,WV=new Set;if(Un){let s=function(){e+=1,console.log("Toggle LOD level",e,iw),iw.forEach((n,r)=>{for(const o of n.keys){const a=r[o];if(a!=null){if(a.isBufferGeometry===!0){const l=Ni.getMeshLODInformation(a),c=l?Math.min(e,l.lods.length):0;r["DEBUG:LOD"]=e,Ni.assignMeshLOD(r,c),l&&(t=Math.max(t,l.lods.length-1))}else if(r.isMaterial===!0){r["DEBUG:LOD"]=e,Ni.assignTextureLOD(r,e);break}}}}),e>=t&&(e=-1)},e=-1,t=2,i=!1;window.addEventListener("keyup",n=>{n.key==="p"&&s(),n.key==="w"&&(i=!i,WV&&WV.forEach(r=>{r.name!="BackgroundCubeMaterial"&&r.glyphMap==null&&"wireframe"in r&&(r.wireframe=i)}))})}function a4(s,e,t){var n;if(!Un)return;iw.has(s)||iw.set(s,{keys:[],sourceId:t});const i=iw.get(s);((n=i==null?void 0:i.keys)==null?void 0:n.includes(e))==!1&&i.keys.push(e)}const kr=class{constructor(s,e){this.loadMesh=t=>{var n,r;if(this._isLoadingMesh)return null;const i=(r=(n=this.parser.json.meshes[t])==null?void 0:n.extensions)==null?void 0:r[ju];return i?(this._isLoadingMesh=!0,this.parser.getDependency("mesh",t).then(o=>{var a;return this._isLoadingMesh=!1,o&&kr.registerMesh(this.url,i.guid,o,(a=i.lods)==null?void 0:a.length,void 0,i),o})):null},Un&&console.log("Progressive extension registered for",e),this.parser=s,this.url=e}get name(){return ju}static getMeshLODInformation(s){const e=this.getAssignedLODInformation(s);return e!=null&&e.key?this.lodInfos.get(e.key):null}static getMaterialMinMaxLODsCount(s,e){const t=this,i="LODS:minmax",n=s[i];if(n!=null)return n;if(e||(e={min_count:1/0,max_count:0,lods:[]}),Array.isArray(s)){for(const o of s)this.getMaterialMinMaxLODsCount(o,e);return s[i]=e,e}if(Un==="verbose"&&console.log("getMaterialMinMaxLODsCount",s),s.type==="ShaderMaterial"||s.type==="RawShaderMaterial"){const o=s;for(const a of Object.keys(o.uniforms)){const l=o.uniforms[a].value;(l==null?void 0:l.isTexture)===!0&&r(l,e)}}else if(s.isMaterial)for(const o of Object.keys(s)){const a=s[o];(a==null?void 0:a.isTexture)===!0&&r(a,e)}return s[i]=e,e;function r(o,a){const l=t.getAssignedLODInformation(o);if(l){const c=t.lodInfos.get(l.key);if(c&&c.lods){a.min_count=Math.min(a.min_count,c.lods.length),a.max_count=Math.max(a.max_count,c.lods.length);for(let h=0;h<c.lods.length;h++){const d=c.lods[h];d.width&&(a.lods[h]=a.lods[h]||{min_height:1/0,max_height:0},a.lods[h].min_height=Math.min(a.lods[h].min_height,d.height),a.lods[h].max_height=Math.max(a.lods[h].max_height,d.height))}}}}}static hasLODLevelAvailable(s,e){var n;if(Array.isArray(s)){for(const r of s)if(this.hasLODLevelAvailable(r,e))return!0;return!1}if(s.isMaterial===!0){for(const r of Object.keys(s)){const o=s[r];if(o&&o.isTexture&&this.hasLODLevelAvailable(o,e))return!0}return!1}else if(s.isGroup===!0){for(const r of s.children)if(r.isMesh===!0&&this.hasLODLevelAvailable(r,e))return!0}let t,i;if(s.isMesh?t=s.geometry:(s.isBufferGeometry||s.isTexture)&&(t=s),t&&(n=t==null?void 0:t.userData)!=null&&n.LODS){const r=t.userData.LODS;if(i=this.lodInfos.get(r.key),e===void 0)return i!=null;if(i)return Array.isArray(i.lods)?e<i.lods.length:e===0}return!1}static assignMeshLOD(s,e){var t;if(!s)return Promise.resolve(null);if(s instanceof Qf||s.isMesh===!0){const i=s.geometry,n=this.getAssignedLODInformation(i);if(!n)return Promise.resolve(null);for(const r of If)(t=r.onBeforeGetLODMesh)==null||t.call(r,s,e);return s["LOD:requested level"]=e,kr.getOrLoadLOD(i,e).then(r=>{if(s["LOD:requested level"]===e){if(delete s["LOD:requested level"],Array.isArray(r)){const o=n.index||0;r=r[o]}r&&i!=r&&((r==null?void 0:r.isBufferGeometry)?(s.geometry=r,Un&&a4(s,"geometry",n.url)):Un&&console.error("Invalid LOD geometry",r))}return r}).catch(r=>(console.error("Error loading mesh LOD",s,r),null))}else Un&&console.error("Invalid call to assignMeshLOD: Request mesh LOD but the object is not a mesh",s);return Promise.resolve(null)}static assignTextureLOD(s,e=0){if(!s)return Promise.resolve(null);if(s.isMesh===!0){const t=s;if(Array.isArray(t.material)){const i=new Array;for(const n of t.material){const r=this.assignTextureLOD(n,e);i.push(r)}return Promise.all(i).then(n=>{const r=new Array;for(const o of n)Array.isArray(o)&&r.push(...o);return r})}else return this.assignTextureLOD(t.material,e)}if(s instanceof Hf||s.isMaterial===!0){const t=s,i=[],n=new Array;if(Un&&WV.add(t),t.uniforms&&(t.isRawShaderMaterial||t.isShaderMaterial===!0)){const r=t;for(const o of Object.keys(r.uniforms)){const a=r.uniforms[o].value;if((a==null?void 0:a.isTexture)===!0){const l=this.assignTextureLODForSlot(a,e,t,o).then(c=>(c&&r.uniforms[o].value!=c&&(r.uniforms[o].value=c,r.uniformsNeedUpdate=!0),c));i.push(l),n.push(o)}}}else for(const r of Object.keys(t)){const o=t[r];if((o==null?void 0:o.isTexture)===!0){const a=this.assignTextureLODForSlot(o,e,t,r);i.push(a),n.push(r)}}return Promise.all(i).then(r=>{const o=new Array;for(let a=0;a<r.length;a++){const l=r[a],c=n[a];l&&l.isTexture===!0?o.push({material:t,slot:c,texture:l,level:e}):o.push({material:t,slot:c,texture:null,level:e})}return o})}if(s instanceof zr||s.isTexture===!0){const t=s;return this.assignTextureLODForSlot(t,e,null,null)}return Promise.resolve(null)}static assignTextureLODForSlot(s,e,t,i){return(s==null?void 0:s.isTexture)!==!0?Promise.resolve(null):i==="glyphMap"?Promise.resolve(s):kr.getOrLoadLOD(s,e).then(n=>{if(Array.isArray(n))return null;if((n==null?void 0:n.isTexture)===!0){if(n!=s){if(t&&i){const r=t[i];if(r){const o=this.getAssignedLODInformation(r);if(o&&(o==null?void 0:o.level)<e)return Un==="verbose"&&console.warn("Assigned texture level is already higher: ",o.level,e,t,r,n),null}t[i]=n}if(Un&&i&&t){const r=this.getAssignedLODInformation(s);r&&a4(t,i,r.url)}}return n}else Un=="verbose"&&console.warn("No LOD found for",s,e);return null}).catch(n=>(console.error("Error loading LOD",s,n),null))}afterRoot(s){var e,t;return Un&&console.log("AFTER",this.url,s),(e=this.parser.json.textures)==null||e.forEach((i,n)=>{var r;if(i!=null&&i.extensions){const o=i==null?void 0:i.extensions[ju];if(o){if(!o.lods){Un&&console.warn("Texture has no LODs",o);return}let a=!1;for(const l of this.parser.associations.keys())if(l.isTexture===!0){const c=this.parser.associations.get(l);(c==null?void 0:c.textures)===n&&(a=!0,kr.registerTexture(this.url,l,(r=o.lods)==null?void 0:r.length,n,o))}a||this.parser.getDependency("texture",n).then(l=>{var c;l&&kr.registerTexture(this.url,l,(c=o.lods)==null?void 0:c.length,n,o)})}}}),(t=this.parser.json.meshes)==null||t.forEach((i,n)=>{if(i!=null&&i.extensions){const r=i==null?void 0:i.extensions[ju];if(r&&r.lods){for(const o of this.parser.associations.keys())if(o.isMesh){const a=this.parser.associations.get(o);(a==null?void 0:a.meshes)===n&&kr.registerMesh(this.url,r.guid,o,r.lods.length,a.primitives,r)}}}}),null}static async getOrLoadLOD(s,e){var o,a,l,c;const t=Un=="verbose",i=s.userData.LODS;if(!i)return null;const n=i==null?void 0:i.key;let r;if(s.isTexture===!0){const h=s;h.source&&h.source[ZV]&&(r=h.source[ZV])}if(r||(r=kr.lodInfos.get(n)),r){if(e>0){let u=!1;const f=Array.isArray(r.lods);if(f&&e>=r.lods.length?u=!0:f||(u=!0),u)return this.lowresCache.get(n)}const h=Array.isArray(r.lods)?(o=r.lods[e])==null?void 0:o.path:r.lods;if(!h)return Un&&!r["missing:uri"]&&(r["missing:uri"]=!0,console.warn("Missing uri for progressive asset for LOD "+e,r)),null;const d=dLe(i.url,h);if(d.endsWith(".glb")||d.endsWith(".gltf")){if(!r.guid)return console.warn("missing pointer for glb/gltf texture",r),null;const u=d+"_"+r.guid,f=this.previouslyLoaded.get(u);if(f!==void 0){t&&console.log(`LOD ${e} was already loading/loaded: ${u}`);let y=await f.catch(x=>(console.error(`Error loading LOD ${e} from ${d}
`,x),null)),b=!1;if(y==null||(y instanceof zr&&s instanceof zr?(a=y.image)!=null&&a.data||(l=y.source)!=null&&l.data?y=this.copySettings(s,y):(b=!0,this.previouslyLoaded.delete(u)):y instanceof Fh&&s instanceof Fh&&((c=y.attributes.position)!=null&&c.array||(b=!0,this.previouslyLoaded.delete(u)))),!b)return y}const m=r,g=new Promise(async(y,b)=>{const x=new UO;zne(x),Un&&(await new Promise(M=>setTimeout(M,1e3)),t&&console.warn("Start loading (delayed) "+d,m.guid));let v=d;if(m&&Array.isArray(m.lods)){const M=m.lods[e];M.hash&&(v+="?v="+M.hash)}const _=await x.loadAsync(v).catch(M=>(console.error(`Error loading LOD ${e} from ${d}
`,M),null));if(!_)return null;const C=_.parser;t&&console.log("Loading finished "+d,m.guid);let S=0;if(_.parser.json.textures){let M=!1;for(const L of _.parser.json.textures){if(L!=null&&L.extensions){const w=L==null?void 0:L.extensions[ju];if(w!=null&&w.guid&&w.guid===m.guid){M=!0;break}}S++}if(M){let L=await C.getDependency("texture",S);return L&&kr.assignLODInformation(i.url,L,n,e,void 0,void 0),t&&console.log('change "'+s.name+'" → "'+L.name+'"',d,S,L,u),s instanceof zr&&(L=this.copySettings(s,L)),L&&(L.guid=m.guid),y(L)}else Un&&console.warn("Could not find texture with guid",m.guid,_.parser.json)}if(S=0,_.parser.json.meshes){let M=!1;for(const L of _.parser.json.meshes){if(L!=null&&L.extensions){const w=L==null?void 0:L.extensions[ju];if(w!=null&&w.guid&&w.guid===m.guid){M=!0;break}}S++}if(M){const L=await C.getDependency("mesh",S),w=m;if(t&&console.log(`Loaded Mesh "${L.name}"`,d,S,L,u),L.isMesh===!0){const E=L.geometry;return kr.assignLODInformation(i.url,E,n,e,void 0,w.density),y(E)}else{const E=new Array;for(let B=0;B<L.children.length;B++){const P=L.children[B];if(P.isMesh===!0){const k=P.geometry;kr.assignLODInformation(i.url,k,n,e,B,w.density),E.push(k)}}return y(E)}}else Un&&console.warn("Could not find mesh with guid",m.guid,_.parser.json)}return y(null)});return this.previouslyLoaded.set(u,g),await g}else if(s instanceof zr){t&&console.log("Load texture from uri: "+d);const f=await new vne().loadAsync(d);return f?(f.guid=r.guid,f.flipY=!1,f.needsUpdate=!0,f.colorSpace=s.colorSpace,t&&console.log(r,f)):Un&&console.warn("failed loading",d),f}}else Un&&console.warn(`Can not load LOD ${e}: no LOD info found for "${n}" ${s.name}`,s.type);return null}static assignLODInformation(s,e,t,i,n,r){if(!e)return;e.userData||(e.userData={});const o=new mLe(s,t,i,n,r);e.userData.LODS=o}static getAssignedLODInformation(s){var e;return((e=s==null?void 0:s.userData)==null?void 0:e.LODS)||null}static copySettings(s,e){return e=e.clone(),Un&&console.warn(`Copying texture settings
`,s.uuid,`
`,e.uuid),e.offset=s.offset,e.repeat=s.repeat,e.colorSpace=s.colorSpace,e.magFilter=s.magFilter,e.minFilter=s.minFilter,e.wrapS=s.wrapS,e.wrapT=s.wrapT,e.flipY=s.flipY,e.anisotropy=s.anisotropy,e.mipmaps||(e.generateMipmaps=s.generateMipmaps),e}};let Ni=kr;Ni.registerTexture=(s,e,t,i,n)=>{if(Un&&console.log("> Progressive: register texture",i,e.name,e.uuid,e,n),!e){Un&&console.error("gltf-progressive: Register texture without texture");return}e.source&&(e.source[ZV]=n);const r=n.guid;kr.assignLODInformation(s,e,r,t,i,void 0),kr.lodInfos.set(r,n),kr.lowresCache.set(r,e)};Ni.registerMesh=(s,e,t,i,n,r)=>{var l;Un&&console.log("> Progressive: register mesh",n,t.name,r,t.uuid,t);const o=t.geometry;if(!o){Un&&console.warn("gltf-progressive: Register mesh without geometry");return}o.userData||(o.userData={}),kr.assignLODInformation(s,o,e,i,n,r.density),kr.lodInfos.set(e,r);let a=kr.lowresCache.get(e);a?a.push(t.geometry):a=[t.geometry],kr.lowresCache.set(e,a),i>0&&!rM(t)&&pLe(t,o);for(const c of If)(l=c.onRegisteredNewMesh)==null||l.call(c,t,r)};Ni.lodInfos=new Map;Ni.previouslyLoaded=new Map;Ni.lowresCache=new Map;class mLe{constructor(e,t,i,n,r){this.url=e,this.key=t,this.level=i,n!=null&&(this.index=n),r!=null&&(this.density=r)}}var Une=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)},zn=(s,e,t)=>(Une(s,e,"read from private field"),t?t.call(s):e.get(s)),wg=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},Ru=(s,e,t,i)=>(Une(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t),Wa,xf,HV,lb,lC,IR,vf;const oh=sM("debugprogressive"),gLe=sM("noprogressive"),MN=Symbol("Needle:LODSManager"),IN=Symbol("Needle:LODState"),Ry=Symbol("Needle:CurrentLOD"),ah={mesh_lod:-1,texture_lod:-1},gc=class{constructor(s,e){this.projectionScreenMatrix=new Qi,this.targetTriangleDensity=2e5,this.updateInterval="auto",wg(this,Wa,1),this.pause=!1,this.manual=!1,this._lodchangedlisteners=[],wg(this,xf,void 0),wg(this,HV,new qEe),wg(this,lb,0),wg(this,lC,0),wg(this,IR,0),wg(this,vf,0),this._fpsBuffer=[60,60,60,60,60],this._sphere=new Oh,this._tempBox=new Dh,this._tempBox2=new Dh,this.tempMatrix=new Qi,this._tempWorldPosition=new _e,this._tempBoxSize=new _e,this._tempBox2Size=new _e,this.renderer=s,this.context={...e}}static getObjectLODState(s){return s[IN]}static addPlugin(s){If.push(s)}static removePlugin(s){const e=If.indexOf(s);e>=0&&If.splice(e,1)}static get(s,e){if(s[MN])return console.debug("[gltf-progressive] LODsManager already exists for this renderer"),s[MN];const t=new gc(s,{engine:"unknown",...e});return s[MN]=t,t}get plugins(){return If}addEventListener(s,e){s==="changed"&&this._lodchangedlisteners.push(e)}removeEventListener(s,e){if(s==="changed"){const t=this._lodchangedlisteners.indexOf(e);t>=0&&this._lodchangedlisteners.splice(t,1)}}enable(){if(zn(this,xf))return;console.debug("[gltf-progressive] Enabling LODsManager for renderer");let s=0;Ru(this,xf,this.renderer.render);const e=this;cP(this.renderer),this.renderer.render=function(t,i){const n=e.renderer.getRenderTarget();(n==null||"isXRRenderTarget"in n&&n.isXRRenderTarget)&&(s=0,Ru(e,lb,zn(e,lb)+1),Ru(e,lC,zn(e,HV).getDelta()),Ru(e,IR,zn(e,IR)+zn(e,lC)),e._fpsBuffer.shift(),e._fpsBuffer.push(1/zn(e,lC)),Ru(e,vf,e._fpsBuffer.reduce((o,a)=>o+a)/e._fpsBuffer.length),oh&&zn(e,lb)%200===0&&console.log("FPS",Math.round(zn(e,vf)),"Interval:",zn(e,Wa)));const r=s++;zn(e,xf).call(this,t,i),e.onAfterRender(t,i,r)}}disable(){zn(this,xf)&&(console.debug("[gltf-progressive] Disabling LODsManager for renderer"),this.renderer.render=zn(this,xf),Ru(this,xf,void 0))}update(s,e){this.internalUpdate(s,e)}onAfterRender(s,e,t){if(this.pause)return;const n=this.renderer.renderLists.get(s,0).opaque;let r=!0;if(n.length===1){const o=n[0].material;(o.name==="EffectMaterial"||o.name==="CopyShader")&&(r=!1)}if((e.parent&&e.parent.type==="CubeCamera"||t>=1&&e.type==="OrthographicCamera")&&(r=!1),r){if(gLe||(this.updateInterval==="auto"?zn(this,vf)<40&&zn(this,Wa)<10?(Ru(this,Wa,zn(this,Wa)+1),oh&&console.warn("↓ Reducing LOD updates",zn(this,Wa),zn(this,vf).toFixed(0))):zn(this,vf)>=60&&zn(this,Wa)>1&&(Ru(this,Wa,zn(this,Wa)-1),oh&&console.warn("↑ Increasing LOD updates",zn(this,Wa),zn(this,vf).toFixed(0))):Ru(this,Wa,this.updateInterval),zn(this,Wa)>0&&zn(this,lb)%zn(this,Wa)!=0))return;this.internalUpdate(s,e)}}internalUpdate(s,e){var a,l;const t=this.renderer.renderLists.get(s,0),i=t.opaque;this.projectionScreenMatrix.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);const n=this.targetTriangleDensity;for(const c of i){if(c.material&&(((a=c.geometry)==null?void 0:a.type)==="BoxGeometry"||((l=c.geometry)==null?void 0:l.type)==="BufferGeometry")&&(c.material.name==="SphericalGaussianBlur"||c.material.name=="BackgroundCubeMaterial"||c.material.name==="CubemapFromEquirect"||c.material.name==="EquirectangularToCubeUV")){oh&&(c.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]||(c.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]=!0,console.warn("Ignoring skybox or BLIT object",c,c.material.name,c.material.type)));continue}switch(c.material.type){case"LineBasicMaterial":case"LineDashedMaterial":case"PointsMaterial":case"ShadowMaterial":case"MeshDistanceMaterial":case"MeshDepthMaterial":continue}if(oh==="color"&&c.material&&!c.object.progressive_debug_color){c.object.progressive_debug_color=!0;const d=Math.random()*16777215,u=new lP({color:d});c.object.material=u}const h=c.object;(h instanceof Qf||h.isMesh)&&this.updateLODs(s,e,h,n)}const r=t.transparent;for(const c of r){const h=c.object;(h instanceof Qf||h.isMesh)&&this.updateLODs(s,e,h,n)}const o=t.transmissive;for(const c of o){const h=c.object;(h instanceof Qf||h.isMesh)&&this.updateLODs(s,e,h,n)}}updateLODs(s,e,t,i){var o,a;t.userData||(t.userData={});let n=t[IN];if(n||(n=new ALe,t[IN]=n),n.frames++<2)return;for(const l of If)(o=l.onBeforeUpdateLOD)==null||o.call(l,this.renderer,s,e,t);this.calculateLodLevel(e,t,n,i,ah),ah.mesh_lod=Math.round(ah.mesh_lod),ah.texture_lod=Math.round(ah.texture_lod),ah.mesh_lod>=0&&this.loadProgressiveMeshes(t,ah.mesh_lod);let r=ah.texture_lod;if(t.material&&r>=0){const l=t["DEBUG:LOD"];l!=null&&(r=l),this.loadProgressiveTextures(t.material,r)}for(const l of If)(a=l.onAfterUpdatedLOD)==null||a.call(l,this.renderer,s,e,t,ah);n.lastLodLevel_Mesh=ah.mesh_lod,n.lastLodLevel_Texture=ah.texture_lod}loadProgressiveTextures(s,e){if(!s)return;if(Array.isArray(s)){for(const i of s)this.loadProgressiveTextures(i,e);return}let t=!1;(s[Ry]===void 0||e<s[Ry])&&(t=!0),t&&(s[Ry]=e,Ni.assignTextureLOD(s,e).then(i=>{this._lodchangedlisteners.forEach(n=>n({type:"texture",level:e,object:s}))}))}loadProgressiveMeshes(s,e){if(!s)return Promise.resolve(null);if(s[Ry]!==e){s[Ry]=e;const t=s.geometry;return Ni.assignMeshLOD(s,e).then(i=>(i&&s[Ry]==e&&t!=s.geometry&&this._lodchangedlisteners.forEach(n=>n({type:"mesh",level:e,object:s})),i))}return Promise.resolve(null)}static isInside(s,e){const t=s.min,i=s.max,n=(t.x+i.x)*.5,r=(t.y+i.y)*.5;return this._tempPtInside.set(n,r,t.z).applyMatrix4(e).z<0}calculateLodLevel(s,e,t,i,n){var g;if(!e){n.mesh_lod=-1,n.texture_lod=-1;return}if(!s){n.mesh_lod=-1,n.texture_lod=-1;return}let o=10+1,a=!1;if(oh&&e["DEBUG:LOD"]!=null)return e["DEBUG:LOD"];const l=Ni.getMeshLODInformation(e.geometry),c=l==null?void 0:l.lods,h=c&&c.length>0,d=Ni.getMaterialMinMaxLODsCount(e.material),u=(d==null?void 0:d.min_count)!=1/0&&d.min_count>0&&d.max_count>0;if(!h&&!u){n.mesh_lod=0,n.texture_lod=0;return}h||(a=!0,o=0);const f=this.renderer.domElement.clientHeight||this.renderer.domElement.height;let m=e.geometry.boundingBox;if(e.type==="SkinnedMesh"){const A=e;if(!A.boundingBox)A.computeBoundingBox();else if(t.frames%30===0){const y=rM(A),b=A.geometry;y&&(A.geometry=y),A.computeBoundingBox(),A.geometry=b}m=A.boundingBox}if(m&&s.isPerspectiveCamera){const A=s;if(e.geometry.attributes.color&&e.geometry.attributes.color.count<100&&e.geometry.boundingSphere){this._sphere.copy(e.geometry.boundingSphere),this._sphere.applyMatrix4(e.matrixWorld);const L=s.getWorldPosition(this._tempWorldPosition);if(this._sphere.containsPoint(L)){n.mesh_lod=0,n.texture_lod=0;return}}if(this._tempBox.copy(m),this._tempBox.applyMatrix4(e.matrixWorld),gc.isInside(this._tempBox,this.projectionScreenMatrix)){n.mesh_lod=0,n.texture_lod=0;return}if(this._tempBox.applyMatrix4(this.projectionScreenMatrix),this.renderer.xr.enabled&&A.fov>70){const L=this._tempBox.min,w=this._tempBox.max;let E=L.x,B=L.y,P=w.x,k=w.y;const X=2,F=1.5,H=(L.x+w.x)*.5,W=(L.y+w.y)*.5;E=(E-H)*X+H,B=(B-W)*X+W,P=(P-H)*X+H,k=(k-W)*X+W;const se=E<0&&P>0?0:Math.min(Math.abs(L.x),Math.abs(w.x)),de=B<0&&k>0?0:Math.min(Math.abs(L.y),Math.abs(w.y)),be=Math.max(se,de);t.lastCentrality=(F-be)*(F-be)*(F-be)}else t.lastCentrality=1;const y=this._tempBox.getSize(this._tempBoxSize);y.multiplyScalar(.5),screen.availHeight>0&&f>0&&y.multiplyScalar(f/screen.availHeight),y.x*=A.aspect;const b=s.matrixWorldInverse,x=this._tempBox2;x.copy(m),x.applyMatrix4(e.matrixWorld),x.applyMatrix4(b);const v=x.getSize(this._tempBox2Size),_=Math.max(v.x,v.y);if(Math.max(y.x,y.y)!=0&&_!=0&&(y.z=v.z/Math.max(v.x,v.y)*Math.max(y.x,y.y)),t.lastScreenCoverage=Math.max(y.x,y.y,y.z),t.lastScreenspaceVolume.copy(y),t.lastScreenCoverage*=t.lastCentrality,oh&&gc.debugDrawLine){const L=this.tempMatrix.copy(this.projectionScreenMatrix);L.invert();const w=gc.corner0,E=gc.corner1,B=gc.corner2,P=gc.corner3;w.copy(this._tempBox.min),E.copy(this._tempBox.max),E.x=w.x,B.copy(this._tempBox.max),B.y=w.y,P.copy(this._tempBox.max);const k=(w.z+P.z)*.5;w.z=E.z=B.z=P.z=k,w.applyMatrix4(L),E.applyMatrix4(L),B.applyMatrix4(L),P.applyMatrix4(L),gc.debugDrawLine(w,E,255),gc.debugDrawLine(w,B,255),gc.debugDrawLine(E,P,255),gc.debugDrawLine(B,P,255)}let S=999;if(c&&t.lastScreenCoverage>0){for(let L=0;L<c.length;L++)if(c[L].density/t.lastScreenCoverage<i){S=L;break}}S<o&&(o=S,a=!0)}if(a?n.mesh_lod=o:n.mesh_lod=t.lastLodLevel_Mesh,oh&&n.mesh_lod!=t.lastLodLevel_Mesh){const y=c==null?void 0:c[n.mesh_lod];y&&console.log(`Mesh LOD changed: ${t.lastLodLevel_Mesh} → ${n.mesh_lod} (${y.density.toFixed(0)}) - ${e.name}`)}if(u){const A="saveData"in globalThis.navigator&&globalThis.navigator.saveData===!0;if(t.lastLodLevel_Texture<0){if(n.texture_lod=d.max_count-1,oh){const y=d.lods[d.max_count-1];oh&&console.log(`First Texture LOD ${n.texture_lod} (${y.max_height}px) - ${e.name}`)}}else{const y=t.lastScreenspaceVolume.x+t.lastScreenspaceVolume.y+t.lastScreenspaceVolume.z;let b=t.lastScreenCoverage*4;((g=this.context)==null?void 0:g.engine)==="model-viewer"&&(b*=1.5);const v=f/window.devicePixelRatio*b;for(let _=d.lods.length-1;_>=0;_--){let C=d.lods[_];if(!(A&&C.max_height>=2048)&&!(uLe()&&C.max_height>4096)&&C.max_height>v){if(n.texture_lod=_,n.texture_lod<t.lastLodLevel_Texture){const S=C.max_height;oh&&console.log(`Texture LOD changed: ${t.lastLodLevel_Texture} → ${n.texture_lod} = ${S}px 
Screensize: ${v.toFixed(0)}px, Coverage: ${(100*t.lastScreenCoverage).toFixed(2)}%, Volume ${y.toFixed(1)} 
${e.name}`)}break}}}}else n.texture_lod=0}};let kl=gc;Wa=new WeakMap;xf=new WeakMap;HV=new WeakMap;lb=new WeakMap;lC=new WeakMap;IR=new WeakMap;vf=new WeakMap;kl.corner0=new _e;kl.corner1=new _e;kl.corner2=new _e;kl.corner3=new _e;kl._tempPtInside=new _e;class ALe{constructor(){this.frames=0,this.lastLodLevel_Mesh=-1,this.lastLodLevel_Texture=-1,this.lastScreenCoverage=0,this.lastScreenspaceVolume=new _e,this.lastCentrality=0}}const l4=Symbol("NEEDLE_mesh_lod"),zT=Symbol("NEEDLE_texture_lod");let y_=null;function Xne(){const s=yLe();s&&(s.mapURLs(function(e){return c4(),e}),c4(),y_==null||y_.disconnect(),y_=new MutationObserver(e=>{e.forEach(t=>{t.addedNodes.forEach(i=>{i instanceof HTMLElement&&i.tagName.toLowerCase()==="model-viewer"&&One(i)})})}),y_.observe(document,{childList:!0,subtree:!0}))}function yLe(){if(typeof customElements>"u")return null;const s=customElements.get("model-viewer");return s||(customElements.whenDefined("model-viewer").then(()=>{console.debug("[gltf-progressive] model-viewer defined"),Xne()}),null)}function c4(){if(typeof document>"u")return;document.querySelectorAll("model-viewer").forEach(e=>{One(e)})}const h4=new WeakSet;let bLe=0;function One(s){if(!s||h4.has(s))return null;h4.add(s),console.debug("[gltf-progressive] found new model-viewer..."+ ++bLe+`
`,s.getAttribute("src"));let e=null,t=null,i=null;for(let n=s;n!=null;n=Object.getPrototypeOf(n)){const r=Object.getOwnPropertySymbols(n),o=r.find(c=>c.toString()=="Symbol(renderer)"),a=r.find(c=>c.toString()=="Symbol(scene)"),l=r.find(c=>c.toString()=="Symbol(needsRender)");!e&&o!=null&&(e=s[o].threeRenderer),!t&&a!=null&&(t=s[a]),!i&&l!=null&&(i=s[l])}if(e&&t){let n=function(){if(i){let o=0,a=setInterval(()=>{if(o++>5){clearInterval(a);return}i==null||i.call(s)},300)}};console.debug("[gltf-progressive] setup model-viewer");const r=kl.get(e,{engine:"model-viewer"});return kl.addPlugin(new xLe),r.enable(),r.addEventListener("changed",()=>{i==null||i.call(s)}),s.addEventListener("model-visibility",o=>{o.detail.visible&&(i==null||i.call(s))}),s.addEventListener("load",()=>{n()}),()=>{r.disable()}}return null}class xLe{constructor(){this._didWarnAboutMissingUrl=!1}onBeforeUpdateLOD(e,t,i,n){this.tryParseMeshLOD(t,n),this.tryParseTextureLOD(t,n)}getUrl(e){if(!e)return null;let t=e.getAttribute("src");return t||(t=e.src),t||(this._didWarnAboutMissingUrl||console.warn("No url found in modelviewer",e),this._didWarnAboutMissingUrl=!0),t}tryGetCurrentGLTF(e){return e._currentGLTF}tryGetCurrentModelViewer(e){return e.element}tryParseTextureLOD(e,t){if(t[zT]==!0)return;t[zT]=!0;const i=this.tryGetCurrentGLTF(e),n=this.tryGetCurrentModelViewer(e),r=this.getUrl(n);if(r&&i&&t.material){let o=function(l){var h,d,u;if(l[zT]==!0)return;l[zT]=!0,l.userData&&(l.userData.LOD=-1);const c=Object.keys(l);for(let f=0;f<c.length;f++){const m=c[f],g=l[m];if((g==null?void 0:g.isTexture)===!0){const A=(d=(h=g.userData)==null?void 0:h.associations)==null?void 0:d.textures;if(A==null)continue;const y=i.parser.json.textures[A];if(!y){console.warn("Texture data not found for texture index "+A);continue}if((u=y==null?void 0:y.extensions)!=null&&u[ju]){const b=y.extensions[ju];b&&r&&Ni.registerTexture(r,g,b.lods.length,A,b)}}}};const a=t.material;if(Array.isArray(a))for(const l of a)o(l);else o(a)}}tryParseMeshLOD(e,t){var o,a;if(t[l4]==!0)return;t[l4]=!0;const i=this.tryGetCurrentModelViewer(e),n=this.getUrl(i);if(!n)return;const r=(a=(o=t.userData)==null?void 0:o.gltfExtensions)==null?void 0:a[ju];if(r&&n){const l=t.uuid;Ni.registerMesh(n,l,t,0,r.lods.length,r)}}}Xne();const Ex=[];function hP(s){Ex.indexOf(s)===-1&&Ex.push(s)}function vLe(s){const e=Ex.indexOf(s);e!==-1&&Ex.splice(e,1)}const Rx=[];function OO(s){Rx.indexOf(s)===-1&&Rx.push(s)}function _Le(s){const e=Rx.indexOf(s);e!==-1&&Rx.splice(e,1)}function Zne(s){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-start",{detail:s}));for(let e=0;e<Ex.length;e++)Ex[e](s)}function Wne(s){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-end",{detail:s}));for(let e=0;e<Rx.length;e++)Rx[e](s)}const Gr={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function Hne(s){const e=await fetch(s);if(e.ok)return e.json();throw new Error(e.statusText)}async function CLe(s){if(!s)throw new Error("No basePath supplied");return await Hne(`${s}/profilesList.json`)}async function wLe(s,e,t=null,i=!0){if(!s)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const n=await CLe(e);let r;if(s.profiles.some(l=>{const c=n[l];return c&&(r={profileId:l,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}),!!r}),!r){if(!t)throw new Error("No matching profile name found");const l=n[t];if(!l)throw new Error(`No matching profile name found and default profile "${t}" missing.`);r={profileId:t,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}}const o=await Hne(r.profilePath);let a;if(i){let l;if(s.handedness==="any"?l=o.layouts[Object.keys(o.layouts)[0]]:l=o.layouts[s.handedness],!l)throw new Error(`No matching handedness, ${s.handedness}, in profile ${r.profileId}`);l.assetPath&&(a=r.profilePath.replace("profile.json",l.assetPath))}return{profile:o,assetPath:a}}const SLe={xAxis:0,yAxis:0,button:0,state:Gr.ComponentState.DEFAULT};function MLe(s=0,e=0){let t=s,i=e;if(Math.sqrt(s*s+e*e)>1){const o=Math.atan2(e,s);t=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:i*.5+.5}}let ILe=class{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Gr.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(SLe)}updateFromComponent({xAxis:e,yAxis:t,button:i,state:n}){const{normalizedXAxis:r,normalizedYAxis:o}=MLe(e,t);switch(this.componentProperty){case Gr.ComponentProperty.X_AXIS:this.value=this.states.includes(n)?r:.5;break;case Gr.ComponentProperty.Y_AXIS:this.value=this.states.includes(n)?o:.5;break;case Gr.ComponentProperty.BUTTON:this.value=this.states.includes(n)?i:0;break;case Gr.ComponentProperty.STATE:this.valueNodeProperty===Gr.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(n):this.value=this.states.includes(n)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},TLe=class{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(i=>{const n=new ILe(t.visualResponses[i]);this.visualResponses[i]=n}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:Gr.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=Gr.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=Gr.ComponentState.PRESSED:(t.touched||this.values.button>Gr.ButtonTouchThreshold)&&(this.values.state=Gr.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Gr.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Gr.AxisTouchThreshold&&(this.values.state=Gr.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Gr.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Gr.AxisTouchThreshold&&(this.values.state=Gr.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}},ELe=class{constructor(e,t,i){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=i,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(n=>{const r=this.layoutDescription.components[n];this.components[n]=new TLe(n,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}};const ur=ee("debuginput");var dP=(s=>(s.Mouse="mouse",s.Touch="touch",s.Controller="controller",s.Hand="hand",s))(dP||{}),es=(s=>(s.PointerDown="pointerdown",s.PointerUp="pointerup",s.PointerMove="pointermove",s.KeyDown="keydown",s.KeyUp="keyup",s.KeyPressed="keypress",s))(es||{});class Wu extends PointerEvent{constructor(t,i,n){super(t,n);p(this,"clientZ");p(this,"deviceIndex");p(this,"origin");p(this,"source");p(this,"mode");p(this,"_ray");p(this,"space");p(this,"isClick",!1);p(this,"isDoubleClick",!1);p(this,"_used",!1);p(this,"_pointerid");p(this,"_pointerType");p(this,"_type");p(this,"metadata",{});p(this,"intersections",new Array);p(this,"_immediatePropagationStopped",!1);p(this,"_propagationStopped",!1);this.clientZ=n.clientZ,this._pointerid=n.pointerId,this._pointerType=n.pointerType,this._type=t,this.deviceIndex=n.deviceIndex,this.origin=n.origin,this.source=i,this.mode=n.mode,this._ray=n.ray,this.space=n.device}get isSpatial(){return this.mode!="screen"}get ray(){return this._ray||(this._ray=new Fa(this.space.worldPosition.clone(),this.space.worldForward.clone())),this._ray}set ray(t){this._ray=t}get hasRay(){return this._ray!==void 0}get used(){return this._used}use(){this._used=!0}get pointerId(){return this._pointerid}get pointerType(){return this._pointerType}get type(){return this._type}get immediatePropagationStopped(){return this._immediatePropagationStopped}get propagationStopped(){return this._immediatePropagationStopped||this._propagationStopped}stopImmediatePropagation(){var t;this._immediatePropagationStopped=!0,super.stopImmediatePropagation(),(t=this.source)==null||t.stopImmediatePropagation()}stopPropagation(){var t;this._propagationStopped=!0,super.stopPropagation(),(t=this.source)==null||t.stopPropagation(),ur&&console.warn("Stop propagation...",this.pointerId,this.pointerType)}}class cC extends KeyboardEvent{constructor(t,i,n){super(t,n);p(this,"source");this.source=i}stopImmediatePropagation(){var t;super.stopImmediatePropagation(),(t=this.source)==null||t.stopImmediatePropagation()}}class RLe{constructor(e){p(this,"key");p(this,"keyType");p(this,"source");this.key=e.key,this.keyType=e.type,this.source=e}}var Nl=(s=>(s[s.Early=-100]="Early",s[s.Default=0]="Default",s[s.Late=100]="Late",s))(Nl||{});class Qne{constructor(e){p(this,"_eventListeners",{});p(this,"_doubleClickTimeThreshold",.2);p(this,"_longPressTimeThreshold",1);p(this,"_specialCursorTrigger",0);p(this,"context");p(this,"_pointerDown",[!1]);p(this,"_pointerUp",[!1]);p(this,"_pointerClick",[!1]);p(this,"_pointerDoubleClick",[!1]);p(this,"_pointerPressed",[!1]);p(this,"_pointerPositions",[new Q]);p(this,"_pointerPositionsLastFrame",[new Q]);p(this,"_pointerPositionsDelta",[new Q]);p(this,"_pointerPositionsRC",[new Q]);p(this,"_pointerPositionDown",[new T]);p(this,"_pointerDownTime",[]);p(this,"_pointerUpTime",[]);p(this,"_pointerUpTimestamp",[]);p(this,"_pointerIds",[]);p(this,"_pointerTypes",[""]);p(this,"_mouseWheelChanged",[!1]);p(this,"_mouseWheelDeltaY",[0]);p(this,"_pointerEvent",[]);p(this,"_pointerEventsPressed",[]);p(this,"_pointerSpace",[]);p(this,"_pressedStack",new Map);p(this,"_htmlEventSource");p(this,"onLostFocus",()=>{for(const e in this.keysPressed)this.keysPressed[e].pressed=!1});p(this,"onEndOfFrame",()=>{for(let e=0;e<this._pointerUp.length;e++)this._pointerUp[e]=!1;for(let e=0;e<this._pointerDown.length;e++)this._pointerDown[e]=!1;for(let e=0;e<this._pointerClick.length;e++)this._pointerClick[e]=!1;for(let e=0;e<this._pointerDoubleClick.length;e++)this._pointerDoubleClick[e]=!1;for(const e of this._pointerPositionsDelta)e.set(0,0);for(let e=0;e<this._mouseWheelChanged.length;e++)this._mouseWheelChanged[e]=!1;for(let e=0;e<this._mouseWheelDeltaY.length;e++)this._mouseWheelDeltaY[e]=0});p(this,"onContextMenu",e=>{this.canReceiveInput(e)!==!1&&e instanceof PointerEvent&&e.pointerType});p(this,"keysPressed",{});p(this,"onKeyDown",e=>{if(ur&&console.log(`key down ${e.code}, ${this.context.application.hasFocus}`,e),!this.context.application.hasFocus)return;const t=this.keysPressed[e.code];if(t&&t.pressed)return;this.keysPressed[e.code]={pressed:!0,frame:this.context.time.frameCount+1,startFrame:this.context.time.frameCount+1,key:e.key,code:e.code};const i=new cC("keydown",e,e);this.onDispatchEvent(i)});p(this,"onKeyPressed",e=>{if(!this.context.application.hasFocus)return;const t=this.keysPressed[e.code];if(!t)return;t.pressed=!0,t.frame=this.context.time.frameCount+1;const i=new cC("keypress",e,e);this.onDispatchEvent(i)});p(this,"onKeyUp",e=>{if(!this.context.application.hasFocus)return;const t=this.keysPressed[e.code];if(!t)return;t.pressed=!1,t.frame=this.context.time.frameCount+1;const i=new cC("keyup",e,e);this.onDispatchEvent(i)});p(this,"onWheelWindow",e=>{document.pointerLockElement&&this.onMouseWheel(e)});p(this,"onMouseWheel",e=>{if(this.canReceiveInput(e)===!1)return;this._mouseWheelDeltaY.length<=0&&this._mouseWheelDeltaY.push(0),this._mouseWheelChanged.length<=0&&this._mouseWheelChanged.push(!1),this._mouseWheelChanged[0]=!0;const t=this._mouseWheelDeltaY[0];this._mouseWheelDeltaY[0]=t+e.deltaY});p(this,"onPointerDown",e=>{if(this.context.isInAR||this.canReceiveInput(e)===!1)return;e.target instanceof HTMLElement&&e.target.setPointerCapture(e.pointerId);const t=this.getPointerId(e);ur&&is(`pointer down #${t}, identifier:${e.pointerId}`);const i=this.getAndUpdateSpatialObjectForScreenPosition(t,e.clientX,e.clientY),n=new Wu("pointerdown",e,{origin:this,mode:"screen",deviceIndex:0,pointerId:t,button:e.button,clientX:e.clientX,clientY:e.clientY,pointerType:e.pointerType,buttonName:this.getButtonName(e),device:i,pressure:e.pressure});this.onDown(n)});p(this,"onPointerMove",e=>{if(this.context.isInAR)return;let t=e.button;e.pointerType==="mouse"&&(t=this.getFirstPressedButtonForPointer(0)??0);const i=this.getPointerId(e,t);t===-1&&(t=i);const n=this.getAndUpdateSpatialObjectForScreenPosition(i,e.clientX,e.clientY),r=new Wu("pointermove",e,{origin:this,mode:"screen",deviceIndex:0,pointerId:i,button:t,clientX:e.clientX,clientY:e.clientY,pointerType:e.pointerType,buttonName:this.getButtonName(e),device:n,pressure:e.pressure});this.onMove(r)});p(this,"onPointerCancel",e=>{this.context.isInAR||(ur&&console.log("Pointer cancel",e),this.onPointerUp(e))});p(this,"onPointerUp",e=>{if(this.context.isInAR)return;e.target instanceof HTMLElement&&e.target.releasePointerCapture(e.pointerId);const t=this.getPointerId(e),i=new Wu("pointerup",e,{origin:this,mode:"screen",deviceIndex:0,pointerId:t,button:e.button,clientX:e.clientX,clientY:e.clientY,pointerType:e.pointerType,buttonName:this.getButtonName(e),device:this.getAndUpdateSpatialObjectForScreenPosition(t,e.clientX,e.clientY),pressure:e.pressure});this.onUp(i),this._pointerIds[t]=-1,ur&&console.log("ID="+t,"PointerId="+e.pointerId,"ALL:",[...this._pointerIds])});p(this,"onTouchStart",e=>{if(this.context.isInAR)for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t],n=this.getPointerIndex(i.identifier),r=this.getAndUpdateSpatialObjectForScreenPosition(n,i.clientX,i.clientY),o=new Wu("pointerdown",e,{origin:this,mode:"screen",deviceIndex:0,pointerId:n,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:"touch",buttonName:"unknown",device:r,pressure:i.force});this.onDown(o)}});p(this,"onTouchMove",e=>{if(this.context.isInAR)for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t],n=this.getPointerIndex(i.identifier),r=this.getAndUpdateSpatialObjectForScreenPosition(n,i.clientX,i.clientY),o=new Wu("pointermove",e,{origin:this,mode:"screen",deviceIndex:0,pointerId:n,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:"touch",buttonName:"unknown",device:r,pressure:i.force});this.onMove(o)}});p(this,"onTouchEnd",e=>{if(this.context.isInAR)for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t],n=this.getPointerIndex(i.identifier),r=new Wu("pointerup",e,{origin:this,mode:"screen",deviceIndex:0,pointerId:n,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:"touch",buttonName:"unknown",device:this.getAndUpdateSpatialObjectForScreenPosition(n,i.clientX,i.clientY),pressure:i.force});this.onUp(r),this._pointerIds[n]=-1}});p(this,"tempNearPlaneVector",new T);p(this,"tempFarPlaneVector",new T);p(this,"tempLookMatrix",new ce);this.context=e,this.context.post_render_callbacks.push(this.onEndOfFrame)}addEventListener(e,t,i){if(this._eventListeners[e]||(this._eventListeners[e]=[]),!t||typeof t!="function"){console.error("Invalid call to addEventListener: callback is required and must be a function!");return}i?i={...i}:i={};let n=0;(i==null?void 0:i.queue)!=null&&(n=i.queue);const r=this._eventListeners[e],o=r.find(a=>a.priority===n);o?o.listeners.push({callback:t,options:i}):(r.push({priority:n,listeners:[{callback:t,options:i}]}),r.sort((a,l)=>a.priority-l.priority))}removeEventListener(e,t,i){if(!this._eventListeners[e]||!t)return;const n=this._eventListeners[e];if((i==null?void 0:i.queue)!=null){const r=n.find(a=>a.priority===i.queue);if(!r)return;const o=r.listeners.findIndex(a=>a.callback===t);o>=0&&r.listeners.splice(o,1)}else for(const r of n){const o=r.listeners.findIndex(a=>a.callback===t);o>=0&&r.listeners.splice(o,1)}}dispatchEvent(e){var i,n,r,o;let t=!1;if(e instanceof cC){const a=this._eventListeners[e.type];if(a)for(const l of a)for(let c=0;c<l.listeners.length;c++){const h=l.listeners[c];if((n=(i=h.options)==null?void 0:i.signal)!=null&&n.aborted){l.listeners.splice(c,1),c--;continue}h.options.once&&(l.listeners.splice(c,1),c--),h.callback(e)}}if(e instanceof Wu){const a=this._eventListeners[e.type];if(a)for(const l of a){if(t)break;for(let c=0;c<l.listeners.length;c++){const h=l.listeners[c];if((o=(r=h.options)==null?void 0:r.signal)!=null&&o.aborted){l.listeners.splice(c,1),c--;continue}if(e.immediatePropagationStopped){t=!0,ur&&console.log("immediatePropagationStopped",e.type);break}else e.propagationStopped&&(t=!0,ur&&console.log("propagationStopped",e.type));h.options.once&&(l.listeners.splice(c,1),c--),h.callback(e)}}}}get mousePosition(){return this._pointerPositions[0]}get mousePositionRC(){return this._pointerPositionsRC[0]}get mouseDown(){return this._pointerDown[0]}get mouseUp(){return this._pointerUp[0]}get mouseClick(){return this._pointerClick[0]}get mouseDoubleClick(){return this._pointerDoubleClick[0]}get mousePressed(){return this._pointerPressed[0]}get mouseWheelChanged(){return this.getMouseWheelChanged(0)}get click(){return this._pointerClick[0]}get doubleClick(){return this._pointerDoubleClick[0]}setCursorPointer(){this._specialCursorTrigger+=1,this.context.domElement.style.cursor="pointer"}setCursorNormal(){this._specialCursorTrigger-=1,this._specialCursorTrigger=Math.max(0,this._specialCursorTrigger),this._specialCursorTrigger===0&&(this.context.domElement.style.cursor="default")}getIsPointerIdInUse(e){for(const t of this._pointerEventsPressed)if(t.pointerId===e&&t.used)return!0;return!1}getPointerPressedCount(){let e=0;for(let t=0;t<this._pointerPressed.length;t++)this._pointerPressed[t]&&e++;return e}getPointerPosition(e){return e>=this._pointerPositions.length?null:this._pointerPositions[e]}getPointerPositionLastFrame(e){return e>=this._pointerPositionsLastFrame.length?null:this._pointerPositionsLastFrame[e]}getPointerPositionDelta(e){return e>=this._pointerPositionsDelta.length?null:this._pointerPositionsDelta[e]}getPointerPositionRC(e){return e>=this._pointerPositionsRC.length?null:this._pointerPositionsRC[e]}getPointerDown(e){return e>=this._pointerDown.length?!1:this._pointerDown[e]}getPointerUp(e){return e>=this._pointerUp.length?!1:this._pointerUp[e]}getPointerPressed(e){return e>=this._pointerPressed.length?!1:this._pointerPressed[e]}getPointerClicked(e){return e>=this._pointerClick.length?!1:this._pointerClick[e]}getPointerDoubleClicked(e){return e>=this._pointerDoubleClick.length?!1:this._pointerDoubleClick[e]}getPointerDownTime(e){return e>=this._pointerDownTime.length?-1:this._pointerDownTime[e]}getPointerUpTime(e){return e>=this._pointerUpTime.length?-1:this._pointerUpTime[e]}getPointerLongPress(e){return e>=this._pointerDownTime.length?!1:this.getPointerPressed(e)&&this.context.time.time-this._pointerDownTime[e]>this._longPressTimeThreshold}getIsMouse(e){return e<0||e>=this._pointerTypes.length?!1:this._pointerTypes[e]==="mouse"}getIsTouch(e){return e<0||e>=this._pointerTypes.length?!1:this._pointerTypes[e]==="touch"}getTouchesPressedCount(){let e=0;for(let t=0;t<this._pointerPressed.length;t++)this._pointerPressed[t]&&this.getIsTouch(t)&&e++;return e}getMouseWheelChanged(e=0){return e>=this._mouseWheelChanged.length?!1:this._mouseWheelChanged[e]}getMouseWheelDeltaY(e=0){return e>=this._mouseWheelDeltaY.length?0:this._mouseWheelDeltaY[e]}getPointerEvent(e){if(!(e>=this._pointerEvent.length))return this._pointerEvent[e]??void 0}*foreachPointerId(e){for(let t=0;t<this._pointerTypes.length;t++)if(this._pointerIsActive(t)){if(e!==void 0){const i=this._pointerTypes[t];if(Array.isArray(e)){let n=!1;for(const r of e)if(i===r){n=!0;break}if(!n)continue}else if(e!==i)continue}yield t}}*foreachTouchId(){for(let e=0;e<this._pointerTypes.length;e++)this._pointerTypes[e]==="touch"&&this._pointerIsActive[e]&&(yield e)}_pointerIsActive(e){return e<0?!1:this._pointerPressed[e]||this._pointerDown[e]||this._pointerUp[e]}onDownButton(e,t){let i=this._pressedStack.get(e);i||(i=[],this._pressedStack.set(e,i)),i.push(t)}onReleaseButton(e,t){const i=this._pressedStack.get(e);if(!i)return;const n=i.indexOf(t);n>=0&&i.splice(n,1)}getFirstPressedButtonForPointer(e){const t=this._pressedStack.get(e);if(t)return t[0]}getLatestPressedButtonForPointer(e){const t=this._pressedStack.get(e);if(t)return t[t.length-1]}getKeyDown(){for(const e in this.keysPressed){const t=this.keysPressed[e];if(t.startFrame===this.context.time.frameCount)return t.key}return null}getKeyPressed(){for(const e in this.keysPressed){const t=this.keysPressed[e];if(t.pressed)return t.key}return null}isKeyDown(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const t=this.getCodeForCommonKeyName(e);if(t!==null){for(const n of t)if(this.isKeyDown(n))return!0;return!1}return((i=this.keysPressed[e])==null?void 0:i.startFrame)===this.context.time.frameCount&&this.keysPressed[e].pressed}isKeyUp(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const t=this.getCodeForCommonKeyName(e);if(t!==null){for(const n of t)if(this.isKeyUp(n))return!0;return!1}return((i=this.keysPressed[e])==null?void 0:i.frame)===this.context.time.frameCount&&!this.keysPressed[e].pressed}isKeyPressed(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const t=this.getCodeForCommonKeyName(e);if(t!==null){for(const n of t)if(this.isKeyPressed(n))return!0;return!1}return(i=this.keysPressed[e])==null?void 0:i.pressed}getCodeForCommonKeyName(e){if(e.length===1){if(e>="0"&&e<="9")return["Digit"+e];if(e>="a"&&e<="z")return["Key"+e.toUpperCase()];if(e==" ")return["Space"]}switch(e){case"shift":case"Shift":return["ShiftLeft","ShiftRight"];case"control":case"Control":return["ControlLeft","ControlRight"];case"alt":case"Alt":return["AltLeft","AltRight"]}return null}createInputEvent(e){switch(e.type){case"pointerdown":ur&&is("Create Pointer down"),this.onDownButton(e.deviceIndex,e.button),this.onDown(e);break;case"pointermove":ur&&is("Create Pointer move"),this.onMove(e);break;case"pointerup":ur&&is("Create Pointer up"),this.onUp(e),this.onReleaseButton(e.deviceIndex,e.button);break}}convertScreenspaceToRaycastSpace(e){return e.x=(e.x-this.context.domX)/this.context.domWidth*2-1,e.y=-((e.y-this.context.domY)/this.context.domHeight)*2+1,e}bindEvents(){this.unbindEvents(),this._htmlEventSource=this.context.renderer.domElement,window.addEventListener("contextmenu",this.onContextMenu),this._htmlEventSource.addEventListener("pointerdown",this.onPointerDown,{passive:!0}),window.addEventListener("pointermove",this.onPointerMove,{passive:!0,capture:!0}),window.addEventListener("pointerup",this.onPointerUp,{passive:!0}),window.addEventListener("pointercancel",this.onPointerCancel,{passive:!0}),window.addEventListener("touchstart",this.onTouchStart,{passive:!0}),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchEnd,{passive:!0}),this._htmlEventSource.addEventListener("wheel",this.onMouseWheel,{passive:!0}),window.addEventListener("wheel",this.onWheelWindow,{passive:!0}),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keypress",this.onKeyPressed,!1),window.addEventListener("keyup",this.onKeyUp,!1),window.addEventListener("blur",this.onLostFocus)}unbindEvents(){var e,t;window.removeEventListener("contextmenu",this.onContextMenu),(e=this._htmlEventSource)==null||e.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("pointercancel",this.onPointerCancel),(t=this._htmlEventSource)==null||t.removeEventListener("wheel",this.onMouseWheel,!1),window.removeEventListener("wheel",this.onWheelWindow,!1),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keypress",this.onKeyPressed,!1),window.removeEventListener("keyup",this.onKeyUp,!1),window.removeEventListener("blur",this.onLostFocus)}dispose(){const e=this.context.post_render_callbacks.indexOf(this.onEndOfFrame);e>=0&&this.context.post_render_callbacks.splice(e,1),this.unbindEvents()}canReceiveInput(e){var t;return e.target===((t=this.context.renderer)==null?void 0:t.domElement)||e.target===this.context.domElement||this.context.isInAR||this.context.isInAR&&e.target===document.body&&exports.DeviceUtilities.isMozillaXR()?!0:(ur&&console.warn("CanReceiveInput:False for",e.target),!1)}getPointerId(e,t){return e.pointerType==="mouse"?0+(t??e.button):this.getPointerIndex(e.pointerId)}getButtonName(e){const t=e.button;if(e.pointerType==="mouse")switch(t){case 0:return"left";case 1:return"middle";case 2:return"right"}return"unknown"}getAndUpdateSpatialObjectForScreenPosition(e,t,i){let n=this._pointerSpace[e];n||(n=new ye,this._pointerSpace[e]=n),this._pointerSpace[e]=n;const r=this.context.mainCamera;if(r){const o=this.tempNearPlaneVector.set(t,i,-1);this.convertScreenspaceToRaycastSpace(o);const a=this.tempFarPlaneVector.set(o.x,o.y,1);o.unproject(r),a.unproject(r);const l=r.worldUp||St(0,1,0).applyQuaternion(gn(r));this.tempLookMatrix.lookAt(a,o,l),n.position.set(o.x,o.y,o.z),n.quaternion.setFromRotationMatrix(this.tempLookMatrix)}return n}isInRect(e){if(this.context.isInXR)return!0;const t=this.context.domElement.getBoundingClientRect(),i=e.clientX,n=e.clientY,r=i>=t.x&&i<=t.right&&n>=t.y&&n<=t.bottom;return ur&&!r&&console.log("Not in rect",t,i,n),r}onDown(e){const t=e.pointerId;if(this.getPointerPressed(t)&&console.warn(`Received pointerDown for pointerId that is already pressed: ${t}`,ur?e:""),ur&&console.log(e.pointerType,"DOWN",t),!!this.isInRect(e)){for(this.setPointerState(t,this._pointerPressed,!0),this.setPointerState(t,this._pointerDown,!0),this.setPointerStateT(t,this._pointerEvent,e.source);t>=this._pointerTypes.length;)this._pointerTypes.push(e.pointerType);for(this._pointerTypes[t]=e.pointerType;t>=this._pointerPositionDown.length;)this._pointerPositionDown.push(new T);for(this._pointerPositionDown[t].set(e.clientX,e.clientY,e.clientZ??0);t>=this._pointerPositions.length;)this._pointerPositions.push(new Q);this._pointerPositions[t].set(e.clientX,e.clientY),t>=this._pointerDownTime.length&&this._pointerDownTime.push(0),this._pointerDownTime[t]=this.context.time.realtimeSinceStartup,this.updatePointerPosition(e),this._pointerEventsPressed.push(e),this.onDispatchEvent(e)}}onMove(e){const t=e.pointerId,i=this.getPointerPressed(t);i===!1&&!this.isInRect(e)||e.pointerType==="touch"&&!i||(this.updatePointerPosition(e),this.setPointerStateT(t,this._pointerEvent,e.source),this.onDispatchEvent(e))}onUp(e){const t=e.pointerId;if(!this.getPointerPressed(t)){ur&&console.log(e.pointerType,"UP",t,"was not down");return}ur&&console.log(e.pointerType,"UP",t),this.setPointerState(t,this._pointerPressed,!1),this.setPointerStateT(t,this._pointerEvent,e.source),this.setPointerState(t,this._pointerUp,!0),this.updatePointerPosition(e);for(let l=this._pointerEventsPressed.length-1;l>=0;l--)if(this._pointerEventsPressed[l].pointerId===t){this._pointerEventsPressed.splice(l,1);break}if(!this._pointerPositionDown[t]){ur&&An("Received pointer up event without matching down event for button: "+t),console.warn("Received pointer up event without matching down event for button: "+t);return}const n=this._pointerUpTime[t],r=this._pointerDownTime[t],o=this.context.time.realtimeSinceStartup,a=o-r;if(t>=this._pointerUpTime.length&&this._pointerUpTime.push(-99),this._pointerUpTime[t]=o,a<1){let l=e.clientX-this._pointerPositionDown[t].x,c=e.clientY-this._pointerPositionDown[t].y,h=0;if(e.isSpatial&&e.clientZ!=null&&(h=e.clientZ-this._pointerPositionDown[t].z,l*=200,c*=200,h*=200),Math.abs(l)<5&&Math.abs(c)<5&&Math.abs(h)<5){this.setPointerState(t,this._pointerClick,!0),e.isClick=!0;const d=o-n;ur&&console.log("CLICK",t,l,c,h,d),d<this._doubleClickTimeThreshold&&d>0&&(this.setPointerState(t,this._pointerDoubleClick,!0),e.isDoubleClick=!0)}}this.onDispatchEvent(e)}updatePointerPosition(e){const t=e.pointerId;for(;t>=this._pointerPositions.length;)this._pointerPositions.push(new Q);for(;t>=this._pointerPositionsLastFrame.length;)this._pointerPositionsLastFrame.push(new Q);for(;t>=this._pointerPositionsDelta.length;)this._pointerPositionsDelta.push(new Q);const i=this._pointerPositionsLastFrame[t];i.copy(this._pointerPositions[t]);const n=this._pointerPositionsDelta[t];let r=e.clientX-i.x,o=e.clientY-i.y;if(e.source instanceof MouseEvent||e.source instanceof TouchEvent){const h=e.source;r===0&&h.movementX!==0&&(r=h.movementX||0),o===0&&h.movementY!==0&&(o=h.movementY||0)}n.x+=r,n.y+=o,this._pointerPositions[t].x=e.clientX,this._pointerPositions[t].y=e.clientY;const a=e.clientX,l=e.clientY;for(;t>=this._pointerPositionsRC.length;)this._pointerPositionsRC.push(new Q);const c=this._pointerPositionsRC[t];c.set(a,l),this.convertScreenspaceToRaycastSpace(c)}getPointerIndex(e){let t=-1;for(let i=0;i<this._pointerIds.length;i++){if(this._pointerIds[i]===e)return i;t===-1&&this._pointerIds[i]===-1&&(t=i)}return t!==-1?(this._pointerIds[t]=e,t):(ur&&console.log("PUSH pointerId:",e),this._pointerIds.push(e),this._pointerIds.length-1)}setPointerState(e,t,i){t[e]=i}setPointerStateT(e,t,i){return t[e]=i,i}onDispatchEvent(e){const t=Wt.Current;try{Wt.Current=this.context,this.dispatchEvent(e)}finally{Wt.Current=t}}}const jb=new ce().makeRotationY(Math.PI),wc=new Ve().setFromAxisAngle(new T(0,1,0),Math.PI),LLe=ee("debugwebxr");class BLe{constructor(){p(this,"priority",-1e5);p(this,"gameObject");if(this.gameObject=new ye,this.gameObject.name="Implicit XR Rig",LLe){const e=t5(16733661);e.position.y+=.5,this.gameObject.add(e)}}isXRRig(){return!0}get isActive(){return this.gameObject.visible}}const qh=ee("debugwebxr"),UT=ee("debugcustomgesture"),PLe="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",GLe="generic-trigger",kLe=new Ve().setFromEuler(new Xi(Bi.degToRad(0),Bi.degToRad(-90),Bi.degToRad(-90))),NLe=new T(.04,-.04,0);class ZO{constructor(e,t,i){p(this,"xr");p(this,"inputSource");p(this,"index",0);p(this,"emitEvents",!0);p(this,"_connected",!0);p(this,"_isTracking",!1);p(this,"__gamepad");p(this,"__hand");p(this,"__side");p(this,"_hitTestSource");p(this,"_hasSelectEvent",!1);p(this,"_isMxInk",!1);p(this,"_isMxInkFallback",!1);p(this,"_isMetaQuestTouchController",!1);p(this,"_handJointPoses",new Map);p(this,"_gripMatrix",new ce);p(this,"_gripPosition",new T);p(this,"_gripQuaternion",new Ve);p(this,"_linearVelocity",new T);p(this,"_rayPositionRaw",new T);p(this,"_rayRotationRaw",new Ve);p(this,"_rayMatrix",new ce);p(this,"_rayPosition",new T);p(this,"_rayQuaternion",new Ve);p(this,"_gripWorldPosition",new T);p(this,"_gripWorldQuaternion",new Ve);p(this,"_rayWorldPosition",new T);p(this,"_rayWorldQuaternion",new Ve);p(this,"_pinchPosition",new T);p(this,"_ray");p(this,"_hand_wristDotUp");p(this,"_object");p(this,"_gripSpaceObject");p(this,"_raySpaceObject");p(this,"model",null);p(this,"_debugAxesHelper",new al(.15));p(this,"_debugGripAxesHelper",new al(.07));p(this,"_debugRayAxesHelper",new al(.07));p(this,"_hitTestSourcePromise",null);p(this,"onPointerHits",e=>{});p(this,"_needleGamepadButtons",{});p(this,"_buttonMap",new Map);p(this,"_motioncontroller");p(this,"_layout");p(this,"getMotionController");p(this,"emitPointerDownEvent",!0);p(this,"emitPointerUpEvent",!0);p(this,"emitPointerMoveEvent",!0);p(this,"pointerMoveDistanceThreshold",.03);p(this,"pointerMoveAngleThreshold",.05);p(this,"_selectButtonIndex");p(this,"_squeezeButtonIndex");p(this,"onSelectStart",e=>{var n,r,o,a;if(!this.emitPointerDownEvent||this.inputSource!==e.inputSource)return;this.onUpdateFrame(e.frame),this._hasSelectEvent=!0;const t=(n=this._layout)==null?void 0:n.selectComponentId,i=(a=(o=(r=this._layout)==null?void 0:r.components[t])==null?void 0:o.gamepadIndices)==null?void 0:a.button;i!==void 0&&(this._selectButtonIndex=i),!UT&&(qh&&Mt.DrawDirection(this.rayWorldPosition,St(0,.01,1).applyQuaternion(this.rayWorldQuaternion),16711680,10),this.emitPointerEvent(es.PointerDown,this._selectButtonIndex||0,"xr-standard-trigger",!0,e))});p(this,"onSelectEnd",e=>{this.emitPointerUpEvent&&(UT||this.inputSource===e.inputSource&&this.emitPointerEvent(es.PointerUp,this._selectButtonIndex||0,"xr-standard-trigger",!0,e))});p(this,"onSequeezeStart",e=>{var t,i,n;this.emitPointerDownEvent&&this.inputSource===e.inputSource&&(this._squeezeButtonIndex=(n=(i=(t=this._layout)==null?void 0:t.components["xr-standard-squeeze"])==null?void 0:i.gamepadIndices)==null?void 0:n.button,this._squeezeButtonIndex!==void 0&&(qh&&Mt.DrawDirection(this.rayWorldPosition,St(0,.01,1).applyQuaternion(this.rayWorldQuaternion),255,10),this.emitPointerEvent(es.PointerDown,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,e)))});p(this,"onSequeezeEnd",e=>{this.emitPointerUpEvent&&this.inputSource===e.inputSource&&this._squeezeButtonIndex!==void 0&&this.emitPointerEvent(es.PointerUp,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,e)});p(this,"states",{});p(this,"_didMoveLastFrame",!1);p(this,"_lastPointerMovePosition",new T);p(this,"_lastPointerMoveQuaternion",new Ve);p(this,"pointerInit");this.xr=e,this.inputSource=t,this.index=i,this._object=new ye,this._object.name=`NeedleXRController_${i}`,qh&&(this._object.add(this._debugAxesHelper),this._gripSpaceObject=new ye,this._raySpaceObject=new ye,this._gripSpaceObject.name=`NeedleXRController_${i}_gripSpace`,this._raySpaceObject.name=`NeedleXRController_${i}_raySpace`,this._gripSpaceObject.add(this._debugGripAxesHelper),this._raySpaceObject.add(this._debugRayAxesHelper),this.xr.context.scene.add(this._gripSpaceObject),this.xr.context.scene.add(this._raySpaceObject)),this.xr.context.scene.add(this._object),this._ray=new Fa,this.pointerInit={origin:this,pointerType:this.hand?"hand":"controller",deviceIndex:this.index,pointerId:-1,mode:this.inputSource.targetRayMode,ray:this._ray,device:this._object,buttonName:"none"},this.initialize(),this.subscribeEvents()}get context(){return this.xr.context}get connected(){return this._connected}get isTracking(){return this._isTracking}get gamepad(){return this.__gamepad??(this.__gamepad=this.inputSource.gamepad)}get isHand(){return this.hand!=null}get hand(){return this.__hand??(this.__hand=this.inputSource.hand)}get handObject(){return this.context.renderer.xr.getHand(this.index)}get profiles(){return this.inputSource.profiles}get layout(){return this._layout}get targetRayMode(){return this.inputSource.targetRayMode}get targetRaySpace(){return this.inputSource.targetRaySpace}get gripSpace(){return this.inputSource.gripSpace}get side(){return this.__side??(this.__side=this.inputSource.handedness)}get isRight(){return this.side==="right"}get isLeft(){return this.side==="left"}get isStylus(){return this._isMxInk}getHitTestSource(){return this._hitTestSource||this._requestHitTestSource(),this._hitTestSource}get hasHitTestSource(){return this._hitTestSource}cancelHitTestSource(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0)}get hasSelectEvent(){return this._hasSelectEvent}getHitTest(){return this.xr.getHitTest(this)}getHandJointPose(e,t){var n;if(t=t||this.xr.frame,!this.hand||!(t!=null&&t.getJointPose)||!this.xr.referenceSpace)return null;let i=(n=this._handJointPoses)==null?void 0:n.get(e);return i||(i=t.getJointPose(e,this.xr.referenceSpace),i&&this._handJointPoses.set(e,i),i)}get gripPosition(){return St(this._gripPosition)}get gripQuaternion(){return Ah(this._gripQuaternion)}get gripMatrix(){return this._gripMatrix}get gripLinearVelocity(){return St(this._linearVelocity).applyQuaternion(wc)}get rayPosition(){return St(this._rayPosition)}get rayQuaternion(){return Ah(this._rayQuaternion)}get gripWorldPosition(){return St(this._gripWorldPosition)}get gripWorldQuaternion(){return Ah(this._gripWorldQuaternion)}get rayWorldPosition(){return St(this._rayWorldPosition)}updateRayWorldPosition(){var t;const e=(t=this.xr.context.mainCamera)==null?void 0:t.parent;this._rayWorldPosition.copy(this._rayPositionRaw),e&&this._rayWorldPosition.applyMatrix4(e.matrixWorld)}get rayWorldQuaternion(){return Ah(this._rayWorldQuaternion)}get pinchPosition(){return St(this._pinchPosition)}updateRayWorldQuaternion(){var i;const e=(i=this.xr.context.mainCamera)==null?void 0:i.parent,t=e?gn(e):void 0;this._rayWorldQuaternion.copy(this._rayRotationRaw).multiply(wc),t&&this._rayWorldQuaternion.premultiply(t)}get ray(){return this._ray.origin.copy(this.rayWorldPosition),this._ray.direction.copy(St(0,0,1).applyQuaternion(this.rayWorldQuaternion)),this._ray}get handWristDotUp(){var t;if(this._hand_wristDotUp!==void 0)return this._hand_wristDotUp;const e=(t=this.handObject)==null?void 0:t.joints.wrist;if(e){const i=St(0,1,0).applyQuaternion(e.quaternion),n=St(0,1,0).dot(i);return this._hand_wristDotUp=n}}get isHandUpsideDown(){return this.handWristDotUp!==void 0?this.handWristDotUp<-.7:!1}get isTeleportGesture(){var e;return this.isHandUpsideDown&&((e=this.getGesture("pinch"))==null?void 0:e.isDown)}get object(){return this._object}async getModelUrl(){var e;return(e=this.getMotionController)==null?void 0:e.then(t=>(t==null?void 0:t.assetUrl)||null)}_requestHitTestSource(){var e;return this._hitTestSourcePromise?this._hitTestSourcePromise:this.xr.mode==="immersive-ar"&&this.inputSource.targetRayMode==="tracked-pointer"&&this.xr.session.requestHitTestSourceForTransientInput?this._hitTestSourcePromise=((e=this.xr.session.requestHitTestSourceForTransientInput({profile:this.inputSource.profiles[0],offsetRay:new XRRay}))==null?void 0:e.then(t=>(this._hitTestSourcePromise=null,this.connected?this._hitTestSource=t:(t.cancel(),null))))??null:null}onUpdate(e){performance.mark("NeedleXRController onUpdate start"),this.onUpdateFrame(e),this.updateInputEvents(),this.onUpdateMove(),performance.mark("NeedleXRController onUpdate end"),performance.measure("NeedleXRController onUpdate","NeedleXRController onUpdate start","NeedleXRController onUpdate end")}onRenderDebug(){var r;Mt.DrawSphere(this.rayWorldPosition,.003),Mt.DrawDirection(this.rayWorldPosition,St(0,0,10).applyQuaternion(this.rayWorldQuaternion));const t=(this.inputSource.gripSpace?this.gripWorldPosition:this.object.worldPosition).sub(this.object.worldForward.multiplyScalar(.1)),i=this.inputSource.profiles.join(`
`);let n=`Controller[${this.index}] (${this.inputSource.targetRayMode}, ${this.side})
C:${this.connected?"x":"-"} T:${this.isTracking?"x":"-"} Hand:${this.inputSource.hand?"x":"-"} Pen: ${this._isMxInk?"x":"-"}`;if(this.inputSource.hand&&(n+=`
Pinch: ${(r=this.getGesture("pinch"))==null?void 0:r.value.toFixed(3)}`),n+=`
`+i,n+=`
`+(this.inputSource.targetRaySpace?"Ray: x":"Ray: -")+(this.inputSource.gripSpace?" Grip: x":" Grip: -")+(this.inputSource.gamepad?` Gamepad: ${this.inputSource.gamepad.mapping}`:" Gamepad: -"),this.inputSource.gamepad){const o=this.inputSource.gamepad;let a="[btns "+o.buttons.length+"]: "+o.buttons.map(l=>l.value.toPrecision(1)).join(",");a+=`
[axes `+o.axes.length+"]: "+o.axes.map(l=>l.toPrecision(1)).join(","),n+=`
`+a}Mt.DrawLabel(t,n,.006)}onUpdateFrame(e){var h,d,u,f,m,g,A,y,b,x,v;if(this._handJointPoses.clear(),this._hand_wristDotUp=void 0,!this.xr.referenceSpace){this._isTracking=!1;return}const t=e.getPose(this.inputSource.targetRaySpace,this.xr.referenceSpace);this._isTracking=t!=null;let i=null,n=null,r=null,o=null;if(t){const _=t.transform;if(this._rayMatrix.fromArray(_.matrix).premultiply(jb),this._rayMatrix.decompose(this._rayPosition,this._rayQuaternion,St(1,1,1)),r=St(_.position),o=Ah(_.orientation),this._isMxInk&&!this._isMxInkFallback){const C=St(.013,0,-.028).applyQuaternion(o);r.add(C),this._rayPosition.add(C)}this._rayPositionRaw.copy(r),this._rayRotationRaw.copy(o)}if(this.inputSource.gripSpace){const _=e.getPose(this.inputSource.gripSpace,this.xr.referenceSpace);if(_){const C=_.transform;if(i=St(C.position),n=Ah(C.orientation),this._gripMatrix.fromArray(C.matrix).premultiply(jb),this._gripMatrix.decompose(this._gripPosition,this._gripQuaternion,St(1,1,1)),"linearVelocity"in _&&_.linearVelocity){const S=_.linearVelocity;this._linearVelocity.set(S.x,S.y,S.z)}}}(h=this.xr.context.mainCamera)!=null&&h.parent&&(this._object.parent!==((d=this.xr.context.mainCamera)==null?void 0:d.parent)&&this.xr.context.mainCamera.parent.add(this._object),this._gripSpaceObject!==void 0&&((u=this._gripSpaceObject)==null?void 0:u.parent)!==((f=this.xr.context.mainCamera)==null?void 0:f.parent)&&this.xr.context.mainCamera.parent.add(this._gripSpaceObject),this._raySpaceObject!==void 0&&((m=this._raySpaceObject)==null?void 0:m.parent)!==((g=this.xr.context.mainCamera)==null?void 0:g.parent)&&this.xr.context.mainCamera.parent.add(this._raySpaceObject));const a=this.hand;if(a){let _=!1;const C=a.get("wrist"),S=C&&this.getHandJointPose(C,e);if(S){_=!0;const w=S.transform.position,E=S.transform.orientation;this._object.position.set(w.x,w.y,w.z),this._object.quaternion.set(E.x,E.y,E.z,E.w).multiply(wc)}_||(this._object.position.copy(this._rayPosition),this._object.quaternion.copy(this._rayQuaternion).multiply(wc));const M=a.get("middle-finger-metacarpal"),L=M&&this.getHandJointPose(M,e);L&&(this._gripMatrix.fromArray(L.transform.matrix).premultiply(jb),this._gripMatrix.decompose(this._gripPosition,this._gripQuaternion,St(1,1,1)),i=St().copy(L.transform.position),n=Ah().copy(L.transform.orientation),n.multiply(kLe),i.add(St(NLe).applyQuaternion(n)))}else this.inputSource.gripSpace&&this.targetRayMode==="transient-pointer"&&i&&n?(this._object.position.copy(i),this._object.quaternion.copy(n).multiply(wc)):r&&o&&(this._object.position.copy(r),this._object.quaternion.copy(o).multiply(wc));qh&&(r&&o&&((A=this._raySpaceObject)==null||A.position.copy(r),(y=this._raySpaceObject)==null||y.quaternion.copy(o).multiply(wc)),i&&n&&((b=this._gripSpaceObject)==null||b.position.copy(i),(x=this._gripSpaceObject)==null||x.quaternion.copy(n).multiply(wc)));const l=(v=this.xr.context.mainCamera)==null?void 0:v.parent,c=l?gn(l):void 0;i&&n&&(this._gripWorldPosition.copy(i),l&&this._gripWorldPosition.applyMatrix4(l.matrixWorld),this._gripWorldQuaternion.copy(n),this._gripWorldQuaternion.multiply(wc),c&&this._gripWorldQuaternion.premultiply(c)),this.updateRayWorldPosition(),this.updateRayWorldQuaternion()}onDisconnected(){var e,t,i,n,r,o;this._connected=!1,qh&&console.warn("Controller disconnected",this.index);for(const a of this._object.children)this.xr.context.scene.attach(a);(e=this._object)==null||e.removeFromParent(),(t=this._debugAxesHelper)==null||t.removeFromParent(),(i=this._debugGripAxesHelper)==null||i.removeFromParent(),(n=this._debugRayAxesHelper)==null||n.removeFromParent(),(r=this._gripSpaceObject)==null||r.removeFromParent(),(o=this._raySpaceObject)==null||o.removeFromParent(),this.unsubscribeEvents(),this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0)}getButton(e){var i;if(!this._layout)return;switch(e){case"primary-button":if(this.isLeft)e="x-button";else if(this.isRight)e="a-button";else return;break;case"primary":return this.hand?this.getGesture("pinch"):this.toNeedleGamepadButton(0,e)}if(this._buttonMap.has(e))return this.toNeedleGamepadButton(this._buttonMap.get(e),e);const t=(i=this._layout)==null?void 0:i.components[e];if(t!=null&&t.gamepadIndices)switch(t.type){case"button":case"squeeze":if(this.inputSource.gamepad){const n=t.gamepadIndices.button;return this._buttonMap.set(e,n),this.toNeedleGamepadButton(n,e)}break;default:console.warn("Unsupported component type",t.type);break}this._buttonMap.set(e,void 0)}getGesture(e){const t=this.states[e];if(!t)return null;this.states[e]=t;const i=this._needleGamepadButtons[e]||new u4(void 0,e);return i.pressed=t.pressed,i.value=t.value,i.isDown=t.isDown,i.isUp=t.isUp,this._needleGamepadButtons[e]=i,i}getPointerId(e){if((e==="primary"||e==="pinch")&&(e=0),typeof e!="number"){const t=this._buttonMap.get(e);if(t===void 0)return;e=t}return this.index*10+e}toNeedleGamepadButton(e,t){var o,a;if(!((o=this.inputSource.gamepad)!=null&&o.buttons))return;const i=(a=this.inputSource.gamepad)==null?void 0:a.buttons[e],n=this.states[e],r=this._needleGamepadButtons[e]||new u4(e,t);return i&&(r.pressed=i.pressed,r.value=i.value,r.touched=i.touched),n&&(r.isDown=n.isDown,r.isUp=n.isUp),this._needleGamepadButtons[e]=r,r}getStick(e){var i,n,r,o,a,l,c,h,d;if(!this._layout)return{x:0,y:0,z:0};if(e==="primary"){const u=((i=this.inputSource.gamepad)==null?void 0:i.axes[0])||0,f=((n=this.inputSource.gamepad)==null?void 0:n.axes[1])||0,m=((o=(r=this.inputSource.gamepad)==null?void 0:r.buttons[3])==null?void 0:o.value)||0;return{x:u,y:f,z:m}}const t=(a=this._layout)==null?void 0:a.components[e];if(t!=null&&t.gamepadIndices)switch(t.type){case"thumbstick":if(this.inputSource.gamepad){const u=t.gamepadIndices.xAxis,f=t.gamepadIndices.yAxis;let m=(l=this.inputSource.gamepad)==null?void 0:l.axes[u],g=(c=this.inputSource.gamepad)==null?void 0:c.axes[f];m*=-1,g*=-1;const A=t.gamepadIndices.button,y=(d=(h=this.inputSource.gamepad)==null?void 0:h.buttons[A])==null?void 0:d.value;return{x:m,y:g,z:y}}}return{x:0,y:0,z:0}}initialize(){if(this._hasSelectEvent=this.profiles.includes("generic-hand-select")||this.profiles.some(e=>e.startsWith("generic-trigger")),this._isMetaQuestTouchController=this.profiles.includes("meta-quest-touch-plus")||this.profiles.includes("oculus-touch-v3"),this._isMxInk=this.profiles.includes("logitech-mx-ink"),!this._layout){if(this.inputSource.targetRayMode==="transient-pointer")return;const e=wLe(this.inputSource,PLe,GLe);this.getMotionController=e.then(t=>{var r;if(!this.connected)return null;this._isMxInk&&!t.assetPath&&(qh&&console.log("Falling back to custom MX Ink model",t.profile,t.assetPath),t.assetPath="https://cdn.needle.tools/static/models/controllers/logitech_vr_stylus_v1.3.1_grip_questos68.glb",this._isMxInkFallback=!0),this._motioncontroller=new ELe(this.inputSource,t.profile,t.assetPath||"");const n=t.profile.layouts[this.inputSource.handedness];if(this._layout=n,this._layout&&!((r=this._layout.gamepad)!=null&&r.length)){this._layout.gamepad=[];for(const o in this._layout.components){const a=this._layout.components[o];this._layout.gamepad[a.gamepadIndices.button]=o}}return this._motioncontroller}).catch(t=>(this.inputSource&&console.warn("Couldn't initialize motion controller profile for ",this.inputSource,t),null))}}subscribeEvents(){this.xr.session.addEventListener("selectstart",this.onSelectStart),this.xr.session.addEventListener("selectend",this.onSelectEnd),this.xr.session.addEventListener("squeezestart",this.onSequeezeStart),this.xr.session.addEventListener("squeezeend",this.onSequeezeEnd)}unsubscribeEvents(){this.xr.session.removeEventListener("selectstart",this.onSelectStart),this.xr.session.removeEventListener("selectend",this.onSelectEnd),this.xr.session.removeEventListener("squeezestart",this.onSequeezeStart),this.xr.session.removeEventListener("squeezeend",this.onSequeezeEnd)}updateInputEvents(){var e,t,i;if((e=this.gamepad)!=null&&e.buttons){for(let n=0;n<this.gamepad.buttons.length;n++){const r=this.gamepad.buttons[n],o=this.states[n]||new d4;let a=null;this._isMxInk&&(n===4||n===5)?(r.value>0&&!o.pressed?(a="pointerdown",o.isDown=!0,o.isUp=!1):r.value===0&&o.pressed?(a="pointerup",o.isDown=!1,o.isUp=!0):o.pressed&&(a="pointermove",o.isDown=!1,o.isUp=!1),o.pressed=r.value>0,o.value=r.value):(r.pressed&&!o.pressed?(a="pointerdown",o.isDown=!0,o.isUp=!1):!r.pressed&&o.pressed?(a="pointerup",o.isDown=!1,o.isUp=!0):(o.isDown=!1,o.isUp=!1),o.pressed=r.pressed,o.value=r.value),this.states[n]=o;const l=n!==this._selectButtonIndex&&n!==this._squeezeButtonIndex;if(a!=null&&l){let c=(t=this._layout)==null?void 0:t.gamepad[n];this._isMxInk&&n===4&&(c="stylus-touch"),this._isMxInk&&n===5&&(c="stylus-tip"),(qh||UT)&&console.log("Emitting pointer event",a,n,c,r.value,this.gamepad,this._layout),this.emitPointerEvent(a,n,c??"none",!1,null,r.value)}}if(this._isMetaQuestTouchController){const n=this.gamepad.buttons.length-1,r=this.states[n];if(r&&r.isDown){const o=this.context.menu;o.spatialMenuIsVisible?o.setSpatialMenuVisible(!1):this.context.menu.setSpatialMenuVisible(!0)}}}if(this.hand){const n=this.handObject;if(n){const r=n.joints["index-finger-tip"],o=n.joints["thumb-tip"];if(r&&o){const a=r.position.distanceTo(o.position);this._pinchPosition.lerpVectors(r.position,o.position,.5);const l=(i=this.xr.context.mainCamera)==null?void 0:i.parent;if(l&&this._pinchPosition.applyMatrix4(l.matrixWorld),a!==0){const d=this.states.pinch||new d4,u=(.02+.01)*1.5;d.value=1-(a-.02)/u;const f=a<.02-.01,m=a>.02+.01;f&&!d.pressed?(UT&&console.log("pinch start",a),d.isDown=!0,d.isUp=!1,d.pressed=!0):m&&d.pressed?(d.isDown=!1,d.isUp=!0,d.pressed=!1):(d.isDown=!1,d.isUp=!1),this.states.pinch=d}}}}}onUpdateMove(){var i,n;if(!this.emitPointerMoveEvent)return;let e=!1;if(this._lastPointerMovePosition.distanceTo(this.gripWorldPosition)>this.pointerMoveDistanceThreshold*this.xr.rigScale&&(e=!0),e||this._lastPointerMoveQuaternion.angleTo(this.gripWorldQuaternion)>this.pointerMoveAngleThreshold&&(e=!0),e){this._didMoveLastFrame=!0,this._lastPointerMovePosition.copy(this.gripWorldPosition),this._lastPointerMoveQuaternion.copy(this.gripWorldQuaternion),qh&&Mt.DrawLabel(this.rayWorldPosition.add(this.object.worldForward.multiplyScalar(.1)),"move",.01);let r=this.xr.context.input.getFirstPressedButtonForPointer(this.index);r===void 0&&(r=0);const o=(n=(i=this.gamepad)==null?void 0:i.buttons[r])==null?void 0:n.value;this.emitPointerEvent("pointermove",r,"none",!1,null,o)}else this._didMoveLastFrame=!1}emitPointerEvent(e,t,i,n,r=null,o){if(!this.emitEvents){qh&&e!==es.PointerMove&&console.warn("Pointer events are disabled for this controller",this.index,e,t);return}if(this.xr.mode==="immersive-vr"||this.xr.isPassThrough){this.pointerInit.origin=this,this.pointerInit.pointerId=this.getPointerId(t),this.pointerInit.pointerType=this.hand?"hand":"controller",this.pointerInit.button=t,this.pointerInit.buttonName=i,this.pointerInit.isPrimary=n,this.pointerInit.mode=this.inputSource.targetRayMode,this.pointerInit.ray=this.ray,this.pointerInit.device=this.object,this.pointerInit.pressure=o,this.pointerInit.clientX=this._rayPosition.x/this.xr.rigScale,this.pointerInit.clientY=this._rayPosition.y/this.xr.rigScale,this.pointerInit.clientZ=this._rayPosition.z/this.xr.rigScale;const a=Wt.Current;Wt.Current=this.xr.context,qh&&e!=="pointermove"&&console.warn("Pointer event",e,t,i,{...this.pointerInit}),this.xr.context.input.createInputEvent(new Wu(e,r,this.pointerInit)),Wt.Current=a}}}class d4{constructor(){p(this,"isDown",!1);p(this,"isUp",!1);p(this,"pressed",!1);p(this,"value",0)}}class u4{constructor(e,t){p(this,"index");p(this,"name");p(this,"touched",!1);p(this,"pressed",!1);p(this,"value",0);p(this,"isDown",!1);p(this,"isUp",!1);this.index=e,this.name=t}}const qb=new Map,Rb=new Map;let p4=0;function Gp(s,e,t){if(qb.has(e)||qb.set(e,new Array),qb.get(e).push({method:s,options:{once:!1,...t}}),p4<30){const i=Rb.get(e);i&&(i==null?void 0:i.length)>100&&(p4+=1,console.warn(`You have ${i.length} methods registered for Event ${e}.

This might be a performance issue!
Consider unregistering the methods when they are not needed anymore!

To unregister you can call the function returned by your event hook (e.g.const unregister = onStart(...)) 

or by using the once option like onStart(()=>{}, { once:true }).

See https://engine.needle.tools/docs/scripting.html#special-lifecycle-hooks for more information.`))}}function Vm(s,e){const t=Rb.get(e);if(t){for(let n=0;n<t.length;n++)if(t[n].method===s){t.splice(n,1);return}}const i=qb.get(e);if(i){for(let n=0;n<i.length;n++)if(i[n].method===s){i.splice(n,1);return}}}function $h(s,e){e===ji.ContextCreated&&QV.delete(s),Kne(s,e)}function Kne(s,e){e===wn.Start&&qb.get(ji.ContextCreated)&&Kne(s,ji.ContextCreated);const t=e===wn.Start||e===ji.ContextCreated,i=Rb.get(e);i&&i.length>0&&m4(s,i,t);const n=qb.get(e);if(n&&n.length>0){const r=[...n];n.length=0,m4(s,r,t),r.length>0&&(Rb.has(e)||Rb.set(e,new Array),Rb.get(e).push(...r))}}const XT=new Array,f4={context:null};function m4(s,e,t){var n,r;XT.length=0;for(let o=0;o<e.length;o++)XT.push(e[o]);let i=QV.get(s);for(let o=0;o<XT.length;o++){const a=XT[o];let l=!0;if(i&&i.has(a)&&(l=!1),l)try{f4.context=s,(n=a.method)==null||n.call(f4,s)}catch(c){console.error("Error in lifecycle method",c)}if((r=a.options)!=null&&r.once){for(let c=0;c<e.length;c++)if(e[c]===a){e.splice(c,1);break}}else t&&(i||(i=new Set,QV.set(s,i)),i.add(a))}}const QV=new WeakMap,TN=2,_d=4,ip=4,WO=4,Tf=new Int32Array(2),g4=new Float32Array(Tf.buffer),A4=new Float64Array(Tf.buffer),OT=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;class xp{constructor(e,t){this.low=e|0,this.high=t|0}static create(e,t){return e==0&&t==0?xp.ZERO:new xp(e,t)}toFloat64(){return(this.low>>>0)+this.high*4294967296}equals(e){return this.low==e.low&&this.high==e.high}}xp.ZERO=new xp(0,0);var KV;(function(s){s[s.UTF8_BYTES=1]="UTF8_BYTES",s[s.UTF16_STRING=2]="UTF16_STRING"})(KV||(KV={}));class uS{constructor(e){this.bytes_=e,this.position_=0}static allocate(e){return new uS(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return new xp(this.readInt32(e),this.readInt32(e+4))}readUint64(e){return new xp(this.readUint32(e),this.readUint32(e+4))}readFloat32(e){return Tf[0]=this.readInt32(e),g4[0]}readFloat64(e){return Tf[OT?0:1]=this.readInt32(e),Tf[OT?1:0]=this.readInt32(e+4),A4[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,t.low),this.writeInt32(e+4,t.high)}writeUint64(e,t){this.writeUint32(e,t.low),this.writeUint32(e+4,t.high)}writeFloat32(e,t){g4[0]=t,this.writeInt32(e,Tf[0])}writeFloat64(e,t){A4[0]=t,this.writeInt32(e,Tf[OT?0:1]),this.writeInt32(e+4,Tf[OT?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+_d+ip)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<ip;t++)e+=String.fromCharCode(this.readInt8(this.position_+_d+t));return e}__offset(e,t){const i=e-this.readInt32(e);return t<this.readInt16(i)?this.readInt16(i+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const i=this.readInt32(e);let n="",r=0;if(e+=_d,t===KV.UTF8_BYTES)return this.bytes_.subarray(e,e+i);for(;r<i;){let o;const a=this.readUint8(e+r++);if(a<192)o=a;else{const l=this.readUint8(e+r++);if(a<224)o=(a&31)<<6|l&63;else{const c=this.readUint8(e+r++);if(a<240)o=(a&15)<<12|(l&63)<<6|c&63;else{const h=this.readUint8(e+r++);o=(a&7)<<18|(l&63)<<12|(c&63)<<6|h&63}}}o<65536?n+=String.fromCharCode(o):(o-=65536,n+=String.fromCharCode((o>>10)+55296,(o&1024-1)+56320))}return n}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+_d}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=ip)throw new Error("FlatBuffers: file identifier must be length "+ip);for(let t=0;t<ip;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+_d+t))return!1;return!0}createLong(e,t){return xp.create(e,t)}createScalarList(e,t){const i=[];for(let n=0;n<t;++n)e(n)!==null&&i.push(e(n));return i}createObjList(e,t){const i=[];for(let n=0;n<t;++n){const r=e(n);r!==null&&i.push(r.unpack())}return i}}class oM{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null;let t;e?t=e:t=1024,this.bb=uS.allocate(t),this.space=t}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,t){e>this.minalign&&(this.minalign=e);const i=~(this.bb.capacity()-this.space+t)+1&e-1;for(;this.space<i+e+t;){const n=this.bb.capacity();this.bb=oM.growByteBuffer(this.bb),this.space+=this.bb.capacity()-n}this.pad(i)}pad(e){for(let t=0;t<e;t++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,t,i){(this.force_defaults||t!=i)&&(this.addInt8(t),this.slot(e))}addFieldInt16(e,t,i){(this.force_defaults||t!=i)&&(this.addInt16(t),this.slot(e))}addFieldInt32(e,t,i){(this.force_defaults||t!=i)&&(this.addInt32(t),this.slot(e))}addFieldInt64(e,t,i){(this.force_defaults||!t.equals(i))&&(this.addInt64(t),this.slot(e))}addFieldFloat32(e,t,i){(this.force_defaults||t!=i)&&(this.addFloat32(t),this.slot(e))}addFieldFloat64(e,t,i){(this.force_defaults||t!=i)&&(this.addFloat64(t),this.slot(e))}addFieldOffset(e,t,i){(this.force_defaults||t!=i)&&(this.addOffset(t),this.slot(e))}addFieldStruct(e,t,i){t!=i&&(this.nested(t),this.slot(e))}nested(e){if(e!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const t=e.capacity();if(t&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const i=t<<1,n=uS.allocate(i);return n.setPosition(i-t),n.bytes().set(e.bytes(),i-t),n}addOffset(e){this.prep(_d,0),this.writeInt32(this.offset()-e+_d)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let t=0;t<e;t++)this.vtable[t]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let t=this.vtable_in_use-1;for(;t>=0&&this.vtable[t]==0;t--);const i=t+1;for(;t>=0;t--)this.addInt16(this.vtable[t]!=0?e-this.vtable[t]:0);const n=2;this.addInt16(e-this.object_start);const r=(i+n)*TN;this.addInt16(r);let o=0;const a=this.space;e:for(t=0;t<this.vtables.length;t++){const l=this.bb.capacity()-this.vtables[t];if(r==this.bb.readInt16(l)){for(let c=TN;c<r;c+=TN)if(this.bb.readInt16(a+c)!=this.bb.readInt16(l+c))continue e;o=this.vtables[t];break}}return o?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,o-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,t,i){const n=i?WO:0;if(t){const r=t;if(this.prep(this.minalign,_d+ip+n),r.length!=ip)throw new Error("FlatBuffers: file identifier must be length "+ip);for(let o=ip-1;o>=0;o--)this.writeInt8(r.charCodeAt(o))}this.prep(this.minalign,_d+n),this.addOffset(e),n&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,t){this.finish(e,t,!0)}requiredField(e,t){const i=this.bb.capacity()-e,n=i-this.bb.readInt32(i);if(!(this.bb.readInt16(n+t)!=0))throw new Error("FlatBuffers: field "+t+" must be set")}startVector(e,t,i){this.notNested(),this.vector_num_elems=t,this.prep(_d,e*t),this.prep(i,e*t)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const t=this.createString(e);return this.string_maps.set(e,t),t}createString(e){if(!e)return 0;let t;if(e instanceof Uint8Array)t=e;else{t=[];let i=0;for(;i<e.length;){let n;const r=e.charCodeAt(i++);if(r<55296||r>=56320)n=r;else{const o=e.charCodeAt(i++);n=(r<<10)+o+(65536-56623104-56320)}n<128?t.push(n):(n<2048?t.push(n>>6&31|192):(n<65536?t.push(n>>12&15|224):t.push(n>>18&7|240,n>>12&63|128),t.push(n>>6&63|128)),t.push(n&63|128))}}this.addInt8(0),this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length);for(let i=0,n=this.space,r=this.bb.bytes();i<t.length;i++)r[n++]=t[i];return this.endVector()}createLong(e,t){return xp.create(e,t)}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const t=[];for(let i=0;i<e.length;++i){const n=e[i];if(n!==null)t.push(this.createObjectOffset(n));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return t}createStructOffsetList(e,t){return t(this,e.length),this.createObjectOffsetList(e),this.endVector()}}const HO={};function QO(s,e){HO[s]=e}function Yne(s){const e=s.getBufferIdentifier(),t=HO[e];return t(s)}function Jne(s){return typeof s.guid=="function"?s.guid():null}function uP(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var jne={exports:{}};(function(s){var e={};e.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),e.useArrayBufferView=!e.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),s.exports.binaryFeatures=e;var t=s.exports.BlobBuilder;typeof window<"u"&&(t=s.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function i(){this._pieces=[],this._parts=[]}i.prototype.append=function(n){typeof n=="number"?this._pieces.push(n):(this.flush(),this._parts.push(n))},i.prototype.flush=function(){if(this._pieces.length>0){var n=new Uint8Array(this._pieces);e.useArrayBufferView||(n=n.buffer),this._parts.push(n),this._pieces=[]}},i.prototype.getBuffer=function(){if(this.flush(),e.useBlobBuilder){for(var n=new t,r=0,o=this._parts.length;r<o;r++)n.append(this._parts[r]);return n.getBlob()}else return new Blob(this._parts)},s.exports.BufferBuilder=i})(jne);var qne=jne.exports,DLe=qne.BufferBuilder,y4=qne.binaryFeatures,FLe={unpack:function(s){var e=new Po(s);return e.unpack()},pack:function(s){var e=new Go;e.pack(s);var t=e.getBuffer();return t}},VLe=FLe;function Po(s){this.index=0,this.dataBuffer=s,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}Po.prototype.unpack=function(){var s=this.unpack_uint8();if(s<128)return s;if((s^224)<32)return(s^224)-32;var e;if((e=s^160)<=15)return this.unpack_raw(e);if((e=s^176)<=15)return this.unpack_string(e);if((e=s^144)<=15)return this.unpack_array(e);if((e=s^128)<=15)return this.unpack_map(e);switch(s){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}};Po.prototype.unpack_uint8=function(){var s=this.dataView[this.index]&255;return this.index++,s};Po.prototype.unpack_uint16=function(){var s=this.read(2),e=(s[0]&255)*256+(s[1]&255);return this.index+=2,e};Po.prototype.unpack_uint32=function(){var s=this.read(4),e=((s[0]*256+s[1])*256+s[2])*256+s[3];return this.index+=4,e};Po.prototype.unpack_uint64=function(){var s=this.read(8),e=((((((s[0]*256+s[1])*256+s[2])*256+s[3])*256+s[4])*256+s[5])*256+s[6])*256+s[7];return this.index+=8,e};Po.prototype.unpack_int8=function(){var s=this.unpack_uint8();return s<128?s:s-256};Po.prototype.unpack_int16=function(){var s=this.unpack_uint16();return s<32768?s:s-65536};Po.prototype.unpack_int32=function(){var s=this.unpack_uint32();return s<Math.pow(2,31)?s:s-Math.pow(2,32)};Po.prototype.unpack_int64=function(){var s=this.unpack_uint64();return s<Math.pow(2,63)?s:s-Math.pow(2,64)};Po.prototype.unpack_raw=function(s){if(this.length<this.index+s)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+s+" "+this.length);var e=this.dataBuffer.slice(this.index,this.index+s);return this.index+=s,e};Po.prototype.unpack_string=function(s){for(var e=this.read(s),t=0,i="",n,r;t<s;)n=e[t],n<128?(i+=String.fromCharCode(n),t++):(n^192)<32?(r=(n^192)<<6|e[t+1]&63,i+=String.fromCharCode(r),t+=2):(r=(n&15)<<12|(e[t+1]&63)<<6|e[t+2]&63,i+=String.fromCharCode(r),t+=3);return this.index+=s,i};Po.prototype.unpack_array=function(s){for(var e=new Array(s),t=0;t<s;t++)e[t]=this.unpack();return e};Po.prototype.unpack_map=function(s){for(var e={},t=0;t<s;t++){var i=this.unpack(),n=this.unpack();e[i]=n}return e};Po.prototype.unpack_float=function(){var s=this.unpack_uint32(),e=s>>31,t=(s>>23&255)-127,i=s&8388607|8388608;return(e===0?1:-1)*i*Math.pow(2,t-23)};Po.prototype.unpack_double=function(){var s=this.unpack_uint32(),e=this.unpack_uint32(),t=s>>31,i=(s>>20&2047)-1023,n=s&1048575|1048576,r=n*Math.pow(2,i-20)+e*Math.pow(2,i-52);return(t===0?1:-1)*r};Po.prototype.read=function(s){var e=this.index;if(e+s<=this.length)return this.dataView.subarray(e,e+s);throw new Error("BinaryPackFailure: read index out of range")};function Go(){this.bufferBuilder=new DLe}Go.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};Go.prototype.pack=function(s){var e=typeof s;if(e==="string")this.pack_string(s);else if(e==="number")Math.floor(s)===s?this.pack_integer(s):this.pack_double(s);else if(e==="boolean")s===!0?this.bufferBuilder.append(195):s===!1&&this.bufferBuilder.append(194);else if(e==="undefined")this.bufferBuilder.append(192);else if(e==="object")if(s===null)this.bufferBuilder.append(192);else{var t=s.constructor;if(t==Array)this.pack_array(s);else if(t==Blob||t==File||s instanceof Blob||s instanceof File)this.pack_bin(s);else if(t==ArrayBuffer)y4.useArrayBufferView?this.pack_bin(new Uint8Array(s)):this.pack_bin(s);else if("BYTES_PER_ELEMENT"in s)y4.useArrayBufferView?this.pack_bin(new Uint8Array(s.buffer)):this.pack_bin(s.buffer);else if(t==Object||t.toString().startsWith("class"))this.pack_object(s);else if(t==Date)this.pack_string(s.toString());else if(typeof s.toBinaryPack=="function")this.bufferBuilder.append(s.toBinaryPack());else throw new Error('Type "'+t.toString()+'" not yet supported')}else throw new Error('Type "'+e+'" not yet supported');this.bufferBuilder.flush()};Go.prototype.pack_bin=function(s){var e=s.length||s.byteLength||s.size;if(e<=15)this.pack_uint8(160+e);else if(e<=65535)this.bufferBuilder.append(218),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(s)};Go.prototype.pack_string=function(s){var e=ULe(s);if(e<=15)this.pack_uint8(176+e);else if(e<=65535)this.bufferBuilder.append(216),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(s)};Go.prototype.pack_array=function(s){var e=s.length;if(e<=15)this.pack_uint8(144+e);else if(e<=65535)this.bufferBuilder.append(220),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(e);else throw new Error("Invalid length");for(var t=0;t<e;t++)this.pack(s[t])};Go.prototype.pack_integer=function(s){if(s>=-32&&s<=127)this.bufferBuilder.append(s&255);else if(s>=0&&s<=255)this.bufferBuilder.append(204),this.pack_uint8(s);else if(s>=-128&&s<=127)this.bufferBuilder.append(208),this.pack_int8(s);else if(s>=0&&s<=65535)this.bufferBuilder.append(205),this.pack_uint16(s);else if(s>=-32768&&s<=32767)this.bufferBuilder.append(209),this.pack_int16(s);else if(s>=0&&s<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(s);else if(s>=-2147483648&&s<=2147483647)this.bufferBuilder.append(210),this.pack_int32(s);else if(s>=-9223372036854776e3&&s<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(s);else if(s>=0&&s<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(s);else throw new Error("Invalid integer")};Go.prototype.pack_double=function(s){var e=0;s<0&&(e=1,s=-s);var t=Math.floor(Math.log(s)/Math.LN2),i=s/Math.pow(2,t)-1,n=Math.floor(i*Math.pow(2,52)),r=Math.pow(2,32),o=e<<31|t+1023<<20|n/r&1048575,a=n%r;this.bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(a)};Go.prototype.pack_object=function(s){var e=Object.keys(s),t=e.length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(t);else throw new Error("Invalid length");for(var i in s)s.hasOwnProperty(i)&&(this.pack(i),this.pack(s[i]))};Go.prototype.pack_uint8=function(s){this.bufferBuilder.append(s)};Go.prototype.pack_uint16=function(s){this.bufferBuilder.append(s>>8),this.bufferBuilder.append(s&255)};Go.prototype.pack_uint32=function(s){var e=s&4294967295;this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};Go.prototype.pack_uint64=function(s){var e=s/Math.pow(2,32),t=s%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};Go.prototype.pack_int8=function(s){this.bufferBuilder.append(s&255)};Go.prototype.pack_int16=function(s){this.bufferBuilder.append((s&65280)>>8),this.bufferBuilder.append(s&255)};Go.prototype.pack_int32=function(s){this.bufferBuilder.append(s>>>24&255),this.bufferBuilder.append((s&16711680)>>>16),this.bufferBuilder.append((s&65280)>>>8),this.bufferBuilder.append(s&255)};Go.prototype.pack_int64=function(s){var e=Math.floor(s/Math.pow(2,32)),t=s%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};function zLe(s){var e=s.charCodeAt(0);return e<=2047?"00":e<=65535?"000":e<=2097151?"0000":e<=67108863?"00000":"000000"}function ULe(s){return s.length>600?new Blob([s]).size:s.replace(/[^\u0000-\u007F]/g,zLe).length}const b4=uP(VLe);let $ne=!0,ese=!0;function hC(s,e,t){const i=s.match(e);return i&&i.length>=t&&parseInt(i[t],10)}function nv(s,e,t){if(!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype,n=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return n.apply(this,arguments);const l=c=>{const h=t(c);h&&(a.handleEvent?a.handleEvent(h):a(h))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,l),n.apply(this,[o,l])};const r=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return r.apply(this,arguments);if(!this._eventMap[e].has(a))return r.apply(this,arguments);const l=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[o,l])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function XLe(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):($ne=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function OLe(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(ese=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function KO(){if(typeof window=="object"){if($ne)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function pP(s,e){ese&&console.warn(s+" is deprecated, please use "+e+" instead.")}function ZLe(s){const e={browser:null,version:null};if(typeof s>"u"||!s.navigator)return e.browser="Not a browser.",e;const{navigator:t}=s;if(t.mozGetUserMedia)e.browser="firefox",e.version=hC(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection&&!s.RTCIceGatherer)e.browser="chrome",e.version=hC(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=hC(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(s.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=hC(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function x4(s){return Object.prototype.toString.call(s)==="[object Object]"}function tse(s){return x4(s)?Object.keys(s).reduce(function(e,t){const i=x4(s[t]),n=i?tse(s[t]):s[t],r=i&&!Object.keys(n).length;return n===void 0||r?e:Object.assign(e,{[t]:n})},{}):s}function YV(s,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?YV(s,s.get(e[i]),t):i.endsWith("Ids")&&e[i].forEach(n=>{YV(s,s.get(n),t)})}))}function v4(s,e,t){const i=t?"outbound-rtp":"inbound-rtp",n=new Map;if(e===null)return n;const r=[];return s.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&r.push(o)}),r.forEach(o=>{s.forEach(a=>{a.type===i&&a.trackId===o.id&&YV(s,a,n)})}),n}const _4=KO;function ise(s,e){const t=s&&s.navigator;if(!t.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const l={};return Object.keys(a).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const h=typeof a[c]=="object"?a[c]:{ideal:a[c]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const d=function(u,f){return u?u+f.charAt(0).toUpperCase()+f.slice(1):f==="deviceId"?"sourceId":f};if(h.ideal!==void 0){l.optional=l.optional||[];let u={};typeof h.ideal=="number"?(u[d("min",c)]=h.ideal,l.optional.push(u),u={},u[d("max",c)]=h.ideal,l.optional.push(u)):(u[d("",c)]=h.ideal,l.optional.push(u))}h.exact!==void 0&&typeof h.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[d("",c)]=h.exact):["min","max"].forEach(u=>{h[u]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[d(u,c)]=h[u])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},n=function(a,l){if(e.version>=61)return l(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const c=function(h,d,u){d in h&&!(u in h)&&(h[u]=h[d],delete h[d])};a=JSON.parse(JSON.stringify(a)),c(a.audio,"autoGainControl","googAutoGainControl"),c(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let c=a.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const h=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!h)){delete a.video.facingMode;let d;if(c.exact==="environment"||c.ideal==="environment"?d=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(d=["front"]),d)return t.mediaDevices.enumerateDevices().then(u=>{u=u.filter(m=>m.kind==="videoinput");let f=u.find(m=>d.some(g=>m.label.toLowerCase().includes(g)));return!f&&u.length&&d.includes("back")&&(f=u[u.length-1]),f&&(a.video.deviceId=c.exact?{exact:f.deviceId}:{ideal:f.deviceId}),a.video=i(a.video),_4("chrome: "+JSON.stringify(a)),l(a)})}a.video=i(a.video)}return _4("chrome: "+JSON.stringify(a)),l(a)},r=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,l,c){n(a,h=>{t.webkitGetUserMedia(h,l,d=>{c&&c(r(d))})})};if(t.getUserMedia=o.bind(t),t.mediaDevices.getUserMedia){const a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(l){return n(l,c=>a(c).then(h=>{if(c.audio&&!h.getAudioTracks().length||c.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return h},h=>Promise.reject(r(h))))}}}function WLe(s,e){if(!(s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices)&&s.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}s.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then(n=>{const r=i.video&&i.video.width,o=i.video&&i.video.height,a=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:a||3}},r&&(i.video.mandatory.maxWidth=r),o&&(i.video.mandatory.maxHeight=o),s.navigator.mediaDevices.getUserMedia(i)})}}}function nse(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function sse(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",n=>{let r;s.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===n.track.id):r={track:n.track};const o=new Event("track");o.track=n.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(n=>{let r;s.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===n.id):r={track:n};const o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else nv(s,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function rse(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const e=function(n,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=n.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:n}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(a,l){let c=n.apply(this,arguments);return c||(c=e(this,a),this._senders.push(c)),c};const r=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(a){r.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const t=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],t.apply(this,[r]),r.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof s=="object"&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const e=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(n=>n._pc=this),i},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function ose(s){if(!s.RTCPeerConnection)return;const e=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[i,n,r]=arguments;if(arguments.length>0&&typeof i=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof i!="function"))return e.apply(this,[]);const o=function(l){const c={};return l.result().forEach(d=>{const u={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach(f=>{u[f]=d.stat(f)}),c[u.id]=u}),c},a=function(l){return new Map(Object.keys(l).map(c=>[c,l[c]]))};if(arguments.length>=2){const l=function(c){n(a(o(c)))};return e.apply(this,[l,i])}return new Promise((l,c)=>{e.apply(this,[function(h){l(a(o(h)))},c])}).then(n,r)}}function ase(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const t=s.RTCPeerConnection.prototype.getSenders;t&&(s.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r});const i=s.RTCPeerConnection.prototype.addTrack;i&&(s.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),s.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>v4(o,r.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const t=s.RTCPeerConnection.prototype.getReceivers;t&&(s.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n}),nv(s,"track",i=>(i.receiver._pc=i.srcElement,i)),s.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(r=>v4(r,n.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype&&"getStats"in s.RTCRtpReceiver.prototype))return;const e=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const i=arguments[0];let n,r,o;return this.getSenders().forEach(a=>{a.track===i&&(n?o=!0:n=a)}),this.getReceivers().forEach(a=>(a.track===i&&(r?o=!0:r=a),a.track===i)),o||n&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function lse(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const t=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(d=>d.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();t.apply(this,arguments);const l=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const i=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const n=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),n.apply(this,arguments)}}function cse(s,e){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&e.version>=65)return lse(s);const t=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const h=t.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(d=>this._reverseStreams[d.id])};const i=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(d=>{if(this.getSenders().find(f=>f.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const d=new s.MediaStream(h.getTracks());this._streams[h.id]=d,this._reverseStreams[d.id]=h,h=d}i.apply(this,[h])};const n=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},s.RTCPeerConnection.prototype.addTrack=function(h,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const u=[].slice.call(arguments,1);if(u.length!==1||!u[0].getTracks().find(g=>g===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[d.id];if(m)m.addTrack(h),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new s.MediaStream([h]);this._streams[d.id]=g,this._reverseStreams[g.id]=d,this.addStream(g)}return this.getSenders().find(g=>g.track===h)};function r(c,h){let d=h.sdp;return Object.keys(c._reverseStreams||[]).forEach(u=>{const f=c._reverseStreams[u],m=c._streams[f.id];d=d.replace(new RegExp(m.id,"g"),f.id)}),new RTCSessionDescription({type:h.type,sdp:d})}function o(c,h){let d=h.sdp;return Object.keys(c._reverseStreams||[]).forEach(u=>{const f=c._reverseStreams[u],m=c._streams[f.id];d=d.replace(new RegExp(f.id,"g"),m.id)}),new RTCSessionDescription({type:h.type,sdp:d})}["createOffer","createAnswer"].forEach(function(c){const h=s.RTCPeerConnection.prototype[c],d={[c](){const u=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[m=>{const g=r(this,m);u[0].apply(null,[g])},m=>{u[1]&&u[1].apply(null,m)},arguments[2]]):h.apply(this,arguments).then(m=>r(this,m))}};s.RTCPeerConnection.prototype[c]=d[c]});const a=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const c=l.get.apply(this);return c.type===""?c:r(this,c)}}),s.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(h._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let u;Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(g=>h.track===g)&&(u=this._streams[f])}),u&&(u.getTracks().length===1?this.removeStream(this._reverseStreams[u.id]):u.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function JV(s,e){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=s.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new(t==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};s.RTCPeerConnection.prototype[t]=n[t]})}function hse(s,e){nv(s,"negotiationneeded",t=>{const i=t.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return t})}const C4=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:hse,shimAddTrackRemoveTrack:cse,shimAddTrackRemoveTrackWithNative:lse,shimGetDisplayMedia:WLe,shimGetSendersWithDtmf:rse,shimGetStats:ose,shimGetUserMedia:ise,shimMediaStream:nse,shimOnTrack:sse,shimPeerConnection:JV,shimSenderReceiverGetStats:ase},Symbol.toStringTag,{value:"Module"}));function HLe(s,e){let t=!1;return s=JSON.parse(JSON.stringify(s)),s.filter(i=>{if(i&&(i.urls||i.url)){let n=i.urls||i.url;i.url&&!i.urls&&pP("RTCIceServer.url","RTCIceServer.urls");const r=typeof n=="string";return r&&(n=[n]),n=n.filter(o=>{if(o.indexOf("stun:")===0)return!1;const a=o.startsWith("turn")&&!o.startsWith("turn:[")&&o.includes("transport=udp");return a&&!t?(t=!0,!0):a&&!t}),delete i.url,i.urls=r?n[0]:n,!!n.length}})}var dse={exports:{}};(function(s){var e={};e.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(function(i){return i.trim()})},e.splitSections=function(t){var i=t.split(`
m=`);return i.map(function(n,r){return(r>0?"m="+n:n).trim()+`\r
`})},e.getDescription=function(t){var i=e.splitSections(t);return i&&i[0]},e.getMediaSections=function(t){var i=e.splitSections(t);return i.shift(),i},e.matchPrefix=function(t,i){return e.splitLines(t).filter(function(n){return n.indexOf(i)===0})},e.parseCandidate=function(t){var i;t.indexOf("a=candidate:")===0?i=t.substring(12).split(" "):i=t.substring(10).split(" ");for(var n={foundation:i[0],component:parseInt(i[1],10),protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]},r=8;r<i.length;r+=2)switch(i[r]){case"raddr":n.relatedAddress=i[r+1];break;case"rport":n.relatedPort=parseInt(i[r+1],10);break;case"tcptype":n.tcpType=i[r+1];break;case"ufrag":n.ufrag=i[r+1],n.usernameFragment=i[r+1];break;default:n[i[r]]=i[r+1];break}return n},e.writeCandidate=function(t){var i=[];i.push(t.foundation),i.push(t.component),i.push(t.protocol.toUpperCase()),i.push(t.priority),i.push(t.address||t.ip),i.push(t.port);var n=t.type;return i.push("typ"),i.push(n),n!=="host"&&t.relatedAddress&&t.relatedPort&&(i.push("raddr"),i.push(t.relatedAddress),i.push("rport"),i.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(i.push("ufrag"),i.push(t.usernameFragment||t.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(t){return t.substr(14).split(" ")},e.parseRtpMap=function(t){var i=t.substr(9).split(" "),n={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),n.name=i[0],n.clockRate=parseInt(i[1],10),n.channels=i.length===3?parseInt(i[2],10):1,n.numChannels=n.channels,n},e.writeRtpMap=function(t){var i=t.payloadType;t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType);var n=t.channels||t.numChannels||1;return"a=rtpmap:"+i+" "+t.name+"/"+t.clockRate+(n!==1?"/"+n:"")+`\r
`},e.parseExtmap=function(t){var i=t.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+`\r
`},e.parseFmtp=function(t){for(var i={},n,r=t.substr(t.indexOf(" ")+1).split(";"),o=0;o<r.length;o++)n=r[o].trim().split("="),i[n[0].trim()]=n[1];return i},e.writeFmtp=function(t){var i="",n=t.payloadType;if(t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var r=[];Object.keys(t.parameters).forEach(function(o){t.parameters[o]?r.push(o+"="+t.parameters[o]):r.push(o)}),i+="a=fmtp:"+n+" "+r.join(";")+`\r
`}return i},e.parseRtcpFb=function(t){var i=t.substr(t.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(t){var i="",n=t.payloadType;return t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(function(r){i+="a=rtcp-fb:"+n+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(t){var i=t.indexOf(" "),n={ssrc:parseInt(t.substr(7,i-7),10)},r=t.indexOf(":",i);return r>-1?(n.attribute=t.substr(i+1,r-i-1),n.value=t.substr(r+1)):n.attribute=t.substr(i+1),n},e.parseSsrcGroup=function(t){var i=t.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(function(n){return parseInt(n,10)})}},e.getMid=function(t){var i=e.matchPrefix(t,"a=mid:")[0];if(i)return i.substr(6)},e.parseFingerprint=function(t){var i=t.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1]}},e.getDtlsParameters=function(t,i){var n=e.matchPrefix(t+i,"a=fingerprint:");return{role:"auto",fingerprints:n.map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,i){var n="a=setup:"+i+`\r
`;return t.fingerprints.forEach(function(r){n+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),n},e.parseCryptoLine=function(t){var i=t.substr(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;var i=t.substr(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,i){var n=e.matchPrefix(t+i,"a=crypto:");return n.map(e.parseCryptoLine)},e.getIceParameters=function(t,i){var n=e.matchPrefix(t+i,"a=ice-ufrag:")[0],r=e.matchPrefix(t+i,"a=ice-pwd:")[0];return n&&r?{usernameFragment:n.substr(12),password:r.substr(10)}:null},e.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`},e.parseRtpParameters=function(t){for(var i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=e.splitLines(t),r=n[0].split(" "),o=3;o<r.length;o++){var a=r[o],l=e.matchPrefix(t,"a=rtpmap:"+a+" ")[0];if(l){var c=e.parseRtpMap(l),h=e.matchPrefix(t,"a=fmtp:"+a+" ");switch(c.parameters=h.length?e.parseFmtp(h[0]):{},c.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+a+" ").map(e.parseRtcpFb),i.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(c.name.toUpperCase());break}}}return e.matchPrefix(t,"a=extmap:").forEach(function(d){i.headerExtensions.push(e.parseExtmap(d))}),i},e.writeRtpDescription=function(t,i){var n="";n+="m="+t+" ",n+=i.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=i.codecs.map(function(o){return o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType}).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(function(o){n+=e.writeRtpMap(o),n+=e.writeFmtp(o),n+=e.writeRtcpFb(o)});var r=0;return i.codecs.forEach(function(o){o.maxptime>r&&(r=o.maxptime)}),r>0&&(n+="a=maxptime:"+r+`\r
`),n+=`a=rtcp-mux\r
`,i.headerExtensions&&i.headerExtensions.forEach(function(o){n+=e.writeExtmap(o)}),n},e.parseRtpEncodingParameters=function(t){var i=[],n=e.parseRtpParameters(t),r=n.fecMechanisms.indexOf("RED")!==-1,o=n.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(t,"a=ssrc:").map(function(u){return e.parseSsrcMedia(u)}).filter(function(u){return u.attribute==="cname"}),l=a.length>0&&a[0].ssrc,c,h=e.matchPrefix(t,"a=ssrc-group:FID").map(function(u){var f=u.substr(17).split(" ");return f.map(function(m){return parseInt(m,10)})});h.length>0&&h[0].length>1&&h[0][0]===l&&(c=h[0][1]),n.codecs.forEach(function(u){if(u.name.toUpperCase()==="RTX"&&u.parameters.apt){var f={ssrc:l,codecPayloadType:parseInt(u.parameters.apt,10)};l&&c&&(f.rtx={ssrc:c}),i.push(f),r&&(f=JSON.parse(JSON.stringify(f)),f.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},i.push(f))}}),i.length===0&&l&&i.push({ssrc:l});var d=e.matchPrefix(t,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substr(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substr(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(function(u){u.maxBitrate=d})),i},e.parseRtcpParameters=function(t){var i={},n=e.matchPrefix(t,"a=ssrc:").map(function(a){return e.parseSsrcMedia(a)}).filter(function(a){return a.attribute==="cname"})[0];n&&(i.cname=n.value,i.ssrc=n.ssrc);var r=e.matchPrefix(t,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=r.length===0;var o=e.matchPrefix(t,"a=rtcp-mux");return i.mux=o.length>0,i},e.parseMsid=function(t){var i,n=e.matchPrefix(t,"a=msid:");if(n.length===1)return i=n[0].substr(7).split(" "),{stream:i[0],track:i[1]};var r=e.matchPrefix(t,"a=ssrc:").map(function(o){return e.parseSsrcMedia(o)}).filter(function(o){return o.attribute==="msid"});if(r.length>0)return i=r[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(t){var i=e.parseMLine(t),n=e.matchPrefix(t,"a=max-message-size:"),r;n.length>0&&(r=parseInt(n[0].substr(19),10)),isNaN(r)&&(r=65536);var o=e.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:i.fmt,maxMessageSize:r};var a=e.matchPrefix(t,"a=sctpmap:");if(a.length>0){var l=e.matchPrefix(t,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:r}}},e.writeSctpDescription=function(t,i){var n=[];return t.protocol!=="DTLS/SCTP"?n=["m="+t.kind+" 9 "+t.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:n=["m="+t.kind+" 9 "+t.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&n.push("a=max-message-size:"+i.maxMessageSize+`\r
`),n.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,21)},e.writeSessionBoilerplate=function(t,i,n){var r,o=i!==void 0?i:2;t?r=t:r=e.generateSessionId();var a=n||"thisisadapterortc";return`v=0\r
o=`+a+" "+r+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.writeMediaSection=function(t,i,n,r){var o=e.writeRtpDescription(t.kind,i);if(o+=e.writeIceParameters(t.iceGatherer.getLocalParameters()),o+=e.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),n==="offer"?"actpass":"active"),o+="a=mid:"+t.mid+`\r
`,t.direction?o+="a="+t.direction+`\r
`:t.rtpSender&&t.rtpReceiver?o+=`a=sendrecv\r
`:t.rtpSender?o+=`a=sendonly\r
`:t.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,t.rtpSender){var a="msid:"+r.id+" "+t.rtpSender.track.id+`\r
`;o+="a="+a,o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+a,t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+`\r
`,t.rtpSender&&t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+`\r
`),o},e.getDirection=function(t,i){for(var n=e.splitLines(t),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(t){var i=e.splitLines(t),n=i[0].split(" ");return n[0].substr(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){var i=e.splitLines(t),n=i[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},e.parseOLine=function(t){var i=e.matchPrefix(t,"o=")[0],n=i.substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;for(var i=e.splitLines(t),n=0;n<i.length;n++)if(i[n].length<2||i[n].charAt(1)!=="=")return!1;return!0},s.exports=e})(dse);var use=dse.exports;const TR=uP(use);var ti=use;function QLe(s){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[s.type]||s.type}function w4(s,e,t,i,n){var r=ti.writeRtpDescription(s.kind,e);if(r+=ti.writeIceParameters(s.iceGatherer.getLocalParameters()),r+=ti.writeDtlsParameters(s.dtlsTransport.getLocalParameters(),t==="offer"?"actpass":n||"active"),r+="a=mid:"+s.mid+`\r
`,s.rtpSender&&s.rtpReceiver?r+=`a=sendrecv\r
`:s.rtpSender?r+=`a=sendonly\r
`:s.rtpReceiver?r+=`a=recvonly\r
`:r+=`a=inactive\r
`,s.rtpSender){var o=s.rtpSender._initialTrackId||s.rtpSender.track.id;s.rtpSender._initialTrackId=o;var a="msid:"+(i?i.id:"-")+" "+o+`\r
`;r+="a="+a,r+="a=ssrc:"+s.sendEncodingParameters[0].ssrc+" "+a,s.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" "+a,r+="a=ssrc-group:FID "+s.sendEncodingParameters[0].ssrc+" "+s.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return r+="a=ssrc:"+s.sendEncodingParameters[0].ssrc+" cname:"+ti.localCName+`\r
`,s.rtpSender&&s.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" cname:"+ti.localCName+`\r
`),r}function KLe(s,e){var t=!1;return s=JSON.parse(JSON.stringify(s)),s.filter(function(i){if(i&&(i.urls||i.url)){var n=i.urls||i.url;i.url&&!i.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r=typeof n=="string";return r&&(n=[n]),n=n.filter(function(o){var a=o.indexOf("turn:")===0&&o.indexOf("transport=udp")!==-1&&o.indexOf("turn:[")===-1&&!t;return a?(t=!0,!0):o.indexOf("stun:")===0&&e>=14393&&o.indexOf("?transport=udp")===-1}),delete i.url,i.urls=r?n[0]:n,!!n.length}})}function ZT(s,e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(r,o){r=parseInt(r,10);for(var a=0;a<o.length;a++)if(o[a].payloadType===r||o[a].preferredPayloadType===r)return o[a]},n=function(r,o,a,l){var c=i(r.parameters.apt,a),h=i(o.parameters.apt,l);return c&&h&&c.name.toLowerCase()===h.name.toLowerCase()};return s.codecs.forEach(function(r){for(var o=0;o<e.codecs.length;o++){var a=e.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if(r.name.toLowerCase()==="rtx"&&r.parameters&&a.parameters.apt&&!n(r,a,s.codecs,e.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(r.numChannels,a.numChannels),t.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(l){for(var c=0;c<r.rtcpFeedback.length;c++)if(r.rtcpFeedback[c].type===l.type&&r.rtcpFeedback[c].parameter===l.parameter)return!0;return!1});break}}}),s.headerExtensions.forEach(function(r){for(var o=0;o<e.headerExtensions.length;o++){var a=e.headerExtensions[o];if(r.uri===a.uri){t.headerExtensions.push(a);break}}}),t}function S4(s,e,t){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[e][s].indexOf(t)!==-1}function EN(s,e){var t=s.getRemoteCandidates().find(function(i){return e.foundation===i.foundation&&e.ip===i.ip&&e.port===i.port&&e.priority===i.priority&&e.protocol===i.protocol&&e.type===i.type});return t||s.addRemoteCandidate(e),!t}function Ho(s,e){var t=new Error(e);return t.name=s,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[s],t}var YLe=function(s,e){function t(l,c){c.addTrack(l),c.dispatchEvent(new s.MediaStreamTrackEvent("addtrack",{track:l}))}function i(l,c){c.removeTrack(l),c.dispatchEvent(new s.MediaStreamTrackEvent("removetrack",{track:l}))}function n(l,c,h,d){var u=new Event("track");u.track=c,u.receiver=h,u.transceiver={receiver:h},u.streams=d,s.setTimeout(function(){l._dispatchEvent("track",u)})}var r=function(l){var c=this,h=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(u){c[u]=h[u].bind(h)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",l=JSON.parse(JSON.stringify(l||{})),this.usingBundle=l.bundlePolicy==="max-bundle",l.rtcpMuxPolicy==="negotiate")throw Ho("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(l.rtcpMuxPolicy||(l.rtcpMuxPolicy="require"),l.iceTransportPolicy){case"all":case"relay":break;default:l.iceTransportPolicy="all";break}switch(l.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:l.bundlePolicy="balanced";break}if(l.iceServers=KLe(l.iceServers||[],e),this._iceGatherers=[],l.iceCandidatePoolSize)for(var d=l.iceCandidatePoolSize;d>0;d--)this._iceGatherers.push(new s.RTCIceGatherer({iceServers:l.iceServers,gatherPolicy:l.iceTransportPolicy}));else l.iceCandidatePoolSize=0;this._config=l,this.transceivers=[],this._sdpSessionId=ti.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(l,c){this._isClosed||(this.dispatchEvent(c),typeof this["on"+l]=="function"&&this["on"+l](c))},r.prototype._emitGatheringStateChange=function(){var l=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",l)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(l,c){var h=this.transceivers.length>0,d={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:l,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&h)d.iceTransport=this.transceivers[0].iceTransport,d.dtlsTransport=this.transceivers[0].dtlsTransport;else{var u=this._createIceAndDtlsTransports();d.iceTransport=u.iceTransport,d.dtlsTransport=u.dtlsTransport}return c||this.transceivers.push(d),d},r.prototype.addTrack=function(l,c){if(this._isClosed)throw Ho("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var h=this.transceivers.find(function(f){return f.track===l});if(h)throw Ho("InvalidAccessError","Track already exists.");for(var d,u=0;u<this.transceivers.length;u++)!this.transceivers[u].track&&this.transceivers[u].kind===l.kind&&(d=this.transceivers[u]);return d||(d=this._createTransceiver(l.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(c)===-1&&this.localStreams.push(c),d.track=l,d.stream=c,d.rtpSender=new s.RTCRtpSender(l,d.dtlsTransport),d.rtpSender},r.prototype.addStream=function(l){var c=this;if(e>=15025)l.getTracks().forEach(function(d){c.addTrack(d,l)});else{var h=l.clone();l.getTracks().forEach(function(d,u){var f=h.getTracks()[u];d.addEventListener("enabled",function(m){f.enabled=m.enabled})}),h.getTracks().forEach(function(d){c.addTrack(d,h)})}},r.prototype.removeTrack=function(l){if(this._isClosed)throw Ho("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(l instanceof s.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var c=this.transceivers.find(function(u){return u.rtpSender===l});if(!c)throw Ho("InvalidAccessError","Sender was not created by this connection.");var h=c.stream;c.rtpSender.stop(),c.rtpSender=null,c.track=null,c.stream=null;var d=this.transceivers.map(function(u){return u.stream});d.indexOf(h)===-1&&this.localStreams.indexOf(h)>-1&&this.localStreams.splice(this.localStreams.indexOf(h),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(l){var c=this;l.getTracks().forEach(function(h){var d=c.getSenders().find(function(u){return u.track===h});d&&c.removeTrack(d)})},r.prototype.getSenders=function(){return this.transceivers.filter(function(l){return!!l.rtpSender}).map(function(l){return l.rtpSender})},r.prototype.getReceivers=function(){return this.transceivers.filter(function(l){return!!l.rtpReceiver}).map(function(l){return l.rtpReceiver})},r.prototype._createIceGatherer=function(l,c){var h=this;if(c&&l>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var d=new s.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(d,"state",{value:"new",writable:!0}),this.transceivers[l].bufferedCandidateEvents=[],this.transceivers[l].bufferCandidates=function(u){var f=!u.candidate||Object.keys(u.candidate).length===0;d.state=f?"completed":"gathering",h.transceivers[l].bufferedCandidateEvents!==null&&h.transceivers[l].bufferedCandidateEvents.push(u)},d.addEventListener("localcandidate",this.transceivers[l].bufferCandidates),d},r.prototype._gather=function(l,c){var h=this,d=this.transceivers[c].iceGatherer;if(!d.onlocalcandidate){var u=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null,d.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates),d.onlocalcandidate=function(f){if(!(h.usingBundle&&c>0)){var m=new Event("icecandidate");m.candidate={sdpMid:l,sdpMLineIndex:c};var g=f.candidate,A=!g||Object.keys(g).length===0;if(A)(d.state==="new"||d.state==="gathering")&&(d.state="completed");else{d.state==="new"&&(d.state="gathering"),g.component=1,g.ufrag=d.getLocalParameters().usernameFragment;var y=ti.writeCandidate(g);m.candidate=Object.assign(m.candidate,ti.parseCandidate(y)),m.candidate.candidate=y,m.candidate.toJSON=function(){return{candidate:m.candidate.candidate,sdpMid:m.candidate.sdpMid,sdpMLineIndex:m.candidate.sdpMLineIndex,usernameFragment:m.candidate.usernameFragment}}}var b=ti.getMediaSections(h._localDescription.sdp);A?b[m.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:b[m.candidate.sdpMLineIndex]+="a="+m.candidate.candidate+`\r
`,h._localDescription.sdp=ti.getDescription(h._localDescription.sdp)+b.join("");var x=h.transceivers.every(function(v){return v.iceGatherer&&v.iceGatherer.state==="completed"});h.iceGatheringState!=="gathering"&&(h.iceGatheringState="gathering",h._emitGatheringStateChange()),A||h._dispatchEvent("icecandidate",m),x&&(h._dispatchEvent("icecandidate",new Event("icecandidate")),h.iceGatheringState="complete",h._emitGatheringStateChange())}},s.setTimeout(function(){u.forEach(function(f){d.onlocalcandidate(f)})},0)}},r.prototype._createIceAndDtlsTransports=function(){var l=this,c=new s.RTCIceTransport(null);c.onicestatechange=function(){l._updateIceConnectionState(),l._updateConnectionState()};var h=new s.RTCDtlsTransport(c);return h.ondtlsstatechange=function(){l._updateConnectionState()},h.onerror=function(){Object.defineProperty(h,"state",{value:"failed",writable:!0}),l._updateConnectionState()},{iceTransport:c,dtlsTransport:h}},r.prototype._disposeIceAndDtlsTransports=function(l){var c=this.transceivers[l].iceGatherer;c&&(delete c.onlocalcandidate,delete this.transceivers[l].iceGatherer);var h=this.transceivers[l].iceTransport;h&&(delete h.onicestatechange,delete this.transceivers[l].iceTransport);var d=this.transceivers[l].dtlsTransport;d&&(delete d.ondtlsstatechange,delete d.onerror,delete this.transceivers[l].dtlsTransport)},r.prototype._transceive=function(l,c,h){var d=ZT(l.localCapabilities,l.remoteCapabilities);c&&l.rtpSender&&(d.encodings=l.sendEncodingParameters,d.rtcp={cname:ti.localCName,compound:l.rtcpParameters.compound},l.recvEncodingParameters.length&&(d.rtcp.ssrc=l.recvEncodingParameters[0].ssrc),l.rtpSender.send(d)),h&&l.rtpReceiver&&d.codecs.length>0&&(l.kind==="video"&&l.recvEncodingParameters&&e<15019&&l.recvEncodingParameters.forEach(function(u){delete u.rtx}),l.recvEncodingParameters.length?d.encodings=l.recvEncodingParameters:d.encodings=[{}],d.rtcp={compound:l.rtcpParameters.compound},l.rtcpParameters.cname&&(d.rtcp.cname=l.rtcpParameters.cname),l.sendEncodingParameters.length&&(d.rtcp.ssrc=l.sendEncodingParameters[0].ssrc),l.rtpReceiver.receive(d))},r.prototype.setLocalDescription=function(l){var c=this;if(["offer","answer"].indexOf(l.type)===-1)return Promise.reject(Ho("TypeError",'Unsupported type "'+l.type+'"'));if(!S4("setLocalDescription",l.type,c.signalingState)||c._isClosed)return Promise.reject(Ho("InvalidStateError","Can not set local "+l.type+" in state "+c.signalingState));var h,d;if(l.type==="offer")h=ti.splitSections(l.sdp),d=h.shift(),h.forEach(function(f,m){var g=ti.parseRtpParameters(f);c.transceivers[m].localCapabilities=g}),c.transceivers.forEach(function(f,m){c._gather(f.mid,m)});else if(l.type==="answer"){h=ti.splitSections(c._remoteDescription.sdp),d=h.shift();var u=ti.matchPrefix(d,"a=ice-lite").length>0;h.forEach(function(f,m){var g=c.transceivers[m],A=g.iceGatherer,y=g.iceTransport,b=g.dtlsTransport,x=g.localCapabilities,v=g.remoteCapabilities,_=ti.isRejected(f)&&ti.matchPrefix(f,"a=bundle-only").length===0;if(!_&&!g.rejected){var C=ti.getIceParameters(f,d),S=ti.getDtlsParameters(f,d);u&&(S.role="server"),(!c.usingBundle||m===0)&&(c._gather(g.mid,m),y.state==="new"&&y.start(A,C,u?"controlling":"controlled"),b.state==="new"&&b.start(S));var M=ZT(x,v);c._transceive(g,M.codecs.length>0,!1)}})}return c._localDescription={type:l.type,sdp:l.sdp},l.type==="offer"?c._updateSignalingState("have-local-offer"):c._updateSignalingState("stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(l){var c=this;if(["offer","answer"].indexOf(l.type)===-1)return Promise.reject(Ho("TypeError",'Unsupported type "'+l.type+'"'));if(!S4("setRemoteDescription",l.type,c.signalingState)||c._isClosed)return Promise.reject(Ho("InvalidStateError","Can not set remote "+l.type+" in state "+c.signalingState));var h={};c.remoteStreams.forEach(function(y){h[y.id]=y});var d=[],u=ti.splitSections(l.sdp),f=u.shift(),m=ti.matchPrefix(f,"a=ice-lite").length>0,g=ti.matchPrefix(f,"a=group:BUNDLE ").length>0;c.usingBundle=g;var A=ti.matchPrefix(f,"a=ice-options:")[0];return A?c.canTrickleIceCandidates=A.substr(14).split(" ").indexOf("trickle")>=0:c.canTrickleIceCandidates=!1,u.forEach(function(y,b){var x=ti.splitLines(y),v=ti.getKind(y),_=ti.isRejected(y)&&ti.matchPrefix(y,"a=bundle-only").length===0,C=x[0].substr(2).split(" ")[2],S=ti.getDirection(y,f),M=ti.parseMsid(y),L=ti.getMid(y)||ti.generateIdentifier();if(_||v==="application"&&(C==="DTLS/SCTP"||C==="UDP/DTLS/SCTP")){c.transceivers[b]={mid:L,kind:v,protocol:C,rejected:!0};return}!_&&c.transceivers[b]&&c.transceivers[b].rejected&&(c.transceivers[b]=c._createTransceiver(v,!0));var w,E,B,P,k,X,F,H,W,se=ti.parseRtpParameters(y),de,be;_||(de=ti.getIceParameters(y,f),be=ti.getDtlsParameters(y,f),be.role="client"),F=ti.parseRtpEncodingParameters(y);var Pe=ti.parseRtcpParameters(y),Oe=ti.matchPrefix(y,"a=end-of-candidates",f).length>0,ae=ti.matchPrefix(y,"a=candidate:").map(function(ot){return ti.parseCandidate(ot)}).filter(function(ot){return ot.component===1});if((l.type==="offer"||l.type==="answer")&&!_&&g&&b>0&&c.transceivers[b]&&(c._disposeIceAndDtlsTransports(b),c.transceivers[b].iceGatherer=c.transceivers[0].iceGatherer,c.transceivers[b].iceTransport=c.transceivers[0].iceTransport,c.transceivers[b].dtlsTransport=c.transceivers[0].dtlsTransport,c.transceivers[b].rtpSender&&c.transceivers[b].rtpSender.setTransport(c.transceivers[0].dtlsTransport),c.transceivers[b].rtpReceiver&&c.transceivers[b].rtpReceiver.setTransport(c.transceivers[0].dtlsTransport)),l.type==="offer"&&!_){w=c.transceivers[b]||c._createTransceiver(v),w.mid=L,w.iceGatherer||(w.iceGatherer=c._createIceGatherer(b,g)),ae.length&&w.iceTransport.state==="new"&&(Oe&&(!g||b===0)?w.iceTransport.setRemoteCandidates(ae):ae.forEach(function(ot){EN(w.iceTransport,ot)})),H=s.RTCRtpReceiver.getCapabilities(v),e<15019&&(H.codecs=H.codecs.filter(function(ot){return ot.name!=="rtx"})),X=w.sendEncodingParameters||[{ssrc:(2*b+2)*1001}];var Ae=!1;if(S==="sendrecv"||S==="sendonly"){if(Ae=!w.rtpReceiver,k=w.rtpReceiver||new s.RTCRtpReceiver(w.dtlsTransport,v),Ae){var Se;W=k.track,M&&M.stream==="-"||(M?(h[M.stream]||(h[M.stream]=new s.MediaStream,Object.defineProperty(h[M.stream],"id",{get:function(){return M.stream}})),Object.defineProperty(W,"id",{get:function(){return M.track}}),Se=h[M.stream]):(h.default||(h.default=new s.MediaStream),Se=h.default)),Se&&(t(W,Se),w.associatedRemoteMediaStreams.push(Se)),d.push([W,k,Se])}}else w.rtpReceiver&&w.rtpReceiver.track&&(w.associatedRemoteMediaStreams.forEach(function(ot){var Ct=ot.getTracks().find(function(zt){return zt.id===w.rtpReceiver.track.id});Ct&&i(Ct,ot)}),w.associatedRemoteMediaStreams=[]);w.localCapabilities=H,w.remoteCapabilities=se,w.rtpReceiver=k,w.rtcpParameters=Pe,w.sendEncodingParameters=X,w.recvEncodingParameters=F,c._transceive(c.transceivers[b],!1,Ae)}else if(l.type==="answer"&&!_){w=c.transceivers[b],E=w.iceGatherer,B=w.iceTransport,P=w.dtlsTransport,k=w.rtpReceiver,X=w.sendEncodingParameters,H=w.localCapabilities,c.transceivers[b].recvEncodingParameters=F,c.transceivers[b].remoteCapabilities=se,c.transceivers[b].rtcpParameters=Pe,ae.length&&B.state==="new"&&((m||Oe)&&(!g||b===0)?B.setRemoteCandidates(ae):ae.forEach(function(ot){EN(w.iceTransport,ot)})),(!g||b===0)&&(B.state==="new"&&B.start(E,de,"controlling"),P.state==="new"&&P.start(be));var Le=ZT(w.localCapabilities,w.remoteCapabilities),st=Le.codecs.filter(function(ot){return ot.name.toLowerCase()==="rtx"}).length;!st&&w.sendEncodingParameters[0].rtx&&delete w.sendEncodingParameters[0].rtx,c._transceive(w,S==="sendrecv"||S==="recvonly",S==="sendrecv"||S==="sendonly"),k&&(S==="sendrecv"||S==="sendonly")?(W=k.track,M?(h[M.stream]||(h[M.stream]=new s.MediaStream),t(W,h[M.stream]),d.push([W,k,h[M.stream]])):(h.default||(h.default=new s.MediaStream),t(W,h.default),d.push([W,k,h.default]))):delete w.rtpReceiver}}),c._dtlsRole===void 0&&(c._dtlsRole=l.type==="offer"?"active":"passive"),c._remoteDescription={type:l.type,sdp:l.sdp},l.type==="offer"?c._updateSignalingState("have-remote-offer"):c._updateSignalingState("stable"),Object.keys(h).forEach(function(y){var b=h[y];if(b.getTracks().length){if(c.remoteStreams.indexOf(b)===-1){c.remoteStreams.push(b);var x=new Event("addstream");x.stream=b,s.setTimeout(function(){c._dispatchEvent("addstream",x)})}d.forEach(function(v){var _=v[0],C=v[1];b.id===v[2].id&&n(c,_,C,[b])})}}),d.forEach(function(y){y[2]||n(c,y[0],y[1],[])}),s.setTimeout(function(){c&&c.transceivers&&c.transceivers.forEach(function(y){y.iceTransport&&y.iceTransport.state==="new"&&y.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),y.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach(function(l){l.iceTransport&&l.iceTransport.stop(),l.dtlsTransport&&l.dtlsTransport.stop(),l.rtpSender&&l.rtpSender.stop(),l.rtpReceiver&&l.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(l){this.signalingState=l;var c=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",c)},r.prototype._maybeFireNegotiationNeeded=function(){var l=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,s.setTimeout(function(){if(l.needNegotiation){l.needNegotiation=!1;var c=new Event("negotiationneeded");l._dispatchEvent("negotiationneeded",c)}},0))},r.prototype._updateIceConnectionState=function(){var l,c={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&!d.rejected&&c[d.iceTransport.state]++}),l="new",c.failed>0?l="failed":c.checking>0?l="checking":c.disconnected>0?l="disconnected":c.new>0?l="new":c.connected>0?l="connected":c.completed>0&&(l="completed"),l!==this.iceConnectionState){this.iceConnectionState=l;var h=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",h)}},r.prototype._updateConnectionState=function(){var l,c={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&d.dtlsTransport&&!d.rejected&&(c[d.iceTransport.state]++,c[d.dtlsTransport.state]++)}),c.connected+=c.completed,l="new",c.failed>0?l="failed":c.connecting>0?l="connecting":c.disconnected>0?l="disconnected":c.new>0?l="new":c.connected>0&&(l="connected"),l!==this.connectionState){this.connectionState=l;var h=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",h)}},r.prototype.createOffer=function(){var l=this;if(l._isClosed)return Promise.reject(Ho("InvalidStateError","Can not call createOffer after close"));var c=l.transceivers.filter(function(m){return m.kind==="audio"}).length,h=l.transceivers.filter(function(m){return m.kind==="video"}).length,d=arguments[0];if(d){if(d.mandatory||d.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");d.offerToReceiveAudio!==void 0&&(d.offerToReceiveAudio===!0?c=1:d.offerToReceiveAudio===!1?c=0:c=d.offerToReceiveAudio),d.offerToReceiveVideo!==void 0&&(d.offerToReceiveVideo===!0?h=1:d.offerToReceiveVideo===!1?h=0:h=d.offerToReceiveVideo)}for(l.transceivers.forEach(function(m){m.kind==="audio"?(c--,c<0&&(m.wantReceive=!1)):m.kind==="video"&&(h--,h<0&&(m.wantReceive=!1))});c>0||h>0;)c>0&&(l._createTransceiver("audio"),c--),h>0&&(l._createTransceiver("video"),h--);var u=ti.writeSessionBoilerplate(l._sdpSessionId,l._sdpSessionVersion++);l.transceivers.forEach(function(m,g){var A=m.track,y=m.kind,b=m.mid||ti.generateIdentifier();m.mid=b,m.iceGatherer||(m.iceGatherer=l._createIceGatherer(g,l.usingBundle));var x=s.RTCRtpSender.getCapabilities(y);e<15019&&(x.codecs=x.codecs.filter(function(_){return _.name!=="rtx"})),x.codecs.forEach(function(_){_.name==="H264"&&_.parameters["level-asymmetry-allowed"]===void 0&&(_.parameters["level-asymmetry-allowed"]="1"),m.remoteCapabilities&&m.remoteCapabilities.codecs&&m.remoteCapabilities.codecs.forEach(function(C){_.name.toLowerCase()===C.name.toLowerCase()&&_.clockRate===C.clockRate&&(_.preferredPayloadType=C.payloadType)})}),x.headerExtensions.forEach(function(_){var C=m.remoteCapabilities&&m.remoteCapabilities.headerExtensions||[];C.forEach(function(S){_.uri===S.uri&&(_.id=S.id)})});var v=m.sendEncodingParameters||[{ssrc:(2*g+1)*1001}];A&&e>=15019&&y==="video"&&!v[0].rtx&&(v[0].rtx={ssrc:v[0].ssrc+1}),m.wantReceive&&(m.rtpReceiver=new s.RTCRtpReceiver(m.dtlsTransport,y)),m.localCapabilities=x,m.sendEncodingParameters=v}),l._config.bundlePolicy!=="max-compat"&&(u+="a=group:BUNDLE "+l.transceivers.map(function(m){return m.mid}).join(" ")+`\r
`),u+=`a=ice-options:trickle\r
`,l.transceivers.forEach(function(m,g){u+=w4(m,m.localCapabilities,"offer",m.stream,l._dtlsRole),u+=`a=rtcp-rsize\r
`,m.iceGatherer&&l.iceGatheringState!=="new"&&(g===0||!l.usingBundle)&&(m.iceGatherer.getLocalCandidates().forEach(function(A){A.component=1,u+="a="+ti.writeCandidate(A)+`\r
`}),m.iceGatherer.state==="completed"&&(u+=`a=end-of-candidates\r
`))});var f=new s.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(f)},r.prototype.createAnswer=function(){var l=this;if(l._isClosed)return Promise.reject(Ho("InvalidStateError","Can not call createAnswer after close"));if(!(l.signalingState==="have-remote-offer"||l.signalingState==="have-local-pranswer"))return Promise.reject(Ho("InvalidStateError","Can not call createAnswer in signalingState "+l.signalingState));var c=ti.writeSessionBoilerplate(l._sdpSessionId,l._sdpSessionVersion++);l.usingBundle&&(c+="a=group:BUNDLE "+l.transceivers.map(function(u){return u.mid}).join(" ")+`\r
`),c+=`a=ice-options:trickle\r
`;var h=ti.getMediaSections(l._remoteDescription.sdp).length;l.transceivers.forEach(function(u,f){if(!(f+1>h)){if(u.rejected){u.kind==="application"?u.protocol==="DTLS/SCTP"?c+=`m=application 0 DTLS/SCTP 5000\r
`:c+="m=application 0 "+u.protocol+` webrtc-datachannel\r
`:u.kind==="audio"?c+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:u.kind==="video"&&(c+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),c+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+u.mid+`\r
`;return}if(u.stream){var m;u.kind==="audio"?m=u.stream.getAudioTracks()[0]:u.kind==="video"&&(m=u.stream.getVideoTracks()[0]),m&&e>=15019&&u.kind==="video"&&!u.sendEncodingParameters[0].rtx&&(u.sendEncodingParameters[0].rtx={ssrc:u.sendEncodingParameters[0].ssrc+1})}var g=ZT(u.localCapabilities,u.remoteCapabilities),A=g.codecs.filter(function(y){return y.name.toLowerCase()==="rtx"}).length;!A&&u.sendEncodingParameters[0].rtx&&delete u.sendEncodingParameters[0].rtx,c+=w4(u,g,"answer",u.stream,l._dtlsRole),u.rtcpParameters&&u.rtcpParameters.reducedSize&&(c+=`a=rtcp-rsize\r
`)}});var d=new s.RTCSessionDescription({type:"answer",sdp:c});return Promise.resolve(d)},r.prototype.addIceCandidate=function(l){var c=this,h;return l&&!(l.sdpMLineIndex!==void 0||l.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(d,u){if(c._remoteDescription)if(!l||l.candidate==="")for(var f=0;f<c.transceivers.length&&!(!c.transceivers[f].rejected&&(c.transceivers[f].iceTransport.addRemoteCandidate({}),h=ti.getMediaSections(c._remoteDescription.sdp),h[f]+=`a=end-of-candidates\r
`,c._remoteDescription.sdp=ti.getDescription(c._remoteDescription.sdp)+h.join(""),c.usingBundle));f++);else{var m=l.sdpMLineIndex;if(l.sdpMid){for(var g=0;g<c.transceivers.length;g++)if(c.transceivers[g].mid===l.sdpMid){m=g;break}}var A=c.transceivers[m];if(A){if(A.rejected)return d();var y=Object.keys(l.candidate).length>0?ti.parseCandidate(l.candidate):{};if(y.protocol==="tcp"&&(y.port===0||y.port===9)||y.component&&y.component!==1)return d();if((m===0||m>0&&A.iceTransport!==c.transceivers[0].iceTransport)&&!EN(A.iceTransport,y))return u(Ho("OperationError","Can not add ICE candidate"));var b=l.candidate.trim();b.indexOf("a=")===0&&(b=b.substr(2)),h=ti.getMediaSections(c._remoteDescription.sdp),h[m]+="a="+(y.type?b:"end-of-candidates")+`\r
`,c._remoteDescription.sdp=ti.getDescription(c._remoteDescription.sdp)+h.join("")}else return u(Ho("OperationError","Can not add ICE candidate"))}else return u(Ho("InvalidStateError","Can not add ICE candidate without a remote description"));d()})},r.prototype.getStats=function(l){if(l&&l instanceof s.MediaStreamTrack){var c=null;if(this.transceivers.forEach(function(d){d.rtpSender&&d.rtpSender.track===l?c=d.rtpSender:d.rtpReceiver&&d.rtpReceiver.track===l&&(c=d.rtpReceiver)}),!c)throw Ho("InvalidAccessError","Invalid selector.");return c.getStats()}var h=[];return this.transceivers.forEach(function(d){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(u){d[u]&&h.push(d[u].getStats())})}),Promise.all(h).then(function(d){var u=new Map;return d.forEach(function(f){f.forEach(function(m){u.set(m.id,m)})}),u})};var o=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];o.forEach(function(l){var c=s[l];if(c&&c.prototype&&c.prototype.getStats){var h=c.prototype.getStats;c.prototype.getStats=function(){return h.apply(this).then(function(d){var u=new Map;return Object.keys(d).forEach(function(f){d[f].type=QLe(d[f]),u.set(f,d[f])}),u})}}});var a=["createOffer","createAnswer"];return a.forEach(function(l){var c=r.prototype[l];r.prototype[l]=function(){var h=arguments;return typeof h[0]=="function"||typeof h[1]=="function"?c.apply(this,[arguments[2]]).then(function(d){typeof h[0]=="function"&&h[0].apply(null,[d])},function(d){typeof h[1]=="function"&&h[1].apply(null,[d])}):c.apply(this,arguments)}}),a=["setLocalDescription","setRemoteDescription","addIceCandidate"],a.forEach(function(l){var c=r.prototype[l];r.prototype[l]=function(){var h=arguments;return typeof h[1]=="function"||typeof h[2]=="function"?c.apply(this,arguments).then(function(){typeof h[1]=="function"&&h[1].apply(null)},function(d){typeof h[2]=="function"&&h[2].apply(null,[d])}):c.apply(this,arguments)}}),["getStats"].forEach(function(l){var c=r.prototype[l];r.prototype[l]=function(){var h=arguments;return typeof h[1]=="function"?c.apply(this,arguments).then(function(){typeof h[1]=="function"&&h[1].apply(null)}):c.apply(this,arguments)}}),r};const JLe=uP(YLe);function pse(s){const e=s&&s.navigator,t=function(n){return{name:{PermissionDeniedError:"NotAllowedError"}[n.name]||n.name,message:n.message,constraint:n.constraint,toString(){return this.name}}},i=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(n){return i(n).catch(r=>Promise.reject(t(r)))}}function fse(s){"getDisplayMedia"in s.navigator&&s.navigator.mediaDevices&&(s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||(s.navigator.mediaDevices.getDisplayMedia=s.navigator.getDisplayMedia.bind(s.navigator)))}function jV(s,e){if(s.RTCIceGatherer&&(s.RTCIceCandidate||(s.RTCIceCandidate=function(n){return n}),s.RTCSessionDescription||(s.RTCSessionDescription=function(n){return n}),e.version<15025)){const i=Object.getOwnPropertyDescriptor(s.MediaStreamTrack.prototype,"enabled");Object.defineProperty(s.MediaStreamTrack.prototype,"enabled",{set(n){i.set.call(this,n);const r=new Event("enabled");r.enabled=n,this.dispatchEvent(r)}})}s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)&&Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new s.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),s.RTCDtmfSender&&!s.RTCDTMFSender&&(s.RTCDTMFSender=s.RTCDtmfSender);const t=JLe(s,e.version);s.RTCPeerConnection=function(n){return n&&n.iceServers&&(n.iceServers=HLe(n.iceServers,e.version),KO("ICE servers after filtering:",n.iceServers)),new t(n)},s.RTCPeerConnection.prototype=t.prototype}function mse(s){s.RTCRtpSender&&!("replaceTrack"in s.RTCRtpSender.prototype)&&(s.RTCRtpSender.prototype.replaceTrack=s.RTCRtpSender.prototype.setTrack)}const M4=Object.freeze(Object.defineProperty({__proto__:null,shimGetDisplayMedia:fse,shimGetUserMedia:pse,shimPeerConnection:jV,shimReplaceTrack:mse},Symbol.toStringTag,{value:"Module"}));function gse(s,e){const t=s&&s.navigator,i=s&&s.MediaStreamTrack;if(t.getUserMedia=function(n,r,o){pP("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(n).then(r,o)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const n=function(o,a,l){a in o&&!(l in o)&&(o[l]=o[a],delete o[a])},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),n(o.audio,"autoGainControl","mozAutoGainControl"),n(o.audio,"noiseSuppression","mozNoiseSuppression")),r(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return n(a,"mozAutoGainControl","autoGainControl"),n(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),n(a,"autoGainControl","mozAutoGainControl"),n(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function jLe(s,e){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,s.navigator.mediaDevices.getUserMedia(i)})}function Ase(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function qV(s,e){if(typeof s!="object"||!(s.RTCPeerConnection||s.mozRTCPeerConnection))return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=s.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};s.RTCPeerConnection.prototype[n]=o[n]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[r,o,a]=arguments;return i.apply(this,[r||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(c=>{c.type=t[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((h,d)=>{l.set(d,Object.assign({},h,{type:t[h.type]||h.type}))})}return l}).then(o,a)}}function yse(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const e=s.RTCPeerConnection.prototype.getSenders;e&&(s.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n});const t=s.RTCPeerConnection.prototype.addTrack;t&&(s.RTCPeerConnection.prototype.addTrack=function(){const n=t.apply(this,arguments);return n._pc=this,n}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function bse(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const e=s.RTCPeerConnection.prototype.getReceivers;e&&(s.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(n=>n._pc=this),i}),nv(s,"track",t=>(t.receiver._pc=t.srcElement,t)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function xse(s){!s.RTCPeerConnection||"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(t){pP("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&t.getTracks().includes(i.track)&&this.removeTrack(i)})})}function vse(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function _se(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.addTransceiver;e&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const i=arguments[1],n=i&&"sendEncodings"in i;n&&i.sendEncodings.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(n){const{sender:o}=r,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i.sendEncodings,o.sendEncodings=i.sendEncodings,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return r})}function Cse(s){if(!(typeof s=="object"&&s.RTCRtpSender))return;const e=s.RTCRtpSender.prototype.getParameters;e&&(s.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function wse(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Sse(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const I4=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:_se,shimCreateAnswer:Sse,shimCreateOffer:wse,shimGetDisplayMedia:jLe,shimGetParameters:Cse,shimGetUserMedia:gse,shimOnTrack:Ase,shimPeerConnection:qV,shimRTCDataChannel:vse,shimReceiverGetStats:bse,shimRemoveStream:xse,shimSenderGetStats:yse},Symbol.toStringTag,{value:"Module"}));function Mse(s){if(!(typeof s!="object"||!s.RTCPeerConnection)){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const e=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(n=>e.call(this,n,i)),i.getVideoTracks().forEach(n=>e.call(this,n,i))},s.RTCPeerConnection.prototype.addTrack=function(i,...n){return n&&n.forEach(r=>{this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]}),e.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);const n=t.getTracks();this.getSenders().forEach(r=>{n.includes(r.track)&&this.removeTrack(r)})})}}function Ise(s){if(!(typeof s!="object"||!s.RTCPeerConnection)&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(n=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(n))return;this._remoteStreams.push(n);const r=new Event("addstream");r.stream=n,this.dispatchEvent(r)})})}});const e=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(r=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(r)>=0)return;i._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function Tse(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const e=s.RTCPeerConnection.prototype,t=e.createOffer,i=e.createAnswer,n=e.setLocalDescription,r=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(c,h){const d=arguments.length>=2?arguments[2]:arguments[0],u=t.apply(this,[d]);return h?(u.then(c,h),Promise.resolve()):u},e.createAnswer=function(c,h){const d=arguments.length>=2?arguments[2]:arguments[0],u=i.apply(this,[d]);return h?(u.then(c,h),Promise.resolve()):u};let a=function(l,c,h){const d=n.apply(this,[l]);return h?(d.then(c,h),Promise.resolve()):d};e.setLocalDescription=a,a=function(l,c,h){const d=r.apply(this,[l]);return h?(d.then(c,h),Promise.resolve()):d},e.setRemoteDescription=a,a=function(l,c,h){const d=o.apply(this,[l]);return h?(d.then(c,h),Promise.resolve()):d},e.addIceCandidate=a}function Ese(s){const e=s&&s.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,i=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=n=>i(Rse(n))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(i,n,r){e.mediaDevices.getUserMedia(i).then(n,r)}.bind(e))}function Rse(s){return s&&s.video!==void 0?Object.assign({},s,{video:tse(s.video)}):s}function Lse(s){if(!s.RTCPeerConnection)return;const e=s.RTCPeerConnection;s.RTCPeerConnection=function(i,n){if(i&&i.iceServers){const r=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(pP("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,r.push(a)):r.push(i.iceServers[o])}i.iceServers=r}return new e(i,n)},s.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Bse(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Pse(s){const e=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const n=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):i.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio"),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video")}return e.apply(this,arguments)}}function Gse(s){typeof s!="object"||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}const T4=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Gse,shimCallbacksAPI:Tse,shimConstraints:Rse,shimCreateOfferLegacy:Pse,shimGetUserMedia:Ese,shimLocalStreamsAPI:Mse,shimRTCIceServerUrls:Lse,shimRemoteStreamsAPI:Ise,shimTrackEventTransceiver:Bse},Symbol.toStringTag,{value:"Module"}));function ER(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const e=s.RTCIceCandidate;s.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const n=new e(i),r=TR.parseCandidate(i.candidate),o=Object.assign(n,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(i)},s.RTCIceCandidate.prototype=e.prototype,nv(s,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new s.RTCIceCandidate(t.candidate),writable:"false"}),t))}function dC(s,e){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(a){if(!a||!a.sdp)return!1;const l=TR.splitSections(a.sdp);return l.shift(),l.some(c=>{const h=TR.parseMLine(c);return h&&h.kind==="application"&&h.protocol.indexOf("SCTP")!==-1})},i=function(a){const l=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const c=parseInt(l[1],10);return c!==c?-1:c},n=function(a){let l=65536;return e.browser==="firefox"&&(e.version<57?a===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},r=function(a,l){let c=65536;e.browser==="firefox"&&e.version===57&&(c=65535);const h=TR.matchPrefix(a.sdp,"a=max-message-size:");return h.length>0?c=parseInt(h[0].substr(19),10):e.browser==="firefox"&&l!==-1&&(c=2147483637),c},o=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const l=i(arguments[0]),c=n(l),h=r(arguments[0],l);let d;c===0&&h===0?d=Number.POSITIVE_INFINITY:c===0||h===0?d=Math.max(c,h):d=Math.min(c,h);const u={};Object.defineProperty(u,"maxMessageSize",{get(){return d}}),this._sctp=u}return o.apply(this,arguments)}}function uC(s){if(!(s.RTCPeerConnection&&"createDataChannel"in s.RTCPeerConnection.prototype))return;function e(i,n){const r=i.send;i.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(i.readyState==="open"&&n.sctp&&l>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return r.apply(i,arguments)}}const t=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const n=t.apply(this,arguments);return e(n,this),n},nv(s,"datachannel",i=>(e(i.channel,i.target),i))}function $V(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const e=s.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const i=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const r=n.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const o=new Event("connectionstatechange",n);r.dispatchEvent(o)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function ez(s,e){if(!s.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=n.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);s.RTCSessionDescription&&n instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:n.type,sdp:r}):n.sdp=r}return t.apply(this,arguments)}}function RR(s,e){if(!(s.RTCPeerConnection&&s.RTCPeerConnection.prototype))return;const t=s.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const qLe=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:ez,shimAddIceCandidateNullOrEmpty:RR,shimConnectionState:$V,shimMaxMessageSize:dC,shimRTCIceCandidate:ER,shimSendThrowTypeError:uC},Symbol.toStringTag,{value:"Module"}));function $Le({window:s}={},e={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const t=KO,i=ZLe(s),n={browserDetails:i,commonShim:qLe,extractVersion:hC,disableLog:XLe,disableWarnings:OLe};switch(i.browser){case"chrome":if(!C4||!JV||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),n;if(i.version===null)return t("Chrome shim can not determine version, not shimming."),n;t("adapter.js shimming chrome."),n.browserShim=C4,RR(s,i),ise(s,i),nse(s),JV(s,i),sse(s),cse(s,i),rse(s),ose(s),ase(s),hse(s,i),ER(s),$V(s),dC(s,i),uC(s),ez(s,i);break;case"firefox":if(!I4||!qV||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),n;t("adapter.js shimming firefox."),n.browserShim=I4,RR(s,i),gse(s,i),qV(s,i),Ase(s),xse(s),yse(s),bse(s),vse(s),_se(s),Cse(s),wse(s),Sse(s),ER(s),$V(s),dC(s,i),uC(s);break;case"edge":if(!M4||!jV||!e.shimEdge)return t("MS edge shim is not included in this adapter release."),n;t("adapter.js shimming edge."),n.browserShim=M4,pse(s),fse(s),jV(s,i),mse(s),dC(s,i),uC(s);break;case"safari":if(!T4||!e.shimSafari)return t("Safari shim is not included in this adapter release."),n;t("adapter.js shimming safari."),n.browserShim=T4,RR(s,i),Lse(s),Pse(s),Tse(s),Mse(s),Ise(s),Bse(s),Ese(s),Gse(s),ER(s),dC(s,i),uC(s),ez(s,i);break;default:t("Unsupported browser!");break}return n}const E4=$Le({window:typeof window>"u"?void 0:window});function ru(s,e,t,i){Object.defineProperty(s,e,{get:t,set:i,enumerable:!0,configurable:!0})}var RN=E4.default||E4,b_=new(function(){function s(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return s.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},s.prototype.isBrowserSupported=function(){var e=this.getBrowser(),t=this.getVersion(),i=this.supportedBrowsers.includes(e);return i?e==="chrome"?t>=this.minChromeVersion:e==="firefox"?t>=this.minFirefoxVersion:e==="safari"?!this.isIOS&&t>=this.minSafariVersion:!1:!1},s.prototype.getBrowser=function(){return RN.browserDetails.browser},s.prototype.getVersion=function(){return RN.browserDetails.version||0},s.prototype.isUnifiedPlanSupported=function(){var e=this.getBrowser(),t=RN.browserDetails.version||0;if(e==="chrome"&&t<this.minChromeVersion)return!1;if(e==="firefox"&&t>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var i,n=!1;try{i=new RTCPeerConnection,i.addTransceiver("audio"),n=!0}catch{}finally{i&&i.close()}return n},s.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},s}()),R4={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},e2e=function(){function s(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=R4,this.browser=b_.getBrowser(),this.browserVersion=b_.getVersion(),this.supports=function(){var e={browser:b_.isBrowserSupported(),webRTC:b_.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!e.webRTC)return e;var t;try{t=new RTCPeerConnection(R4),e.audioVideo=!0;var i=void 0;try{i=t.createDataChannel("_PEERJSTEST",{ordered:!0}),e.data=!0,e.reliable=!!i.ordered;try{i.binaryType="blob",e.binaryBlob=!b_.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{t&&t.close()}return e}(),this.pack=b4.pack,this.unpack=b4.unpack,this._dataCount=1}return s.prototype.noop=function(){},s.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},s.prototype.chunk=function(e){for(var t=[],i=e.size,n=Math.ceil(i/sn.chunkedMTU),r=0,o=0;o<i;){var a=Math.min(i,o+sn.chunkedMTU),l=e.slice(o,a),c={__peerData:this._dataCount,n:r,data:l,total:n};t.push(c),o=a,r++}return this._dataCount++,t},s.prototype.blobToArrayBuffer=function(e,t){var i=new FileReader;return i.onload=function(n){n.target&&t(n.target.result)},i.readAsArrayBuffer(e),i},s.prototype.binaryStringToArrayBuffer=function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i)&255;return t.buffer},s.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},s.prototype.isSecure=function(){return location.protocol==="https:"},s}(),sn=new e2e,kse={};ru(kse,"Peer",()=>nz,s=>nz=s);var aM={},t2e=Object.prototype.hasOwnProperty,Da="~";function pS(){}Object.create&&(pS.prototype=Object.create(null),new pS().__proto__||(Da=!1));function i2e(s,e,t){this.fn=s,this.context=e,this.once=t||!1}function Nse(s,e,t,i,n){if(typeof t!="function")throw new TypeError("The listener must be a function");var r=new i2e(t,i||s,n),o=Da?Da+e:e;return s._events[o]?s._events[o].fn?s._events[o]=[s._events[o],r]:s._events[o].push(r):(s._events[o]=r,s._eventsCount++),s}function LR(s,e){--s._eventsCount===0?s._events=new pS:delete s._events[e]}function ra(){this._events=new pS,this._eventsCount=0}ra.prototype.eventNames=function(){var e=[],t,i;if(this._eventsCount===0)return e;for(i in t=this._events)t2e.call(t,i)&&e.push(Da?i.slice(1):i);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};ra.prototype.listeners=function(e){var t=Da?Da+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,o=new Array(r);n<r;n++)o[n]=i[n].fn;return o};ra.prototype.listenerCount=function(e){var t=Da?Da+e:e,i=this._events[t];return i?i.fn?1:i.length:0};ra.prototype.emit=function(e,t,i,n,r,o){var a=Da?Da+e:e;if(!this._events[a])return!1;var l=this._events[a],c=arguments.length,h,d;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,n),!0;case 5:return l.fn.call(l.context,t,i,n,r),!0;case 6:return l.fn.call(l.context,t,i,n,r,o),!0}for(d=1,h=new Array(c-1);d<c;d++)h[d-1]=arguments[d];l.fn.apply(l.context,h)}else{var u=l.length,f;for(d=0;d<u;d++)switch(l[d].once&&this.removeListener(e,l[d].fn,void 0,!0),c){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,t);break;case 3:l[d].fn.call(l[d].context,t,i);break;case 4:l[d].fn.call(l[d].context,t,i,n);break;default:if(!h)for(f=1,h=new Array(c-1);f<c;f++)h[f-1]=arguments[f];l[d].fn.apply(l[d].context,h)}}return!0};ra.prototype.on=function(e,t,i){return Nse(this,e,t,i,!1)};ra.prototype.once=function(e,t,i){return Nse(this,e,t,i,!0)};ra.prototype.removeListener=function(e,t,i,n){var r=Da?Da+e:e;if(!this._events[r])return this;if(!t)return LR(this,r),this;var o=this._events[r];if(o.fn)o.fn===t&&(!n||o.once)&&(!i||o.context===i)&&LR(this,r);else{for(var a=0,l=[],c=o.length;a<c;a++)(o[a].fn!==t||n&&!o[a].once||i&&o[a].context!==i)&&l.push(o[a]);l.length?this._events[r]=l.length===1?l[0]:l:LR(this,r)}return this};ra.prototype.removeAllListeners=function(e){var t;return e?(t=Da?Da+e:e,this._events[t]&&LR(this,t)):(this._events=new pS,this._eventsCount=0),this};ra.prototype.off=ra.prototype.removeListener;ra.prototype.addListener=ra.prototype.on;ra.prefixed=Da;ra.EventEmitter=ra;aM=ra;var Et={};ru(Et,"LogLevel",()=>Ya,s=>Ya=s);ru(Et,"default",()=>L4,s=>L4=s);var Sg=function(s,e){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var i=t.call(s),n,r=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)r.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},Mg=function(s,e,t){if(t||arguments.length===2)for(var i=0,n=e.length,r;i<n;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return s.concat(r||Array.prototype.slice.call(e))},n2e="PeerJS: ",Ya;(function(s){s[s.Disabled=0]="Disabled",s[s.Errors=1]="Errors",s[s.Warnings=2]="Warnings",s[s.All=3]="All"})(Ya||(Ya={}));var s2e=function(){function s(){this._logLevel=Ya.Disabled}return Object.defineProperty(s.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!1,configurable:!0}),s.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=Ya.All&&this._print.apply(this,Mg([Ya.All],Sg(e),!1))},s.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=Ya.Warnings&&this._print.apply(this,Mg([Ya.Warnings],Sg(e),!1))},s.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=Ya.Errors&&this._print.apply(this,Mg([Ya.Errors],Sg(e),!1))},s.prototype.setLogFunction=function(e){this._print=e},s.prototype._print=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=Mg([n2e],Sg(t),!1);for(var r in n)n[r]instanceof Error&&(n[r]="("+n[r].name+") "+n[r].message);e>=Ya.All?console.log.apply(console,Mg([],Sg(n),!1)):e>=Ya.Warnings?console.warn.apply(console,Mg(["WARNING"],Sg(n),!1)):e>=Ya.Errors&&console.error.apply(console,Mg(["ERROR"],Sg(n),!1))},s}(),L4=new s2e,Dse={};ru(Dse,"Socket",()=>B4,s=>B4=s);var Ch;(function(s){s.Data="data",s.Media="media"})(Ch||(Ch={}));var Ds;(function(s){s.BrowserIncompatible="browser-incompatible",s.Disconnected="disconnected",s.InvalidID="invalid-id",s.InvalidKey="invalid-key",s.Network="network",s.PeerUnavailable="peer-unavailable",s.SslUnavailable="ssl-unavailable",s.ServerError="server-error",s.SocketError="socket-error",s.SocketClosed="socket-closed",s.UnavailableID="unavailable-id",s.WebRTC="webrtc"})(Ds||(Ds={}));var Hu;(function(s){s.Binary="binary",s.BinaryUTF8="binary-utf8",s.JSON="json"})(Hu||(Hu={}));var dp;(function(s){s.Message="message",s.Disconnected="disconnected",s.Error="error",s.Close="close"})(dp||(dp={}));var Ao;(function(s){s.Heartbeat="HEARTBEAT",s.Candidate="CANDIDATE",s.Offer="OFFER",s.Answer="ANSWER",s.Open="OPEN",s.Error="ERROR",s.IdTaken="ID-TAKEN",s.InvalidKey="INVALID-KEY",s.Leave="LEAVE",s.Expire="EXPIRE"})(Ao||(Ao={}));var YO={};YO=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stückler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Sören Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var r2e=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),o2e=function(s,e){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var i=t.call(s),n,r=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)r.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},a2e=function(s,e,t){if(t||arguments.length===2)for(var i=0,n=e.length,r;i<n;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return s.concat(r||Array.prototype.slice.call(e))},l2e=function(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],i=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&i>=s.length&&(s=void 0),{value:s&&s[i++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},B4=function(s){r2e(e,s);function e(t,i,n,r,o,a){a===void 0&&(a=5e3);var l=s.call(this)||this;l.pingInterval=a,l._disconnected=!0,l._messagesQueue=[];var c=t?"wss://":"ws://";return l._baseUrl=c+i+":"+n+r+"peerjs?key="+o,l}return e.prototype.start=function(t,i){var n=this;this._id=t;var r="".concat(this._baseUrl,"&id=").concat(t,"&token=").concat(i);this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+YO.version),this._disconnected=!1,this._socket.onmessage=function(o){var a;try{a=JSON.parse(o.data),Et.default.log("Server message received:",a)}catch{Et.default.log("Invalid server message",o.data);return}n.emit(dp.Message,a)},this._socket.onclose=function(o){n._disconnected||(Et.default.log("Socket closed.",o),n._cleanup(),n._disconnected=!0,n.emit(dp.Disconnected))},this._socket.onopen=function(){n._disconnected||(n._sendQueuedMessages(),Et.default.log("Socket open"),n._scheduleHeartbeat())})},e.prototype._scheduleHeartbeat=function(){var t=this;this._wsPingTimer=setTimeout(function(){t._sendHeartbeat()},this.pingInterval)},e.prototype._sendHeartbeat=function(){if(!this._wsOpen()){Et.default.log("Cannot send heartbeat, because socket closed");return}var t=JSON.stringify({type:Ao.Heartbeat});this._socket.send(t),this._scheduleHeartbeat()},e.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},e.prototype._sendQueuedMessages=function(){var t,i,n=a2e([],o2e(this._messagesQueue),!1);this._messagesQueue=[];try{for(var r=l2e(n),o=r.next();!o.done;o=r.next()){var a=o.value;this.send(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}},e.prototype.send=function(t){if(!this._disconnected){if(!this._id){this._messagesQueue.push(t);return}if(!t.type){this.emit(dp.Error,"Invalid message");return}if(this._wsOpen()){var i=JSON.stringify(t);this._socket.send(i)}}},e.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},e.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},e}(aM.EventEmitter),tz={};ru(tz,"MediaConnection",()=>k4,s=>k4=s);var JO={};ru(JO,"Negotiator",()=>P4,s=>P4=s);var t2=function(){return t2=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=e[n])}return s},t2.apply(this,arguments)},WT=function(s,e,t,i){function n(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(i.next(h))}catch(d){o(d)}}function l(h){try{c(i.throw(h))}catch(d){o(d)}}function c(h){h.done?r(h.value):n(h.value).then(a,l)}c((i=i.apply(s,e||[])).next())})},HT=function(s,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,n,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(h){return l([c,h])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(r=c[0]&2?n.return:c[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,c[1])).done)return r;switch(n=0,r&&(c=[c[0]&2,r.value]),c[0]){case 0:case 1:r=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,n=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!r||c[1]>r[0]&&c[1]<r[3])){t.label=c[1];break}if(c[0]===6&&t.label<r[1]){t.label=r[1],r=c;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(c);break}r[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(s,t)}catch(h){c=[6,h],n=0}finally{i=r=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},P4=function(){function s(e){this.connection=e}return s.prototype.startConnection=function(e){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===Ch.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){if(this.connection.type===Ch.Data){var i=this.connection,n={ordered:!!e.reliable},r=t.createDataChannel(i.label,n);i.initialize(r)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)},s.prototype._startPeerConnection=function(){Et.default.log("Creating RTCPeerConnection.");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e},s.prototype._setupListeners=function(e){var t=this,i=this.connection.peer,n=this.connection.connectionId,r=this.connection.type,o=this.connection.provider;Et.default.log("Listening for ICE candidates."),e.onicecandidate=function(a){!a.candidate||!a.candidate.candidate||(Et.default.log("Received ICE candidates for ".concat(i,":"),a.candidate),o.socket.send({type:Ao.Candidate,payload:{candidate:a.candidate,type:r,connectionId:n},dst:i}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":Et.default.log("iceConnectionState is failed, closing connections to "+i),t.connection.emit("error",new Error("Negotiation of connection to "+i+" failed.")),t.connection.close();break;case"closed":Et.default.log("iceConnectionState is closed, closing connections to "+i),t.connection.emit("error",new Error("Connection to "+i+" closed.")),t.connection.close();break;case"disconnected":Et.default.log("iceConnectionState changed to disconnected on the connection with "+i);break;case"completed":e.onicecandidate=sn.noop;break}t.connection.emit("iceStateChanged",e.iceConnectionState)},Et.default.log("Listening for data channel"),e.ondatachannel=function(a){Et.default.log("Received data channel");var l=a.channel,c=o.getConnection(i,n);c.initialize(l)},Et.default.log("Listening for remote stream"),e.ontrack=function(a){Et.default.log("Received remote stream");var l=a.streams[0],c=o.getConnection(i,n);if(c.type===Ch.Media){var h=c;t._addStreamToMediaConnection(l,h)}}},s.prototype.cleanup=function(){Et.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var t=e.signalingState!=="closed",i=!1;if(this.connection.type===Ch.Data){var n=this.connection,r=n.dataChannel;r&&(i=!!r.readyState&&r.readyState!=="closed")}(t||i)&&e.close()}},s.prototype._makeOffer=function(){return WT(this,void 0,Promise,function(){var e,t,i,n,r,o,a;return HT(this,function(l){switch(l.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,l.label=1;case 1:return l.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:i=l.sent(),Et.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),l.label=3;case 3:return l.trys.push([3,5,,6]),[4,e.setLocalDescription(i)];case 4:return l.sent(),Et.default.log("Set localDescription:",i,"for:".concat(this.connection.peer)),n={sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:sn.browser},this.connection.type===Ch.Data&&(r=this.connection,n=t2(t2({},n),{label:r.label,reliable:r.reliable,serialization:r.serialization})),t.socket.send({type:Ao.Offer,payload:n,dst:this.connection.peer}),[3,6];case 5:return o=l.sent(),o!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(Ds.WebRTC,o),Et.default.log("Failed to setLocalDescription, ",o)),[3,6];case 6:return[3,8];case 7:return a=l.sent(),t.emitError(Ds.WebRTC,a),Et.default.log("Failed to createOffer, ",a),[3,8];case 8:return[2]}})})},s.prototype._makeAnswer=function(){return WT(this,void 0,Promise,function(){var e,t,i,n,r;return HT(this,function(o){switch(o.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,o.label=1;case 1:return o.trys.push([1,7,,8]),[4,e.createAnswer()];case 2:i=o.sent(),Et.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,e.setLocalDescription(i)];case 4:return o.sent(),Et.default.log("Set localDescription:",i,"for:".concat(this.connection.peer)),t.socket.send({type:Ao.Answer,payload:{sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,browser:sn.browser},dst:this.connection.peer}),[3,6];case 5:return n=o.sent(),t.emitError(Ds.WebRTC,n),Et.default.log("Failed to setLocalDescription, ",n),[3,6];case 6:return[3,8];case 7:return r=o.sent(),t.emitError(Ds.WebRTC,r),Et.default.log("Failed to create answer, ",r),[3,8];case 8:return[2]}})})},s.prototype.handleSDP=function(e,t){return WT(this,void 0,Promise,function(){var i,n,r,o;return HT(this,function(a){switch(a.label){case 0:t=new RTCSessionDescription(t),i=this.connection.peerConnection,n=this.connection.provider,Et.default.log("Setting remote description",t),r=this,a.label=1;case 1:return a.trys.push([1,5,,6]),[4,i.setRemoteDescription(t)];case 2:return a.sent(),Et.default.log("Set remoteDescription:".concat(e," for:").concat(this.connection.peer)),e!=="OFFER"?[3,4]:[4,r._makeAnswer()];case 3:a.sent(),a.label=4;case 4:return[3,6];case 5:return o=a.sent(),n.emitError(Ds.WebRTC,o),Et.default.log("Failed to setRemoteDescription, ",o),[3,6];case 6:return[2]}})})},s.prototype.handleCandidate=function(e){return WT(this,void 0,Promise,function(){var t,i,n,r,o,a;return HT(this,function(l){switch(l.label){case 0:Et.default.log("handleCandidate:",e),t=e.candidate,i=e.sdpMLineIndex,n=e.sdpMid,r=this.connection.peerConnection,o=this.connection.provider,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,r.addIceCandidate(new RTCIceCandidate({sdpMid:n,sdpMLineIndex:i,candidate:t}))];case 2:return l.sent(),Et.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return a=l.sent(),o.emitError(Ds.WebRTC,a),Et.default.log("Failed to handleCandidate, ",a),[3,4];case 4:return[2]}})})},s.prototype._addTracksToConnection=function(e,t){if(Et.default.log("add tracks from stream ".concat(e.id," to peer connection")),!t.addTrack)return Et.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(function(i){t.addTrack(i,e)})},s.prototype._addStreamToMediaConnection=function(e,t){Et.default.log("add stream ".concat(e.id," to media connection ").concat(t.connectionId)),t.addStream(e)},s}(),jO={};ru(jO,"BaseConnection",()=>G4,s=>G4=s);var c2e=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),G4=function(s){c2e(e,s);function e(t,i,n){var r=s.call(this)||this;return r.peer=t,r.provider=i,r.options=n,r._open=!1,r.metadata=n.metadata,r}return Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),e}(aM.EventEmitter),h2e=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),i2=function(){return i2=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=e[n])}return s},i2.apply(this,arguments)},d2e=function(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],i=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&i>=s.length&&(s=void 0),{value:s&&s[i++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},k4=function(s){h2e(e,s);function e(t,i,n){var r=s.call(this,t,i,n)||this;return r._localStream=r.options._stream,r.connectionId=r.options.connectionId||e.ID_PREFIX+sn.randomToken(),r._negotiator=new JO.Negotiator(r),r._localStream&&r._negotiator.startConnection({_stream:r._localStream,originator:!0}),r}return Object.defineProperty(e.prototype,"type",{get:function(){return Ch.Media},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),e.prototype.addStream=function(t){Et.default.log("Receiving stream",t),this._remoteStream=t,s.prototype.emit.call(this,"stream",t)},e.prototype.handleMessage=function(t){var i=t.type,n=t.payload;switch(t.type){case Ao.Answer:this._negotiator.handleSDP(i,n.sdp),this._open=!0;break;case Ao.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:Et.default.warn("Unrecognized message type:".concat(i," from peer:").concat(this.peer));break}},e.prototype.answer=function(t,i){var n,r;if(i===void 0&&(i={}),this._localStream){Et.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=t,i&&i.sdpTransform&&(this.options.sdpTransform=i.sdpTransform),this._negotiator.startConnection(i2(i2({},this.options._payload),{_stream:t}));var o=this.provider._getMessages(this.connectionId);try{for(var a=d2e(o),l=a.next();!l.done;l=a.next()){var c=l.value;this.handleMessage(c)}}catch(h){n={error:h}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}this._open=!0},e.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,s.prototype.emit.call(this,"close"))},e.ID_PREFIX="mc_",e}(jO.BaseConnection),iz={};ru(iz,"DataConnection",()=>D4,s=>D4=s);var Fse={};ru(Fse,"EncodingQueue",()=>N4,s=>N4=s);var u2e=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),N4=function(s){u2e(e,s);function e(){var t=s.call(this)||this;return t.fileReader=new FileReader,t._queue=[],t._processing=!1,t.fileReader.onload=function(i){t._processing=!1,i.target&&t.emit("done",i.target.result),t.doNextTask()},t.fileReader.onerror=function(i){Et.default.error("EncodingQueue error:",i),t._processing=!1,t.destroy(),t.emit("error",i)},t}return Object.defineProperty(e.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),e.prototype.enque=function(t){this.queue.push(t),!this.processing&&this.doNextTask()},e.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},e.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},e}(aM.EventEmitter),p2e=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),f2e=function(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],i=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&i>=s.length&&(s=void 0),{value:s&&s[i++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},D4=function(s){p2e(e,s);function e(t,i,n){var r=s.call(this,t,i,n)||this;return r.stringify=JSON.stringify,r.parse=JSON.parse,r._buffer=[],r._bufferSize=0,r._buffering=!1,r._chunkedData={},r._encodingQueue=new Fse.EncodingQueue,r.connectionId=r.options.connectionId||e.ID_PREFIX+sn.randomToken(),r.label=r.options.label||r.connectionId,r.serialization=r.options.serialization||Hu.Binary,r.reliable=!!r.options.reliable,r._encodingQueue.on("done",function(o){r._bufferedSend(o)}),r._encodingQueue.on("error",function(){Et.default.error("DC#".concat(r.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),r.close()}),r._negotiator=new JO.Negotiator(r),r._negotiator.startConnection(r.options._payload||{originator:!0}),r}return Object.defineProperty(e.prototype,"type",{get:function(){return Ch.Data},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),e.prototype.initialize=function(t){this._dc=t,this._configureDataChannel()},e.prototype._configureDataChannel=function(){var t=this;(!sn.supports.binaryBlob||sn.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){Et.default.log("DC#".concat(t.connectionId," dc connection success")),t._open=!0,t.emit("open")},this.dataChannel.onmessage=function(i){Et.default.log("DC#".concat(t.connectionId," dc onmessage:"),i.data),t._handleDataMessage(i)},this.dataChannel.onclose=function(){Et.default.log("DC#".concat(t.connectionId," dc closed for:"),t.peer),t.close()}},e.prototype._handleDataMessage=function(t){var i=this,n=t.data,r=n.constructor,o=this.serialization===Hu.Binary||this.serialization===Hu.BinaryUTF8,a=n;if(o){if(r===Blob){sn.blobToArrayBuffer(n,function(c){var h=sn.unpack(c);i.emit("data",h)});return}else if(r===ArrayBuffer)a=sn.unpack(n);else if(r===String){var l=sn.binaryStringToArrayBuffer(n);a=sn.unpack(l)}}else this.serialization===Hu.JSON&&(a=this.parse(n));if(a.__peerData){this._handleChunk(a);return}s.prototype.emit.call(this,"data",a)},e.prototype._handleChunk=function(t){var i=t.__peerData,n=this._chunkedData[i]||{data:[],count:0,total:t.total};if(n.data[t.n]=t.data,n.count++,this._chunkedData[i]=n,n.total===n.count){delete this._chunkedData[i];var r=new Blob(n.data);this._handleDataMessage({data:r})}},e.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,s.prototype.emit.call(this,"close"))},e.prototype.send=function(t,i){if(!this.open){s.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===Hu.JSON)this._bufferedSend(this.stringify(t));else if(this.serialization===Hu.Binary||this.serialization===Hu.BinaryUTF8){var n=sn.pack(t);if(!i&&n.size>sn.chunkedMTU){this._sendChunks(n);return}sn.supports.binaryBlob?this._bufferedSend(n):this._encodingQueue.enque(n)}else this._bufferedSend(t)},e.prototype._bufferedSend=function(t){(this._buffering||!this._trySend(t))&&(this._buffer.push(t),this._bufferSize=this._buffer.length)},e.prototype._trySend=function(t){var i=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>e.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){i._buffering=!1,i._tryBuffer()},50),!1;try{this.dataChannel.send(t)}catch(n){return Et.default.error("DC#:".concat(this.connectionId," Error when sending:"),n),this._buffering=!0,this.close(),!1}return!0},e.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},e.prototype._sendChunks=function(t){var i,n,r=sn.chunk(t);Et.default.log("DC#".concat(this.connectionId," Try to send ").concat(r.length," chunks..."));try{for(var o=f2e(r),a=o.next();!a.done;a=o.next()){var l=a.value;this.send(l,!0)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}},e.prototype.handleMessage=function(t){var i=t.payload;switch(t.type){case Ao.Answer:this._negotiator.handleSDP(t.type,i.sdp);break;case Ao.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:Et.default.warn("Unrecognized message type:",t.type,"from peer:",this.peer);break}},e.ID_PREFIX="dc_",e.MAX_BUFFERED_AMOUNT=8388608,e}(jO.BaseConnection),Vse={};ru(Vse,"API",()=>z4,s=>z4=s);var F4=function(s,e,t,i){function n(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(i.next(h))}catch(d){o(d)}}function l(h){try{c(i.throw(h))}catch(d){o(d)}}function c(h){h.done?r(h.value):n(h.value).then(a,l)}c((i=i.apply(s,e||[])).next())})},V4=function(s,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,n,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(h){return l([c,h])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(r=c[0]&2?n.return:c[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,c[1])).done)return r;switch(n=0,r&&(c=[c[0]&2,r.value]),c[0]){case 0:case 1:r=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,n=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!r||c[1]>r[0]&&c[1]<r[3])){t.label=c[1];break}if(c[0]===6&&t.label<r[1]){t.label=r[1],r=c;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(c);break}r[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(s,t)}catch(h){c=[6,h],n=0}finally{i=r=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},z4=function(){function s(e){this._options=e}return s.prototype._buildRequest=function(e){var t=this._options.secure?"https":"http",i=this._options,n=i.host,r=i.port,o=i.path,a=i.key,l=new URL("".concat(t,"://").concat(n,":").concat(r).concat(o).concat(a,"/").concat(e));return l.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),l.searchParams.set("version",YO.version),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})},s.prototype.retrieveId=function(){return F4(this,void 0,Promise,function(){var e,t,i;return V4(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(e=n.sent(),e.status!==200)throw new Error("Error. Status:".concat(e.status));return[2,e.text()];case 2:throw t=n.sent(),Et.default.error("Error retrieving ID",t),i="",this._options.path==="/"&&this._options.host!==sn.CLOUD_HOST&&(i=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+i);case 3:return[2]}})})},s.prototype.listAllPeers=function(){return F4(this,void 0,Promise,function(){var e,t,i;return V4(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(e=n.sent(),e.status!==200)throw e.status===401?(t="",this._options.host===sn.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)):new Error("Error. Status:".concat(e.status));return[2,e.json()];case 2:throw i=n.sent(),Et.default.error("Error retrieving list peers",i),new Error("Could not get list peers from the server."+i);case 3:return[2]}})})},s}(),m2e=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),nw=function(){return nw=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=e[n])}return s},nw.apply(this,arguments)},x_=function(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],i=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&i>=s.length&&(s=void 0),{value:s&&s[i++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},g2e=function(s,e){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var i=t.call(s),n,r=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)r.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},nz=function(s){m2e(e,s);function e(t,i){var n=s.call(this)||this;n._id=null,n._lastServerId=null,n._destroyed=!1,n._disconnected=!1,n._open=!1,n._connections=new Map,n._lostMessages=new Map;var r;return t&&t.constructor==Object?i=t:t&&(r=t.toString()),i=nw({debug:0,host:sn.CLOUD_HOST,port:sn.CLOUD_PORT,path:"/",key:e.DEFAULT_KEY,token:sn.randomToken(),config:sn.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},i),n._options=i,n._options.host==="/"&&(n._options.host=window.location.hostname),n._options.path&&(n._options.path[0]!=="/"&&(n._options.path="/"+n._options.path),n._options.path[n._options.path.length-1]!=="/"&&(n._options.path+="/")),n._options.secure===void 0&&n._options.host!==sn.CLOUD_HOST?n._options.secure=sn.isSecure():n._options.host==sn.CLOUD_HOST&&(n._options.secure=!0),n._options.logFunction&&Et.default.setLogFunction(n._options.logFunction),Et.default.logLevel=n._options.debug||0,n._api=new Vse.API(i),n._socket=n._createServerConnection(),!sn.supports.audioVideo&&!sn.supports.data?(n._delayedAbort(Ds.BrowserIncompatible,"The current browser does not support WebRTC"),n):r&&!sn.validateId(r)?(n._delayedAbort(Ds.InvalidID,'ID "'.concat(r,'" is invalid')),n):(r?n._initialize(r):n._api.retrieveId().then(function(o){return n._initialize(o)}).catch(function(o){return n._abort(Ds.ServerError,o)}),n)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connections",{get:function(){var t,i,n=Object.create(null);try{for(var r=x_(this._connections),o=r.next();!o.done;o=r.next()){var a=g2e(o.value,2),l=a[0],c=a[1];n[l]=c}}catch(h){t={error:h}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),e.prototype._createServerConnection=function(){var t=this,i=new Dse.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return i.on(dp.Message,function(n){t._handleMessage(n)}),i.on(dp.Error,function(n){t._abort(Ds.SocketError,n)}),i.on(dp.Disconnected,function(){t.disconnected||(t.emitError(Ds.Network,"Lost connection to server."),t.disconnect())}),i.on(dp.Close,function(){t.disconnected||t._abort(Ds.SocketClosed,"Underlying socket is already closed.")}),i},e.prototype._initialize=function(t){this._id=t,this.socket.start(t,this._options.token)},e.prototype._handleMessage=function(t){var i,n,r=t.type,o=t.payload,a=t.src;switch(r){case Ao.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Ao.Error:this._abort(Ds.ServerError,o.msg);break;case Ao.IdTaken:this._abort(Ds.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case Ao.InvalidKey:this._abort(Ds.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case Ao.Leave:Et.default.log("Received leave message from ".concat(a)),this._cleanupPeer(a),this._connections.delete(a);break;case Ao.Expire:this.emitError(Ds.PeerUnavailable,"Could not connect to peer ".concat(a));break;case Ao.Offer:var m=o.connectionId,g=this.getConnection(a,m);if(g&&(g.close(),Et.default.warn("Offer received for existing Connection ID:".concat(m))),o.type===Ch.Media){var l=new tz.MediaConnection(a,this,{connectionId:m,_payload:o,metadata:o.metadata});g=l,this._addConnection(a,g),this.emit("call",l)}else if(o.type===Ch.Data){var c=new iz.DataConnection(a,this,{connectionId:m,_payload:o,metadata:o.metadata,label:o.label,serialization:o.serialization,reliable:o.reliable});g=c,this._addConnection(a,g),this.emit("connection",c)}else{Et.default.warn("Received malformed connection type:".concat(o.type));return}var h=this._getMessages(m);try{for(var d=x_(h),u=d.next();!u.done;u=d.next()){var f=u.value;g.handleMessage(f)}}catch(A){i={error:A}}finally{try{u&&!u.done&&(n=d.return)&&n.call(d)}finally{if(i)throw i.error}}break;default:if(!o){Et.default.warn("You received a malformed message from ".concat(a," of type ").concat(r));return}var m=o.connectionId,g=this.getConnection(a,m);g&&g.peerConnection?g.handleMessage(t):m?this._storeMessage(m,t):Et.default.warn("You received an unrecognized message:",t);break}},e.prototype._storeMessage=function(t,i){this._lostMessages.has(t)||this._lostMessages.set(t,[]),this._lostMessages.get(t).push(i)},e.prototype._getMessages=function(t){var i=this._lostMessages.get(t);return i?(this._lostMessages.delete(t),i):[]},e.prototype.connect=function(t,i){if(i===void 0&&(i={}),this.disconnected){Et.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Ds.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var n=new iz.DataConnection(t,this,i);return this._addConnection(t,n),n},e.prototype.call=function(t,i,n){if(n===void 0&&(n={}),this.disconnected){Et.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Ds.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!i){Et.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var r=new tz.MediaConnection(t,this,nw(nw({},n),{_stream:i}));return this._addConnection(t,r),r},e.prototype._addConnection=function(t,i){Et.default.log("add connection ".concat(i.type,":").concat(i.connectionId," to peerId:").concat(t)),this._connections.has(t)||this._connections.set(t,[]),this._connections.get(t).push(i)},e.prototype._removeConnection=function(t){var i=this._connections.get(t.peer);if(i){var n=i.indexOf(t);n!==-1&&i.splice(n,1)}this._lostMessages.delete(t.connectionId)},e.prototype.getConnection=function(t,i){var n,r,o=this._connections.get(t);if(!o)return null;try{for(var a=x_(o),l=a.next();!l.done;l=a.next()){var c=l.value;if(c.connectionId===i)return c}}catch(h){n={error:h}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return null},e.prototype._delayedAbort=function(t,i){var n=this;setTimeout(function(){n._abort(t,i)},0)},e.prototype._abort=function(t,i){Et.default.error("Aborting!"),this.emitError(t,i),this._lastServerId?this.disconnect():this.destroy()},e.prototype.emitError=function(t,i){Et.default.error("Error:",i);var n;typeof i=="string"?n=new Error(i):n=i,n.type=t,this.emit("error",n)},e.prototype.destroy=function(){this.destroyed||(Et.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},e.prototype._cleanup=function(){var t,i;try{for(var n=x_(this._connections.keys()),r=n.next();!r.done;r=n.next()){var o=r.value;this._cleanupPeer(o),this._connections.delete(o)}}catch(a){t={error:a}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}this.socket.removeAllListeners()},e.prototype._cleanupPeer=function(t){var i,n,r=this._connections.get(t);if(r)try{for(var o=x_(r),a=o.next();!a.done;a=o.next()){var l=a.value;l.close()}}catch(c){i={error:c}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}},e.prototype.disconnect=function(){if(!this.disconnected){var t=this.id;Et.default.log("Disconnect peer with ID:".concat(t)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=t,this._id=null,this.emit("disconnected",t)}},e.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)Et.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)Et.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},e.prototype.listAllPeers=function(t){var i=this;t===void 0&&(t=function(n){}),this._api.listAllPeers().then(function(n){return t(n)}).catch(function(n){return i._abort(Ds.ServerError,n)})},e.DEFAULT_KEY="peerjs",e}(aM.EventEmitter),sz=kse.Peer;const A2e=Object.freeze(Object.defineProperty({__proto__:null,get Peer(){return nz},default:sz,util:sn},Symbol.toStringTag,{value:"Module"}));let qO;function y2e(){return qO}function b2e(s){qO=s}function zse(s,e){return e||(e={}),e={...qO,...e},s?new sz(s,e):new sz(e)}async function U4(){const s=await Promise.resolve().then(()=>A2e);return console.log(s),s.default===void 0?s:s.default}class Use{constructor(){p(this,"_host");p(this,"_client");p(this,"_clientData");this.onEnable()}get isHost(){return this._host!==void 0}onEnable(){const e="HOST-5980e65c-8438-453e-8b35-f13c736dcd81";this.trySetupHost(e)}async trySetupHost(e){const t=await U4(),i=new t(e);i.on("error",n=>{console.error(n),this._host=void 0,this.trySetupClient(e)}),i.on("open",n=>{this._host=new v2e(i)})}async trySetupClient(e){const t=await U4();this._client=new t,this._client.on("error",i=>{console.error("Client error",i)}),this._client.on("open",i=>{console.log("client connected",i),this._clientData=this._client.connect(e,{metadata:{id:i}}),this._clientData.on("open",()=>{console.log("Connected to host")}),this._clientData.on("data",n=>{console.log("<<",n)})})}}class x2e{constructor(e){p(this,"_peer");this._peer=e}}class v2e extends x2e{constructor(t){var i;super(t);p(this,"_connections",[]);console.log("I AM THE HOST"),(i=this._peer)==null||i.on("connection",this.onConnection.bind(this)),this._peer.on("close",()=>{this.broadcast("BYE")}),setInterval(()=>{this.broadcast("HELLO")},2e3)}get isHost(){return!0}onConnection(t){console.log("host connection",t),t.on("open",()=>{this._connections.push(t),this.broadcastConnection(t)})}broadcastConnection(t){const i=this._connections.map(n=>{var r;return(r=n.metadata)==null?void 0:r.id}).filter(n=>n!==void 0);this.broadcast({type:"connection-list",connections:i})}broadcast(t){if(t!=null){console.log(">>",t);for(const i in this._peer.connections){const n=this._peer.connections[i];if(n)if(Array.isArray(n))for(const r of n)r&&r.send(t);else console.warn(n)}}}}var yh=(s=>(s[s.OnConnection=0]="OnConnection",s[s.OnRoomJoin=1]="OnRoomJoin",s[s.Queued=2]="Queued",s[s.Immediate=3]="Immediate",s))(yh||{});const X4="https://urls.needle.tools/default-networking-backend/index";let Xa="wss://networking.needle.tools/socket";const Ha=!!ee("debugnet"),pC=!!(Ha||ee("debugowner")),LN=ee("debugnetbin");var Xse=(s=>(s.ConnectionInfo="connection-start-info",s))(Xse||{}),ri=(s=>(s.Join="join-room",s.Leave="leave-room",s.JoinedRoom="joined-room",s.LeftRoom="left-room",s.UserJoinedRoom="user-joined-room",s.UserLeftRoom="user-left-room",s.RoomStateSent="room-state-sent",s))(ri||{});class _2e{constructor(){p(this,"room");p(this,"viewId");p(this,"allowEditing");p(this,"inRoom")}}class C2e{constructor(){p(this,"room")}}class w2e{constructor(){p(this,"userId")}}var Ose=(s=>(s.RequestHasOwner="request-has-owner",s.ResponseHasOwner="response-has-owner",s.RequestIsOwner="request-is-owner",s.ResponseIsOwner="response-is-owner",s.RequestOwnership="request-ownership",s.GainedOwnership="gained-ownership",s.RemoveOwnership="remove-ownership",s.LostOwnership="lost-ownership",s.GainedOwnershipBroadcast="gained-ownership-broadcast",s.LostOwnershipBroadcast="lost-ownership-broadcast",s))(Ose||{});class $O{constructor(e,t){p(this,"guid");p(this,"connection");p(this,"_hasOwnership",!1);p(this,"_isOwned");p(this,"_gainSubscription");p(this,"_lostSubscription");p(this,"_hasOwnerResponse");p(this,"_isWaitingForOwnershipResponseCallback",null);this.connection=e,this.guid=t,this._gainSubscription=this.onGainedOwnership.bind(this),this._lostSubscription=this.onLostOwnership.bind(this),e.beginListen("lost-ownership",this._lostSubscription),e.beginListen("gained-ownership-broadcast",this._gainSubscription),this._hasOwnerResponse=this.onHasOwnerResponse.bind(this),e.beginListen("response-has-owner",this._hasOwnerResponse)}get hasOwnership(){return this._hasOwnership}get isOwned(){return this._isOwned}get isConnected(){return this.connection.isConnected}updateIsOwned(){this.connection.send("request-has-owner",{guid:this.guid})}onHasOwnerResponse(e){e.guid===this.guid&&(this._isOwned=e.value)}requestOwnershipIfNotOwned(){return this._isWaitingForOwnershipResponseCallback!==null?this:(this._isWaitingForOwnershipResponseCallback=this.waitForHasOwnershipRequestResponse.bind(this),this.connection.beginListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this.connection.send("request-has-owner",{guid:this.guid}),this)}waitForHasOwnershipRequestResponse(e){e.guid===this.guid&&(this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this._isOwned=e.value,e.value||(pC&&console.log("request ownership",this.guid),this.requestOwnership()))}requestOwnershipAsync(){return new Promise((e,t)=>{this.requestOwnership();let i=0;const n=()=>{if(i++>10)return t("Timeout");setTimeout(()=>{this.hasOwnership?e(this):n()},100)};n()})}requestOwnership(){return pC&&console.log("Request ownership",this.guid),this.connection.send("request-ownership",{guid:this.guid}),this}freeOwnership(){return this.connection.send("remove-ownership",{guid:this.guid}),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this}destroy(){this.connection.stopListen("gained-ownership",this._gainSubscription),this.connection.stopListen("lost-ownership",this._lostSubscription),this.connection.stopListen("response-has-owner",this._hasOwnerResponse),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null)}onGainedOwnership(e){e.guid===this.guid&&(this._isOwned=!0,this.connection.connectionId===e.owner?(pC&&console.log("GAINED OWNERSHIP",this.guid),this._hasOwnership=!0):this._hasOwnership=!1)}onLostOwnership(e){e===this.guid&&(pC&&console.log("LOST OWNERSHIP",this.guid),this._hasOwnership=!1,this._isOwned=!1)}}class Zse{constructor(e){p(this,"context");p(this,"_peer",null);p(this,"_usersInRoomCopy",[]);p(this,"_defaultMessagesBuffer",[]);p(this,"_defaultMessagesBufferArray",[]);p(this,"netWebSocketUrlProvider");p(this,"_listeners",{});p(this,"_listenersBinary",{});p(this,"connected",!1);p(this,"channelId");p(this,"_connectionId",null);p(this,"_ws");p(this,"_waitingForSocket",{});p(this,"_isInRoom",!1);p(this,"_currentRoomName",null);p(this,"_currentRoomViewId",null);p(this,"_currentRoomAllowEditing",!0);p(this,"_currentInRoom",[]);p(this,"_state",{});p(this,"_currentDelay",-1);p(this,"_connectingToWebsocketPromise",null);this.context=e}get peer(){return this._peer||(this._peer=new Use),this._peer}tryGetState(e){return e==="invalid"?null:this._state[e]}get connectionId(){return this._connectionId}get isDebugEnabled(){return Ha}get isConnected(){return this.connected}get currentRoomName(){return this._currentRoomName}get allowEditing(){return this._currentRoomAllowEditing}get currentRoomViewId(){return this._currentRoomViewId}getViewOnlyUrl(){if(this.currentRoomViewId===null)return null;const e=new URL(window.location.href);return e.searchParams.set("view",this.currentRoomViewId),e.href}get isInRoom(){return this._isInRoom}get currentLatency(){return this._currentDelay}get currentServerUrl(){var e;return((e=this._ws)==null?void 0:e.url)??null}sendPing(){this.send("ping",{time:this.context.time.time})}userIsInRoom(e){return this._currentInRoom.indexOf(e)!==-1}usersInRoom(e=null){e||(e=this._usersInRoomCopy),e.length=0;for(const t of this._currentInRoom)e.push(t);return e}joinRoom(e,t=!1){return e?e.length>1024?(console.error('Room name too long, can not join: "'+e+'". Max length is 1024 characters.'),!1):(this.connect(),Ha&&console.log("join: "+e),this.send("join-room",{room:e,viewOnly:t},yh.OnConnection),!0):(console.error('Missing room name, can not join: "'+e+'"'),!1)}leaveRoom(e=null){return e||(e=this.currentRoomName),e?(this.send("leave-room",{room:e}),!0):(console.error('Missing room name, can not join: "'+e+'"'),!1)}send(e,t=null,i=yh.Queued){if(t===null&&(t={}),i===yh.Queued){this._defaultMessagesBuffer.push({key:e,value:t});return}return this.sendWithWebsocket(e,t,i)}sendDeleteRemoteState(e){this.send("delete-state",{guid:e,dontSave:!0}),delete this._state[e]}sendDeleteRemoteStateAll(){this.send("delete-all-state"),this._state={}}sendBinary(e){var t;LN&&console.log("<< send binary",this.context.time.frame,e.length/1024+" KB"),(t=this._ws)==null||t.send(e)}sendBufferedMessagesNow(){var i;if(!this._ws)return;this._defaultMessagesBufferArray.length=0;const e=Object.keys(this._defaultMessagesBuffer).length;for(const n in this._defaultMessagesBuffer){const r=this._defaultMessagesBuffer[n];if(e<=1){this.sendWithWebsocket(r.key,r.value,yh.Immediate);break}const o=this.toMessage(r.key,r.value);this._defaultMessagesBufferArray.push(o)}if(this._defaultMessagesBuffer.length=0,this._defaultMessagesBufferArray.length>0&&Ha&&console.log("SEND BUFFERED",this._defaultMessagesBufferArray.length),this._defaultMessagesBufferArray.length<=0)return;const t=JSON.stringify(this._defaultMessagesBufferArray);(i=this._ws)==null||i.send(t)}beginListen(e,t){return this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t),t}stopListening(e,t){return this.stopListen(e,t)}stopListen(e,t){if(!t||!this._listeners[e])return;const i=this._listeners[e].indexOf(t);i>=0&&this._listeners[e].splice(i,1)}beginListenBinary(e,t){return this._listenersBinary[e]||(this._listenersBinary[e]=[]),this._listenersBinary[e].push(t),t}stopListenBinary(e,t){if(!this._listenersBinary[e])return;const i=this._listenersBinary[e].indexOf(t);i>=0&&this._listenersBinary[e].splice(i,1)}registerProvider(e){this.netWebSocketUrlProvider=e}async connect(e){var i;if(this.connected&&e&&e!==Xa)return Promise.reject("Can not connect to different server url. Please disconnect first.");if(this.connected)return Promise.resolve(!0);e&&console.debug("Connecting to user provided url "+e);const t=e||((i=this.netWebSocketUrlProvider)==null?void 0:i.getWebsocketUrl());return t?Xa=t:yte()&&(Xa="wss://"+window.location.host+"/socket"),this.connectWebsocket()}disconnect(){var e;(e=this._ws)==null||e.close(),this._ws=void 0,Xa=void 0}connectWebsocket(){return this._connectingToWebsocketPromise?this._connectingToWebsocketPromise:this._connectingToWebsocketPromise=new Promise(async(e,t)=>{var c,h;let i=!1;const n=d=>{i||(i=!0,e(d))};if(Xa===void 0&&(console.log("Fetch default backend url: "+X4),Xa=await(await fetch(X4)).text()),Xa===void 0){n(!1);return}console.debug(`⊡ Connecting to networking backend on
`+Xa);const r=await Promise.resolve().then(()=>O5e),o=((c=r.default)==null?void 0:c.WebsocketBuilder)??r.WebsocketBuilder,a=((h=r.default)==null?void 0:h.ExponentialBackoff)??r.ExponentialBackoff,l=new o(Xa).withMaxRetries(10).withBackoff(new a(2e3,4)).onOpen(()=>{this._connectingToWebsocketPromise=null,this._ws=l,this.connected=!0,Qe()||Ha?console.log(`⊞ Connected to networking backend
`+Xa):console.debug("⊞ Connected to networking backend",Xa),n(!0),this.onSendQueued(yh.OnConnection)}).onClose(d=>{this._connectingToWebsocketPromise=null,this.connected=!1,this._isInRoom=!1,n(!1);let u="Websocket connection closed...";Xa!=null&&Xa.includes("/socket")||(u+=' Do you perhaps mean to connect to "/socket"?'),console.error(u)}).onError(d=>{console.error("⊠ Websocket connection failed..."),n(!1)}).onRetry(()=>{console.log("→ Retry connecting to networking websocket")}).build();l.addEventListener(r.WebsocketEvent.message,(d,u)=>{this.onMessage(d,u)})})}onMessage(e,t){const i=t.data;try{if(typeof i!="string"){i.size&&this.handleIncomingBinaryMessage(i);return}const n=JSON.parse(i);if(Array.isArray(n))for(const r of n)this.handleIncomingStringMessage(r);else this.handleIncomingStringMessage(n);return}catch(n){Ha&&i==="pong"?console.log("<<",i):Qe()&&console.error("Failed to parse message",n)}}async handleIncomingBinaryMessage(e){LN&&console.log("<< bin",this.context.time.frame);const t=await e.arrayBuffer();var i=new Uint8Array(t);const n=new uS(i),r=n.getBufferIdentifier(),o=this._listenersBinary[r],a=Yne(n),l=Jne(a);if(l&&typeof l=="string"&&(this._state[l]=a),!o)return;const c=a??n;for(const h of o)h(c)}handleIncomingStringMessage(e){var n,r;if(Ha&&console.log("<<",e.key??e),e.key)switch(e.key){case"connection-start-info":if(e.data){const l=e.data;l&&(console.assert(l.id!==void 0&&l.id!==null&&l.id.length>0,"server did not send connection id",l.id),console.debug("Your id is: "+l.id,this.context.alias??""),this._connectionId=l.id)}else console.warn("Expected connection id in "+e.key);break;case"joined-room":if(Ha&&console.log(e),e){this._isInRoom=!0;const l=e;this._currentRoomName=l.room,this._currentRoomViewId=l.viewId,this._currentRoomAllowEditing=l.allowEditing??!0,this._currentInRoom.length=0,this._currentInRoom.push(...l.inRoom),(LN||Qe())&&console.debug("Joined Needle Engine Room: "+l.room);const c=new URL(window.location.href);c.searchParams.has("room")&&c.searchParams.delete("room"),c.searchParams.set("view",this._currentRoomViewId),console.debug(`Room view id: ${this._currentRoomViewId}
${c.href}`)}this.onSendQueued(yh.OnRoomJoin);break;case"left-room":e.room===this.currentRoomName&&(this._isInRoom=!1,this._currentRoomName=null,this._currentInRoom.length=0);break;case"user-joined-room":if(e.data){const l=e.data;this._currentInRoom.push(l.userId),Ha&&console.log(l.userId+" joined","now in room:",this._currentInRoom)}break;case"user-left-room":if(e.data){const l=e.data,c=this._currentInRoom.indexOf(l.userId);c>=0&&(Ha&&console.log(l.userId+" left","now in room:",this._currentInRoom),this._currentInRoom.splice(c,1)),l.userId===this.connectionId&&console.log("you left the room")}break;case"all-room-state-deleted":Ha&&console.log("RECEIVED all-room-state-deleted"),this._state={};break;case"ping":case"pong":const a=(n=e.data)==null?void 0:n.time;a&&(this._currentDelay=this.context.time.time-a),Ha&&console.log("Current latency: "+this._currentDelay.toFixed(4)+" sec","Clients in room: "+((r=this._currentInRoom)==null?void 0:r.length));break}const t=e.data;t&&(this._state[t.guid]=t);let i=this._listeners[e.key];if(i){i=[...i];for(const o of i)try{o(e.data)}catch(a){console.error('Error invoking callback for "'+e.key+'"',a)}}}toMessage(e,t){return{key:e,data:t}}sendWithWebsocket(e,t,i=yh.OnRoomJoin){if(!this._ws){const r=this._waitingForSocket[i]||[];r.push(()=>this.sendWithWebsocket(e,t,i)),this._waitingForSocket[i]=r;return}const n=JSON.stringify(this.toMessage(e,t));Ha&&console.log(">>",e),this._ws.send(n)}onSendQueued(e){const t=this._waitingForSocket[e];if(t){for(const i of t)i();t.length=0}}}const sw=ee("debugwebxr");class BN{constructor(e,t){p(this,"controllerStates",[]);p(this,"userId");p(this,"context");p(this,"userStateEvtName");p(this,"onReceivedControllerState",e=>{sw&&console.log(`XRSync: Received change for ${this.userId}: ${e.type} ${e.handedness}; tracked=${e.isTracking}`);let t=!1;for(let i=0;i<this.controllerStates.length;i++)if(this.controllerStates[i].index===e.index){this.controllerStates[i]=e,t=!0;break}t||this.controllerStates.push(e)});this.userId=e,this.context=t,this.userStateEvtName="xr-sync-user-state-"+e,this.context.connection.beginListen(this.userStateEvtName,this.onReceivedControllerState)}dispose(){this.context.connection.stopListen(this.userStateEvtName,this.onReceivedControllerState)}update(e){if(this.context.connection.isConnected!=!1){for(let t=this.controllerStates.length-1;t>=0;t--){const i=this.controllerStates[t];let n=!1;for(let r=0;r<e.controllers.length;r++)e.controllers[r].index===i.index&&(n=!0);n||(sw&&console.log(`XRSync: ${i.type} ${i.handedness} removed`,i.index),this.controllerStates.splice(t,1),this.sendControllerRemoved(i))}for(const t of e.controllers)this.updateControllerStates(t)}}onExitXR(e){for(const t of this.controllerStates)this.sendControllerRemoved(t);this.controllerStates.length=0}sendControllerRemoved(e){e.isTracking=!1,e.guid="",this.context.connection.send(this.userStateEvtName,e),this.context.connection.sendDeleteRemoteState(e.guid)}updateControllerStates(e){const t=this.controllerStates.find(i=>i.index===e.index);if(t){let i=!1;i||(i=t.isTracking!=e.isTracking),i&&(t.isTracking=e.isTracking,this.context.connection.send(this.userStateEvtName,t))}else{const i={guid:this.userId+"-"+e.index,isTracking:e.isTracking,handedness:e.side,index:e.index,type:e.hand?"hand":"controller"};this.controllerStates.push(i),this.context.connection.send(this.userStateEvtName,i),sw&&console.log(`XRSync: ${i.type} ${i.handedness} added`,i.index)}}}class Wse{constructor(e){p(this,"context");p(this,"onJoinedRoom",()=>{if(this.context.connection.connectionId){this._states.has(this.context.connection.connectionId)||(sw&&console.log("XRSync: Local user joined room",this.context.connection.connectionId),this._states.set(this.context.connection.connectionId,new BN(this.context.connection.connectionId,this.context)));for(const e of this.context.connection.usersInRoom())this._states.has(e)||this._states.set(e,new BN(e,this.context))}});p(this,"onLeftRoom",()=>{if(this.context.connection.connectionId&&!this._states.has(this.context.connection.connectionId)){const e=this._states.get(this.context.connection.connectionId);e==null||e.dispose(),this._states.delete(this.context.connection.connectionId)}});p(this,"onOtherUserJoinedRoom",e=>{const t=e.userId;this._states.has(t)||(sw&&console.log("XRSync: Remote user joined room",t),this._states.set(t,new BN(t,this.context)))});p(this,"onOtherUserLeftRoom",e=>{const t=e.userId;if(!this._states.has(t)){const i=this._states.get(t);i==null||i.dispose(),this._states.delete(t)}});p(this,"_states",new Map);this.context=e,this.context.connection.beginListen(ri.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(ri.LeftRoom,this.onLeftRoom),this.context.connection.beginListen(ri.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.beginListen(ri.UserLeftRoom,this.onOtherUserLeftRoom)}hasState(e){return e?this._states.has(e):!1}isTracking(e,t){if(!e)return;const i=this._states.get(e);if(!i)return;const n=i.controllerStates.find(r=>r.handedness===t);return(n==null?void 0:n.isTracking)||!1}getDeviceType(e,t){if(!e)return;const i=this._states.get(e);if(!i)return;const n=i.controllerStates.find(r=>r.handedness===t);return(n==null?void 0:n.type)||"unknown"}destroy(){this.context.connection.stopListen(ri.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(ri.LeftRoom,this.onLeftRoom),this.context.connection.stopListen(ri.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.stopListen(ri.UserLeftRoom,this.onOtherUserLeftRoom)}onUpdate(e){if(this.context.connection.isConnected&&this.context.connection.connectionId){const t=this._states.get(this.context.connection.connectionId);t==null||t.update(e)}}onExitXR(e){if(this.context.connection.isConnected&&this.context.connection.connectionId){const t=this._states.get(this.context.connection.connectionId);t==null||t.onExitXR(e)}}}class O4{constructor(){p(this,"_fadeToColorQuad");p(this,"_fadeToColorMaterial");p(this,"_requestedFadeValue",0);p(this,"_transitionPromise",null);p(this,"_transitionResolve",null);this._fadeToColorMaterial=new ii({color:0,transparent:!0,depthTest:!1,fog:!1,side:Zi}),this._fadeToColorQuad=new fe(new Rs(10,10),this._fadeToColorMaterial)}dispose(){this._fadeToColorQuad.geometry.dispose(),this._fadeToColorMaterial.dispose()}update(e,t){const i=this._fadeToColorQuad,n=this._fadeToColorMaterial;i.parent!==e&&n.opacity>0?e.add(i):n.opacity===0&&i.removeFromParent(),i.layers.set(2),i.material=this._fadeToColorMaterial,i.position.z=-1,i.renderOrder=1/0;const r=this._requestedFadeValue;n.opacity=lt.lerp(n.opacity,r,t/.03),Math.abs(n.opacity-r)<=.01&&this._transitionResolve&&(this._transitionResolve(),this._transitionResolve=null,this._transitionPromise=null,this._requestedFadeValue=0)}remove(){this._fadeToColorQuad.removeFromParent()}fadeTransition(){if(this._transitionPromise)return this._transitionPromise;this._requestedFadeValue=1;const e=new Promise(t=>{this._transitionResolve=t});return this._transitionPromise=e,e}}class S2e extends Qx{constructor(e,t={}){const i=t.font;if(i===void 0)super();else{const n=i.generateShapes(e,t.size);t.depth===void 0&&t.height!==void 0&&console.warn("THREE.TextGeometry: .height is now depreciated. Please use .depth instead"),t.depth=t.depth!==void 0?t.depth:t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(n,t)}this.type="TextGeometry"}}class M2e extends ps{constructor(e){super(e)}load(e,t,i,n){const r=this,o=new Is(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){const l=r.parse(JSON.parse(a));t&&t(l)},i,n)}parse(e){return new Hse(e)}}class Hse{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){const i=[],n=I2e(e,t,this.data);for(let r=0,o=n.length;r<o;r++)i.push(...n[r].toShapes());return i}}function I2e(s,e,t){const i=Array.from(s),n=e/t.resolution,r=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*n,o=[];let a=0,l=0;for(let c=0;c<i.length;c++){const h=i[c];if(h===`
`)a=0,l-=r;else{const d=T2e(h,n,a,l,t);a+=d.offsetX,o.push(d.path)}}return o}function T2e(s,e,t,i,n){const r=n.glyphs[s]||n.glyphs["?"];if(!r){console.error('THREE.Font: character "'+s+'" does not exists in font family '+n.familyName+".");return}const o=new r6;let a,l,c,h,d,u,f,m;if(r.o){const g=r._cachedOutline||(r._cachedOutline=r.o.split(" "));for(let A=0,y=g.length;A<y;)switch(g[A++]){case"m":a=g[A++]*e+t,l=g[A++]*e+i,o.moveTo(a,l);break;case"l":a=g[A++]*e+t,l=g[A++]*e+i,o.lineTo(a,l);break;case"q":c=g[A++]*e+t,h=g[A++]*e+i,d=g[A++]*e+t,u=g[A++]*e+i,o.quadraticCurveTo(d,u,c,h);break;case"b":c=g[A++]*e+t,h=g[A++]*e+i,d=g[A++]*e+t,u=g[A++]*e+i,f=g[A++]*e+t,m=g[A++]*e+i,o.bezierCurveTo(d,u,f,m,c,h);break}}return{offsetX:r.ha*e,path:o}}function E2e(s,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},i=s.getIndex(),n=s.getAttribute("position"),r=i?i.count:n.count;let o=0;const a=Object.keys(s.attributes),l={},c={},h=[],d=["getX","getY","getZ","getW"],u=["setX","setY","setZ","setW"];for(let b=0,x=a.length;b<x;b++){const v=a[b],_=s.attributes[v];l[v]=new _.constructor(new _.array.constructor(_.count*_.itemSize),_.itemSize,_.normalized);const C=s.morphAttributes[v];C&&(c[v]||(c[v]=[]),C.forEach((S,M)=>{const L=new S.array.constructor(S.count*S.itemSize);c[v][M]=new S.constructor(L,S.itemSize,S.normalized)}))}const f=e*.5,m=Math.log10(1/e),g=Math.pow(10,m),A=f*g;for(let b=0;b<r;b++){const x=i?i.getX(b):b;let v="";for(let _=0,C=a.length;_<C;_++){const S=a[_],M=s.getAttribute(S),L=M.itemSize;for(let w=0;w<L;w++)v+=`${~~(M[d[w]](x)*g+A)},`}if(v in t)h.push(t[v]);else{for(let _=0,C=a.length;_<C;_++){const S=a[_],M=s.getAttribute(S),L=s.morphAttributes[S],w=M.itemSize,E=l[S],B=c[S];for(let P=0;P<w;P++){const k=d[P],X=u[P];if(E[X](o,M[k](x)),L)for(let F=0,H=L.length;F<H;F++)B[F][X](o,L[F][k](x))}}t[v]=o,h.push(o),o++}}const y=s.clone();for(const b in s.attributes){const x=l[b];if(y.setAttribute(b,new x.constructor(x.array.slice(0,o*x.itemSize),x.itemSize,x.normalized)),b in c)for(let v=0;v<c[b].length;v++){const _=c[b][v];y.morphAttributes[b][v]=new _.constructor(_.array.slice(0,o*_.itemSize),_.itemSize,_.normalized)}}return y.setIndex(h),y}function Z4(s,e){if(e===Oj)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),s;if(e===xL||e===LU){let t=s.getIndex();if(t===null){const o=[],a=s.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);s.setIndex(o),t=s.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),s}const i=t.count-2,n=[];if(e===xL)for(let o=1;o<=i;o++)n.push(t.getX(0)),n.push(t.getX(o)),n.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(n.push(t.getX(o)),n.push(t.getX(o+1)),n.push(t.getX(o+2))):(n.push(t.getX(o+2)),n.push(t.getX(o+1)),n.push(t.getX(o)));n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=s.clone();return r.setIndex(n),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),s}class Tp extends ps{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new G2e(t)}),this.register(function(t){return new k2e(t)}),this.register(function(t){return new Z2e(t)}),this.register(function(t){return new W2e(t)}),this.register(function(t){return new H2e(t)}),this.register(function(t){return new D2e(t)}),this.register(function(t){return new F2e(t)}),this.register(function(t){return new V2e(t)}),this.register(function(t){return new z2e(t)}),this.register(function(t){return new P2e(t)}),this.register(function(t){return new U2e(t)}),this.register(function(t){return new N2e(t)}),this.register(function(t){return new O2e(t)}),this.register(function(t){return new X2e(t)}),this.register(function(t){return new L2e(t)}),this.register(function(t){return new Q2e(t)}),this.register(function(t){return new K2e(t)})}load(e,t,i,n){const r=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=Vd.extractUrlBase(e);o=Vd.resolveURL(c,this.path)}else o=Vd.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){n?n(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},l=new Is(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,o,function(h){t(h),r.manager.itemEnd(e)},a)}catch(h){a(h)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let r;const o={},a={},l=new TextDecoder;if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===Qse){try{o[Ei.KHR_BINARY_GLTF]=new Y2e(e)}catch(d){n&&n(d);return}r=JSON.parse(o[Ei.KHR_BINARY_GLTF].content)}else r=JSON.parse(l.decode(e));else r=e;if(r.asset===void 0||r.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new lBe(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const d=this.pluginCallbacks[h](c);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[d.name]=d,o[d.name]=!0}if(r.extensionsUsed)for(let h=0;h<r.extensionsUsed.length;++h){const d=r.extensionsUsed[h],u=r.extensionsRequired||[];switch(d){case Ei.KHR_MATERIALS_UNLIT:o[d]=new B2e;break;case Ei.KHR_DRACO_MESH_COMPRESSION:o[d]=new J2e(r,this.dracoLoader);break;case Ei.KHR_TEXTURE_TRANSFORM:o[d]=new j2e;break;case Ei.KHR_MESH_QUANTIZATION:o[d]=new q2e;break;default:u.indexOf(d)>=0&&a[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,n)}parseAsync(e,t){const i=this;return new Promise(function(n,r){i.parse(e,t,n,r)})}}function R2e(){let s={};return{get:function(e){return s[e]},add:function(e,t){s[e]=t},remove:function(e){delete s[e]},removeAll:function(){s={}}}}const Ei={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class L2e{constructor(e){this.parser=e,this.name=Ei.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const r=t[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let n=t.cache.get(i);if(n)return n;const r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let c;const h=new ge(16777215);l.color!==void 0&&h.setRGB(l.color[0],l.color[1],l.color[2],Ji);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new um(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new dm(h),c.distance=d;break;case"spot":c=new pA(h),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,Qu(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),n=Promise.resolve(c),t.cache.add(i,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,r=i.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}}let B2e=class{constructor(){this.name=Ei.KHR_MATERIALS_UNLIT}getMaterialType(){return ii}extendParams(e,t,i){const n=[];e.color=new ge(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],Ji),e.opacity=o[3]}r.baseColorTexture!==void 0&&n.push(i.assignTexture(e,"map",r.baseColorTexture,ft))}return Promise.all(n)}},P2e=class{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}},G2e=class{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:To}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Q(a,a)}return Promise.all(r)}},k2e=class{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:To}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}},N2e=class{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:To}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}},D2e=class{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:To}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new ge(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=n.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],Ji)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,ft)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}},F2e=class{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:To}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}},V2e=class{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:To}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new ge().setRGB(a[0],a[1],a[2],Ji),Promise.all(r)}},z2e=class{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:To}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}},U2e=class{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:To}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new ge().setRGB(a[0],a[1],a[2],Ji),o.specularColorTexture!==void 0&&r.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,ft)),Promise.all(r)}},X2e=class{constructor(e){this.parser=e,this.name=Ei.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:To}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(i.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(r)}},O2e=class{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:To}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}};class Z2e{constructor(e){this.parser=e,this.name=Ei.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const r=n.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class W2e{constructor(e){this.parser=e,this.name=Ei.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=n.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class H2e{constructor(e){this.parser=e,this.name=Ei.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=n.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Q2e{constructor(e){this.name=Ei.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const n=i.extensions[this.name],r=this.parser.getDependency("buffer",n.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const l=n.byteOffset||0,c=n.byteLength||0,h=n.count,d=n.byteStride,u=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,d,u,n.mode,n.filter).then(function(f){return f.buffer}):o.ready.then(function(){const f=new ArrayBuffer(h*d);return o.decodeGltfBuffer(new Uint8Array(f),h,d,u,n.mode,n.filter),f})})}else return null}}let K2e=class{constructor(e){this.name=Ei.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const n=t.meshes[i.mesh];for(const c of n.primitives)if(c.mode!==Sc.TRIANGLES&&c.mode!==Sc.TRIANGLE_STRIP&&c.mode!==Sc.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(h=>(l[c]=h,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const h=c.pop(),d=h.isGroup?h.children:[h],u=c[0].count,f=[];for(const m of d){const g=new ce,A=new T,y=new Ve,b=new T(1,1,1),x=new XU(m.geometry,m.material,u);for(let v=0;v<u;v++)l.TRANSLATION&&A.fromBufferAttribute(l.TRANSLATION,v),l.ROTATION&&y.fromBufferAttribute(l.ROTATION,v),l.SCALE&&b.fromBufferAttribute(l.SCALE,v),x.setMatrixAt(v,g.compose(A,y,b));for(const v in l)if(v==="_COLOR_0"){const _=l[v];x.instanceColor=new $o(_.array,_.itemSize,_.normalized)}else v!=="TRANSLATION"&&v!=="ROTATION"&&v!=="SCALE"&&m.geometry.setAttribute(v,l[v]);ye.prototype.copy.call(x,m),this.parser.assignFinalMaterial(x),f.push(x)}return h.isGroup?(h.clear(),h.add(...f),h):f[0]}))}};const Qse="glTF",v_=12,W4={JSON:1313821514,BIN:5130562};class Y2e{constructor(e){this.name=Ei.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,v_),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Qse)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-v_,r=new DataView(e,v_);let o=0;for(;o<n;){const a=r.getUint32(o,!0);o+=4;const l=r.getUint32(o,!0);if(o+=4,l===W4.JSON){const c=new Uint8Array(e,v_+o,a);this.content=i.decode(c)}else if(l===W4.BIN){const c=v_+o;this.body=e.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class J2e{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ei.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const h in o){const d=rz[h]||h.toLowerCase();a[d]=o[h]}for(const h in e.attributes){const d=rz[h]||h.toLowerCase();if(o[h]!==void 0){const u=i.accessors[e.attributes[h]],f=$b[u.componentType];c[d]=f.name,l[d]=u.normalized===!0}}return t.getDependency("bufferView",r).then(function(h){return new Promise(function(d,u){n.decodeDracoFile(h,function(f){for(const m in f.attributes){const g=f.attributes[m],A=l[m];A!==void 0&&(g.normalized=A)}d(f)},a,c,Ji,u)})})}}class j2e{constructor(){this.name=Ei.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class q2e{constructor(){this.name=Ei.KHR_MESH_QUANTIZATION}}class Kse extends Kx{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n*3+n;for(let o=0;o!==n;o++)t[o]=i[r+o];return t}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,h=n-t,d=(i-t)/h,u=d*d,f=u*d,m=e*c,g=m-c,A=-2*f+3*u,y=f-u,b=1-A,x=y-u+d;for(let v=0;v!==a;v++){const _=o[g+v+a],C=o[g+v+l]*h,S=o[m+v+a],M=o[m+v]*h;r[v]=b*_+x*C+A*S+y*M}return r}}const $2e=new Ve;class eBe extends Kse{interpolate_(e,t,i,n){const r=super.interpolate_(e,t,i,n);return $2e.fromArray(r).normalize().toArray(r),r}}const Sc={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},$b={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},H4={9728:qt,9729:Ot,9984:g1,9985:mp,9986:Id,9987:xr},Q4={33071:ea,33648:Sp,10497:Mo},PN={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},rz={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},lf={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},tBe={CUBICSPLINE:void 0,LINEAR:Mp,STEP:hm},GN={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function iBe(s){return s.DefaultMaterial===void 0&&(s.DefaultMaterial=new Us({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:us})),s.DefaultMaterial}function Ig(s,e,t){for(const i in t.extensions)s[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Qu(s,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(s.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function nBe(s,e,t){let i=!1,n=!1,r=!1;for(let c=0,h=e.length;c<h;c++){const d=e[c];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(n=!0),d.COLOR_0!==void 0&&(r=!0),i&&n&&r)break}if(!i&&!n&&!r)return Promise.resolve(s);const o=[],a=[],l=[];for(let c=0,h=e.length;c<h;c++){const d=e[c];if(i){const u=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):s.attributes.position;o.push(u)}if(n){const u=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):s.attributes.normal;a.push(u)}if(r){const u=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):s.attributes.color;l.push(u)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const h=c[0],d=c[1],u=c[2];return i&&(s.morphAttributes.position=h),n&&(s.morphAttributes.normal=d),r&&(s.morphAttributes.color=u),s.morphTargetsRelative=!0,s})}function sBe(s,e){if(s.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)s.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(s.morphTargetInfluences.length===t.length){s.morphTargetDictionary={};for(let i=0,n=t.length;i<n;i++)s.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function rBe(s){let e;const t=s.extensions&&s.extensions[Ei.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+kN(t.attributes):e=s.indices+":"+kN(s.attributes)+":"+s.mode,s.targets!==void 0)for(let i=0,n=s.targets.length;i<n;i++)e+=":"+kN(s.targets[i]);return e}function kN(s){let e="";const t=Object.keys(s).sort();for(let i=0,n=t.length;i<n;i++)e+=t[i]+":"+s[t[i]]+";";return e}function oz(s){switch(s){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function oBe(s){return s.search(/\.jpe?g($|\?)/i)>0||s.search(/^data\:image\/jpeg/)===0?"image/jpeg":s.search(/\.webp($|\?)/i)>0||s.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const aBe=new ce;class lBe{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new R2e,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=-1,r=!1,o=-1;if(typeof navigator<"u"){const a=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(a)===!0;const l=a.match(/Version\/(\d+)/);n=i&&l?parseInt(l[1],10):-1,r=a.indexOf("Firefox")>-1,o=r?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&n<17||r&&o<98?this.textureLoader=new Mh(this.options.manager):this.textureLoader=new Y8(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Is(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][n.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:n.asset,parser:i,userData:{}};return Ig(r,a,n),Qu(a,n),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){const o=t[n].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let n=0,r=e.length;n<r;n++){const o=e[n];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),r=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,h]of o.children.entries())r(h,a.children[c])};return r(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const r=e(t[n]);r&&i.push(r)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":n=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(r,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Ei.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(r,o){i.load(Vd.resolveURL(t.uri,n.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const n=t.byteLength||0,r=t.byteOffset||0;return i.slice(r,r+n)})}loadAccessor(e){const t=this,i=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const o=PN[n.type],a=$b[n.componentType],l=n.normalized===!0,c=new a(n.count*o);return Promise.resolve(new dt(c,o,l))}const r=[];return n.bufferView!==void 0?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),n.sparse!==void 0&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=PN[n.type],c=$b[n.componentType],h=c.BYTES_PER_ELEMENT,d=h*l,u=n.byteOffset||0,f=n.bufferView!==void 0?i.bufferViews[n.bufferView].byteStride:void 0,m=n.normalized===!0;let g,A;if(f&&f!==d){const y=Math.floor(u/f),b="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+y+":"+n.count;let x=t.cache.get(b);x||(g=new c(a,y*f,n.count*f/h),x=new Hx(g,f/h),t.cache.add(b,x)),A=new Ma(x,l,u%f/h,m)}else a===null?g=new c(n.count*l):g=new c(a,u,n.count*l),A=new dt(g,l,m);if(n.sparse!==void 0){const y=PN.SCALAR,b=$b[n.sparse.indices.componentType],x=n.sparse.indices.byteOffset||0,v=n.sparse.values.byteOffset||0,_=new b(o[1],x,n.sparse.count*y),C=new c(o[2],v,n.sparse.count*l);a!==null&&(A=new dt(A.array.slice(),A.itemSize,A.normalized)),A.normalized=!1;for(let S=0,M=_.length;S<M;S++){const L=_[S];if(A.setX(L,C[S*l]),l>=2&&A.setY(L,C[S*l+1]),l>=3&&A.setZ(L,C[S*l+2]),l>=4&&A.setW(L,C[S*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}A.normalized=m}return A})}loadTexture(e){const t=this.json,i=this.options,r=t.textures[e].source,o=t.images[r];let a=this.textureLoader;if(o.uri){const l=i.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,i){const n=this,r=this.json,o=r.textures[e],a=r.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then(function(h){h.flipY=!1,h.name=o.name||a.name||"",h.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(h.name=a.uri);const u=(r.samplers||{})[o.sampler]||{};return h.magFilter=H4[u.magFilter]||Ot,h.minFilter=H4[u.minFilter]||xr,h.wrapS=Q4[u.wrapS]||Mo,h.wrapT=Q4[u.wrapT]||Mo,h.anisotropy=4,n.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const i=this,n=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const o=n.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(d){c=!0;const u=new Blob([d],{type:o.mimeType});return l=a.createObjectURL(u),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(d){return new Promise(function(u,f){let m=u;t.isImageBitmapLoader===!0&&(m=function(g){const A=new si(g);A.needsUpdate=!0,u(A)}),t.load(Vd.resolveURL(d,r.path),m,void 0,f)})}).then(function(d){return c===!0&&a.revokeObjectURL(l),Qu(d,o),d.userData.mimeType=o.mimeType||oBe(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=h,h}assignTexture(e,t,i,n){const r=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),r.extensions[Ei.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[Ei.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=r.associations.get(o);o=r.extensions[Ei.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,l)}}return n!==void 0&&(o.colorSpace=n),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const n=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new Td,Yt.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new _n,Yt.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(n||r||o){let a="ClonedMaterial:"+i.uuid+":";n&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),n&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return Us}loadMaterial(e){const t=this,i=this.json,n=this.extensions,r=i.materials[e];let o;const a={},l=r.extensions||{},c=[];if(l[Ei.KHR_MATERIALS_UNLIT]){const d=n[Ei.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),c.push(d.extendParams(a,r,t))}else{const d=r.pbrMetallicRoughness||{};if(a.color=new ge(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const u=d.baseColorFactor;a.color.setRGB(u[0],u[1],u[2],Ji),a.opacity=u[3]}d.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",d.baseColorTexture,ft)),a.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,a.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(u){return u.getMaterialType&&u.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(u){return u.extendMaterialParams&&u.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=Zi);const h=r.alphaMode||GN.OPAQUE;if(h===GN.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===GN.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==ii&&(c.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new Q(1,1),r.normalTexture.scale!==void 0)){const d=r.normalTexture.scale;a.normalScale.set(d,d)}if(r.occlusionTexture!==void 0&&o!==ii&&(c.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==ii){const d=r.emissiveFactor;a.emissive=new ge().setRGB(d[0],d[1],d[2],Ji)}return r.emissiveTexture!==void 0&&o!==ii&&c.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,ft)),Promise.all(c).then(function(){const d=new o(a);return r.name&&(d.name=r.name),Qu(d,r),t.associations.set(d,{materials:e}),r.extensions&&Ig(n,d,r),d})}createUniqueName(e){const t=di.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,n=this.primitiveCache;function r(a){return i[Ei.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return K4(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],h=rBe(c),d=n[h];if(d)o.push(d.promise);else{let u;c.extensions&&c.extensions[Ei.KHR_DRACO_MESH_COMPRESSION]?u=r(c):u=K4(new It,c,t),n[h]={primitive:c,promise:u},o.push(u)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,n=this.extensions,r=i.meshes[e],o=r.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const h=o[l].material===void 0?iBe(this.cache):this.getDependency("material",o[l].material);a.push(h)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],d=[];for(let f=0,m=h.length;f<m;f++){const g=h[f],A=o[f];let y;const b=c[f];if(A.mode===Sc.TRIANGLES||A.mode===Sc.TRIANGLE_STRIP||A.mode===Sc.TRIANGLE_FAN||A.mode===void 0)y=r.isSkinnedMesh===!0?new ol(g,b):new fe(g,b),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),A.mode===Sc.TRIANGLE_STRIP?y.geometry=Z4(y.geometry,LU):A.mode===Sc.TRIANGLE_FAN&&(y.geometry=Z4(y.geometry,xL));else if(A.mode===Sc.LINES)y=new sa(g,b);else if(A.mode===Sc.LINE_STRIP)y=new ts(g,b);else if(A.mode===Sc.LINE_LOOP)y=new OU(g,b);else if(A.mode===Sc.POINTS)y=new Hb(g,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+A.mode);Object.keys(y.geometry.morphAttributes).length>0&&sBe(y,r),y.name=t.createUniqueName(r.name||"mesh_"+e),Qu(y,r),A.extensions&&Ig(n,y,A),t.assignFinalMaterial(y),d.push(y)}for(let f=0,m=d.length;f<m;f++)t.associations.set(d[f],{meshes:e,primitives:f});if(d.length===1)return r.extensions&&Ig(n,d[0],r),d[0];const u=new Ms;r.extensions&&Ig(n,u,r),t.associations.set(u,{meshes:e});for(let f=0,m=d.length;f<m;f++)u.add(d[f]);return u})}loadCamera(e){let t;const i=this.json.cameras[e],n=i[i.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new Xt(Bi.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):i.type==="orthographic"&&(t=new zh(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Qu(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let n=0,r=t.joints.length;n<r;n++)i.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(n){const r=n.pop(),o=n,a=[],l=[];for(let c=0,h=o.length;c<h;c++){const d=o[c];if(d){a.push(d);const u=new ce;r!==null&&u.fromArray(r.array,c*16),l.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new C1(a,l)})}loadAnimation(e){const t=this.json,i=this,n=t.animations[e],r=n.name?n.name:"animation_"+e,o=[],a=[],l=[],c=[],h=[];let d=0,u=n.channels.length;for(d=0,u=n.channels.length;d<u;d++){const f=n.channels[d],m=n.samplers[f.sampler],g=f.target,A=g.node,y=n.parameters!==void 0?n.parameters[m.input]:m.input,b=n.parameters!==void 0?n.parameters[m.output]:m.output;g.node!==void 0&&(o.push(this.getDependency("node",A)),a.push(this.getDependency("accessor",y)),l.push(this.getDependency("accessor",b)),c.push(m),h.push(g))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(f){const m=f[0],g=f[1],A=f[2],y=f[3],b=f[4],x=[];for(d=0,u=m.length;d<u;d++){const v=m[d],_=g[d],C=A[d],S=y[d],M=b[d];if(v===void 0)continue;v.updateMatrix&&v.updateMatrix();const L=i._createAnimationTracks(v,_,C,S,M);if(L)for(let w=0;w<L.length;w++)x.push(L[w])}return new Ba(r,void 0,x)})}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return n.mesh===void 0?null:i.getDependency("mesh",n.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,n.mesh,r);return n.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=n.weights.length;l<c;l++)a.morphTargetInfluences[l]=n.weights[l]}),o})}loadNode(e){const t=this.json,i=this,n=t.nodes[e],r=i._loadNodeShallow(e),o=[],a=n.children||[];for(let c=0,h=a.length;c<h;c++)o.push(i.getDependency("node",a[c]));const l=n.skin===void 0?Promise.resolve(null):i.getDependency("skin",n.skin);return Promise.all([r,Promise.all(o),l]).then(function(c){const h=c[0],d=c[1],u=c[2];u!==null&&h.traverse(function(f){f.isSkinnedMesh&&f.bind(u,aBe)});for(let f=0,m=d.length;f<m;f++)h.add(d[f]);return h})}_loadNodeShallow(e){const t=this.json,i=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],o=r.name?n.createUniqueName(r.name):"",a=[],l=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),r.camera!==void 0&&a.push(n.getDependency("camera",r.camera).then(function(c){return n._getNodeRef(n.cameraCache,r.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let h;if(r.isBone===!0?h=new Q0:c.length>1?h=new Ms:c.length===1?h=c[0]:h=new ye,h!==c[0])for(let d=0,u=c.length;d<u;d++)h.add(c[d]);if(r.name&&(h.userData.name=r.name,h.name=o),Qu(h,r),r.extensions&&Ig(i,h,r),r.matrix!==void 0){const d=new ce;d.fromArray(r.matrix),h.applyMatrix4(d)}else r.translation!==void 0&&h.position.fromArray(r.translation),r.rotation!==void 0&&h.quaternion.fromArray(r.rotation),r.scale!==void 0&&h.scale.fromArray(r.scale);return n.associations.has(h)||n.associations.set(h,{}),n.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],n=this,r=new Ms;i.name&&(r.name=n.createUniqueName(i.name)),Qu(r,i),i.extensions&&Ig(t,r,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(n.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let h=0,d=l.length;h<d;h++)r.add(l[h]);const c=h=>{const d=new Map;for(const[u,f]of n.associations)(u instanceof Yt||u instanceof si)&&d.set(u,f);return h.traverse(u=>{const f=n.associations.get(u);f!=null&&d.set(u,f)}),d};return n.associations=c(r),r})}_createAnimationTracks(e,t,i,n,r){const o=[],a=e.name?e.name:e.uuid,l=[];lf[r.path]===lf.weights?e.traverse(function(u){u.morphTargetInfluences&&l.push(u.name?u.name:u.uuid)}):l.push(a);let c;switch(lf[r.path]){case lf.weights:c=Ip;break;case lf.rotation:c=Kd;break;case lf.position:case lf.scale:c=Yd;break;default:switch(i.itemSize){case 1:c=Ip;break;case 2:case 3:default:c=Yd;break}break}const h=n.interpolation!==void 0?tBe[n.interpolation]:Mp,d=this._getArrayFromAccessor(i);for(let u=0,f=l.length;u<f;u++){const m=new c(l[u]+"."+lf[r.path],t.array,d,h);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=oz(t.constructor),n=new Float32Array(t.length);for(let r=0,o=t.length;r<o;r++)n[r]=t[r]*i;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const n=this instanceof Kd?eBe:Kse;return new n(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function cBe(s,e,t){const i=e.attributes,n=new oi;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(n.set(new T(l[0],l[1],l[2]),new T(c[0],c[1],c[2])),a.normalized){const h=oz($b[a.componentType]);n.min.multiplyScalar(h),n.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new T,l=new T;for(let c=0,h=r.length;c<h;c++){const d=r[c];if(d.POSITION!==void 0){const u=t.json.accessors[d.POSITION],f=u.min,m=u.max;if(f!==void 0&&m!==void 0){if(l.setX(Math.max(Math.abs(f[0]),Math.abs(m[0]))),l.setY(Math.max(Math.abs(f[1]),Math.abs(m[1]))),l.setZ(Math.max(Math.abs(f[2]),Math.abs(m[2]))),u.normalized){const g=oz($b[u.componentType]);l.multiplyScalar(g)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(a)}s.boundingBox=n;const o=new Vn;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,s.boundingSphere=o}function K4(s,e,t){const i=e.attributes,n=[];function r(o,a){return t.getDependency("accessor",o).then(function(l){s.setAttribute(a,l)})}for(const o in i){const a=rz[o]||o.toLowerCase();a in s.attributes||n.push(r(i[o],a))}if(e.indices!==void 0&&!s.index){const o=t.getDependency("accessor",e.indices).then(function(a){s.setIndex(a)});n.push(o)}return ni.workingColorSpace!==Ji&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ni.workingColorSpace}" not supported.`),Qu(s,e),cBe(s,e,t),Promise.all(n).then(function(){return e.targets!==void 0?nBe(s,e.targets,t):s})}var $0=(s=>(s[s.Quad=0]="Quad",s[s.Cube=1]="Cube",s[s.Sphere=2]="Sphere",s[s.RoundedCube=10]="RoundedCube",s))($0||{}),u1,az;class zm{static createText(e,t){let i=null;const n=(t==null?void 0:t.font)||dBe((t==null?void 0:t.familyFamily)||null);n instanceof Hse?i=ng(this,u1,az).call(this,e,n,t):i==null&&(i=new It);const r=(t==null?void 0:t.color)||16777215,o=new fe(i,(t==null?void 0:t.material)??new Us({color:r}));return this.applyDefaultObjectOptions(o,t),n instanceof Promise?n.then(a=>{o.geometry=ng(this,u1,az).call(this,e,a,t),t!=null&&t.onGeometry&&t.onGeometry(o)}):t!=null&&t.onGeometry&&t.onGeometry(o),o}static createOccluder(e){const t=new ii({colorWrite:!1,depthWrite:!0,side:Zi});return this.createPrimitive(e,{material:t})}static createPrimitive(e,t){let i;const n=(t==null?void 0:t.color)||16777215;switch(e){case"Quad":case 0:{const r=new Rs(1,1,1,1),o=(t==null?void 0:t.material)??new Us({color:n});t!=null&&t.texture&&"map"in o&&(o.map=t.texture),i=new fe(r,o),i.name="Quad"}break;case"Cube":case 1:{const r=new pn(1,1,1),o=(t==null?void 0:t.material)??new Us({color:n});t!=null&&t.texture&&"map"in o&&(o.map=t.texture),i=new fe(r,o),i.name="Cube"}break;case 10:case"RoundedCube":{const r=hBe(1,1,1,.1,2),o=(t==null?void 0:t.material)??new Us({color:n});t!=null&&t.texture&&"map"in o&&(o.map=t.texture),i=new fe(r,o),i.name="RoundedCube"}break;case"Sphere":case 2:{const r=new Wc(.5,16,16),o=(t==null?void 0:t.material)??new Us({color:n});t!=null&&t.texture&&"map"in o&&(o.map=t.texture),i=new fe(r,o),i.name="Sphere"}break;case"ShaderBall":i=new Ms,i.name="ShaderBall",uBe(i,t);break}return this.applyDefaultObjectOptions(i,t),i}static createSprite(e){const i=new _1({color:16777215});e!=null&&e.texture&&"map"in i&&(i.map=e.texture);const n=new zU(i);return this.applyDefaultObjectOptions(n,e),n}static applyDefaultObjectOptions(e,t){e.receiveShadow=!0,e.castShadow=!0,t!=null&&t.name&&(e.name=t.name),t!=null&&t.position&&(Array.isArray(t.position)?e.position.set(t.position[0],t.position[1],t.position[2]):e.position.set(t.position.x,t.position.y,t.position.z)),t!=null&&t.rotation&&(Array.isArray(t.rotation)?e.rotation.set(t.rotation[0],t.rotation[1],t.rotation[2]):e.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z)),t!=null&&t.scale&&(typeof t.scale=="number"?e.scale.set(t.scale,t.scale,t.scale):e.scale.set(t.scale.x,t.scale.y,t.scale.z)),(t==null?void 0:t.receiveShadow)!=null&&(e.receiveShadow=t.receiveShadow),(t==null?void 0:t.castShadow)!=null&&(e.castShadow=t.castShadow),t!=null&&t.parent&&t.parent.add(e)}}u1=new WeakSet,az=function(e,t,i){const n=(i==null?void 0:i.depth)||.1;return new S2e(e,{font:t,size:1,depth:n,height:n,bevelEnabled:(i==null?void 0:i.bevel)||!1,bevelThickness:.01,bevelOffset:.01,bevelSize:.01})},ml(zm,u1);function hBe(s,e,t,i,n){const r=new Xf,o=1e-5,a=i-o;r.absarc(o,o,o,-Math.PI/2,-Math.PI,!0),r.absarc(o,e-a*2,o,Math.PI,Math.PI/2,!0),r.absarc(s-a*2,e-a*2,o,Math.PI/2,0,!0),r.absarc(s-a*2,o,o,0,-Math.PI/2,!0);const l=new Qx(r,{bevelEnabled:!0,bevelSegments:n*2,steps:1,bevelSize:a,bevelThickness:i,curveSegments:n});return l.scale(1,1,1-i),l.center(),l.computeVertexNormals(),l}const QT=new Map;function dBe(s){let e="";switch(s){default:case"OpenSans":e="https://cdn.needle.tools/static/fonts/facetype/Open Sans_Regular_ascii.json";break;case"Helvetiker":e="https://raw.githubusercontent.com/mrdoob/three.js/master/examples/fonts/helvetiker_regular.typeface.json";break}if(QT.has(e)){const n=QT.get(e);if(n)return n}const t=new M2e,i=new Promise((n,r)=>{t.load(e,o=>{QT.set(e,o),n(o)},void 0,r)});return QT.set(e,i),i}let NN=!1,DN=null;function uBe(s,e){if(DN===null){const t="https://cdn.needle.tools/static/models/shaderball.glb",i=new Tp,n=cP(null);i.setDRACOLoader(n.dracoLoader),i.setKTX2Loader(n.ktx2Loader),NN=!0,DN=i.loadAsync(t).then(r=>{const o=r.scene;return o.position.y-=.5,o}).catch(r=>(console.warn("Failed to load shaderball mesh: "+r.message),J4())).finally(()=>{NN=!1})}if(NN){const t=J4();t.name="ShaderBall-Placeholder";const i=t.children[0];(i==null?void 0:i.type)==="Mesh"&&Y4(i,e),s.add(t)}DN.then(t=>{s.children.forEach(r=>{r.name==="ShaderBall-Placeholder"&&s.remove(r)});const i=t.clone(),n=i.children[0];(n==null?void 0:n.type)==="Mesh"&&Y4(n,e),s.add(i)})}function Y4(s,e){var i;if((e==null?void 0:e.color)||(e==null?void 0:e.material)||(e==null?void 0:e.texture)){const n=(e==null?void 0:e.material)??((i=s.material)==null?void 0:i.clone())??new Us;e.color&&"color"in n&&n.color instanceof ge&&n.color.set(e.color),e!=null&&e.texture&&"map"in n&&(n.map=e.texture),s.material=n}}function J4(){return new Ms().add(zm.createPrimitive("Sphere",{material:new ii({transparent:!0,opacity:.1})}))}const KZ=class{constructor(e,t,i){p(this,"_session");p(this,"_mode");p(this,"_init");p(this,"_renderer");p(this,"_camera");p(this,"_scene");p(this,"onEnd",()=>{var e;(e=this._session)==null||e.removeEventListener("end",this.onEnd),this._renderer.setAnimationLoop(null),this._renderer.dispose(),this._scene.clear()});p(this,"_lastTime",0);p(this,"onFrame",(e,t)=>{const i=e-this._lastTime;this.update(e,i),this._camera.parent!==this._scene&&this._scene.add(this._camera),this._renderer.render(this._scene,this._camera)});p(this,"_objects",[]);this._mode=e,this._init=t,this._session=i,this._session.addEventListener("end",this.onEnd),this._renderer=new Mm({alpha:!0}),this._renderer.setAnimationLoop(this.onFrame),this._renderer.xr.setSession(i),this._renderer.xr.enabled=!0,this._camera=new Xt,this._scene=new sr,this._scene.fog=new sB(4473924,10,250),this._scene.add(this._camera),this.setupScene()}static get active(){return this._active}static async start(e,t){if(this._active)return console.error("Cannot start a new XR session while one is already active"),null;if(this._requestInFlight)return console.error("Cannot start a new XR session while a request is already in flight"),null;if("xr"in navigator&&navigator.xr){if(!t)return console.error("XRSessionInit must be provided"),null;this._requestInFlight=!0;const i=await navigator.xr.requestSession(e,t);return i.addEventListener("end",()=>{this._active=null}),this._requestInFlight?(this._requestInFlight=!1,this._active=new KZ(e,t,i),this._active):(i.end(),null)}return null}static async handoff(){return this._active?this._active.handoff():null}static async stop(){this._requestInFlight=!1,this._active&&(await this._active.end(),await Nh(100)),this._active=null}get isAR(){return this._mode==="immersive-ar"}end(){return this._session?this._session.end():Promise.resolve()}async handoff(){if(!this._session)throw new Error("Cannot handoff a session that has already ended");const e={session:this._session,mode:this._mode,init:this._init};return await this.onBeforeHandoff(),this.onEnd(),this._session=null,e}async onBeforeHandoff(){await Nh(1e3),this._scene.clear()}setupScene(){this._scene.background=new ge(0),this._scene.add(new SB(5,10,1118481,1118481));const e=new um(16777215,1);e.position.set(0,20,0),e.castShadow=!1,this._scene.add(e);const t=new um(16777215,1);t.position.set(0,-1,0),t.castShadow=!1,this._scene.add(t);const i=new dm(16777215,1,100,1);i.position.set(0,2,0),i.castShadow=!1,i.distance=200,this._scene.add(i);const n=50;for(let r=0;r<100;r++){const o=new Us({color:2236962,metalness:1,roughness:.8});this.isAR&&(o.emissive=new ge(Math.random(),Math.random(),Math.random()),o.emissiveIntensity=Math.random());const a=lt.random(0,1)>.5?$0.Sphere:$0.Cube,l=zm.createPrimitive(a,{material:o});l.position.x=lt.random(-n,n),l.position.y=lt.random(-2,n),l.position.z=lt.random(-n,n),l.rotation.x=lt.random(0,Math.PI*2),l.rotation.y=lt.random(0,Math.PI*2),l.rotation.z=lt.random(0,Math.PI*2),l.scale.multiplyScalar(.5+Math.random()*10);const c=l.position.distanceTo(this._camera.position)-l.scale.x;c<1&&l.position.multiplyScalar(1+1/c),this._objects.push(l),this._scene.add(l)}}update(e,t){const i=e*4e-4;for(let n=0;n<this._objects.length;n++){const r=this._objects[n];r.position.y+=Math.sin(i+n*.5)*.005,r.rotateY(.002)}}};let Nf=KZ;p(Nf,"_active",null),p(Nf,"_requestInFlight",!1);var fS;(s=>{const e=[];function t(){if(!(e!=null&&e.length))return!1;for(const r of e)r.exportAndOpen();return!0}s.exportAndOpen=t;function i(r){e.push(r)}s.registerExporter=i;function n(r){if(!e)return;const o=e.indexOf(r);o>=0&&e.splice(o,1)}s.unregisterExporter=n})(fS||(fS={}));const j4="NeedleXRSession onStart",q4="NeedleXRSession onEnd",Rr=ee("debugwebxr"),$4=ee("stats");let FN=0;function pBe(s){let e=null;const t=s;return t.getAROverlayContainer?e=t.getAROverlayContainer():e=s,e}fBe();async function fBe(){var s;if(ee("debugasap")){let e=globalThis["needle:XRSession"];if(e instanceof Promise){delete globalThis["needle:XRSession"],Oi.addContextCreatedCallback(async t=>{if(!e)return;I0(!0);const i=await e;if(i){const n=Vt.getDefaultSessionInit("immersive-vr");Vt.setSession("immersive-vr",i,n,t.context)}else console.error("NeedleXRSession: ASAP session was rejected");e=void 0});return}}if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent)){console.warn("WebXRViewer does not support addEventListener");return}(s=navigator.xr)==null||s.addEventListener("sessiongranted",async()=>{I0(!0),console.log("Received Session Granted..."),await Nh(100);const e=sessionStorage.getItem("needle_xr_session_mode"),t=sessionStorage.getItem("needle_xr_session_init")??null,i=t?JSON.parse(t):null;let n=null;if(Yse()&&(await Nf.start(e||"immersive-vr",i||Vt.getDefaultSessionInit("immersive-vr")),await ABe(),n=await Nf.handoff()),n)Vt.setSession(n.mode,n.session,n.init,Wt.Current);else if(e&&t){console.log("Session Granted: Restore last session");const r=JSON.parse(t);Vt.start(e,r).catch(o=>console.warn(o))}else Vt.start("immersive-vr").catch(r=>console.warn("Session Granted failed:",r))},{once:!0})}}function mBe(s,e){sessionStorage.setItem("needle_xr_session_mode",s),sessionStorage.setItem("needle_xr_session_init",JSON.stringify(e))}function gBe(){sessionStorage.removeItem("needle_xr_session_mode"),sessionStorage.removeItem("needle_xr_session_init")}const e5=new Set;Oi.registerCallback(ji.ContextCreationStart,async s=>{e5.add(s.context)});Oi.registerCallback(ji.ContextCreated,async s=>{e5.delete(s.context)});function Yse(){return e5.size>0}function ABe(){return new Promise(s=>{const e=Date.now(),t=setInterval(()=>{(!Yse()||Date.now()-e>6e4)&&(clearInterval(t),s())},100)})}exports.DeviceUtilities.isDesktop()&&Qe()&&window.addEventListener("keydown",s=>{(s.key==="x"||s.key==="Escape")&&Vt.active&&Vt.stop()});const Yu=class{constructor(e,t,i,n){p(this,"context");p(this,"session");p(this,"mode");p(this,"controllers",[]);p(this,"_rigScale",1);p(this,"_lastRigScaleUpdate",-1);p(this,"_rigs",[]);p(this,"_viewerHitTestSource",null);p(this,"_defaultRig");p(this,"_xr_scripts");p(this,"_xr_update_scripts",[]);p(this,"_inactive_scripts",[]);p(this,"_controllerAdded");p(this,"_controllerRemoved");p(this,"_originalCameraWorldPosition");p(this,"_originalCameraWorldRotation");p(this,"_originalCameraWorldScale");p(this,"_originalCameraParent");p(this,"_mainCamera",null);p(this,"onRendererSessionSet",()=>{var e;this.running&&(this.context.renderer.xr.enabled=!0,this.context.renderer.xr.updateCamera(this.context.mainCamera),(e=this.context.mainCameraComponent)==null||e.applyClearFlags())});p(this,"onInputSourceAdded",e=>{if(e.targetRayMode==="screen")return;let t=0;for(let n=0;n<this.session.inputSources.length;n++)if(this.session.inputSources[n]===e){t=n;break}if(this.controllers.find(n=>n.inputSource===e)){console.debug("Controller already exists for input source",t);return}else if(this._newControllers.find(n=>n.inputSource===e)){console.debug("Controller already registered for input source",t);return}const i=new ZO(this,e,t);this._newControllers.push(i)});p(this,"_ended",!1);p(this,"_newControllers",[]);p(this,"onEnd",e=>{var r,o,a;if(this._ended)return;this._ended=!0,console.debug("XR Session ended"),gBe(),this.onAfterRender(),this.revertCustomForward(),this._didStart=!1,this._previousCameraParent=null,Vm(this.onBefore,wn.LateUpdate);const t=this.context.pre_render_callbacks.indexOf(this.onBeforeRender);t>=0&&this.context.pre_render_callbacks.splice(t,1);const i=this.context.post_render_callbacks.indexOf(this.onAfterRender);i>=0&&this.context.post_render_callbacks.splice(i,1),this.context.xr=null,this.context.renderer.xr.enabled=!1,this.context.pre_update_oneshot_callbacks.push(()=>{var l,c;(l=this.context.mainCameraComponent)==null||l.applyClearFlags(),(c=this.context.mainCameraComponent)==null||c.applyClippingPlane()}),Wne({session:this});for(const l of Yu._xrEndListeners)l({xr:this});const n=[...this.controllers];for(let l=0;l<n.length;l++)this.disconnectInputSource(n[l].inputSource);this._newControllers.length=0,this.controllers.length=0;for(const l of this._xr_scripts)(r=l==null?void 0:l.onLeaveXR)==null||r.call(l,{xr:this});(o=this.sync)==null||o.onExitXR(this),this.context.mainCamera&&((a=this._originalCameraParent)==null||a.add(this.context.mainCamera),this._originalCameraWorldPosition&&_r(this.context.mainCamera,this._originalCameraWorldPosition),this._originalCameraWorldRotation&&Uc(this.context.mainCamera,this._originalCameraWorldRotation),this._originalCameraWorldScale&&wx(this.context.mainCamera,this._originalCameraWorldScale)),this.context.requestSizeUpdate(),this._defaultRig.gameObject.removeFromParent(),I0(!1),performance.mark(q4),performance.measure("NeedleXRSession",j4,q4)});p(this,"_didStart",!1);p(this,"onBefore",e=>{var n,r,o,a,l,c,h,d;const t=e.xrFrame;if(!t)return;performance.mark("NeedleXRSession onBefore start"),this.context.xr=this,this.context.mainCameraComponent&&this.context.mainCameraComponent!==this._mainCamera&&(this._mainCamera=this.context.mainCameraComponent),((n=this.rig)==null?void 0:n.isActive)==!1&&(Rr&&console.warn("Latest rig is not active - trying to activate a different rig",this.rig),this.updateActiveXRRig()),this.rig&&((r=this._mainCamera)!=null&&r.gameObject)&&((a=(o=this._mainCamera)==null?void 0:o.gameObject)==null?void 0:a.parent)!==this.rig.gameObject&&this.rig.gameObject.add((l=this._mainCamera)==null?void 0:l.gameObject),this.internalUpdateState(),this.applyCustomForward();const i={xr:this};if(this._didStart){if(this.context.new_scripts_xr.length>0){const u=[...this.context.new_scripts_xr];for(let f=0;f<u.length;f++){const m=this.context.new_scripts_xr[f];if(!m||m.destroyed||((c=m.supportsXR)==null?void 0:c.call(m,this.mode))==!1){this.context.new_scripts_xr.splice(f,1);continue}if(!m.activeAndEnabled){this.context.new_scripts_xr.splice(f,1),this.markInactive(m);continue}if(this.addScript(m)){this.invokeCallback_EnterXR(m);for(const g of this.controllers)this.invokeCallback_ControllerAdded(m,g)}}}}else{if(this._didStart=!0,this.mode==="immersive-vr"){const f=ec(this.context.scene.children);if(f){const m=f.getSize(St());if(m.length()>0){const g=this._defaultRig.gameObject;g.position.set(f.min.x+m.x*.5,f.min.y,f.max.z+m.z*.5+1.5);const A=f.getCenter(St());A.y=g.position.y,g.lookAt(A)}}}Zne({session:this});for(const f of Yu._xrStartListeners)f(i);const u=[...this._xr_scripts];Rr&&console.log("NeedleXRSession start, handle scripts:",u);for(const f of u){if(f.destroyed){this._script_to_remove.push(f);continue}if(!f.activeAndEnabled){this.markInactive(f);continue}this.invokeCallback_EnterXR(f);for(const m of this.controllers)this.invokeCallback_ControllerAdded(f,m)}}this.syncCameraCullingMask();for(const u of this.controllers)u.onUpdate(t);if(this._newControllers.length>0){const u=[...this._newControllers];this._newControllers.length=0;for(const f of u){if(!f.connected){console.warn("New controller is not connected",f);continue}this.controllers.push(f);for(const m of this._xr_scripts){if(m.destroyed){this._script_to_remove.push(m);continue}m.activeAndEnabled!==!1&&this.invokeCallback_ControllerAdded(m,f)}}this.controllers.sort((f,m)=>f.index-m.index)}Rr&&this.context.time.frame%30===0&&this.controllers.length<=0&&this.session.inputSources.length>0&&(I0(!0),console.error("XRControllers are not added but inputSources are present")),performance.mark("NeedleXRSession update scripts start");for(const u of this._xr_update_scripts){if(u.destroyed===!0){this._script_to_remove.push(u);continue}if(u.activeAndEnabled===!1){this.markInactive(u);continue}u.onUpdateXR&&u.onUpdateXR(i)}if(performance.mark("NeedleXRSession update scripts end"),performance.measure("NeedleXRSession update scripts","NeedleXRSession update scripts start","NeedleXRSession update scripts end"),this.handleInactiveScripts(),this._script_to_remove.length>0){const u=[...new Set(this._script_to_remove)];this._script_to_remove.length=0;for(const f of u)!f.destroyed&&this.running&&((h=f.onLeaveXR)==null||h.call(f,i)),this.removeScript(f)}(d=this.sync)==null||d.onUpdate(this),this.onRenderDebug(),performance.mark("NeedleXRSession onBefore end"),performance.measure("NE XR frame","NeedleXRSession onBefore start","NeedleXRSession onBefore end")});p(this,"onBeforeRender",()=>{this.context.mainCamera&&this.updateFade(this.context.mainCamera)});p(this,"onAfterRender",()=>{if(this.onUpdateFade_PostRender(),exports.DeviceUtilities.isDesktop()||!this._renderOnceOnDevice){const e=this.context.renderer;if(e.xr.isPresenting&&this.context.mainCamera){this._renderOnceOnDevice=!0;const t=e.xr.enabled,i=e.getRenderTarget(),n=this.context.scene.background;e.xr.enabled=!1,e.setRenderTarget(null),this.isPassThrough&&(this.context.scene.background=null),this.context.composer?this.context.composer.render(this.context.time.deltaTime):e.render(this.context.scene,this.context.mainCamera),e.xr.enabled=t,e.setRenderTarget(i),this.context.scene.background=n}}});p(this,"_script_to_remove",[]);p(this,"_camera");p(this,"_cameraRenderParent",new ye().rotateY(Math.PI));p(this,"_previousCameraParent");p(this,"_customforward",!0);p(this,"originalCameraNearPlane");p(this,"_viewerPose");p(this,"_transformOrientation",new Ve);p(this,"_transformPosition",new T);p(this,"_transition");var r,o;performance.mark(j4),mBe(e,n.init),this.session=t,this.mode=e,this.context=i,(Rr||ee("console"))&&I0(!0),this._xr_scripts=[...n.scripts],this._xr_update_scripts=this._xr_scripts.filter(a=>typeof a.onUpdateXR=="function"),this._controllerAdded=n.controller_added,this._controllerRemoved=n.controller_removed,Gp(this.onBefore,wn.LateUpdate),this.context.pre_render_callbacks.push(this.onBeforeRender),this.context.post_render_callbacks.push(this.onAfterRender),((r=n.init.optionalFeatures)!=null&&r.includes("hit-test")||(o=n.init.requiredFeatures)!=null&&o.includes("hit-test"))&&t.requestReferenceSpace("viewer").then(a=>{var l,c;return(c=(l=t.requestHitTestSource)==null?void 0:l.call(t,{space:a}))==null?void 0:c.then(h=>this._viewerHitTestSource=h).catch(h=>console.error(h))}).catch(a=>console.error(a)),this.context.mainCamera&&(this._originalCameraWorldPosition=$t(this.context.mainCamera,new T),this._originalCameraWorldRotation=gn(this.context.mainCamera,new Ve),this._originalCameraWorldScale=kn(this.context.mainCamera,new T),this._originalCameraParent=this.context.mainCamera.parent),this._defaultRig=new BLe,this.context.scene.add(this._defaultRig.gameObject),this.addRig(this._defaultRig);for(let a=0;a<t.inputSources.length;a++){const l=t.inputSources[a];if(!l.handedness){console.warn("Input source in xr session has no handedness - ignoring",a);continue}this.onInputSourceAdded(l)}this.session.addEventListener("end",this.onEnd),this.session.addEventListener("inputsourceschange",a=>{for(const l of a.removed)this.disconnectInputSource(l);for(const l of a.added)this.onInputSourceAdded(l)}),this.context.xr=this,this.context.renderer.xr.setSession(this.session).then(this.onRendererSessionSet),"controllerAutoUpdate"in this.context.renderer.xr?(console.debug("Disabling three.js controllerAutoUpdate"),this.context.renderer.xr.controllerAutoUpdate=!1):Rr&&console.warn("controllerAutoUpdate is not available in three.js - cannot disable it")}static getXRSync(e){return this._sync||(this._sync=new Wse(e)),this._sync}static get currentSessionRequest(){return this._currentSessionRequestMode}static get active(){return this._activeSession}static get activeMode(){var e;return((e=this._activeSession)==null?void 0:e.mode)??null}static get xrSystem(){return"xr"in navigator?navigator.xr:void 0}static isXRSupported(){return Promise.all([this.isVRSupported(),this.isARSupported()]).then(e=>e.some(t=>t)).catch(()=>!1)}static isVRSupported(){return this.isSessionSupported("immersive-vr")}static isARSupported(){return this.isSessionSupported("immersive-ar")}static isSessionSupported(e){var t;return((t=this.xrSystem)==null?void 0:t.isSessionSupported(e).catch(i=>(Rr&&console.error(i),!1)))??Promise.resolve(!1)}static onSessionRequestStart(e){this._sessionRequestStartListeners.push(e)}static offSessionRequestStart(e){const t=this._sessionRequestStartListeners.indexOf(e);t>=0&&this._sessionRequestStartListeners.splice(t,1)}static onSessionRequestEnd(e){this._sessionRequestEndListeners.push(e)}static offSessionRequestEnd(e){const t=this._sessionRequestEndListeners.indexOf(e);t>=0&&this._sessionRequestEndListeners.splice(t,1)}static onXRSessionStart(e){this._xrStartListeners.push(e)}static offXRSessionStart(e){const t=this._xrStartListeners.indexOf(e);t>=0&&this._xrStartListeners.splice(t,1)}static onXRSessionEnd(e){this._xrEndListeners.push(e)}static offXRSessionEnd(e){const t=this._xrEndListeners.indexOf(e);t>=0&&this._xrEndListeners.splice(t,1)}static onControllerAdded(e){this._controllerAddedListeners.push(e)}static offControllerAdded(e){const t=this._controllerAddedListeners.indexOf(e);t>=0&&this._controllerAddedListeners.splice(t,1)}static onControllerRemoved(e){this._controllerRemovedListeners.push(e)}static offControllerRemoved(e){const t=this._controllerRemovedListeners.indexOf(e);t>=0&&this._controllerRemovedListeners.splice(t,1)}static offerSession(e,t,i){return"xr"in navigator&&navigator.xr&&"offerSession"in navigator.xr?(typeof navigator.xr.offerSession=="function"&&(console.log("WebXR offerSession is available - requesting mode: "+e),t=="default"&&(t=this.getDefaultSessionInit(e)),navigator.xr.offerSession(e,{...t}).then(n=>Yu.setSession(e,n,t,i)).catch(n=>{console.log("XRSession offer rejected (perhaps because another call to offerSession was made or a call to requestSession was made)")})),!0):!1}static getDefaultSessionInit(e){switch(e){case"immersive-ar":return{optionalFeatures:["anchors","local-floor","hand-tracking","layers","dom-overlay","hit-test","unbounded"]};case"immersive-vr":return{optionalFeatures:["local-floor","bounded-floor","hand-tracking","high-fixed-foveation-level","layers"]};default:return console.warn("No default session init for mode",e),{}}}static async start(e,t,i){var a,l,c,h;if(exports.DeviceUtilities.isiOS()){if(e==="ar")if(await this.isARSupported())e="immersive-ar";else return fS.exportAndOpen(),null}else e=="ar"&&(e="immersive-ar");if(Qe()&&ee("debugxrpreroom"))return console.warn("Debug: Starting temporary XR session"),await Nf.start(e,t||Yu.getDefaultSessionInit(e)),null;if(this._currentSessionRequest)return console.warn("A XRSession is already being requested"),(Rr||Qe())&&An("A XRSession is already being requested"),this._currentSessionRequest.then(()=>this._activeSession);if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;if(i||(i=Wt.Current),i||(i=Oi.All[0]),!i)throw new Error("No Needle Engine Context found");switch(performance.mark("NeedleXRSession start"),t||(t={}),e){case"immersive-ar":{if(await((a=this.xrSystem)==null?void 0:a.isSessionSupported("immersive-ar"))!==!0)return console.error(e+" is not supported by this browser."),null;const u=this.getDefaultSessionInit(e),f=pBe(i.domElement);f&&!exports.DeviceUtilities.isQuest()&&(u.domOverlay={root:f},u.optionalFeatures.push("dom-overlay")),t={...u,...t}}break;case"immersive-vr":{if(await((l=this.xrSystem)==null?void 0:l.isSessionSupported("immersive-vr"))!==!0)return console.error(e+" is not supported by this browser."),null;t={...this.getDefaultSessionInit(e),...t}}break;default:console.warn("No default session init for mode",e);break}t.optionalFeatures??(t.optionalFeatures=[]),t.requiredFeatures??(t.requiredFeatures=[]),await Nf.stop();const n=e=="immersive-ar"?i.scripts_immersive_ar:i.scripts_immersive_vr;Rr?console.log(`%cRequesting ${e} session`,"font-weight:bold;",t,n):console.log(`%cRequesting ${e} session`,"font-weight:bold;");for(const d of n)d.onBeforeXR&&d.onBeforeXR(e,t);for(const d of this._sessionRequestStartListeners)d({mode:e,init:t});Rr&&is("Requesting "+e+" session ("+Date.now()+")"),this._currentSessionRequest=(c=navigator.xr)==null?void 0:c.requestSession(e,t),this._currentSessionRequestMode=e;const r=await((h=this._currentSessionRequest)==null?void 0:h.catch(d=>{console.error(d,"Code: "+d.code),d.code===9&&An("Make sure your device has the required permissions (e.g. camera access)"),console.log("If the specified XR configuration is not supported (e.g. entering AR doesnt work) - make sure you access the website on a secure connection (HTTPS) and your device has the required permissions (e.g. camera access)"),location.protocol==="http:"&&An("XR requires a secure connection (HTTPS)")}));this._currentSessionRequest=void 0,this._currentSessionRequestMode=null;for(const d of this._sessionRequestEndListeners)d({mode:e,init:t,newSession:r||null});if(!r)return console.warn("XR Session request was rejected"),null;const o=this.setSession(e,r,t,i);return performance.mark("NeedleXRSession end"),performance.measure("NeedleXRSession Startup","NeedleXRSession start","NeedleXRSession end"),o}static setSession(e,t,i,n){if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;const r=e=="immersive-ar"?n.scripts_immersive_ar:n.scripts_immersive_vr;return this._activeSession=new Yu(e,t,n,{scripts:r,controller_added:this._controllerAddedListeners,controller_removed:this._controllerRemovedListeners,init:i}),t.addEventListener("end",this.onEnd),Rr?console.log(`%cStarted ${e} session`,"font-weight:bold;",r):console.log(`%cStarted ${e} session`,"font-weight:bold;"),this._activeSession}static stop(){var e;(e=this._activeSession)==null||e.end()}get sync(){return Yu._sync}get running(){return!this._ended&&this.session!=null}get interactionMode(){return this.session.interactionMode}get visibilityState(){return this.session.visibilityState}get isVisibleBlurred(){return this.session.visibilityState==="visible-blurred"}get isSystemKeyboardSupported(){return this.session.isSystemKeyboardSupported}get environmentBlendMode(){return this.session.environmentBlendMode}get frame(){return this.context.xrFrame}get leftController(){return this.controllers.find(e=>e.side==="left")}get rightController(){return this.controllers.find(e=>e.side==="right")}getController(e){return typeof e=="number"?this.controllers[e]||null:this.controllers.find(t=>t.side===e)||null}get isPassThrough(){return!!(this.environmentBlendMode!=="opaque"&&this.interactionMode==="world-space"||this.mode==="immersive-ar"&&this.environmentBlendMode!=="opaque"&&this.controllers.some(e=>e.inputSource.targetRayMode==="tracked-pointer")||Qe()&&exports.DeviceUtilities.isDesktop()&&this.mode==="immersive-ar")}get isAR(){return this.mode==="immersive-ar"}get isVR(){return this.mode==="immersive-vr"}get isScreenBasedAR(){return this.isAR&&!this.isPassThrough}get posePosition(){return this._transformPosition}get poseOrientation(){return this._transformOrientation}get referenceSpace(){return this.context.renderer.xr.getReferenceSpace()}get viewerPose(){return this._viewerPose}get isTrackingImages(){if(this.frame&&"getImageTrackingResults"in this.frame&&typeof this.frame.getImageTrackingResults=="function")try{const e=this.frame.getImageTrackingResults();for(const t of e)if(t.trackingState==="tracked")return!0}catch{return!1}return!1}get rig(){const e=this._rigs[0]??null;return e!=null&&e.gameObject&&eA(e.gameObject)||(e==null?void 0:e.isActive)===!1?(this.updateActiveXRRig(),this._rigs[0]??null):e}get rigScale(){return this._rigs[0]?(this._lastRigScaleUpdate!==this.context.time.frame&&(this._lastRigScaleUpdate=this.context.time.frame,this._rigScale=this._rigs[0].gameObject.worldScale.x),this._rigScale):1}addRig(e){this._rigs.indexOf(e)>=0||(e.priority===void 0&&(e.priority=0),this._rigs.push(e),this.updateActiveXRRig())}removeRig(e){const t=this._rigs.indexOf(e);t!==-1&&(this._rigs.splice(t,1),this.updateActiveXRRig())}setRigActive(e){const t=this._rigs.indexOf(e);this._rigs.splice(t,1),this._rigs.unshift(e),this.updateActiveXRRig()}getUserOffsetInRig(){var i;const e=(i=this.context.mainCamera)==null?void 0:i.position;if(!e||!this.rig)return St(0,0,0);const t=St(e);return t.x*=-1,t.z*=-1,t.applyQuaternion(Ah(this.rig.gameObject.quaternion)),t}updateActiveXRRig(){const e=this._rigs[0]??null;this._defaultRig.gameObject.parent!==this.context.scene&&this.context.scene.add(this._defaultRig.gameObject),this._defaultRig.gameObject.visible=!0,this._rigs.includes(this._defaultRig)||this._rigs.push(this._defaultRig);let t=this._rigs[0];t&&t.priority===void 0&&(t.priority=0);for(let i=1;i<this._rigs.length;i++){const n=this._rigs[i];if(n.isActive){if(eA(n.gameObject)){this._rigs.splice(i,1),i--;continue}(!t||t.isActive===!1||n.priority!==void 0&&n.priority>t.priority)&&(t=n)}}if(e!==t){const i=this._rigs.indexOf(t);i>=0&&this._rigs.splice(i,1),this._rigs.unshift(t)}Rr&&(e===t?console.log("Updated Active XR Rig:",t,"prev:",e):console.log("Updated Active XRRig:",t," (the same as before)"))}getHitTest(e){if(e)return this.getControllerHitTest(e);if(!this._viewerHitTestSource)return null;const t=this._viewerHitTestSource,i=this.frame.getHitTestResults(t);if(i.length>0){const n=i[0];return this.convertHitTestResult(n)}return null}getControllerHitTest(e){const t=e.getHitTestSource();if(!t)return null;const i=this.frame.getHitTestResultsForTransientInput(t);for(const n of i)if(n.inputSource===e.inputSource)for(const r of n.results)return this.convertHitTestResult(r);return null}convertHitTestResult(e){const t=this.context.renderer.xr.getReferenceSpace(),i=t&&e.getPose(t);if(i){const n=St(i.transform.position),r=Ah(i.transform.orientation),o=this.context.mainCamera;if((o==null?void 0:o.parent)!==this._cameraRenderParent&&n.applyMatrix4(jb),o!=null&&o.parent){n.applyMatrix4(o.parent.matrixWorld),r.multiply(wc);const a=gn(o.parent);a.premultiply(wc),r.premultiply(a)}return{hit:e,position:n,quaternion:r}}return null}convertSpace(e){const t=St(e.position);t.applyMatrix4(jb);const i=Ah(e.orientation);return i.premultiply(wc),{position:t,quaternion:i}}disconnectInputSource(e){const t=(i,n,r)=>{if(i.inputSource===e){Rr&&console.log("Disconnecting controller",i.index),this.controllers.splice(r,1),this.invokeControllerEvent(i,this._controllerRemoved,"removed");const o={xr:this,controller:i,change:"removed"};for(const a of this._xr_scripts)a.onXRControllerRemoved&&a.onXRControllerRemoved(o);i.onDisconnected()}};for(let i=this.controllers.length-1;i>=0;i--){const n=this.controllers[i];t(n,this.controllers,i)}for(let i=this._newControllers.length-1;i>=0;i--){const n=this._newControllers[i];t(n,this._newControllers,i)}}end(){this._ended||this.session.end().catch(e=>console.warn(e))}onRenderDebug(){if(Rr)for(const e of this.controllers)e.onRenderDebug();if((Rr||$4)&&this.rig&&(FN++,FN>=20)){const e=this.rig.gameObject.worldPosition,t=this.rig.gameObject.worldForward;e.add(t.multiplyScalar(1.5));const i=this.rig.gameObject.worldUp;e.add(i.multiplyScalar(2.5));let n="";if(n+=`${this.context.time.smoothedFps.toFixed(0)} FPS`,n+=`, calls: ${this.context.renderer.info.render.calls}, tris: ${this.context.renderer.info.render.triangles.toLocaleString()}`,Rr||$4)for(const r of this.controllers)n+=`
${r.hand?"hand":"ctrl"} ${r.inputSource.handedness}[${r.index}] con:${r.connected} tr:${r.isTracking} hts:${r.hasHitTestSource?"yes":"no"}`;FN=0,Mt.DrawLabel(e,n,void 0,1/60*20)}}addScript(e){return this._xr_scripts.includes(e)?!1:(Rr&&console.log("Register new XRScript",e),this._xr_scripts.push(e),typeof e.onUpdateXR=="function"&&this._xr_update_scripts.push(e),!0)}markInactive(e){if(!(this._inactive_scripts.indexOf(e)>=0)){this.removeScript(e,!1),this._inactive_scripts.push(e);for(const t of this.controllers)this.invokeCallback_ControllerRemoved(e,t);this.invokeCallback_LeaveXR(e)}}handleInactiveScripts(){if(this._inactive_scripts.length>0)for(let e=this._inactive_scripts.length-1;e>=0;e--){const t=this._inactive_scripts[e];if(t.activeAndEnabled){this._inactive_scripts.splice(e,1),this.addScript(t),this.invokeCallback_EnterXR(t);for(const i of this.controllers)this.invokeCallback_ControllerAdded(t,i)}}}removeScript(e,t=!0){Rr&&console.log("Remove XRScript",e);const i=this._xr_scripts.indexOf(e);i>=0&&this._xr_scripts.splice(i,1);const n=this._xr_update_scripts.indexOf(e);if(n>=0&&this._xr_update_scripts.splice(n,1),t){const r=this._inactive_scripts.indexOf(e);r>=0&&this._inactive_scripts.splice(r,1)}}invokeCallback_EnterXR(e){e.onEnterXR&&e.onEnterXR({xr:this})}invokeCallback_ControllerAdded(e,t){e.onXRControllerAdded&&e.onXRControllerAdded({xr:this,controller:t,change:"added"})}invokeCallback_ControllerRemoved(e,t){e.onXRControllerRemoved&&e.onXRControllerRemoved({xr:this,controller:t,change:"removed"})}invokeCallback_LeaveXR(e){e.onLeaveXR&&!e.destroyed&&e.onLeaveXR({xr:this})}syncCameraCullingMask(){var i;const e=this.context.xrCamera,t=(i=this.context.mainCameraComponent)==null?void 0:i.cullingMask;if(e&&t!==void 0){for(const n of e.cameras)n.layers.mask=t;e.layers.mask=t}else if(e){for(const n of e.cameras)n.layers.enableAll();e.layers.enableAll()}}invokeControllerEvent(e,t,i){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r)try{r({xr:this,controller:e,change:i})}catch(o){console.error(o)}}}applyCustomForward(){var e;if(this.context.mainCamera&&this._customforward){this._camera=this.context.mainCamera,this._camera.parent!==this._cameraRenderParent&&(this._previousCameraParent=this._camera.parent,(e=this._previousCameraParent)==null||e.add(this._cameraRenderParent)),this._cameraRenderParent.name="XR Camera Render Parent",this._cameraRenderParent.add(this._camera);let t=.02;if(this.rig){const i=kn(this.rig.gameObject);t*=i.x}this._camera instanceof Xt&&this._camera.near>t&&(this.originalCameraNearPlane=this._camera.near,this._camera.near=t)}}revertCustomForward(){this._camera&&this._previousCameraParent&&this._previousCameraParent.add(this._camera),this._previousCameraParent=null,this._camera instanceof Xt&&this.originalCameraNearPlane!=null&&(this._camera.near=this.originalCameraNearPlane)}internalUpdateState(){const e=this.context.renderer.xr.getReferenceSpace();if(!e){this._viewerPose=void 0;return}if(this._viewerPose=this.frame.getViewerPose(e),this._viewerPose){const t=this._viewerPose.transform;this._transformPosition.set(t.position.x,t.position.y,t.position.z),this._transformOrientation.set(t.orientation.x,t.orientation.y,t.orientation.z,t.orientation.w)}}get transition(){return this._transition||(this._transition=new O4),this._transition}fadeTransition(){return this._transition||(this._transition=new O4),this._transition.fadeTransition()}updateFade(e){this._transition&&e instanceof Xt&&this._transition.update(e,this.context.time.deltaTime)}onUpdateFade_PostRender(){var e;(e=this._transition)==null||e.remove()}};let Vt=Yu;p(Vt,"_sync",null),p(Vt,"_currentSessionRequestMode",null),p(Vt,"_currentSessionRequest"),p(Vt,"_activeSession"),p(Vt,"_sessionRequestStartListeners",[]),p(Vt,"_sessionRequestEndListeners",[]),p(Vt,"_xrStartListeners",[]),p(Vt,"_xrEndListeners",[]),p(Vt,"_controllerAddedListeners",[]),p(Vt,"_controllerRemovedListeners",[]),p(Vt,"onEnd",()=>{Rr&&console.log("XR Session ended"),Yu._activeSession=null});const VN=ee("debugwebxr");class Jse{static tryFindAvatarObjects(e,t,i){if(i.head&&i.leftHand&&i.rightHand)return;const n=e.name.toLocaleLowerCase();!i.head&&n.includes("head")&&(VN&&console.log("FOUND AVATAR HEAD",e.name),i.head=new gi("",t,e)),n.includes("hand")&&(!i.leftHand&&n.includes("left")&&(VN&&console.log("FOUND AVATAR LEFT HAND",e.name),i.leftHand=new gi("",t,e)),!i.rightHand&&n.includes("right")&&(VN&&console.log("FOUND AVATAR RIGHT HAND",e.name),i.rightHand=new gi("",t,e)));for(let r=0;r<e.children.length;r++){if(i.head&&i.leftHand&&i.rightHand)return;const o=e.children[r];this.tryFindAvatarObjects(o,t,i)}}}const Qo=new T,eK=new T,tK=new Ve,yBe=ee("debuggizmos"),lh=8947848,zN=32,xc=class{constructor(){}static isGizmo(e){return e[lz]!==void 0}static DrawLabel(e,t,i=.05,n=0,r,o,a){var h;if(!xc.enabled)return null;r||(r=lh);const l=((h=Vt.active)==null?void 0:h.rigScale)??1,c=Xn.getTextLabel(n,t,i*l,r,o);return a instanceof ye&&a.add(c),c.position.x=e.x,c.position.y=e.y,c.position.z=e.z,c}static DrawRay(e,t,i=lh,n=0,r=!0){if(!xc.enabled)return;const o=Xn.getLine(n),a=o.geometry.getAttribute("position");a.setXYZ(0,e.x,e.y,e.z),Qo.set(t.x,t.y,t.z).multiplyScalar(999999999),a.setXYZ(1,e.x+Qo.x,e.y+Qo.y,e.z+Qo.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawDirection(e,t,i=lh,n=0,r=!0,o=1){if(!xc.enabled)return;const a=Xn.getLine(n),l=a.geometry.getAttribute("position");l.setXYZ(0,e.x,e.y,e.z),t.w!==void 0?(Qo.set(0,0,-o),tK.set(t.x,t.y,t.z,t.w),Qo.applyQuaternion(tK)):(Qo.set(t.x,t.y,t.z),Qo.multiplyScalar(o)),l.setXYZ(1,e.x+Qo.x,e.y+Qo.y,e.z+Qo.z),l.needsUpdate=!0,a.material.color.set(i),a.material.depthTest=r,a.material.depthWrite=!1}static DrawLine(e,t,i=lh,n=0,r=!0){if(!xc.enabled)return;const o=Xn.getLine(n),a=o.geometry.getAttribute("position");a.setXYZ(0,e.x,e.y,e.z),a.setXYZ(1,t.x,t.y,t.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1,o.material.fog=!1}static DrawCircle(e,t,i,n=lh,r=0,o=!0){if(!xc.enabled)return;const a=Xn.getCircle(r);a.position.set(e.x,e.y,e.z),a.scale.set(i,i,i),a.quaternion.setFromUnitVectors(this._up,Qo.set(t.x,t.y,t.z).normalize()),a.material.color.set(n),a.material.depthTest=o,a.material.depthWrite=!1,a.material.fog=!1}static DrawWireSphere(e,t,i=lh,n=0,r=!0){if(!xc.enabled)return;const o=Xn.getSphere(t,n,!0);q0(o,e.x,e.y,e.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1,o.material.fog=!1}static DrawSphere(e,t,i=lh,n=0,r=!0){if(!xc.enabled)return;const o=Xn.getSphere(t,n,!1);q0(o,e.x,e.y,e.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawWireBox(e,t,i=lh,n=0,r=!0){if(!xc.enabled)return;const o=Xn.getBox(n);o.position.set(e.x,e.y,e.z),o.scale.set(t.x,t.y,t.z),o.material.color.set(i),o.material.depthTest=r,o.material.wireframe=!0,o.material.depthWrite=!1,o.material.fog=!1}static DrawWireBox3(e,t=lh,i=0,n=!0){if(!xc.enabled)return;const r=Xn.getBox(i);r.position.copy(e.getCenter(Qo)),r.scale.copy(e.getSize(Qo)),r.material.color.set(t),r.material.depthTest=n,r.material.wireframe=!0,r.material.depthWrite=!1,r.material.fog=!1}static DrawArrow(e,t,i=lh,n=0,r=!0,o=!1){if(!xc.enabled)return;const a=Xn.getArrowHead(n);a.position.set(t.x,t.y,t.z),a.quaternion.setFromUnitVectors(this._up.set(0,1,0),Qo.set(t.x,t.y,t.z).sub(eK.set(e.x,e.y,e.z)).normalize());const c=Qo.set(t.x,t.y,t.z).sub(eK.set(e.x,e.y,e.z)).length()*.1;a.scale.set(c,c,c),a.material.color.set(i),a.material.depthTest=r,a.material.wireframe=o,this.DrawLine(e,t,i,n,r)}static DrawWireMesh(e){const t=Xn.getMesh(e.duration??0);"mesh"in e?(t.geometry=e.mesh.geometry,t.matrix.copy(e.mesh.matrixWorld)):(t.geometry=e.geometry,t.matrix.copy(e.matrix)),t.matrixAutoUpdate=!1,t.matrixWorldAutoUpdate=!1,t.material.color.set(e.color??lh),t.material.depthTest=e.depthTest??!0,t.material.wireframe=!0}static setVisible(e){for(const t of Xn.timedObjectsBuffer)t.visible=e}};let Mt=xc;p(Mt,"enabled",!0),p(Mt,"_up",new T(0,1,0));const bBe=new pn(1,1,1);function t5(s=null){const e=new ge(s??14540253),t=new $U(bBe);return new sa(t,new _n({color:e}))}const lz=Symbol("GizmoCache");class Xn{static ensureFont(){let e=Mn.FontLibrary.getFontFamily(this.familyName);if(!e){e=Mn.FontLibrary.addFontFamily(this.familyName);const t=e.addVariant("normal","normal","https://uploads.needle.tools/include/font-msdf.json","https://uploads.needle.tools/include/font.png");t==null||t.addEventListener("ready",()=>{Mn.update()})}}static getTextLabel(e,t,i,n,r){this.ensureFont();let o=this.textLabelCache.pop(),a=1;r&&typeof r=="string"&&(r==null?void 0:r.length)>=8&&r.startsWith("#")?(a=parseInt(r.substring(7),16)/255,r=r.substring(0,7),yBe&&console.log(r,a)):typeof r=="object"&&r.a!==void 0&&(a=r.a);const l={boxSizing:"border-box",fontFamily:this.familyName,width:"auto",fontSize:i,color:n,lineHeight:1,backgroundColor:r??void 0,backgroundOpacity:a,textContent:t,borderRadius:.5*i,padding:.8*i,whiteSpace:"pre",offset:.05*i};if(o)o.set(l);else{o=new uO(l);const c=this,h=o;h.setText=function(d){this.set({textContent:d}),c.tmuiNeedsUpdate=!0}}return this.tmuiNeedsUpdate=!0,this.registerTimedObject(Wt.Current,o,e,this.textLabelCache),o}static getBox(e){let t=this.boxesCache.pop();if(!t){const i=new pn(1,1,1);t=new fe(i)}return this.registerTimedObject(Wt.Current,t,e,this.boxesCache),t}static getLine(e){let t=this.linesCache.pop();if(!t){t=new ts;let i=t.geometry.getAttribute("position");i||(i=new dt(new Float32Array(2*3),3),t.geometry.setAttribute("position",i))}return t.frustumCulled=!1,this.registerTimedObject(Wt.Current,t,e,this.linesCache),t}static getCircle(e){let t=this.circlesCache.pop();if(!t){t=new ts;let i=t.geometry.getAttribute("position");if(!i){i=new dt(new Float32Array(zN*3),3),t.geometry.setAttribute("position",i);const n=St(0,1,0),r=St(0,0,1),o=St(r);o.cross(n).normalize();const a=St(o),l=Math.PI*2/(zN-1);for(let c=0;c<zN+1;c++){const h=l*c;n.copy(a).multiplyScalar(Math.cos(h)*1),o.copy(r).multiplyScalar(Math.sin(h)*1);const d=n.add(o);i.setXYZ(c,d.x,d.y,d.z)}}}return t.frustumCulled=!1,this.registerTimedObject(Wt.Current,t,e,this.circlesCache),t}static getSphere(e,t,i){let n=this.spheresCache.pop();return n||(n=new fe(new Wc(1,8,8))),n.scale.set(e,e,e),n.material.wireframe=i,this.registerTimedObject(Wt.Current,n,t,this.spheresCache),n}static getArrowHead(e){let t=this.arrowHeadsCache.pop();return t||(t=new fe(new Ns(0,.5,1,8))),this.registerTimedObject(Wt.Current,t,e,this.arrowHeadsCache),t}static getMesh(e){let t=this.mesh.pop();return t||(t=new fe,t.material=new ii),this.registerTimedObject(Wt.Current,t,e,this.mesh),t}static registerTimedObject(e,t,i,n){if(!e){console.error("No Needle Engine context available. Did you call a Gizmos function in global scope?");return}const r=this.contextBeforeRenderCallbacks.get(e),o=this.contextPostRenderCallbacks.get(e);if(r){if(e.pre_render_callbacks[e.pre_render_callbacks.length-1]!==r){const a=e.pre_render_callbacks.indexOf(r);a>=0&&e.pre_render_callbacks.splice(a,1),e.pre_render_callbacks.push(r)}}else{const a=()=>{this.onBeforeRender(e,this.timedObjectsBuffer)};this.contextBeforeRenderCallbacks.set(e,a),e.pre_render_callbacks.push(a)}if(o){if(e.post_render_callbacks[e.post_render_callbacks.length-1]!==o){const a=e.post_render_callbacks.indexOf(o);a>=0&&e.post_render_callbacks.splice(a,1),e.post_render_callbacks.push(o)}}else{const a=()=>{this.onPostRender(e,this.timedObjectsBuffer,this.timesBuffer)};this.contextPostRenderCallbacks.set(e,a),e.post_render_callbacks.push(a)}t.traverse(a=>{a.layers.disableAll(),a.layers.enable(2)}),t.renderOrder=999999,t[lz]=n,t.castShadow=!1,t.receiveShadow=!1,t.isGizmo=!0,this.timedObjectsBuffer.push(t),this.timesBuffer.push(Wt.Current.time.realtimeSinceStartup+i),e.scene.add(t)}static onBeforeRender(e,t){this.tmuiNeedsUpdate&&(this.tmuiNeedsUpdate=!1,Mn.update());for(let i=0;i<t.length;i++){const n=t[i];if(e.mainCamera&&n instanceof Mn.MeshUIBaseElement){if(eA(n))continue;const r=e.isInVR,o=!1,a=!r;q1(n,e.mainCamera,o,a)}}}static onPostRender(e,t,i){const n=e.time.realtimeSinceStartup;for(let r=t.length-1;r>=0;r--){const o=t[r];n>=i[r]-1e-6&&(t.splice(r,1),i.splice(r,1),o.removeFromParent(),eA(o)!=!0&&o[lz].push(o))}}}p(Xn,"familyName","needle-gizmos"),p(Xn,"linesCache",[]),p(Xn,"circlesCache",[]),p(Xn,"spheresCache",[]),p(Xn,"boxesCache",[]),p(Xn,"arrowHeadsCache",[]),p(Xn,"mesh",[]),p(Xn,"textLabelCache",[]),p(Xn,"timedObjectsBuffer",new Array),p(Xn,"timesBuffer",new Array),p(Xn,"contextPostRenderCallbacks",new Map),p(Xn,"contextBeforeRenderCallbacks",new Map),p(Xn,"tmuiNeedsUpdate",!1);const Rl=ee("debugphysics"),iK=new ta;class qd{constructor(){p(this,"ray");p(this,"cam");p(this,"screenPoint");p(this,"raycaster");p(this,"results");p(this,"targets");p(this,"recursive",!0);p(this,"minDistance");p(this,"maxDistance");p(this,"lineThreshold");p(this,"layerMask");p(this,"ignore");p(this,"testObject");p(this,"useAcceleratedRaycast")}screenPointFromOffset(e,t){this.screenPoint===void 0&&(this.screenPoint=new Q),this.screenPoint.x=e/window.innerWidth*2-1,this.screenPoint.y=-(t/window.innerHeight)*2+1}setLayer(e){iK.set(e),this.layerMask=iK}setMask(e){this.layerMask||(this.layerMask=new ta);const t=this.layerMask;t?t.mask=e:this.layerMask=e}}p(qd,"AllLayers",4294967295);class i5{constructor(e,t,i){p(this,"distance");p(this,"point");p(this,"object");this.object=e,this.distance=t,this.point=i}}const D2=class{constructor(e){p(this,"context");p(this,"engine");p(this,"raycaster",new Em);p(this,"defaultRaycastOptions",new qd);p(this,"targetBuffer",new Array(1));p(this,"defaultThresholds",{Mesh:{},Line:{threshold:-1},LOD:{},Points:{threshold:0},Sprite:{}});p(this,"sphereResults",new Array);p(this,"sphereMask",new ta);p(this,"sphere",new Vn);p(this,"tempBoundingBox",new oi);this.context=e}static get raycasting(){return this._raycasting>0}raycastPhysicsFast(e,t=void 0,i=1/0,n=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycast(e,t,{maxDistance:i,solid:n}))??null}raycastPhysicsFastAndGetNormal(e,t=void 0,i=1/0,n=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycastAndGetNormal(e,t,{maxDistance:i,solid:n}))??null}sphereOverlapPhysics(e,t){var i;return((i=this.context.physics.engine)==null?void 0:i.sphereOverlap(e,t))??null}sphereOverlap(e,t,i=!0,n=!1,r=null){if(this.sphereResults.length=0,!this.context.scene)return this.sphereResults;const o=this.sphereMask;o.enableAll(),o.disable(2);for(const a of this.context.scene.children)this.intersectSphere(a,e,t,o,this.sphereResults,i,n,r);return this.sphereResults.sort((a,l)=>a.distance-l.distance)}raycastFromRay(e,t=null){const i=t??this.defaultRaycastOptions;i.ray=e;const n=this.raycast(i);return i===this.defaultRaycastOptions&&(i.ray=void 0),n}raycast(e=null){Rl&&performance.mark("raycast.start"),e||(e=this.defaultRaycastOptions);const t=e.screenPoint??this.context.input.mousePositionRC,i=e.raycaster??this.raycaster;if(i.near=e.minDistance??0,i.far=e.maxDistance??1/0,i.params=this.defaultThresholds,e.lineThreshold===void 0&&(e.lineThreshold=-1),i.params.Line={threshold:e.lineThreshold},e.ray)i.ray.copy(e.ray);else{const a=e.cam??this.context.mainCamera;if(!a)return Rl&&console.error("Can not perform raycast - no main camera found"),this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),this.defaultRaycastOptions.results??[];const l=this.context.xrCamera;this.context.isInXR&&l instanceof VU&&l.cameras.length>0?i.setFromCamera(t,l.cameras[0]):i.setFromCamera(t,a)}let n=e.targets;n||(n=this.targetBuffer,n.length=1,n[0]=this.context.scene);let r=e.results;this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),r||(this.defaultRaycastOptions.results||(this.defaultRaycastOptions.results=new Array),r=this.defaultRaycastOptions.results),e.layerMask!==void 0?e.layerMask instanceof ta?i.layers.mask=e.layerMask.mask:i.layers.mask=e.layerMask:(i.layers.enableAll(),i.layers.disable(2)),Rl&&console.time("raycast"),r.length=0,D2._raycasting++,this.intersect(this.raycaster,n,r,e),r.sort((a,l)=>a.distance-l.distance);const o=e.ignore;return o!==void 0&&o.length>0&&(r=r.filter(a=>!o.includes(a.object))),D2._raycasting--,Rl&&(console.timeEnd("raycast"),console.warn("#"+this.context.time.frame+", hits:",r!=null&&r.length?[...r]:"nothing"),performance.mark("raycast.end"),performance.measure("raycast","raycast.start","raycast.end")),r}intersect(e,t,i,n){var r,o,a;for(const l of t){if(!l||l.visible===!1||Mt.isGizmo(l)||n.lineThreshold!==void 0&&n.lineThreshold<0&&l instanceof ts)continue;let c=!0;const h=l,d=h.geometry;if(n.testObject){const u=(r=n.testObject)==null?void 0:r.call(n,l);if(u===!1)continue;u==="continue in children"&&(c=!1)}if(c&&(d&&nK(d)||(c=!1)),c){const u=rM(l);u&&(h.geometry=u);const f=i.length;let m=!0;if(n.precise===!1&&(m=!1),m||(m=((a=(o=d.getAttribute("position"))==null?void 0:o.array)==null?void 0:a.length)<64),h instanceof Cx&&(m=!1),!m&&vBe(h,e,i)||(n.useAcceleratedRaycast!==!1?n2.runMeshBVHRaycast(e,h,i,this.context):e.intersectObject(h,!1,i)),Rl&&i.length!=f){const g=i[i.length-1],A=u?8969557:7798784;Mt.DrawWireSphere(g.point,.1,A,1,!1),Mt.DrawWireMesh({mesh:l,depthTest:!1,duration:.2,color:A})}h.geometry=d}n.recursive!==!1&&this.intersect(e,l.children,i,n)}return i}intersectSphere(e,t,i,n,r,o,a,l){let c=e&&e.isMesh&&e.layers.test(n)&&!Mt.isGizmo(e);c&&(c=e.visible),c&&(c=!(e instanceof ts)),c&&(c=!(e instanceof Cx));const h=e,d=h.geometry;if(c&&l){const u=l(e);if(u===!1)return;u==="continue in children"&&(c=!1)}if(d&&nK(d)||(c=!1),c){if(a){const u=this.sphere;u.center.copy(t),u.radius=i;const f=r.length;if(n2.runMeshBVHRaycast(this.sphere,h,r,this.context),f!=r.length&&!o)return}else if(d.boundingBox||d.computeBoundingBox(),d.boundingBox){h.matrixWorldNeedsUpdate&&h.updateWorldMatrix(!1,!1);const u=this.tempBoundingBox.copy(d.boundingBox).applyMatrix4(h.matrixWorld),f=this.sphere;if(f.center.copy(t),f.radius=i,f.intersectsBox(u)){const m=$t(e),g=m.distanceTo(f.center),A=new i5(e,g,m);if(r.push(A),!o)return}}}if(e.children)for(const u of e.children){const f=r.length;if(this.intersectSphere(u,t,i,n,r,o,a,l),f!=r.length&&!o)return}}};let ex=D2;p(ex,"_raycasting",0);function nK(s){return!(s.index&&s.index.array.length<3)}const Tg=new Vn,KT=new js,xBe=new ei;function vBe(s,e,t){const i=s._computeIntersections;if(!i)return!1;let n=s["_computeIntersections:Needle"];return n||(n=s["_computeIntersections:Needle"]=function(r,o,a){const l=this,c=l.geometry.boundingSphere;if(c){if(l instanceof Cx){KT.setFromNormalAndCoplanarPoint(St(0,1,0),St(0,-l.position.y,0)),KT.applyMatrix4(l.matrixWorld,xBe);const d=r.ray.intersectPlane(KT,St());if(d){Tg.copy(c),Tg.applyMatrix4(l.matrixWorld);const f=St(d).sub(r.ray.origin).length(),m=Tg.radius*.5;f<m&&o.push({distance:f,point:d,object:l,normal:KT.normal.clone()})}return}Tg.copy(c),Tg.applyMatrix4(l.matrixWorld);const h=r.ray.intersectSphere(Tg,St());if(h){const d=St(h).sub(r.ray.origin),u=d.length();if(u>Tg.radius){const f=d.clone().normalize();o.push({distance:u,point:h,object:l,normal:f})}}}}),s._computeIntersections=n,e.intersectObject(s,!1,t),s._computeIntersections=i,!0}var n2;(s=>{function e(y,b,x,v){var C,S,M;if(!b.geometry||!b.geometry.hasAttribute("position"))return!1;const _=b.geometry;if(b!=null&&b.isSkinnedMesh){const L=b,w=L.bvhNeedsUpdate;if(!L.staticGenerator)a(),r&&(L.staticGenerator=new r(b),L.staticGenerator.applyWorldTransforms=!1,L.staticGeometry=L.staticGenerator.generate(),_.boundsTree=o==null?void 0:o.call(L.staticGeometry),L.staticGeometryLastUpdate=performance.now()+Math.random()*200,L.autoUpdateMeshBVH===void 0&&(L.autoUpdateMeshBVH=!1));else if(_.boundsTree&&(L.autoUpdateMeshBVH===!0||w===!0)){const E=performance.now(),B=E-L.staticGeometryLastUpdate;(w||B>100)&&(L.bvhNeedsUpdate=!1,L.staticGeometryLastUpdate=E,(C=L.staticGenerator)==null||C.generate(L.staticGeometry),_.boundsTree.refit())}}else if(!_.boundsTree){c||A();let L=!0;if((v.xr||_[f]===!1||(S=_.getAttribute("position"))!=null&&S.isInterleavedBufferAttribute||_.index&&((M=_.index)!=null&&M.isInterleavedBufferAttribute))&&(L=!1),L&&d){if(_[u]===void 0){let w=null;if(g.length>0){const E=g.shift();E&&!E.running&&(w=E)}if(!w&&m.length<3&&(w=new d,m.push(w)),w!=null&&!w.running){const E=b.name;Rl&&console.log("<<<< worker start",E,w),_[u]="queued",performance.mark("bvh.create.start");const B=_.clone();try{w.generate(B).then(P=>{_[u]="done",_.boundsTree=P}).catch(P=>{_[u]="failed - "+(P==null?void 0:P.message),_[f]=!1,Rl&&console.error("Failed to generate mesh bvh on worker",P)}).finally(()=>{Rl&&console.log(">>>>> worker done",E,{hasBoundsTre:_.boundsTree!=null}),g.push(w),B.dispose(),performance.mark("bvh.create.end"),performance.measure("bvh.create (worker)","bvh.create.start","bvh.create.end")})}catch(P){console.error("Failed to generate mesh bvh on worker",P)}}else Rl&&console.warn("No worker available")}}else(!h||!L)&&(a(),n&&(performance.mark("bvh.create.start"),_.boundsTree=new n(_),performance.mark("bvh.create.end"),performance.measure("bvh.create","bvh.create.start","bvh.create.end")))}if(y instanceof Em){const L=y,w=b.raycast;_.boundsTree?(a(),i&&(b.acceleratedRaycast||(b.acceleratedRaycast=i.bind(b),Rl&&console.debug(`Physics: bind acceleratedRaycast fn to "${b.name}"`)),b.raycast=b.acceleratedRaycast)):Rl&&console.warn("No bounds tree found for mesh",b.name,{workerTask:_[u],hasAcceleratedRaycast:i!=null});const E=L.firstHitOnly;return L.firstHitOnly=!1,L.intersectObject(b,!1,x),L.firstHitOnly=E,b.raycast=w,!0}else if(y instanceof Vn){const L=_.boundsTree;if(L){const w=y;if(l.copy(b.matrixWorld).invert(),w.applyMatrix4(l),L.intersectsSphere(w)){const B=$t(b),P=B.distanceTo(w.center),k=new i5(b,P,B);x.push(k)}}return!0}return!1}s.runMeshBVHRaycast=e;let t=!1,i=null,n=null,r=null,o=null;function a(){t||(t=!0,Promise.resolve().then(()=>wWe).then(y=>{i=y.acceleratedRaycast,n=y.MeshBVH,r=y.StaticGeometryGenerator,o=y.computeBoundsTree}).catch(y=>{(Rl||Qe())&&console.error("Failed to load BVH library...",y.message)}))}const l=new ce;let c=!1,h=!1,d=null;const u=Symbol("Needle:MeshBVH-Worker"),f=Symbol("Needle:MeshBVH-CanUseWorker"),m=[],g=[];function A(){c=!0,h=!0,Promise.resolve().then(()=>TWe).then(y=>{d=y.GenerateMeshBVHWorker}).catch(y=>{(Rl||Qe())&&console.warn("Failed to setup mesh bvh worker")}).finally(()=>{h=!1})}})(n2||(n2={}));const sK=Symbol("gltf-loader-internal-usage-tracker"),_Be=ee("debugusers"),bw=class{constructor(e){p(this,"parser");p(this,"_getDependency");p(this,"_loadingId");p(this,"_loadedObjects",new Set);this.parser=e,this._getDependency=this.parser.getDependency,this._loadingId=Date.now().toString()}get name(){return"NEEDLE_internal_usage_tracker"}static isLoading(e){return bw._loadingProcesses>0}beforeRoot(){bw._loadingProcesses++;const e=this,t=this._getDependency;return this.parser.getDependency=function(i,n){const r=t.call(this,i,n);return r.then(o=>(o&&(e._loadedObjects.add(o),o[sK]=e._loadingId),o)),r},null}afterRoot(e){bw._loadingProcesses--,this.parser.getDependency=this._getDependency;for(const t of this._loadedObjects)delete t[sK],t instanceof ye&&(t.parent||t instanceof fe&&setTimeout(()=>{_Be&&console.warn("> GLTF LOADER: Mesh not used in scene!",t),t.material=null,t.geometry=null},1e3));return null}};let rw=bw;p(rw,"_loadingProcesses",0);class jse{constructor(){window.addEventListener("unhandledrejection",e=>{var i;if(e.defaultPrevented)return;const t=(i=e==null?void 0:e.reason)==null?void 0:i.path;if(t){const n=t[0];n&&n.tagName==="IMG"&&(console.warn(`Could not load image:
`+n.src),e.preventDefault())}})}}const fP=ee("trackresources");function qse(){return fP==="dispose"}let xA=!0;fP===0&&(xA=!1);function CBe(s){xA=s}function $se(){return xA}const ere=Symbol("disposable");function n5(s,e){s&&(s[ere]=e,E0&&console.warn("Set disposable",e,s))}const tre=Symbol("disposed");function wBe(s){return s[tre]===!0}function Rn(s){var e;if(s){if(s[ere]===!1){E0&&console.warn("Object is marked as not disposable",s);return}if(s[tre]=!0,s instanceof sr)Rn(s.environment),Rn(s.background),Rn(s.customDepthMaterial),Rn(s.customDistanceMaterial);else if(s instanceof ol)Rn(s.geometry),Rn(s.material),Rn(s.skeleton),Rn(s.bindMatrix),Rn(s.bindMatrixInverse),Rn(s.customDepthMaterial),Rn(s.customDistanceMaterial),s.geometry=null,s.material=null,s.visible=!1;else if(s instanceof fe)Rn(s.geometry),Rn(s.material),Rn(s.customDepthMaterial),Rn(s.customDistanceMaterial),s.geometry=null,s.material=null,s.visible=!1;else if(s instanceof It){Ly(s);for(const t of Object.keys(s.attributes)){const i=s.attributes[t];Rn(i)}}else if(s instanceof dt||s instanceof Ma)E0&&console.warn("BufferAttribute dispose not supported",s.count);else if(s instanceof Array)for(const t of s)t instanceof Yt&&Rn(t);else if(s instanceof Yt){Ly(s);for(const i of Object.keys(s)){const n=s[i];n instanceof si&&(Rn(n),s[i]=null)}const t=s.uniforms;if(t)for(const i of Object.keys(t)){const n=t[i];n instanceof si?(Rn(n),t[i]=null):n instanceof Te&&(Rn(n.value),n.value=null)}}else s instanceof si?(Ly(s),Ly(s.source),((e=s.source)==null?void 0:e.data)instanceof ImageBitmap&&Ly(s.source.data)):s instanceof C1?(Ly(s.boneTexture),s.boneTexture=null):s instanceof Q0||!(s instanceof ye)&&E0&&console.warn("Unknown object type",s)}}function Ly(s){s&&((E0||qse()||fP)&&console.warn("🧨 FREE",s),s instanceof ImageBitmap?s.close():s instanceof ap?s.data=null:s.dispose())}function ire(s){(s instanceof fe||s instanceof ol)&&(s.material=null,s.geometry=null)}const SBe=new Set;function s5(s,e,t=null,i){if(i||(i=SBe,i.clear()),!s)return i;const n=s[mS];if(n)for(const r of n)i.has(r)||(t==null?void 0:t.call(null,r))!==!1&&(i.add(r),e&&s5(r,!0,t,i));return i}function MBe(s){return s[fC]}const E0=ee("debugresourceusers")||ee("debugmemory"),mS=Symbol("needle-resource-users"),fC=Symbol("needle-resource-users-count");function pa(s,e){nP(s,e,function(t,i){xA&&!ex.raycasting&&(s2(mS,this,t,!1),s2(mS,this,i,!0))})}xA&&(pa(fe.prototype,"material"),pa(fe.prototype,"geometry"),pa(Yt.prototype,"map"),pa(Yt.prototype,"bumpMap"),pa(Yt.prototype,"alphaMap"),pa(Yt.prototype,"normalMap"),pa(Yt.prototype,"displacementMap"),pa(Yt.prototype,"roughnessMap"),pa(Yt.prototype,"metalnessMap"),pa(Yt.prototype,"emissiveMap"),pa(Yt.prototype,"specularMap"),pa(Yt.prototype,"envMap"),pa(Yt.prototype,"lightMap"),pa(Yt.prototype,"aoMap"),pa(Yt.prototype,"gradientMap"));function IBe(s){if(xA===!1)return;const e=s[mS];if(e)for(const t of e)s2(mS,t,s,!1)}xA&&nP(Yt.prototype,"dispose",function(){IBe(this)});let cz=0;function s2(s,e,t,i){if(cz>0)return;if(Array.isArray(t)){for(const r of t)s2(s,e,r,i);return}if(!t)return;let n=t[s];if(n||(n=new Set),i){if(e&&!n.has(e)){n.add(e);let r=t[fC]||0;r+=1,t[fC]=r,E0&&console.warn(`🟢 Added user of "${t.type}"`,e,t,r,"users:",n)}}else if(e&&n.has(e)){n.delete(e);let r=t[fC]||0;r>0&&(r-=1,t[fC]=r),E0&&console.warn(`🔴 Removed user of "${t.type}"`,e,t,r,"users:",n),r<=0&&(rw.isLoading(t)||(fP&&console.warn(`🔴 Removed all user of "${t.type}"`,t),qse()&&Rn(t)))}t[s]=n}try{nP(Mm.prototype,"render",function(){cz++},function(){cz--})}catch(s){console.warn("Could not wrap WebGLRenderer.render",s)}const rK=ee("debugcomponentevents");class lM{static addComponentLifecylceEventListener(e,t){this.eventListeners.has(e)&&this.eventListeners.set(e,[]);let i=this.eventListeners.get(e);i||(i=[]),i.push(t),this.eventListeners.set(e,i),rK&&console.log("Added event listener for "+e,this.eventListeners)}static removeComponentLifecylceEventListener(e,t){const i=this.eventListeners.get(e);if(!i)return;const n=i.indexOf(t);n<0||i.splice(n,1)}static dispatchComponentLifecycleEvent(e,t){const i=this.eventListeners.get(e);if(rK&&console.log("Dispatching event "+e,i),!!i)for(const n of i)n(t)}}p(lM,"eventListeners",new Map);const gS=Symbol("NEEDLE_NEED_UPDATE_INSTANCE"),nre=Symbol("isUsingInstancing"),sre=Symbol("instancingRenderer"),mC=Symbol("instancingAutoUpdateBounds");class Vc{static isUsingInstancing(e){return e[nre]===!0}static getRenderer(e){return e[sre]||null}setAutoUpdateBounds(e,t){const i=Vc.getRenderer(e);i&&(i[mC]=t)}static markDirty(e,t=!0){if(e&&(this.isUsingInstancing(e)&&(e[gS]=!0,e.matrixWorldNeedsUpdate=!0),t))for(const i of e.children)Vc.markDirty(i,!0)}}function tx(s,e){try{e?s(e):s()}catch(t){return console.error(t),!1}return!0}const hz=ee("debugnewscripts"),TBe=ee("debughierarchy"),Jn=[];function EBe(){return Jn.length>0}function r2(s){if(!(s.new_scripts.length<=0)){if(hz&&console.log("Register new components",s.new_scripts.length,[...s.new_scripts],s.alias?"element: "+s.alias:s.hash,s),s.new_scripts_pre_setup_callbacks.length>0){for(const e of s.new_scripts_pre_setup_callbacks)e&&e();s.new_scripts_pre_setup_callbacks.length=0}Jn.length=0,s.new_scripts.length>0&&Jn.push(...s.new_scripts),s.new_scripts.length=0;for(let e=0;e<Jn.length;e++)try{const t=Jn[e];if(t.isComponent!==!0){(Qe()||hz)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,t),Jn.splice(e,1),e--;continue}if(t.destroyed)continue;if(!t.gameObject){console.warn(`Component can not be initialized: no GameObject assigned.
Did you add and remove a component in the same frame?`),Jn.splice(e,1),e--;continue}t.context=s,ow(t.gameObject),r5(t,s)}catch(t){console.error(t),np(Jn[e],s),Jn.splice(e,1),e--}for(let e=0;e<Jn.length;e++)try{const t=Jn[e];if(t.destroyed){np(Jn[e],s),Jn.splice(e,1),e--;continue}if(t.registering)try{t.registering()}catch(i){console.error(i)}t.__internalAwake!==void 0&&(t.gameObject||console.error("Calling awake for a component without a GameObject",t,t.gameObject),ow(t.gameObject),t.activeAndEnabled&&tx(t.__internalAwake.bind(t)))}catch(t){console.error(t),np(Jn[e],s),Jn.splice(e,1),e--}for(let e=0;e<Jn.length;e++)try{const t=Jn[e];if(t.destroyed||t.enabled===!1||(ow(t.gameObject),t.activeAndEnabled===!1))continue;t.__internalEnable!==void 0&&(t.enabled=!0,tx(t.__internalEnable.bind(t)))}catch(t){console.error(t),np(Jn[e],s),Jn.splice(e,1),e--}for(let e=0;e<Jn.length;e++)try{const t=Jn[e];if(t.destroyed||!t.gameObject)continue;s.new_script_start.push(t)}catch(t){console.error(t),np(Jn[e],s),Jn.splice(e,1),e--}Jn.length=0;for(const e of s.new_scripts_post_setup_callbacks)e&&e();s.new_scripts_post_setup_callbacks.length=0}}function RBe(s){s&&(s.__internalDisable(!0),np(s,s.context))}function rre(s,e){for(let t=0;t<s.new_script_start.length;t++)try{const i=s.new_script_start[t];if(e!==void 0&&i.gameObject!==e||i.destroyed||i.activeAndEnabled===!1)continue;tx(i.__internalAwake.bind(i)),i.enabled&&(tx(i.__internalEnable.bind(i)),tx(i.__internalStart.bind(i)),s.new_script_start.splice(t,1),t--)}catch(i){console.error(i),np(s.new_script_start[t],s),s.new_script_start.splice(t,1),t--}}function r5(s,e){e.scripts.indexOf(s)===-1&&(e.scripts.push(s),s.earlyUpdate&&e.scripts_earlyUpdate.push(s),s.update&&e.scripts_update.push(s),s.lateUpdate&&e.scripts_lateUpdate.push(s),s.onBeforeRender&&e.scripts_onBeforeRender.push(s),s.onAfterRender&&e.scripts_onAfterRender.push(s),s.onPausedChanged&&e.scripts_pausedChanged.push(s),UN(s,null)&&e.new_scripts_xr.push(s),UN(s,"immersive-vr")&&e.scripts_immersive_vr.push(s),UN(s,"immersive-ar")&&e.scripts_immersive_ar.push(s))}function np(s,e){uc(s,e.new_scripts),uc(s,e.new_script_start),uc(s,e.scripts),uc(s,e.scripts_earlyUpdate),uc(s,e.scripts_update),uc(s,e.scripts_lateUpdate),uc(s,e.scripts_onBeforeRender),uc(s,e.scripts_onAfterRender),uc(s,e.scripts_pausedChanged),uc(s,e.new_scripts_xr),uc(s,e.scripts_immersive_vr),uc(s,e.scripts_immersive_ar),e.stopAllCoroutinesFrom(s)}function uc(s,e){const t=e.indexOf(s);t>=0&&e.splice(t,1)}function UN(s,e){var t;if(s){const i=s;if(i.onBeforeXR||i.onEnterXR||i.onUpdateXR||i.onLeaveXR||i.onXRControllerAdded||i.onXRControllerRemoved)return!(e!=null&&((t=i.supportsXR)==null?void 0:t.call(i,e))===!1)}return!1}function BR(s){if(s||(s=Oi.Current.scene),!s){console.trace("Invalid call - no current context.");return}const e=rv(s);ore(s,e,!0)||(hz||Qe()?console.error(`Error updating hierarchy
Do you have circular references in your project? <a target="_blank" href="https://docs.needle.tools/circular-reference"> Click here for more information.`,s):console.error('Failed to update active state in hierarchy of "'+s.name+'"',s),console.warn(" ↑ this error might be caused by circular references. Please make sure you don't have files with circular references (e.g. one GLB 1 is loading GLB 2 which is then loading GLB 1 again)."))}function ore(s,e,t,i=0){if(i>1e3)return console.warn("Hierarchy is too deep (> 1000 level) - will abort updating active state"),!1;const n=rv(s);if(e&&(e=n,e&&s.parent)){const l=s.parent;e=l[yp],e===void 0&&(l instanceof sr||(e=!0))}const o=s[yp]!==e;s[yp]=e,o&&(TBe&&console.warn("ACTIVE CHANGE",s.name,n,s.visible,e,"changed?"+o,s),t&&LBe(s,l=>{e?l.enabled&&(tx(l.__internalAwake.bind(l)),l.enabled&&(l.__didEnable=!0,l.onEnable())):l.__didAwake&&l.enabled&&(l.__didEnable=!1,l.onDisable())}));let a=!0;if(s.children){const l=i+1;for(const c of s.children)ore(c,e,t,l)===!1&&(a=!1)}return a}function ow(s){let e=!0,t=s,i=!1;for(;t&&t;){if(t.type==="Scene"&&(i=!0),!rv(t)){e=!1;break}t=t.parent}if(!s){console.error("GO is null");return}s[yp]=e&&i}function LBe(s,e){var t;if((t=s.userData)!=null&&t.components)for(const i of s.userData.components)e(i)}const PR=new Map,are=Symbol("prewarmFlag"),dz=Symbol("waitingForPrewarm"),uz=ee("debugprewarm");function BBe(s,e){if(!s||s[are]===!0||s[dz]===!0)return;PR.has(e)||PR.set(e,[]),s[dz]=!0,PR.get(e).push(s),uz&&console.debug("register prewarm",s.name)}let oK=null,aK=null;function PBe(s){if(!s)return;const e=PR.get(s);if(!(e!=null&&e.length))return;const t=s.mainCamera;if(t){uz&&console.log("prewarm",e.length,"objects",[...e]);const i=s.renderer;if(i.compile){const n=s.scene;i.compile(n,t),oK??(oK=new tB(64)),aK??(aK=new eB(.001,9999999,oK)),aK.update(i,n);for(const r of e)r[are]=!0,r[dz]=!1;e.length=0,uz&&console.log("prewarm done")}}}const GBe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function kBe(s){return typeof s=="string"&&GBe.test(s)}const lo=[];for(let s=0;s<256;++s)lo.push((s+256).toString(16).slice(1));function NBe(s,e=0){return lo[s[e+0]]+lo[s[e+1]]+lo[s[e+2]]+lo[s[e+3]]+"-"+lo[s[e+4]]+lo[s[e+5]]+"-"+lo[s[e+6]]+lo[s[e+7]]+"-"+lo[s[e+8]]+lo[s[e+9]]+"-"+lo[s[e+10]]+lo[s[e+11]]+lo[s[e+12]]+lo[s[e+13]]+lo[s[e+14]]+lo[s[e+15]]}function DBe(s){if(!kBe(s))throw TypeError("Invalid UUID");let e;const t=new Uint8Array(16);return t[0]=(e=parseInt(s.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(s.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(s.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(s.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(s.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}function FBe(s){s=unescape(encodeURIComponent(s));const e=[];for(let t=0;t<s.length;++t)e.push(s.charCodeAt(t));return e}const VBe="6ba7b810-9dad-11d1-80b4-00c04fd430c8",zBe="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function UBe(s,e,t){function i(n,r,o,a){var l;if(typeof n=="string"&&(n=FBe(n)),typeof r=="string"&&(r=DBe(r)),((l=r)===null||l===void 0?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+n.length);if(c.set(r),c.set(n,r.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,o){a=a||0;for(let h=0;h<16;++h)o[a+h]=c[h];return o}return NBe(c)}try{i.name=s}catch{}return i.DNS=VBe,i.URL=zBe,i}function XBe(s,e,t,i){switch(s){case 0:return e&t^~e&i;case 1:return e^t^i;case 2:return e&t^e&i^t&i;case 3:return e^t^i}}function XN(s,e){return s<<e|s>>>32-e}function OBe(s){const e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof s=="string"){const o=unescape(encodeURIComponent(s));s=[];for(let a=0;a<o.length;++a)s.push(o.charCodeAt(a))}else Array.isArray(s)||(s=Array.prototype.slice.call(s));s.push(128);const i=s.length/4+2,n=Math.ceil(i/16),r=new Array(n);for(let o=0;o<n;++o){const a=new Uint32Array(16);for(let l=0;l<16;++l)a[l]=s[o*64+l*4]<<24|s[o*64+l*4+1]<<16|s[o*64+l*4+2]<<8|s[o*64+l*4+3];r[o]=a}r[n-1][14]=(s.length-1)*8/Math.pow(2,32),r[n-1][14]=Math.floor(r[n-1][14]),r[n-1][15]=(s.length-1)*8&4294967295;for(let o=0;o<n;++o){const a=new Uint32Array(80);for(let f=0;f<16;++f)a[f]=r[o][f];for(let f=16;f<80;++f)a[f]=XN(a[f-3]^a[f-8]^a[f-14]^a[f-16],1);let l=t[0],c=t[1],h=t[2],d=t[3],u=t[4];for(let f=0;f<80;++f){const m=Math.floor(f/20),g=XN(l,5)+XBe(m,c,h,d)+u+e[m]+a[f]>>>0;u=d,d=h,h=XN(c,30)>>>0,c=l,l=g}t[0]=t[0]+l>>>0,t[1]=t[1]+c>>>0,t[2]=t[2]+h>>>0,t[3]=t[3]+d>>>0,t[4]=t[4]+u>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}const ZBe=UBe("v5",80,OBe),lK=ZBe;Oi.registerCallback(ji.ContextCreated,s=>{const e=s.context;ure(e),cre(e)});const o2=ee("debugcomponents"),cK="eff8ba80-635d-11ec-90d6-0242ac120003";class So{constructor(e){p(this,"_originalSeed");p(this,"_seed");typeof e=="string"&&(e=So.hash(e)),this._originalSeed=e,this._seed=e}get seed(){return this._seed}set seed(e){this._seed=e}reset(){this._seed=this._originalSeed}generateUUID(e){if(typeof e=="string")return lK(e,cK);const t=this._seed;return this._seed-=1,lK(t.toString(),cK)}initialize(e){typeof e=="string"?this._seed=So.hash(e):this._seed=e}static createFromString(e){return new So(this.hash(e))}static hash(e){let t=0;for(let i=0;i<e.length;i++)t=e.charCodeAt(i)+((t<<5)-t);return t}}var lre=(s=>(s.NewInstanceCreated="new-instance-created",s.InstanceDestroyed="instance-destroyed",s))(lre||{});class WBe{constructor(e){p(this,"guid");p(this,"dontSave");this.guid=e}}function cM(s,e,t=!0,i){if(!s)return;const n=s;if(ic(s,t),!e){console.warn("Can not send destroy: No networking connection provided",s.guid);return}if(!e.isConnected){Qe()&&console.debug("Can not send destroy: not connected",s.guid);return}let r=s.guid;if(!r&&n.uuid&&(r=n.uuid),!r){console.warn("Can not send destroy: failed to find guid",s);return}o5(r,e,i)}function o5(s,e,t){const i=new WBe(s);(t==null?void 0:t.saveInRoom)===!1&&(i.dontSave=!0),e.send("instance-destroyed",i,yh.Queued)}function cre(s){s.connection.beginListen("instance-destroyed",e=>{o2&&console.log("[Remote] Destroyed",s.scene,e);const t=p5(e.guid,s.scene);t&&ic(t)})}class HBe{constructor(e,t,i){p(this,"filename");p(this,"hash");p(this,"size");this.filename=e,this.hash=t,this.size=i}}class hre{constructor(e,t){p(this,"guid");p(this,"originalGuid");p(this,"seed");p(this,"visible");p(this,"hostData");p(this,"dontSave");p(this,"parent");p(this,"position");p(this,"rotation");p(this,"scale");p(this,"preventCreation");p(this,"deleteStateOnDisconnect");this.originalGuid=e,this.guid=t}}function a5(s,e,t,i){var l,c;const n=s;if(!n.guid)return console.warn("Can not instantiate: No guid",n),null;if(e.context||(e.context=Wt.Current),!e.context)return console.error("Missing network instantiate options / reference to network connection in sync instantiate"),null;const r=e?{...e}:null,{instance:o,seed:a}=QBe(n,e);if(o){const h=o;if(h.guid){o2&&console.log("[Local] new instance","gameobject:",o==null?void 0:o.guid);const d=new hre(n.guid,h.guid);d.seed=a,e.deleteOnDisconnect===!0&&(d.deleteStateOnDisconnect=!0),r&&(r.position&&(d.position={x:r.position.x,y:r.position.y,z:r.position.z}),r.rotation&&(d.rotation={x:r.rotation.x,y:r.rotation.y,z:r.rotation.z,w:r.rotation.w}),r.scale&&(d.scale={x:r.scale.x,y:r.scale.y,z:r.scale.z})),d.position||(d.position={x:h.position.x,y:h.position.y,z:h.position.z}),d.rotation||(d.rotation={x:h.quaternion.x,y:h.quaternion.y,z:h.quaternion.z,w:h.quaternion.w}),d.scale||(d.scale={x:h.scale.x,y:h.scale.y,z:h.scale.z}),d.visible=n.visible,r!=null&&r.parent&&(typeof r.parent=="string"?d.parent=r.parent:d.parent=r.parent.guid),d.hostData=t,i===!1&&(d.dontSave=!0),!((l=e==null?void 0:e.context)==null?void 0:l.connection)&&Qe()&&console.debug("Object will be instantiated but it will not be synced: not connected",n.guid),e.context.connection.isInRoom&&cb.push(new WeakRef(h)),(c=e==null?void 0:e.context)==null||c.connection.send("new-instance-created",d)}else console.warn("Missing guid, can not send new instance event",h)}return o}function dre(){return Math.random()*9999999}const cb=new Array;function ure(s){s.connection.beginListen("new-instance-created",async e=>{const t=await KBe(e.originalGuid,s.scene);if(e.preventCreation===!0)return;if(!t){console.warn("could not find object that was instantiated: "+e.guid);return}const i=new Zh;e.position&&(i.position=new T(e.position.x,e.position.y,e.position.z)),e.rotation&&(i.rotation=new Ve(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w)),e.scale&&(i.scale=new T(e.scale.x,e.scale.y,e.scale.z)),i.parent=e.parent,e.seed&&(i.idProvider=new So(e.seed)),i.visible=e.visible,i.context=s,o2&&s.alias&&console.log("[Remote] instantiate in: "+s.alias);const n=ov(t,i);cb.push(new WeakRef(n)),n&&(e.parent==="scene"&&s.scene.add(n),o2&&console.log("[Remote] new instance","gameobject:",n==null?void 0:n.guid,t))}),s.connection.beginListen("left-room",()=>{cb.length>0&&console.debug(`Left networking room, cleaning up ${cb.length} instantiated objects`);for(const e of cb){const t=e.deref();t&&t.destroy()}cb.length=0})}function QBe(s,e){const t=dre(),i=e??new Zh;i.idProvider=new So(t);const n=ov(s,i);return{seed:t,instance:n}}const pre={};function fre(s,e){pre[s]=e}async function KBe(s,e){const t=pre[s];if(t!=null){const i=await t(s);if(i)return i}return mre(s,e)}function mre(s,e){if(e===null||!s)return null;if(e.guid===s)return e;if(e.children)for(const t of e.children){const i=mre(s,t);if(i)return i}return null}const hM=ee("gizmos"),Ur=ee("debugextension"),ON=ee("debugtypes");class YBe{constructor(){p(this,"_types",new Map);ON&&console.warn("TypeStore: Created",this)}add(e,t){ON&&console.warn("ADD TYPE",e);const i=this._types.get(e);i?ON&&i!==t&&console.warn("Type name exists multiple times in your project and may lead to runtime errors:",e):this._types.set(e,t)}get(e){return this._types.get(e)||null}getKey(e){for(const[t,i]of this._types)if(i===e)return t;return null}}const JBe=Symbol("BuiltInType"),Y=new YBe,jBe=function(s){Y.get(s.name)||Y.add(s.name,s)},l5=ee("debugresolvedependencies"),qBe=["/extensions/","extensions/"],$Be=[{prefix:"/nodes/",dependencyName:"node"},{prefix:"/meshes/",dependencyName:"mesh"},{prefix:"/materials/",dependencyName:"material"},{prefix:"/textures/",dependencyName:"texture"},{prefix:"/animations/",dependencyName:"animation"},{prefix:"nodes/",dependencyName:"node"},{prefix:"meshes/",dependencyName:"mesh"},{prefix:"materials/",dependencyName:"material"},{prefix:"textures/",dependencyName:"texture"},{prefix:"animations/",dependencyName:"animation"}];async function c5(s,e){l5&&console.log(s,e);const t=[];pz($Be,s,e,t);const i=await Promise.all(t);return typeof e=="string"&&i.length===1?i[0]:i}function gre(s,e){return!s||!e?!1:s["needle:identifier"]!=null&&e["needle:identifier"]!=null?s["needle:identifier"]===e["needle:identifier"]:!1}function ePe(s,e){s["needle:identifier"]=e}function pz(s,e,t,i){if(typeof t=="object"&&t!==void 0&&t!==null)for(const n of Object.keys(t)){const r=t[n];if(typeof r=="string"){const o=hK(e,r);if(o!=null)typeof o.then=="function"?i.push(o.then(a=>t[n]=a)):t[n]=o;else{const a=dK(s,e,r);if(a){i.push(a.then(l=>(t[n]=l,l)));continue}}}else if(Array.isArray(r))for(let o=0;o<r.length;o++){const a=r[o],l=hK(e,a);if(l!==null){typeof l.then=="function"?i.push(l.then(c=>r[o]=c)):r[o]=l;continue}for(const c of s){const h=Are(c.prefix,a);if(h>=0){l5&&console.log(c,h,c.dependencyName),i.push(e.getDependency(c.dependencyName,h).then(d=>r[o]=d));break}}typeof a=="object"&&pz(s,e,a,i)}else typeof r=="object"&&pz(s,e,r,i)}else if(typeof t=="string"){const n=dK(s,e,t);n&&i.push(n)}}function hK(s,e){if(s&&s.plugins&&typeof e=="string"){for(const t of qBe)if(e.startsWith(t)){let i=e.substring(t.length);const n=i.indexOf("/");n>=0&&(i=i.substring(0,n));const r=s.plugins[i];if(Ur&&console.log(i,r),typeof(r==null?void 0:r.resolve)=="function"){const o=e.substring(t.length+i.length+1);return r.resolve(s,o)}break}}return null}function dK(s,e,t){for(const i of s){const n=Are(i.prefix,t);if(n>=0)return l5&&console.warn("GET DEPENDENCY",i,n,i.dependencyName),e.getDependency(i.dependencyName,n)}return null}function Are(s,e){if(typeof e=="string"&&e.startsWith(s)){const t=e.substring(s.length),i=Number.parseInt(t);if(i>=0)return i}return-1}const ZN="NEEDLE_persistent_assets";function tPe(s){return(s==null?void 0:s.___persistentAsset)===!0}class iPe{constructor(e){p(this,"parser");this.parser=e}get name(){return ZN}async afterRoot(e){var n,r;if(!((r=(n=this.parser)==null?void 0:n.json)!=null&&r.extensions))return;const t=this.parser.json.extensions[ZN];if(!t)return;Ur&&console.log(t);const i=new Array;for(const o of t==null?void 0:t.assets){const a=c5(this.parser,o);a&&i.push(a)}await Promise.all(i)}resolve(e,t){const i=Number.parseInt(t);if(i>=0){Ur&&console.log(t);const n=e.json.extensions[ZN];if(n){const r=n==null?void 0:n.assets[i];if(r&&typeof r=="object"){r.___persistentAsset=!0;const o=r.__type;o&&Y.get(o)}return r}}return null}}const gd=ee("debugserializer");class nPe{constructor(){p(this,"typeMap",new Map)}register(e,t){if(this.typeMap.has(e)){const i=this.typeMap.get(e);if(i===t)return;gd&&console.warn("Type: "+e+" is already registered",t,i)}gd&&console.log("Register type serializer",t.name,t,e),this.typeMap.set(e,t)}getSerializer(e){if(e)return this.typeMap.get(e)}getSerializerForConstructor(e,t=0){if(t>20)return;if(!e||!e.constructor){gd&&console.log("invalid type");return}const i=e.name,n=this.getSerializer(e);if(n!==void 0)return gd&&console.log("FOUND SERIALIZER",n==null?void 0:n.name,e.name,e.constructor.name,"for type: "+i,n,e,this.typeMap),n;const r=Object.getPrototypeOf(e);if(r&&r!==e){const o=this.getSerializerForConstructor(r,++t);if(o){const a=r.constructor||r.prototype;gd&&console.log("FOUND SERIALIZER(in constructor) "+a.constructor.name,a.name,a,o),this.register(a,o)}return o}gd&&console.warn("No serializer found for "+i,e,e.name,e.constructor.name)}}const a2=new nPe;class Qc{constructor(e,t){p(this,"name");if(this.name=t,Array.isArray(e))for(const i of e)a2.register(i,this);else a2.register(e,this)}}class sPe{constructor(){p(this,"isDevMode",ka());p(this,"cache",{})}registerDefinedKeys(e,t){if(this.isDevMode&&this.cache[e]===void 0){this.cache[e]=Object.keys(t);const i=t;i.$serializedTypes&&Object.keys(i.$serializedTypes)&&this.cache[e].push(...Object.keys(i.$serializedTypes)),gd&&console.log("registerDefinedKeys for "+e,this.cache[e],t)}}getDefinedKey(e,t){return this.cache[e]===void 0?!1:this.cache[e].includes(t)}}class h5{constructor(e){p(this,"root");p(this,"gltf");p(this,"gltfId");p(this,"object");p(this,"target");p(this,"nodeId");p(this,"nodeToObject");p(this,"objectToNode");p(this,"context");p(this,"path");p(this,"type");p(this,"serializable");p(this,"implementationInformation");this.root=e}}function yre(s,e){const t=s.$serializedTypes;if(t===void 0)return null;const i={};for(const r in t){const o=s[r];if(o!=null&&typeof o=="object"){const a=a2.getSerializerForConstructor(o);if(a){i[r]=a.onSerialize(o,e);continue}}i[r]=o}function n(r){const o=Y._types;for(const[a,l]of o)if(l===s.constructor)return a;return r.__name||r.constructor.name}return i.name=n(s),typeof s.guid=="string"&&(i.guid=s.guid),i}const GR=[];function bre(s,e){if(!s)return e;typeof s.$serializedTypes=="object"&&(e||(e={}),Object.assign(e,s.$serializedTypes));const t=Object.getPrototypeOf(s);return bre(t,e)}function l2(s,e,t){if(!s)return!1;if(t.target=s,s.onBeforeDeserialize!==void 0){const n=s.onBeforeDeserialize(e,t);if(typeof n=="boolean")return n}const i=bre(s);if(e){if(typeof e.guid=="string"&&(s.guid=e.guid),i)for(const n in i){let r=function(l){const h=l.type;return h?fz(a,h,t,void 0,s[n]):fz(a,l,t,void 0,s[n])};const o=i[n],a=e[n];if(gd&&console.log(n,a,s,o),!(s[n]!==void 0&&a===void 0)&&(t.type=void 0,t.path=n,t.serializable=o,!(s.onBeforeDeserializeMember!==void 0&&s.onBeforeDeserializeMember(n,a,t)===!0))){if(o===null)s[n]=a;else{if(Array.isArray(o))for(let l=0;l<o.length;l++){const c=o[l],h=r(c);if(h!==void 0||l===o.length-1){s[n]=h;break}}else s[n]=r(o);GR.length=0}s.onAfterDeserializeMember!==void 0&&s.onAfterDeserializeMember(n,a,t)}}aPe(s,e)}return oPe(s,e,t.implementationInformation),s.onAfterDeserialize!==void 0&&s.onAfterDeserialize(e,t),!0}const rPe=ee("noerrors");function oPe(s,e,t){var r,o;if(rPe||!e||!ka()||!s||s.constructor&&s.constructor[JBe]===!0)return;const i=(r=s.constructor)==null?void 0:r.name,n=Object.getOwnPropertyNames(e);for(const a of n){if(a==="sourceId")continue;const l=s[a];if(l==null)continue;const c=e[a];if((t==null?void 0:t.getDefinedKey(i,a))===!1){const h=a.charAt(0).toUpperCase()+a.slice(1);t.getDefinedKey(i,h)&&(Ed(zl.Warn,'<strong>Please rename</strong> "'+h+'" to "'+a+'" in '+i),console.warn('Please use lowercase for field: "'+h+'" in '+i,c,s));continue}if(c!=null){if(typeof c=="object"&&(l===void 0||!l.isObject3D)){if(typeof c.node=="number"||typeof c.guid=="string"){if(c.could_not_resolve)continue;if(!(l!==void 0&&Object.keys(l).length>1)){Ed(zl.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(Object3D)
${a}? : Object3D;

in script ${i}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(i,a,s[a],s);continue}}else if(!Array.isArray(l)){const h=(o=l.constructor)==null?void 0:o.name;if(h==="Object"&&!l.constructor["did_warn:missing_serializable"]){l.constructor["did_warn:missing_serializable"]=!0;const d='You might be missing a @serializable(Type) decorator for field "'+a+'" in '+i+".ts";console.warn(d+`
${a}:`,c,h),Ed(zl.Warn,"Dev Warning: Are you missing a type in @serializable? Please check the browser console for details")}}}if(typeof l=="string"&&typeof c=="string"&&(c.endsWith(".gltf")||c.endsWith(".glb"))){Ed(zl.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(AssetReference)
${a}? : AssetReference;

in script ${i}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(i,a,s[a],s);continue}}}}function aPe(s,e){for(const t of Object.keys(e)){const i=e[t];if(typeof i=="object"&&i!==null&&i!==void 0){const n=s[t];if(!n){gd&&console.log(t,"is undefined on",s);continue}for(const r of Object.keys(i))if(n[r]===void 0&&uK(i[r])&&!uK(n)){const a=lPe(n,r);if(a&&((a==null?void 0:a.writable)===void 0||(a==null?void 0:a.writable)===!1)&&a.set===void 0){gd&&console.warn('Property is not writable "'+r+'"',n,a,i[r],n[r]);continue}n[r]=i[r]}}}}function lPe(s,e){for(;s;){const t=Object.getOwnPropertyDescriptor(s,e);if(t)return t;s=Object.getPrototypeOf(s)}}function uK(s){switch(typeof s){case"number":case"string":case"boolean":return!0}return!1}function fz(s,e,t,i,n){let r=typeof e=="function"&&e.prototype===void 0,o=e;if(r)try{if(o=e==null?void 0:e.call(e,n),r=!1,o==null)return}catch(h){console.error("Error in callback",h,s)}if(t.type=o,!r&&n instanceof o)return n;if(i||(i={serializer:a2.getSerializerForConstructor(o)}),n&&typeof n=="object"&&tPe(n)){if(n.__concreteInstance)return n.__concreteInstance;const h=n;if(!h.$serializedTypes&&o.prototype.$serializedTypes&&(h.$serializedTypes=o.prototype.$serializedTypes),h.$serializedTypes&&l2(h,s,t),n&&o!==void 0)try{let d=null;i.serializer&&(d=i.serializer.onDeserialize(s,t)),d||(d=new o,Ur&&console.log("Create concrete instance for persistent asset",n,"instance:",d),Lx(d,n)),n.__concreteInstance=d,n=d}catch(d){console.error("Error creating instance or creating values on instance",d,n,o)}return n}if(Array.isArray(s)){const h=[];for(let d=0;d<s.length;d++){const u=s[d],f=fz(u,e,t,i,u);h.push(f)}return h}const a=i==null?void 0:i.serializer;if(a)return a.onDeserialize(s,t);let l;if(s&&(s.isMaterial||s.isTexture||s.isObject3D||s instanceof Ba))l=s;else{if(s===void 0)return;if(s===null&&(o===Yt||o===si||o===fe||o===Ba))return null;try{l=new o(...cPe(s))}catch(h){console.error("Error creating "+t.path,t.target,h);return}}const c=l;return c.$serializedTypes&&l2(c,s,t),l}function cPe(s){if(GR.length=0,typeof s=="object"&&s!==null&&s!==void 0)for(const e of Object.keys(s))GR.push(s[e]);return GR}const mz=Symbol("assigned component properties");function Lx(s,e,t){var n;if(e==null||s==null)return;s[mz]=!0;const i=((n=s.constructor)==null?void 0:n.name)??"unknown";t==null||t.registerDefinedKeys(i,s);for(const r of Object.keys(e)){const o=hPe(s,r);typeof(o==null?void 0:o.value)!="function"&&(!o||o.writable===!0||(o==null?void 0:o.set)!==void 0)&&(s[r]=e[r])}delete s[mz]}function hPe(s,e){let t;do t=Object.getOwnPropertyDescriptor(s,e);while(!t&&(s=Object.getPrototypeOf(s)));return t}const xre=Symbol("customVisibilityFlag");function sp(s,e){s.layers[xre]=e}const pK=Symbol("DidPatchLayers");function dPe(){const s=ta.prototype;if(s[pK])return;s[pK]=!0;const e=s.test;s.test=function(t){return this[xre]===!1?!1:e.call(this,t)}}dPe();Object.defineProperty(Xt.prototype,"fov",{get:function(){return this._fov},set:function(s){const e=s!==this._fov;this._fov=s,e&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0});Object.defineProperty(Xt.prototype,"near",{get:function(){return this._near},set:function(s){const e=s!==this._near;this._near=s,e&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0});Object.defineProperty(Xt.prototype,"far",{get:function(){return this._far},set:function(s){const e=s!==this._far;this._far=s,e&&this.view!==void 0&&this.updateProjectionMatrix()},configurable:!0});const vre=new Map;function _re(s,e){if(!s)return;if(!e){console.warn("No prototype found",s,s.prototype,s.constructor);return}const t=vre.get(e);t&&t.apply(s)}function Cre(s){const e=uPe(s.prototype);vre.set(s,e)}function uPe(s){return new pPe(s)}class pPe{constructor(e){p(this,"$symbol");p(this,"extensions");p(this,"descriptors");this.$symbol=Symbol("prototype-extension"),this.extensions=Object.keys(e),this.descriptors=new Array;for(let t=0;t<this.extensions.length;t++){const i=this.extensions[t],n=Object.getOwnPropertyDescriptor(e,i);n&&this.descriptors.push(n)}}apply(e){if(!e[this.$symbol]){e[this.$symbol]=!0;for(let t=0;t<this.extensions.length;t++){const i=this.extensions[t],n=this.descriptors[t];n&&Object.defineProperty(e,i,n)}}}}const Eg=new Em,jo=new T,cf=new T,qn=new Ve,fK={X:new T(1,0,0),Y:new T(0,1,0),Z:new T(0,0,1)},WN={type:"change"},mK={type:"mouseDown",mode:null},gK={type:"mouseUp",mode:null},AK={type:"objectChange"};class fPe extends MB{constructor(e,t=null){super(void 0,t);const i=new xPe(this);this._root=i;const n=new d5;this._gizmo=n,i.add(n);const r=new vPe;this._plane=r,i.add(r);const o=this;function a(x,v){let _=v;Object.defineProperty(o,x,{get:function(){return _!==void 0?_:v},set:function(C){_!==C&&(_=C,r[x]=C,n[x]=C,o.dispatchEvent({type:x+"-changed",value:C}),o.dispatchEvent(WN))}}),o[x]=v,r[x]=v,n[x]=v}a("camera",e),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);const l=new T,c=new T,h=new Ve,d=new Ve,u=new T,f=new Ve,m=new T,g=new T,A=new T,y=0,b=new T;a("worldPosition",l),a("worldPositionStart",c),a("worldQuaternion",h),a("worldQuaternionStart",d),a("cameraPosition",u),a("cameraQuaternion",f),a("pointStart",m),a("pointEnd",g),a("rotationAxis",A),a("rotationAngle",y),a("eye",b),this._offset=new T,this._startNorm=new T,this._endNorm=new T,this._cameraScale=new T,this._parentPosition=new T,this._parentQuaternion=new Ve,this._parentQuaternionInv=new Ve,this._parentScale=new T,this._worldScaleStart=new T,this._worldQuaternionInv=new Ve,this._worldScale=new T,this._positionStart=new T,this._quaternionStart=new Ve,this._scaleStart=new T,this._getPointer=mPe.bind(this),this._onPointerDown=APe.bind(this),this._onPointerHover=gPe.bind(this),this._onPointerMove=yPe.bind(this),this._onPointerUp=bPe.bind(this),t!==null&&this.connect()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&Eg.setFromCamera(e,this.camera);const t=HN(this._gizmo.picker[this.mode],Eg);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&Eg.setFromCamera(e,this.camera);const t=HN(this._plane,Eg,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,mK.mode=this.mode,this.dispatchEvent(mK)}}pointerMove(e){const t=this.axis,i=this.mode,n=this.object;let r=this.space;if(i==="scale"?r="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(r="world"),n===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&Eg.setFromCamera(e,this.camera);const o=HN(this._plane,Eg,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(n.position.applyQuaternion(qn.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),r==="world"&&(n.parent&&n.position.add(jo.setFromMatrixPosition(n.parent.matrixWorld)),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(jo.setFromMatrixPosition(n.parent.matrixWorld))));else if(i==="scale"){if(t.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),cf.set(a,a,a)}else jo.copy(this.pointStart),cf.copy(this.pointEnd),jo.applyQuaternion(this._worldQuaternionInv),cf.applyQuaternion(this._worldQuaternionInv),cf.divide(jo),t.search("X")===-1&&(cf.x=1),t.search("Y")===-1&&(cf.y=1),t.search("Z")===-1&&(cf.z=1);n.scale.copy(this._scaleStart).multiply(cf),this.scaleSnap&&(t.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(jo.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(jo.copy(this.rotationAxis).cross(this.eye))*a):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(fK[t]),jo.copy(fK[t]),r==="local"&&jo.applyQuaternion(this.worldQuaternion),jo.cross(this.eye),jo.length()===0?l=!0:this.rotationAngle=this._offset.dot(jo.normalize())*a),(t==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&t!=="E"&&t!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(qn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(qn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(WN),this.dispatchEvent(AK)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(gK.mode=this.mode,this.dispatchEvent(gK)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(WN),this.dispatchEvent(AK),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Eg}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function mPe(s){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:s.button};{const e=this.domElement.getBoundingClientRect();return{x:(s.clientX-e.left)/e.width*2-1,y:-(s.clientY-e.top)/e.height*2+1,button:s.button}}}function gPe(s){if(this.enabled)switch(s.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(s));break}}function APe(s){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(s)),this.pointerDown(this._getPointer(s)))}function yPe(s){this.enabled&&this.pointerMove(this._getPointer(s))}function bPe(s){this.enabled&&(this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(s)))}function HN(s,e,t){const i=e.intersectObject(s,!0);for(let n=0;n<i.length;n++)if(i[n].object.visible||t)return i[n];return!1}const YT=new Xi,Sn=new T(0,1,0),yK=new T(0,0,0),bK=new ce,JT=new Ve,kR=new Ve,ed=new T,xK=new ce,gC=new T(1,0,0),Qg=new T(0,1,0),AC=new T(0,0,1),jT=new T,__=new T,C_=new T;class xPe extends ye{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const t=this.controls;t.object!==void 0&&(t.object.updateMatrixWorld(),t.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):t.object.parent.matrixWorld.decompose(t._parentPosition,t._parentQuaternion,t._parentScale),t.object.matrixWorld.decompose(t.worldPosition,t.worldQuaternion,t._worldScale),t._parentQuaternionInv.copy(t._parentQuaternion).invert(),t._worldQuaternionInv.copy(t.worldQuaternion).invert()),t.camera.updateMatrixWorld(),t.camera.matrixWorld.decompose(t.cameraPosition,t.cameraQuaternion,t._cameraScale),t.camera.isOrthographicCamera?t.camera.getWorldDirection(t.eye).negate():t.eye.copy(t.cameraPosition).sub(t.worldPosition).normalize(),super.updateMatrixWorld(e)}}class d5 extends ye{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new ii({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new _n({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const n=t.clone();n.opacity=.5;const r=e.clone();r.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const a=e.clone();a.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const h=e.clone();h.color.setHex(255),h.opacity=.5;const d=e.clone();d.opacity=.25;const u=e.clone();u.color.setHex(16776960),u.opacity=.25,e.clone().color.setHex(16776960);const m=e.clone();m.color.setHex(7895160);const g=new Ns(0,.04,.1,12);g.translate(0,.05,0);const A=new pn(.08,.08,.08);A.translate(0,.04,0);const y=new It;y.setAttribute("position",new ut([0,0,0,1,0,0],3));const b=new Ns(.0075,.0075,.5,3);b.translate(0,.25,0);function x(X,F){const H=new tp(X,.0075,3,64,F*Math.PI*2);return H.rotateY(Math.PI/2),H.rotateX(Math.PI/2),H}function v(){const X=new It;return X.setAttribute("position",new ut([0,0,0,1,1,1],3)),X}const _={X:[[new fe(g,r),[.5,0,0],[0,0,-Math.PI/2]],[new fe(g,r),[-.5,0,0],[0,0,Math.PI/2]],[new fe(b,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new fe(g,o),[0,.5,0]],[new fe(g,o),[0,-.5,0],[Math.PI,0,0]],[new fe(b,o)]],Z:[[new fe(g,a),[0,0,.5],[Math.PI/2,0,0]],[new fe(g,a),[0,0,-.5],[-Math.PI/2,0,0]],[new fe(b,a),null,[Math.PI/2,0,0]]],XYZ:[[new fe(new lp(.1,0),d.clone()),[0,0,0]]],XY:[[new fe(new pn(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new fe(new pn(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new fe(new pn(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},C={X:[[new fe(new Ns(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new fe(new Ns(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new fe(new Ns(.2,0,.6,4),i),[0,.3,0]],[new fe(new Ns(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new fe(new Ns(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new fe(new Ns(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new fe(new lp(.2,0),i)]],XY:[[new fe(new pn(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new fe(new pn(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new fe(new pn(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},S={START:[[new fe(new lp(.01,2),n),null,null,null,"helper"]],END:[[new fe(new lp(.01,2),n),null,null,null,"helper"]],DELTA:[[new ts(v(),n),null,null,null,"helper"]],X:[[new ts(y,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new ts(y,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new ts(y,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={XYZE:[[new fe(x(.5,1),m),null,[0,Math.PI/2,0]]],X:[[new fe(x(.5,.5),r)]],Y:[[new fe(x(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new fe(x(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new fe(x(.75,1),u),null,[0,Math.PI/2,0]]]},L={AXIS:[[new ts(y,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},w={XYZE:[[new fe(new Wc(.25,10,8),i)]],X:[[new fe(new tp(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new fe(new tp(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new fe(new tp(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new fe(new tp(.75,.1,2,24),i)]]},E={X:[[new fe(A,r),[.5,0,0],[0,0,-Math.PI/2]],[new fe(b,r),[0,0,0],[0,0,-Math.PI/2]],[new fe(A,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new fe(A,o),[0,.5,0]],[new fe(b,o)],[new fe(A,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new fe(A,a),[0,0,.5],[Math.PI/2,0,0]],[new fe(b,a),[0,0,0],[Math.PI/2,0,0]],[new fe(A,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new fe(new pn(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new fe(new pn(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new fe(new pn(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new fe(new pn(.1,.1,.1),d.clone())]]},B={X:[[new fe(new Ns(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new fe(new Ns(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new fe(new Ns(.2,0,.6,4),i),[0,.3,0]],[new fe(new Ns(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new fe(new Ns(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new fe(new Ns(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new fe(new pn(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new fe(new pn(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new fe(new pn(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new fe(new pn(.2,.2,.2),i),[0,0,0]]]},P={X:[[new ts(y,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new ts(y,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new ts(y,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function k(X){const F=new ye;for(const H in X)for(let W=X[H].length;W--;){const se=X[H][W][0].clone(),de=X[H][W][1],be=X[H][W][2],Pe=X[H][W][3],Oe=X[H][W][4];se.name=H,se.tag=Oe,de&&se.position.set(de[0],de[1],de[2]),be&&se.rotation.set(be[0],be[1],be[2]),Pe&&se.scale.set(Pe[0],Pe[1],Pe[2]),se.updateMatrix();const ae=se.geometry.clone();ae.applyMatrix4(se.matrix),se.geometry=ae,se.renderOrder=1/0,se.position.set(0,0,0),se.rotation.set(0,0,0),se.scale.set(1,1,1),F.add(se)}return F}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=k(_)),this.add(this.gizmo.rotate=k(M)),this.add(this.gizmo.scale=k(E)),this.add(this.picker.translate=k(C)),this.add(this.picker.rotate=k(w)),this.add(this.picker.scale=k(B)),this.add(this.helper.translate=k(S)),this.add(this.helper.rotate=k(L)),this.add(this.helper.scale=k(P)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:kR;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let r=0;r<n.length;r++){const o=n[r];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(qn.setFromEuler(YT.set(0,0,0)),o.quaternion.copy(i).multiply(qn),Math.abs(Sn.copy(gC).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(qn.setFromEuler(YT.set(0,0,Math.PI/2)),o.quaternion.copy(i).multiply(qn),Math.abs(Sn.copy(Qg).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(qn.setFromEuler(YT.set(0,Math.PI/2,0)),o.quaternion.copy(i).multiply(qn),Math.abs(Sn.copy(AC).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(qn.setFromEuler(YT.set(0,Math.PI/2,0)),Sn.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(bK.lookAt(yK,Sn,Qg)),o.quaternion.multiply(qn),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),jo.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),jo.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(jo),o.visible=this.dragging):(o.quaternion.copy(i),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Sn.copy(gC).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Sn.copy(Qg).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Sn.copy(AC).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Sn.copy(AC).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Sn.copy(gC).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Sn.copy(Qg).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(JT.copy(i),Sn.copy(this.eye).applyQuaternion(qn.copy(i).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(bK.lookAt(this.eye,yK,Qg)),o.name==="X"&&(qn.setFromAxisAngle(gC,Math.atan2(-Sn.y,Sn.z)),qn.multiplyQuaternions(JT,qn),o.quaternion.copy(qn)),o.name==="Y"&&(qn.setFromAxisAngle(Qg,Math.atan2(Sn.x,Sn.z)),qn.multiplyQuaternions(JT,qn),o.quaternion.copy(qn)),o.name==="Z"&&(qn.setFromAxisAngle(AC,Math.atan2(Sn.y,Sn.x)),qn.multiplyQuaternions(JT,qn),o.quaternion.copy(qn))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(l){return o.name===l}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}class vPe extends fe{constructor(){super(new Rs(1e5,1e5,2,2),new ii({visible:!1,wireframe:!0,side:Zi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),jT.copy(gC).applyQuaternion(t==="local"?this.worldQuaternion:kR),__.copy(Qg).applyQuaternion(t==="local"?this.worldQuaternion:kR),C_.copy(AC).applyQuaternion(t==="local"?this.worldQuaternion:kR),Sn.copy(__),this.mode){case"translate":case"scale":switch(this.axis){case"X":Sn.copy(this.eye).cross(jT),ed.copy(jT).cross(Sn);break;case"Y":Sn.copy(this.eye).cross(__),ed.copy(__).cross(Sn);break;case"Z":Sn.copy(this.eye).cross(C_),ed.copy(C_).cross(Sn);break;case"XY":ed.copy(C_);break;case"YZ":ed.copy(jT);break;case"XZ":Sn.copy(C_),ed.copy(__);break;case"XYZ":case"E":ed.set(0,0,0);break}break;case"rotate":default:ed.set(0,0,0)}ed.length()===0?this.quaternion.copy(this.cameraQuaternion):(xK.lookAt(jo.set(0,0,0),ed,Sn),this.quaternion.setFromRotationMatrix(xK)),super.updateMatrixWorld(e)}}const _Pe=ee("debuggetcomponent"),vK=()=>_Pe||globalThis.NEEDLE_DEBUG_GETCOMPONENT===!0;function CPe(s){return s==null||s.isObject3D?s:s.object&&s.object.isObject3D?s.object:s}function u5(s,e){if(!s||!s.userData.components)return e;const t=s.userData.components.indexOf(e);return t<0||(lM.dispatchComponentLifecycleEvent("removing-component",e),e.gameObject=null,s.userData.components.splice(t,1)),e}function dM(s,e,t){const i=vA(s,e);return i||Yl(s,e,t)}const wre=new So("addComponentIdProvider");function R0(s,e,t=!0){s.userData||(s.userData={}),s.userData.components||(s.userData.components=[]),s.userData.components.push(e),e.gameObject=s,(e.guid===void 0||e.guid==="invalid")&&(e.guid=wre.generateUUID()),AP(s),_P(e,e.context);try{t&&e.__internalAwake&&(ow(s),e.activeAndEnabled&&e.__internalAwake()),lM.dispatchComponentLifecycleEvent("component-added",e)}catch(i){console.error(i)}return e}function Yl(s,e,t,i){if(typeof e=="function"){const n=new e;t&&n.__internalNewInstanceCreated(t);let r=!0;return(i==null?void 0:i.callAwake)!=null&&(r=i.callAwake),R0(s,n,r)}if(e.destroyed)return console.warn("Can not move/add a destroyed component",e),e;if(e.gameObject===s)return e;if(e.gameObject&&e.gameObject.userData.components){const n=e.gameObject.userData.components.indexOf(e);e.gameObject.userData.components.splice(n,1)}if(!s.userData.components)s.userData.components=[];else if(s.userData.components.includes(e))return e;return s.userData.components.push(e),e.gameObject=s,(e.guid===void 0||e.guid==="invalid")&&(e.guid=wre.generateUUID()),t&&e._internalInit(t),_P(e,e.context),e}function Sre(s){if(s.gameObject&&s.gameObject.userData.components){const e=s.gameObject.userData.components.indexOf(s);s.gameObject.userData.components.splice(e,1)}s.__internalDisable&&s.__internalDisable(),np(s,s.context??Wt.Current),s.destroy(),s.gameObject=null}let _K=!1;function Mre(s,e,t){var i;if(s==null)return null;if(!s.isObject3D)return console.error("Object is not object3D"),null;if(!((i=s==null?void 0:s.userData)!=null&&i.components)||(typeof e=="string"&&(_K||(_K=!0,console.warn(`Accessing components by name is not supported.
Please use the component type instead. This may keep working in local development but it will fail when bundling your application.

You can import other modules your main module to get access to types
or if you use npmdefs you can make types available globally using globalThis:
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis`,e))),vK()&&console.log("[onGetComponent] FIND",e),e==null))return null;for(let n=0;n<s.userData.components.length;n++){const r=s.userData.components[n];let o=Object.getPrototypeOf(r);for(;o;){if(o===e.prototype)if(vK()&&console.log("[onGetComponent] MATCH BY PROTOYPE",o),t)t.push(r);else return r;o=Object.getPrototypeOf(o)}}return t||null}function vA(s,e){const t=Mre(s,e);return t?Array.isArray(t)?t[0]:t:null}function uM(s,e,t,i=!0){return t||(t=[]),i&&(t.length=0),Mre(s,e,t),t}function pM(s,e,t){var n;const i=vA(s,e);if(t===!1&&(i==null?void 0:i.enabled)===!1)return null;if(i)return i;for(let r=0;r<((n=s==null?void 0:s.children)==null?void 0:n.length);r++){const o=pM(s.children[r],e);if(o)return o}return null}function sv(s,e,t,i=!0){var n;t||(t=[]),i&&(t.length=0),uM(s,e,t,!1);for(let r=0;r<((n=s==null?void 0:s.children)==null?void 0:n.length);r++)sv(s.children[r],e,t,!1);return t}function AS(s,e){if(!s)return null;if(Array.isArray(s)){for(let i=0;i<s.length;i++){const n=CPe(s[i]),r=AS(n,e);if(r)return r}return null}const t=vA(s,e);return t||(s.parent?AS(s.parent,e):null)}function mP(s,e,t,i=!0){return t||(t=[]),i&&(t.length=0),s?(uM(s,e,t,!1),s.parent?mP(s.parent,e,t,!1):t):t}function gP(s,e=void 0,t=!0){if(!s)return null;if(!e&&(e=Wt.Current,!e))return console.error("Can not search object without any needle context or scene!!!"),null;let i=e;if(i.isScene||(i=e==null?void 0:e.scene),!i)return null;for(const n in i.children){const r=i.children[n];if(t===!1&&r[yp]===!1)continue;const o=pM(r,s);if(o)return o}return null}function Ire(s,e,t=void 0){if(!s)return e??[];if(e||(e=[]),e.length=0,!t&&(t=Wt.Current,!t))return console.error("Can not search object without any needle context or scene!!!"),e;"scene"in t&&(t=t.scene);const i=t;if(!i)return e;for(const n in i.children){const r=i.children[n];sv(r,s,e,!1)}return e}function AP(s){s&&s.isObject3D===!0&&_re(s,ye)}ye.prototype.SetActive=function(s){this.visible=s};ye.prototype.setActive=function(s){this.visible=s};ye.prototype.destroy=function(){ic(this)};ye.prototype.addComponent=function(s,e){return Yl(this,s,e)};ye.prototype.addNewComponent=function(s,e){return Yl(this,s,e)};ye.prototype.removeComponent=function(s){return u5(this,s)};ye.prototype.getOrAddComponent=function(s,e){return dM(this,s,e)};ye.prototype.getComponent=function(s){return vA(this,s)};ye.prototype.getComponents=function(s,e){return uM(this,s,e)};ye.prototype.getComponentInChildren=function(s){return pM(this,s)};ye.prototype.getComponentsInChildren=function(s,e){return sv(this,s,e)};ye.prototype.getComponentInParent=function(s){return AS(this,s)};ye.prototype.getComponentsInParent=function(s,e){return mP(this,s,e)};Object.getOwnPropertyDescriptor(ye.prototype,"activeSelf")||Object.defineProperty(ye.prototype,"activeSelf",{get:function(){return rv(this)},set:function(s){aw(this,s)}});Object.getOwnPropertyDescriptor(ye.prototype,"worldPosition")||Object.defineProperty(ye.prototype,"worldPosition",{get:function(){return this instanceof d5?$t(this.object):$t(this)},set:function(s){_r(this,s)}});Object.getOwnPropertyDescriptor(ye.prototype,"worldQuaternion")||Object.defineProperty(ye.prototype,"worldQuaternion",{get:function(){return this instanceof d5?gn(this.object):gn(this)},set:function(s){Uc(this,s)}});Object.getOwnPropertyDescriptor(ye.prototype,"worldRotation")||Object.defineProperty(ye.prototype,"worldRotation",{get:function(){return $1(this)},set:function(s){bO(this,s)}});Object.getOwnPropertyDescriptor(ye.prototype,"worldScale")||Object.defineProperty(ye.prototype,"worldScale",{get:function(){return kn(this)},set:function(s){wx(this,s)}});Object.getOwnPropertyDescriptor(ye.prototype,"worldForward")||Object.defineProperty(ye.prototype,"worldForward",{get:function(){return St().set(0,0,1).applyQuaternion(gn(this))}});Object.getOwnPropertyDescriptor(ye.prototype,"worldRight")||Object.defineProperty(ye.prototype,"worldRight",{get:function(){return St().set(1,0,0).applyQuaternion(gn(this))}});Object.getOwnPropertyDescriptor(ye.prototype,"worldUp")||Object.defineProperty(ye.prototype,"worldUp",{get:function(){return St().set(0,1,0).applyQuaternion(gn(this))}});Cre(ye);class hn extends ge{constructor(t,i,n,r){var e=(...args)=>{super(...args);p(this,"alpha",1)};i!=null&&n!=null?(e(t,i,n),this.alpha=r):(e(t),this.alpha=1)}get isRGBAColor(){return!0}set a(t){this.alpha=t}get a(){return this.alpha}clone(){const t=super.clone();return t.alpha=this.alpha,t}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,"alpha"in t&&typeof t.alpha=="number"?this.alpha=t.alpha:typeof t.a=="number"&&(this.alpha=t.a),this}lerp(t,i){const n=t;return n.alpha!=null&&(this.alpha=lt.lerp(this.alpha,n.alpha,i)),super.lerp(t,i)}lerpColors(t,i,n){const r=t,o=i;return r.alpha!=null&&o.alpha!=null&&(this.alpha=lt.lerp(r.alpha,o.alpha,n)),super.lerpColors(t,i,n)}multiply(t){const i=t;return i.alpha!=null&&(this.alpha=this.alpha*i.alpha),super.multiply(t)}fromArray(t,i=0){return this.alpha=t[i+3],super.fromArray(t,i)}}const NR=ee("debuggetcomponent"),DR=ee("debuginstantiate");var Tre=(s=>(s[s.None=0]="None",s[s.HideInHierarchy=1]="HideInHierarchy",s[s.HideInInspector=2]="HideInInspector",s[s.DontSaveInEditor=4]="DontSaveInEditor",s[s.NotEditable=8]="NotEditable",s[s.DontSaveInBuild=16]="DontSaveInBuild",s[s.DontUnloadUnusedAsset=32]="DontUnloadUnusedAsset",s[s.DontSave=52]="DontSave",s[s.HideAndDontSave=61]="HideAndDontSave",s))(Tre||{});class Zh{constructor(){p(this,"idProvider");p(this,"parent");p(this,"keepWorldPosition");p(this,"position");p(this,"rotation");p(this,"scale");p(this,"visible");p(this,"context");p(this,"components")}clone(){var t,i,n;const e=new Zh;return e.idProvider=this.idProvider,e.parent=this.parent,e.keepWorldPosition=this.keepWorldPosition,e.position=(t=this.position)==null?void 0:t.clone(),e.rotation=(i=this.rotation)==null?void 0:i.clone(),e.scale=(n=this.scale)==null?void 0:n.clone(),e.visible=this.visible,e.context=this.context,e.components=this.components,e}cloneAssign(e){var t,i,n;this.idProvider=e.idProvider,this.parent=e.parent,this.keepWorldPosition=e.keepWorldPosition,this.position=(t=e.position)==null?void 0:t.clone(),this.rotation=(i=e.rotation)==null?void 0:i.clone(),this.scale=(n=e.scale)==null?void 0:n.clone(),this.visible=e.visible,this.context=e.context,this.components=e.components}}function rv(s){return s.visible}function aw(s,e){return typeof e=="number"&&(e=e>.5),s.visible=e,s.visible}function Ere(s){return s[yp]||yP(s)}function Rre(s,e){s[nre]=e}function yP(s){return Vc.isUsingInstancing(s)}function p5(s,e){return xx(s,e,!0,!0)}const Lre=Symbol("isDestroyed");function eA(s){return s[Lre]}function Bre(s,e){s[Lre]=e}const gz=Symbol("isDontDestroy");function hb(s,e=!0){s[gz]=e}const FR=[],VR=[];function ic(s,e=!0,t=!1){FR.length=0,VR.length=0,Az(s,e,!0);for(const i of FR)i.gameObject=null,i.context=null;for(const i of VR)Bre(i,!0),t&&Rn(i),ire(i);VR.length=0,FR.length=0}function Az(s,e=!0,t=!0){var o;if(s==null)return;const i=s;if(i.isComponent){if(i[gz])return;FR.push(i);const a=i.gameObject;i.__internalDisable(),i.__internalDestroy(),i.gameObject=a;return}if(s[gz])return;const n=s;NR&&console.log(n),VR.push(n);const r=(o=n.userData)==null?void 0:o.components;if(r!=null&&Array.isArray(r)){let a=r.length;for(let l=0;l<r.length;l++){const c=r[l];Az(c,e,!1),r.length<a&&(a=r.length,l--)}}if(e&&n.children)for(const a of n.children)Az(a,e,!1);t&&n.removeFromParent()}function tA(s,e,t=!0){return Pre(s,e,t)}function*bP(s,e,t=!1,i=999,n=0){if(s!=null&&s.userData.components&&!(n>i)){for(const r of s.userData.components)e&&(r==null?void 0:r.isComponent)===!0&&r instanceof e?yield r:yield r;if(t===!0)for(const r of s.children)yield*bP(r,e,!0,i,n+1)}}function Pre(s,e,t,i=0){var n;if(s){if(s.isObject3D,i>1e3){console.warn("Failed to iterate components: too many levels");return}if((n=s.userData)!=null&&n.components)for(let r=0;r<s.userData.components.length;r++){const o=s.userData.components[r];if((o==null?void 0:o.isComponent)===!0){const a=e(o);if(a!==void 0)return a}}if(t&&s.children){const r=i+1;for(let o=0;o<s.children.length;o++){const a=s.children[o];if(!a)continue;const l=Pre(a,e,t,r);if(l!==void 0)return l}}}}function ov(s,e=null){let t=null;e!==null&&(e.x!==void 0?(t=new Zh,t.position=e):t=e);let i=Wt.Current;t!=null&&t.context&&(i=t.context),NR&&i.alias&&console.log("context",i.alias),t&&!t.idProvider&&(t.idProvider=new So(Date.now()));const n=[],r={},o={},a=Gre(i,s,t,n,r,o);a&&(SPe(r),wPe(o,r)),NR&&(YL(s,!0),YL(a,!0));const l={};if((t==null?void 0:t.components)!==!1){for(const c in n){const h=n[c],d=h.guid;t&&t.idProvider&&(h.guid=t.idProvider.generateUUID(),l[d]=h.guid,NR&&console.log(h.name,h.guid)),_P(h,i),h.__internalNewInstanceCreated&&h.__internalNewInstanceCreated()}for(const c in n){const h=n[c];h.resolveGuids&&h.resolveGuids(l),h.enabled!==!1&&(h.enabled=!0)}r2(i)}return a}function Gre(s,e,t,i,n,r){var h;if(!e)return null;const o=e.userData;e.userData={};const a=e.children;e.children=[];const l=e.clone(!1);if(AP(l),e.userData=o,e.children=a,n[e.uuid]={original:e,clone:l},DR&&console.log("ADD",e,l),e.type==="SkinnedMesh"&&(r[e.uuid]={original:e,clone:l}),(t==null?void 0:t.visible)!==void 0&&(l.visible=t.visible),t!=null&&t.idProvider){l.uuid=t.idProvider.generateUUID();const d=l;d&&(d.guid=l.uuid)}e.animations&&e.animations.length>0&&(l.animations=[...e.animations]);const c=e.parent;if(c&&c.add(l),t!=null&&t.position?_r(l,t.position):l.position.copy(e.position),t!=null&&t.rotation?Uc(l,t.rotation):l.quaternion.copy(e.quaternion),t!=null&&t.scale?l.scale.copy(t.scale):l.scale.copy(e.scale),t!=null&&t.parent&&t.parent!=="scene"){let d=null;if(typeof t.parent=="string"?d=xx(t.parent,s.scene,!0):d=t.parent,d){const u=t.keepWorldPosition===!0?d.attach:d.add;u?u.call(d,l):console.error("Invalid parent object",d,"received when instantiating:",e)}else console.warn("could not find parent:",t.parent)}for(const[d,u]of Object.entries(e.userData))d!=="components"&&(l.userData[d]=u);if((h=e.userData)!=null&&h.components){const d=e.userData.components,u=[];l.userData.components=u;for(let f=0;f<d.length;f++){const m=d[f],g=new m.constructor;Lx(g,m),m[JC]!==void 0&&(g[JC]=m[JC]),u.push(g),g.gameObject=l,i.push(g),n[m.guid]={original:m,clone:g},lM.dispatchComponentLifecycleEvent("component-added",g)}}t&&(t.position=void 0,t.rotation=void 0,t.scale=void 0,t.parent=void 0);for(const d in e.children){const u=e.children[d],f=Gre(s,u,t,i,n,r);f&&l.add(f)}return l}function wPe(s,e){for(const t in s){const i=s[t],n=i.original,r=n.skeleton,o=i.clone;if(!r){console.warn("Skinned mesh has no skeleton?",i);continue}const a=r.bones,l=o.skeleton.clone();o.skeleton=l,o.bindMatrix.clone().copy(n.bindMatrix),o.bindMatrixInverse.copy(n.bindMatrixInverse);const c=[];l.bones=c;for(let h=0;h<a.length;h++){const d=a[h],f=e[d.uuid].clone;c.push(f)}}for(const t in s){const i=s[t].clone;i.skeleton.update(),i.bind(i.skeleton,i.bindMatrix),i.updateMatrixWorld(!0)}}function SPe(s){var e;for(const t in s){const n=s[t].clone;if(n!=null&&n.isObject3D&&((e=n==null?void 0:n.userData)!=null&&e.components))for(let r=0;r<n.userData.components.length;r++){const o=n.userData.components[r],a=Object.entries(o);for(const[l,c]of a)if(Array.isArray(c)){const h=[];o[l]=h;for(let d=0;d<c.length;d++){const u=c[d];if(typeof u!="object"){h.push(u);continue}const f=CK(o,l,u,s);f!==void 0?h.push(f):h.push(u)}}else if(typeof c=="object"){const h=CK(o,l,c,s);h!==void 0&&(o[l]=h)}}}}function CK(s,e,t,i){var n,r;if(t!=null)if(t.isComponent===!0){const o=t.gameObject;if(o){const a=o.uuid,l=(n=i[a])==null?void 0:n.clone;if(!l){DR&&console.log("reference did not change",e,s,t);return}const c=o.userData.components.indexOf(t);if(c>=0&&l.isObject3D)return DR&&console.log(e,a),l.userData.components[c];console.warn("could not find component",e,t)}}else if(t.isObject3D===!0){if(e==="gameObject")return;const o=t;if(o){const a=o.uuid,l=(r=i[a])==null?void 0:r.clone;if(l)return DR&&console.log(e,"old",t,"new",l),l}}else{if(t.isVector4||t.isVector3||t.isVector2||t.isQuaternion||t.isEuler)return t.clone();if(t.isColor===!0)return t.clone();if(t.isEventList===!0)return t.__internalOnInstantiate(i)}}var kre={exports:{}},Nre={exports:{}};(function(){var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(t,i){return t<<i|t>>>32-i},rotr:function(t,i){return t<<32-i|t>>>i},endian:function(t){if(t.constructor==Number)return e.rotl(t,8)&16711935|e.rotl(t,24)&4278255360;for(var i=0;i<t.length;i++)t[i]=e.endian(t[i]);return t},randomBytes:function(t){for(var i=[];t>0;t--)i.push(Math.floor(Math.random()*256));return i},bytesToWords:function(t){for(var i=[],n=0,r=0;n<t.length;n++,r+=8)i[r>>>5]|=t[n]<<24-r%32;return i},wordsToBytes:function(t){for(var i=[],n=0;n<t.length*32;n+=8)i.push(t[n>>>5]>>>24-n%32&255);return i},bytesToHex:function(t){for(var i=[],n=0;n<t.length;n++)i.push((t[n]>>>4).toString(16)),i.push((t[n]&15).toString(16));return i.join("")},hexToBytes:function(t){for(var i=[],n=0;n<t.length;n+=2)i.push(parseInt(t.substr(n,2),16));return i},bytesToBase64:function(t){for(var i=[],n=0;n<t.length;n+=3)for(var r=t[n]<<16|t[n+1]<<8|t[n+2],o=0;o<4;o++)n*8+o*6<=t.length*8?i.push(s.charAt(r>>>6*(3-o)&63)):i.push("=");return i.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var i=[],n=0,r=0;n<t.length;r=++n%4)r!=0&&i.push((s.indexOf(t.charAt(n-1))&Math.pow(2,-2*r+8)-1)<<r*2|s.indexOf(t.charAt(n))>>>6-r*2);return i}};Nre.exports=e})();var MPe=Nre.exports,yz={utf8:{stringToBytes:function(s){return yz.bin.stringToBytes(unescape(encodeURIComponent(s)))},bytesToString:function(s){return decodeURIComponent(escape(yz.bin.bytesToString(s)))}},bin:{stringToBytes:function(s){for(var e=[],t=0;t<s.length;t++)e.push(s.charCodeAt(t)&255);return e},bytesToString:function(s){for(var e=[],t=0;t<s.length;t++)e.push(String.fromCharCode(s[t]));return e.join("")}}},wK=yz;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var IPe=function(s){return s!=null&&(Dre(s)||TPe(s)||!!s._isBuffer)};function Dre(s){return!!s.constructor&&typeof s.constructor.isBuffer=="function"&&s.constructor.isBuffer(s)}function TPe(s){return typeof s.readFloatLE=="function"&&typeof s.slice=="function"&&Dre(s.slice(0,0))}(function(){var s=MPe,e=wK.utf8,t=IPe,i=wK.bin,n=function(r,o){r.constructor==String?o&&o.encoding==="binary"?r=i.stringToBytes(r):r=e.stringToBytes(r):t(r)?r=Array.prototype.slice.call(r,0):!Array.isArray(r)&&r.constructor!==Uint8Array&&(r=r.toString());for(var a=s.bytesToWords(r),l=r.length*8,c=1732584193,h=-271733879,d=-1732584194,u=271733878,f=0;f<a.length;f++)a[f]=(a[f]<<8|a[f]>>>24)&16711935|(a[f]<<24|a[f]>>>8)&4278255360;a[l>>>5]|=128<<l%32,a[(l+64>>>9<<4)+14]=l;for(var m=n._ff,g=n._gg,A=n._hh,y=n._ii,f=0;f<a.length;f+=16){var b=c,x=h,v=d,_=u;c=m(c,h,d,u,a[f+0],7,-680876936),u=m(u,c,h,d,a[f+1],12,-389564586),d=m(d,u,c,h,a[f+2],17,606105819),h=m(h,d,u,c,a[f+3],22,-1044525330),c=m(c,h,d,u,a[f+4],7,-176418897),u=m(u,c,h,d,a[f+5],12,1200080426),d=m(d,u,c,h,a[f+6],17,-1473231341),h=m(h,d,u,c,a[f+7],22,-45705983),c=m(c,h,d,u,a[f+8],7,1770035416),u=m(u,c,h,d,a[f+9],12,-1958414417),d=m(d,u,c,h,a[f+10],17,-42063),h=m(h,d,u,c,a[f+11],22,-1990404162),c=m(c,h,d,u,a[f+12],7,1804603682),u=m(u,c,h,d,a[f+13],12,-40341101),d=m(d,u,c,h,a[f+14],17,-1502002290),h=m(h,d,u,c,a[f+15],22,1236535329),c=g(c,h,d,u,a[f+1],5,-165796510),u=g(u,c,h,d,a[f+6],9,-1069501632),d=g(d,u,c,h,a[f+11],14,643717713),h=g(h,d,u,c,a[f+0],20,-373897302),c=g(c,h,d,u,a[f+5],5,-701558691),u=g(u,c,h,d,a[f+10],9,38016083),d=g(d,u,c,h,a[f+15],14,-660478335),h=g(h,d,u,c,a[f+4],20,-405537848),c=g(c,h,d,u,a[f+9],5,568446438),u=g(u,c,h,d,a[f+14],9,-1019803690),d=g(d,u,c,h,a[f+3],14,-187363961),h=g(h,d,u,c,a[f+8],20,1163531501),c=g(c,h,d,u,a[f+13],5,-1444681467),u=g(u,c,h,d,a[f+2],9,-51403784),d=g(d,u,c,h,a[f+7],14,1735328473),h=g(h,d,u,c,a[f+12],20,-1926607734),c=A(c,h,d,u,a[f+5],4,-378558),u=A(u,c,h,d,a[f+8],11,-2022574463),d=A(d,u,c,h,a[f+11],16,1839030562),h=A(h,d,u,c,a[f+14],23,-35309556),c=A(c,h,d,u,a[f+1],4,-1530992060),u=A(u,c,h,d,a[f+4],11,1272893353),d=A(d,u,c,h,a[f+7],16,-155497632),h=A(h,d,u,c,a[f+10],23,-1094730640),c=A(c,h,d,u,a[f+13],4,681279174),u=A(u,c,h,d,a[f+0],11,-358537222),d=A(d,u,c,h,a[f+3],16,-722521979),h=A(h,d,u,c,a[f+6],23,76029189),c=A(c,h,d,u,a[f+9],4,-640364487),u=A(u,c,h,d,a[f+12],11,-421815835),d=A(d,u,c,h,a[f+15],16,530742520),h=A(h,d,u,c,a[f+2],23,-995338651),c=y(c,h,d,u,a[f+0],6,-198630844),u=y(u,c,h,d,a[f+7],10,1126891415),d=y(d,u,c,h,a[f+14],15,-1416354905),h=y(h,d,u,c,a[f+5],21,-57434055),c=y(c,h,d,u,a[f+12],6,1700485571),u=y(u,c,h,d,a[f+3],10,-1894986606),d=y(d,u,c,h,a[f+10],15,-1051523),h=y(h,d,u,c,a[f+1],21,-2054922799),c=y(c,h,d,u,a[f+8],6,1873313359),u=y(u,c,h,d,a[f+15],10,-30611744),d=y(d,u,c,h,a[f+6],15,-1560198380),h=y(h,d,u,c,a[f+13],21,1309151649),c=y(c,h,d,u,a[f+4],6,-145523070),u=y(u,c,h,d,a[f+11],10,-1120210379),d=y(d,u,c,h,a[f+2],15,718787259),h=y(h,d,u,c,a[f+9],21,-343485551),c=c+b>>>0,h=h+x>>>0,d=d+v>>>0,u=u+_>>>0}return s.endian([c,h,d,u])};n._ff=function(r,o,a,l,c,h,d){var u=r+(o&a|~o&l)+(c>>>0)+d;return(u<<h|u>>>32-h)+o},n._gg=function(r,o,a,l,c,h,d){var u=r+(o&l|a&~l)+(c>>>0)+d;return(u<<h|u>>>32-h)+o},n._hh=function(r,o,a,l,c,h,d){var u=r+(o^a^l)+(c>>>0)+d;return(u<<h|u>>>32-h)+o},n._ii=function(r,o,a,l,c,h,d){var u=r+(a^(o|~l))+(c>>>0)+d;return(u<<h|u>>>32-h)+o},n._blocksize=16,n._digestsize=16,kre.exports=function(r,o){if(r==null)throw new Error("Illegal argument "+r);var a=s.wordsToBytes(n(r,o));return o&&o.asBytes?a:o&&o.asString?i.bytesToString(a):s.bytesToHex(a)}})();var EPe=kre.exports;const SK=uP(EPe);exports.BlobStorage=void 0;(s=>{s.baseUrl="https://networking.needle.tools";function i(h){return SK(new Uint8Array(h))}s.hashMD5=i;function n(h){const d=SK(new Uint8Array(h),{encoding:"binary",asBytes:!0});return btoa(String.fromCharCode(...d))}s.hashMD5_Base64=n;function r(h){const d=new Uint8Array(h);return crypto.subtle.digest("SHA-256",d).then(f=>btoa(String.fromCharCode(...new Uint8Array(f))))}s.hashSha256=r;function o(h){const d=h.filesize/1024/1024;return Bh()?d<50:d<5}s.canUpload=o;async function a(h,d){var x;const u=s.baseUrl;if(u){if(!h.name)return console.error("Upload: file name is missing"),null}else return console.error("Blob storage base url is not set"),null;let f=null;h instanceof File?f=await h.arrayBuffer():f=h.data;const m=f.byteLength,g=m/1024/1024;if(g>50)return(d==null?void 0:d.silent)!==!0&&An(`File (${g.toFixed(1)}MB) is too large for uploading (see console for details)`),console.warn(`Your file is too large for uploading (${g.toFixed(1)}MB). Max allowed size is 50MB`),null;if(!Bh()&&g>5)return(d==null?void 0:d.silent)!==!0&&An('File is too large for uploading. Please get a <a href="https://needle.tools/pricing" target="_blank">commercial license</a> to upload files larger than 5MB'),console.warn(`Your file is too large for uploading (${g.toFixed(1)}MB). Max size is 5MB for non-commercial users. Please get a commercial license at https://needle.tools/pricing for larger files (up to 50MB)`),null;if(m<1)return console.warn(`Your file is too small for uploading (${g.toFixed(1)}MB). Min size is 1 byte`),null;const A=n(f),y={filename:h.name,"Content-Md5":A,"Content-Type":h.type||"application/octet-stream",FileSize:m.toString(),"Content-Disposition":`attachment; filename="${h.name}"`,"x-amz-server-side-encryption":"AES256"},b=await fetch(u+"/api/needle/blob",{method:"POST",headers:y,signal:d==null?void 0:d.abort}).then(v=>v.json()).catch(v=>(console.error(v),null));if(b==null)return console.warn("Upload failed..."),null;if("error"in b)return console.error(b.error),null;if("upload"in b&&b.upload){let v=function(S){var L;return(L=d==null?void 0:d.onProgress)==null||L.call(null,{progress01:0,state:"inprogress"}),fetch(S,{method:"PUT",headers:y,body:f,signal:d==null?void 0:d.abort}).then(w=>{var E;return(E=d==null?void 0:d.onProgress)==null||E.call(null,{progress01:1,state:"finished"}),w}).catch(w=>w)};console.debug("Uploading file",b.upload);let _=!1,C=null;for(let S=0;S<3;S++)try{if(_)break;if((x=d==null?void 0:d.abort)!=null&&x.aborted)return console.debug("Aborted upload"),null;const M=await v(b.upload);M instanceof Error?(C=M,await Nh(1e3*S)):M.ok&&(console.debug("File uploaded successfully"),_=!0)}catch(M){console.error(M)}if(!_)return console.error((C==null?void 0:C.message)||"Failed to upload file"),null}if("download"in b){const v=u+b.download;return console.debug("File found in blob storage",v),{key:b.key,success:!0,download_url:v}}return null}s.upload=a;function l(h){return`${s.baseUrl}/api/needle/blob/${h}`}s.getBlobUrlForKey=l;async function c(h,d){var v;const u=await fetch(h),f=(v=u.body)==null?void 0:v.getReader(),m=u.headers.get("Content-Length"),g=m?parseInt(m):0;if(!f)return null;let A=0;const y=[];for(;;){const{done:_,value:C}=await f.read();if(C&&(y.push(C),A+=C.length,d==null||d.call(null,new ProgressEvent("progress",{loaded:A,total:g}))),_)break}const b=new Uint8Array(A);let x=0;for(const _ of y)b.set(_,x),x+=_.length;return b}s.download=c})(exports.BlobStorage||(exports.BlobStorage={}));const hf=ee("debugaddressables");class Fre{constructor(e){p(this,"_context");p(this,"_assetReferences",{});p(this,"preUpdate",()=>{});this._context=e,this._context.pre_update_callbacks.push(this.preUpdate)}dispose(){const e=this._context.pre_update_callbacks.indexOf(this.preUpdate);e>=0&&this._context.pre_update_callbacks.splice(e,1);for(const t in this._assetReferences){const i=this._assetReferences[t];i==null||i.unload()}this._assetReferences={}}findAssetReference(e){return this._assetReferences[e]||null}registerAssetReference(e){return e.url&&(this._assetReferences[e.url]?console.warn("Asset reference already registered",e):this._assetReferences[e.url]=e),e}unregisterAssetReference(e){e.url&&delete this._assetReferences[e.url]}}const QN=Symbol("assetReference"),t0=class{constructor(e,t,i=null){p(this,"_loading");p(this,"_asset");p(this,"_glbRoot");p(this,"_url");p(this,"_progressListeners",[]);p(this,"_hash");p(this,"_hashedUri");p(this,"_isLoadingRawBinary",!1);p(this,"_rawBinary");this._url=e,this._hash=t,e.includes("?v=")?this._hashedUri=e:this._hashedUri=t?e+"?v="+t:e,i!==null&&(this.asset=i),fre(this._url,this.onResolvePrefab.bind(this))}static getOrCreateFromUrl(e,t){if(!t&&(t=Wt.Current,!t))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.');const i=t.addressables,n=i.findAssetReference(e);if(n)return n;const r=new t0(e,t.hash);return i.registerAssetReference(r),r}static getOrCreate(e,t,i){if(typeof e=="string"){if(!i&&(i=Wt.Current,!i))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.')}else i=e.context,e=e.sourceId;const n=km(e,t);hf&&console.log("GetOrCreate Addressable from",e,t,"FinalPath=",n);const r=i.addressables,o=r.findAssetReference(n);if(o)return o;const a=new t0(n,i.hash);return r.registerAssetReference(a),a}get asset(){return this._glbRoot??this._asset}set asset(e){this._asset=e}get uri(){return this._url}get url(){return this._url}get hasUrl(){return this._url!==void 0&&(this._url.startsWith("http")||this._url.startsWith("blob:")||this._url.startsWith("www.")||this._url.includes("/"))}get rawAsset(){return this._asset}async onResolvePrefab(e){return e===this.url&&(this.mustLoad&&await this.loadAssetAsync(),this.asset)?this.asset:null}get mustLoad(){return!this.asset||this.asset.__destroyed===!0||eA(this.asset)===!0}isLoaded(){return this._rawBinary||this.asset!==void 0}unload(){this.asset&&(hf&&console.log("Unload",this.asset),this.asset.scene&&ic(this.asset.scene,!0,!0),ic(this.asset,!0,!0)),this.asset=null,this._rawBinary=void 0,this._glbRoot=null,this._loading=void 0,Wt.Current&&Wt.Current.addressables.unregisterAssetReference(this)}async preload(){if(!this.mustLoad||this._isLoadingRawBinary)return null;if(this._rawBinary!==void 0)return this._rawBinary;this._isLoadingRawBinary=!0,hf&&console.log("Preload",this._hashedUri);const e=await exports.BlobStorage.download(this._hashedUri,t=>{this.raiseProgressEvent(t)});return this._rawBinary=(e==null?void 0:e.buffer)??null,this._isLoadingRawBinary=!1,this._rawBinary}async loadAssetAsync(e){if(hf&&console.log("loadAssetAsync",this.url),!this.mustLoad)return this.asset;if(e&&this._progressListeners.push(e),this._loading!==void 0)return this._loading.then(n=>this.asset);const t=Wt.Current;this._rawBinary?(this._loading=kh().parseSync(t,this._rawBinary,this.url,null),this.raiseProgressEvent(new ProgressEvent("progress",{loaded:this._rawBinary.byteLength,total:this._rawBinary.byteLength}))):(hf&&console.log("Load async",this.url),this._loading=kh().loadSync(t,this._hashedUri,this.url,null,n=>{this.raiseProgressEvent(n)}));const i=await this._loading;if(this._progressListeners.length=0,this._glbRoot=this.tryGetActualGameObjectRoot(i),this._loading=void 0,i)return i[QN]=this,this._glbRoot&&(this._glbRoot[QN]=this),this.asset&&(this.asset[QN]=this),r2(t),i.scene!==void 0&&(this.asset=i),this.asset}async instantiate(e){return this.onInstantiate(e,!1)}async instantiateSynced(e,t=!0){return this.onInstantiate(e,!0,t)}beginListenDownload(e){this._progressListeners.indexOf(e)<0&&this._progressListeners.push(e)}endListenDownload(e){const t=this._progressListeners.indexOf(e);t>=0&&this._progressListeners.splice(t,1)}raiseProgressEvent(e){for(const t of this._progressListeners)t(this,e)}async onInstantiate(e,t=!1,i){const n=Wt.Current,r=new Zh;if(e instanceof ye?r.parent=e:e&&(Object.assign(r,e),r.cloneAssign(e)),r.parent||(r.parent=n.scene),this.mustLoad&&await this.loadAssetAsync(),hf&&console.log("Instantiate",this.url,"parent:",e),this.asset){hf&&console.log("Add to scene",this.asset);let o=t0.currentlyInstantiating.get(this.url);if(o!==void 0&&o>=1e4)return console.error("Recursive or too many instantiations of "+this.url+" in the same frame ("+o+")"),null;try{if(o===void 0&&(o=0),o+=1,t0.currentlyInstantiating.set(this.url,o),t){r.context=n;const a=this.asset;a.guid=this.url;const l=a5(a,r,void 0,i);if(l)return l}else{const a=ov(this.asset,r);if(a)return a}}finally{n.post_render_callbacks.push(()=>{o===void 0||o<0?o=0:o-=1,t0.currentlyInstantiating.set(this.url,o)})}}else hf&&console.warn("Failed to load asset",this.url);return null}tryGetActualGameObjectRoot(e){if(e&&e.scene){const t=e.scene;return t.isGroup&&t.children.length===1&&t.children[0].name+"glb"===t.name?t.children[0]:t}return null}};let gi=t0;p(gi,"currentlyInstantiating",new Map);class RPe extends Qc{constructor(){super([gi],"AssetReferenceSerializer")}onSerialize(e,t){if(e&&e.uri!==void 0&&typeof e.uri=="string")return e.uri}onDeserialize(e,t){if(typeof e=="string")return t.context?t.gltfId?gi.getOrCreate(t.gltfId,e,t.context):(console.error("Missing source id"),null):(console.error("Missing context"),null);if(e instanceof ye){if(!t.context)return console.error("Missing context"),null;if(!t.gltfId)return console.error("Missing source id"),null;const i=e,n=t.context,r=i.guid??i.uuid,o=n.addressables.findAssetReference(r);if(o)return o;const a=new gi(r,void 0,i);return n.addressables.registerAssetReference(a),a}return null}}new RPe;const LPe=Promise.resolve(null),xw=class{constructor(e){p(this,"url");p(this,"_bitmap");p(this,"_bitmapObject");p(this,"loader",null);this.url=e}static getOrCreate(e){let t=xw.imageReferences.get(e);return t||(t=new xw(e),xw.imageReferences.set(e,t)),t}dispose(){this._bitmapObject&&this._bitmapObject.close(),this._bitmap=void 0}createHTMLImage(){const e=new Image;return e.src=this.url,e}createTexture(){return this.url?(this.loader||(this.loader=new Mh),this.loader.setCrossOrigin("anonymous"),this.loader.loadAsync(this.url)):LPe}getBitmap(){return this._bitmap?this._bitmap:(this._bitmap=new Promise((e,t)=>{const i=document.createElement("img");i.addEventListener("load",()=>{this._bitmap=createImageBitmap(i).then(n=>(this._bitmapObject=n,e(n),n))}),i.addEventListener("error",n=>{console.error("Failed to load image:"+this.url,n),e(null)}),i.src=this.url}),this._bitmap)}};let ix=xw;p(ix,"imageReferences",new Map);class Vre extends Qc{constructor(){super([ix],"ImageReferenceSerializer")}onSerialize(e,t){return null}onDeserialize(e,t){if(typeof e=="string"){const i=km(t.gltfId,e);return ix.getOrCreate(i)}}}new Vre;const vw=class{constructor(e){p(this,"url");p(this,"res");this.url=e}static getOrCreate(e){let t=vw.cache.get(e);return t||(t=new vw(e),vw.cache.set(e,t)),t}async loadRaw(){return this.res||(this.res=fetch(this.url)),this.res.then(e=>e.blob())}async loadText(){return this.res||(this.res=fetch(this.url)),this.res.then(e=>e.text())}};let nx=vw;p(nx,"cache",new Map);class zre extends Qc{constructor(){super([nx],"FileReferenceSerializer")}onSerialize(e,t){return null}onDeserialize(e,t){if(typeof e=="string"){const i=km(t.gltfId,e);return nx.getOrCreate(i)}}}new zre;class BPe{constructor(e){p(this,"context");p(this,"mixers",[]);this.context=e}onDestroy(){this.mixers.forEach(e=>e.stopAllAction()),this.mixers.length=0}registerAnimationMixer(e){if(!e){console.warn("AnimationsRegistry.registerAnimationMixer called with null or undefined mixer");return}this.mixers.includes(e)||this.mixers.push(e)}unregisterAnimationMixer(e){if(!e){console.warn("AnimationsRegistry.unregisterAnimationMixer called with null or undefined mixer");return}const t=this.mixers.indexOf(e);t!==-1&&this.mixers.splice(t,1)}}class Bx{static tryGetActionsFromMixer(e){const t=e._actions;return t||null}static tryGetAnimationClipsFromObjectHierarchy(e,t){if(t||(t=new Array),e)e.animations&&t.push(...e.animations);else return t;if(e.children)for(const i of e.children)this.tryGetAnimationClipsFromObjectHierarchy(i,t);return t}static assignAnimationsFromFile(e,t){if(!e||!e.animations){console.debug("No animations found in file");return}for(let n=0;n<e.animations.length;n++){const r=e.animations[n];if(!r.tracks||r.tracks.length<=0){console.warn("Animation has no tracks");continue}for(const o in r.tracks){const a=r.tracks[o],l=di.parseTrackName(a.name);let c=di.findNode(e.scene,l.nodeName);if(!c){const d=a.__objectName??a.name.substring(0,a.name.indexOf("."));if(c=e.scene.getObjectByProperty("uuid",d),!c)continue}let h=i(c);if(!h){if(!(t!=null&&t.createAnimationComponent)){console.warn("No AnimationComponent found in parent hierarchy of object and no 'createAnimationComponent' callback was provided in options.");continue}h=t.createAnimationComponent(e.scene,r)}h.addClip&&h.addClip(r)}}function i(n){var o;if(!n)return null;const r=(o=n.userData)==null?void 0:o.components;if(r&&r.length>0){for(let a=0;a<r.length;a++)if(r[a].isAnimationComponent===!0)return n}return i(n.parent)}}}var c2=(s=>(s.Visible="application-visible",s.Hidden="application-hidden",s.MuteChanged="application-mutechanged",s))(c2||{});let h2=!1;const Lb=[];function _A(){if(h2)return;Qe()&&console.debug("User interaction registered: audio can now be played"),h2=!0;const s=[...Lb];Lb.length=0,s.forEach(e=>e())}document.addEventListener("mousedown",_A);document.addEventListener("pointerup",_A);document.addEventListener("click",_A);document.addEventListener("dragstart",_A);document.addEventListener("touchend",_A);document.addEventListener("keydown",_A);Vt.onXRSessionStart(()=>{_A()});const YZ=class extends EventTarget{constructor(t){super();p(this,"_mute",!1);p(this,"context");p(this,"_isVisible",!0);this.context=t,window.addEventListener("visibilitychange",this.onVisiblityChanged.bind(this),!1)}static get userInteractionRegistered(){return h2}static registerWaitForInteraction(t){if(t!==null){if(h2){t();return}Lb.indexOf(t)===-1&&Lb.push(t)}}static unregisterWaitForInteraction(t){const i=Lb.indexOf(t);i!==-1&&Lb.splice(i,1)}get muted(){return this._mute}set muted(t){t!==this._mute&&(this._mute=t,this.dispatchEvent(new Event("application-mutechanged")))}get hasFocus(){return document.hasFocus()}get isVisible(){return this._isVisible}onVisiblityChanged(t){switch(t.target.visibilityState){case"hidden":this._isVisible=!1,this.dispatchEvent(new Event("application-hidden"));break;case"visible":this._isVisible=!0,this.dispatchEvent(new Event("application-visible"));break}}};let Lh=YZ;p(Lh,"registerWaitForAllowAudio",YZ.registerWaitForInteraction);function*Ure(s,e=null){const t=e?e.time:Wt.Current.time,i=t.time;for(;t.time-i<s;)yield}function*PPe(s){for(let e=0;e<s;e++)yield}function*Xre(s){let e=!0;for(s.then(()=>e=!1),s.catch(()=>e=!1);e;)yield}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var Ss=Uint8Array,Ul=Uint16Array,f5=Int32Array,xP=new Ss([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),vP=new Ss([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),bz=new Ss([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ore=function(s,e){for(var t=new Ul(31),i=0;i<31;++i)t[i]=e+=1<<s[i-1];for(var n=new f5(t[30]),i=1;i<30;++i)for(var r=t[i];r<t[i+1];++r)n[r]=r-t[i]<<5|i;return{b:t,r:n}},Zre=Ore(xP,2),Wre=Zre.b,xz=Zre.r;Wre[28]=258,xz[258]=28;var Hre=Ore(vP,0),GPe=Hre.b,MK=Hre.r,vz=new Ul(32768);for(var Hn=0;Hn<32768;++Hn){var df=(Hn&43690)>>1|(Hn&21845)<<1;df=(df&52428)>>2|(df&13107)<<2,df=(df&61680)>>4|(df&3855)<<4,vz[Hn]=((df&65280)>>8|(df&255)<<8)>>1}var Od=function(s,e,t){for(var i=s.length,n=0,r=new Ul(e);n<i;++n)s[n]&&++r[s[n]-1];var o=new Ul(e);for(n=1;n<e;++n)o[n]=o[n-1]+r[n-1]<<1;var a;if(t){a=new Ul(1<<e);var l=15-e;for(n=0;n<i;++n)if(s[n])for(var c=n<<4|s[n],h=e-s[n],d=o[s[n]-1]++<<h,u=d|(1<<h)-1;d<=u;++d)a[vz[d]>>l]=c}else for(a=new Ul(i),n=0;n<i;++n)s[n]&&(a[n]=vz[o[s[n]-1]++]>>15-s[n]);return a},Am=new Ss(288);for(var Hn=0;Hn<144;++Hn)Am[Hn]=8;for(var Hn=144;Hn<256;++Hn)Am[Hn]=9;for(var Hn=256;Hn<280;++Hn)Am[Hn]=7;for(var Hn=280;Hn<288;++Hn)Am[Hn]=8;var yS=new Ss(32);for(var Hn=0;Hn<32;++Hn)yS[Hn]=5;var kPe=Od(Am,9,0),NPe=Od(Am,9,1),DPe=Od(yS,5,0),FPe=Od(yS,5,1),KN=function(s){for(var e=s[0],t=1;t<s.length;++t)s[t]>e&&(e=s[t]);return e},ch=function(s,e,t){var i=e/8|0;return(s[i]|s[i+1]<<8)>>(e&7)&t},YN=function(s,e){var t=e/8|0;return(s[t]|s[t+1]<<8|s[t+2]<<16)>>(e&7)},m5=function(s){return(s+7)/8|0},g5=function(s,e,t){return(e==null||e<0)&&(e=0),(t==null||t>s.length)&&(t=s.length),new Ss(s.subarray(e,t))},VPe=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],$a=function(s,e,t){var i=new Error(e||VPe[s]);if(i.code=s,Error.captureStackTrace&&Error.captureStackTrace(i,$a),!t)throw i;return i},zPe=function(s,e,t,i){var n=s.length,r=i?i.length:0;if(!n||e.f&&!e.l)return t||new Ss(0);var o=!t,a=o||e.i!=2,l=e.i;o&&(t=new Ss(n*3));var c=function(zt){var ke=t.length;if(zt>ke){var Z=new Ss(Math.max(ke*2,zt));Z.set(t),t=Z}},h=e.f||0,d=e.p||0,u=e.b||0,f=e.l,m=e.d,g=e.m,A=e.n,y=n*8;do{if(!f){h=ch(s,d,1);var b=ch(s,d+1,3);if(d+=3,b)if(b==1)f=NPe,m=FPe,g=9,A=5;else if(b==2){var C=ch(s,d,31)+257,S=ch(s,d+10,15)+4,M=C+ch(s,d+5,31)+1;d+=14;for(var L=new Ss(M),w=new Ss(19),E=0;E<S;++E)w[bz[E]]=ch(s,d+E*3,7);d+=S*3;for(var B=KN(w),P=(1<<B)-1,k=Od(w,B,1),E=0;E<M;){var X=k[ch(s,d,P)];d+=X&15;var x=X>>4;if(x<16)L[E++]=x;else{var F=0,H=0;for(x==16?(H=3+ch(s,d,3),d+=2,F=L[E-1]):x==17?(H=3+ch(s,d,7),d+=3):x==18&&(H=11+ch(s,d,127),d+=7);H--;)L[E++]=F}}var W=L.subarray(0,C),se=L.subarray(C);g=KN(W),A=KN(se),f=Od(W,g,1),m=Od(se,A,1)}else $a(1);else{var x=m5(d)+4,v=s[x-4]|s[x-3]<<8,_=x+v;if(_>n){l&&$a(0);break}a&&c(u+v),t.set(s.subarray(x,_),u),e.b=u+=v,e.p=d=_*8,e.f=h;continue}if(d>y){l&&$a(0);break}}a&&c(u+131072);for(var de=(1<<g)-1,be=(1<<A)-1,Pe=d;;Pe=d){var F=f[YN(s,d)&de],Oe=F>>4;if(d+=F&15,d>y){l&&$a(0);break}if(F||$a(2),Oe<256)t[u++]=Oe;else if(Oe==256){Pe=d,f=null;break}else{var ae=Oe-254;if(Oe>264){var E=Oe-257,Ae=xP[E];ae=ch(s,d,(1<<Ae)-1)+Wre[E],d+=Ae}var Se=m[YN(s,d)&be],Le=Se>>4;Se||$a(3),d+=Se&15;var se=GPe[Le];if(Le>3){var Ae=vP[Le];se+=YN(s,d)&(1<<Ae)-1,d+=Ae}if(d>y){l&&$a(0);break}a&&c(u+131072);var st=u+ae;if(u<se){var ot=r-se,Ct=Math.min(se,st);for(ot+u<0&&$a(3);u<Ct;++u)t[u]=i[ot+u]}for(;u<st;++u)t[u]=t[u-se]}}e.l=f,e.p=Pe,e.b=u,e.f=h,f&&(h=1,e.m=g,e.d=m,e.n=A)}while(!h);return u!=t.length&&o?g5(t,0,u):t.subarray(0,u)},Lu=function(s,e,t){t<<=e&7;var i=e/8|0;s[i]|=t,s[i+1]|=t>>8},w_=function(s,e,t){t<<=e&7;var i=e/8|0;s[i]|=t,s[i+1]|=t>>8,s[i+2]|=t>>16},JN=function(s,e){for(var t=[],i=0;i<s.length;++i)s[i]&&t.push({s:i,f:s[i]});var n=t.length,r=t.slice();if(!n)return{t:Kre,l:0};if(n==1){var o=new Ss(t[0].s+1);return o[t[0].s]=1,{t:o,l:1}}t.sort(function(_,C){return _.f-C.f}),t.push({s:-1,f:25001});var a=t[0],l=t[1],c=0,h=1,d=2;for(t[0]={s:-1,f:a.f+l.f,l:a,r:l};h!=n-1;)a=t[t[c].f<t[d].f?c++:d++],l=t[c!=h&&t[c].f<t[d].f?c++:d++],t[h++]={s:-1,f:a.f+l.f,l:a,r:l};for(var u=r[0].s,i=1;i<n;++i)r[i].s>u&&(u=r[i].s);var f=new Ul(u+1),m=_z(t[h-1],f,0);if(m>e){var i=0,g=0,A=m-e,y=1<<A;for(r.sort(function(C,S){return f[S.s]-f[C.s]||C.f-S.f});i<n;++i){var b=r[i].s;if(f[b]>e)g+=y-(1<<m-f[b]),f[b]=e;else break}for(g>>=A;g>0;){var x=r[i].s;f[x]<e?g-=1<<e-f[x]++-1:++i}for(;i>=0&&g;--i){var v=r[i].s;f[v]==e&&(--f[v],++g)}m=e}return{t:new Ss(f),l:m}},_z=function(s,e,t){return s.s==-1?Math.max(_z(s.l,e,t+1),_z(s.r,e,t+1)):e[s.s]=t},IK=function(s){for(var e=s.length;e&&!s[--e];);for(var t=new Ul(++e),i=0,n=s[0],r=1,o=function(l){t[i++]=l},a=1;a<=e;++a)if(s[a]==n&&a!=e)++r;else{if(!n&&r>2){for(;r>138;r-=138)o(32754);r>2&&(o(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(o(n),--r;r>6;r-=6)o(8304);r>2&&(o(r-3<<5|8208),r=0)}for(;r--;)o(n);r=1,n=s[a]}return{c:t.subarray(0,i),n:e}},S_=function(s,e){for(var t=0,i=0;i<e.length;++i)t+=s[i]*e[i];return t},Qre=function(s,e,t){var i=t.length,n=m5(e+2);s[n]=i&255,s[n+1]=i>>8,s[n+2]=s[n]^255,s[n+3]=s[n+1]^255;for(var r=0;r<i;++r)s[n+r+4]=t[r];return(n+4+i)*8},TK=function(s,e,t,i,n,r,o,a,l,c,h){Lu(e,h++,t),++n[256];for(var d=JN(n,15),u=d.t,f=d.l,m=JN(r,15),g=m.t,A=m.l,y=IK(u),b=y.c,x=y.n,v=IK(g),_=v.c,C=v.n,S=new Ul(19),M=0;M<b.length;++M)++S[b[M]&31];for(var M=0;M<_.length;++M)++S[_[M]&31];for(var L=JN(S,7),w=L.t,E=L.l,B=19;B>4&&!w[bz[B-1]];--B);var P=c+5<<3,k=S_(n,Am)+S_(r,yS)+o,X=S_(n,u)+S_(r,g)+o+14+3*B+S_(S,w)+2*S[16]+3*S[17]+7*S[18];if(l>=0&&P<=k&&P<=X)return Qre(e,h,s.subarray(l,l+c));var F,H,W,se;if(Lu(e,h,1+(X<k)),h+=2,X<k){F=Od(u,f,0),H=u,W=Od(g,A,0),se=g;var de=Od(w,E,0);Lu(e,h,x-257),Lu(e,h+5,C-1),Lu(e,h+10,B-4),h+=14;for(var M=0;M<B;++M)Lu(e,h+3*M,w[bz[M]]);h+=3*B;for(var be=[b,_],Pe=0;Pe<2;++Pe)for(var Oe=be[Pe],M=0;M<Oe.length;++M){var ae=Oe[M]&31;Lu(e,h,de[ae]),h+=w[ae],ae>15&&(Lu(e,h,Oe[M]>>5&127),h+=Oe[M]>>12)}}else F=kPe,H=Am,W=DPe,se=yS;for(var M=0;M<a;++M){var Ae=i[M];if(Ae>255){var ae=Ae>>18&31;w_(e,h,F[ae+257]),h+=H[ae+257],ae>7&&(Lu(e,h,Ae>>23&31),h+=xP[ae]);var Se=Ae&31;w_(e,h,W[Se]),h+=se[Se],Se>3&&(w_(e,h,Ae>>5&8191),h+=vP[Se])}else w_(e,h,F[Ae]),h+=H[Ae]}return w_(e,h,F[256]),h+H[256]},UPe=new f5([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Kre=new Ss(0),XPe=function(s,e,t,i,n,r){var o=r.z||s.length,a=new Ss(i+o+5*(1+Math.ceil(o/7e3))+n),l=a.subarray(i,a.length-n),c=r.l,h=(r.r||0)&7;if(e){h&&(l[0]=r.r>>3);for(var d=UPe[e-1],u=d>>13,f=d&8191,m=(1<<t)-1,g=r.p||new Ul(32768),A=r.h||new Ul(m+1),y=Math.ceil(t/3),b=2*y,x=function(Ke){return(s[Ke]^s[Ke+1]<<y^s[Ke+2]<<b)&m},v=new f5(25e3),_=new Ul(288),C=new Ul(32),S=0,M=0,L=r.i||0,w=0,E=r.w||0,B=0;L+2<o;++L){var P=x(L),k=L&32767,X=A[P];if(g[k]=X,A[P]=k,E<=L){var F=o-L;if((S>7e3||w>24576)&&(F>423||!c)){h=TK(s,l,0,v,_,C,M,w,B,L-B,h),w=S=M=0,B=L;for(var H=0;H<286;++H)_[H]=0;for(var H=0;H<30;++H)C[H]=0}var W=2,se=0,de=f,be=k-X&32767;if(F>2&&P==x(L-be))for(var Pe=Math.min(u,F)-1,Oe=Math.min(32767,L),ae=Math.min(258,F);be<=Oe&&--de&&k!=X;){if(s[L+W]==s[L+W-be]){for(var Ae=0;Ae<ae&&s[L+Ae]==s[L+Ae-be];++Ae);if(Ae>W){if(W=Ae,se=be,Ae>Pe)break;for(var Se=Math.min(be,Ae-2),Le=0,H=0;H<Se;++H){var st=L-be+H&32767,ot=g[st],Ct=st-ot&32767;Ct>Le&&(Le=Ct,X=st)}}}k=X,X=g[k],be+=k-X&32767}if(se){v[w++]=268435456|xz[W]<<18|MK[se];var zt=xz[W]&31,ke=MK[se]&31;M+=xP[zt]+vP[ke],++_[257+zt],++C[ke],E=L+W,++S}else v[w++]=s[L],++_[s[L]]}}for(L=Math.max(L,E);L<o;++L)v[w++]=s[L],++_[s[L]];h=TK(s,l,c,v,_,C,M,w,B,L-B,h),c||(r.r=h&7|l[h/8|0]<<3,h-=7,r.h=A,r.p=g,r.i=L,r.w=E)}else{for(var L=r.w||0;L<o+c;L+=65535){var Z=L+65535;Z>=o&&(l[h/8|0]=c,Z=o),h=Qre(l,h+1,s.subarray(L,Z))}r.i=o}return g5(a,0,i+m5(h)+n)},OPe=function(){for(var s=new Int32Array(256),e=0;e<256;++e){for(var t=e,i=9;--i;)t=(t&1&&-306674912)^t>>>1;s[e]=t}return s}(),ZPe=function(){var s=-1;return{p:function(e){for(var t=s,i=0;i<e.length;++i)t=OPe[t&255^e[i]]^t>>>8;s=t},d:function(){return~s}}},WPe=function(s,e,t,i,n){if(!n&&(n={l:1},e.dictionary)){var r=e.dictionary.subarray(-32768),o=new Ss(r.length+s.length);o.set(r),o.set(s,r.length),s=o,n.w=r.length}return XPe(s,e.level==null?6:e.level,e.mem==null?n.l?Math.ceil(Math.max(8,Math.min(13,Math.log(s.length)))*1.5):20:12+e.mem,t,i,n)},Yre=function(s,e){var t={};for(var i in s)t[i]=s[i];for(var i in e)t[i]=e[i];return t},po=function(s,e,t){for(;t;++e)s[e]=t,t>>>=8},HPe=function(s,e){return((s[0]&15)!=8||s[0]>>4>7||(s[0]<<8|s[1])%31)&&$a(6,"invalid zlib data"),(s[1]>>5&1)==+!e&&$a(6,"invalid zlib data: "+(s[1]&32?"need":"unexpected")+" dictionary"),(s[1]>>3&4)+2};function QPe(s,e){return WPe(s,e||{},0,0)}function yC(s,e){return zPe(s.subarray(HPe(s,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}var Jre=function(s,e,t,i){for(var n in s){var r=s[n],o=e+n,a=i;Array.isArray(r)&&(a=Yre(i,r[1]),r=r[0]),r instanceof Ss?t[o]=[r,a]:(t[o+="/"]=[new Ss(0),a],Jre(r,o,t,i))}},EK=typeof TextEncoder<"u"&&new TextEncoder,KPe=typeof TextDecoder<"u"&&new TextDecoder,YPe=0;try{KPe.decode(Kre,{stream:!0}),YPe=1}catch{}function d2(s,e){if(e){for(var t=new Ss(s.length),i=0;i<s.length;++i)t[i]=s.charCodeAt(i);return t}if(EK)return EK.encode(s);for(var n=s.length,r=new Ss(s.length+(s.length>>1)),o=0,a=function(h){r[o++]=h},i=0;i<n;++i){if(o+5>r.length){var l=new Ss(o+8+(n-i<<1));l.set(r),r=l}var c=s.charCodeAt(i);c<128||e?a(c):c<2048?(a(192|c>>6),a(128|c&63)):c>55295&&c<57344?(c=65536+(c&1047552)|s.charCodeAt(++i)&1023,a(240|c>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|c&63)):(a(224|c>>12),a(128|c>>6&63),a(128|c&63))}return g5(r,0,o)}var Cz=function(s){var e=0;if(s)for(var t in s){var i=s[t].length;i>65535&&$a(9),e+=i+4}return e},RK=function(s,e,t,i,n,r,o,a){var l=i.length,c=t.extra,h=a&&a.length,d=Cz(c);po(s,e,o!=null?33639248:67324752),e+=4,o!=null&&(s[e++]=20,s[e++]=t.os),s[e]=20,e+=2,s[e++]=t.flag<<1|(r<0&&8),s[e++]=n&&8,s[e++]=t.compression&255,s[e++]=t.compression>>8;var u=new Date(t.mtime==null?Date.now():t.mtime),f=u.getFullYear()-1980;if((f<0||f>119)&&$a(10),po(s,e,f<<25|u.getMonth()+1<<21|u.getDate()<<16|u.getHours()<<11|u.getMinutes()<<5|u.getSeconds()>>1),e+=4,r!=-1&&(po(s,e,t.crc),po(s,e+4,r<0?-r-2:r),po(s,e+8,t.size)),po(s,e+12,l),po(s,e+14,d),e+=16,o!=null&&(po(s,e,h),po(s,e+6,t.attrs),po(s,e+10,o),e+=14),s.set(i,e),e+=l,d)for(var m in c){var g=c[m],A=g.length;po(s,e,+m),po(s,e+2,A),s.set(g,e+4),e+=4+A}return h&&(s.set(a,e),e+=h),e},JPe=function(s,e,t,i,n){po(s,e,101010256),po(s,e+8,t),po(s,e+10,t),po(s,e+12,i),po(s,e+16,n)};function jPe(s,e){e||(e={});var t={},i=[];Jre(s,"",t,e);var n=0,r=0;for(var o in t){var a=t[o],l=a[0],c=a[1],h=c.level==0?0:8,d=d2(o),u=d.length,f=c.comment,m=f&&d2(f),g=m&&m.length,A=Cz(c.extra);u>65535&&$a(11);var y=h?QPe(l,c):l,b=y.length,x=ZPe();x.p(l),i.push(Yre(c,{size:l.length,crc:x.d(),c:y,f:d,m,u:u!=o.length||m&&f.length!=g,o:n,compression:h})),n+=30+u+A+b,r+=76+2*(u+A)+(g||0)+b}for(var v=new Ss(r+22),_=n,C=r-n,S=0;S<i.length;++S){var d=i[S];RK(v,d.o,d,d.f,d.u,d.c.length);var M=30+d.f.length+Cz(d.extra);v.set(d.c,d.o+M),RK(v,n,d,d.f,d.u,d.c.length,d.o,d.m),n+=16+M+(d.m?d.m.length:0)}return JPe(v,n,i.length,C,_),v}class bS extends oX{constructor(e){super(e),this.type=Wi}parse(e){const L=Math.pow(2.7182818,2.2);function w(R,G){let N=0;for(let q=0;q<65536;++q)(q==0||R[q>>3]&1<<(q&7))&&(G[N++]=q);const V=N-1;for(;N<65536;)G[N++]=0;return V}function E(R){for(let G=0;G<16384;G++)R[G]={},R[G].len=0,R[G].lit=0,R[G].p=null}const B={l:0,c:0,lc:0};function P(R,G,N,V,q){for(;N<R;)G=G<<8|kt(V,q),N+=8;N-=R,B.l=G>>N&(1<<R)-1,B.c=G,B.lc=N}const k=new Array(59);function X(R){for(let N=0;N<=58;++N)k[N]=0;for(let N=0;N<65537;++N)k[R[N]]+=1;let G=0;for(let N=58;N>0;--N){const V=G+k[N]>>1;k[N]=G,G=V}for(let N=0;N<65537;++N){const V=R[N];V>0&&(R[N]=V|k[V]++<<6)}}function F(R,G,N,V,q,j){const ue=G;let Ce=0,xe=0;for(;V<=q;V++){if(ue.value-G.value>N)return!1;P(6,Ce,xe,R,ue);const ve=B.l;if(Ce=B.c,xe=B.lc,j[V]=ve,ve==63){if(ue.value-G.value>N)throw new Error("Something wrong with hufUnpackEncTable");P(8,Ce,xe,R,ue);let pe=B.l+6;if(Ce=B.c,xe=B.lc,V+pe>q+1)throw new Error("Something wrong with hufUnpackEncTable");for(;pe--;)j[V++]=0;V--}else if(ve>=59){let pe=ve-59+2;if(V+pe>q+1)throw new Error("Something wrong with hufUnpackEncTable");for(;pe--;)j[V++]=0;V--}}X(j)}function H(R){return R&63}function W(R){return R>>6}function se(R,G,N,V){for(;G<=N;G++){const q=W(R[G]),j=H(R[G]);if(q>>j)throw new Error("Invalid table entry");if(j>14){const ue=V[q>>j-14];if(ue.len)throw new Error("Invalid table entry");if(ue.lit++,ue.p){const Ce=ue.p;ue.p=new Array(ue.lit);for(let xe=0;xe<ue.lit-1;++xe)ue.p[xe]=Ce[xe]}else ue.p=new Array(1);ue.p[ue.lit-1]=G}else if(j){let ue=0;for(let Ce=1<<14-j;Ce>0;Ce--){const xe=V[(q<<14-j)+ue];if(xe.len||xe.p)throw new Error("Invalid table entry");xe.len=j,xe.lit=G,ue++}}}return!0}const de={c:0,lc:0};function be(R,G,N,V){R=R<<8|kt(N,V),G+=8,de.c=R,de.lc=G}const Pe={c:0,lc:0};function Oe(R,G,N,V,q,j,ue,Ce,xe){if(R==G){V<8&&(be(N,V,q,j),N=de.c,V=de.lc),V-=8;let ve=N>>V;if(ve=new Uint8Array([ve])[0],Ce.value+ve>xe)return!1;const pe=ue[Ce.value-1];for(;ve-- >0;)ue[Ce.value++]=pe}else if(Ce.value<xe)ue[Ce.value++]=R;else return!1;Pe.c=N,Pe.lc=V}function ae(R){return R&65535}function Ae(R){const G=ae(R);return G>32767?G-65536:G}const Se={a:0,b:0};function Le(R,G){const N=Ae(R),q=Ae(G),j=N+(q&1)+(q>>1),ue=j,Ce=j-q;Se.a=ue,Se.b=Ce}function st(R,G){const N=ae(R),V=ae(G),q=N-(V>>1)&65535,j=V+q-32768&65535;Se.a=j,Se.b=q}function ot(R,G,N,V,q,j,ue){const Ce=ue<16384,xe=N>q?q:N;let ve=1,pe,Ze;for(;ve<=xe;)ve<<=1;for(ve>>=1,pe=ve,ve>>=1;ve>=1;){Ze=0;const Ye=Ze+j*(q-pe),qe=j*ve,wt=j*pe,He=V*ve,De=V*pe;let Nt,Dt,Fi,Ws;for(;Ze<=Ye;Ze+=wt){let xi=Ze;const Si=Ze+V*(N-pe);for(;xi<=Si;xi+=De){const Ai=xi+He,Bs=xi+qe,xs=Bs+He;Ce?(Le(R[xi+G],R[Bs+G]),Nt=Se.a,Fi=Se.b,Le(R[Ai+G],R[xs+G]),Dt=Se.a,Ws=Se.b,Le(Nt,Dt),R[xi+G]=Se.a,R[Ai+G]=Se.b,Le(Fi,Ws),R[Bs+G]=Se.a,R[xs+G]=Se.b):(st(R[xi+G],R[Bs+G]),Nt=Se.a,Fi=Se.b,st(R[Ai+G],R[xs+G]),Dt=Se.a,Ws=Se.b,st(Nt,Dt),R[xi+G]=Se.a,R[Ai+G]=Se.b,st(Fi,Ws),R[Bs+G]=Se.a,R[xs+G]=Se.b)}if(N&ve){const Ai=xi+qe;Ce?Le(R[xi+G],R[Ai+G]):st(R[xi+G],R[Ai+G]),Nt=Se.a,R[Ai+G]=Se.b,R[xi+G]=Nt}}if(q&ve){let xi=Ze;const Si=Ze+V*(N-pe);for(;xi<=Si;xi+=De){const Ai=xi+He;Ce?Le(R[xi+G],R[Ai+G]):st(R[xi+G],R[Ai+G]),Nt=Se.a,R[Ai+G]=Se.b,R[xi+G]=Nt}}pe=ve,ve>>=1}return Ze}function Ct(R,G,N,V,q,j,ue,Ce,xe){let ve=0,pe=0;const Ze=ue,Ye=Math.trunc(V.value+(q+7)/8);for(;V.value<Ye;)for(be(ve,pe,N,V),ve=de.c,pe=de.lc;pe>=14;){const wt=ve>>pe-14&16383,He=G[wt];if(He.len)pe-=He.len,Oe(He.lit,j,ve,pe,N,V,Ce,xe,Ze),ve=Pe.c,pe=Pe.lc;else{if(!He.p)throw new Error("hufDecode issues");let De;for(De=0;De<He.lit;De++){const Nt=H(R[He.p[De]]);for(;pe<Nt&&V.value<Ye;)be(ve,pe,N,V),ve=de.c,pe=de.lc;if(pe>=Nt&&W(R[He.p[De]])==(ve>>pe-Nt&(1<<Nt)-1)){pe-=Nt,Oe(He.p[De],j,ve,pe,N,V,Ce,xe,Ze),ve=Pe.c,pe=Pe.lc;break}}if(De==He.lit)throw new Error("hufDecode issues")}}const qe=8-q&7;for(ve>>=qe,pe-=qe;pe>0;){const wt=G[ve<<14-pe&16383];if(wt.len)pe-=wt.len,Oe(wt.lit,j,ve,pe,N,V,Ce,xe,Ze),ve=Pe.c,pe=Pe.lc;else throw new Error("hufDecode issues")}return!0}function zt(R,G,N,V,q,j){const ue={value:0},Ce=N.value,xe=at(G,N),ve=at(G,N);N.value+=4;const pe=at(G,N);if(N.value+=4,xe<0||xe>=65537||ve<0||ve>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Ze=new Array(65537),Ye=new Array(16384);E(Ye);const qe=V-(N.value-Ce);if(F(R,N,qe,xe,ve,Ze),pe>8*(V-(N.value-Ce)))throw new Error("Something wrong with hufUncompress");se(Ze,xe,ve,Ye),Ct(Ze,Ye,R,N,pe,ve,j,q,ue)}function ke(R,G,N){for(let V=0;V<N;++V)G[V]=R[G[V]]}function Z(R){for(let G=1;G<R.length;G++){const N=R[G-1]+R[G]-128;R[G]=N}}function Ke(R,G){let N=0,V=Math.floor((R.length+1)/2),q=0;const j=R.length-1;for(;!(q>j||(G[q++]=R[N++],q>j));)G[q++]=R[V++]}function je(R){let G=R.byteLength;const N=new Array;let V=0;const q=new DataView(R);for(;G>0;){const j=q.getInt8(V++);if(j<0){const ue=-j;G-=ue+1;for(let Ce=0;Ce<ue;Ce++)N.push(q.getUint8(V++))}else{const ue=j;G-=2;const Ce=q.getUint8(V++);for(let xe=0;xe<ue+1;xe++)N.push(Ce)}}return N}function We(R,G,N,V,q,j){let ue=new DataView(j.buffer);const Ce=N[R.idx[0]].width,xe=N[R.idx[0]].height,ve=3,pe=Math.floor(Ce/8),Ze=Math.ceil(Ce/8),Ye=Math.ceil(xe/8),qe=Ce-(Ze-1)*8,wt=xe-(Ye-1)*8,He={value:0},De=new Array(ve),Nt=new Array(ve),Dt=new Array(ve),Fi=new Array(ve),Ws=new Array(ve);for(let Si=0;Si<ve;++Si)Ws[Si]=G[R.idx[Si]],De[Si]=Si<1?0:De[Si-1]+Ze*Ye,Nt[Si]=new Float32Array(64),Dt[Si]=new Uint16Array(64),Fi[Si]=new Uint16Array(Ze*64);for(let Si=0;Si<Ye;++Si){let Ai=8;Si==Ye-1&&(Ai=wt);let Bs=8;for(let fi=0;fi<Ze;++fi){fi==Ze-1&&(Bs=qe);for(let an=0;an<ve;++an)Dt[an].fill(0),Dt[an][0]=q[De[an]++],nt(He,V,Dt[an]),Tt(Dt[an],Nt[an]),mt(Nt[an]);O(Nt);for(let an=0;an<ve;++an)D(Nt[an],Fi[an],fi*64)}let xs=0;for(let fi=0;fi<ve;++fi){const an=N[R.idx[fi]].type;for(let qc=8*Si;qc<8*Si+Ai;++qc){xs=Ws[fi][qc];for(let Zp=0;Zp<pe;++Zp){const Jh=Zp*64+(qc&7)*8;ue.setUint16(xs+0*2*an,Fi[fi][Jh+0],!0),ue.setUint16(xs+1*2*an,Fi[fi][Jh+1],!0),ue.setUint16(xs+2*2*an,Fi[fi][Jh+2],!0),ue.setUint16(xs+3*2*an,Fi[fi][Jh+3],!0),ue.setUint16(xs+4*2*an,Fi[fi][Jh+4],!0),ue.setUint16(xs+5*2*an,Fi[fi][Jh+5],!0),ue.setUint16(xs+6*2*an,Fi[fi][Jh+6],!0),ue.setUint16(xs+7*2*an,Fi[fi][Jh+7],!0),xs+=8*2*an}}if(pe!=Ze)for(let qc=8*Si;qc<8*Si+Ai;++qc){const Zp=Ws[fi][qc]+8*pe*2*an,Jh=pe*64+(qc&7)*8;for(let rI=0;rI<Bs;++rI)ue.setUint16(Zp+rI*2*an,Fi[fi][Jh+rI],!0)}}}const xi=new Uint16Array(Ce);ue=new DataView(j.buffer);for(let Si=0;Si<ve;++Si){N[R.idx[Si]].decoded=!0;const Ai=N[R.idx[Si]].type;if(N[Si].type==2)for(let Bs=0;Bs<xe;++Bs){const xs=Ws[Si][Bs];for(let fi=0;fi<Ce;++fi)xi[fi]=ue.getUint16(xs+fi*2*Ai,!0);for(let fi=0;fi<Ce;++fi)ue.setFloat32(xs+fi*2*Ai,ie(xi[fi]),!0)}}}function nt(R,G,N){let V,q=1;for(;q<64;)V=G[R.value],V==65280?q=64:V>>8==255?q+=V&255:(N[q]=V,q++),R.value++}function Tt(R,G){G[0]=ie(R[0]),G[1]=ie(R[1]),G[2]=ie(R[5]),G[3]=ie(R[6]),G[4]=ie(R[14]),G[5]=ie(R[15]),G[6]=ie(R[27]),G[7]=ie(R[28]),G[8]=ie(R[2]),G[9]=ie(R[4]),G[10]=ie(R[7]),G[11]=ie(R[13]),G[12]=ie(R[16]),G[13]=ie(R[26]),G[14]=ie(R[29]),G[15]=ie(R[42]),G[16]=ie(R[3]),G[17]=ie(R[8]),G[18]=ie(R[12]),G[19]=ie(R[17]),G[20]=ie(R[25]),G[21]=ie(R[30]),G[22]=ie(R[41]),G[23]=ie(R[43]),G[24]=ie(R[9]),G[25]=ie(R[11]),G[26]=ie(R[18]),G[27]=ie(R[24]),G[28]=ie(R[31]),G[29]=ie(R[40]),G[30]=ie(R[44]),G[31]=ie(R[53]),G[32]=ie(R[10]),G[33]=ie(R[19]),G[34]=ie(R[23]),G[35]=ie(R[32]),G[36]=ie(R[39]),G[37]=ie(R[45]),G[38]=ie(R[52]),G[39]=ie(R[54]),G[40]=ie(R[20]),G[41]=ie(R[22]),G[42]=ie(R[33]),G[43]=ie(R[38]),G[44]=ie(R[46]),G[45]=ie(R[51]),G[46]=ie(R[55]),G[47]=ie(R[60]),G[48]=ie(R[21]),G[49]=ie(R[34]),G[50]=ie(R[37]),G[51]=ie(R[47]),G[52]=ie(R[50]),G[53]=ie(R[56]),G[54]=ie(R[59]),G[55]=ie(R[61]),G[56]=ie(R[35]),G[57]=ie(R[36]),G[58]=ie(R[48]),G[59]=ie(R[49]),G[60]=ie(R[57]),G[61]=ie(R[58]),G[62]=ie(R[62]),G[63]=ie(R[63])}function mt(R){const G=.5*Math.cos(.7853975),N=.5*Math.cos(3.14159/16),V=.5*Math.cos(3.14159/8),q=.5*Math.cos(3*3.14159/16),j=.5*Math.cos(5*3.14159/16),ue=.5*Math.cos(3*3.14159/8),Ce=.5*Math.cos(7*3.14159/16),xe=new Array(4),ve=new Array(4),pe=new Array(4),Ze=new Array(4);for(let Ye=0;Ye<8;++Ye){const qe=Ye*8;xe[0]=V*R[qe+2],xe[1]=ue*R[qe+2],xe[2]=V*R[qe+6],xe[3]=ue*R[qe+6],ve[0]=N*R[qe+1]+q*R[qe+3]+j*R[qe+5]+Ce*R[qe+7],ve[1]=q*R[qe+1]-Ce*R[qe+3]-N*R[qe+5]-j*R[qe+7],ve[2]=j*R[qe+1]-N*R[qe+3]+Ce*R[qe+5]+q*R[qe+7],ve[3]=Ce*R[qe+1]-j*R[qe+3]+q*R[qe+5]-N*R[qe+7],pe[0]=G*(R[qe+0]+R[qe+4]),pe[3]=G*(R[qe+0]-R[qe+4]),pe[1]=xe[0]+xe[3],pe[2]=xe[1]-xe[2],Ze[0]=pe[0]+pe[1],Ze[1]=pe[3]+pe[2],Ze[2]=pe[3]-pe[2],Ze[3]=pe[0]-pe[1],R[qe+0]=Ze[0]+ve[0],R[qe+1]=Ze[1]+ve[1],R[qe+2]=Ze[2]+ve[2],R[qe+3]=Ze[3]+ve[3],R[qe+4]=Ze[3]-ve[3],R[qe+5]=Ze[2]-ve[2],R[qe+6]=Ze[1]-ve[1],R[qe+7]=Ze[0]-ve[0]}for(let Ye=0;Ye<8;++Ye)xe[0]=V*R[16+Ye],xe[1]=ue*R[16+Ye],xe[2]=V*R[48+Ye],xe[3]=ue*R[48+Ye],ve[0]=N*R[8+Ye]+q*R[24+Ye]+j*R[40+Ye]+Ce*R[56+Ye],ve[1]=q*R[8+Ye]-Ce*R[24+Ye]-N*R[40+Ye]-j*R[56+Ye],ve[2]=j*R[8+Ye]-N*R[24+Ye]+Ce*R[40+Ye]+q*R[56+Ye],ve[3]=Ce*R[8+Ye]-j*R[24+Ye]+q*R[40+Ye]-N*R[56+Ye],pe[0]=G*(R[Ye]+R[32+Ye]),pe[3]=G*(R[Ye]-R[32+Ye]),pe[1]=xe[0]+xe[3],pe[2]=xe[1]-xe[2],Ze[0]=pe[0]+pe[1],Ze[1]=pe[3]+pe[2],Ze[2]=pe[3]-pe[2],Ze[3]=pe[0]-pe[1],R[0+Ye]=Ze[0]+ve[0],R[8+Ye]=Ze[1]+ve[1],R[16+Ye]=Ze[2]+ve[2],R[24+Ye]=Ze[3]+ve[3],R[32+Ye]=Ze[3]-ve[3],R[40+Ye]=Ze[2]-ve[2],R[48+Ye]=Ze[1]-ve[1],R[56+Ye]=Ze[0]-ve[0]}function O(R){for(let G=0;G<64;++G){const N=R[0][G],V=R[1][G],q=R[2][G];R[0][G]=N+1.5747*q,R[1][G]=N-.1873*V-.4682*q,R[2][G]=N+1.8556*V}}function D(R,G,N){for(let V=0;V<64;++V)G[N+V]=a0.toHalfFloat(he(R[V]))}function he(R){return R<=1?Math.sign(R)*Math.pow(Math.abs(R),2.2):Math.sign(R)*Math.pow(L,Math.abs(R)-1)}function Ee(R){return new DataView(R.array.buffer,R.offset.value,R.size)}function Ne(R){const G=R.viewer.buffer.slice(R.offset.value,R.offset.value+R.size),N=new Uint8Array(je(G)),V=new Uint8Array(N.length);return Z(N),Ke(N,V),new DataView(V.buffer)}function Re(R){const G=R.array.slice(R.offset.value,R.offset.value+R.size),N=yC(G),V=new Uint8Array(N.length);return Z(N),Ke(N,V),new DataView(V.buffer)}function yt(R){const G=R.viewer,N={value:R.offset.value},V=new Uint16Array(R.columns*R.lines*(R.inputChannels.length*R.type)),q=new Uint8Array(8192);let j=0;const ue=new Array(R.inputChannels.length);for(let wt=0,He=R.inputChannels.length;wt<He;wt++)ue[wt]={},ue[wt].start=j,ue[wt].end=ue[wt].start,ue[wt].nx=R.columns,ue[wt].ny=R.lines,ue[wt].size=R.type,j+=ue[wt].nx*ue[wt].ny*ue[wt].size;const Ce=Ue(G,N),xe=Ue(G,N);if(xe>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(Ce<=xe)for(let wt=0;wt<xe-Ce+1;wt++)q[wt+Ce]=jt(G,N);const ve=new Uint16Array(65536),pe=w(q,ve),Ze=at(G,N);zt(R.array,G,N,Ze,V,j);for(let wt=0;wt<R.inputChannels.length;++wt){const He=ue[wt];for(let De=0;De<ue[wt].size;++De)ot(V,He.start+De,He.nx,He.size,He.ny,He.nx*He.size,pe)}ke(ve,V,j);let Ye=0;const qe=new Uint8Array(V.buffer.byteLength);for(let wt=0;wt<R.lines;wt++)for(let He=0;He<R.inputChannels.length;He++){const De=ue[He],Nt=De.nx*De.size,Dt=new Uint8Array(V.buffer,De.end*2,Nt*2);qe.set(Dt,Ye),Ye+=Nt*2,De.end+=Nt}return new DataView(qe.buffer)}function et(R){const G=R.array.slice(R.offset.value,R.offset.value+R.size),N=yC(G),V=R.inputChannels.length*R.lines*R.columns*R.totalBytes,q=new ArrayBuffer(V),j=new DataView(q);let ue=0,Ce=0;const xe=new Array(4);for(let ve=0;ve<R.lines;ve++)for(let pe=0;pe<R.inputChannels.length;pe++){let Ze=0;switch(R.inputChannels[pe].pixelType){case 1:xe[0]=ue,xe[1]=xe[0]+R.columns,ue=xe[1]+R.columns;for(let qe=0;qe<R.columns;++qe){const wt=N[xe[0]++]<<8|N[xe[1]++];Ze+=wt,j.setUint16(Ce,Ze,!0),Ce+=2}break;case 2:xe[0]=ue,xe[1]=xe[0]+R.columns,xe[2]=xe[1]+R.columns,ue=xe[2]+R.columns;for(let qe=0;qe<R.columns;++qe){const wt=N[xe[0]++]<<24|N[xe[1]++]<<16|N[xe[2]++]<<8;Ze+=wt,j.setUint32(Ce,Ze,!0),Ce+=4}break}}return j}function ct(R){const G=R.viewer,N={value:R.offset.value},V=new Uint8Array(R.columns*R.lines*(R.inputChannels.length*R.type*2)),q={version:yi(G,N),unknownUncompressedSize:yi(G,N),unknownCompressedSize:yi(G,N),acCompressedSize:yi(G,N),dcCompressedSize:yi(G,N),rleCompressedSize:yi(G,N),rleUncompressedSize:yi(G,N),rleRawSize:yi(G,N),totalAcUncompressedCount:yi(G,N),totalDcUncompressedCount:yi(G,N),acCompression:yi(G,N)};if(q.version<2)throw new Error("EXRLoader.parse: "+mu.compression+" version "+q.version+" is unsupported");const j=new Array;let ue=Ue(G,N)-2;for(;ue>0;){const He=Jt(G.buffer,N),De=jt(G,N),Nt=De>>2&3,Dt=(De>>4)-1,Fi=new Int8Array([Dt])[0],Ws=jt(G,N);j.push({name:He,index:Fi,type:Ws,compression:Nt}),ue-=He.length+3}const Ce=mu.channels,xe=new Array(R.inputChannels.length);for(let He=0;He<R.inputChannels.length;++He){const De=xe[He]={},Nt=Ce[He];De.name=Nt.name,De.compression=0,De.decoded=!1,De.type=Nt.pixelType,De.pLinear=Nt.pLinear,De.width=R.columns,De.height=R.lines}const ve={idx:new Array(3)};for(let He=0;He<R.inputChannels.length;++He){const De=xe[He];for(let Nt=0;Nt<j.length;++Nt){const Dt=j[Nt];De.name==Dt.name&&(De.compression=Dt.compression,Dt.index>=0&&(ve.idx[Dt.index]=He),De.offset=He)}}let pe,Ze,Ye;if(q.acCompressedSize>0)switch(q.acCompression){case 0:pe=new Uint16Array(q.totalAcUncompressedCount),zt(R.array,G,N,q.acCompressedSize,pe,q.totalAcUncompressedCount);break;case 1:const He=R.array.slice(N.value,N.value+q.totalAcUncompressedCount),De=yC(He);pe=new Uint16Array(De.buffer),N.value+=q.totalAcUncompressedCount;break}if(q.dcCompressedSize>0){const He={array:R.array,offset:N,size:q.dcCompressedSize};Ze=new Uint16Array(Re(He).buffer),N.value+=q.dcCompressedSize}if(q.rleRawSize>0){const He=R.array.slice(N.value,N.value+q.rleCompressedSize),De=yC(He);Ye=je(De.buffer),N.value+=q.rleCompressedSize}let qe=0;const wt=new Array(xe.length);for(let He=0;He<wt.length;++He)wt[He]=new Array;for(let He=0;He<R.lines;++He)for(let De=0;De<xe.length;++De)wt[De].push(qe),qe+=xe[De].width*R.type*2;We(ve,wt,xe,pe,Ze,V);for(let He=0;He<xe.length;++He){const De=xe[He];if(!De.decoded)switch(De.compression){case 2:let Nt=0,Dt=0;for(let Fi=0;Fi<R.lines;++Fi){let Ws=wt[He][Nt];for(let xi=0;xi<De.width;++xi){for(let Si=0;Si<2*De.type;++Si)V[Ws++]=Ye[Dt+Si*De.width*De.height];Dt++}Nt++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(V.buffer)}function Jt(R,G){const N=new Uint8Array(R);let V=0;for(;N[G.value+V]!=0;)V+=1;const q=new TextDecoder().decode(N.slice(G.value,G.value+V));return G.value=G.value+V+1,q}function Ge(R,G,N){const V=new TextDecoder().decode(new Uint8Array(R).slice(G.value,G.value+N));return G.value=G.value+N,V}function At(R,G){const N=Lt(R,G),V=at(R,G);return[N,V]}function Kt(R,G){const N=at(R,G),V=at(R,G);return[N,V]}function Lt(R,G){const N=R.getInt32(G.value,!0);return G.value=G.value+4,N}function at(R,G){const N=R.getUint32(G.value,!0);return G.value=G.value+4,N}function kt(R,G){const N=R[G.value];return G.value=G.value+1,N}function jt(R,G){const N=R.getUint8(G.value);return G.value=G.value+1,N}const yi=function(R,G){let N;return"getBigInt64"in DataView.prototype?N=Number(R.getBigInt64(G.value,!0)):N=R.getUint32(G.value+4,!0)+Number(R.getUint32(G.value,!0)<<32),G.value+=8,N};function te(R,G){const N=R.getFloat32(G.value,!0);return G.value+=4,N}function xt(R,G){return a0.toHalfFloat(te(R,G))}function ie(R){const G=(R&31744)>>10,N=R&1023;return(R>>15?-1:1)*(G?G===31?N?NaN:1/0:Math.pow(2,G-15)*(1+N/1024):6103515625e-14*(N/1024))}function Ue(R,G){const N=R.getUint16(G.value,!0);return G.value+=2,N}function bt(R,G){return ie(Ue(R,G))}function vt(R,G,N,V){const q=N.value,j=[];for(;N.value<q+V-1;){const ue=Jt(G,N),Ce=Lt(R,N),xe=jt(R,N);N.value+=3;const ve=Lt(R,N),pe=Lt(R,N);j.push({name:ue,pixelType:Ce,pLinear:xe,xSampling:ve,ySampling:pe})}return N.value+=1,j}function Di(R,G){const N=te(R,G),V=te(R,G),q=te(R,G),j=te(R,G),ue=te(R,G),Ce=te(R,G),xe=te(R,G),ve=te(R,G);return{redX:N,redY:V,greenX:q,greenY:j,blueX:ue,blueY:Ce,whiteX:xe,whiteY:ve}}function bs(R,G){const N=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],V=jt(R,G);return N[V]}function Vo(R,G){const N=Lt(R,G),V=Lt(R,G),q=Lt(R,G),j=Lt(R,G);return{xMin:N,yMin:V,xMax:q,yMax:j}}function Ki(R,G){const N=["INCREASING_Y","DECREASING_Y","RANDOM_Y"],V=jt(R,G);return N[V]}function zo(R,G){const N=["ENVMAP_LATLONG","ENVMAP_CUBE"],V=jt(R,G);return N[V]}function jc(R,G){const N=["ONE_LEVEL","MIPMAP_LEVELS","RIPMAP_LEVELS"],V=["ROUND_DOWN","ROUND_UP"],q=at(R,G),j=at(R,G),ue=jt(R,G);return{xSize:q,ySize:j,levelMode:N[ue&15],roundingMode:V[ue>>4]}}function $M(R,G){const N=te(R,G),V=te(R,G);return[N,V]}function eI(R,G){const N=te(R,G),V=te(R,G),q=te(R,G);return[N,V,q]}function fu(R,G,N,V,q){if(V==="string"||V==="stringvector"||V==="iccProfile")return Ge(G,N,q);if(V==="chlist")return vt(R,G,N,q);if(V==="chromaticities")return Di(R,N);if(V==="compression")return bs(R,N);if(V==="box2i")return Vo(R,N);if(V==="envmap")return zo(R,N);if(V==="tiledesc")return jc(R,N);if(V==="lineOrder")return Ki(R,N);if(V==="float")return te(R,N);if(V==="v2f")return $M(R,N);if(V==="v3f")return eI(R,N);if(V==="int")return Lt(R,N);if(V==="rational")return At(R,N);if(V==="timecode")return Kt(R,N);if(V==="preview")return N.value+=q,"skipped";N.value+=q}function kv(R,G){const N=Math.log2(R);return G=="ROUND_DOWN"?Math.floor(N):Math.ceil(N)}function tI(R,G,N){let V=0;switch(R.levelMode){case"ONE_LEVEL":V=1;break;case"MIPMAP_LEVELS":V=kv(Math.max(G,N),R.roundingMode)+1;break;case"RIPMAP_LEVELS":throw new Error("THREE.EXRLoader: RIPMAP_LEVELS tiles currently unsupported.")}return V}function Nv(R,G,N,V){const q=new Array(R);for(let j=0;j<R;j++){const ue=1<<j;let Ce=G/ue|0;V=="ROUND_UP"&&Ce*ue<G&&(Ce+=1);const xe=Math.max(Ce,1);q[j]=(xe+N-1)/N|0}return q}function QA(){const R=this,G=R.offset,N={value:0};for(let V=0;V<R.tileCount;V++){const q=Lt(R.viewer,G),j=Lt(R.viewer,G);G.value+=8,R.size=at(R.viewer,G);const ue=q*R.blockWidth,Ce=j*R.blockHeight;R.columns=ue+R.blockWidth>R.width?R.width-ue:R.blockWidth,R.lines=Ce+R.blockHeight>R.height?R.height-Ce:R.blockHeight;const xe=R.columns*R.totalBytes,pe=R.size<R.lines*xe?R.uncompress(R):Ee(R);G.value+=R.size;for(let Ze=0;Ze<R.lines;Ze++){const Ye=Ze*R.columns*R.totalBytes;for(let qe=0;qe<R.inputChannels.length;qe++){const wt=mu.channels[qe].name,He=R.channelByteOffsets[wt]*R.columns,De=R.decodeChannels[wt];if(De===void 0)continue;N.value=Ye+He;const Nt=(R.height-(1+Ce+Ze))*R.outLineWidth;for(let Dt=0;Dt<R.columns;Dt++){const Fi=Nt+(Dt+ue)*R.outputChannels+De;R.byteArray[Fi]=R.getter(pe,N)}}}}}function iI(){const R=this,G=R.offset,N={value:0};for(let V=0;V<R.height/R.blockHeight;V++){const q=Lt(R.viewer,G)-mu.dataWindow.yMin;R.size=at(R.viewer,G),R.lines=q+R.blockHeight>R.height?R.height-q:R.blockHeight;const j=R.columns*R.totalBytes,Ce=R.size<R.lines*j?R.uncompress(R):Ee(R);G.value+=R.size;for(let xe=0;xe<R.blockHeight;xe++){const ve=V*R.blockHeight,pe=xe+R.scanOrder(ve);if(pe>=R.height)continue;const Ze=xe*j,Ye=(R.height-1-pe)*R.outLineWidth;for(let qe=0;qe<R.inputChannels.length;qe++){const wt=mu.channels[qe].name,He=R.channelByteOffsets[wt]*R.columns,De=R.decodeChannels[wt];if(De!==void 0){N.value=Ze+He;for(let Nt=0;Nt<R.columns;Nt++){const Dt=Ye+Nt*R.outputChannels+De;R.byteArray[Dt]=R.getter(Ce,N)}}}}}}function KA(R,G,N){const V={};if(R.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");V.version=R.getUint8(4);const q=R.getUint8(5);V.spec={singleTile:!!(q&2),longName:!!(q&4),deepFormat:!!(q&8),multiPart:!!(q&16)},N.value=8;let j=!0;for(;j;){const ue=Jt(G,N);if(ue==0)j=!1;else{const Ce=Jt(G,N),xe=at(R,N),ve=fu(R,G,N,Ce,xe);ve===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${Ce}'.`):V[ue]=ve}}if(q&-7)throw console.error("THREE.EXRHeader:",V),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return V}function nI(R,G,N,V,q){const j={size:0,viewer:G,array:N,offset:V,width:R.dataWindow.xMax-R.dataWindow.xMin+1,height:R.dataWindow.yMax-R.dataWindow.yMin+1,inputChannels:R.channels,channelByteOffsets:{},scanOrder:null,totalBytes:null,columns:null,lines:null,type:null,uncompress:null,getter:null,format:null,colorSpace:Ji};switch(R.compression){case"NO_COMPRESSION":j.blockHeight=1,j.uncompress=Ee;break;case"RLE_COMPRESSION":j.blockHeight=1,j.uncompress=Ne;break;case"ZIPS_COMPRESSION":j.blockHeight=1,j.uncompress=Re;break;case"ZIP_COMPRESSION":j.blockHeight=16,j.uncompress=Re;break;case"PIZ_COMPRESSION":j.blockHeight=32,j.uncompress=yt;break;case"PXR24_COMPRESSION":j.blockHeight=16,j.uncompress=et;break;case"DWAA_COMPRESSION":j.blockHeight=32,j.uncompress=ct;break;case"DWAB_COMPRESSION":j.blockHeight=256,j.uncompress=ct;break;default:throw new Error("EXRLoader.parse: "+R.compression+" is unsupported")}const ue={};for(const pe of R.channels)switch(pe.name){case"Y":case"R":case"G":case"B":case"A":ue[pe.name]=!0,j.type=pe.pixelType}let Ce=!1;if(ue.R&&ue.G&&ue.B)Ce=!ue.A,j.outputChannels=4,j.decodeChannels={R:0,G:1,B:2,A:3};else if(ue.Y)j.outputChannels=1,j.decodeChannels={Y:0};else throw new Error("EXRLoader.parse: file contains unsupported data channels.");if(j.type==1)switch(q){case $i:j.getter=bt;break;case Wi:j.getter=Ue;break}else if(j.type==2)switch(q){case $i:j.getter=te;break;case Wi:j.getter=xt}else throw new Error("EXRLoader.parse: unsupported pixelType "+j.type+" for "+R.compression+".");j.columns=j.width;const xe=j.width*j.height*j.outputChannels;switch(q){case $i:j.byteArray=new Float32Array(xe),Ce&&j.byteArray.fill(1,0,xe);break;case Wi:j.byteArray=new Uint16Array(xe),Ce&&j.byteArray.fill(15360,0,xe);break;default:console.error("THREE.EXRLoader: unsupported type: ",q);break}let ve=0;for(const pe of R.channels)j.decodeChannels[pe.name]!==void 0&&(j.channelByteOffsets[pe.name]=ve),ve+=pe.pixelType*2;if(j.totalBytes=ve,j.outLineWidth=j.width*j.outputChannels,R.lineOrder==="INCREASING_Y"?j.scanOrder=pe=>pe:j.scanOrder=pe=>j.height-1-pe,j.outputChannels==4?(j.format=bi,j.colorSpace=Ji):(j.format=Vl,j.colorSpace=Fr),R.spec.singleTile){j.blockHeight=R.tiles.ySize,j.blockWidth=R.tiles.xSize;const pe=tI(R.tiles,j.width,j.height),Ze=Nv(pe,j.width,R.tiles.xSize,R.tiles.roundingMode),Ye=Nv(pe,j.height,R.tiles.ySize,R.tiles.roundingMode);j.tileCount=Ze[0]*Ye[0];for(let qe=0;qe<pe;qe++)for(let wt=0;wt<Ye[qe];wt++)for(let He=0;He<Ze[qe];He++)yi(G,V);j.decode=QA.bind(j)}else{j.blockWidth=j.width;const pe=Math.ceil(j.height/j.blockHeight);for(let Ze=0;Ze<pe;Ze++)yi(G,V);j.decode=iI.bind(j)}return j}const Dv={value:0},sI=new DataView(e),pG=new Uint8Array(e),mu=KA(sI,e,Dv),z=nI(mu,sI,pG,Dv,this.type);return z.decode(),{header:mu,width:z.width,height:z.height,data:z.byteArray,format:z.format,colorSpace:z.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,i,n){function r(o,a){o.colorSpace=a.colorSpace,o.minFilter=Ot,o.magFilter=Ot,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,a)}return super.load(e,r,i,n)}}const qPe=Object.freeze(Object.defineProperty({__proto__:null,EXRLoader:bS},Symbol.toStringTag,{value:"Module"}));class u2 extends oX{constructor(e){super(e),this.type=Wi}parse(e){const o=function(M,L){switch(M){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(L||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(L||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(L||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(L||""))}},h=`
`,d=function(M,L,w){L=L||1024;let B=M.pos,P=-1,k=0,X="",F=String.fromCharCode.apply(null,new Uint16Array(M.subarray(B,B+128)));for(;0>(P=F.indexOf(h))&&k<L&&B<M.byteLength;)X+=F,k+=F.length,B+=128,F+=String.fromCharCode.apply(null,new Uint16Array(M.subarray(B,B+128)));return-1<P?(w!==!1&&(M.pos+=k+P+1),X+F.slice(0,P)):!1},u=function(M){const L=/^#\?(\S+)/,w=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,E=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,B=/^\s*FORMAT=(\S+)\s*$/,P=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,k={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let X,F;for((M.pos>=M.byteLength||!(X=d(M)))&&o(1,"no header found"),(F=X.match(L))||o(3,"bad initial token"),k.valid|=1,k.programtype=F[1],k.string+=X+`
`;X=d(M),X!==!1;){if(k.string+=X+`
`,X.charAt(0)==="#"){k.comments+=X+`
`;continue}if((F=X.match(w))&&(k.gamma=parseFloat(F[1])),(F=X.match(E))&&(k.exposure=parseFloat(F[1])),(F=X.match(B))&&(k.valid|=2,k.format=F[1]),(F=X.match(P))&&(k.valid|=4,k.height=parseInt(F[1],10),k.width=parseInt(F[2],10)),k.valid&2&&k.valid&4)break}return k.valid&2||o(3,"missing format specifier"),k.valid&4||o(3,"missing image size specifier"),k},f=function(M,L,w){const E=L;if(E<8||E>32767||M[0]!==2||M[1]!==2||M[2]&128)return new Uint8Array(M);E!==(M[2]<<8|M[3])&&o(3,"wrong scanline width");const B=new Uint8Array(4*L*w);B.length||o(4,"unable to allocate buffer space");let P=0,k=0;const X=4*E,F=new Uint8Array(4),H=new Uint8Array(X);let W=w;for(;W>0&&k<M.byteLength;){k+4>M.byteLength&&o(1),F[0]=M[k++],F[1]=M[k++],F[2]=M[k++],F[3]=M[k++],(F[0]!=2||F[1]!=2||(F[2]<<8|F[3])!=E)&&o(3,"bad rgbe scanline format");let se=0,de;for(;se<X&&k<M.byteLength;){de=M[k++];const Pe=de>128;if(Pe&&(de-=128),(de===0||se+de>X)&&o(3,"bad scanline data"),Pe){const Oe=M[k++];for(let ae=0;ae<de;ae++)H[se++]=Oe}else H.set(M.subarray(k,k+de),se),se+=de,k+=de}const be=E;for(let Pe=0;Pe<be;Pe++){let Oe=0;B[P]=H[Pe+Oe],Oe+=E,B[P+1]=H[Pe+Oe],Oe+=E,B[P+2]=H[Pe+Oe],Oe+=E,B[P+3]=H[Pe+Oe],P+=4}W--}return B},m=function(M,L,w,E){const B=M[L+3],P=Math.pow(2,B-128)/255;w[E+0]=M[L+0]*P,w[E+1]=M[L+1]*P,w[E+2]=M[L+2]*P,w[E+3]=1},g=function(M,L,w,E){const B=M[L+3],P=Math.pow(2,B-128)/255;w[E+0]=a0.toHalfFloat(Math.min(M[L+0]*P,65504)),w[E+1]=a0.toHalfFloat(Math.min(M[L+1]*P,65504)),w[E+2]=a0.toHalfFloat(Math.min(M[L+2]*P,65504)),w[E+3]=a0.toHalfFloat(1)},A=new Uint8Array(e);A.pos=0;const y=u(A),b=y.width,x=y.height,v=f(A.subarray(A.pos),b,x);let _,C,S;switch(this.type){case $i:S=v.length/4;const M=new Float32Array(S*4);for(let w=0;w<S;w++)m(v,w*4,M,w*4);_=M,C=$i;break;case Wi:S=v.length/4;const L=new Uint16Array(S*4);for(let w=0;w<S;w++)g(v,w*4,L,w*4);_=L,C=Wi;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:b,height:x,data:_,header:y.string,gamma:y.gamma,exposure:y.exposure,type:C}}setDataType(e){return this.type=e,this}load(e,t,i,n){function r(o,a){switch(o.type){case $i:case Wi:o.colorSpace=Ji,o.minFilter=Ot,o.magFilter=Ot,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,a)}return super.load(e,r,i,n)}}const $Pe=Object.freeze(Object.defineProperty({__proto__:null,RGBELoader:u2},Symbol.toStringTag,{value:"Module"})),LK="NEEDLE_lightmaps",M_=ee("debuglightmapsextension")||ee("debuglightmaps");var Df=(s=>(s[s.Lightmap=0]="Lightmap",s[s.Skybox=1]="Skybox",s[s.Reflection=2]="Reflection",s))(Df||{});class eGe{constructor(e,t,i){p(this,"parser");p(this,"registry");p(this,"source");this.parser=e,this.registry=t,this.source=i}get name(){return LK}afterRoot(e){const t=this.parser.json.extensions;if(t){const i=t[LK];if(i){const n=i.textures;return n!=null&&n.length?(M_&&console.log(i),new Promise(async(r,o)=>{const a=[];for(const c of n)if(c.pointer){M_&&console.log(c);let h=null;if(c.pointer.startsWith("/textures/"))M_&&console.log("Load texture from gltf",c.pointer),h=c5(this.parser,c.pointer).then(d=>this.resolveTexture(c,d));else if(typeof c.pointer=="string"){M_&&console.log("Load texture from path",c.pointer);const d=km(this.source,c.pointer);let u;d.endsWith(".exr")?u=new bS(this.parser.options.manager):d.endsWith(".hdr")?u=new u2(this.parser.options.manager):u=new Mh(this.parser.options.manager),h=u.loadAsync(d,void 0).then(f=>this.resolveTexture(c,f))}else c.pointer;h&&a.push(h)}const l=await YB(a);l!=null&&l.anyFailed&&Qe()&&console.error("Failed to load lightmap extension",l),r()})):null}}return null}resolveTexture(e,t){const i=t;M_&&console.log("Lightmap loaded:",i),i!=null&&i.isTexture&&(this.registry?(i.colorSpace=Ji,this.registry.registerTexture(this.source,e.type,i,e.index)):console.log(Df[e.type],e.pointer,i))}}const BK=!!ee("debuglightmaps");class tGe{constructor(e){p(this,"_context");p(this,"_lightmaps",new Map);this._context=e}clear(){this._lightmaps.clear()}registerTexture(e,t,i,n){BK&&console.log("Registering ",Df[t]+' "'+e+'"',i),this._lightmaps.has(e)||this._lightmaps.set(e,new Map);const r=this._lightmaps.get(e),o=(r==null?void 0:r.get(t))??[];o.length<n&&(o.length=n+1),o[n]=i,r==null||r.set(t,o)}tryGetLightmap(e,t=0){return this.tryGet(e,Df.Lightmap,t)}tryGetSkybox(e){return this.tryGet(e,Df.Skybox,0)}tryGetReflection(e){return this.tryGet(e,Df.Reflection,0)}tryGet(e,t,i){if(!e)return BK&&console.warn("Missing source id"),null;const n=this._lightmaps.get(e);if(!n)return null;const r=n.get(t);return r===void 0||!(r!=null&&r.length)||r.length<=i?null:r[i]}}Ut.lights_fragment_maps=Ut.lights_fragment_maps.replace("vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );",`
    vec2 lUv = vLightMapUv.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
    vec4 lightMapTexel = texture2D( lightMap, lUv);
    // The range of RGBM lightmaps goes from 0 to 34.49 (5^2.2) in linear space, and from 0 to 5 in gamma space.
    lightMapTexel.rgb *= lightMapTexel.a * 8.; // no idea where that "8" comes from... heuristically derived
    lightMapTexel.a = 1.;
    lightMapTexel = conv_sRGBToLinear(lightMapTexel);
    `);Ut.lightmap_pars_fragment=`
    #ifdef USE_LIGHTMAP
        uniform sampler2D lightMap;
        uniform float lightMapIntensity;
        uniform vec4 lightmapScaleOffset;
        
        // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
        vec4 conv_sRGBToLinear( in vec4 value ) {
            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
        }
    #endif
    `;Ut.lights_fragment_begin=Ut.lights_fragment_begin.replace("irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );",`
#if defined(USE_LIGHTMAP)
irradiance += 0.;
#else
irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
#endif`);ht.lightmap.lightmapScaleOffset={value:new Je(1,1,0,0)};const jN=ee("debugprogressive"),qT=new oi,$T=new Vn;class iGe{constructor(e){p(this,"context");p(this,"_lodsManager");this.context=e}get manager(){return this._lodsManager}get targetTriangleDensity(){var e;return((e=this._lodsManager)==null?void 0:e.targetTriangleDensity)??-1}set targetTriangleDensity(e){this._lodsManager&&(this._lodsManager.targetTriangleDensity=e)}setRenderer(e){var t;(t=this._lodsManager)==null||t.disable(),kl.removePlugin(this),kl.addPlugin(this),kl.debugDrawLine=Mt.DrawLine,this._lodsManager=kl.get(e),this._lodsManager.enable()}disable(){var e;(e=this._lodsManager)==null||e.disable(),kl.removePlugin(this)}onAfterUpdatedLOD(e,t,i,n,r){jN&&this.onRenderDebug(i,n,r)}onRenderDebug(e,t,i){var a,l,c;if(!t.geometry||!Ni.hasLODLevelAvailable(t.geometry)&&!Ni.hasLODLevelAvailable(t.material))return;const n=kl.getObjectLODState(t);if(!n)return;let r=i.mesh_lod;const o=i.mesh_lod!=n.lastLodLevel_Mesh||i.texture_lod!=n.lastLodLevel_Texture;if(jN&&t.geometry.boundingSphere){const h=t.geometry.boundingSphere;$T.copy(h),$T.applyMatrix4(t.matrixWorld);const d=$T.center,u=$T.radius,f=["#76c43e","#bcc43e","#c4ac3e","#c4673e","#ff3e3e"];if(o)Mt.DrawWireSphere(d,u,f[r],.1);else{const m=((a=t.geometry.index)==null?void 0:a.count)??0,g=(l=Ni.getMeshLODInformation(t.geometry))==null?void 0:l.lods;r=g?Math.min((g==null?void 0:g.length)-1,r):0;let A="";if(g&&n.lastScreenCoverage>0)for(let x=0;x<g.length;x++){const v=g[x].density,_=x==g.length-1;A+=v.toFixed(0)+">"+(v/n.lastScreenCoverage).toFixed(0)+(_?"":",")}const y=g?(c=g[r])==null?void 0:c.density:-1;let b="LOD "+i.mesh_lod+`
TEX `+i.texture_lod;if(jN=="density"&&(b+=`
`+m+` tris
`+(y/n.lastScreenCoverage).toFixed(0)+` dens
`+(n.lastScreenCoverage*100).toFixed(1)+`% cov
`+(n.lastCentrality*100).toFixed(1)+`% centr
`+(qT.min.x.toFixed(2)+"-"+qT.max.x.toFixed(2)+"x"+qT.min.y.toFixed(2)+"-"+qT.max.y.toFixed(2))+" scr"),n.lastScreenCoverage>.1){const x=e,v=x.worldForward,_=x.worldPosition,S=St(v).multiplyScalar(u*.7).add(d),M=S.distanceTo(_),L=f[Math.min(f.length-1,Math.max(0,r))]+"88",w=this.context.domHeight>0?screen.height/this.context.domHeight:1,E=e.isPerspectiveCamera?Math.tan(e.fov*Math.PI/180/2):1;Mt.DrawLabel(S,b,M*.012*w*E,void 0,16777215,L)}}}}}const nGe=ee("debugplayerview");var Kf=(s=>(s.Browser="browser",s.Headset="headset",s.Handheld="handheld",s))(Kf||{});class jre{constructor(e,t){p(this,"userId");p(this,"context");p(this,"viewDevice","browser");p(this,"removed",!1);p(this,"_object");this.userId=e,this.context=t}get currentObject(){return this._object}set currentObject(e){this._object=e}get isConnected(){return this.context.connection.userIsInRoom(this.userId)}}class qre{constructor(e){p(this,"context");p(this,"playerViews",new Map);this.context=e}setPlayerView(e,t,i){let n=this.playerViews.get(e);n||(n=new jre(e,this.context),this.playerViews.set(e,n)),n.viewDevice=i,n.currentObject=t,n.removed=!1}getPlayerView(e){if(!e)return;if(!this.context.connection.userIsInRoom(e)){this.playerViews.delete(e);return}return this.playerViews.get(e)}removePlayerView(e,t){const i=this.playerViews.get(e);(i==null?void 0:i.viewDevice)===t&&(nGe&&console.log("REMOVE",e),i.removed=!0,this.playerViews.delete(e))}}new Is;const fM=new Uint8Array(4);fM[0]=255;fM[1]=255;fM[2]=255;fM[3]=255;const sGe=new ir(fM,1,1,bi);function A5(s,e=1){const t="alpha"in s,i=e*e,n=new Uint8Array(4*i),r=Math.floor(s.r*255),o=Math.floor(s.g*255),a=Math.floor(s.b*255);for(let c=0;c<i;c++){const h=c*4;n[h+0]=r,n[h+1]=o,n[h+2]=a,t?n[h+3]=Math.floor(s.alpha*255):n[h+3]=255}const l=new ir(n,e,e);return l.needsUpdate=!0,l}function rGe(s,e,t,i=1,n=3){const o=i*n,a=[s,e,t],l=a.length,c=new Uint8Array(4*l*o),h=new ge;for(let u=0;u<n;u++){const f=Math.floor(u/n*l),m=lt.clamp(f+1,0,l-1),g=a[f],A=a[m],y=u/n*l%1;h.lerpColors(g,A,y);const b=Math.floor(h.r*255),x=Math.floor(h.g*255),v=Math.floor(h.b*255);for(let _=0;_<i;_++){const C=(u*i+_)*4;c[C+0]=b,c[C+1]=x,c[C+2]=v,c[C+3]=255}}const d=new ir(c,i,n);return d.needsUpdate=!0,d}function p2(s,e){const t=s.elements;e||(e=[]),e.length=0;for(let i=0;i<16;i+=4){const n=t[i],r=t[i+1],o=t[i+2],a=t[i+3],l=new Je(n,r,o,a);e.push(l)}return e}const qN=[],PK=[];function oGe(s,e){if(qN.length===0)for(let t=0;t<27;t++)qN.push(0);e||(e=qN);for(let t=0;t<27;t++)PK[t]=e[t];e=PK,s.unity_SHAr={value:new Je(e[9],e[3],e[6],e[0])},s.unity_SHBr={value:new Je(e[12],e[15],e[18],e[21])},s.unity_SHAg={value:new Je(e[10],e[4],e[7],e[1])},s.unity_SHBg={value:new Je(e[13],e[16],e[19],e[22])},s.unity_SHAb={value:new Je(e[11],e[5],e[8],e[2])},s.unity_SHBb={value:new Je(e[14],e[17],e[20],e[23])},s.unity_SHC={value:new Je(e[24],e[25],e[26],1)}}class aGe{constructor(e,t,i){p(this,"vertexShader");p(this,"fragmentShader");p(this,"technique");this.vertexShader=e,this.fragmentShader=t,this.technique=i}}async function lGe(s,e){if(!s)return console.error("Can not find technique: no shader data"),null;const t=s.programs[e],i=t.vertexShader,n=t.fragmentShader;if(i!==void 0&&n!==void 0){const r=s.shaders[i],o=s.shaders[n];if(r.uri&&o.uri||r.code&&o.code){if(!r.code&&r.uri&&await GK(r),!o.code&&o.uri&&await GK(o),!r.code||!o.code)return null;const a=s.techniques[e];return new aGe(r.code,o.code,a)}}return console.error("Shader technique not found",e),null}async function GK(s){const e=s.uri;if(e)if(e.endsWith(".glsl")){const i=await new Is().loadAsync(e);s.code=i.toString()}else s.code=cGe(s.uri)}function cGe(s){return decodeURIComponent(Array.prototype.map.call(atob(s),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}const hh=ee("debugenvlight");var sx=(s=>(s[s.Skybox=0]="Skybox",s[s.Trilight=1]="Trilight",s[s.Flat=3]="Flat",s[s.Custom=4]="Custom",s))(sx||{}),f2=(s=>(s[s.Skybox=0]="Skybox",s[s.Custom=1]="Custom",s))(f2||{});class $re{constructor(e){p(this,"context");p(this,"_currentLightSettingsId");p(this,"_sceneLightSettings");p(this,"_timevec4",new Je);p(this,"__currentReflectionId",null);p(this,"_lighting",{});this.context=e,this.context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){const e=this.context.time;this._timevec4.x=e.time,this._timevec4.y=Math.sin(e.time),this._timevec4.z=Math.cos(e.time),this._timevec4.w=e.deltaTime}get timeVec4(){return this._timevec4}get environmentIntensity(){if(!this._sceneLightSettings||!this._currentLightSettingsId)return 1;const e=this._sceneLightSettings.get(this._currentLightSettingsId);return e?e.ambientIntensity:1}get sceneLightSettings(){var e;return(e=this._sceneLightSettings)==null?void 0:e.values()}enable(e){var i;e instanceof gi&&(e=e.url);const t=(i=this._sceneLightSettings)==null?void 0:i.get(e);return t?(hh&&console.log("Enable scene light settings",e,t),e!==this._currentLightSettingsId&&this._currentLightSettingsId&&this.disable(this._currentLightSettingsId),this._currentLightSettingsId=e,t.enabled=!0,!0):(hh&&console.warn("No light settings found for",e),!1)}disable(e){var i;if(e instanceof gi&&(e=e.url),e==null)return!1;const t=(i=this._sceneLightSettings)==null?void 0:i.get(e);return t?(hh&&console.log("Disable scene light settings",e,t),t.enabled=!1,!0):!1}disableCurrent(){if(this._currentLightSettingsId){const e=this._currentLightSettingsId;return this.disable(this._currentLightSettingsId),e}return null}internalRegisterSceneLightSettings(e){const t=e.sourceId;if(!t){console.error("Missing source id for scene light settings, can not register:",e);return}hh&&console.log("Register "+(e==null?void 0:e.sourceId)+" lighting",e),this._sceneLightSettings||(this._sceneLightSettings=new Map),this._sceneLightSettings.set(t,e)}internalUnregisterSceneLightSettings(e){const t=e.sourceId;if(!t){console.error("Missing source id for scene light settings, can not unregister:",e);return}hh&&console.log("Unregister "+(e==null?void 0:e.sourceId)+" lighting",e),this._sceneLightSettings&&this._sceneLightSettings.delete(t)}internalRegisterReflection(e,t){hh&&console.log("Register reflection",e,t);const i=new eoe(this.context,t,1);this._lighting[e]=i}internalGetReflection(e){return this._lighting[e]}internalEnableReflection(e){var i;this.__currentReflectionId=e;const t=(i=this._sceneLightSettings)==null?void 0:i.get(e);switch(hh&&console.log("Enable reflection",e,t?sx[t.ambientMode]:"Unknown ambient mode",t),t==null?void 0:t.ambientMode){case 0:case 4:const n=this.internalGetReflection(e);if(n&&n.Source){hh&&console.log("Setting environment reflection",n);const r=this.context.scene,o=n.Source;o.mapping=wo,r.environment=o;return}else hh&&console.warn("Could not find reflection for source",e);break}if((t==null?void 0:t.environmentReflectionSource)===1)switch(t==null?void 0:t.ambientMode){case 1:if(t.ambientTrilight){const n=t.ambientTrilight,r=rGe(n[0],n[1],n[2],64,64);r.colorSpace=ft,r.mapping=wo,this.context.scene.environment=r}else console.error("Missing ambient trilight",t.sourceId);return;case 3:if(t.ambientLight){const n=A5(t.ambientLight,64);n.colorSpace=ft,n.mapping=wo,this.context.scene.environment=n}else console.error("Missing ambientlight",t.sourceId);return;default:return}}internalDisableReflection(e){if(e&&e!==this.__currentReflectionId){hh&&console.log("Not disabling reflection for",e,"because it is not the current light settings id",this.__currentReflectionId);return}hh&&console.log("Disable reflection",e);const t=this.context.scene;t.environment=null}}class eoe{constructor(e,t,i=1){p(this,"_source");this._source=t,t.mapping=wo}get Source(){return this._source}}const kK=ee("timescale");let wz=1;typeof kK=="number"&&(wz=kK);class toe{constructor(){p(this,"_time",0);p(this,"_deltaTime",0);p(this,"_deltaTimeUnscaled",0);p(this,"timeScale",1);p(this,"_frame",0);p(this,"clock",new dX);p(this,"_smoothedFps",0);p(this,"_smoothedDeltaTime",0);p(this,"_fpsSamples",[]);p(this,"_fpsSampleIndex",0);typeof wz=="number"&&(this.timeScale=wz)}get time(){return this._time}set time(e){this._time=e}get deltaTime(){return this._deltaTime}set deltaTime(e){this._deltaTime=e}get deltaTimeUnscaled(){return this._deltaTimeUnscaled}get frame(){return this._frame}set frame(e){this._frame=e}get frameCount(){return this.frame}get realtimeSinceStartup(){return this.clock.elapsedTime}get smoothedFps(){return this._smoothedFps}get smoothedDeltaTime(){return 1/this._smoothedFps}update(){this.deltaTime=this.clock.getDelta(),this.deltaTime=Math.min(.1,this.deltaTime),this._deltaTimeUnscaled=this.deltaTime,this.deltaTime<=0&&(this.deltaTime=1e-12),this.deltaTime*=this.timeScale,this.frame+=1,this.time+=this.deltaTime,this._fpsSamples.length<60?this._fpsSamples.push(this.deltaTime):this._fpsSamples[this._fpsSampleIndex++%60]=this.deltaTime;let e=0;for(let t=0;t<this._fpsSamples.length;t++)e+=this._fpsSamples[t];this._smoothedDeltaTime=e/this._fpsSamples.length,this._smoothedFps=1/this._smoothedDeltaTime}}let NK=!1;function ioe(s){NK||(NK=!0,hGe(),dGe())}ioe();function hGe(){const s=`
float startCompression = 0.8;
float desaturation = 0.5;
// Patched tonemapping function
vec3 NeutralToneMapping( vec3 color ) {
    color *= toneMappingExposure;
    
    float d = 1. - startCompression;
    // float peak = dot(color, vec3(0.299, 0.587, 0.114));
    float peak = max(color.r, max(color.g, color.b));
    if (peak < startCompression) return color;
    float newPeak = 1. - d * d / (peak + d - startCompression);
    float invPeak = 1. / peak;
    
    float extraBrightness = dot(color * (1. - startCompression * invPeak), vec3(1, 1, 1));
    
    color *= newPeak * invPeak;
    float g = 1. - 3. / (desaturation * extraBrightness + 3.);
    return mix(color, vec3(1, 1, 1), g);
}
`,e="vec3 NeutralToneMapping( vec3 color ) {",t=`return mix( color, vec3( newPeak ), g );
}`,i=Ut.tonemapping_pars_fragment.indexOf(e),n=Ut.tonemapping_pars_fragment.indexOf(t,i);if(i>=0&&n>=0){const r=Ut.tonemapping_pars_fragment.substring(i,n+t.length);Ut.tonemapping_pars_fragment=Ut.tonemapping_pars_fragment.replace(r,s)}else Qe()&&console.error("Couldn't find NeutralToneMapping in ShaderChunk.tonemapping_pars_fragment")}function dGe(){const s=`
// 0: Default, 1: Golden, 2: Punchy
#define AGX_LOOK 0        

vec3 userSlope = vec3(1.0);
vec3 userOffset = vec3(0.0);
vec3 userPower = vec3(1.0);
float userSaturation = 1.0;

// Mean error^2: 3.6705141e-06
vec3 _agxDefaultContrastApprox(vec3 x) {
    vec3 x2 = x * x;
    vec3 x4 = x2 * x2;
    
    return  + 15.5     * x4 * x2
            - 40.14    * x4 * x
            + 31.96    * x4
            - 6.868    * x2 * x
            + 0.4298   * x2
            + 0.1191   * x
            - 0.00232;
}

vec3 _agx(vec3 val) {
    const mat3 agx_mat = mat3(
        0.842479062253094, 0.0423282422610123, 0.0423756549057051,
        0.0784335999999992,  0.878468636469772,  0.0784336,
        0.0792237451477643, 0.0791661274605434, 0.879142973793104);
    
    const float min_ev = -12.47393f;
    const float max_ev = 4.026069f;

    // val = pow(val, vec3(2.2)); 

    // Input transform (inset)
    val = agx_mat * val;
    
    // Log2 space encoding
    val = clamp(log2(val), min_ev, max_ev);
    val = (val - min_ev) / (max_ev - min_ev);
    
    // Apply sigmoid function approximation
    val = _agxDefaultContrastApprox(val);

    return val;
}

vec3 _agxEotf(vec3 val) {
    const mat3 agx_mat_inv = mat3(
        1.19687900512017, -0.0528968517574562, -0.0529716355144438,
        -0.0980208811401368, 1.15190312990417, -0.0980434501171241,
        -0.0990297440797205, -0.0989611768448433, 1.15107367264116);
        
    // Inverse input transform (outset)
    val = agx_mat_inv * val;
    
    // sRGB IEC 61966-2-1 2.2 Exponent Reference EOTF Display
    // NOTE: We're linearizing the output here. Comment/adjust when
    // *not* using a sRGB render target
    val = pow(val, vec3(2.2)); 

    return val;
}

vec3 _agxLook(vec3 val) {
    const vec3 lw = vec3(0.2126, 0.7152, 0.0722);
    float luma = dot(val, lw);
    
    // Default
    vec3 offset = vec3(0.0);
    vec3 slope = vec3(1.0);
    vec3 power = vec3(1.0);
    float sat = 1.0;
    
    #if AGX_LOOK == 1
    // Golden
    slope = vec3(1.0, 0.9, 0.5);
    power = vec3(0.8);
    sat = 0.8;
    #elif AGX_LOOK == 2
    // Punchy
    slope = vec3(1.0);
    power = vec3(1.35, 1.35, 1.35);
    sat = 1.4;
    #endif        
    
    // Needle
    slope = vec3(1.05);
    power = vec3(1.10, 1.10, 1.10);
    sat = 1.15;

    // User
    // slope = userSlope;
    // offset = userOffset;
    // power = userPower;
    // sat = userSaturation;
    
    // ASC CDL
    val = pow(val * slope + offset, power);
    return luma + sat * (val - luma);
}


vec3 AgXToneMapping( vec3 color ) {
    // apply AGX
    color *= toneMappingExposure;
    color = _agx(color);
    color = _agxLook(color); // Optional
    color = _agxEotf(color);
    return color;
`,e="vec3 AgXToneMapping( vec3 color ) {",t="return color;",i=Ut.tonemapping_pars_fragment.indexOf(e),n=Ut.tonemapping_pars_fragment.indexOf(t,i);if(i>=0&&n>=0){const r=Ut.tonemapping_pars_fragment.substring(i,n+t.length);Ut.tonemapping_pars_fragment=Ut.tonemapping_pars_fragment.replace(r,s)}else Qe()&&console.error("Couldn't find AgXToneMapping in ShaderChunk.tonemapping_pars_fragment")}function bo(s){const e=document.createElement("span");return e.style.maxWidth="48px",e.style.maxHeight="48px",e.style.overflow="hidden",e.classList.add("material-symbols-outlined","notranslate"),e.setAttribute("translate","no"),e.innerText=s,e}function noe(s){var t;return((t=s.classList)==null?void 0:t.contains("material-symbols-outlined"))||!1}const eE=new Map;async function Sz(s){const e="Material Symbols Outlined";if(document.fonts.check(`1em '${e}'`)||(console.log("Font not loaded yet"),await document.fonts.ready),eE.has(s))return eE.get(s);const t=document.createElement("canvas"),i=48;t.width=i,t.height=i;const n=t.getContext("2d");if(n){n.font=`${i}px '${e}'`,n.fillStyle="black",n.fillText(s,0,i);const r=t.toDataURL(),o=new si;return o.name=s+" icon",o.image=new Image,o.image.src=r,o.needsUpdate=!0,eE.set(s,o),o}return eE.set(s,null),null}const F2=class{constructor(){p(this,"_fullscreenButton");p(this,"_muteButton");p(this,"_qrButton")}static getOrCreate(){return this._instance||(this._instance=new F2),this._instance}static create(){return new F2}get fullscreenButton(){return this._fullscreenButton}createFullscreenButton(e){if(this._fullscreenButton)return this._fullscreenButton;if(!document.fullscreenEnabled)return Qe()&&console.warn("NeedleMenu: Fullscreen button could not be created, device doesn't support the Fullscreen API"),null;const t=document.createElement("button");this._fullscreenButton=t,t.classList.add("fullscreen-button"),t.title="Click to enter fullscreen mode";const i=bo("fullscreen"),n=bo("fullscreen_exit");return t.appendChild(i),t.onclick=()=>{document.fullscreenElement?document.exitFullscreen():"webkitRequestFullscreen"in e.domElement&&typeof e.domElement.webkitRequestFullscreen=="function"?e.domElement.webkitRequestFullscreen():"requestFullscreen"in e.domElement&&e.domElement.requestFullscreen()},document.addEventListener("fullscreenchange",()=>{document.fullscreenElement?(i.remove(),t.appendChild(n),t.title="Click to enter fullscreen mode"):(n.remove(),t.appendChild(i),t.title="Click to exit fullscreen mode")}),globalThis.addEventListener("needle-xrsession-start",()=>{t.style.display="none"}),globalThis.addEventListener("needle-xrsession-end",()=>{t.style.display=""}),t}get muteButton(){return this._muteButton}createMuteButton(e){if(this._muteButton)return this._muteButton;const t=document.createElement("button");this._muteButton=t,t.classList.add("mute-button"),t.title="Click to mute/unmute";const i=bo("volume_off"),n=bo("volume_up");return e.application.muted?t.appendChild(i):t.appendChild(n),t.onclick=()=>{e.application.muted?(i.remove(),t.appendChild(n),e.application.muted=!1):(n.remove(),t.appendChild(i),e.application.muted=!0)},t}get qrButton(){return this._qrButton}createQRCode(){if(this._qrButton)return this._qrButton;const e=document.createElement("button");this._qrButton=e,e.innerText="QR Code",e.prepend(bo("qr_code")),e.title="Scan this QR code with your phone to open this page",this.hideElementDuringXRSession(e);const t=document.createElement("div");t.style.cssText=`
            position: fixed;
            display: inline-block;
            padding: 1rem;
            background-color: white;
            border-radius: 0.4rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
        `;const i=document.createElement("div");i.classList.add("qr-code-container"),t.appendChild(i),e.addEventListener("click",()=>{if(t.parentNode)return r();window.location.href.includes("://localhost")&&An("To access your website from another device in the same local network you have to use the IP address instead of localhost."),n()});async function n(){await o(),document.body.appendChild(t);const a=i.getBoundingClientRect(),l=e.getBoundingClientRect();t.style.left=l.left+l.width*.5-a.width*.5+"px",l.top<a.height?t.style.top=`calc(${l.bottom}px + ${t.style.padding} * .6)`:t.style.top=`calc(${l.top-a.height}px - ${t.style.padding} * 2.5)`,t.style.opacity="0",t.style.pointerEvents="all",t.style.transition="opacity 0.2s ease-in-out",setTimeout(()=>{t.style.opacity="1",window.addEventListener("click",r,{once:!0})}),window.addEventListener("resize",r),window.addEventListener("scroll",r),document.fullscreenElement?document.fullscreenElement.appendChild(t):document.body.appendChild(t)}function r(){t.style.pointerEvents="none",t.style.transition="opacity 0.2s",t.style.opacity="0",setTimeout(()=>{var a;return(a=t.parentNode)==null?void 0:a.removeChild(t)},500),window.removeEventListener("click",r),window.removeEventListener("resize",r),window.removeEventListener("scroll",r)}async function o(){const l=await Mte({text:window.location.href,width:200,height:200});i.innerHTML="",i.appendChild(l)}return e.addEventListener("pointerenter",()=>{o()},{once:!0}),e}hideElementDuringXRSession(e){hP(t=>{e["previous-display"]=e.style.display,e.style.display="none"}),OO(t=>{e["previous-display"]!=null&&(e.style.display=e["previous-display"])})}};let wh=F2;p(wh,"_instance");function m2(s,e){const t=(e==null?void 0:e.element)||document.head,i=Array.from(t.querySelectorAll(`link[rel=stylesheet][href*='${s}']`));if(i.length<=0){const n=document.createElement("link");n.href=s,n.rel="stylesheet",t.appendChild(n),i.push(n)}if(e!=null&&e.loadedCallback)for(let n=0;n<i.length;n++)e!=null&&e.loadedCallback&&i[n].addEventListener("load",e.loadedCallback)}function soe(){m2("https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap")}const Mz="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0",g2="needle-logo-element";class roe extends HTMLElement{constructor(){super();p(this,"_root");p(this,"wrapper");p(this,"logoElement",document.createElement("img"));p(this,"textElement",document.createElement("span"));this._root=this.attachShadow({mode:"closed"});const t=document.createElement("template");t.innerHTML=`<style>
        :host {
            position: relative;
            min-width: fit-content;
            /* height: 100%; can not have height 100% because of align-items: stretch; in the parent */
            display: flex;
        }

        .wrapper {
            position: relative;
            display: grid;
            grid-template-columns: auto auto;
            padding: .1rem;
        }
        .wrapper:hover {
            cursor: pointer;
        }
        img {
            width: 95px;
            height: 100%;
            align-self: end;
            margin-left: 0.6rem;
        }
        span {
            font-size: 1rem;
            white-space: nowrap;
        }
        </style>
        <div class="wrapper">
            <img class="logo" src=${mMe} />
        </div>
        `,this._root.appendChild(t.content.cloneNode(!0)),this.wrapper=this._root.querySelector(".wrapper"),this._root.appendChild(this.wrapper),this.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")}),this.wrapper.setAttribute("title","Made with Needle Engine")}static get elementName(){return g2}static create(){return document.createElement(g2)}setLogoVisible(t){this.logoElement.style.display=t?"block":"none"}}customElements.get(g2)||customElements.define(g2,roe);const $N=ee("debugspatialmenu");class uGe{constructor(e,t){p(this,"_context");p(this,"needleMenu");p(this,"htmlButtonsMap",new Map);p(this,"enabled",!0);p(this,"userRequestedMenu",!1);p(this,"uiisDirty",!1);p(this,"_showNeedleLogo");p(this,"_wasInXR",!1);p(this,"preRender",()=>{var t;if(!this.enabled){(t=this.menu)==null||t.removeFromParent();return}$N&&exports.DeviceUtilities.isDesktop()&&this.updateMenu();const e=this._context.xr;if(!(e!=null&&e.running)){this._wasInXR&&(this._wasInXR=!1,this.onExitXR());return}this._wasInXR||(this._wasInXR=!0,this.onEnterXR()),this.updateMenu()});p(this,"_menuTarget",new ye);p(this,"positionFilter",new pO(90,.5));p(this,"familyName","Needle Spatial Menu");p(this,"menu");p(this,"_poweredByNeedleElement");var n;this._context=e,this._context.pre_render_callbacks.push(this.preRender),this.needleMenu=t;const i=(n=this.needleMenu.shadowRoot)==null?void 0:n.querySelector(".options");i?new MutationObserver(o=>{if(this.enabled&&!(this._context.isInXR==!1&&!$N))for(const a of o)a.type==="childList"&&(a.addedNodes.forEach(l=>{this.createButtonFromHTMLNode(l)}),a.removedNodes.forEach(l=>{const c=l,h=this.htmlButtonsMap.get(c);h&&(this.htmlButtonsMap.delete(c),h.remove(),Mn.update())}))}).observe(i,{childList:!0}):console.error("Could not find options container in needle menu")}setEnabled(e){var t;this.enabled=e,e||(t=this.menu)==null||t.removeFromParent()}setDisplay(e){return this.enabled?(this.userRequestedMenu=e,!0):!1}onDestroy(){const e=this._context.pre_render_callbacks.indexOf(this.preRender);e>-1&&this._context.pre_render_callbacks.splice(e,1)}markDirty(){this.uiisDirty=!0}showNeedleLogo(e){this._showNeedleLogo=e}onEnterXR(){var t;const e=(t=this.needleMenu.shadowRoot)==null?void 0:t.querySelector(".options");e&&e.childNodes.forEach(i=>{this.createButtonFromHTMLNode(i)})}onExitXR(){var e;(e=this.menu)==null||e.removeFromParent()}createButtonFromHTMLNode(e){const t=this.getMenu(),i=this.htmlButtonsMap.get(e);if(i){i.add();return}if(e instanceof HTMLButtonElement){const n=this.createButton(t,e);this.htmlButtonsMap.set(e,n),n.add()}else e instanceof HTMLSlotElement&&e.assignedNodes().forEach(n=>{this.createButtonFromHTMLNode(n)})}updateMenu(){var r,o;performance.mark("NeedleSpatialMenu updateMenu start");const e=this.getMenu();this.handleNeedleWatermark(),this._context.scene.add(e);const t=this._context.mainCamera,i=this._context.xr,n=(i==null?void 0:i.rigScale)||1;if(t){const a=t.worldPosition,l=t.worldForward.multiplyScalar(-1),c=l.y>.6,h=l.y>.4,d=(e.visible?h:c)||this.userRequestedMenu,u=!e.visible&&d;e.visible=d||exports.DeviceUtilities.isDesktop()&&$N,l.multiplyScalar(3*n),a.add(l),(u||!1)&&(e.position.copy(this._menuTarget.position),e.position.y+=.25,this._menuTarget.position.copy(e.position),this.positionFilter.reset(e.position),e.quaternion.copy(this._menuTarget.quaternion),this.markDirty());const m=this._menuTarget.position.distanceTo(a);(u||m>1.5*n)&&(this.ensureRenderOnTop(this.menu),this._menuTarget.position.copy(a),this._context.scene.add(this._menuTarget),q1(this._menuTarget,this._context.mainCamera,!0,!0),this._menuTarget.removeFromParent()),this.positionFilter.filter(this._menuTarget.position,e.position,this._context.time.time);const g=5;(r=this.menu)==null||r.quaternion.slerp(this._menuTarget.quaternion,this._context.time.deltaTime*g),(o=this.menu)==null||o.scale.setScalar(n)}this.uiisDirty&&(performance.mark("SpatialMenu.update.uiisDirty.start"),this.uiisDirty=!1,Mn.update(),performance.mark("SpatialMenu.update.uiisDirty.end"),performance.measure("SpatialMenu.update.uiisDirty","SpatialMenu.update.uiisDirty.start","SpatialMenu.update.uiisDirty.end")),performance.mark("NeedleSpatialMenu updateMenu end"),performance.measure("SpatialMenu.update","NeedleSpatialMenu updateMenu start","NeedleSpatialMenu updateMenu end")}ensureRenderOnTop(e,t=0){e instanceof fe&&(e.material.depthTest=!1,e.material.depthWrite=!1),e.renderOrder=1e3+t*2;for(const i of e.children)this.ensureRenderOnTop(i,t+1)}get isVisible(){var e;return(e=this.menu)==null?void 0:e.visible}getMenu(){if(this.menu)return this.menu;this.ensureFont(),this.menu=new Mn.Block({boxSizing:"border-box",fontFamily:this.familyName,height:"auto",fontSize:.1,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:.55,borderRadius:1,whiteSpace:"pre-wrap",flexDirection:"row",alignItems:"center",padding:new Je(0,.05,0,.05),borderColor:0,borderOpacity:.05,borderWidth:.005});const e=Y.get("ObjectRaycaster");return e&&R0(this.menu,new e),this.menu}handleNeedleWatermark(){var e;if(!this._poweredByNeedleElement){this._poweredByNeedleElement=new Mn.Block({width:"auto",height:"auto",fontSize:.05,whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",margin:.02,borderRadius:.02,padding:.02,backgroundColor:16777215,backgroundOpacity:1}),this._poweredByNeedleElement["needle:use_eventsystem"]=!0;const t=new DK(this._context,()=>globalThis.open("https://needle.tools","_self"));R0(this._poweredByNeedleElement,t);const i=new Mn.Text({textContent:"Powered by",width:"auto",height:"auto"}),n=new Mn.Text({textContent:"needle",width:"auto",height:"auto",fontSize:.07,margin:new Je(0,0,0,.02)});this._poweredByNeedleElement.add(i),this._poweredByNeedleElement.add(n),(e=this.menu)==null||e.add(this._poweredByNeedleElement),this.markDirty(),new Mh().load("./include/needle/poweredbyneedle.webp",o=>{var l;t.allowModifyUI=!1,i.removeFromParent(),n.removeFromParent();const a=o.image.width/o.image.height;(l=this._poweredByNeedleElement)==null||l.set({backgroundImage:o,backgroundOpacity:1,width:.1*a,height:.1}),this.markDirty()})}if(this.menu){const t=this.menu.children.indexOf(this._poweredByNeedleElement);if(!this._showNeedleLogo&&Yf())t>=0&&(this._poweredByNeedleElement.removeFromParent(),this.markDirty());else{this._poweredByNeedleElement.visible=!0,this.menu.add(this._poweredByNeedleElement);const i=this.menu.children.indexOf(this._poweredByNeedleElement);t!==i&&this.markDirty()}}}ensureFont(){let e=Mn.FontLibrary.getFontFamily(this.familyName);if(!e){e=Mn.FontLibrary.addFontFamily(this.familyName);const t=e.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");t==null||t.addEventListener("ready",()=>{this.markDirty()})}}createButton(e,t){const i=new Mn.Block({width:"auto",height:"auto",whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",backgroundColor:16777215,backgroundOpacity:0,padding:.02,margin:.01,borderRadius:.02,cursor:"pointer",fontSize:.05}),n=new Mn.Text({textContent:"",width:"auto",justifyContent:"center",alignItems:"center",backgroundOpacity:0,backgroundColor:16777215,fontFamily:this.familyName,color:0,borderRadius:.02,padding:.01});i.add(n),i["needle:use_eventsystem"]=!0;const r=new DK(this._context,()=>t.click());return R0(i,r),new pGe(this,e,t,i,n)}}class pGe{constructor(e,t,i,n,r){p(this,"menu");p(this,"root");p(this,"htmlbutton");p(this,"spatialContainer");p(this,"spatialText");p(this,"spatialIcon");p(this,"_lastText","");p(this,"_lastTexture");this.menu=e,this.root=t,this.htmlbutton=i,this.spatialContainer=n,this.spatialText=r,new MutationObserver(a=>{for(const l of a)l.type==="attributes"?l.attributeName==="style"&&this.updateVisible():l.type==="childList"&&this.updateText()}).observe(i,{attributes:!0,childList:!0}),this.updateText()}add(){this.spatialContainer.parent!=this.root&&(this.root.add(this.spatialContainer),this.menu.markDirty(),this.updateVisible(),this.updateText())}remove(){this.spatialContainer.parent&&(this.spatialContainer.removeFromParent(),this.menu.markDirty())}updateVisible(){const e=this.spatialContainer.visible;this.spatialContainer.visible=this.htmlbutton.style.display!=="none",e!==this.spatialContainer.visible&&this.menu.markDirty()}updateText(){let e="",t="";this.htmlbutton.childNodes.forEach(i=>{i.nodeType===Node.TEXT_NODE?e+=i.textContent:i instanceof HTMLElement&&noe(i)&&i.textContent&&(t=i.textContent)}),this._lastText!==e&&(this._lastText=e,this.spatialText.name=e,this.spatialText.set({textContent:e}),this.menu.markDirty()),e.length<=0?this.spatialText.parent&&(this.spatialText.removeFromParent(),this.menu.markDirty()):this.spatialText.parent||(this.spatialContainer.add(this.spatialText),this.menu.markDirty()),t&&this.createIcon(t)}async createIcon(e){var i;if(!this.spatialIcon){const n=await Sz(e);if(n&&!this.spatialIcon){const o=new Mn.Block({width:.08,height:.08,backgroundColor:16777215,backgroundImage:n,backgroundOpacity:1,margin:new Je(0,.005,0,0)});this.spatialIcon=o,this.spatialContainer.add(o),this.menu.markDirty()}}if(e!=this._lastTexture){this._lastTexture=e;const n=await Sz(e);n&&((i=this.spatialIcon)==null||i.set({backgroundImage:n}),this.menu.markDirty())}const t=this.spatialContainer.children.indexOf(this.spatialIcon);t>0&&(this.spatialContainer.children.splice(t,1),this.spatialContainer.children.unshift(this.spatialIcon),this.menu.markDirty())}}class DK{constructor(e,t){p(this,"isComponent",!0);p(this,"enabled",!0);p(this,"gameObject");p(this,"allowModifyUI",!0);p(this,"context");p(this,"onclick");this.context=e,this.onclick=t}get activeAndEnabled(){return!0}__internalAwake(){}__internalEnable(){}__internalDisable(){}__internalStart(){}onEnable(){}onDisable(){}get element(){return this.gameObject}onPointerEnter(){this.context.input.setCursorPointer(),this.allowModifyUI&&(this.element.set({backgroundOpacity:1}),Mn.update())}onPointerExit(){this.context.input.setCursorNormal(),this.allowModifyUI&&(this.element.set({backgroundOpacity:0}),Mn.update())}onPointerDown(e){e.use()}onPointerUp(e){e.use()}onPointerClick(e){e.use(),this.onclick()}}const Bb="needle-menu",lw=ee("debugmenu"),FK=ee("debugnoncommercial");let fGe=class{constructor(e){p(this,"_context");p(this,"_menu");p(this,"_spatialMenu");p(this,"onPostMessage",e=>{if(e.origin===globalThis.location.origin&&typeof e.data=="object"){const t=e.data,i=t.type;if(i==="needle:menu"){const n=t.button;if(n){if(!n.label)return console.error("NeedleMenu: buttoninfo.label is required");if(!n.onclick)return console.error("NeedleMenu: buttoninfo.onclick is required");const r=document.createElement("button");if(r.textContent=n.label,n.icon){const o=bo(n.icon);r.prepend(o)}n.priority&&r.setAttribute("priority",n.priority.toString()),r.onclick=()=>{if(n.onclick){const o=n.onclick.startsWith("http")||n.onclick.startsWith("www."),a=n.target||"_blank";o?globalThis.open(n.onclick,a):console.error("NeedleMenu: onclick is not a valid link",n.onclick)}},this._menu.appendChild(r)}else lw&&console.error("NeedleMenu: unknown postMessage event",t)}else lw&&console.warn("NeedleMenu: unknown postMessage type",i,t)}});p(this,"onStartXR",e=>{e.session.isScreenBasedAR&&(this._menu.previousParent=this._menu.parentNode,this._context.arOverlayElement.appendChild(this._menu),e.session.session.addEventListener("end",this.onExitXR),this._menu.closeFoldout())});p(this,"onExitXR",()=>{this._menu.previousParent&&(this._menu.previousParent.appendChild(this._menu),delete this._menu.previousParent)});p(this,"_muteButton");p(this,"_fullscreenButton");this._menu=A2.getOrCreate(e.domElement,e),this._context=e,this._spatialMenu=new uGe(e,this._menu),window.addEventListener("message",this.onPostMessage),hP(this.onStartXR)}onDestroy(){window.removeEventListener("message",this.onPostMessage),this._menu.remove(),this._spatialMenu.onDestroy()}setPosition(e){this._menu.setPosition(e)}setVisible(e){this._menu.setVisible(e)}showNeedleLogo(e){var t;this._menu.showNeedleLogo(e),(t=this._spatialMenu)==null||t.showNeedleLogo(e)}showSpatialMenu(e){this._spatialMenu.setEnabled(e)}setSpatialMenuVisible(e){this._spatialMenu.setDisplay(e)}get spatialMenuIsVisible(){return this._spatialMenu.isVisible}showQRCodeButton(e){if(e==="desktop-only"&&(e=!exports.DeviceUtilities.isMobileDevice()),e){const t=wh.getOrCreate().createQRCode();return t.style.display="",this._menu.appendChild(t),t}else{const t=wh.getOrCreate().qrButton;return t&&(t.style.display="none"),t??null}}showAudioPlaybackOption(e){var t;if(!e){(t=this._muteButton)==null||t.remove();return}this._muteButton=wh.getOrCreate().createMuteButton(this._context),this._muteButton.setAttribute("priority","100"),this._menu.appendChild(this._muteButton)}showFullscreenOption(e){var t;if(!e){(t=this._fullscreenButton)==null||t.remove();return}this._fullscreenButton=wh.getOrCreate().createFullscreenButton(this._context),this._fullscreenButton&&(this._fullscreenButton.setAttribute("priority","150"),this._menu.appendChild(this._fullscreenButton))}appendChild(e){return this._menu.appendChild(e)}};var p1,f1,Iz;const JZ=class extends HTMLElement{constructor(){var d,u,f,m,g,A;super();ml(this,f1);p(this,"_domElement",null);p(this,"_context",null);p(this,"_sizeChangeInterval");ml(this,p1,t=>{if(!t.defaultPrevented&&t.target==this._domElement&&t instanceof PointerEvent&&t.button===0&&this.root.classList.contains("open")){const i=this.foldout.getBoundingClientRect(),n=t;n.clientX>i.left&&n.clientX<i.right&&n.clientY>i.top&&n.clientY<i.bottom||this.root.classList.toggle("open",!1)}});p(this,"_userRequestedLogoVisible");p(this,"_userRequestedMenuVisible");p(this,"root");p(this,"wrapper");p(this,"options");p(this,"logoContainer");p(this,"compactMenuButton");p(this,"foldout");p(this,"_isHandlingChange",!1);p(this,"_didSort",new Map);p(this,"_lastAvailableWidthChange",0);p(this,"_timeoutHandle",0);p(this,"handleSizeChange",(t,i)=>{if(!this._domElement)return;const n=this._domElement.clientWidth;if(n<100){clearTimeout(this._timeoutHandle),this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style");return}const r=20*2,o=n-r;if(!i&&Math.abs(o-this._lastAvailableWidthChange)<1)return;this._lastAvailableWidthChange=o,clearTimeout(this._timeoutHandle),this._timeoutHandle=setTimeout(()=>{const c=l();c<0?(this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style")):c>0&&(this.root.classList.remove("compact"),this.foldout.classList.remove("floating-panel-style"),l()<0&&(this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style")))},5);const a=()=>this.options.clientWidth+this.logoContainer.clientWidth,l=()=>o-a()});const t=document.createElement("template");t.innerHTML=`<style>

        #root {
            position: absolute;
            width: auto;
            max-width: 95%;
            left: 50%;
            transform: translateX(-50%);
            top: min(20px, 10vh);
            padding: 0.3rem;
            display: flex;
            visibility: visible;
            flex-direction: row-reverse; /* if we overflow this should be right aligned so the logo is always visible */
            pointer-events: all;
            z-index: 1000;
        }

        /** hide the menu if it's empty **/
        #root.has-no-options.logo-hidden {
            display: none; 
        }

        /** using a div here because then we can change the class for placement **/
        #root.bottom {
            top: auto;
            bottom: min(30px, 10vh);
        }
        #root.top {
            top: calc(.7rem + env(safe-area-inset-top));
        }
        
        .wrapper {
            position: relative;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: stretch;
            gap: 0px;
            padding: 0 0rem;
        }

        .wrapper > *, .options > button, .options > select, ::slotted(*) {
            position: relative;
            border: none;
            border-radius: 0;
            outline: 1px solid rgba(0,0,0,0);
            display: flex;
            justify-content: center;
            align-items: center;
            max-height: 2.3rem;
            max-width: 100%;

            /** basic font settings for all entries **/
            font-size: 1rem;
            font-family: 'Roboto Flex', sans-serif;
            font-optical-sizing: auto;
            font-weight: 500;
            font-weight: 200;
            font-variation-settings: "wdth" 100;
            color: rgb(20,20,20);
        }

        .floating-panel-style {
            background: rgba(255, 255, 255, .4);
            outline: rgb(0 0 0 / 5%) 1px solid;
            border: 1px solid rgba(255, 255, 255, .1);
            box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);
            border-radius: 1.5rem;
            /** 
             * to make nested background filter work 
             * https://stackoverflow.com/questions/60997948/backdrop-filter-not-working-for-nested-elements-in-chrome 
             **/
            &::before {
                content: '';
                position: absolute;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                z-index: -1;
                border-radius: 1.5rem;
                -webkit-backdrop-filter: blur(8px);
                backdrop-filter: blur(8px);
            }
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        .options {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        .options > *, ::slotted(*) {
            max-height: 2.25rem;
            padding: .4rem .5rem;
        }
        
        :host .options > *, ::slotted(*) {
            background: transparent;
            border: none;
            white-space: nowrap;
            transition: all 0.1s linear .02s;
            border-radius: 1.5rem;
            user-select: none;
        }
        :host .options > *:hover, ::slotted(*:hover) {
            cursor: pointer;
            color: black;
            background: rgba(245, 245, 245, .8);
            box-shadow: inset 0 0 1rem rgba(0,0,30,.2);
            outline: rgba(0,0,0,.1) 1px solid;
        }
        :host .options > *:active, ::slotted(*:active) {
            background: rgba(255, 255, 255, .8);
            box-shadow: inset 0px 1px 1px rgba(255,255,255,.5), inset 0 0 2rem rgba(0,0,30,.2), inset 0px 2px 4px rgba(0,0,20,.5);
            transition: all 0.05s linear;
        }
        :host .options > *:focus, ::slotted(*:focus) {
            outline: rgba(255,255,255,.5) 1px solid;
        }
        :host .options > *:focus-visible, ::slotted(*:focus-visible) {
            outline: rgba(0,0,0,.5) 1px solid;
        }

        :host .options > *:disabled, ::slotted(*:disabled) {
            background: rgba(0,0,0,.05);
            color: rgba(60,60,60,.7);
            pointer-events: none;
        }

        button, ::slotted(button) {
            gap: 0.3rem;
        }

        /** XR button animation **/
        :host button.this-mode-is-requested {
            background: repeating-linear-gradient(to right, #fff 0%, #fff 40%, #aaffff 55%, #fff 80%);
            background-size: 200% auto;
            background-position: 0 100%;
            animation: AnimationName .7s ease infinite forwards;
        }
        :host button.other-mode-is-requested {
            opacity: .5;
        }
        
        @keyframes AnimationName {
            0% { background-position: 0% 0 }
            100% { background-position: -200% 0 }
        }




        .logo {
            cursor: pointer;
            padding-left: 0.6rem;
            padding-bottom: .02rem;
            margin-right: 0.5rem;
        }
        .logo-hidden {
            .logo {
                display: none;
            }
        }
        :host .has-options .logo {
            border-left: 1px solid rgba(40,40,40,.4);
            margin-left: 0.3rem;
            margin-right: 0.5rem;
        }

        .logo > span {
            white-space: nowrap;
        }



        /** COMPACT */

        /** Hide the menu button normally **/
        .compact-menu-button { display: none; }
        /** And show it when we're in compact mode **/
        .compact .compact-menu-button {
            position: relative;
            display: block;
            background: none;
            border: none;
            border-radius: 2rem;

            margin: 0;
            padding: 0 .3rem;
            padding-top: .2rem;

            z-index: 100;

            color: #000;

            &:hover {
                background: rgba(255,255,255,.2);
                cursor: pointer;
            }
            &:focus {
                outline: 1px solid rgba(255,255,255,.5);
            }
            &:focus-visible {
                outline: 1px solid rgba(0,0,0,.5);
            }
            & .expanded-click-area {
                position: absolute;
                left: 0;
                right: 0;
                top: 10%;
                bottom: 10%;
                transform: scale(1.8);
            }
        }  
        .has-no-options .compact-menu-button {
            display: none;
        }
        .open .compact-menu-button {
            background: rgba(255,255,255,.2);
        }
        .logo-visible .compact-menu-button { 
            margin-left: .2rem;
        }
        
        /** Open and hide menu **/
        .compact .foldout { 
            display: none;
        }
        .open .options, .open .foldout {
            display: flex;
            justify-content: center;
        }
        .compact .wrapper {
            padding: 0;
        }
        .compact .wrapper, .compact .options {
            height: auto;
            max-height: initial;
            flex-direction: row;
            gap: .12rem;
        }
        .compact .options { 
            flex-wrap: wrap;
            gap: .3rem;
        }
        .compact .top .options {
            height: auto;
            flex-direction: row;
        }
        .compact .bottom .wrapper {
            height: auto;
            flex-direction: column;
        }

        .compact .foldout {
            max-height: min(100ch, calc(100vh - 100px));
            overflow: auto;
            overflow-x: hidden;
            align-items: center;

            position: fixed;
            bottom: calc(100% + 5px);
            z-index: 100;
            width: auto;
            left: .2rem;
            right: .2rem;
            padding: .2rem;

        }
        .compact.logo-hidden .foldout {
            /** for when there's no logo we want to center the foldout **/
            min-width: 24ch;
            margin-left: 50%;
            transform: translateX(calc(-50% - .2rem));
        }
        
        .compact.top .foldout {
            top: calc(100% + 5px);
            bottom: auto;
        }

        ::-webkit-scrollbar {
            max-width: 7px;
            background: rgba(100,100,100,.2);
            border-radius: .2rem;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, .3);
            border-radius: .2rem;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgb(150,150,150);
        }

        .compact .options > *, .compact .options > ::slotted(*) {
            font-size: 1.2rem;
            padding: .6rem .5rem;
            width: 100%;
        }
        .compact.has-options .logo {
            border: none;
            padding-left: 0;
            margin-left: 1rem;
            margin-bottom: .02rem;
        }
        .compact .options {
            /** e.g. if we have a very wide menu item like a select with long option names we don't want to overflow **/
            max-width: 100%;

            & > button, & > select {
                display: flex;
                flex-basis: 100%;
                min-height: 3rem;
            }
            & > button.row2 {
                //border: 1px solid red !important;
                display: flex;
                flex: 1;
                flex-basis: 30%;
            }
        }

        /** If there's really not enough space then just hide all options **/
        @media (max-width: 100px) or (max-height: 100px){
            .foldout {
                display: none !important;
            }
            .compact-menu-button {
                display: none !important;
            }
        }
        
        /* dark mode */
        /*
        @media (prefers-color-scheme: dark) {
            :host {
                background: rgba(0,0,0, .6);
            }
            :host button {
                color: rgba(200,200,200);
            }
            :host button:hover {
                background: rgba(100,100,100, .8);
            }
        }
        */

        </style>
        
        <div id="root" class="logo-visible floating-panel-style bottom">
            <div class="wrapper">
                <div class="foldout">
                    <div class="options" part="options">
                        <slot></slot>
                    </div>
                    <div class="options" part="options">
                        <slot name="end"></slot>
                    </div>
                </div>
                <div style="user-select:none" class="logo">
                    <span class="madewith notranslate">powered by</span>
                </div>
            </div>
            <button class="compact-menu-button">
                <div class="expanded-click-area"></div>
            </button>
        </div>
        `;const i=this.attachShadow({mode:"open"});soe(),m2(Mz,{loadedCallback:()=>{this.handleSizeChange()}}),m2(Mz,{element:i});const n=t.content.cloneNode(!0);i==null||i.appendChild(n),this.root=i.querySelector("#root"),this.wrapper=(d=this.root)==null?void 0:d.querySelector(".wrapper"),this.options=(u=this.root)==null?void 0:u.querySelector(".options"),this.logoContainer=(f=this.root)==null?void 0:f.querySelector(".logo"),this.compactMenuButton=(m=this.root)==null?void 0:m.querySelector(".compact-menu-button"),this.compactMenuButton.append(bo("more_vert")),this.foldout=(g=this.root)==null?void 0:g.querySelector(".foldout"),(A=this.root)==null||A.appendChild(this.wrapper),this.wrapper.classList.add("wrapper");const r=roe.create();r.style.minHeight="1rem",this.logoContainer.append(r),this.logoContainer.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")});try{vGe(y=>{if(y==!0&&Bh()&&!FK){let b=this._userRequestedLogoVisible;b===void 0&&(b=!1),ng(this,f1,Iz).call(this,b)}})}catch(y){console.error("[Needle Menu] License check failed.",y)}this.compactMenuButton.addEventListener("click",y=>{y.preventDefault(),this.root.classList.toggle("open")});let o=this._context;setTimeout(()=>o=this._context);let a=0;const l=(y,b)=>{var x,v,_;lw&&console.log("Set menu visible",b),o!=null&&o.isInAR&&o.arOverlayElement?y!=o.arOverlayElement&&o.arOverlayElement.appendChild(this):this.parentNode!=((x=this._domElement)==null?void 0:x.shadowRoot)&&((_=(v=this._domElement)==null?void 0:v.shadowRoot)==null||_.appendChild(this)),this.style.display=b?"flex":"none",this.style.visibility="visible",this.style.opacity="1"};let c=!1;new MutationObserver(y=>{var b;if(!c)try{c=!0,this.onChangeDetected(y);const x=this==null?void 0:this.parentNode;if((this.style.display!="flex"||this.style.visibility!="visible"||this.style.opacity!="1"||x!=((b=this._domElement)==null?void 0:b.shadowRoot))&&!Bh()){const v=a++;ka()&&this._userRequestedMenuVisible===!1?(v===0&&l(x,this._userRequestedMenuVisible),v===1&&console.warn("Needle Menu Warning: You need a PRO license to hide the Needle Engine menu → The menu will be visible in your deployed website if you don't have a PRO license. See https://needle.tools/pricing for details.")):v===0?l(x,!0):setTimeout(()=>l(x,!0),5)}}finally{c=!1}}).observe(this.root,{childList:!0,subtree:!0,attributes:!0}),lw&&this.___insertDebugOptions()}static create(){return document.createElement(Bb,{is:Bb})}static getOrCreate(t,i){let n=t.querySelector(Bb);return!n&&t.shadowRoot&&(n=t.shadowRoot.querySelector(Bb)),n||(n=JZ.create(),t.shadowRoot?t.shadowRoot.appendChild(n):t.appendChild(n)),n._domElement=t,n._context=i,n}connectedCallback(){window.addEventListener("resize",this.handleSizeChange),this.handleMenuVisible(),this._sizeChangeInterval=setInterval(()=>this.handleSizeChange(void 0,!0),5e3),setTimeout(()=>{var t,i;(t=this._domElement)==null||t.addEventListener("resize",this.handleSizeChange),(i=this._domElement)==null||i.addEventListener("click",Vi(this,p1))},1)}disconnectedCallback(){var t,i;window.removeEventListener("resize",this.handleSizeChange),clearInterval(this._sizeChangeInterval),(t=this._domElement)==null||t.removeEventListener("resize",this.handleSizeChange),(i=this._context)==null||i.domElement.removeEventListener("click",Vi(this,p1))}showNeedleLogo(t){this._userRequestedLogoVisible=t,!(!t&&(!Bh()||FK)&&(console.warn("Needle Menu: You need a PRO license to hide the Needle Engine logo."),!ka()))&&ng(this,f1,Iz).call(this,t)}setPosition(t){if(t!=="top"&&t!=="bottom")return console.error("NeedleMenu.setPosition: invalid position",t);this.root.classList.remove("top","bottom"),this.root.classList.add(t)}setVisible(t){this._userRequestedMenuVisible=t,this.style.display=t?"flex":"none"}closeFoldout(){this.root.classList.remove("open")}append(...t){for(const i of t)if(typeof i=="string"){const n=document.createTextNode(i);this.options.appendChild(n)}else this.options.appendChild(i)}appendChild(t){var n;if(!(t instanceof Node)){const r=document.createElement("button");if(r.textContent=t.label,r.onclick=t.onClick,r.setAttribute("priority",((n=t.priority)==null?void 0:n.toString())??"0"),t.title&&(r.title=t.title),t.icon){const o=bo(t.icon);t.iconSide==="right"?r.appendChild(o):r.prepend(o)}t.class&&r.classList.add(t.class),t=r}return this.options.appendChild(t)}prepend(...t){for(const i of t)if(typeof i=="string"){const n=document.createTextNode(i);this.options.prepend(n)}else this.options.prepend(i)}onChangeDetected(t){if(!this._isHandlingChange){this._isHandlingChange=!0;try{this.handleMenuVisible();for(const i of t)i.target==this.options&&this.onOptionsChildrenChanged(i)}finally{this._isHandlingChange=!1}}}onOptionsChildrenChanged(t){if(this.root.classList.toggle("has-options",this.hasAnyVisibleOptions),this.root.classList.toggle("has-no-options",!this.hasAnyVisibleOptions),this.handleSizeChange(void 0,!0),t.type==="childList"&&t.addedNodes.length>0){const i=Array.from(this.options.children);i.sort((r,o)=>{const a=parseInt(r.getAttribute("priority")||"0"),l=parseInt(o.getAttribute("priority")||"0");return a-l});let n=!1;for(let r=0;r<i.length;r++){const o=this.options.children[r],a=i[r];if(o!==a){n=!0;break}}if(n)for(const r of i)this.options.appendChild(r)}}handleMenuVisible(){lw&&console.log("Update VisibleState: Any Content?",this.hasAnyContent),this.hasAnyContent?this.root.style.display="":this.root.style.display="none",this.root.classList.toggle("has-options",this.hasAnyVisibleOptions),this.root.classList.toggle("has-no-options",!this.hasAnyVisibleOptions)}get hasAnyContent(){return!!(this.logoContainer.style.display!="none"||this.hasAnyVisibleOptions)}get hasAnyVisibleOptions(){for(let t=0;t<this.options.children.length;t++){const i=this.options.children[t];if(i.tagName==="SLOT"){const r=i.assignedNodes();for(const o of r)if(o instanceof HTMLElement&&o.style.display!="none")return!0}else if(i.style.display!="none")return!0}return!1}___insertDebugOptions(){window.addEventListener("keydown",n=>{n.key==="p"&&this.setPosition(this.root.classList.contains("top")?"bottom":"top")});const t=document.createElement("button");t.textContent="Hide Buttons",t.onclick=()=>{const n=new Array(this.options.children.length);for(let r=0;r<this.options.children.length;r++)n[r]=this.options.children[r];for(const r of n)this.options.removeChild(r);setTimeout(()=>{for(const r of n)this.options.appendChild(r)},1e3)},this.appendChild(t);const i=document.createElement("button");i.textContent="Toggle Logo",i.addEventListener("click",()=>{this.logoContainer.style.display=this.logoContainer.style.display==="none"?"":"none"}),this.appendChild(i)}};let A2=JZ;p1=new WeakMap,f1=new WeakSet,Iz=function(t){this.logoContainer.style.display="",this.logoContainer.style.opacity="1",this.logoContainer.style.visibility="visible",t?(this.root.classList.remove("logo-hidden"),this.root.classList.add("logo-visible")):(this.root.classList.remove("logo-visible"),this.root.classList.add("logo-hidden"))};customElements.get(Bb)||customElements.define(Bb,A2);const fr=ee("debugcontext"),mGe=ee("stats"),gGe=ee("debugactive"),AGe=ee("debugframerate"),yGe=ee("debugcoroutine"),bGe={};class xGe{constructor(){p(this,"name");p(this,"alias");p(this,"hash");p(this,"runInBackground");p(this,"domElement");p(this,"renderer");p(this,"camera");p(this,"scene")}}var wn=(s=>(s[s.Start=-1]="Start",s[s.EarlyUpdate=0]="EarlyUpdate",s[s.Update=1]="Update",s[s.LateUpdate=2]="LateUpdate",s[s.OnBeforeRender=3]="OnBeforeRender",s[s.OnAfterRender=4]="OnAfterRender",s[s.PrePhysicsStep=9]="PrePhysicsStep",s[s.PostPhysicsStep=10]="PostPhysicsStep",s[s.Undefined=-1]="Undefined",s))(wn||{});function _P(s,e){if(!s)return;if(!s.isComponent){(Qe()||fr)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,s);return}e||(e=Wt.Current,fr&&console.warn("> Registering component without context"));const t=e==null?void 0:e.new_scripts;t.includes(s)||t.push(s)}const En=class{constructor(e){p(this,"name");p(this,"alias");p(this,"isManagedExternally",!1);p(this,"isPaused",!1);p(this,"runInBackground",!1);p(this,"targetFrameRate");p(this,"physicsSteps",1);p(this,"hash");p(this,"domElement");p(this,"_resolutionScaleFactor",1);p(this,"_boundingClientRectFrame",-1);p(this,"_boundingClientRect",null);p(this,"_domX");p(this,"_domY");p(this,"xr",null);p(this,"_xrFrame",null);p(this,"_currentFrameEvent",-1);p(this,"scene");p(this,"renderer");p(this,"composer",null);p(this,"scripts",[]);p(this,"scripts_pausedChanged",[]);p(this,"scripts_earlyUpdate",[]);p(this,"scripts_update",[]);p(this,"scripts_lateUpdate",[]);p(this,"scripts_onBeforeRender",[]);p(this,"scripts_onAfterRender",[]);p(this,"scripts_WithCorroutines",[]);p(this,"scripts_immersive_vr",[]);p(this,"scripts_immersive_ar",[]);p(this,"coroutines",{});p(this,"post_setup_callbacks",[]);p(this,"pre_update_callbacks",[]);p(this,"pre_render_callbacks",[]);p(this,"post_render_callbacks",[]);p(this,"pre_update_oneshot_callbacks",[]);p(this,"new_scripts",[]);p(this,"new_script_start",[]);p(this,"new_scripts_pre_setup_callbacks",[]);p(this,"new_scripts_post_setup_callbacks",[]);p(this,"new_scripts_xr",[]);p(this,"mainCameraComponent");p(this,"_mainCamera",null);p(this,"_fallbackCamera",null);p(this,"application");p(this,"animations");p(this,"time");p(this,"input");p(this,"physics");p(this,"connection");p(this,"assets");p(this,"mainLight",null);p(this,"sceneLighting");p(this,"addressables");p(this,"lightmaps");p(this,"players");p(this,"lodsManager");p(this,"menu");p(this,"_sizeChanged",!1);p(this,"_isCreated",!1);p(this,"_isCreating",!1);p(this,"_isVisible",!1);p(this,"_stats",mGe?new dTe:null);p(this,"_intersectionObserver",null);p(this,"_disposeCallbacks",[]);p(this,"maxRenderResolution");p(this,"_originalCreationArgs");p(this,"onUnhandledRejection",e=>{this.onError(e.reason)});p(this,"_cameraStack",[]);p(this,"_onBeforeRenderListeners",new Map);p(this,"_onAfterRenderListeners",new Map);p(this,"_requireDepthTexture",!1);p(this,"_requireColorTexture",!1);p(this,"_renderTarget");p(this,"_isRendering",!1);p(this,"_createId",0);p(this,"_renderlooperrors",0);p(this,"_lastTimestamp",0);p(this,"_accumulatedTime",0);p(this,"_dispatchReadyAfterFrame",!1);p(this,"_wasPaused",!1);this.name=(e==null?void 0:e.name)||"",this.alias=e==null?void 0:e.alias,this.domElement=(e==null?void 0:e.domElement)||document.body,this.hash=e==null?void 0:e.hash,e!=null&&e.renderer&&(this.renderer=e.renderer,this.isManagedExternally=!0),(e==null?void 0:e.runInBackground)!==void 0&&(this.runInBackground=e.runInBackground),e!=null&&e.scene?this.scene=e.scene:this.scene=new sr,e!=null&&e.camera&&(this._mainCamera=e.camera),this.application=new Lh(this),this.time=new toe,this.input=new Qne(this),this.physics=new ex(this),this.connection=new Zse(this),this.assets=new jse,this.sceneLighting=new $re(this),this.addressables=new Fre(this),this.lightmaps=new tGe(this),this.players=new qre(this),this.menu=new fGe(this),this.lodsManager=new iGe(this),this.animations=new BPe(this);const t=()=>this._sizeChanged=!0;window.addEventListener("resize",t),this._disposeCallbacks.push(()=>window.removeEventListener("resize",t));const i=new ResizeObserver(n=>this._sizeChanged=!0);i.observe(this.domElement),this._disposeCallbacks.push(()=>i.disconnect()),this._intersectionObserver=new IntersectionObserver(n=>{this._isVisible=n[0].isIntersecting}),this._disposeCallbacks.push(()=>{var n;return(n=this._intersectionObserver)==null?void 0:n.disconnect()}),Oi.register(this)}static get DefaultTargetFrameRate(){return En._defaultTargetFramerate.value}static set DefaultTargetFrameRate(e){En._defaultTargetFramerate.value=e}static get DefaultWebGLRendererParameters(){return En._defaultWebglRendererParameters}get version(){return Eh}static get Current(){return Oi.Current}static set Current(e){Oi.Current=e}appendHTMLElement(e){return this.domElement.shadowRoot?this.domElement.shadowRoot.appendChild(e):this.domElement.appendChild(e)}get resolutionScaleFactor(){return this._resolutionScaleFactor}set resolutionScaleFactor(e){if(e!==this._resolutionScaleFactor&&typeof e=="number"){if(e<=0){console.error("Invalid resolution scale factor",e);return}this._resolutionScaleFactor=e,this.updateSize()}}calculateBoundingClientRect(){if(this.xr){this._domX=0,this._domY=0;return}this._boundingClientRectFrame!==this.time.frame&&(this._boundingClientRectFrame=this.time.frame,this._boundingClientRect=this.domElement.getBoundingClientRect(),this._domX=this._boundingClientRect.x,this._domY=this._boundingClientRect.y)}get domWidth(){return this.isInAR?window.innerWidth:this.domElement.clientWidth}get domHeight(){return this.isInAR?window.innerHeight:this.domElement.clientHeight}get domX(){return this.calculateBoundingClientRect(),this._domX}get domY(){return this.calculateBoundingClientRect(),this._domY}get isInXR(){var e,t;return((t=(e=this.renderer)==null?void 0:e.xr)==null?void 0:t.isPresenting)||!1}get xrSessionMode(){var e;return(e=this.xr)==null?void 0:e.mode}get isInVR(){return this.xrSessionMode==="immersive-vr"}get isInAR(){return this.xrSessionMode==="immersive-ar"}get isInPassThrough(){return this.xr?this.xr.isPassThrough:!1}get xrSession(){var e,t;return(t=(e=this.renderer)==null?void 0:e.xr)==null?void 0:t.getSession()}get xrFrame(){return this._xrFrame}get xrCamera(){var e,t;return this.renderer.xr.isPresenting?(t=(e=this.renderer)==null?void 0:e.xr)==null?void 0:t.getCamera():void 0}get arOverlayElement(){const e=this.domElement;return typeof e.getAROverlayContainer=="function"?e.getAROverlayContainer():this.domElement}get currentFrameEvent(){return this._currentFrameEvent}get mainCamera(){if(this._mainCamera)return this._mainCamera;if(this.mainCameraComponent){const e=this.mainCameraComponent;return e.threeCamera||e.buildCamera(),e.threeCamera}return this._fallbackCamera||(this._fallbackCamera=new Xt(75,this.domWidth/this.domHeight,.1,1e3)),this._fallbackCamera}set mainCamera(e){this._mainCamera=e}get rendererData(){return this.sceneLighting}get isCreated(){return this._isCreated}createNewRenderer(e){var t,i,n;if((t=this.renderer)==null||t.dispose(),e={...En.DefaultWebGLRendererParameters,...e},!e.canvas){const r=(n=(i=this.domElement)==null?void 0:i.shadowRoot)==null?void 0:n.querySelector("canvas");r&&(e.canvas=r,fr&&console.log("Using canvas from shadow root",r))}fr&&console.log("Using Renderer Parameters:",e,this.domElement),this.renderer=new Mm(e),this.renderer.debug.checkShaderErrors=Qe()||ee("checkshadererrors")===!0,this.renderer.toneMappingExposure=1,this.renderer.toneMapping=Zr,this.renderer.setClearColor(new ge("lightgrey"),0),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=yU,this.renderer.setSize(this.domWidth,this.domHeight),this.renderer.outputColorSpace=ft,this.renderer.nodes={library:new gte,modelViewMatrix:null,modelNormalViewMatrix:null},this.lodsManager.setRenderer(this.renderer),this.input.bindEvents()}internalOnUpdateVisible(){var e,t;(e=this._intersectionObserver)==null||e.disconnect(),(t=this._intersectionObserver)==null||t.observe(this.domElement)}requestSizeUpdate(){this._sizeChanged=!0}updateSize(e=!1){var t,i,n;if(e||!this.isManagedExternally&&((t=this.renderer.xr)==null?void 0:t.isPresenting)===!1){this._sizeChanged=!1;const r=this.resolutionScaleFactor;let o=this.domWidth*r,a=this.domHeight*r;this.maxRenderResolution&&(this.maxRenderResolution.x=Math.max(1,this.maxRenderResolution.x),o=Math.min(this.maxRenderResolution.x,o),this.maxRenderResolution.y=Math.max(1,this.maxRenderResolution.y),a=Math.min(this.maxRenderResolution.y,a));const l=this.mainCamera;this.updateAspect(l),this.renderer.setSize(o,a,!0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.composer&&((i=this.composer.setSize)==null||i.call(this.composer,o,a),"setPixelRatio"in this.composer&&typeof this.composer.setPixelRatio=="function"&&((n=this.composer.setPixelRatio)==null||n.call(this.composer,window.devicePixelRatio)))}}updateAspect(e,t,i){if(!e)return;t===void 0&&(t=this.domWidth),i===void 0&&(i=this.domHeight);const n=e.aspect;e.aspect=t/i,n!==e.aspect&&e.updateProjectionMatrix()}recreate(){this.clear(),this.create(this._originalCreationArgs)}async onCreate(e){return this.create(e)}async create(e){try{this._isCreating=!0,e!==this._originalCreationArgs&&(this._originalCreationArgs=Y1(e)),window.addEventListener("unhandledrejection",this.onUnhandledRejection);const t=await this.internalOnCreate(e);return this._isCreated=t,t}finally{window.removeEventListener("unhandledrejection",this.onUnhandledRejection),this._isCreating=!1}}onError(e){this.domElement.dispatchEvent(new CustomEvent("error",{detail:e}))}clear(){var e,t,i,n;Oi.dispatchCallback(ji.ContextClearing,this),$h(this,ji.ContextClearing),ic(this.scene,!0,!0),this.scene=new sr,(e=this.addressables)==null||e.dispose(),(t=this.lightmaps)==null||t.clear(),(n=(i=this.physics)==null?void 0:i.engine)==null||n.clearCaches(),this.lodsManager.disable(),this.isManagedExternally||this.renderer&&(this.renderer.renderLists.dispose(),this.renderer.state.reset(),this.renderer.resetState()),Oi.dispatchCallback(ji.ContextCleared,this)}dispose(){this.internalOnDestroy()}onDestroy(){this.internalOnDestroy()}internalOnDestroy(){var e,t;En.Current=this,Oi.dispatchCallback(ji.ContextDestroying,this),$h(this,ji.ContextDestroying),this.clear(),(e=this.renderer)==null||e.setAnimationLoop(null),this.renderer&&(this.renderer.setClearAlpha(0),this.renderer.clear(),this.isManagedExternally||(fr&&console.log("Disposing renderer"),this.renderer.dispose())),this.scene=null,this.renderer=null,this.input.dispose(),this.menu.onDestroy(),this.animations.onDestroy();for(const i of this._disposeCallbacks)try{i()}catch(n){console.error("Error in on dispose callback:",n,i)}(t=this.domElement)!=null&&t.parentElement&&this.domElement.parentElement.removeChild(this.domElement),this._isCreated=!1,Oi.dispatchCallback(ji.ContextDestroyed,this),$h(this,ji.ContextDestroyed),Oi.unregister(this),En.Current===this&&(En.Current=null)}registerCoroutineUpdate(e,t,i){return typeof(t==null?void 0:t.next)!="function"?(console.error("Registered invalid coroutine function from "+e.name+`
Coroutine functions must be generators: "*myCoroutine() {...}"
Start a coroutine from a component by calling "this.startCoroutine(myCoroutine())"`),t):(this.coroutines[i]||(this.coroutines[i]=[]),this.coroutines[i].push({comp:e,main:t}),t)}unregisterCoroutineUpdate(e,t){if(!this.coroutines[t])return;const i=this.coroutines[t].findIndex(n=>n.main===e);i>=0&&this.coroutines[t].splice(i,1)}stopAllCoroutinesFrom(e){for(const t in this.coroutines){const i=this.coroutines[t];for(let n=i.length-1;n>=0;n--)i[n].comp===e&&i.splice(n,1)}}setCurrentCamera(e){var n;if(!e)return;if(e.threeCamera||e.buildCamera(),!e.threeCamera){console.warn("Camera component is missing camera",e);return}const t=this._cameraStack.indexOf(e);t>=0&&this._cameraStack.splice(t,1),this._cameraStack.push(e),this.mainCameraComponent=e;const i=e.threeCamera;i.isPerspectiveCamera&&this.updateAspect(i),(n=this.mainCameraComponent)==null||n.applyClearFlagsIfIsActiveCamera()}removeCamera(e){if(!e)return;const t=this._cameraStack.indexOf(e);if(t>=0&&this._cameraStack.splice(t,1),this.mainCameraComponent===e&&(this.mainCameraComponent=void 0,this._cameraStack.length>0)){const i=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(i)}}addBeforeRenderListener(e,t){this._onBeforeRenderListeners.has(e.uuid)||(this._onBeforeRenderListeners.set(e.uuid,[]),e.onBeforeRender=this._createRenderCallbackWrapper(e,this._onBeforeRenderListeners)),this._onBeforeRenderListeners.get(e.uuid).push(t)}removeBeforeRenderListener(e,t){if(this._onBeforeRenderListeners.has(e.uuid)){const i=this._onBeforeRenderListeners.get(e.uuid),n=i.indexOf(t);n>=0&&i.splice(n,1)}}addAfterRenderListener(e,t){var i;this._onAfterRenderListeners.has(e.uuid)||(this._onAfterRenderListeners.set(e.uuid,[]),e.onAfterRender=this._createRenderCallbackWrapper(e,this._onAfterRenderListeners)),(i=this._onAfterRenderListeners.get(e.uuid))==null||i.push(t)}removeAfterRenderListener(e,t){if(this._onAfterRenderListeners.has(e.uuid)){const i=this._onAfterRenderListeners.get(e.uuid),n=i.indexOf(t);n>=0&&i.splice(n,1)}}_createRenderCallbackWrapper(e,t){return(i,n,r,o,a,l)=>{const c=t.get(e.uuid);if(c)for(let h=0;h<c.length;h++){const d=c[h];d(i,n,r,o,a,l)}}}get isRendering(){return this._isRendering}setRequireDepth(e){this._requireDepthTexture=e}setRequireColor(e){this._requireColorTexture=e}get depthTexture(){var e;return((e=this._renderTarget)==null?void 0:e.depthTexture)||null}get opaqueColorTexture(){var e;return((e=this._renderTarget)==null?void 0:e.texture)||null}get isVisibleToUser(){if(this.isInXR)return!0;if(!this._isVisible)return!1;const e=getComputedStyle(this.domElement);return e.visibility!=="hidden"&&e.display!=="none"&&e.opacity!=="0"}async internalOnCreate(e){var a,l,c,h,d,u,f,m;const t=++this._createId;fr&&console.log("Creating context",this.name,e);const i=globalThis["needle:dependencies:ready"];i instanceof Promise&&(fr&&console.log("Waiting for dependencies to be ready"),await i.catch(g=>{if(fr||Qe()){if(tM("Needle Engine dependencies failed to load. Please check the console for more details"),g instanceof ReferenceError){let A="YourComponentName";const y=g.message.indexOf("'");if(y>0){const b=g.message.indexOf("'",y+1);if(b>0){const x=g.message.substring(y+1,b);x.length>3&&(A=x)}}console.error(`Needle Engine dependencies failed to load:

# Make sure you don't have circular imports in your scripts!
→ Possible solution: Replace @serializable(${A}) in your script with @serializable(Behaviour)

---`,g);return}console.error("Needle Engine dependencies failed to load",g)}}).then(()=>{fr&&console.log("Needle Engine dependencies are ready")})),this.clear(),this.isManagedExternally===!1&&(this.createNewRenderer(),(a=this.renderer)==null||a.setAnimationLoop(null)),await Nh(1),En.Current=this,await Oi.dispatchCallback(ji.ContextCreationStart,this);let n=!0,r;try{En.Current=this,e?r=await this.internalLoadInitialContent(t,e):r=[]}catch(g){console.error(g),n=!1}if(!n)return this.onError("Failed to load initial content"),!1;if(t!==this._createId||(l=e==null?void 0:e.abortSignal)!=null&&l.aborted)return!1;if(this.internalOnUpdateVisible(),!this.renderer)return fr&&console.warn("Context has no renderer (perhaps it was disconnected?",this.domElement.isConnected),!1;!this.isManagedExternally&&!this.domElement.shadowRoot&&this.domElement.prepend(this.renderer.domElement),En.Current=this,En.Current=this;for(let g=0;g<this.new_scripts.length;g++){const A=this.new_scripts[g];if(A.gameObject!==void 0&&A.gameObject!==null){A.gameObject.userData===void 0&&(A.gameObject.userData={}),A.gameObject.userData.components===void 0&&(A.gameObject.userData.components=[]);const y=A.gameObject.userData.components;y.includes(A)||y.push(A)}}if(this.post_setup_callbacks)for(let g=0;g<this.post_setup_callbacks.length;g++)En.Current=this,await this.post_setup_callbacks[g](this);if(!this._mainCamera){En.Current=this;let g=null;tA(this.scene,A=>{const y=A;if(y!=null&&y.isCamera){if(ow(y.gameObject),!y.activeAndEnabled)return;if(y.tag==="MainCamera")return g=y,!0;g=y}}),g?this.setCurrentCamera(g):!Oi.dispatchCallback(ji.MissingCamera,this,{files:r})&&!this.mainCamera&&!this.isManagedExternally&&console.warn("Missing camera in main scene",this)}if(this.input.bindEvents(),En.Current=this,r2(this),this.physics.engine&&((c=this.physics.engine)==null||c.step(0),(h=this.physics.engine)==null||h.postStep()),!this.isManagedExternally&&this.composer&&this.mainCamera){const g=new iP(this.scene,this.mainCamera);this.renderer.setSize(this.domWidth,this.domHeight),this.composer.addPass(g),this.composer.setSize(this.domWidth,this.domHeight)}this._sizeChanged=!0,this._stats&&(this._stats.showPanel(0),this._stats.dom.style.position="absolute",(d=this.domElement.shadowRoot)==null||d.appendChild(this._stats.dom)),fr&&YL(this.scene,!0),this.targetFrameRate===void 0?(fr&&console.warn("No target framerate set, using default",En.DefaultTargetFrameRate),this.targetFrameRate=En._defaultTargetFramerate):fr&&console.log("Target framerate set to",this.targetFrameRate),this._dispatchReadyAfterFrame=!0;const o=Oi.dispatchCallback(ji.ContextCreated,this,{files:r});return o&&("internalSetLoadingMessage"in this.domElement&&typeof this.domElement.internalSetLoadingMessage=="function"&&((u=this.domElement)==null||u.internalSetLoadingMessage("finish loading")),await o),(f=e==null?void 0:e.abortSignal)!=null&&f.aborted?!1:($h(this,ji.ContextCreated),fr&&console.log("Context Created...",this.renderer,this.renderer.domElement),this._isCreating=!1,!this.isManagedExternally&&!((m=e==null?void 0:e.abortSignal)!=null&&m.aborted)&&this.restartRenderLoop(),!0)}async internalLoadInitialContent(e,t){var l,c,h,d;const i=new Array;if(t.files.length===0)return i;const n=[...t.files],r={name:"",progress:null,index:0,count:n.length},o=kh(),a=0;for(let u=0;u<n.length;u++){if((l=t.abortSignal)!=null&&l.aborted){fr&&console.log("Aborting loading because of abort signal");break}if(e!==this._createId){fr&&console.log("Aborting loading because create id changed",e,this._createId);break}const f=n[u];(c=t==null?void 0:t.onLoadingStart)==null||c.call(this,u,f),fr&&console.log("Context Load "+f);const m=await o.loadSync(this,f,f,a,g=>{var A,y;(A=t.abortSignal)!=null&&A.aborted||(r.name=f,r.progress=g,r.index=u,r.count=n.length,(y=t.onLoadingProgress)==null||y.call(this,r))});(h=t==null?void 0:t.onLoadingFinished)==null||h.call(this,u,f,m??null),m?i.push({src:f,file:m}):console.warn("Could not load file: "+f)}if(e!==this._createId||(d=t.abortSignal)!=null&&d.aborted){for(const u of i)if(u&&u.file)for(const f of u.file.scenes)ic(f,!0,!0)}else{let u=!1;for(const f of i)f&&f.file&&(f.file.scene?(u=!0,this.scene.add(f.file.scene)):console.warn("No scene found in loaded file"));if(!u){for(const f of i)if(f&&f.file&&"parser"in f.file){let m=0;if(!Array.isArray(f.file.parser.json.materials))continue;for(let g=0;g<f.file.parser.json.materials.length;g++){const A=await f.file.parser.getDependency("material",g),y=new ye;y.position.x=g*1.1,y.position.y=m,this.scene.add(y),zm.createPrimitive("ShaderBall",{parent:y,material:A})}m+=1}}}return i}restartRenderLoop(){return this.renderer?this._isCreating?(console.warn("Can not start render loop while creating context"),!1):(this.renderer.setAnimationLoop((e,t)=>{this.isManagedExternally||this.update(e,t)}),!0):(console.error("Can not start render loop without renderer"),!1)}update(e,t){if(t===void 0&&(t=null),Qe()||fr||EBe())try{performance.mark("update.start"),this.internalStep(e,t),this._renderlooperrors=0,performance.mark("update.end"),performance.measure("NE Frame","update.start","update.end")}catch(i){this._renderlooperrors+=1,(Qe()||fr)&&(i instanceof Error||i instanceof TypeError)&&is("Caught unhandled exception during render-loop - see console for details.",zl.Error),console.error("Frame #"+this.time.frame+`
`,i),this._renderlooperrors>=3&&(console.warn("Stopping render loop due to error"),this.renderer.setAnimationLoop(null)),this.domElement.dispatchEvent(new CustomEvent("error",{detail:i}))}else this.internalStep(e,t)}updatePhysics(e){this.internalUpdatePhysics(e)}internalStep(e,t){this.internalOnBeforeRender(e,t)!==!1&&(this.internalOnRender(),this.internalOnAfterRender())}internalOnBeforeRender(e,t){var n;this.renderer.info.autoReset=!0;const i=t!==null&&this._xrFrame===null;if(this._xrFrame=t,i&&this.domElement.dispatchEvent(new CustomEvent("xr-session-started",{detail:{context:this,session:this.xrSession,frame:t}})),this._currentFrameEvent=-1,this.isManagedExternally===!1&&this.isInXR===!1&&this.targetFrameRate!==void 0){this._lastTimestamp===0&&(this._lastTimestamp=e),this._accumulatedTime+=(e-this._lastTimestamp)/1e3,this._lastTimestamp=e;let r=this.targetFrameRate;if(typeof r=="object"&&(r=r.value),this._accumulatedTime<1/(r+1))return!1;this._accumulatedTime=0}if((n=this._stats)==null||n.begin(),En.Current=this,this.onHandlePaused())return!1;for(En.Current=this,this.time.update(),AGe&&console.log("FPS",this.time.smoothedFps.toFixed(0)),r2(this),BR(this.scene),rre(this),$h(this,-1);this._cameraStack.length>0&&(!this.mainCameraComponent||this.mainCameraComponent.destroyed);){this._cameraStack.splice(this._cameraStack.length-1,1);const r=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(r)}if(this.pre_update_oneshot_callbacks){for(const r in this.pre_update_oneshot_callbacks)this.pre_update_oneshot_callbacks[r]();this.pre_update_oneshot_callbacks.length=0}if(this.pre_update_callbacks)for(const r in this.pre_update_callbacks)this.pre_update_callbacks[r]();this._currentFrameEvent=0;for(let r=0;r<this.scripts_earlyUpdate.length;r++){const o=this.scripts_earlyUpdate[r];o.activeAndEnabled&&o.earlyUpdate!==void 0&&(En.Current=this,o.earlyUpdate())}if(this.executeCoroutines(0),$h(this,0),this.onHandlePaused())return!1;this._currentFrameEvent=1;for(let r=0;r<this.scripts_update.length;r++){const o=this.scripts_update[r];o.activeAndEnabled&&o.update!==void 0&&(En.Current=this,o.update())}if(this.executeCoroutines(1),$h(this,1),this.onHandlePaused())return!1;this._currentFrameEvent=2;for(let r=0;r<this.scripts_lateUpdate.length;r++){const o=this.scripts_lateUpdate[r];o.activeAndEnabled&&o.lateUpdate!==void 0&&(En.Current=this,o.lateUpdate())}if(this.executeCoroutines(2),$h(this,2),this.onHandlePaused()||(this.physicsSteps===void 0&&(this.physicsSteps=1),this.physics.engine&&this.physicsSteps>0&&this.internalUpdatePhysics(this.physicsSteps),this.onHandlePaused()))return!1;if(this.isVisibleToUser||this.runInBackground){this._currentFrameEvent=3;for(let r=0;r<this.scripts_onBeforeRender.length;r++){const o=this.scripts_onBeforeRender[r];o.activeAndEnabled&&o.onBeforeRender!==void 0&&(En.Current=this,o.onBeforeRender(t))}if(this.executeCoroutines(3),$h(this,3),this._sizeChanged&&this.updateSize(),this.pre_render_callbacks)for(const r in this.pre_render_callbacks)this.pre_render_callbacks[r](t)}return!0}internalUpdatePhysics(e){if(!this.physics.engine)return!1;const t=e,i=this.time.deltaTime/t;for(let n=0;n<t;n++)this._currentFrameEvent=9,this.executeCoroutines(9),this.physics.engine.step(i),this._currentFrameEvent=10,this.executeCoroutines(10);return this.physics.engine.postStep(),!0}internalOnRender(){this.isManagedExternally||(PBe(this),this._currentFrameEvent=-1,tne.update(),this.renderNow(),this._currentFrameEvent=4)}internalOnAfterRender(){if(this.isVisibleToUser||this.runInBackground){for(let e=0;e<this.scripts_onAfterRender.length;e++){const t=this.scripts_onAfterRender[e];t.activeAndEnabled&&t.onAfterRender!==void 0&&(En.Current=this,t.onAfterRender())}if(this.executeCoroutines(4),$h(this,4),this.post_render_callbacks)for(const e in this.post_render_callbacks)this.post_render_callbacks[e]()}this._currentFrameEvent=-1,this.connection.sendBufferedMessagesNow(),this._stats&&(this._stats.end(),this.time.frameCount%150===0&&console.log(this.renderer.info.render.calls+" DrawCalls",`
Render:`,{...this.renderer.info.render},`
Memory:`,{...this.renderer.info.memory},`
Target Framerate: `+this.targetFrameRate)),this._dispatchReadyAfterFrame&&(this._dispatchReadyAfterFrame=!1,this.domElement.dispatchEvent(new CustomEvent("ready")),Oi.dispatchCallback(ji.ContextFirstFrameRendered,this))}renderNow(e){var t;return!e&&(e=this.mainCamera,!e)?!1:(this.handleRendererContextLost(),this._isRendering=!0,this.renderRequiredTextures(),this.renderer.toneMapping!==Zr&&ioe(),this.composer&&!this.isInXR?(e&&((t=this.composer.passes[0])==null?void 0:t.mainCamera)!=e&&this.composer.setMainCamera(e),this.composer.render(this.time.deltaTime)):e&&(this.isInXR&&exports.DeviceUtilities.isMacOS()&&this.renderer.clearDepth(),this.renderer.render(this.scene,e)),this._isRendering=!1,!0)}handleRendererContextLost(){this.renderer.getContext().isContextLost()&&(console.warn("Attempting to recover WebGL context..."),this.renderer.forceContextRestore())}onHandlePaused(){const e=this.evaluatePaused();if(this._wasPaused!==e){gGe&&console.log("Paused?",e,"context:"+this.alias);for(let t=0;t<this.scripts_pausedChanged.length;t++){const i=this.scripts_pausedChanged[t];i.activeAndEnabled&&i.onPausedChanged!==void 0&&(En.Current=this,i.onPausedChanged(e,this._wasPaused))}}return this._wasPaused=e,e}evaluatePaused(){return this.isInXR?!1:this.isPaused?!0:this.runInBackground?!1:!this.isVisibleToUser}renderRequiredTextures(){if(!this.mainCamera||!this._requireDepthTexture&&!this._requireColorTexture)return;if(!this._renderTarget){if(this._renderTarget=new ci(this.domWidth,this.domHeight),this._requireDepthTexture){const i=new Bp(this.domWidth,this.domHeight);this._renderTarget.depthTexture=i}this._requireColorTexture&&(this._renderTarget.texture=new si,this._renderTarget.texture.generateMipmaps=!1,this._renderTarget.texture.minFilter=qt,this._renderTarget.texture.magFilter=qt,this._renderTarget.texture.format=bi)}const e=this._renderTarget;e.texture&&(e.texture.colorSpace=this.renderer.outputColorSpace);const t=this.renderer.getRenderTarget();this.renderer.setRenderTarget(e),this.renderer.render(this.scene,this.mainCamera),this.renderer.setRenderTarget(t)}executeCoroutines(e){var i;if(this.coroutines[e]){const n=this.coroutines[e];for(let r=0;r<n.length;r++)try{const o=n[r];if(!o.comp||o.comp.destroyed||!o.main||o.comp.enabled===!1){yGe&&console.log("Removing coroutine",o.comp,o.comp.enabled),n.splice(r,1),--r;continue}const l=o.chained;if(l&&l.length>0){const u=l[l.length-1].next();if(u.done&&l.pop(),t(u)&&(o.chained||(o.chained=[]),o.chained.push(u.value)),!u.done)continue}const c=o.main.next();if(c.done===!0){n.splice(r,1),--r;continue}const h=c.value;if(t(h)){if(h.next().done)continue;o.chained||(o.chained=[]),o.chained.push(h)}else if(h instanceof Promise){const d=h;o.chained||(o.chained=[]);const u=Xre(d);(i=o.chained)==null||i.push(u);continue}}catch(o){console.error(o)}}function t(n){return!!(n&&n.next&&n.return)}}};let Wt=En;p(Wt,"_defaultTargetFramerate",{value:90,toString(){return this.value}}),p(Wt,"_defaultWebglRendererParameters",{antialias:!0,alpha:!1,powerPreference:exports.DeviceUtilities.isiOS()||exports.DeviceUtilities.isMacOS()?"default":"high-performance",stencil:!0});const Lc=ee("debuglicense");let L0="basic";Lc&&console.log("License Type: "+L0);function Yf(){switch(L0){case"pro":case"enterprise":return!0}return!1}function y5(){switch(L0){case"indie":return!0}return!1}function Bh(){return Yf()||y5()}const ooe=[];function vGe(s){if(Yf()||y5())return s(!0);ooe.push(s)}function _Ge(s){for(const e of ooe)try{e(s)}catch{}}Oi.registerCallback(ji.ContextRegistered,s=>{SGe(s.context),IGe(),wGe(s.context)});let Jf,Tz=!1,bC="";async function CGe(){if(Jf)return Jf;if(L0==="basic")try{const s="https://engine.needle.tools/licensing/check?location="+encodeURIComponent(window.location.href)+"&version="+Eh+"&generator="+encodeURIComponent(eP),e=await fetch(s,{method:"GET"}).catch(t=>{Lc&&console.error("License check failed",t)});(e==null?void 0:e.status)===200?(Tz=!1,Lc&&console.log("License check succeeded"),L0="pro",_Ge(!0)):(e==null?void 0:e.status)===403?(Tz=!0,bC=await e.text()):Lc&&console.log("License check failed with status "+(e==null?void 0:e.status))}catch(s){Lc&&console.error("License check failed",s)}else Lc&&console.log('Runtime license check is skipped because license is already applied as "'+L0+'"')}Jf=CGe();async function wGe(s){function e(){const n=document.createElement("div");n.className="needle-forbidden",n.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: all;
        zIndex: 2147483647;
        line-height: 1.5;
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        `;const r=n.style.cssText,o=document.createElement("div");n.appendChild(o),o.style.cssText=`
        position: absolute;
        left: 0;
        right: 0;
        top:0;
        bottom: 0;
        padding: 10%;
        color: white;
        font-size: 20px;
        font-family: sans-serif;
        text-align: center;
        pointer-events: all;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: rgba(0,0,0,.3);
        text-shadow: 0 0 2px black;
        `;const a=o.style.cssText,l=(bC==null?void 0:bC.length)>1?bC:"This web application has been paused.<br/>You might be in violation of the Needle Engine terms of use.<br/>Please contact the Needle support if you think this is a mistake.";return o.innerHTML=l,setInterval(()=>{o.innerHTML!==l&&(o.innerHTML=l),o.parentNode!==n&&n.appendChild(o),n.style.cssText!==r&&(n.style.cssText=r),o.style.cssText!==a&&(o.style.cssText=a)},500),n}let t=e();const i=t.style.cssText;setInterval(()=>{var n;Tz===!0&&(t.style.cssText!==i&&(t=e()),s.domElement.shadowRoot?t.parentNode!==s.domElement.shadowRoot&&((n=s.domElement.shadowRoot)==null||n.appendChild(t)):t.parentNode!=document.body&&document.body.appendChild(t))},500)}async function SGe(s){try{if(Bh()!==!0)return eD(s)}catch(e){return Lc&&console.log("License check failed",e),eD(s)}Lc&&eD(s)}async function eD(s){s.domElement.addEventListener("ready",()=>!0),await(Jf==null?void 0:Jf.catch(()=>{})),!Bh()&&MGe()}let VK=0;async function MGe(s){var o;const e=Date.now();if(e-VK<2e3)return;VK=e;const i=`
        position: relative;
        display: block;
        font-size: 18px;
        background-size: 20px;
        background-position: 10px 5px;
        background-repeat:no-repeat;
        background-image:url('data:image/webp;base64,UklGRrABAABXRUJQVlA4WAoAAAAQAAAAHwAAHwAAQUxQSKEAAAARN6CmbSM4WR7vdARON11EBDq3fLiNbVtVzpMCPlKAEzsx0Y/x+Ovuv4dn0EFE/ydAvz6YggXzgh5sVgXM/zOC/4sii7qgGvB5N7hmuQYwkvazWAu1JPW41FXSHq6pnaQWvqYH18Fc0j1hO/BFTtIeSBlJi5w6qIIO7IOrwhFsB2Yxukif0FTRLpXswHR8MxbslKe9VZsn/Ub5C7YFOpqSTABWUDgg6AAAAFAGAJ0BKiAAIAA+7VyoTqmkpCI3+qgBMB2JbACdMt69DwMIQBLhkTO6XwY00UEDK6cNIDnuNibPf0EgAP7Y1myuiQHLDsF/0h5unrGh6WAbv7aegg2ZMd3uRKfT/3SJztcaujYfTvMXspfCTmYcoO6a+vhC3ss4M8uM58t4siiu59I4aOl59e9Sr6xoxYlHf2v+NnBNpJYeJf8jABQAId/PXuBkLEFkiCucgSGEcfhvajql/j3reCGl0M5/9gQWy7ayNPs+wlvIxFnNfSlfuND4CZOCyxOHhRqOmHN4ULHo3tCSrUNvgAA=');
        background-max-size: 40px;
        margin-bottom: 5px;
        margin-top: .3em;
        margin-bottom: .5em;
        padding: .2em;
        padding-left: 25px;
        border-radius: .5em;
        border: 2px solid rgba(160,160,160,.3);
    `,r=`Needle Engine — No license active, commercial use is not allowed. Visit https://needle.tools/pricing for more information and licensing options! v${Eh}`;(o=Wt.Current)!=null&&o.xr?console.log(r):console.log("%c "+r,i)}async function IGe(){var s;if(!window.crossOriginIsolated)try{const e="https://needle-engine-analytics-v2-r26roub2hq-lz.a.run.app";if(e){Lc&&console.log("Analytics backend url",e);const t=window.location.href.split("?")[0];let i="api/v2/new/request";e.endsWith("/")||(i="/"+i);const n=L0,r=`${e}${i}`;Lc&&console.log("Sending non-commercial usage message to analytics backend",r);const o={license:n,url:t,hostname:window.location.hostname,pathname:window.location.pathname,version:Eh,generator:eP,build_time:CO,public_key:YC},a=(s=navigator.sendBeacon)==null?void 0:s.call(navigator,r,JSON.stringify(o));Lc&&console.log("Send beacon result",a)}}catch(e){Lc&&console.log("Failed to send non-commercial usage message to analytics backend",e)}}const e0=ee("debugloading"),I_=ee("debugloadingrendering"),zK=ee("debuglicense");class TGe{constructor(){p(this,"className");p(this,"additionalClasses")}}let T_=0,UK;function b5(s){e0&&console.log(s.progress.loaded.toFixed(0)+"/"+s.progress.total.toFixed(0),s);const e=s.count,t=s.progress.total;t===0||t===void 0?(UK!==s.name&&(T_=0),UK=s.name,T_+=(1-T_)*.001,e0&&An("Loading "+s.name+" did not report total size")):T_=s.progress.loaded/t;const i=s.index/e+T_/e;return lt.clamp01(i)}const V2=class{constructor(e,t){p(this,"loadingProgress",0);p(this,"_element");p(this,"_progress",0);p(this,"_allowCustomLoadingElement",!0);p(this,"_loadingElement");p(this,"_loadingTextContainer",null);p(this,"_loadingBar",null);p(this,"_messageContainer",null);p(this,"_loadingElementOptions");p(this,"_progressLoop");this._element=e,this._loadingElementOptions=t}async onLoadingBegin(e){const t=this._element.shadowRoot||this._element;if(e0&&console.warn("Begin Loading"),!this._loadingElement){for(let i=0;i<t.children.length;i++){const n=t.children[i];if(n.classList.contains(V2.LoadingContainerClassName)){if(!this._allowCustomLoadingElement){e0&&console.warn("Remove custom loading container"),t.removeChild(n);continue}this._loadingElement=this.createLoadingElement(n)}}this._loadingElement||(this._loadingElement=this.createLoadingElement())}this._progress=0,this.loadingProgress=0,this._loadingElement.style.display="flex",t.appendChild(this._loadingElement),this.smoothProgressLoop(),this.setMessage(e??"")}onLoadingUpdate(e,t){var n;if(!((n=this._loadingElement)!=null&&n.parentNode))return;let i=0;typeof e=="number"?i=e:("index"in e&&(i=b5(e)),!t&&"name"in e&&this.setMessage("loading "+e.name)),this.loadingProgress=i,t&&this.setMessage(t),this.updateDisplay()}onLoadingFinished(){e0&&console.warn("Finished Loading"),I_||(this.loadingProgress=1,this.onDoneLoading())}setMessage(e){this._messageContainer&&(this._messageContainer.innerText=e)}smoothProgressLoop(){if(this._progressLoop)return;let e=1/12;I_&&(e=1/500,typeof I_=="number"&&(e*=I_)),this._progressLoop=setInterval(()=>{this.loadingProgress>=.95&&!I_&&(e=.9),this._progress=lt.lerp(this._progress,this.loadingProgress,e*this.loadingProgress),this.updateDisplay()},e)}onDoneLoading(){this._loadingElement&&(e0&&console.log("Hiding loading element"),this._loadingElement.style.display="none",this._loadingElement.remove()),this._progressLoop&&clearInterval(this._progressLoop),this._progressLoop=null}updateDisplay(){const e=this._progress,t=(e*100).toFixed(0)+"%";this._loadingBar&&(this._loadingBar.style.width=e*100+"%"),this._loadingTextContainer&&(this._loadingTextContainer.textContent=t)}createLoadingElement(e){var f,m;e0&&!e&&console.log("Creating loading element"),this._loadingElement=e||document.createElement("div");let t=this._element.getAttribute("loading-style");(!t||t==="auto")&&(window.matchMedia("(prefers-color-scheme: dark)").matches?t="dark":t="light");const i=Yf();if(!e&&(this._loadingElement.style.position="absolute",this._loadingElement.style.width="100%",this._loadingElement.style.height="100%",this._loadingElement.style.left="0",this._loadingElement.style.top="0",t==="light"?this._loadingElement.style.backgroundColor="#ddd":this._loadingElement.style.backgroundColor="#222",this._loadingElement.style.display="flex",this._loadingElement.style.alignItems="center",this._loadingElement.style.justifyContent="center",this._loadingElement.style.zIndex=Number.MAX_SAFE_INTEGER.toString(),this._loadingElement.style.flexDirection="column",this._loadingElement.style.pointerEvents="none",this._loadingElement.style.color="white",this._loadingElement.style.fontFamily='system-ui, Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',this._loadingElement.style.fontSize="1rem",t==="light"?this._loadingElement.style.color="rgba(0,0,0,.6)":this._loadingElement.style.color="rgba(255,255,255,.3)",i&&this._element)){const g=this._element.getAttribute("loading-background-color");g&&(this._loadingElement.style.backgroundColor=g);const A=this._element.getAttribute("loading-text-color");A&&(this._loadingElement.style.color=A)}const n=((f=this._loadingElementOptions)==null?void 0:f.className)??V2.LoadingContainerClassName;if(this._loadingElement.classList.add(n),(m=this._loadingElementOptions)!=null&&m.additionalClasses)for(const g of this._loadingElementOptions.additionalClasses)this._loadingElement.classList.add(g);const r=document.createElement("div");this._loadingElement.appendChild(r);const o=document.createElement("img"),a=120;if(o.style.width=`${a}px`,o.style.height=`${a}px`,o.style.paddingTop="20px",o.style.paddingBottom="10px",o.style.margin="0px",o.style.userSelect="none",o.style.objectFit="contain",o.style.transition="transform 1.5s ease-out, opacity .3s ease-in-out",o.style.transform="translateY(30px)",o.style.opacity="0.05",setTimeout(()=>{o.style.opacity="1",o.style.transform="translateY(0px)"},1),o.src=hMe,i&&this._element){const g=this._element.getAttribute("loading-logo-src");g&&(o.src=g)}r.appendChild(o);const l=document.createElement("div");l.style.cssText=`
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        opacity: 0;
        transition: opacity 1s ease-in-out 4s;
        `,setTimeout(()=>{l.style.opacity="1"},1),this._loadingElement.appendChild(l);const c=document.createElement("div"),h=100;c.style.display="flex",c.style.width=h+"%",c.style.height="3px",c.style.position="absolute",c.style.left="0",c.style.bottom="0px",c.style.opacity="0",c.style.transition="opacity 1s ease-in-out 2s",setTimeout(()=>{c.style.opacity="1"},1),t==="light"?c.style.backgroundColor="rgba(0,0,0,.2)":c.style.backgroundColor="rgba(255,255,255,.2)",this._loadingElement.appendChild(c),this._loadingBar=document.createElement("div"),c.appendChild(this._loadingBar);const d=function(g){return lt.lerp(0,h,g)+"%"};if(this._loadingBar.style.background=`linear-gradient(90deg, #204f49 ${d(0)}, #0BA398 ${d(.3)}, #66A22F ${d(.6)}, #D7DB0A ${d(1)})`,this._loadingBar.style.backgroundAttachment="fixed",this._loadingBar.style.width="0%",this._loadingBar.style.height="100%",i&&this._element){const g=this._element.getAttribute("primary-color"),A=this._element.getAttribute("secondary-color");g&&A?this._loadingBar.style.background=`linear-gradient(90deg, ${g} ${d(0)}, ${A} ${d(1)})`:g?this._loadingBar.style.background=g:A&&(this._loadingBar.style.background=A)}this._loadingTextContainer=document.createElement("div"),this._loadingTextContainer.style.display="flex",this._loadingTextContainer.style.justifyContent="center",this._loadingTextContainer.style.marginTop=".2rem",l.appendChild(this._loadingTextContainer);const u=document.createElement("div");if(this._messageContainer=u,u.style.display="flex",u.style.fontSize=".8rem",u.style.paddingTop=".1rem",u.style.justifyContent="center",l.appendChild(u),i&&this._element){const g=this._element.getAttribute("loading-text-color");g&&(u.style.color=g)}return this.handleRuntimeLicense(this._loadingElement),this._loadingElement}async handleRuntimeLicense(e){let t=Bh();if(t)return;zK&&console.log("Loading UI has commercial license?",t);const i=document.createElement("div");i.style.paddingTop=".6em",i.style.fontSize=".8em",i.style.textTransform="uppercase",i.innerText=`NEEDLE ENGINE NON COMMERCIAL VERSION
CLICK HERE TO GET A LICENSE`,i.style.cursor="pointer",i.style.userSelect="none",i.style.textAlign="center",i.style.pointerEvents="all",i.addEventListener("click",()=>window.open("https://needle.tools/pricing","_self")),i.style.opacity="0",e.appendChild(i),!Qe()&&Jf&&(zK&&console.log("Waiting for runtime license check"),await Jf,t=Bh()),!t&&(i.style.transition="opacity .5s ease-in-out",i.style.opacity="1")}};let cw=V2;p(cw,"LoadingContainerClassName","loading");const E_=ee("debugoverlay"),aoe="ar",EGe="quit-ar";class RGe{constructor(){p(this,"arContainer",null);p(this,"currentSession",null);p(this,"_createdAROnlyElements",[]);p(this,"_reparentedObjects",[]);p(this,"contentElement",null);p(this,"originalDomOverlayParent",null);p(this,"requestEndAR",()=>{this.onRequestedEndAR()})}get ARContainer(){return this.arContainer}onBegin(e,t,i){var n;if(this.currentSession=i,this.arContainer=t,exports.DeviceUtilities.isMozillaXR()){const r=e.domElement.children;for(let o=0;o<(r==null?void 0:r.length);o++){const a=r[o];if(!a||a===this.arContainer)return;this._reparentedObjects.push({el:a,previousParent:a.parentElement}),(n=this.arContainer)==null||n.appendChild(a)}t?(this.originalDomOverlayParent=t.parentNode,this.originalDomOverlayParent&&(console.log("Reparent DOM Overlay to body",t,t.style.display),t.style.display="",t.style.visibility="",document.body.appendChild(t))):console.warn("WebXRViewer: No DOM Overlay found")}this.ensureQuitARButton(this.arContainer)}onEnd(e){var t;for(const i of this._createdAROnlyElements)i.remove&&i.remove();for(const i of this._reparentedObjects){const n=i.el;(t=i.previousParent)==null||t.appendChild(n)}this._reparentedObjects.length=0,exports.DeviceUtilities.isMozillaXR()&&setTimeout(()=>{var o;const i=e.renderer.domElement;i&&((o=e.domElement.shadowRoot)==null||o.prepend(i));const n=document.querySelectorAll("*");for(var r=0;r<n.length;r++){const a=n[r];a&&a._displayChanged!==void 0&&a._displayWas!==void 0&&(a.style.display=a._displayWas)}},10)}createOverlayContainer(e){if(this.contentElement)return this.contentElement;E_&&console.log("Setup overlay container");const t=e.shadowRoot.querySelector(".content");this.contentElement=t;const i=e.shadowRoot.querySelector(".overlay-content");return i&&t.appendChild(i),E_&&!exports.DeviceUtilities.isMobileDevice()&&this.ensureQuitARButton(t),t}onRequestedEndAR(){this.currentSession&&(this.currentSession.end(),this.currentSession=null)}ensureQuitARButton(e){const t=document.createElement("slot");t.setAttribute("name","quit-ar"),this.appendElement(t,e),this._createdAROnlyElements.push(t),t.style.pointerEvents="auto";const i=document.querySelector(`.${EGe}`);if(i){i.addEventListener("click",this.requestEndAR),E_&&i.addEventListener("click",()=>console.log("Clicked quit-ar button"));return}t.addEventListener("click",this.requestEndAR),E_&&t.addEventListener("click",()=>console.log("Clicked fallback close button"));const n=document.createElement("div");n.style.cssText=`
            position: fixed;
            top: 0;
            right: 0;
            z-index: 600;
            pointer-events: all;
        `,this.appendElement(n,t);var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("quit-ar-button"),r.setAttribute("width","40px"),r.setAttribute("height","40px"),r.style.cssText=`
            background: rgba(255, 255, 255, .4);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,.3);
            outline: 1px solid rgba(255, 255, 255, .6);
            display: flex;
            justify-content: center;
            align-items: center;
        `,n.appendChild(r);var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),o.setAttribute("stroke","#000000"),o.setAttribute("stroke-width","2px"),o.style.cssText=`
            /**filter: drop-shadow(0 0px 1.2px rgba(0,0,0,.7));**/
        `,r.appendChild(o),E_&&console.log("Created fallback close button",r,e)}appendElement(e,t){return t.shadowRoot?t.shadowRoot.appendChild(e):t.appendChild(e)}}const x5=ee("debugdecoders");let tD=null;function CP(){if(!tD){const s=cP(null);tD={dracoLoader:s.dracoLoader,ktx2Loader:s.ktx2Loader,meshoptDecoder:s.meshoptDecoder}}return tD}function XK(s){if(s!==void 0&&typeof s=="string"){aLe(s);const e=CP();x5&&console.log("Setting draco decoder path to",s),e.dracoLoader.setDecoderPath(s)}}function OK(s){if(s!==void 0&&typeof s=="string"){const e=CP();x5&&console.log("Setting draco decoder type to",s),e.dracoLoader.setDecoderConfig({type:s})}}function ZK(s){if(s!==void 0&&typeof s=="string"){lLe(s);const e=CP();x5&&console.log("Setting ktx2 transcoder path to",s),e.ktx2Loader.setTranscoderPath(s)}}function wP(s,e){const t=CP();return e.renderer?t.ktx2Loader.detectSupport(e.renderer):console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures will probably fail"),zne(s),s.dracoLoader||s.setDRACOLoader(t.dracoLoader),s.ktx2Loader||s.setKTX2Loader(t.ktx2Loader),s.meshoptDecoder||s.setMeshoptDecoder(t.meshoptDecoder),cLe(s,{progressive:!0}),s}function loe(s,e,t){const i=t.length-s-1;if(e>=t[i])return i-1;if(e<=t[s])return s;let n=s,r=i,o=Math.floor((n+r)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?r=o:n=o,o=Math.floor((n+r)/2);return o}function LGe(s,e,t,i){const n=[],r=[],o=[];n[0]=1;for(let a=1;a<=t;++a){r[a]=e-i[s+1-a],o[a]=i[s+a]-e;let l=0;for(let c=0;c<a;++c){const h=o[c+1],d=r[a-c],u=n[c]/(h+d);n[c]=l+h*u,l=d*u}n[a]=l}return n}function BGe(s,e,t,i){const n=loe(s,i,e),r=LGe(n,i,s,e),o=new Je(0,0,0,0);for(let a=0;a<=s;++a){const l=t[n-s+a],c=r[a],h=l.w*c;o.x+=l.x*h,o.y+=l.y*h,o.z+=l.z*h,o.w+=l.w*c}return o}function PGe(s,e,t,i,n){const r=[];for(let d=0;d<=t;++d)r[d]=0;const o=[];for(let d=0;d<=i;++d)o[d]=r.slice(0);const a=[];for(let d=0;d<=t;++d)a[d]=r.slice(0);a[0][0]=1;const l=r.slice(0),c=r.slice(0);for(let d=1;d<=t;++d){l[d]=e-n[s+1-d],c[d]=n[s+d]-e;let u=0;for(let f=0;f<d;++f){const m=c[f+1],g=l[d-f];a[d][f]=m+g;const A=a[f][d-1]/a[d][f];a[f][d]=u+m*A,u=g*A}a[d][d]=u}for(let d=0;d<=t;++d)o[0][d]=a[d][t];for(let d=0;d<=t;++d){let u=0,f=1;const m=[];for(let g=0;g<=t;++g)m[g]=r.slice(0);m[0][0]=1;for(let g=1;g<=i;++g){let A=0;const y=d-g,b=t-g;d>=g&&(m[f][0]=m[u][0]/a[b+1][y],A=m[f][0]*a[y][b]);const x=y>=-1?1:-y,v=d-1<=b?g-1:t-d;for(let C=x;C<=v;++C)m[f][C]=(m[u][C]-m[u][C-1])/a[b+1][y+C],A+=m[f][C]*a[y+C][b];d<=b&&(m[f][g]=-m[u][g-1]/a[b+1][d],A+=m[f][g]*a[d][b]),o[g][d]=A;const _=u;u=f,f=_}}let h=t;for(let d=1;d<=i;++d){for(let u=0;u<=t;++u)o[d][u]*=h;h*=t-d}return o}function GGe(s,e,t,i,n){const r=n<s?n:s,o=[],a=loe(s,i,e),l=PGe(a,i,s,r,e),c=[];for(let h=0;h<t.length;++h){const d=t[h].clone(),u=d.w;d.x*=u,d.y*=u,d.z*=u,c[h]=d}for(let h=0;h<=r;++h){const d=c[a-s].clone().multiplyScalar(l[h][0]);for(let u=1;u<=s;++u)d.add(c[a-s+u].clone().multiplyScalar(l[h][u]));o[h]=d}for(let h=r+1;h<=n+1;++h)o[h]=new Je(0,0,0);return o}function kGe(s,e){let t=1;for(let n=2;n<=s;++n)t*=n;let i=1;for(let n=2;n<=e;++n)i*=n;for(let n=2;n<=s-e;++n)i*=n;return t/i}function NGe(s){const e=s.length,t=[],i=[];for(let r=0;r<e;++r){const o=s[r];t[r]=new T(o.x,o.y,o.z),i[r]=o.w}const n=[];for(let r=0;r<e;++r){const o=t[r].clone();for(let a=1;a<=r;++a)o.sub(n[r-a].clone().multiplyScalar(kGe(r,a)*i[a]));n[r]=o.divideScalar(i[0])}return n}function DGe(s,e,t,i,n){const r=GGe(s,e,t,i,n);return NGe(r)}class FGe extends Zc{constructor(e,t,i,n,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=n||0,this.endKnot=r||this.knots.length-1;for(let o=0;o<i.length;++o){const a=i[o];this.controlPoints[o]=new Je(a.x,a.y,a.z,a.w)}}getPoint(e,t=new T){const i=t,n=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=BGe(this.degree,this.knots,this.controlPoints,n);return r.w!==1&&r.divideScalar(r.w),i.set(r.x,r.y,r.z)}getTangent(e,t=new T){const i=t,n=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=DGe(this.degree,this.knots,this.controlPoints,n,1);return i.copy(r[1]).normalize(),i}}let vi,Fs,ba;class coe extends ps{constructor(e){super(e)}load(e,t,i,n){const r=this,o=r.path===""?Vd.extractUrlBase(e):r.path,a=new Is(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(l){try{t(r.parse(l,o))}catch(c){n?n(c):console.error(c),r.manager.itemError(e)}},i,n)}parse(e,t){if(ZGe(e))vi=new OGe().parse(e);else{const n=uoe(e);if(!WGe(n))throw new Error("THREE.FBXLoader: Unknown format.");if(HK(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+HK(n));vi=new XGe().parse(n)}const i=new Mh(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new VGe(i,this.manager).parse(vi)}}class VGe{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Fs=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),n=this.parseDeformers(),r=new zGe().parse(n);return this.parseScene(n,r,i),ba}parseConnections(){const e=new Map;return"Connections"in vi&&vi.Connections.connections.forEach(function(i){const n=i[0],r=i[1],o=i[2];e.has(n)||e.set(n,{parents:[],children:[]});const a={ID:r,relationship:o};e.get(n).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});const l={ID:n,relationship:o};e.get(r).children.push(l)}),e}parseImages(){const e={},t={};if("Video"in vi.Objects){const i=vi.Objects.Video;for(const n in i){const r=i[n],o=parseInt(n);if(e[o]=r.RelativeFilename||r.Filename,"Content"in r){const a=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,l=typeof r.Content=="string"&&r.Content!=="";if(a||l){const c=this.parseImage(i[n]);t[r.RelativeFilename||r.Filename]=c}}}}for(const i in e){const n=e[i];t[n]!==void 0?e[i]=t[n]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){const t=e.Content,i=e.RelativeFilename||e.Filename,n=i.slice(i.lastIndexOf(".")+1).toLowerCase();let r;switch(n){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+n+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in vi.Objects){const i=vi.Objects.Texture;for(const n in i){const r=this.parseTexture(i[n],e);t.set(parseInt(n),r)}}return t}parseTexture(e,t){const i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;const n=e.WrapModeU,r=e.WrapModeV,o=n!==void 0?n.value:0,a=r!==void 0?r.value:0;if(i.wrapS=o===0?Mo:ea,i.wrapT=a===0?Mo:ea,"Scaling"in e){const l=e.Scaling.value;i.repeat.x=l[0],i.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;i.offset.x=l[0],i.offset.y=l[1]}return i}loadTexture(e,t){const i=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),n=e.FileName.split(".").pop().toLowerCase(),r=i.has(n)?this.manager.getHandler(`.${n}`):this.textureLoader;if(!r)return console.warn(`FBXLoader: ${n.toUpperCase()} loader not found, creating placeholder texture for`,e.RelativeFilename),new si;const o=r.path;o||r.setPath(this.textureLoader.path);const a=Fs.get(e.id).children;let l;a!==void 0&&a.length>0&&t[a[0].ID]!==void 0&&(l=t[a[0].ID],(l.indexOf("blob:")===0||l.indexOf("data:")===0)&&r.setPath(void 0));const c=r.load(l);return r.setPath(o),c}parseMaterials(e){const t=new Map;if("Material"in vi.Objects){const i=vi.Objects.Material;for(const n in i){const r=this.parseMaterial(i[n],e);r!==null&&t.set(parseInt(n),r)}}return t}parseMaterial(e,t){const i=e.id,n=e.attrName;let r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!Fs.has(i))return null;const o=this.parseParameters(e,t,i);let a;switch(r.toLowerCase()){case"phong":a=new Of;break;case"lambert":a=new AB;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new Of;break}return a.setValues(o),a.name=n,a}parseParameters(e,t,i){const n={};e.BumpFactor&&(n.bumpScale=e.BumpFactor.value),e.Diffuse?n.color=ni.toWorkingColorSpace(new ge().fromArray(e.Diffuse.value),ft):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(n.color=ni.toWorkingColorSpace(new ge().fromArray(e.DiffuseColor.value),ft)),e.DisplacementFactor&&(n.displacementScale=e.DisplacementFactor.value),e.Emissive?n.emissive=ni.toWorkingColorSpace(new ge().fromArray(e.Emissive.value),ft):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(n.emissive=ni.toWorkingColorSpace(new ge().fromArray(e.EmissiveColor.value),ft)),e.EmissiveFactor&&(n.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(n.opacity=parseFloat(e.Opacity.value)),n.opacity<1&&(n.transparent=!0),e.ReflectionFactor&&(n.reflectivity=e.ReflectionFactor.value),e.Shininess&&(n.shininess=e.Shininess.value),e.Specular?n.specular=ni.toWorkingColorSpace(new ge().fromArray(e.Specular.value),ft):e.SpecularColor&&e.SpecularColor.type==="Color"&&(n.specular=ni.toWorkingColorSpace(new ge().fromArray(e.SpecularColor.value),ft));const r=this;return Fs.get(i).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":n.bumpMap=r.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":n.aoMap=r.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=r.getTexture(t,o.ID),n.map!==void 0&&(n.map.colorSpace=ft);break;case"DisplacementColor":n.displacementMap=r.getTexture(t,o.ID);break;case"EmissiveColor":n.emissiveMap=r.getTexture(t,o.ID),n.emissiveMap!==void 0&&(n.emissiveMap.colorSpace=ft);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=r.getTexture(t,o.ID);break;case"ReflectionColor":n.envMap=r.getTexture(t,o.ID),n.envMap!==void 0&&(n.envMap.mapping=wo,n.envMap.colorSpace=ft);break;case"SpecularColor":n.specularMap=r.getTexture(t,o.ID),n.specularMap!==void 0&&(n.specularMap.colorSpace=ft);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=r.getTexture(t,o.ID),n.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),n}getTexture(e,t){return"LayeredTexture"in vi.Objects&&t in vi.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Fs.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in vi.Objects){const i=vi.Objects.Deformer;for(const n in i){const r=i[n],o=Fs.get(parseInt(n));if(r.attrType==="Skin"){const a=this.parseSkeleton(o,i);a.ID=n,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[n]=a}else if(r.attrType==="BlendShape"){const a={id:n};a.rawTargets=this.parseMorphTargets(o,i),a.id=n,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[n]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const i=[];return e.children.forEach(function(n){const r=t[n.ID];if(r.attrType!=="Cluster")return;const o={ID:n.ID,indices:[],weights:[],transformLink:new ce().fromArray(r.TransformLink.a)};"Indexes"in r&&(o.indices=r.Indexes.a,o.weights=r.Weights.a),i.push(o)}),{rawBones:i,bones:[]}}parseMorphTargets(e,t){const i=[];for(let n=0;n<e.children.length;n++){const r=e.children[n],o=t[r.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=Fs.get(parseInt(r.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,i.push(a)}return i}parseScene(e,t,i){ba=new Ms;const n=this.parseModels(e.skeletons,t,i),r=vi.Objects.Model,o=this;n.forEach(function(l){var d;const c=r[l.ID];o.setLookAtProperties(l,c);const h=(d=Fs.get(l.ID))==null?void 0:d.parents;h==null||h.forEach(function(u){const f=n.get(u.ID);f!==void 0&&f.add(l)}),l.parent===null&&ba.add(l)}),this.bindSkeleton(e.skeletons,t,n),this.addGlobalSceneSettings(),ba.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=doe(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const a=new UGe().parse();ba.children.length===1&&ba.children[0].isGroup&&(ba.children[0].animations=a,ba=ba.children[0]),ba.animations=a}parseModels(e,t,i){const n=new Map,r=vi.Objects.Model;for(const o in r){const a=parseInt(o),l=r[o],c=Fs.get(a);let h=this.buildSkeleton(c,e,a,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,t,i);break;case"NurbsCurve":h=this.createCurve(c,t);break;case"LimbNode":case"Root":h=new Q0;break;case"Null":default:h=new Ms;break}h.name=l.attrName?di.sanitizeNodeName(l.attrName):"",h.userData.originalName=l.attrName,h.ID=a}this.getTransformData(h,l),n.set(a,h)}return n}buildSkeleton(e,t,i,n){let r=null;return e==null||e.parents.forEach(function(o){for(const a in t){const l=t[a];l.rawBones.forEach(function(c,h){if(c.ID===o.ID){const d=r;r=new Q0,r.matrixWorld.copy(c.transformLink),r.name=n?di.sanitizeNodeName(n):"",r.userData.originalName=n,r.ID=i,l.bones[h]=r,d!==null&&r.add(d)}})}}),r}createCamera(e){let t,i;if(e.children.forEach(function(n){const r=vi.Objects.NodeAttribute[n.ID];r!==void 0&&(i=r)}),i===void 0)t=new ye;else{let n=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(n=1);let r=1;i.NearPlane!==void 0&&(r=i.NearPlane.value/1e3);let o=1e3;i.FarPlane!==void 0&&(o=i.FarPlane.value/1e3);let a=window.innerWidth,l=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(a=i.AspectWidth.value,l=i.AspectHeight.value);const c=a/l;let h=45;i.FieldOfView!==void 0&&(h=i.FieldOfView.value);const d=i.FocalLength?i.FocalLength.value:null;switch(n){case 0:t=new Xt(h,c,r,o),d!==null&&t.setFocalLength(d);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),t=new ye;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+n+"."),t=new ye;break}}return t}createLight(e){let t,i;if(e.children.forEach(function(n){const r=vi.Objects.NodeAttribute[n.ID];r!==void 0&&(i=r)}),i===void 0)t=new ye;else{let n;i.LightType===void 0?n=0:n=i.LightType.value;let r=16777215;i.Color!==void 0&&(r=ni.toWorkingColorSpace(new ge().fromArray(i.Color.value),ft));let o=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(o=0);let a=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?a=0:a=i.FarAttenuationEnd.value);const l=1;switch(n){case 0:t=new dm(r,o,a,l);break;case 1:t=new um(r,o);break;case 2:let c=Math.PI/3;i.InnerAngle!==void 0&&(c=Bi.degToRad(i.InnerAngle.value));let h=0;i.OuterAngle!==void 0&&(h=Bi.degToRad(i.OuterAngle.value),h=Math.max(h,1)),t=new pA(r,o,a,c,h,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new dm(r,o);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,i){let n,r=null,o=null;const a=[];return e.children.forEach(function(l){t.has(l.ID)&&(r=t.get(l.ID)),i.has(l.ID)&&a.push(i.get(l.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new Of({name:ps.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(o)),"color"in r.attributes&&a.forEach(function(l){l.vertexColors=!0}),r.FBX_Deformer?(n=new ol(r,o),n.normalizeSkinWeights()):n=new fe(r,o),n}createCurve(e,t){const i=e.children.reduce(function(r,o){return t.has(o.ID)&&(r=t.get(o.ID)),r},null),n=new _n({name:ps.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new ts(i,n)}getTransformData(e,t){const i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?i.eulerOrder=xS(t.RotationOrder.value):i.eulerOrder=xS(0),"Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,t){"LookAtProperty"in t&&Fs.get(e.ID).children.forEach(function(n){if(n.relationship==="LookAtProperty"){const r=vi.Objects.Model[n.ID];if("Lcl_Translation"in r){const o=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),ba.add(e.target)):e.lookAt(new T().fromArray(o))}}})}bindSkeleton(e,t,i){const n=this.parsePoseNodes();for(const r in e){const o=e[r];Fs.get(parseInt(o.ID)).parents.forEach(function(l){if(t.has(l.ID)){const c=l.ID;Fs.get(c).parents.forEach(function(d){i.has(d.ID)&&i.get(d.ID).bind(new C1(o.bones),n[d.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in vi.Objects){const t=vi.Objects.Pose;for(const i in t)if(t[i].attrType==="BindPose"&&t[i].NbPoseNodes>0){const n=t[i].PoseNode;Array.isArray(n)?n.forEach(function(r){e[r.Node]=new ce().fromArray(r.Matrix.a)}):e[n.Node]=new ce().fromArray(n.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in vi){if("AmbientColor"in vi.GlobalSettings){const e=vi.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],n=e[2];if(t!==0||i!==0||n!==0){const r=new ge().setRGB(t,i,n,ft);ba.add(new T1(r,1))}}"UnitScaleFactor"in vi.GlobalSettings&&(ba.userData.unitScaleFactor=vi.GlobalSettings.UnitScaleFactor.value)}}}class zGe{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in vi.Objects){const i=vi.Objects.Geometry;for(const n in i){const r=Fs.get(parseInt(n)),o=this.parseGeometry(r,i[n],e);t.set(parseInt(n),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){const n=i.skeletons,r=[],o=e.parents.map(function(d){return vi.Objects.Model[d.ID]});if(o.length===0)return;const a=e.children.reduce(function(d,u){return n[u.ID]!==void 0&&(d=n[u.ID]),d},null);e.children.forEach(function(d){i.morphTargets[d.ID]!==void 0&&r.push(i.morphTargets[d.ID])});const l=o[0],c={};"RotationOrder"in l&&(c.eulerOrder=xS(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const h=doe(c);return this.genGeometry(t,a,r,h)}genGeometry(e,t,i,n){const r=new It;e.attrName&&(r.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),l=new ut(a.vertex,3);if(l.applyMatrix4(n),r.setAttribute("position",l),a.colors.length>0&&r.setAttribute("color",new ut(a.colors,3)),t&&(r.setAttribute("skinIndex",new $2(a.weightsIndices,4)),r.setAttribute("skinWeight",new ut(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){const c=new ei().getNormalMatrix(n),h=new ut(a.normal,3);h.applyNormalMatrix(c),r.setAttribute("normal",h)}if(a.uvs.forEach(function(c,h){const d=h===0?"uv":`uv${h}`;r.setAttribute(d,new ut(a.uvs[h],2))}),o.material&&o.material.mappingType!=="AllSame"){let c=a.materialIndex[0],h=0;if(a.materialIndex.forEach(function(d,u){d!==c&&(r.addGroup(h,u-h,c),c=d,h=u)}),r.groups.length>0){const d=r.groups[r.groups.length-1],u=d.start+d.count;u!==a.materialIndex.length&&r.addGroup(u,a.materialIndex.length-u,c)}r.groups.length===0&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,i,n),r}parseGeoNode(e,t){const i={};if(i.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],i.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let n=0;for(;e.LayerElementUV[n];)e.LayerElementUV[n].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return i.weightTable={},t!==null&&(i.skeleton=t,t.rawBones.forEach(function(n,r){n.indices.forEach(function(o,a){i.weightTable[o]===void 0&&(i.weightTable[o]=[]),i.weightTable[o].push({id:r,weight:n.weights[a]})})})),i}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,n=0,r=!1,o=[],a=[],l=[],c=[],h=[],d=[];const u=this;return e.vertexIndices.forEach(function(f,m){let g,A=!1;f<0&&(f=f^-1,A=!0);let y=[],b=[];if(o.push(f*3,f*3+1,f*3+2),e.color){const x=tE(m,i,f,e.color);l.push(x[0],x[1],x[2])}if(e.skeleton){if(e.weightTable[f]!==void 0&&e.weightTable[f].forEach(function(x){b.push(x.weight),y.push(x.id)}),b.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const x=[0,0,0,0],v=[0,0,0,0];b.forEach(function(_,C){let S=_,M=y[C];v.forEach(function(L,w,E){if(S>L){E[w]=S,S=L;const B=x[w];x[w]=M,M=B}})}),y=x,b=v}for(;b.length<4;)b.push(0),y.push(0);for(let x=0;x<4;++x)h.push(b[x]),d.push(y[x])}if(e.normal){const x=tE(m,i,f,e.normal);a.push(x[0],x[1],x[2])}e.material&&e.material.mappingType!=="AllSame"&&(g=tE(m,i,f,e.material)[0],g<0&&(u.negativeMaterialIndices=!0,g=0)),e.uv&&e.uv.forEach(function(x,v){const _=tE(m,i,f,x);c[v]===void 0&&(c[v]=[]),c[v].push(_[0]),c[v].push(_[1])}),n++,A&&(u.genFace(t,e,o,g,a,l,c,h,d,n),i++,n=0,o=[],a=[],l=[],c=[],h=[],d=[])}),t}getNormalNewell(e){const t=new T(0,0,0);for(let i=0;i<e.length;i++){const n=e[i],r=e[(i+1)%e.length];t.x+=(n.y-r.y)*(n.z+r.z),t.y+=(n.z-r.z)*(n.x+r.x),t.z+=(n.x-r.x)*(n.y+r.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),n=(Math.abs(t.z)>.5?new T(0,1,0):new T(0,0,1)).cross(t).normalize(),r=t.clone().cross(n).normalize();return{normal:t,tangent:n,bitangent:r}}flattenVertex(e,t,i){return new Q(e.dot(t),e.dot(i))}genFace(e,t,i,n,r,o,a,l,c,h){let d;if(h>3){const u=[],f=t.baseVertexPositions||t.vertexPositions;for(let y=0;y<i.length;y+=3)u.push(new T(f[i[y]],f[i[y+1]],f[i[y+2]]));const{tangent:m,bitangent:g}=this.getNormalTangentAndBitangent(u),A=[];for(const y of u)A.push(this.flattenVertex(y,m,g));d=Sh.triangulateShape(A,[])}else d=[[0,1,2]];for(const[u,f,m]of d)e.vertex.push(t.vertexPositions[i[u*3]]),e.vertex.push(t.vertexPositions[i[u*3+1]]),e.vertex.push(t.vertexPositions[i[u*3+2]]),e.vertex.push(t.vertexPositions[i[f*3]]),e.vertex.push(t.vertexPositions[i[f*3+1]]),e.vertex.push(t.vertexPositions[i[f*3+2]]),e.vertex.push(t.vertexPositions[i[m*3]]),e.vertex.push(t.vertexPositions[i[m*3+1]]),e.vertex.push(t.vertexPositions[i[m*3+2]]),t.skeleton&&(e.vertexWeights.push(l[u*4]),e.vertexWeights.push(l[u*4+1]),e.vertexWeights.push(l[u*4+2]),e.vertexWeights.push(l[u*4+3]),e.vertexWeights.push(l[f*4]),e.vertexWeights.push(l[f*4+1]),e.vertexWeights.push(l[f*4+2]),e.vertexWeights.push(l[f*4+3]),e.vertexWeights.push(l[m*4]),e.vertexWeights.push(l[m*4+1]),e.vertexWeights.push(l[m*4+2]),e.vertexWeights.push(l[m*4+3]),e.weightsIndices.push(c[u*4]),e.weightsIndices.push(c[u*4+1]),e.weightsIndices.push(c[u*4+2]),e.weightsIndices.push(c[u*4+3]),e.weightsIndices.push(c[f*4]),e.weightsIndices.push(c[f*4+1]),e.weightsIndices.push(c[f*4+2]),e.weightsIndices.push(c[f*4+3]),e.weightsIndices.push(c[m*4]),e.weightsIndices.push(c[m*4+1]),e.weightsIndices.push(c[m*4+2]),e.weightsIndices.push(c[m*4+3])),t.color&&(e.colors.push(o[u*3]),e.colors.push(o[u*3+1]),e.colors.push(o[u*3+2]),e.colors.push(o[f*3]),e.colors.push(o[f*3+1]),e.colors.push(o[f*3+2]),e.colors.push(o[m*3]),e.colors.push(o[m*3+1]),e.colors.push(o[m*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(r[u*3]),e.normal.push(r[u*3+1]),e.normal.push(r[u*3+2]),e.normal.push(r[f*3]),e.normal.push(r[f*3+1]),e.normal.push(r[f*3+2]),e.normal.push(r[m*3]),e.normal.push(r[m*3+1]),e.normal.push(r[m*3+2])),t.uv&&t.uv.forEach(function(g,A){e.uvs[A]===void 0&&(e.uvs[A]=[]),e.uvs[A].push(a[A][u*2]),e.uvs[A].push(a[A][u*2+1]),e.uvs[A].push(a[A][f*2]),e.uvs[A].push(a[A][f*2+1]),e.uvs[A].push(a[A][m*2]),e.uvs[A].push(a[A][m*2+1])})}addMorphTargets(e,t,i,n){if(i.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;i.forEach(function(o){o.rawTargets.forEach(function(a){const l=vi.Objects.Geometry[a.geoID];l!==void 0&&r.genMorphGeometry(e,t,l,n,a.name)})})}genMorphGeometry(e,t,i,n,r){const o=t.Vertices!==void 0?t.Vertices.a:[],a=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],l=i.Vertices!==void 0?i.Vertices.a:[],c=i.Indexes!==void 0?i.Indexes.a:[],h=e.attributes.position.count*3,d=new Float32Array(h);for(let g=0;g<c.length;g++){const A=c[g]*3;d[A]=l[g*3],d[A+1]=l[g*3+1],d[A+2]=l[g*3+2]}const u={vertexIndices:a,vertexPositions:d,baseVertexPositions:o},f=this.genBuffers(u),m=new ut(f.vertex,3);m.name=r||i.attrName,m.applyMatrix4(n),e.morphAttributes.position.push(m)}parseNormals(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Normals.a;let r=[];return i==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:r,mappingType:t,referenceType:i}}parseUVs(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.UV.a;let r=[];return i==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:n,indices:r,mappingType:t,referenceType:i}}parseVertexColors(e){if(!e.Colors)return;const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Colors.a;let r=[];i==="IndexToDirect"&&(r=e.ColorIndex.a);for(let o=0,a=new ge;o<n.length;o+=4)a.fromArray(n,o),ni.toWorkingColorSpace(a,ft),a.toArray(n,o);return{dataSize:4,buffer:n,indices:r,mappingType:t,referenceType:i}}parseMaterialIndices(e){const t=e.MappingInformationType,i=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const n=e.Materials.a,r=[];for(let o=0;o<n.length;++o)r.push(o);return{dataSize:1,buffer:n,indices:r,mappingType:t,referenceType:i}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new It;const i=t-1,n=e.KnotVector.a,r=[],o=e.Points.a;for(let d=0,u=o.length;d<u;d+=4)r.push(new Je().fromArray(o,d));let a,l;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){a=i,l=n.length-1-a;for(let d=0;d<i;++d)r.push(r[d])}const h=new FGe(i,n,r,a,l).getPoints(r.length*12);return new It().setFromPoints(h)}}class UGe{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const i in t){const n=t[i],r=this.addClip(n);e.push(r)}return e}parseClips(){if(vi.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=vi.Objects.AnimationCurveNode,t=new Map;for(const i in e){const n=e[i];if(n.attrName.match(/S|R|T|DeformPercent/)!==null){const r={id:n.id,attr:n.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){const t=vi.Objects.AnimationCurve;for(const i in t){const n={id:t[i].id,times:t[i].KeyTime.a.map(HGe),values:t[i].KeyValueFloat.a},r=Fs.get(n.id);if(r!==void 0){const o=r.parents[0].ID,a=r.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=n:a.match(/Y/)?e.get(o).curves.y=n:a.match(/Z/)?e.get(o).curves.z=n:a.match(/DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=n)}}}parseAnimationLayers(e){const t=vi.Objects.AnimationLayer,i=new Map;for(const n in t){const r=[],o=Fs.get(parseInt(n));o!==void 0&&(o.children.forEach(function(l,c){if(e.has(l.ID)){const h=e.get(l.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(r[c]===void 0){const d=Fs.get(l.ID).parents.filter(function(u){return u.relationship!==void 0})[0].ID;if(d!==void 0){const u=vi.Objects.Model[d.toString()];if(u===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const f={modelName:u.attrName?di.sanitizeNodeName(u.attrName):"",ID:u.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};ba.traverse(function(m){m.ID===u.id&&(f.transform=m.matrix,m.userData.transformData&&(f.eulerOrder=m.userData.transformData.eulerOrder))}),f.transform||(f.transform=new ce),"PreRotation"in u&&(f.preRotation=u.PreRotation.value),"PostRotation"in u&&(f.postRotation=u.PostRotation.value),r[c]=f}}r[c]&&(r[c][h.attr]=h)}else if(h.curves.morph!==void 0){if(r[c]===void 0){const d=Fs.get(l.ID).parents.filter(function(y){return y.relationship!==void 0})[0].ID,u=Fs.get(d).parents[0].ID,f=Fs.get(u).parents[0].ID,m=Fs.get(f).parents[0].ID,g=vi.Objects.Model[m],A={modelName:g.attrName?di.sanitizeNodeName(g.attrName):"",morphName:vi.Objects.Deformer[d].attrName};r[c]=A}r[c][h.attr]=h}}}),i.set(parseInt(n),r))}return i}parseAnimStacks(e){const t=vi.Objects.AnimationStack,i={};for(const n in t){const r=Fs.get(parseInt(n)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(r[0].ID);i[n]={name:t[n].attrName,layer:o}}return i}addClip(e){let t=[];const i=this;return e.layer.forEach(function(n){t=t.concat(i.generateTracks(n))}),new Ba(e.name,-1,t)}generateTracks(e){const t=[];let i=new T,n=new T;if(e.transform&&e.transform.decompose(i,new Ve,n),i=i.toArray(),n=n.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");r!==void 0&&t.push(r)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const r=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);r!==void 0&&t.push(r)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.S.curves,n,"scale");r!==void 0&&t.push(r)}if(e.DeformPercent!==void 0){const r=this.generateMorphTrack(e);r!==void 0&&t.push(r)}return t}generateVectorTrack(e,t,i,n){const r=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(r,t,i);return new Yd(e+"."+n,r,o)}generateRotationTrack(e,t,i,n,r){let o,a;if(t.x===void 0||t.y===void 0||t.z===void 0){console.warn("THREE.FBXLoader: Missing rotation curves "+(t.x===void 0?"x ":"")+(t.y===void 0?"y ":"")+(t.z===void 0?"z ":"")+" for animation of "+e+". This is currently not supported.");return}if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){const u=this.interpolateRotations(t.x,t.y,t.z,r);o=u[0],a=u[1]}const l=xS(0);i!==void 0&&(i=i.map(Bi.degToRad),i.push(l),i=new Xi().fromArray(i),i=new Ve().setFromEuler(i)),n!==void 0&&(n=n.map(Bi.degToRad),n.push(l),n=new Xi().fromArray(n),n=new Ve().setFromEuler(n).invert());const c=new Ve,h=new Xi,d=[];if(!(!a||!o)){for(let u=0;u<a.length;u+=3)h.set(a[u],a[u+1],a[u+2],r),c.setFromEuler(h),i!==void 0&&c.premultiply(i),n!==void 0&&c.multiply(n),u>2&&new Ve().fromArray(d,(u-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w),c.toArray(d,u/3*4);return new Kd(e+".quaternion",o,d)}}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,i=t.values.map(function(r){return r/100}),n=ba.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Ip(e.modelName+".morphTargetInfluences["+n+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(i,n){return i-n}),t.length>1){let i=1,n=t[0];for(let r=1;r<t.length;r++){const o=t[r];o!==n&&(t[i]=o,n=o,i++)}t=t.slice(0,i)}return t}getKeyframeTrackValues(e,t,i){const n=i,r=[];let o=-1,a=-1,l=-1;return e.forEach(function(c){if(t.x&&(o=t.x.times.indexOf(c)),t.y&&(a=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),o!==-1){const h=t.x.values[o];r.push(h),n[0]=h}else r.push(n[0]);if(a!==-1){const h=t.y.values[a];r.push(h),n[1]=h}else r.push(n[1]);if(l!==-1){const h=t.z.values[l];r.push(h),n[2]=h}else r.push(n[2])}),r}interpolateRotations(e,t,i,n){const r=[],o=[];r.push(e.times[0]),o.push(Bi.degToRad(e.values[0])),o.push(Bi.degToRad(t.values[0])),o.push(Bi.degToRad(i.values[0]));for(let a=1;a<e.values.length;a++){const l=[e.values[a-1],t.values[a-1],i.values[a-1]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;const c=l.map(Bi.degToRad),h=[e.values[a],t.values[a],i.values[a]];if(isNaN(h[0])||isNaN(h[1])||isNaN(h[2]))continue;const d=h.map(Bi.degToRad),u=[h[0]-l[0],h[1]-l[1],h[2]-l[2]],f=[Math.abs(u[0]),Math.abs(u[1]),Math.abs(u[2])];if(f[0]>=180||f[1]>=180||f[2]>=180){const g=Math.max(...f)/180,A=new Xi(...c,n),y=new Xi(...d,n),b=new Ve().setFromEuler(A),x=new Ve().setFromEuler(y);b.dot(x)&&x.set(-x.x,-x.y,-x.z,-x.w);const v=e.times[a-1],_=e.times[a]-v,C=new Ve,S=new Xi;for(let M=0;M<1;M+=1/g)C.copy(b.clone().slerp(x.clone(),M)),r.push(v+M*_),S.setFromQuaternion(C,n),o.push(S.x),o.push(S.y),o.push(S.z)}else r.push(e.times[a]),o.push(Bi.degToRad(e.values[a])),o.push(Bi.degToRad(t.values[a])),o.push(Bi.degToRad(i.values[a]))}return[r,o]}}class XGe{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new hoe,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,i=e.split(/[\r\n]+/);return i.forEach(function(n,r){const o=n.match(/^[\s\t]*;/),a=n.match(/^[\s\t]*$/);if(o||a)return;const l=n.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=n.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=n.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(n,l):c?t.parseNodeProperty(n,c,i[++r]):h?t.popStack():n.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(n)}),this.allNodes}parseNodeBegin(e,t){const i=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:i},o=this.parseNodeAttr(n),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,r):i in a?(i==="PoseNode"?a.PoseNode.push(r):a[i].id!==void 0&&(a[i]={},a[i][a[i].id]=a[i]),o.id!==""&&(a[i][o.id]=r)):typeof o.id=="number"?(a[i]={},a[i][o.id]=r):i!=="Properties70"&&(i==="PoseNode"?a[i]=[r]:a[i]=r),typeof o.id=="number"&&(r.id=o.id),o.name!==""&&(r.attrName=o.name),o.type!==""&&(r.attrType=o.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let i="",n="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:i,type:n}}parseNodeProperty(e,t,i){let n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();n==="Content"&&r===","&&(r=i.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,n,r);return}if(n==="C"){const l=r.split(",").slice(1),c=parseInt(l[0]),h=parseInt(l[1]);let d=r.split(",").slice(3);d=d.map(function(u){return u.trim().replace(/^"/,"")}),n="connections",r=[c,h],KGe(r,d),o[n]===void 0&&(o[n]=[])}n==="Node"&&(o.id=r),n in o&&Array.isArray(o[n])?o[n].push(r):n!=="a"?o[n]=r:o.a=r,this.setCurrentProp(o,n),n==="a"&&r.slice(-1)!==","&&(o.a=nD(r))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=nD(t.a))}parseNodeSpecialProperty(e,t,i){const n=i.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=n[0],o=n[1],a=n[2],l=n[3];let c=n[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=nD(c);break}this.getPrevNode()[r]={type:o,type2:a,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),r)}}class OGe{parse(e){const t=new WK(e);t.skip(23);const i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const n=new hoe;for(;!this.endOfContent(t);){const r=this.parseNode(t,i);r!==null&&n.add(r.name,r)}return n}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const i={},n=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(n===0)return null;const l=[];for(let u=0;u<r;u++)l.push(this.parseProperty(e));const c=l.length>0?l[0]:"",h=l.length>1?l[1]:"",d=l.length>2?l[2]:"";for(i.singleProperty=r===1&&e.getOffset()===n;n>e.getOffset();){const u=this.parseNode(e,t);u!==null&&this.parseSubNode(a,i,u)}return i.propertyList=l,typeof c=="number"&&(i.id=c),h!==""&&(i.attrName=h),d!==""&&(i.attrType=d),a!==""&&(i.name=a),i}parseSubNode(e,t,i){if(i.singleProperty===!0){const n=i.propertyList[0];Array.isArray(n)?(t[i.name]=i,i.a=n):t[i.name]=n}else if(e==="Connections"&&i.name==="C"){const n=[];i.propertyList.forEach(function(r,o){o!==0&&n.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(n)}else if(i.name==="Properties70")Object.keys(i).forEach(function(r){t[r]=i[r]});else if(e==="Properties70"&&i.name==="P"){let n=i.propertyList[0],r=i.propertyList[1];const o=i.propertyList[2],a=i.propertyList[3];let l;n.indexOf("Lcl ")===0&&(n=n.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?l=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:l=i.propertyList[4],t[n]={type:r,type2:o,flag:a,value:l}}else t[i.name]===void 0?typeof i.id=="number"?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:i.name==="PoseNode"?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):t[i.name][i.id]===void 0&&(t[i.name][i.id]=i)}parseProperty(e){const t=e.getString(1);let i;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const n=e.getUint32(),r=e.getUint32(),o=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}const a=yC(new Uint8Array(e.getArrayBuffer(o))),l=new WK(a.buffer);switch(t){case"b":case"c":return l.getBooleanArray(n);case"d":return l.getFloat64Array(n);case"f":return l.getFloat32Array(n);case"i":return l.getInt32Array(n);case"l":return l.getInt64Array(n)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class WK{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let i=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const n=i.indexOf(0);return n>=0&&(i=new Uint8Array(this.dv.buffer,t,n)),this._textDecoder.decode(i)}}class hoe{add(e,t){this[e]=t}}function ZGe(s){const e="Kaydara FBX Binary  \0";return s.byteLength>=e.length&&e===uoe(s,0,e.length)}function WGe(s){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function i(n){const r=s[n-1];return s=s.slice(t+n),t++,r}for(let n=0;n<e.length;++n)if(i(1)===e[n])return!1;return!0}function HK(s){const e=/FBXVersion: (\d+)/,t=s.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function HGe(s){return s/46186158e3}const QGe=[];function tE(s,e,t,i){let n;switch(i.mappingType){case"ByPolygonVertex":n=s;break;case"ByPolygon":n=e;break;case"ByVertice":n=t;break;case"AllSame":n=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(n=i.indices[n]);const r=n*i.dataSize,o=r+i.dataSize;return YGe(QGe,i.buffer,r,o)}const iD=new Xi,By=new T;function doe(s){const e=new ce,t=new ce,i=new ce,n=new ce,r=new ce,o=new ce,a=new ce,l=new ce,c=new ce,h=new ce,d=new ce,u=new ce,f=s.inheritType?s.inheritType:0;s.translation&&e.setPosition(By.fromArray(s.translation));const m=xS(0);if(s.preRotation){const E=s.preRotation.map(Bi.degToRad);E.push(m),t.makeRotationFromEuler(iD.fromArray(E))}if(s.rotation){const E=s.rotation.map(Bi.degToRad);E.push(s.eulerOrder||m),i.makeRotationFromEuler(iD.fromArray(E))}if(s.postRotation){const E=s.postRotation.map(Bi.degToRad);E.push(m),n.makeRotationFromEuler(iD.fromArray(E)),n.invert()}s.scale&&r.scale(By.fromArray(s.scale)),s.scalingOffset&&a.setPosition(By.fromArray(s.scalingOffset)),s.scalingPivot&&o.setPosition(By.fromArray(s.scalingPivot)),s.rotationOffset&&l.setPosition(By.fromArray(s.rotationOffset)),s.rotationPivot&&c.setPosition(By.fromArray(s.rotationPivot)),s.parentMatrixWorld&&(d.copy(s.parentMatrix),h.copy(s.parentMatrixWorld));const g=t.clone().multiply(i).multiply(n),A=new ce;A.extractRotation(h);const y=new ce;y.copyPosition(h);const b=y.clone().invert().multiply(h),x=A.clone().invert().multiply(b),v=r,_=new ce;if(f===0)_.copy(A).multiply(g).multiply(x).multiply(v);else if(f===1)_.copy(A).multiply(x).multiply(g).multiply(v);else{const B=new ce().scale(new T().setFromMatrixScale(d)).clone().invert(),P=x.clone().multiply(B);_.copy(A).multiply(g).multiply(P).multiply(v)}const C=c.clone().invert(),S=o.clone().invert();let M=e.clone().multiply(l).multiply(c).multiply(t).multiply(i).multiply(n).multiply(C).multiply(a).multiply(o).multiply(r).multiply(S);const L=new ce().copyPosition(M),w=h.clone().multiply(L);return u.copyPosition(w),M=u.clone().multiply(_),M.premultiply(h.invert()),M}function xS(s){s=s||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return s===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[s]}function nD(s){return s.split(",").map(function(t){return parseFloat(t)})}function uoe(s,e,t){return e===void 0&&(e=0),t===void 0&&(t=s.byteLength),new TextDecoder().decode(new Uint8Array(s,e,t))}function KGe(s,e){for(let t=0,i=s.length,n=e.length;t<n;t++,i++)s[i]=e[t]}function YGe(s,e,t,i){for(let n=t,r=0;n<i;n++,r++)s[r]=e[n];return s}class JGe extends ps{constructor(e){super(e)}load(e,t,i,n){const r=this,o=this.path===""?Vd.extractUrlBase(e):this.path,a=new Is(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{t(r.parse(l,o))}catch(c){n?n(c):console.error(c),r.manager.itemError(e)}},i,n)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const i=e.split(`
`);let n={};const r=/\s+/,o={};for(let l=0;l<i.length;l++){let c=i[l];if(c=c.trim(),c.length===0||c.charAt(0)==="#")continue;const h=c.indexOf(" ");let d=h>=0?c.substring(0,h):c;d=d.toLowerCase();let u=h>=0?c.substring(h+1):"";if(u=u.trim(),d==="newmtl")n={name:u},o[u]=n;else if(d==="ka"||d==="kd"||d==="ks"||d==="ke"){const f=u.split(r,3);n[d]=[parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2])]}else n[d]=u}const a=new jGe(this.resourcePath||t,this.materialOptions);return a.setCrossOrigin(this.crossOrigin),a.setManager(this.manager),a.setMaterials(o),a}}class jGe{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:us,this.wrap=this.options.wrap!==void 0?this.options.wrap:Mo}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const i in e){const n=e[i],r={};t[i]=r;for(const o in n){let a=!0,l=n[o];const c=o.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(l=[l[0]/255,l[1]/255,l[2]/255]),this.options&&this.options.ignoreZeroRGBs&&l[0]===0&&l[1]===0&&l[2]===0&&(a=!1);break}a&&(r[c]=l)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,i=this.materialsInfo[e],n={name:e,side:this.side};function r(a,l){return typeof l!="string"||l===""?"":/^https?:\/\//i.test(l)?l:a+l}function o(a,l){if(n[a])return;const c=t.getTextureParams(l,n),h=t.loadTexture(r(t.baseUrl,c.url));h.repeat.copy(c.scale),h.offset.copy(c.offset),h.wrapS=t.wrap,h.wrapT=t.wrap,(a==="map"||a==="emissiveMap")&&(h.colorSpace=ft),n[a]=h}for(const a in i){const l=i[a];let c;if(l!=="")switch(a.toLowerCase()){case"kd":n.color=ni.toWorkingColorSpace(new ge().fromArray(l),ft);break;case"ks":n.specular=ni.toWorkingColorSpace(new ge().fromArray(l),ft);break;case"ke":n.emissive=ni.toWorkingColorSpace(new ge().fromArray(l),ft);break;case"map_kd":o("map",l);break;case"map_ks":o("specularMap",l);break;case"map_ke":o("emissiveMap",l);break;case"norm":o("normalMap",l);break;case"map_bump":case"bump":o("bumpMap",l);break;case"map_d":o("alphaMap",l),n.transparent=!0;break;case"ns":n.shininess=parseFloat(l);break;case"d":c=parseFloat(l),c<1&&(n.opacity=c,n.transparent=!0);break;case"tr":c=parseFloat(l),this.options&&this.options.invertTrProperty&&(c=1-c),c>0&&(n.opacity=1-c,n.transparent=!0);break}}return this.materials[e]=new Of(n),this.materials[e]}getTextureParams(e,t){const i={scale:new Q(1,1),offset:new Q(0,0)},n=e.split(/\s+/);let r;return r=n.indexOf("-bm"),r>=0&&(t.bumpScale=parseFloat(n[r+1]),n.splice(r,2)),r=n.indexOf("-s"),r>=0&&(i.scale.set(parseFloat(n[r+1]),parseFloat(n[r+2])),n.splice(r,4)),r=n.indexOf("-o"),r>=0&&(i.offset.set(parseFloat(n[r+1]),parseFloat(n[r+2])),n.splice(r,4)),i.url=n.join(" ").trim(),i}loadTexture(e,t,i,n,r){const o=this.manager!==void 0?this.manager:rX;let a=o.getHandler(e);a===null&&(a=new Mh(o)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin);const l=a.load(e,i,n,r);return t!==void 0&&(l.mapping=t),l}}const qGe=/^[og]\s*(.+)?/,$Ge=/^mtllib /,eke=/^usemtl /,tke=/^usemap /,QK=/\s+/,KK=new T,sD=new T,YK=new T,JK=new T,pc=new T,iE=new ge;function ike(){const s={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(n,r){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const a={index:this.materials.length,name:n||"",mtllib:Array.isArray(r)&&r.length>0?r[r.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){const c={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return c.clone=this.clone.bind(c),c}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(n){const r=this.currentMaterial();if(r&&r.groupEnd===-1&&(r.groupEnd=this.geometry.vertices.length/3,r.groupCount=r.groupEnd-r.groupStart,r.inherited=!1),n&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return n&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),r}},i&&i.name&&typeof i.clone=="function"){const n=i.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseNormalIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseUVIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/2)*2},addVertex:function(e,t,i){const n=this.vertices,r=this.object.geometry.vertices;r.push(n[e+0],n[e+1],n[e+2]),r.push(n[t+0],n[t+1],n[t+2]),r.push(n[i+0],n[i+1],n[i+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){const n=this.normals,r=this.object.geometry.normals;r.push(n[e+0],n[e+1],n[e+2]),r.push(n[t+0],n[t+1],n[t+2]),r.push(n[i+0],n[i+1],n[i+2])},addFaceNormal:function(e,t,i){const n=this.vertices,r=this.object.geometry.normals;KK.fromArray(n,e),sD.fromArray(n,t),YK.fromArray(n,i),pc.subVectors(YK,sD),JK.subVectors(KK,sD),pc.cross(JK),pc.normalize(),r.push(pc.x,pc.y,pc.z),r.push(pc.x,pc.y,pc.z),r.push(pc.x,pc.y,pc.z)},addColor:function(e,t,i){const n=this.colors,r=this.object.geometry.colors;n[e]!==void 0&&r.push(n[e+0],n[e+1],n[e+2]),n[t]!==void 0&&r.push(n[t+0],n[t+1],n[t+2]),n[i]!==void 0&&r.push(n[i+0],n[i+1],n[i+2])},addUV:function(e,t,i){const n=this.uvs,r=this.object.geometry.uvs;r.push(n[e+0],n[e+1]),r.push(n[t+0],n[t+1]),r.push(n[i+0],n[i+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,n,r,o,a,l,c){const h=this.vertices.length;let d=this.parseVertexIndex(e,h),u=this.parseVertexIndex(t,h),f=this.parseVertexIndex(i,h);if(this.addVertex(d,u,f),this.addColor(d,u,f),a!==void 0&&a!==""){const m=this.normals.length;d=this.parseNormalIndex(a,m),u=this.parseNormalIndex(l,m),f=this.parseNormalIndex(c,m),this.addNormal(d,u,f)}else this.addFaceNormal(d,u,f);if(n!==void 0&&n!==""){const m=this.uvs.length;d=this.parseUVIndex(n,m),u=this.parseUVIndex(r,m),f=this.parseUVIndex(o,m),this.addUV(d,u,f),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let i=0,n=e.length;i<n;i++){const r=this.parseVertexIndex(e[i],t);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const i=this.vertices.length,n=this.uvs.length;for(let r=0,o=e.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(e[r],i));for(let r=0,o=t.length;r<o;r++)this.addUVLine(this.parseUVIndex(t[r],n))}};return s.startObject("",!1),s}class v5 extends ps{constructor(e){super(e),this.materials=null,this.materialsLoader=new JGe(e)}load(e,t,i,n){const r=this,o=new Is(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,async function(a){try{const l=r.parse(a,!0);for(let c=0,h=l.materialLibraries.length;c<h;c++){const d=l.materialLibraries[c],u=e.startsWith("blob:")?e+"/"+d:new URL(d,e);console.debug("Loading MTL file: "+u),await new Promise((f,m)=>{r.materialsLoader.load(u.toString(),g=>{r.setMaterials(g),f()},null,m)})}t(r.createObjects(l))}catch(l){n?n(l):console.error(l),r.manager.itemError(e)}},i,n)}setMTLLoader(e){return this.materialsLoader=e,this}setMaterials(e){return this.materials=e,this}parse(e,t=!1){const i=new ike;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const n=e.split(`
`);let r=[];for(let o=0,a=n.length;o<a;o++){const l=n[o].trimStart();if(l.length===0)continue;const c=l.charAt(0);if(c!=="#")if(c==="v"){const h=l.split(QK);switch(h[0]){case"v":i.vertices.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])),h.length>=7?(iE.setRGB(parseFloat(h[4]),parseFloat(h[5]),parseFloat(h[6]),ft),i.colors.push(iE.r,iE.g,iE.b)):i.colors.push(void 0,void 0,void 0);break;case"vn":i.normals.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]));break;case"vt":i.uvs.push(parseFloat(h[1]),parseFloat(h[2]));break}}else if(c==="f"){const d=l.slice(1).trim().split(QK),u=[];for(let m=0,g=d.length;m<g;m++){const A=d[m];if(A.length>0){const y=A.split("/");u.push(y)}}const f=u[0];for(let m=1,g=u.length-1;m<g;m++){const A=u[m],y=u[m+1];i.addFace(f[0],A[0],y[0],f[1],A[1],y[1],f[2],A[2],y[2])}}else if(c==="l"){const h=l.substring(1).trim().split(" ");let d=[];const u=[];if(l.indexOf("/")===-1)d=h;else for(let f=0,m=h.length;f<m;f++){const g=h[f].split("/");g[0]!==""&&d.push(g[0]),g[1]!==""&&u.push(g[1])}i.addLineGeometry(d,u)}else if(c==="p"){const d=l.slice(1).trim().split(" ");i.addPointGeometry(d)}else if((r=qGe.exec(l))!==null){const h=(" "+r[0].slice(1).trim()).slice(1);i.startObject(h)}else if(eke.test(l))i.object.startMaterial(l.substring(7).trim(),i.materialLibraries);else if($Ge.test(l))i.materialLibraries.push(l.substring(7).trim());else if(tke.test(l))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(c==="s"){if(r=l.split(" "),r.length>1){const d=r[1].trim().toLowerCase();i.object.smooth=d!=="0"&&d!=="off"}else i.object.smooth=!0;const h=i.object.currentMaterial();h&&(h.smooth=i.object.smooth)}else{if(l==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+l+'"')}}return i.finalize(),t?i:this.createObjects(i)}createObjects(e){const t=new Ms;if(t.materialLibraries=[].concat(e.materialLibraries),!(e.objects.length===1&&e.objects[0].geometry.vertices.length===0)===!0)for(let n=0,r=e.objects.length;n<r;n++){const o=e.objects[n],a=o.geometry,l=o.materials,c=a.type==="Line",h=a.type==="Points";let d=!1;if(a.vertices.length===0)continue;const u=new It;u.setAttribute("position",new ut(a.vertices,3)),a.normals.length>0&&u.setAttribute("normal",new ut(a.normals,3)),a.colors.length>0&&(d=!0,u.setAttribute("color",new ut(a.colors,3))),a.hasUVIndices===!0&&u.setAttribute("uv",new ut(a.uvs,2));const f=[];for(let g=0,A=l.length;g<A;g++){const y=l[g],b=y.name+"_"+y.smooth+"_"+d;let x=e.materials[b];if(this.materials!==null){if(x=this.materials.create(y.name),c&&x&&!(x instanceof _n)){const v=new _n;Yt.prototype.copy.call(v,x),v.color.copy(x.color),x=v}else if(h&&x&&!(x instanceof Td)){const v=new Td({size:10,sizeAttenuation:!1});Yt.prototype.copy.call(v,x),v.color.copy(x.color),v.map=x.map,x=v}}x===void 0&&(c?x=new _n:h?x=new Td({size:1,sizeAttenuation:!1}):x=new Of,x.name=y.name,x.flatShading=!y.smooth,x.vertexColors=d,e.materials[b]=x),f.push(x)}let m;if(f.length>1){for(let g=0,A=l.length;g<A;g++){const y=l[g];u.addGroup(y.groupStart,y.groupCount,g)}c?m=new sa(u,f):h?m=new Hb(u,f):m=new fe(u,f)}else c?m=new sa(u,f[0]):h?m=new Hb(u,f[0]):m=new fe(u,f[0]);m.name=o.name,t.add(m)}else if(e.vertices.length>0){const n=new Td({size:1,sizeAttenuation:!1}),r=new It;r.setAttribute("position",new ut(e.vertices,3)),e.colors.length>0&&e.colors[0]!==void 0&&(r.setAttribute("color",new ut(e.colors,3)),n.vertexColors=!0);const o=new Hb(r,n);t.add(o)}return t}}typeof globalThis!==void 0&&!("OffscreenCanvas"in globalThis)&&(globalThis.OffscreenCanvas=class{constructor(e,t){p(this,"canvas");return this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t,this.canvas.convertToBlob=(i,n)=>new Promise(r=>{this.canvas.toBlob(r,i,n)}),this.canvas}});const nke=ee("debugprogress");function poe(s){s=s||new Date;const e=s.getMonth()+1,t=s.getDate(),i=s.getHours(),n=s.getMinutes(),r=s.getSeconds(),o=(e<10?"0":"")+e,a=(t<10?"0":"")+t,l=(i<10?"0":"")+i,c=(n<10?"0":"")+n,h=(r<10?"0":"")+r;return s.getFullYear()+o+a+"-"+l+c+h}class Ci{static start(e,t){typeof t=="string"&&(t={parentScope:t});const i=new ske(e,t);xC.set(e,i)}static report(e,t){const i=xC.get(e);if(!i){console.warn("Reporting progress for non-existing scope",e);return}typeof t=="string"&&(t={message:t,autoStep:!0}),i.report(t)}static end(e){const t=xC.get(e);t&&(t.end(),xC.delete(e))}}const xC=new Map;class ske{constructor(e,t){p(this,"scopeLabel");p(this,"parentScope");p(this,"childScopes",[]);p(this,"parentDepth",0);p(this,"lastStep",0);p(this,"lastAutoStepWeight",1);p(this,"lastTotalSteps",0);p(this,"onProgress");p(this,"showLogs",!1);p(this,"selfProgress",0);p(this,"totalProgress",0);p(this,"selfReports",0);p(this,"totalReports",0);this.parentScope=t!=null&&t.parentScope?xC.get(t.parentScope):void 0,this.parentScope&&(this.parentScope.childScopes.push(this),this.parentDepth=this.parentScope.parentDepth+1),this.scopeLabel=" ".repeat(this.parentDepth*2)+e,this.showLogs=(t==null?void 0:t.logTimings)??!!nke,this.showLogs&&console.time(this.scopeLabel),this.onProgress=t==null?void 0:t.onProgress}report(e,t=!1){if(e){if(e.totalSteps!==void 0&&(this.lastTotalSteps=e.totalSteps),e.currentStep!==void 0&&(this.lastStep=e.currentStep),e.autoStep!==void 0){if(e.currentStep===void 0){this.lastStep===void 0&&(this.lastStep=0);const n=typeof e.autoStep=="number"?e.autoStep:1;this.lastStep+=this.lastAutoStepWeight,this.lastAutoStepWeight=n,e.currentStep=this.lastStep}e.totalSteps=this.lastTotalSteps}e.progress!==void 0?this.selfProgress=e.progress:e.currentStep!==void 0&&e.totalSteps!==void 0&&(this.selfProgress=e.currentStep/e.totalSteps)}if(this.childScopes.length>0){let n=0,r=0;for(const a of this.childScopes)n+=a.selfProgress,r+=1;r>0&&(n/=r);const o=this.lastAutoStepWeight/(this.lastTotalSteps??1);this.totalProgress=this.selfProgress+n*o}else this.totalProgress=this.selfProgress;this.selfProgress=Math.min(1,this.selfProgress),this.totalProgress=Math.min(1,this.totalProgress);let i=(this.totalProgress*100).toFixed(3)+"%";this.childScopes.length>0&&(i+=" ("+(this.selfProgress*100).toFixed(3)+"% self)"),e!=null&&e.message&&(i=e.message+" – "+i),this.lastStep!==void 0&&this.lastTotalSteps!==void 0&&(i="Step "+(this.lastStep+(this.lastAutoStepWeight!=1?"–"+(this.lastStep+this.lastAutoStepWeight):"")+"/"+this.lastTotalSteps)+" "+i),t?this.totalReports++:(this.selfReports++,this.totalReports++),this.showLogs&&console.timeLog(this.scopeLabel,i),this.onProgress&&this.onProgress(this.totalProgress),this.parentScope&&this.parentScope.report(void 0,!0)}end(){this.report({progress:1,autoStep:!0},!0),this.showLogs&&(console.timeLog(this.scopeLabel,"Total reports: "+this.totalReports,"Self reports: "+this.selfReports),console.timeEnd(this.scopeLabel));let e=!1;for(const t of this.childScopes)if(!(t.selfProgress>=1)){e=!0;break}e&&console.warn("Progress end with child scopes that are still running",this),this.onProgress=void 0}}function Vh(s){return s=s.replace(/[^a-zA-Z0-9_]/g,""),s.match(/^[a-zA-Z_]/)||(s="_"+s),s}function foe(s){return s=s.replace('"','\\"'),s}function moe(s){if(s.length===0)return null;const e=s.map(i=>{const n=new Array;for(;i.parent;)n.unshift(i.parent),i=i.parent;return n});return e[0].findLast(i=>e.every(n=>n.includes(i)))||null}function goe(s){const e=moe(s),t=new Set;for(const i of s){let n=i.parent;for(;n&&n!==e;)s.includes(n)||t.add(n),n=n.parent}return t}const rke=new T,oke=new Ve,ake=new T(1,1,1),i0=class{constructor(e,t,i=null,n=null,r=null,o=null,a=null,l=null){p(this,"uuid");p(this,"name");p(this,"type");p(this,"extraSchemas",[]);p(this,"displayName");p(this,"visibility");p(this,"transform",null);p(this,"_isDynamic");p(this,"geometry");p(this,"material");p(this,"camera");p(this,"parent");p(this,"skinnedMesh");p(this,"children",[]);p(this,"animations");p(this,"_eventListeners");p(this,"needsTranslate",!1);p(this,"needsOrient",!1);p(this,"needsScale",!1);var c,h,d;this.uuid=e,this.name=Vh(t),this.displayName=t,i?this.transform={position:((c=i.position)==null?void 0:c.clone())||null,quaternion:((h=i.quaternion)==null?void 0:h.clone())||null,scale:((d=i.scale)==null?void 0:d.clone())||null}:this.transform=null,this.geometry=n,this.material=r,this.camera=o,this.parent=null,this.children=[],this._eventListeners={},this._isDynamic=!1,this.skinnedMesh=a,this.animations=l}getMatrix(){if(!this.transform)return new ce;const{position:e,quaternion:t,scale:i}=this.transform,n=new ce;return n.compose(e||rke,t||oke,i||ake),n}setMatrix(e){if(!e||!(e instanceof ce)){this.transform=null;return}const t=new T,i=new Ve,n=new T;e.decompose(t,i,n),this.transform={position:t,quaternion:i,scale:n}}get matrix(){return this.getMatrix()}set matrix(e){this.setMatrix(e)}get isDynamic(){return this._isDynamic}set isDynamic(e){this._isDynamic=e}static createEmptyParent(e){const t=new i0(Bi.generateUUID(),e.name+"_empty_"+i0.USDObject_export_id++,e.transform),i=e.parent;return i&&i.add(t),t.add(e),t.isDynamic=!0,e.transform=null,t}static createEmpty(){const e=new i0(Bi.generateUUID(),"Empty_"+i0.USDObject_export_id++);return e.isDynamic=!0,e}is(e){return e?this.uuid===e.uuid:!1}isEmpty(){return!this.geometry}clone(){const e=new i0(Bi.generateUUID(),this.name,this.transform,this.geometry,this.material);return e.isDynamic=this.isDynamic,e}deepClone(){const e=this.clone();for(const t of this.children)t&&e.add(t.deepClone());return e}getPath(){let e=this.parent,t=this.name;for(;e;)t=(e.parent?e.name:e.name+"/Scenes/Scene")+"/"+t,e=e.parent;return"</"+t+">"}add(e){e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e)}remove(e){const t=this.children.indexOf(e);t>=0&&(e.parent===this&&(e.parent=null),this.children.splice(t,1))}addEventListener(e,t){this._eventListeners[e]||(this._eventListeners[e]=[]),this._eventListeners[e].push(t)}removeEventListener(e,t){if(!this._eventListeners[e])return;const i=this._eventListeners[e].indexOf(t);i>=0&&this._eventListeners[e].splice(i,1)}onSerialize(e,t){const i=this._eventListeners.serialize;i&&i.forEach(n=>n(e,t))}};let Co=i0;p(Co,"USDObject_export_id",0);class _5 extends Co{constructor(){super(void 0,"StageRoot",null,null,null,null);p(this,"stageLength");this.children=[],this.stageLength=200}get isDocumentRoot(){return!0}get isDynamic(){return!1}add(t){t.parent=this,this.children.push(t)}remove(t){const i=this.children.indexOf(t);i>=0&&(t.parent===this&&(t.parent=null),this.children.splice(i,1))}traverse(t,i=null){if(i!==null?t(i):i=this,i.children)for(const n of i.children)this.traverse(t,n)}findById(t){let i=!1;function n(r){if(!i){if(r.uuid===t)return i=!0,r;if(r.children)for(const o of r.children){if(!o)continue;const a=n(o);if(a)return a}}}return n(this)}buildHeader(t){var d,u,f;const i=(d=t.extensions)==null?void 0:d.find(m=>(m==null?void 0:m.extensionName)==="animation"),n=(u=t.extensions)==null?void 0:u.find(m=>(m==null?void 0:m.extensionName)==="Behaviour"),r=(f=t.extensions)==null?void 0:f.find(m=>(m==null?void 0:m.extensionName)==="Physics"),o=(i==null?void 0:i.getStartTimeCode())??0,a=(i==null?void 0:i.getEndTimeCode())??0;let l="";const c=i==null?void 0:i.registeredClips;if(c)for(const m of c)l+=`	# Animation: ${m.name}, start=${i.getStartTimeByClip(m)*60}, length=${m.duration*60}
`;const h=l;return`#usda 1.0
(
	customLayerData = {
		string creator = "Needle Engine ${Eh}"
		dictionary Needle = {
			bool animations = ${i?1:0}
			bool interactive = ${n?1:0}
			bool physics = ${r?1:0}
			bool quickLookCompatible = ${t.quickLookCompatible?1:0}
		}
	}
	defaultPrim = "${Vh(this.name)}"
	metersPerUnit = 1
	upAxis = "Y"
	startTimeCode = ${o}
	endTimeCode = ${a}
	timeCodesPerSecond = 60
	framesPerSecond = 60
	doc = """Generated by Needle Engine USDZ Exporter ${Eh}"""
${h}
)
`}}const Py=`
`,fa="</StageRoot/Materials";class Aoe{constructor(){p(this,"str");p(this,"indent");this.str="",this.indent=0}clear(){this.str="",this.indent=0}beginBlock(e=void 0,t="{",i=!0){e!==void 0?(e=this.applyIndent(e),this.str+=e,i?(this.str+=Py,this.str+=this.applyIndent(t)):this.str+=" "+t):this.str+=this.applyIndent(t),this.str+=Py,this.indent+=1}closeBlock(e="}"){this.indent-=1,this.str+=this.applyIndent(e)+Py}beginArray(e){e=this.applyIndent(e+" = ["),this.str+=e,this.str+=Py,this.indent+=1}closeArray(){this.indent-=1,this.str+=this.applyIndent("]")+Py}appendLine(e=""){e=this.applyIndent(e),this.str+=e,this.str+=Py}toString(){return this.str}applyIndent(e){let t="";for(let i=0;i<this.indent;i++)t+="	";return t+e}}class lke{constructor(e,t,i){p(this,"root");p(this,"exporter");p(this,"extensions",[]);p(this,"quickLookCompatible");p(this,"exportInvisible");p(this,"materials");p(this,"textures");p(this,"files");p(this,"document");p(this,"output");p(this,"animations");this.root=e,this.exporter=t,this.quickLookCompatible=i.quickLookCompatible,this.exportInvisible=i.exportInvisible,i.extensions&&(this.extensions=i.extensions),this.materials=new Map,this.textures={},this.files={},this.document=new _5,this.output="",this.animations=[]}}class rD{constructor(){p(this,"ar",{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}});p(this,"quickLookCompatible",!1);p(this,"extensions",[]);p(this,"maxTextureSize",4096);p(this,"exportInvisible",!1)}}let yoe=class{constructor(){p(this,"debug");p(this,"pruneUnusedNodes");p(this,"sceneAnchoringOptions",new rD);p(this,"extensions",[]);p(this,"keepObject");p(this,"beforeWritingDocument");this.debug=!1,this.pruneUnusedNodes=!0}async parse(e,t=new rD){var b,x;t=Object.assign(new rD,t),this.sceneAnchoringOptions=t;const i=new lke(e,this,t);this.extensions=i.extensions;const n=i.files,r="model.usda";n[r]=null;const o=i.materials,a=i.textures;Ci.report("export-usdz","Invoking onBeforeBuildDocument"),await zR(i,"onBeforeBuildDocument"),Ci.report("export-usdz","Done onBeforeBuildDocument"),Ci.report("export-usdz","Reparent bones to common ancestor");const l=[],c=new Set;e==null||e.traverse(v=>{if(!(!t.exportInvisible&&!v.visible)&&v instanceof ol){const _=v.skeleton.bones,C=moe(_);if(C){const S={object:v,originalParent:v.parent,newParent:C};l.push(S),c.add(S.object.uuid),S.newParent&&c.add(S.newParent.uuid),S.originalParent&&c.add(S.originalParent.uuid)}}});for(const v of l){const{object:_,originalParent:C,newParent:S}=v;S.add(_)}Ci.report("export-usdz","Traversing hierarchy"),e&&boe(e,i.document,i,this.keepObject),Ci.report("export-usdz","Invoking onAfterBuildDocument"),await zR(i,"onAfterBuildDocument");const h=i.extensions.find(v=>v.extensionName==="Behaviour"),d=(h==null?void 0:h.getAllTargetUuids())??new Set;if(this.pruneUnusedNodes){const v={allBehaviorTargets:d,debug:!1,boneReparentings:c,quickLookCompatible:i.quickLookCompatible};this.debug&&jK(i.document,"Hierarchy BEFORE pruning",v),xoe(i.document,v),this.debug&&jK(i.document,"Hierarchy AFTER pruning")}else this.debug&&console.log("Pruning of empty nodes is disabled. This may result in a larger USDZ file.");Ci.report("export-usdz",{message:"Parsing document",autoStep:10}),await cke(i,()=>(Ci.report("export-usdz","Building materials"),yke(o,a,t.quickLookCompatible))),Ci.report("export-usdz","Invoking onAfterSerialize"),await zR(i,"onAfterSerialize");for(const v of l){const{object:_,originalParent:C,newParent:S}=v;C&&C.add(_)}(x=(b=i.exporter)==null?void 0:b.beforeWritingDocument)==null||x.call(b);const f=i.document.buildHeader(i)+`
`+i.output;this.debug&&console.log(f),n[r]=d2(f),i.output="",Ci.report("export-usdz",{message:"Exporting textures",autoStep:10}),Ci.start("export-usdz-textures",{parentScope:"export-usdz",logTimings:!1});const m=new Mm({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),g=Object.keys(a).length;Ci.report("export-usdz-textures",{totalSteps:g*3,currentStep:0});const A=async v=>{const _=a[v],C=_.texture,S=Soe.includes(C.format);let M={imageData:C.image};Ci.report("export-usdz-textures",{message:"read back texture",autoStep:!0});const L=_.scale!==void 0&&_.scale.x!==1&&_.scale.y!==1&&_.scale.z!==1&&_.scale.w!==1;(C.isCompressedTexture||C.isRenderTargetTexture||L)&&(M=await hke(C,t.maxTextureSize,m,_.scale)),Ci.report("export-usdz-textures",{message:"convert texture to canvas",autoStep:!0});const w=await uke(M.imageBitmap||M.imageData,t.maxTextureSize).catch(E=>{console.error("Error converting texture to canvas",C,E)});if(w){Ci.report("export-usdz-textures",{message:"convert canvas to blob",autoStep:!0});const E=await w.convertToBlob({type:S?"image/png":"image/jpeg",quality:.95});n[`textures/${v}.${S?"png":"jpg"}`]=new Uint8Array(await E.arrayBuffer())}else console.warn("Can`t export texture: ",C)};for(const v in a)await A(v);m.dispose(),Ci.end("export-usdz-textures");let y=0;for(const v in n){const _=n[v],C=34+v.length;y+=C;const S=y&63;if(S!==4){const M=64-S,L=new Uint8Array(M);n[v]=[_,{extra:{12345:L}}]}y=_.length}return Ci.report("export-usdz","zip archive"),jPe(n,{level:0})}};function boe(s,e,t,i){var l;if(!t.exportInvisible&&!s.visible)return;let n,r,o;const a={position:s.position,quaternion:s.quaternion,scale:s.scale};if(s.position.x===0&&s.position.y===0&&s.position.z===0&&(a.position=null),s.quaternion.x===0&&s.quaternion.y===0&&s.quaternion.z===0&&s.quaternion.w===1&&(a.quaternion=null),s.scale.x===1&&s.scale.y===1&&s.scale.z===1&&(a.scale=null),(s instanceof fe||s instanceof ol)&&(r=s.geometry,o=s.material),i&&!i(s)&&(r=void 0,o=void 0),(s instanceof fe||s instanceof ol)&&o&&(o instanceof Us||o instanceof ii||o instanceof Yt&&o.type==="MeshLineMaterial")){const c=rE(s),h=s instanceof ol?s:null;n=new Co(s.uuid,c,a,r,o,void 0,h,s.animations)}else if(s instanceof Xt||s instanceof zh){const c=rE(s);n=new Co(s.uuid,c,a,void 0,void 0,s)}else{const c=rE(s);n=new Co(s.uuid,c,a,void 0,void 0,void 0,void 0,s.animations)}if(n){if(n.displayName=((l=s.userData)==null?void 0:l.name)||s.name,n.visibility=s.visible?void 0:"invisible",e&&e.add(n),e=n,t.extensions)for(const c of t.extensions)c.onExportObject&&c.onExportObject.call(c,s,n,t)}else{const c=rE(s),h=new Co(s.uuid,c,{position:s.position,quaternion:s.quaternion,scale:s.scale});e&&e.add(h),e=h}for(const c of s.children)boe(c,e,t,i)}function jK(s,e,...t){const i={};let n=0;function r(o,a){n++;let l=o.displayName||o.name;l+=" ("+o.uuid+")",(o.geometry||o.material||o.camera||o.skinnedMesh)&&(l+=" ("+(o.geometry?"geo, ":"")+(o.material?"mat, ":"")+(o.camera?"cam, ":"")+(o.skinnedMesh?"skin, ":"")+")"),a[l]={};const h={object:o};o.material&&(h.mat=!0),o.geometry&&(h.geo=!0),o.camera&&(h.cam=!0),o.skinnedMesh&&(h.skin=!0),a[l]._self=h;for(const d of o.children)d&&r(d,a[l])}r(s,i),console.log(e+" ("+n+" nodes)",i,...t)}function xoe(s,e){var c;let t=!0;const i=new Array,n=new Array;if(s.children.length===0)t=!0;else{const h=[...s.children];for(const d of h)if(d){const u=xoe(d,e);e.debug&&(u?i.push(d):n.push(d)),t=t&&u}}const r=e.allBehaviorTargets.has(s.uuid),o=s.geometry||s.material||s.camera&&!e.quickLookCompatible||s.skinnedMesh||!1,a=e.boneReparentings.has(s.uuid),l=t&&!r&&!o&&!a;return l?(e.debug&&console.log("Pruned object:",(s.displayName||s.name)+" ("+s.uuid+")",{isVisible:o,isBehaviorSourceOrTarget:r,allChildsWerePruned:t,isBoneReparenting:a,object:s,prunedChilds:i,keptChilds:n}),(c=s.parent)==null||c.remove(s)):e.debug&&console.log("Kept object:",(s.displayName||s.name)+" ("+s.uuid+")",{isVisible:o,isBehaviorSourceOrTarget:r,allChildsWerePruned:t,isBoneReparenting:a,object:s,prunedChilds:i,keptChilds:n}),l}async function cke(s,e){Ci.start("export-usdz-resources","export-usdz");const t=[];for(const l of s.document.children)voe(l,s,t);const i=t.length;for(let l=0;l<i;l++)Ci.report("export-usdz-resources",{totalSteps:i,currentStep:l}),await new Promise((c,h)=>{t[l](),c()});Ci.end("export-usdz-resources");const n=new Aoe,r=s.exporter.sceneAnchoringOptions.ar;n.beginBlock(`def Xform "${s.document.name}"`),n.beginBlock(`def Scope "Scenes" (
		kind = "sceneLibrary"
	)`),n.beginBlock('def Xform "Scene"',"(",!1),n.appendLine('apiSchemas = ["Preliminary_AnchoringAPI"]'),n.appendLine("customData = {"),n.appendLine("	bool preliminary_collidesWithEnvironment = 0"),n.appendLine('	string sceneName = "Scene"'),n.appendLine("}"),n.appendLine('sceneName = "Scene"'),n.closeBlock(")"),n.beginBlock(),n.appendLine(`token preliminary:anchoring:type = "${r.anchoring.type}"`),r.anchoring.type==="plane"&&n.appendLine(`token preliminary:planeAnchoring:alignment = "${r.planeAnchoring.alignment}"`),r.anchoring.type==="image"&&n.appendLine(`rel preliminary:imageAnchoring:referenceImage = </${s.document.name}/Scenes/Scene/AnchoringReferenceImage>`),n.appendLine();const o=l=>{if(!l)return 0;let c=1;for(const h of l.children)c+=o(h);return c},a=o(s.document);Ci.start("export-usdz-xforms","export-usdz"),Ci.report("export-usdz-xforms",{totalSteps:a,currentStep:1});for(const l of s.document.children)Coe(l,n,s);Ci.end("export-usdz-xforms"),Ci.report("export-usdz","invoke onAfterHierarchy"),zR(s,"onAfterHierarchy",n),n.closeBlock(),n.closeBlock(),n.appendLine(e()),n.closeBlock(),Ci.report("export-usdz","write to string"),s.output+=n.toString()}function voe(s,e,t){if(!s)return;const i=s.geometry,n=s.material;if(i)if(n&&("isMeshStandardMaterial"in n&&n.isMeshStandardMaterial||"isMeshBasicMaterial"in n&&n.isMeshBasicMaterial||n.type==="MeshLineMaterial")){const r="geometries/"+Ez(i,s.name)+".usda";if(!(r in e.files)){const o=()=>{var l,c;const a=mke(i,(c=(l=s.skinnedMesh)==null?void 0:l.skeleton)==null?void 0:c.bones,e.quickLookCompatible);e.files[r]=fke(a)};t.push(o)}}else console.warn("NeedleUSDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",n==null?void 0:n.name);n&&(n.uuid in e.materials||(e.materials[n.uuid]=n));for(const r of s.children)voe(r,e,t)}async function zR(s,e,t=null){if(s.extensions){for(const i of s.extensions)if(i&&typeof i[e]=="function"){const r=i[e].call(i,s,t);r instanceof Promise&&await r}}}let nE=null,ma=null,oD,Gy,sE;async function hke(s,e=1/0,t=null,i=void 0){oD||(oD=new Rs(2,2,1,1)),Gy||(Gy=new Ht({uniforms:{blitTexture:new Te(s),flipY:new Te(!1),scale:new Te(new Je(1,1,1,1))},vertexShader:`
            varying vec2 vUv;
			uniform bool flipY;
            void main(){
                vUv = uv;
				if (flipY)
					vUv.y = 1. - vUv.y;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture;
			uniform vec4 scale; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
				
				gl_FragColor.rgba *= scale.rgba;
            }`}));const n=Gy.uniforms;n.blitTexture.value=s,n.flipY.value=!1,n.scale.value=new Je(1,1,1,1),i!==void 0&&n.scale.value.copy(i),Gy.defines.IS_SRGB=s.colorSpace==ft,Gy.needsUpdate=!0,sE||(sE=new fe(oD,Gy),sE.frustumCulled=!1);const r=new Xt,o=new sr;o.add(sE),t||(t=nE=new Mm({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}));const a=Math.min(s.image.width,e),l=Math.min(s.image.height,e);ma&&(ma.width!==a||ma.height!==l)&&(ma.dispose(),ma=null),ma||(ma=new ci(a,l,{format:bi,type:Pi,minFilter:Ot,magFilter:Ot})),t.setRenderTarget(ma),t.setSize(a,l),t.clear(),t.render(o,r),nE&&(nE.dispose(),nE=null);const c=new Uint8ClampedArray(ma.width*ma.height*4);t.readRenderTargetPixels(ma,0,0,ma.width,ma.height,c);const h=new ImageData(c,ma.width,ma.height,void 0),d=await createImageBitmap(h,{premultiplyAlpha:"none"});return{imageData:h,imageBitmap:d}}function dke(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&s instanceof ImageBitmap}async function uke(s,e=4096){const t=e/Math.max(s.width,s.height),i=s.width*Math.min(1,t),n=s.height*Math.min(1,t),r=new OffscreenCanvas(i,n),o={premultiplyAlpha:"none"};s.width!==i&&(o.resizeWidth=i),s.height!==n&&(o.resizeHeight=n);const a=await createImageBitmap(s,o),l=r.getContext("bitmaprenderer");return l&&l.transferFromImageBitmap(a),r}async function _oe(s,e=void 0,t=!1,i=4096){if(dke(s)){const n=i/Math.max(s.width,s.height),r=new OffscreenCanvas(s.width*Math.min(1,n),s.height*Math.min(1,n)),o=r.getContext("2d",{alpha:!0,premultipliedAlpha:!1});if(!o)throw new Error("Could not get canvas 2D context");if(t===!0&&(o.translate(0,r.height),o.scale(1,-1)),o.drawImage(s,0,0,r.width,r.height),e!==void 0){const a=e.x,l=e.y,c=e.z,h=e.w,d=o.getImageData(0,0,r.width,r.height),u=d.data;for(let f=0;f<u.length;f+=4)u[f+0]=u[f+0]*a,u[f+1]=u[f+1]*l,u[f+2]=u[f+2]*c,u[f+3]=u[f+3]*h;o.putImageData(d,0,0)}return r}else throw new Error("NeedleUSDZExporter: No valid image data found. Unable to process texture.")}const Zn=7;function pke(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Needle Engine USDZExporter"
    }
    metersPerUnit = 1
    upAxis = "Y"
)
`}function fke(s,e){let t=pke();return t+=s,d2(t)}function rE(s){return s.name.replace(/[-<>\(\)\[\]§$%&\/\\\=\?\,\;]/g,"")+"_"+s.id}function qK(s){return Vh(s.name||"bone_"+s.uuid)}function Ez(s,e){return Vh(s.name||"Geometry")+"_"+s.id}function C5(s){return Vh(s.name||"Material")+"_"+s.id}function rx(s,e){let t=qK(s),i=s.parent;for(;i&&i!==e;)t=qK(i)+"/"+t,i=i.parent;return t}function Coe(s,e,t){var f;if(s==null)return;Ci.report("export-usdz-xforms",{message:"buildXform "+s.displayName||s.name,autoStep:!0});const i=s.transform,n=s.geometry,r=s.material,o=s.camera,a=s.name;if(s.animations)for(const m of s.animations)t.animations.push(m);const l=n&&n.isBufferGeometry&&n.attributes.skinIndex!==void 0&&n.attributes.skinIndex.count>0,c=l?"SkelRoot":"Xform",h=new Array,d=r&&r instanceof ii&&r.color&&r.color.r===1&&r.color.g===1&&r.color.b===1&&!r.map&&r.opacity===1&&(n==null?void 0:n.attributes.color);if(n!=null&&n.attributes.color&&!d&&console.warn("NeedleUSDZExporter: Geometry has vertex colors. Vertex colors will only be shown in QuickLook for unlit materials with white color and no texture. Otherwise, they will be ignored.",s.displayName),e.appendLine(),n?(e.beginBlock(`def ${c} "${a}"`,"(",!1),t.quickLookCompatible&&r&&r.side===Zi&&!l?e.appendLine(`prepend references = @./geometries/${Ez(n)}.usda@</Geometry_doubleSided>`):e.appendLine(`prepend references = @./geometries/${Ez(n)}.usda@</Geometry>`),d||h.push("MaterialBindingAPI"),l&&h.push("SkelBindingAPI")):o&&!t.quickLookCompatible?e.beginBlock(`def Camera "${a}"`,"(",!1):s.type!==void 0?e.beginBlock(`def ${s.type} "${a}"`):e.beginBlock(`def Xform "${a}"`,"(",!1),s.type===void 0&&((f=s.extraSchemas)!=null&&f.length&&h.push(...s.extraSchemas),h.length&&e.appendLine(`prepend apiSchemas = [${h.map(m=>`"${m}"`).join(", ")}]`)),s.displayName&&e.appendLine(`displayName = "${foe(s.displayName)}"`),(o||s.type===void 0)&&(e.closeBlock(")"),e.beginBlock()),n&&r){if(!d){const m=C5(r);e.appendLine(`rel material:binding = </StageRoot/Materials/${m}>`)}!t.quickLookCompatible&&r.side===Zi&&(e.beginBlock('over "Geometry" '),e.appendLine("uniform bool doubleSided = 1"),e.closeBlock())}let u=!1;if(l?(e.appendLine("rel skel:skeleton = <Rig>"),e.appendLine("rel skel:animationSource = <Rig/_anim>"),u=!1):s.type===void 0&&i&&(u=u||i.position!==null||i.quaternion!==null||i.scale!==null,i.position&&(s.needsTranslate=!0,e.appendLine(`double3 xformOp:translate = (${_i(i.position.x)}, ${_i(i.position.y)}, ${_i(i.position.z)})`)),i.quaternion&&(s.needsOrient=!0,e.appendLine(`quatf xformOp:orient = (${_i(i.quaternion.w)}, ${_i(i.quaternion.x)}, ${_i(i.quaternion.y)}, ${_i(i.quaternion.z)})`)),i.scale&&(s.needsScale=!0,e.appendLine(`double3 xformOp:scale = (${_i(i.scale.x)}, ${_i(i.scale.y)}, ${_i(i.scale.z)})`))),s.visibility!==void 0&&e.appendLine(`token visibility = "${s.visibility}"`),o&&!t.quickLookCompatible&&("isOrthographicCamera"in o&&o.isOrthographicCamera?(e.appendLine(`float2 clippingRange = (${o.near}, ${o.far})`),e.appendLine(`float horizontalAperture = ${((Math.abs(o.left)+Math.abs(o.right))*10).toPrecision(Zn)}`),e.appendLine(`float verticalAperture = ${((Math.abs(o.top)+Math.abs(o.bottom))*10).toPrecision(Zn)}`),e.appendLine('token projection = "orthographic"')):"isPerspectiveCamera"in o&&o.isPerspectiveCamera&&(e.appendLine(`float2 clippingRange = (${o.near.toPrecision(Zn)}, ${o.far.toPrecision(Zn)})`),e.appendLine(`float focalLength = ${o.getFocalLength().toPrecision(Zn)}`),e.appendLine(`float focusDistance = ${o.focus.toPrecision(Zn)}`),e.appendLine(`float horizontalAperture = ${o.getFilmWidth().toPrecision(Zn)}`),e.appendLine('token projection = "perspective"'),e.appendLine(`float verticalAperture = ${o.getFilmHeight().toPrecision(Zn)}`))),s.onSerialize&&s.onSerialize(e,t),s.type===void 0){const m=new Array;s.needsTranslate&&m.push('"xformOp:translate"'),s.needsOrient&&m.push('"xformOp:orient"'),s.needsScale&&m.push('"xformOp:scale"'),m.length&&e.appendLine(`uniform token[] xformOpOrder = [${m.join(", ")}]`)}if(s.children){e.appendLine();for(const m of s.children)Coe(m,e,t)}e.closeBlock()}function _i(s){return Number.isInteger(s)?s.toString():s.toFixed(10)}function $K(s){const e=s.elements;return`( ${oE(e,0)}, ${oE(e,4)}, ${oE(e,8)}, ${oE(e,12)} )`}function oE(s,e){return`(${_i(s[e+0])}, ${_i(s[e+1])}, ${_i(s[e+2])}, ${_i(s[e+3])})`}function mke(s,e=[],t=!0){return`
def "Geometry"
${gke(s,e,t)}
`}function gke(s,e=[],t=!0){const i="Geometry",n=s.attributes,r=n.position.count,o=e&&e.length>0,a=[],l=[];let c=new Array,h=n.skinIndex;if(o){const u=[];for(const g of e)g.parent.type!=="Bone"&&(a.push({bone:g,index:e.indexOf(g)}),u.push(g.uuid));for(;u.length<e.length;)for(const g of a){const A=g.bone.children;for(const y of A)u.indexOf(y.uuid)===-1&&e.indexOf(y)!==-1&&(a.push({bone:y,index:e.indexOf(y)}),u.push(y.uuid))}for(const g of goe(e))a.push({bone:g,index:a.length});const f=a[0].bone.parent;a.sort((g,A)=>rx(g.bone,f)>rx(A.bone,f)?1:-1),a.map(g=>'"'+rx(g.bone,f)+'"').join(", ");for(const g in a)l[a[g].index]=parseInt(g);const m=n.skinIndex;c=new Array;for(let g=0;g<m.count;g++){const A=m.getX(g),y=m.getY(g),b=m.getZ(g),x=m.getW(g);c.push(l[A],l[y],l[b],l[x])}h=new dt(new Uint16Array(c),4)}const d=n.skinWeight&&n.skinIndex;return`
{	
    def Mesh "${i}" ${d?`(
        prepend apiSchemas = ["SkelBindingAPI"]
    )`:""}
    {
        int[] faceVertexCounts = [${aD(s)}]
        int[] faceVertexIndices = [${lD(s)}]
		${n.normal||t?`normal3f[] normals = [${UR(n.normal,r)}] (
            interpolation = "vertex"
        )`:""}
        point3f[] points = [${UR(n.position,r)}]
        ${n.uv?`texCoord2f[] primvars:st = [${woe(n.uv,r,!0)}] (
            interpolation = "vertex"
        )`:""}
		${n.uv1?cD("st1",n.uv1):""}
		${n.uv2?cD("st2",n.uv2):""}
		${n.uv3?cD("st3",n.uv3):""}
		${d?`matrix4d primvars:skel:geomBindTransform = ( (1, 0, 0, 0), (0, 1, 0, 0), (0, 0, 1, 0), (0, 0, 0, 1) ) (
				elementSize = 1
				interpolation = "constant"
			)`:""}
		${n.skinIndex?`int[] primvars:skel:jointIndices = [${eY(h,!0)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
		${n.skinWeight?`float[] primvars:skel:jointWeights = [${eY(n.skinWeight)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
		${n.color?`color3f[] primvars:displayColor = [${UR(n.color,r)}] (
			interpolation = "vertex"
		)`:""}
        uniform token subdivisionScheme = "none"
    }
}
${t?`
# This is a workaround for QuickLook/RealityKit not supporting the doubleSided attribute. We're adding a second
# geometry definition here, that uses the same mesh data but appends extra faces with reversed winding order.
def "${i}_doubleSided" (
	prepend references = </Geometry>
)
{
	over "Geometry"
	{
		int[] faceVertexCounts = [${aD(s)+", "+aD(s)}]
		int[] faceVertexIndices = [${lD(s)+", "+lD(s,!0)}]
	}
}
`:""}
`}function aD(s){const e=s.index!==null?s.index.count:s.attributes.position.count;return Array(Math.floor(e/3)).fill(3).join(", ")}function lD(s,e=!1){const t=s.index,i=[];if(t!==null)for(let n=0;n<t.count;n++){let r=n;e&&(r=n%3===0?n+2:n%3===2?n-2:n),i.push(t.getX(r))}else{const n=s.attributes.position.count;for(let r=0;r<n;r++){let o=r;e&&(o=r%3===0?r+2:r%3===2?r-2:r),i.push(o)}}return i.join(", ")}function cD(s,e){const t=e.itemSize;switch(t){case 2:return`texCoord2f[] primvars:${s} = [${woe(e,t,!0)}] (
				interpolation = "vertex"
			)`;case 3:return`texCoord3f[] primvars:${s} = [${UR(e,t)}] (
				interpolation = "vertex"
			)`;case 4:return`double4[] primvars:${s} = [${Ake(e,t)}] (
				interpolation = "vertex"
			)`;default:return console.warn("USDZExporter: Attribute with "+t+" components are currently not supported. Results may be undefined for "+s+"."),""}}function UR(s,e){if(s===void 0)return console.warn("USDZExporter: A mesh attribute is missing and will be set with placeholder data. The result may look incorrect."),Array(e).fill("(0, 0, 1)").join(", ");const t=[];for(let i=0;i<s.count;i++){const n=s.getX(i),r=s.getY(i),o=s.getZ(i);t.push(`(${n.toPrecision(Zn)}, ${r.toPrecision(Zn)}, ${o.toPrecision(Zn)})`)}return t.join(", ")}function Ake(s,e){if(s===void 0)return console.warn("USDZExporter: Attribute is missing. Results may be undefined."),Array(e).fill("(0, 0, 0, 0)").join(", ");const t=[];for(let i=0;i<s.count;i++){const n=s.getX(i),r=s.getY(i),o=s.getZ(i)||0,a=s.getW(i)||0;t.push(`(${n.toPrecision(Zn)}, ${r.toPrecision(Zn)}, ${o.toPrecision(Zn)}, ${a.toPrecision(Zn)})`)}return t.join(", ")}function eY(s,e=!1){const t=[];for(let i=0;i<s.count;i++){const n=s.getX(i),r=s.getY(i),o=s.getZ(i),a=s.getW(i);t.push(`${e?n:n.toPrecision(Zn)}`),t.push(`${e?r:r.toPrecision(Zn)}`),t.push(`${e?o:o.toPrecision(Zn)}`),t.push(`${e?a:a.toPrecision(Zn)}`)}return t.join(", ")}function woe(s,e,t=!1){if(s===void 0)return console.warn("USDZExporter: UVs missing."),Array(e).fill("(0, 0)").join(", ");const i=[];for(let n=0;n<s.count;n++){const r=s.getX(n);let o=s.getY(n);t&&(o=1-o),i.push(`(${r.toPrecision(Zn)}, ${o.toPrecision(Zn)})`)}return i.join(", ")}function yke(s,e,t=!1){const i=[];for(const n in s){const r=s[n];i.push(bke(r,e,t))}return`
	def "Materials"
    {
${i.join("")}
    }`}function bke(s,e,t=!1){var m,g,A;const i=C5(s);if(console.log(s),s.colorWrite===!1||((m=s.userData)==null?void 0:m.isShadowCatcherMaterial)||((g=s.userData)==null?void 0:g.isLightBlendMaterial)){const y=s.userData.isLightBlendMaterial||s.userData.isShadowCatcherMaterial?"ND_realitykit_shadowreceiver_surfaceshader":"ND_realitykit_occlusion_surfaceshader";return`

		def Material "${i}" ${s.name?`(
			displayName = "${s.name}"
		)`:""}
		{
			token outputs:mtlx:surface.connect = ${fa}/${i}/Occlusion.outputs:out>

			def Shader "Occlusion"
			{
				uniform token info:id = "${y}"
				token outputs:out
			}
		}`}const r="                ",o=[],a=[],l=new Set;function c(y){var b;return Vh(y.name)+"_"+(((b=y.source)==null?void 0:b.id)??y.id)}function h(y,b,x=void 0,v=void 0){const _=c(y),C=_+(v!==void 0&&v!==1?"_"+v:""),S=t&&v!==void 0&&v!==1,M=S?new Je(1,1,1,v):void 0;v===void 0&&(v=1),S&&(v=1),M&&M.w<=.05&&(M.w=.05),e[C]={texture:y,scale:M};const L=y.channel>0?"st"+y.channel:"st";l.add(y.channel);const w=Soe.includes(y.format),E={1e3:"repeat",1001:"clamp",1002:"mirror"},B=y.repeat.clone(),P=y.offset.clone(),k=y.rotation,X=Math.sin(k),F=Math.cos(k);P.y=1-P.y-B.y,t?(B.x===0&&(B.x=1e-4),B.y===0&&(B.y=1e-4),P.x=P.x/B.x,P.y=P.y/B.y,P.x+=X/B.x,P.y+=F-1):(P.x+=X*B.x,P.y+=(1-F)*B.y);const H=B.x!=1||B.y!=1||P.x!=0||P.y!=0||k!=0,W=`${fa}/${i}/${"uvReader_"+L}.outputs:result>`,se=`${fa}/${i}/Transform2d_${b}.outputs:result>`,de=b!=="normal"&&x&&(x.r!==1||x.g!==1||x.b!==1||v!==1)||!1,be=b==="normal",Pe=s instanceof Us&&s.normalScale?s.normalScale.x*2:2,Oe=Pe.toFixed(Zn),ae=(-1*(Pe/2)).toFixed(Zn),Ae=(1-Pe).toFixed(Zn);return`
			${H?`def Shader "Transform2d_${b}" (
				sdrMetadata = {
					string role = "math"
				}
			)
			{
				uniform token info:id = "UsdTransform2d"
				float2 inputs:in.connect = ${W}
				float2 inputs:scale = ${iY(B)}
				float2 inputs:translation = ${iY(P)}
				float inputs:rotation = ${(k/Math.PI*180).toFixed(Zn)}
				float2 outputs:result
			}
			`:""}
			def Shader "${_}_${b}"
			{
				uniform token info:id = "UsdUVTexture"
				asset inputs:file = @textures/${C}.${w?"png":"jpg"}@
				token inputs:sourceColorSpace = "${y.colorSpace==="srgb"?"sRGB":"raw"}"
				float2 inputs:st.connect = ${H?se:W}
				${de?`
				float4 inputs:scale = (${x?x.r+", "+x.g+", "+x.b:"1, 1, 1"}, ${v})
				`:""}
				${be?`
				float4 inputs:scale = (${Oe}, ${Oe}, ${Oe}, 1)
				float4 inputs:bias = (${ae}, ${ae}, ${Ae}, 0)
				`:""}
				token inputs:wrapS = "${E[y.wrapS]}"
				token inputs:wrapT = "${E[y.wrapT]}"
				float outputs:r
				float outputs:g
				float outputs:b
				float3 outputs:rgb
				${s.transparent||s.alphaTest>0?"float outputs:a":""}
			}`}let d=s.transparent||s.alphaTest?s.opacity:1,u=!1,f=!1;if(s instanceof To&&s.transmission!==void 0&&(d*=1-s.transmission*(1-s.roughness*.5)),s.map?(o.push(`${r}color3f inputs:diffuseColor.connect = ${fa}/${i}/${c(s.map)}_diffuse.outputs:rgb>`),s instanceof ii&&s.transparent&&s.alphaTest==0&&t?(o.push(`${r}float inputs:opacity.connect = ${fa}/${i}/${c(s.map)}_diffuse.outputs:a>`),u=!0,o.push(`${r}float inputs:opacityThreshold = ${1e-10}`),f=!0):s.transparent?(o.push(`${r}float inputs:opacity.connect = ${fa}/${i}/${c(s.map)}_diffuse.outputs:a>`),u=!0):s.alphaTest>0&&(o.push(`${r}float inputs:opacity.connect = ${fa}/${i}/${c(s.map)}_diffuse.outputs:a>`),u=!0,o.push(`${r}float inputs:opacityThreshold = ${s.alphaTest}`),f=!0),a.push(h(s.map,"diffuse",s.color,d))):o.push(`${r}color3f inputs:diffuseColor = ${tY(s.color)}`),s.alphaHash&&t&&(f?console.warn("Opacity threshold for "+s.name+" was already connected. Skipping alphaHash opacity threshold."):(o.push(`${r}float inputs:opacityThreshold = 0.0000000001`),f=!0)),s.aoMap&&(o.push(`${r}float inputs:occlusion.connect = ${fa}/${i}/${c(s.aoMap)}_occlusion.outputs:r>`),a.push(h(s.aoMap,"occlusion"))),s.alphaMap?(o.push(`${r}float inputs:opacity.connect = ${fa}/${i}/${c(s.alphaMap)}_opacity.outputs:r>`),o.push(`${r}float inputs:opacityThreshold = 0.0000000001`),u=!0,f=!0,a.push(h(s.alphaMap,"opacity",new ge(1,1,1),d))):(u?console.warn("Opacity for "+s.name+" was already connected. Skipping default opacity."):(o.push(`${r}float inputs:opacity = ${d}`),u=!0),s.alphaTest>0&&(f?console.warn("Opacity threshold for "+s.name+" was already connected. Skipping default opacity threshold."):(o.push(`${r}float inputs:opacityThreshold = ${s.alphaTest}`),f=!0))),s instanceof Us){if(s.emissiveMap){o.push(`${r}color3f inputs:emissiveColor.connect = ${fa}/${i}/${c(s.emissiveMap)}_emissive.outputs:rgb>`);const y=s.emissive.clone();y.multiplyScalar(s.emissiveIntensity),a.push(h(s.emissiveMap,"emissive",y))}else if(((A=s.emissive)==null?void 0:A.getHex())>0){const y=s.emissive.clone();y.multiplyScalar(s.emissiveIntensity),o.push(`${r}color3f inputs:emissiveColor = ${tY(y)}`)}s.normalMap&&(o.push(`${r}normal3f inputs:normal.connect = ${fa}/${i}/${c(s.normalMap)}_normal.outputs:rgb>`),a.push(h(s.normalMap,"normal"))),s.roughnessMap&&s.roughness===1?(o.push(`${r}float inputs:roughness.connect = ${fa}/${i}/${c(s.roughnessMap)}_roughness.outputs:g>`),a.push(h(s.roughnessMap,"roughness"))):o.push(`${r}float inputs:roughness = ${s.roughness!==void 0?s.roughness:1}`),s.metalnessMap&&s.metalness===1?(o.push(`${r}float inputs:metallic.connect = ${fa}/${i}/${c(s.metalnessMap)}_metallic.outputs:b>`),a.push(h(s.metalnessMap,"metallic"))):o.push(`${r}float inputs:metallic = ${s.metalness!==void 0?s.metalness:0}`)}return s instanceof To&&(o.push(`${r}float inputs:clearcoat = ${s.clearcoat}`),o.push(`${r}float inputs:clearcoatRoughness = ${s.clearcoatRoughness}`),o.push(`${r}float inputs:ior = ${s.ior}`),!s.transparent&&!(s.alphaTest>0)&&s.transmissionMap&&(o.push(`${r}float inputs:opacity.connect = ${fa}/${i}/${c(s.transmissionMap)}_transmission.outputs:r>`),a.push(h(s.transmissionMap,"transmission")))),l.size>2?console.warn("USDZExporter: Material "+s.name+" uses more than 2 UV channels. Currently, only UV0 and UV1 are supported."):l.size===2&&(!l.has(0)||!l.has(1))&&console.warn("USDZExporter: Material "+s.name+" uses UV channels other than 0 and 1. Currently, only UV0 and UV1 are supported."),`

		def Material "${i}" ${s.name?`(
			displayName = "${foe(s.name)}"
		)`:""}
		{
			token outputs:surface.connect = ${fa}/${i}/PreviewSurface.outputs:surface>

			def Shader "PreviewSurface"
			{
				uniform token info:id = "UsdPreviewSurface"
${o.join(`
`)}
				int inputs:useSpecularWorkflow = ${s instanceof ii?"1":"0"}
				token outputs:surface
			}
${a.length>0?`
${l.has(0)?`
			def Shader "uvReader_st"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${l.has(1)?`
			def Shader "uvReader_st1"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st1"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${a.join(`
`)}`:""}
		}`}function tY(s){return`(${s.r}, ${s.g}, ${s.b})`}function iY(s){return`(${s.x}, ${s.y})`}const Soe=[1023,33777,33778,33779,35842,35843,37496,37808,37809,37810,37811,37812,37813,37814,37815,37816,37817,37818,37819,37820,37821,36492];ee("debugusdz");const jZ=class{constructor(e,t,i){p(this,"id");p(this,"trigger");p(this,"action");p(this,"exclusive",!1);this.id="Behavior_"+Vh(e)+"_"+jZ.global_id++,this.trigger=t,this.action=i}makeExclusive(e){return this.exclusive=e,this}writeTo(e,t,i){if(!this.trigger||!this.action)return;i.beginBlock(`def Preliminary_Behavior "${this.id}"`);let n="";if(Array.isArray(this.trigger)){n="[";for(let r=0;r<this.trigger.length;r++){const o=this.trigger[r];n+="<"+o.id+">",r+1<this.trigger.length&&(n+=", ")}n+="]"}else n=`<${this.trigger.id}>`;if(i.appendLine(`rel triggers = ${n}`),i.appendLine(`rel actions = <${this.action.id}>`),i.appendLine(`uniform bool exclusive = ${this.exclusive?1:0}`),i.appendLine(),Array.isArray(this.trigger))for(const r of this.trigger)r.writeTo(t,i),i.appendLine();else this.trigger.writeTo(t,i);i.appendLine(),this.action.writeTo(t,i),i.closeBlock()}};let er=jZ;p(er,"global_id",0);const ky=new Set;function Rz(s,e){var i,n;let t="";if(Array.isArray(s)){ky.clear();let r="[ ";for(let o=0;o<s.length;o++){let a=s[o];if(!a){console.warn("Invalid target object in behavior",s+". Is the object exported?");continue}if(typeof a=="string"){if(ky.has(a))continue;r+=a,ky.add(a)}else if(typeof a=="object"){if(a.isObject3D&&(a=e.findById(a.uuid),!a)){console.warn("Invalid target object in behavior",s+". Is the object exported?");continue}const l=(i=a.getPath)==null?void 0:i.call(a);if(ky.has(l))continue;r+=l,ky.add(l)}o+1<s.length&&(r+=", ")}r+=" ]",t=r,ky.clear()}else if(typeof s=="object"){const r=s;if(r.isObject3D&&(s=e.findById(r.uuid)),!s)throw console.error("Invalid target object in behavior, the target object is likely missing from USDZ export. Is the object exported?",r),new Error(`Invalid target object in behavior, the target object is likely missing from USDZ export. Please report a bug. uuid: ${r.uuid}.`);t=(n=s.getPath)==null?void 0:n.call(s)}return t}const qZ=class{constructor(e,t){p(this,"id");p(this,"targetId");p(this,"tokenId");p(this,"type");p(this,"distance");e&&(this.targetId=e),t?this.id=t:this.id="Trigger_"+qZ.global_id++}writeTo(e,t){t.beginBlock(`def Preliminary_Trigger "${this.id}"`),this.targetId&&(typeof this.targetId!="string"&&(this.targetId=Rz(this.targetId,e)),t.appendLine("rel affectedObjects = "+this.targetId)),this.tokenId&&t.appendLine(`token info:id = "${this.tokenId}"`),this.type&&t.appendLine(`token type = "${this.type}"`),typeof this.distance=="number"&&t.appendLine(`double distance = ${this.distance}`),t.closeBlock()}};let Zd=qZ;p(Zd,"global_id",0);function nY(s,e={direct:!0,indirect:!0}){const t=Co.createEmpty();t.name="InputTarget_"+t.name,t.displayName=void 0,t.type="RealityKitComponent",t.onSerialize=i=>{i.appendLine("bool allowsDirectInput = "+(e.direct?1:0)),i.appendLine("bool allowsIndirectInput = "+(e.indirect?1:0)),i.appendLine('uniform token info:id = "RealityKit.InputTarget"')},s.add(t)}class Or{static sceneStartTrigger(){const e=new Zd;return e.targetId=void 0,e.tokenId="SceneTransition",e.type="enter",e}static tapTrigger(e,t={direct:!0,indirect:!0}){const i=new Zd(e);if(Array.isArray(e)&&e.length>1)for(const n of e)n instanceof Co&&nY(n,t);else e instanceof Co&&nY(e,t);return i.tokenId="TapGesture",i}static isTapTrigger(e){return(e==null?void 0:e.tokenId)==="TapGesture"}static proximityToCameraTrigger(e,t){const i=new Zd(e);return i.tokenId="ProximityToCamera",i.distance=t,i}}class up{constructor(e,t){p(this,"id");p(this,"actions");p(this,"loops",0);p(this,"performCount",1);p(this,"type","serial");p(this,"multiplePerformOperation");this.id=e,this.actions=t}static getId(){return this.global_id++}addAction(e){return this.actions.push(e),this}makeParallel(){return this.type="parallel",this}makeSequence(){return this.type="serial",this}makeLooping(){return this.loops=1,this.performCount=0,this}makeRepeat(e){return this.performCount=e,this}writeTo(e,t){t.beginBlock(`def Preliminary_Action "${this.id}"`),t.beginArray("rel actions");for(const i of this.actions){if(!i)continue;const n=i===this.actions[this.actions.length-1];t.appendLine("<"+i.id+">"+(n?"":", "))}t.closeArray(),t.appendLine(),t.appendLine('token info:id = "Group"'),t.appendLine(`bool loops = ${this.loops}`),t.appendLine(`int performCount = ${this.loops>0?0:Math.max(0,this.performCount)}`),t.appendLine(`token type = "${this.type}"`),typeof this.multiplePerformOperation=="string"&&t.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),t.appendLine();for(const i of this.actions)i&&(i.writeTo(e,t),t.appendLine());t.closeBlock()}}p(up,"global_id",0);const z2=class{constructor(e,t){p(this,"id");p(this,"tokenId");p(this,"affectedObjects");p(this,"easeType");p(this,"motionType");p(this,"duration");p(this,"moveDistance");p(this,"style");p(this,"type");p(this,"front");p(this,"up");p(this,"start");p(this,"animationSpeed");p(this,"reversed");p(this,"pingPong");p(this,"xFormTarget");p(this,"audio");p(this,"gain");p(this,"auralMode");p(this,"multiplePerformOperation");p(this,"velocity");p(this,"comment");p(this,"animationName");e&&(this.affectedObjects=e),t?this.id=t:this.id="Action",this.id+="_"+z2.global_id++}clone(){const e=new z2,t=e.id;return Object.assign(e,this),e.id=t,e}writeTo(e,t){t.beginBlock(`def Preliminary_Action "${this.id}"`),this.comment&&t.appendLine(`# ${this.comment}`),this.affectedObjects&&(typeof this.affectedObjects!="string"&&(this.affectedObjects=Rz(this.affectedObjects,e)),t.appendLine("rel affectedObjects = "+this.affectedObjects)),typeof this.duration=="number"&&(typeof this.animationSpeed=="number"&&this.animationSpeed!==1?t.appendLine(`double duration = ${this.duration/this.animationSpeed} `):t.appendLine(`double duration = ${this.duration} `)),this.easeType&&t.appendLine(`token easeType = "${this.easeType}"`),this.tokenId&&t.appendLine(`token info:id = "${this.tokenId}"`),this.tokenId==="ChangeScene"&&t.appendLine("rel scene = </StageRoot/Scenes/Scene>"),this.motionType!==void 0&&t.appendLine(`token motionType = "${this.motionType}"`),typeof this.moveDistance=="number"&&t.appendLine(`double moveDistance = ${this.moveDistance} `),this.style&&t.appendLine(`token style = "${this.style}"`),this.type&&t.appendLine(`token type = "${this.type}"`),this.front&&t.appendLine(`vector3d front = (${this.front.x}, ${this.front.y}, ${this.front.z})`),this.up&&t.appendLine(`vector3d upVector = (${this.up.x}, ${this.up.y}, ${this.up.z})`),typeof this.start=="number"&&t.appendLine(`double start = ${this.start} `),typeof this.animationSpeed=="number"&&t.appendLine(`double animationSpeed = ${this.animationSpeed.toFixed(2)} `),typeof this.reversed=="boolean"&&t.appendLine(`bool reversed = ${this.reversed}`),typeof this.pingPong=="boolean"&&t.appendLine(`bool reverses = ${this.pingPong}`),this.xFormTarget&&(typeof this.xFormTarget!="string"&&(this.xFormTarget=Rz(this.xFormTarget,e)),t.appendLine(`rel xformTarget = ${this.xFormTarget}`)),typeof this.audio=="string"&&t.appendLine(`asset audio = @${this.audio}@`),typeof this.gain=="number"&&t.appendLine(`double gain = ${this.gain}`),typeof this.auralMode=="string"&&t.appendLine(`token auralMode = "${this.auralMode}"`),typeof this.multiplePerformOperation=="string"&&t.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),typeof this.velocity=="object"&&t.appendLine(`vector3d velocity = (${this.velocity.x}, ${this.velocity.y}, ${this.velocity.z})`),t.closeBlock()}};let _a=z2;p(_a,"global_id",0);let Pb=class db{constructor(e,t,i){p(this,"x",0);p(this,"y",0);p(this,"z",0);this.x=e,this.y=t,this.z=i}static get up(){return new db(0,1,0)}static get right(){return new db(1,0,0)}static get forward(){return new db(0,0,1)}static get back(){return new db(0,0,-1)}static get zero(){return new db(0,0,0)}};class zi{static sequence(...e){return new up("Group_"+up.getId(),e).makeSequence()}static parallel(...e){return new up("Group_"+up.getId(),e).makeParallel()}static fadeAction(e,t,i){const n=new _a(e);return n.tokenId="Visibility",n.type=i?"show":"hide",n.duration=t,n.style="basic",n.motionType="none",n.moveDistance=0,n.easeType="none",n}static startAnimationAction(e,t,i=!1,n=!1){const r=new _a(e);r.tokenId="StartAnimation";const o=t.start,a=t.duration,l=t.speed,c=t.clipName;if(r.comment=`Animation: ${c}, start=${o*60}, length=${a*60}, end=${(o+a)*60}`,r.animationName=c,r.start=o,r.duration=a,r.animationSpeed=l,r.reversed=i,r.pingPong=n,r.multiplePerformOperation="allow",i&&(r.start-=a),n){r.pingPong=!1;const h=r.clone();return h.reversed=!i,h.start=r.start,h.reversed&&(h.start-=a),zi.sequence(r,h)}return r}static waitAction(e){const t=new _a;return t.tokenId="Wait",t.duration=e,t.motionType=void 0,t}static lookAtCameraAction(e,t,i,n){const r=new _a(e);return r.tokenId="LookAtCamera",r.duration=t===void 0?9999999999999:t,r.front=i??Pb.forward,r.up=n??Pb.up,r}static emphasize(e,t,i="bounce",n=1,r="basic"){const o=new _a(e);return o.tokenId="Emphasize",o.duration=t,o.style=r??"basic",o.motionType=i,o.moveDistance=n,o}static transformAction(e,t,i,n,r="inout"){const o=new _a(e);return o.tokenId="Transform",o.duration=i,o.duration=Math.max(1e-6,i),o.type=n,o.easeType=i>0?r:"none",Array.isArray(t)&&console.error("Transform target must not be an array",t),o.xFormTarget=t,o}static playAudioAction(e,t,i="play",n=1,r="spatial"){const o=new _a(e);return o.tokenId="Audio",o.type=i,o.audio=t,o.gain=n,o.auralMode=r,o.multiplePerformOperation="allow",o}static impulseAction(e,t){const i=new _a(e);return i.tokenId="Impulse",i.velocity=t,i}}class xke{constructor(e){p(this,"object");p(this,"model");this.object=e}get id(){return this.object.uuid}apply(e){if(!this.model&&(this.model=e.findById(this.object.uuid),!this.model)){console.error("could not find model with id "+this.object.uuid);return}this.onApply(e)}}class w5 extends xke{constructor(t,i,n,r){super(t);p(this,"matrix");p(this,"material");p(this,"geometry");p(this,"_enableAction");p(this,"_disableAction");this.matrix=i,this.material=n,this.geometry=r}onApply(t){var r,o;const i=this.model;if(!i)return;(r=i.parent)!=null&&r.isDynamic||Co.createEmptyParent(i);const n=i.clone();this.matrix&&n.setMatrix(this.matrix),this.material&&(n.material=this.material),this.geometry&&(n.geometry=this.geometry),(o=i.parent)==null||o.add(n)}enable(){return this._enableAction?this._enableAction:(this._enableAction=zi.fadeAction(this.object,0,!0),this._enableAction)}disable(){return this._disableAction?this._disableAction:(this._disableAction=zi.fadeAction(this.object,0,!1),this._disableAction)}}class S5{constructor(e){p(this,"actions");p(this,"sortedActions");this.actions=[...e]}organize(){this.sortedActions={};for(const e of this.actions){const t=e.id;this.sortedActions[t]||(this.sortedActions[t]=[]),this.sortedActions[t].push(e)}}getActions(e){return this.sortedActions||this.organize(),this.sortedActions[e.uuid]}}const av=function(s){return I(s)},I=function(s){if(s===void 0&&(s=null),!Array.isArray(s))s=sY(s);else for(let e=0;e<s.length;e++){const t=s[e];s[e]=sY(t)}return function(e,t){typeof t!="string"&&(t=t.name),Object.getOwnPropertyDescriptor(e,"$serializedTypes")||(e.$serializedTypes={});const i=e.$serializedTypes=e.$serializedTypes||{};i[t]=s}};function sY(s){var e,t;switch((t=(e=s==null?void 0:s.prototype)==null?void 0:e.constructor)==null?void 0:t.name){case"Number":case"String":case"Boolean":return null}return s}class $ extends ye{constructor(){super(...arguments);p(this,"guid")}static isDestroyed(t){return eA(t)}static setActive(t,i,n=!0){t&&(aw(t,i),BR(t),i&&n&&rre(Wt.Current,t))}static isActiveSelf(t){return rv(t)}static isActiveInHierarchy(t){return Ere(t)}static markAsInstancedRendered(t,i){Rre(t,i)}static isUsingInstancing(t){return yP(t)}static foreachComponent(t,i,n=!0){return tA(t,i,n)}static instantiateSynced(t,i){return t?a5(t,i):null}static instantiate(t,i=null){return ov(t,i)}static destroySynced(t,i,n=!0){if(!t)return;const r=t;i=i??Wt.Current,cM(r,i.connection,n)}static destroy(t,i=!0){return ic(t,i)}static add(t,i,n){if(!(!t||!i)){if(t===i){console.warn("Can not add object to self",t);return}n||(n=Wt.Current),i.add(t),aw(t,!0),BR(t),n?$.foreachComponent(t,r=>{r5(r,n),!r.__internalDidAwakeAndStart&&n.new_script_start.includes(r)===!1&&n.new_script_start.push(r)},!0):console.warn("Missing context")}}static remove(t){var i;t&&((i=t.parent)==null||i.remove(t),aw(t,!1),BR(t),$.foreachComponent(t,n=>{RBe(n)},!0))}static invokeOnChildren(t,i,...n){this.invoke(t,i,!0,n)}static invoke(t,i,n=!1,...r){t&&this.foreachComponent(t,o=>{const a=o[i];a&&typeof a=="function"&&(a==null||a.call(o,...r))},n)}static addNewComponent(t,i,n,r=!0){return Yl(t,i,n,{callAwake:r})}static addComponent(t,i,n,r){return Yl(t,i,n,r)}static moveComponent(t,i){return Yl(t,i)}static removeComponent(t){return u5(t.gameObject,t),t}static getOrAddComponent(t,i){return dM(t,i)}static getComponent(t,i){return t===null?null:vA(t,i)}static getComponents(t,i,n=null){return t===null?n??[]:uM(t,i,n)}static findByGuid(t,i){return p5(t,i)}static findObjectOfType(t,i,n=!0){return gP(t,i??Wt.Current,n)}static findObjectsOfType(t,i){const n=[];return Ire(t,n,i),n}static getComponentInChildren(t,i){return pM(t,i)}static getComponentsInChildren(t,i,n=null){return sv(t,i,n??void 0)}static getComponentInParent(t,i){return AS(t,i)}static getComponentsInParent(t,i,n=null){return mP(t,i,n)}static getAllComponents(t){var r;const i=(r=t.userData)==null?void 0:r.components;return i?[...i]:[]}static*iterateComponents(t){var n;const i=(n=t==null?void 0:t.userData)==null?void 0:n.components;if(i&&Array.isArray(i))for(let r=0;r<i.length;r++)yield i[r]}}var Md;let ze=(Md=class{constructor(e){p(this,"__context");p(this,"__name");p(this,"gameObject");p(this,"guid","invalid");p(this,"sourceId");p(this,"__didAwake",!1);p(this,"__didStart",!1);p(this,"__didEnable",!1);p(this,"__isEnabled");p(this,"__destroyed",!1);p(this,"_eventListeners",new Map);this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(e)}get isComponent(){return!0}get context(){return this.__context??Wt.Current}set context(e){this.__context=e}get scene(){return this.context.scene}get layer(){var e,t;return(t=(e=this.gameObject)==null?void 0:e.userData)==null?void 0:t.layer}get name(){var e,t;return(e=this.gameObject)!=null&&e.name?this.gameObject.name:(t=this.gameObject)==null?void 0:t.userData.name}set name(e){this.gameObject?(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.name=e,this.__name=e):this.__name=e}get tag(){var e;return(e=this.gameObject)==null?void 0:e.userData.tag}set tag(e){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.tag=e)}get static(){var e;return(e=this.gameObject)==null?void 0:e.userData.static}set static(e){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.static=e)}get hideFlags(){var e;return(e=this.gameObject)==null?void 0:e.userData.hideFlags}get activeAndEnabled(){return!(this.destroyed||this.__isEnabled===!1||!this.__isActiveInHierarchy)}get __isActive(){return this.gameObject.visible}get __isActiveInHierarchy(){if(!this.gameObject)return!1;const e=this.gameObject[yp];return e===void 0?!0:e}set __isActiveInHierarchy(e){this.gameObject&&(this.gameObject[yp]=e)}awake(){}onEnable(){}onDisable(){}onDestroy(){this.__destroyed=!0}startCoroutine(e,t=wn.Update){return this.context.registerCoroutineUpdate(this,e,t)}stopCoroutine(e,t=wn.Update){this.context.unregisterCoroutineUpdate(e,t)}get destroyed(){return this.__destroyed}destroy(){this.__destroyed||this.__internalDestroy()}get __internalDidAwakeAndStart(){return this.__didAwake&&this.__didStart}__internalNewInstanceCreated(e){return this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(e),this}_internalInit(e){if(typeof e=="object")for(const t of Object.keys(e)){const i=e[t];typeof i!="function"&&(this[t]=i)}}__internalAwake(){this.__didAwake||(this.__didAwake=!0,this.awake())}__internalStart(){this.__didStart||(this.__didStart=!0,this.start&&this.start())}__internalEnable(e){return this.__destroyed?(Qe()&&console.warn("[Needle Engine Dev] Trying to enable destroyed component"),!1):this.__didAwake?this.__didEnable?(e!==!0&&(this.__isEnabled=!0),!1):(this.__didEnable=!0,this.__isEnabled=!0,this.onEnable(),!0):!1}__internalDisable(e){if(this.__didAwake){if(!this.__didEnable){e!==!0&&(this.__isEnabled=!1);return}this.__didEnable=!1,this.__isEnabled=!1,this.onDisable()}}__internalDestroy(){var e;this.__destroyed||(this.__destroyed=!0,this.__didAwake&&((e=this.onDestroy)==null||e.call(this),this.dispatchEvent(new CustomEvent("destroyed",{detail:this}))),Sre(this))}get enabled(){return typeof this.__isEnabled=="boolean"?this.__isEnabled:!0}set enabled(e){if(this.__destroyed){Qe()&&console.warn(`[Needle Engine Dev] Trying to ${e?"enable":"disable"} destroyed component`);return}if(typeof e=="number"&&(e>=.5?e=!0:e=!1),!this.__didAwake){this.__isEnabled=e;return}e?this.__internalEnable():this.__internalDisable()}get worldPosition(){return $t(this.gameObject)}set worldPosition(e){_r(this.gameObject,e)}setWorldPosition(e,t,i){q0(this.gameObject,e,t,i)}get worldQuaternion(){return gn(this.gameObject)}set worldQuaternion(e){Uc(this.gameObject,e)}setWorldQuaternion(e,t,i,n){mO(this.gameObject,e,t,i,n)}get worldEuler(){return AO(this.gameObject)}set worldEuler(e){yO(this.gameObject,e)}get worldRotation(){return this.gameObject.worldRotation}set worldRotation(e){this.setWorldRotation(e.x,e.y,e.z,!0)}setWorldRotation(e,t,i,n=!0){eM(this.gameObject,e,t,i,n)}get forward(){return Md._forward.set(0,0,-1).applyQuaternion(this.worldQuaternion)}get right(){return Md._right.set(1,0,0).applyQuaternion(this.worldQuaternion)}get up(){return Md._up.set(0,1,0).applyQuaternion(this.worldQuaternion)}addEventListener(e,t){this._eventListeners[e]=this._eventListeners[e]||[],this._eventListeners[e].push(t)}removeEventListener(e,t){if(!this._eventListeners[e])return;const i=this._eventListeners[e].indexOf(t);i>=0&&this._eventListeners[e].splice(i,1)}dispatchEvent(e){if(!e||!this._eventListeners[e.type])return!1;const t=this._eventListeners[e.type];for(let i=0;i<t.length;i++)t[i](e);return!1}},p(Md,"_forward",new T),p(Md,"_right",new T),p(Md,"_up",new T),Md);const vke=Object.freeze(Object.defineProperty({__proto__:null,Behaviour:ze,Component:ze,GameObject:$},Symbol.toStringTag,{value:"Module"}));var _ke=Object.defineProperty,Cke=Object.getOwnPropertyDescriptor,Moe=(s,e,t,i)=>{for(var n=i>1?void 0:i?Cke(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&_ke(e,t,n),n};class mM extends ze{constructor(){super(...arguments);p(this,"from");p(this,"to");p(this,"width",0);p(this,"centered",!0);p(this,"_centerPos")}awake(){this._centerPos=new T}update(){if(!this.from||!this.to)return;const t=$t(this.from).clone(),i=$t(this.to).clone(),n=t.distanceTo(i);this._centerPos.copy(t),this._centerPos.add(i),this._centerPos.multiplyScalar(.5),_r(this.gameObject,this.centered?this._centerPos:t),this.gameObject.lookAt($t(this.to).clone()),this.gameObject.scale.set(this.width,this.width,n)}}Moe([I($)],mM.prototype,"from",2);Moe([I($)],mM.prototype,"to",2);var wke=Object.defineProperty,Ske=Object.getOwnPropertyDescriptor,CA=(s,e,t,i)=>{for(var n=i>1?void 0:i?Ske(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&wke(e,t,n),n};const uf=ee("debuganimation");let Ioe=class{constructor(){p(this,"x");p(this,"y")}};class na extends ze{constructor(){super(...arguments);p(this,"playAutomatically",!0);p(this,"randomStartTime",!0);p(this,"minMaxSpeed");p(this,"minMaxOffsetNormalized");p(this,"loop",!0);p(this,"clampWhenFinished",!1);p(this,"_tempAnimationClipBeforeGameObjectExisted",null);p(this,"_tempAnimationsArray");p(this,"mixer");p(this,"_actions");p(this,"_handles")}get isAnimationComponent(){return!0}addClip(t){this.animations||(this.animations=[]),this.animations.push(t)}get time(){if(this.actions){for(const t of this.actions)if(t.isRunning())return t.time}return 0}set time(t){if(this.actions)for(const i of this.actions)i.time=t}get clip(){var t;return(t=this.animations)!=null&&t.length?this.animations[0]:null}set clip(t){if(!this.__didAwake){uf&&console.warn("Assign clip during serialization",t),this._tempAnimationClipBeforeGameObjectExisted=t;return}t&&(this.gameObject.animations||(this.gameObject.animations=[]),!this.animations.includes(t)&&(this.animations.length>0?this.animations.splice(0,0,t):this.animations.push(t)))}set clips(t){this.animations=t}set animations(t){t==null||!Array.isArray(t)||(this.gameObject?this.gameObject.animations=t:this._tempAnimationsArray=t)}get animations(){return this.gameObject.animations||this._tempAnimationsArray||[]}get actions(){return this._actions}set actions(t){this._actions=t}awake(){this.mixer=void 0,uf&&console.log("Animation Awake",this.name,this),this._tempAnimationsArray&&(this.animations=this._tempAnimationsArray,this._tempAnimationsArray=void 0),this._tempAnimationClipBeforeGameObjectExisted&&(this.clip=this._tempAnimationClipBeforeGameObjectExisted,this._tempAnimationClipBeforeGameObjectExisted=null),this.actions=[],this._handles=[]}onEnable(){var t;if(this.playAutomatically&&((t=this.animations)==null?void 0:t.length)>0){const i=Math.floor(Math.random()*this.animations.length),n=this.animations[i];this.play(i,{exclusive:!0,fadeDuration:0,startTime:this.randomStartTime?Math.random()*n.duration:0,loop:this.loop,clampWhenFinished:this.clampWhenFinished})}}update(){this.mixer&&(this.mixer.update(this.context.time.deltaTime),this._handles.forEach(t=>t.update()))}onDisable(){this.mixer&&this.mixer.stopAllAction()}onDestroy(){this.context.animations.unregisterAnimationMixer(this.mixer)}getAction(t){var i;return((i=this.actions)==null?void 0:i.find(n=>n.getClip().name===t))||null}get isPlaying(){if(this.actions){for(let t=0;t<this.actions.length;t++)if(this.actions[t].isRunning())return!0}return!1}stopAll(t){if(this.actions)for(const i of this.actions)t!=null&&t.fadeDuration?i.fadeOut(t.fadeDuration):i.stop()}stop(t,i){if(t===void 0){this.stopAll();return}else if(typeof t=="number"){if(t>=this.animations.length){uf&&console.log("No animation at index",t);return}t=this.animations[t]}else typeof t=="string"&&(t=this.animations.find(r=>r.name===t));if(!t){console.error("Could not find clip",t);return}const n=this.actions.find(r=>r.getClip()===t);if(!n){console.error("Could not find action",t);return}i!=null&&i.fadeDuration?n.fadeOut(i.fadeDuration):n.stop()}pause(t,i=!1){if(t===void 0){for(const r of this.actions)r.paused=!i;return}else if(typeof t=="number"){if(t>=this.animations.length){uf&&console.log("No animation at index",t);return}t=this.animations[t]}else typeof t=="string"&&(t=this.animations.find(r=>r.name===t));if(!t){console.error("Could not find clip",t);return}const n=this.actions.find(r=>r.getClip()===t);if(!n){console.error("Could not find action",t);return}n.paused=!i}resume(){for(const t of this.actions)t.paused=!1}play(t=0,i){if(uf&&console.log("PLAY",t),this.ensureMixer(),!this.mixer){uf&&console.warn("Missing mixer",this);return}t===void 0&&(t=0);let n=t;if(typeof t=="number"){if(t>=this.animations.length){uf&&console.log("No animation at index",t);return}n=this.animations[t]}else typeof t=="string"&&(n=this.animations.find(o=>o.name===t));if(!n){console.error("Could not find clip",t);return}i||(i={});for(const o of this.actions)if(o.getClip()===n)return this.internalOnPlay(o,i);if(!n.tracks){console.warn("Clip is no AnimationClip",n);return}const r=this.mixer.clipAction(n);return this.actions.push(r),this.internalOnPlay(r,i)}internalOnPlay(t,i){var n=this.actions.find(a=>a===t);if(n===t&&n.isRunning()&&n.time<n.getClip().duration){const a=this.tryFindHandle(t);if(n.paused&&(n.paused=!1),a)return a.waitForFinish()}if(i.loop===void 0&&(i.loop=this.loop),i.clampWhenFinished===void 0&&(i.clampWhenFinished=this.clampWhenFinished),i.minMaxOffsetNormalized===void 0&&this.randomStartTime&&(i.minMaxOffsetNormalized=this.minMaxOffsetNormalized),i.minMaxSpeed===void 0&&(i.minMaxSpeed=this.minMaxSpeed),(i==null?void 0:i.exclusive)??!0)for(const a of this.actions)a!=n&&(i.fadeDuration?a.fadeOut(i.fadeDuration):a.stop());if(i!=null&&i.fadeDuration&&t.fadeIn(i.fadeDuration),t.enabled=!0,(i==null?void 0:i.startTime)!=null)t.time=i.startTime;else if(i!=null&&i.minMaxOffsetNormalized&&i.minMaxOffsetNormalized.x!=0&&i.minMaxOffsetNormalized.y!=0){const a=t.getClip();t.time=lt.lerp(i.minMaxOffsetNormalized.x,i.minMaxOffsetNormalized.y,Math.random())*a.duration}else t.time>=t.getClip().duration&&(t.time=0);i!=null&&i.minMaxSpeed?t.timeScale=lt.lerp(i.minMaxSpeed.x,i.minMaxSpeed.y,Math.random()):t.timeScale=(i==null?void 0:i.speed)??1,(i==null?void 0:i.loop)!=null?t.loop=i.loop?EU:Pw:t.loop=Pw,i!=null&&i.clampWhenFinished&&(t.clampWhenFinished=!0),t.paused=!1,t.play(),uf&&console.log("PLAY",t.getClip().name,t);const o=new Mke(t,this.mixer,i,a=>{this._handles.splice(this._handles.indexOf(o),1)});return this._handles.push(o),o.waitForFinish()}tryFindHandle(t){for(const i of this._handles)if(i.action===t)return i}ensureMixer(){if(!this.mixer){const t="animationMixer";this.gameObject[t]&&(this.mixer=this.gameObject[t]),(!this.mixer||!this.mixer.clipAction)&&(this.mixer=new wB(this.gameObject),this.gameObject[t]=this.mixer)}this.context.animations.registerAnimationMixer(this.mixer)}}CA([I()],na.prototype,"playAutomatically",2);CA([I()],na.prototype,"randomStartTime",2);CA([I(Ioe)],na.prototype,"minMaxSpeed",2);CA([I(Ioe)],na.prototype,"minMaxOffsetNormalized",2);CA([I()],na.prototype,"loop",2);CA([I()],na.prototype,"clampWhenFinished",2);CA([I(Ba)],na.prototype,"clips",1);class Mke{constructor(e,t,i,n){p(this,"mixer");p(this,"action");p(this,"promise",null);p(this,"_options");p(this,"_resolveCallback",null);p(this,"_resolvedOrRejectedCallback");p(this,"onFinished",e=>{e.action===this.action&&this.onResolve()});this.action=e,this.mixer=t,this._resolvedOrRejectedCallback=n,this._options=i}waitForFinish(){return this.promise?this.promise:(this.promise=new Promise(e=>{this._resolveCallback=e}),this.mixer.addEventListener("finished",this.onFinished),this.promise)}update(){this._options&&this._options.endTime!==void 0&&this.action.time>this._options.endTime&&(this._options.loop===!0?this.action.time=this._options.startTime??0:(this.action.time=this._options.endTime,this.action.timeScale=0,this.onResolve()))}onResolve(){var e,t;this.dispose(),(e=this._resolvedOrRejectedCallback)==null||e.call(this,this),(t=this._resolveCallback)==null||t.call(this,this.action)}dispose(){this.mixer.removeEventListener("finished",this.onFinished)}}var Ike=Object.defineProperty,Tke=Object.getOwnPropertyDescriptor,Um=(s,e,t,i)=>{for(var n=i>1?void 0:i?Tke(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Ike(e,t,n),n};class Ea{constructor(e=0,t=0){p(this,"time",0);p(this,"value",0);p(this,"inTangent",1/0);p(this,"inWeight");p(this,"outTangent",1/0);p(this,"outWeight");p(this,"weightedMode");this.time=e,this.value=t}}Um([I()],Ea.prototype,"time",2);Um([I()],Ea.prototype,"value",2);Um([I()],Ea.prototype,"inTangent",2);Um([I()],Ea.prototype,"inWeight",2);Um([I()],Ea.prototype,"outTangent",2);Um([I()],Ea.prototype,"outWeight",2);Um([I()],Ea.prototype,"weightedMode",2);const vC=class{constructor(){p(this,"keys",[])}static linearFromTo(s,e,t){const i=new vC,n=new Ea;n.time=0,n.value=s;const r=new Ea;return r.time=t,r.value=e,i.keys.push(n,r),i}static constant(s){const e=new vC,t=new Ea;return t.time=0,t.value=s,e.keys.push(t),e}clone(){var e;const s=new vC;return s.keys=((e=this.keys)==null?void 0:e.map(t=>{const i=new Ea;return i.time=t.time,i.value=t.value,i.inTangent=t.inTangent,i.inWeight=t.inWeight,i.outTangent=t.outTangent,i.outWeight=t.outWeight,i.weightedMode=t.weightedMode,i}))||[],s}get duration(){return!this.keys||this.keys.length==0?0:this.keys[this.keys.length-1].time}evaluate(s){if(!this.keys||this.keys.length==0)return 0;if(this.keys.length===1)return this.keys[0].value;if(this.keys[0].time>=s)return this.keys[0].value;for(let e=0;e<this.keys.length;e++){const t=this.keys[e];if(t.time<=s)if(e+1<this.keys.length){const n=this.keys[e+1];if(n.time<s)continue;return!isFinite(t.outTangent)||!isFinite(n.inTangent)?t.value:vC.interpolateValue(s,t,n)}else return t.value}return this.keys[this.keys.length-1].value}static interpolateValue(s,e,t){const i=e.time,n=e.value,r=e.outTangent,o=t.time,a=t.value,l=t.inTangent,c=o-i,h=c*c,d=h*c,u=((r+l)*c-2*(a-n))/d,f=(3*(a-n)-(l+2*r)*c)/h,m=r,g=n,A=s-i,y=A*A,b=y*A;return u*b+f*y+m*A+g}};let wA=vC;Um([I(Ea)],wA.prototype,"keys",2);const XR=Symbol("objectIsAnimatedData");function rY(s,e,t){if(!s)return;if(s[XR]===void 0){if(!t)return;s[XR]=new Set}const i=s[XR];t?i.add(e):i.has(e)&&i.delete(e)}function Eke(s){if(!s)return!1;const e=s[XR];return e!==void 0&&e.size>0}class Rke{constructor(){p(this,"_context")}get context(){return this._context??Wt.Current}get isStateMachineBehaviour(){return!0}}class _C{constructor(e,t,i,n){p(this,"name");p(this,"nameHash");p(this,"normalizedTime");p(this,"length");p(this,"speed");p(this,"action");p(this,"hasTransitions");var r;this.name=e.name,this.nameHash=e.hash,this.normalizedTime=t,this.length=i,this.speed=n,this.action=e.motion.action||null,this.hasTransitions=((r=e.transitions)==null?void 0:r.length)>0||!1}}function Toe(s,e){return{name:"Empty",isLooping:!1,guid:(e==null?void 0:e.generateUUID())??Bi.generateUUID(),index:-1,clip:new Ba(s,0,[])}}var Ef=(s=>(s[s.If=1]="If",s[s.IfNot=2]="IfNot",s[s.Greater=3]="Greater",s[s.Less=4]="Less",s[s.Equals=6]="Equals",s[s.NotEqual=7]="NotEqual",s))(Ef||{}),M5=(s=>(s[s.Float=1]="Float",s[s.Int=3]="Int",s[s.Bool=4]="Bool",s[s.Trigger=9]="Trigger",s))(M5||{});const hr=ee("debuganimatorcontroller"),aE=ee("debugrootmotion");class Jl{constructor(e){p(this,"_speed",1);p(this,"normalizedStartOffset",0);p(this,"animator");p(this,"model");p(this,"_mixer");p(this,"_activeState");p(this,"_activeStates",[]);p(this,"_heldActions",[]);p(this,"rootMotionHandler");this.model=e,hr&&console.log(this)}static createFromClips(e,t={looping:!1,autoTransition:!0,transitionDuration:0}){const i=[];for(let o=0;o<e.length;o++){const a=e[o],l=[];if(t.autoTransition!==!1){const h=t.transitionDuration??0,d=h/a.duration;let u=o;(t.autoTransition===void 0||t.autoTransition===!0)&&(u=(o+1)%e.length),l.push({exitTime:1-d,offset:0,duration:h,hasExitTime:!0,destinationState:u,conditions:[]})}const c={name:a.name,hash:o,motion:{name:a.name,clip:a,isLooping:(t==null?void 0:t.looping)??!1},transitions:l,behaviours:[]};i.push(c)}const n={name:"AnimatorController",guid:new So(Date.now()).generateUUID(),parameters:[],layers:[{name:"Base Layer",stateMachine:{defaultState:0,states:i}}]};return new Jl(n)}play(e,t=-1,i=Number.NEGATIVE_INFINITY,n=0){if(t<0)t=0;else if(t>=this.model.layers.length){console.warn("invalid layer");return}const o=this.model.layers[t].stateMachine;for(const a of o.states)if(a.name===e||a.hash===e){hr&&console.log("transition to ",a),this.transitionTo(a,n,i);return}console.warn("Could not find "+e+" to play")}reset(){this.setStartTransition()}setBool(e,t){var n,r;const i=typeof e=="string"?"name":"hash";return(r=(n=this.model)==null?void 0:n.parameters)==null?void 0:r.filter(o=>o[i]===e).forEach(o=>o.value=t)}getBool(e){var i,n,r;const t=typeof e=="string"?"name":"hash";return((r=(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.find(o=>o[t]===e))==null?void 0:r.value)??!1}setFloat(e,t){var r,o;const i=typeof e=="string"?"name":"hash",n=(o=(r=this.model)==null?void 0:r.parameters)==null?void 0:o.filter(a=>a[i]===e);return n.forEach(a=>a.value=t),(n==null?void 0:n.length)>0}getFloat(e){var i,n,r;const t=typeof e=="string"?"name":"hash";return((r=(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.find(o=>o[t]===e))==null?void 0:r.value)??0}setInteger(e,t){var n,r;const i=typeof e=="string"?"name":"hash";return(r=(n=this.model)==null?void 0:n.parameters)==null?void 0:r.filter(o=>o[i]===e).forEach(o=>o.value=t)}getInteger(e){var i,n,r;const t=typeof e=="string"?"name":"hash";return((r=(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.find(o=>o[t]===e))==null?void 0:r.value)??0}setTrigger(e){var i,n;hr&&console.log("SET TRIGGER",e);const t=typeof e=="string"?"name":"hash";return(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.filter(r=>r[t]===e).forEach(r=>r.value=!0)}resetTrigger(e){var i,n;const t=typeof e=="string"?"name":"hash";return(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.filter(r=>r[t]===e).forEach(r=>r.value=!1)}getTrigger(e){var i,n,r;const t=typeof e=="string"?"name":"hash";return((r=(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.find(o=>o[t]===e))==null?void 0:r.value)??!1}isInTransition(){return this._activeStates.length>1}setSpeed(e){this._speed=e}FindState(e){return this.findState(e)}findState(e){if(!e)return null;if(Array.isArray(this.model.layers)){for(const t of this.model.layers)for(const i of t.stateMachine.states)if(i.name===e||i.hash==e)return i}return null}getCurrentStateInfo(){if(!this._activeState)return null;const e=this._activeState.motion.action;if(!e)return null;const t=this._activeState.motion.clip.duration,i=t<=0?0:Math.abs(e.time/t);return new _C(this._activeState,i,t,this._speed)}get currentAction(){if(!this._activeState)return null;const e=this._activeState.motion.action;return e||null}get context(){var e;return(e=this.animator)==null?void 0:e.context}get mixer(){return this._mixer}dispose(){var e;if(this._mixer.stopAllAction(),this.animator){this._mixer.uncacheRoot(this.animator.gameObject);for(const t of this._activeStates)t.motion.clip&&this.mixer.uncacheAction(t.motion.clip,this.animator.gameObject)}(e=this.context)==null||e.animations.unregisterAnimationMixer(this._mixer)}bind(e){var t,i;e?this.animator!==e&&(this._mixer&&(this._mixer.stopAllAction(),(t=this.context)==null||t.animations.unregisterAnimationMixer(this._mixer)),this.animator=e,this._mixer=new wB(this.animator.gameObject),(i=this.context)==null||i.animations.registerAnimationMixer(this._mixer),this.createActions(this.animator)):console.error("AnimatorController.bind: animator is null")}clone(){if(typeof this.model=="string")return console.warn("AnimatorController has not been resolved, can not create model from string",this.model),null;hr&&console.warn("AnimatorController clone()",this.model);const e=Y1(this.model,(i,n,r)=>r==null?!0:!(r.type==="Object3D"||r.isObject3D===!0||Iie(r)||r.tracks!==void 0||r instanceof Jl));return console.assert(e!==this.model),new Jl(e)}update(e){var i,n;if(!this.animator)return;this.evaluateTransitions(),this.updateActiveStates(e);const t=this.animator.context.time.deltaTime;this.animator.applyRootMotion&&((i=this.rootMotionHandler)==null||i.onBeforeUpdate(e)),this._mixer.update(t),this.animator.applyRootMotion&&((n=this.rootMotionHandler)==null||n.onAfterUpdate(e))}get activeState(){return this._activeState}updateActiveStates(e){for(let t=0;t<this._activeStates.length;t++){const i=this._activeStates[t],n=i.motion;if(!n.action)this._activeStates.splice(t,1),t--;else{const r=n.action;r.weight=e,r.getEffectiveWeight()<=0&&!r.isRunning()&&(hr&&console.debug("REMOVE",i.name,r.getEffectiveWeight(),r.isRunning(),r.isScheduled()),this._activeStates.splice(t,1),t--)}}}setStartTransition(){var e;this.model.layers.length>1&&(hr||Qe())&&console.warn("Multiple layers are not supported yet "+((e=this.animator)==null?void 0:e.name));for(const t of this.model.layers){const i=t.stateMachine;i.defaultState===void 0&&(hr&&console.warn("AnimatorController default state is undefined, will assign state 0 as default",t),i.defaultState=0);const n=i.states[i.defaultState];this.transitionTo(n,0,this.normalizedStartOffset);break}}evaluateTransitions(){var r;let e=!1;if(!this._activeState){if(this.setStartTransition(),!this._activeState)return;e=!0}const t=this._activeState,i=t.motion.action;for(const o of t.transitions){if(!o.hasExitTime&&o.conditions.length<=0)continue;let a=!0;for(const l of o.conditions)if(!this.evaluateCondition(l)){a=!1;break}if(a)if(i){const l=t.motion.clip.duration,c=l<=0?1:Math.abs(i.time/l);let h=o.exitTime;i.timeScale<0&&(h=1-h);let d=!1;if(o.hasExitTime?i.timeScale>0?d=c>=o.exitTime:i.timeScale<0&&(d=1-c>=o.exitTime):d=!0,d){for(const u of o.conditions){const f=this.model.parameters.find(m=>m.name===u.parameter);(f==null?void 0:f.type)===M5.Trigger&&f.value&&(f.value=!1)}if(i.clampWhenFinished=!0,hr){const u=this.getState(o.destinationState,0);console.log(`Transition to ${o.destinationState} / ${u==null?void 0:u.name}`,o,`
Timescale: `+i.timeScale,`
Normalized time: `+c.toFixed(3),`
Exit Time: `+h,o.hasExitTime)}this.transitionTo(o.destinationState,o.duration,o.offset);return}}else{this.transitionTo(o.destinationState,o.duration,o.offset);return}}i&&this.setTimescale(i,t);let n=!1;if(t.motion.isLooping&&i&&(i.time>=i.getClip().duration?(n=!0,i.reset(),i.time=0,i.play()):i.time<=0&&i.timeScale<0&&(n=!0,i.reset(),i.time=i.getClip().duration,i.play())),!n&&t&&!e&&i&&this.animator&&t.behaviours){const o=i==null?void 0:i.getClip().duration,a=i.time/o,l=new _C(this._activeState,a,o,this._speed);for(const c of t.behaviours)c.instance&&((r=c.instance.onStateUpdate)==null||r.call(c.instance,this.animator,l,0))}}setTimescale(e,t){let i=t.speed??1;t.speedParameter&&(i*=this.getFloat(t.speedParameter)),i!==void 0&&(e.timeScale=i*this._speed)}getState(e,t){return typeof e=="number"&&(e==-1&&(e=this.model.layers[t].stateMachine.defaultState,e===void 0&&(hr&&console.warn("AnimatorController default state is undefined: ",this.model,"Layer: "+t),e=0)),e=this.model.layers[t].stateMachine.states[e]),e}releaseHeldActions(e){for(const t of this._heldActions)t.fadeOut(e);this._heldActions.length=0}transitionTo(e,t,i){var h,d,u,f,m,g,A,y;if(!this.animator)return;const n=0;if(e=this.getState(e,n),!(e!=null&&e.motion)||!e.motion.clip||!(e.motion.clip instanceof Ba))return;const r=this._activeState===e;if(r){const b=e.motion;if(!b.action_loopback&&b.clip){const x=this.rootMotionHandler?this.animator.gameObject.matrix.clone():null;this._mixer.uncacheAction(b.clip,this.animator.gameObject),x&&x.decompose(this.animator.gameObject.position,this.animator.gameObject.quaternion,this.animator.gameObject.scale),b.action_loopback=this.createAction(b.clip)}}if((h=this._activeState)!=null&&h.behaviours&&this._activeState.motion.action){const b=(d=this._activeState)==null?void 0:d.motion.clip.duration,x=this._activeState.motion.action.time/b,v=new _C(this._activeState,x,b,this._speed);for(const _ of this._activeState.behaviours)(f=(u=_.instance)==null?void 0:u.onStateExit)==null||f.call(_.instance,this.animator,v,n)}const o=(m=this._activeState)==null?void 0:m.motion.action;r&&(e.motion.action=e.motion.action_loopback,e.motion.action_loopback=o);const a=this._activeState;this._activeState=e;const l=(g=e.motion)==null?void 0:g.action,c=e.motion.clip;if((c==null?void 0:c.duration)<=0&&c.tracks.length<=0?o&&this._heldActions.push(o):o&&(o.fadeOut(t),this.releaseHeldActions(t)),l){if(i=Math.max(0,Math.min(1,i)),e.cycleOffsetParameter){let x=this.getFloat(e.cycleOffsetParameter);typeof x=="number"?(x<0&&(x+=1),i+=x,i%=1):hr&&console.warn("AnimatorController cycle offset parameter is not a number",e.cycleOffsetParameter)}else typeof e.cycleOffset=="number"&&(i+=e.cycleOffset,i%=1);l.isRunning()&&l.stop(),l.reset(),l.enabled=!0,this.setTimescale(l,e);const b=e.motion.clip.duration;if(l.time=r?0:i*b,l.timeScale<0&&(l.time=b-l.time),l.clampWhenFinished=!0,l.setLoop(Pw,0),t>0?l.fadeIn(t):l.weight=1,l.play(),this.rootMotionHandler&&this.rootMotionHandler.onStart(l),this._activeStates.includes(e)||this._activeStates.push(e),this._activeState.behaviours){const x=new _C(e,i,b,this._speed);for(const v of this._activeState.behaviours)(y=(A=v.instance)==null?void 0:A.onStateEnter)==null||y.call(v.instance,this.animator,x,n)}}else hr&&(e.__warned_no_motion||(e.__warned_no_motion=!0,console.warn("No action",e.motion,this)));hr&&console.log("TRANSITION FROM "+(a==null?void 0:a.name)+" TO "+e.name,t,o,l,l==null?void 0:l.getEffectiveTimeScale(),l==null?void 0:l.getEffectiveWeight(),l==null?void 0:l.isRunning(),l==null?void 0:l.isScheduled(),l==null?void 0:l.paused)}createAction(e){var i,n;if(this._mixer.existingAction(e)&&this._mixer.uncacheAction(e,(i=this.animator)==null?void 0:i.gameObject),(n=this.animator)!=null&&n.applyRootMotion){this.rootMotionHandler||(this.rootMotionHandler=new Lke(this));const r=this.animator.gameObject;return this.rootMotionHandler.createClip(this._mixer,r,e)}else return this._mixer.clipAction(e)}evaluateCondition(e){const t=this.model.parameters.find(i=>i.name===e.parameter);if(!t)return!1;switch(e.mode){case Ef.If:return t.value===!0;case Ef.IfNot:return t.value===!1;case Ef.Greater:return t.value>e.threshold;case Ef.Less:return t.value<e.threshold;case Ef.Equals:return t.value===e.threshold;case Ef.NotEqual:return t.value!==e.threshold}return!1}createActions(e){var t,i,n,r;hr&&console.log("AnimatorController createActions",this.model);for(const o of this.model.layers){const a=o.stateMachine;for(let l=0;l<a.states.length;l++){const c=a.states[l];c.transitions||(c.transitions=[]);for(const h of c.transitions)h.conditions||(h.conditions=[]);if(c.motion||(hr&&console.warn("No motion",c),c.motion=Toe(c.name)),this.animator&&c.motion.clips){const h=(t=c.motion.clips)==null?void 0:t.find(d=>{var u,f;return d.node.name===((f=(u=this.animator)==null?void 0:u.gameObject)==null?void 0:f.name)});h?c.motion.clip=h.clip:(hr||Qe())&&console.warn('Could not find clip for animator "'+((n=(i=this.animator)==null?void 0:i.gameObject)==null?void 0:n.name)+'"',c.motion.clips.map(d=>d.node.name))}if(!c.motion.clip){hr&&console.warn("No clip assigned to state",c);const h=new Ba(void 0,void 0,[]);c.motion.clip=h}if((r=c.motion)!=null&&r.clip){const h=c.motion.clip;if(h instanceof Ba){const d=this.createAction(h);c.motion.action=d}else(hr||Qe())&&console.warn("No valid animationclip assigned",c)}if(c.behaviours&&Array.isArray(c.behaviours))for(const h of c.behaviours){if(!(h!=null&&h.typeName))continue;const d=Y.get(h.typeName);if(d){const u=new d;u.isStateMachineBehaviour&&(u._context=this.context??void 0,Lx(u,h.properties),h.instance=u),hr&&console.log("Created animator controller behaviour",c.name,h.typeName,h.properties,u)}else(hr||Qe())&&console.warn("Could not find AnimatorBehaviour type: "+h.typeName)}}}}*enumerateActions(){if(this.model.layers)for(const e of this.model.layers){const t=e.stateMachine;for(let i=0;i<t.states.length;i++){const n=t.states[i];n!=null&&n.motion&&(n.motion.action&&(yield n.motion.action),n.motion.action_loopback&&(yield n.motion.action_loopback))}}}}class oY{constructor(e,t){p(this,"track");p(this,"createdInterpolant");p(this,"originalEvaluate");p(this,"customEvaluate");this.track=e;const i=e,n=i.createInterpolant.bind(e);i.createInterpolant=()=>(i.createInterpolant=n,this.createdInterpolant=n(),this.originalEvaluate=this.createdInterpolant.evaluate.bind(this.createdInterpolant),this.customEvaluate=r=>{if(!this.originalEvaluate)return;const o=this.originalEvaluate(r);return t(r,o)},this.createdInterpolant.evaluate=this.customEvaluate,this.createdInterpolant)}dispose(){this.createdInterpolant&&this.originalEvaluate&&(this.createdInterpolant.evaluate=this.originalEvaluate),this.track=void 0,this.createdInterpolant=null,this.originalEvaluate=void 0,this.customEvaluate=void 0}}const mr=class{constructor(e,t,i,n,r){p(this,"_action");p(this,"root");p(this,"clip");p(this,"positionWrapper",null);p(this,"rotationWrapper",null);p(this,"context");p(this,"positionChange",new T);p(this,"rotationChange",new Ve);p(this,"_prevTime",0);if(this.context=e,this.root=t,this.clip=i,mr.firstKeyframeRotation[this.cacheId]||(mr.firstKeyframeRotation[this.cacheId]=new Ve),r){const o=r.values;mr.firstKeyframeRotation[this.cacheId].set(o[0],o[1],o[2],o[3])}mr.spaceRotation[this.cacheId]||(mr.spaceRotation[this.cacheId]=new Ve),mr.effectiveSpaceRotation[this.cacheId]||(mr.effectiveSpaceRotation[this.cacheId]=new Ve),mr.clipOffsetRotation[this.cacheId]=new Ve,r&&mr.clipOffsetRotation[this.cacheId].set(r.values[0],r.values[1],r.values[2],r.values[3]).invert(),this.handlePosition(i,n),this.handleRotation(i,r)}set action(e){this._action=e}get action(){return this._action}get cacheId(){return this.root.uuid}onStart(e){if(e.getClip()!==this.clip)return;mr.lastObjRotation[this.cacheId]||(mr.lastObjRotation[this.cacheId]=this.root.quaternion.clone());const t=mr.lastObjRotation[this.cacheId];if(mr.spaceRotation[this.cacheId].copy(t),aE){const i=new Xi().setFromQuaternion(t);console.log("START",this.clip.name,lt.toDegrees(i.y),this.root.position.z)}}getClipRotationOffset(){return mr.clipOffsetRotation[this.cacheId]}handlePosition(e,t){if(t){const i=this.root;aE&&i.add(new al),mr.lastObjPosition[this.cacheId]||(mr.lastObjPosition[this.cacheId]=this.root.position.clone());const n=new T,r=new T;this.positionWrapper=new oY(t,(o,a)=>{const l=this.action.getEffectiveWeight();return aE&&i.position.length()>8&&i.position.set(0,i.position.y,0),o>this._prevTime&&(n.set(a[0],a[1],a[2]),n.sub(r),n.multiplyScalar(l),n.applyQuaternion(this.getClipRotationOffset()),n.applyQuaternion(i.quaternion),this.positionChange.copy(n)),r.fromArray(a),this._prevTime=o,a[0]=0,a[1]=0,a[2]=0,a})}}handleRotation(e,t){if(t){if(aE){const o=t.values,a=new Xi().setFromQuaternion(new Ve(o[0],o[1],o[2],o[3]));console.log(e.name,t.name,"FIRST ROTATION IN TRACK",lt.toDegrees(a.y));const l=t.values.length-4,c=new Ve().set(o[l],o[l+1],o[l+2],o[l+3]),h=new Xi().setFromQuaternion(c);console.log(e.name,t.name,"LAST ROTATION IN TRACK",lt.toDegrees(h.y))}let i=0;const n=new Ve,r=new Ve;this.rotationWrapper=new oY(t,(o,a)=>(o>i&&(r.set(a[0],a[1],a[2],a[3]),n.invert(),r.multiply(n),this.rotationChange.copy(r)),n.fromArray(a),i=o,a[0]=0,a[1]=0,a[2]=0,a[3]=1,a))}}onBeforeUpdate(e){this.positionChange.set(0,0,0),this.rotationChange.set(0,0,0,1)}onAfterUpdate(e){return!this.action||(e*=this.action.getEffectiveWeight(),e<=0)?!1:(this.positionChange.multiplyScalar(e),this.rotationChange.slerp(mr.identityQuaternion,1-e),!0)}};let od=mr;p(od,"lastObjPosition",{}),p(od,"lastObjRotation",{}),p(od,"firstKeyframeRotation",{}),p(od,"spaceRotation",{}),p(od,"effectiveSpaceRotation",{}),p(od,"clipOffsetRotation",{}),p(od,"identityQuaternion",new Ve);class Lke{constructor(e){p(this,"controller");p(this,"handler",[]);p(this,"root");p(this,"basePosition",new T);p(this,"baseQuaternion",new Ve);p(this,"baseRotation",new Xi);p(this,"summedPosition",new T);p(this,"summedRotation",new Ve);this.controller=e}createClip(e,t,i){this.root=t,t&&"name"in t&&t.name;const n=this.findRootTrack(i,".position"),r=this.findRootTrack(i,".quaternion"),o=new od(this.controller.context,t,i,n,r);this.handler.push(o);const a=e.clipAction(i);return o.action=a,a}onStart(e){for(const t of this.handler)t.onStart(e)}onBeforeUpdate(e){this.basePosition.copy(this.root.position),this.baseQuaternion.copy(this.root.quaternion);for(const t of this.handler)t.onBeforeUpdate(e)}onAfterUpdate(e){if(!(e<=0)){this.root.position.copy(this.basePosition),this.root.quaternion.copy(this.baseQuaternion),this.summedPosition.set(0,0,0),this.summedRotation.set(0,0,0,1);for(const t of this.handler)t.onAfterUpdate(e)&&(this.summedPosition.add(t.positionChange),this.summedRotation.multiply(t.rotationChange));this.root.position.add(this.summedPosition),this.root.quaternion.multiply(this.summedRotation)}}findRootTrack(e,t){const i=e.tracks;if(!i)return null;for(const n of i)if(n.name.endsWith(t))return n;return null}}class Bke extends Qc{onSerialize(e,t){}onDeserialize(e,t){if(t.type===Jl&&(e==null?void 0:e.__type)==="AnimatorController")return new Jl(e)}}new Bke(Jl);var Pke=Object.defineProperty,Gke=Object.getOwnPropertyDescriptor,SP=(s,e,t,i)=>{for(var n=i>1?void 0:i?Gke(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Pke(e,t,n),n};const fc=ee("debuganimator");class Ro extends ze{constructor(){super(...arguments);p(this,"applyRootMotion",!1);p(this,"hasRootMotion",!1);p(this,"keepAnimatorControllerStateOnDisable",!1);p(this,"_parametersAreDirty",!1);p(this,"_isDirty",!1);p(this,"_speed",1);p(this,"_normalizedStartOffset",0);p(this,"_animatorController",null);p(this,"_initializeWithRuntimeAnimatorController")}get isAnimationComponent(){return!0}set runtimeAnimatorController(t){var i;this._animatorController&&this._animatorController.model===t||(t?t instanceof Jl?(t.animator&&t.animator!==this&&(console.warn("AnimatorController can not be bound to multiple animators",(i=t.model)==null?void 0:i.name),t.model||console.error("AnimatorController has no model"),t=new Jl(t.model)),this._animatorController=t,this._animatorController.bind(this)):(fc&&console.log("Assign animator controller",t,this),this._animatorController=new Jl(t),this.__didAwake&&this._animatorController.bind(this)):this._animatorController=null)}get runtimeAnimatorController(){return this._animatorController}getCurrentStateInfo(){var t;return(t=this.runtimeAnimatorController)==null?void 0:t.getCurrentStateInfo()}get currentAction(){var t;return((t=this.runtimeAnimatorController)==null?void 0:t.currentAction)||null}get parametersAreDirty(){return this._parametersAreDirty}get isDirty(){return this._isDirty}Play(t,i=-1,n=Number.NEGATIVE_INFINITY,r=0){this.play(t,i,n,r)}play(t,i=-1,n=Number.NEGATIVE_INFINITY,r=0){var o;(o=this.runtimeAnimatorController)==null||o.play(t,i,n,r),this._isDirty=!0}Reset(){this.reset()}reset(){var t;(t=this._animatorController)==null||t.reset(),this._isDirty=!0}SetBool(t,i){this.setBool(t,i)}setBool(t,i){var n,r;fc&&console.log("setBool",t,i),((n=this.runtimeAnimatorController)==null?void 0:n.getBool(t))!==i&&(this._parametersAreDirty=!0),(r=this.runtimeAnimatorController)==null||r.setBool(t,i)}GetBool(t){return this.getBool(t)}getBool(t){var n;const i=((n=this.runtimeAnimatorController)==null?void 0:n.getBool(t))??!1;return fc&&console.log("getBool",t,i),i}toggleBool(t){this.setBool(t,!this.getBool(t))}SetFloat(t,i){this.setFloat(t,i)}setFloat(t,i){var n,r;((n=this.runtimeAnimatorController)==null?void 0:n.getFloat(t))!==i&&(this._parametersAreDirty=!0),fc&&console.log("setFloat",t,i),(r=this.runtimeAnimatorController)==null||r.setFloat(t,i)}GetFloat(t){return this.getFloat(t)}getFloat(t){var n;const i=((n=this.runtimeAnimatorController)==null?void 0:n.getFloat(t))??-1;return fc&&console.log("getFloat",t,i),i}SetInteger(t,i){this.setInteger(t,i)}setInteger(t,i){var n,r;((n=this.runtimeAnimatorController)==null?void 0:n.getInteger(t))!==i&&(this._parametersAreDirty=!0),fc&&console.log("setInteger",t,i),(r=this.runtimeAnimatorController)==null||r.setInteger(t,i)}GetInteger(t){return this.getInteger(t)}getInteger(t){var n;const i=((n=this.runtimeAnimatorController)==null?void 0:n.getInteger(t))??-1;return fc&&console.log("getInteger",t,i),i}SetTrigger(t){this.setTrigger(t)}setTrigger(t){var i;this._parametersAreDirty=!0,fc&&console.log("setTrigger",t),(i=this.runtimeAnimatorController)==null||i.setTrigger(t)}ResetTrigger(t){this.resetTrigger(t)}resetTrigger(t){var i;this._parametersAreDirty=!0,fc&&console.log("resetTrigger",t),(i=this.runtimeAnimatorController)==null||i.resetTrigger(t)}GetTrigger(t){this.getTrigger(t)}getTrigger(t){var n;const i=(n=this.runtimeAnimatorController)==null?void 0:n.getTrigger(t);return fc&&console.log("getTrigger",t,i),i}IsInTransition(){return this.isInTransition()}isInTransition(){var t;return((t=this.runtimeAnimatorController)==null?void 0:t.isInTransition())??!1}SetSpeed(t){return this.setSpeed(t)}setSpeed(t){var i;t!==this._speed&&(fc&&console.log("setSpeed",t),this._speed=t,((i=this._animatorController)==null?void 0:i.animator)==this&&this._animatorController.setSpeed(t))}set minMaxSpeed(t){var i;this._speed=lt.lerp(t.x,t.y,Math.random()),((i=this._animatorController)==null?void 0:i.animator)==this&&this._animatorController.setSpeed(this._speed)}set minMaxOffsetNormalized(t){var i;this._normalizedStartOffset=lt.lerp(t.x,t.y,Math.random()),((i=this.runtimeAnimatorController)==null?void 0:i.animator)==this&&(this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset)}awake(){fc&&console.log("ANIMATOR",this.name,this),this.gameObject&&this.initializeRuntimeAnimatorController()}initializeRuntimeAnimatorController(t=!1){const i=t||this.runtimeAnimatorController!==this._initializeWithRuntimeAnimatorController;if(this.runtimeAnimatorController&&i){const n=this.runtimeAnimatorController.clone();this._initializeWithRuntimeAnimatorController=n,n?(console.assert(this.runtimeAnimatorController!==n),this.runtimeAnimatorController=n,console.assert(this.runtimeAnimatorController===n),this.runtimeAnimatorController.bind(this),this.runtimeAnimatorController.setSpeed(this._speed),this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset):console.warn("Could not clone animator controller",this.runtimeAnimatorController)}}onDisable(){var t;this.keepAnimatorControllerStateOnDisable||(t=this._animatorController)==null||t.reset()}onBeforeRender(){this._isDirty=!1,this._parametersAreDirty=!1,!Eke(this.gameObject)&&this._animatorController&&this._animatorController.update(1)}}SP([I()],Ro.prototype,"applyRootMotion",2);SP([I()],Ro.prototype,"hasRootMotion",2);SP([I()],Ro.prototype,"keepAnimatorControllerStateOnDisable",2);SP([I()],Ro.prototype,"runtimeAnimatorController",1);const Ad=ee("debugusdzanimation"),Lz=ee("debugusdzanimationserialization");class pp{constructor(e,t,i){p(this,"_start");p(this,"ext");p(this,"root");p(this,"_nearestAnimatedRoot");p(this,"clip");p(this,"speed");this.ext=e,this.root=t,this.clip=i,this._nearestAnimatedRoot=this.getNearestAnimatedRoot()}get start(){return this._start===void 0&&(this._start=this.ext.getStartTimeByClip(this.clip)),this._start}get duration(){var e;return((e=this.clip)==null?void 0:e.duration)??On.restPoseClipDuration}get nearestAnimatedRoot(){return this._nearestAnimatedRoot}get clipName(){var e;return((e=this.clip)==null?void 0:e.name)??"rest"}static isDescendantOf(e,t){let i=t;if(!i||!e)return!1;for(;i;){if(!i)return!1;if(i===e)return!0;i=i.parent}return!1}getNearestAnimatedRoot(){var t;let e;try{for(const i of((t=this.clip)==null?void 0:t.tracks)??[]){const n=di.parseTrackName(i.name);let r=di.findNode(this.root,n.nodeName);if(r)if(!e)e=r;else{if(r===e||pp.isDescendantOf(e,r))continue;if(!pp.isDescendantOf(r,e)){for(;!pp.isDescendantOf(r,e)&&r.parent;)r=r.parent;pp.isDescendantOf(r,e)||console.error("USDZExporter: Animation clip targets multiple roots that are not parent/child. Please report a bug",this.root,this.clip,e,r)}e=r}}}catch(i){console.error("USDZExporter: Exception when trying to find nearest animated root. Please report a bug",i),e=void 0}return e}}const _w=class{constructor(e,t,i){p(this,"clip");p(this,"pos");p(this,"rot");p(this,"scale");p(this,"root");p(this,"target");p(this,"duration",0);p(this,"useRootMotion",!1);if(this.root=e,this.target=t,this.clip=i,i?this.duration=i.duration:this.duration=_w.restPoseClipDuration,i&&i.tracks){const r=Math.max(...i.tracks.map(o=>o.times[o.times.length-1]));r!==this.duration&&(console.warn("USDZExporter: Animation clip duration does not match the maximum time value in the tracks.",i,r,this.duration),this.duration=r)}const n=$.getComponent(e,Ro);n&&(this.useRootMotion=n.applyRootMotion)}addTrack(e){var t,i;if(!this.clip){console.error("This is a rest clip but you're trying to add tracks to it – this is likely a bug");return}e.name.endsWith("position")?this.pos=e:e.name.endsWith("quaternion")?this.rot=e:e.name.endsWith("scale")?this.scale=e:(e.name.endsWith("activeSelf")?console.warn("[USDZ] Animation of enabled/disabled state is not supported for USDZ export and will NOT be exported: "+e.name+" on "+(((t=this.root)==null?void 0:t.name)??this.target.name)+". Animate scale 0/1 instead."):console.warn("[USDZ] Animation track type not supported for USDZ export and will NOT be exported: "+e.name+" on "+(((i=this.root)==null?void 0:i.name)??this.target.name)+". Only .position, .rotation, .scale are supported."),Qe()&&An("[USDZ] Some animations can't be exported. See console for details."))}getFrames(){var e,t,i,n,r,o;return this.clip?Math.max(((t=(e=this.pos)==null?void 0:e.times)==null?void 0:t.length)??0,((n=(i=this.rot)==null?void 0:i.times)==null?void 0:n.length)??0,((o=(r=this.scale)==null?void 0:r.times)==null?void 0:o.length)??0):2}getDuration(){return this.duration}getSortedTimesArray(e=!0,t=!0,i=!0){var l,c,h;if(!this.clip)return[0,this.duration];const n=(l=this.pos)==null?void 0:l.times,r=(c=this.rot)==null?void 0:c.times,o=(h=this.scale)==null?void 0:h.times,a=[];if(e&&n)for(const d of n)a.push(d);if(t&&r)for(const d of r)a.push(d);if(i&&o)for(const d of o)a.push(d);return a.includes(0)||a.push(0),a.sort((d,u)=>d-u),[...new Set(a)]}*getValues(e,t=!0,i=!0,n=!0){var f,m,g;const r=new T,o=new Ve,a=new T(1,1,1),l=this.target,c=t?(f=this.pos)==null?void 0:f.createInterpolant():void 0,h=i?(m=this.rot)==null?void 0:m.createInterpolant():void 0,d=n?(g=this.scale)==null?void 0:g.createInterpolant():void 0;c||r.set(l.position.x,l.position.y,l.position.z),h||o.set(l.quaternion.x,l.quaternion.y,l.quaternion.z,l.quaternion.w),d||a.set(l.scale.x,l.scale.y,l.scale.z),c&&c.valueSize!==3&&(c.valueSize=3),h&&h.valueSize!==4&&(h.valueSize=4),d&&d.valueSize!==3&&(d.valueSize=3);const u=0;for(let A=0-u;A<e.length+u;A++){let y=0,b=0;if(A<0?(y=e[0],b=y-_w.animationDurationPadding/2+1/60):A>=e.length?(y=e[e.length-1],b=y+_w.animationDurationPadding/2-1/60):(y=e[A],b=y),c){const x=c.evaluate(y);r.set(x[0],x[1],x[2])}if(h){const x=h.evaluate(y);o.set(x[0],x[1],x[2],x[3])}if(d){const x=d.evaluate(y);a.set(x[0],x[1],x[2])}if(this.useRootMotion&&l===this.root){const x=new ce;x.compose(r,o,a),x.multiply(l.matrix),x.decompose(r,o,a)}yield{time:b,translation:r,rotation:o,scale:a,index:A}}}};let On=_w;p(On,"frameRate",60),p(On,"animationDurationPadding",6/60),p(On,"restPoseClipDuration",6/60);class gM{constructor(e){p(this,"dict",new Map);p(this,"rootTargetMap",new Map);p(this,"rootAndClipToRegisteredAnimationMap",new Map);p(this,"rootToRegisteredClip",new Map);p(this,"lastClipEndTime",0);p(this,"clipToStartTime",new Map);p(this,"clipToHoldClip",new Map);p(this,"serializers",[]);p(this,"injectRestPoses",!1);p(this,"injectImplicitBehaviours",!1);this.injectRestPoses=e,this.injectImplicitBehaviours=e}get extensionName(){return"animation"}get animationData(){return this.dict}get registeredClips(){return this.clipToStartTime.keys()}get animatedRoots(){return this.rootTargetMap.keys()}get holdClipMap(){return this.clipToHoldClip}getStartTimeCode(){return!this.injectRestPoses||this.rootAndClipToRegisteredAnimationMap.size===0?0:(On.restPoseClipDuration+On.animationDurationPadding)*60}getEndTimeCode(){let e=0;for(const[t,i]of this.rootAndClipToRegisteredAnimationMap){const n=i.start+i.duration;n>e&&(e=n)}return e*60}getClipCount(e){var i;return((i=this.rootToRegisteredClip.get(e))==null?void 0:i.length)??0??0}getStartTimeByClip(e){return e?this.clipToStartTime.has(e)?this.clipToStartTime.get(e):(console.error("USDZExporter: Missing start time for clip – please report a bug.",e),0):0}registerAnimation(e,t){var c;if(!e)return null;this.rootTargetMap.has(e)||this.rootTargetMap.set(e,[]);const i=e.uuid+((t==null?void 0:t.uuid)??"-rest");if(this.rootAndClipToRegisteredAnimationMap.has(i))return this.rootAndClipToRegisteredAnimationMap.get(i);Ad&&console.log("registerAnimation",e,t);const n=this.injectRestPoses?1:0,r=(((c=this.rootToRegisteredClip.get(e))==null?void 0:c.length)??0)+n,o=this.rootTargetMap.get(e),a=new Set(o);if(t&&t.tracks)for(const h of t.tracks){const d=di.parseTrackName(h.name),u=di.findNode(e,d.nodeName);if(!u){console.warn("no object found for track",h.name,"using "+e.name+" instead");continue}this.dict.has(u)||this.dict.set(u,[]);const f=this.dict.get(u);if(!f){console.warn("no transform data found for target ",u,"at slot "+r+", this is likely a bug");continue}a.delete(u),this.injectRestPoses&&!f[0]&&(console.log("Injecting rest pose",u,t,"at slot",r),f[0]=new On(null,u,null));let m=f[r];m||(m=new On(e,u,t),f[r]=m),m.addTrack(h),o!=null&&o.includes(u)||o==null||o.push(u)}Ad&&console.log("Unregistered nodes for this clip",a,"clip",t,"at slot",r,"for root",e,"targets",o);for(const h of a){const d=this.dict.get(h);if(!d)continue;if(this.injectRestPoses&&!d[0]){console.warn("Adding rest pose for ",h,t,"at slot",r,"This is likely a bug, should have been added earlier.");const f=new On(null,h,null);d[0]=f}let u=d[r];u||(Ad&&console.log("Adding padding clip for ",h,t,"at slot",r),u=new On(e,h,t),d[r]=u)}const l=new pp(this,e,t);if(this.rootAndClipToRegisteredAnimationMap.set(i,l),Ad&&console.log({root:e,clip:t,info:l}),t){const h=this.rootToRegisteredClip.get(e);if(h?h.push(t):this.rootToRegisteredClip.set(e,[t]),!this.clipToStartTime.get(t)){this.lastClipEndTime==null&&(this.lastClipEndTime=On.restPoseClipDuration);let u=this.lastClipEndTime+On.animationDurationPadding,f=u+t.duration;const m=Math.round(u*60)/60,g=Math.round(f*60)/60;Math.abs(m-u)<.01&&(u=m),Math.abs(g-f)<.01&&(f=g),u=Math.ceil(u),f=u+t.duration,this.clipToStartTime.set(t,u),this.lastClipEndTime=f}}return l}onAfterHierarchy(e){Ad&&console.log("Animation clips per animation target node",this.dict)}onAfterBuildDocument(e){var t,i;Ad&&console.log("Animation data",{dict:this.dict,rootTargetMap:this.rootTargetMap,rootToRegisteredClip:this.rootToRegisteredClip});for(const n of this.rootTargetMap.keys()){const r=this.rootTargetMap.get(n);if(!r)continue;let o;const a=[];for(const l of r){const c=this.dict.get(l);if(!c){console.error("No data found for target on USDZ export – please report a bug!",l);continue}o===void 0&&(o=c==null?void 0:c.length),o!==(c==null?void 0:c.length)&&console.error("Different array lengths for targets – please report a bug!",c);for(let h=0;h<c.length;h++){let d=c[h];if(!d){const f=h-(this.injectRestPoses?1:0);c[h]=new On(null,l,this.rootToRegisteredClip.get(n)[f]),d=c[h]}const u=d.getDuration();if(a[h]===void 0)a[h]=u;else if(a[h]!==u){console.error("Error during UDSZ export: Encountered different animation durations for animated targets. Please report a bug!",{datas:c,target:l}),a[h]=u;continue}}}}for(const n of this.serializers){const r=(t=n.model)==null?void 0:t.parent,o=(r==null?void 0:r.isDynamic)===!0;Lz&&console.log(o,(i=n.model)==null?void 0:i.parent),o&&n.registerCallback(r)}}onExportObject(e,t,i){$.foreachComponent(e,r=>{const o=r;typeof o.createAnimation=="function"&&o.createAnimation(this,t,i)},!1);const n=new kke(e,this);this.serializers.push(n),n.registerCallback(t)}}class kke{constructor(e,t){p(this,"model");p(this,"object");p(this,"animationData");p(this,"ext");p(this,"callback");this.object=e,this.animationData=t.animationData,this.ext=t}registerCallback(e){this.model&&this.callback&&this.model.removeEventListener("serialize",this.callback),this.callback||(this.callback=this.onSerialize.bind(this)),Lz&&console.log("REPARENT",e),this.model=e,this.callback&&this.model.addEventListener("serialize",this.callback)}skinnedMeshExport(e,t,i){var o;const n=this.model,r=this.animationData;if(n&&n.skinnedMesh){let a=function(B){const P=[];for(const[k,X]of B){let F=`${k} : [`;const H=[];for(const W of X)H.push(`(${_i(W.x)}, ${_i(W.y)}, ${_i(W.z)})`);F=F.concat(H.join(", ")),F=F.concat("],"),P.push(F)}return P},l=function(B){const P=[];for(const[k,X]of B){let F=`${k} : [`;const H=[];for(const W of X)H.push(`(${_i(W.w)}, ${_i(W.x)}, ${_i(W.y)}, ${_i(W.z)})`);F=F.concat(H.join(", ")),F=F.concat("],"),P.push(F)}return P},c=function(B){let P,k=!0;const X=new Map;for(const[H,W]of B){P===void 0&&(P=W.length),P!==W.length&&(k=!1);let se=0;for(const de of W)se++,de||(X.has(H)||X.set(H,[]),X.get(H).push(se))}Ad&&console.log("Bone count: ",B.size,"TransformData entries per bone: ",P,"Undefined bone entries: ",X),console.assert(k,"All bones should have the same number of TransformData entries",B),console.assert(X.size===0,"All TransformData entries should be set",X);const F=[];for(const[H,W]of B)for(let se=0;se<W.length;se++){const de=W[se],be=i.getStartTimeByClip(de.clip);F.length<=se&&F.push({pos:[],rot:[],scale:[],timeOffset:be});const Pe=F[se];Pe.pos.push(...de.getSortedTimesArray(!0,!1,!1)),Pe.rot.push(...de.getSortedTimesArray(!1,!0,!1)),Pe.scale.push(...de.getSortedTimesArray(!1,!1,!0))}for(const H of F)H.pos.sort((W,se)=>W-se),H.rot.sort((W,se)=>W-se),H.scale.sort((W,se)=>W-se),H.pos=[...new Set(H.pos)],H.rot=[...new Set(H.rot)],H.scale=[...new Set(H.scale)];return F},h=function(B,P,k){const X=new Map,F=new Map,H=new Map,W=P.length;for(const se of k){const de=B.get(se);let be;de?console.assert(de.length===W,"We should have the same number of TransformData entries for each bone",de,P):be=new On(null,se,null);for(let Pe=0;Pe<W;Pe++){const Oe=de?de[Pe]:be,ae=P[Pe];for(const{time:Ae,translation:Se}of Oe.getValues(ae.pos,!0,!1,!1)){const st=(Ae+ae.timeOffset)*60;X.has(st)||X.set(st,new Array),X.get(st).push(Se.clone())}for(const{time:Ae,rotation:Se}of Oe.getValues(ae.rot,!1,!0,!1)){const st=(Ae+ae.timeOffset)*60;F.has(st)||F.set(st,new Array),F.get(st).push(Se.clone())}for(const{time:Ae,scale:Se}of Oe.getValues(ae.scale,!1,!1,!0)){const st=(Ae+ae.timeOffset)*60;H.has(st)||H.set(st,new Array),H.get(st).push(Se.clone())}}}return{position:X.size==0?void 0:X,quaternion:F.size==0?void 0:F,scale:H.size==0?void 0:H}},d=function(B){const P=[];for(const k of B)P.push(`(${_i(k.x)}, ${_i(k.y)}, ${_i(k.z)})`);return P.join(", ")},u=function(B){const P=[];for(const k of B)P.push(`(${_i(k.w)}, ${_i(k.x)}, ${_i(k.y)}, ${_i(k.z)})`);return P.join(", ")},f=function(B){const P=new Map;if(Ad){const k=new Array;for(const[X,F]of r)k.push(X.uuid+": "+F.length+" "+F.map(H=>{var W;return(W=H.clip)==null?void 0:W.uuid.substring(0,6)}).join(" "));console.log(`getPerBoneTransformData
`+k.join(`
`))}for(const k of B){const X=r.get(k);X&&P.set(k,X)}return P},m=function(B){const P=f(B),k=c(P);return h(P,k,B)};const g=n.skinnedMesh.skeleton,A=new Array,y=[],b=[];for(const B of g.bones)if(B.parent.type!=="Bone"){y.push(B);const P=g.boneInverses[g.bones.indexOf(B)];A.push({bone:B,inverse:P}),b.push(B.uuid)}for(;b.length<g.bones.length;)for(const B of y){const P=B.children;for(const k of P)if(b.indexOf(k.uuid)===-1&&g.bones.indexOf(k)!==-1){y.push(k);const X=g.boneInverses[g.bones.indexOf(k)];A.push({bone:k,inverse:X}),b.push(k.uuid)}}for(const B of goe(g.bones))A.push({bone:B,inverse:B.matrixWorld.clone().invert()});const x=A[0].bone.parent;x||console.error("No bone parent found for skinned mesh during USDZ export",n.skinnedMesh),A.sort((B,P)=>rx(B.bone,x)>rx(P.bone,x)?1:-1);const v=t.quickLookCompatible,_=[],C=[],S=[],M=[];for(const{bone:B}of A){if(v){const P=B.scale;P.x==0&&(P.x=1e-5),P.y==0&&(P.y=1e-5),P.z==0&&(P.z=1e-5),_.push(new ce().compose(B.position,B.quaternion,B.scale))}else _.push(B.matrix.clone());C.push(B.position),S.push(B.quaternion),M.push(B.scale)}const L=A.map(B=>'"'+rx(B.bone,x)+'"').join(", "),w=A.map(B=>$K(B.inverse.clone().invert())).join(", ");e.beginBlock('def Skeleton "Rig"'),e.appendLine(`uniform matrix4d[] bindTransforms = [${w}]`),e.appendLine(`uniform token[] joints = [${L}]`),e.appendLine('uniform token purpose = "guide"'),e.appendLine(`uniform matrix4d[] restTransforms = [${_.map(B=>$K(B)).join(", ")}]`);const E=m(A.map(B=>B.bone));if(Ad){let B=1e7,P=0;for(const k of((o=E.position)==null?void 0:o.keys())??[])B=Math.min(B,k),P=Math.max(P,k);console.log("Time samples",B,P,E)}if(e.beginBlock('def SkelAnimation "_anim"'),e.appendLine(`uniform token[] joints = [${L}]`),e.appendLine(`quatf[] rotations = [${u(S)}]`),E&&E.quaternion){e.beginBlock("quatf[] rotations.timeSamples = {","");const B=l(E.quaternion);for(const P of B)e.appendLine(P);e.closeBlock()}if(e.appendLine(`half3[] scales = [${d(M)}]`),E&&E.scale){e.beginBlock("half3[] scales.timeSamples = {","");const B=a(E.scale);for(const P of B)e.appendLine(P);e.closeBlock()}if(e.appendLine(`float3[] translations = [${d(C)}]`),E&&E.position){e.beginBlock("float3[] translations.timeSamples = {","");const B=a(E.position);for(const P of B)e.appendLine(P);e.closeBlock()}e.closeBlock(),e.closeBlock()}}onSerialize(e,t){if(!this.model)return;const i=this.animationData.get(this.object);if(i)for(let h=0;h<i.length;h++)i[h]===void 0&&(i[h]=new On(null,this.object,null));const n=this.ext;this.skinnedMeshExport(e,t,n);const r=this.object,o=this.model,a=this.animationData.get(r);if(!a||r.isSkinnedMesh)return;Lz&&console.log("SERIALIZE",this.model.name,this.object.type,a);const l=Intl.NumberFormat("en-US",{maximumFractionDigits:3,minimumFractionDigits:0,useGrouping:!1});function c(h,d){var f;if(h.some(m=>m&&{position:m.pos,rotation:m.rot,scale:m.scale}[d])){switch(d){case"position":o.needsTranslate=!0,e.beginBlock("double3 xformOp:translate.timeSamples = {","");break;case"rotation":o.needsOrient=!0,e.beginBlock("quatf xformOp:orient.timeSamples = {","");break;case"scale":o.needsScale=!0,e.beginBlock("double3 xformOp:scale.timeSamples = {","");break}for(let m=0;m<h.length;m++){const g=h[m];if(!g)continue;const A=n.getStartTimeByClip(g.clip),y=g.getSortedTimesArray(d==="position",d==="rotation",d==="scale");if(!y||y.length===0){console.error("got an animated object but no time values?",r,g);continue}const b=!g.clip,x=d==="position"&&(g.pos||b),v=d==="rotation"&&(g.rot||b),_=d==="scale"&&(g.scale||b);if(x||v||_){const C=((f=g.clip)==null?void 0:f.name)??"rest",S=g.getDuration();Ad&&console.log("Write .timeSamples:",C,A,S,h),e.appendLine("# "+C+": start="+l.format(A*On.frameRate)+", length="+l.format(S*On.frameRate)+", frames="+g.getFrames())}if(x)for(const{time:C,translation:S}of g.getValues(y,!0,!1,!1)){const L=`${l.format((A+C)*On.frameRate)}: (${_i(S.x)}, ${_i(S.y)}, ${_i(S.z)}),`;e.appendLine(L)}if(v)for(const{time:C,rotation:S}of g.getValues(y,!1,!0,!1)){const L=`${l.format((A+C)*On.frameRate)}: (${_i(S.w)}, ${_i(S.x)}, ${_i(S.y)}, ${_i(S.z)}),`;e.appendLine(L)}if(_)for(const{time:C,scale:S}of g.getValues(y,!1,!1,!0)){const L=`${l.format((A+C)*On.frameRate)}: (${_i(S.x)}, ${_i(S.y)}, ${_i(S.z)}),`;e.appendLine(L)}}e.closeBlock()}}c(a,"position"),c(a,"rotation"),c(a,"scale")}}class Nke extends ts{constructor(e,t=1,i=16,n=2){const r=new It,o=i+n*2,a=new Float32Array((o*3+3)*3);r.setAttribute("position",new dt(a,3));const l=new _n({color:65280}),c=new _n({color:16776960});super(r,[c,l]),this.audio=e,this.range=t,this.divisionsInnerAngle=i,this.divisionsOuterAngle=n,this.type="PositionalAudioHelper",this.update()}update(){const e=this.audio,t=this.range,i=this.divisionsInnerAngle,n=this.divisionsOuterAngle,r=Bi.degToRad(e.panner.coneInnerAngle),o=Bi.degToRad(e.panner.coneOuterAngle),a=r/2,l=o/2;let c=0,h=0,d,u;const f=this.geometry,m=f.attributes.position;f.clearGroups();function g(A,y,b,x){const v=(y-A)/b;for(m.setXYZ(c,0,0,0),h++,d=A;d<y;d+=v)u=c+h,m.setXYZ(u,Math.sin(d)*t,0,Math.cos(d)*t),m.setXYZ(u+1,Math.sin(Math.min(d+v,y))*t,0,Math.cos(Math.min(d+v,y))*t),m.setXYZ(u+2,0,0,0),h+=3;f.addGroup(c,h,x),c+=h,h=0}g(-l,-a,n,0),g(-a,a,i,1),g(a,l,n,0),m.needsUpdate=!0,r===o&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}const aY=Symbol("previous-visibility"),Vb=class extends ci{render(e,t,i){if(i instanceof wO)this._unsupported_effectcomposer_warning||(console.warn("RenderTexture.render() does not yet support EffectComposer"),this._unsupported_effectcomposer_warning=!0);else{this.onBeforeRender();const n=i.getRenderTarget(),r=i.xr.enabled;i.xr.enabled=!1,i.setRenderTarget(this),i.clear(!0,!0,!0),i.render(e,t),i.setRenderTarget(n),i.xr.enabled=r,this.onAfterRender()}}onBeforeRender(){Vb._userSet.clear();const e=s5(this.texture,!0,null,Vb._userSet);for(const t of e)t instanceof fe&&(t[aY]=t.visible,t.visible=!1)}onAfterRender(){for(const e of Vb._userSet)e instanceof fe&&(e.visible=e[aY]);Vb._userSet.clear()}};let jf=Vb;p(jf,"_userSet",new Set);const lY={type:"change"},I5={type:"start"},Eoe={type:"end"},lE=new Fa,cY=new js,Dke=Math.cos(70*Bi.DEG2RAD),dr=new T;new T;const Oa=2*Math.PI,bn={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},hD=1e-6;let Roe=class extends MB{constructor(e,t=null){super(e,t),this.state=bn.NONE,this.enabled=!0,this.target=new T,this.cursor=new T,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:y0.ROTATE,MIDDLE:y0.DOLLY,RIGHT:y0.PAN},this.touches={ONE:s0.ROTATE,TWO:s0.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new T,this._lastQuaternion=new Ve,this._lastTargetPosition=new T,this._quat=new Ve().setFromUnitVectors(e.up,new T(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new jF,this._sphericalDelta=new jF,this._scale=1,this._currentScale=1,this._panOffset=new T,this._rotateStart=new Q,this._rotateEnd=new Q,this._rotateDelta=new Q,this._panStart=new Q,this._panEnd=new Q,this._panDelta=new Q,this._dollyStart=new Q,this._dollyEnd=new Q,this._dollyDelta=new Q,this._dollyDirection=new T,this._mouse=new Q,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Vke.bind(this),this._onPointerDown=Fke.bind(this),this._onPointerUp=zke.bind(this),this._onContextMenu=Qke.bind(this),this._onMouseWheel=Oke.bind(this),this._onKeyDown=Zke.bind(this),this._onTouchStart=Wke.bind(this),this._onTouchMove=Hke.bind(this),this._onMouseDown=Uke.bind(this),this._onMouseMove=Xke.bind(this),this._interceptControlDown=Kke.bind(this),this._interceptControlUp=Yke.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(lY),this.update(),this.state=bn.NONE}update(e=null){const t=this.object.getWorldPosition(this.object.position);dr.copy(t).sub(this.target),dr.applyQuaternion(this._quat),this._spherical.setFromVector3(dr),this.autoRotate&&this.state===bn.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,n=this.maxAzimuthAngle;isFinite(i)&&isFinite(n)&&(i<-Math.PI?i+=Oa:i>Math.PI&&(i-=Oa),n<-Math.PI?n+=Oa:n>Math.PI&&(n-=Oa),i<=n?this._spherical.theta=Math.max(i,Math.min(n,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+n)/2?Math.max(i,this._spherical.theta):Math.min(n,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let r=!1;if(this.enableDamping?this._currentScale=Bi.lerp(this._currentScale,this._scale,this.dampingFactor):this._currentScale=this._scale,this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._currentScale),r=o!=this._spherical.radius}if(dr.setFromSpherical(this._spherical),dr.applyQuaternion(this._quatInverse),t.copy(this.target).add(dr),this.object.parent?this.object.parent.worldToLocal(t):this.object.position.copy(t),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=dr.length();o=this._clampDistance(a*this._currentScale);const l=a-o;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),r=!!l}else if(this.object.isOrthographicCamera){const a=new T(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._currentScale)),this.object.updateProjectionMatrix(),r=l!==this.object.zoom;const c=new T(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(a),this.object.updateMatrixWorld(),o=dr.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(lE.origin.copy(this.object.position),lE.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(lE.direction))<Dke?this.object.lookAt(this.target):(cY.setFromNormalAndCoplanarPoint(this.object.up,this.target),lE.intersectPlane(cY,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),r=!0)}return this._scale=1,r||this._lastPosition.distanceToSquared(this.object.position)>hD||8*(1-this._lastQuaternion.dot(this.object.quaternion))>hD||this._lastTargetPosition.distanceToSquared(this.target)>hD?(this.dispatchEvent(lY),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):(this._performCursorZoom=!1,!1)}_getAutoRotationAngle(e){return e!==null?Oa/60*this.autoRotateSpeed*e:Oa/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){dr.setFromMatrixColumn(t,0),dr.multiplyScalar(-e),this._panOffset.add(dr)}_panUp(e,t){this.screenSpacePanning===!0?dr.setFromMatrixColumn(t,1):(dr.setFromMatrixColumn(t,0),dr.crossVectors(this.object.up,dr)),dr.multiplyScalar(e),this._panOffset.add(dr)}_pan(e,t){const i=this.domElement;if(this.object.isPerspectiveCamera){this.object.getWorldPosition(dr).sub(this.target);let n=dr.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*n/i.clientHeight,this.object.matrixWorld),this._panUp(2*t*n/i.clientHeight,this.object.matrixWorld)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),n=e-i.left,r=t-i.top,o=i.width,a=i.height;this._mouse.x=n/o*2-1,this._mouse.y=-(r/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Oa*this._rotateDelta.x/t.clientHeight),this._rotateUp(Oa*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(Oa*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateUp(-Oa*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(Oa*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this._rotateLeft(-Oa*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._rotateStart.set(i,n)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panStart.set(i,n)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,n=e.pageY-t.y,r=Math.sqrt(i*i+n*n);this._dollyStart.set(0,r)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),r=.5*(e.pageY+i.y);this._rotateEnd.set(n,r)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Oa*this._rotateDelta.x/t.clientHeight),this._rotateUp(Oa*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panEnd.set(i,n)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,n=e.pageY-t.y,r=Math.sqrt(i*i+n*n);this._dollyEnd.set(0,r),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Q,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}};function Fke(s){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),window.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(s)&&(this._addPointer(s),s.pointerType==="touch"?this._onTouchStart(s):this._onMouseDown(s)))}function Vke(s){this.enabled!==!1&&(s.pointerType==="touch"?this._onTouchMove(s):this._onMouseMove(s))}function zke(s){switch(this._removePointer(s),this._pointers.length){case 0:this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Eoe),this.state=bn.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function Uke(s){let e;switch(s.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case y0.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(s),this.state=bn.DOLLY;break;case y0.ROTATE:if(s.ctrlKey||s.metaKey||s.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(s),this.state=bn.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(s),this.state=bn.ROTATE}break;case y0.PAN:if(s.ctrlKey||s.metaKey||s.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(s),this.state=bn.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(s),this.state=bn.PAN}break;default:this.state=bn.NONE}this.state!==bn.NONE&&this.dispatchEvent(I5)}function Xke(s){switch(this.state){case bn.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(s);break;case bn.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(s);break;case bn.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(s);break}}function Oke(s){this.enabled===!1||this.enableZoom===!1||this.state!==bn.NONE||(s.preventDefault(),this.dispatchEvent(I5),this._handleMouseWheel(this._customWheelEvent(s)),this.dispatchEvent(Eoe))}function Zke(s){this.enabled===!1||this.enablePan===!1||this._handleKeyDown(s)}function Wke(s){switch(this._trackPointer(s),this._pointers.length){case 1:switch(this.touches.ONE){case s0.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(s),this.state=bn.TOUCH_ROTATE;break;case s0.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(s),this.state=bn.TOUCH_PAN;break;default:this.state=bn.NONE}break;case 2:switch(this.touches.TWO){case s0.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(s),this.state=bn.TOUCH_DOLLY_PAN;break;case s0.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(s),this.state=bn.TOUCH_DOLLY_ROTATE;break;default:this.state=bn.NONE}break;default:this.state=bn.NONE}this.state!==bn.NONE&&this.dispatchEvent(I5)}function Hke(s){switch(this._trackPointer(s),this.state){case bn.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(s),this.update();break;case bn.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(s),this.update();break;case bn.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(s),this.update();break;case bn.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(s),this.update();break;default:this.state=bn.NONE}}function Qke(s){this.enabled!==!1&&s.preventDefault()}function Kke(s){s.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Yke(s){s.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}var Jke=Object.defineProperty,jke=Object.getOwnPropertyDescriptor,AM=(s,e,t,i)=>{for(var n=i>1?void 0:i?jke(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Jke(e,t,n),n};const dD=ee("debuggroundprojection");class ou extends ze{constructor(){super(...arguments);p(this,"applyOnAwake",!1);p(this,"autoFit",!0);p(this,"_radius",50);p(this,"_height",3);p(this,"_arblending",0);p(this,"_lastEnvironment");p(this,"_lastRadius");p(this,"_lastHeight");p(this,"_projection");p(this,"_watcher");p(this,"_needsTextureUpdate",!1);p(this,"_blurrynessShader",null);p(this,"_lastBlurriness",-1)}set radius(t){this._radius=t,this.updateProjection()}get radius(){return this._radius}set height(t){this._height=t,this.updateProjection()}get height(){return this._height}set arBlending(t){this._arblending=t,this._needsTextureUpdate=!0}get arBlending(){return this._arblending}awake(){this.applyOnAwake&&this.updateAndCreate()}onEnable(){this.context.time.frameCount>0&&this.applyOnAwake&&this.updateAndCreate(),this._watcher||(this._watcher=new Ap(this.context.scene,"environment"),this._watcher.subscribeWrite(t=>{this.updateProjection()}))}onDisable(){var t,i;(t=this._watcher)==null||t.revoke(),(i=this._projection)==null||i.removeFromParent()}onEnterXR(){this.activeAndEnabled&&(this._needsTextureUpdate=!0,this.updateProjection())}async onLeaveXR(){this.activeAndEnabled&&(await QB(1),this.updateProjection())}onBeforeRender(){this._projection&&this.scene.backgroundRotation&&this._projection.rotation.copy(this.scene.backgroundRotation),this.context.scene.backgroundBlurriness!==void 0&&this._lastBlurriness!=this.context.scene.backgroundBlurriness&&this.context.scene.backgroundBlurriness>.001?this.updateProjection():this._needsTextureUpdate&&this.updateBlurriness()}updateAndCreate(){var t;this.updateProjection(),(t=this._watcher)==null||t.apply()}updateProjection(){var n,r,o,a,l;if(!this.context.scene.environment){(n=this._projection)==null||n.removeFromParent();return}if(((r=this.context.xr)!=null&&r.isPassThrough||(o=this.context.xr)!=null&&o.isAR)&&this.arBlending===0){(a=this._projection)==null||a.removeFromParent();return}if(!this.gameObject||this.destroyed)return;let t=!0;const i=0;if(!this._projection||this.context.scene.environment!==this._lastEnvironment||this._height!==this._lastHeight||this._radius!==this._lastRadius){if(dD&&console.log("Create/Update Ground Projection",this.context.scene.environment.name),(l=this._projection)==null||l.removeFromParent(),!this._projection||this.context.scene.environment!==this._lastEnvironment||this._lastHeight!==this._height||this._lastRadius!==this._radius)try{this._projection=new Cx(this.context.scene.environment,this._height,this.radius,64)}catch(c){console.error("Failed to enable GroundProjection for environment",c);return}else t=!1;this._projection.position.y=this._height-i,this._projection.name="GroundProjection",xO(this._projection,!1)}else t=!1;if(this._projection.parent||this.gameObject.add(this._projection),this.autoFit&&t){this._projection.updateWorldMatrix(!0,!0);const c=ec(this.context.scene.children,[this._projection]),h=c.min.y;if(h<1/0){const d=St();d.x=c.min.x+(c.max.x-c.min.x)*.5;const u=kn(this.gameObject).x;d.y=h+this._height*u-i,d.z=c.min.z+(c.max.z-c.min.z)*.5,_r(this._projection,d)}dD&&Mt.DrawWireBox3(c,65280,5)}this.context.scene.backgroundBlurriness>.001&&this._needsTextureUpdate&&this.updateBlurriness(),this._lastEnvironment=this.context.scene.environment,this._lastHeight=this._height,this._lastRadius=this._radius,this._needsTextureUpdate=!1}updateBlurriness(){var i;if(this._projection){if(!this.context.scene.environment)return}else return;this._needsTextureUpdate=!1,dD&&console.log("Update Blurriness",this.context.scene.backgroundBlurriness),this._blurrynessShader??(this._blurrynessShader=new Ht({name:"GroundProjectionBlurriness",uniforms:{map:{value:this.context.scene.environment},blurriness:{value:this.context.scene.backgroundBlurriness},blending:{value:0},alphaFactor:{value:1}},vertexShader:qke,fragmentShader:$ke})),this._blurrynessShader.depthWrite=!1,this._blurrynessShader.uniforms.blurriness.value=this.context.scene.backgroundBlurriness,this._lastBlurriness=this.context.scene.backgroundBlurriness,this.context.scene.environment.needsPMREMUpdate=!0;const t=this._projection.material.transparent;this._projection.material.transparent=(((i=this.context.xr)==null?void 0:i.isAR)===!0&&this.arBlending>1e-6)??!1,this._projection.material.transparent?this._blurrynessShader.uniforms.blending.value=this.arBlending:this._blurrynessShader.uniforms.blending.value=0,this.context.isInPassThrough?this._blurrynessShader.uniforms.alphaFactor.value=.95:this._blurrynessShader.uniforms.alphaFactor.value=1,t!==this._projection.material.transparent&&(this._projection.material.needsUpdate=!0),this._projection.material.map=Ec.copyTexture(this.context.scene.environment,this._blurrynessShader),this._projection.material.depthTest=!0,this._projection.material.depthWrite=!1}}AM([I()],ou.prototype,"applyOnAwake",2);AM([I()],ou.prototype,"autoFit",2);AM([I()],ou.prototype,"radius",1);AM([I()],ou.prototype,"height",1);AM([I()],ou.prototype,"arBlending",1);const qke=`
  varying vec2 vUv;

  void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,$ke=`
  uniform sampler2D map;
  uniform float blurriness;
  uniform float alphaFactor;
  uniform float blending;
  varying vec2 vUv;

  const float PI = 3.14159265359;

  // Gaussian function
  float gaussian(float x, float sigma) {
    return exp(-(x * x) / (2.0 * sigma * sigma)) / (sqrt(2.0 * PI) * sigma);
  }

  // Custom smoothstep function for desired falloff
  float customSmoothstep(float edge0, float edge1, float x) {
    float t = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return t * t * (3.0 - 2.0 * t);
  }

  void main() {
    vec2 center = vec2(0.0, 0.0);
    vec2 pos = vUv;
    pos.x = 0.0; // Only consider vertical distance
    float distance = length(pos - center);
    
    // Calculate blur amount based on custom falloff
    float blurAmount = customSmoothstep(0.5, 1.0, distance * 2.0);
    blurAmount = clamp(blurAmount, 0.0, 1.0); // Ensure blur amount is within valid range

    // Gaussian blur
    vec2 pixelSize = 1.0 / vec2(textureSize(map, 0));
    vec4 color = vec4(0.0);
    float totalWeight = 0.0;
    int blurSize = int(60.0 * min(1.0, blurriness) * blurAmount); // Adjust blur size based on distance and blurriness
    float lodLevel = log2(float(blurSize)) * 0.5; // Compute LOD level

    for (int x = -blurSize; x <= blurSize; x++) {
        for (int y = -blurSize; y <= blurSize; y++) {
            vec2 offset = vec2(float(x), float(y)) * pixelSize * blurAmount;
            float weight = gaussian(length(vec2(float(x), float(y))), 1000.0 * blurAmount); // Use a fixed sigma value
            color += textureLod(map, vUv + offset, lodLevel) * weight;
            totalWeight += weight;
        }
    }

    color = totalWeight > 0.0 ? color / totalWeight : texture2D(map, vUv);

    gl_FragColor = color;

    float brightness = dot(gl_FragColor.rgb, vec3(0.299, 0.587, 0.114));
    float stepFactor = blending - brightness * .1;
    gl_FragColor.a = pow(1.0 - blending * customSmoothstep(0.35 * stepFactor, 0.45 * stepFactor, distance), 5.);
    gl_FragColor.a *= alphaFactor;
    // gl_FragColor.rgb = vec3(1.0);

    // #include <tonemapping_fragment>
    // #include <colorspace_fragment>
    
    // Uncomment to visualize blur amount
    // gl_FragColor = vec4(blurAmount, 0.0, 0.0, 1.0);
  }
`;var eNe=Object.defineProperty,tNe=Object.getOwnPropertyDescriptor,T5=(s,e,t,i)=>{for(var n=i>1?void 0:i?tNe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&eNe(e,t,n),n};class SA extends ze{constructor(){super(...arguments);p(this,"constraintActive",!0);p(this,"locked",!1);p(this,"sources",[])}}T5([I()],SA.prototype,"constraintActive",2);T5([I()],SA.prototype,"locked",2);T5([I(ye)],SA.prototype,"sources",2);function iNe(s,e){return Gp(s,ji.ContextCreated,e),()=>Vm(s,ji.ContextCreated)}function nNe(s,e){return Gp(s,ji.ContextClearing,e),()=>Vm(s,ji.ContextClearing)}function sNe(s,e){return Gp(s,ji.ContextDestroying,e),()=>Vm(s,ji.ContextDestroying)}function E5(s,e){return Gp(s,wn.Start,e),()=>Vm(s,wn.Start)}function R5(s,e){return Gp(s,wn.Update,e),()=>Vm(s,wn.Update)}function Loe(s,e){return Gp(s,wn.OnBeforeRender,e),()=>Vm(s,wn.OnBeforeRender)}function rNe(s,e){return Gp(s,wn.OnAfterRender,e),()=>Vm(s,wn.OnAfterRender)}class B0{constructor(){p(this,"bb",null);p(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}x(){return this.bb.readFloat32(this.bb_pos)}y(){return this.bb.readFloat32(this.bb_pos+4)}z(){return this.bb.readFloat32(this.bb_pos+8)}static sizeOf(){return 12}static createVec3(e,t,i,n){return e.prep(4,12),e.writeFloat32(n),e.writeFloat32(i),e.writeFloat32(t),e.offset()}}class Boe{constructor(){p(this,"bb",null);p(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}position(e){return(e||new B0).__init(this.bb_pos,this.bb)}rotation(e){return(e||new B0).__init(this.bb_pos+12,this.bb)}scale(e){return(e||new B0).__init(this.bb_pos+24,this.bb)}static sizeOf(){return 36}static createTransform(e,t,i,n,r,o,a,l,c,h){return e.prep(4,36),e.prep(4,12),e.writeFloat32(h),e.writeFloat32(c),e.writeFloat32(l),e.prep(4,12),e.writeFloat32(a),e.writeFloat32(o),e.writeFloat32(r),e.prep(4,12),e.writeFloat32(n),e.writeFloat32(i),e.writeFloat32(t),e.offset()}}class rp{constructor(){p(this,"bb",null);p(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSyncedTransformModel(e,t){return(t||new rp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedTransformModel(e,t){return e.setPosition(e.position()+WO),(t||new rp).__init(e.readInt32(e.position())+e.position(),e)}guid(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}fast(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}transform(e){const t=this.bb.__offset(this.bb_pos,8);return t?(e||new Boe).__init(this.bb_pos+t,this.bb):null}dontSave(){const e=this.bb.__offset(this.bb_pos,10);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startSyncedTransformModel(e){e.startObject(4)}static addGuid(e,t){e.addFieldOffset(0,t,0)}static addFast(e,t){e.addFieldInt8(1,+t,0)}static addTransform(e,t){e.addFieldStruct(2,t,0)}static addDontSave(e,t){e.addFieldInt8(3,+t,0)}static endSyncedTransformModel(e){return e.endObject()}static finishSyncedTransformModelBuffer(e,t){e.finish(t)}static finishSizePrefixedSyncedTransformModelBuffer(e,t){e.finish(t,void 0,!0)}}var Pr=(s=>(s[s.Average=0]="Average",s[s.Multiply=1]="Multiply",s[s.Minimum=2]="Minimum",s[s.Maximum=3]="Maximum",s))(Pr||{}),MP=(s=>(s[s.Discrete=0]="Discrete",s[s.Continuous=1]="Continuous",s))(MP||{}),Gs=(s=>(s[s.None=0]="None",s[s.FreezePositionX=2]="FreezePositionX",s[s.FreezePositionY=4]="FreezePositionY",s[s.FreezePositionZ=8]="FreezePositionZ",s[s.FreezePosition=14]="FreezePosition",s[s.FreezeRotationX=16]="FreezeRotationX",s[s.FreezeRotationY=32]="FreezeRotationY",s[s.FreezeRotationZ=64]="FreezeRotationZ",s[s.FreezeRotation=112]="FreezeRotation",s[s.FreezeAll=126]="FreezeAll",s))(Gs||{}),Gb=(s=>(s[s.None=0]="None",s[s.X=2]="X",s[s.Y=4]="Y",s[s.Z=8]="Z",s[s.All=-1]="All",s))(Gb||{});const ko=function(s,e){return function(t,i,n){oNe(t,i,n,s,e)}};function oNe(s,e,t,i,n){if(!n&&!i&&!s.onValidate)return;if(t!==void 0){console.error("Invalid usage of validate decorator. Only fields can be validated.",s,e,t),is("Invalid usage of validate decorator. Only fields can be validated. Property: "+e,zl.Error);return}let r="";if(typeof e=="string"?r=e:r=e.name,s.__internalAwake){const o=Symbol(r),a=s.__internalAwake;s.__internalAwake=function(){var l;if(!this.onValidate){Qe()&&console.warn('Usage of @validate decorate detected but there is no onValidate method in your class: "'+((l=s.constructor)==null?void 0:l.name)+'"');return}if(this[o]===void 0){this[o]=this[r];const c=this[r];if(c instanceof Q||c instanceof T||c instanceof Je||c instanceof Ve){const h=this[r];KB(h,()=>{this.onValidate(r)})}Object.defineProperty(this,r,{set:function(h){var d;if(this[mz]===!0)this[o]=h;else{i==null||i.call(this,h);const u=this[o];this[o]=h,(d=this.onValidate)==null||d.call(this,r,u)}},get:function(){return n==null||n.call(this),this[o]}})}a.call(this)}}}const aNe=function(s){return function(e,t,i){let n="";typeof t=="string"?n=t:n=t.name;const r=s.prototype,o=Object.getOwnPropertyDescriptor(r,n);if(!(o!=null&&o.value)){console.warn("Can not apply prefix: type does not have method named",t,s);return}const a=o.value,l=e[n];Object.defineProperty(r,n,{value:function(...c){const h=l==null?void 0:l.call(this,...c);if(h instanceof Promise){h.then(d=>{if(d!==!1)return a.call(this,...c)});return}if(h!==!1)return a.call(this,...c)}})}};var lNe=Object.defineProperty,cNe=Object.getOwnPropertyDescriptor,rc=(s,e,t,i)=>{for(var n=i>1?void 0:i?cNe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&lNe(e,t,n),n};class hNe{constructor(e,t){p(this,"positionChanged",!1);p(this,"rotationChanged",!1);p(this,"position");p(this,"quaternion");p(this,"_positionKeys",["x","y","z"]);p(this,"_quaternionKeys",["_x","_y","_z","_w"]);p(this,"mute",!1);p(this,"context");p(this,"obj");p(this,"_positionWatch");p(this,"_rotationWatch");this.context=t,this.obj=e}get isDirty(){return this.positionChanged||this.rotationChanged}reset(e=!1){if(this.positionChanged=!1,this.rotationChanged=!1,this.mute=!1,e){if(this.position)for(const t of this._positionKeys)delete this.position[t];if(this.quaternion)for(const t of this._quaternionKeys)delete this.quaternion[t]}}syncValues(){for(const e of this._positionKeys)this.position[e]=this.obj.position[e];for(const e of this._quaternionKeys)this.quaternion[e]=this.obj.quaternion[e]}applyValues(){if(this.positionChanged&&this.position)for(const e of this._positionKeys){const t=this.position[e];t!==void 0&&(this.obj.position[e]=t)}if(this.rotationChanged&&this.quaternion)for(const e of this._quaternionKeys){const t=this.quaternion[e];t!==void 0&&(this.obj.quaternion[e]=t)}}start(e,t){this.reset(),e&&(this._positionWatch||(this._positionWatch=new Ap(this.obj.position,["x","y","z"])),this._positionWatch.apply(),this.position={},this._positionWatch.subscribeWrite((r,o)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const a=this.position[o];Math.abs(a-r)<1e-5||(this.position[o]=r,this.positionChanged=!0)})),t&&(this._rotationWatch||(this._rotationWatch=new Ap(this.obj.quaternion,["_x","_y","_z","_w"])),this._rotationWatch.apply(),this.quaternion={},this._rotationWatch.subscribeWrite((r,o)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const a=this.quaternion[o];Math.abs(a-r)<1e-5||(this.quaternion[o]=r,this.rotationChanged=!0)}));const i=this.obj.matrixWorld.multiplyMatrices.bind(this.obj.matrixWorld),n=new ce;this.obj.matrixWorld.multiplyMatrices=(r,o)=>{var a;return(a=this.context.physics.engine)!=null&&a.isUpdating||this.mute||n.equals(r)||(this.positionChanged=!0,this.rotationChanged=!0,n.copy(r)),i(r,o)}}stop(){var e,t;(e=this._positionWatch)==null||e.revoke(),(t=this._rotationWatch)==null||t.revoke()}}var wF;const Bz=(wF=class extends ze{constructor(){super(...arguments);p(this,"autoMass",!0);p(this,"_mass",0);p(this,"useGravity",!0);p(this,"centerOfMass",new T(0,0,0));p(this,"constraints",Gs.None);p(this,"isKinematic",!1);p(this,"drag",0);p(this,"angularDrag",1);p(this,"detectCollisions",!0);p(this,"sleepThreshold",.01);p(this,"collisionDetectionMode",MP.Discrete);p(this,"_gravityScale",1);p(this,"dominanceGroup",0);p(this,"_propertiesChanged",!1);p(this,"_currentVelocity",new T);p(this,"_smoothedVelocity",new T);p(this,"_smoothedVelocityGetter",new T);p(this,"_lastPosition",new T);p(this,"_watch")}set mass(e){e!==this._mass&&(this._mass=e,this._propertiesChanged=!0,this.__didAwake&&(this.autoMass=!1))}get mass(){var e,t;return this.autoMass?((t=(e=this.context.physics.engine)==null?void 0:e.getBody(this))==null?void 0:t.mass())??-1:this._mass}get lockPositionX(){return(this.constraints&Gs.FreezePositionX)!==0}get lockPositionY(){return(this.constraints&Gs.FreezePositionY)!==0}get lockPositionZ(){return(this.constraints&Gs.FreezePositionZ)!==0}get lockRotationX(){return(this.constraints&Gs.FreezeRotationX)!==0}get lockRotationY(){return(this.constraints&Gs.FreezeRotationY)!==0}get lockRotationZ(){return(this.constraints&Gs.FreezeRotationZ)!==0}set lockPositionX(e){e?this.constraints|=Gs.FreezePositionX:this.constraints&=~Gs.FreezePositionX}set lockPositionY(e){e?this.constraints|=Gs.FreezePositionY:this.constraints&=~Gs.FreezePositionY}set lockPositionZ(e){e?this.constraints|=Gs.FreezePositionZ:this.constraints&=~Gs.FreezePositionZ}set lockRotationX(e){e?this.constraints|=Gs.FreezeRotationX:this.constraints&=~Gs.FreezeRotationX}set lockRotationY(e){e?this.constraints|=Gs.FreezeRotationY:this.constraints&=~Gs.FreezeRotationY}set lockRotationZ(e){e?this.constraints|=Gs.FreezeRotationZ:this.constraints&=~Gs.FreezeRotationZ}set gravityScale(e){this._gravityScale=e}get gravityScale(){return this._gravityScale}awake(){this._watch=void 0,this._propertiesChanged=!1}onEnable(){var e;this._watch||(this._watch=new hNe(this.gameObject,this.context)),this._watch.start(!0,!0),this.startCoroutine(this.beforePhysics(),wn.LateUpdate),Qe()&&!((e=this.context.physics.engine)!=null&&e.getBody(this))&&(globalThis.false?console.warn(`Rigidbody could not be created. Ensure "(${this.name}" has a Collider component.`):console.warn("Rigidbody could not be created: Rapier physics are explicitly disabled."))}onDisable(){var e,t;(e=this._watch)==null||e.stop(),(t=this.context.physics.engine)==null||t.removeBody(this)}onDestroy(){var e;(e=this.context.physics.engine)==null||e.removeBody(this)}onValidate(){this._propertiesChanged=!0}*beforePhysics(){var e,t,i,n;for(;;)this._propertiesChanged&&(this._propertiesChanged=!1,(e=this.context.physics.engine)==null||e.updateProperties(this)),(t=this._watch)!=null&&t.isDirty?(this._watch.mute=!0,this._watch.applyValues(),(i=this.context.physics.engine)==null||i.updateBody(this,this._watch.positionChanged,this._watch.rotationChanged),this._watch.reset()):(n=this._watch)==null||n.syncValues(),this.captureVelocity(),yield}teleport(e,t=!0){var i;(i=this._watch)==null||i.reset(!0),t?this.gameObject.position.set(e.x,e.y,e.z):this.setWorldPosition(e.x,e.y,e.z),this.resetForcesAndTorques(),this.resetVelocities()}resetForces(e=!0){var t;(t=this.context.physics.engine)==null||t.resetForces(this,e)}resetTorques(e=!0){var t;(t=this.context.physics.engine)==null||t.resetTorques(this,e)}resetVelocities(){this.setVelocity(0,0,0),this.setAngularVelocity(0,0,0)}resetForcesAndTorques(){this.resetForces(),this.resetTorques()}wakeUp(){var e;(e=this.context.physics.engine)==null||e.wakeup(this)}get isSleeping(){var e;return(e=this.context.physics.engine)==null?void 0:e.isSleeping(this)}updateProperties(){var e;return this._propertiesChanged=!1,(e=this.context.physics.engine)==null?void 0:e.updateProperties(this)}applyForce(e,t,i=!0){var n;this._propertiesChanged&&this.updateProperties(),(n=this.context.physics.engine)==null||n.addForce(this,e,i)}applyImpulse(e,t=!0){var i;this._propertiesChanged&&this.updateProperties(),(i=this.context.physics.engine)==null||i.applyImpulse(this,e,t)}setForce(e,t,i,n=!0){var r,o,a;(r=this.context.physics.engine)==null||r.resetForces(this,n),typeof e=="number"?(t??(t=0),i??(i=0),(o=this.context.physics.engine)==null||o.addForce(this,{x:e,y:t,z:i},n)):(a=this.context.physics.engine)==null||a.addForce(this,e,n)}getVelocity(){var t;const e=(t=this.context.physics.engine)==null?void 0:t.getLinearVelocity(this);return e?(this._currentVelocity.x=e.x,this._currentVelocity.y=e.y,this._currentVelocity.z=e.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setVelocity(e,t,i,n=!0){var r,o;if(e instanceof T){const a=e;(r=this.context.physics.engine)==null||r.setLinearVelocity(this,a,n);return}t===void 0||i===void 0||(o=this.context.physics.engine)==null||o.setLinearVelocity(this,{x:e,y:t,z:i},n)}getAngularVelocity(){var t;const e=(t=this.context.physics.engine)==null?void 0:t.getAngularVelocity(this);return e?(this._currentVelocity.x=e.x,this._currentVelocity.y=e.y,this._currentVelocity.z=e.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setAngularVelocity(e,t,i,n=!0){var r,o;if(typeof e=="object"){const a=e;(r=this.context.physics.engine)==null||r.setAngularVelocity(this,a,n);return}if(t===void 0||i===void 0||typeof t=="boolean"){console.warn("setAngularVelocity expects either a Vec3 or 3 numbers");return}(o=this.context.physics.engine)==null||o.setAngularVelocity(this,{x:e,y:t,z:i},n)}setTorque(e,t,i){typeof e=="number"?this.setAngularVelocity(e,t,i):this.setAngularVelocity(e)}get smoothedVelocity(){return this._smoothedVelocityGetter.copy(this._smoothedVelocity),this._smoothedVelocityGetter.multiplyScalar(1/this.context.time.deltaTime)}setBodyFromGameObject(e=null){}captureVelocity(){const e=$t(this.gameObject);this.gameObject.matrixWorld.decompose(Bz.tempPosition,dNe,uNe);const t=e.sub(this._lastPosition);this._lastPosition.copy(Bz.tempPosition),this._smoothedVelocity.lerp(t,this.context.time.deltaTime/.1)}},p(wF,"tempPosition",new T),wF);let en=Bz;rc([ko()],en.prototype,"autoMass",2);rc([I()],en.prototype,"mass",1);rc([ko(),I()],en.prototype,"useGravity",2);rc([I(T)],en.prototype,"centerOfMass",2);rc([ko(),I()],en.prototype,"constraints",2);rc([ko(),I()],en.prototype,"isKinematic",2);rc([ko(),I()],en.prototype,"drag",2);rc([ko(),I()],en.prototype,"angularDrag",2);rc([ko(),I()],en.prototype,"detectCollisions",2);rc([ko(),I()],en.prototype,"sleepThreshold",2);rc([ko(),I()],en.prototype,"collisionDetectionMode",2);rc([ko()],en.prototype,"_gravityScale",2);rc([ko()],en.prototype,"dominanceGroup",2);new T;const dNe=new Ve,uNe=new T,_f=ee("debugsync"),vS="STRS";QO(vS,rp.getRootAsSyncedTransformModel);const td=new oM;function Poe(s,e,t=!0){td.clear();const i=td.createString(s);rp.startSyncedTransformModel(td),rp.addGuid(td,i),rp.addFast(td,t);const n=e.worldPosition,r=e.worldEuler,o=e.gameObject.scale;rp.addTransform(td,Boe.createTransform(td,n.x,n.y,n.z,r.x,r.y,r.z,o.x,o.y,o.z));const a=rp.endSyncedTransformModel(td);return td.finish(a,vS),td.asUint8Array()}let Pz=0,hw=0;R5(s=>{var i;const t=((i=s.connection.currentServerUrl)==null?void 0:i.includes("glitch"))?10:40;hw=Math.floor(Pz/t),Pz=0,_f&&hw>0&&console.log("Sync Transform Fast Interval",hw)});class $d extends ze{constructor(){super(...arguments);p(this,"overridePhysics",!0);p(this,"interpolatePosition",!0);p(this,"interpolateRotation",!0);p(this,"fastMode",!1);p(this,"syncDestroy",!1);p(this,"_model",null);p(this,"_needsUpdate",!0);p(this,"rb",null);p(this,"_wasKinematic",!1);p(this,"_receivedDataBefore",!1);p(this,"_targetPosition");p(this,"_targetRotation");p(this,"_receivedFastUpdate",!1);p(this,"_shouldRequestOwnership",!1);p(this,"joinedRoomCallback",null);p(this,"receivedDataCallback",null);p(this,"tempEuler",new Xi);p(this,"receivedUpdate",!1);p(this,"lastWorldPos");p(this,"lastWorldRotation")}requestOwnership(){_f&&console.log("Request ownership"),this._model?this._model.requestOwnership():(this._shouldRequestOwnership=!0,this._needsUpdate=!0)}hasOwnership(){var t;return((t=this._model)==null?void 0:t.hasOwnership)??void 0}isOwned(){var t;return(t=this._model)==null?void 0:t.isOwned}awake(){_f&&console.log("new instance",this.guid,this),this._receivedDataBefore=!1,this._targetPosition=new T,this._targetRotation=new Ve,this.lastWorldPos=new T,this.lastWorldRotation=new Ve,this.rb=$.getComponentInChildren(this.gameObject,en),this.rb&&(this._wasKinematic=this.rb.isKinematic),this.receivedUpdate=!0,this._model=new $O(this.context.connection,this.guid),this.context.connection.isConnected&&this.tryGetLastState(),this.joinedRoomCallback=this.tryGetLastState.bind(this),this.context.connection.beginListen(ri.JoinedRoom,this.joinedRoomCallback),this.receivedDataCallback=this.onReceivedData.bind(this),this.context.connection.beginListenBinary(vS,this.receivedDataCallback)}onDestroy(){this.syncDestroy&&o5(this.guid,this.context.connection),this._model=null,this.context.connection.stopListen(ri.JoinedRoom,this.joinedRoomCallback),this.context.connection.stopListenBinary(vS,this.receivedDataCallback)}tryGetLastState(){const t=this.context.connection.tryGetState(this.guid);t&&this.onReceivedData(t)}onReceivedData(t){var i;if(!this.destroyed&&typeof t.guid=="function"&&t.guid()===this.guid){_f&&console.log("new data",this.context.connection.connectionId,this.context.time.frameCount,this.guid,t),this.receivedUpdate=!0,this._receivedFastUpdate=t.fast();const n=t.transform();if(n){Vc.markDirty(this.gameObject,!0);const r=n.position();r&&(this.interpolatePosition&&((i=this._targetPosition)==null||i.set(r.x(),r.y(),r.z())),(!this.interpolatePosition||!this._receivedDataBefore)&&this.setWorldPosition(r.x(),r.y(),r.z()));const o=n.rotation();o&&(this.tempEuler.set(o.x(),o.y(),o.z()),this.interpolateRotation&&this._targetRotation.setFromEuler(this.tempEuler),(!this.interpolateRotation||!this._receivedDataBefore)&&yO(this.gameObject,this.tempEuler))}this._receivedDataBefore=!0}}onEnable(){this.lastWorldPos.copy(this.worldPosition),this.lastWorldRotation.copy(this.worldQuaternion),this._needsUpdate=!0,this._model&&this._model.updateIsOwned()}onDisable(){this._model&&this._model.freeOwnership()}onBeforeRender(){if(!this.activeAndEnabled||!this.context.connection.isConnected)return;if(!this.context.connection.isInRoom||!this._model){_f&&console.log("no model or room",this.name,this.guid,this.context.connection.isInRoom);return}this._shouldRequestOwnership&&(this._shouldRequestOwnership=!1,this._model.requestOwnership());const t=this.worldPosition,i=this.worldQuaternion;if(this._model.isOwned&&!this.receivedUpdate){const o=t.distanceTo(this.lastWorldPos),a=i.angleTo(this.lastWorldRotation),l=this._model.hasOwnership||this.fastMode?1e-4:.001;(o>l||a>l)&&(this._model.hasOwnership?this._needsUpdate=!0:(_f&&console.log(this.guid,"reset because not owned but",this.gameObject.name,this.lastWorldPos),this.worldPosition=this.lastWorldPos,t.copy(this.lastWorldPos),this.worldQuaternion=this.lastWorldRotation,i.copy(this.lastWorldRotation),Vc.markDirty(this.gameObject,!0),this._needsUpdate=!1))}if(this._model&&!this._model.hasOwnership&&this._model.isOwned&&this._receivedDataBefore){const a=this._receivedFastUpdate||this.fastMode?.5:.3;let l=!1;if(this.interpolatePosition&&this._targetPosition){const c=this.worldPosition;c.lerp(this._targetPosition,a),this.worldPosition=c,l=!0}if(this.interpolateRotation&&this._targetRotation){const c=this.worldQuaternion;c.slerp(this._targetRotation,a),this.worldQuaternion=c,l=!0}l&&Vc.markDirty(this.gameObject,!0)}if(this.receivedUpdate=!1,this.lastWorldPos.copy(t),this.lastWorldRotation.copy(i),!this._model||!this._model||this._model.hasOwnership===void 0||!this._model.hasOwnership)return;this.rb&&this.overridePhysics&&this._wasKinematic!==void 0&&(_f&&console.log("reset kinematic",this.rb.name,this._wasKinematic),this.rb.isKinematic=this._wasKinematic);const n=10,r=this.rb||this.fastMode;if(this._needsUpdate&&(this.context.time.frameCount%n===0||r)){if(Pz++,r&&hw>0&&this.context.time.frameCount%hw!==0)return;_f&&console.log("send update",this.context.connection.connectionId,this.guid,this.gameObject.name,this.gameObject.guid),this._needsUpdate=!1;const o=Poe(this.guid,this,!!r);this.context.connection.sendBinary(o)}}}const pNe=ee("debugshadowcomponents");dO.prototype.interactable={get(){return this.interactive},set(s){this.interactable=s}};const Bc=Symbol("shadowDomOwner");class Xc extends ze{constructor(){super(...arguments);p(this,"_shadowComponent",null);p(this,"_controlsChildLayout",!0);p(this,"_root");p(this,"_parentComponent")}isRoot(){var t;return((t=this.Root)==null?void 0:t.gameObject)===this.gameObject}get canvas(){const t=this.Root;return t!=null&&t.isCanvas?t:null}get Canvas(){return this.canvas}markDirty(){nl.markUIDirty(this.context)}get shadowComponent(){return this._shadowComponent}set shadowComponent(t){this._shadowComponent=t}get controlsChildLayout(){return this._controlsChildLayout}set controlsChildLayout(t){this._controlsChildLayout=t,this.shadowComponent&&(this.shadowComponent.autoLayout=t)}get Root(){return this._root===void 0&&(this._root=$.getComponentInParent(this.gameObject,yM)),this._root}__internalNewInstanceCreated(t){return super.__internalNewInstanceCreated(t),this.shadowComponent=null,this._root=void 0,this._parentComponent=void 0,this}onEnable(){super.onEnable()}addShadowComponent(t,i){var o;if(!t)return;this.removeShadowComponent();const n=this.isRoot()?this.gameObject:this.gameObject.parent;if(this._parentComponent=$.getComponentInParent(n,Xc),!this._parentComponent){console.warn(`Component "${this.name}" doesn't have a UI parent anywhere. Do you have an UI element outside a Canvas? UI components must be a child of a Canvas component`,this);return}t.name=this.name+" ("+(this.constructor.name??"UI")+")",t.autoLayout=this._parentComponent.controlsChildLayout,t[Bc]=this,this.setShadowComponentOwner(t);let r=!1;if(((o=this.Root)==null?void 0:o.gameObject)===this.gameObject)this.gameObject.add(t);else{const a=this._parentComponent.shadowComponent;a&&(a==null||a.add(t),r=!0)}this.shadowComponent=t,i&&i.shadowComponent&&this.shadowComponent&&i.shadowComponent.add(this.shadowComponent),hM&&t.add(new al(.5)),this.onAfterAddedToScene(),r&&_ie(),pNe&&console.warn("Added shadow component",this.shadowComponent)}setShadowComponentOwner(t){if(t&&(t[Bc]===void 0||t[Bc]===this)&&(t[Bc]=this,t.children))for(const i of t.children)this.setShadowComponentOwner(i)}traverseOwnedShadowComponents(t,i,n){if(t&&t[Bc]===i){n(t);for(const r of t.children)this.traverseOwnedShadowComponents(r,i,n)}}removeShadowComponent(){this.shadowComponent&&this.shadowComponent.removeFromParent()}onAfterAddedToScene(){}setInteractable(t){this.shadowComponent&&(this.shadowComponent.interactable=t)}}class yM extends Xc{awake(){super.awake()}}class lv{constructor(e,t){p(this,"event");p(this,"button");p(this,"buttonName");p(this,"_used",!1);p(this,"_propagationStopped",!1);p(this,"z__pointer_ctured",!1);p(this,"z__pointer_cture_rleased",!1);p(this,"inputSource");p(this,"object");p(this,"point");p(this,"normal");p(this,"face");p(this,"distance");p(this,"instanceId");p(this,"intersection");p(this,"isDown");p(this,"isUp");p(this,"isPressed");p(this,"isClick");p(this,"isDoubleClick");p(this,"input");this.event=t,this.input=e,this.button=t.button}get deviceIndex(){return this.event.deviceIndex}get pointerId(){return this.event.pointerId}get pressure(){return this.event.pressure}get used(){return this._used}use(){this._used||(this._used=!0,this.event.use())}get propagationStopped(){return this._propagationStopped}stopPropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}stopImmediatePropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}setPointerCapture(){this.z__pointer_ctured=!0}releasePointerCapture(){this.z__pointer_cture_rleased=!0}get mode(){return this.event.mode}clone(){const e=new lv(this.input,this.event);return Object.assign(e,this),e}Use(){this.use()}StopPropagation(){this.event.stopImmediatePropagation()}}function y2(s,e){return $.foreachComponent(s,i=>{if(!i.enabled)return;const n=i;if(e)switch(e){case"pointerdown":if(n.onPointerDown)return!0;break;case"pointerup":if(n.onPointerUp||n.onPointerClick)return!0;break;case"pointermove":if(n.onPointerEnter||n.onPointerExit||n.onPointerMove)return!0;break}else if(n.onPointerDown||n.onPointerUp||n.onPointerEnter||n.onPointerExit||n.onPointerClick)return!0},!1)===!0}const Bu=new Array;class Cd{constructor(e,t,i,n){p(this,"enabled",!0);p(this,"target");p(this,"methodName");p(this,"arguments");this.target=e,this.methodName=t||null,this.arguments=i,n!=null&&(this.enabled=n)}get canClone(){return this.target instanceof Object}invoke(...e){if(this.enabled!==!1){if(typeof this.target=="function")this.arguments?(Bu.length=0,e!==void 0&&e.length>0&&Bu.push(...e),Bu.push(...this.arguments),this.target(...this.arguments),Bu.length=0):this.target(...e);else if(this.methodName!=null){const t=this.target[this.methodName];typeof t=="function"?this.arguments?(Bu.length=0,e!==void 0&&e.length>0&&Bu.push(...e),Bu.push(...this.arguments),t.call(this.target,...Bu),Bu.length=0):t.call(this.target,...e):this.arguments?this.target[this.methodName]=this.arguments[0]||e[0]:this.target[this.methodName]=e[0]}}}}const fNe=s=>/^[A-Z]*$/.test(s);class IP extends Event{constructor(){super(...arguments);p(this,"args")}}class Tn{constructor(e){p(this,"isEventList",!0);p(this,"target");p(this,"key");p(this,"_isInvoking",!1);p(this,"methods",[]);p(this,"_methodsCopy",[]);if(this.methods=[],Array.isArray(e))for(const t of e)t instanceof Cd?this.methods.push(t):typeof t=="function"&&this.methods.push(new Cd(t));else typeof e=="function"&&this.methods.push(new Cd(e))}__internalOnInstantiate(e){var n;const t=new Array;for(let r=0;r<this.methods.length;r++){const o=this.methods[r];if(!(o.target instanceof Function)){const a=o.target;let l=a==null?void 0:a.uuid;if(a&&(l=a.guid),l){const c=e[l];if(c){const h=(n=o.arguments)==null?void 0:n.map(d=>d instanceof Object&&d.uuid?e[d.uuid]:d!=null&&d.isComponent?e[d.guid]:d);t.push(new Cd(c.clone,o.methodName,h,o.enabled))}else Qe()&&console.warn("Could not find target for event listener")}}}return new Tn(t)}setEventTarget(e,t){if(this.key=e,this.target=t,this.key!==void 0){let i="",n=!1;for(const r of this.key)n&&fNe(r)&&(i+="-"),n=!0,i+=r.toLowerCase();this.key=i}}get listenerCount(){var e;return((e=this.methods)==null?void 0:e.length)??0}get isInvoking(){return this._isInvoking}static from(...e){return new Tn(e)}invoke(...e){var t;if(this._isInvoking)return console.warn("Circular event invocation detected. Please check your event listeners for circular references.",this),!1;if(((t=this.methods)==null?void 0:t.length)<=0)return!1;this._isInvoking=!0;try{this._methodsCopy.length=0,this._methodsCopy.push(...this.methods);for(const i of this._methodsCopy)i.invoke(...e);if(typeof this.target=="object"&&typeof this.key=="string"){const i=this.target.dispatchEvent;if(typeof i=="function"){const n=new IP(this.key);n.args=e,i.call(this.target,n)}}}finally{this._isInvoking=!1,this._methodsCopy.length=0}return!0}addEventListener(e){return this.methods.push(new Cd(e)),e}removeEventListener(e){if(e)for(let t=this.methods.length-1;t>=0;t--)this.methods[t].target===e&&(this.methods[t].enabled=!1,this.methods.splice(t,1))}removeAllEventListeners(){this.methods.length=0}}class mNe extends Qc{constructor(){super([ge,hn],"ColorSerializer")}onDeserialize(e){if(e!=null)return e.a!==void 0?new hn(e.r,e.g,e.b,e.a):e.alpha!==void 0?new hn(e.r,e.g,e.b,e.alpha):new ge(e.r,e.g,e.b)}onSerialize(e){if(e!=null)return e.a!==void 0?{r:e.r,g:e.g,b:e.b,a:e.a}:{r:e.r,g:e.g,b:e.b}}}const gNe=new mNe;class ANe extends Qc{constructor(){super([Xi],"EulerSerializer")}onDeserialize(e,t){if(e!=null){if(e.order)return new Xi(e.x,e.y,e.z,e.order);if(e.x!=null)return new Xi(e.x,e.y,e.z)}}onSerialize(e,t){return{x:e.x,y:e.y,z:e.z,order:e.order}}}const yNe=new ANe;class bNe extends Qc{constructor(){super(ye,"ObjectSerializer")}onSerialize(e,t){if(t.objectToNode!==void 0&&e.uuid){const i=t.objectToNode[e.uuid];return Ur&&console.log(i,e.name,e.uuid),{node:i}}}onDeserialize(e,t){var i,n,r;if(typeof e=="string"){if(e.endsWith(".glb")||e.endsWith(".gltf")){if(t.serializable instanceof Array&&t.serializable.includes(gi))return;Qe()&&An("Detected wrong usage of @serializable with Object3D or GameObject. Instead you should use AssetReference here! Please see the console for details.");const o=(n=(i=t.target)==null?void 0:i.constructor)==null?void 0:n.name;console.warn(`Wrong usage of @serializable detected in your script "${o}"

It looks like you used @serializable(Object3D) or @serializable(GameObject) for a prefab or scene reference which is exported to a separate glTF file.

To fix this please change your code to:

@serializable(AssetReference)
${t.path}! : AssetReference;
\0`)}return}if(e){if(e.node!==void 0&&t.nodeToObject){const o=t.nodeToObject[e.node];return Ur&&console.log("Deserialized object reference?",e,o,t==null?void 0:t.nodeToObject),o||console.warn("Did not find node: "+e.node,t.nodeToObject,t.object),o}else if(e.guid){if(!t.context){console.error("Missing context");return}let o;const a=(r=t.gltf)==null?void 0:r.scene;return a&&(o=$.findByGuid(e.guid,a)),o||(o=$.findByGuid(e.guid,t.context.scene)),o?(o&&o.isComponent===!0&&(Ur&&console.warn("Deserialized object reference is a component"),o=o.gameObject),Ur&&console.log("Deserialized object reference?",e,o,t==null?void 0:t.nodeToObject)):((Qe()||Ur)&&console.warn("Could not resolve object reference",t.path,e,t.target,t.context.scene),e.could_not_resolve=!0),o}}}}const Goe=new bNe;class xNe extends Qc{constructor(){super([ze,ze],"ComponentSerializer")}onSerialize(e,t){if(e!=null&&e.guid)return{guid:e.guid}}onDeserialize(e,t){var i;if(e!=null&&e.guid){if(e.___persistentAsset){Ur&&console.log("Skipping component deserialization because it's a persistent asset",e);return}const n=t.path;Ur&&console.log(e.guid,t.root,t.object,t.target);let r=this.findObjectForGuid(e.guid,t.root);if(r||t.context&&(r=this.findObjectForGuid(e.guid,(i=t.context)==null?void 0:i.scene),r))return r;(Qe()||Ur)&&console.warn('Could not resolve component reference: "'+n+'" using guid '+e.guid,t.target),e.could_not_resolve=!0;return}}findObjectForGuid(e,t){if(t.guid===e)return t;const i=$.foreachComponent(t,n=>{if(n.guid===e)return n},!1);if(i!==void 0)return i;for(let n=0;n<t.children.length;n++){const r=t.children[n],o=this.findObjectForGuid(e,r);if(o)return o}}}const OR=new xNe;class vNe extends Qc{constructor(){super([Tn])}onSerialize(e,t){console.log("TODO: SERIALIZE EVENT")}onDeserialize(e,t){var i,n,r;if(typeof e=="function")return new Tn([new Cd(e,null,[],!0)]);if(e&&e.type==="EventList"){Ur&&console.log("DESERIALIZE EVENT",e);const o=new Array;if(e.calls&&Array.isArray(e.calls))for(const c of e.calls){let h=function(f){if(typeof f=="object"){let m=Goe.onDeserialize(f,t);if(m||(m=OR.onDeserialize(f,t)),m)return m}return f};Ur&&console.log(c);let d=OR.findObjectForGuid(c.target,t.root);!d&&((i=t.context)!=null&&i.scene)&&(d=OR.findObjectForGuid(c.target,(n=t.context)==null?void 0:n.scene));const u=((r=c.method)==null?void 0:r.length)>0;if(d&&u){const f=()=>{const g=c.method[0].toUpperCase()+c.method.slice(1);if(typeof d[g]=="function"){console.warn(`EventList method:
Could not find method ${c.method} on object ${d.name}. Please rename ${c.method} to ${g}?
`,d[g],`
 in script: `,d),An("EventList methods must start with lowercase letter, see console for details");return}else console.warn(`EventList method:
Could not find method ${c.method} on object ${d.name}`,d,typeof d[c.method])};if(typeof d[c.method]!="function"){let g=!1,A=d;for(;A;){const y=Object.getOwnPropertyDescriptor(A,c.method);if(y&&(y.writable===!0||y.set)){g=!0;break}A=Object.getPrototypeOf(A)}!g&&(Qe()||Ur)&&f()}}if(d){let f=c.argument;if(f!==void 0?f=h(f):c.arguments!==void 0&&(f=c.arguments.map(h)),!d[c.method])console.warn(`EventList method not found: "${c.method}" on ${d==null?void 0:d.name}`);else{f!==void 0&&!Array.isArray(f)&&(f=[f]);const g=new Cd(d,c.method,f,c.enabled);o.push(g)}}else Qe()&&console.warn("[Debug] EventList: Could not find event listener in scene",c,t.object,e)}const a=new Tn(o);Ur&&console.log(a);const l=t.target;return l!==void 0&&t.path!==void 0&&a.setEventTarget(t.path,l),a}}}const _Ne=new vNe,b2=new WeakMap,CNe=si.prototype.clone;si.prototype.clone=function(){const s=CNe.call(this);return b2.has(s)||b2.set(s,this),s};class koe extends Qc{constructor(){super([jf,ci])}onSerialize(e,t){}onDeserialize(e,t){if(e instanceof si&&t.type===jf){let i=e;b2.has(i)&&(i=b2.get(i)),i.isRenderTargetTexture=!0,i.flipY=!0,i.offset.y=1,i.repeat.y=-1,i.needsUpdate=!0,i.mipmaps=[],i instanceof Fd&&(i.isCompressedTexture=!1,i.format=bi);const n=new jf(i.image.width,i.image.height,{colorSpace:Ji});return n.texture=i,n}}}new koe;class Noe extends Qc{constructor(){super([URL])}onSerialize(e,t){return null}onDeserialize(e,t){if(typeof e=="string"&&e.length>0)return km(t.gltfId,e)}}new Noe;var wNe=Object.defineProperty,SNe=Object.getOwnPropertyDescriptor,MNe=(s,e,t,i)=>{for(var n=i>1?void 0:i?SNe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&wNe(e,t,n),n};class bM extends ze{awake(){nl.createIfNoneExists(this.context)}onEnable(){var e;(e=nl.get(this.context))==null||e.register(this)}onDisable(){var e;(e=nl.get(this.context))==null||e.unregister(this)}}class nc extends bM{constructor(){super(...arguments);p(this,"targets",null);p(this,"raycastHits",[]);p(this,"ignoreSkinnedMeshes",!1)}start(){this.targets=[this.gameObject]}performRaycast(t=null){if(!this.targets)return null;t??(t=new qd),t.targets=this.targets,t.results=this.raycastHits,t.useAcceleratedRaycast=!0;const i=t.testObject;this.ignoreSkinnedMeshes&&(t.testObject=r=>r instanceof ol?"continue in children":i?i(r):!0);const n=this.context.physics.raycast(t);return t.testObject=i,n}}MNe([I()],nc.prototype,"ignoreSkinnedMeshes",2);class TP extends nc{constructor(){super(),this.ignoreSkinnedMeshes=!0}}const $Z=class extends bM{performRaycast(e){if(!Vt.active||!$Z.allow||!(e!=null&&e.ray))return null;const t=e.ray.origin,i=.015;return this.context.physics.sphereOverlap(t,i,!1,!0)}};let qf=$Z;p(qf,"allow",!0);class EP{static getObject(e){const t=e[Bc];return t&&(t.isComponent===!0?e=t.gameObject:e=t),e}static isInteractable(e,t){if(t&&(t.canvasGroup=void 0,t.graphic=void 0),e==null||!e.visible||(e=this.getObject(e),!e.visible))return!1;const i=this.tryFindCanvasGroup(e);if((i==null?void 0:i.isCanvasGroup)===!0&&(t&&(t.canvasGroup=i),i.blocksRaycasts===!1||i.interactable===!1))return!1;const n=tA(e,r=>{if(r.isGraphic===!0)return r},!1);return t&&(n==null?void 0:n.isGraphic)===!0&&(t.graphic=n),!((n==null?void 0:n.raycastTarget)===!1||(n==null?void 0:n.layer)===2)}static tryFindCanvasGroup(e){if(!e)return null;const t=tA(e,i=>{const n=i;if(n.blocksRaycasts!==void 0&&n.interactable!==void 0)return n},!1);return t!==void 0?t:this.tryFindCanvasGroup(e.parent)}}function L5(s){const e=s[Bc];return e||(s.parent?L5(s.parent):null)}function INe(s){return s.isUI===!0||typeof s[Bc]=="object"}function x2(s,e){if(!s)return;const t=s.material;if((t==null?void 0:t.isMaterial)===!0){const i=s.parent;i&&i.isText,t.side=e.doubleSided??!0?Zi:us,t.shadowSide=e.doubleSided?Zi:us,s.castShadow=e.castShadows?e.castShadows:!1,s.receiveShadow=e.receiveShadows?e.receiveShadows:!1}for(const i of s.children)x2(i,e)}function ub(s,e,t){s[e]===void 0&&console.warn("Field",e,"is undefined on",s);const i=Proxy.revocable(s[e],{set(o,a,l,c){const h=o[a],d=Reflect.set(o,a,l,c);return t(l,h),d}}),n=i.revoke,r=s[e];return i.revoke=()=>{s[e]=r,n()},s[e]=i.proxy,i}const hY=Symbol("Scheduled action");function TNe(s,e,t=wn.OnBeforeRender){let i=s[hY];i||(i=s[hY]={});const n=e.name;i[t]||(i[t]={});const r=i[t];if(r[n])return;function*a(){e==null||e.call(s),r[n]=null}const l=s.startCoroutine(a(),t);r[n]=l}const Fu=ee("debugeventsystem");var Gz=(s=>(s.BeforeHandleInput="BeforeHandleInput",s.AfterHandleInput="AfterHandleInput",s))(Gz||{});const ud=class extends ze{constructor(){super();p(this,"raycaster",[]);p(this,"pressedByID",new Map);p(this,"hoveredByID",new Map);p(this,"onPointerEvent",t=>{if(t===void 0||t.propagationStopped||t.defaultPrevented||t.used)return;const i=new lv(this.context.input,t);this._currentPointerEventName=t.type,i.inputSource=this.context.input,i.isClick=t.isClick,i.isDoubleClick=t.isDoubleClick,i.isDown=t.type==es.PointerDown,i.isUp=t.type==es.PointerUp,i.isPressed=this.context.input.getPointerPressed(t.pointerId),Fu&&(i.isDown?console.log("DOWN",i.pointerId):i.isUp&&console.log("UP",i.pointerId),i.isClick&&console.log("CLICK",i.pointerId));const n=new qd;t.hasRay?n.ray=t.ray:n.screenPoint=this.context.input.getPointerPositionRC(t.pointerId);const r=this.performRaycast(n);if(r){for(const a of r)a.event=t,t.intersections.push(a);t.origin.onPointerHits&&t.origin.onPointerHits({sender:this,event:t,hits:r})}Fu&&i.isClick&&is("EventSystem: "+i.pointerId+" - "+this.context.time.frame+" - Up:"+i.isUp+", Down:"+i.isDown);const o={sender:this,args:i,hasActiveUI:this.currentActiveMeshUIComponents.length>0};this.dispatchEvent(new CustomEvent("BeforeHandleInput",{detail:o})),this.handleIntersections(r,i),this.dispatchEvent(new CustomEvent("AfterHandleInput",{detail:o}))});p(this,"_sortedHits",[]);p(this,"_testObjectsCache",new Map);p(this,"_currentlyActiveRaycaster",null);p(this,"_currentPointerEventName",null);p(this,"shouldRaycastObject",t=>{var r;let i=null;if(INe(t)&&(i=(r=t[Bc])==null?void 0:r.gameObject),this._testObjectsCache.has(t)||i&&this._testObjectsCache.has(i))return this._testObjectsCache.get(t)===!1?"continue in children":!0;{let o=y2(t,this._currentPointerEventName);if(!o&&i&&(o=y2(i,this._currentPointerEventName)),o){this._testObjectsCache.set(t,!0);for(const a of t.children)this.shouldRaycastObject_AddToYesCache(a);return!0}return this._testObjectsCache.set(t,!1),"continue in children"}});p(this,"_sortingBuffer",[]);p(this,"_noDepthTestingResults",[]);p(this,"out",{});p(this,"_capturedPointer",{});p(this,"pointerEnterSymbol",Symbol("pointerEnter"));p(this,"pointerExitSymbol",Symbol("pointerExit"));p(this,"currentActiveMeshUIComponents",[]);ud.systems.push(this)}static createIfNoneExists(t){this.didSearchEventSystem||(this.didSearchEventSystem=!0,ud.systems.length<=0&&ud.systems.push(...$.findObjectsOfType(ud,t)));for(const n of ud.systems)if(n.context===t)return;const i=new ye;$.addComponent(i,ud),t.scene.add(i)}static get systems(){const t=Wt.Current;return this._eventSystemMap.has(t)||this._eventSystemMap.set(t,[]),this._eventSystemMap.get(t)}static get(t){const i=this._eventSystemMap.get(t);return i&&i.length>0?i[0]:null}static get instance(){return this.systems[0]}static ensureUpdateMeshUI(t,i,n=!1){Bf.update(t,i,n)}static markUIDirty(t){Bf.markDirty()}get hasActiveUI(){return this.currentActiveMeshUIComponents.length>0}get isHoveringObjects(){return this.hoveredByID.size>0}onDestroy(){ud.systems.splice(ud.systems.indexOf(this),1)}start(){if(this.raycaster.length<=0&&!$.findObjectOfType(bM,this.context)){const i=$.addComponent(this.context.scene,nc);this.raycaster.push(i),(Qe()||Fu)&&console.warn("Added an ObjectRaycaster to the scene because no raycaster was found.")}}register(t){var i;t&&this.raycaster&&!this.raycaster.includes(t)&&((i=this.raycaster)==null||i.push(t))}unregister(t){var n,r;const i=(n=this.raycaster)==null?void 0:n.indexOf(t);i!==void 0&&i!==-1&&((r=this.raycaster)==null||r.splice(i,1))}onEnable(){this.context.input.addEventListener(es.PointerDown,this.onPointerEvent),this.context.input.addEventListener(es.PointerUp,this.onPointerEvent),this.context.input.addEventListener(es.PointerMove,this.onPointerEvent)}onDisable(){this.context.input.removeEventListener(es.PointerDown,this.onPointerEvent),this.context.input.removeEventListener(es.PointerUp,this.onPointerEvent),this.context.input.removeEventListener(es.PointerMove,this.onPointerEvent)}onBeforeRender(){this.resetMeshUIStates()}shouldRaycastObject_AddToYesCache(t){this._testObjectsCache.set(t,!0);for(const i of t.children)this.shouldRaycastObject_AddToYesCache(i)}performRaycast(t){if(!this.raycaster)return null;this._testObjectsCache.clear(),this._sortedHits.length=0,t||(t=new qd),t.testObject=this.shouldRaycastObject;for(const i of this.raycaster){if(!i.activeAndEnabled)continue;this._currentlyActiveRaycaster=i;const n=i.performRaycast(t);this._currentlyActiveRaycaster=null,n&&n.length>0&&this._sortedHits.push(...n)}return this._sortedHits.sort((i,n)=>i.distance-n.distance),this._sortedHits}assignHitInformation(t,i){i?(t.intersection=i,t.point=i.point,t.normal=i.normal,t.face=i.face,t.distance=i.distance,t.instanceId=i.instanceId):(t.intersection=void 0,t.point=void 0,t.normal=void 0,t.face=void 0,t.distance=void 0,t.instanceId=void 0)}handleIntersections(t,i){var r;if(t!=null&&t.length){t=this.sortCandidates(t);for(const o of t){if(i.event.immediatePropagationStopped)return!1;if(this.assignHitInformation(i,o),this.handleEventOnObject(o.object,i))return!0}}this.assignHitInformation(i,t==null?void 0:t[0]),this.invokePointerCapture(i);const n=this.hoveredByID.get(i.pointerId);return n&&this.propagatePointerExit(n.obj,n.data,null),this.hoveredByID.delete(i.pointerId),i.isUp&&((r=this.pressedByID.get(i.pointerId))==null||r.handlers.forEach(o=>this.invokeOnPointerUp(i,o)),this.pressedByID.delete(i.pointerId)),!1}sortCandidates(t){this._sortingBuffer.length=0,this._noDepthTestingResults.length=0;for(let i=0;i<t.length;i++){const n=t[i],r=n.object;if(r.material&&r.material.depthTest===!1){this._noDepthTestingResults.push(n);continue}this._sortingBuffer.push(n)}for(const i of this._sortingBuffer)this._noDepthTestingResults.push(i);return this._noDepthTestingResults}handleEventOnObject(t,i){if(!this.testIsVisible(t))return i.isClick&&Fu&&console.log("not allowed",t),!1;if(i.pointerId===void 0)return Fu&&console.error("Event without pointer can't be handled",i),!1;i.object=t;const n=t.parent,r=i.isClick??!1;let o=null;if(n&&n.isUI){const d=(i.isPressed||i.isClick)??!1;if(n[Bc]){const u=n[Bc].gameObject;if(u){if(!EP.isInteractable(u,this.out))return!1;o=this.out.canvasGroup??null,this.handleMeshUIIntersection(t,d),t=u}}}r&&Fu&&console.log(this.context.time.frame,t);const a=this.hoveredByID.get(i.pointerId),l=a==null?void 0:a.obj;l!==t&&l&&this.propagatePointerExit(l,a.data,t);const h=this.hoveredByID.get(i.pointerId);if(h?(h.obj=t,h.data=i):this.hoveredByID.set(i.pointerId,{obj:t,data:i}),i.isDown){const d=this.pressedByID.get(i.pointerId);d?(d.obj=t,d.data=i):this.pressedByID.set(i.pointerId,{obj:t,data:i,handlers:new Set})}return(o===null||o.interactable)&&this.handleMainInteraction(t,i,l??null),!0}propagate(t,i){for(;t;)$.foreachComponent(t,n=>{i(n)},!1),t=t.parent}handleMainInteraction(t,i,n){const r=this.pressedByID.get(i.pointerId),o=n!==t;let a=!0;switch(i.event.pointerType){case"mouse":case"touch":const l=this.context.input.getPointerPositionLastFrame(i.pointerId),c=this.context.input.getPointerPosition(i.pointerId);a=l&&!lt.approximately(l,c);break}this.propagate(t,l=>{var h;const c=l;c.interactable!==!1&&(!c.activeAndEnabled||!c.enabled||(c.onPointerEnter&&o&&this.handlePointerEnter(c,i),i.isDown&&c.onPointerDown&&(c.onPointerDown(i),r==null||r.handlers.add(c),this.handlePointerCapture(i,c)),c.onPointerMove&&(a&&c.onPointerMove(i),this.handlePointerCapture(i,c)),i.isUp&&(c.onPointerUp&&(this.invokeOnPointerUp(i,c),r==null||r.handlers.delete(c)),c.onPointerExit&&((h=i.event)==null?void 0:h.pointerType)===dP.Touch&&(this.handlePointerExit(c,i),this.hoveredByID.delete(i.pointerId))),i.isClick&&c.onPointerClick&&c.onPointerClick(i)))}),i.isUp&&(r==null||r.handlers.forEach(l=>{this.invokeOnPointerUp(i,l)}),this.pressedByID.delete(i.pointerId))}propagatePointerExit(t,i,n){this.propagate(t,r=>{if(!r.gameObject||r.destroyed)return;const o=r;if(o.onPointerExit||o.onPointerEnter){if(n&&this.isChild(n,r.gameObject))return;this.handlePointerExit(o,i)}})}invokeOnPointerUp(t,i){var n;(n=i.onPointerUp)==null||n.call(i,t),this.releasePointerCapture(t,i)}handlePointerEnter(t,i){t.onPointerEnter&&this.updatePointerState(t,i.pointerId,this.pointerEnterSymbol,!0)&&t.onPointerEnter(i),this.updatePointerState(t,i.pointerId,this.pointerExitSymbol,!1)}handlePointerExit(t,i){t.onPointerExit&&this.updatePointerState(t,i.pointerId,this.pointerExitSymbol,!0)&&t.onPointerExit(i),this.updatePointerState(t,i.pointerId,this.pointerEnterSymbol,!1)}updatePointerState(t,i,n,r){let o=t[n];if(r)return o&&o.includes(i)?!1:(o=o||[],o.push(i),t[n]=o,!0);{if(!o||!o.includes(i))return!1;const a=o.indexOf(i);return a!==-1&&o.splice(a,1),!0}}handlePointerCapture(t,i){if(t.z__pointer_ctured){t.z__pointer_ctured=!1;const n=t.pointerId;if(i.onPointerMove){const r=this._capturedPointer[n]||[];r.push(i),this._capturedPointer[n]=r}else Qe()&&!i.z__warned_no_pointermove&&(i.z__warned_no_pointermove=!0,console.warn("PointerCapture was requested but the component doesn't implement onPointerMove. It will not receive any pointer events"))}else t.z__pointer_cture_rleased&&(t.z__pointer_cture_rleased=!1,this.releasePointerCapture(t,i))}releasePointerCapture(t,i){const n=t.pointerId;if(this._capturedPointer[n]){const r=this._capturedPointer[n].indexOf(i);r!==-1&&(this._capturedPointer[n].splice(r,1),Fu&&console.log("released pointer capture",n,i,this._capturedPointer))}}invokePointerCapture(t){var i;if(t.event.type===es.PointerMove){const n=t.pointerId,r=this._capturedPointer[n];if(r){Fu&&console.log("Captured",n,r);for(let o=0;o<r.length;o++){const a=r[o];if(a.destroyed){r.splice(o,1),o--;continue}(i=a.onPointerMove)==null||i.call(a,t)}}}}isChild(t,i){return!t||!i?!1:t===i?!0:t.parent?this.isChild(t.parent,i):!1}handleMeshUiObjectWithoutShadowDom(t,i){return!t||!t.isUI?!0:this.handleMeshUIIntersection(t,i)}handleMeshUIIntersection(t,i){const n=Bf.updateState(t,i);return n&&this.currentActiveMeshUIComponents.push(n),n!==null}resetMeshUIStates(){if(this.context.input.getPointerPressedCount()>0&&Bf.resetLastSelected(),!(!this.currentActiveMeshUIComponents||this.currentActiveMeshUIComponents.length<=0)){for(let t=0;t<this.currentActiveMeshUIComponents.length;t++){const i=this.currentActiveMeshUIComponents[t];Bf.resetState(i)}this.currentActiveMeshUIComponents.length=0}}testIsVisible(t){return t?$.isActiveSelf(t)?this.testIsVisible(t.parent):!1:!0}};let nl=ud;p(nl,"_eventSystemMap",new Map),p(nl,"didSearchEventSystem",!1);class Bf{static markDirty(){this.needsUpdate=!0}static update(e,t,i=!1){if(i){e.update();return}const n=t.time.frameCount;for(const r of this.lastUpdateFrame)if(r.context===t){if(n===r.frame)return;r.frame=n;let o=this.needsUpdate||n<1;r.nextUpdate<=n&&(o=!0),o&&(Fu&&console.log("Update threemeshui"),this.needsUpdate=!1,r.nextUpdate=n+60,e.update());return}this.lastUpdateFrame=[{context:t,frame:n,nextUpdate:n+60}],e.update(),this.needsUpdate=!1}static updateState(e,t){let i=null;if(e&&(i=this.findBlockInParent(e),i&&i!==this.lastSelected)){if(i.interactable===!1)return null;this.needsUpdate=!0}return i}static resetLastSelected(){const e=this.lastSelected;e&&(this.lastSelected=null,this.resetState(e))}static resetState(e){e&&(this.needsUpdate=!0)}static findBlockInParent(e){return e?e.isBlock?e:this.findBlockInParent(e.parent):null}}p(Bf,"lastSelected",null),p(Bf,"lastUpdateFrame",[]),p(Bf,"needsUpdate",!1);var ENe=Object.defineProperty,RNe=Object.getOwnPropertyDescriptor,rs=(s,e,t,i)=>{for(var n=i>1?void 0:i?RNe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&ENe(e,t,n),n};const cE=ee("debugorbit"),uD=ee("freecam"),hE=ee("debugcamerafit"),dE=ee("smoothcam"),LNe={LEFT:"",UP:"",RIGHT:"",BOTTOM:""};let pD;class _S extends CustomEvent{constructor(e,t){super("target-reached",{detail:{controls:e,type:t}})}}class on extends ze{constructor(){super(...arguments);p(this,"autoTarget",!0);p(this,"autoFit",!1);p(this,"enableRotate",!0);p(this,"autoRotate",!1);p(this,"autoRotateSpeed",1);p(this,"minAzimuthAngle",1/0);p(this,"maxAzimuthAngle",1/0);p(this,"minPolarAngle",0);p(this,"maxPolarAngle",Math.PI);p(this,"enableKeys",!1);p(this,"enableDamping",!0);p(this,"dampingFactor",.1);p(this,"enableZoom",!0);p(this,"minZoom",0);p(this,"maxZoom",1/0);p(this,"zoomSpeed",1);p(this,"zoomToCursor",!1);p(this,"enablePan",!0);p(this,"lookAtConstraint",null);p(this,"lookAtConstraint01",1);p(this,"allowInterrupt",!0);p(this,"middleClickToFocus",!0);p(this,"doubleClickToFocus",!0);p(this,"clickBackgroundToFitScene",2);p(this,"debugLog",!1);p(this,"targetLerpDuration",1);p(this,"_controls",null);p(this,"_cameraObject",null);p(this,"_lookTargetLerpActive",!1);p(this,"_lookTargetStartPosition",new T);p(this,"_lookTargetEndPosition",new T);p(this,"_lookTargetLerp01",0);p(this,"_lookTargetLerpDuration",0);p(this,"_cameraLerpActive",!1);p(this,"_cameraStartPosition",new T);p(this,"_cameraEndPosition",new T);p(this,"_cameraLerp01",0);p(this,"_cameraLerpDuration",0);p(this,"_fovLerpActive",!1);p(this,"_fovLerpStartValue",0);p(this,"_fovLerpEndValue",0);p(this,"_fovLerp01",0);p(this,"_fovLerpDuration",0);p(this,"_inputs",0);p(this,"_enableTime",0);p(this,"_startedListeningToKeyEvents",!1);p(this,"_eventSystem");p(this,"_afterHandleInputFn");p(this,"_camera",null);p(this,"_syncedTransform");p(this,"_didSetTarget",0);p(this,"targetElement",null);p(this,"_activePointerEvents");p(this,"_lastTimeClickOnBackground",-1);p(this,"_clickOnBackgroundCount",0);p(this,"_onPointerDown",t=>{this._activePointerEvents.push(t)});p(this,"_onPointerUp",t=>{for(let i=this._activePointerEvents.length-1;i>=0;i--){const n=this._activePointerEvents[i];if(n.pointerId===t.pointerId&&n.button===t.button){this._activePointerEvents.splice(i,1);break}}if(this.clickBackgroundToFitScene>0&&t.isClick&&t.button===0){if(t.hasRay||t.intersections.push(...this.context.physics.raycast()),t.intersections.length<=0){const i=this.context.time.time-this._lastTimeClickOnBackground;this._lastTimeClickOnBackground=this.context.time.time,this.clickBackgroundToFitScene<=1||i<this.clickBackgroundToFitScene*.15?(this._clickOnBackgroundCount+=1,this._clickOnBackgroundCount>=this.clickBackgroundToFitScene-1&&this.fitCamera(this.context.scene.children,{immediate:!1})):this._clickOnBackgroundCount=0}cE&&console.log(this.clickBackgroundToFitScene,t.intersections.length,this._clickOnBackgroundCount)}});p(this,"_onPointerUpLate",t=>{this.doubleClickToFocus&&t.isDoubleClick&&!t.used&&this.setTargetFromRaycast()});p(this,"onControlsChangeStarted",()=>{this._syncedTransform&&this._syncedTransform.requestOwnership()});p(this,"_shouldDisable",!1);p(this,"__onPreRender",()=>{const t=this.context.pre_render_callbacks.indexOf(this.__onPreRender);t>=0&&this.context.pre_render_callbacks.splice(t,1),this.autoFit&&(this.autoFit=!1,this.fitCamera({centerCamera:"y",immediate:!0,objects:this.scene.children}))});p(this,"_haveAttachedKeyboardEvents",!1)}get isCameraController(){return!0}get controls(){return this._controls}get controllerObject(){return this._cameraObject}onStartInteraction(t){var i;(i=this.controls)==null||i.addEventListener("start",t)}get targetLerpSpeed(){return 5}set targetLerpSpeed(t){this.targetLerpDuration=1/t}awake(){cE&&console.debug("OrbitControls",this),this._didSetTarget=0,this._startedListeningToKeyEvents=!1}start(){this._eventSystem=nl.get(this.context)??void 0,this._eventSystem&&(this._afterHandleInputFn=this.afterHandleInput.bind(this),this._eventSystem.addEventListener(Gz.AfterHandleInput,this._afterHandleInputFn))}onDestroy(){var t,i;(t=this._controls)==null||t.dispose(),(i=this._eventSystem)==null||i.removeEventListener(Gz.AfterHandleInput,this._afterHandleInputFn)}onEnable(){this._didSetTarget=0,this._enableTime=this.context.time.time;const t=$.getComponent(this.gameObject,Cn);this._camera=t;let i=t==null?void 0:t.threeCamera;if(!i&&this.gameObject instanceof Xt&&(i=this.gameObject),i&&wV(i,this,!0),!this._controls&&i instanceof Xt){this._cameraObject=i;const n=this.targetElement??this.context.renderer.domElement,r=i==null?void 0:i.quaternion.clone();this._controls=new Roe(i,n),i==null||i.quaternion.copy(r),pD===void 0&&(pD={...this._controls.keys})}if(this._controls)if(uD&&(this.enablePan=!0,this.enableZoom=!0,this.middleClickToFocus=!0,exports.DeviceUtilities.isMobileDevice()&&(this.doubleClickToFocus=!0)),this._controls.addEventListener("start",this.onControlsChangeStarted),!this._startedListeningToKeyEvents&&this.enableKeys)this._startedListeningToKeyEvents=!0,this._controls.listenToKeyEvents(this.context.domElement);else try{this._controls.stopListenToKeyEvents()}catch{}this._syncedTransform=$.getComponent(this.gameObject,$d)??void 0,this.context.pre_render_callbacks.push(this.__onPreRender),this._activePointerEvents=[],this.context.input.addEventListener("pointerdown",this._onPointerDown,{queue:Nl.Early}),this.context.input.addEventListener("pointerup",this._onPointerUp,{queue:Nl.Early}),this.context.input.addEventListener("pointerup",this._onPointerUpLate,{queue:Nl.Late})}onDisable(){var t;if((t=this._camera)!=null&&t.threeCamera&&wV(this._camera.threeCamera,this,!1),this._controls){this._controls.enabled=!1,this._controls.autoRotate=!1,this._controls.removeEventListener("start",this.onControlsChangeStarted);try{this._controls.stopListenToKeyEvents()}catch{}this._startedListeningToKeyEvents=!1}this._activePointerEvents.length=0,this.context.input.removeEventListener("pointerdown",this._onPointerDown),this.context.input.removeEventListener("pointerup",this._onPointerUp),this.context.input.removeEventListener("pointerup",this._onPointerUpLate)}afterHandleInput(t){t.detail.args.pointerId===0&&(t.detail.args.isDown?this._controls&&this._eventSystem&&(this._shouldDisable=this._eventSystem.hasActiveUI):(!t.detail.args.isPressed||t.detail.args.isUp)&&(this._shouldDisable=!1))}onBeforeRender(){var i,n,r,o;if(!this._controls)return;if(this._cameraObject!==this.context.mainCamera){this._controls.enabled=!1;return}if(this._controls.enabled=!0,(this.context.input.getPointerDown(1)||this.context.input.getPointerDown(2)||this.context.input.mouseWheelChanged||this.context.input.getPointerPressed(0)&&((i=this.context.input.getPointerPositionDelta(0))!=null&&i.length())||0>.1)&&(this._inputs+=1),this._inputs>0&&this.allowInterrupt&&(this.enableRotate&&(this.autoRotate=!1),this._cameraLerpActive=!1,this._lookTargetLerpActive=!1),this._inputs=0,this.autoTarget&&this._didSetTarget++===0){const a=$.getComponent(this.gameObject,Cn);if(a&&!this.setLookTargetFromConstraint()){this.debugLog&&console.log("NO TARGET");const l=$t(a.threeCamera),c=Math.max(.01,l.length()),h=new T(0,0,-c).applyMatrix4(a.threeCamera.matrixWorld);this.setLookTargetPosition(h,!0)}if(!this.setLookTargetFromConstraint()){const l=new qd;l.screenPoint=new Q(0,0),l.lineThreshold=.1;const c=this.context.physics.raycast(l);c.length>0&&this.setLookTargetPosition(c[0].point,!0),hE&&console.log("OrbitControls hits",...c)}}if(this.middleClickToFocus&&this.context.input.getPointerClicked(1)&&this.setTargetFromRaycast(),this._lookTargetLerpActive||this._cameraLerpActive||this._fovLerpActive){if(this._cameraLerpActive&&this._cameraObject)if(this._cameraLerp01+=this.context.time.deltaTime/this._cameraLerpDuration,this._cameraLerp01>=1)this._cameraObject.position.copy(this._cameraEndPosition),this._cameraLerpActive=!1,this.dispatchEvent(new _S(this,"camera"));else{const a=lt.easeInOutCubic(this._cameraLerp01);this._cameraObject.position.lerpVectors(this._cameraStartPosition,this._cameraEndPosition,a)}if(this._lookTargetLerpActive)if(this._lookTargetLerp01+=this.context.time.deltaTime/this._lookTargetLerpDuration,this._lookTargetLerp01>=1)this._controls.target.copy(this._lookTargetEndPosition),this._lookTargetLerpActive=!1,this.dispatchEvent(new _S(this,"lookat"));else{const a=lt.easeInOutCubic(this._lookTargetLerp01);this._controls.target.lerpVectors(this._lookTargetStartPosition,this._lookTargetEndPosition,a)}if(this._fovLerpActive&&this._cameraObject){const a=this._cameraObject;if(this._fovLerp01+=this.context.time.deltaTime/this._fovLerpDuration,this._fovLerp01>=1)a.fov=this._fovLerpEndValue,this._fovLerpActive=!1;else{const l=lt.easeInOutCubic(this._fovLerp01);a.fov=lt.lerp(this._fovLerpStartValue,this._fovLerpEndValue,l)}a.updateProjectionMatrix()}}if(this._controls){if(this.debugLog&&(this._controls.domElement=this.context.renderer.domElement),this._controls.enabled=!this._shouldDisable&&this._camera===this.context.mainCameraComponent&&!this.context.isInXR&&!this._activePointerEvents.some(a=>a.used),this._controls.keys=this.enableKeys?pD:LNe,this._controls.autoRotate=this.autoRotate,this._controls.autoRotateSpeed=this.autoRotateSpeed,this._controls.enableZoom=this.enableZoom,this._controls.zoomSpeed=this.zoomSpeed,this._controls.zoomToCursor=this.zoomToCursor,this._controls.enableDamping=this.enableDamping,this._controls.dampingFactor=this.dampingFactor,this._controls.enablePan=this.enablePan,this._controls.enableRotate=this.enableRotate,this._controls.minAzimuthAngle=this.minAzimuthAngle,this._controls.maxAzimuthAngle=this.maxAzimuthAngle,this._controls.minPolarAngle=this.minPolarAngle,this._controls.maxPolarAngle=this.maxPolarAngle,uD||(((r=(n=this._camera)==null?void 0:n.threeCamera)==null?void 0:r.type)==="PerspectiveCamera"?(this._controls.minDistance=this.minZoom,this._controls.maxDistance=this.maxZoom,this._controls.minZoom=0,this._controls.maxZoom=1/0):(this._controls.minDistance=0,this._controls.maxDistance=1/0,this._controls.minZoom=this.minZoom,this._controls.maxZoom=this.maxZoom)),typeof dE=="number"||dE===!0){this._controls.enableDamping=!0;const a=typeof dE=="number"?dE:.99;this._controls.dampingFactor=Math.max(.001,1-Math.min(1,a))}this.allowInterrupt||(this._lookTargetLerpActive&&(this._controls.enablePan=!1),this._cameraLerpActive&&(this._controls.enableRotate=!1,this._controls.autoRotate=!1),(this._lookTargetLerpActive||this._cameraLerpActive)&&(this._controls.enableZoom=!1)),this.context.isInXR||(!uD&&((o=this.lookAtConstraint)!=null&&o.locked)&&this.setLookTargetFromConstraint(0,this.lookAtConstraint01),this._controls.update(this.context.time.deltaTime),cE&&Mt.DrawWireSphere(this._controls.target,.1,65280))}}setCameraAndLookTarget(t){if(!t||!(t instanceof ye))return;const i=$t(t),n=gO(t);this.setTargetFromRaycast(new Fa(i,n)),this.setCameraTargetPosition(i)}setCameraTargetPosition(t,i=!1){var n;t&&(t instanceof ye&&(t=$t(t)),this._cameraEndPosition||(this._cameraEndPosition=new T),this._cameraEndPosition.copy(t),i===!0?(this._cameraLerpActive=!1,this._cameraObject&&this._cameraObject.position.copy(this._cameraEndPosition)):this._cameraObject&&(this._cameraLerpActive=!0,this._cameraLerp01=0,this._cameraStartPosition.copy((n=this._cameraObject)==null?void 0:n.position),typeof i=="number"?this._cameraLerpDuration=i:this._cameraLerpDuration=this.targetLerpDuration))}get cameraLerpActive(){return this._cameraLerpActive}stopCameraLerp(){this._cameraLerpActive=!1}setFieldOfView(t,i=!1){var r;if(!this._controls||typeof t!="number")return;const n=(r=this._camera)==null?void 0:r.threeCamera;n&&(i===!0?n.fov=t:(this._fovLerpActive=!0,this._fovLerp01=0,this._fovLerpStartValue=n.fov,this._fovLerpEndValue=t,typeof i=="number"?this._fovLerpDuration=i:this._fovLerpDuration=this.targetLerpDuration))}setLookTargetPosition(t=null,i=!1){this._controls&&t&&(t instanceof ye&&(t=$t(t)),this._lookTargetEndPosition.copy(t),this._didSetTarget++,cE&&(console.warn("OrbitControls: setLookTargetPosition",t,i),Mt.DrawWireSphere(this._lookTargetEndPosition,.2,16711680,2)),i===!0?this._controls.target.copy(this._lookTargetEndPosition):(this._lookTargetLerpActive=!0,this._lookTargetLerp01=0,this._lookTargetStartPosition.copy(this._controls.target),typeof i=="number"?this._lookTargetLerpDuration=i:this._lookTargetLerpDuration=this.targetLerpDuration))}get lookTargetLerpActive(){return this._lookTargetLerpActive}stopLookTargetLerp(){this._lookTargetLerpActive=!1}setLookTargetFromConstraint(t=0,i=1){var r;if(!this._controls)return!1;const n=(r=this.lookAtConstraint)==null?void 0:r.sources;if(n&&n.length>0){const o=n[t];if(o)return o.getWorldPosition(this._lookTargetEndPosition),this.lerpLookTarget(this._lookTargetEndPosition,i),!0}return!1}lerpTarget(t,i){return this.lerpLookTarget(t,i)}lerpLookTarget(t,i){this._controls&&(i>=1?this._controls.target.copy(t):this._controls.target.lerp(t,i))}setTargetFromRaycast(t){if(!this.controls)return;const i=t?this.context.physics.raycastFromRay(t):this.context.physics.raycast();for(const n of i)if(n.distance>0&&$.isActiveInHierarchy(n.object)){const r=L5(n.object);if(r){const o=r.canvas;if(o!=null&&o.screenspace)break}this.setLookTargetPosition(n.point);break}}fitCamera(t,i){var B,P;if(this.context.isInXR)return;let n;if(Array.isArray(t)?n=t:t&&"type"in t?n=t.children:t&&"objects"in t&&(n=t==null?void 0:t.objects,i=t),n&&!Array.isArray(n)&&(n=n.children),(!Array.isArray(n)||n&&n.length<=0)&&(n=this.context.scene.children),!Array.isArray(n)||n.length<=0){console.warn("No objects to fit camera to...");return}const r=this._cameraObject,o=this._controls;if(!r||!o){console.warn("No camera or controls found to fit camera to objects...");return}i||(i={});const{immediate:a=!1,centerCamera:l="y",cameraNearFar:c="auto",fitOffset:h=1.1,fov:d=r==null?void 0:r.fov}=i,u=new T,f=new T,m=ec(n,void 0,(P=(B=this._camera)==null?void 0:B.threeCamera)==null?void 0:P.layers),g=m.clone();r.updateMatrixWorld(),r.updateProjectionMatrix(),m.getCenter(f);const A=new T;if(m.getSize(A),m.applyMatrix4(r.matrixWorldInverse),m.getSize(u),m.setFromCenterAndSize(f,u),Number.isNaN(u.x)||Number.isNaN(u.y)||Number.isNaN(u.z)){console.warn("Camera fit size resultet in NaN",r,m,[...n]);return}if(u.length()<=1e-10){hE&&console.warn("Camera fit size is zero",m,[...n]);return}const y=i.fov||r.fov,b=2*Math.atan(Math.tan(y*Math.PI/360/2)*r.aspect)/Math.PI*360,x=u.y/(2*Math.atan(Math.PI*y/360)),v=u.x/(2*Math.atan(Math.PI*b/360)),_=h*Math.max(x,v)+u.z/2;hE&&console.log("Fit camera to objects",{fitHeightDistance:x,fitWidthDistance:v,distance:_,verticalFov:y,horizontalFov:b}),this.maxZoom=_*10,this.minZoom=_*.01;const C=.05,S=f.clone();if(S.y-=u.y*C,this.setLookTargetPosition(S,a),this.setFieldOfView(i.fov,a),this.autoTarget=!1,c==null||c=="auto"){const k=$.findObjectOfType(ou),X=k?k.radius:0,F=Math.max(A.x,A.y,A.z,X);r.near=_/100,r.far=F+_*10,k&&(this.maxZoom=Math.max(Math.min(this.maxZoom,X*.5),_))}const M=o.getDistance();M<this.minZoom&&(this.minZoom=M*.9),M>this.maxZoom&&(this.maxZoom=M*1.1),r.updateMatrixWorld(),r.updateProjectionMatrix();const L=$t(r),w=f.clone();w.sub(L),l==="y"&&(w.y=0),w.normalize(),w.multiplyScalar(_),l==="y"&&(w.y+=-C*4*_);let E=f.clone().sub(w);if(r.parent&&(E=r.parent.worldToLocal(E)),this.setCameraTargetPosition(E,a),hE){const k=new gX(m);this.context.scene.add(k),bO(k,$1(r)),setTimeout(()=>{this.context.scene.remove(k)},1e4),Mt.DrawWireBox3(g,65280,10),this._haveAttachedKeyboardEvents||(this._haveAttachedKeyboardEvents=!0,document.body.addEventListener("keydown",X=>{if(X.code==="KeyF"){let F;this._cameraObject instanceof Xt&&(F=Math.random()*Math.random()*170+10),this.fitCamera({objects:n,fitOffset:h,immediate:!1,fov:F})}X.code==="KeyV"&&this._cameraObject instanceof Xt&&(this._cameraObject.fov=60)}))}o.update()}}rs([I()],on.prototype,"autoTarget",2);rs([I()],on.prototype,"autoFit",2);rs([I()],on.prototype,"enableRotate",2);rs([I()],on.prototype,"autoRotate",2);rs([I()],on.prototype,"autoRotateSpeed",2);rs([I()],on.prototype,"minAzimuthAngle",2);rs([I()],on.prototype,"maxAzimuthAngle",2);rs([I()],on.prototype,"minPolarAngle",2);rs([I()],on.prototype,"maxPolarAngle",2);rs([I()],on.prototype,"enableKeys",2);rs([I()],on.prototype,"enableDamping",2);rs([I()],on.prototype,"dampingFactor",2);rs([I()],on.prototype,"enableZoom",2);rs([I()],on.prototype,"minZoom",2);rs([I()],on.prototype,"maxZoom",2);rs([I()],on.prototype,"zoomSpeed",2);rs([I()],on.prototype,"enablePan",2);rs([I(SA)],on.prototype,"lookAtConstraint",2);rs([I()],on.prototype,"lookAtConstraint01",2);rs([I()],on.prototype,"allowInterrupt",2);rs([I()],on.prototype,"middleClickToFocus",2);rs([I()],on.prototype,"doubleClickToFocus",2);rs([I()],on.prototype,"clickBackgroundToFitScene",2);rs([I()],on.prototype,"targetLerpDuration",2);var BNe=Object.defineProperty,PNe=Object.getOwnPropertyDescriptor,Va=(s,e,t,i)=>{for(var n=i>1?void 0:i?PNe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&BNe(e,t,n),n},$f=(s=>(s[s.None=0]="None",s[s.Skybox=1]="Skybox",s[s.SolidColor=2]="SolidColor",s[s.Uninitialized=4]="Uninitialized",s))($f||{});const Cf=ee("debugcam"),dY=ee("debugscreenpointtoray");var nR;const CC=(nR=class extends ze{constructor(){super(...arguments);p(this,"_nearClipPlane",.1);p(this,"_farClipPlane",1e3);p(this,"orthographic",!1);p(this,"orthographicSize",5);p(this,"ARBackgroundAlpha",0);p(this,"_cullingMask",4294967295);p(this,"_backgroundBlurriness");p(this,"_backgroundIntensity");p(this,"_backgroundRotation");p(this,"_environmentIntensity");p(this,"_targetTexture",null);p(this,"_backgroundColor");p(this,"_fov");p(this,"_cam",null);p(this,"_clearFlags",2);p(this,"_skybox");p(this,"_frustum");p(this,"_projScreenMatrix",new ce)}get isCamera(){return!0}get aspect(){return this._cam instanceof Xt?this._cam.aspect:this.context.domWidth/this.context.domHeight}set aspect(e){this._cam instanceof Xt&&this._cam.aspect!==e&&(this._cam.aspect=e,this._cam.updateProjectionMatrix())}get fieldOfView(){return this._cam instanceof Xt?this._cam.fov:this._fov}set fieldOfView(e){const t=this.fieldOfView!=e;if(this._fov=e,t&&this._cam&&this._cam instanceof Xt){if(this._fov===void 0){console.warn("Can not set undefined fov on PerspectiveCamera");return}this._cam.fov=this._fov,this._cam.updateProjectionMatrix()}}get nearClipPlane(){return this._nearClipPlane}set nearClipPlane(e){const t=this._nearClipPlane!=e;this._nearClipPlane=e,this._cam&&(t||this._cam.near!=e)&&(this._cam.near=e,this._cam.updateProjectionMatrix())}applyClippingPlane(){this._cam&&(this._cam.near=this._nearClipPlane,this._cam.far=this._farClipPlane,this._cam.updateProjectionMatrix())}get farClipPlane(){return this._farClipPlane}set farClipPlane(e){const t=this._farClipPlane!=e;this._farClipPlane=e,this._cam&&(t||this._cam.far!=e)&&(this._cam.far=e,this._cam.updateProjectionMatrix())}get clearFlags(){return this._clearFlags}set clearFlags(e){e!==this._clearFlags&&(this._clearFlags=e,this.applyClearFlagsIfIsActiveCamera())}set cullingMask(e){this._cullingMask=e,this._cam&&(this._cam.layers.mask=e)}get cullingMask(){return this._cam?this._cam.layers.mask:this._cullingMask}set cullingLayer(e){this.cullingMask=(1<<e|0)>>>0}set backgroundBlurriness(e){e!==this._backgroundBlurriness&&(e===void 0?this._backgroundBlurriness=void 0:this._backgroundBlurriness=Math.min(Math.max(e,0),1),this.applyClearFlagsIfIsActiveCamera())}get backgroundBlurriness(){return this._backgroundBlurriness}set backgroundIntensity(e){e!==this._backgroundIntensity&&(e===void 0?this._backgroundIntensity=void 0:this._backgroundIntensity=Math.min(Math.max(e,0),10),this.applyClearFlagsIfIsActiveCamera())}get backgroundIntensity(){return this._backgroundIntensity}set backgroundRotation(e){e!==this._backgroundRotation&&(e===void 0?this._backgroundRotation=void 0:this._backgroundRotation=e,this.applyClearFlagsIfIsActiveCamera())}get backgroundRotation(){return this._backgroundRotation}set environmentIntensity(e){this._environmentIntensity=e}get environmentIntensity(){return this._environmentIntensity}get backgroundColor(){return this._backgroundColor??null}set backgroundColor(e){if(e){if(this._backgroundColor)this._backgroundColor.copy(e);else{if(!e.clone)return;this._backgroundColor=e.clone()}e.alpha===void 0&&(this._backgroundColor.alpha=1),this.applyClearFlagsIfIsActiveCamera()}}set targetTexture(e){this._targetTexture=e}get targetTexture(){return this._targetTexture}get cam(){return this.threeCamera}get threeCamera(){return this.activeAndEnabled&&this.buildCamera(),this._cam}screenPointToRay(e,t,i){const n=this.threeCamera,r=CC._origin;r.set(e,t,-1),this.context.input.convertScreenspaceToRaycastSpace(r),dY&&console.log("screenPointToRay",e.toFixed(2),t.toFixed(2),"now:",r.x.toFixed(2),r.y.toFixed(2),"isInXR:"+this.context.isInXR),r.z=-1,r.unproject(n);const o=CC._direction.set(r.x,r.y,r.z),a=$t(n);return o.sub(a),o.normalize(),i?(i.set(a,o),i):new Fa(a.clone(),o.clone())}getFrustum(){return this._frustum||(this._frustum=new H0,this.updateFrustum()),this._frustum}updateFrustum(){this._frustum||(this._frustum=new H0),this._frustum.setFromProjectionMatrix(this.getProjectionScreenMatrix(this._projScreenMatrix,!0),this.context.renderer.coordinateSystem)}getProjectionScreenMatrix(e,t){return t&&this._projScreenMatrix.multiplyMatrices(this.threeCamera.projectionMatrix,this.threeCamera.matrixWorldInverse),e===this._projScreenMatrix?e:e.copy(this._projScreenMatrix)}awake(){dY&&window.addEventListener("pointerdown",e=>{const t=e.clientX,i=e.clientY;console.log("touch",t.toFixed(2),i.toFixed(2));const n=this.screenPointToRay(t,i),r="#"+Math.floor(Math.random()*16777215).toString(16);Mt.DrawRay(n.origin,n.direction,r,10)})}onEnable(){Cf&&console.log(`Camera enabled: "${this.name}". ClearFlags=${$f[this._clearFlags]}`,this),this.buildCamera(),(this.tag=="MainCamera"||!this.context.mainCameraComponent)&&(this.context.setCurrentCamera(this),kNe(this)),this.applyClearFlagsIfIsActiveCamera({applySkybox:!0})}onDisable(){this.context.removeCamera(this)}onBeforeRender(){if(this._cam&&(this._frustum&&this.updateFrustum(),this._clearFlags===2&&this.applyClearFlagsIfIsActiveCamera(),this._targetTexture)){this.context.isManagedExternally&&(this._warnedAboutExternalRenderer||(this._warnedAboutExternalRenderer=!0,console.warn("Rendering with external renderer is not supported yet. This may not work or throw errors. Please remove the the target texture from your camera: "+this.name,this.targetTexture))),this.context.composer;const e=this.context.renderer;if(e){const t=this.context.mainCameraComponent;this.applyClearFlags(),this._targetTexture.render(this.context.scene,this._cam,e),t==null||t.applyClearFlags()}}}buildCamera(){if(this._cam)return;const e=this.gameObject.isCamera;let t=null;if(e?(t=this.gameObject,t==null||t.layers.enableAll(),t instanceof Xt&&(this._fov=t.fov)):t=this.gameObject.children[0],t&&t.isCamera)t instanceof Xt&&(this._fov&&(t.fov=this._fov),t.near=this._nearClipPlane,t.far=this._farClipPlane,t.updateProjectionMatrix());else if(!this.orthographic)t=new Xt(this.fieldOfView,window.innerWidth/window.innerHeight,this._nearClipPlane,this._farClipPlane),this.fieldOfView&&(t.fov=this.fieldOfView),this.gameObject.add(t);else{const i=this.orthographicSize*100;t=new zh(window.innerWidth/-i,window.innerWidth/i,window.innerHeight/i,window.innerHeight/-i,this._nearClipPlane,this._farClipPlane),this.gameObject.add(t)}this._cam=t,this._cam.layers.mask=this._cullingMask,this.tag=="MainCamera"&&this.context.setCurrentCamera(this)}applyClearFlagsIfIsActiveCamera(e){this.context.mainCameraComponent===this&&this.applyClearFlags(e)}applyClearFlags(e){var t;if(!this._cam){Cf&&console.log("Camera does not exist (apply clear flags)");return}if(this.fieldOfView=this._fov,Cf){const i=`Camera "${this.name}" clear flags: ${$f[this._clearFlags]}`;console.debug(i)}switch(this._clearFlags){case 0:return;case 1:if(CC.backgroundShouldBeTransparent(this.context)&&(!this.ARBackgroundAlpha||this.ARBackgroundAlpha<.001)){this.context.scene.background=null,this.context.renderer.setClearColor(0,0);return}(!this.scene.background||!this._skybox||(e==null?void 0:e.applySkybox)===!0)&&this.applySceneSkybox(),this._backgroundBlurriness!==void 0?this.context.scene.backgroundBlurriness=this._backgroundBlurriness:Cf&&console.warn(`Camera "${this.name}" has no background blurriness`),this._backgroundIntensity!==void 0&&(this.context.scene.backgroundIntensity=this._backgroundIntensity),this._backgroundRotation!==void 0?this.context.scene.backgroundRotation=this._backgroundRotation:Cf&&console.warn(`Camera "${this.name}" has no background intensity`);break;case 2:if(this._backgroundColor){let i=this._backgroundColor.alpha;CC.backgroundShouldBeTransparent(this.context)&&(i=this.ARBackgroundAlpha??0),this.context.scene.background=null,(t=this.context.xr)!=null&&t.isVR?this.context.renderer.setClearColor(Mie(this._backgroundColor).convertLinearToSRGB()):this.context.renderer.setClearColor(this._backgroundColor,i)}else Cf&&console.warn(`Camera "${this.name}" has no background color`,this);break;case 4:this.context.scene.background=null,this.context.renderer.setClearColor(0,0);break}}applySceneSkybox(){this._skybox||(this._skybox=new GNe(this)),this._skybox.apply()}static backgroundShouldBeTransparent(e){var r,o,a,l;const t=(r=e.renderer.xr)==null?void 0:r.getSession();if(!t)return!1;if(typeof t._transparent=="boolean")return t._transparent;const i=t.environmentBlendMode;Cf&&is("Environment blend mode: "+i+" on "+navigator.userAgent);let n=i==="additive"||i==="alpha-blend";return e.isInAR&&i==="opaque"&&((o=navigator.userAgent)!=null&&o.includes("OculusBrowser")||(a=navigator.userAgent)!=null&&a.includes("Mozilla")&&((l=navigator.userAgent)!=null&&l.includes("Mobile WebXRViewer/v2")))&&(n=!0),t._transparent=n,n}},p(nR,"_origin",new T),p(nR,"_direction",new T),nR);let Cn=CC;Va([I()],Cn.prototype,"aspect",1);Va([I()],Cn.prototype,"fieldOfView",1);Va([I()],Cn.prototype,"nearClipPlane",1);Va([I()],Cn.prototype,"farClipPlane",1);Va([I()],Cn.prototype,"clearFlags",1);Va([I()],Cn.prototype,"orthographic",2);Va([I()],Cn.prototype,"orthographicSize",2);Va([I()],Cn.prototype,"ARBackgroundAlpha",2);Va([I()],Cn.prototype,"cullingMask",1);Va([I()],Cn.prototype,"backgroundBlurriness",1);Va([I()],Cn.prototype,"backgroundIntensity",1);Va([I(Xi)],Cn.prototype,"backgroundRotation",1);Va([I()],Cn.prototype,"environmentIntensity",1);Va([I(hn)],Cn.prototype,"backgroundColor",1);Va([I(jf)],Cn.prototype,"targetTexture",1);class GNe{constructor(e){p(this,"_camera");p(this,"_skybox");this._camera=e}get context(){var e;return(e=this._camera)==null?void 0:e.context}apply(){this._skybox=this.context.lightmaps.tryGetSkybox(this._camera.sourceId),this._skybox?this.context.scene.background!==this._skybox&&(Cf&&console.log(`Camera "${this._camera.name}" set skybox`,this._camera,this._skybox),this._skybox.mapping=wo,this.context.scene.background=this._skybox):this._did_log_failed_to_find_skybox||(this._did_log_failed_to_find_skybox=!0,console.warn(`Camera "${this._camera.name}" has no skybox texture. ${this._camera.sourceId}`))}}function kNe(s){ee("freecam")&&s.context.mainCameraComponent===s&&$.getOrAddComponent(s.gameObject,on)}class em extends ze{constructor(){super(...arguments);p(this,"_listener",null);p(this,"onInteraction",()=>{this.destroyed||this.listener==null||this.addListenerIfItExists()})}get listener(){return this._listener==null&&(this._listener=new J8),this._listener}onEnable(){Lh.registerWaitForInteraction(this.onInteraction),this.addListenerIfItExists()}onDisable(){Lh.unregisterWaitForInteraction(this.onInteraction),this.removeListenerIfItExists()}addListenerIfItExists(){const t=this._listener;if(!t||t!=null&&t.parent)return;const i=this.context.mainCameraComponent||$.getComponentInParent(this.gameObject,Cn);i!=null&&i.threeCamera?i.threeCamera.add(t):this.gameObject.add(t),t.filter?(t.gain.connect(t.filter),t.filter.connect(t.context.destination)):t.gain.connect(t.context.destination)}removeListenerIfItExists(){const t=this._listener;t&&(t.removeFromParent(),t.filter&&t.filter.disconnect(),t.gain&&t.gain.disconnect())}}var NNe=Object.defineProperty,DNe=Object.getOwnPropertyDescriptor,Wh=(s,e,t,i)=>{for(var n=i>1?void 0:i?DNe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&NNe(e,t,n),n};const Ko=ee("debugaudio"),wf=class extends ze{constructor(){super(...arguments);p(this,"clip","");p(this,"playOnAwake",!1);p(this,"preload",!1);p(this,"playInBackground",!0);p(this,"_spatialBlend",0);p(this,"_minDistance",1);p(this,"_maxDistance",100);p(this,"_volume",1);p(this,"rollOffMode",0);p(this,"_loop",!1);p(this,"sound",null);p(this,"helper",null);p(this,"wasPlaying",!1);p(this,"audioLoader",null);p(this,"shouldPlay",!1);p(this,"_lastClipStartedLoading",null);p(this,"_audioElement",null);p(this,"onVisibilityChanged",()=>{switch(document.visibilityState){case"hidden":(this.playInBackground===!1||exports.DeviceUtilities.isMobileDevice())&&(this.wasPlaying=this.isPlaying,this.isPlaying&&this.pause());break;case"visible":Ko&&console.log("visible",this.enabled,this.playOnAwake,!this.isPlaying,wf.userInteractionRegistered,this.wasPlaying),this.enabled&&this.playOnAwake&&!this.isPlaying&&wf.userInteractionRegistered&&this.wasPlaying&&this.play();break}});p(this,"onApplicationMuteChanged",()=>{var e,t;this.context.application.muted?(e=this.sound)==null||e.setVolume(0):(t=this.sound)==null||t.setVolume(this.volume)});p(this,"createAudio",e=>{Ko&&console.log("AudioBuffer finished loading",e);const t=this.Sound;if(!t){Ko&&console.warn("Failed getting sound?",this.name);return}t.isPlaying&&t.stop(),e&&t.setBuffer(e),t.loop=this._loop,this.context.application.muted?t.setVolume(0):t.setVolume(this.volume),t.autoplay=this.shouldPlay&&wf.userInteractionRegistered,this.applySpatialDistanceSettings(),t.isPlaying&&t.stop(),wf.registerWaitForAllowAudio(this.__onAllowAudioCallback)});p(this,"__onAllowAudioCallback",()=>{this.shouldPlay&&this.play()});p(this,"_lastContextTime",0);p(this,"_hasEnded",!0);p(this,"_needUpdateSpatialDistanceSettings",!1)}static get userInteractionRegistered(){return Lh.userInteractionRegistered}static registerWaitForAllowAudio(e){Lh.registerWaitForInteraction(e)}get isPlaying(){var e;return((e=this.sound)==null?void 0:e.isPlaying)??!1}get duration(){var e,t;return(t=(e=this.sound)==null?void 0:e.buffer)==null?void 0:t.duration}get time01(){var t;const e=this.duration;return e&&this.sound?((t=this.sound)==null?void 0:t.context.currentTime)/e:0}set time01(e){const t=this.duration;t&&this.sound&&(this.time=e*t)}get time(){var e,t;return(e=this.sound)!=null&&e.source?((t=this.sound.source)==null?void 0:t.context.currentTime)-this._lastContextTime+this.sound.offset:0}set time(e){if(this.sound){if(e===this.sound.offset)return;const t=this.isPlaying;this.stop(),this.sound.offset=e,t&&this.play()}}get loop(){return this.sound&&(this._loop=this.sound.getLoop()),this._loop}set loop(e){this._loop=e,this.sound&&this.sound.setLoop(e)}get spatialBlend(){return this._spatialBlend}set spatialBlend(e){e!==this._spatialBlend&&(this._spatialBlend=e,this._needUpdateSpatialDistanceSettings=!0)}get minDistance(){return this._minDistance}set minDistance(e){this._minDistance!==e&&(this._minDistance=e,this._needUpdateSpatialDistanceSettings=!0)}get maxDistance(){return this._maxDistance}set maxDistance(e){this._maxDistance!==e&&(this._maxDistance=e,this._needUpdateSpatialDistanceSettings=!0)}get volume(){return this._volume}set volume(e){this._volume=e,this.sound&&!this.context.application.muted&&(Ko&&console.log(this.name,"audio set volume",e),this.sound.setVolume(e))}set pitch(e){this.sound&&this.sound.setPlaybackRate(e)}get pitch(){return this.sound?this.sound.getPlaybackRate():1}get Sound(){var e;if(!this.sound&&wf.userInteractionRegistered){let t=$.getComponent(this.context.mainCamera,em)??$.findObjectOfType(em,this.context);!t&&this.context.mainCamera&&(t=$.addComponent(this.context.mainCamera,em)),t!=null&&t.listener?(this.sound=new j8(t.listener),(e=this.gameObject)==null||e.add(this.sound)):Ko&&console.warn("No audio listener found in scene - can not play audio")}return this.sound}get ShouldPlay(){return this.shouldPlay}get audioContext(){var e;return(e=this.sound)==null?void 0:e.context}awake(){Ko&&console.log(this),this.audioLoader=new ML,this.playOnAwake&&(this.shouldPlay=!0),this.preload&&typeof this.clip=="string"&&this.audioLoader.load(this.clip,this.createAudio,()=>{},console.error)}onEnable(){this.sound&&this.gameObject.add(this.sound),wf.userInteractionRegistered?this.playOnAwake&&this.context.application.isVisible&&this.play():wf.registerWaitForAllowAudio(()=>{this.enabled&&!this.destroyed&&this.shouldPlay&&this.onNewClip(this.clip)}),globalThis.addEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.addEventListener(c2.MuteChanged,this.onApplicationMuteChanged)}onDisable(){globalThis.removeEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.removeEventListener(c2.MuteChanged,this.onApplicationMuteChanged),this.pause()}applySpatialDistanceSettings(){const e=this.sound;if(!e)return;this._needUpdateSpatialDistanceSettings=!1;const t=lt.lerp(10*this._maxDistance/Math.max(1e-4,this.spatialBlend),this._minDistance,this.spatialBlend);switch(Ko&&console.log(this.name,this._minDistance,this._maxDistance,this.spatialBlend,"Ref distance="+t),e.setRefDistance(t),e.setMaxDistance(Math.max(.01,this._maxDistance)),this.rollOffMode){case 0:e.setDistanceModel("exponential");break;case 1:e.setDistanceModel("linear");break;case 2:console.warn("Custom rolloff for AudioSource is not supported: "+this.name);break}this.spatialBlend>0?Ko&&!this.helper&&(this.helper=new Nke(e,e.getRefDistance()),e.add(this.helper)):this.helper&&this.helper.parent&&this.helper.removeFromParent()}async onNewClip(e){if(e&&(this.clip=e),typeof e=="string")if(Ko&&console.log(e),e.endsWith(".mp3")||e.endsWith(".wav")){if(this.audioLoader||(this.audioLoader=new ML),this.shouldPlay=!0,this._lastClipStartedLoading===e){Ko&&console.log("Is currently loading:",this._lastClipStartedLoading,this);return}this._lastClipStartedLoading=e,Ko&&console.log("load audio",e);const t=await this.audioLoader.loadAsync(e).catch(console.error);this._lastClipStartedLoading=null,t&&this.createAudio(t)}else console.warn("Unsupported audio clip type",e);else this.shouldPlay=!0,this.createAudio()}play(e=void 0){var i,n,r;!e&&this.clip&&(e=this.clip),e!==void 0&&typeof e!="string"&&!(e instanceof MediaStream)&&(Qe()&&console.warn("Called play on AudioSource with unknown argument type:",e+`
Using the assigned clip instead:`,this.clip),e=this.clip);let t=!this.sound||e&&e!==this.clip;if(typeof e=="string"&&!this.audioLoader&&(t=!0),(e instanceof MediaStream||typeof e=="string")&&(this.clip=e),t){this.shouldPlay=!0,this.onNewClip(e);return}if(this.shouldPlay=!0,this._hasEnded=!1,Ko&&console.log("play",(i=this.sound)==null?void 0:i.getVolume(),this.sound),this.sound&&!this.sound.isPlaying){const o=this.context.application.muted;o&&this.sound.setVolume(0),(n=this.gameObject)==null||n.add(this.sound),this.clip instanceof MediaStream?(this.sound.setMediaStreamSource(this.clip),this._audioElement||(this._audioElement=document.createElement("audio"),this._audioElement.style.display="none"),this._audioElement.parentNode||(r=this.context.domElement.shadowRoot)==null||r.append(this._audioElement),this._audioElement.srcObject=this.clip,this._audioElement.autoplay=!1):(this._audioElement&&this._audioElement.remove(),this.sound.play(o?.1:0))}}pause(){var e,t;Ko&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.isPlaying&&this.sound.source&&(this._lastContextTime=(e=this.sound)==null?void 0:e.context.currentTime,this.sound.pause()),(t=this._audioElement)==null||t.remove()}stop(){var e,t;Ko&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.source&&(this._lastContextTime=(e=this.sound)==null?void 0:e.context.currentTime,Ko&&console.log(this._lastContextTime),this.sound.stop()),(t=this._audioElement)==null||t.remove()}update(){this.helper&&(this.isPlaying&&this.helper.update(),this.helper.visible=this.isPlaying),this._needUpdateSpatialDistanceSettings&&this.applySpatialDistanceSettings(),this.sound&&!this.sound.isPlaying&&this.shouldPlay&&!this._hasEnded&&(this._hasEnded=!0,Ko&&console.log("Audio clip ended",this.clip),this.dispatchEvent(new CustomEvent("ended",{detail:this})))}};let fs=wf;Wh([I(URL)],fs.prototype,"clip",2);Wh([I()],fs.prototype,"playOnAwake",2);Wh([I()],fs.prototype,"preload",2);Wh([I()],fs.prototype,"playInBackground",2);Wh([I()],fs.prototype,"loop",1);Wh([I()],fs.prototype,"spatialBlend",1);Wh([I()],fs.prototype,"minDistance",1);Wh([I()],fs.prototype,"maxDistance",1);Wh([I()],fs.prototype,"volume",1);Wh([I()],fs.prototype,"pitch",1);Wh([I()],fs.prototype,"rollOffMode",2);var FNe=Object.defineProperty,VNe=Object.getOwnPropertyDescriptor,RP=(s,e,t,i)=>{for(var n=i>1?void 0:i?VNe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&FNe(e,t,n),n};const zNe=ee("debugsignals");class xM{constructor(){p(this,"guid")}}RP([I()],xM.prototype,"guid",2);class cv{constructor(){p(this,"signal");p(this,"reaction")}}RP([I(xM)],cv.prototype,"signal",2);RP([I(Tn)],cv.prototype,"reaction",2);var SF;const Vu=(SF=class extends ze{constructor(){super(...arguments);p(this,"events")}static invoke(e){if(Vu.receivers[e]){const t=Vu.receivers[e];if(!t)return;for(const i of t)i.invoke(e)}}awake(){zNe&&console.log("SignalReceiver awake",this)}onEnable(){if(this.events)for(const e of this.events)Vu.receivers[e.signal.guid]||(Vu.receivers[e.signal.guid]=[]),Vu.receivers[e.signal.guid].push(this)}onDisable(){if(this.events){for(const e of this.events)if(Vu.receivers[e.signal.guid]){const t=Vu.receivers[e.signal.guid].indexOf(this);t>=0&&Vu.receivers[e.signal.guid].splice(t,1)}}}invoke(e){if(!this.events||!Array.isArray(this.events))return;const t=typeof e=="object"?e.guid:e;for(const i of this.events)if(i.signal.guid===t)try{if(i.reaction){if(!i.reaction.invoke){console.warn("Missing invoke - possibly a serialization error",i,this);continue}}else{console.warn("Missing reaction for signal",i,this);continue}i.reaction.invoke()}catch(n){console.error(n)}}},p(SF,"receivers",{}),SF);let hv=Vu;RP([I(cv)],hv.prototype,"events",2);var Sl=(s=>(s.Activation="ActivationTrack",s.Animation="AnimationTrack",s.Audio="AudioTrack",s.Control="ControlTrack",s.Marker="MarkerTrack",s.Signal="SignalTrack",s))(Sl||{}),hd=(s=>(s[s.None=0]="None",s[s.Hold=1]="Hold",s[s.Loop=2]="Loop",s[s.PingPong=3]="PingPong",s[s.Continue=4]="Continue",s))(hd||{}),B5=(s=>(s.Signal="SignalEmitter",s))(B5||{}),UNe=Object.defineProperty,XNe=Object.getOwnPropertyDescriptor,Doe=(s,e,t,i)=>{for(var n=i>1?void 0:i?XNe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&UNe(e,t,n),n};const Pu=ee("debugtimeline");var MF;const kz=(MF=class extends ze{constructor(){super(...arguments);p(this,"playableAsset");p(this,"playOnAwake");p(this,"extrapolationMode",1);p(this,"waitForAudio",!0);p(this,"_visibilityChangeEvt");p(this,"_clonedPlayableAsset",!1);p(this,"_speed",1);p(this,"_guidsMap");p(this,"_isPlaying",!1);p(this,"_internalUpdateRoutine");p(this,"_isPaused",!1);p(this,"_isStopping",!1);p(this,"_time",0);p(this,"_duration",0);p(this,"_weight",1);p(this,"_animationTracks",[]);p(this,"_audioTracks",[]);p(this,"_signalTracks",[]);p(this,"_controlTracks",[]);p(this,"_customTracks",[]);p(this,"_allTracks",[this._animationTracks,this._audioTracks,this._signalTracks,this._controlTracks,this._customTracks]);p(this,"animationCallbackReceivers",[])}static registerCreateTrack(e,t){this.createTrackFunctions[e]=t}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get time(){return this._time}set time(e){typeof e=="number"&&!Number.isNaN(e)?this._time=e:(Pu||ka())&&console.error("INVALID TIMELINE.TIME VALUE",e,this.name)}get duration(){return this._duration}set duration(e){this._duration=e}get weight(){return this._weight}set weight(e){this._weight=e}get speed(){return this._speed}set speed(e){this._speed=e}awake(){var e,t,i,n,r;Pu&&console.log(this,(e=this.playableAsset)==null?void 0:e.tracks),this.rebuildGraph(),!this.isValid()&&(Pu||Qe())&&(Pu?console.warn("PlayableDirector is not valid","Asset?",this.playableAsset,"Tracks:",(t=this.playableAsset)==null?void 0:t.tracks,"IsArray?",Array.isArray((i=this.playableAsset)==null?void 0:i.tracks),this):(r=(n=this.playableAsset)==null?void 0:n.tracks)!=null&&r.length?console.warn("PlayableDirector is not valid"):console.warn("PlayableDirector has no tracks"))}onEnable(){var e,t,i;for(const n of this._audioTracks)(e=n.onEnable)==null||e.call(n);for(const n of this._customTracks)(t=n.onEnable)==null||t.call(n);for(const n of this._animationTracks)(i=n.onEnable)==null||i.call(n);this.playOnAwake&&this.play(),this._visibilityChangeEvt||(this._visibilityChangeEvt=()=>{switch(document.visibilityState){case"hidden":this.setAudioTracksAllowPlaying(!1);break;case"visible":this.setAudioTracksAllowPlaying(!0);break}}),window.addEventListener("visibilitychange",this._visibilityChangeEvt)}onDisable(){var e,t,i;this.stop();for(const n of this._audioTracks)(e=n.onDisable)==null||e.call(n);for(const n of this._customTracks)(t=n.onDisable)==null||t.call(n);for(const n of this._animationTracks)(i=n.onDisable)==null||i.call(n);this._visibilityChangeEvt&&window.removeEventListener("visibilitychange",this._visibilityChangeEvt)}onDestroy(){var e;for(const t of this._allTracks)for(const i of t)(e=i.onDestroy)==null||e.call(i)}rebuildGraph(){this.isValid()&&(this.resolveBindings(),this.updateTimelineDuration(),this.setupAndCreateTrackHandlers())}async play(){if(!this.isValid())return;const e=this._isPaused==!0;if(this._isPaused=!1,!this._isPlaying){if(this._isPlaying=!0,e&&this.invokePauseChangedMethodsOnTracks(),this.waitForAudio){const t=[];for(const i of this._audioTracks){const n=i.loadAudio(this._time,1,0);n&&t.push(n)}if(t.length>0&&(await Promise.all(t),!this._isPlaying))return;for(;this._audioTracks.length>0&&this._isPlaying&&!fs.userInteractionRegistered&&this.waitForAudio;)await Nh(200)}this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine=this.startCoroutine(this.internalUpdate(),wn.LateUpdate)}}pause(){this.isValid()&&(this._isPlaying=!1,!this._isPaused&&(this._isPaused=!0,this.internalEvaluate(),this.invokePauseChangedMethodsOnTracks(),this.invokeStateChangedMethodsOnTracks()))}stop(){this._isStopping=!0;for(const i of this._audioTracks)i.stop();const e=this._isPaused==!0,t=this._isPlaying;this._isPlaying&&(this._time=0,this._isPlaying=!1,this._isPaused=!1,this.internalEvaluate(),e&&this.invokePauseChangedMethodsOnTracks()),this._isPlaying=!1,this._isPaused=!1,e&&!t&&this.invokePauseChangedMethodsOnTracks(),t&&this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine&&this.stopCoroutine(this._internalUpdateRoutine),this._internalUpdateRoutine=null,this._isStopping=!1}evaluate(){this.internalEvaluate(!0)}isValid(){return this.playableAsset&&this.playableAsset.tracks&&Array.isArray(this.playableAsset.tracks)}*forEachTrack(){for(const e of this._allTracks)for(const t of e)yield t}get animationTracks(){return this._animationTracks}get audioTracks(){return this._audioTracks}resolveGuids(e){this._guidsMap=e}invokePauseChangedMethodsOnTracks(){var e;for(const t of this.forEachTrack())(e=t.onPauseChanged)==null||e.call(t)}invokeStateChangedMethodsOnTracks(){var e;for(const t of this.forEachTrack())(e=t.onStateChanged)==null||e.call(t,this._isPlaying)}*internalUpdate(){for(;this._isPlaying&&this.activeAndEnabled;)!this._isPaused&&this._isPlaying&&(this._time+=this.context.time.deltaTime*this.speed,this.internalEvaluate()),yield}internalEvaluate(e=!1){if(!this.isValid())return;let t=this._time;switch(this.extrapolationMode){case 0:this._speed>0?t=Math.min(t,this._duration):this._speed<0&&(t=Math.max(t,0)),this._time=t;break;case 1:t%=this._duration,this._time=t;break;case 2:if(t>this._duration){this.stop();return}break}const i=this._time;for(const n of this.playableAsset.tracks)if(!n.muted)switch(n.type){case Sl.Activation:if(!e&&!this._isPlaying)continue;for(let r=0;r<n.outputs.length;r++){const o=n.outputs[r];if(typeof o=="object"){let a=!1;if(n.clips)for(const c of n.clips)c.start<=i&&i<=c.end&&(a=!0);const l=o;l.visible!==void 0&&l.visible!==a&&(l.visible=a,Pu&&console.warn(this.name,"set ActivationTrack-"+r,l.name,a,i))}}break}if(!this._isStopping)for(const n of this._animationTracks)n.evaluate(i);for(const n of this._audioTracks)n.evaluate(i);for(const n of this._signalTracks)n.evaluate(i);for(const n of this._controlTracks)n.evaluate(i);for(const n of this._customTracks)n.evaluate(i)}resolveBindings(){if(this._clonedPlayableAsset||(this._clonedPlayableAsset=!0,this.playableAsset=Y1(this.playableAsset)),!this.playableAsset||!this.playableAsset.tracks)return;const e=this.findRoot(this.gameObject);for(const t of this.playableAsset.tracks){for(let i=t.outputs.length-1;i>=0;i--){let n=t.outputs[i];if(typeof n=="string"){this._guidsMap&&this._guidsMap[n]&&(n=this._guidsMap[n]);const r=$.findByGuid(n,e);r===null||typeof r!="object"?(t.outputs.splice(i,1),console.warn("Failed to resolve binding",n,t.name,t.type)):(Pu&&console.log("Resolved binding",n,"to",r),t.outputs[i]=r)}else if(n===null){if(t.outputs.splice(i,1),kz.createTrackFunctions[t.type])continue;t.type!==Sl.Audio&&t.type!==Sl.Control&&t.type!==Sl.Marker&&t.type!==Sl.Signal&&console.warn("Missing binding",n,t.name,t.type,this.name,this.playableAsset.name)}}if(t.type===Sl.Control&&t.clips)for(let i=0;i<t.clips.length;i++){const n=t.clips[i];let r=n.asset.sourceObject;if(typeof r=="string"){this._guidsMap&&this._guidsMap[r]&&(r=this._guidsMap[r]);const o=$.findByGuid(r,e);o===null||typeof o!="object"?console.warn("Failed to resolve sourceObject binding",r,t.name,n):(Pu&&console.log("Resolved binding",r,"to",o),n.asset.sourceObject=o)}}}}findRoot(e){return e.parent?this.findRoot(e.parent):e}updateTimelineDuration(){if(this._duration=0,!(!this.playableAsset||!this.playableAsset.tracks)){for(const e of this.playableAsset.tracks)if(e.muted!==!0){if(e.clips)for(const t of e.clips)t.end>this._duration&&(this._duration=t.end);if(e.markers)for(const t of e.markers)t.time>this._duration&&(this._duration=t.time+.001)}}}setupAndCreateTrackHandlers(){var t,i,n;if(this._animationTracks.length=0,this._audioTracks.length=0,this._signalTracks.length=0,!this.playableAsset)return;let e=$.findObjectOfType(em,this.context);for(const r of this.playableAsset.tracks){const o=r.type,a=kz.createTrackFunctions[o];if(a!=null){const l=a(this,r);if(typeof l.evaluate=="function"){l.director=this,l.track=r,this._customTracks.push(l);continue}}if(r.type===Sl.Animation){if(!r.clips||r.clips.length<=0){Pu&&console.warn("Animation track has no clips",r);continue}for(let l=r.outputs.length-1;l>=0;l--){let c=r.outputs[l];if(c instanceof ye){const d=$.getOrAddComponent(c,Ro);d&&(c=d)}const h=(t=c==null?void 0:c.gameObject)==null?void 0:t.animations;if(h){const d=new LP;d.trackOffset=r.trackOffset,d.director=this,d.track=r;for(let u=0;u<r.clips.length;u++){const f=r.clips[u],m=f.asset;if(!m){console.error(`Timeline ${this.name}: clip #${u} on track "${r.name}" has no animation data`);continue}const g=m.clip;let A=g;if((typeof A=="string"||typeof A=="number")&&(A=h.find(b=>b.name===g)),Pu&&console.log(m,g,"→",A),!A){console.warn("Could not find animationClip for model",f,r.name,this.name,(i=this.playableAsset)==null?void 0:i.name,h,c);continue}c instanceof Ro&&c.runtimeAnimatorController&&(c.__internalDidAwakeAndStart||c.initializeRuntimeAnimatorController(),c.runtimeAnimatorController.mixer||c.runtimeAnimatorController.bind(c),d.mixer=c.runtimeAnimatorController.mixer),d.mixer||(d.mixer=new wB(c.gameObject),this.context.animations.registerAnimationMixer(d.mixer)),d.clips.push(A),d.mixer.uncacheAction(A),d.createHooks(f.asset,A);const y=d.mixer.clipAction(A);d.actions.push(y),d.models.push(f)}this._animationTracks.push(d)}}}else if(r.type===Sl.Audio){if(!r.clips||r.clips.length<=0)continue;const l=new P0;l.director=this,l.track=r,l.audioSource=r.outputs.find(c=>c instanceof fs),this._audioTracks.push(l),e||(e=(n=this.context.mainCameraComponent)==null?void 0:n.gameObject.addComponent(em)),l.listener=e.listener;for(let c=0;c<r.clips.length;c++){const h=r.clips[c];l.addModel(h)}}else if(r.type===Sl.Marker){const l=new CS;if(l.director=this,l.track=r,r.markers)for(const c of r.markers)switch(c.type){case B5.Signal:l.models.push(c),l.didTrigger.push(!1);break}if(l!==null&&l.models.length>0){const c=$.getComponent(this.gameObject,hv);c&&(l.receivers.push(c),this._signalTracks.push(l))}}else if(r.type===Sl.Signal){const l=new CS;if(l.director=this,l.track=r,r.markers)for(const c of r.markers)l.models.push(c),l.didTrigger.push(!1);for(const c of r.outputs)l.receivers.push(c);this._signalTracks.push(l)}else if(r.type===Sl.Control){const l=new BP;if(l.director=this,l.track=r,r.clips)for(const c of r.clips)l.models.push(c);l.resolveSourceObjects(this.context),this._controlTracks.push(l)}}}setAudioTracksAllowPlaying(e){for(const t of this._audioTracks)t.onAllowAudioChanged(e)}registerAnimationCallback(e){this.animationCallbackReceivers.push(e)}unregisterAnimationCallback(e){const t=this.animationCallbackReceivers.indexOf(e);t!==-1&&this.animationCallbackReceivers.splice(t,1)}},p(MF,"createTrackFunctions",{}),MF);let ym=kz;Doe([I()],ym.prototype,"playOnAwake",2);Doe([I()],ym.prototype,"extrapolationMode",2);const Ld=ee("debugtimeline");class vM{constructor(){p(this,"director");p(this,"track")}get muted(){return this.track.muted}set muted(e){var t;e!==this.track.muted&&(this.track.muted=e,(t=this.onMuteChanged)==null||t.call(this))}*forEachClip(e=!1){var t;if((t=this.track)!=null&&t.clips)if(e)for(let i=this.track.clips.length-1;i>=0;i--)yield this.track.clips[i];else for(const i of this.track.clips)yield i}getClipTime(e,t){return t.clipIn+(e-t.start)*t.timeScale}getClipTimeNormalized(e,t){return(e-t.start)/t.duration}evaluateWeight(e,t,i,n=!0){if(t<0||t>=i.length)return 0;const r=i[t];if(n||e>=r.start&&e<=r.end){let o=1;const a=!1;if(r.easeInDuration>0){const l=Math.min((e-r.start)/r.easeInDuration,1);o*=l}if(r.easeOutDuration>0&&!a){const l=Math.min((r.end-e)/r.easeOutDuration,1);o*=l}return o}return 0}}class ONe{constructor(e){p(this,"clip");p(this,"rootPositionOffset");p(this,"rootQuaternionOffset");p(this,"rootStartPosition");p(this,"rootEndPosition");p(this,"rootStartQuaternion");p(this,"rootEndQuaternion");const t=e.getClip();this.clip=t;const i=e.getRoot(),n=i.name+".position",r=i.name+".quaternion";Ld&&console.log(t.name,t.tracks,n);for(const o of t.tracks)if(!(o.times.length<=0)){if(o.name.endsWith(n))this.rootStartPosition=new T().fromArray(o.values,0),this.rootEndPosition=new T().fromArray(o.values,o.values.length-3),this.rootPositionOffset=this.rootEndPosition.clone().sub(this.rootStartPosition),Ld&&console.log(this.rootPositionOffset);else if(o.name.endsWith(r)&&(this.rootStartQuaternion=new Ve().fromArray(o.values,0),this.rootEndQuaternion=new Ve().fromArray(o.values,o.values.length-4),this.rootQuaternionOffset=this.rootEndQuaternion.clone().multiply(this.rootStartQuaternion),Ld)){const a=new Xi().setFromQuaternion(this.rootQuaternionOffset);console.log("ROT",a)}}}get hasOffsets(){return this.rootPositionOffset!==void 0||this.rootQuaternionOffset!==void 0}}class LP extends vM{constructor(){super(...arguments);p(this,"models",[]);p(this,"trackOffset");p(this,"target");p(this,"mixer");p(this,"clips",[]);p(this,"actions",[]);p(this,"weight",1);p(this,"_actionOffsets",[]);p(this,"_didBind",!1);p(this,"_animator",null);p(this,"_useclipOffsets",!0);p(this,"_totalOffsetPosition",new T);p(this,"_totalOffsetRotation",new Ve);p(this,"_totalOffsetPosition2",new T);p(this,"_totalOffsetRotation2",new Ve);p(this,"_summedPos",new T);p(this,"_tempPos",new T);p(this,"_summedRot",new Ve);p(this,"_tempRot",new Ve);p(this,"_clipRotQuat",new Ve)}onDisable(){var t;(t=this.mixer)==null||t.stopAllAction()}onDestroy(){this.director.context.animations.unregisterAnimationMixer(this.mixer)}onStateChanged(){this._animator&&rY(this._animator.gameObject,this,this.director.isPlaying)}createHooks(t,i){var h,d;if(((h=i.tracks)==null?void 0:h.length)<=0){console.warn("No tracks in AnimationClip",i);return}const n=i.tracks[0].name.split("."),r=n[n.length-2],o=r+".position",a=r+".quaternion";let l=!1,c=!1;for(const u of i.tracks)u.name.endsWith(o)?(l=!0,this.createPositionInterpolant(i,t,u)):u.name.endsWith(a)&&(c=!0,this.createRotationInterpolant(i,t,u));if(!l||!c){const u=(d=this.mixer)==null?void 0:d.getRoot(),f=i.tracks[0],m=f.name.lastIndexOf("."),g=f.name.substring(0,m),A=g.substring(g.lastIndexOf(".")+1),y=u.getObjectByName(A);if(y)if(l){if(!c){const b=i.tracks[0].name.substring(0,m)+".quaternion";Ld&&console.warn("Create quaternion track",A,y);const x=y.quaternion,v=new Kd(b,[0,i.duration],[x.x,x.y,x.z,x.w,x.x,x.y,x.z,x.w]);i.tracks.push(v),this.createRotationInterpolant(i,t,v)}}else{const b=g+".position";Ld&&console.warn("Create position track",A,y);const x=y.position,v=new Yd(b,[0,i.duration],[x.x,x.y,x.z,x.x,x.y,x.z]);i.tracks.push(v),this.createPositionInterpolant(i,t,v)}}}bind(){if(!this._didBind){this._didBind=!0,Ld&&console.log(this.models),this.mixer?this.target=this.mixer.getRoot():console.warn("No mixer was assigned to animation track");for(const t of this.actions){const i=new ONe(t);this._actionOffsets.push(i)}this.target&&(this._animator=$.getComponent(this.target,Ro)??null,this._animator&&rY(this._animator.gameObject,this,!0));for(const t of this.models){const i=t.asset,n=i.position,r=i.rotation;n&&n.x!==void 0&&(n.isVector3||(i.position=new T(n.x,n.y,n.z)),r.isQuaternion||(i.rotation=new Ve(r.x,r.y,r.z,r.w)))}this.ensureTrackOffsets()}}ensureTrackOffsets(){if(this.trackOffset){const t=this.trackOffset.position;t&&(t.isVector3||(this.trackOffset.position=new T(t.x,t.y,t.z)));const i=this.trackOffset.rotation;i&&(i.isQuaternion||(this.trackOffset.rotation=new Ve(i.x,i.y,i.z,i.w)))}}evaluate(t){var l,c,h,d,u,f,m;if(this.track.muted||!this.mixer)return;this.bind(),this._totalOffsetPosition.set(0,0,0),this._totalOffsetRotation.set(0,0,0,1),this._totalOffsetPosition2.set(0,0,0),this._totalOffsetRotation2.set(0,0,0,1);let i=0,n=0,r=!1,o=!1,a=0;for(let g=0;g<this.clips.length;g++){const A=this.models[g],y=this.actions[g],b=A.asset;y.weight=0;const x=t>=A.start&&t<=A.end,v=A.preExtrapolationMode,_=A.postExtrapolationMode,C=g<this.clips.length-1?this.models[g+1]:null;let S=x,M=!1;if(!S&&!r&&A.end<t&&_!==hd.None?(!C||C.start>t)&&(S=!0,r=!0):g==0&&!S&&!o&&A.start>t&&v!==hd.None&&(!C||C.start<t)&&(S=!0,M=!0,o=!0),S){let L=this.weight;L*=this.evaluateWeight(t,g,this.models,S),L*=this.director.weight;let w=x;if(M)switch(v){case hd.Hold:break;case hd.Loop:t+=A.start,w=!0;break;default:t+=A.start,w=!0;break}let E=this.getClipTime(t,A),B=0;const P=b.duration;if(M&&v===hd.Hold&&(E=0),w){if(b.loop)for(B+=Math.floor(E/(P+1e-6));E>P;)E-=P}else if(!x&&r)switch(_){case hd.Hold:E=this.getClipTime(A.end,A);break;case hd.Loop:E%=P;break;case hd.PingPong:const F=Math.floor(E/P)%2!==0;E%=P,F&&(E=P-E);break}A.reversed===!0?y.time=y.getClip().duration-E:y.time=E,y.timeScale=0;const k=Math.max(0,L);if(y.weight=k,a+=k,y.clampWhenFinished=!1,y.isRunning()||y.play(),this._useclipOffsets){const X=i==0?this._totalOffsetPosition:this._totalOffsetPosition2,F=i==0?this._totalOffsetRotation:this._totalOffsetRotation2;i<1&&(n=1-L),i+=1;const H=this._summedPos.set(0,0,0),W=this._tempPos.set(0,0,0),se=this._summedRot.identity(),de=this._tempRot.identity(),be=b.rotation;be&&(this._clipRotQuat.identity(),this._clipRotQuat.slerp(be,L));const Pe=this._actionOffsets[g];if(Pe.hasOffsets)for(let Oe=0;Oe<B;Oe++)Pe.rootPositionOffset?W.copy(Pe.rootPositionOffset):W.set(0,0,0),W.applyQuaternion(se),this._clipRotQuat&&W.applyQuaternion(this._clipRotQuat),Pe.rootQuaternionOffset&&(de.copy(Pe.rootQuaternionOffset),se.multiply(de)),H.add(W);this._clipRotQuat&&F.multiply(this._clipRotQuat),F.multiply(se),b.position&&H.add(b.position),X.add(H)}}}if(this._useclipOffsets&&(this._totalOffsetPosition.lerp(this._totalOffsetPosition2,n),this._totalOffsetRotation.slerp(this._totalOffsetRotation2,n)),this.__mixerError===void 0&&(Ld||Qe())&&((c=(l=this._animator)==null?void 0:l.runtimeAnimatorController)!=null&&c.mixer)&&this.mixer!==((d=(h=this._animator)==null?void 0:h.runtimeAnimatorController)==null?void 0:d.mixer)&&(this.__mixerError=!0,console.error("AnimationTrack mixer is not shared with the animator controller - this might result in the timeline to not animate properly. Please report a bug to the Needle Engine team!",this)),(u=this._animator)!=null&&u.runtimeAnimatorController){const g=Math.max(0,1-a);(m=(f=this._animator)==null?void 0:f.runtimeAnimatorController)==null||m.update(g)}else this.mixer.update(t)}createRotationInterpolant(t,i,n){var l;const r=n.createInterpolant.bind(n),o=new Ve;this.ensureTrackOffsets();const a=(l=this.trackOffset)==null?void 0:l.rotation;n.createInterpolant=()=>{const c=r(),h=c.evaluate.bind(c);return c.evaluate=d=>{var f;const u=h(d);if(o.set(u[0],u[1],u[2],u[3]),o.premultiply(this._totalOffsetRotation),a&&o.premultiply(a),this.director.animationCallbackReceivers)for(const m of this.director.animationCallbackReceivers)(f=m==null?void 0:m.onTimelineRotation)==null||f.call(m,this.director,this.target,d,o);return u[0]=o.x,u[1]=o.y,u[2]=o.z,u[3]=o.w,u},c}}createPositionInterpolant(t,i,n){var h,d;const r=n.createInterpolant.bind(n),o=new T;this.ensureTrackOffsets();const a=(h=this.trackOffset)==null?void 0:h.rotation,l=(d=this.trackOffset)==null?void 0:d.position;let c;n.createInterpolant=()=>{const u=r(),f=u.evaluate.bind(u);return u.evaluate=m=>{var A,y,b;const g=f(m);if(o.set(g[0],g[1],g[2]),i.removeStartOffset&&(c===void 0?(c=null,c=(y=(A=this._actionOffsets.find(x=>x.clip===t))==null?void 0:A.rootStartPosition)==null?void 0:y.clone()):c!=null&&c.isVector3&&o.sub(c)),o.applyQuaternion(this._totalOffsetRotation),o.add(this._totalOffsetPosition),a&&o.applyQuaternion(a),l&&(o.x-=l.x,o.y+=l.y,o.z+=l.z),this.director.animationCallbackReceivers)for(const x of this.director.animationCallbackReceivers)(b=x==null?void 0:x.onTimelinePosition)==null||b.call(x,this.director,this.target,m,o);return g[0]=o.x,g[1]=o.y,g[2]=o.z,g},u}}}const ZNe=ee("mutetimeline"),zb=class extends vM{constructor(){super(...arguments);p(this,"models",[]);p(this,"listener");p(this,"audio",[]);p(this,"audioContextTimeOffset",[]);p(this,"lastTime",0);p(this,"audioSource");p(this,"_audioLoader",null);p(this,"_playableDirectorResumed",!1)}getAudioFilePath(t){const i=this.director.sourceId;return km(i,t)}onAllowAudioChanged(t){for(let i=0;i<this.models.length;i++){const n=this.models[i];this.audio[i].setVolume(t?n.asset.volume:0)}}addModel(t){const i=new uX(this.listener);this.audio.push(i);const n=t;n._didTriggerPlay=!1,this.models.push(n)}onDisable(){for(const t of this.audio)t.isPlaying&&t.stop();for(const t of this.models)t._didTriggerPlay=!1}onDestroy(){for(const t of this.audio)t.source&&(t==null||t.disconnect());this.audio.length=0}onMuteChanged(){if(this.muted)for(let t=0;t<this.audio.length;t++){const i=this.audio[t];i!=null&&i.isPlaying&&i.stop()}}stop(){for(let t=0;t<this.audio.length;t++){const i=this.audio[t];i!=null&&i.isPlaying&&i.stop()}for(const t of this.models)t._didTriggerPlay=!1}onPauseChanged(){for(let t=0;t<this.audio.length;t++){const i=this.audio[t];i!=null&&i.isPlaying&&i.stop()}this._playableDirectorResumed=this.director.isPlaying}evaluate(t){if(ZNe||this.track.muted||this.director.speed<0)return;const i=this.director.context.application.muted,n=this._playableDirectorResumed;this._playableDirectorResumed=!1;const r=i?.1:0;for(let o=0;o<this.models.length;o++){const a=this.models[o],l=this.audio[o],c=a.asset;if((!l||!l.buffer)&&this.isInTimeRange(a,t-1,t+1)&&this.handleAudioLoading(a,l),fs.userInteractionRegistered!==!1&&!(l===null||!l.buffer))if(l.playbackRate=this.director.context.time.timeScale*this.director.speed,l.loop=c.loop,t>=a.start&&t<=a.end&&t<this.director.duration){if(!l.isPlaying||!this.director.isPlaying)(n||!a._didTriggerPlay&&this.lastTime<t)&&(a.duration*a.timeScale>.3?l.offset=a.clipIn+(t-a.start)*a.timeScale:l.offset=0,Ld&&console.log("Timeline Audio ("+this.track.name+") play with offset "+l.offset+" - "+a.asset.clip),l.play(r),a._didTriggerPlay=!0);else{const d=a.clipIn+(t-a.start)*a.timeScale,u=l.context.currentTime-l._startedAt+l.offset;Math.abs(d-u)>.3&&(l.offset=d,l.stop(),l.play(r))}let h=c.volume;if(this.track.volume!==void 0&&(h*=this.track.volume),i&&(h=0),a.easeInDuration>0){const d=Math.min((t-a.start)/a.easeInDuration,1);h*=d}if(a.easeOutDuration>0){const d=Math.min((a.end-t)/a.easeOutDuration,1);h*=d}l.setVolume(h*this.director.weight)}else a._didTriggerPlay=!1,this.director.isPlaying&&l.isPlaying&&l.stop()}this.lastTime=t}loadAudio(t,i=0,n=0){let r=null;const o=t-n,a=t+i;for(const l of this.models)if(this.isInTimeRange(l,o,a)){const c=this.audio[this.models.indexOf(l)],h=this.handleAudioLoading(l,c);h!==null&&(r===null&&(r=[]),r.push(h))}return r!==null?Promise.all(r):null}isInTimeRange(t,i,n){return i<=t.start&&n>=t.end||i>=t.start&&i<=t.end||n>=t.start&&n<=t.end}static dispose(){zb._audioBuffers.clear()}handleAudioLoading(t,i){this._audioLoader||(this._audioLoader=new ML);const n=this.getAudioFilePath(t.asset.clip);if(zb._audioBuffers.get(n)){const o=zb._audioBuffers.get(n);return o.then(a=>{a&&i.setBuffer(a)}),o}Ld&&console.warn("LOAD audio track",n,this.director.sourceId);const r=new Promise((o,a)=>{this._audioLoader.load(n,l=>{i.setBuffer(l),o(l)},void 0,l=>{console.error("Error loading audio",l),o(null)})});return zb._audioBuffers.set(n,r),r}};let P0=zb;p(P0,"_audioBuffers",new Map);class CS extends vM{constructor(){super(...arguments);p(this,"models",[]);p(this,"didTrigger",[]);p(this,"receivers",[])}evaluate(t){var n;if(this.track.muted)return;const i=this.director.context.time.deltaTime*1.5;for(let r=0;r<this.models.length;r++){const o=this.models[r],a=this.didTrigger[r],l=o.time-t;let c=!1;if(o.retroActive)c=l<=1e-6;else{const h=Math.abs(l);(h===0||h>=1e-5&&h<i)&&(c=!0)}if(c){if(!a)if(Ld&&console.log("Trigger signal",t,o.time,o),this.didTrigger[r]=!0,((n=this.receivers)==null?void 0:n.length)<=0)hv.invoke(o.asset);else for(const h of this.receivers)h&&h.invoke(o.asset)}else o.emitOnce||(this.didTrigger[r]=!1)}}}class BP extends vM{constructor(){super(...arguments);p(this,"models",[]);p(this,"timelines",[]);p(this,"_previousActiveModel",null)}resolveSourceObjects(t){for(let i=this.models.length-1;i>=0;i--){const r=this.models[i].asset;if(!r.sourceObject||typeof r.sourceObject!="object"){console.log("no source object, removing model",i,r),this.models.splice(i,1);continue}else{const o=$.getComponent(r.sourceObject,ym);this.timelines.push(o),o&&r.updateDirector&&(o.playOnAwake=!1)}}}evaluate(t){var i;this._previousActiveModel=null;for(let n=0;n<this.models.length;n++){const r=this.models[n],o=r.asset;if(t>=r.start&&t<=r.end){this._previousActiveModel=r;const a=this.getClipTime(t,r);if(o.controlActivation){const l=o.sourceObject;l.visible=!0}if(o.updateDirector){const l=this.timelines[n];l&&(l.isPlaying&&l.pause(),l.time=a,l.evaluate())}}else{const a=(i=this._previousActiveModel)==null?void 0:i.asset;if(o.controlActivation){const l=o.sourceObject;(a==null?void 0:a.sourceObject)!==l&&(l.visible=!1)}}}}}const WNe=ee("debugpost");let Nz=null;function HNe(s){Nz=s}function Foe(s){let e=s.gameObject;for(;e;){for(const t of bP(e))if(t.isPostProcessingManager===!0)return t;e=e.parent}return null}function QNe(s){let e=Foe(s);if(!e)if(Nz){WNe&&console.warn("Adding postprocessing manager to the scene.");const t=s.scene;e=Yl(t,Nz)}else Qe()&&console.warn("No post processing manager found");return e}var KNe=Object.defineProperty,YNe=Object.getOwnPropertyDescriptor,Voe=(s,e,t,i)=>{for(var n=i>1?void 0:i?YNe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&KNe(e,t,n),n};const JNe=ee("debugpost");class rt{constructor(e){p(this,"isVolumeParameter",!0);p(this,"_isInitialized",!1);p(this,"_active",!0);p(this,"_value");p(this,"_valueRaw");p(this,"_defaultValue");p(this,"valueProcessor");p(this,"onValueChanged");e!==void 0&&this.initialize(e)}get isInitialized(){return this._isInitialized}initialize(e){e!==void 0&&(this._value=e,this._defaultValue=e,this._valueRaw=e,this._isInitialized=!0)}get overrideState(){return this._active}set overrideState(e){if(this._active===e)return;this._active=e;const t=e?this._valueRaw:this._defaultValue;this.processValue(t,!0)}get value(){return this._valueRaw}set value(e){this.isInitialized||this.initialize(e),this.processValue(e,!1)}set defaultValue(e){this._defaultValue=e}__init(){this.processValue(this._valueRaw,!0)}processValue(e,t){if(e==null||!t&&this.testIfValueChanged(e)===!1)return;const i=this._value;JNe&&typeof i=="number"&&typeof e=="number"&&(i==null||i.toFixed(4),e==null||e.toFixed(4)),!this._active&&this._defaultValue!==void 0?(this._value=this._defaultValue,e=this._defaultValue,this._valueRaw=e):(this._valueRaw=e,this._active&&this.valueProcessor&&(e=this.valueProcessor(e)),this._value=e),this.onValueChanged&&this.onValueChanged(e,i,this)}testIfValueChanged(e){return this._valueRaw!==e}}Voe([I()],rt.prototype,"overrideState",1);Voe([I()],rt.prototype,"value",1);class jNe extends Qc{constructor(){super([rt])}onSerialize(e,t){}onDeserialize(e,t){const i=t.target,n=t.path;let r;if(i&&n&&(r=i[n]),(typeof r!="object"||typeof r=="object"&&r.isVolumeParameter!==!0)&&(r=new rt),typeof e=="object"&&"value"in e){const o=e.value;r.initialize(o),r.overrideState=e.overrideState}else r.value=e;return r}}new jNe;var qNe=Object.defineProperty,$Ne=Object.getOwnPropertyDescriptor,eDe=(s,e,t,i)=>{for(var n=i>1?void 0:i?$Ne(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&qNe(e,t,n),n};const tDe=ee("debugpost");class jr extends ze{constructor(t=void 0){super();p(this,"active",!0);p(this,"_manager",null);p(this,"_result");p(this,"_postprocessingContext",null);if(t)for(const i of Object.keys(t)){const n=t[i],r=this[i];r instanceof rt?r.initialize(n):r!==void 0&&(this[i]=n)}}get isPostProcessingEffect(){return!0}onEnable(){super.onEnable(),this.onEffectEnabled(),this.__internalDidAwakeAndStart&&(this.active=!0)}onDisable(){var t;super.onDisable(),(t=this._manager)==null||t.removeEffect(this),this.active=!1}onEffectEnabled(t){var i;t&&t.isPostProcessingManager===!0?this._manager=t:this._manager||(this._manager=QNe(this)),(i=this._manager)==null||i.addEffect(this)}init(){}get postprocessingContext(){return this._postprocessingContext}apply(t){var i;return this._postprocessingContext=t,this._result||(this.initParameters(),this._result=(i=this.onCreateEffect)==null?void 0:i.call(this)),this._result&&this.initParameters(),this._result}unapply(){}dispose(){tDe&&console.warn("DISPOSE",this),this._result&&(Array.isArray(this._result)?this._result.forEach(t=>t.dispose()):this._result.dispose()),this._result=void 0}initParameters(){const t=Object.keys(this);for(const i of t){const n=this[i];n instanceof rt&&n.__init()}}onEditorModification(t){const i=t.propertyName;if(this[i]instanceof rt){const n=t.value;return this[i].value=n,!0}}}eDe([I()],jr.prototype,"active",2);var iDe=Object.defineProperty,nDe=Object.getOwnPropertyDescriptor,sDe=(s,e,t,i)=>{for(var n=i>1?void 0:i?nDe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&iDe(e,t,n),n};const rDe=ee("debugpost"),Dz={};function Kc(s,e){Dz[s]=e}function oDe(s){return s.__type in Dz?Dz[s.__type]:(rDe&&s.__type&&console.warn("Unknown postprocessing type",s.__type,s),jr)}class _M{constructor(){p(this,"components",[])}init(){var e;(e=this.components)==null||e.forEach(t=>t.init())}addEffect(e){this.components.push(e)}removeEffect(e){const t=this.components.indexOf(e);t>=0&&this.components.splice(t,1)}}sDe([av([s=>oDe(s),jr])],_M.prototype,"components",2);var aDe=Object.defineProperty,lDe=Object.getOwnPropertyDescriptor,cDe=(s,e,t,i)=>{for(var n=i>1?void 0:i?lDe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&aDe(e,t,n),n};class CM extends jr{constructor(){super(...arguments);p(this,"preset",new rt($g.HIGH))}get typeName(){return"Antialiasing"}onCreateEffect(){const t=new Jie({preset:$g.HIGH,edgeDetectionMode:IO.DEPTH});return this.preset.onValueChanged=i=>{t.applyPreset(i)},t}}cDe([I(rt)],CM.prototype,"preset",2);Kc("Antialiasing",CM);const hDe=ee("debugusdz");class Xm{constructor(){p(this,"files",new Array)}static getName(e){var r;const t=e.split(".").pop();let n=(r=e.split(".").slice(0,-1).join(".").split("/").pop())==null?void 0:r.replace(".","_");return n||(n="Audio_"+Math.random().toString(36).substring(2,15)),Vh(n)+"."+t}get extensionName(){return"Audio"}onExportObject(e,t,i){const n=$.getComponents(e,fs);if(n.length)for(const r of n){if(!r.clip||typeof r.clip!="string"||!r.playOnAwake)continue;const o=r.clip.split("/").pop()||"Audio",a=Xm.getName(r.clip),l=Vh(a);if(!this.files.some(c=>c.path===r.clip)){this.files.push({path:r.clip,name:a});const c=a.toLowerCase();i.quickLookCompatible&&!c.endsWith(".mp3")&&!c.endsWith(".wav")&&!c.endsWith(".m4a")&&console.error("Audio file "+r.clip+" from "+r.name+" is not an MP3 or WAV file. QuickLook may not support playing it.")}i.quickLookCompatible||t.addEventListener("serialize",(c,h)=>{c.appendLine(),c.beginBlock(`def SpatialAudio "${l}"`,"(",!1),c.appendLine(`displayName = "${o}"`),c.closeBlock(")"),c.beginBlock(),c.appendLine(`uniform asset filePath = @audio/${a}@`),c.appendLine(`uniform token auralMode = "${r.spatialBlend>0?"spatial":"nonSpatial"}"`),c.appendLine(`uniform token playbackMode = "${r.loop?"loopFromStage":"onceFromStart"}"`),c.appendLine(`uniform float gain = ${r.volume}`),c.closeBlock()})}}async onAfterSerialize(e){for(const t of this.files){const i="audio/"+t.name;if(e.files[i]){hDe&&console.warn("Audio file with name "+i+" already exists in the context. Skipping.");continue}const o=await(await(await fetch(t.path)).blob()).arrayBuffer(),a=new Uint8Array(o);e.files[i]=a}}}const op=ee("debugautosync"),fD=Symbol("syncerId");class dDe{constructor(){p(this,"_syncers",{})}getOrCreateSyncer(e){if(!e.guid)return null;if(this._syncers[e.guid])return this._syncers[e.guid];const t=new uDe(e);return t[fD]=e.guid,this._syncers[t[fD]]=t,t}removeSyncer(e){delete this._syncers[e[fD]]}}const P5=new dDe;class uDe{constructor(e){p(this,"comp");p(this,"hasChanges",!1);p(this,"changedProperties",{});p(this,"_isReceiving",!1);p(this,"_isInit",!1);p(this,"onHandleSending",()=>{if(!this.hasChanges)return;this.hasChanges=!1;const e=this.comp.context.connection;if(!e||!e.isConnected||!e.isInRoom){for(const t in this.changedProperties)delete this.changedProperties[t];return}for(const t in this.changedProperties){const i=this.comp.guid+"/"+t,n=this.changedProperties[t];op&&console.log("SEND",this.comp.name,this.networkingKey),e.send(this.networkingKey,{guid:i,data:n},yh.Queued)}});p(this,"onHandleReceiving",e=>{if(op&&console.log("RECEIVE",this.comp.name,this.comp.guid,e),!this._isInit||!this.comp||e.guid.startsWith(this.comp.guid)===!1)return;const[t,i]=e.guid.split("/");op&&console.log("RECEIVED",this.comp.name,this.comp.guid,e);try{this._isReceiving=!0,this.comp[i]=e.data}catch(n){console.error(n)}finally{this._isReceiving=!1}});this.comp=e}get networkingKey(){return this.comp.guid}init(e){if(this._isInit)return;this._isInit=!0,this.comp=e,this.comp.context.post_render_callbacks.push(this.onHandleSending),this.comp.context.connection.beginListen(this.networkingKey,this.onHandleReceiving);const t=this.comp.context.connection.tryGetState(this.comp.guid);t&&this.onHandleReceiving(t)}destroy(){this._isInit&&(this.comp.context.post_render_callbacks.splice(this.comp.context.post_render_callbacks.indexOf(this.onHandleSending),1),this.comp.context.connection.stopListen(this.networkingKey,this.onHandleReceiving),this.comp=null,this._isInit=!1)}notifyChanged(e,t){this._isReceiving||(op&&console.log("Property changed: "+e,t),this.hasChanges=!0,this.changedProperties[e]=t)}}function pDe(s,e){let t=e!==s;return!t&&s&&e&&(Array.isArray(s)&&Array.isArray(e)||typeof s=="object"&&typeof e=="object")&&(t=!0),t}const dw=Symbol("AutoSyncHandler");function fDe(s){if(s[dw])return s[dw];const e=P5.getOrCreateSyncer(s);return e==null||e.init(s),s[dw]=e,e}function mDe(s){const e=s[dw];e&&(P5.removeSyncer(e),e.destroy(),delete s[dw])}const G5=function(s=null){return function(e,t){var h;let i="";typeof t=="string"?i=t:i=t.name;let n=null,r;typeof s=="string"?r=e[s]:typeof s=="function"&&(r=s),r==null&&(Qe()||op)&&s!=null&&console.warn('syncField: no callback function found for property "'+i+'"','"'+s+'"');const o=e,a=o.__internalAwake;if(typeof a!="function"){(op||Qe())&&console.error('@syncField can currently only used on Needle Engine Components, custom object of type "'+((h=e==null?void 0:e.constructor)==null?void 0:h.name)+'" is not supported',e);return}op&&console.log(i);const l=Symbol(i);o.__internalAwake=function(){if(this[l]!==void 0)return;this[l]=this[i],n=P5.getOrCreateSyncer(this);const d=Object.getOwnPropertyDescriptor(this,i);if((d==null?void 0:d.set)===void 0){let u=!1;Object.defineProperty(this,i,{set:function(f){var g;const m=this[l];if(this[l]=f,u){(Qe()||op)&&console.warn("Recursive call detected",i);return}u=!0;try{const A=pDe(f,m);op&&console.log("SyncField assignment",i,"changed?",A,f,r),A&&(r==null?void 0:r.call(this,f,m))!==!1&&((g=fDe(this))==null||g.notifyChanged(i,f))}finally{u=!1}},get:function(){return this[l]},configurable:!0,enumerable:!0})}n==null||n.init(this),a.call(this)};const c=o.__internalDestroy;o.__internalDestroy=function(){mDe(this),c.call(this)}}};var gDe=Object.defineProperty,ADe=Object.getOwnPropertyDescriptor,PP=(s,e,t,i)=>{for(var n=i>1?void 0:i?ADe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&gDe(e,t,n),n};const Tl=ee("debugplayersync"),zoe=class extends ze{constructor(){super(...arguments);p(this,"autoSync",!0);p(this,"asset");p(this,"onPlayerSpawned");p(this,"_localInstance");p(this,"onJoinedRoom",()=>{Tl&&console.log("PlayerSync.joinedRoom. autoSync is set to "+this.autoSync),this.autoSync&&this.getInstance()});p(this,"destroyInstance",()=>{var e;(e=this._localInstance)==null||e.then(t=>{Tl&&console.log("PlayerSync.destroyInstance",t),cM(t,this.context.connection,!0,{saveInRoom:!1})}),this._localInstance=void 0})}static async setupFrom(e,t){const i=gi.getOrCreateFromUrl(e);if(!i.asset){const o=await i.loadAssetAsync();$.getOrAddComponent(o,Xl)}const n=new zoe;n._internalInit(t),n.asset=i;const r=new ye;return r.guid=e,$.addComponent(r,n),n}awake(){this.watchTabVisible(),this.onPlayerSpawned||(this.onPlayerSpawned=new Tn)}onEnable(){this.context.connection.beginListen(ri.RoomStateSent,this.onJoinedRoom),this.context.connection.beginListen(ri.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(ri.LeftRoom,this.destroyInstance),this.context.connection.isInRoom&&this.onJoinedRoom()}onDisable(){this.context.connection.stopListen(ri.RoomStateSent,this.onJoinedRoom),this.context.connection.stopListen(ri.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(ri.LeftRoom,this.destroyInstance)}async getInstance(){var t,i,n,r,o,a;if(this._localInstance)return this._localInstance;if(Tl&&console.log("PlayerSync.createInstance",(t=this.asset)==null?void 0:t.url),!((i=this.asset)!=null&&i.asset)&&!((n=this.asset)!=null&&n.url))return console.error('PlayerSync: can not create an instance because "asset" is not set and or has no URL!'),null;this.gameObject.guid||console.warn("PlayerSync: gameObject has no guid! This might cause issues with syncing the player state."),this._localInstance=(r=this.asset)==null?void 0:r.instantiateSynced({parent:this.gameObject,deleteOnDisconnect:!0},!0);const e=await this._localInstance;if(e){const l=$.getComponentsInChildren(e,Xl);if(l!=null&&l.length){for(const c of l)c.owner=this.context.connection.connectionId;(o=this.onPlayerSpawned)==null||o.invoke(e)}else this._localInstance=void 0,console.error("<strong>Failed finding PlayerState on "+((a=this.asset)==null?void 0:a.url)+"</strong>: please make sure the asset has a PlayerState component!"),$.destroySynced(e)}else this._localInstance=void 0,console.warn("PlayerSync: failed instantiating asset!");return this._localInstance}watchTabVisible(){window.addEventListener("visibilitychange",e=>{if(document.visibilityState==="visible")for(let t=Xl.all.length-1;t>=0;t--){const i=Xl.all[t];(!i.owner||!this.context.connection.userIsInRoom(i.owner))&&i.doDestroy()}})}};let dv=zoe;PP([I()],dv.prototype,"autoSync",2);PP([I(gi)],dv.prototype,"asset",2);PP([I(Tn)],dv.prototype,"onPlayerSpawned",2);var Uoe=(s=>(s.OwnerChanged="ownerChanged",s))(Uoe||{}),tC;const co=(tC=class extends ze{constructor(){super(...arguments);p(this,"onOwnerChangeEvent",new Tn);p(this,"onFirstOwnerChangeEvent",new Tn);p(this,"hasOwner",!1);p(this,"owner");p(this,"dontDestroy",!1);p(this,"onUserLeftRoom",e=>{if(e.userId===this.owner){Tl&&console.log("PLAYERSYNC LEFT",this.owner),this.doDestroy();return}})}static get all(){return co._all}static get local(){return co._local}static getFor(e){if(e instanceof ye)return $.getComponentInParent(e,co);if(e instanceof ze)return $.getComponentInParent(e.gameObject,co)}static isLocalPlayer(e){const t=co.getFor(e);return(t==null?void 0:t.isLocalPlayer)??!1}static addEventListener(e,t){return this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),t}static removeEventListener(e,t){if(!this._callbacks[e])return;const i=this._callbacks[e].indexOf(t);i>=0&&this._callbacks[e].splice(i,1)}static dispatchEvent(e,t){if(this._callbacks[e])for(const i of this._callbacks[e])i(t)}get isLocalPlayer(){return this.owner===this.context.connection.connectionId}onOwnerChange(e,t){var o,a;Tl&&console.log("PlayerSync.onOwnerChange",this,"newOwner",e,"oldOwner",t);const i=co._local.indexOf(this);i>=0&&co._local.splice(i,1);const n={playerState:this,oldValue:t,newValue:e};if(this.hasOwner||(this.hasOwner=!0,(o=this.onFirstOwnerChangeEvent)==null||o.invoke(n)),(a=this.onOwnerChangeEvent)==null||a.invoke(n),this.owner===this.context.connection.connectionId){co._local.push(this);const l=new CustomEvent("local-owner-changed",{detail:n});this.dispatchEvent(l)}const r=new CustomEvent("owner-changed",{detail:n});this.dispatchEvent(r),co.dispatchEvent("ownerChanged",r)}awake(){co.all.push(this),Tl&&console.log("Registered new PlayerState",this.guid,co.all.length-1,co.all),this.context.connection.beginListen(ri.UserLeftRoom,this.onUserLeftRoom)}async start(){Tl&&console.log("PLAYERSTATE.START, owner: "+this.owner,this.context.connection.usersInRoom([])),this.owner?(this.context.connection.isInRoom||await Nh(300),this.context.connection.userIsInRoom(this.owner)==!1&&(Tl&&console.log(`PlayerSync.start → doDestroy "${this.name}" because user "${this.owner}" is not in room anymore...`,"Currently in room:",...this.context.connection.usersInRoom()),this.doDestroy())):this.owner||(Tl&&console.warn("PlayerState.start → owner is undefined!",this.name),setTimeout(()=>{!this.destroyed&&!this.owner?this.dontDestroy?Tl&&console.warn("PlayerState.start → owner is still undefined but dontDestroy is set to true",this.name):(Tl&&console.warn(`PlayerState.start → owner is still undefined: destroying "${this.name}" instance now`),this.doDestroy()):Tl&&console.log("PlayerState.start → owner is assigned",this.owner)},2e3))}doDestroy(){Tl&&console.log("PlayerSync.doDestroy → syncDestroy",this.name),cM(this.gameObject,this.context.connection,!0,{saveInRoom:!1})}onDestroy(){if(this.context.connection.stopListen(ri.UserLeftRoom,this.onUserLeftRoom),co.all.splice(co.all.indexOf(this),1),this.isLocalPlayer){const e=co._local.indexOf(this);e>=0&&co._local.splice(e,1)}}},p(tC,"_all",[]),p(tC,"_local",[]),p(tC,"_callbacks",{}),tC);let Xl=co;PP([G5(Xl.prototype.onOwnerChange)],Xl.prototype,"owner",2);const yDe=ee("debugavatar"),fh=class extends ze{constructor(){super(...arguments);p(this,"connectionId");p(this,"avatar")}static getAvatar(t){return t>=0&&t<fh.instances.length?fh.instances[t]:null}static onAvatarMarkerCreated(t){return fh._onNewAvatarMarkerAdded.push(t),t}static onAvatarMarkerDestroyed(t){return fh._onAvatarMarkerDestroyed.push(t),t}awake(){fh.instances.push(this),yDe&&console.log(this);for(const t of fh._onNewAvatarMarkerAdded)t({avatarMarker:this,gameObject:this.gameObject})}onDestroy(){fh.instances.splice(fh.instances.indexOf(this),1);for(const t of fh._onAvatarMarkerDestroyed)t({avatarMarker:this,gameObject:this.gameObject})}isLocalAvatar(){return this.connectionId===this.context.connection.connectionId}};let br=fh;p(br,"instances",[]),p(br,"_onNewAvatarMarkerAdded",[]),p(br,"_onAvatarMarkerDestroyed",[]);var bDe=Object.defineProperty,xDe=Object.getOwnPropertyDescriptor,vDe=(s,e,t,i)=>{for(var n=i>1?void 0:i?xDe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&bDe(e,t,n),n};const pb=ee("debugxrflags"),Xoe=ee("disablexrflags");Xoe&&console.warn("XRFlags are disabled");var wd=(s=>(s[s.Never=0]="Never",s[s.Browser=1]="Browser",s[s.AR=2]="AR",s[s.VR=4]="VR",s[s.FirstPerson=8]="FirstPerson",s[s.ThirdPerson=16]="ThirdPerson",s[s.All=4294967295]="All",s))(wd||{});const eW=class{constructor(){p(this,"Mask",17)}Has(e){return(this.Mask&e)!==0}Set(e){pb&&console.warn("Set XR flag state to",e),this.Mask=e,Dl.Apply()}Enable(e){this.Mask|=e,Dl.Apply()}Disable(e){this.Mask&=~e,Dl.Apply()}Toggle(e){this.Mask^=e,Dl.Apply()}EnableAll(){this.Mask=-1,Dl.Apply()}DisableAll(){this.Mask=0,Dl.Apply()}};let xo=eW;p(xo,"Global",new eW);var iC;const zu=(iC=class extends ze{constructor(){super(...arguments);p(this,"visibleIn")}static Apply(){for(const e of this.registry)e.UpdateVisible(xo.Global)}awake(){zu.registry.push(this)}onEnable(){zu.firstApply?this.UpdateVisible(xo.Global):(zu.firstApply=!0,zu.Apply())}onDestroy(){const e=zu.registry.indexOf(this);e>=0&&zu.registry.splice(e,1)}get isOn(){return this.gameObject.visible}UpdateVisible(e=null){if(Xoe)return;let t;const i=e;if(i&&typeof i=="number"&&(console.assert(typeof i=="number","XRFlag.UpdateVisible: state must be a number",i),pb&&console.log(i),zu.buffer.Mask=i,e=zu.buffer),e instanceof xo?(pb&&console.warn(this.name,"use passed in mask",e.Mask,this.visibleIn),t=e.Has(this.visibleIn)):(pb&&console.log(this.name,"use global mask"),xo.Global.Has(this.visibleIn)),t!==void 0)if(t)pb&&console.log(this.name,"is visible",this.gameObject.uuid),$.setActive(this.gameObject,!0);else{if(pb&&console.log(this.name,"is not visible",this.gameObject.uuid),!this.gameObject.visible)return;this.gameObject.visible=!1}}},p(iC,"registry",[]),p(iC,"firstApply"),p(iC,"buffer",new xo),iC);let Dl=zu;vDe([I()],Dl.prototype,"visibleIn",2);var _De=Object.defineProperty,CDe=Object.getOwnPropertyDescriptor,k5=(s,e,t,i)=>{for(var n=i>1?void 0:i?CDe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&_De(e,t,n),n};const R_=ee("debugwebxr"),uY=new Ve().setFromAxisAngle(new T(0,1,0),Math.PI);class bm extends ze{constructor(){super(...arguments);p(this,"head");p(this,"leftHand");p(this,"rightHand");p(this,"_leftHandMeshes");p(this,"_rightHandMeshes");p(this,"_syncTransforms")}async onEnterXR(t){if(!this.activeAndEnabled)return;R_&&console.warn("AVATAR ENTER XR",this.guid,this.sourceId,this,this.activeAndEnabled),this._syncTransforms&&(this._syncTransforms.length=0),await this.prepareAvatar();const i=Xl.getFor(this);if(i!=null&&i.owner){const n=this.gameObject.addComponent(br);n.avatar=this.gameObject,n.connectionId=i.owner}else this.context.connection.isConnected?console.error("No player state found for avatar",this):i&&!this.context.connection.isConnected&&(i.dontDestroy=!0)}onLeaveXR(t){const i=this.gameObject.getComponent(br);i&&i.destroy()}onUpdateXR(t){var c,h;if(!this.activeAndEnabled)return;const i=Xl.isLocalPlayer(this);if(!i)return;const n=t.xr;if(n.rig&&n.rig.gameObject!==this.gameObject.parent&&(this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),this.gameObject.scale.set(1,1,1),n.rig.gameObject.add(this.gameObject)),this._syncTransforms&&i)for(const d of this._syncTransforms)d.fastMode=!0,d.isOwned()||d.requestOwnership();if(this.head&&this.context.mainCamera){const d=this.head.asset;if(d.position.copy(this.context.mainCamera.position),d.position.x*=-1,d.position.z*=-1,d.quaternion.copy(this.context.mainCamera.quaternion),d.quaternion.x*=-1,this.context.time.frameCount%10===0){const u=$.getComponentsInChildren(this.head.asset,Dl);for(const f of u)f.enabled=!1,f.gameObject.visible=!1}}const r=t.xr.leftController,o=(c=this.leftHand)==null?void 0:c.asset;r&&o?(o.position.copy(r.gripPosition),o.quaternion.copy(r.gripQuaternion),o.quaternion.multiply(uY),o.visible=r.isTracking,this.updateHandVisibility(r,o,this._leftHandMeshes)):o&&o.visible&&(o.visible=!1);const a=t.xr.rightController,l=(h=this.rightHand)==null?void 0:h.asset;a&&l?(l.position.copy(a.gripPosition),l.quaternion.copy(a.gripQuaternion),l.quaternion.multiply(uY),l.visible=a.isTracking,this.updateHandVisibility(a,l,this._rightHandMeshes)):l&&l.visible&&(l.visible=!1)}onBeforeRender(){this.context.xr&&this.context.time.frame%10===0&&this.updateRemoteAvatarVisibility()}updateHandVisibility(t,i,n){if(n){const r=t.model&&t.model.visible&&t.model!==i;n.forEach(o=>{sp(o,!r)})}}updateRemoteAvatarVisibility(){var t,i,n;if(this.context.connection.isConnected){const r=Xl.getFor(this);if(r&&r.isLocalPlayer==!1){const o=Vt.getXRSync(this.context);if(o&&o.hasState(r.owner)){this.tryFindAvatarObjectsIfMissing();const a=(t=this.leftHand)==null?void 0:t.asset;a&&(a.visible=(o==null?void 0:o.isTracking(r.owner,"left"))??!1);const l=(i=this.rightHand)==null?void 0:i.asset;l&&(l.visible=(o==null?void 0:o.isTracking(r.owner,"right"))??!1)}if((n=this.head)!=null&&n.asset){const a=$.getComponentsInChildren(this.head.asset,Dl);for(const l of a)l.enabled=!1,l.gameObject.visible=!0}}}}tryFindAvatarObjectsIfMissing(){if(!this.head||!this.leftHand||!this.rightHand){const t={head:this.head,leftHand:this.leftHand,rightHand:this.rightHand};Jse.tryFindAvatarObjects(this.gameObject,this.sourceId||"",t),t.head&&(this.head=t.head),t.leftHand&&(this.leftHand=t.leftHand),t.rightHand&&(this.rightHand=t.rightHand)}}async prepareAvatar(){if(this.tryFindAvatarObjectsIfMissing(),this.head)this.head instanceof ye&&(this.head=new gi("",this.sourceId,this.head));else{const t=new ye;t.name="Head";const i=zm.createPrimitive($0.Cube);t.add(i),this.gameObject.add(t),this.head=new gi("",this.sourceId,t),R_&&console.log("Create head",t)}if(this.rightHand)this.rightHand instanceof ye&&(this.rightHand=new gi("",this.sourceId,this.rightHand));else{const t=new ye;t.name="Right Hand",this.gameObject.add(t),this.rightHand=new gi("",this.sourceId,t),R_&&console.log("Create right hand",t)}if(this.leftHand)this.leftHand instanceof ye&&(this.leftHand=new gi("",this.sourceId,this.leftHand));else{const t=new ye;t.name="Left Hand",this.gameObject.add(t),this.leftHand=new gi("",this.sourceId,t),R_&&console.log("Create left hand",t)}await this.loadAvatarObjects(this.head,this.leftHand,this.rightHand),this._leftHandMeshes=[],this.leftHand.asset.traverse(t=>{t!=null&&t.isMesh&&this._leftHandMeshes.push(t)}),this._rightHandMeshes=[],this.rightHand.asset.traverse(t=>{t!=null&&t.isMesh&&this._rightHandMeshes.push(t)}),Xl.isLocalPlayer(this.gameObject)&&(this._syncTransforms=$.getComponentsInChildren(this.gameObject,$d))}async loadAvatarObjects(t,i,n){const r=t.loadAssetAsync(),o=i.loadAssetAsync(),a=n.loadAssetAsync(),l=new Array;r&&l.push(r),o&&l.push(o),a&&l.push(a);const c=await YB(l);R_&&console.log("Avatar loaded results:",c)}}k5([I(gi)],bm.prototype,"head",2);k5([I(gi)],bm.prototype,"leftHand",2);k5([I(gi)],bm.prototype,"rightHand",2);class Wd{static Add(e,t,i=null){if(t){for(const n of this.Pois)if(n.obj===t)return;this.Pois.push({obj:t,avatar:i}),this.LastChangeTime=e.time.time}}static Remove(e,t){var i;if(t){for(const n of this.Pois)if(n.obj===t){this.Pois.splice(this.Pois.indexOf(n),1),this.LastChangeTime=(e==null?void 0:e.time.time)??((i=Wt.Current)==null?void 0:i.time.time);return}}}}p(Wd,"Pois",[]),p(Wd,"LastChangeTime",0);class wDe{constructor(){p(this,"guid");p(this,"position",new T)}}class wS extends ze{constructor(){super(...arguments);p(this,"target",null);p(this,"avatar",null);p(this,"_model",null);p(this,"_targetModel",new wDe);p(this,"_currentTargetObject",null);p(this,"_lastUpdateTime",0);p(this,"_lookDuration",0);p(this,"_lastPoiChangedTime",0)}set controlledTarget(t){this.target=t;const i=Y.get("MoveRandom");if(i&&this.target){const n=$.getComponent(this.target,i);n&&n.destroy()}}awake(){if(this.avatar=$.getComponentInParent(this.gameObject,br),this.avatar){const t=$.getComponentInParent(this.gameObject,br);this._model=new $O(this.context.connection,this.guid),t!=null&&t.isLocalAvatar&&this._model.requestOwnership()}this.context.connection.beginListen("avatar-look-target-changed",t=>{var i;this.target&&t&&t.guid===((i=this.avatar)==null?void 0:i.guid)&&_r(this.target,t.position)})}update(){var i;if((!this.context.connection.isConnected||(i=this._model)!=null&&i.hasOwnership)&&(Wd.LastChangeTime!==this._lastPoiChangedTime&&(this._lastPoiChangedTime=Wd.LastChangeTime,this._lookDuration=0),this.selectTarget(),this._currentTargetObject&&this.context.time.frameCount%10===0&&this.target)){const n=$t(this._currentTargetObject);_r(this.target,n),this.context.connection.isConnected&&this.avatar&&(this.context.connection.send("avatar-look-target-changed",this._targetModel),this._targetModel.guid=this.avatar.guid,this._targetModel.position.copy(n))}}selectTarget(){if(this.context.time.time-this._lastUpdateTime>this._lookDuration){this._lastUpdateTime=this.context.time.time,this._lookDuration=Math.random()*.5+.2;const i=Wd.Pois;if(i.length>0){const n=i[Math.floor(Math.random()*i.length)];if(n&&n.obj){if(n.avatar&&n.avatar===this.avatar)return;this._currentTargetObject=n.obj}}}}}function Ooe(s){return s&&s.isComponent}const SDe=Symbol("object"),mD=new $l(()=>new T,20);class Zoe{constructor(e,t,i,n,r,o){p(this,"_point");p(this,"_normal");p(this,"_tangentVelocity");p(this,"distance");p(this,"impulse");p(this,"friction");this._point=e,this.distance=t,this._normal=i,this.impulse=n,this.friction=r,this._tangentVelocity=o}get point(){return mD.get().set(this._point.x,this._point.y,this._point.z)}get normal(){return mD.get().set(this._normal.x,this._normal.y,this._normal.z)}get tangentVelocity(){return mD.get().set(this._tangentVelocity.x,this._tangentVelocity.y,this._tangentVelocity.z)}}class Woe{constructor(e,t,i){p(this,"contacts");p(this,"me");p(this,"_collider");p(this,"_gameObject");this.me=e,this._collider=t,this._gameObject=t.gameObject,this.contacts=i}get collider(){return this._collider}get gameObject(){return this._gameObject}get rigidBody(){var e;return(e=this.collider)==null?void 0:e.attachedRigidbody}}class Hoe{constructor(e,t){p(this,"object");p(this,"collider");this.object=e,this.collider=t}}const ks=ee("debugnetworkingstreams");var Bd=(s=>(s.Connected="peer-user-connected",s.StreamReceived="receive-stream",s.StreamEnded="call-ended",s.Disconnected="peer-user-disconnected",s.UserJoined="user-joined",s))(Bd||{});class N5{constructor(e,t){p(this,"type","call-ended");p(this,"userId");p(this,"direction");this.userId=e,this.direction=t}}class Qoe{constructor(e,t,i){p(this,"type","receive-stream");p(this,"userId");p(this,"stream");p(this,"target");this.userId=e,this.stream=t,this.target=i}}class MDe{constructor(e,t){p(this,"guid");p(this,"peerId");p(this,"dontSave",!0);this.guid=e.id,this.peerId=t}}var Koe=(s=>(s.Incoming="incoming",s.Outgoing="outgoing",s))(Koe||{});class IDe extends Mr{constructor(t,i,n,r=null){super();p(this,"peerId");p(this,"userId");p(this,"direction");p(this,"call");p(this,"_stream",null);p(this,"_isDisposed",!1);this.peerId=i.peer,this.userId=t,this.call=i,this.direction=n,this._stream=r,i.on("stream",o=>{if(ks&&console.log("Receive stream",`
Audio:`,o.getAudioTracks(),`
Video:`,o.getVideoTracks()),this._stream=o,n==="incoming"){const a=new Qoe(t,o,this);this.dispatchEvent(a)}}),i.on("close",()=>{this.dispatchEvent(new N5(t,n))})}get stream(){return this._stream}close(){this._isDisposed||(this._isDisposed=!0,this.call.close(),Pd(this._stream))}get isOpen(){var t;return((t=this.call.peerConnection)==null?void 0:t.connectionState)==="connected"}get isOpening(){var t;return((t=this.call.peerConnection)==null?void 0:t.connectionState)==="connecting"}get isClosed(){return!this.isOpen||this._isDisposed}}function pY(s){return s=s.replace("a=fmtp:111 minptime=10;useinbandfec=1","a=fmtp:111 ptime=5;useinbandfec=1;stereo=1;maxplaybackrate=48000;maxaveragebitrat=128000;sprop-stereo=1"),s}const Ub=class extends Mr{constructor(t,i){super();p(this,"updateCalls",()=>{var t;for(let i=this._incomingCalls.length-1;i>=0;i--){const n=this._incomingCalls[i];n.isClosed&&!n.isOpening&&this._incomingCalls.splice(i,1)}for(let i=this._outgoingCalls.length-1;i>=0;i--){const n=this._outgoingCalls[i];let r=!1;n.isClosed&&!n.isOpening&&((t=n.stream)!=null&&t.active?ks&&console.warn("!!! Stream is still active, don't remove call",n.userId,"Your id: "+this.context.connection.connectionId):(ks&&console.warn("!!! Remove closed call",n.userId),r=!0)),this.context.connection.userIsInRoom(n.userId)===!1&&(ks&&console.warn("!!! User is not in room anymore, remove call",n.userId),r=!0),r&&(n.close(),this._outgoingCalls.splice(i,1))}});p(this,"id");p(this,"context");p(this,"_incomingCalls",[]);p(this,"_outgoingCalls",[]);p(this,"_peer");p(this,"_enabled",!1);p(this,"_enabledPeer",!1);p(this,"onConnectRoomFn",this.onConnectRoom.bind(this));p(this,"onPeerConnect",t=>{if(ks&&console.log("PEER opened as",t),t===null){console.error("Peer connection failed",t);return}this.context.connection.send("peer-user-connected",new MDe(this,t))});p(this,"onPeerClose",()=>{ks&&console.log("PEER closed"),this.updateCalls()});p(this,"onPeerDisconnected",()=>{ks&&console.log("PEER disconnected"),this.updateCalls()});p(this,"onPeerError",t=>{ks&&console.error("PEER error",t)});p(this,"onPeerReceivingCall",t=>{t.answer(void 0,{sdpTransform:i=>pY(i)}),this.registerCall(t,"incoming",null)});this.context=t,this.id=i,this.setupPeer(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}static getOrCreate(t,i){if(Ub.instances.has(i))return Ub.instances.get(i);const n=new Ub(t,i);return Ub.instances.set(i,n),n}getMyPeerId(){if(this.context.connection.connectionId)return this.getPeerIdFromUserId(this.context.connection.connectionId)}getPeerIdFromUserId(t){return this.id+"-"+t}getUserIdFromPeerId(t){return t.substring(this.id.length+1)}makeCall(t,i){var o;if(!(i!=null&&i.id)){ks?console.warn("Can not make a call: mediastream has no id or is undefined"):console.debug("Can not make a call: mediastream has no id or is undefined");return}const n={metadata:{userId:this.context.connection.connectionId,streamId:i.id},sdpTransform:a=>pY(a)},r=(o=this._peer)==null?void 0:o.call(t,i,n);if(r){const a=this.registerCall(r,"outgoing",i);return ks&&console.warn(`📞 CALL ${t}`,`
Outgoing:`,this._outgoingCalls,`
Incoming:`,this._incomingCalls),a}else ks&&console.error("Failed to make call",t,i,this._peer)}closeAll(){for(const t of this._incomingCalls)t.close();for(const t of this._outgoingCalls)t.close();this.updateCalls()}get peer(){return this._peer}get incomingCalls(){return this._incomingCalls}enable(){this._enabled||(this._enabled=!0,this.context.connection.beginListen(ri.JoinedRoom,this.onConnectRoomFn),this.subscribePeerEvents())}disable(){this._enabled&&(this._enabled=!1,this.context.connection.stopListen(ri.JoinedRoom,this.onConnectRoomFn),this.unsubscribePeerEvents())}onConnectRoom(){this.setupPeer()}setupPeer(){if(this.context.connection.connectionId&&!this._enabledPeer){if(this._enabledPeer=!0,!this._peer){const t=this.getMyPeerId();t?this._peer=zse(t):console.error("Failed to setup peerjs because we dont have a connection id",this.context.connection.connectionId)}this._enabled&&this.subscribePeerEvents()}}subscribePeerEvents(){this._peer&&(this._peer.on("open",this.onPeerConnect),this._peer.on("close",this.onPeerClose),this._peer.on("call",this.onPeerReceivingCall),this._peer.on("disconnected",this.onPeerDisconnected),this._peer.on("error",this.onPeerError))}unsubscribePeerEvents(){this._peer&&(this._peer.off("open",this.onPeerConnect),this._peer.off("close",this.onPeerClose),this._peer.off("call",this.onPeerReceivingCall),this._peer.off("disconnected",this.onPeerDisconnected),this._peer.off("error",this.onPeerError))}registerCall(t,i,n){const r=t.metadata;(!r||!r.userId)&&console.error("Missing call metadata",t);const o=r.userId;i==="incoming"&&ks?console.warn("← Receive call from",t.metadata,t.connectionId):ks&&console.warn("→ Make call to",t.metadata);const a=i==="incoming"?this._incomingCalls:this._outgoingCalls,l=new IDe(o,t,i,n);return a.push(l),t.on("error",c=>{console.error("Call error",c)}),t.on("close",()=>{ks&&console.log("Call ended",t.metadata);const c=a.indexOf(l);c!==-1&&a.splice(c,1),l.close(),this.dispatchEvent(new N5(o,i))}),l.addEventListener("call-ended",c=>{this.dispatchEvent(c)}),i==="incoming"&&(l.addEventListener("receive-stream",c=>{this.dispatchEvent(c)}),t.on("stream",()=>{ks&&console.log("Received stream for call",t.metadata);let c=0;const h=setInterval(()=>{const d=c===0;!l.isOpen&&d&&(ks&&console.warn("Close call because stream is not active",t.metadata),c+=1,clearInterval(h),l.close())},2e3)})),l}};let G0=Ub;p(G0,"instances",new Map);class wM extends Mr{constructor(t,i){super();p(this,"context");p(this,"peer");p(this,"_sendingStreams",new Map);p(this,"debug",!1);p(this,"_enabled",!1);p(this,"_tickIntervalId");p(this,"tick",()=>{this.updateSendingCalls()});p(this,"onJoinedRoom",t=>{this._sendingStreams.size>0&&(this.debug&&console.warn(`${t!=null&&t.userId?`User ${t.userId}`:"You"} joined room`,t,this._sendingStreams.size),this.updateSendingCalls())});p(this,"onLeftRoom",t=>{this.debug&&console.warn(`${(t==null?void 0:t.userId)||"You"} left room`,t),this.stopCallsToUsersThatAreNotInTheRoomAnymore(),this.peer.closeAll()});p(this,"onCallStreamReceived",t=>{this.debug&&console.log("Call with "+t.userId+" started"),this.dispatchEvent({type:"receive-stream",target:this,stream:t.stream,userId:t.userId}),this.debug&&this.debugLogCurrentState()});p(this,"onCallEnded",t=>{this.debug&&console.log("Call with "+t.userId+" ended"),this.dispatchEvent(t),this.debug&&this.debugLogCurrentState()});p(this,"onUserConnected",t=>{if(this.peer.id===t.guid){this.debug&&console.log("PEER USER CONNECTED",t.guid,t,this._sendingStreams.size);const i=this._sendingStreams.keys().next().value;this.peer.makeCall(t.peerId,i)}else ks&&console.log("Unknown user connected",t.guid,t.peerId)});p(this,"onUserLeft",t=>{this.debug&&console.log("User left room: "+t.userId),this.stopCallsToUsersThatAreNotInTheRoomAnymore()});if(Ooe(t)){const n=t;t=n.context,i=G0.getOrCreate(n.context,n.guid)}else typeof i=="string"&&(i=G0.getOrCreate(t,i));if(t){if(!(t instanceof Wt))throw new Error("Failed to create NetworkedStreams because context is not an instance of Context")}else throw new Error("Failed to create NetworkedStreams because context is undefined");if(!i)throw new Error("Failed to create NetworkedStreams because peer is undefined");this.context=t,this.peer=i,ks&&(this.debug=!0)}static create(t,i){const n=G0.getOrCreate(t.context,i||t.context.connection.connectionId||t.guid);return new wM(t.context,n)}startSendingStream(t){this._sendingStreams.has(t)?console.warn("Received start sending stream with stream that is already being sent"):(this._sendingStreams.set(t,[]),this.updateSendingCalls())}stopSendingStream(t){if(t){const i=this._sendingStreams.get(t);if(i){for(const n of i)n.close();i.length=0}this._sendingStreams.delete(t),i&&this.debug&&this.debugLogCurrentState()}this.updateSendingCalls()}get enabled(){return this._enabled}enable(){this._enabled||(this._enabled=!0,this.peer.enable(),this.peer.addEventListener("receive-stream",this.onCallStreamReceived),this.peer.addEventListener("call-ended",this.onCallEnded),this.context.connection.beginListen("peer-user-connected",this.onUserConnected),this.context.connection.beginListen(ri.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(ri.UserJoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(ri.UserLeftRoom,this.onUserLeft),this.context.connection.beginListen(ri.LeftRoom,this.onLeftRoom),this._tickIntervalId=setInterval(this.tick,5e3))}disable(){this._enabled&&(this._enabled=!1,this.peer.disable(),this.peer.removeEventListener("receive-stream",this.onCallStreamReceived),this.peer.removeEventListener("call-ended",this.onCallEnded),this.context.connection.stopListen("peer-user-connected",this.onUserConnected),this.context.connection.stopListen(ri.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(ri.UserJoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(ri.UserLeftRoom,this.onUserLeft),this.context.connection.stopListen(ri.LeftRoom,this.onLeftRoom),this._tickIntervalId!=null&&(clearInterval(this._tickIntervalId),this._tickIntervalId=void 0))}updateSendingCalls(){const t=this.context.connection.connectionId;for(const i of this._sendingStreams.keys()){const n=this._sendingStreams.get(i)||[];for(const r of this.context.connection.usersInRoom()){if(r===t)continue;const o=this.peer.getPeerIdFromUserId(r);if(n.find(l=>{var c;return l.peerId===o&&l.direction==="outgoing"&&!l.isClosed&&((c=l.stream)==null?void 0:c.active)}))ks&&console.debug("Already have a call with user "+r+" / peer "+o);else{const l=this.peer.makeCall(o,i);l&&n.push(l)}}this._sendingStreams.set(i,n)}this.stopCallsToUsersThatAreNotInTheRoomAnymore()}stopCallsToUsersThatAreNotInTheRoomAnymore(){for(const t of this._sendingStreams.keys()){const i=this._sendingStreams.get(t);if(i)for(let n=i.length-1;n>=0;n--){const r=i[n];this.context.connection.userIsInRoom(r.userId)?ks&&(this.context.connection.connectionId===r.userId?console.warn(`You are still in the room [${n}] ${r.userId}`):console.log(`User is still in room [${n}] ${r.userId}`)):(ks&&console.log(`Remove call ${[n]} to user that is not in room anymore ${r.userId}`),r.close(),i.splice(n,1))}}this.peer.updateCalls(),this.debug&&this.debugLogCurrentState()}debugLogCurrentState(){console.warn(`You (${this.context.connection.connectionId}) are currently sending ${this._sendingStreams.size} and receiving ${this.peer.incomingCalls.length} calls (${this.peer.incomingCalls.map(t=>t.userId).join(", ")})`,this.peer.incomingCalls)}}function Pd(s){if(s&&s instanceof MediaStream)for(const e of s.getTracks())e.stop()}var TDe=Object.defineProperty,EDe=Object.getOwnPropertyDescriptor,D5=(s,e,t,i)=>{for(var n=i>1?void 0:i?EDe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&TDe(e,t,n),n};const RDe="noVoip",LDe=ee("debugvoip");class Om extends ze{constructor(){super(...arguments);p(this,"autoConnect",!0);p(this,"runInBackground",!0);p(this,"createMenuButton",!0);p(this,"debug",!1);p(this,"_net");p(this,"_menubutton");p(this,"_allowSending",!0);p(this,"_outputStream",null);p(this,"onJoinedRoom",async()=>{this.debug&&console.log("VOIP: Joined room"),await Nh(300),this.autoConnect&&!this.isSending&&this._allowSending&&this.connect()});p(this,"onLeftRoom",()=>{this.debug&&console.log("VOIP: Left room"),this.disconnect();for(const t of this._incomingStreams.values())Pd(t.srcObject);this._incomingStreams.clear()});p(this,"_incomingStreams",new Map);p(this,"onReceiveStream",t=>{const i=t.target.userId,n=t.stream;let r=this._incomingStreams.get(i);r||(r=new Audio,this._incomingStreams.set(i,r)),r.srcObject=n,r.setAttribute("autoplay","true"),Lh.registerWaitForInteraction(()=>{r==null||r.play().catch(o=>{console.error("VOIP: Failed to play audio",o)})})});p(this,"onStreamEnded",t=>{const i=this._incomingStreams.get(t.userId);Pd(i==null?void 0:i.srcObject),this._incomingStreams.delete(t.userId)});p(this,"onEnabledChanged",()=>{for(const t of this._incomingStreams){const i=t[1];i.muted=!this.enabled}});p(this,"onVisibilityChanged",()=>{if(this.runInBackground)return;const i=!(document.visibilityState==="visible");this.setMuted(i);for(const n of this._incomingStreams){const r=n[1];r.muted=i}})}awake(){LDe&&(this.debug=!0),this.debug&&(console.log("VOIP debugging: press 'v' to toggle mute or 'c' to toggle connect/disconnect"),window.addEventListener("keydown",async t=>{switch(t.key.toLowerCase()){case"v":console.log("MUTE?",!this.isMuted),this.setMuted(!this.isMuted);break;case"c":this.isSending?this.disconnect():this.connect();break}}),window.addEventListener("blur",()=>{console.log("VOIP: MUTE ON BLUR"),this.setMuted(!0)}),window.addEventListener("focus",()=>{console.log("VOIP: UNMUTE ON FOCUS"),this.setMuted(!1)}))}onEnable(){this._net||(this._net=wM.create(this)),this.debug&&(this._net.debug=!0),this._net.addEventListener(Bd.StreamReceived,this.onReceiveStream),this._net.addEventListener(Bd.StreamEnded,this.onStreamEnded),this._net.enable(),this.autoConnect&&this.context.connection.isConnected&&this.connect(),this.context.connection.beginListen(ri.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(ri.LeftRoom,this.onLeftRoom),this.onEnabledChanged(),this.updateButton(),window.addEventListener("visibilitychange",this.onVisibilityChanged)}onDisable(){var t;this._net&&(this._net.stopSendingStream(this._outputStream),this._net.removeEventListener(Bd.StreamReceived,this.onReceiveStream),this._net.removeEventListener(Bd.StreamEnded,this.onStreamEnded),(t=this._net)==null||t.disable()),this.context.connection.stopListen(ri.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(ri.LeftRoom,this.onLeftRoom),this.onEnabledChanged(),this.updateButton(),window.removeEventListener("visibilitychange",this.onVisibilityChanged)}onDestroy(){var t;(t=this._menubutton)==null||t.remove(),this._menubutton=void 0}get isSending(){return this._outputStream!=null&&this._outputStream.active}async connect(t){var i,n;if(!this._net)return console.error("Cannot connect to voice chat - NetworkedStreams not initialized. Make sure the component is enabled before calling this method."),!1;if(this.context.connection.isConnected){if(!await exports.DeviceUtilities.microphonePermissionsGranted())return console.error("Cannot connect to voice chat - microphone permissions not granted"),this.updateButton(),!1}else return console.error("Cannot connect to voice chat - not connected to server"),this.updateButton(),!1;return this._allowSending=!0,(i=this._net)==null||i.stopSendingStream(this._outputStream),Pd(this._outputStream),this._outputStream=await this.getAudioStream(t),this._outputStream?(this.debug&&console.log("VOIP: Got audio stream"),(n=this._net)==null||n.startSendingStream(this._outputStream),this.updateButton(),!0):(this.updateButton(),await exports.DeviceUtilities.microphonePermissionsGranted()?console.error("VOIP: Could not get audio stream - please make sure to connect an audio device and grant microphone permissions"):tM("Microphone permissions not granted: Please grant microphone permissions to use voice chat"),(this.debug||Qe())&&console.log("VOIP: Failed to get audio stream"),!1)}disconnect(t){var i;t!=null&&t.remember&&(this._allowSending=!1),(i=this._net)==null||i.stopSendingStream(this._outputStream),Pd(this._outputStream),this._outputStream=null,this.updateButton()}setMuted(t){var n;const i=(n=this._outputStream)==null?void 0:n.getAudioTracks();if(i)for(const r of i)r.enabled=!t}get isMuted(){var i;if(this._outputStream===null)return!1;const t=(i=this._outputStream)==null?void 0:i.getAudioTracks();if(t){for(const n of t)if(!n.enabled)return!0}return!1}async updateButton(){var t;if(this.createMenuButton){if(this._menubutton||(this._menubutton=document.createElement("button"),this._menubutton.addEventListener("click",()=>{this.isSending?this.disconnect({remember:!0}):this.connect(),exports.DeviceUtilities.microphonePermissionsGranted().then(i=>{i||An("<strong>Microphone permissions not granted</strong>. Please allow your browser to use the microphone to be able to talk. Click on the button on the left side of your browser's address bar to allow microphone permissions.")})})),this._menubutton){this.context.menu.appendChild(this._menubutton),this.activeAndEnabled?this._menubutton.style.display="":this._menubutton.style.display="none",this._menubutton.title=this.isSending?"Click to disable your microphone":"Click to enable your microphone";let i=(this.isSending,""),n=this.isSending?"mic":"mic_off";await exports.DeviceUtilities.microphonePermissionsGranted()||(i="No Permission",n="mic_off",this._menubutton.title="Microphone permissions not granted. Please allow your browser to use the microphone to be able to talk. This can usually be done in the addressbar of the webpage."),this._menubutton.innerText=i,this._menubutton.prepend(bo(n)),this.context.connection.isConnected==!1?this._menubutton.setAttribute("disabled",""):this._menubutton.removeAttribute("disabled")}}else this.activeAndEnabled||(t=this._menubutton)==null||t.remove()}getFrequency(t){return this.unsupported_getfrequency||(this.unsupported_getfrequency=!0,Qe()&&An("VOIP: getFrequency is currently not supported"),console.warn("VOIP: getFrequency is currently not supported")),null}async getAudioStream(t){if(!navigator.mediaDevices.getUserMedia)return console.error("No getDisplayMedia support"),null;const i=async r=>await navigator.mediaDevices.getUserMedia({audio:r??!0,video:!1}).catch(o=>(console.warn("VOIP failed getting audio stream",o),null)),n=await i(t);if(!n)return null;if(exports.DeviceUtilities.isiOS()&&(t==null?void 0:t.deviceId)===void 0){const o=(await navigator.mediaDevices.enumerateDevices()).find(a=>(a.kind==="audioinput"||a.kind==="audiooutput")&&!a.label.includes("iPhone"));if(o){const a=Object.assign({},t);return a.deviceId=o.deviceId,await i(a)}}return n}}D5([I()],Om.prototype,"autoConnect",2);D5([I()],Om.prototype,"runInBackground",2);D5([I()],Om.prototype,"createMenuButton",2);var BDe=Object.defineProperty,PDe=Object.getOwnPropertyDescriptor,Yoe=(s,e,t,i)=>{for(var n=i>1?void 0:i?PDe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&BDe(e,t,n),n};const GDe=ee("debugmouth");class SM extends ze{constructor(){super(...arguments);p(this,"idle",[]);p(this,"talking",[]);p(this,"marker",null);p(this,"voip",null);p(this,"lastMouthChangeTime",0);p(this,"mouthChangeLength",0)}awake(){setTimeout(()=>{this.voip=$.findObjectOfType(Om,this.context),this.marker||(this.marker=$.getComponentInParent(this.gameObject,br))},3e3)}update(){var n;if(!this.voip||this.context.time.frameCount%10!==0)return;let t=((n=this.marker)==null?void 0:n.connectionId)??null;if(!t){GDe&&(t=null);return}const i=this.voip.getFrequency(t)??0;this.updateLips(i)}updateLips(t){if(this.context.time.time-this.lastMouthChangeTime>this.mouthChangeLength){if(this.mouthChangeLength=.05+Math.random()*.1,this.talking&&this.talking.length>0&&t>30){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.talking.length);this.setMouthShapeActive(this.talking,i)}else if(this.idle.length>0&&this.context.time.time-this.lastMouthChangeTime>.5){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.idle.length);this.setMouthShapeActive(this.idle,i)}}}setMouthShapeActive(t,i){if(t){t!=this.idle?this.idle.map(n=>n.visible=!1):this.talking.map(n=>n.visible=!1);for(let n=0;n<t.length;n++){const r=t[n];r&&(r.visible=n===i)}}}}Yoe([I(ye)],SM.prototype,"idle",2);Yoe([I(ye)],SM.prototype,"talking",2);class F5 extends ze{constructor(){super(...arguments);p(this,"voip",null);p(this,"marker",null);p(this,"_startPosition",null)}awake(){this.voip=$.findObjectOfType(Om,this.context),this.marker=$.getComponentInParent(this.gameObject,br)}update(){if(!this.voip||!this.marker||this.context.time.frameCount%10!==0)return;const t=this.marker.connectionId,i=this.voip.getFrequency(t);if(i==null)return;this._startPosition||(this._startPosition=this.gameObject.position.clone());const n=i/100;this.gameObject.position.y=this._startPosition.y+n*.07}}var kDe=Object.defineProperty,NDe=Object.getOwnPropertyDescriptor,GP=(s,e,t,i)=>{for(var n=i>1?void 0:i?NDe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&kDe(e,t,n),n};class MA extends ze{constructor(){super(...arguments);p(this,"eyes",[]);p(this,"lastBlinkTime",0);p(this,"blinkLength",0);p(this,"eyesOpen",!0);p(this,"state",null)}awake(){this.state=$.getComponentInParent(this.gameObject,Dl)}update(){if(!this.gameObject||!this.gameObject.visible||!this.eyes||!Array.isArray(this.eyes)||this.eyes.length===0)return;if(this.context.time.time-this.lastBlinkTime>this.blinkLength){if(this.lastBlinkTime=this.context.time.time,this.state&&!this.state.isOn||!this.activeAndEnabled)return;if(this.eyesOpen=!this.eyesOpen,this.blinkLength=Math.random(),this.eyesOpen?(this.blinkLength*=3,this.blinkLength+=.5,Math.random()<.1&&(this.blinkLength=.1+Math.random()*.2)):(this.blinkLength*=Math.random()*.2,this.blinkLength+=.1),Math.random()<.1&&(this.blinkLength*=3),this.blinkLength=Math.max(.2,this.blinkLength),this.blinkLength=Math.min(3,this.blinkLength),this.eyes)for(const i of this.eyes)i&&(i.visible=this.eyesOpen)}}}GP([I(ye)],MA.prototype,"eyes",2);GP([I()],MA.prototype,"lastBlinkTime",2);GP([I()],MA.prototype,"blinkLength",2);GP([I()],MA.prototype,"eyesOpen",2);var DDe=Object.defineProperty,FDe=Object.getOwnPropertyDescriptor,V5=(s,e,t,i)=>{for(var n=i>1?void 0:i?FDe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&DDe(e,t,n),n},IF;const Joe=(IF=class extends ze{constructor(){super(...arguments);p(this,"head",null);p(this,"eyes",null);p(this,"target",null);p(this,"brain",null);p(this,"vec",new T);p(this,"currentTargetPoint",new T)}awake(){this.brain||(this.brain=$.getComponentInParent(this.gameObject,wS)),this.brain||(this.brain=$.addComponent(this.gameObject,wS)),this.brain&&this.target&&(this.brain.controlledTarget=this.target)}update(){const e=this.target;if(e&&this.head){const t=this.eyes;if(t){const i=$t(e);this.currentTargetPoint.lerp(i,this.context.time.deltaTime/.1);const n=$t(this.head),r=this.vec.copy(this.currentTargetPoint).sub(n).normalize();if(r.length()<.1)return;const o=Joe.forward;if(o.set(0,0,1),o.applyQuaternion(gn(this.head)),o.dot(r)>.45)for(let l=0;l<t.length;l++)t[l].lookAt(this.currentTargetPoint)}}}},p(IF,"forward",new T(0,0,1)),IF);let uv=Joe;V5([I(ye)],uv.prototype,"head",2);V5([I(ye)],uv.prototype,"eyes",2);V5([I(ye)],uv.prototype,"target",2);const L_=ee("debugavatar");class kP{constructor(e,t,i,n){p(this,"root");p(this,"head");p(this,"leftHand");p(this,"rigthHand");var r;this.root=e,this.head=t,this.leftHand=i,this.rigthHand=n,(r=this.root)==null||r.traverse(o=>o.layers.set(2))}get isValid(){return this.head!==null&&this.head!==void 0}}class z5{constructor(){p(this,"avatarRegistryUrl",null)}async getOrCreateNewAvatarInstance(e,t){if(!t)return console.error("Can not create avatar: failed to provide id or root object"),null;let i=null;if(typeof t=="string"){if(i=await this.loadAvatar(e,t),!i){const r=new Zh;i=$.instantiate(xx(t,e.scene),r)}}else i=t;if(!i)return null;const n=this.findAvatar(i);return n.isValid?(L_&&console.log("[Custom Avatar] valid config",t,L_?n:""),n):(console.warn("[Custom Avatar] config isn't valid",t,L_?n:""),null)}async loadAvatar(e,t){if(console.assert(t!=null&&typeof t=="string","Avatar id must not be null"),t.length<=0||!t)return null;if(L_&&console.log("[Custom Avatar] "+t+", loading..."),t.endsWith(".glb")||(t+=".glb"),this.avatarRegistryUrl===null){const n=await fetch("./"+t);let r=null;if(n.ok){const a=await n.blob();a&&(r=await a.arrayBuffer())}if(!r)return null;const o=await kh().parseSync(e,r,null,0);return(o==null?void 0:o.scene)??null}const i=new Tp;return wP(i,e),new Promise((n,r)=>{const o=this.avatarRegistryUrl+"/"+t;i.load(o,async a=>{await kh().createBuiltinComponents(e,o,a,null,void 0),n(a.scene)},a=>{L_&&console.log("[Custom Avatar] "+a.loaded/a.total*100+"% loaded of "+a.total/1024+"kB")},a=>{console.error("[Custom Avatar] Error when loading: "+a),n(null)})})}cacheModel(e,t){}findAvatar(e){const t=e;let i=t;i.children.length==1&&(i=e.children[0]);let n=this.findAvatarPart(i,["head"]);const r=this.findAvatarPart(i,["left","hand"]),o=this.findAvatarPart(i,["right","hand"]);if(!n){n=t;const l=new T;new oi().setFromObject(n).getSize(l);const c=Math.max(l.x,l.y,l.z);console.warn("[Custom Avatar] Normalizing head scale, it's too big: "+c+" meters! Should be < 0.3m"),c>.3&&n.scale.multiplyScalar(1/c*.3)}return new kP(t,n,r,o)}findAvatarPart(e,t){const i=e.name.toLowerCase();let n=!0;for(const r of t){if(!n)break;i.indexOf(r)===-1&&(n=!1)}if(n)return e;if(e.children)for(const r of e.children){const o=this.findAvatarPart(r,t);if(o)return o}return null}handleCustomAvatarErrors(e){if(!e.ok)throw Error(e.statusText);return e}}var VDe=Object.defineProperty,zDe=Object.getOwnPropertyDescriptor,U5=(s,e,t,i)=>{for(var n=i>1?void 0:i?zDe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&VDe(e,t,n),n};class pv extends ze{constructor(){super(...arguments);p(this,"length",1);p(this,"depthTest",!0);p(this,"isGizmo",!1);p(this,"_axes",null)}onEnable(){if(this.isGizmo&&!hM)return;this._axes||(this._axes=new al(this.length)),this._axes.layers.disableAll(),this._axes.layers.set(this.layer),this.gameObject.add(this._axes);const t=this._axes.material;t&&t.depthTest!==void 0&&(t.depthTest=this.depthTest)}onDisable(){this._axes&&this.gameObject.remove(this._axes)}}U5([I()],pv.prototype,"length",2);U5([I()],pv.prototype,"depthTest",2);U5([I()],pv.prototype,"isGizmo",2);class X5 extends ze{constructor(){super(...arguments);p(this,"from");p(this,"to");p(this,"hint");p(this,"desiredDistance",1)}onEnable(){}update(){if(!this.from||!this.to||!this.hint)return;const t=$t(this.to).clone(),i=$t(this.from).clone(),n=t.distanceTo(i),r=t.clone();r.sub(i);const o=i.clone();o.add(t),o.multiplyScalar(.5);const a=$t(this.hint).clone();a.sub(o);const l=new T;l.crossVectors(a,r),l.crossVectors(r,l),l.normalize();const c=n*.5,h=Math.max(this.desiredDistance,c),d=Math.sqrt(h*h-c*c),u=l.clone();u.multiplyScalar(d),u.add(o),_r(this.gameObject,u);const f=o.clone();f.sub(l),this.gameObject.lookAt(f)}}const uE=ee("debugusdzbehaviours");class NP{constructor(){p(this,"behaviours",[]);p(this,"behaviourComponents",[]);p(this,"behaviourComponentsCopy",[]);p(this,"audioClips",[]);p(this,"audioClipsCopy",[]);p(this,"targetUuids",new Set)}get extensionName(){return"Behaviour"}addBehavior(e){this.behaviours.push(e)}addAudioClip(e){if(!e||typeof e!="string")return"";const i="audio/"+Xm.getName(e);return this.audioClips.push({clipUrl:e,filesKey:i}),i}getAllTargetUuids(){return this.targetUuids}onBeforeBuildDocument(e){if(!e.root)return Promise.resolve();const t=[];return e.root.traverse(i=>{$.foreachComponent(i,n=>{var o;const r=n;if(typeof r.createBehaviours=="function"||typeof r.beforeCreateDocument=="function"||typeof r.afterCreateDocument=="function"||typeof r.afterSerialize=="function"){this.behaviourComponents.push(r);const a=(o=r.beforeCreateDocument)==null?void 0:o.call(r,this,e);a instanceof Promise&&t.push(a)}},!1)}),uE&&console.log("onBeforeBuildDocument: all components",this.behaviourComponents),Promise.all(t)}onExportObject(e,t,i){var n;for(const r of this.behaviourComponents)(n=r.createBehaviours)==null||n.call(r,this,t,i)}onAfterBuildDocument(e){for(const d of this.behaviourComponents)typeof d.afterCreateDocument=="function"&&d.afterCreateDocument(this,e);this.behaviourComponentsCopy=this.behaviourComponents.slice(),this.behaviourComponents.length=0,this.audioClipsCopy=this.audioClips.slice(),this.audioClips.length=0;const t=new Set,i=new Set,n=new Set,r=new Set,o=uE;let a=`graph LR
`,l="";function c(d){if(d instanceof up){o&&(a+=`subgraph Group_${d.id}
`);for(const u of d.actions)o&&(a+=`${d.id}[${d.id}] -- ${d.type} --> ${u.id}[${u.id}]
`),c(u);o&&(a+=`end
`)}else if(d instanceof _a){d.tokenId==="StartAnimation"&&r.add(d);const u=d.affectedObjects;if(u)if(Array.isArray(u))for(const m of u)i.add(m),o&&(l+=`${d.id}[${d.id}] -- ${d.tokenId} --> ${m.uuid}(("${m.displayName||m.name||m.uuid}"))
`);else typeof u=="object"?(i.add(u),o&&(l+=`${d.id}[${d.id}] -- ${d.tokenId} --> ${u.uuid}(("${u.displayName||u.name||u.uuid}"))
`)):typeof u=="string"&&i.add({uuid:u});const f=d.xFormTarget;f&&(typeof f=="object"?(i.add(f),o&&(l+=`${d.id}[${d.id}] -- ${d.tokenId} --> ${f.uuid}(("${f.displayName||f.name||f.uuid}"))
`)):typeof f=="string"&&i.add({uuid:f}))}}function h(d,u){if(Array.isArray(d))for(const f of d)h(f,u);else d instanceof Zd&&(typeof d.targetId=="object"&&(t.add(d.targetId),o&&(l+=`${d.targetId.uuid}(("${d.targetId.displayName}")) --> ${d.id}[${d.id}]
`)),o&&(a+=`${d.id}((${d.id})) -- ${d.tokenId}${d.type?":"+d.type:""} --> ${u.id}[${u.tokenId||u.id}]
`))}for(const d of this.behaviours)o&&(a+=`subgraph Behavior_${d.id}
`),c(d.action),h(d.trigger,d.action),o&&(a+=`end
`);o&&(a+=`
`+l),o&&(console.log("All USDZ behaviours",this.behaviours),console.warn("The Mermaid graph can be pasted into https://massive-mermaid.glitch.me/ or https://mermaid.live/edit. It should be in your clipboard already!"),console.log(a),navigator.clipboard.writeText(a));{let d=`gantt
title Animations
dateFormat X
axisFormat %s
`;const u=Array.from(r),f=new Set;for(const y of u)if(y.affectedObjects&&typeof y.affectedObjects!="string"){if(Array.isArray(y.affectedObjects))for(const b of y.affectedObjects)f.add(b);else f.add(y.affectedObjects);o&&(d+=`section ${y.animationName} (${y.id})
`,d+=`${y.id} : ${y.start}, ${y.duration}s
`)}o&&console.log(d);const m=new Set;for(const y of f){y.getPath||console.error("USDZExporter: Animation target object has no getPath method. This is likely a bug",y);let b=y.getPath();b.startsWith("<")&&(b=b.substring(1)),b.endsWith(">")&&(b=b.substring(0,b.length-1)),m.add({path:b,obj:y})}const g=Array.from(m).sort((y,b)=>y.path.length-b.path.length),A=new Array;for(let y=0;y<g.length;y++)for(let b=y+1;b<g.length;b++)if(g[b].path.startsWith(g[y].path)){const x=g[b],v=g[y];A.push({child:x.obj.displayName+" ("+x.path+")",parent:v.obj.displayName+" ("+v.path+")"})}A.length&&console.warn("USDZExporter: There are overlapping PlayAnimation actions. This can lead to undefined runtime behaviour when playing multiple animations. Please restructure the hierarchy so that animations don't overlap.",{overlappingTargets:A,playAnimationActions:r})}for(const d of new Set([...t,...i]))if(Array.isArray(d))for(const u of d)n.add(u.uuid);else n.add(d.uuid);uE&&console.log("All Behavior trigger sources and action targets",t,i,n),this.targetUuids=new Set(n)}onAfterHierarchy(e,t){var i;if((i=this.behaviours)!=null&&i.length){t.beginBlock('def Scope "Behaviors"');for(const n of this.behaviours)n.writeTo(this,e.document,t);t.closeBlock()}}async onAfterSerialize(e){uE&&console.log("onAfterSerialize behaviours",this.behaviourComponentsCopy);for(const t of this.behaviourComponentsCopy)typeof t.afterSerialize=="function"&&(t.afterSerialize.constructor.name==="AsyncFunction"?await t.afterSerialize(this,e):t.afterSerialize(this,e));for(const{clipUrl:t,filesKey:i}of this.audioClipsCopy){if(e.files[i])return;const o=await(await(await fetch(t)).blob()).arrayBuffer(),a=new Uint8Array(o);e.files[i]=a}this.behaviourComponentsCopy.length=0,this.audioClipsCopy.length=0}}var UDe=Object.defineProperty,XDe=Object.getOwnPropertyDescriptor,O5=(s,e,t,i)=>{for(var n=i>1?void 0:i?XDe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&UDe(e,t,n),n},TF;const joe=(TF=class extends jr{constructor(){super(...arguments);p(this,"threshold",new rt(.9));p(this,"intensity",new rt(1));p(this,"scatter",new rt(.3));p(this,"selectiveBloom")}get typeName(){return"Bloom"}init(){this.threshold.valueProcessor=e=>e,this.intensity.valueProcessor=e=>e,this.scatter.valueProcessor=e=>e}onCreateEffect(){let e;if(this.selectiveBloom==null&&(this.selectiveBloom=joe.useSelectiveBloom),this.selectiveBloom){const t=e=new Yie(this.context.scene,this.context.mainCamera,{blendFunction:ai.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,radius:.85,intensity:this.intensity.value});t.inverted=!0}else e=new MO({blendFunction:ai.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,radius:.85,intensity:this.intensity.value});return this.intensity.onValueChanged=t=>{e.intensity=t},this.threshold.onValueChanged=t=>{e.luminanceMaterial.threshold=Math.pow(t,2.2)},this.scatter.onValueChanged=t=>{e.luminancePass.enabled=!0,e.luminanceMaterial.smoothing=t,e.mipmapBlurPass&&(e.mipmapBlurPass.radius=Bi.lerp(.1,.9,t))},e}},p(TF,"useSelectiveBloom",!1),TF);let IA=joe;O5([I(rt)],IA.prototype,"threshold",2);O5([I(rt)],IA.prototype,"intensity",2);O5([I(rt)],IA.prototype,"scatter",2);Kc("Bloom",IA);var ODe=Object.defineProperty,ZDe=Object.getOwnPropertyDescriptor,dl=(s,e,t,i)=>{for(var n=i>1?void 0:i?ZDe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&ODe(e,t,n),n};class ul extends ze{constructor(){super(...arguments);p(this,"attachedRigidbody",null);p(this,"isTrigger",!1);p(this,"sharedMaterial");p(this,"membership",[0]);p(this,"filter");p(this,"updateProperties",()=>{var t;(t=this.context.physics.engine)==null||t.updateProperties(this)})}get isCollider(){return!0}awake(){super.awake(),this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(en))}start(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(en))}onEnable(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(en))}onDisable(){var t;(t=this.context.physics.engine)==null||t.removeBody(this)}get body(){var t;return(t=this.context.physics.engine)==null?void 0:t.getBody(this)}updatePhysicsMaterial(){var t;(t=this.context.physics.engine)==null||t.updatePhysicsMaterial(this)}}dl([I(en)],ul.prototype,"attachedRigidbody",2);dl([I()],ul.prototype,"isTrigger",2);dl([I()],ul.prototype,"sharedMaterial",2);dl([I()],ul.prototype,"membership",2);dl([I()],ul.prototype,"filter",2);class fv extends ul{constructor(){super(...arguments);p(this,"radius",.5);p(this,"center",new T(0,0,0))}onEnable(){var t;super.onEnable(),(t=this.context.physics.engine)==null||t.addSphereCollider(this),KB(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),U3(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}}dl([ko(),I()],fv.prototype,"radius",2);dl([I(T)],fv.prototype,"center",2);const qoe=class extends ul{constructor(){super(...arguments);p(this,"size",new T(1,1,1));p(this,"center",new T(0,0,0))}static add(e,t){const i=new qoe;e.geometry.boundingBox||e.geometry.computeBoundingBox();const n=e.geometry.boundingBox;return i.size=n.getSize(new T)||new T(1,1,1),i.center=n.getCenter(new T)||new T(0,0,0),Yl(e,i),(t==null?void 0:t.rigidbody)===!0&&Yl(e,en,{isKinematic:!1}),i}onEnable(){var e;super.onEnable(),(e=this.context.physics.engine)==null||e.addBoxCollider(this,this.size),KB(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),U3(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}};let mv=qoe;dl([ko(),I(T)],mv.prototype,"size",2);dl([I(T)],mv.prototype,"center",2);class TA extends ul{constructor(){super(...arguments);p(this,"sharedMesh");p(this,"convex",!1)}onEnable(){var i,n,r;if(super.onEnable(),!this.context.physics.engine)return;(i=this.sharedMesh)!=null&&i.isMesh||(this.gameObject instanceof fe||this.gameObject instanceof Ms)&&(this.sharedMesh=this.gameObject);const t=0;if((n=this.sharedMesh)!=null&&n.isMesh)this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,kn(this.gameObject)),Ni.assignMeshLOD(this.sharedMesh,t).then(o=>{o&&this.activeAndEnabled&&this.context.physics.engine&&this.sharedMesh&&(this.context.physics.engine.removeBody(this),this.sharedMesh.geometry=o,this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,kn(this.gameObject)))});else{const o=this.sharedMesh;if(o!=null&&o.isGroup){console.warn(`MeshCollider mesh is a group "${((r=this.sharedMesh)==null?void 0:r.name)||this.gameObject.name}", adding all children as colliders. This is currently not fully supported (colliders can not be removed from world again)`,this);const a=new Array;for(const l in o.children){const c=o.children[l];c.isMesh&&(this.context.physics.engine.addMeshCollider(this,c,this.convex,kn(this.gameObject)),a.push(Ni.assignMeshLOD(c,t)))}Promise.all(a).then(l=>{var h,d;if(l.some(u=>u)==!1)return;(h=this.context.physics.engine)==null||h.removeBody(this);const c=new fe;for(const u of l)u&&this.activeAndEnabled&&(c.geometry=u,(d=this.context.physics.engine)==null||d.addMeshCollider(this,c,this.convex,kn(this.gameObject)))})}else console.warn("A MeshCollider mesh is assigned, but it's neither a Mesh nor a Group. Please report a bug!",this,this.sharedMesh)}}}dl([I(fe)],TA.prototype,"sharedMesh",2);dl([I()],TA.prototype,"convex",2);class Ep extends ul{constructor(){super(...arguments);p(this,"center",new T(0,0,0));p(this,"radius",.5);p(this,"height",2)}onEnable(){var t;super.onEnable(),(t=this.context.physics.engine)==null||t.addCapsuleCollider(this,this.height,this.radius)}}dl([I(T)],Ep.prototype,"center",2);dl([I()],Ep.prototype,"radius",2);dl([I()],Ep.prototype,"height",2);var WDe=Object.defineProperty,HDe=Object.getOwnPropertyDescriptor,Z5=(s,e,t,i)=>{for(var n=i>1?void 0:i?HDe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&WDe(e,t,n),n};class EA extends ze{constructor(){super(...arguments);p(this,"objectBounds",!1);p(this,"color");p(this,"isGizmo",!0);p(this,"_gizmoObject",null);p(this,"_boxHelper",null)}onEnable(){this.isGizmo&&!hM||(this._gizmoObject||(this.objectBounds?this._gizmoObject=new s6(this.gameObject,this.color??16776960):(this.objectBounds=!1,this._gizmoObject=t5(this.color??16776960))),this.objectBounds?(this.scene.add(this._gizmoObject),this._boxHelper=this._gizmoObject,this.startCoroutine(this.syncObjectBounds(),wn.OnBeforeRender)):this.gameObject.add(this._gizmoObject))}onDisable(){this._gizmoObject&&this.gameObject.remove(this._gizmoObject)}*syncObjectBounds(){var t;for(;this._boxHelper;)(t=this._boxHelper)==null||t.update(),yield}}Z5([I()],EA.prototype,"objectBounds",2);Z5([I(ge)],EA.prototype,"color",2);Z5([I()],EA.prototype,"isGizmo",2);const QDe=ee("gizmos"),KDe=ee("debugboxhelper"),mh=class extends ze{constructor(){super(...arguments);p(this,"box",null);p(this,"_lastMatrixUpdateFrame",-1);p(this,"_helper",null);p(this,"_color",null)}isInBox(t){var n;if(!t)return;if(this.box||(this.box=new oi),ec([t],void 0,void 0,mh.testBox),mh.testBox.isEmpty()){const r=$t(t,mh._position);mh.testBox.setFromCenterAndSize(r,mh._emptyObjectSize)}this.updateBox();const i=(n=this.box)==null?void 0:n.intersectsBox(mh.testBox);return i&&KDe&&Mt.DrawWireBox3(mh.testBox,16711680,5),i}intersects(t){return t?this.updateBox(!1).intersectsBox(t):!1}updateBox(t=!1){if(this.box||(this.box=new oi),t||this.context.time.frameCount!=this._lastMatrixUpdateFrame){const i=this._lastMatrixUpdateFrame<0;this._lastMatrixUpdateFrame=this.context.time.frameCount;const n=i,r=$t(this.gameObject,mh._position,n),o=kn(this.gameObject,mh._size);this.box.setFromCenterAndSize(r,o)}return this.box}awake(){this._helper=null,this._color=null,this.box=null}showHelper(t=null,i=!1){var n;if(!(!QDe&&!i)){if(this._helper){t&&((n=this._color)==null||n.set(t)),this.gameObject.add(this._helper);return}this._helper=t5(t),this.gameObject.add(this._helper)}}};let il=mh;p(il,"testBox",new oi),p(il,"_position",new T),p(il,"_size",new T(.01,.01,.01)),p(il,"_emptyObjectSize",new T(.01,.01,.01));class YDe extends vie{constructor(e,t={}){super(e),e._simpleState__activeStates=[],e._simpleState__normalStyles={},e._simpleState__states=t,e._simpleState__statesProperties={};for(const i in t)for(const n in t[i])e._simpleState__statesProperties[n]||(e._simpleState__statesProperties[n]=[]),e._simpleState__statesProperties[n].push(i);for(const i of e._components)e._simpleState__statesProperties[i.id]&&(e._simpleState__normalStyles[i.id]=i.inline?i.inline:i._value);e.__overridedSet=e.set,e.set=this.storeSet.bind(e),e.renderStates=this.renderStates.bind(e),e.setupState=this.setupState.bind(e),e.setState=this.setState.bind(e),e.activatePseudoState=this.activatePseudoState.bind(e),e.deactivatePseudoState=this.deactivatePseudoState.bind(e),e.togglePseudoState=this.togglePseudoState.bind(e)}act(){}attach(){}detach(){}setupState(e,t){this._simpleState__states[e]=t;const i=[];for(const n in t)this._simpleState__statesProperties[n]||(this._simpleState__statesProperties[n]=[],i.push(n)),this._simpleState__statesProperties[n].push(e);for(const n of this._components)i.indexOf(n.id)>-1&&(this._simpleState__normalStyles[n.id]=n.inline?n.inline:n._value)}renderStates(){let e={...this._simpleState__normalStyles};for(const t in this._simpleState__states)this._simpleState__activeStates.indexOf(t)>-1&&(e={...e,...this._simpleState__states[t]});this.set(e,!1)}storeSet(e,t=!0){if(t)for(const i in e)this._simpleState__statesProperties[i]&&(this._simpleState__normalStyles[i]=e[i]);this.__overridedSet(e)}activatePseudoState(e){this._simpleState__activeStates.indexOf(e)===-1&&(this._simpleState__activeStates.push(e),this.renderStates())}deactivatePseudoState(e){const t=this._simpleState__activeStates.indexOf(e);t>-1&&(this._simpleState__activeStates.splice(t,1),this.renderStates())}togglePseudoState(e){const t=this._simpleState__activeStates.indexOf(e);t>-1?this._simpleState__activeStates.splice(t,1):this._simpleState__activeStates.push(e),this.renderStates()}setState(e){Array.isArray(e)?this._simpleState__activeStates=e:this._simpleState__activeStates=[e],this.renderStates()}}var JDe=Object.defineProperty,jDe=Object.getOwnPropertyDescriptor,$oe=(s,e,t,i)=>{for(var n=i>1?void 0:i?jDe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&JDe(e,t,n),n};class gv extends ze{constructor(){super(...arguments);p(this,"effectColor");p(this,"effectDistance")}}$oe([I(hn)],gv.prototype,"effectColor",2);$oe([I(Q)],gv.prototype,"effectDistance",2);var qDe=Object.defineProperty,$De=Object.getOwnPropertyDescriptor,MM=(s,e,t,i)=>{for(var n=i>1?void 0:i?$De(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&qDe(e,t,n),n};const gD=ee("debugui"),AD=ee("debuguilayout");class W5{constructor(){p(this,"width");p(this,"height")}}class H5{constructor(){p(this,"x");p(this,"y");p(this,"width");p(this,"height")}}const dh=new T,B_=new ce,pE=new Ve,eae=class extends Xc{constructor(){super(...arguments);p(this,"_anchoredPosition");p(this,"sizeDelta",new Q(100,100));p(this,"pivot",new Q(.5,.5));p(this,"anchorMin",new Q(0,0));p(this,"anchorMax",new Q(1,1));p(this,"minWidth");p(this,"minHeight");p(this,"lastMatrix");p(this,"rectBlock");p(this,"_transformNeedsUpdate",!1);p(this,"_initialPosition");p(this,"_parentRectTransform");p(this,"_lastUpdateFrame",-1);p(this,"_lastAnchoring");p(this,"_createdBlocks",[]);p(this,"_createdTextBlocks",[])}get parent(){return this._parentRectTransform}get translation(){return this.gameObject.position}get rotation(){return this.gameObject.quaternion}get scale(){return this.gameObject.scale}get anchoredPosition(){return this._anchoredPosition||(this._anchoredPosition=new Q),this._anchoredPosition}set anchoredPosition(e){this._anchoredPosition=e}get width(){let e=this.sizeDelta.x;if(this.anchorMin.x!==this.anchorMax.x&&this._parentRectTransform){const t=this._parentRectTransform.width,i=this.anchorMax.x-this.anchorMin.x;e=t*i,e+=this.sizeDelta.x}return this.minWidth!==void 0&&e<this.minWidth?this.minWidth:e}get height(){let e=this.sizeDelta.y;if(this.anchorMin.y!==this.anchorMax.y&&this._parentRectTransform){const t=this._parentRectTransform.height,i=this.anchorMax.y-this.anchorMin.y;e=t*i,e+=this.sizeDelta.y}return this.minHeight!==void 0&&e<this.minHeight?this.minHeight:e}awake(){super.awake(),this._anchoredPosition||(this._anchoredPosition=new Q),this.lastMatrix=new ce,this.rectBlock=new ye,this.rectBlock.name=this.name,this._initialPosition=this.gameObject.position.clone(),this._initialPosition.z=0,ub(this,"_anchoredPosition",()=>{this.markDirty()}),ub(this,"sizeDelta",()=>{this.markDirty()}),ub(this,"pivot",()=>{this.markDirty()}),ub(this,"anchorMin",()=>{this.markDirty()}),ub(this,"anchorMax",()=>{this.markDirty()})}onEnable(){var e;super.onEnable(),this.rectBlock||(this.rectBlock=new ye),this.lastMatrix||(this.lastMatrix=new ce),this._lastAnchoring||(this._lastAnchoring=new Q),this._initialPosition||(this._initialPosition=new T),this._anchoredPosition||(this._anchoredPosition=new Q),this.addShadowComponent(this.rectBlock),this._transformNeedsUpdate=!0,(e=this.canvas)==null||e.registerTransform(this)}onDisable(){var e;super.onDisable(),this.removeShadowComponent(),(e=this.canvas)==null||e.unregisterTransform(this)}onParentRectTransformChanged(e){this._transformNeedsUpdate||this.onApplyTransform(AD?`${e.name} changed`:void 0)}get isDirty(){return this._transformNeedsUpdate||(this._transformNeedsUpdate=!this.lastMatrix.equals(this.gameObject.matrix)),this._transformNeedsUpdate}markDirty(){this._transformNeedsUpdate||(AD&&console.warn("RectTransform markDirty()",this.name),this._transformNeedsUpdate=!0,this._lastUpdateFrame=-1)}updateTransform(){(this._transformNeedsUpdate||!this.lastMatrix.equals(this.gameObject.matrix))&&this.canUpdate()&&this.onApplyTransform(this._transformNeedsUpdate?"Marked dirty":"Matrix changed")}canUpdate(){return this._transformNeedsUpdate&&this.activeAndEnabled&&this._lastUpdateFrame!==this.context.time.frame}onApplyTransform(e){var n;if(this.context.time.frameCount===this._lastUpdateFrame)return;this._lastUpdateFrame=this.context.time.frameCount;const t=this.shadowComponent;if(!t)return;this.gameObject.parent?this._parentRectTransform=$.getComponentInParent(this.gameObject.parent,eae):this._parentRectTransform=void 0,this._transformNeedsUpdate=!1,AD&&console.warn("RectTransform → ApplyTransform",this.name+" because "+e),this.isRoot()?this.Root.screenspace||(t.rotation.y=Math.PI):(t.matrix.identity(),t.matrixAutoUpdate=!1,dh.set(0,0,0),this.applyPivot(dh),t.matrix.setPosition(dh.x,dh.y,0),(this.gameObject.quaternion.x||this.gameObject.quaternion.y||this.gameObject.quaternion.z)&&(pE.copy(this.gameObject.quaternion),pE.x*=-1,pE.z*=-1,B_.makeRotationFromQuaternion(pE),t.matrix.premultiply(B_)),dh.set(0,0,0),this.applyAnchoring(dh),(n=this.canvas)!=null&&n.screenspace?dh.z+=.1:dh.z+=.01,B_.identity(),B_.setPosition(dh.x,dh.y,dh.z),t.matrix.premultiply(B_),t.matrix.scale(this.gameObject.scale)),this.lastMatrix.copy(this.gameObject.matrix);const i=!0;for(const r of bP(this.gameObject,Xc,i,1)){if(r===this||!r.activeAndEnabled)continue;const o=r;o.onParentRectTransformChanged&&o.onParentRectTransformChanged(this)}}applyAnchoring(e){this._lastAnchoring||(this._lastAnchoring=new Q);const t=this._lastAnchoring.sub(this._anchoredPosition);this.gameObject.position.x+=t.x,this.gameObject.position.y+=t.y,this._lastAnchoring.copy(this._anchoredPosition),e.x+=this._initialPosition.x-this.gameObject.position.x,e.y+=this._initialPosition.y-this.gameObject.position.y,e.z+=this._initialPosition.z-this.gameObject.position.z;const i=this._parentRectTransform;if(i){let n=0;const r=1-this.anchorMax.y-this.anchorMin.y;n-=i.height*.5*r,e.y+=n;let o=0;const a=1-this.anchorMax.x-this.anchorMin.x;o-=i.width*.5*a,e.x+=o}}applyPivot(e){if(this.pivot&&!this.isRoot()){const t=this.pivot.x-.5;e.x-=t*this.sizeDelta.x*this.gameObject.scale.x;const i=this.pivot.y-.5;e.y-=i*this.sizeDelta.y*this.gameObject.scale.y}}getBasicOptions(){const e={width:this.sizeDelta.x,height:this.sizeDelta.y,offset:0,backgroundOpacity:0,borderWidth:0,borderRadius:0,borderOpacity:0,letterSpacing:-.03};return this.ensureValidSize(e),e}ensureValidSize(e,t=1e-4){return e.width<=0&&(e.width=t),e.height<=0&&(e.height=1e-4),e}createNewBlock(e){e={...this.getBasicOptions(),...e},gD&&console.log(this.name,e);const t=new dO(e);return this._createdBlocks.push(t),t}createNewText(e){gD&&console.log(e),e={...this.getBasicOptions(),...e},gD&&console.log(this.name,e);const t=new uO(e);return this._createdTextBlocks.push(t),t}};let oa=eae;MM([I(Q)],oa.prototype,"anchoredPosition",1);MM([I(Q)],oa.prototype,"sizeDelta",2);MM([I(Q)],oa.prototype,"pivot",2);MM([I(Q)],oa.prototype,"anchorMin",2);MM([I(Q)],oa.prototype,"anchorMax",2);var eFe=Object.defineProperty,tFe=Object.getOwnPropertyDescriptor,tae=(s,e,t,i)=>{for(var n=i>1?void 0:i?tFe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&eFe(e,t,n),n};const fE={backgroundColor:new ge(1,1,1),backgroundOpacity:1,borderColor:new ge(1,1,1),borderOpacity:1};var EF;const wC=(EF=class extends Xc{constructor(){super(...arguments);p(this,"_alphaFactor",1);p(this,"sRGBColor",new ge(1,0,1));p(this,"raycastTarget",!0);p(this,"uiObject",null);p(this,"_color",null);p(this,"_rect",null);p(this,"_stateManager",null);p(this,"_currentlyCreatingPanel",!1)}get isGraphic(){return!0}get color(){return this._color||(this._color=new hn(1,1,1,1)),this._color}set color(e){(!this._color||this._color.r!==e.r||this._color.g!==e.g||this._color.b!==e.b||this._color.alpha!==e.alpha)&&(this._color||(this._color=new hn(1,1,1,1)),this._color.copy(e),this.onColorChanged())}setAlphaFactor(e){this._alphaFactor=e,this.onColorChanged()}get alphaFactor(){return this._alphaFactor}onColorChanged(){this.uiObject&&(this.sRGBColor.copy(this._color),this.sRGBColor.convertLinearToSRGB(),fE.backgroundColor=this.sRGBColor,fE.backgroundOpacity=this._color.alpha*this._alphaFactor,this.applyEffects(fE,this._alphaFactor),this.uiObject.set(fE),this.markDirty())}get m_Color(){return this._color}get rectTransform(){if(this._rect||(this._rect=$.getComponent(this.gameObject,oa)),!this._rect)throw new Error("Not Supported: Make sure to add a RectTransform component before adding a UI Graphic component.");return this._rect}onParentRectTransformChanged(){var e;(e=this.uiObject)==null||e.set({width:this.rectTransform.width,height:this.rectTransform.height}),this.markDirty()}__internalNewInstanceCreated(e){return super.__internalNewInstanceCreated(e),this._rect=null,this.uiObject=null,this._color&&(this._color=this._color.clone()),this}setState(e){this.makePanel(),this.uiObject&&(this.uiObject.setState(e),this==null||this.markDirty())}setupState(e){this.makePanel(),this.uiObject&&(this._stateManager||(this._stateManager=new YDe(this.uiObject)),this.uiObject.setupState(e.state,e.attributes))}setOptions(e){this.makePanel(),this.uiObject&&this.uiObject.set(e)}awake(){super.awake(),this.makePanel(),ub(this,"_color",()=>TNe(this,this.onColorChanged))}onEnable(){var e;super.onEnable(),this.uiObject&&((e=this.rectTransform.shadowComponent)==null||e.add(this.uiObject),this.addShadowComponent(this.uiObject,this.rectTransform))}onDisable(){super.onDisable(),this.uiObject&&this.removeShadowComponent()}makePanel(){if(this.uiObject||this._currentlyCreatingPanel)return;this._currentlyCreatingPanel=!0;const e=.015,t={backgroundColor:this.color,backgroundOpacity:this.color.alpha,offset:e};this.onBeforeCreate(t),this.applyEffects(t),this.onCreate(t),this.controlsChildLayout=!1,this._currentlyCreatingPanel=!1,this.onAfterCreated(),this.onColorChanged()}onBeforeCreate(e){}onCreate(e){this.uiObject=this.rectTransform.createNewBlock(e),this.uiObject.name=this.name}onAfterCreated(){}applyEffects(e,t=1){var n;const i=(n=this.gameObject)==null?void 0:n.getComponent(gv);i&&(i.effectDistance&&(e.borderWidth=Math.max(Math.abs(i.effectDistance.x),Math.abs(i.effectDistance.y))),i.effectColor&&(e.borderColor=i.effectColor,e.borderOpacity=i.effectColor.alpha*t))}async setTexture(e){if(this.setOptions({backgroundOpacity:0}),e){if(wC.textureCache.has(e))e=wC.textureCache.get(e);else if(!e.isRenderTargetTexture){const t=e.clone();t.colorSpace=Ji,wC.textureCache.set(e,t),e=t}this.setOptions({backgroundImage:e,borderRadius:0,backgroundOpacity:this.color.alpha,backgroundSize:"stretch"}),Ni.assignTextureLOD(e,0).then(t=>{t instanceof si&&(e&&wC.textureCache.set(e,t),this.setOptions({backgroundImage:t}),this.markDirty())})}else this.setOptions({backgroundImage:void 0,borderRadius:0,backgroundOpacity:this.color.alpha});this.markDirty()}onAfterAddedToScene(){super.onAfterAddedToScene(),this.shadowComponent&&(this.shadowComponent.offset=this.shadowComponent.position.z)}},p(EF,"textureCache",new Map),EF);let RA=wC;tae([I(hn)],RA.prototype,"color",1);tae([I()],RA.prototype,"raycastTarget",2);class IM extends RA{constructor(){super(...arguments);p(this,"_flippedObject",!1)}onAfterCreated(){this.uiObject&&!this._flippedObject&&(this._flippedObject=!0,this.uiObject.scale.y*=-1)}}var iFe=Object.defineProperty,nFe=Object.getOwnPropertyDescriptor,DP=(s,e,t,i)=>{for(var n=i>1?void 0:i?nFe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&iFe(e,t,n),n};let Q5=class{constructor(){p(this,"texture",null);p(this,"rect")}};DP([I(si)],Q5.prototype,"texture",2);let Av=class extends IM{constructor(){super(...arguments);p(this,"_sprite");p(this,"pixelsPerUnitMultiplier",1)}set image(t){this.sprite||(this.sprite=new Q5),this.sprite.texture=t,this.onAfterCreated()}get image(){return this.sprite?this.sprite.texture:null}get sprite(){return this._sprite}set sprite(t){this._sprite!==t&&(this._sprite=t,this.onAfterCreated())}isBuiltinSprite(){var i,n,r,o,a,l,c;const t=this.sprite;switch((i=t==null?void 0:t.texture)==null?void 0:i.name){case"InputFieldBackground":case"UISprite":case"Background":case"Knob":return!0}return!((r=(n=t==null?void 0:t.texture)==null?void 0:n.name)!=null&&r.length)&&((a=(o=t==null?void 0:t.texture)==null?void 0:o.image)==null?void 0:a.width)===32&&((c=(l=t==null?void 0:t.texture)==null?void 0:l.image)==null?void 0:c.height)===32}onBeforeCreate(t){var i,n;super.onBeforeCreate(t),this.isBuiltinSprite()&&(t.borderRadius=5/this.pixelsPerUnitMultiplier,((n=(i=this.sprite)==null?void 0:i.texture)==null?void 0:n.name)==="Knob"&&(t.borderRadius=999))}onAfterCreated(){var t;this.__didAwake&&(super.onAfterCreated(),!this.isBuiltinSprite()&&this.setTexture((t=this.sprite)==null?void 0:t.texture))}};DP([I(Q5)],Av.prototype,"sprite",1);DP([I()],Av.prototype,"pixelsPerUnitMultiplier",2);class FP extends IM{constructor(){super(...arguments);p(this,"_mainTexture")}get mainTexture(){return this._mainTexture}set mainTexture(t){this._mainTexture!==t&&(this._mainTexture=t,this.onAfterCreated())}onAfterCreated(){this.__didAwake&&(super.onAfterCreated(),this.setTexture(this.mainTexture))}}DP([I(si)],FP.prototype,"mainTexture",1);var sFe=Object.defineProperty,rFe=Object.getOwnPropertyDescriptor,oc=(s,e,t,i)=>{for(var n=i>1?void 0:i?rFe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&sFe(e,t,n),n};const Rg=ee("debugbutton");class Zm{constructor(){p(this,"colorMultiplier");p(this,"disabledColor");p(this,"fadeDuration");p(this,"highlightedColor");p(this,"normalColor");p(this,"pressedColor");p(this,"selectedColor")}}oc([I()],Zm.prototype,"colorMultiplier",2);oc([I(hn)],Zm.prototype,"disabledColor",2);oc([I()],Zm.prototype,"fadeDuration",2);oc([I(hn)],Zm.prototype,"highlightedColor",2);oc([I(hn)],Zm.prototype,"normalColor",2);oc([I(hn)],Zm.prototype,"pressedColor",2);oc([I(hn)],Zm.prototype,"selectedColor",2);class oFe{constructor(){p(this,"disabledTrigger");p(this,"highlightedTrigger");p(this,"normalTrigger");p(this,"pressedTrigger");p(this,"selectedTrigger")}}class kp extends ze{constructor(){super(...arguments);p(this,"onClick",new Tn);p(this,"_isHovered",0);p(this,"colors");p(this,"transition");p(this,"animationTriggers");p(this,"animator");p(this,"_interactable",!0);p(this,"_requestedAnimatorTrigger");p(this,"_isInit",!1);p(this,"_image")}click(){var t;(t=this.onClick)==null||t.invoke()}onPointerEnter(t){var n,r;const i=t.event.pointerType==="mouse"&&t.button===0;i&&(this._isHovered+=1),Rg&&console.warn("Button Enter",i,this._isHovered,(n=this.animationTriggers)==null?void 0:n.highlightedTrigger,this.animator),this.interactable&&(this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.highlightedTrigger):this.transition===1&&this.colors&&((r=this._image)==null||r.setState("hovered")),i&&this.context.input.setCursorPointer())}onPointerExit(){var t,i;this._isHovered-=1,this._isHovered<0&&(this._isHovered=0),Rg&&console.log("Button Exit",this._isHovered,(t=this.animationTriggers)==null?void 0:t.highlightedTrigger,this.animator),this.interactable&&(this._isHovered>0||(this._isHovered=0,this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.normalTrigger):this.transition===1&&this.colors&&((i=this._image)==null||i.setState("normal")),this.context.input.setCursorNormal()))}onPointerDown(t){var i,n;Rg&&console.log("Button Down",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator),this.interactable&&(this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.pressedTrigger):this.transition===1&&this.colors&&((n=this._image)==null||n.setState("pressed")))}onPointerUp(t){var i,n;Rg&&console.warn("Button Up",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator,this._isHovered),this.interactable&&(this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this._isHovered?this.animationTriggers.highlightedTrigger:this.animationTriggers.normalTrigger):this.transition===1&&this.colors&&((n=this._image)==null||n.setState(this._isHovered?"hovered":"normal")))}onPointerClick(t){if(this.interactable&&!(t.button!==0&&t.event.pointerType===dP.Mouse)&&(Rg&&(console.warn("Button Click",this.onClick),is("CLICKED button "+this.name+" at "+this.context.time.frameCount)),this.onClick&&this.onClick.listenerCount>0&&(this.onClick.invoke(),t.use(),Rg))){const i=this.gameObject.worldPosition;i.add(this.gameObject.worldUp.multiplyScalar(1+Math.random()*.5)),Mt.DrawLabel(i,"CLICK:"+Date.now(),.1,1+Math.random()*.5)}}set interactable(t){this._interactable=t,this._image&&(this._image.setInteractable(t),t?this._image.setState("normal"):this._image.setState("disabled"))}get interactable(){return this._interactable}set_interactable(t){this.interactable=t}awake(){super.awake(),Rg&&console.log(this),this._isInit=!1,this.init()}start(){var t;(t=this._image)==null||t.setInteractable(this.interactable),this.gameObject.getComponentInParent(bM)||this.gameObject.addComponent(TP)}onEnable(){super.onEnable()}onDestroy(){this._isHovered&&this.context.input.setCursorNormal()}*setAnimatorTriggerAtEndOfFrame(t){var i;this._requestedAnimatorTrigger=t,yield,yield,this._requestedAnimatorTrigger==t&&((i=this.animator)==null||i.setTrigger(t))}init(){this._isInit||(this._isInit=!0,this._image=$.getComponent(this.gameObject,Av),this._image&&(this.stateSetup(this._image),this.interactable?this._image.setState("normal"):this._image.setState("disabled")))}stateSetup(t){var f,m,g,A,y;t.setInteractable(this.interactable);const i=this.getFinalColor(t.color,(f=this.colors)==null?void 0:f.normalColor),n={state:"normal",attributes:{backgroundColor:i,backgroundOpacity:i.alpha}};t.setupState(n);const r=this.getFinalColor(t.color,(m=this.colors)==null?void 0:m.highlightedColor),o={state:"hovered",attributes:{backgroundColor:r,backgroundOpacity:r.alpha}};t.setupState(o);const a=this.getFinalColor(t.color,(g=this.colors)==null?void 0:g.pressedColor),l={state:"pressed",attributes:{backgroundColor:a,backgroundOpacity:a.alpha}};t.setupState(l);const c=this.getFinalColor(t.color,(A=this.colors)==null?void 0:A.selectedColor),h={state:"selected",attributes:{backgroundColor:c,backgroundOpacity:c.alpha}};t.setupState(h);const d=this.getFinalColor(t.color,(y=this.colors)==null?void 0:y.disabledColor),u={state:"disabled",attributes:{backgroundColor:d,backgroundOpacity:d.alpha}};t.setupState(u)}getFinalColor(t,i){return i?t.clone().multiply(i).convertLinearToSRGB():t.clone().convertLinearToSRGB()}}oc([I(Tn)],kp.prototype,"onClick",2);oc([I(Zm)],kp.prototype,"colors",2);oc([I()],kp.prototype,"transition",2);oc([I(oFe)],kp.prototype,"animationTriggers",2);oc([I(Ro)],kp.prototype,"animator",2);oc([I()],kp.prototype,"interactable",1);var aFe=Object.defineProperty,lFe=Object.getOwnPropertyDescriptor,lr=(s,e,t,i)=>{for(var n=i>1?void 0:i?lFe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&aFe(e,t,n),n};const fY=ee("debuguilayout");class Wm{constructor(){p(this,"left",0);p(this,"right",0);p(this,"top",0);p(this,"bottom",0)}get vertical(){return this.top+this.bottom}get horizontal(){return this.left+this.right}}lr([I()],Wm.prototype,"left",2);lr([I()],Wm.prototype,"right",2);lr([I()],Wm.prototype,"top",2);lr([I()],Wm.prototype,"bottom",2);class ac extends ze{constructor(){super(...arguments);p(this,"_rectTransform",null);p(this,"_needsUpdate",!1);p(this,"childAlignment",0);p(this,"reverseArrangement",!1);p(this,"spacing",0);p(this,"padding");p(this,"minWidth",0);p(this,"minHeight",0);p(this,"flexibleHeight",0);p(this,"flexibleWidth",0);p(this,"preferredHeight",0);p(this,"preferredWidth",0)}get rectTransform(){return this._rectTransform}onParentRectTransformChanged(t){this._needsUpdate=!0}get isDirty(){return this._needsUpdate}get isLayoutGroup(){return!0}updateLayout(){this._rectTransform&&(fY&&console.warn("Layout Update",this.context.time.frame,this.name),this._needsUpdate=!1,this.onCalculateLayout(this._rectTransform))}start(){this._needsUpdate=!0}onEnable(){fY&&console.log(this.name,this),this._rectTransform=this.gameObject.getComponent(oa);const t=this.gameObject.getComponentInParent(Lo);t&&t.registerLayoutGroup(this),this._needsUpdate=!0}onDisable(){const t=this.gameObject.getComponentInParent(Lo);t&&t.unregisterLayoutGroup(this)}set m_Spacing(t){t!==this.spacing&&(this._needsUpdate=!0,this.spacing=t)}get m_Spacing(){return this.spacing}}lr([I()],ac.prototype,"childAlignment",2);lr([I()],ac.prototype,"reverseArrangement",2);lr([I()],ac.prototype,"spacing",2);lr([I(Wm)],ac.prototype,"padding",2);lr([I()],ac.prototype,"minWidth",2);lr([I()],ac.prototype,"minHeight",2);lr([I()],ac.prototype,"flexibleHeight",2);lr([I()],ac.prototype,"flexibleWidth",2);lr([I()],ac.prototype,"preferredHeight",2);lr([I()],ac.prototype,"preferredWidth",2);class Hm extends ac{constructor(){super(...arguments);p(this,"childControlHeight",!0);p(this,"childControlWidth",!0);p(this,"childForceExpandHeight",!1);p(this,"childForceExpandWidth",!1);p(this,"childScaleHeight",!1);p(this,"childScaleWidth",!1)}onCalculateLayout(t){var M;const i=this.primaryAxis,n=t.width;let r=n;const o=t.height;let a=o;r-=this.padding.horizontal,a-=this.padding.vertical,i==="x"?this.padding.horizontal:this.padding.vertical;const l=i==="x",c=l?"y":"x",h=l?this.childControlWidth:this.childControlHeight,d=l?this.childControlHeight:this.childControlWidth,u=l?this.childForceExpandWidth:this.childForceExpandHeight,f=l?this.childForceExpandHeight:this.childForceExpandWidth,m=l?a:r,g=l?n:o,A=.5*(l?this.childAlignment%3:Math.floor(this.childAlignment/3));let y=0;l?y+=this.padding.left:y+=this.padding.top;let b=0,x=0;for(let L=0;L<this.gameObject.children.length;L++){const w=this.gameObject.children[L],E=$.getComponent(w,oa);E!=null&&E.activeAndEnabled&&(x+=1,l?b+=E.width:b+=E.height)}let v=0;const _=this.spacing*(x-1);if(u||h){let L=0;l?L=r-=_:L=a-=_,x>0&&(v=L/x)}let C=0;C+=this.padding.left,C-=this.padding.right,A!==0&&(y=g-b,y*=A,y-=_*A,l?(y-=this.padding.right*A,y+=this.padding.left*(1-A),y<this.padding.left&&(y=this.padding.left)):(y-=this.padding.bottom*A,y+=this.padding.top*(1-A),y<this.padding.top&&(y=this.padding.top)));let S=1;for(let L=0;L<this.gameObject.children.length;L++){const w=this.gameObject.children[L],E=$.getComponent(w,oa);if(E!=null&&E.activeAndEnabled){(M=E.pivot)==null||M.set(.5,.5),E.anchorMin.set(0,1),E.anchorMax.set(0,1);const B=n*.5+C*.5;E.anchoredPosition.x!==B&&(E.anchoredPosition.x=B);const P=o*-.5;E.anchoredPosition.y!==P&&(E.anchoredPosition.y=P),f&&d&&E.sizeDelta[c]!==m&&(E.sizeDelta[c]=m),u&&h&&E.sizeDelta[i]!==v&&(E.sizeDelta[i]=v);const k=l?E.width:E.height,X=k*.5;if(y+=X,u){const H=v*S-v*.5;H>y&&(y=H-v*.5+k+this.padding.left,y-=X)}let F=y;i==="y"&&(F=-F),E.anchoredPosition[i]!==F&&(E.anchoredPosition[i]=F),y+=X,y+=this.spacing,S+=1}}}}lr([I()],Hm.prototype,"childControlHeight",2);lr([I()],Hm.prototype,"childControlWidth",2);lr([I()],Hm.prototype,"childForceExpandHeight",2);lr([I()],Hm.prototype,"childForceExpandWidth",2);lr([I()],Hm.prototype,"childScaleHeight",2);lr([I()],Hm.prototype,"childScaleWidth",2);class K5 extends Hm{get primaryAxis(){return"y"}}class Y5 extends Hm{get primaryAxis(){return"x"}}class J5 extends ac{onCalculateLayout(){}}var cFe=Object.defineProperty,hFe=Object.getOwnPropertyDescriptor,au=(s,e,t,i)=>{for(var n=i>1?void 0:i?hFe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&cFe(e,t,n),n},iae=(s=>(s[s.ScreenSpaceOverlay=0]="ScreenSpaceOverlay",s[s.ScreenSpaceCamera=1]="ScreenSpaceCamera",s[s.WorldSpace=2]="WorldSpace",s[s.Undefined=-1]="Undefined",s))(iae||{});const yD=ee("debuguilayout"),nae=class extends yM{constructor(){super(...arguments);p(this,"_renderOnTop");p(this,"_depthWrite",!1);p(this,"_doubleSided",!0);p(this,"_castShadows",!1);p(this,"_receiveShadows",!1);p(this,"_renderMode",-1);p(this,"_rootCanvas");p(this,"_scaleFactor",1);p(this,"worldCamera");p(this,"planeDistance",-1);p(this,"_boundRenderSettingsChanged",this.onRenderSettingsChanged.bind(this));p(this,"previousParent",null);p(this,"_lastMatrixWorld",null);p(this,"_rectTransforms",[]);p(this,"_layoutGroups",new Map);p(this,"_receivers",[]);p(this,"onBeforeRenderRoutine",()=>{var e,t,i,n;if(this.previousParent=this.gameObject.parent,((e=this.context.xr)!=null&&e.isVR||(t=this.context.xr)!=null&&t.isPassThrough)&&this.screenspace){this.gameObject.visible=!1,this.gameObject.removeFromParent();return}this.renderOnTop||this.screenspace?this.gameObject.removeFromParent():(this.onUpdateRenderMode(),this.handleLayoutUpdates(),(i=this.shadowComponent)==null||i.updateMatrixWorld(!0),(n=this.shadowComponent)==null||n.updateWorldMatrix(!0,!0),this.invokeBeforeRenderEvents(),nl.ensureUpdateMeshUI(z9,this.context))});p(this,"onAfterRenderRoutine",()=>{var e,t,i,n,r;if(((e=this.context.xr)!=null&&e.isVR||(t=this.context.xr)!=null&&t.isPassThrough)&&this.screenspace){(i=this.previousParent)==null||i.add(this.gameObject);return}if((this.screenspace||this.renderOnTop)&&this.previousParent&&this.context.mainCamera){if(this.screenspace){const l=this.context.mainCamera;l==null||l.add(this.gameObject)}else this.previousParent.add(this.gameObject);const o=this.context.renderer.autoClear,a=this.context.renderer.autoClearColor;this.context.renderer.autoClear=!1,this.context.renderer.autoClearColor=!1,this.context.renderer.clearDepth(),this.onUpdateRenderMode(!0),this.handleLayoutUpdates(),(n=this.shadowComponent)==null||n.updateMatrixWorld(!0),this.invokeBeforeRenderEvents(),nl.ensureUpdateMeshUI(z9,this.context,!0),this.context.renderer.render(this.gameObject,this.context.mainCamera),this.context.renderer.autoClear=o,this.context.renderer.autoClearColor=a,this.previousParent.add(this.gameObject)}(r=this._lastMatrixWorld)==null||r.copy(this.gameObject.matrixWorld)});p(this,"_updateRenderSettingsRoutine");p(this,"_activeRenderMode",-1);p(this,"_lastWidth",-1);p(this,"_lastHeight",-1)}get isCanvas(){return!0}get screenspace(){return this.renderMode!==2}set renderOnTop(e){e!==this._renderOnTop&&(this._renderOnTop=e,this.onRenderSettingsChanged())}get renderOnTop(){return this._renderOnTop!==void 0?this._renderOnTop:!!(this.screenspace&&this._renderMode===0)}set depthWrite(e){this._depthWrite!==e&&(this._depthWrite=e,this.onRenderSettingsChanged())}get depthWrite(){return this._depthWrite}set doubleSided(e){this._doubleSided!==e&&(this._doubleSided=e,this.onRenderSettingsChanged())}get doubleSided(){return this._doubleSided}set castShadows(e){this._castShadows!==e&&(this._castShadows=e,this.onRenderSettingsChanged())}get castShadows(){return this._castShadows}set receiveShadows(e){this._receiveShadows!==e&&(this._receiveShadows=e,this.onRenderSettingsChanged())}get receiveShadows(){return this._receiveShadows}get renderMode(){return this._renderMode}set renderMode(e){this._renderMode!==e&&(this._renderMode=e,this.onRenderSettingsChanged())}set rootCanvas(e){this._rootCanvas instanceof nae||(this._rootCanvas=e)}get rootCanvas(){return this._rootCanvas}get scaleFactor(){return this._scaleFactor}set scaleFactor(e){this._scaleFactor=e}awake(){var e;this.shadowComponent=this.gameObject,this.previousParent=this.gameObject.parent,yD&&console.log("Canvas.Awake()",((e=this.previousParent)==null?void 0:e.name)+"/"+this.gameObject.name),super.awake()}start(){this.onUpdateRenderMode()}onEnable(){super.onEnable(),this._updateRenderSettingsRoutine=void 0,this._lastMatrixWorld=new ce,this.onUpdateRenderMode(),document.addEventListener("resize",this._boundRenderSettingsChanged),this.context.pre_render_callbacks.push(this.onBeforeRenderRoutine),this.context.post_render_callbacks.push(this.onAfterRenderRoutine)}onDisable(){super.onDisable(),document.removeEventListener("resize",this._boundRenderSettingsChanged);const e=this.context.pre_render_callbacks.indexOf(this.onBeforeRenderRoutine);e!==-1&&this.context.pre_render_callbacks.splice(e,1);const t=this.context.post_render_callbacks.indexOf(this.onAfterRenderRoutine);t!==-1&&this.context.post_render_callbacks.splice(t,1)}registerTransform(e){this._rectTransforms.push(e)}unregisterTransform(e){const t=this._rectTransforms.indexOf(e);t!==-1&&this._rectTransforms.splice(t,1)}registerLayoutGroup(e){const t=e.gameObject;this._layoutGroups.set(t,e)}unregisterLayoutGroup(e){const t=e.gameObject;this._layoutGroups.delete(t)}registerEventReceiver(e){this._receivers.push(e)}unregisterEventReceiver(e){const t=this._receivers.indexOf(e);t!==-1&&this._receivers.splice(t,1)}async onEnterXR(e){this.screenspace?(e.xr.isVR||e.xr.isPassThrough)&&(this.gameObject.visible=!1):(this.gameObject.visible=!1,await QB(1).then(()=>{this.gameObject.visible=!0}))}onLeaveXR(e){this.screenspace&&(e.xr.isVR||e.xr.isPassThrough)&&(this.gameObject.visible=!0)}invokeBeforeRenderEvents(){var e;for(const t of this._receivers)(e=t.onBeforeCanvasRender)==null||e.call(t,this)}handleLayoutUpdates(){this._lastMatrixWorld===null&&(this._lastMatrixWorld=new ce);const e=!this._lastMatrixWorld.equals(this.gameObject.matrixWorld);yD&&e&&console.log("Canvas Layout changed",this.context.time.frameCount,this.name);const t=!1;for(const i of this._rectTransforms){e&&i.markDirty();let n=this._layoutGroups.get(i.gameObject);i.isDirty&&!n&&(n=i.gameObject.getComponentInParent(ac)),(i.isDirty||n!=null&&n.isDirty)&&(yD&&!t&&console.log("CANVAS UPDATE ### "+i.name+" ##################################### "+this.context.time.frame),n==null||n.updateLayout(),i.updateTransform())}}applyRenderSettings(){this.onRenderSettingsChanged()}onRenderSettingsChanged(){this._updateRenderSettingsRoutine||(this._updateRenderSettingsRoutine=this.startCoroutine(this._updateRenderSettingsDelayed(),wn.OnBeforeRender))}*_updateRenderSettingsDelayed(){if(yield,this._updateRenderSettingsRoutine=void 0,this.shadowComponent){this.onUpdateRenderMode(),x2(this.shadowComponent,this);for(const e of $.getComponentsInChildren(this.gameObject,Xc))x2(e.shadowComponent,this)}}onUpdateRenderMode(e=!1){if(!e&&this._renderMode===this._activeRenderMode&&this._lastWidth===this.context.domWidth&&this._lastHeight===this.context.domHeight)return;this._activeRenderMode=this._renderMode;let t=this.context.mainCameraComponent,i=10;switch(t&&t.nearClipPlane>0&&t.farClipPlane>0&&(i=lt.lerp(t.nearClipPlane,t.farClipPlane,.01)),this._renderMode===1&&(this.worldCamera&&(t=this.worldCamera),this.planeDistance>0&&(i=this.planeDistance)),this._renderMode){case 0:case 1:if(this._lastWidth=this.context.domWidth,this._lastHeight=this.context.domHeight,!t)return;const n=i+.01;this.gameObject.position.x=0,this.gameObject.position.y=0,this.gameObject.position.z=-n,this.gameObject.quaternion.identity();const r=this.gameObject.getComponent(oa);let o=!1;r.sizeDelta.x!==this.context.domWidth&&(o=!0),r.sizeDelta.y!==this.context.domHeight&&(o=!0);const a=t.fieldOfView*Math.PI/180,l=2*Math.tan(a/2)*Math.abs(n);this.gameObject.scale.x=l/this.context.domHeight,this.gameObject.scale.y=l/this.context.domHeight,this.gameObject.scale.z=.01,o&&(r.sizeDelta.x=this.context.domWidth,r.sizeDelta.y=this.context.domHeight,r==null||r.markDirty());break;case 2:this._lastWidth=-1,this._lastHeight=-1;break}}};let Lo=nae;au([I()],Lo.prototype,"renderOnTop",1);au([I()],Lo.prototype,"depthWrite",1);au([I()],Lo.prototype,"doubleSided",1);au([I()],Lo.prototype,"castShadows",1);au([I()],Lo.prototype,"receiveShadows",1);au([I()],Lo.prototype,"renderMode",1);au([I(Lo)],Lo.prototype,"rootCanvas",1);au([I()],Lo.prototype,"scaleFactor",1);au([I(Cn)],Lo.prototype,"worldCamera",2);au([I()],Lo.prototype,"planeDistance",2);var dFe=Object.defineProperty,uFe=Object.getOwnPropertyDescriptor,j5=(s,e,t,i)=>{for(var n=i>1?void 0:i?uFe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&dFe(e,t,n),n};class xm extends ze{constructor(){super(...arguments);p(this,"_alpha",1);p(this,"interactable",!0);p(this,"blocksRaycasts",!0);p(this,"_isDirty",!1);p(this,"_buffer",[])}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.markDirty())}get isCanvasGroup(){return!0}markDirty(){this._isDirty||(this._isDirty=!0,this.startCoroutine(this.applyChangesDelayed(),wn.OnBeforeRender))}*applyChangesDelayed(){this._isDirty=!1,this.applyChangesNow()}applyChangesNow(){this._buffer.length=0;for(const t of $.getComponentsInChildren(this.gameObject,Xc,this._buffer)){const i=t;i.setAlphaFactor&&i.setAlphaFactor(this._alpha)}}}j5([I()],xm.prototype,"alpha",1);j5([I()],xm.prototype,"interactable",2);j5([I()],xm.prototype,"blocksRaycasts",2);var pFe=Object.defineProperty,fFe=Object.getOwnPropertyDescriptor,ms=(s,e,t,i)=>{for(var n=i>1?void 0:i?fFe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&pFe(e,t,n),n};const mY=ee("debugusdzbehaviours");function TM(s){s&&(s.getComponentInParent(bM)||(Qe()&&console.debug('Raycaster on "'+s.name+'" was automatically added, because no raycaster was found in the parent hierarchy.'),s.addComponent(nc)))}class LA extends ze{constructor(){super(...arguments);p(this,"object");p(this,"target");p(this,"duration",1);p(this,"relativeMotion",!1);p(this,"coroutine",null);p(this,"targetPos",new T);p(this,"targetRot",new Ve);p(this,"targetScale",new T)}start(){TM(this.gameObject)}onPointerClick(t){t.use(),this.coroutine&&this.stopCoroutine(this.coroutine),this.relativeMotion?this.coroutine=this.startCoroutine(this.moveRelative()):this.coroutine=this.startCoroutine(this.moveToTarget())}*moveToTarget(){if(!this.target||!this.object)return;const t=$t(this.object).clone(),i=$t(this.target).clone(),n=gn(this.object).clone(),r=gn(this.target).clone(),o=kn(this.object).clone(),a=kn(this.target).clone(),l=t.distanceTo(i),c=n.angleTo(r),h=o.distanceTo(a);if(l<.01&&c<.01&&h<.01){_r(this.object,i),Uc(this.object,r),wx(this.object,a),this.coroutine=null;return}let d=0,u=0;for(;d<1;)d+=this.context.time.deltaTime/this.duration,d>1&&(d=1),u=d<.5?4*d*d*d:1-Math.pow(-2*d+2,3)/2,this.targetPos.lerpVectors(t,i,u),this.targetRot.slerpQuaternions(n,r,u),this.targetScale.lerpVectors(o,a,u),_r(this.object,this.targetPos),Uc(this.object,this.targetRot),wx(this.object,this.targetScale),yield;this.coroutine=null}*moveRelative(){if(!this.target||!this.object)return;const t=this.object.position.clone(),i=this.object.quaternion.clone(),n=this.object.scale.clone(),r=this.target.position.clone(),o=this.target.quaternion.clone(),a=this.target.scale.clone();r.applyQuaternion(this.object.quaternion),this.targetPos.copy(this.object.position).add(r),this.targetRot.copy(this.object.quaternion).multiply(o),this.targetScale.copy(this.object.scale).multiply(a);let l=0,c=0;for(;l<1;)l+=this.context.time.deltaTime/this.duration,l>1&&(l=1),c=l<.5?4*l*l*l:1-Math.pow(-2*l+2,3)/2,this.object.position.lerpVectors(t,this.targetPos,c),this.object.quaternion.slerpQuaternions(i,this.targetRot,c),this.object.scale.lerpVectors(n,this.targetScale,c),yield;this.coroutine=null}beforeCreateDocument(t){var i;if(this.target&&this.object&&this.gameObject){const n=new er("Move to "+((i=this.target)==null?void 0:i.name),Or.tapTrigger(this.gameObject),zi.transformAction(this.object,this.target,this.duration,this.relativeMotion?"relative":"absolute"));t.addBehavior(n)}}}ms([I(ye)],LA.prototype,"object",2);ms([I(ye)],LA.prototype,"target",2);ms([I()],LA.prototype,"duration",2);ms([I()],LA.prototype,"relativeMotion",2);var sR;const ad=(sR=class extends ze{constructor(){super(...arguments);p(this,"materialToSwitch");p(this,"variantMaterial");p(this,"fadeDuration",0);p(this,"_objectsWithThisMaterial",null);p(this,"selfModel");p(this,"targetModels")}start(){var e;this._objectsWithThisMaterial=this.objectsWithThisMaterial,TM(this.gameObject),Qe()&&this._objectsWithThisMaterial.length<=0&&console.warn('ChangeMaterialOnClick: No objects found with material "'+((e=this.materialToSwitch)==null?void 0:e.name)+'"')}onPointerEnter(e){this.context.input.setCursorPointer()}onPointerExit(e){this.context.input.setCursorNormal()}onPointerClick(e){if(e.use(),!!this.variantMaterial)for(let t=0;t<this.objectsWithThisMaterial.length;t++){const i=this.objectsWithThisMaterial[t];i.material=this.variantMaterial}}get objectsWithThisMaterial(){return this._objectsWithThisMaterial!=null?this._objectsWithThisMaterial:(this._objectsWithThisMaterial=[],this.variantMaterial&&this.materialToSwitch&&this.context.scene.traverse(e=>{if(e instanceof fe)if(Array.isArray(e.material)){for(const t of e.material)if(t===this.materialToSwitch){this.objectsWithThisMaterial.push(e);break}}else e.material===this.materialToSwitch?this.objectsWithThisMaterial.push(e):gre(e.material,this.materialToSwitch)&&this.objectsWithThisMaterial.push(e)}),this._objectsWithThisMaterial)}async beforeCreateDocument(e,t){this.targetModels=[],ad._materialTriggersPerId={},ad.variantSwitchIndex=0,this.materialToSwitch&&await Ni.assignTextureLOD(this.materialToSwitch,0),this.variantMaterial&&await Ni.assignTextureLOD(this.variantMaterial,0)}createBehaviours(e,t,i){this.objectsWithThisMaterial.find(r=>r.uuid===t.uuid)&&this.targetModels.push(t),this.gameObject.uuid===t.uuid&&(this.selfModel=t,this.materialToSwitch&&(ad._materialTriggersPerId[this.materialToSwitch.uuid]||(ad._materialTriggersPerId[this.materialToSwitch.uuid]=[]),ad._materialTriggersPerId[this.materialToSwitch.uuid].push(this)))}afterCreateDocument(e,t){if(!this.materialToSwitch)return;const i=ad._materialTriggersPerId[this.materialToSwitch.uuid];if(i){const n={};for(const r of i){const o=r.createVariants();o&&o.length>0&&(n[r.selfModel.uuid]=o)}for(const r of i){const o=[];for(const a in n)a!==r.selfModel.uuid&&o.push(...n[a]);r.createAndAttachBehaviors(e,n[r.selfModel.uuid],o)}}delete ad._materialTriggersPerId[this.materialToSwitch.uuid]}createAndAttachBehaviors(e,t,i){const n=[],r=[],o=Math.max(0,this.fadeDuration);r.push(zi.fadeAction([...this.targetModels,...i],o,!1)),n.push(zi.fadeAction(t,o,!1)),r.push(zi.fadeAction(t,o,!0)),e.addBehavior(new er("Select_"+this.selfModel.name,Or.tapTrigger(this.selfModel),zi.parallel(...r))),e.addBehavior(new er("StartHidden_"+this.selfModel.name,Or.sceneStartTrigger(),zi.parallel(...n)))}static getMaterialName(e){return Vh(e.name||"Material")+"_"+e.id}createVariants(){if(!this.variantMaterial)return null;const e=[];for(const t of this.targetModels){const i=t.clone();i.name+="_Variant_"+ad.variantSwitchIndex+++"_"+ad.getMaterialName(this.variantMaterial),i.displayName=i.displayName+": Variant with material "+this.variantMaterial.name,i.material=this.variantMaterial,i.geometry=t.geometry,i.transform=t.transform,(!t.parent||!t.parent.isEmpty())&&Co.createEmptyParent(t),t.parent&&t.parent.add(i),e.push(i)}return e}},p(sR,"_materialTriggersPerId",{}),p(sR,"variantSwitchIndex",0),sR);let yv=ad;ms([I(Yt)],yv.prototype,"materialToSwitch",2);ms([I(Yt)],yv.prototype,"variantMaterial",2);ms([I()],yv.prototype,"fadeDuration",2);var jy;const as=(jy=class extends ze{constructor(){super(...arguments);p(this,"target");p(this,"toggleOnClick",!1);p(this,"targetState",!0);p(this,"hideSelf",!0);p(this,"selfModel");p(this,"selfModelClone");p(this,"targetModel");p(this,"toggleModel");p(this,"stateBeforeCreatingDocument",!1);p(this,"targetStateBeforeCreatingDocument",!1)}start(){TM(this.gameObject)}onPointerClick(e){e.use(),!this.toggleOnClick&&this.hideSelf&&(this.gameObject.visible=!1),this.target&&(this.target.visible=this.toggleOnClick?!this.target.visible:this.targetState)}createBehaviours(e,t,i){t.uuid===this.gameObject.uuid&&(this.selfModel=t,this.selfModelClone=t.clone())}beforeCreateDocument(){this.target&&(this.gameObject[as.wasVisible]===void 0&&(this.gameObject[as.wasVisible]=this.gameObject.activeSelf),this.target[as.wasVisible]===void 0&&(this.target[as.wasVisible]=this.target.activeSelf),this.stateBeforeCreatingDocument=this.gameObject[as.wasVisible],this.targetStateBeforeCreatingDocument=this.target[as.wasVisible],this.gameObject.visible=!0,this.target.visible=!0)}afterCreateDocument(e,t){if(!this.target)return;this.targetModel=t.document.findById(this.target.uuid);const i=this.selfModel;if(this.selfModel&&this.targetModel){let n=this.selfModel,r=this.targetState;if(this.toggleOnClick)if(r=!this.targetStateBeforeCreatingDocument,!this.selfModelClone.geometry)(!this.selfModel.parent||this.selfModel.parent.isEmpty())&&_5.createEmptyParent(this.selfModel),this.toggleModel=this.selfModel.deepClone(),this.toggleModel.name+="_toggle",this.selfModel.parent.add(this.toggleModel);else{if(!this.gameObject[as.toggleClone]){const l=this.selfModelClone.clone();l.setMatrix(new ce),l.name+="_toggle"+as.clonedToggleIndex++,i.add(l),this.gameObject[as.toggleClone]=l,console.warn("USDZExport: Toggle "+this.gameObject.name+" doesn't have geometry. It will be deep cloned and nested behaviours will likely not work.")}const a=this.gameObject[as.toggleClone];if(!this.gameObject[as.reverseToggleClone]){const l=this.selfModelClone.clone();l.setMatrix(new ce),l.name+="_toggleReverse"+as.clonedToggleIndex++,i.add(l),this.gameObject[as.reverseToggleClone]=l}this.toggleModel=this.gameObject[as.reverseToggleClone],(!this.toggleModel.geometry||!a.geometry)&&console.error("triggers without childs and without geometry won't work!",this,i.geometry),n=a,i.geometry=null,i.material=null}if(this.toggleModel){if(this.toggleOnClick){const a=[];a.push(zi.fadeAction(n,0,!1)),a.push(zi.fadeAction(this.toggleModel,0,!0)),a.push(zi.fadeAction(this.targetModel,0,r)),e.addBehavior(new er("Toggle_"+n.name+"_toggleTo"+(r?"On":"Off"),Or.tapTrigger(n),zi.parallel(...a)));const l=[];l.push(zi.fadeAction(this.toggleModel,0,!1)),l.push(zi.fadeAction(n,0,!0)),l.push(zi.fadeAction(this.targetModel,0,!r)),e.addBehavior(new er("Toggle_"+n.name+"_toggleTo"+(r?"Off":"On"),Or.tapTrigger(this.toggleModel),zi.parallel(...l)))}}else{const a=[];this.hideSelf&&a.push(zi.fadeAction(n,0,!1)),a.push(zi.fadeAction(this.targetModel,0,r)),e.addBehavior(new er("Toggle_"+n.name+"_toggleTo"+(r?"On":"Off"),Or.tapTrigger(n),zi.parallel(...a)))}const o=new Array;this.targetStateBeforeCreatingDocument||o.push(this.targetModel),this.stateBeforeCreatingDocument||o.push(i),this.toggleModel&&o.push(this.toggleModel),e.addBehavior(new er("HideOnStart_"+this.gameObject.name,Or.sceneStartTrigger(),zi.fadeAction(o,0,!1)))}}afterSerialize(e,t){this.gameObject[as.wasVisible]!==void 0&&(this.gameObject.visible=this.gameObject[as.wasVisible],delete this.gameObject[as.wasVisible]),this.target&&this.target[as.wasVisible]!==void 0&&(this.target.visible=this.target[as.wasVisible],delete this.target[as.wasVisible]),delete this.gameObject[as.toggleClone],delete this.gameObject[as.reverseToggleClone]}},p(jy,"clonedToggleIndex",0),p(jy,"wasVisible",Symbol("usdz_SetActiveOnClick_wasVisible")),p(jy,"toggleClone",Symbol("clone for toggling")),p(jy,"reverseToggleClone",Symbol("clone for reverse toggling")),jy);let BA=as;ms([I(ye)],BA.prototype,"target",2);ms([I()],BA.prototype,"toggleOnClick",2);ms([I()],BA.prototype,"targetState",2);ms([I()],BA.prototype,"hideSelf",2);class q5 extends ze{constructor(){super(...arguments);p(this,"wasVisible",!1)}start(){$.setActive(this.gameObject,!1)}createBehaviours(t,i,n){i.uuid===this.gameObject.uuid&&(this.wasVisible||t.addBehavior(new er("HideOnStart_"+this.gameObject.name,Or.sceneStartTrigger(),zi.fadeAction(i,0,!1))))}beforeCreateDocument(){this.wasVisible=$.isActiveSelf(this.gameObject)}}class bv extends ze{constructor(){super(...arguments);p(this,"target");p(this,"duration",.5);p(this,"motionType","bounce")}beforeCreateDocument(){}createBehaviours(t,i,n){if(this.target&&i.uuid===this.gameObject.uuid){const r=new er("emphasize "+this.name,Or.tapTrigger(this.gameObject),zi.emphasize(this.target,this.duration,this.motionType,void 0,"basic"));t.addBehavior(r)}}afterCreateDocument(t,i){}}ms([I()],bv.prototype,"target",2);ms([I()],bv.prototype,"duration",2);ms([I()],bv.prototype,"motionType",2);class vm extends ze{constructor(){super(...arguments);p(this,"target");p(this,"clip","");p(this,"toggleOnClick",!1);p(this,"trigger","tap")}start(){TM(this.gameObject)}ensureAudioSource(){if(!this.target){const t=this.gameObject.addComponent(fs);t&&(this.target=t,t.spatialBlend=1,t.volume=1,t.loop=!1,t.preload=!0)}}onPointerClick(t){var i;t.use(),!(!((i=this.target)!=null&&i.clip)&&!this.clip)&&(this.ensureAudioSource(),this.target&&(this.target.isPlaying&&this.toggleOnClick?this.target.stop():(!this.toggleOnClick&&this.target.isPlaying&&this.target.stop(),this.clip?this.target.play(this.clip):this.target.play())))}createBehaviours(t,i,n){if(!(!this.target&&!this.clip)&&i.uuid===this.gameObject.uuid){const r=this.clip?this.clip:this.target?this.target.clip:void 0;if(!r||typeof r!="string")return;const o=this.target?this.target.gameObject:this.gameObject;Xm.getName(r);const a=this.target?this.target.volume:1,l=this.target&&this.target.spatialBlend==0?"nonSpatial":"spatial";let c=!1;this.gameObject.traverse(f=>{f instanceof fe&&f.visible&&(c=!0)}),c=!0;const h=t.addAudioClip(r);let d=zi.playAudioAction(o,h,"play",a,l);this.target&&this.target.loop&&(d=zi.sequence(d).makeLooping());const u=this.name?"_"+this.name:"";if(c&&this.trigger==="tap"){this.toggleOnClick&&(d.multiplePerformOperation="stop");const f=new er("playAudio"+u,Or.tapTrigger(i),d);t.addBehavior(f)}if(this.target&&this.target.playOnAwake&&this.target.enabled)if(c&&this.trigger==="tap")console.warn("USDZExport: Audio sources that are played on tap can't also auto-play at scene start due to a QuickLook bug.");else{const f=new er("playAudioOnStart"+u,Or.sceneStartTrigger(),d);t.addBehavior(f)}}}}ms([I(fs)],vm.prototype,"target",2);ms([I(URL)],vm.prototype,"clip",2);ms([I()],vm.prototype,"toggleOnClick",2);var rR;const ld=(rR=class extends ze{constructor(){super(...arguments);p(this,"animator");p(this,"stateName");p(this,"trigger","tap");p(this,"animation");p(this,"selfModel");p(this,"stateAnimationModel");p(this,"animationSequence",new Array);p(this,"animationLoopAfterSequence",new Array);p(this,"randomOffsetNormalized",0)}get target(){var e,t;return((e=this.animator)==null?void 0:e.gameObject)||((t=this.animation)==null?void 0:t.gameObject)}start(){TM(this.gameObject)}onPointerClick(e){var t;e.use(),this.target&&this.stateName&&((t=this.animator)==null||t.play(this.stateName,0,0,.1))}createBehaviours(e,t,i){t.uuid===this.gameObject.uuid&&(this.selfModel=t)}afterSerialize(){if(ld.rootsWithExclusivePlayback.size>1){const e='Multiple root objects targeted by more than one animation. To work around QuickLook bug FB13410767, animations will be set as "exclusive" and activating them will stop other animations being marked as exclusive.';Qe()&&An(e),console.warn(e,...ld.rootsWithExclusivePlayback)}ld.animationActions=[],ld.rootsWithExclusivePlayback=new Set}afterCreateDocument(e,t){if(this.animationSequence===void 0&&this.animationLoopAfterSequence===void 0||!this.stateAnimationModel||!this.target)return;const i=t.document,n=t.extensions.find(a=>a instanceof gM);if(!n)return;const r=n.getClipCount(this.target)>1;r&&(Qe()&&console.warn("Setting exclusive playback for "+this.target.name+"@"+this.stateName+" because it has "+n.getClipCount(this.target)+" animations. This works around QuickLook bug FB13410767."),ld.rootsWithExclusivePlayback.add(this.target));const o=this.name?this.name:"";i.traverse(a=>{var l,c;if(a.uuid===((l=this.target)==null?void 0:l.uuid)){const h=ld.getActionForSequences(i,a,this.animationSequence,this.animationLoopAfterSequence,this.randomOffsetNormalized),d=new er(this.trigger+"_"+o+"_toPlayAnimation_"+this.stateName+"_on_"+((c=this.target)==null?void 0:c.name),this.trigger=="tap"?Or.tapTrigger(this.selfModel):Or.sceneStartTrigger(),h);r&&d.makeExclusive(!0),e.addBehavior(d)}})}static getActionForSequences(e,t,i,n,r){const o=(l,c)=>{let h=ld.animationActions.find(d=>d.affectedObjects==l&&d.start==c.start&&d.duration==c.duration&&d.animationSpeed==c.speed);return h||(h=zi.startAnimationAction(l,c),ld.animationActions.push(h)),h},a=zi.sequence();if(i&&i.length>0)for(const l of i)a.addAction(o(t,l));if(n&&n.length>0){const l=a.actions.length==0?a:zi.sequence();for(const c of n)l.addAction(o(t,c));l.makeLooping(),a!==l&&a.addAction(l)}return r&&r>0&&a.actions.unshift(zi.waitAction(r)),a}static getAndRegisterAnimationSequences(e,t,i){var m,g,A,y,b,x,v,_;if(!t)return;const n=t.getComponent(Ro),r=t.getComponent(na);if(!n&&!r)return;if(n&&!i)throw new Error("PlayAnimationOnClick: No stateName specified for animator "+n.name+" on "+t.name);let o=[],a=[];if(r){const C=e.registerAnimation(t,r.clip);C&&(r.loop?a.push(C):o.push(C));let S=0;if(r.minMaxOffsetNormalized){const M=r.minMaxOffsetNormalized.x,L=r.minMaxOffsetNormalized.y;S=(((m=r.clip)==null?void 0:m.duration)||1)*(M+Math.random()*(L-M))}return{animationSequence:o,animationLoopAfterSequence:a,randomTimeOffset:S}}const l=n==null?void 0:n.runtimeAnimatorController;let c=l==null?void 0:l.findState(i),h=[],d=[];if(l&&c){const C=new Array;C.push(c);let S=!1;for(;C.length<100;){if(!c||c===null||!c.transitions||c.transitions.length===0){(g=c.motion)!=null&&g.isLooping&&(S=!0);break}const M=c.transitions.find(w=>w.conditions.length===0),L=M?l.getState(M.destinationState,0):null;if(L&&C.includes(L)){c=L,S=!0;break}else if(M){if(c=L,!c)break;C.push(c)}else{S=((A=c.motion)==null?void 0:A.isLooping)??!1;break}}if(S&&c){const M=C.indexOf(c);h=C.slice(0,M),d=C.slice(M),mY&&console.log("found loop from "+i,"states until loop",h,"states looping",d)}else h=C,d=[],mY&&console.log("found no loop from "+i,"states",h);if(!d.length){const M=h[h.length-1],L=(y=M.motion)==null?void 0:y.clip;if(L){let w;if(e.holdClipMap.has(L))w=e.holdClipMap.get(L);else{const E=M.name+"_hold";w=L.clone(),w.duration=1,w.name=E;const B=L.duration;w.tracks=L.tracks.map(P=>{const k=P.clone();k.times=new Float32Array([0,B]);const X=P.values.length,F=P.getValueSize(),H=P.values.slice(X-F,X);return k.values=new Float32Array(2*F),k.values.set(H,0),k.values.set(H,F),k}),w.name=E,e.holdClipMap.set(L,w)}if(w){const E={name:w.name,motion:{clip:w,isLooping:!1,name:w.name},speed:1,transitions:[],behaviours:[],hash:M.hash+1};d.push(E)}}}}if(h.length===1&&(!((b=h[0].motion)!=null&&b.clip)||((v=(x=h[0].motion)==null?void 0:x.clip.tracks)==null?void 0:v.length)===0)){o=new Array;const C=e.registerAnimation(t,null);C&&o.push(C);return}if(h=h.filter(C=>{var S,M,L;return((S=C.motion)==null?void 0:S.clip)&&((L=(M=C.motion)==null?void 0:M.clip.tracks)==null?void 0:L.length)>0}),d=d.filter(C=>{var S,M,L;return((S=C.motion)==null?void 0:S.clip)&&((L=(M=C.motion)==null?void 0:M.clip.tracks)==null?void 0:L.length)>0}),h.length===0&&d.length===0){console.warn("No clips found for state "+i+" on "+(n==null?void 0:n.name)+", can't export animation data");return}const u=(C,S)=>{if(!t)return;const M=e.registerAnimation(t,C.motion.clip??null);M?(M.speed=C.speed,S.push(M)):console.warn("Couldn't register animation for state "+C.name+" on "+(n==null?void 0:n.name))};if(h.length>0){o=new Array;for(const C of h)u(C,o)}if(d.length>0){a=new Array;for(const C of d)u(C,a)}let f=0;if(n&&l&&n.minMaxOffsetNormalized){const C=n.minMaxOffsetNormalized.x,S=n.minMaxOffsetNormalized.y,M=h.length?h[0]:d.length?d[0]:null;f=(((_=M==null?void 0:M.motion.clip)==null?void 0:_.duration)||1)*(C+Math.random()*(S-C))}return{animationSequence:o,animationLoopAfterSequence:a,randomTimeOffset:f}}createAnimation(e,t,i){if(!this.target||!this.animator&&!this.animation)return;const n=ld.getAndRegisterAnimationSequences(e,this.target,this.stateName);n&&(this.animationSequence=n.animationSequence,this.animationLoopAfterSequence=n.animationLoopAfterSequence,this.randomOffsetNormalized=n.randomTimeOffset,this.stateAnimationModel=t)}},p(rR,"animationActions",[]),p(rR,"rootsWithExclusivePlayback",new Set),rR);let iA=ld;ms([I(Ro)],iA.prototype,"animator",2);ms([I()],iA.prototype,"stateName",2);class xv extends ze{constructor(){super(...arguments);p(this,"target")}getType(){}getDuration(){}}ms([I(ye)],xv.prototype,"target",2);class EM extends ze{constructor(){super(...arguments);p(this,"target")}}ms([I(xv)],EM.prototype,"target",2);class RM extends xv{constructor(){super(...arguments);p(this,"type",1);p(this,"duration",1)}getType(){switch(this.type){case 1:return"hide";case 0:return"show"}}getDuration(){return this.duration}}ms([I()],RM.prototype,"type",2);ms([I()],RM.prototype,"duration",2);class $5 extends EM{}var mFe=Object.defineProperty,gFe=Object.getOwnPropertyDescriptor,Np=(s,e,t,i)=>{for(var n=i>1?void 0:i?gFe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&mFe(e,t,n),n};const gY=ee("debugcharactercontroller");class PA extends ze{constructor(){super(...arguments);p(this,"center",new T(0,0,0));p(this,"radius",.5);p(this,"height",2);p(this,"_rigidbody",null);p(this,"_activeGroundCollisions");p(this,"_contactVelocity",new T)}get rigidbody(){return this._rigidbody?this._rigidbody:(this._rigidbody=this.gameObject.getComponent(en),this._rigidbody||(this._rigidbody=this.gameObject.addComponent(en)),this.rigidbody)}awake(){this._activeGroundCollisions=new Set}onEnable(){const t=this.rigidbody;let i=this.gameObject.getComponent(Ep);i||(i=this.gameObject.addComponent(Ep)),i.center.copy(this.center),i.radius=this.radius,i.height=this.height;const n=new T(0,0,1),r=new T(1,0,0),o=new T(0,1,0),a=this.gameObject.getWorldDirection(new T);a.y=0;const l=r.dot(a)<0?-1:1,c=n.angleTo(a)*l;this.gameObject.setRotationFromAxisAngle(o,c),t.lockRotationX=!0,t.lockRotationY=!0,t.lockRotationZ=!0}move(t){this.gameObject.position.add(t)}onCollisionEnter(t){(t.contacts.length==0||t.contacts.some(i=>i.normal.y>.2))&&(this._activeGroundCollisions.add(t),gY&&console.log(`Collision(${this._activeGroundCollisions.size}): ${t.contacts.map(i=>i.normal.y.toFixed(2)).join(", ")} - ${this.isGrounded}`))}onCollisionExit(t){this._activeGroundCollisions.delete(t),gY&&console.log(`Collision(${this._activeGroundCollisions.size}) - ${this.isGrounded}`)}get isGrounded(){return this._activeGroundCollisions.size>0}get contactVelocity(){var t;this._contactVelocity.set(0,0,0);for(const i of this._activeGroundCollisions){const n=(t=this.context.physics.engine)==null?void 0:t.getLinearVelocity(i.collider);n&&(this._contactVelocity.x+=n.x,this._contactVelocity.y+=n.y,this._contactVelocity.z+=n.z)}return this._contactVelocity}}Np([I(T)],PA.prototype,"center",2);Np([I()],PA.prototype,"radius",2);Np([I()],PA.prototype,"height",2);class Dp extends ze{constructor(){super(...arguments);p(this,"controller");p(this,"movementSpeed",2);p(this,"rotationSpeed",2);p(this,"jumpForce",1);p(this,"doubleJumpForce",2);p(this,"animator");p(this,"lookForward",!0);p(this,"lookInput",new Q(0,0));p(this,"moveInput",new Q(0,0));p(this,"jumpInput",!1);p(this,"_currentSpeed",new T(0,0,0));p(this,"_currentAngularSpeed",new T(0,0,0));p(this,"_temp",new T(0,0,0));p(this,"_jumpCount",0);p(this,"_currentRotation");p(this,"_raycastOptions",new qd)}awake(){this._currentRotation=new Ve}update(){const t=this.context.input;t.isKeyPressed("KeyW")?this.moveInput.y+=1:t.isKeyPressed("KeyS")&&(this.moveInput.y-=1),t.isKeyPressed("KeyD")?this.lookInput.x+=1:t.isKeyPressed("KeyA")&&(this.lookInput.x-=1),this.jumpInput||(this.jumpInput=t.isKeyDown("Space"))}move(t){this.moveInput.add(t)}look(t){this.lookInput.add(t)}jump(){this.jumpInput=!0}onBeforeRender(){this.handleInput(this.moveInput,this.lookInput,this.jumpInput),this.lookInput.set(0,0),this.moveInput.set(0,0),this.jumpInput=!1}handleInput(t,i,n){var r,o,a,l,c,h,d,u,f,m,g;if((r=this.controller)!=null&&r.isGrounded&&(this._jumpCount=0,this.doubleJumpForce>0&&((o=this.animator)==null||o.setBool("doubleJump",!1))),this._currentSpeed.z+=t.y*this.movementSpeed*this.context.time.deltaTime,(a=this.animator)==null||a.setBool("running",t.length()>.01),(c=this.animator)==null||c.setBool("jumping",((l=this.controller)==null?void 0:l.isGrounded)===!0&&n),this._temp.copy(this._currentSpeed),this._temp.applyQuaternion(this.gameObject.quaternion),this.controller?this.controller.move(this._temp):this.gameObject.position.add(this._temp),this._currentAngularSpeed.y+=lt.toRadians(-i.x*this.rotationSpeed)*this.context.time.deltaTime,this.lookForward&&Math.abs(this._currentAngularSpeed.y)<.01){const A=this.context.mainCameraComponent.forward;A.y=0,A.normalize(),this._currentRotation.setFromUnitVectors(new T(0,0,1),A),this.gameObject.quaternion.slerp(this._currentRotation,this.context.time.deltaTime*10)}if(this.gameObject.rotateY(this._currentAngularSpeed.y),this._currentSpeed.multiplyScalar(1-this.context.time.deltaTime*10),this._currentAngularSpeed.y*=1-this.context.time.deltaTime*10,this.controller&&n&&this.jumpForce>0){let A=(h=this.controller)==null?void 0:h.isGrounded;if(this.doubleJumpForce>0&&!((d=this.controller)!=null&&d.isGrounded)&&this._jumpCount===1&&(A=!0,(u=this.animator)==null||u.setBool("doubleJump",!0)),A){this._jumpCount+=1;const y=this.controller.rigidbody,b=this._jumpCount===2?this.doubleJumpForce:this.jumpForce;y.applyImpulse(new T(0,1,0).multiplyScalar(b))}}if(this.controller){const A=(f=this.controller)==null?void 0:f.rigidbody.getVelocity().y;if(A<-1){this._raycastOptions.ray||(this._raycastOptions.ray=new Fa),this._raycastOptions.ray.origin.copy($t(this.gameObject)),this._raycastOptions.ray.direction.set(0,-1,0);const y=this.layer;this.gameObject.layers.disableAll(),this.gameObject.layers.set(2);const b=this.context.physics.raycast(this._raycastOptions);this.gameObject.layers.set(y),(b.length&&b[0].distance>2||A<-10)&&((m=this.animator)==null||m.setBool("falling",!0))}else(g=this.animator)==null||g.setBool("falling",!1)}}}Np([I(PA)],Dp.prototype,"controller",2);Np([I()],Dp.prototype,"movementSpeed",2);Np([I()],Dp.prototype,"rotationSpeed",2);Np([I()],Dp.prototype,"jumpForce",2);Np([I()],Dp.prototype,"doubleJumpForce",2);Np([I(Ro)],Dp.prototype,"animator",2);var AFe=Object.defineProperty,yFe=Object.getOwnPropertyDescriptor,bFe=(s,e,t,i)=>{for(var n=i>1?void 0:i?yFe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&AFe(e,t,n),n};class LM extends jr{constructor(){super(...arguments);p(this,"intensity",new rt(0))}get typeName(){return"ChromaticAberration"}onCreateEffect(){const t=new Oie;return t.offset=new Q(0,0),t.radialModulation=!0,t.modulationOffset=.15,this.intensity.valueProcessor=i=>i*.02,this.intensity.onValueChanged=i=>{t.offset.x=-i,t.offset.y=i},t}}bFe([I(rt)],LM.prototype,"intensity",2);Kc("ChromaticAberration",LM);var xFe=Object.defineProperty,vFe=Object.getOwnPropertyDescriptor,sae=(s,e,t,i)=>{for(var n=i>1?void 0:i?vFe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&xFe(e,t,n),n};const AY=ee("debugpost");var ZR=(s=>(s[s.None=0]="None",s[s.Neutral=1]="Neutral",s[s.ACES=2]="ACES",s[s.AgX=3]="AgX",s[s.KhronosNeutral=4]="KhronosNeutral",s))(ZR||{});function bD(s){switch(s){case 0:return aA;case 1:return Vx;case 2:return zx;case 3:return lA;case 4:return om;default:return om}}function _Fe(s){switch(s){case aA:return 0;case zx:return 2;case lA:return 3;case om:return 1;case Vx:return 1;default:return 0}}function yY(s){switch(s){case aA:return gr.LINEAR;case zx:return gr.ACES_FILMIC;case lA:return gr.AGX;case om:return gr.NEUTRAL;case Vx:return gr.REINHARD;default:return gr.LINEAR}}const rae=class extends jr{constructor(){super(...arguments);p(this,"mode",new rt(void 0));p(this,"exposure",new rt(1))}get typeName(){return"ToneMapping"}setMode(e){const t=ZR[e];return t===void 0?(console.error("Invalid ToneMapping mode",e),this):(this.mode.value=t,this)}get isToneMapping(){return!0}onEffectEnabled(){const e=Foe(this);e&&super.onEffectEnabled(e)}onCreateEffect(){if(this.postprocessingContext)for(const i of this.postprocessingContext.components){if(i===this)break;if(i!=this&&i instanceof rae){console.warn("Multiple tonemapping effects found in the same postprocessing stack: Please check your scene setup.",{activeEffect:i,ignoredEffect:this});return}}if(this.mode.isInitialized==!1){const i=_Fe(this.context.renderer.toneMapping);this.mode.initialize(i)}const e=bD(this.mode.value),t=new JL({mode:yY(e)});return this.mode.onValueChanged=i=>{const n=bD(i);t.mode=yY(n),AY&&console.log("ToneMapping mode changed to",ZR[i],n,t.mode)},AY&&console.log("Use ToneMapping",ZR[this.mode.value],e,t.mode,"renderer.tonemapping: "+this.context.renderer.toneMapping),this.exposure.onValueChanged=i=>{this.context.renderer.toneMappingExposure=i},t}onBeforeRender(){this.mode.overrideState&&(this.context.renderer.toneMapping=bD(this.mode.value)),this.exposure.overrideState&&(this.context.renderer.toneMappingExposure=this.exposure.value)}};let _m=rae;sae([I(rt)],_m.prototype,"mode",2);sae([I(rt)],_m.prototype,"exposure",2);Kc("Tonemapping",_m);var CFe=Object.defineProperty,wFe=Object.getOwnPropertyDescriptor,VP=(s,e,t,i)=>{for(var n=i>1?void 0:i?wFe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&CFe(e,t,n),n};class Qm extends jr{constructor(){super(...arguments);p(this,"postExposure",new rt(0));p(this,"contrast",new rt(0));p(this,"hueShift",new rt(0));p(this,"saturation",new rt(0))}get typeName(){return"ColorAdjustments"}init(){this.postExposure.valueProcessor=t=>(t=Math.pow(2,t),t),this.contrast.valueProcessor=t=>{let i=1;return t>0?i=200:t<0&&(i=100),t/i},this.contrast.defaultValue=0,this.hueShift.valueProcessor=t=>Math.PI*t/180,this.hueShift.defaultValue=0,this.saturation.valueProcessor=t=>t<0?t/100:t/(100*Math.PI),this.saturation.defaultValue=0}onCreateEffect(){var o,a;const t=[];this.context.renderer.toneMapping!==Zr&&this.postExposure.overrideState&&(this.context.renderer.toneMapping=Zr);let i=(o=this.postprocessingContext)==null?void 0:o.components.find(l=>l instanceof _m);i||(i=new _m,(a=this.postprocessingContext)==null||a.components.push(i)),this.postExposure.onValueChanged=l=>{this.postExposure.overrideState&&(i.exposure.value=l)};const n=new Xie;this.contrast.onValueChanged=l=>n.contrast=l;const r=new Qie;return t.push(n),t.push(r),this.hueShift.onValueChanged=l=>r.hue=l,this.saturation.onValueChanged=l=>r.saturation=l,t}}VP([I(rt)],Qm.prototype,"postExposure",2);VP([I(rt)],Qm.prototype,"contrast",2);VP([I(rt)],Qm.prototype,"hueShift",2);VP([I(rt)],Qm.prototype,"saturation",2);Kc("ColorAdjustments",Qm);const oae=Math.sqrt(5),SFe=(oae-1)/4,to=(5-oae)/20,mE=s=>Math.floor(s)|0,gE=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);function MFe(s=Math.random){const e=IFe(s),t=new Float64Array(e).map(o=>gE[o%32*4]),i=new Float64Array(e).map(o=>gE[o%32*4+1]),n=new Float64Array(e).map(o=>gE[o%32*4+2]),r=new Float64Array(e).map(o=>gE[o%32*4+3]);return function(a,l,c,h){let d,u,f,m,g;const A=(a+l+c+h)*SFe,y=mE(a+A),b=mE(l+A),x=mE(c+A),v=mE(h+A),_=(y+b+x+v)*to,C=y-_,S=b-_,M=x-_,L=v-_,w=a-C,E=l-S,B=c-M,P=h-L;let k=0,X=0,F=0,H=0;w>E?k++:X++,w>B?k++:F++,w>P?k++:H++,E>B?X++:F++,E>P?X++:H++,B>P?F++:H++;const W=k>=3?1:0,se=X>=3?1:0,de=F>=3?1:0,be=H>=3?1:0,Pe=k>=2?1:0,Oe=X>=2?1:0,ae=F>=2?1:0,Ae=H>=2?1:0,Se=k>=1?1:0,Le=X>=1?1:0,st=F>=1?1:0,ot=H>=1?1:0,Ct=w-W+to,zt=E-se+to,ke=B-de+to,Z=P-be+to,Ke=w-Pe+2*to,je=E-Oe+2*to,We=B-ae+2*to,nt=P-Ae+2*to,Tt=w-Se+3*to,mt=E-Le+3*to,O=B-st+3*to,D=P-ot+3*to,he=w-1+4*to,Ee=E-1+4*to,Ne=B-1+4*to,Re=P-1+4*to,yt=y&255,et=b&255,ct=x&255,Jt=v&255;let Ge=.6-w*w-E*E-B*B-P*P;if(Ge<0)d=0;else{const kt=yt+e[et+e[ct+e[Jt]]];Ge*=Ge,d=Ge*Ge*(t[kt]*w+i[kt]*E+n[kt]*B+r[kt]*P)}let At=.6-Ct*Ct-zt*zt-ke*ke-Z*Z;if(At<0)u=0;else{const kt=yt+W+e[et+se+e[ct+de+e[Jt+be]]];At*=At,u=At*At*(t[kt]*Ct+i[kt]*zt+n[kt]*ke+r[kt]*Z)}let Kt=.6-Ke*Ke-je*je-We*We-nt*nt;if(Kt<0)f=0;else{const kt=yt+Pe+e[et+Oe+e[ct+ae+e[Jt+Ae]]];Kt*=Kt,f=Kt*Kt*(t[kt]*Ke+i[kt]*je+n[kt]*We+r[kt]*nt)}let Lt=.6-Tt*Tt-mt*mt-O*O-D*D;if(Lt<0)m=0;else{const kt=yt+Se+e[et+Le+e[ct+st+e[Jt+ot]]];Lt*=Lt,m=Lt*Lt*(t[kt]*Tt+i[kt]*mt+n[kt]*O+r[kt]*D)}let at=.6-he*he-Ee*Ee-Ne*Ne-Re*Re;if(at<0)g=0;else{const kt=yt+1+e[et+1+e[ct+1+e[Jt+1]]];at*=at,g=at*at*(t[kt]*he+i[kt]*Ee+n[kt]*Ne+r[kt]*Re)}return 27*(d+u+f+m+g)}}function IFe(s){const t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){const n=i+~~(s()*(256-i)),r=t[i];t[i]=t[n],t[n]=r}for(let i=256;i<512;i++)t[i]=t[i-256];return t}const xD=ee("debugstencil");function TFe(s,e){return(s&1<<e.layer)!=0}const EFe=Symbol("stencils"),n0=class{constructor(e,t){p(this,"parser");p(this,"source");this.parser=e,this.source=t}get name(){return"NEEDLE_render_objects"}static applyStencil(e){if(!e)return;const t=e.sourceId;if(xD&&console.log(t,n0.stencils),!t)return;const i=n0.stencils[t];if(i)for(let n=i.length-1;n>=0;n--){const r=i[n];if(TFe(r.layer,e)){xD&&console.log(r),setTimeout(()=>{ka()&&yP(e.gameObject)&&(An("Stencil not supported on instanced objects"),console.warn("Stencil not supported on instanced objects",e))},500);for(let o=0;o<e.sharedMaterials.length;o++){let a=e.sharedMaterials[o];a&&(a=a.clone(),a[EFe]=!0,a.stencilWrite=!0,a.stencilWriteMask=255,a.stencilFuncMask=255,a.stencilRef=r.value,a.stencilFunc=r.compareFunc,a.stencilZPass=r.passOp,a.stencilFail=r.failOp,a.stencilZFail=r.zFailOp,e.sharedMaterials[o]=a)}e.gameObject.renderOrder=r.event*1e3+r.index*50;break}}}afterRoot(e){const t=this.parser.json.extensions;if(t){const i=t[LFe];if(i){xD&&console.log(i);const n=i.stencil;if(n&&Array.isArray(n))for(const r of n){const o={...r};o.compareFunc=RFe(o.compareFunc),o.passOp=vD(o.passOp),o.failOp=vD(o.failOp),o.zFailOp=vD(o.zFailOp),n0.stencils[this.source]||(n0.stencils[this.source]=[]),n0.stencils[this.source].push(o)}}}return null}};let uw=n0;p(uw,"stencils",{});function vD(s){switch(s){case 0:return Sf;case 1:return Zj;case 2:return Wj;case 3:return Hj;case 4:return Qj;case 6:return Kj;case 7:return Yj;case 5:return Jj}return 0}function RFe(s){switch(s){case 1:return UF;case 2:return jj;case 3:return qj;case 4:return $j;case 5:return e8;case 6:return t8;case 7:return i8;case 8:return vL}return UF}const LFe="NEEDLE_render_objects";var BFe=Object.defineProperty,PFe=Object.getOwnPropertyDescriptor,aae=(s,e,t,i)=>{for(var n=i>1?void 0:i?PFe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&BFe(e,t,n),n};const AE=ee("debugreflectionprobe"),bY=ee("noreflectionprobe"),GFe=Symbol("reflectionProbeKey"),kFe=Symbol("original material");var oR;const Uu=(oR=class extends ze{constructor(){var e;super();p(this,"_texture");p(this,"center");p(this,"size");p(this,"_boxHelper");Uu._probes.has(this.context)||Uu._probes.set(this.context,[]),(e=Uu._probes.get(this.context))==null||e.push(this)}static get(e,t,i,n){if(!e||e.isObject3D!==!0||bY)return null;const r=Uu._probes.get(t);if(r){for(const o of r)if(o.__didAwake||o.__internalAwake(),o.enabled&&n&&o.gameObject===n)return o}return AE&&console.debug("Did not find reflection probe",e.name,i,e),null}set texture(e){if(e&&!(e instanceof si)){console.error("ReflectionProbe.texture must be a Texture",e);return}this._texture=e,e&&(e.mapping=wo,e.colorSpace=ft,e.needsUpdate=!0)}get texture(){return this._texture}isInBox(e){var t;return(t=this._boxHelper)==null?void 0:t.isInBox(e)}awake(){this._boxHelper=this.gameObject.addComponent(il),this._boxHelper.updateBox(!0),AE&&this._boxHelper.showHelper(5592320,!0),this.texture&&(this.texture.mapping=wo,this.texture.colorSpace=ft,this.texture.needsUpdate=!0)}onDestroy(){const e=Uu._probes.get(this.context);if(e){const t=e.indexOf(this);t>=0&&e.splice(t,1)}}onSet(e){var i;if(bY||!this.enabled||((i=e.sharedMaterials)==null?void 0:i.length)<=0||!this.texture)return;let t=Uu._rendererMaterialsCache.get(e);t||(t=[],Uu._rendererMaterialsCache.set(e,t));for(let n=0;n<e.sharedMaterials.length;n++){const r=e.sharedMaterials[n];if(!r||r.envMap===void 0||r instanceof ii)continue;let o=t[n];const a=r===(o==null?void 0:o.copy),l=!o||o.material.uuid!==r.uuid||o.copy.version!==r.version;if(!a&&l){if(AE){let d="";o?o.material!==r?d="reference changed; cached instance?: "+a:o.copy.version!==r.version&&(d="version changed"):d="not cached",console.warn("Cloning material",r.name,r.version,"Reason:",d,`
`,r.uuid,`
`,o==null?void 0:o.copy.uuid,`
`,e.name)}const h=r.clone();h.version=r.version,o?(o.copy=h,o.material=r):(o={material:r,copy:h},t.push(o)),h[GFe]=this,h[kFe]=r,AE&&console.log("Set reflection",e.name,e.guid)}o&&o.copy&&(o.copy.onBeforeCompile=r.onBeforeCompile);const c=o==null?void 0:o.copy;c.envMap=this.texture,e.sharedMaterials[n]=c}}onUnset(e){const t=Uu._rendererMaterialsCache.get(e);if(t)for(let i=0;i<t.length;i++){const n=t[i];e.sharedMaterials[i]=n.material}}},p(oR,"_probes",new Map),p(oR,"_rendererMaterialsCache",new Map),oR);let vv=Uu;aae([I(T)],vv.prototype,"center",2);aae([I(T)],vv.prototype,"size",2);const _D=ee("debugexr");class NFe{constructor(e){p(this,"parser");this.parser=e,_D&&console.log(e)}get name(){return"EXT_texture_exr"}loadTexture(e){const t=this.name,i=this.parser,r=i.json.textures[e];if(_D&&console.log("EXT_texture_exr.loadTexture",e,r),!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=new bS(i.options.manager);return _D&&console.log("EXT_texture_exr.loadTexture",o),i.loadTextureImage(e,o.source,a)}}typeof window<"u"&&window.addEventListener("unhandledrejection",s=>{});const Gu=Ur,yE="$___Export_Components",DFe="NEEDLE_components";var BWe;class FFe{constructor(){p(this,BWe)}}BWe=qg;class VFe{constructor(e,t,i){p(this,"node");p(this,"nodeIndex");p(this,"nodeDef");this.node=e,this.nodeIndex=t,this.nodeDef=i}}class lae{constructor(){p(this,"parser");p(this,"nodeToObjectMap",{});p(this,"gltf",null);p(this,"exportContext");p(this,"objectToNodeMap",{});p(this,"context");p(this,"writer")}get name(){return DFe}registerExport(e){e.register(t=>{if("serializeUserData"in t){const i=t.serializeUserData.bind(t);this.writer=t,t.serializeUserData=(n,r)=>{try{this.serializeUserData(n,r)&&(t.extensionsUsed[this.name]=!0),i(n,r)}finally{this.afterSerializeUserData(n,r)}}}return this})}beforeParse(){this.exportContext={},this.objectToNodeMap={}}serializeUserData(e,t){var n;const i=(n=e.userData)==null?void 0:n.components;return!i||i.length<=0?!1:(delete e.userData.components,e[yE]=i,!0)}afterSerializeUserData(e,t){if(e.type==="Scene"&&Gu&&console.log("DONE",JSON.stringify(t)),e[yE]===void 0)return;const i=e[yE];delete e[yE],i!==null&&(e.userData.components=i)}writeNode(e,t){const i=this.writer.json.nodes.length;Gu&&console.log(e.name,i,e.uuid);const n=new VFe(e,i,t);this.exportContext[i]=n,this.objectToNodeMap[e.uuid]=i}afterParse(e){var t;Gu&&console.log("AFTER",e);for(const i in this.exportContext){const n=this.exportContext[i],r=n.node,o=n.nodeDef,a=n.nodeIndex,l=(t=r.userData)==null?void 0:t.components;if(!l||l.length<=0)continue;const c=new FFe;o.extensions=o.extensions||{},o.extensions[this.name]=c,this.context.object=r,this.context.nodeId=a,this.context.objectToNode=this.objectToNodeMap;const h=[];for(const d of l){this.context.target=d;const u=kh().writeBuiltinComponentData(d,this.context);u!==null&&h.push(u)}h.length>0&&(c[qg]=h,Gu&&console.log("DID WRITE",r,"nodeIndex",a,h))}}beforeRoot(){return Gu&&console.log("BEGIN LOAD"),this.nodeToObjectMap={},null}async afterRoot(e){this.gltf=e;const t=e.parser,i=t==null?void 0:t.extensions;if(!i)return;const n=i[this.name];Gu&&console.log("After root",e,this.parser,i);const r=[];if(n===!0){const o=t.json.nodes;if(o){for(let a=0;a<o.length;a++){const l=await t.getDependency("node",a);this.nodeToObjectMap[a]=l}for(let a=0;a<o.length;a++){const l=o[a],c=a,h=l.extensions;if(!h)continue;const d=h[this.name];if(!d)continue;Gu&&console.log("NODE",l);const u=this.nodeToObjectMap[c];if(!u){console.error("Could not find object for node index: "+c,l,t);continue}AP(u),r.push(this.createComponents(u,d))}}}await Promise.all(r);for(const o of t.associations.keys()){const a=t.associations.get(o);if((a==null?void 0:a.materials)!=null){const l="/materials/"+a.materials;ePe(o,l)}}}async createComponents(e,t){if(!t)return;const i=t[qg];if(i){const n=new Array;Gu&&console.log(e.name,i);for(const r in i){const o=i[r];Gu&&console.log("Serialized data",JSON.parse(JSON.stringify(o))),o&&this.parser&&n.push(c5(this.parser,o).catch(a=>console.error(`Error while resolving references (see console for details)
`,a,e,o))),e.userData=e.userData||{},e.userData[qg]=e.userData[qg]||[],e.userData[qg].push(o)}await Promise.all(n).catch(r=>{console.error("Error while loading components",r)})}}}const xY="NEEDLE_gameobject_data";class zFe{constructor(e){p(this,"parser");this.parser=e}get name(){return xY}afterRoot(e){var i;const t=[];for(let n=0;n<((i=this.parser.json.nodes)==null?void 0:i.length);n++){const r=this.parser.json.nodes[n];if(r&&r.extensions){const o=r.extensions[xY];if(o){const a=this.findAndApplyExtensionData(n,o);t.push(a)}}}return Promise.all(t).then(()=>null)}async findAndApplyExtensionData(e,t){const i=await this.parser.getDependency("node",e);i&&this.applyExtensionData(i,t)}applyExtensionData(e,t){t.layers===void 0&&(t.layers=0),e.userData.layer=t.layers,e.layers.disableAll(),e.layers.set(t.layers),e.userData.tag=t.tag??"none",e.userData.hideFlags=t.hideFlags??0,e.userData.static=t.static??!1,e.visible=t.activeSelf??!0,e.guid=t.guid}}const vY="NEEDLE_lighting_settings",fb=ee("debugenvlight");class UFe{constructor(e,t,i){p(this,"parser");p(this,"sourceId");p(this,"context");this.parser=e,this.sourceId=t,this.context=i}get name(){return vY}afterRoot(e){const t=this.parser.json.extensions;if(t){const i=t[vY];if(i){fb&&console.log('Loaded "'+this.name+'", src: "'+this.sourceId+'"',i);let n;if(e.scene.children.length===1){const r=e.scene.children[0];n=$.addComponent(r,v2,{},{callAwake:!1})}else{const r=new ye;r.name="LightSettings "+this.sourceId,e.scene.add(r),n=$.addComponent(r,v2,{},{callAwake:!1})}n.sourceId=this.sourceId,n.ambientIntensity=i.ambientIntensity,n.ambientLight=new ge().fromArray(i.ambientLight),Array.isArray(i.ambientTrilight)&&(n.ambientTrilight=i.ambientTrilight.map(r=>new ge().fromArray(r))),n.ambientMode=i.ambientMode,n.environmentReflectionSource=i.environmentReflectionSource}}return null}}Oi.registerCallback(ji.ContextCreated,s=>{const e=s.context,t=$.findObjectOfType(v2,e);t!=null&&t.sourceId&&(t.enabled=!0)});class v2 extends ze{constructor(){super(...arguments);p(this,"ambientMode",sx.Skybox);p(this,"ambientLight");p(this,"ambientTrilight");p(this,"ambientIntensity",1);p(this,"environmentReflectionSource",f2.Skybox);p(this,"_hasReflection",!1);p(this,"_ambientLightObj");p(this,"_hemisphereLightObj")}awake(){var i;if(this.sourceId){const n=this.environmentReflectionSource===f2.Skybox?Df.Skybox:Df.Reflection,r=this.context.lightmaps.tryGet(this.sourceId,n,0);this._hasReflection=r!=null,r&&this.context.sceneLighting.internalRegisterReflection(this.sourceId,r)}this.enabled=!1,this.context.sceneLighting.internalRegisterSceneLightSettings(this),fb&&window.addEventListener("keydown",n=>{if(!this.destroyed)switch(n.key){case"l":this.enabled=!this.enabled;break}});const t=(i=this.gameObject.userData)==null?void 0:i.components;if(t){const n=t.indexOf(this);t.splice(n,1),t.push(this)}}onDestroy(){this.context.sceneLighting.internalUnregisterSceneLightSettings(this)}calculateIntensityFactor(t){const i=Math.max(t.r,t.g,t.b);return 2.2*lt.lerp(0,1.33,i)}onEnable(){if(fb&&console.warn("💡🟡 >>> Enable lighting",this.sourceId,this.enabled,this),this.ambientMode==sx.Flat){if(this.ambientLight&&!this._ambientLightObj){const t=this.calculateIntensityFactor(this.ambientLight);this._ambientLightObj=new T1(this.ambientLight,this.ambientIntensity*t),fb&&console.log("Created ambient light",this.sourceId,this._ambientLightObj,this.ambientIntensity,t)}this._ambientLightObj&&this.gameObject.add(this._ambientLightObj)}else if(this.ambientMode===sx.Trilight){if(this.ambientTrilight){const t=this.ambientTrilight[0],i=this.ambientTrilight[this.ambientTrilight.length-1],n=this.calculateIntensityFactor(i);this._hemisphereLightObj=new vB(i,t,this.ambientIntensity*n),this.gameObject.add(this._hemisphereLightObj),fb&&console.log("Created hemisphere ambient light",this.sourceId,this._hemisphereLightObj,this.ambientIntensity,n)}}else this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent();this.sourceId&&this.context.sceneLighting.internalEnableReflection(this.sourceId)}onDisable(){fb&&console.warn("💡⚫ <<< Disable lighting:",this.sourceId,this),this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent(),this.sourceId&&this.context.sceneLighting.internalDisableReflection(this.sourceId)}}var cae=(s=>(s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_VEC2=35664]="FLOAT_VEC2",s[s.FLOAT_VEC3=35665]="FLOAT_VEC3",s[s.FLOAT_VEC4=35666]="FLOAT_VEC4",s[s.INT_VEC2=35667]="INT_VEC2",s[s.INT_VEC3=35668]="INT_VEC3",s[s.INT_VEC4=35669]="INT_VEC4",s[s.BOOL=35670]="BOOL",s[s.BOOL_VEC2=35671]="BOOL_VEC2",s[s.BOOL_VEC3=35672]="BOOL_VEC3",s[s.BOOL_VEC4=35673]="BOOL_VEC4",s[s.FLOAT_MAT2=35674]="FLOAT_MAT2",s[s.FLOAT_MAT3=35675]="FLOAT_MAT3",s[s.FLOAT_MAT4=35676]="FLOAT_MAT4",s[s.SAMPLER_2D=35678]="SAMPLER_2D",s[s.SAMPLER_3D=35680]="SAMPLER_3D",s[s.SAMPLER_CUBE=35681]="SAMPLER_CUBE",s[s.UNKNOWN=0]="UNKNOWN",s))(cae||{});const dd=ee("debugcustomshader"),Ny="NEEDLE_techniques_webgl";class XFe{constructor(){p(this,"objectToWorldMatrix",new ce);p(this,"worldToObjectMatrix",new ce);p(this,"objectToWorld",new Array);p(this,"worldToObject",new Array)}updateFrom(e){this.objectToWorldMatrix.copy(e.matrixWorld),p2(this.objectToWorldMatrix,this.objectToWorld),this.worldToObjectMatrix.copy(e.matrixWorld).invert(),p2(this.worldToObjectMatrix,this.worldToObject)}}const jn=class extends gB{constructor(t,...i){super(...i);p(this,"identifier");p(this,"onBeforeRenderSceneCallback",this.onBeforeRenderScene.bind(this));p(this,"_sphericalHarmonicsName","unity_SpecCube0");p(this,"_objToWorldName","hlslcc_mtx4x4unity_ObjectToWorld");p(this,"_worldToObjectName","hlslcc_mtx4x4unity_WorldToObject");p(this,"_viewProjectionName","hlslcc_mtx4x4unity_MatrixVP");p(this,"_viewMatrixName","hlslcc_mtx4x4unity_MatrixV");p(this,"_rendererData",new XFe);this.identifier=t,dd&&console.log(this),this.type="NEEDLE_CUSTOM_SHADER",this.uniforms[this._objToWorldName]||(this.uniforms[this._objToWorldName]={value:[]}),this.uniforms[this._worldToObjectName]||(this.uniforms[this._worldToObjectName]={value:[]}),this.uniforms[this._viewProjectionName]||(this.uniforms[this._viewProjectionName]={value:[]}),this.uniforms[this._sphericalHarmonicsName],(this.depthTextureUniform||this.opaqueTextureUniform)&&Wt.Current.pre_render_callbacks.push(this.onBeforeRenderSceneCallback)}clone(){const t=super.clone();return hae(t),t}dispose(){super.dispose();const t=Wt.Current.pre_render_callbacks.indexOf(this.onBeforeRenderSceneCallback);t>=0&&Wt.Current.pre_render_callbacks.splice(t,1)}get depthTextureUniform(){if(this.uniforms)return this.uniforms._CameraDepthTexture}get opaqueTextureUniform(){if(this.uniforms)return this.uniforms._CameraOpaqueTexture}onBeforeRenderScene(){this.opaqueTextureUniform&&Wt.Current.setRequireColor(!0),this.depthTextureUniform&&Wt.Current.setRequireDepth(!0)}onBeforeRender(t,i,n,r,o,a){r.attributes.tangent||r.computeTangents(),this.onUpdateUniforms(n,o)}onUpdateUniforms(t,i){const n=Wt.Current;if(t&&(jn.viewProjection&&this.uniforms[this._viewProjectionName]&&(jn.viewProjection.copy(t.projectionMatrix).multiply(t.matrixWorldInverse),p2(jn.viewProjection,jn._viewProjectionValues)),jn.viewMatrix&&this.uniforms[this._viewMatrixName]&&(jn.viewMatrix.copy(t.matrixWorldInverse),p2(jn.viewMatrix,jn._viewMatrixValues)),this.uniforms[jn._worldSpaceCameraPosName]&&jn._worldSpaceCameraPos.setFromMatrixPosition(t.matrixWorld)),this.uniforms._TimeParameters&&(this.uniforms._TimeParameters.value=n.sceneLighting.timeVec4),this.uniforms._Time){const l=this.uniforms._Time.value;l.x=n.sceneLighting.timeVec4.x/20,l.y=n.sceneLighting.timeVec4.x,l.z=n.sceneLighting.timeVec4.x*2,l.w=n.sceneLighting.timeVec4.x*3}if(this.uniforms._SinTime){const l=this.uniforms._SinTime.value;l.x=Math.sin(n.sceneLighting.timeVec4.x/8),l.y=Math.sin(n.sceneLighting.timeVec4.x/4),l.z=Math.sin(n.sceneLighting.timeVec4.x/2),l.w=Math.sin(n.sceneLighting.timeVec4.x)}if(this.uniforms._CosTime){const l=this.uniforms._CosTime.value;l.x=Math.cos(n.sceneLighting.timeVec4.x/8),l.y=Math.cos(n.sceneLighting.timeVec4.x/4),l.z=Math.cos(n.sceneLighting.timeVec4.x/2),l.w=Math.cos(n.sceneLighting.timeVec4.x)}if(this.uniforms.unity_DeltaTime){const l=this.uniforms.unity_DeltaTime.value;l.x=n.time.deltaTime,l.y=1/n.time.deltaTime,l.z=n.time.smoothedDeltaTime,l.w=1/n.time.smoothedDeltaTime}const r=n.mainLight;if(r){const l=$t(r.gameObject,jn._mainLightPosition);this.uniforms._MainLightPosition={value:l.normalize()},jn._mainLightColor.set(r.color.r,r.color.g,r.color.b,0),this.uniforms._MainLightColor={value:jn._mainLightColor};const c=r.intensity;jn._lightData.z=c,this.uniforms.unity_LightData={value:jn._lightData}}if(t&&(jn.viewProjection&&this.uniforms[this._viewProjectionName]&&(this.uniforms[this._viewProjectionName].value=jn._viewProjectionValues),jn.viewMatrix&&this.uniforms[this._viewMatrixName]&&(this.uniforms[this._viewMatrixName].value=jn._viewMatrixValues),this.uniforms[jn._worldSpaceCameraPosName]&&(this.uniforms[jn._worldSpaceCameraPosName]={value:jn._worldSpaceCameraPos}),n.mainCameraComponent)){if(this.uniforms._ProjectionParams){const l=this.uniforms._ProjectionParams.value;l.x=1,l.y=n.mainCameraComponent.nearClipPlane,l.z=n.mainCameraComponent.farClipPlane,l.w=1/l.z,this.uniforms._ProjectionParams.value=l}if(this.uniforms._ZBufferParams){const l=this.uniforms._ZBufferParams.value,c=n.mainCameraComponent;l.x=1-c.farClipPlane/c.nearClipPlane,l.y=c.farClipPlane/c.nearClipPlane,l.z=l.x/c.farClipPlane,l.w=l.y/c.farClipPlane,this.uniforms._ZBufferParams.value=l}if(this.uniforms._ScreenParams){const l=this.uniforms._ScreenParams.value;l.x=n.domWidth,l.y=n.domHeight,l.z=1+1/l.x,l.w=1+1/l.y,this.uniforms._ScreenParams.value=l}if(this.uniforms._ScaledScreenParams){const l=this.uniforms._ScaledScreenParams.value;l.x=n.domWidth,l.y=n.domHeight,l.z=1+1/l.x,l.w=1+1/l.y,this.uniforms._ScaledScreenParams.value=l}}const o=this.depthTextureUniform;o&&(o.value=n.depthTexture);const a=this.opaqueTextureUniform;if(a&&(a.value=n.opaqueColorTexture),i){const l=this._rendererData;l.updateFrom(i),this.uniforms[this._worldToObjectName].value=l.worldToObject,this.uniforms[this._objToWorldName].value=l.objectToWorld}this.uniformsNeedUpdate=!0}};let Ml=jn;p(Ml,"viewProjection",new ce),p(Ml,"_viewProjectionValues",[]),p(Ml,"viewMatrix",new ce),p(Ml,"_viewMatrixValues",[]),p(Ml,"_worldSpaceCameraPosName","_WorldSpaceCameraPos"),p(Ml,"_worldSpaceCameraPos",new T),p(Ml,"_mainLightColor",new Je),p(Ml,"_mainLightPosition",new T),p(Ml,"_lightData",new Je);class OFe{constructor(e,t){p(this,"parser");p(this,"identifier");this.parser=e,this.identifier=t}get name(){return Ny}loadMaterial(e){const t=this.parser.json.materials[e];if(!t)return dd&&console.log(e,this.parser.json.materials),null;if(!t.extensions||!t.extensions[Ny])return dd&&console.log(`Material ${e} does not use NEEDLE_techniques_webgl`),null;dd&&console.log(`Material ${e} uses NEEDLE_techniques_webgl`,t);const i=t.extensions[Ny].technique;if(i<0)return console.debug(`Material ${e} does not have a valid technique index`),null;const n=this.parser.json.extensions[Ny];if(!n)return dd?console.error("Missing shader data",this.parser.json.extensions):console.debug("Missing custom shader data in parser.json.extensions"),null;dd&&console.log(n);const r=n.techniques[i];return r?new Promise(async(o,a)=>{var y,b,x;const l=await lGe(n,r.program),c=l==null?void 0:l.fragmentShader,h=l==null?void 0:l.vertexShader;if(!c||!h)return a();dd&&console.log("loadMaterial",t,l);const d={},u=r.uniforms;(h.includes("_Time")||c.includes("_Time"))&&(d._Time={value:new Je(0,0,0,0)}),(h.includes("_SinTime")||c.includes("_SinTime"))&&(d._SinTime={value:new Je(0,0,0,0)}),(h.includes("_CosTime")||c.includes("_CosTime"))&&(d._CosTime={value:new Je(0,0,0,0)}),(h.includes("unity_DeltaTime")||c.includes("unity_DeltaTime"))&&(d.unity_DeltaTime={value:new Je(0,0,0,0)});for(const v in u){const _=v;switch(_){case"_TimeParameters":const C=new Je;d[_]={value:C};break;case"hlslcc_mtx4x4unity_MatrixV":case"hlslcc_mtx4x4unity_MatrixVP":d[_]={value:[]};break;case"_MainLightPosition":case"_MainLightColor":case"_WorldSpaceCameraPos":d[_]={value:[0,0,0,1]};break;case"unity_OrthoParams":break;case"unity_SpecCube0":d[_]={value:null};break;default:case"_ScreenParams":case"_ZBufferParams":case"_ProjectionParams":d[_]={value:[0,0,0,0]};break;case"_CameraOpaqueTexture":case"_CameraDepthTexture":d[_]={value:null};break}}let f=!1;if(t.extensions&&t.extensions[Ny]){const v=t.extensions[Ny];if(v.technique===i){dd&&console.log(t.name,"Material Properties",v);for(const _ in v.values){const C=v.values[_];if(typeof C=="string"){if(C.startsWith("/textures/")){const S=C.substring(10),M=Number.parseInt(S);if(M>=0){const L=await this.parser.getDependency("texture",M);L instanceof si&&(L.colorSpace=Ji,L.needsUpdate=!0),d[_]={value:L};continue}}switch(_){case"alphaMode":C==="BLEND"&&(f=!0);continue}}if(Array.isArray(C)&&C.length===4){d[_]={value:new Je(C[0],C[1],C[2],C[3])};continue}d[_]={value:C}}}}const m=new Ml(this.identifier,{name:t.name??"",uniforms:d,vertexShader:h,fragmentShader:c,lights:!1});switch(m.glslVersion=_L,m.vertexShader=m.vertexShader.replace("#version 300 es",""),m.fragmentShader=m.fragmentShader.replace("#version 300 es",""),(y=d._Cull)==null?void 0:y.value){case 0:m.side=Zi;break;case 1:m.side=vn;break;case 2:m.side=us;break;default:m.side=us;break}switch((b=d._ZTest)==null?void 0:b.value){case 3:m.depthTest=!0,m.depthFunc=rm;break;case 6:m.depthTest=!0,m.depthFunc=X0;break;case 2:m.depthTest=!0,m.depthFunc=U0;break;case 4:m.depthTest=!0,m.depthFunc=wp;break;case 5:m.depthTest=!0,m.depthFunc=hx;break;case 7:m.depthTest=!0,m.depthFunc=cx;break;case 8:m.depthTest=!1,m.depthFunc=lx;break}m.transparent=f,f&&(m.depthWrite=!1),oGe(d),m.onUpdateUniforms();for(const v in u){const _=v,C=u[v].type;if(((x=d[_])==null?void 0:x.value)===void 0)switch(C){case cae.SAMPLER_2D:d[_]={value:sGe},console.warn("Missing/unassigned texture, fallback to white: "+_);break;default:_==="unity_OrthoParams"||console.warn("TODO: EXPECTED UNIFORM / fallback NOT SET: "+_,u[v]);break}}dd&&console.log(m.uuid,d),hae(m),o(m)}):null}}function hae(s){if(s.uniforms){dd&&console.log("Uniforms:",s.uniforms);for(const t in s.uniforms)switch(e(t,t),t){case"_Color":e("color",t);break}}function e(t,i){Object.getOwnPropertyDescriptor(s,t)||Object.defineProperty(s,t,{get:()=>s.uniforms[i].value,set:n=>{s.uniforms[i].value=n,s.needsUpdate=!0}})}}const ZFe=ee("debugextensions");let _2;const WFe=Promise.resolve().then(()=>LWe).then(async s=>(_2=s.GLTFAnimationPointerExtension,_2)).catch(s=>{console.warn("Failed to import GLTFLoaderAnimationPointer. Please use @needle-tools/three for full KHR_animation support",s)}),nA=new Array;function HFe(s){nA.includes(s)||nA.push(s)}function QFe(s){const e=nA.indexOf(s);e>=0&&nA.splice(e,1)}function zP(s){const e=new lae;return s.register(t=>(e.parser=t,e)),e}class KFe{resolvePath(e){return e.includes("/extensions/builtin_components/")?e.replace("/extensions/builtin_components/","/userData/components/"):e.includes("extensions/builtin_components/")?e.replace("extensions/builtin_components/","/userData/components/"):e}}async function C2(s,e,t){const i=t.indexOf("?");i>=0&&(t=t.substring(0,i)),s.register(n=>new zFe(n)),s.register(n=>new iPe(n)),s.register(n=>new eGe(n,e.lightmaps,t)),s.register(n=>new UFe(n,t,e)),s.register(n=>new OFe(n,t)),s.register(n=>new uw(n,t)),s.register(n=>new Ni(n,t)),s.register(n=>new NFe(n)),$se()&&s.register(n=>new rw(n)),await WFe.catch(n=>{}),s.register(n=>{if(_2){const r=new _2(n);return r.setAnimationPointerResolver.bind(r)(new KFe),r}else return(ZFe||Qe())&&console.error("Missing KHR_animation_pointer extension..."),{name:"KHR_animation_pointer_NOT_AVAILABLE"}});for(const n of nA)n.onImport&&n.onImport(s,t,e)}function eZ(s,e){for(const t of nA)t.onExport&&t.onExport(s,e)}function tZ(s,e,t){for(const i of nA)i.onLoaded&&i.onLoaded(s,e,t)}const Ac=ee("debuginstancing"),tW=class{constructor(){p(this,"objs",[])}setup(e,t,i,n,r,o=0){e.applySettings(t);const a=this.tryCreateOrAddInstance(t,i,r);if(a){n===null&&(n=[]),n.push(a),Ni.assignTextureLOD(a.renderer.material,0);for(const l of e.sharedMeshes){const c=l.geometry;Ni.assignMeshLOD(l,0).then(h=>{h&&e.activeAndEnabled&&c!=h&&a.setGeometry(h)})}}else if(o<=0&&t.type!=="Mesh"){const l=o+1;for(const c of t.children)n=this.setup(e,c,i,n,r,l)}return o===0&&r.useMatrixWorldAutoUpdate&&n&&n.length>=0&&this.autoUpdateInstanceMatrix(t),n}tryCreateOrAddInstance(e,t,i){if(e.type==="Mesh"){const n=i.foundMeshes;if(i.foundMeshes+=1,!i.rend.enableInstancing)return null;if(i.rend.enableInstancing!==!0){if(n>=i.rend.enableInstancing.length)return Ac&&console.error("Something is wrong with instance setup",e,i.rend.enableInstancing,n),null;if(!i.rend.enableInstancing[n])return null}const r=e,o=r.material;for(const d of this.objs){if(!d.canAdd(r.geometry,o))continue;return d.addInstance(r)}const a=16;let l=e.name;l!=null&&l.length||(l=vte());const c=new dae(l,r.geometry,o,a,t);return this.objs.push(c),c.addInstance(r)}return null}autoUpdateInstanceMatrix(e){const t=e.matrixWorld.multiplyMatrices.bind(e.matrixWorld),i=e.matrixWorld.clone(),n=(r,o)=>{const a=t(r,o);return(e[gS]||i.equals(a)===!1)&&(i.copy(a),e[gS]=!0),a};e.matrixWorld.multiplyMatrices=n}};let tm=tW;p(tm,"instance",new tW);const Cw=class{constructor(e,t){p(this,"object");p(this,"renderer");p(this,"__instanceIndex",-1);p(this,"__reservedVertexRange",0);p(this,"__reservedIndexRange",0);p(this,"__geometryIndex",-1);p(this,"meshInformation");this.__instanceIndex=-1,this.object=e,this.renderer=t,e[sre]=t,this.meshInformation=mb(e.geometry),Cw.all.push(this)}get name(){return this.object.name}get isActive(){return this.__instanceIndex>=0}get vertexCount(){return this.object.geometry.attributes.position.count}get maxVertexCount(){return this.meshInformation.vertexCount}get reservedVertexCount(){return this.__reservedVertexRange}get indexCount(){return this.object.geometry.index?this.object.geometry.index.count:0}get maxIndexCount(){return this.meshInformation.indexCount}get reservedIndexCount(){return this.__reservedIndexRange}updateInstanceMatrix(e=!1,t=!0){this.__instanceIndex<0||(t&&this.object.updateWorldMatrix(!0,e),this.renderer.updateInstance(this.object.matrixWorld,this.__instanceIndex))}setMatrix(e){this.__instanceIndex<0||this.renderer.updateInstance(e,this.__instanceIndex)}setGeometry(e){return this.__geometryIndex<0?!1:this.vertexCount>this.__reservedVertexRange?(console.error(`Cannot update geometry, reserved vertex range is too small: ${this.__reservedVertexRange} < ${this.vertexCount} vertices for ${this.name}`),!1):this.indexCount>this.__reservedIndexRange?(console.error(`Cannot update geometry, reserved index range is too small: ${this.__reservedIndexRange} < ${this.indexCount} indices for ${this.name}`),!1):this.renderer.updateGeometry(e,this.__geometryIndex)}add(){this.__instanceIndex>=0||(this.renderer.add(this),$.markAsInstancedRendered(this.object,!0))}remove(e){if(!(this.__instanceIndex<0)&&(this.renderer.remove(this,e),$.markAsInstancedRendered(this.object,!1),e)){const t=Cw.all.indexOf(this);t>=0&&Cw.all.splice(t,1)}}};let k0=Cw;p(k0,"all",[]);class dae{constructor(e,t,i,n,r){p(this,"allowResize",!0);p(this,"name","");p(this,"geometry");p(this,"material");p(this,"_context");p(this,"_batchedMesh");p(this,"_handles",[]);p(this,"_geometryIds",new Map);p(this,"_maxInstanceCount");p(this,"_currentInstanceCount",0);p(this,"_currentVertexCount",0);p(this,"_currentIndexCount",0);p(this,"_maxVertexCount");p(this,"_maxIndexCount");p(this,"_needUpdateBounds",!1);p(this,"_debugMaterial",null);p(this,"onBeforeRender",()=>{this._batchedMesh.layers.enableAll(),this._needUpdateBounds&&this._batchedMesh[mC]===!0&&(Ac&&console.log("Update instancing bounds",this.name,this._batchedMesh.matrixWorldNeedsUpdate),this.updateBounds())});p(this,"onAfterRender",()=>{this._batchedMesh.layers.disableAll()});p(this,"_availableBuckets",new Array);p(this,"_usedBuckets",new Array);this.name=e,this.geometry=t,this.material=i,this._context=r,this._maxInstanceCount=Math.max(2,n),Ac&&(this._debugMaterial=_Y());const o=this.tryEstimateVertexCountSize(this._maxInstanceCount,[t],n);this._maxVertexCount=o.vertexCount,this._maxIndexCount=o.indexCount,this._batchedMesh=new Vw(this._maxInstanceCount,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material),this._batchedMesh[mC]=!0,this._batchedMesh.visible=!0,this._context.scene.add(this._batchedMesh),i instanceof gB&&(i.defines.USE_INSTANCING=!0,i.needsUpdate=!0),r.pre_render_callbacks.push(this.onBeforeRender),r.post_render_callbacks.push(this.onAfterRender),Ac&&console.log(`Instanced renderer created with ${this._maxInstanceCount} instances, ${this._maxVertexCount} max vertices and ${this._maxIndexCount} max indices for "${e}"`)}get batchedMesh(){return this._batchedMesh}get visible(){return this._batchedMesh.visible}set visible(e){this._batchedMesh.visible=e}get castShadow(){return this._batchedMesh.castShadow}set castShadow(e){this._batchedMesh.castShadow=e}set receiveShadow(e){this._batchedMesh.receiveShadow=e}get count(){return this._currentInstanceCount}updateBounds(e=!0,t=!0){this._needUpdateBounds=!1,e&&this._batchedMesh.computeBoundingBox(),t&&this._batchedMesh.computeBoundingSphere()}canAdd(e,t){return this._maxVertexCount>1e7||t!==this.material||!this.validateGeometry(e)?!1:!!(!this.mustGrow(e)||this.allowResize)}dispose(){Ac&&console.warn("Dispose instanced renderer",this.name),this._context.scene.remove(this._batchedMesh),this._batchedMesh.dispose(),this._batchedMesh=null,this._handles=[]}addInstance(e){const t=new k0(e,this);e.castShadow===!0&&this._batchedMesh.castShadow===!1&&(this._batchedMesh.castShadow=!0),e.receiveShadow===!0&&this._batchedMesh.receiveShadow===!1&&(this._batchedMesh.receiveShadow=!0);try{this.add(t)}catch(i){return console.error(`Failed adding mesh to instancing
`,i),Qe()&&tM("Failed instancing mesh. See the browser console for details."),null}return t}add(e){const t=e.object.geometry;if(!t||!t.attributes)return console.error("Cannot add object to instancing without geometry",e.name),!1;if(this.mustGrow(t))if(this.allowResize)this.grow(t);else return console.error("Cannot add instance, max count reached",this.name,this.count,this._maxInstanceCount),!1;return e.object.updateWorldMatrix(!0,!0),this.addGeometry(e),this._handles[e.__instanceIndex]=e,this._currentInstanceCount+=1,this.markNeedsUpdate(),this._currentInstanceCount>0&&(this._batchedMesh.visible=!0),!0}remove(e,t){e&&(e.__instanceIndex<0||this._handles[e.__instanceIndex]!=e||this._currentInstanceCount<=0||(this.removeGeometry(e,t),this._handles[e.__instanceIndex]=null,e.__instanceIndex=-1,this._currentInstanceCount>0&&(this._currentInstanceCount-=1),this._currentInstanceCount<=0&&(this._batchedMesh.visible=!1),this.markNeedsUpdate()))}updateInstance(e,t){this._batchedMesh.setMatrixAt(t,e),this.markNeedsUpdate()}updateGeometry(e,t){return this.validateGeometry(e)?(this.mustGrow()&&this.grow(e),Ac&&console.debug("UPDATE MESH",t,this._batchedMesh._geometryCount,e.name,mb(e),e.attributes.position.count,e.index?e.index.count:0),this._batchedMesh.setGeometryAt(t,e),this.markNeedsUpdate(),!0):!1}validateGeometry(e){const t=this.geometry;for(const i in t.attributes)if(i!=="batchId"&&!e.hasAttribute(i))return Qe()&&console.warn(`BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`),!1;return!0}markNeedsUpdate(){Ac&&console.warn("Marking instanced mesh dirty",this.name),this._needUpdateBounds=!0}mustGrow(e){if(this.count>=this._maxInstanceCount)return!0;if(!e||!e.attributes)return!1;const t=mb(e),i=t.vertexCount,n=t.indexCount;return this._currentVertexCount+i>this._maxVertexCount||this._currentIndexCount+n>this._maxIndexCount}grow(e){const t=this._maxInstanceCount*2,i=this.tryEstimateVertexCountSize(t,[e]),n=Math.max(this._maxVertexCount,i.vertexCount),r=Math.max(this._maxIndexCount,i.indexCount,this._maxVertexCount*2);if(Ac){const l=mb(e);console.warn(`Growing batched mesh for "${this.name}/${e.name}" ${l.vertexCount} vertices, ${l.indexCount} indices
Max count ${this._maxInstanceCount} → ${t}
Max vertex count ${this._maxVertexCount} -> ${n}
Max index count ${this._maxIndexCount} -> ${r}`),this._debugMaterial=_Y()}this._maxVertexCount=n,this._maxIndexCount=r;const o=new Vw(t,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material);o.layers=this._batchedMesh.layers,o.castShadow=this._batchedMesh.castShadow,o.receiveShadow=this._batchedMesh.receiveShadow,o.visible=this._batchedMesh.visible,o[mC]=this._batchedMesh[mC],o.matrixAutoUpdate=this._batchedMesh.matrixAutoUpdate,o.matrixWorldNeedsUpdate=this._batchedMesh.matrixWorldNeedsUpdate,o.matrixAutoUpdate=this._batchedMesh.matrixAutoUpdate,o.matrixWorld.copy(this._batchedMesh.matrixWorld),o.matrix.copy(this._batchedMesh.matrix),this._batchedMesh.dispose(),this._batchedMesh.removeFromParent(),this._geometryIds.clear(),this._batchedMesh=o,this._maxInstanceCount=t,this._usedBuckets.length=0,this._availableBuckets.length=0;const a=[...this._handles];this._handles=[];for(const l of a)l&&l.__instanceIndex>=0&&(this.addGeometry(l),this._handles[l.__instanceIndex]=l);this._context.scene.add(o)}tryEstimateVertexCountSize(e,t,i=1){const n=new Map;for(const d of this._handles)if(d&&d.__instanceIndex>=0&&d.object.geometry)if(n.has(d.object.geometry)){const u=n.get(d.object.geometry);u.count+=1}else{const f={count:1,...mb(d.object.geometry)};n.set(d.object.geometry,f)}let r=0,o=0;for(const[d,u]of n)r+=u.vertexCount*u.count,o+=u.indexCount*u.count;let l=Math.ceil(r/Math.max(1,this._currentInstanceCount))*e,h=Math.ceil(o/Math.max(1,this._currentInstanceCount))*e*2;if(t)for(const d of t){const u=mb(d);u!=null&&(l+=u.vertexCount*i,h+=u.indexCount*i)}return{vertexCount:l,indexCount:h}}addGeometry(e){const t=e.object.geometry;if(!t)return;let i=null,n=-1;for(let a=this._availableBuckets.length-1;a>=0;a--){const l=this._availableBuckets[a];l.vertexCount>=e.maxVertexCount&&l.indexCount>=e.maxIndexCount&&(i==null||l.vertexCount<i.vertexCount)&&(i=l,n=a)}if(i!=null){const a=i;Ac&&console.debug(`RE-USE SPACE #${a.geometryIndex}, ${e.maxVertexCount} vertices, ${e.maxIndexCount} indices, ${e.name}`);try{this._batchedMesh.setGeometryAt(a.geometryIndex,e.object.geometry);const l=this._batchedMesh.addInstance(a.geometryIndex);this._batchedMesh.setMatrixAt(l,e.object.matrixWorld),this._batchedMesh.setVisibleAt(l,!0),e.__instanceIndex=l,this._usedBuckets[a.geometryIndex]=a,this._availableBuckets.splice(n,1);return}catch(l){Ac?console.error("Failed to re-use space",l):Qe()&&l instanceof Error&&console.warn(`Failed to re-use space "${l.message}" in bucket ${a.geometryIndex} (${a.vertexCount}) - will add new geometry instead`)}}Ac&&console.debug("ADD GEOMETRY",t.name,`
vertex:`,`${this._currentVertexCount} + ${e.maxVertexCount} < ${this._maxVertexCount}?`,`
index:`,e.maxIndexCount,this._currentIndexCount,this._maxIndexCount);let r=this._geometryIds.get(t);r==null&&(r=this._batchedMesh.addGeometry(t,e.maxVertexCount,e.maxIndexCount),this._geometryIds.set(t,r));const o=this._batchedMesh.addInstance(r);e.__geometryIndex=r,e.__instanceIndex=o,e.__reservedVertexRange=e.maxVertexCount,e.__reservedIndexRange=e.maxIndexCount,this._currentVertexCount+=e.maxVertexCount,this._currentIndexCount+=e.maxIndexCount,this._usedBuckets[o]={geometryIndex:r,vertexCount:e.maxVertexCount,indexCount:e.maxIndexCount},this._batchedMesh.setMatrixAt(o,e.object.matrixWorld),Ac&&console.debug(`ADD MESH & RESERVE SPACE #${o}, ${e.maxVertexCount} vertices, ${e.maxIndexCount} indices, ${e.name} ${e.object.uuid}`)}removeGeometry(e,t){if(e.__instanceIndex<0){console.warn("Cannot remove geometry, instance index is invalid",e.name);return}this._usedBuckets.splice(e.__instanceIndex,1),this._batchedMesh.deleteInstance(e.__instanceIndex),this._availableBuckets.push({geometryIndex:e.__geometryIndex,vertexCount:e.reservedVertexCount,indexCount:e.reservedIndexCount})}}p(dae,"nullMatrix",new ce);function mb(s){var n,r;if(!s)return Qe()&&console.error("Cannot get mesh information from null geometry"),{vertexCount:0,indexCount:0};let e=((r=(n=s.attributes)==null?void 0:n.position)==null?void 0:r.count)||0,t=s.index?s.index.count:0;const i=Ni.getMeshLODInformation(s);if(i){const o=i.lods[0];let a=o.vertexCount,l=o.indexCount;const c=Math.min(128,Math.ceil(a*.15));a+=c,l+=20,e=Math.max(e,a),t=Math.max(t,l)}return e=Math.ceil(e),t=Math.ceil(t),{vertexCount:e,indexCount:t}}function _Y(){const s=new Us({color:new ge(Math.random(),Math.random(),Math.random())});return s.emissive=s.color,s.emissiveIntensity=.3,ee("wireframe")&&(s.wireframe=!0),s}const Dy=ee("debuglightmaps");class SS{constructor(e,t){p(this,"lightmapIndex",-1);p(this,"lightmapScaleOffset",new Je(1,1,0,0));p(this,"context");p(this,"gameObject");p(this,"lightmapTexture",null);p(this,"lightmapScaleOffsetUniform",{value:new Je(1,1,0,0)});p(this,"lightmapUniform",{value:null});p(this,"onBeforeCompile",(e,t)=>{Dy&&console.log(`Lightmaps, before compile
`,e),this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,this.lightmapUniform.value=this.lightmapTexture,e.uniforms.lightmapScaleOffset=this.lightmapScaleOffsetUniform});this.gameObject=e,this.context=t}get lightmap(){return this.lightmapTexture}set lightmap(e){e!==this.lightmapTexture&&(this.lightmapTexture=e,this.applyLightmap(),this.lightmapTexture&&Ni.assignTextureLOD(this.lightmapTexture,0).then(t=>{t!=null&&t.isTexture&&(this.lightmapTexture=t)}))}init(e,t,i){console.assert(this.gameObject!==void 0&&this.gameObject!==null,"Missing gameobject",this),this.lightmapIndex=e,!(this.lightmapIndex<0)&&(this.lightmapScaleOffset=t,this.lightmapTexture=i,Ni.assignTextureLOD(i,0).then(n=>{n!=null&&n.isTexture&&(this.lightmapTexture=n)}),Dy=="show"?(console.log("Lightmap:",this.gameObject.name,e,`
ScaleOffset:`,t,`
Texture:`,i),this.setLightmapDebugMaterial()):Dy&&console.log("Use debuglightmaps=show to render lightmaps only in the scene."),this.applyLightmap())}updateLightmapUniforms(e){const t=e.uniforms;t&&t.lightmap&&(this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,t.lightmapScaleOffset=this.lightmapScaleOffsetUniform)}applyLightmap(){if(this.gameObject.type==="Object3D"){Dy&&console.warn("Can not add lightmap. Is this object missing a renderer?",this.gameObject.name);return}if(this.gameObject.type==="Group"){this.gameObject["Needle:Multimaterial-LightmapWarning"]===void 0&&(this.gameObject["Needle:Multimaterial-LightmapWarning"]=!0,console.warn("Lightmap on multimaterial object is not supported yet... please open a feature request on https://github.com/needle-tools/needle-engine-support if your project requires it"));return}console.assert(this.gameObject.type==="Mesh","Lightmap only works on meshes",this);const e=this.gameObject;if(e.geometry.getAttribute("uv1")||e.geometry.setAttribute("uv1",e.geometry.getAttribute("uv")),Array.isArray(this.gameObject.material)){const t=this.gameObject.material;for(let i=0;i<t.length;i++)t[i]=this.ensureLightmapMaterial(t[i])}else this.gameObject.material=this.ensureLightmapMaterial(this.gameObject.material);if(this.lightmapIndex>=0&&this.lightmapTexture){this.lightmapTexture.channel=1;const t=this.gameObject.material;if(Array.isArray(t))for(const i of t)this.assignLightmapTexture(i);else t&&this.assignLightmapTexture(t)}}ensureLightmapMaterial(e){return e.userData||(e.userData={}),e["NEEDLE:lightmap-material-version"]!=e.version&&e["NEEDLE:lightmap-material-version"]==null&&(Dy&&console.warn("Cloning material for lightmap "+e.name),e=e.clone(),e.onBeforeCompile=this.onBeforeCompile),e}assignLightmapTexture(e){!e||e instanceof To&&e.transmission>0||!(e.lightMap!==this.lightmapTexture||e["NEEDLE:lightmap-material-version"]!==e.version)||(Dy&&console.log("Assigning lightmap",e.name,e.version),e.lightMap=this.lightmapTexture,e["NEEDLE:lightmap-material-version"]=e.version)}setLightmapDebugMaterial(){this.gameObject.material=new Ht({vertexShader:`
                varying vec2 vUv1;
                void main()
                {
                    vUv1 = uv1;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
                }
                `,fragmentShader:`
                uniform sampler2D lightMap;
                uniform float lightMapIntensity;
                uniform vec4 lightmapScaleOffset;
                varying vec2 vUv1;

                // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
                vec4 conv_sRGBToLinear( in vec4 value ) {
                    return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
                }

                void main() {
                    vec2 lUv = vUv1.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
                    
                    vec4 lightMapTexel = texture2D( lightMap, lUv);
                    gl_FragColor = lightMapTexel;
                    gl_FragColor.a = 1.;
                }
                `,defines:{USE_LIGHTMAP:""}})}}var YFe=Object.defineProperty,JFe=Object.getOwnPropertyDescriptor,Fp=(s,e,t,i)=>{for(var n=i>1?void 0:i?JFe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&YFe(e,t,n),n};const SC=ee("debugrenderer"),CY=ee("debugskinnedmesh"),wY=ee("noinstancing"),jFe=ee("wireframe");class iZ{constructor(){p(this,"path",null);p(this,"asset",null);p(this,"default")}}class qFe{constructor(e,t){p(this,"_renderer");p(this,"_targets",[]);p(this,"_indexMapMaxIndex");p(this,"_indexMap");p(this,"_changed",!1);this._renderer=e;const i=this.setMaterial.bind(this),n=this.getMaterial.bind(this),r=e.gameObject;if(this._targets=[],r)switch(r.type){case"Group":this._targets=[...r.children];break;case"SkinnedMesh":case"Mesh":this._targets.push(r);break}let o=!1,a,l=0;for(let c=0;c<this._targets.length;c++){const h=this._targets[c];if(!h)continue;const d=h.material;if(d){d.shadowSide=d.side;for(let u=0;u<t.length;u++){const f=t[u];if(!f){o=!0;continue}if(d.name===f.name){a===void 0&&(a=new Map),a.set(u,c),l=Math.max(l,u);break}}}}if(o){this._indexMapMaxIndex=l,this._indexMap=a;const c=`Renderer ${e.name} was initialized with missing materials - this may lead to unexpected behaviour when trying to access sharedMaterials by index.`;console.warn(c),ka()&&An("Found renderer with missing materials: please check the console for details.")}return new Proxy(this,{get(c,h){if(typeof h=="string"){const d=parseInt(h);if(!isNaN(d))return n(d)}return c[h]},set(c,h,d){return typeof h=="string"&&i(d,Number.parseInt(h)),Reflect.set(c,h,d)?(d instanceof Yt&&(c.changed=!0),!0):!1}})}get changed(){return this._changed}set changed(e){e===!0&&SC&&console.warn("SharedMaterials have changed: "+this._renderer.name,this),this._changed=e}is(e){return this._renderer===e}get length(){return this._indexMapMaxIndex!==void 0?this._indexMapMaxIndex+1:this._targets.length}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.getMaterial(e)}resolveIndex(e){const t=this._indexMap;return t&&t.has(e)?t.get(e):e}setMaterial(e,t){if(t=this.resolveIndex(t),t<0||t>=this._targets.length)return;const i=this._targets[t];!i||i.material===void 0||(i.material=e,this.changed=!0)}getMaterial(e){if(e=this.resolveIndex(e),e<0)return null;const t=this._targets;if(e>=t.length)return null;const i=t[e];return i?i.material:null}}const WR=class extends ze{constructor(){super(...arguments);p(this,"receiveShadows",!1);p(this,"shadowCastingMode",0);p(this,"lightmapIndex",-1);p(this,"lightmapScaleOffset",new Je(1,1,0,0));p(this,"enableInstancing");p(this,"renderOrder");p(this,"allowOcclusionWhenDynamic",!0);p(this,"probeAnchor");p(this,"reflectionProbeUsage",0);p(this,"_lightmaps");p(this,"_sharedMeshes",[]);p(this,"_sharedMaterials");p(this,"_originalMaterials");p(this,"_probeAnchorLastFrame");p(this,"_lightmapTextureOverride");p(this,"allowProgressiveLoading",!0);p(this,"_firstFrame",-1);p(this,"_isInstancingEnabled",!1);p(this,"_handles");p(this,"_handlesTempArray",[]);p(this,"onBeforeRenderThree",(e,t,i,n,r,o)=>{var a;if(r.envMapIntensity!==void 0){const l=this.hasLightmap?Math.PI:1,c=((a=this.context.mainCameraComponent)==null?void 0:a.environmentIntensity)??1;r.envMapIntensity=Math.max(0,c*this.context.sceneLighting.environmentIntensity/l)}if(this._lightmaps)for(const l of this._lightmaps)l.updateLightmapUniforms(r),l.applyLightmap()});p(this,"_reflectionProbe",null)}static setInstanced(e,t){const i=dM(e,WR);return i.setInstancingEnabled(t),i}static isInstanced(e){const t=vA(e,WR);return t?t.isInstancingActive:Vc.isUsingInstancing(e)}static setVisible(e,t){sp(e,t)}get sharedMesh(){if(this.gameObject.type==="Mesh")return this.gameObject;if(this.gameObject.type==="SkinnesMesh")return this.gameObject;if(this.gameObject.type==="Group")return this.gameObject.children[0]}get sharedMeshes(){if(this.destroyed||!this.gameObject)return this._sharedMeshes;if(this._sharedMeshes.length=0,this.gameObject.type==="Group")for(const e of this.gameObject.children)(e.type==="Mesh"||e.type==="SkinnedMesh")&&this._sharedMeshes.push(e);else(this.gameObject.type==="Mesh"||this.gameObject.type==="SkinnedMesh")&&this._sharedMeshes.push(this.gameObject);return this._sharedMeshes}get sharedMaterial(){return this.sharedMaterials[0]}set sharedMaterial(e){this.sharedMaterials[0]!==e&&(this.sharedMaterials[0]=e,this.applyLightmapping())}get material(){return this.sharedMaterials[0]}set material(e){this.sharedMaterial=e}set sharedMaterials(e){if(!this._originalMaterials)this._originalMaterials=e;else if(e){let t=!1;for(let i=0;i<this._sharedMaterials.length;i++){const n=i<e.length?e[i]:null;n&&n instanceof Yt?this.sharedMaterials[i]=n:t||(t=!0,console.warn("Can not assign null as material: "+this.name,n))}}}get sharedMaterials(){return(!this._sharedMaterials||!this._sharedMaterials.is(this))&&(this._originalMaterials||(this._originalMaterials=[]),this._sharedMaterials=new qFe(this,this._originalMaterials)),this._sharedMaterials}static get shouldSuppressInstancing(){return wY}get lightmap(){var e;return(e=this._lightmaps)!=null&&e.length?this._lightmaps[0].lightmap:null}set lightmap(e){var t;if(this._lightmapTextureOverride=e,e===void 0&&(e=this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex)),(t=this._lightmaps)!=null&&t.length)for(const i of this._lightmaps)i.lightmap=e}get hasLightmap(){const e=this.lightmap;return e!=null}registering(){this.enabled||this.setVisibility(!1)}awake(){if(this._firstFrame=this.context.time.frame,SC&&console.log("Renderer ",this.name,this),this.clearInstancingState(),this.probeAnchor&&SC&&this.probeAnchor.add(new al(.2)),this._reflectionProbe=null,this.isMultiMaterialObject(this.gameObject)){for(const e of this.gameObject.children)this.context.addBeforeRenderListener(e,this.onBeforeRenderThree),e.layers.mask=this.gameObject.layers.mask;if(this.renderOrder!==void 0){let e=0;for(let t=0;t<this.gameObject.children.length;t++){const i=this.gameObject.children[t];if(!(!this.isMeshOrSkinnedMesh(i)||$.getComponent(i,WR))){if(this.renderOrder.length<=e){console.warn("Incorrect renderOrder element count",this,this.renderOrder.length+" but expected "+this.gameObject.children.length,"Index: "+e,"ChildElement:",i);continue}i.renderOrder=this.renderOrder[e],e+=1}}}}else this.isMeshOrSkinnedMesh(this.gameObject)?(this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree),this.renderOrder!==void 0&&this.renderOrder.length>0&&(this.gameObject.renderOrder=this.renderOrder[0])):this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree);if(this.applyLightmapping(),jFe)for(let e=0;e<this.sharedMaterials.length;e++){const t=this.sharedMaterials[e];t&&(t.wireframe=!0)}}applyLightmapping(){var e;if(this.lightmapIndex>=0){const t=this.gameObject.type,i=this._lightmapTextureOverride!==void 0?this._lightmapTextureOverride:this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex);if(i){if(this._lightmaps||(this._lightmaps=[]),t==="Mesh"){const n=this.gameObject.material;if(n!=null&&n.isMeshBasicMaterial)n&&console.warn("Lightmapping is not supported on MeshBasicMaterial",n.name);else{if(this._lightmaps.length<=0){const o=new SS(this.gameObject,this.context);this._lightmaps.push(o)}this._lightmaps[0].init(this.lightmapIndex,this.lightmapScaleOffset,i)}}else if(this.isMultiMaterialObject(this.gameObject)&&this.sharedMaterials.length>0)for(let n=0;n<this.gameObject.children.length;n++){const r=this.gameObject.children[n];if(!((e=r.material)!=null&&e.isMeshBasicMaterial)){let o;n>=this._lightmaps.length?(o=new SS(r,this.context),this._lightmaps.push(o)):o=this._lightmaps[n],o.init(this.lightmapIndex,this.lightmapScaleOffset,i)}}}else SC&&console.warn("Lightmap not found",this.sourceId,this.lightmapIndex)}}get isInstancingActive(){return this._handles!=null&&this._handles.length>0&&this._isInstancingEnabled}get instances(){if(!this._handles||this._handles.length<=0)return null;if(this._handlesTempArray.length=0,this._handles)for(const e of this._handles)this._handlesTempArray.push(e);return this._handlesTempArray}setInstancingEnabled(e){if(this._isInstancingEnabled===e)return e&&(this._handles===void 0||this._handles!=null&&this._handles.length>0);if(this._isInstancingEnabled=e,e){if(this.enableInstancing===void 0&&(this.enableInstancing=!0),this._handles===void 0){if(this._handles=tm.instance.setup(this,this.gameObject,this.context,null,{rend:this,foundMeshes:0,useMatrixWorldAutoUpdate:this.useInstanceMatrixWorldAutoUpdate()}),this._handles)return $.markAsInstancedRendered(this.gameObject,!0),!0}else if(this._handles!==null){for(const t of this._handles)t.updateInstanceMatrix(!0),t.add();return $.markAsInstancedRendered(this.gameObject,!0),!0}}else{if(this._handles)for(const t of this._handles)t.remove(this.destroyed);return!0}return!1}clearInstancingState(){this._isInstancingEnabled=!1,this._handles=void 0}useInstanceMatrixWorldAutoUpdate(){return!0}start(){if(this.enableInstancing&&!wY&&(this.setInstancingEnabled(!0),Vc.markDirty(this.gameObject)),this.gameObject.frustumCulled=this.allowOcclusionWhenDynamic,this.isMultiMaterialObject(this.gameObject))for(let e=0;e<this.gameObject.children.length;e++){const t=this.gameObject.children[e];t.frustumCulled=this.allowOcclusionWhenDynamic}}onEnable(){this.sharedMeshes,this.setVisibility(!0),this._isInstancingEnabled||this.enableInstancing==!0||Array.isArray(this.enableInstancing)&&this.enableInstancing.some(t=>t)?this.__internalDidAwakeAndStart&&this.setInstancingEnabled(!0):this.enabled&&this.applyStencil(),this.updateReflectionProbe()}onDisable(){this.setVisibility(!1),this._handles&&this._handles.length>0&&this.setInstancingEnabled(!1)}onDestroy(){if(this._handles=null,this.isMultiMaterialObject(this.gameObject))for(const e of this.gameObject.children)this.context.removeBeforeRenderListener(e,this.onBeforeRenderThree);else this.context.removeBeforeRenderListener(this.gameObject,this.onBeforeRenderThree)}onBeforeRender(){var e,t,i;if(this.gameObject){if(this._probeAnchorLastFrame!==this.probeAnchor&&((e=this._reflectionProbe)==null||e.onUnset(this),this.updateReflectionProbe()),SC==this.name&&this.gameObject instanceof fe){this.gameObject.geometry.computeBoundingSphere();const n=St(this.gameObject.geometry.boundingSphere.center).applyMatrix4(this.gameObject.matrixWorld);Mt.DrawWireSphere(n,this.gameObject.geometry.boundingSphere.radius,56831)}if(this.isMultiMaterialObject(this.gameObject)&&((t=this.gameObject.children)==null?void 0:t.length)>0)for(const n of this.gameObject.children)this.applySettings(n);else this.applySettings(this.gameObject);if(this.sharedMaterials.changed&&(this.sharedMaterials.changed=!1,this.applyLightmapping()),(i=this._handles)!=null&&i.length&&this.gameObject[gS]===!0){this.gameObject[gS]=!1;for(let r=this._handles.length-1;r>=0;r--)this._handles[r].updateInstanceMatrix();this.gameObject.matrixWorldNeedsUpdate=!1}if(this._handles&&this._handles.length<=0&&$.markAsInstancedRendered(this.gameObject,!1),this._isInstancingEnabled&&this._handles)for(let n=0;n<this._handles.length;n++){const r=this._handles[n];sp(r.object,!1)}this.reflectionProbeUsage!==0&&this._reflectionProbe&&this._reflectionProbe.onSet(this)}}onAfterRender(){if(this._isInstancingEnabled&&this._handles)for(let e=0;e<this._handles.length;e++){const t=this._handles[e];sp(t.object,!0)}this.reflectionProbeUsage!==0&&this._reflectionProbe&&this._reflectionProbe.onUnset(this),this.static&&this.gameObject.matrixAutoUpdate&&(this.gameObject.matrixAutoUpdate=!1)}applyStencil(){uw.applyStencil(this)}applySettings(e){e.receiveShadow=this.receiveShadows,this.shadowCastingMode==1?e.castShadow=!0:e.castShadow=!1}updateReflectionProbe(){this._reflectionProbe=null,this.reflectionProbeUsage!==0&&(this.startCoroutine(this._updateReflectionProbe(),wn.LateUpdate),this._probeAnchorLastFrame=this.probeAnchor)}*_updateReflectionProbe(){const e=this.probeAnchor||this.gameObject,t=!!this.probeAnchor;this._reflectionProbe=vv.get(e,this.context,t,this.probeAnchor)}setVisibility(e){if(!this.isMultiMaterialObject(this.gameObject))sp(this.gameObject,e);else for(const t of this.gameObject.children)this.isMeshOrSkinnedMesh(t)&&sp(t,e)}isMultiMaterialObject(e){return e.type==="Group"}isMeshOrSkinnedMesh(e){return e.type==="Mesh"||e.type==="SkinnedMesh"}};let Es=WR;Fp([I()],Es.prototype,"receiveShadows",2);Fp([I()],Es.prototype,"shadowCastingMode",2);Fp([I()],Es.prototype,"lightmapIndex",2);Fp([I(Je)],Es.prototype,"lightmapScaleOffset",2);Fp([I()],Es.prototype,"enableInstancing",2);Fp([I()],Es.prototype,"renderOrder",2);Fp([I()],Es.prototype,"allowOcclusionWhenDynamic",2);Fp([I(ye)],Es.prototype,"probeAnchor",2);Fp([I()],Es.prototype,"reflectionProbeUsage",2);class BM extends Es{}class nZ extends BM{constructor(){super(...arguments);p(this,"_needUpdateBoundingSphere",!1)}awake(){var t;super.awake(),CY&&console.log('SkinnedMeshRenderer for "'+this.name+'"',this),this.allowOcclusionWhenDynamic=!1;for(const i of this.sharedMeshes)(t=i.parent)==null||t.updateWorldMatrix(!1,!0),this.markBoundsDirty()}onAfterRender(){if(super.onAfterRender(),this._needUpdateBoundingSphere){for(const t of this.sharedMeshes)if(t instanceof ol){this._needUpdateBoundingSphere=!1;const i=t.geometry,n=rM(t);n&&(t.geometry=n),t.computeBoundingSphere(),t.geometry=i}}if(CY){for(const t of this.sharedMeshes)if(t instanceof ol&&t.boundingSphere){const i=St(t.boundingSphere.center).applyMatrix4(t.matrixWorld);Mt.DrawWireSphere(i,t.boundingSphere.radius,"red")}}}markBoundsDirty(){this._needUpdateBoundingSphere=!0}}var $Fe=Object.defineProperty,eVe=Object.getOwnPropertyDescriptor,re=(s,e,t,i)=>{for(var n=i>1?void 0:i?eVe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&$Fe(e,t,n),n};const bE=ee("debugparticles");var qu=(s=>(s[s.Billboard=0]="Billboard",s[s.Stretch=1]="Stretch",s[s.HorizontalBillboard=2]="HorizontalBillboard",s[s.VerticalBillboard=3]="VerticalBillboard",s[s.Mesh=4]="Mesh",s))(qu||{});let Km=class{constructor(){p(this,"alphaKeys",[]);p(this,"colorKeys",[])}get duration(){return 1}evaluate(e,t){let i,n=0,r=null,o=0;for(let a=0;a<this.alphaKeys.length;a++){const l=this.alphaKeys[a];(l.time<e||!i)&&(i=l,n=a)}for(let a=0;a<this.colorKeys.length;a++){const l=this.colorKeys[a];(l.time<e||!r)&&(r=l,o=a)}if(r)if(o+1<this.colorKeys.length){const l=this.colorKeys[o+1],c=lt.remap(e,r.time,l.time,0,1);t.r=lt.lerp(r.color.r,l.color.r,c),t.g=lt.lerp(r.color.g,l.color.g,c),t.b=lt.lerp(r.color.b,l.color.b,c)}else t.r=r.color.r,t.g=r.color.g,t.b=r.color.b;if(i)if(n+1<this.alphaKeys.length){const l=this.alphaKeys[n+1],c=lt.remap(e,i.time,l.time,0,1);t.alpha=lt.lerp(i.alpha,l.alpha,c)}else t.alpha=i.alpha;return t}};re([I()],Km.prototype,"alphaKeys",2);re([I()],Km.prototype,"colorKeys",2);var MS=(s=>(s[s.Local=0]="Local",s[s.World=1]="World",s[s.Custom=2]="Custom",s))(MS||{}),w2=(s=>(s[s.Sphere=0]="Sphere",s[s.SphereShell=1]="SphereShell",s[s.Hemisphere=2]="Hemisphere",s[s.HemisphereShell=3]="HemisphereShell",s[s.Cone=4]="Cone",s[s.Box=5]="Box",s[s.Mesh=6]="Mesh",s[s.ConeShell=7]="ConeShell",s[s.ConeVolume=8]="ConeVolume",s[s.ConeVolumeShell=9]="ConeVolumeShell",s[s.Circle=10]="Circle",s[s.CircleEdge=11]="CircleEdge",s[s.SingleSidedEdge=12]="SingleSidedEdge",s[s.MeshRenderer=13]="MeshRenderer",s[s.SkinnedMeshRenderer=14]="SkinnedMeshRenderer",s[s.BoxShell=15]="BoxShell",s[s.BoxEdge=16]="BoxEdge",s[s.Donut=17]="Donut",s[s.Rectangle=18]="Rectangle",s[s.Sprite=19]="Sprite",s[s.SpriteRenderer=20]="SpriteRenderer",s))(w2||{});const MC=class{constructor(){p(this,"mode","Constant");p(this,"constant");p(this,"constantMin");p(this,"constantMax");p(this,"curve");p(this,"curveMin");p(this,"curveMax");p(this,"curveMultiplier")}static constant(s){const e=new MC;return e.setConstant(s),e}static betweenTwoConstants(s,e){const t=new MC;return t.setMinMaxConstant(s,e),t}static curve(s,e=1){const t=new MC;return t.setCurve(s,e),t}setConstant(s){this.mode=0,this.constant=s}setMinMaxConstant(s,e){this.mode=3,this.constantMin=s,this.constantMax=e}setCurve(s,e=1){this.mode=1,this.curve=s,this.curveMultiplier=e}clone(){var e,t,i;const s=new MC;return s.mode=this.mode,s.constant=this.constant,s.constantMin=this.constantMin,s.constantMax=this.constantMax,s.curve=(e=this.curve)==null?void 0:e.clone(),s.curveMin=(t=this.curveMin)==null?void 0:t.clone(),s.curveMax=(i=this.curveMax)==null?void 0:i.clone(),s.curveMultiplier=this.curveMultiplier,s}evaluate(s,e){const t=e===void 0?Math.random():e;switch(this.mode){case 0:case"Constant":return this.constant;case 1:case"Curve":return s=lt.clamp01(s),this.curve.evaluate(s)*this.curveMultiplier;case 2:case"TwoCurves":const i=s*this.curveMin.duration,n=s*this.curveMax.duration;return lt.lerp(this.curveMin.evaluate(i),this.curveMax.evaluate(n),t%1)*this.curveMultiplier;case 3:case"TwoConstants":return lt.lerp(this.constantMin,this.constantMax,t%1);default:this.curveMax.evaluate(s)*this.curveMultiplier;break}return 0}getMax(){switch(this.mode){case 0:case"Constant":return this.constant;case 1:case"Curve":return this.getMaxFromCurve(this.curve)*this.curveMultiplier;case 2:case"TwoCurves":return Math.max(this.getMaxFromCurve(this.curveMin),this.getMaxFromCurve(this.curveMax))*this.curveMultiplier;case 3:case"TwoConstants":return Math.max(this.constantMin,this.constantMax);default:return 0}}getMaxFromCurve(s){if(!s)return 0;let e=Number.MIN_VALUE;for(let t=0;t<s.keys.length;t++){const i=s.keys[t];i.value>e&&(e=i.value)}return e}};let Gt=MC;re([I()],Gt.prototype,"mode",2);re([I()],Gt.prototype,"constant",2);re([I()],Gt.prototype,"constantMin",2);re([I()],Gt.prototype,"constantMax",2);re([I(wA)],Gt.prototype,"curve",2);re([I(wA)],Gt.prototype,"curveMin",2);re([I(wA)],Gt.prototype,"curveMax",2);re([I()],Gt.prototype,"curveMultiplier",2);var aR;const wl=(aR=class{constructor(){p(this,"mode",0);p(this,"color");p(this,"colorMin");p(this,"colorMax");p(this,"gradient");p(this,"gradientMin");p(this,"gradientMax")}static constant(s){const e=new wl;return e.constant(s),e}static betweenTwoColors(s,e){const t=new wl;return t.betweenTwoColors(s,e),t}constant(s){return this.mode=0,this.color=s,this}betweenTwoColors(s,e){return this.mode=2,this.colorMin=s,this.colorMax=e,this}evaluate(s,e){const t=e===void 0?Math.random():e;switch(this.mode){case 0:case"Color":return this.color;case 1:case"Gradient":return this.gradient.evaluate(s,wl._temp),wl._temp;case 2:case"TwoColors":return wl._temp.lerpColors(this.colorMin,this.colorMax,t);case 3:case"TwoGradients":return this.gradientMin.evaluate(s,wl._temp),this.gradientMax.evaluate(s,wl._temp2),wl._temp.lerp(wl._temp2,t)}return wl._temp.set(16711935),wl._temp.alpha=1,wl._temp}},p(aR,"_temp",new hn(0,0,0,1)),p(aR,"_temp2",new hn(0,0,0,1)),aR);let za=wl;re([I()],za.prototype,"mode",2);re([I(hn)],za.prototype,"color",2);re([I(hn)],za.prototype,"colorMin",2);re([I(hn)],za.prototype,"colorMax",2);re([I(Km)],za.prototype,"gradient",2);re([I(Km)],za.prototype,"gradientMin",2);re([I(Km)],za.prototype,"gradientMax",2);var Fz=(s=>(s[s.Hierarchy=0]="Hierarchy",s[s.Local=1]="Local",s[s.Shape=2]="Shape",s))(Fz||{});class No{constructor(){p(this,"cullingMode");p(this,"duration");p(this,"emitterVelocityMode");p(this,"flipRotation");p(this,"gravityModifier");p(this,"gravityModifierMultiplier");p(this,"loop");p(this,"maxParticles");p(this,"playOnAwake");p(this,"prewarm");p(this,"ringBufferLoopRange");p(this,"ringBufferMode");p(this,"scalingMode");p(this,"simulationSpace");p(this,"simulationSpeed");p(this,"startColor");p(this,"startDelay");p(this,"startDelayMultiplier");p(this,"startLifetime");p(this,"startLifetimeMultiplier");p(this,"startRotation");p(this,"startRotationMultiplier");p(this,"startRotation3D");p(this,"startRotationX");p(this,"startRotationXMultiplier");p(this,"startRotationY");p(this,"startRotationYMultiplier");p(this,"startRotationZ");p(this,"startRotationZMultiplier");p(this,"startSize");p(this,"startSize3D");p(this,"startSizeMultiplier");p(this,"startSizeX");p(this,"startSizeXMultiplier");p(this,"startSizeY");p(this,"startSizeYMultiplier");p(this,"startSizeZ");p(this,"startSizeZMultiplier");p(this,"startSpeed");p(this,"startSpeedMultiplier");p(this,"stopAction");p(this,"useUnscaledTime")}}re([I(Gt)],No.prototype,"gravityModifier",2);re([I(za)],No.prototype,"startColor",2);re([I(Gt)],No.prototype,"startDelay",2);re([I(Gt)],No.prototype,"startLifetime",2);re([I(Gt)],No.prototype,"startRotation",2);re([I(Gt)],No.prototype,"startRotationX",2);re([I(Gt)],No.prototype,"startRotationY",2);re([I(Gt)],No.prototype,"startRotationZ",2);re([I(Gt)],No.prototype,"startSize",2);re([I(Gt)],No.prototype,"startSizeX",2);re([I(Gt)],No.prototype,"startSizeY",2);re([I(Gt)],No.prototype,"startSizeZ",2);re([I(Gt)],No.prototype,"startSpeed",2);class IS{constructor(){p(this,"cycleCount");p(this,"maxCount");p(this,"minCount");p(this,"probability");p(this,"repeatInterval");p(this,"time");p(this,"count");p(this,"_performed",0)}reset(){this._performed=0}run(e){if(e<=this.time)return 0;let t=0;if(this.cycleCount===0||this._performed<this.cycleCount){const i=this.time+this.repeatInterval*this._performed;if(e>=i&&(this._performed+=1,Math.random()<this.probability))switch(this.count.mode){case 0:t=this.count.constant;break;case 3:t=lt.lerp(this.count.constantMin,this.count.constantMax,Math.random());break;case 1:t=this.count.curve.evaluate(Math.random());break;case 2:const n=Math.random();t=lt.lerp(this.count.curveMin.evaluate(n),this.count.curveMax.evaluate(n),Math.random());break}}return t}}class lu{constructor(){p(this,"enabled");p(this,"bursts");p(this,"rateOverTime");p(this,"rateOverTimeMultiplier");p(this,"rateOverDistance");p(this,"rateOverDistanceMultiplier");p(this,"system")}get burstCount(){var e;return((e=this.bursts)==null?void 0:e.length)??0}reset(){var e;(e=this.bursts)==null||e.forEach(t=>t.reset())}getBurst(){let e=0;if(this.burstCount>0)for(let t=0;t<this.burstCount;t++){const i=this.bursts[t];this.system.main.loop&&i.time>=this.system.time&&i.reset(),e+=Math.round(i.run(this.system.time))}return e}}re([I()],lu.prototype,"enabled",2);re([I()],lu.prototype,"bursts",2);re([I(Gt)],lu.prototype,"rateOverTime",2);re([I()],lu.prototype,"rateOverTimeMultiplier",2);re([I(Gt)],lu.prototype,"rateOverDistance",2);re([I()],lu.prototype,"rateOverDistanceMultiplier",2);class PM{constructor(){p(this,"enabled");p(this,"color")}}re([I(za)],PM.prototype,"color",2);class Ym{constructor(){p(this,"enabled");p(this,"separateAxes");p(this,"size");p(this,"sizeMultiplier");p(this,"x");p(this,"xMultiplier");p(this,"y");p(this,"yMultiplier");p(this,"z");p(this,"zMultiplier");p(this,"_time",0);p(this,"_temp",new T)}evaluate(e,t,i){if(t||(t=this._temp),!this.enabled)return t.x=t.y=t.z=1,t;if(this.separateAxes)t.x=this.x.evaluate(e,i)*this.xMultiplier,t.y=this.y.evaluate(e,i)*this.yMultiplier,t.z=this.z.evaluate(e,i)*this.zMultiplier;else{const n=this.size.evaluate(e,i)*this.sizeMultiplier;t.x=n}return t}}re([I(Gt)],Ym.prototype,"size",2);re([I(Gt)],Ym.prototype,"x",2);re([I(Gt)],Ym.prototype,"y",2);re([I(Gt)],Ym.prototype,"z",2);var lR;const IC=(lR=class{constructor(){p(this,"shapeType",5);p(this,"enabled",!0);p(this,"alignToDirection",!1);p(this,"angle",0);p(this,"arc",360);p(this,"arcSpread");p(this,"arcSpeedMultiplier");p(this,"arcMode");p(this,"boxThickness");p(this,"position");p(this,"rotation");p(this,"_rotation",new Xi);p(this,"scale");p(this,"radius");p(this,"radiusThickness");p(this,"sphericalDirectionAmount");p(this,"randomDirectionAmount");p(this,"randomPositionAmount");p(this,"meshShapeType");p(this,"meshRenderer");p(this,"_meshObj");p(this,"_meshGeometry");p(this,"system");p(this,"_space");p(this,"_worldSpaceMatrix",new ce);p(this,"_worldSpaceMatrixInverse",new ce);p(this,"_vector",new T(0,0,0));p(this,"_temp",new T(0,0,0));p(this,"_triangle",new $s);p(this,"_dir",new T);p(this,"_loopTime",0);p(this,"_loopDirection",1);bE&&console.log(this)}get type(){return w2[this.shapeType]}initialize(s){this.onInitialize(s),s.position.x=this._vector.x,s.position.y=this._vector.y,s.position.z=this._vector.z}toJSON(){return this}clone(){return new IC}setMesh(s){this.meshRenderer=s,s?(this._meshObj=s.sharedMeshes[Math.floor(Math.random()*s.sharedMeshes.length)],this._meshGeometry=this._meshObj.geometry):(this._meshObj=void 0,this._meshGeometry=void 0)}update(s,e){throw new Error("Method not implemented: use onUpdate")}onUpdate(s,e,t,i){this.system=s,this._space=t,t===1&&(this._worldSpaceMatrix.copy(i.matrixWorld),this._worldSpaceMatrix.elements[0]=1,this._worldSpaceMatrix.elements[5]=1,this._worldSpaceMatrix.elements[10]=1,this._worldSpaceMatrixInverse.copy(this._worldSpaceMatrix).invert())}applyRotation(s){const e=this.rotation.x!==0||this.rotation.y!==0||this.rotation.z!==0;return e&&(this._rotation.x=lt.toRadians(this.rotation.x),this._rotation.y=lt.toRadians(this.rotation.y),this._rotation.z=lt.toRadians(this.rotation.z),this._rotation.order="ZYX",s.applyEuler(this._rotation)),e}onInitialize(s){this._vector.set(0,0,0),s.mesh=void 0,s.mesh_geometry=void 0;const e=this._temp.copy(this.position),t=this._space===1;t&&e.applyQuaternion(this.system.worldQuaternion);let i=this.radius;if(t&&(i*=this.system.worldScale.x),this.enabled){switch(this.shapeType){case 5:bE&&Mt.DrawWireBox(this.position,this.scale,14540253,1),this._vector.x=Math.random()*this.scale.x-this.scale.x/2,this._vector.y=Math.random()*this.scale.y-this.scale.y/2,this._vector.z=Math.random()*this.scale.z-this.scale.z/2,this._vector.add(e);break;case 4:this.randomConePoint(this.position,this.angle,i,this.radiusThickness,this.arc,this.arcMode,this._vector);break;case 0:this.randomSpherePoint(this.position,i,this.radiusThickness,this.arc,this._vector);break;case 10:this.randomCirclePoint(this.position,i,this.radiusThickness,this.arc,this._vector);break;case 13:const n=this.meshRenderer;(n==null?void 0:n.destroyed)==!1&&this.setMesh(n);const r=s.mesh=this._meshObj,o=s.mesh_geometry=this._meshGeometry;if(r&&o)switch(this.meshShapeType){case 0:{const a=o.getAttribute("position"),l=Math.floor(Math.random()*a.count);this._vector.fromBufferAttribute(a,l),this._vector.applyMatrix4(r.matrixWorld),s.mesh_normal=l}break;case 1:break;case 2:{const a=o.index;if(a){let l=Math.random(),c=Math.random();l+c>1&&(l=1-l,c=1-c);const h=Math.floor(Math.random()*(a.count/3));let d=h*3,u=h*3+1,f=h*3+2;d=a.getX(d),u=a.getX(u),f=a.getX(f);const m=o.getAttribute("position");this._triangle.a.fromBufferAttribute(m,d),this._triangle.b.fromBufferAttribute(m,u),this._triangle.c.fromBufferAttribute(m,f),this._vector.set(0,0,0).addScaledVector(this._triangle.a,l).addScaledVector(this._triangle.b,c).addScaledVector(this._triangle.c,1-(l+c)),this._vector.applyMatrix4(r.matrixWorld),s.mesh_normal=h}}break}break;default:this._vector.set(0,0,0),Qe()&&!globalThis.__particlesystem_shapetype_unsupported&&(console.warn("ParticleSystem ShapeType is not supported:",w2[this.shapeType]),globalThis.__particlesystem_shapetype_unsupported=!0);break}this.randomizePosition(this._vector,this.randomPositionAmount)}this.applyRotation(this._vector),t&&(this._vector.applyQuaternion(this.system.worldQuaternion),this._vector.add(this.system.worldPos)),bE&&Mt.DrawSphere(this._vector,.03,16711680,.5,!0)}getDirection(s,e){var t;if(!this.enabled)return this._dir.set(0,0,1),this._dir;switch(this.shapeType){case 5:this._dir.set(0,0,1);break;case 4:this._dir.set(0,0,1);break;case 10:case 0:const i=e.x,n=e.y,r=e.z;this._dir.set(i,n,r),(t=this.system)!=null&&t.worldspace?this._dir.sub(this.system.worldPos):this._dir.sub(this.position);break;case 13:const o=s.mesh,a=s.mesh_geometry;if(o&&a)switch(this.meshShapeType){case 0:{const l=a.getAttribute("normal"),c=s.mesh_normal;this._dir.fromBufferAttribute(l,c)}break;case 1:break;case 2:{const l=a.index;if(l){const c=s.mesh_normal,h=l.getX(c*3),d=l.getX(c*3+1),u=l.getX(c*3+2),f=a.getAttribute("position"),m=St(),g=St(),A=St();m.fromBufferAttribute(f,h),g.fromBufferAttribute(f,d),A.fromBufferAttribute(f,u),m.sub(g),A.sub(g),m.cross(A),this._dir.copy(m).multiplyScalar(-1);const y=gn(o);this._dir.applyQuaternion(y)}}break}break;default:this._dir.set(0,0,1);break}return this._space===1&&this._dir.applyQuaternion(this.system.worldQuaternion),this.applyRotation(this._dir),this._dir.normalize(),this.spherizeDirection(this._dir,this.sphericalDirectionAmount),this.randomizeDirection(this._dir,this.randomDirectionAmount),bE&&(Mt.DrawSphere(e,.01,8925952,.5,!0),Mt.DrawDirection(e,this._dir,8925952,.5,!0)),this._dir}randomizePosition(s,e){if(e<=0)return;const t=IC._tempVec;t.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1),t.x*=e*this.scale.x,t.y*=e*this.scale.y,t.z*=e*this.scale.z,s.add(t)}randomizeDirection(s,e){if(e===0)return;const t=IC._randomQuat,i=IC._tempVec;i.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize(),t.setFromAxisAngle(i,e*Math.random()*Math.PI),s.applyQuaternion(t)}spherizeDirection(s,e){if(e===0)return;const t=Math.random()*Math.PI*2,i=Math.acos(1-Math.random()*2),n=Math.sin(i)*Math.cos(t),r=Math.sin(i)*Math.sin(t),o=Math.cos(i),a=new T(n,r,o);s.lerp(a,e)}randomSpherePoint(s,e,t,i,n){const r=Math.random(),o=Math.random(),a=2*Math.PI*r*(i/360),l=Math.acos(2*o-1),c=lt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),t)*e,h=s.x+this.scale.x*(-c*Math.sin(l)*Math.cos(a)),d=s.y+this.scale.y*(c*Math.sin(l)*Math.sin(a)),u=s.z+this.scale.z*(c*Math.cos(l));n.x=h,n.y=d,n.z=u}randomCirclePoint(s,e,t,i,n){const r=Math.random(),o=2*Math.PI*r*(i/360),a=lt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),t)*e,l=s.x+this.scale.x*a*Math.cos(o),c=s.y+this.scale.y*a*Math.sin(o),h=s.z;n.x=l,n.y=c,n.z=h}randomConePoint(s,e,t,i,n,r,o){let a=0,l=0;switch(r){case 0:a=Math.random(),l=Math.random();break;case 2:this._loopTime>1&&(this._loopDirection=-1),this._loopTime<0&&(this._loopDirection=1);case 1:a=.5,l=Math.random(),this._loopTime+=this.system.deltaTime*this._loopDirection;break}let c=2*Math.PI*a*(n/360);switch(r){case 2:case 1:c+=Math.PI+.5,c+=this._loopTime*Math.PI*2,c%=lt.toRadians(n);break}const h=Math.acos(2*l-1),d=lt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*t,u=s.x+-d*Math.sin(h)*Math.cos(c),f=s.y+d*Math.sin(h)*Math.sin(c),m=s.z;o.x=u*this.scale.x,o.y=f*this.scale.y,o.z=m*this.scale.z}},p(lR,"_randomQuat",new Ve),p(lR,"_tempVec",new T),lR);let gs=IC;re([I()],gs.prototype,"shapeType",2);re([I()],gs.prototype,"enabled",2);re([I()],gs.prototype,"alignToDirection",2);re([I()],gs.prototype,"angle",2);re([I()],gs.prototype,"arc",2);re([I()],gs.prototype,"arcSpread",2);re([I()],gs.prototype,"arcSpeedMultiplier",2);re([I()],gs.prototype,"arcMode",2);re([I(T)],gs.prototype,"boxThickness",2);re([I(T)],gs.prototype,"position",2);re([I(T)],gs.prototype,"rotation",2);re([I(T)],gs.prototype,"scale",2);re([I()],gs.prototype,"radius",2);re([I()],gs.prototype,"radiusThickness",2);re([I()],gs.prototype,"sphericalDirectionAmount",2);re([I()],gs.prototype,"randomDirectionAmount",2);re([I()],gs.prototype,"randomPositionAmount",2);re([I()],gs.prototype,"meshShapeType",2);re([I(BM)],gs.prototype,"meshRenderer",2);class un{constructor(){p(this,"damping");p(this,"enabled");p(this,"frequency");p(this,"octaveCount");p(this,"octaveMultiplier");p(this,"octaveScale");p(this,"positionAmount");p(this,"quality");p(this,"remap");p(this,"remapEnabled");p(this,"remapMultiplier");p(this,"remapX");p(this,"remapXMultiplier");p(this,"remapY");p(this,"remapYMultiplier");p(this,"remapZ");p(this,"remapZMultiplier");p(this,"scrollSpeedMultiplier");p(this,"separateAxes");p(this,"strengthMultiplier");p(this,"strengthX");p(this,"strengthXMultiplier");p(this,"strengthY");p(this,"strengthYMultiplier");p(this,"strengthZ");p(this,"strengthZMultiplier");p(this,"_noise");p(this,"_time",0);p(this,"_temp",new T)}update(e){this._time+=e.time.deltaTime*this.scrollSpeedMultiplier}apply(e,t,i,n,r,o){if(!this.enabled)return;this._noise||(this._noise=MFe(()=>0));const a=this._temp.set(t.x,t.y,t.z).multiplyScalar(this.frequency),l=this._noise(a.x,a.y,a.z,this._time),c=this._noise(a.x,a.y,a.z,this._time+1e3*this.frequency),h=this._noise(a.x,a.y,a.z,this._time+2e3*this.frequency);this._temp.set(l,c,h).normalize();const d=r/o;let u=this.positionAmount.evaluate(d);this.separateAxes?(this._temp.x*=u*this.strengthXMultiplier,this._temp.y*=u*this.strengthYMultiplier,this._temp.z*=u*this.strengthZMultiplier):(this.strengthX&&(u*=this.strengthX.evaluate(d)*1.5),this._temp.multiplyScalar(u)),i.x+=this._temp.x,i.y+=this._temp.y,i.z+=this._temp.z}}re([I()],un.prototype,"damping",2);re([I()],un.prototype,"enabled",2);re([I()],un.prototype,"frequency",2);re([I()],un.prototype,"octaveCount",2);re([I()],un.prototype,"octaveMultiplier",2);re([I()],un.prototype,"octaveScale",2);re([I(Gt)],un.prototype,"positionAmount",2);re([I()],un.prototype,"quality",2);re([I(Gt)],un.prototype,"remap",2);re([I()],un.prototype,"remapEnabled",2);re([I()],un.prototype,"remapMultiplier",2);re([I(Gt)],un.prototype,"remapX",2);re([I()],un.prototype,"remapXMultiplier",2);re([I(Gt)],un.prototype,"remapY",2);re([I()],un.prototype,"remapYMultiplier",2);re([I(Gt)],un.prototype,"remapZ",2);re([I()],un.prototype,"remapZMultiplier",2);re([I()],un.prototype,"scrollSpeedMultiplier",2);re([I()],un.prototype,"separateAxes",2);re([I()],un.prototype,"strengthMultiplier",2);re([I(Gt)],un.prototype,"strengthX",2);re([I()],un.prototype,"strengthXMultiplier",2);re([I(Gt)],un.prototype,"strengthY",2);re([I()],un.prototype,"strengthYMultiplier",2);re([I(Gt)],un.prototype,"strengthZ",2);re([I()],un.prototype,"strengthZMultiplier",2);class os{constructor(){p(this,"enabled");p(this,"attachRibbonToTransform",!1);p(this,"colorOverLifetime");p(this,"colorOverTrail");p(this,"dieWithParticles",!0);p(this,"inheritParticleColor",!0);p(this,"lifetime");p(this,"lifetimeMultiplier");p(this,"minVertexDistance",.2);p(this,"mode",0);p(this,"ratio",1);p(this,"ribbonCount",1);p(this,"shadowBias",0);p(this,"sizeAffectsLifetime",!1);p(this,"sizeAffectsWidth",!1);p(this,"splitSubEmitterRibbons",!1);p(this,"textureMode",0);p(this,"widthOverTrail");p(this,"widthOverTrailMultiplier");p(this,"worldSpace",!1)}getWidth(e,t,i,n){const r=this.widthOverTrail.evaluate(i,n);return e*=r,e}getColor(e,t,i){const n=this.colorOverTrail.evaluate(i),r=this.colorOverLifetime.evaluate(t);e.x*=n.r*r.r,e.y*=n.g*r.g,e.z*=n.b*r.b,"alpha"in n&&"alpha"in r&&(e.w*=n.alpha*r.alpha)}}re([I()],os.prototype,"enabled",2);re([I()],os.prototype,"attachRibbonToTransform",2);re([I(za)],os.prototype,"colorOverLifetime",2);re([I(za)],os.prototype,"colorOverTrail",2);re([I()],os.prototype,"dieWithParticles",2);re([I()],os.prototype,"inheritParticleColor",2);re([I(Gt)],os.prototype,"lifetime",2);re([I()],os.prototype,"lifetimeMultiplier",2);re([I()],os.prototype,"minVertexDistance",2);re([I()],os.prototype,"mode",2);re([I()],os.prototype,"ratio",2);re([I()],os.prototype,"ribbonCount",2);re([I()],os.prototype,"shadowBias",2);re([I()],os.prototype,"sizeAffectsLifetime",2);re([I()],os.prototype,"sizeAffectsWidth",2);re([I()],os.prototype,"splitSubEmitterRibbons",2);re([I()],os.prototype,"textureMode",2);re([I(Gt)],os.prototype,"widthOverTrail",2);re([I()],os.prototype,"widthOverTrailMultiplier",2);re([I()],os.prototype,"worldSpace",2);class As{constructor(){p(this,"enabled");p(this,"space",0);p(this,"orbitalX");p(this,"orbitalY");p(this,"orbitalZ");p(this,"orbitalXMultiplier");p(this,"orbitalYMultiplier");p(this,"orbitalZMultiplier");p(this,"orbitalOffsetX");p(this,"orbitalOffsetY");p(this,"orbitalOffsetZ");p(this,"speedModifier");p(this,"speedModifierMultiplier");p(this,"x");p(this,"xMultiplier");p(this,"y");p(this,"yMultiplier");p(this,"z");p(this,"zMultiplier");p(this,"_system");p(this,"_temp",new T);p(this,"_temp2",new T);p(this,"_temp3",new T);p(this,"_hasOrbital",!1);p(this,"_index",0);p(this,"_orbitalMatrix",new ce)}update(e){this._system=e}init(e){this._index==0&&(e.debug=!0),this._index+=1,e.orbitx=this.orbitalX.evaluate(Math.random()),e.orbity=this.orbitalY.evaluate(Math.random()),e.orbitz=this.orbitalZ.evaluate(Math.random()),this._hasOrbital=e.orbitx!=0||e.orbity!=0||e.orbitz!=0}apply(e,t,i,n,r,o,a){var f;if(!this.enabled)return;const l=o/a,c=this.speedModifier.evaluate(l)*this.speedModifierMultiplier,h=this.x.evaluate(l),d=this.y.evaluate(l),u=this.z.evaluate(l);if(this._temp.set(-h,d,u),this._system&&this._system.main.simulationSpace===1&&this._temp.applyQuaternion(this._system.worldQuaternion),this._hasOrbital&&((f=this._system)==null?void 0:f.worldPos)){const g=this._temp2.set(i.x,i.y,i.z),A=this.orbitalXMultiplier,y=this.orbitalYMultiplier,b=this.orbitalZMultiplier,x=c*Math.PI*2*10,v=Math.cos(x*A),_=Math.sin(x*A),C=Math.cos(x*y),S=Math.sin(x*y),M=Math.cos(x*b),L=Math.sin(x*b),w=g.x*(C*M)+g.y*(C*L)+g.z*-S,E=g.x*(_*S*M-v*L)+g.y*(_*S*L+v*M)+g.z*(_*C),B=g.x*(v*S*M+_*L)+g.y*(v*S*L-_*M)+g.z*(v*C),P=this._temp3.set(g.x-w,g.y-E,g.z-B);P.normalize(),P.multiplyScalar(.2/r*Math.max(this.orbitalXMultiplier,this.orbitalYMultiplier,this.orbitalZMultiplier)),n.x+=P.x,n.y+=P.y,n.z+=P.z}n.x+=this._temp.x,n.y+=this._temp.y,n.z+=this._temp.z,n.x*=c,n.y*=c,n.z*=c}}re([I()],As.prototype,"enabled",2);re([I()],As.prototype,"space",2);re([I(Gt)],As.prototype,"orbitalX",2);re([I(Gt)],As.prototype,"orbitalY",2);re([I(Gt)],As.prototype,"orbitalZ",2);re([I()],As.prototype,"orbitalXMultiplier",2);re([I()],As.prototype,"orbitalYMultiplier",2);re([I()],As.prototype,"orbitalZMultiplier",2);re([I()],As.prototype,"orbitalOffsetX",2);re([I()],As.prototype,"orbitalOffsetY",2);re([I()],As.prototype,"orbitalOffsetZ",2);re([I(Gt)],As.prototype,"speedModifier",2);re([I()],As.prototype,"speedModifierMultiplier",2);re([I(Gt)],As.prototype,"x",2);re([I()],As.prototype,"xMultiplier",2);re([I(Gt)],As.prototype,"y",2);re([I()],As.prototype,"yMultiplier",2);re([I(Gt)],As.prototype,"z",2);re([I()],As.prototype,"zMultiplier",2);class Do{constructor(){p(this,"animation");p(this,"enabled");p(this,"cycleCount");p(this,"frameOverTime");p(this,"frameOverTimeMultiplier");p(this,"numTilesX");p(this,"numTilesY");p(this,"startFrame");p(this,"startFrameMultiplier");p(this,"rowMode");p(this,"rowIndex");p(this,"spriteCount");p(this,"timeMode")}sampleOnceAtStart(){if(this.timeMode===0)switch(this.frameOverTime.mode){case 0:case 3:case 2:case 1:return!0}return!1}getStartIndex(){return this.sampleOnceAtStart()?Math.random()*(this.numTilesX*this.numTilesY):0}evaluate(e){if(!this.sampleOnceAtStart())return this.getIndex(e)}getIndex(e){const t=this.numTilesX*this.numTilesY;e=e*this.cycleCount;let i=this.frameOverTime.evaluate(e%1);return i*=this.frameOverTimeMultiplier,i*=t,i=i%t,i=Math.floor(i),i}}re([I()],Do.prototype,"animation",2);re([I()],Do.prototype,"enabled",2);re([I()],Do.prototype,"cycleCount",2);re([I(Gt)],Do.prototype,"frameOverTime",2);re([I()],Do.prototype,"frameOverTimeMultiplier",2);re([I()],Do.prototype,"numTilesX",2);re([I()],Do.prototype,"numTilesY",2);re([I(Gt)],Do.prototype,"startFrame",2);re([I()],Do.prototype,"startFrameMultiplier",2);re([I()],Do.prototype,"rowMode",2);re([I()],Do.prototype,"rowIndex",2);re([I()],Do.prototype,"spriteCount",2);re([I()],Do.prototype,"timeMode",2);class Yc{constructor(){p(this,"enabled");p(this,"separateAxes");p(this,"x");p(this,"xMultiplier");p(this,"y");p(this,"yMultiplier");p(this,"z");p(this,"zMultiplier")}evaluate(e,t){return this.enabled?this.separateAxes?0:this.z.evaluate(e,t)*-1:0}}re([I()],Yc.prototype,"enabled",2);re([I()],Yc.prototype,"separateAxes",2);re([I(Gt)],Yc.prototype,"x",2);re([I()],Yc.prototype,"xMultiplier",2);re([I(Gt)],Yc.prototype,"y",2);re([I()],Yc.prototype,"yMultiplier",2);re([I(Gt)],Yc.prototype,"z",2);re([I()],Yc.prototype,"zMultiplier",2);class lc{constructor(){p(this,"enabled");p(this,"range");p(this,"separateAxes");p(this,"x");p(this,"xMultiplier");p(this,"y");p(this,"yMultiplier");p(this,"z");p(this,"zMultiplier")}evaluate(e,t){if(!this.enabled)return 0;if(!this.separateAxes){const i=lt.lerp(this.range.x,this.range.y,t);return this.z.evaluate(i)*-1}return 0}}re([I()],lc.prototype,"enabled",2);re([I()],lc.prototype,"range",2);re([I()],lc.prototype,"separateAxes",2);re([I(Gt)],lc.prototype,"x",2);re([I()],lc.prototype,"xMultiplier",2);re([I(Gt)],lc.prototype,"y",2);re([I()],lc.prototype,"yMultiplier",2);re([I(Gt)],lc.prototype,"z",2);re([I()],lc.prototype,"zMultiplier",2);class cr{constructor(){p(this,"enabled");p(this,"dampen");p(this,"drag");p(this,"dragMultiplier");p(this,"limit");p(this,"limitMultiplier");p(this,"separateAxes");p(this,"limitX");p(this,"limitXMultiplier");p(this,"limitY");p(this,"limitYMultiplier");p(this,"limitZ");p(this,"limitZMultiplier");p(this,"multiplyDragByParticleSize",!1);p(this,"multiplyDragByParticleVelocity",!1);p(this,"space");p(this,"_temp",new T);p(this,"_temp2",new T)}apply(e,t,i,n,r,o,a){if(this.enabled){const l=this.limit.evaluate(r)*this.limitMultiplier;if(t.length()>l){this._temp.copy(t).normalize().multiplyScalar(l);const h=this.dampen*.5;t.x=lt.lerp(t.x,this._temp.x,h),t.y=lt.lerp(t.y,this._temp.y,h),t.z=lt.lerp(t.z,this._temp.z,h),i.x=lt.lerp(i.x,this._temp.x,h),i.y=lt.lerp(i.y,this._temp.y,h),i.z=lt.lerp(i.z,this._temp.z,h)}}}}re([I()],cr.prototype,"enabled",2);re([I()],cr.prototype,"dampen",2);re([I(Gt)],cr.prototype,"drag",2);re([I()],cr.prototype,"dragMultiplier",2);re([I(Gt)],cr.prototype,"limit",2);re([I()],cr.prototype,"limitMultiplier",2);re([I()],cr.prototype,"separateAxes",2);re([I(Gt)],cr.prototype,"limitX",2);re([I()],cr.prototype,"limitXMultiplier",2);re([I(Gt)],cr.prototype,"limitY",2);re([I()],cr.prototype,"limitYMultiplier",2);re([I(Gt)],cr.prototype,"limitZ",2);re([I()],cr.prototype,"limitZMultiplier",2);re([I()],cr.prototype,"multiplyDragByParticleSize",2);re([I()],cr.prototype,"multiplyDragByParticleVelocity",2);re([I()],cr.prototype,"space",2);const uae=class{constructor(){p(this,"enabled");p(this,"curve");p(this,"curveMultiplier");p(this,"mode");p(this,"system");p(this,"_temp",new T);p(this,"_firstUpdate",!0);p(this,"_frames",0)}clone(){var e;const s=new uae;return s.enabled=this.enabled,s.curve=(e=this.curve)==null?void 0:e.clone(),s.curveMultiplier=this.curveMultiplier,s.mode=this.mode,s}get _lastWorldPosition(){return this.system._iv_lastWorldPosition||(this.system._iv_lastWorldPosition=new T),this.system._iv_lastWorldPosition}get _velocity(){return this.system._iv_velocity||(this.system._iv_velocity=new T),this.system._iv_velocity}awake(s){this.system=s,this.reset()}reset(){this._firstUpdate=!0}update(s){this.enabled&&this.system.worldspace!==!1&&(this._firstUpdate?(this._firstUpdate=!1,this._velocity.set(0,0,0),this._lastWorldPosition.copy(this.system.worldPos)):this._lastWorldPosition&&(this._velocity.copy(this.system.worldPos).sub(this._lastWorldPosition).multiplyScalar(1/this.system.deltaTime),this._lastWorldPosition.copy(this.system.worldPos)))}applyInitial(s){if(this.enabled&&this.system.worldspace!==!1&&this.mode===0){const e=this.curve.evaluate(Math.random(),Math.random());this._temp.copy(this._velocity).multiplyScalar(e),s.x+=this._temp.x,s.y+=this._temp.y,s.z+=this._temp.z}}applyCurrent(s,e,t){if(this.enabled&&this.system&&this.system.worldspace!==!1&&this.mode===1){const i=this.curve.evaluate(e,t);this._temp.copy(this._velocity).multiplyScalar(i),s.x+=this._temp.x,s.y+=this._temp.y,s.z+=this._temp.z}}};let Jm=uae;re([I()],Jm.prototype,"enabled",2);re([I(Gt)],Jm.prototype,"curve",2);re([I()],Jm.prototype,"curveMultiplier",2);re([I()],Jm.prototype,"mode",2);class Ua{constructor(){p(this,"enabled");p(this,"range");p(this,"separateAxes");p(this,"size");p(this,"sizeMultiplier");p(this,"x");p(this,"xMultiplier");p(this,"y");p(this,"yMultiplier");p(this,"z");p(this,"zMultiplier")}evaluate(e,t,i,n){const r=e.length(),o=lt.remap(r,this.range.x,this.range.y,0,1),a=this.size.evaluate(o,i);return n.x*=a,n.y*=a,n.z*=a,n}}re([I()],Ua.prototype,"enabled",2);re([I(Q)],Ua.prototype,"range",2);re([I()],Ua.prototype,"separateAxes",2);re([I(Gt)],Ua.prototype,"size",2);re([I()],Ua.prototype,"sizeMultiplier",2);re([I(Gt)],Ua.prototype,"x",2);re([I()],Ua.prototype,"xMultiplier",2);re([I(Gt)],Ua.prototype,"y",2);re([I()],Ua.prototype,"yMultiplier",2);re([I(Gt)],Ua.prototype,"z",2);re([I()],Ua.prototype,"zMultiplier",2);class GA{constructor(){p(this,"enabled");p(this,"range");p(this,"color")}evaluate(e,t,i){const n=e.length(),r=lt.remap(n,this.range.x,this.range.y,0,1),o=this.color.evaluate(r,t);i.x*=o.r,i.y*=o.g,i.z*=o.b,"alpha"in o&&(i.w*=o.alpha)}}re([I()],GA.prototype,"enabled",2);re([I(Q)],GA.prototype,"range",2);re([I(za)],GA.prototype,"color",2);const tVe={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},iVe={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};var nVe=Object.defineProperty,sVe=Object.getOwnPropertyDescriptor,_v=(s,e,t,i)=>{for(var n=i>1?void 0:i?sVe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&nVe(e,t,n),n};const P_=ee("debugcontactshadows");E5(s=>{const e=s.domElement.getAttribute("contactshadows");e!=null&&e!="0"&&e!="false"&&Hh.auto(s)});var RF;const pae=(RF=class extends ze{constructor(){super(...arguments);p(this,"autoFit",!1);p(this,"darkness",.5);p(this,"opacity",.5);p(this,"blur",4);p(this,"occludeBelowGround",!1);p(this,"backfaceShadows",!0);p(this,"minSize");p(this,"shadowsRoot",new ye);p(this,"shadowCamera");p(this,"shadowGroup",new Ms);p(this,"renderTarget");p(this,"renderTargetBlur");p(this,"plane");p(this,"occluderMesh");p(this,"blurPlane");p(this,"depthMaterial");p(this,"horizontalBlurMaterial");p(this,"verticalBlurMaterial");p(this,"textureSize",512)}static auto(e){if(e||(e=Wt.Current),!e)throw new Error("No context provided and no current context set.");let t=this._instances.get(e);if(!t||t.destroyed){const i=new ye;t=Yl(i,pae,{autoFit:!1,occludeBelowGround:!1}),this._instances.set(e,t)}return e.scene.add(t.gameObject),t.fitShadows(),t}fitShadows(){P_&&console.warn("Fitting shadows to scene"),MV(this.shadowsRoot,!1);const e=ec(this.context.scene.children,[this.shadowsRoot]),t=Math.max(1,this.blur/32),i=e.max.x-e.min.x,n=e.max.z-e.min.z;e.expandByVector(new T(t*i,0,t*n)),P_&&Mt.DrawWireBox3(e,16776960,60),this.gameObject.parent&&e.applyMatrix4(this.gameObject.parent.matrixWorld.clone().invert());const r=e.min,o=Math.max(1e-5,(e.max.y-r.y)*.002);e.max.y+=o,this.shadowsRoot.position.set((r.x+e.max.x)/2,r.y-o,(r.z+e.max.z)/2),this.shadowsRoot.scale.set(e.max.x-r.x,e.max.y-r.y,e.max.z-r.z),this.applyMinSize(),this.shadowsRoot.matrixWorldNeedsUpdate=!0,P_&&console.log("Fitted shadows to scene",this.shadowsRoot.scale.clone())}awake(){MV(this.shadowsRoot,!1)}start(){P_&&console.log("Create ContactShadows on "+this.gameObject.name,this),this.gameObject.add(this.shadowsRoot),this.shadowsRoot.add(this.shadowGroup),this.renderTarget=new ci(this.textureSize,this.textureSize),this.renderTarget.texture.generateMipmaps=!1,this.renderTargetBlur=new ci(this.textureSize,this.textureSize),this.renderTargetBlur.texture.generateMipmaps=!1;const e=new Rs(1,1).rotateX(Math.PI/2);this.gameObject instanceof fe&&(console.warn("ContactShadows can not be added to a Mesh. Please add it to a Group or an empty Object"),sp(this.gameObject,!1));const t=new ii({map:this.renderTarget.texture,opacity:this.opacity,color:0,transparent:!0,depthWrite:!1,side:us});this.plane=new fe(e,t),this.plane.scale.y=-1,this.plane.layers.set(2),this.shadowsRoot.add(this.plane),this.plane&&(this.plane.renderOrder=1),this.occluderMesh=new fe(this.plane.geometry,new ii({depthWrite:!0,stencilWrite:!0,colorWrite:!1,side:vn})).translateY(-1e-4),this.occluderMesh.renderOrder=-100,this.occluderMesh.layers.set(2),this.shadowsRoot.add(this.occluderMesh),this.blurPlane=new fe(e),this.blurPlane.visible=!1,this.shadowGroup.add(this.blurPlane);const i=0,n=1;this.shadowCamera=new zh(-1/2,1/2,1/2,-1/2,i,n),this.shadowCamera.layers.enableAll(),this.shadowCamera.rotation.x=Math.PI/2,this.shadowGroup.add(this.shadowCamera),this.depthMaterial=new v1,this.depthMaterial.userData.darkness={value:this.darkness},this.depthMaterial.blending=bU,this.depthMaterial.blendEquation=xU,this.depthMaterial.onBeforeCompile=r=>{this.depthMaterial&&(r.uniforms.darkness=this.depthMaterial.userData.darkness,r.fragmentShader=`
                uniform float darkness;
                ${r.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 ), ( 1.0 - fragCoordZ ) * darkness * opacity * (gl_FrontFacing ? 1.0 : 0.66) );")}
            `)},this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1,this.horizontalBlurMaterial=new Ht(tVe),this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial=new Ht(iVe),this.verticalBlurMaterial.depthTest=!1,this.shadowGroup.visible=!1,this.autoFit?this.fitShadows():this.applyMinSize()}onDestroy(){var e,t,i,n,r,o,a,l;(e=this.renderTarget)==null||e.dispose(),(t=this.renderTargetBlur)==null||t.dispose(),(i=this.depthMaterial)==null||i.dispose(),(n=this.horizontalBlurMaterial)==null||n.dispose(),(r=this.verticalBlurMaterial)==null||r.dispose(),(o=this.blurPlane)==null||o.geometry.dispose(),(a=this.plane)==null||a.geometry.dispose(),(l=this.occluderMesh)==null||l.geometry.dispose()}onBeforeRender(e){if(!this.renderTarget||!this.renderTargetBlur||!this.depthMaterial||!this.shadowCamera||!this.blurPlane||!this.shadowGroup||!this.plane||!this.horizontalBlurMaterial||!this.verticalBlurMaterial){P_&&console.error("ContactShadows: not initialized yet");return}const t=this.context.scene,i=this.context.renderer,n=i.getRenderTarget();this.shadowGroup.visible=!0,this.occluderMesh&&(this.occluderMesh.visible=!1);const r=this.plane.visible;this.plane.visible=!1,this.gameObject instanceof fe&&sp(this.gameObject,!1);const o=t.background;t.background=null,t.overrideMaterial=this.depthMaterial,this.backfaceShadows?this.depthMaterial.side=Zi:this.depthMaterial.side=us;const a=i.getClearAlpha();i.setClearAlpha(0);const l=i.xr.enabled;i.xr.enabled=!1;const c=this.context.scene.matrixWorldAutoUpdate;this.context.scene.matrixWorldAutoUpdate=!1;const h=i.renderLists.get(t,0),d=h.transparent;SY.length=0,h.transparent=SY,CD.length=0;for(const f of h.opaque){if(!f.object.visible)continue;const m=f.material;let g=f.material.colorWrite==!1||m.wireframe===!0||Eie(f.object)===!1;!g&&f.material.linewidth!=null&&(g=!0),g&&(CD.push(f.object),f.object["needle:visible"]=f.object.visible,f.object.visible=!1)}i.setRenderTarget(this.renderTarget),i.clear(),i.render(t,this.shadowCamera),h.transparent=d;for(const f of CD)f["needle:visible"]!=null&&(f.visible=f["needle:visible"]);t.overrideMaterial=null;const u=Math.max(this.blur,.05);this.blurShadow(u*2),this.blurShadow(u*.5),this.shadowGroup.visible=!1,this.occluderMesh&&(this.occluderMesh.visible=this.occludeBelowGround),this.plane.visible=r,i.setRenderTarget(n),i.setClearAlpha(a),t.background=o,i.xr.enabled=l,this.context.scene.matrixWorldAutoUpdate=c}blurShadow(e){if(!this.blurPlane||!this.shadowCamera||!this.renderTarget||!this.renderTargetBlur||!this.horizontalBlurMaterial||!this.verticalBlurMaterial)return;this.blurPlane.visible=!0;const t=this.shadowsRoot.worldScale,i=(t.x+t.z)/2,n=t.z/i,r=t.x/i;this.blurPlane.material=this.horizontalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTarget.texture,this.horizontalBlurMaterial.uniforms.h.value=e*1/this.textureSize*n;const o=this.context.renderer,a=o.getRenderTarget();o.setRenderTarget(this.renderTargetBlur),o.render(this.blurPlane,this.shadowCamera),this.blurPlane.material=this.verticalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTargetBlur.texture,this.verticalBlurMaterial.uniforms.v.value=e*1/this.textureSize*r,o.setRenderTarget(this.renderTarget),o.render(this.blurPlane,this.shadowCamera),this.blurPlane.visible=!1,o.setRenderTarget(a)}applyMinSize(){this.minSize&&this.shadowsRoot.scale.set(Math.max(this.minSize.x||0,this.shadowsRoot.scale.x),Math.max(this.minSize.y||0,this.shadowsRoot.scale.y),Math.max(this.minSize.z||0,this.shadowsRoot.scale.z))}},p(RF,"_instances",new Map),RF);let Hh=pae;_v([I()],Hh.prototype,"autoFit",2);_v([I()],Hh.prototype,"darkness",2);_v([I()],Hh.prototype,"opacity",2);_v([I()],Hh.prototype,"blur",2);_v([I()],Hh.prototype,"occludeBelowGround",2);_v([I()],Hh.prototype,"backfaceShadows",2);const SY=[],CD=new Array,iW=class{constructor(){p(this,"_quicklookButton");p(this,"_arButton");p(this,"_vrButton");p(this,"_sendToQuestButton")}static create(){return new iW}static getOrCreate(){return this._instance||(this._instance=this.create()),this._instance}get isSecureConnection(){return window.location.protocol==="https:"}get quicklookButton(){return this._quicklookButton}get arButton(){return this._arButton}get vrButton(){return this._vrButton}get sendToQuestButton(){return this._sendToQuestButton}get qrButton(){return wh.getOrCreate().createQRCode()}createQuicklookButton(){if(this._quicklookButton)return this._quicklookButton;const e=document.createElement("button");this._quicklookButton=e,e.dataset.needle="quicklook-button";const t=exports.DeviceUtilities.supportsQuickLookAR();e.innerText="View in AR",e.prepend(bo("view_in_ar"));let i=!1,n=null;return e.addEventListener("click",()=>{n=gP(ds),n||(i=!0,n=new ds),i&&(n.objectToExport=Wt.Current.scene),n?(e.classList.add("this-mode-is-requested"),n.exportAndOpen().then(()=>{e.classList.remove("this-mode-is-requested")}).catch(r=>{e.classList.remove("this-mode-is-requested"),console.error(r)})):console.warn("No USDZExporter component found in the scene")}),this.hideElementDuringXRSession(e),e}createARButton(e){var n;if(this._arButton)return this._arButton;const t="immersive-ar",i=document.createElement("button");return this._arButton=i,i.classList.add("webxr-button"),i.dataset.needle="webxr-ar-button",i.innerText="Enter AR",i.prepend(bo("view_in_ar")),i.title="Click to start an AR session",i.addEventListener("click",()=>Vt.start(t,e)),this.updateSessionSupported(i,t),this.listenToXRSessionState(i,t),this.hideElementDuringXRSession(i),this.isSecureConnection||(i.disabled=!0,i.title="WebXR requires a secure connection (HTTPS)"),exports.DeviceUtilities.isMozillaXR()||(n=navigator.xr)==null||n.addEventListener("devicechange",()=>this.updateSessionSupported(i,t)),i}createVRButton(e){var n;if(this._vrButton)return this._vrButton;const t="immersive-vr",i=document.createElement("button");return this._vrButton=i,i.classList.add("webxr-button"),i.dataset.needle="webxr-vr-button",i.innerText="Enter VR",i.prepend(bo("panorama_photosphere")),i.title="Click to start a VR session",i.addEventListener("click",()=>Vt.start(t,e)),this.updateSessionSupported(i,t),this.listenToXRSessionState(i,t),this.hideElementDuringXRSession(i),this.isSecureConnection||(i.disabled=!0,i.title="WebXR requires a secure connection (HTTPS)"),exports.DeviceUtilities.isMozillaXR()||(n=navigator.xr)==null||n.addEventListener("devicechange",()=>this.updateSessionSupported(i,t)),i}createSendToQuestButton(){var i;if(this._sendToQuestButton)return this._sendToQuestButton;const e="https://oculus.com/open_url/?url=",t=document.createElement("button");return this._sendToQuestButton=t,t.dataset.needle="webxr-sendtoquest-button",t.innerText="Open on Quest",t.prepend(bo("share_windows")),t.title="Click to send this page to the Oculus Browser on your Quest",t.addEventListener("click",()=>{const n=encodeURIComponent(window.location.href),r=e+n;window.open(r)==null&&is("This page doesn't allow popups. Please paste "+r+" into your browser.")}),this.listenToXRSessionState(t),this.hideElementDuringXRSession(t),exports.DeviceUtilities.isMozillaXR()||(i=navigator.xr)==null||i.addEventListener("devicechange",()=>{var n;(n=navigator.xr)!=null&&n.isSessionSupported("immersive-vr")?t.style.display="none":t.style.display=""}),t}createQRCode(){return wh.getOrCreate().createQRCode()}updateSessionSupported(e,t){if(!("xr"in navigator)){e.style.display="none";return}Vt.isSessionSupported(t).then(i=>{e.style.display=i?"":"none",Qe()&&!i&&console.log('[WebXR] "'+t+'" is not supported on this device – make sure your server runs using HTTPS and you have a device connected that supports '+t)})}hideElementDuringXRSession(e){hP(t=>{e["previous-display"]=e.style.display,e.style.display="none"}),OO(t=>{e["previous-display"]!=null&&(e.style.display=e["previous-display"])})}listenToXRSessionState(e,t){t&&(Vt.onSessionRequestStart(i=>{i.mode===t?e.classList.add("this-mode-is-requested"):(e["was-disabled"]=e.disabled,e.disabled=!0,e.classList.add("other-mode-is-requested"))}),Vt.onSessionRequestEnd(i=>{e.classList.remove("this-mode-is-requested"),e.classList.remove("other-mode-is-requested"),e.disabled=e["was-disabled"]}))}};let vp=iW;p(vp,"_instance");var rVe=Object.defineProperty,oVe=Object.getOwnPropertyDescriptor,qr=(s,e,t,i)=>{for(var n=i>1?void 0:i?oVe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&rVe(e,t,n),n};const S2=ee("debugspriterenderer"),aVe=ee("wireframe"),U2=class{static getOrCreateGeometry(e){if(e.__cached_geometry)return e.__cached_geometry;if(e.guid&&U2.cache[e.guid])return S2&&console.log("Take cached geometry for sprite",e.guid),U2.cache[e.guid];const t=new It;e.__cached_geometry=t;const i=new Float32Array(e.triangles.length*3),n=new Float32Array(e.triangles.length*2);for(let r=0;r<e.triangles.length;r+=1){const o=e.triangles[r];i[r*3]=-e.vertices[o].x,i[r*3+1]=e.vertices[o].y,i[r*3+2]=0;const a=e.uv[o];n[r*2]=a.x,n[r*2+1]=1-a.y}return t.setAttribute("position",new dt(i,3)),t.setAttribute("uv",new dt(n,2)),e.guid&&(this.cache[e.guid]=t),S2&&console.log("Built sprite geometry",e,t),t}};let N0=U2;p(N0,"cache",{});class lVe{constructor(){p(this,"x");p(this,"y")}}function fae(s){s&&(s.colorSpace!=ft&&(s.colorSpace=ft,s.needsUpdate=!0),s.minFilter==qt&&s.magFilter==qt&&(s.anisotropy=1,s.needsUpdate=!0))}class cu{constructor(e){p(this,"guid");p(this,"texture");p(this,"triangles");p(this,"uv");p(this,"vertices");p(this,"__cached_geometry");p(this,"_mesh");p(this,"_material");e&&(this.texture=e,this.triangles=[0,1,2,0,2,3],this.uv=[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],this.vertices=[{x:-.5,y:-.5},{x:.5,y:-.5},{x:.5,y:.5},{x:-.5,y:.5}])}get mesh(){return this._mesh||(this._mesh=new fe(N0.getOrCreateGeometry(this),this.material)),this._mesh}get material(){return this._material||(this.texture&&fae(this.texture),this._material=new ii({map:this.texture,color:16777215,side:Zi,transparent:!0})),this._material}getGeometry(){return N0.getOrCreateGeometry(this)}}qr([I()],cu.prototype,"guid",2);qr([I(si)],cu.prototype,"texture",2);qr([av()],cu.prototype,"triangles",2);qr([av()],cu.prototype,"uv",2);qr([av()],cu.prototype,"vertices",2);const wD=Symbol("spriteOwner");class Cm{constructor(){p(this,"sprites")}}qr([I(cu)],Cm.prototype,"sprites",2);const mae=class{constructor(){p(this,"spriteSheet");p(this,"index",0)}static create(){const s=new mae;return s.spriteSheet=new Cm,s}set sprite(s){s&&(this.spriteSheet?((this.index===null||this.index===void 0)&&(this.index=0),this.spriteSheet.sprites[this.index]=s):(this.spriteSheet=new Cm,this.spriteSheet.sprites=[s],this.index=0))}get sprite(){if(this.spriteSheet)return this.spriteSheet.sprites[this.index]}update(s){if(!this.spriteSheet)return;const e=this.index;if(e<0||e>=this.spriteSheet.sprites.length)return;const t=this.spriteSheet.sprites[e],i=t==null?void 0:t.texture;if(i&&(fae(i),!t.__hasLoadedProgressive)){t.__hasLoadedProgressive=!0;const n=i;Ni.assignTextureLOD(i,0).then(r=>{r instanceof si&&(t.texture=r,(s==null?void 0:s.map)===n&&(s.map=r,s.needsUpdate=!0))})}}};let _p=mae;qr([I(Cm)],_p.prototype,"spriteSheet",2);qr([I()],_p.prototype,"index",2);class pl extends ze{constructor(){super(...arguments);p(this,"drawMode",0);p(this,"size",{x:1,y:1});p(this,"color");p(this,"sharedMaterial");p(this,"transparent",!0);p(this,"cutoutThreshold",0);p(this,"castShadows",!1);p(this,"renderOrder",0);p(this,"toneMapped",!0);p(this,"_spriteSheet");p(this,"_currentSprite")}set texture(t){var n;if(!this._spriteSheet)return;const i=(n=this._spriteSheet.spriteSheet)==null?void 0:n.sprites[this.spriteIndex];i&&(i.texture=t,this.updateSprite())}addSprite(t,i=!1){var r,o;if(this._spriteSheet||(this._spriteSheet=_p.create()),!this._spriteSheet.spriteSheet)return-1;(r=this._spriteSheet.spriteSheet)==null||r.sprites.push(t);const n=((o=this._spriteSheet.spriteSheet)==null?void 0:o.sprites.length)-1;return i&&(this.spriteIndex=n),n}get sprite(){return this._spriteSheet}set sprite(t){if(t!==this._spriteSheet)if(typeof t=="number"){const i=Math.floor(t);this.spriteIndex=i;return}else t instanceof cu?(this._spriteSheet||(this._spriteSheet=_p.create()),this._spriteSheet.sprite!=t&&(this._spriteSheet.sprite=t,this.updateSprite())):t!=this._spriteSheet&&(this._spriteSheet=t,this.updateSprite())}set spriteIndex(t){this._spriteSheet&&t!==this.spriteIndex&&(this._spriteSheet.index=t,this.updateSprite())}get spriteIndex(){var t;return((t=this._spriteSheet)==null?void 0:t.index)??0}get spriteFrames(){var t,i;return((i=(t=this._spriteSheet)==null?void 0:t.spriteSheet)==null?void 0:i.sprites.length)??0}awake(){this._currentSprite=void 0,this._spriteSheet||(this._spriteSheet=new _p,this._spriteSheet.spriteSheet=new Cm),S2&&console.log("Awake",this.name,this,this.sprite)}start(){this._currentSprite?this.gameObject&&this.gameObject.add(this._currentSprite):this.updateSprite()}updateSprite(t=!1){var r;if(!this.__didAwake&&!t)return!1;const i=this._spriteSheet;if(!((r=i==null?void 0:i.spriteSheet)!=null&&r.sprites))return console.warn("SpriteRenderer has no data or spritesheet assigned..."),!1;const n=i.spriteSheet.sprites[this.spriteIndex];if(!n)return S2&&console.warn("Sprite not found",this.spriteIndex,i.spriteSheet.sprites),!1;if(this._currentSprite)this._currentSprite.geometry=N0.getOrCreateGeometry(n),this._currentSprite.material.map=n.texture;else{const o=new ii({color:16777215,side:Zi});if(aVe&&(o.wireframe=!0),this.color&&(o.color||(o.color=new ge),o.color.copy(this.color),o.opacity=this.color.alpha),o.transparent=!0,o.toneMapped=this.toneMapped,n.texture&&!o.wireframe){let a=n.texture;a[wD]!==void 0&&a[wD]!==this&&this.spriteFrames>1&&(a=n.texture=a.clone()),a[wD]=this,o.map=a}this.sharedMaterial=o,this._currentSprite=new fe(N0.getOrCreateGeometry(n),o),this._currentSprite.renderOrder=Math.round(this.renderOrder),Ni.assignTextureLOD(o,0)}return this._currentSprite.parent!==this.gameObject&&(this.drawMode===2&&this._currentSprite.scale.set(this.size.x,this.size.y,1),this.gameObject&&this.gameObject.add(this._currentSprite)),this._currentSprite&&this._currentSprite.layers.set(this.layer),this.sharedMaterial&&(this.sharedMaterial.alphaTest=this.cutoutThreshold,this.sharedMaterial.transparent=this.transparent),this._currentSprite.castShadow=this.castShadows,i==null||i.update(this.sharedMaterial),!0}}qr([I()],pl.prototype,"drawMode",2);qr([I(lVe)],pl.prototype,"size",2);qr([I(hn)],pl.prototype,"color",2);qr([I(Yt)],pl.prototype,"sharedMaterial",2);qr([I()],pl.prototype,"transparent",2);qr([I()],pl.prototype,"cutoutThreshold",2);qr([I()],pl.prototype,"castShadows",2);qr([I()],pl.prototype,"renderOrder",2);qr([I()],pl.prototype,"toneMapped",2);qr([I(_p)],pl.prototype,"sprite",1);const MY=ee("debugwebxr"),cVe=new ce().makeRotationY(Math.PI);class Rp extends ze{constructor(){super(...arguments);p(this,"_arScale",1);p(this,"invertForward",!1);p(this,"customReticle");p(this,"arTouchTransform",!0);p(this,"autoPlace",!1);p(this,"autoCenter",!1);p(this,"useXRAnchor",!1);p(this,"_isPlacing",!0);p(this,"_startOffset",new ce);p(this,"_createdPlacementObject",null);p(this,"_reparentedComponents",[]);p(this,"_placementScene",new sr);p(this,"_reticle",[]);p(this,"_hits",[]);p(this,"_placementStartTime",-1);p(this,"_rigPlacementMatrix");p(this,"_anchor",null);p(this,"userInput");p(this,"onPlaceScene",t=>{var r;if(this._isPlacing==!1||t!=null&&t.used)return;let i=this._reticle[0];if(!i){console.warn("No reticle to place...");return}if(!i.visible&&!this.autoPlace){console.warn("Reticle is not visible (can not place)");return}if((r=Vt.active)!=null&&r.isTrackingImages){console.warn("Scene Placement is disabled while images are being tracked");return}let n=this._hits[0];if(t&&t.origin instanceof ZO){const o=this._reticle[t.origin.index];o&&(i=o,n=this._hits[t.origin.index])}if(t&&(t.stopImmediatePropagation(),t.stopPropagation(),t.use()),this._isPlacing=!1,this.context.input.removeEventListener("pointerup",this.onPlaceScene),this.onRevertSceneChanges(),i.position.copy(i.lastPos),i.quaternion.copy(i.lastQuat),this.onApplyPose(i),this.useXRAnchor&&this.onCreateAnchor(Vt.active,n),this.context.xr)for(const o of this.context.xr.controllers)o.cancelHitTestSource()});p(this,"upVec",new T(0,1,0));p(this,"lookPoint",new T);p(this,"worldUpVec",new T(0,1,0))}static onPlaced(t){const i="placed";return this._eventListeners[i]||(this._eventListeners[i]=[]),this._eventListeners[i].push(t),()=>{const n=this._eventListeners[i].indexOf(t);n>=0&&this._eventListeners[i].splice(n,1)}}get arScale(){return this._arScale}set arScale(t){t!==this._arScale&&(this._arScale=t,this.onScaleChanged())}onEnable(){var t;(t=this.customReticle)==null||t.preload()}supportsXR(t){return t==="immersive-ar"}onEnterXR(t){MY&&console.log("ENTER WEBXR: SessionRoot start..."),this._anchor=null,this.gameObject.updateMatrixWorld(),this._startOffset.copy(this.gameObject.matrixWorld);const i=new ye;this._createdPlacementObject=i,i.name="AR Session Root",this._placementScene.name="AR Placement Scene",this._placementScene.children.length=0;for(let n=this.context.scene.children.length-1;n>=0;n--){const r=this.context.scene.children[n];this._placementScene.add(r)}if(this.context.scene.add(i),this.autoCenter){const n=ec(this._placementScene.children),r=n.getCenter(new T),o=n.getSize(new T),a=new ce;a.makeTranslation(r.x,r.y-o.y*.5,r.z),this._startOffset.multiply(a)}this._reparentedComponents.length=0,this._reparentedComponents.push({comp:this,originalObject:this.gameObject}),$.addComponent(i,this);for(const n of this._reticle)ic(n);this._reticle.length=0,this._isPlacing=!0,this.context.input.addEventListener("pointerup",this.onPlaceScene,{queue:Nl.Early})}onLeaveXR(){this.context.input.removeEventListener("pointerup",this.onPlaceScene,{queue:Nl.Early}),this.onRevertSceneChanges(),this._anchor=null,this._rigPlacementMatrix=void 0}onUpdateXR(t){var i,n,r,o;if(t.xr.isTrackingImages){for(const a of this._reticle)a.visible=!1;return}if(this._isPlacing){const a=(i=t.xr.rig)==null?void 0:i.gameObject;a&&a.parent!==this.context.scene&&this.context.scene.add(a);let l=!1;if(t.xr.isPassThrough&&t.xr.controllers.length>0&&!this.autoPlace)for(const c of t.xr.controllers){const h=c.getHitTest();h&&(l=!0,this.updateReticleAndHits(t.xr,c.index,h,t.xr.rigScale))}if(!l){const c=t.xr.getHitTest();c&&this.updateReticleAndHits(t.xr,0,c,t.xr.rigScale)}}else{if(this._anchor&&t.xr.referenceSpace){const a=t.xr.frame.getPose(this._anchor.anchorSpace,t.xr.referenceSpace);if(a&&this.context.time.frame%20===0){const l=t.xr.convertSpace(a.transform),c=this._reticle[0];c&&(c.position.copy(l.position),c.quaternion.copy(l.quaternion),this.onApplyPose(c))}}if(this.arTouchTransform?(this.userInput||(this.userInput=new gb(this.context)),(n=this.userInput)==null||n.enable()):(r=this.userInput)==null||r.disable(),this.arTouchTransform&&((o=this.userInput)!=null&&o.hasChanged)){if(t.xr.rig){const a=t.xr.rig.gameObject;this.userInput.applyMatrixTo(a.matrix,!0),a.matrix.decompose(a.position,a.quaternion,a.scale),this.userInput.factor=a.scale.x}this.userInput.reset()}}}updateReticleAndHits(t,i,n,r){this._hits[i]=n.hit;let o=this._reticle[i];if(!o){if(this.customReticle)if(this.customReticle.asset)o=ov(this.customReticle.asset);else{this.customReticle.loadAssetAsync();return}else o=new fe(new S1(.07,.09,32).rotateX(-Math.PI/2),new ii({side:Zi,depthTest:!1,depthWrite:!1,transparent:!0,opacity:1,color:15658734})),o.name="AR Placement Reticle";if(MY){const a=new al(1);a.position.y+=.01,o.add(a)}this._reticle[i]=o,o.matrixAutoUpdate=!1,o.visible=!1}if(o.lastPos=o.lastPos||n.position.clone(),o.lastQuat=o.lastQuat||n.quaternion.clone(),o.position.copy(o.lastPos.lerp(n.position,this.context.time.deltaTime/.1)),o.lastPos.copy(o.position),o.quaternion.copy(o.lastQuat.slerp(n.quaternion,this.context.time.deltaTime/.05)),o.lastQuat.copy(o.quaternion),o.scale.set(r,r,r),this.customReticle&&this.applyViewBasedTransform(o),o.updateMatrix(),o.visible=!0,o.parent!==this.context.scene&&this.context.scene.add(o),this._placementStartTime<0&&(this._placementStartTime=this.context.time.realtimeSinceStartup),this.autoPlace)if(this.upVec.set(0,1,0).applyQuaternion(o.quaternion),this.upVec.dot(St(0,1,0))>.9){let l=o["autoplace:timer"]||0;l>=1?(o.visible=!1,this.onPlaceScene(null)):(l+=this.context.time.deltaTime,o["autoplace:timer"]=l)}else o["autoplace:timer"]=0}onScaleChanged(){}onRevertSceneChanges(){var t;for(const i of this._reticle)i&&(i.visible=!1,i==null||i.removeFromParent());this._reticle.length=0;for(let i=this._placementScene.children.length-1;i>=0;i--){const n=this._placementScene.children[i];this.context.scene.add(n)}(t=this._createdPlacementObject)==null||t.removeFromParent();for(const i of this._reparentedComponents)$.addComponent(i.originalObject,i.comp)}async onCreateAnchor(t,i){if(i.createAnchor===void 0){console.warn("Hit does not support creating an anchor",i),Qe()&&An("Hit does not support creating an anchor");return}else{const n=await i.createAnchor(t.viewerPose.transform);t.running&&n&&(this._anchor=n)}}applyViewBasedTransform(t){const i=this.context.mainCamera,n=t,r=i.worldPosition,o=n.worldPosition;this.upVec.set(0,1,0).applyQuaternion(t.quaternion);const a=i.worldPosition;a&&t.position.clone().sub(a).angleTo(this.upVec)<Math.PI/2&&this.upVec.negate();const l=this.upVec.angleTo(this.worldUpVec)*180/Math.PI,c=30;l>c&&l<180-c||l<-c&&l>-180+c?(this.lookPoint.copy(t.position).add(this.upVec),this.lookPoint.y=t.position.y,t.lookAt(this.lookPoint)):(r.y=o.y,t.lookAt(r))}onApplyPose(t){var r,o,a,l;const i=(o=(r=Vt.active)==null?void 0:r.rig)==null?void 0:o.gameObject;if(!i){console.warn("No rig object to place");return}(a=Vt.active)!=null&&a.rigScale;const n=i.parent||this.context.scene;this._rigPlacementMatrix?(l=this._rigPlacementMatrix)==null||l.decompose(i.position,i.quaternion,i.scale):this._rigPlacementMatrix=i.matrix.clone(),this.applyViewBasedTransform(t),t.updateMatrix(),this.context.scene.add(t),t.attach(i),t.removeFromParent(),i.scale.set(this.arScale,this.arScale,this.arScale),i.position.multiplyScalar(this.arScale),i.updateMatrix(),this.invertForward&&i.matrix.premultiply(cVe),i.matrix.premultiply(this._startOffset),i.matrix.decompose(i.position,i.quaternion,i.scale),n.add(i)}}p(Rp,"_eventListeners",{});const X2=class{constructor(e){p(this,"oneFingerDrag",!0);p(this,"twoFingerRotate",!0);p(this,"twoFingerScale",!0);p(this,"factor",1);p(this,"context");p(this,"offset");p(this,"plane");p(this,"_scale",1);p(this,"_hasChanged",!1);p(this,"_enabled",!1);p(this,"currentlyUsedPointerIds",new Set);p(this,"currentlyUnusedPointerIds",new Set);p(this,"onPointerDownEarly",e=>{this.isActive&&e.stopPropagation()});p(this,"onPointerDownLate",e=>{e.used?this.currentlyUsedPointerIds.add(e.pointerId):this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.add(e.pointerId)});p(this,"onPointerUpEarly",e=>{this.currentlyUsedPointerIds.delete(e.pointerId),this.currentlyUnusedPointerIds.delete(e.pointerId)});p(this,"prev",new Map);p(this,"_didMultitouch",!1);p(this,"touchStart",e=>{if(!e.defaultPrevented)for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t],n=exports.DeviceUtilities.isAndroidDevice()&&i.clientY<window.innerHeight*.1;this.prev.has(i.identifier)||this.prev.set(i.identifier,{ignore:n,x:0,z:0,screenx:0,screeny:0});const r=this.prev.get(i.identifier);if(r){const o=this.getPositionOnPlane(i.clientX,i.clientY);r.x=o.x,r.z=o.z,r.screenx=i.clientX,r.screeny=i.clientY}}});p(this,"touchEnd",e=>{e.touches.length<=0&&(this._didMultitouch=!1);for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t];this.prev.delete(i.identifier)}});p(this,"touchMove",e=>{if(!e.defaultPrevented&&this.isActive){if(e.touches.length===1){if(this._didMultitouch)return;const t=e.touches[0],i=this.prev.get(t.identifier);if(!i||i.ignore)return;const n=this.getPositionOnPlane(t.clientX,t.clientY),r=n.x-i.x,o=n.z-i.z;if(r===0&&o===0)return;this.oneFingerDrag&&this.addMovement(r,o),i.x=n.x,i.z=n.z,i.screenx=t.clientX,i.screeny=t.clientY;return}else if(e.touches.length===2){this._didMultitouch=!0;const t=e.touches[0],i=e.touches[1],n=this.prev.get(t.identifier),r=this.prev.get(i.identifier);if(!n||!r)return;if(this.twoFingerRotate){const o=Math.atan2(t.clientY-i.clientY,t.clientX-i.clientX),a=Math.atan2(n.screeny-r.screeny,n.screenx-r.screenx),l=o-a;Math.abs(l)>.001&&this.addRotation(l)}if(this.twoFingerScale){const o=t.clientX-i.clientX,a=t.clientY-i.clientY,l=Math.sqrt(o*o+a*a),c=n.screenx-r.screenx,h=n.screeny-r.screeny,d=Math.sqrt(c*c+h*h),u=l-d;Math.abs(u)>2&&this.addScale(u)}n.screenx=t.clientX,n.screeny=t.clientY,r.screenx=i.clientX,r.screeny=i.clientY}}});p(this,"_raycaster",new Em);p(this,"_intersection",new T);p(this,"_screenPos",new T);p(this,"_tempMatrix",new ce);this.context=e,this.offset=new ce,this.plane=new js,this.plane.setFromNormalAndCoplanarPoint(X2.up,X2.zero)}reset(){this._scale=1,this.offset.identity()}get hasChanged(){return this._hasChanged}applyMatrixTo(e,t){this._hasChanged=!1,t?(this.offset.invert(),e.premultiply(this.offset)):e.multiply(this.offset)}get isActive(){return this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.size>0}enable(){this._enabled||(this._enabled=!0,this.context.input.addEventListener("pointerdown",this.onPointerDownEarly,{queue:Nl.Early}),this.context.input.addEventListener("pointerdown",this.onPointerDownLate,{queue:Nl.Late}),this.context.input.addEventListener("pointerup",this.onPointerUpEarly,{queue:Nl.Early}),window.addEventListener("touchstart",this.touchStart,{passive:!1}),window.addEventListener("touchmove",this.touchMove,{passive:!1}),window.addEventListener("touchend",this.touchEnd,{passive:!1}))}disable(){this._enabled&&(this._enabled=!1,this.context.input.removeEventListener("pointerdown",this.onPointerDownEarly,{queue:Nl.Early}),this.context.input.removeEventListener("pointerdown",this.onPointerDownLate,{queue:Nl.Late}),this.context.input.removeEventListener("pointerup",this.onPointerUpEarly,{queue:Nl.Early}),window.removeEventListener("touchstart",this.touchStart),window.removeEventListener("touchmove",this.touchMove),window.removeEventListener("touchend",this.touchEnd))}getPositionOnPlane(e,t){const i=this.context.mainCamera;return this._screenPos.x=e/window.innerWidth*2-1,this._screenPos.y=-(t/window.innerHeight)*2+1,this._screenPos.z=1,this._screenPos.unproject(i),this._raycaster.set(i.position,this._screenPos.sub(i.position)),this._raycaster.ray.intersectPlane(this.plane,this._intersection),this._intersection}addMovement(e,t){e/=this._scale,t/=this._scale,e*=this.factor,t*=this.factor,this.offset.elements[12]+=e,this.offset.elements[14]+=t,(e!==0||t!==0)&&(this._hasChanged=!0)}addScale(e){e/=window.innerWidth,e*=-1,this._scale*=1+e,this._tempMatrix.makeScale(1-e,1-e,1-e),this.offset.premultiply(this._tempMatrix),e!==0&&(this._hasChanged=!0)}addRotation(e){e*=-1,this._tempMatrix.makeRotationY(e),this.offset.premultiply(this._tempMatrix),e!==0&&(this._hasChanged=!0)}};let gb=X2;p(gb,"up",new T(0,1,0)),p(gb,"zero",new T(0,0,0)),p(gb,"one",new T(1,1,1));var hVe=Object.defineProperty,dVe=Object.getOwnPropertyDescriptor,Cv=(s,e,t,i)=>{for(var n=i>1?void 0:i?dVe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&hVe(e,t,n),n};class hu extends ze{constructor(){super(...arguments);p(this,"position","bottom");p(this,"showNeedleLogo",!0);p(this,"showSpatialMenu");p(this,"createFullscreenButton");p(this,"createMuteButton");p(this,"createQRCodeButton")}onEnable(){this.applyOptions()}applyOptions(){this.context.menu.setPosition(this.position),this.context.menu.showNeedleLogo(this.showNeedleLogo),this.createFullscreenButton===!0&&this.context.menu.showFullscreenOption(!0),this.createMuteButton===!0&&this.context.menu.showAudioPlaybackOption(!0),this.showSpatialMenu===!0&&this.context.menu.showSpatialMenu(this.showSpatialMenu),this.createQRCodeButton===!0&&(exports.DeviceUtilities.isMobileDevice()||this.context.menu.showQRCodeButton(!0))}}Cv([I()],hu.prototype,"position",2);Cv([I()],hu.prototype,"showNeedleLogo",2);Cv([I()],hu.prototype,"showSpatialMenu",2);Cv([I()],hu.prototype,"createFullscreenButton",2);Cv([I()],hu.prototype,"createMuteButton",2);Cv([I()],hu.prototype,"createQRCodeButton",2);const Cs={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function gae(s){const e=await fetch(s);if(e.ok)return e.json();throw new Error(e.statusText)}async function uVe(s){if(!s)throw new Error("No basePath supplied");return await gae(`${s}/profilesList.json`)}async function pVe(s,e,t=null,i=!0){if(!s)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const n=await uVe(e);let r;if(s.profiles.some(l=>{const c=n[l];return c&&(r={profileId:l,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}),!!r}),!r){if(!t)throw new Error("No matching profile name found");const l=n[t];if(!l)throw new Error(`No matching profile name found and default profile "${t}" missing.`);r={profileId:t,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}}const o=await gae(r.profilePath);let a;if(i){let l;if(s.handedness==="any"?l=o.layouts[Object.keys(o.layouts)[0]]:l=o.layouts[s.handedness],!l)throw new Error(`No matching handedness, ${s.handedness}, in profile ${r.profileId}`);l.assetPath&&(a=r.profilePath.replace("profile.json",l.assetPath))}return{profile:o,assetPath:a}}const fVe={xAxis:0,yAxis:0,button:0,state:Cs.ComponentState.DEFAULT};function mVe(s=0,e=0){let t=s,i=e;if(Math.sqrt(s*s+e*e)>1){const o=Math.atan2(e,s);t=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:i*.5+.5}}class gVe{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Cs.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(fVe)}updateFromComponent({xAxis:e,yAxis:t,button:i,state:n}){const{normalizedXAxis:r,normalizedYAxis:o}=mVe(e,t);switch(this.componentProperty){case Cs.ComponentProperty.X_AXIS:this.value=this.states.includes(n)?r:.5;break;case Cs.ComponentProperty.Y_AXIS:this.value=this.states.includes(n)?o:.5;break;case Cs.ComponentProperty.BUTTON:this.value=this.states.includes(n)?i:0;break;case Cs.ComponentProperty.STATE:this.valueNodeProperty===Cs.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(n):this.value=this.states.includes(n)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class AVe{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(i=>{const n=new gVe(t.visualResponses[i]);this.visualResponses[i]=n}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:Cs.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=Cs.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=Cs.ComponentState.PRESSED:(t.touched||this.values.button>Cs.ButtonTouchThreshold)&&(this.values.state=Cs.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Cs.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Cs.AxisTouchThreshold&&(this.values.state=Cs.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Cs.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Cs.AxisTouchThreshold&&(this.values.state=Cs.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class yVe{constructor(e,t,i){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=i,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(n=>{const r=this.layoutDescription.components[n];this.components[n]=new AVe(n,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const bVe="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",xVe="generic-trigger";let vVe=class extends ye{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(i=>{const{valueNode:n,minNode:r,maxNode:o,value:a,valueNodeProperty:l}=i;n&&(l===Cs.VisualResponseProperty.VISIBILITY?n.visible=a:l===Cs.VisualResponseProperty.TRANSFORM&&(n.quaternion.slerpQuaternions(r.quaternion,o.quaternion,a),n.position.lerpVectors(r.position,o.position,a)))})}))}};function _Ve(s,e){Object.values(s.components).forEach(t=>{const{type:i,touchPointNodeName:n,visualResponses:r}=t;if(i===Cs.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(n),t.touchPointNode){const o=new Wc(.001),a=new ii({color:255}),l=new fe(o,a);t.touchPointNode.add(l)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(r).forEach(o=>{const{valueNodeName:a,minNodeName:l,maxNodeName:c,valueNodeProperty:h}=o;if(h===Cs.VisualResponseProperty.TRANSFORM){if(o.minNode=e.getObjectByName(l),o.maxNode=e.getObjectByName(c),!o.minNode){console.warn(`Could not find ${l} in the model`);return}if(!o.maxNode){console.warn(`Could not find ${c} in the model`);return}}o.valueNode=e.getObjectByName(a),o.valueNode||console.warn(`Could not find ${a} in the model`)})})}function IY(s,e){_Ve(s.motionController,e),s.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=s.envMap,t.material.needsUpdate=!0)}),s.layers.mask!=0&&e.traverse(t=>{t.layers.mask=s.layers.mask}),s.add(e)}class CVe{constructor(e=null,t=null){this.gltfLoader=e,this.path=bVe,this._assetCache={},this.onLoad=t,this.gltfLoader||(this.gltfLoader=new Tp)}setPath(e){return this.path=e,this}createControllerModel(e){const t=new vVe;let i=null;return e.addEventListener("connected",n=>{const r=n.data;r.targetRayMode!=="tracked-pointer"||!r.gamepad||r.hand||pVe(r,this.path,xVe).then(({profile:o,assetPath:a})=>{t.motionController=new yVe(r,o,a);const l=this._assetCache[t.motionController.assetUrl];if(l)i=l.scene.clone(),IY(t,i),this.onLoad&&this.onLoad(i);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,c=>{this._assetCache[t.motionController.assetUrl]=c,i=c.scene.clone(),IY(t,i),this.onLoad&&this.onLoad(i)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(o=>{console.warn(o)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(i),i=null}),t}}const wVe="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class SVe{constructor(e,t,i,n,r=null,o=null){this.controller=t,this.handModel=e,this.bones=[],r===null&&(r=new Tp,r.setPath(i||wVe)),r.load(`${n}.glb`,a=>{const l=a.scene.children[0];this.handModel.add(l),l.layers.mask=this.handModel.layers.mask;const c=l.getObjectByProperty("type","SkinnedMesh");c.frustumCulled=!1,c.castShadow=!0,c.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(d=>{const u=l.getObjectByName(d);u!==void 0?u.jointName=d:console.warn(`Couldn't find ${d} in ${n} hand mesh`),this.bones.push(u)}),o&&o(l)})}updateMesh(){const e=this.controller.joints;for(let t=0;t<this.bones.length;t++){const i=this.bones[t];if(i){const n=e[i.jointName];if(n.visible){const r=n.position;i.position.copy(r),i.quaternion.copy(n.quaternion)}}}}}var MVe=Object.defineProperty,IVe=Object.getOwnPropertyDescriptor,UP=(s,e,t,i)=>{for(var n=i>1?void 0:i?IVe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&MVe(e,t,n),n};const ku=ee("debugwebxr"),pf=new Array;class eu extends ze{constructor(){super(...arguments);p(this,"createControllerModel",!0);p(this,"createHandModel",!0);p(this,"customLeftHand");p(this,"customRightHand");p(this,"_models",new Array)}supportsXR(t){return t==="immersive-vr"||t==="immersive-ar"}async onXRControllerAdded(t){var r;if(!(t.xr.isVR||t.xr.isPassThrough))return;const{controller:n}=t;if(ku&&console.warn("Add Controller Model for",n.side,n.index),this.createControllerModel||this.createHandModel){if(n.hand){if(this.createHandModel){const o=await this.loadHandModel(this,n);if(!o||!n.connected||!n.isHand){o!=null&&o.handObject&&hb(o.handObject,!1),(r=o==null?void 0:o.handObject)==null||r.destroy();return}this._models.push({controller:n,model:o.handObject,handmesh:o.handmesh}),this._models.sort((a,l)=>a.controller.index-l.controller.index),this.scene.add(o.handObject),n.model=o.handObject}}else if(this.createControllerModel){const o=await n.getModelUrl();if(o){const a=await this.loadModel(n,o);if(!a||!n.connected||n.isHand)return;this._models.push({controller:n,model:a}),this._models.sort((l,c)=>l.controller.index-c.controller.index),this.scene.add(a),a.traverse(l=>{l.layers.set(2),l.matrixAutoUpdate=!1,l.updateMatrix()}),n.model=a}else n.targetRayMode!=="transient-pointer"&&console.warn("XRControllerModel: no model found for "+n.side)}}}onXRControllerRemoved(t){console.debug("XR Controller Removed",t.controller.side,t.controller.index);const i=this._models.findIndex(r=>r.controller===t.controller),n=this._models[i];n&&(this._models.splice(i,1),n.model&&(hb(n.model,!1),n.model.destroy(),n.model=void 0))}onLeaveXR(t){for(const i of this._models)i&&(i.model&&(hb(i.model,!1),i.model.destroy(),i.model=void 0),i.controller.model===i.model&&(i.controller.model=null));this._models.length=0}onBeforeRender(){if(Vt.active&&(ku&&(pf[0]=Date.now()),this.updateRendering(Vt.active),ku)){const t=Date.now()-pf[0];pf.push(t),pf.length>=30&&(pf[0]=0,pf.reduce((i,n)=>i+n,0)/pf.length,pf.length=0)}}updateRendering(t){var i,n,r,o,a;for(let l=0;l<this._models.length;l++){const c=this._models[l];if(!c)continue;const h=c.controller;if(!h.connected){ku&&console.warn("XRControllerModel.onUpdateXR: controller is not connected anymore",h.side,h.hand);continue}if(c.model&&!c.handmesh)c.model.matrixAutoUpdate=!1,c.model.matrix.copy(h.gripMatrix),c.model.visible=h.isTracking,(i=t.rig)==null||i.gameObject.add(c.model);else if(h.inputSource.hand&&c.handmesh){const d=t.referenceSpace,u=this.context.renderer.xr.getHand(h.index);if(d&&t.frame.getJointPose){for(const f of h.inputSource.hand.values()){const m=u.joints[f.jointName];if(m){const g=h.getHandJointPose(f);if(g){const A=g.transform.position,y=g.transform.orientation;m.position.copy(A),m.quaternion.copy(y),m.matrixAutoUpdate=!1}m.visible=g!=null}}c.model&&(c.model.visible=h.isTracking,c.model.visible&&c.model.parent!==((n=t.rig)==null?void 0:n.gameObject)&&((r=t.rig)==null||r.gameObject.add(c.model))),(o=c.model)!=null&&o.visible&&((a=c.handmesh)==null||a.updateMesh(),c.model.matrixAutoUpdate=!1,c.model.matrix.identity(),c.model.applyMatrix4(jb))}}}}async loadModel(t,i){var o;if(!t.connected)return console.warn("XRControllerModel.onXRControllerAdded: controller is not connected anymore",t.side),null;const r=await gi.getOrCreate("",i).instantiate();return hb(r),(o=Vt.active)!=null&&o.isPassThrough&&r.traverseVisible(a=>{this.makeOccluder(a)}),r}async loadHandModel(t,i){const n=this.context,r=n.renderer.xr.getHand(i.index);r||(ku?Mt.DrawLabel(i.rayWorldPosition,"No hand found for index "+i.index,.05,5):console.warn("No hand found for index "+i.index));const o=new Tp;wP(o,n),await C2(o,n,this.sourceId??"");const a=zP(o);let l="";const c=i.side==="left"?this.customLeftHand:this.customRightHand;c?(l=c.url.split(".").slice(0,-1).join("."),o.setPath("")):(l=i.inputSource.handedness==="left"?"left":"right",o.setPath("https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/"));const h=new ye;hb(h);const d=new SVe(h,r,o.path,l,o,u=>{var m;const f=a.gltf;((m=f==null?void 0:f.scene.children)==null?void 0:m.length)===0&&(f.scene.children[0]=u),kh().createBuiltinComponents(t.context,t.sourceId||l,a.gltf,null,a),u.traverse(g=>{var A;g.layers.set(2),(A=Vt.active)!=null&&A.isPassThrough&&!c&&this.makeOccluder(g),g instanceof fe&&Ni.assignMeshLOD(g,0)}),i.connected||(ku&&Mt.DrawLabel(i.rayWorldPosition,"Hand is loaded but not connected anymore",.05,5),u.removeFromParent())});if(ku&&h.add(new al(.5)),i.inputSource.hand){ku&&console.log(i.inputSource.hand);for(const u of i.inputSource.hand.values())if(r.joints[u.jointName]===void 0){const f=new Ms;f.matrixAutoUpdate=!1,f.visible=!0,r.joints[u.jointName]=f,r.add(f)}}else ku&&Mt.DrawLabel(i.rayWorldPosition,"No inputSource.hand found for index "+i.index,.05,5);return{handObject:h,handmesh:d}}makeOccluder(t){if(t instanceof fe){let i=t.material;i instanceof Yt&&(i=t.material=i.clone(),i.depthWrite=!0,i.depthTest=!0,i.colorWrite=!1,t.receiveShadow=!1,t.renderOrder=-100)}}}p(eu,"factory",new CVe);UP([I()],eu.prototype,"createControllerModel",2);UP([I()],eu.prototype,"createHandModel",2);UP([I(gi)],eu.prototype,"customLeftHand",2);UP([I(gi)],eu.prototype,"customRightHand",2);const TY=new oi,xE=new T;class Aae extends _B{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new ut(e,3)),this.setAttribute("uv",new ut(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new Ww(t,6,1);return this.setAttribute("instanceStart",new Ma(i,3,0)),this.setAttribute("instanceEnd",new Ma(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new Ww(t,6,1);return this.setAttribute("instanceColorStart",new Ma(i,3,0)),this.setAttribute("instanceColorEnd",new Ma(i,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new eX(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new oi);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),TY.setFromBufferAttribute(t),this.boundingBox.union(TY))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Vn),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let n=0;for(let r=0,o=e.count;r<o;r++)xE.fromBufferAttribute(e,r),n=Math.max(n,i.distanceToSquared(xE)),xE.fromBufferAttribute(t,r),n=Math.max(n,i.distanceToSquared(xE));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}ht.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Q(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};Wn.line={uniforms:Zx.merge([ht.common,ht.fog,ht.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class sZ extends Ht{constructor(e){super({type:"LineMaterial",uniforms:Zx.clone(Wn.line.uniforms),vertexShader:Wn.line.vertexShader,fragmentShader:Wn.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const SD=new Je,EY=new T,RY=new T,io=new Je,no=new Je,id=new Je,MD=new T,ID=new ce,fo=new Fc,LY=new T,vE=new oi,_E=new Vn,nd=new Je;let Sd,D0;function BY(s,e,t){return nd.set(0,0,-e,1).applyMatrix4(s.projectionMatrix),nd.multiplyScalar(1/nd.w),nd.x=D0/t.width,nd.y=D0/t.height,nd.applyMatrix4(s.projectionMatrixInverse),nd.multiplyScalar(1/nd.w),Math.abs(Math.max(nd.x,nd.y))}function TVe(s,e){const t=s.matrixWorld,i=s.geometry,n=i.attributes.instanceStart,r=i.attributes.instanceEnd,o=Math.min(i.instanceCount,n.count);for(let a=0,l=o;a<l;a++){fo.start.fromBufferAttribute(n,a),fo.end.fromBufferAttribute(r,a),fo.applyMatrix4(t);const c=new T,h=new T;Sd.distanceSqToSegment(fo.start,fo.end,h,c),h.distanceTo(c)<D0*.5&&e.push({point:h,pointOnLine:c,distance:Sd.origin.distanceTo(h),object:s,face:null,faceIndex:a,uv:null,uv1:null})}}function EVe(s,e,t){const i=e.projectionMatrix,r=s.material.resolution,o=s.matrixWorld,a=s.geometry,l=a.attributes.instanceStart,c=a.attributes.instanceEnd,h=Math.min(a.instanceCount,l.count),d=-e.near;Sd.at(1,id),id.w=1,id.applyMatrix4(e.matrixWorldInverse),id.applyMatrix4(i),id.multiplyScalar(1/id.w),id.x*=r.x/2,id.y*=r.y/2,id.z=0,MD.copy(id),ID.multiplyMatrices(e.matrixWorldInverse,o);for(let u=0,f=h;u<f;u++){if(io.fromBufferAttribute(l,u),no.fromBufferAttribute(c,u),io.w=1,no.w=1,io.applyMatrix4(ID),no.applyMatrix4(ID),io.z>d&&no.z>d)continue;if(io.z>d){const x=io.z-no.z,v=(io.z-d)/x;io.lerp(no,v)}else if(no.z>d){const x=no.z-io.z,v=(no.z-d)/x;no.lerp(io,v)}io.applyMatrix4(i),no.applyMatrix4(i),io.multiplyScalar(1/io.w),no.multiplyScalar(1/no.w),io.x*=r.x/2,io.y*=r.y/2,no.x*=r.x/2,no.y*=r.y/2,fo.start.copy(io),fo.start.z=0,fo.end.copy(no),fo.end.z=0;const g=fo.closestPointToPointParameter(MD,!0);fo.at(g,LY);const A=Bi.lerp(io.z,no.z,g),y=A>=-1&&A<=1,b=MD.distanceTo(LY)<D0*.5;if(y&&b){fo.start.fromBufferAttribute(l,u),fo.end.fromBufferAttribute(c,u),fo.start.applyMatrix4(o),fo.end.applyMatrix4(o);const x=new T,v=new T;Sd.distanceSqToSegment(fo.start,fo.end,v,x),t.push({point:v,pointOnLine:x,distance:Sd.origin.distanceTo(v),object:s,face:null,faceIndex:u,uv:null,uv1:null})}}}class RVe extends fe{constructor(e=new Aae,t=new sZ({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,n=new Float32Array(2*t.count);for(let o=0,a=0,l=t.count;o<l;o++,a+=2)EY.fromBufferAttribute(t,o),RY.fromBufferAttribute(i,o),n[a]=a===0?0:n[a-1],n[a+1]=n[a]+EY.distanceTo(RY);const r=new Ww(n,2,1);return e.setAttribute("instanceDistanceStart",new Ma(r,1,0)),e.setAttribute("instanceDistanceEnd",new Ma(r,1,1)),this}raycast(e,t){const i=this.material.worldUnits,n=e.camera;n===null&&!i&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const r=e.params.Line2!==void 0&&e.params.Line2.threshold||0;Sd=e.ray;const o=this.matrixWorld,a=this.geometry,l=this.material;D0=l.linewidth+r,a.boundingSphere===null&&a.computeBoundingSphere(),_E.copy(a.boundingSphere).applyMatrix4(o);let c;if(i)c=D0*.5;else{const d=Math.max(n.near,_E.distanceToPoint(Sd.origin));c=BY(n,d,l.resolution)}if(_E.radius+=c,Sd.intersectsSphere(_E)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),vE.copy(a.boundingBox).applyMatrix4(o);let h;if(i)h=D0*.5;else{const d=Math.max(n.near,vE.distanceToPoint(Sd.origin));h=BY(n,d,l.resolution)}vE.expandByScalar(h),Sd.intersectsBox(vE)!==!1&&(i?TVe(this,t):EVe(this,n,t))}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(SD),this.material.uniforms.resolution.value.set(SD.z,SD.w))}}class yae extends Aae{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return super.setPositions(i),this}setColors(e){const t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return super.setColors(i),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class LVe extends RVe{constructor(e=new yae,t=new sZ({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}class XP extends ze{}var BVe=Object.defineProperty,PVe=Object.getOwnPropertyDescriptor,jm=(s,e,t,i)=>{for(var n=i>1?void 0:i?PVe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&BVe(e,t,n),n};const TD=ee("debugwebxr");class sc extends ze{constructor(){super(...arguments);p(this,"movementSpeed",1.5);p(this,"rotationStep",30);p(this,"useTeleport",!0);p(this,"usePinchToTeleport",!0);p(this,"useTeleportTarget",!1);p(this,"useTeleportFade",!1);p(this,"showRays",!0);p(this,"showHits",!0);p(this,"isXRMovementHandler",!0);p(this,"xrSessionMode","immersive-vr");p(this,"_didApplyRotation",!1);p(this,"_didTeleport",!1);p(this,"_teleportBuffer",new Array);p(this,"_plane",null);p(this,"_lines",[]);p(this,"_hitDiscs",[]);p(this,"_hitDistances",[]);p(this,"_lastHitDistances",[]);p(this,"hitPointRaycastFilter",t=>t.type==="SkinnedMesh"?"continue in children":!0)}onUpdateXR(t){const i=t.xr.rig;if(!(i!=null&&i.gameObject)||t.xr.isPassThrough)return;const n=t.xr.leftController,r=t.xr.rightController;n&&this.onHandleMovement(n,i.gameObject),r&&(this.onHandleRotation(r,i.gameObject),this.useTeleport&&this.onHandleTeleport(r,i.gameObject))}onLeaveXR(t){for(const i of this._lines)i.removeFromParent();for(const i of this._hitDiscs)i==null||i.removeFromParent()}onBeforeRender(){var t;(t=this.context.xr)!=null&&t.running&&(this.showRays&&this.renderRays(this.context.xr),this.showHits&&this.renderHits(this.context.xr))}onHandleMovement(t,i){const n=t.getStick("xr-standard-thumbstick");if(n.x!=0||n.y!=0){const r=St(n.x,0,n.y);r.multiplyScalar(this.context.time.deltaTimeUnscaled*this.movementSpeed);const o=kn(i);r.multiplyScalar(o.x),r.applyQuaternion(t.xr.poseOrientation),r.y=0,r.applyQuaternion(i.worldQuaternion),i.position.add(r),i.updateWorldMatrix(!1,!1);for(const a of i.children)a.updateWorldMatrix(!1,!1)}}onHandleRotation(t,i){if(t._isMxInk)return;const r=t.getStick("xr-standard-thumbstick").x;if(this._didApplyRotation)Math.abs(r)<.3&&(this._didApplyRotation=!1);else if(Math.abs(r)>.5){this._didApplyRotation=!0;const o=r>0?1:-1,a=$t(this.context.mainCamera).clone();i.rotateY(o*lt.toRadians(this.rotationStep));const c=$t(this.context.mainCamera).clone().sub(a);c.y=0,i.position.sub(c)}}onHandleTeleport(t,i){var r,o,a,l,c;let n=0;if(t.hand&&this.usePinchToTeleport&&t.isTeleportGesture){const h=t.getPointerId("primary");if(h!=null&&this.context.input.getIsPointerIdInUse(h))return;const d=t.getGesture("pinch");d&&(n=d.value)}else n=(r=t.getStick("xr-standard-thumbstick"))==null?void 0:r.y;if(this._didTeleport)n>=0&&n<.4?this._didTeleport=!1:n<0&&n>-.4&&(this._didTeleport=!1);else if(n>.8){this._didTeleport=!0;const h=this.context.physics.raycastFromRay(t.ray)[0];if(h&&h.object instanceof Cx){const u=(o=h.normal)==null?void 0:o.dot(St(0,1,0));if(u!==void 0&&u<.4)return}let d=h==null?void 0:h.point;if(!d&&!this.useTeleportTarget){this._plane||(this._plane=new js(new T(0,1,0),0));const u=i.worldPosition;this._plane.setFromNormalAndCoplanarPoint(new T(0,1,0),u);const f=t.ray;d=u.clone(),this._plane.intersectLine(new Fc(f.origin,St(f.direction).multiplyScalar(1e4).add(f.origin)),d),d.distanceTo(u)>i.scale.x*10&&(d=null)}if(d){if(this.useTeleportTarget&&!$.getComponentInParent(h.object,XP))return;const u=d.clone();if(TD&&Mt.DrawSphere(d,.025,16711680,5),(a=this.context.mainCamera)==null?void 0:a.position){const m=(l=this.context.xr)==null?void 0:l.getUserOffsetInRig();m&&(m.y=0,u.sub(m),TD&&Mt.DrawWireSphere(m.add(u),.025,65280,5))}this._teleportBuffer.push(i.matrix.clone()),this._teleportBuffer.length>10&&this._teleportBuffer.shift(),this.useTeleportFade?(c=t.xr.fadeTransition())==null||c.then(()=>{i.worldPosition=u}):i.worldPosition=u}}else if(n<-.8&&(this._didTeleport=!0,this._teleportBuffer.length>0)){const h=this._teleportBuffer.pop();h&&h.decompose(i.position,i.quaternion,i.scale)}}renderRays(t){var i;for(let n=0;n<this._lines.length;n++){const r=this._lines[n];r&&(r.visible=!1)}for(let n=0;n<t.controllers.length;n++){const r=t.controllers[n];let o=this._lines[n];if(!r.connected||!r.isTracking||!r.ray||r.targetRayMode==="transient-pointer"||!r.hasSelectEvent){o&&(o.visible=!1);continue}o||(o=this.createRayLineObject(),o.scale.z=.5,this._lines[n]=o),r.updateRayWorldPosition(),r.updateRayWorldQuaternion();const a=r.rayWorldPosition,l=r.rayWorldQuaternion;o.position.copy(a),o.quaternion.copy(l);const c=t.rigScale,h=this.usePinchToTeleport&&r.isTeleportGesture,d=this._lastHitDistances[n],u=this._hitDistances[n]!=null,f=d??c;o.scale.set(c,c,f),o.visible=!0,o.layers.disableAll(),o.layers.enable(2);let m=o.material.opacity;h?m=1:this.showHits&&f<t.rigScale*.5?m=0:(i=r.getButton("primary"))!=null&&i.pressed?m=.5:m=u?.2:.1,o.material.opacity=lt.lerp(o.material.opacity,m,this.context.time.deltaTimeUnscaled/.1),o.parent!==this.context.scene&&this.context.scene.add(o)}}renderHits(t){var i;for(const n of this._hitDiscs){if(!n)continue;const r=n.controller;if(!r||!r.connected||!r.isTracking){n.visible=!1;continue}}for(let n=0;n<t.controllers.length;n++){const r=t.controllers[n];if(!r.connected||!r.isTracking||!r.ray||!r.hasSelectEvent)continue;let o=this._hitDiscs[n],a=!0;const l=r.getPointerId("primary");l!=null&&this.context.input.getIsPointerIdInUse(l)&&(o&&(o.visible=!1),this._hitDistances[n]=null,this._lastHitDistances[n]=0,a=!1);const c=this.context.time.smoothedFps>=59?1:10;if((this.context.time.frame+r.index)%c!==0&&(a=!1),!a){const u=this._hitDiscs[n];u&&u.visible&&u.hit&&this.updateHitPointerPosition(r,u,u.hit.distance);continue}const h=this.context.physics.raycastFromRay(r.ray,{testObject:this.hitPointRaycastFilter,precise:!1});let d=h.find(u=>this.usePinchToTeleport&&r.isTeleportGesture?!0:this.isObjectWithInteractiveComponent(u.object));if(d||(d=h[0]),o&&(o.controller=r,o.hit=d),this._hitDistances[n]=(d==null?void 0:d.distance)||null,d){this._lastHitDistances[n]=d.distance;const u=t.rigScale??1;TD&&(Mt.DrawWireSphere(d.point,.025*u,16711680),Mt.DrawLabel(St(0,.2,0).add(d.point),d.object.name,.02,0)),o||(o=this.createHitPointObject(),this._hitDiscs[n]=o),o.hit=d,o.visible=d.distance>u*.05;let f=.01*(u+d.distance);const m=(i=r.getButton("primary"))==null?void 0:i.pressed;m&&(f*=1.1),o.scale.set(f,f,f),o.layers.set(2);let g=o.material.opacity;if(m?g=1:g=d.distance<.15*u?.2:.6,o.material.opacity=lt.lerp(o.material.opacity,g,this.context.time.deltaTimeUnscaled/.1),o.visible){if(d.normal){this.updateHitPointerPosition(r,o,d.distance);const A=d.normal.applyQuaternion(gn(d.object));o.quaternion.setFromUnitVectors(GVe,A)}else this.updateHitPointerPosition(r,o,d.distance);o.parent!==this.context.scene&&this.context.scene.add(o)}}else this._hitDiscs[n]&&(this._hitDiscs[n].visible=!1)}}isObjectWithInteractiveComponent(t,i=0){return y2(t)||t.isUI===!0?!0:t.isScene?!1:t.parent?this.isObjectWithInteractiveComponent(t.parent,i+1):!1}updateHitPointerPosition(t,i,n){const r=St(t.rayWorldPosition);r.add(St(0,0,n-.01).applyQuaternion(t.rayWorldQuaternion)),i.position.lerp(r,this.context.time.deltaTimeUnscaled/.05)}createHitPointObject(){const t=new fe(new Wc(.3,6,6),new ii({color:15658734,opacity:.7,transparent:!0,depthTest:!1,depthWrite:!1,side:Zi}));return t.layers.disableAll(),t.layers.enable(2),t}createRayLineObject(){const t=new LVe;t.layers.disableAll(),t.layers.enable(2);const i=new yae;t.geometry=i;const n=new Float32Array(9);n.set([0,0,.02,0,0,.4,0,0,1]),i.setPositions(n);const r=new Float32Array(9);r.set([1,1,1,.1,.1,.1,0,0,0]),i.setColors(r);const o=new sZ({color:16777215,vertexColors:!0,worldUnits:!0,linewidth:.004,transparent:!0,depthWrite:!1,blending:sm,dashed:!1});return t.material=o,t}}jm([I()],sc.prototype,"movementSpeed",2);jm([I()],sc.prototype,"rotationStep",2);jm([I()],sc.prototype,"useTeleport",2);jm([I()],sc.prototype,"usePinchToTeleport",2);jm([I()],sc.prototype,"useTeleportTarget",2);jm([I()],sc.prototype,"useTeleportFade",2);jm([I()],sc.prototype,"showRays",2);jm([I()],sc.prototype,"showHits",2);const GVe=new T(0,1,0);var kVe=Object.defineProperty,NVe=Object.getOwnPropertyDescriptor,$r=(s,e,t,i)=>{for(var n=i>1?void 0:i?NVe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&kVe(e,t,n),n};const CE=ee("debugwebxr"),DVe=ee("debugusdz");var LF;const Ab=(LF=class extends ze{constructor(){super(...arguments);p(this,"createVRButton",!0);p(this,"createARButton",!0);p(this,"createSendToQuestButton",!0);p(this,"createQRCode",!0);p(this,"useDefaultControls",!0);p(this,"showControllerModels",!0);p(this,"showHandModels",!0);p(this,"usePlacementReticle",!0);p(this,"customARPlacementReticle");p(this,"usePlacementAdjustment",!0);p(this,"arScale",1);p(this,"useXRAnchor",!1);p(this,"autoPlace",!0);p(this,"autoCenter",!1);p(this,"useQuicklookExport",!1);p(this,"useDepthSensing",!1);p(this,"useSpatialGrab",!0);p(this,"defaultAvatar");p(this,"_playerSync");p(this,"_createdComponentsInSession",[]);p(this,"_usdzExporter");p(this,"_exitXRMenuButton");p(this,"_previousXRState",0);p(this,"_spatialGrabRaycaster");p(this,"onAvatarSpawned",e=>{CE&&console.log("WebXR.onAvatarSpawned",e),$.getComponentInChildren(e,bm)??(t=$.addComponent(e,bm))});p(this,"_buttonFactory");p(this,"_buttons",[])}awake(){Vt.getXRSync(this.context)}onEnable(){var e,t;window.location.protocol!=="https:"&&An('<a href="https://developer.mozilla.org/en-US/docs/Web/API/WebXR_Device_API" target="_blank">WebXR</a> only works on secure connections (https).'),this.useQuicklookExport&&($.findObjectOfType(ds)||(CE&&console.log("WebXR: Adding USDZExporter"),this._usdzExporter=$.addComponent(this.gameObject,ds),this._usdzExporter.objectToExport=this.context.scene,this._usdzExporter.autoExportAnimations=!0,this._usdzExporter.autoExportAudioSources=!0)),this.handleCreatingHTML(),this.handleOfferSession(),this.defaultAvatar===!0&&(CE&&console.warn("WebXR: No default avatar set, using static default avatar"),this.defaultAvatar=new gi("https://cdn.needle.tools/static/avatars/DefaultAvatar.glb")),this.defaultAvatar&&(this._playerSync=this.gameObject.getOrAddComponent(dv),this._playerSync.autoSync=!1),this._playerSync&&typeof this.defaultAvatar!="boolean"&&(this._playerSync.asset=this.defaultAvatar,(e=this._playerSync.onPlayerSpawned)==null||e.removeEventListener(this.onAvatarSpawned),(t=this._playerSync.onPlayerSpawned)==null||t.addEventListener(this.onAvatarSpawned))}onDisable(){var e;(e=this._usdzExporter)==null||e.destroy(),this.removeButtons()}async handleOfferSession(){return this.createVRButton&&await Vt.isVRSupported()&&this.createVRButton?Vt.offerSession("immersive-vr","default",this.context):this.createARButton&&await Vt.isARSupported()&&this.createARButton?Vt.offerSession("immersive-ar","default",this.context):!1}get session(){return Vt.active??null}get sessionMode(){return Vt.activeMode??null}async enterVR(e){return Vt.start("immersive-vr",e,this.context)}async enterAR(e){return Vt.start("immersive-ar",e,this.context)}exitXR(){Vt.stop()}get isActiveWebXR(){return!Ab.activeWebXRComponent||Ab.activeWebXRComponent===this}onBeforeXR(e,t){var i;if(!this.isActiveWebXR){console.warn(`WebXR: another WebXR component is already active (${(i=Ab.activeWebXRComponent)==null?void 0:i.name}). This is ignored: ${this.name}`);return}Ab.activeWebXRComponent=this,e=="immersive-ar"&&this.useDepthSensing&&(t.optionalFeatures=t.optionalFeatures||[],t.optionalFeatures.push("depth-sensing"))}async onEnterXR(e){if(!this.isActiveWebXR)return;CE&&console.log("WebXR onEnterXR"),this._previousXRState=xo.Global.Mask;const t=e.xr.isVR;if(xo.Global.Set(t?wd.VR:wd.AR),this.usePlacementReticle&&e.xr.isAR){let i=$.findObjectOfType(Rp);if(!i){const n=new ye;for(const r of this.context.scene.children)n.add(r);this.context.scene.add(n),i=$.addComponent(n,Rp),this._createdComponentsInSession.push(i)}i.customReticle=this.customARPlacementReticle,i.arScale=this.arScale,i.arTouchTransform=this.usePlacementAdjustment,i.autoPlace=this.autoPlace,i.autoCenter=this.autoCenter,i.useXRAnchor=this.useXRAnchor}this.useDefaultControls&&this.setDefaultMovementEnabled(!0),(this.showControllerModels||this.showHandModels)&&this.setDefaultControllerRenderingEnabled(!0),this.useSpatialGrab&&(this._spatialGrabRaycaster=$.findObjectOfType(qf)??void 0,this._spatialGrabRaycaster||(this._spatialGrabRaycaster=this.gameObject.addComponent(qf))),this.createLocalAvatar(e.xr),e.xr.isScreenBasedAR||(this._exitXRMenuButton=this.context.menu.appendChild({label:"Quit XR",onClick:()=>this.exitXR(),icon:"exit_to_app",priority:2e4}))}onUpdateXR(e){this.isActiveWebXR&&this._spatialGrabRaycaster&&(this._spatialGrabRaycaster.enabled=this.useSpatialGrab)}onLeaveXR(e){var t,i;if((t=this._exitXRMenuButton)==null||t.remove(),!!this.isActiveWebXR){xo.Global.Set(this._previousXRState),(i=this._playerSync)==null||i.destroyInstance();for(const n of this._createdComponentsInSession)n.destroy();this._createdComponentsInSession.length=0,this.handleOfferSession(),QB(1).then(()=>Ab.activeWebXRComponent=null)}}setDefaultMovementEnabled(e){let t=this.gameObject.getComponent(sc);return!t&&e&&(t=this.gameObject.addComponent(sc),this._createdComponentsInSession.push(t)),t&&(t.enabled=e),t}setDefaultControllerRenderingEnabled(e){let t=this.gameObject.getComponent(eu);return!t&&e&&(t=this.gameObject.addComponent(eu),this._createdComponentsInSession.push(t),t.createControllerModel=this.showControllerModels,t.createHandModel==this.showHandModels),t&&(t.enabled=e),t}async createLocalAvatar(e){this._playerSync&&e.running&&typeof this.defaultAvatar!="boolean"&&(this._playerSync.asset=this.defaultAvatar,await this._playerSync.getInstance())}getButtonsContainer(){return this.getButtonsFactory()}getButtonsFactory(){return this._buttonFactory||(this._buttonFactory=vp.getOrCreate()),this._buttonFactory}handleCreatingHTML(){if(this.createARButton||this.createVRButton||this.useQuicklookExport){if((exports.DeviceUtilities.isiOS()&&exports.DeviceUtilities.isSafari()||DVe)&&this.useQuicklookExport){const t=$.findObjectOfType(ds);if(!t||t&&t.allowCreateQuicklookButton){const i=this.getButtonsFactory().createQuicklookButton();this.addButton(i,50)}}if(this.createARButton){const t=this.getButtonsFactory().createARButton();this.addButton(t,50)}if(this.createVRButton){const t=this.getButtonsFactory().createVRButton();this.addButton(t,50)}}if(this.createSendToQuestButton&&!exports.DeviceUtilities.isQuest()&&Vt.isVRSupported().then(t=>{if(!t){const i=this.getButtonsFactory().createSendToQuestButton();this.addButton(i,50)}}),this.createQRCode){const t=gP(hu);if(t&&t.createQRCodeButton===!1)Qe()&&console.warn("WebXR: QRCode button is disabled in the Needle Menu component");else if(!exports.DeviceUtilities.isMobileDevice()){const i=wh.getOrCreate().createQRCode();this.addButton(i,50)}}}addButton(e,t){this._buttons.push(e),e.setAttribute("priority",t.toString()),this.context.menu.appendChild(e)}removeButtons(){for(const e of this._buttons)e.remove();this._buttons.length=0}},p(LF,"activeWebXRComponent",null),LF);let Ls=Ab;$r([I()],Ls.prototype,"createVRButton",2);$r([I()],Ls.prototype,"createARButton",2);$r([I()],Ls.prototype,"createSendToQuestButton",2);$r([I()],Ls.prototype,"createQRCode",2);$r([I()],Ls.prototype,"useDefaultControls",2);$r([I()],Ls.prototype,"showControllerModels",2);$r([I()],Ls.prototype,"showHandModels",2);$r([I()],Ls.prototype,"usePlacementReticle",2);$r([I(gi)],Ls.prototype,"customARPlacementReticle",2);$r([I()],Ls.prototype,"usePlacementAdjustment",2);$r([I()],Ls.prototype,"arScale",2);$r([I()],Ls.prototype,"useXRAnchor",2);$r([I()],Ls.prototype,"autoPlace",2);$r([I()],Ls.prototype,"autoCenter",2);$r([I()],Ls.prototype,"useQuicklookExport",2);$r([I()],Ls.prototype,"useDepthSensing",2);$r([I()],Ls.prototype,"useSpatialGrab",2);$r([I(gi)],Ls.prototype,"defaultAvatar",2);class OP{get extensionName(){return"Physics"}onExportObject(e,t,i){const n=$.getComponents(e,en).filter(l=>l.enabled),r=$.getComponents(e,ul).filter(l=>l.enabled&&!l.isTrigger);let o=n.length>0?n[0]:null;const a=r.length>0?r[0]:null;a&&!o&&(o=new en,o.isKinematic=!0),o&&t.addEventListener("serialize",(l,c)=>{var h,d,u;if(o){if(l.appendLine(),l.beginBlock('def RealityKitComponent "RigidBody"',"{",!0),o.useGravity||l.appendLine("bool gravityEnabled = 0"),l.appendLine('uniform token info:id = "RealityKit.RigidBody"'),o.isKinematic&&l.appendLine('token motionType = "Kinematic"'),l.beginBlock('def RealityKitStruct "massFrame"',"{",!0),l.appendLine(`float m_mass = ${o.mass}`),l.beginBlock('def RealityKitStruct "m_pose"',"{",!0),l.appendLine(`float3 position = (${o.centerOfMass.x}, ${o.centerOfMass.y}, ${o.centerOfMass.z})`),l.closeBlock("}"),l.closeBlock("}"),r.length>0){const f=r[0];l.beginBlock('def RealityKitStruct "material"',"{",!0);const m=f.sharedMaterial;m&&m.dynamicFriction!==void 0&&l.appendLine(`double dynamicFriction = ${(h=f.sharedMaterial)==null?void 0:h.dynamicFriction}`),m&&m.bounciness!==void 0&&l.appendLine(`double restitution = ${(d=f.sharedMaterial)==null?void 0:d.bounciness}`),m&&m.staticFriction!==void 0&&l.appendLine(`double staticFriction = ${(u=f.sharedMaterial)==null?void 0:u.staticFriction}`),l.closeBlock("}")}l.closeBlock("}")}}),a&&(t.addEventListener("serialize",(l,c)=>{var u;l.beginBlock('def RealityKitComponent "Collider"',"{",!0),l.appendLine("uint group = 1"),l.appendLine('uniform token info:id = "RealityKit.Collider"'),l.appendLine("uint mask = 4294967295");const d=a.isTrigger?"Trigger":"Default";if(l.appendLine(`token type = "${d}"`),l.beginBlock('def RealityKitStruct "Shape"',"{",!0),a instanceof fv){const f=a;l.appendLine('token shapeType = "Sphere"'),l.appendLine(`float radius = ${f.radius}`)}else if(a instanceof mv){const f=a;l.appendLine('token shapeType = "Box"'),l.appendLine(`float3 extent = (${f.size.x}, ${f.size.y}, ${f.size.z})`)}else if(a instanceof Ep){const f=a;l.appendLine('token shapeType = "Capsule"'),l.appendLine(`float radius = ${f.radius}`),l.appendLine(`float height = ${f.height}`)}else if(a instanceof TA&&((u=a.sharedMesh)!=null&&u.geometry)){const f=a.sharedMesh.geometry;f.boundingBox||f.computeBoundingBox();const m=a.sharedMesh.geometry.boundingBox;m&&(l.appendLine('token shapeType = "Box"'),l.appendLine(`float3 extent = (${m.max.x-m.min.x}, ${m.max.y-m.min.y}, ${m.max.z-m.min.z})`),console.log("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. MeshCollider will be exported as Box",a))}else console.warn("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. Ignoring collider:",a);l.beginBlock('def RealityKitStruct "pose"',"{",!0),l.closeBlock("}"),l.closeBlock("}"),l.closeBlock("}")}),r.length>1&&console.log("WARNING: Multiple colliders detected. visionOS / iOS can only support objects with a single collider, only exporting the first collider: ",a))}}var FVe=Object.defineProperty,VVe=Object.getOwnPropertyDescriptor,Vp=(s,e,t,i)=>{for(var n=i>1?void 0:i?VVe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&FVe(e,t,n),n};const Lg=ee("debugtext");var pr=(s=>(s[s.UpperLeft=0]="UpperLeft",s[s.UpperCenter=1]="UpperCenter",s[s.UpperRight=2]="UpperRight",s[s.MiddleLeft=3]="MiddleLeft",s[s.MiddleCenter=4]="MiddleCenter",s[s.MiddleRight=5]="MiddleRight",s[s.LowerLeft=6]="LowerLeft",s[s.LowerCenter=7]="LowerCenter",s[s.LowerRight=8]="LowerRight",s))(pr||{}),bae=(s=>(s[s.Normal=0]="Normal",s[s.Bold=1]="Bold",s[s.Italic=2]="Italic",s[s.BoldAndItalic=3]="BoldAndItalic",s))(bae||{});class aa extends RA{constructor(){super(...arguments);p(this,"alignment",0);p(this,"verticalOverflow",0);p(this,"horizontalOverflow",0);p(this,"lineSpacing",1);p(this,"supportRichText",!1);p(this,"font");p(this,"fontStyle",0);p(this,"sRGBTextColor",new ge(1,0,1));p(this,"_text","");p(this,"_fontSize",12);p(this,"_textMeshUi",null);p(this,"_didHandleTextRenderOnTop",!1)}setAlphaFactor(t){var i;super.setAlphaFactor(t),(i=this.uiObject)==null||i.set({fontOpacity:this.color.alpha*this.alphaFactor}),this.markDirty()}get text(){return this._text}set text(t){t!==this._text&&(this._text=t,this.feedText(this.text,this.supportRichText),this.markDirty())}set_text(t){this.text=t}get fontSize(){return this._fontSize}set fontSize(t){var i;this._fontSize=t,(i=this.uiObject)==null||i.set({fontSize:t})}onColorChanged(){var t;this.sRGBTextColor.copy(this.color),this.sRGBTextColor.convertLinearToSRGB(),(t=this.uiObject)==null||t.set({color:this.sRGBTextColor,fontOpacity:this.color.alpha})}onParentRectTransformChanged(){super.onParentRectTransformChanged(),this.uiObject&&this.updateOverflow()}onBeforeCanvasRender(t){this.updateOverflow()}updateOverflow(){var i;const t=(i=this.uiObject)==null?void 0:i._overflow;t&&(t._needsUpdate=!0)}onCreate(t){Lg&&console.log(this),this.horizontalOverflow==1&&(t.whiteSpace="pre"),this.verticalOverflow==0&&(this.context.renderer.localClippingEnabled=!0,t.overflow="hidden"),this.horizontalOverflow==1&&this.verticalOverflow==0,t.lineHeight=this.lineSpacing,delete t.backgroundOpacity,delete t.backgroundColor,Lg&&(t.backgroundColor=16750848,t.backgroundOpacity=.5);const i=this.rectTransform;t={...t,...this.getTextOpts()},this.getAlignment(t),Lg&&(t.backgroundColor=Math.random()*16777215,t.backgroundOpacity=.1),this.uiObject=i.createNewText(t),this.feedText(this.text,this.supportRichText)}onAfterAddedToScene(){super.onAfterAddedToScene(),this.handleTextRenderOnTop()}getTextOpts(){const t=this.fontSize,i={color:this.color,fontOpacity:this.color.alpha,fontSize:t,fontKerning:"normal"};return this.setFont(i,this.fontStyle),i}onEnable(){var t;super.onEnable(),this._didHandleTextRenderOnTop=!1,this.uiObject&&this.uiObject.addAfterUpdate(()=>{this.setShadowComponentOwner(this.uiObject),this.markDirty()}),setTimeout(()=>this.markDirty(),10),(t=this.canvas)==null||t.registerEventReceiver(this)}onDisable(){var t;super.onDisable(),(t=this.canvas)==null||t.unregisterEventReceiver(this)}getAlignment(t){switch(t.flexDirection="column",this.alignment){case 0:case 3:case 6:t.textAlign="left";break;case 1:case 4:case 7:t.textAlign="center";break;case 2:case 5:case 8:t.textAlign="right";break}switch(this.alignment){default:case 0:case 1:case 2:t.alignItems="start";break;case 3:case 4:case 5:t.alignItems="center";break;case 6:case 7:case 8:t.alignItems="end";break}return t}feedText(t,i){var n,r,o;if(Lg&&console.log("feedText",this.uiObject,t,i),!!this.uiObject)if(this._textMeshUi||(this._textMeshUi=[]),this.uiObject.children.length=0,!i||t.length===0)this.uiObject.textContent=t;else{let a=this.getNextTag(t);if(a){if(a.startIndex>0){for(let h=this.uiObject.children.length-1;h>=0;h--){const d=this.uiObject.children[h];d.isUI&&(this.uiObject.remove(d),d.clear())}const c=new _R({textContent:t.substring(0,a.startIndex),color:"inherit"});this.uiObject.add(c)}}else{this.uiObject.textContent="",this.setOptions({textContent:t});return}const l=[];for(;a;){const c=this.getNextTag(t,a.endIndex),h={fontFamily:(n=this.uiObject)==null?void 0:n.get("fontFamily"),color:"inherit",textContent:""};if(c){h.textContent=this.getText(t,a,c),this.handleTag(a,h,l);const d=new _R(h);(r=this.uiObject)==null||r.add(d)}else{h.textContent=t.substring(a.endIndex),this.handleTag(a,h,l);const d=new _R(h);(o=this.uiObject)==null||o.add(d)}a=c}}}handleTextRenderOnTop(){this._didHandleTextRenderOnTop||(this._didHandleTextRenderOnTop=!0,this.startCoroutine(this.renderOnTopCoroutine()))}*renderOnTopCoroutine(){if(!this.canvas)return;const t=[],i=this.canvas,n={renderOnTop:i.renderOnTop,depthWrite:i.depthWrite,doubleSided:i.doubleSided};for(;;){let r=!1;if(this._textMeshUi)for(let o=0;o<this._textMeshUi.length;o++){if(t[o]===!0)continue;r=!0;const a=this._textMeshUi[o];a.textContent&&(x2(a,n),t[o]=!0)}if(!r)break;yield}}handleTag(t,i,n){if(!t.isEndTag){if(t.type.includes("color")){const r=new ED(t,{color:i.color});if(n.push(r),t.type.length>6){const o=parseInt("0x"+t.type.substring(7));i.color=o}else i.color=new ge(1,1,1)}else if(t.type=="b"){this.setFont(i,1);const r=new ED(t,{fontWeight:700});n.push(r)}else if(t.type=="i"){this.setFont(i,2);const r=new ED(t,{fontStyle:"italic"});n.push(r)}}}getText(t,i,n){return t.substring(i.endIndex,n.startIndex)}getNextTag(t,i=0){const n=t.indexOf("<",i),r=t.indexOf(">",n);if(n>=0&&r>=0){const o=t.substring(n+1,r);return{type:o,startIndex:n,endIndex:r+1,isEndTag:o.startsWith("/")}}return null}setFont(t,i){if(!this.font)return;const n=this.font,r=this.getFamilyNameWithCorrectSuffix(n,i);Lg&&console.log("Selected font family:"+r);let o=CV.getFontFamily(r);switch(o||(o=CV.addFontFamily(r)),t.fontFamily=o,i){default:case 0:t.fontWeight=400,t.fontStyle="normal";break;case 1:t.fontWeight=700,t.fontStyle="normal";break;case 2:t.fontWeight=400,t.fontStyle="italic";break;case 3:t.fontStyle="italic",t.fontWeight=400}let a=o.getVariant(t.fontWeight,t.fontStyle);if(!a){let l=r;l!=null&&l.endsWith("-msdf.json")||(l+="-msdf.json");let c=r;c!=null&&c.endsWith(".png")||(c+=".png"),a=o.addVariant(t.fontWeight,t.fontStyle,l,c),a==null||a.addEventListener("ready",()=>{this.markDirty()})}}getFamilyNameWithCorrectSuffix(t,i){var h;const n=t.lastIndexOf("-");if(n<0)return t;const r=(h=t.substring(n+1))==null?void 0:h.toLowerCase();if(zVe.includes(r))return Lg&&console.warn("Unsupported font style: "+r),t;const o=t.lastIndexOf("/");let a=t;o>=0&&(a=a.substring(o+1));const l=a[0]===a[0].toUpperCase(),c=t.substring(0,n);switch(Lg&&console.log("Select font: ",t,bae[i],a,l,c),i){case 0:return l?c+"-Regular":c+"-regular";case 1:return l?c+"-Bold":c+"-bold";case 2:return l?c+"-Italic":c+"-italic";case 3:return l?c+"-BoldItalic":c+"-bolditalic";default:return t}}}Vp([I()],aa.prototype,"alignment",2);Vp([I()],aa.prototype,"verticalOverflow",2);Vp([I()],aa.prototype,"horizontalOverflow",2);Vp([I()],aa.prototype,"lineSpacing",2);Vp([I()],aa.prototype,"supportRichText",2);Vp([I(URL)],aa.prototype,"font",2);Vp([I()],aa.prototype,"fontStyle",2);Vp([I()],aa.prototype,"text",1);Vp([I()],aa.prototype,"fontSize",1);class ED{constructor(e,t){p(this,"tag");p(this,"previousValues");this.tag=e,this.previousValues=t}}const zVe=["medium","mediumitalic","black","blackitalic","thin","thinitalic","extrabold","light","lightitalic","semibold"];class Ff{constructor(e){p(this,"id");p(this,"content","");p(this,"font",[]);p(this,"pointSize",144);p(this,"width");p(this,"height");p(this,"depth");p(this,"wrapMode");p(this,"horizontalAlignment");p(this,"verticalAlignment");p(this,"material");this.id=e}static getId(){return this.global_id++}setDepth(e){return this.depth=e,this}setPointSize(e){return this.pointSize=e,this}setHorizontalAlignment(e){return this.horizontalAlignment=e,this}setVerticalAlignment(e){return this.verticalAlignment=e,this}writeTo(e,t){var n;t.beginBlock(`def Preliminary_Text "${this.id}"`,"(",!1),t.appendLine('prepend apiSchemas = ["MaterialBindingAPI"]'),t.closeBlock(")"),t.beginBlock(),this.content&&t.appendLine(`string content = "${this.content}"`),(!this.font||this.font.length<=0)&&(this.font||(this.font=[]),(n=this.font)==null||n.push("sans-serif"));const i=this.font.map(r=>`"${r}"`).join(", ");t.appendLine(`string[] font = [ ${i} ]`),t.appendLine(`double pointSize = ${this.pointSize}`),typeof this.width=="number"&&t.appendLine(`double width = ${this.width}`),typeof this.height=="number"&&t.appendLine(`double height = ${this.height}`),typeof this.depth=="number"&&t.appendLine(`double depth = ${this.depth}`),this.wrapMode&&t.appendLine(`token wrapMode = "${this.wrapMode}"`),this.horizontalAlignment&&t.appendLine(`token horizontalAlignment = "${this.horizontalAlignment}"`),this.verticalAlignment&&t.appendLine(`token verticalAlignment = "${this.verticalAlignment}"`),this.material!==void 0&&t.appendLine(`rel material:binding = </StageRoot/Materials/${C5(this.material)}>`),t.closeBlock()}}p(Ff,"global_id",0);class ZP{static singleLine(e,t,i){const n=new Ff("text_"+Ff.getId());return n.content=e,t&&(n.pointSize=t),i&&(n.depth=i),n}static multiLine(e,t,i,n,r,o){const a=new Ff("text_"+Ff.getId());return a.content=e,a.width=t,a.height=i,a.horizontalAlignment=n,a.verticalAlignment=r,o!==void 0&&(a.wrapMode=o),a}}const UVe=new ce().makeRotationY(Math.PI),XVe=new ce().makeScale(-1,1,-1);class GM{get extensionName(){return"text"}exportText(e,t,i){const n=$.getComponent(e,aa);if(!n)return;const r=$.getComponent(e,oa);let o=100,a=100;r&&(o=r.width,a=r.height);const l=UVe.clone();r&&l.premultiply(XVe),t.setMatrix(l);const c=n.color.clone();t.material=new Us({color:c,emissive:c}),t.addEventListener("serialize",(h,d)=>{let u=n.text;u=u.replace(/\r/g,""),u=u.replace(/\n/g,"\\n");const f=ZP.multiLine(u,o,a,"center","bottom","flowing");this.setTextAlignment(f,n.alignment),this.setOverflow(f,n),t.material&&(f.material=t.material),f.pointSize=this.convertToTextSize(n.fontSize),f.depth=.001,f.writeTo(void 0,h)})}convertToTextSize(e){return 1/.0502*144*e}setOverflow(e,t){t.horizontalOverflow?e.wrapMode="singleLine":e.wrapMode="flowing"}setTextAlignment(e,t){switch(t){case pr.LowerLeft:case pr.MiddleLeft:case pr.UpperLeft:e.horizontalAlignment="left";break;case pr.LowerCenter:case pr.MiddleCenter:case pr.UpperCenter:e.horizontalAlignment="center";break;case pr.LowerRight:case pr.MiddleRight:case pr.UpperRight:e.horizontalAlignment="right";break}switch(t){case pr.LowerLeft:case pr.LowerCenter:case pr.LowerRight:e.verticalAlignment="bottom";break;case pr.MiddleLeft:case pr.MiddleCenter:case pr.MiddleRight:e.verticalAlignment="middle";break;case pr.UpperLeft:case pr.UpperCenter:case pr.UpperRight:e.verticalAlignment="top";break}}}class WP{get extensionName(){return"tmui"}onExportObject(e,t,i){const n=$.getComponent(e,Lo);if(n&&n.enabled&&n.renderMode===iae.WorldSpace){const r=new GM,o=$.getComponent(e,oa),a=$.getComponent(e,xm),l=new Array;if(o){if(!$.isActiveSelf(e)){const d=$.isActiveSelf(e);$.setActive(e,!0),o.onEnable(),o.updateTransform(),l.push(()=>{o.onDisable(),$.setActive(e,d)})}e.traverse(d=>{if(!$.isActiveInHierarchy(d)){const u=$.isActiveSelf(d);$.setActive(d,!0);const f=$.getComponent(d,Xc);f&&(f.onEnable(),l.push(()=>{f.onDisable()}));const m=$.getComponent(d,oa);m&&(m.onEnable(),m.updateTransform(),m.onApplyTransform(),l.push(()=>{m.onDisable()}));const g=$.getComponent(d,aa);g&&(g.onEnable(),l.push(()=>{g.onDisable()})),l.push(()=>{$.setActive(d,u)})}}),o.width,o.height;const c=Co.createEmpty(),h=o.shadowComponent;if(t.add(c),h){const d=h.matrix;c.setMatrix(d);const u=new Map,f=new Map;u.set(h,c),f.set(h,a?a.alpha:1),h.traverse(m=>{if(m===h)return;const g=Co.createEmpty();g.setMatrix(m.matrix);const A=m.parent,y=!!A&&typeof A.textContent=="string"&&A.textContent.length>0;let b=f.get(A)||1;const x=$.getComponent(m,xm);if(x&&(b*=x.alpha),m instanceof fe&&y){const _=m[Bc];_?r.exportText(_.gameObject,g,i):console.error("Error when exporting UI: shadow component owner not found. This is likely a bug.",m)}if(m instanceof fe&&!y){const _=m.geometry.clone();_.scale(1,1,-1),this.flipWindingOrder(_),g.geometry=_;const C=new ge,S=m.material.opacity;C.copy(m.material.color),g.material=new ii({color:C,opacity:S*b,map:m.material.map,transparent:!0})}u.set(m,g),f.set(m,b);const v=u.get(A);if(!v){console.error("Error when exporting UI: shadow component parent not found!",m,m.parent);return}v.add(g)})}}for(const c of l)c()}}flipWindingOrder(e){const t=e.index.array;for(let i=0,n=t.length/3;i<n;i++){const r=t[i*3];t[i*3]=t[i*3+2],t[i*3+2]=r}e.index.needsUpdate=!0}}const TC=ee("debugusdz");function OVe(s,e){var a;const t=[],i=$.getComponentsInChildren(s,Ro),n=$.getComponentsInChildren(s,na),r=new Array,o=new Array;if(e.injectImplicitBehaviours)for(const l of i){if(!l||!l.runtimeAnimatorController||!l.enabled)continue;const c=l.runtimeAnimatorController.activeState;if(!c||!c.motion||!c.motion.clip||((a=c.motion.clip.tracks)==null?void 0:a.length)<1||r.includes(l))continue;const h=new iA;h.animator=l,h.stateName=c.name,h.trigger="start",h.name="PlayAnimationOnClick_implicitAtStart_"+h.stateName;const d=new ye;$.addComponent(d,h),o.push(d),r.push(l),s.add(d)}else for(const l of i){if(!l||!l.runtimeAnimatorController||!l.enabled)continue;TC&&console.log(l);const c=[];for(const h of l.runtimeAnimatorController.enumerateActions()){TC&&console.log(h);const d=h.getClip();c.includes(d)||c.push(d)}t.push({root:l.gameObject,clips:c})}if(e.injectImplicitBehaviours)for(const l of n){if(!l||!l.clip||!l.enabled||!l.playAutomatically||r.includes(l))continue;const c=new iA;c.animation=l,c.stateName=l.clip.name,c.trigger="start",c.name="PlayAnimationOnClick_implicitAtStart_"+c.stateName;const h=new ye;$.addComponent(h,c),o.push(h),r.push(l),s.add(h)}else for(const l of n){TC&&console.log(l);const c=[];for(const h of l.animations)c.includes(h)||c.push(h);t.push({root:l.gameObject,clips:c})}TC&&(t==null?void 0:t.length)>0&&console.log("USDZ Animation Clips without behaviours",t);for(const l of t)for(const c of l.clips)e.registerAnimation(l.root,c);return o}function ZVe(s,e){const t=$.getComponentsInChildren(s,fs),i=$.getComponentsInChildren(s,vm),n=new Array,r=new Array;TC&&console.log({audioSources:t,playAudioOnClicks:i});for(const o of i){if(!o.target)continue;const a=t.indexOf(o.target);a>-1&&t.splice(a,1)}for(const o of t){if(!o||!o.clip||o.volume<=0||n.includes(o))continue;const a=new vm;a.target=o,a.name="PlayAudioOnClick_implicitAtStart_",a.trigger="start";const l=new ye;$.addComponent(l,a),console.log("implicit PlayAudioOnStart",l,a),r.push(l),n.push(o),s.add(l)}return r}function WVe(s){return new er("DisableAtStart",Or.sceneStartTrigger(),zi.fadeAction(s,0,!1))}function PY(s,e){const t=s.domElement.shadowRoot.querySelector("link[rel='ar']");if(t)return t;const i=document.createElement("div");i.classList.add("menu"),i.classList.add("quicklook-menu"),i.style.display="none",i.style.visibility="hidden";const n=document.createElement("button");n.id="open-in-ar",e?(n.innerText="View in AR",n.title="View this scene in AR. The scene will be exported to USDZ and opened with Apple's QuickLook."):(n.innerText="View in AR",n.title="Download this scene for AR. Open the downloaded USDZ file to view it in AR using Apple's QuickLook."),i.appendChild(n);const r=document.createElement("a");r.id="needle-usdz-link",r.style.display="none",r.rel="ar",r.href="",r.target="_blank",i.appendChild(r);const o=document.createElement("img");return o.id="button",r.appendChild(o),s.domElement.shadowRoot.appendChild(i),r}var HVe=Object.defineProperty,QVe=Object.getOwnPropertyDescriptor,Fo=(s,e,t,i)=>{for(var n=i>1?void 0:i?QVe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&HVe(e,t,n),n};const vl=ee("debugusdz"),KVe=ee("debugusdzpruning");class qm{constructor(){p(this,"callToAction");p(this,"checkoutTitle");p(this,"checkoutSubtitle");p(this,"callToActionURL")}}Fo([I()],qm.prototype,"callToAction",2);Fo([I()],qm.prototype,"checkoutTitle",2);Fo([I()],qm.prototype,"checkoutSubtitle",2);Fo([I()],qm.prototype,"callToActionURL",2);var cR;const Vz=(cR=class extends ze{constructor(){super(...arguments);p(this,"objectToExport");p(this,"autoExportAnimations",!0);p(this,"autoExportAudioSources",!0);p(this,"exportFileName");p(this,"customUsdzFile");p(this,"customBranding");p(this,"anchoringType","plane");p(this,"maxTextureSize",2048);p(this,"planeAnchoringAlignment","horizontal");p(this,"interactive",!0);p(this,"physics",!0);p(this,"allowCreateQuicklookButton",!0);p(this,"quickLookCompatible",!0);p(this,"extensions",[]);p(this,"link");p(this,"button");p(this,"onClickedOpenInARElement",e=>{e.preventDefault(),this.exportAndOpen()});p(this,"_currentExportTasks",new Map);p(this,"_previousTimeScale",1);p(this,"lastCallback");p(this,"_rootSessionRootWasAppliedTo",null);p(this,"_rootPositionBeforeExport",new T);p(this,"_rootRotationBeforeExport",new Ve);p(this,"_rootScaleBeforeExport",new T)}start(){var e,t,i;vl&&(console.log("USDZExporter",this),console.log("Debug USDZ Mode. Press 'T' to export"),window.addEventListener("keydown",n=>{switch(n.key){case"t":this.exportAndOpen();break}})),this.objectToExport||(this.objectToExport=this.gameObject),!((t=(e=this.objectToExport)==null?void 0:e.children)!=null&&t.length)&&!((i=this.objectToExport)!=null&&i.isMesh)&&(this.objectToExport=this.context.scene)}onEnable(){var i;const e=exports.DeviceUtilities.supportsQuickLookAR(),t=exports.DeviceUtilities.isiOS()||exports.DeviceUtilities.isiPad();!this.button&&(vl||e||t)&&(this.allowCreateQuicklookButton&&(this.button=this.createQuicklookButton()),this.lastCallback=this.quicklookCallback.bind(this),this.link=PY(this.context,e),this.link.addEventListener("message",this.lastCallback)),vl&&is("USDZ Exporter enabled: "+this.name),(i=document.getElementById("open-in-ar"))==null||i.addEventListener("click",this.onClickedOpenInARElement),fS.registerExporter(this)}onDisable(){var e,t,i;(e=this.button)==null||e.remove(),(t=this.link)==null||t.removeEventListener("message",this.lastCallback),vl&&is("USDZ Exporter disabled: "+this.name),(i=document.getElementById("open-in-ar"))==null||i.removeEventListener("click",this.onClickedOpenInARElement),fS.unregisterExporter(this)}async exportAsync(){return this.exportAndOpen()}async exportAndOpen(){var i;let e=this.exportFileName??((i=this.objectToExport)==null?void 0:i.name)??this.name;if(e+="-"+poe(),Yf()||(e!==""&&(e+="-"),e+="MadeWithNeedle"),this.link||(this.link=PY(this.context,exports.DeviceUtilities.supportsQuickLookAR())),this.customUsdzFile)return vl&&console.log("Exporting custom usdz",this.customUsdzFile),this.openInQuickLook(this.customUsdzFile,e),null;if(!this.objectToExport)return console.warn("No object to export",this),null;const t=await this.export(this.objectToExport);return t?(vl&&console.log("USDZ generation done. Downloading as "+e),this.openInQuickLook(t,e),t):(console.error("USDZ generation failed. Please report a bug",this),null)}async export(e){if(!e)return console.warn("No object to export"),null;const t=this._currentExportTasks.get(e);if(t)return t;const i=this.internalExport(e);return i instanceof Promise?(this._currentExportTasks.set(e,i),i.then(n=>(this._currentExportTasks.delete(e),n)).catch(n=>(this._currentExportTasks.delete(e),console.error("Error during USDZ export – please report a bug!",n),null))):i}async internalExport(e){Ci.start("export-usdz",{onProgress:_=>{this.dispatchEvent(new CustomEvent("export-progress",{detail:{progress:_}}))}}),Ci.report("export-usdz",{message:"Starting export",totalSteps:40,currentStep:0}),Ci.report("export-usdz",{message:"Load progressive textures",autoStep:5}),Ci.start("export-usdz-textures","export-usdz");const t=$.getComponentsInChildren(e,pl);for(const _ of t)_&&_.enabled&&_.updateSprite(!0);const i=$.getComponentsInChildren(e,Es),n=new Array;let r=0;for(const _ of i){for(const C of _.sharedMeshes)if(C){const S=Ni.assignMeshLOD(C,0);S instanceof Promise&&n.push(new Promise((M,L)=>{S.then(()=>{r++,Ci.report("export-usdz-textures",{message:"Loaded progressive mesh",currentStep:r,totalSteps:n.length}),M()}).catch(w=>L(w))}))}for(const C of _.sharedMaterials)if(C){const S=Ni.assignTextureLOD(C,0);S instanceof Promise&&n.push(new Promise((M,L)=>{S.then(()=>{r++,Ci.report("export-usdz-textures",{message:"Loaded progressive texture",currentStep:r,totalSteps:n.length}),M()}).catch(w=>L(w))}))}}vl&&is("Progressive Loading: "+n.length),await Promise.all(n),vl&&is("Progressive Loading: done"),Ci.end("export-usdz-textures");const o=xo.Global.Mask;xo.Global.Set(wd.AR);const a=new yoe,l=new gM(this.quickLookCompatible);let c;const h=[];this.interactive&&(h.push(new NP),h.push(new Xm),globalThis.false&&$.getComponentsInChildren(e,en).length>0&&(this.physics?(c=new OP,h.push(c)):Qe()&&console.warn("USDZExporter: Physics export is disabled, but there are active Rigidbody components in the scene. They will not be exported.")),h.push(new GM),h.push(new WP));const d=[l,...h,...this.extensions],u={self:this,exporter:a,extensions:d,object:e};Ci.report("export-usdz","Invoking before-export"),this.dispatchEvent(new CustomEvent("before-export",{detail:u})),this.applyWebARSessionRoot(),this._previousTimeScale=this.context.time.timeScale,this.context.time.timeScale=0,Ci.report("export-usdz","auto export animations and audio sources");const f=new Array;this.autoExportAnimations&&f.push(...OVe(e,l)),this.extensions.find(_=>_.extensionName==="Audio")&&this.autoExportAudioSources&&f.push(...ZVe(e)),a.debug=vl,a.pruneUnusedNodes=!KVe;const g=tm.instance.objs.map(_=>_.batchedMesh);a.keepObject=_=>{let C=!0;const S=$.getComponent(_,Es);return S&&!S.enabled&&(C=!1),C&&g.includes(_)&&(C=!1),C&&$.getComponentInParent(_,Hh)&&(C=!1),C&&$.getComponentInParent(_,ou)&&(C=!1),vl&&!C&&console.log("USDZExporter: Discarding object",_),C},a.beforeWritingDocument=()=>{if(Qe()&&l&&c){const _=l.animatedRoots;for(const C of _){const S=$.getComponentsInChildren(C,en).filter(L=>L.enabled),M=$.getComponents(C,ul).filter(L=>L.enabled&&!L.isTrigger);(S.length>0||M.length>0)&&console.error("An animated object has physics components in its child hierarchy. This can lead to undefined behaviour due to a bug in Apple's QuickLook (FB15925487). Remove the physics components from child objects or verify that you get the expected results.",C)}}};const A=new Array;this.objectToExport&&this.quickLookCompatible&&this.interactive&&this.objectToExport.traverse(_=>{_.visible||A.push(_)});const y=this.extensions.find(_=>_.extensionName==="Behaviour");this.interactive&&y&&A.length>0&&y.addBehavior(WVe(A));let b=!0;this.quickLookCompatible&&!this.interactive&&(b=!1),this.anchoringType!=="plane"&&this.anchoringType!=="none"&&this.anchoringType!=="image"&&this.anchoringType!=="face"&&(this.anchoringType="plane"),this.planeAnchoringAlignment!=="horizontal"&&this.planeAnchoringAlignment!=="vertical"&&this.planeAnchoringAlignment!=="any"&&(this.planeAnchoringAlignment="horizontal"),Ci.report("export-usdz","Invoking exporter.parse");const x=await a.parse(this.objectToExport,{ar:{anchoring:{type:this.anchoringType},planeAnchoring:{alignment:this.planeAnchoringAlignment}},extensions:d,quickLookCompatible:this.quickLookCompatible,maxTextureSize:this.maxTextureSize,exportInvisible:b}),v=new Blob([x],{type:"model/vnd.usdz+zip"});this.revertWebARSessionRoot(),this.context.time.timeScale=this._previousTimeScale,Ci.report("export-usdz","Invoking after-export"),this.dispatchEvent(new CustomEvent("after-export",{detail:u}));for(const _ of f)$.destroy(_);return xo.Global.Set(o),Ci.end("export-usdz"),v}openInQuickLook(e,t){const i=e instanceof Blob?URL.createObjectURL(e):e,n=this.buildQuicklookOverlay();vl&&console.log("QuickLook Overlay",n);const r=n.callToAction?encodeURIComponent(n.callToAction):"",o=n.checkoutTitle?encodeURIComponent(n.checkoutTitle):"",a=n.checkoutSubtitle?encodeURIComponent(n.checkoutSubtitle):"";this.link.href=i+`#callToAction=${r}&checkoutTitle=${o}&checkoutSubtitle=${a}&callToActionURL=${n.callToActionURL}`,this.lastCallback||(this.lastCallback=this.quicklookCallback.bind(this),this.link.addEventListener("message",this.lastCallback)),this.link.download=t+".usdz",this.link.click()}download(e,t){Vz.save(e,t)}static save(e,t){const i=document.createElement("a");i.style.display="none",document.body.appendChild(i),typeof e=="string"?i.href=e:i.href=URL.createObjectURL(e),i.download=t,i.click(),i.remove()}quicklookCallback(e){if((e==null?void 0:e.data)=="_apple_ar_quicklook_button_tapped"){vl&&An("Quicklook closed via call to action button");var t=new CustomEvent("quicklook-button-tapped",{detail:this});if(this.dispatchEvent(t),!t.defaultPrevented){const i=new URLSearchParams(this.link.href);if(i){const n=i.get("callToActionURL");vl&&is("Quicklook url: "+n),n&&(Yf()?globalThis.open(n,"_blank"):console.warn("Quicklook closed: custom redirects require a Needle Engine Pro license: https://needle.tools/pricing",n))}}}}buildQuicklookOverlay(){var i,n,r,o,a,l;const e={};return this.customBranding&&Object.assign(e,this.customBranding),Yf()||(console.log("Custom Quicklook banner text requires pro license: https://needle.tools/pricing"),e.callToAction="Close",e.checkoutTitle="🌵 Made with Needle",e.checkoutSubtitle="_"),(((i=e.callToAction)==null?void 0:i.length)||((n=e.checkoutTitle)==null?void 0:n.length)||((r=e.checkoutSubtitle)==null?void 0:r.length))&&((o=e.callToAction)!=null&&o.length||(e.callToAction="\0"),(a=e.checkoutTitle)!=null&&a.length||(e.checkoutTitle="\0"),(l=e.checkoutSubtitle)!=null&&l.length||(e.checkoutSubtitle="\0")),this.dispatchEvent(new CustomEvent("quicklook-overlay",{detail:e})),e}getARScaleAndTarget(){if(!this.objectToExport)return{scale:1,_invertForward:!1,target:this.gameObject,sessionRoot:null};const e=$.findObjectOfType(Ls);let t=$.getComponentInParent(this.objectToExport,Rp);t||(t=$.getComponentInChildren(this.objectToExport,Rp));let i=1,n=!1;const r=this.objectToExport;return e?i=e.arScale:t&&(i=t.arScale,n=t.invertForward),{scale:1/i,_invertForward:n,target:r,sessionRoot:(t==null?void 0:t.gameObject)??null}}applyWebARSessionRoot(){if(!this.objectToExport)return;const{scale:e,_invertForward:t,target:i,sessionRoot:n}=this.getARScaleAndTarget(),r=n==null?void 0:n.matrixWorld.clone().invert();this._rootSessionRootWasAppliedTo=i,this._rootPositionBeforeExport.copy(i.position),this._rootRotationBeforeExport.copy(i.quaternion),this._rootScaleBeforeExport.copy(i.scale),i.scale.multiplyScalar(e),t&&i.quaternion.multiply(Vz.invertForwardQuaternion),i.updateMatrix(),i.updateMatrixWorld(!0),n&&r&&i.matrix.premultiply(r)}revertWebARSessionRoot(){if(!this.objectToExport||!this._rootSessionRootWasAppliedTo)return;const e=this._rootSessionRootWasAppliedTo;e.position.copy(this._rootPositionBeforeExport),e.quaternion.copy(this._rootRotationBeforeExport),e.scale.copy(this._rootScaleBeforeExport),e.updateMatrix(),e.updateMatrixWorld(!0),this._rootSessionRootWasAppliedTo=null}createQuicklookButton(){const t=vp.getOrCreate().createQuicklookButton();return t.parentNode||this.context.menu.appendChild(t),t}},p(cR,"invertForwardMatrix",new ce().makeRotationY(Math.PI)),p(cR,"invertForwardQuaternion",new Ve().setFromEuler(new Xi(0,Math.PI,0))),cR);let ds=Vz;Fo([I(ye)],ds.prototype,"objectToExport",2);Fo([I()],ds.prototype,"autoExportAnimations",2);Fo([I()],ds.prototype,"autoExportAudioSources",2);Fo([I()],ds.prototype,"exportFileName",2);Fo([I(URL)],ds.prototype,"customUsdzFile",2);Fo([I(qm)],ds.prototype,"customBranding",2);Fo([I()],ds.prototype,"anchoringType",2);Fo([I()],ds.prototype,"maxTextureSize",2);Fo([I()],ds.prototype,"planeAnchoringAlignment",2);Fo([I()],ds.prototype,"interactive",2);Fo([I()],ds.prototype,"physics",2);Fo([I()],ds.prototype,"allowCreateQuicklookButton",2);Fo([I()],ds.prototype,"quickLookCompatible",2);class kM extends ze{constructor(){super(...arguments);p(this,"isUsed",!0);p(this,"usedBy",null)}}class rZ extends ze{}const GY=ee("debugdeletable"),ww=class extends il{onEnable(){ww._instances.push(this)}onDisable(){const e=ww._instances.indexOf(this);e>=0&&ww._instances.splice(e,1)}};let F0=ww;p(F0,"_instances",[]);class oZ extends ze{update(){for(const e of F0._instances){const t=this.gameObject;if(e.isInBox(t)===!0){const n=$.getComponentInParent(this.gameObject,kM);if(n)GY&&console.warn("DeleteBox: Not deleting object with usage marker",this.guid,n);else{if(GY)try{if(e.box){const r=e.box,o=il.testBox;Mt.DrawWireBox3(r,16711680,5),Mt.DrawWireBox3(o,255,5),console.log("DeleteBox: Destroying",this.gameObject,{deleteBoxArea:r,deletedObjectArea:o})}else console.log("DeleteBox: Destroying",this.gameObject)}catch{}cM(this.gameObject,this.context.connection)}}}}}var YVe=Object.defineProperty,JVe=Object.getOwnPropertyDescriptor,kA=(s,e,t,i)=>{for(var n=i>1?void 0:i?JVe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&YVe(e,t,n),n};const jVe=ee("debugpost");class Qh extends jr{constructor(){super(...arguments);p(this,"mode");p(this,"focusDistance",new rt(1));p(this,"focalLength",new rt(.2));p(this,"aperture",new rt(20));p(this,"gaussianMaxRadius",new rt);p(this,"resolutionScale",new rt(1*1/window.devicePixelRatio));p(this,"bokehScale",new rt)}get typeName(){return"DepthOfField"}init(){this.focalLength.valueProcessor=i=>{const n=i/300,r=2;return lt.lerp(r,.01,n)};const t=20;this.aperture.valueProcessor=i=>{const n=1-i/32;return lt.lerp(1,t,n)}}onCreateEffect(){if(this.mode===0){jVe&&console.warn("DepthOfField: Mode is set to Off");return}const t=new Hie(this.context.mainCamera,{worldFocusRange:.2,focalLength:1,bokehScale:20,resolutionScale:this.resolutionScale.value});return this.focusDistance.onValueChanged=i=>{t.cocMaterial.worldFocusDistance=i},this.focalLength.onValueChanged=i=>t.cocMaterial.worldFocusRange=i,this.aperture.onValueChanged=i=>t.bokehScale=i,this.resolutionScale&&(this.resolutionScale.onValueChanged=i=>t.resolution.scale=i),[t]}unapply(){}}kA([I()],Qh.prototype,"mode",2);kA([I(rt)],Qh.prototype,"focusDistance",2);kA([I(rt)],Qh.prototype,"focalLength",2);kA([I(rt)],Qh.prototype,"aperture",2);kA([I(rt)],Qh.prototype,"gaussianMaxRadius",2);kA([I(rt)],Qh.prototype,"resolutionScale",2);kA([I(rt)],Qh.prototype,"bokehScale",2);Kc("DepthOfField",Qh);var qVe=Object.defineProperty,$Ve=Object.getOwnPropertyDescriptor,eze=(s,e,t,i)=>{for(var n=i>1?void 0:i?$Ve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&qVe(e,t,n),n};class HP extends ze{constructor(){super(...arguments);p(this,"visibleOn")}onEnable(){this.apply()}apply(){this.test()||$.setActive(this.gameObject,!1)}test(){return this.visibleOn<0?!0:exports.DeviceUtilities.isMobileDevice()?(this.visibleOn&2)!==0:(this.visibleOn&1)!==0}}eze([I()],HP.prototype,"visibleOn",2);class aZ{get extensionName(){return"DocumentExtension"}onAfterBuildDocument(e){}}var tze=Object.defineProperty,ize=Object.getOwnPropertyDescriptor,NA=(s,e,t,i)=>{for(var n=i>1?void 0:i?ize(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&tze(e,t,n),n};const Gd=ee("debugdrag"),RD=[];var lZ=(s=>(s[s.XZPlane=0]="XZPlane",s[s.Attached=1]="Attached",s[s.HitNormal=2]="HitNormal",s[s.DynamicViewAngle=3]="DynamicViewAngle",s[s.SnapToSurfaces=4]="SnapToSurfaces",s[s.None=5]="None",s))(lZ||{}),nC;const yc=(nC=class extends ze{constructor(){super(...arguments);p(this,"dragMode",3);p(this,"snapGridResolution",0);p(this,"keepRotation",!0);p(this,"xrDragMode",1);p(this,"xrKeepRotation",!1);p(this,"xrDistanceDragFactor",1);p(this,"showGizmo",!1);p(this,"_rigidbody",null);p(this,"_targetObject",null);p(this,"_dragHelper",null);p(this,"_draggingRigidbodies",[]);p(this,"_potentialDragStartEvt",null);p(this,"_dragHandlers",new Map);p(this,"_totalMovement",new T);p(this,"_marker",null);p(this,"_isDragging",!1);p(this,"_didDrag",!1)}static get HasAnySelected(){return this._active>0}static get CurrentlySelected(){RD.length=0;for(const e of this._instances)e._isDragging&&RD.push(e);return RD}get draggedObject(){return this._targetObject}setTargetObject(e){var i,n;this._targetObject=e;for(const r of this._dragHandlers.values())r.setTargetObject(e);const t="_rigidbody-was-kinematic";((i=this._rigidbody)==null?void 0:i[t])===!1&&(this._rigidbody.isKinematic=!1,this._rigidbody[t]=void 0),this._rigidbody=null,e&&(this._rigidbody=$.getComponentInChildren(e,en),((n=this._rigidbody)==null?void 0:n.isKinematic)===!1&&(this._rigidbody.isKinematic=!0,this._rigidbody[t]=!1))}awake(){this._potentialDragStartEvt=null,this._dragHandlers=new Map,this._totalMovement=new T,this._marker=null,this._isDragging=!1,this._didDrag=!1,this._dragHelper=null,this._draggingRigidbodies=[]}start(){this.gameObject.getComponentInParent(nc)||this.gameObject.addComponent(nc)}onEnable(){yc._instances.push(this)}onDisable(){yc._instances=yc._instances.filter(e=>e!==this)}allowEdit(e=null){return this.context.connection.allowEditing}onPointerEnter(e){if(!this.allowEdit(this.gameObject)||e.mode!=="screen"||(e.event.mode==="tracked-pointer"||e.event.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===5)return;const n=$.getComponentInParent(e.object,yc);!n||n!==this||(yc.lastHovered=e.object,this.context.domElement.style.cursor="pointer")}onPointerMove(e){(this._isDragging||this._potentialDragStartEvt!==null)&&e.use()}onPointerExit(e){this.allowEdit(this.gameObject)&&e.mode==="screen"&&yc.lastHovered===e.object&&(this.context.domElement.style.cursor="auto")}onPointerDown(e){if(!(!this.allowEdit(this.gameObject)||e.used||(e.mode==="tracked-pointer"||e.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===5)&&(yc.lastHovered=e.object,e.button===0)){this._dragHandlers.size===0&&(this._didDrag=!1,this._totalMovement.set(0,0,0),this._potentialDragStartEvt=e),this._targetObject||this.setTargetObject(this.gameObject),yc._active+=1;const n=new sze(this,this._targetObject);if(this._dragHandlers.set(e.event.space,n),n.onDragStart(e),this._dragHandlers.size===2){const r=this._dragHandlers.values(),o=r.next().value,a=r.next().value,l=new nze(this,this._targetObject,o,a);this._dragHandlers.set(this.gameObject,l),l.onDragStart(e)}e.use()}}onPointerUp(e){if(Gd&&Mt.DrawLabel(e.point??this.gameObject.worldPosition,"POINTERUP:"+e.pointerId+", "+e.button,.03,3),!this.allowEdit(this.gameObject)||e.button!==0)return;this._potentialDragStartEvt=null;const t=this._dragHandlers.get(e.event.space),i=this._dragHandlers.get(this.gameObject);i&&(i.handlerA===t||i.handlerB===t)&&(this._dragHandlers.delete(this.gameObject),i.onDragEnd(e)),t&&(yc._active>0&&(yc._active-=1),this.setTargetObject(null),t.onDragEnd&&t.onDragEnd(e),this._dragHandlers.delete(e.event.space),this._dragHandlers.size===0&&this.onLastDragEnd(e),e.use())}update(){for(const e of this._dragHandlers.values())e.collectMovementInfo&&e.collectMovementInfo(),e.getTotalMovement&&this._totalMovement.add(e.getTotalMovement());if(this._potentialDragStartEvt){if(!this._didDrag)if(this._totalMovement.length()>3e-4)this._didDrag=!0;else return;const e=this._potentialDragStartEvt;this._potentialDragStartEvt=null,this.onFirstDragStart(e)}for(const e of this._dragHandlers.values())e.onDragUpdate&&e.onDragUpdate(this._dragHandlers.size);this._dragHelper&&this._dragHelper.hasSelected&&this.onAnyDragUpdate()}onFirstDragStart(e){if(!e||!e.object)return;const t=$.getComponentInParent(e.object,yc);if(!t||t!==this&&t._isDragging)return;const i=this._targetObject||this.gameObject;if(!i)return;this._isDragging=!0;const n=$.getComponentInChildren(i,$d);Gd&&console.log("DRAG START",n,i),n&&(n.fastMode=!0,n==null||n.requestOwnership()),this._marker=$.addComponent(i,kM),this._draggingRigidbodies.length=0;const r=$.getComponentsInChildren(i,en);r&&this._draggingRigidbodies.push(...r)}onAnyDragUpdate(){if(!this._dragHelper)return;this._dragHelper.showGizmo=this.showGizmo,this._dragHelper.onUpdate(this.context);for(const t of this._draggingRigidbodies)t.wakeUp(),t.resetVelocities(),t.resetForcesAndTorques();const e=this._targetObject||this.gameObject;Vc.markDirty(e)}onLastDragEnd(e){if(!this||!this._isDragging)return;this._isDragging=!1;for(const i of this._draggingRigidbodies)i.setVelocity(i.smoothedVelocity);if(this._draggingRigidbodies.length=0,this._targetObject=null,e!=null&&e.object){const i=$.getComponentInChildren(e.object,$d);i&&(i.fastMode=!1)}if(this._marker&&this._marker.destroy(),!this._dragHelper)return;const t=this._dragHelper.selected;Gd&&console.log("DRAG END",t,t==null?void 0:t.visible),this._dragHelper.setSelected(null,this.context)}},p(nC,"_active",0),p(nC,"_instances",[]),p(nC,"lastHovered"),nC);let sl=yc;NA([I()],sl.prototype,"dragMode",2);NA([I()],sl.prototype,"snapGridResolution",2);NA([I()],sl.prototype,"keepRotation",2);NA([I()],sl.prototype,"xrDragMode",2);NA([I()],sl.prototype,"xrKeepRotation",2);NA([I()],sl.prototype,"xrDistanceDragFactor",2);NA([I()],sl.prototype,"showGizmo",2);class nze{constructor(e,t,i,n){p(this,"handlerA");p(this,"handlerB");p(this,"context");p(this,"settings");p(this,"gameObject");p(this,"_handlerAAttachmentPoint",new T);p(this,"_handlerBAttachmentPoint",new T);p(this,"_followObject");p(this,"_manipulatorObject");p(this,"_deviceMode");p(this,"_followObjectStartWorldQuaternion",new Ve);p(this,"_manipulatorPosOffset",new T);p(this,"_manipulatorRotOffset",new Ve);p(this,"_manipulatorScaleOffset",new T);p(this,"_tempVec1",new T);p(this,"_tempVec2",new T);p(this,"_tempVec3",new T);p(this,"tempLookMatrix",new ce);p(this,"_initialScale",new T);p(this,"_initialDistance",0);var o,a;this.context=e.context,this.settings=e,this.gameObject=t,this.handlerA=i,this.handlerB=n,this._followObject=new ye,this._manipulatorObject=new ye,this.context.scene.add(this._manipulatorObject);const r=(a=(o=Vt.active)==null?void 0:o.rig)==null?void 0:a.gameObject;if(!this.handlerA||!this.handlerB||!this.handlerA.hitPointInLocalSpace||!this.handlerB.hitPointInLocalSpace){console.error("Invalid: MultiTouchDragHandler needs two valid DragPointerHandlers with hitPointInLocalSpace set.");return}if(this._tempVec1.copy(this.handlerA.hitPointInLocalSpace),this._tempVec2.copy(this.handlerB.hitPointInLocalSpace),this.gameObject.localToWorld(this._tempVec1),this.gameObject.localToWorld(this._tempVec2),r&&(r.worldToLocal(this._tempVec1),r.worldToLocal(this._tempVec2)),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.02?(Gd&&console.log("Finding alternative drag attachment points since initial distance is too low: "+this._initialDistance.toFixed(2)),this.handlerA.followObject.parent.getWorldPosition(this._tempVec1),this.handlerB.followObject.parent.getWorldPosition(this._tempVec2),this._handlerAAttachmentPoint.copy(this._tempVec1),this._handlerBAttachmentPoint.copy(this._tempVec2),this.gameObject.worldToLocal(this._handlerAAttachmentPoint),this.gameObject.worldToLocal(this._handlerBAttachmentPoint),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.001&&(console.warn("Not supported right now – controller drag points for multitouch are too close!"),this._initialDistance=1)):(this._handlerAAttachmentPoint.copy(this.handlerA.hitPointInLocalSpace),this._handlerBAttachmentPoint.copy(this.handlerB.hitPointInLocalSpace)),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._initialScale.copy(t.scale),Gd){this._followObject.add(new al(2)),this._manipulatorObject.add(new al(5));const l=c=>`${c.x.toFixed(2)}, ${c.y.toFixed(2)}, ${c.z.toFixed(2)}`;Mt.DrawLine(this._tempVec1,this._tempVec2,65535,0,!1),Mt.DrawLabel(this._tempVec3,"A:B "+this._initialDistance.toFixed(2)+`
`+l(this._tempVec1)+`
`+l(this._tempVec2),.03,5)}}onDragStart(e){this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.matrix.identity(),this._deviceMode=e.mode,this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this.alignManipulator(),this._manipulatorObject.attach(this._followObject),this._manipulatorPosOffset.copy(this._followObject.position),this._manipulatorRotOffset.copy(this._followObject.quaternion),this._manipulatorScaleOffset.copy(this._followObject.scale)}onDragEnd(e){if(!this.handlerA||!this.handlerB){console.error("onDragEnd called on MultiTouchDragHandler without valid handlers. This is likely a bug.");return}this.handlerA.recenter(),this.handlerB.recenter(),this._manipulatorObject.removeFromParent(),this._followObject.removeFromParent(),this._manipulatorObject.destroy(),this._followObject.destroy()}alignManipulator(){if(!this.handlerA||!this.handlerB){console.error("alignManipulator called on MultiTouchDragHandler without valid handlers. This is likely a bug.",this);return}if(!this.handlerA.followObject||!this.handlerB.followObject){console.error("alignManipulator called on MultiTouchDragHandler without valid follow objects. This is likely a bug.",this.handlerA,this.handlerB);return}this._tempVec1.copy(this._handlerAAttachmentPoint),this._tempVec2.copy(this._handlerBAttachmentPoint),this.handlerA.followObject.localToWorld(this._tempVec1),this.handlerB.followObject.localToWorld(this._tempVec2),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._manipulatorObject.position.copy(this._tempVec3);const e=this.context.mainCamera;this.tempLookMatrix.lookAt(this._tempVec3,this._tempVec2,e.worldUp),this._manipulatorObject.quaternion.setFromRotationMatrix(this.tempLookMatrix);const t=this._tempVec1.distanceTo(this._tempVec2);this._manipulatorObject.scale.copy(this._initialScale).multiplyScalar(t/this._initialDistance),this._manipulatorObject.updateMatrix(),this._manipulatorObject.updateMatrixWorld(!0),Gd&&(Mt.DrawLabel(this._tempVec3.clone().add(new T(0,.2,0)),"A:B "+t.toFixed(2),.03),Mt.DrawLine(this._tempVec1,this._tempVec2,65280,0,!1))}onDragUpdate(){this.alignManipulator();const e=30,t=1;this._followObject.position.copy(this._manipulatorPosOffset),this._followObject.quaternion.copy(this._manipulatorRotOffset),this._followObject.scale.copy(this._manipulatorScaleOffset);const i=this.gameObject,n=this._followObject;n.updateMatrix(),n.updateMatrixWorld(!0);const o=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrKeepRotation:this.settings.keepRotation;if(this.settings.snapGridResolution>0){const d=this._followObject.worldPosition,u=this.settings.snapGridResolution;d.x=Math.round(d.x/u)*u,d.y=Math.round(d.y/u)*u,d.z=Math.round(d.z/u)*u,this._followObject.worldPosition=d,this._followObject.updateMatrix()}o&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const a=lt.clamp01(this.context.time.deltaTime*e*t),l=i.worldPosition;l.lerp(n.worldPosition,a),i.worldPosition=l;const c=i.worldQuaternion;c.slerp(n.worldQuaternion,a),i.worldQuaternion=c;const h=i.worldScale;h.lerp(n.worldScale,a),i.worldScale=h}setTargetObject(e){this.gameObject=e}}class sze{constructor(e,t){p(this,"context");p(this,"gameObject");p(this,"settings");p(this,"_lastRig");p(this,"_followObject");p(this,"_totalMovement",new T);p(this,"_totalMovementAlongRayDirection",0);p(this,"_grabStartDistance",0);p(this,"_deviceMode");p(this,"_followObjectStartPosition",new T);p(this,"_followObjectStartQuaternion",new Ve);p(this,"_followObjectStartWorldQuaternion",new Ve);p(this,"_lastDragPosRigSpace");p(this,"_tempVec",new T);p(this,"_tempMat",new ce);p(this,"_hitPointInLocalSpace",new T);p(this,"_hitNormalInLocalSpace",new T);p(this,"_bottomCenter",new T);p(this,"_backCenter",new T);p(this,"_backBottomCenter",new T);p(this,"_bounds",new oi);p(this,"_dragPlane",new js(new T(0,1,0)));p(this,"_draggedOverObject",null);p(this,"_draggedOverObjectLastSetUp",null);p(this,"_draggedOverObjectLastNormal",new T);p(this,"_draggedOverObjectDuration",0);p(this,"_hasLastSurfaceHitPoint",!1);p(this,"_lastSurfaceHitPoint",new T);this.settings=e,this.context=e.context,this.gameObject=t,this._followObject=new ye}getTotalMovement(){return this._totalMovement}get followObject(){return this._followObject}get hitPointInLocalSpace(){return this._hitPointInLocalSpace}setTargetObject(e){this.gameObject=e}recenter(){var r,o;if(!this._followObject.parent){console.warn("Error: space follow object doesn't have parent but recenter() is called. This is likely a bug");return}if(!this.gameObject){console.warn("Error: space follow object doesn't have a gameObject");return}const e=this._followObject.parent;this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.position.set(0,0,0),this._followObject.quaternion.set(0,0,0,1),this._followObject.scale.set(1,1,1),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0),e.attach(this._followObject),this._followObjectStartPosition.copy(this._followObject.position),this._followObjectStartQuaternion.copy(this._followObject.quaternion),this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const t=this._hitPointInLocalSpace.clone();this.gameObject.localToWorld(t),this._grabStartDistance=t.distanceTo(e.worldPosition);const i=(o=(r=Vt.active)==null?void 0:r.rig)==null?void 0:o.gameObject,n=(i==null?void 0:i.worldScale.x)||1;this._grabStartDistance/=n,this._totalMovementAlongRayDirection=0,this._lastDragPosRigSpace=void 0,Gd&&(Mt.DrawLine(t,e.worldPosition,65280,.5,!1),Mt.DrawLabel(e.worldPosition.add(new T(0,.1,0)),this._grabStartDistance.toFixed(2),.03,.5))}onDragStart(e){if(!this.gameObject){console.warn("Error: space follow object doesn't have a gameObject");return}if(e.event.space.add(this._followObject),this._lastDragPosRigSpace=void 0,e.point&&e.normal)this._hitPointInLocalSpace.copy(e.point),this.gameObject.worldToLocal(this._hitPointInLocalSpace),this._hitNormalInLocalSpace.copy(e.normal);else if(e){const g=e.event.space,A=g.worldPosition;this.gameObject.worldToLocal(A),this._hitPointInLocalSpace.copy(A);const y=g.worldUp;this._tempMat.copy(this.gameObject.matrixWorld).invert(),y.transformDirection(this._tempMat),this._hitNormalInLocalSpace.copy(y)}this.recenter(),this._totalMovement.set(0,0,0),this._deviceMode=e.mode;const i=this._followObject.parent.worldForward,r=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrDragMode:this.settings.dragMode,o=this._hitPointInLocalSpace.clone();switch(this.gameObject.localToWorld(o),r){case 0:const g=new T(0,1,0);this.gameObject.parent&&g.transformDirection(this.gameObject.parent.matrixWorld.clone().invert()),this._dragPlane.setFromNormalAndCoplanarPoint(g,o);break;case 2:const A=this._hitNormalInLocalSpace.clone();A.transformDirection(this.gameObject.matrixWorld),this._dragPlane.setFromNormalAndCoplanarPoint(A,o);break;case 1:this._dragPlane.setFromNormalAndCoplanarPoint(i,o);break;case 3:this.setPlaneViewAligned(o,!0);break;case 4:this.setPlaneViewAligned(o,!1);break}const a=this.gameObject.parent,l=this.gameObject.position.clone(),c=this.gameObject.quaternion.clone(),h=this.gameObject.scale.clone(),d=this.gameObject.matrixWorld.clone();a&&a.remove(this.gameObject),this.gameObject.position.set(0,0,0),this.gameObject.quaternion.set(0,0,0,1),this.gameObject.scale.set(1,1,1);const u=ec([this.gameObject]);u.expandByPoint(this.gameObject.worldPosition);const f=new T;u.getCenter(f);const m=new T;u.getSize(m),this._bottomCenter.copy(f.clone().add(new T(0,-m.y/2,0))),this._backCenter.copy(f.clone().add(new T(0,0,m.z/2))),this._backBottomCenter.copy(f.clone().add(new T(0,-m.y/2,m.z/2))),this._bounds.copy(u),a&&a.add(this.gameObject),this.gameObject.position.copy(l),this.gameObject.quaternion.copy(c),this.gameObject.scale.copy(h),this.gameObject.matrixWorld.copy(d),this._draggedOverObject=null,this._draggedOverObjectLastSetUp=null,this._draggedOverObjectLastNormal.set(0,1,0),this._draggedOverObjectDuration=0}collectMovementInfo(){var r,o;if(!this._followObject.parent)return;const e=this._followObject.parent;this._followObject.updateMatrix();const t=e.worldPosition,i=(o=(r=Vt.active)==null?void 0:r.rig)==null?void 0:o.gameObject;i&&i.worldToLocal(t),(this._lastDragPosRigSpace===void 0||i!=this._lastRig)&&(this._lastDragPosRigSpace=t.clone(),this._lastRig=i),this._tempVec.copy(t).sub(this._lastDragPosRigSpace);const n=e.worldForward;if(i&&(this._tempMat.copy(i.matrixWorld).invert(),n.transformDirection(this._tempMat)),this._totalMovementAlongRayDirection+=n.dot(this._tempVec),this._tempVec.x=Math.abs(this._tempVec.x),this._tempVec.y=Math.abs(this._tempVec.y),this._tempVec.z=Math.abs(this._tempVec.z),this._totalMovement.add(this._tempVec),this._lastDragPosRigSpace.copy(t),Gd){let a=t;i&&(a=a.clone(),a.transformDirection(i.matrixWorld)),Mt.DrawRay(a,n,255)}}onDragUpdate(e){if(e>1)return;const t=this.gameObject;if(!t||!this._followObject){console.warn("Warning: DragPointerHandler doesn't have a dragged object. This is likely a bug.");return}const i=this._followObject.parent;if(!i){console.warn("Warning: DragPointerHandler doesn't have a drag source. This is likely a bug.");return}this._followObject.updateMatrix();const n=i.worldPosition,r=i.worldForward,o=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer",a=o?this.settings.xrKeepRotation:this.settings.keepRotation,l=o?this.settings.xrDragMode:this.settings.dragMode;if(l===5)return;const c=10;a&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);let h=1,d=2;if(o&&this._grabStartDistance>.5){const b=1+this._totalMovementAlongRayDirection*(2*this.settings.xrDistanceDragFactor);h=Math.max(0,b),h=h*h*h}else this._grabStartDistance<=.5&&(d=3);this._followObject.position.copy(this._followObjectStartPosition),a||this._followObject.quaternion.copy(this._followObjectStartQuaternion),this._followObject.position.multiplyScalar(h),this._followObject.updateMatrix();const u=this._hasLastSurfaceHitPoint;this._hasLastSurfaceHitPoint=!1;const f=new Fa(n,r);if(l==4){const b=this.context.physics.raycastFromRay(f,{testObject:x=>x!==this.followObject&&x!==i&&x!==t});if(b.length>0){const x=b[0];if(this._draggedOverObject===x.object?this._draggedOverObjectDuration+=this.context.time.deltaTime:(this._draggedOverObject=x.object,this._draggedOverObjectDuration=0),x.face){this._hasLastSurfaceHitPoint=!0,this._lastSurfaceHitPoint.copy(x.point);const v=.15,_=this._draggedOverObjectDuration>=v,C=.001,S=this._totalMovement.length()>=C,M=St(x.normal||x.face.normal).applyQuaternion(x.object.worldQuaternion);if((_||S)&&(this._draggedOverObjectLastSetUp!==this._draggedOverObject||this._draggedOverObjectLastNormal.dot(M)<.999999||this.context.time.frame%60===0)){this._draggedOverObjectLastSetUp=this._draggedOverObject,this._draggedOverObjectLastNormal.copy(x.face.normal);const L=St(),w=St();this._bounds.getCenter(L),this._bounds.getSize(w),L.sub(w.multiplyScalar(.5).multiply(M)),this._hitPointInLocalSpace.copy(L),this._hitNormalInLocalSpace.copy(x.face.normal),this._bounds.getCenter(L),this._bounds.getSize(w),L.add(w.multiplyScalar(.5).multiply(x.face.normal));const E=St(this._hitPointInLocalSpace).add(L);this._followObject.localToWorld(E);const B=x.point;this._dragPlane.setFromNormalAndCoplanarPoint(M,B)}else if(!(_||S))return}}else u&&this.gameObject&&this.setPlaneViewAligned(this.gameObject.worldPosition,!1)}if(l!==1&&f.intersectPlane(this._dragPlane,this._tempVec)){this._followObject.worldPosition=this._tempVec,this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const b=St(this._hitPointInLocalSpace);this._followObject.localToWorld(b),Gd&&Mt.DrawLine(b,this._tempVec,65535,0,!1),this._followObject.worldPosition=this._tempVec.multiplyScalar(2).sub(b),this._followObject.updateMatrix(),this._followObject.updateMatrix()}if(this.settings.snapGridResolution>0){const b=this._followObject.worldPosition,x=this.settings.snapGridResolution;b.x=Math.round(b.x/x)*x,b.y=Math.round(b.y/x)*x,b.z=Math.round(b.z/x)*x,this._followObject.worldPosition=b,this._followObject.updateMatrix()}a&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const m=lt.clamp01(this.context.time.deltaTime*c*d),g=lt.clamp01(this.context.time.deltaTime*c*.5*d),A=t.worldPosition;A.lerp(this._followObject.worldPosition,m),t.worldPosition=A;const y=t.worldQuaternion;if(y.slerp(this._followObject.worldQuaternion,g),t.worldQuaternion=y,Gd){const b=this._hitPointInLocalSpace.clone();t.localToWorld(b),Mt.DrawSphere(b,.02,16711680);const x=this._hitNormalInLocalSpace.clone();x.applyQuaternion(y),Mt.DrawRay(b,x,16711680),Mt.DrawLabel(A.add(new T(0,.25,0)),`Distance: ${this._totalMovement.length().toFixed(2)}

                Along Ray: ${this._totalMovementAlongRayDirection.toFixed(2)}

                Session: ${!!Vt.active}

                Device: ${this._deviceMode}

                `,.03);const v=this._bottomCenter.clone(),_=this._backCenter.clone(),C=this._backBottomCenter.clone();t.localToWorld(v),t.localToWorld(_),t.localToWorld(C),Mt.DrawSphere(v,.01,65280,0,!1),Mt.DrawSphere(_,.01,255,0,!1),Mt.DrawSphere(C,.01,16711935,0,!1),Mt.DrawLine(v,C,65535,0,!1),Mt.DrawLine(C,_,65535,0,!1)}}onDragEnd(e){console.assert(this._followObject.parent===e.event.space,"Drag end: _followObject is not parented to the space object"),this._followObject.removeFromParent(),this._followObject.destroy(),this._lastDragPosRigSpace=void 0}setPlaneViewAligned(e,t){if(!this._followObject.parent)return!1;const i=this._followObject.parent.worldForward,n=St(0,1,0),r=i,o=n.angleTo(r),a=.5;return t&&(o>Math.PI/2+a||o<Math.PI/2-a)?this._dragPlane.setFromNormalAndCoplanarPoint(n,e):this._dragPlane.setFromNormalAndCoplanarPoint(i,e),!0}}const nW=class{constructor(e){p(this,"showGizmo",!0);p(this,"useViewAngle",!0);p(this,"_selected",null);p(this,"_context",null);p(this,"_camera");p(this,"_cameraPlane",new js);p(this,"_hasGroundPlane",!1);p(this,"_groundPlane",new js);p(this,"_groundOffset",new T);p(this,"_groundOffsetFactor",0);p(this,"_groundDistance",0);p(this,"_groundPlanePoint",new T);p(this,"_raycaster",new Em);p(this,"_cameraPlaneOffset",new T);p(this,"_intersection",new T);p(this,"_worldPosition",new T);p(this,"_inverseMatrix",new ce);p(this,"_rbs",[]);p(this,"_groundLine");p(this,"_groundMarker");p(this,"_groundOffsetVector",new T(0,1,0));p(this,"_requireUpdateGroundPlane",!0);p(this,"_didDragOnGroundPlaneLastFrame",!1);this._camera=e;const t=new ts(nW.geometry),i=t.material;i.color=new ge(.4,.4,.4),t.layers.set(2),t.name="line",t.scale.y=1,this._groundLine=t;const n=new Wc(.5,22,22),r=new ii({color:i.color}),o=new fe(n,r);o.visible=!1,o.layers.set(2),this._groundMarker=o}get hasSelected(){return this._selected!==null&&this._selected!==void 0}get selected(){return this._selected}setSelected(e,t){if(this._selected&&t)for(const i of this._rbs)i.wakeUp(),i.setVelocity(0,0,0);if(this._selected&&Wd.Remove(t,this._selected),this._selected=e,this._context=t,this._rbs.length=0,e?(t.scene.add(this._groundLine),t.scene.add(this._groundMarker)):(this._groundLine.removeFromParent(),this._groundMarker.removeFromParent()),this._selected){if(!t){console.error("DragHelper: no context");return}Wd.Add(t,this._selected,null),this._groundOffsetFactor=0,this._hasGroundPlane=!0,this._groundOffset.set(0,0,0),this._requireUpdateGroundPlane=!0,this.onUpdateScreenSpacePlane()}}onUpdate(e){this._selected}onUpdateWorldPosition(e,t,i){if(this._selected){if(i){const n=$t(this._selected);n.y=e.y,e=n}if(_r(this._selected,e),_r(this._groundLine,e),this._hasGroundPlane?this._groundLine.scale.y=this._groundDistance:this._groundLine.scale.y=1e3,this._groundLine.visible=this.showGizmo,this._groundMarker.visible=t!==null&&this.showGizmo,t){const n=$t(this._camera).distanceTo(t)*.01;this._groundMarker.scale.set(n,n,n),_r(this._groundMarker,t)}}}onUpdateScreenSpacePlane(){if(!this._selected||!this._context)return;const e=this._context.input.getPointerPositionRC(0);e&&(this._raycaster.setFromCamera(e,this._camera),this._cameraPlane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._cameraPlane.normal),this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld)),this._raycaster.ray.intersectPlane(this._cameraPlane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._cameraPlaneOffset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))))}onUpdateGroundPlane(){if(!this._selected||!this._context)return;const e=$t(this._selected),t=new Fa(St(0,.1,0).add(e),St(0,-1,0)),i=new qd;i.testObject=r=>r!==this._selected;const n=this._context.physics.raycastFromRay(t,i);for(let r=0;r<n.length;r++){const o=n[r];if(!o.face||this.contains(this._selected,o.object))continue;const a=St(0,1,0);this._groundPlane.setFromNormalAndCoplanarPoint(a,o.point);break}this._hasGroundPlane=!0,this._groundPlane.setFromNormalAndCoplanarPoint(t.direction.multiplyScalar(-1),t.origin),this._raycaster.ray.intersectPlane(this._groundPlane,this._intersection),this._groundDistance=this._intersection.distanceTo(e),this._groundOffset.copy(this._intersection).sub(e)}contains(e,t){if(e===t)return!0;if(e.children){for(const i of e.children)if(this.contains(i,t))return!0}return!1}};let LD=nW;p(LD,"geometry",new It().setFromPoints([new T(0,0,0),new T(0,-1,0)]));var xae=(s=>(s.File_Spawned="file-spawned",s))(xae||{});class rze{constructor(e,t,i,n,r,o,a,l,c){p(this,"guid");p(this,"file_name");p(this,"file_hash");p(this,"file_size");p(this,"position");p(this,"scale");p(this,"seed");p(this,"sender");p(this,"downloadUrl");p(this,"parentGuid");p(this,"boundsSize");this.seed=t,this.guid=i,this.file_name=n,this.file_hash=r,this.file_size=o,this.position=a,this.scale=l,this.sender=e,this.downloadUrl=c}}exports.PreviewHelper=void 0;(s=>{const e=new Map;function t(n){var d;e.has(n.guid)&&i(n.guid);const r=new ye;e.set(n.guid,r);const o=new ye;o.position.y=-.5,r.add(o);const a=new fe(new pn(1,1,1,1,1,1),new ii({color:14540253,wireframe:!0,transparent:!0,opacity:.3}));a.position.y=.5,o.add(a);const l=new ye;o.add(l);const c=new fe(new pn(1,1,1,1,1,1),new ii({color:12307660,transparent:!0,opacity:.4}));c.position.y=.5,l.scale.y=.01,l.add(c);const h=new fe(new Rs(1,1,1,1),new ii({color:34,transparent:!0,opacity:.05,depthTest:!1}));return h.rotateX(-Math.PI/2),h.position.y=.51,c.add(h),n.parent.add(r),r.rotateY(Math.PI/2),n.position&&((d=r.position)==null||d.copy(n.position)),n.size&&(r.worldScale=new T().copy(n.size)),r.position.y=r.scale.y/2,{object:r,onProgress:u=>{l instanceof ye&&l.scale.set(1,u,1)}}}s.addPreview=t;function i(n){const r=e.get(n);r&&(e.delete(n),r.removeFromParent())}s.removePreview=i})(exports.PreviewHelper||(exports.PreviewHelper={}));var oze=Object.defineProperty,aze=Object.getOwnPropertyDescriptor,wv=(s,e,t,i)=>{for(var n=i>1?void 0:i?aze(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&oze(e,t,n),n};const gh=ee("debugdroplistener");class QP extends CustomEvent{constructor(e){super("object-added",{detail:e})}}const lze="blob";class zp extends ze{constructor(){super(...arguments);p(this,"useNetworking",!0);p(this,"dropArea");p(this,"fitIntoVolume",!1);p(this,"fitVolumeSize",new T(1,1,1));p(this,"placeAtHitPosition",!0);p(this,"onDropped",new Tn);p(this,"onNetworkEvent",t=>{var i;if(!this.useNetworking){gh&&console.debug("[DropListener] Ignoring networked event because networking is disabled",t);return}if((i=t.guid)!=null&&i.startsWith(this.guid)){const n=t.url;if(console.debug("[DropListener] Received networked event",t),n)if(Array.isArray(n))for(const r of n)this.addFromUrl(r,{screenposition:new Q,point:t.point,size:t.size},!0);else this.addFromUrl(n,{screenposition:new Q,point:t.point,size:t.size},!0)}});p(this,"handlePaste",t=>{if(this.context.connection.allowEditing===!1||t.defaultPrevented)return;navigator.clipboard.readText().then(n=>{if(n&&(n.startsWith("http")||n.startsWith("https")||n.startsWith("blob"))){const o={screenposition:new Q(this.context.input.mousePosition.x,this.context.input.mousePosition.y)};this.testIfIsInDropArea(o)&&this.addFromUrl(n,o,!1)}}).catch(console.warn)});p(this,"onDrag",t=>{this.context.connection.allowEditing!==!1&&t.preventDefault()});p(this,"onDrop",async t=>{if(this.context.connection.allowEditing===!1||(gh&&console.log(t),!(t!=null&&t.dataTransfer))||t["droplistener:handled"])return;t.preventDefault();const i={screenposition:new Q(t.offsetX,t.offsetY)};if(this.dropArea&&this.testIfIsInDropArea(i)===!1)return;t["droplistener:handled"]=!0;const n=t.dataTransfer.items;if(!n)return;const r=[];for(const o in n){const a=n[o];if(a.kind==="file"){const l=a.getAsFile();if(!l)continue;r.push(l)}else a.kind==="string"&&a.type=="text/plain"&&a.getAsString(l=>{this.addFromUrl(l,i,!1)})}r.length>0&&await this.addDroppedFiles(r,i)});p(this,"_abort",null);p(this,"_addedObjects",new Array);p(this,"_addedModels",new Array)}onEnable(){this.context.renderer.domElement.addEventListener("dragover",this.onDrag),this.context.renderer.domElement.addEventListener("drop",this.onDrop),window.addEventListener("paste",this.handlePaste),this.context.connection.beginListen("droplistener",this.onNetworkEvent)}onDisable(){this.context.renderer.domElement.removeEventListener("dragover",this.onDrag),this.context.renderer.domElement.removeEventListener("drop",this.onDrop),window.removeEventListener("paste",this.handlePaste),this.context.connection.stopListen("droplistener",this.onNetworkEvent)}loadFromURL(t,i){this.addFromUrl(t,{screenposition:new Q,point:i==null?void 0:i.point,size:i==null?void 0:i.size},!0)}forgetObjects(){this.removePreviouslyAddedObjects(!1)}async addFromUrl(t,i,n){gh&&console.log("dropped url",t);try{if(t.startsWith("https://github.com/")){const a=t.split("/"),l=a[3],c=a[4],h=a[6],d=a.slice(7).join("/");t=`https://raw.githubusercontent.com/${l}/${c}/${h}/${d}`}else t.startsWith("https://polyhaven.com/a")&&(t=cze(t));if(!t)return null;const r=t.toLowerCase();if(r.endsWith(".hdr")||r.endsWith(".hdri")||r.endsWith(".exr")||r.endsWith(".png")||r.endsWith(".jpg")||r.endsWith(".jpeg"))return null;this.removePreviouslyAddedObjects();const o=await M2.loadFileFromURL(new URL(t),{guid:this.guid,context:this.context,parent:this.gameObject,point:i.point,size:i.size});if(o&&this._addedObjects.length<=0)return i.url=t,this.addObject(o,i,n)}catch{console.warn("String is not a valid URL",t)}return null}async addDroppedFiles(t,i){var n,r;if(gh&&console.log("Add files",t),!!Array.isArray(t)&&t.length){this.deleteDropEvent(),this.removePreviouslyAddedObjects(),eS(lze,null),(n=this._abort)==null||n.abort("New files dropped"),this._abort=new AbortController;for(const o of t){if(!o)continue;console.debug("Load file "+o.name);const a=await M2.loadFile(o,this.context,{guid:this.guid});if(a){this.dispatchEvent(new CustomEvent("file-dropped",{detail:o})),i.file=o;const l=this.addObject(a,i,!1);l&&this.context.connection.isConnected&&this.useNetworking&&(console.debug("Uploading dropped file to blob storage"),exports.BlobStorage.upload(o,{abort:(r=this._abort)==null?void 0:r.signal}).then(c=>{c!=null&&c.download_url&&this._addedObjects.includes(l)&&this.sendDropEvent(c.download_url,l,a.contentMD5)}).catch(console.warn));break}}}}removePreviouslyAddedObjects(t=!0){if(t)for(const i of this._addedObjects)i.parent===this.gameObject&&ic(i,!0,!0);this._addedObjects.length=0,this._addedModels.length=0}addObject(t,i,n){var h,d;const{model:r,contentMD5:o}=t;if(gh&&console.log(`Dropped ${this.gameObject.name}`,r),!(r!=null&&r.scene))return console.warn("No object specified to add to scene",r),null;this.removePreviouslyAddedObjects();const a=r.scene;this.gameObject.attach(a),a.position.set(0,0,0),a.quaternion.identity(),this._addedObjects.push(a),this._addedModels.push(r);const l=new oi().setFromCenterAndSize(new T(0,this.fitVolumeSize.y*.5,0).add(this.gameObject.worldPosition),this.fitVolumeSize);if(gh&&Mt.DrawWireBox3(l,255,5),this.fitIntoVolume&&Rie(a,l,{position:!this.placeAtHitPosition}),this.placeAtHitPosition&&i&&i.screenposition){a.visible=!1;const u=this.context.physics.raycast({screenPoint:this.context.input.convertScreenspaceToRaycastSpace(i.screenposition.clone())});if(a.visible=!0,u&&u.length>0)for(const f of u){const m=f.point.clone();gh&&console.log("Place object at hit",f),Lie(a,m);break}}Bx.assignAnimationsFromFile(r,{createAnimationComponent:u=>Yl(u,na)});const c=new QP({sender:this,gltf:r,model:r,object:a,contentMD5:o,dropped:i.file||(i.url?new URL(i.url):void 0)});return this.dispatchEvent(c),(h=this.onDropped)==null||h.invoke(c.detail),!n&&((d=i.url)!=null&&d.startsWith("http"))&&this.context.connection.isConnected&&a&&this.sendDropEvent(i.url,a,o),a}async sendDropEvent(t,i,n){if(!this.useNetworking){gh&&console.debug("[DropListener] Ignoring networked event because networking is disabled",t);return}if(this.context.connection.isConnected){console.debug('Sending drop event "'+i.name+'"',t);const r=ec([i]),o={name:i.name,guid:this.guid,url:t,point:i.worldPosition.clone(),size:r.getSize(new T),contentMD5:n};this.context.connection.send("droplistener",o)}}deleteDropEvent(){this.context.connection.sendDeleteRemoteState(this.guid)}testIfIsInDropArea(t){if(this.dropArea){const i=this.context.input.convertScreenspaceToRaycastSpace(t.screenposition.clone());if(!this.context.physics.raycast({targets:[this.dropArea],screenPoint:i,recursive:!0,testObject:r=>!this._addedObjects.includes(r)}).length)return Qe()&&console.log(`Dropped outside of drop area for DropListener "${this.name}".`),!1}return!0}}wv([I()],zp.prototype,"useNetworking",2);wv([I(ye)],zp.prototype,"dropArea",2);wv([I()],zp.prototype,"fitIntoVolume",2);wv([I(T)],zp.prototype,"fitVolumeSize",2);wv([I()],zp.prototype,"placeAtHitPosition",2);wv([I(Tn)],zp.prototype,"onDropped",2);function cze(s){if(!s.startsWith("https://polyhaven.com/"))return s;const e="https://dl.polyhaven.org/file/ph-assets/Models/gltf/4k/",n=new URL(s).pathname.split("/").pop(),r=`${e}${n}/${n}_4k.gltf`;return console.log("Resolved polyhaven asset url",s,"→",r),r}var M2;(s=>{async function e(i,n,r){const o=i.name.toLowerCase();return o.endsWith(".gltf")||o.endsWith(".glb")||o.endsWith(".fbx")||o.endsWith(".obj")||o.endsWith(".usdz")||o.endsWith(".vrm")||i.type==="model/gltf+json"||i.type==="model/gltf-binary"?new Promise((a,l)=>{const c=new FileReader;c.readAsArrayBuffer(i),c.onloadend=async h=>{const d=c.result,u=r.guid,f=new So(u),m=await kh().parseSync(n,d,i.name,f);if(m){const g=exports.BlobStorage.hashMD5(d);a({model:m,contentMD5:g})}}}):(console.warn("Unsupported file type: "+o,i.type),null)}s.loadFile=e;async function t(i,n){return new Promise(async(r,o)=>{const a=new So(n.guid),l=i.toString();gh&&Mt.DrawWireSphere(n.point,.1,16711680,3);const c=exports.PreviewHelper.addPreview({guid:n.guid,parent:n.parent,position:n==null?void 0:n.point,size:n==null?void 0:n.size}),h=await kh().loadSync(n.context,l,l,a,d=>{c.onProgress(d.loaded/d.total)}).catch(console.warn);if(h){const d=await fetch(l).then(f=>f.arrayBuffer()),u=exports.BlobStorage.hashMD5(d);gh?setTimeout(()=>exports.PreviewHelper.removePreview(n.guid),3e3):exports.PreviewHelper.removePreview(n.guid),r({model:h,contentMD5:u})}else gh?setTimeout(()=>exports.PreviewHelper.removePreview(n.guid),3e3):exports.PreviewHelper.removePreview(n.guid),console.warn("Unsupported file type: "+i.toString())})}s.loadFileFromURL=t})(M2||(M2={}));var hze=Object.defineProperty,dze=Object.getOwnPropertyDescriptor,KP=(s,e,t,i)=>{for(var n=i>1?void 0:i?dze(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&hze(e,t,n),n};const vae=class extends ze{constructor(){super(...arguments);p(this,"parent",null);p(this,"object",null);p(this,"limitCount",10);p(this,"limitInterval",60);p(this,"_currentCount",0);p(this,"_startPosition",null);p(this,"_startQuaternion",null);p(this,"_forwardPointerEvents",new Map)}start(){var e,t;if(this._currentCount=0,this._startPosition=null,this._startQuaternion=null,this.object||(this.object=this.gameObject),this.object){if(this.object===this.gameObject){const n=new So(this.guid);this.object=$.instantiate(this.object,{idProvider:n,keepWorldPosition:!1});const r=$.getComponent(this.object,vae);r==null||r.destroy();let o=this.object.getComponentInChildren(sl);o||(o=this.object.addComponent(sl,{dragMode:lZ.SnapToSurfaces}),o.guid=n.generateUUID());let a=$.getComponent(o.gameObject,$d);a||(a=o.gameObject.addComponent($d),a.guid=n.generateUUID())}this.object.visible=!1;const i=this.gameObject.getComponent(sl);i&&(i.enabled=!1),this._startPosition=((e=this.object.position)==null?void 0:e.clone())??new T(0,0,0),this._startQuaternion=((t=this.object.quaternion)==null?void 0:t.clone())??new Ve(0,0,0,1)}this.gameObject.getComponentInParent(nc)||this.gameObject.addComponent(nc),this.cloneLimitIntervalFn()}onPointerEnter(e){e.used||this.object&&this.context.connection.allowEditing&&e.button===0&&this.context.input.setCursorPointer()}onPointerExit(e){e.used||this.object&&this.context.connection.allowEditing&&e.button===0&&this.context.input.setCursorNormal()}onPointerDown(e){if(e.used||!this.object||!this.context.connection.allowEditing||e.button!==0)return;const t=this.handleDuplication();if(t){const i=$.getComponent(t,sl);i?(i.onPointerDown(e),this._forwardPointerEvents.set(e.event.space,i)):console.warn("Duplicated object does not have DragControls",t)}else console.warn("Could not duplicate object. Has the target object been destroyed?",this)}onPointerUp(e){if(e.used)return;const t=this._forwardPointerEvents.get(e.event.space);t&&(t.onPointerUp(e),this._forwardPointerEvents.delete(e.event.space))}cloneLimitIntervalFn(){this.destroyed||(this._currentCount>0&&(this._currentCount-=1),setTimeout(()=>{this.cloneLimitIntervalFn()},this.limitInterval/this.limitCount*1e3))}handleDuplication(){var i;if(!this.object||this._currentCount>=this.limitCount||this.object===this.gameObject)return null;if($.isDestroyed(this.object))return this.object=null,null;this.object.visible=!0,this._startPosition&&this.object.position.copy(this._startPosition),this._startQuaternion&&this.object.quaternion.copy(this._startQuaternion);const e=new Zh;this.parent||(this.parent=this.gameObject.parent),this.parent&&(e.parent=this.parent.guid??((i=this.parent.userData)==null?void 0:i.guid),e.keepWorldPosition=!0),e.position=this.worldPosition,e.rotation=this.worldQuaternion,e.context=this.context,this._currentCount+=1;const t=$.instantiateSynced(this.object,e);return console.assert(t!==this.object,"Duplicated object is original"),this.object.visible=!1,this._startPosition&&this.object.position.clone().copy(this._startPosition),this._startQuaternion&&this.object.quaternion.clone().copy(this._startQuaternion),t}};let DA=vae;KP([I(ye)],DA.prototype,"parent",2);KP([I(ye)],DA.prototype,"object",2);KP([I()],DA.prototype,"limitCount",2);KP([I()],DA.prototype,"limitInterval",2);class TS extends jr{constructor(t){super();p(this,"effect");this.effect=t}get typeName(){return this.effect.constructor.name}onCreateEffect(){return this.effect}}var yb=(s=>(s[s.PointerEnter=0]="PointerEnter",s[s.PointerExit=1]="PointerExit",s[s.PointerDown=2]="PointerDown",s[s.PointerUp=3]="PointerUp",s[s.PointerClick=4]="PointerClick",s[s.Drag=5]="Drag",s[s.Drop=6]="Drop",s[s.Scroll=7]="Scroll",s[s.UpdateSelected=8]="UpdateSelected",s[s.Select=9]="Select",s[s.Deselect=10]="Deselect",s[s.Move=11]="Move",s[s.InitializePotentialDrag=12]="InitializePotentialDrag",s[s.BeginDrag=13]="BeginDrag",s[s.EndDrag=14]="EndDrag",s[s.Submit=15]="Submit",s[s.Cancel=16]="Cancel",s))(yb||{}),uze=Object.defineProperty,pze=Object.getOwnPropertyDescriptor,cZ=(s,e,t,i)=>{for(var n=i>1?void 0:i?pze(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&uze(e,t,n),n};class hZ{constructor(){p(this,"eventID");p(this,"callback",new Tn)}}cZ([I()],hZ.prototype,"eventID",2);cZ([I(Tn)],hZ.prototype,"callback",2);class YP extends ze{constructor(){super(...arguments);p(this,"triggers",[])}invoke(t){var i;if(this.triggers)for(const n of this.triggers)n.eventID===t&&((i=n.callback)==null||i.invoke())}onPointerClick(t){this.invoke(yb.PointerClick)}onPointerEnter(t){this.invoke(yb.PointerEnter)}onPointerExit(t){this.invoke(yb.PointerExit)}onPointerDown(t){this.invoke(yb.PointerDown)}onPointerUp(t){this.invoke(yb.PointerUp)}}cZ([I(hZ)],YP.prototype,"triggers",2);var fze=Object.defineProperty,mze=Object.getOwnPropertyDescriptor,dZ=(s,e,t,i)=>{for(var n=i>1?void 0:i?mze(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&fze(e,t,n),n};class uZ extends ze{constructor(){super(...arguments);p(this,"connectedBody");p(this,"_rigidBody",null)}get rigidBody(){return this._rigidBody}onEnable(){this._rigidBody||(this._rigidBody=this.gameObject.getComponent(en)),this.rigidBody&&this.connectedBody&&this.startCoroutine(this.create())}*create(){yield,this.rigidBody&&this.connectedBody&&this.activeAndEnabled&&this.createJoint(this.rigidBody,this.connectedBody)}}dZ([I(en)],uZ.prototype,"connectedBody",2);class pZ extends uZ{createJoint(e,t){var i;(i=this.context.physics.engine)==null||i.addFixedJoint(e,t)}}class NM extends uZ{constructor(){super(...arguments);p(this,"anchor");p(this,"axis")}createJoint(t,i){var n;this.axis&&this.anchor&&((n=this.context.physics.engine)==null||n.addHingeJoint(t,i,this.anchor,this.axis))}}dZ([I(T)],NM.prototype,"anchor",2);dZ([I(T)],NM.prototype,"axis",2);const gze={type:"change"},kY=1e-6,NY=new Ve;let Aze=class extends MB{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new T(0,0,0),this._rotationVector=new T(0,0,0),this._lastQuaternion=new Ve,this._lastPosition=new T,this._status=0,this._onKeyDown=yze.bind(this),this._onKeyUp=bze.bind(this),this._onPointerMove=vze.bind(this),this._onPointerDown=xze.bind(this),this._onPointerUp=_ze.bind(this),this._onPointerCancel=Cze.bind(this),this._onContextMenu=wze.bind(this),t!==null&&this.connect()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const t=this.object,i=e*this.movementSpeed,n=e*this.rollSpeed;t.translateX(this._moveVector.x*i),t.translateY(this._moveVector.y*i),t.translateZ(this._moveVector.z*i),NY.set(this._rotationVector.x*n,this._rotationVector.y*n,this._rotationVector.z*n,1).normalize(),t.quaternion.multiply(NY),(this._lastPosition.distanceToSquared(t.position)>kY||8*(1-this._lastQuaternion.dot(t.quaternion))>kY)&&(this.dispatchEvent(gze),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}};function yze(s){if(!(s.altKey||this.enabled===!1)){switch(s.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function bze(s){if(this.enabled!==!1){switch(s.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function xze(s){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(s.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function vze(s){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),t=e.size[0]/2,i=e.size[1]/2;this._moveState.yawLeft=-(s.pageX-e.offset[0]-t)/t,this._moveState.pitchDown=(s.pageY-e.offset[1]-i)/i,this._updateRotationVector()}}function _ze(s){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(s.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function Cze(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function wze(s){this.enabled!==!1&&s.preventDefault()}class fZ extends ze{constructor(){super(...arguments);p(this,"_controls",null)}onEnable(){var i;const t=(i=$.getComponent(this.gameObject,Cn))==null?void 0:i.threeCamera;if(!t){console.warn("FlyControls: Requires a Camera component on the same object as this component.");return}this._controls=new Aze(t,this.context.renderer.domElement),this._controls.rollSpeed=.5,this._controls.movementSpeed=3,this._controls.dragToLook=!0}onDisable(){var t;(t=this._controls)==null||t.dispose(),this._controls=null}update(){this._controls&&this._controls.update(this.context.time.deltaTime)}}var Sze=Object.defineProperty,Mze=Object.getOwnPropertyDescriptor,mZ=(s,e,t,i)=>{for(var n=i>1?void 0:i?Mze(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Sze(e,t,n),n};class Sv extends ze{constructor(){super(...arguments);p(this,"_fog")}get fog(){return this._fog||(this._fog=new sB(0,0,50)),this._fog}get mode(){return 1}set near(t){this.fog.near=t}get near(){return this.fog.near}set far(t){this.fog.far=t}get far(){return this.fog.far}set color(t){this.fog.color.copy(t)}get color(){return this.fog.color}onEnable(){this.scene.fog=this.fog}onDisable(){this.scene.fog===this._fog&&(this.scene.fog=null)}}mZ([I()],Sv.prototype,"near",1);mZ([I()],Sv.prototype,"far",1);mZ([I(ge)],Sv.prototype,"color",1);let G_,BD,Fy,wE;function PD(s,e=1/0,t=null){BD||(BD=new Rs(2,2,1,1)),Fy||(Fy=new Ht({uniforms:{blitTexture:new Te(s)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = sRGBTransferOETF( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),Fy.uniforms.blitTexture.value=s,Fy.defines.IS_SRGB=s.colorSpace==ft,Fy.needsUpdate=!0,wE||(wE=new fe(BD,Fy),wE.frustumCulled=!1);const i=new Xt,n=new sr;n.add(wE),t===null&&(t=G_=new Mm({antialias:!1}));const r=Math.min(s.image.width,e),o=Math.min(s.image.height,e);t.setSize(r,o),t.clear(),t.render(n,i);const a=document.createElement("canvas"),l=a.getContext("2d");a.width=r,a.height=o,l.drawImage(t.domElement,0,0,r,o);const c=new HU(a);return c.minFilter=s.minFilter,c.magFilter=s.magFilter,c.wrapS=s.wrapS,c.wrapT=s.wrapT,c.colorSpace=s.colorSpace,c.name=s.name,G_&&(G_.forceContextLoss(),G_.dispose(),G_=null),c}const DY={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class JP{constructor(){this.pluginCallbacks=[],this.register(function(e){return new Nze(e)}),this.register(function(e){return new Dze(e)}),this.register(function(e){return new Uze(e)}),this.register(function(e){return new Xze(e)}),this.register(function(e){return new Oze(e)}),this.register(function(e){return new Zze(e)}),this.register(function(e){return new Fze(e)}),this.register(function(e){return new Vze(e)}),this.register(function(e){return new zze(e)}),this.register(function(e){return new Wze(e)}),this.register(function(e){return new Hze(e)}),this.register(function(e){return new Qze(e)}),this.register(function(e){return new Kze(e)}),this.register(function(e){return new Yze(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){const r=new kze,o=[];for(let a=0,l=this.pluginCallbacks.length;a<l;a++)o.push(this.pluginCallbacks[a](r));r.setPlugins(o),r.write(e,t,n).catch(i)}parseAsync(e,t){const i=this;return new Promise(function(n,r){i.parse(e,n,r,t)})}}const Mi={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},GD="KHR_mesh_quantization",Ol={};Ol[qt]=Mi.NEAREST;Ol[g1]=Mi.NEAREST_MIPMAP_NEAREST;Ol[Id]=Mi.NEAREST_MIPMAP_LINEAR;Ol[Ot]=Mi.LINEAR;Ol[mp]=Mi.LINEAR_MIPMAP_NEAREST;Ol[xr]=Mi.LINEAR_MIPMAP_LINEAR;Ol[ea]=Mi.CLAMP_TO_EDGE;Ol[Mo]=Mi.REPEAT;Ol[Sp]=Mi.MIRRORED_REPEAT;const FY={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Ize=new ge,VY=12,Tze=1179937895,Eze=2,zY=8,Rze=1313821514,Lze=5130562;function EC(s,e){return s.length===e.length&&s.every(function(t,i){return t===e[i]})}function Bze(s){return new TextEncoder().encode(s).buffer}function Pze(s){return EC(s.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function Gze(s,e,t){const i={min:new Array(s.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(s.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=e;n<e+t;n++)for(let r=0;r<s.itemSize;r++){let o;s.itemSize>4?o=s.array[n*s.itemSize+r]:(r===0?o=s.getX(n):r===1?o=s.getY(n):r===2?o=s.getZ(n):r===3&&(o=s.getW(n)),s.normalized===!0&&(o=Bi.normalize(o,s.array))),i.min[r]=Math.min(i.min[r],o),i.max[r]=Math.max(i.max[r],o)}return i}function _ae(s){return Math.ceil(s/4)*4}function kD(s,e=0){const t=_ae(s.byteLength);if(t!==s.byteLength){const i=new Uint8Array(t);if(i.set(new Uint8Array(s)),e!==0)for(let n=s.byteLength;n<t;n++)i[n]=e;return i.buffer}return s}function UY(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function XY(s,e){if(s.toBlob!==void 0)return new Promise(i=>s.toBlob(i,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),s.convertToBlob({type:e,quality:t})}class kze{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+La}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const n=this,r=n.buffers,o=n.json;i=n.options;const a=n.extensionsUsed,l=n.extensionsRequired,c=new Blob(r,{type:"application/octet-stream"}),h=Object.keys(a),d=Object.keys(l);if(h.length>0&&(o.extensionsUsed=h),d.length>0&&(o.extensionsRequired=d),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=c.size),i.binary===!0){const u=new FileReader;u.readAsArrayBuffer(c),u.onloadend=function(){const f=kD(u.result),m=new DataView(new ArrayBuffer(zY));m.setUint32(0,f.byteLength,!0),m.setUint32(4,Lze,!0);const g=kD(Bze(JSON.stringify(o)),32),A=new DataView(new ArrayBuffer(zY));A.setUint32(0,g.byteLength,!0),A.setUint32(4,Rze,!0);const y=new ArrayBuffer(VY),b=new DataView(y);b.setUint32(0,Tze,!0),b.setUint32(4,Eze,!0);const x=VY+A.byteLength+g.byteLength+m.byteLength+f.byteLength;b.setUint32(8,x,!0);const v=new Blob([y,A,g,m,f],{type:"application/octet-stream"}),_=new FileReader;_.readAsArrayBuffer(v),_.onloadend=function(){t(_.result)}}}else if(o.buffers&&o.buffers.length>0){const u=new FileReader;u.readAsDataURL(c),u.onloadend=function(){const f=u.result;o.buffers[0].uri=f,t(o)}}else t(o)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const i=this.options,n=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&r.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const o in r.gltfExtensions)t.extensions[o]=r.gltfExtensions[o],n[o]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(r){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+r.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const n=new Map;n.set(!0,this.uid++),n.set(!1,this.uid++),this.uids.set(e,n)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new T;for(let n=0,r=e.count;n<r;n++)if(Math.abs(i.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const i=e.clone(),n=new T;for(let r=0,o=i.count;r<o;r++)n.fromBufferAttribute(i,r),n.x===0&&n.y===0&&n.z===0?n.setX(1):n.normalize(),i.setXYZ(r,n.x,n.y,n.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1;const n={};(t.offset.x!==0||t.offset.y!==0)&&(n.offset=t.offset.toArray(),i=!0),t.rotation!==0&&(n.rotation=t.rotation,i=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(n.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function i(f){return f.colorSpace===ft?function(g){return g<.04045?g*.0773993808:Math.pow(g*.9478672986+.0521327014,2.4)}:function(g){return g}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof Fd&&(e=PD(e)),t instanceof Fd&&(t=PD(t));const n=e?e.image:null,r=t?t.image:null,o=Math.max(n?n.width:0,r?r.width:0),a=Math.max(n?n.height:0,r?r.height:0),l=UY();l.width=o,l.height=a;const c=l.getContext("2d",{willReadFrequently:!0});c.fillStyle="#00ffff",c.fillRect(0,0,o,a);const h=c.getImageData(0,0,o,a);if(n){c.drawImage(n,0,0,o,a);const f=i(e),m=c.getImageData(0,0,o,a).data;for(let g=2;g<m.length;g+=4)h.data[g]=f(m[g]/256)*256}if(r){c.drawImage(r,0,0,o,a);const f=i(t),m=c.getImageData(0,0,o,a).data;for(let g=1;g<m.length;g+=4)h.data[g]=f(m[g]/256)*256}c.putImageData(h,0,0);const u=(e||t).clone();return u.source=new ap(l),u.colorSpace=Fr,u.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),u}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,n,r){const o=this.json;o.bufferViews||(o.bufferViews=[]);let a;switch(t){case Mi.BYTE:case Mi.UNSIGNED_BYTE:a=1;break;case Mi.SHORT:case Mi.UNSIGNED_SHORT:a=2;break;default:a=4}let l=e.itemSize*a;r===Mi.ARRAY_BUFFER&&(l=Math.ceil(l/4)*4);const c=_ae(n*l),h=new DataView(new ArrayBuffer(c));let d=0;for(let m=i;m<i+n;m++){for(let g=0;g<e.itemSize;g++){let A;e.itemSize>4?A=e.array[m*e.itemSize+g]:(g===0?A=e.getX(m):g===1?A=e.getY(m):g===2?A=e.getZ(m):g===3&&(A=e.getW(m)),e.normalized===!0&&(A=Bi.normalize(A,e.array))),t===Mi.FLOAT?h.setFloat32(d,A,!0):t===Mi.INT?h.setInt32(d,A,!0):t===Mi.UNSIGNED_INT?h.setUint32(d,A,!0):t===Mi.SHORT?h.setInt16(d,A,!0):t===Mi.UNSIGNED_SHORT?h.setUint16(d,A,!0):t===Mi.BYTE?h.setInt8(d,A):t===Mi.UNSIGNED_BYTE&&h.setUint8(d,A),d+=a}d%l!==0&&(d+=l-d%l)}const u={buffer:this.processBuffer(h.buffer),byteOffset:this.byteOffset,byteLength:c};return r!==void 0&&(u.target=r),r===Mi.ARRAY_BUFFER&&(u.byteStride=l),this.byteOffset+=c,o.bufferViews.push(u),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(n){const r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){const o=kD(r.result),a={buffer:t.processBuffer(o),byteOffset:t.byteOffset,byteLength:o.byteLength};t.byteOffset+=o.byteLength,n(i.bufferViews.push(a)-1)}})}processAccessor(e,t,i,n){const r=this.json,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=Mi.FLOAT;else if(e.array.constructor===Int32Array)a=Mi.INT;else if(e.array.constructor===Uint32Array)a=Mi.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=Mi.SHORT;else if(e.array.constructor===Uint16Array)a=Mi.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=Mi.BYTE;else if(e.array.constructor===Uint8Array)a=Mi.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(i===void 0&&(i=0),(n===void 0||n===1/0)&&(n=e.count),n===0)return null;const l=Gze(e,i,n);let c;t!==void 0&&(c=e===t.index?Mi.ELEMENT_ARRAY_BUFFER:Mi.ARRAY_BUFFER);const h=this.processBufferView(e,a,i,n,c),d={bufferView:h.id,byteOffset:h.byteOffset,componentType:a,count:n,max:l.max,min:l.min,type:o[e.itemSize]};return e.normalized===!0&&(d.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(d)-1}processImage(e,t,i,n="image/png"){if(e!==null){const r=this,o=r.cache,a=r.json,l=r.options,c=r.pending;o.images.has(e)||o.images.set(e,{});const h=o.images.get(e),d=n+":flipY/"+i.toString();if(h[d]!==void 0)return h[d];a.images||(a.images=[]);const u={mimeType:n},f=UY();f.width=Math.min(e.width,l.maxTextureSize),f.height=Math.min(e.height,l.maxTextureSize);const m=f.getContext("2d",{willReadFrequently:!0});if(i===!0&&(m.translate(0,f.height),m.scale(1,-1)),e.data!==void 0){t!==bi&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const A=new Uint8ClampedArray(e.height*e.width*4);for(let y=0;y<A.length;y+=4)A[y+0]=e.data[y+0],A[y+1]=e.data[y+1],A[y+2]=e.data[y+2],A[y+3]=e.data[y+3];m.putImageData(new ImageData(A,e.width,e.height),0,0)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)m.drawImage(e,0,0,f.width,f.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");l.binary===!0?c.push(XY(f,n).then(A=>r.processBufferViewImage(A)).then(A=>{u.bufferView=A})):f.toDataURL!==void 0?u.uri=f.toDataURL(n):c.push(XY(f,n).then(A=>new FileReader().readAsDataURL(A)).then(A=>{u.uri=A}));const g=a.images.push(u)-1;return h[d]=g,g}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:Ol[e.magFilter],minFilter:Ol[e.minFilter],wrapS:Ol[e.wrapS],wrapT:Ol[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){const i=this.options,n=this.cache,r=this.json;if(n.textures.has(e))return n.textures.get(e);const o={keep:!0,newTexture:null};if(this._invokeAll(function(h){h.beforeWriteTexture&&h.beforeWriteTexture(e,o)}),o.keep===!1)return null;o.newTexture!=null&&(e=o.newTexture),r.textures||(r.textures=[]),e instanceof Fd&&(e=PD(e,i.maxTextureSize));let a=e.userData.mimeType;a==="image/webp"&&(a="image/png");const l={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,a)};e.name&&(l.name=e.name),this._invokeAll(function(h){h.writeTexture&&h.writeTexture(e,l)});const c=r.textures.push(l)-1;return n.textures.set(e,c),c}processMaterial(e){var c,h,d,u,f;const t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const n={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=e.color.toArray().concat([e.opacity]);EC(r,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=e.metalness,n.pbrMetallicRoughness.roughnessFactor=e.roughness):(n.pbrMetallicRoughness.metallicFactor=.5,n.pbrMetallicRoughness.roughnessFactor=.5);const o=(c=e.metalnessMap)!=null&&c.image?e.metalnessMap:void 0,a=(h=e.roughnessMap)!=null&&h.image?e.roughnessMap:void 0;if(o||a){const m=this.buildMetalRoughTexture(o,a),g={index:this.processTexture(m),channel:m.channel};this.applyTextureTransform(g,m),n.pbrMetallicRoughness.metallicRoughnessTexture=g}if(e.map){const m={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(m,e.map),n.pbrMetallicRoughness.baseColorTexture=m}if(e.emissive){const m=e.emissive;if(Math.max(m.r,m.g,m.b)>0&&(n.emissiveFactor=e.emissive.toArray()),(d=e.emissiveMap)!=null&&d.image){const A={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(A,e.emissiveMap),n.emissiveTexture=A}}if((u=e.normalMap)!=null&&u.image){const m={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(m.scale=e.normalScale.x),this.applyTextureTransform(m,e.normalMap),n.normalTexture=m}if((f=e.aoMap)!=null&&f.image){const m={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(m.strength=e.aoMapIntensity),this.applyTextureTransform(m,e.aoMap),n.occlusionTexture=m}e.transparent?n.alphaMode="BLEND":e.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=e.alphaTest),e.side===Zi&&(n.doubleSided=!0),e.name!==""&&(n.name=e.name),this.serializeUserData(e,n),this._invokeAll(function(m){m.writeMaterial&&m.writeMaterial(e,n)});const l=i.materials.push(n)-1;return t.materials.set(e,l),l}processMesh(e){const t={keep:!0};if(this._invokeAll(function(_){_.beforeWriteMesh&&_.beforeWriteMesh(e,t)}),t.keep!=!0)return null;const i=this.cache,n=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let _=0,C=e.material.length;_<C;_++)r.push(e.material[_].uuid);else r.push(e.material.uuid);const o=r.join(":");if(i.meshes.has(o))return i.meshes.get(o);const a=e.geometry;let l;e.isLineSegments?l=Mi.LINES:e.isLineLoop?l=Mi.LINE_LOOP:e.isLine?l=Mi.LINE_STRIP:e.isPoints?l=Mi.POINTS:l=e.material.wireframe?Mi.LINES:Mi.TRIANGLES;const c={},h={},d=[],u=[],f={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},m=a.getAttribute("normal");m!==void 0&&!this.isNormalizedNormalAttribute(m)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),a.setAttribute("normal",this.createNormalizedNormalAttribute(m)));let g=null;for(let _ in a.attributes){if(_.slice(0,5)==="morph")continue;const C=a.attributes[_];if(_=f[_]||_.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(_)||(_="_"+_),i.attributes.has(this.getUID(C))){h[_]=i.attributes.get(this.getUID(C));continue}g=null;const M=C.array;_==="JOINTS_0"&&!(M instanceof Uint16Array)&&!(M instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),g=new dt(new Uint16Array(M),C.itemSize,C.normalized));const L=this.processAccessor(g||C,a);L!==null&&(_.startsWith("_")||this.detectMeshQuantization(_,C),h[_]=L,i.attributes.set(this.getUID(C),L))}if(m!==void 0&&a.setAttribute("normal",m),Object.keys(h).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const _=[],C=[],S={};if(e.morphTargetDictionary!==void 0)for(const M in e.morphTargetDictionary)S[e.morphTargetDictionary[M]]=M;for(let M=0;M<e.morphTargetInfluences.length;++M){const L={};let w=!1;for(const E in a.morphAttributes){if(E!=="position"&&E!=="normal"){w||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),w=!0);continue}const B=a.morphAttributes[E][M],P=E.toUpperCase(),k=a.attributes[E];if(i.attributes.has(this.getUID(B,!0))){L[P]=i.attributes.get(this.getUID(B,!0));continue}const X=B.clone();if(!a.morphTargetsRelative)for(let F=0,H=B.count;F<H;F++)for(let W=0;W<B.itemSize;W++)W===0&&X.setX(F,B.getX(F)-k.getX(F)),W===1&&X.setY(F,B.getY(F)-k.getY(F)),W===2&&X.setZ(F,B.getZ(F)-k.getZ(F)),W===3&&X.setW(F,B.getW(F)-k.getW(F));L[P]=this.processAccessor(X,a),i.attributes.set(this.getUID(k,!0),L[P])}u.push(L),_.push(e.morphTargetInfluences[M]),e.morphTargetDictionary!==void 0&&C.push(S[M])}c.weights=_,C.length>0&&(c.extras={},c.extras.targetNames=C)}const A=Array.isArray(e.material);if(A&&a.groups.length===0)return null;let y=!1;if(A&&a.index===null){const _=[];for(let C=0,S=a.attributes.position.count;C<S;C++)_[C]=C;a.setIndex(_),y=!0}const b=A?e.material:[e.material],x=A?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let _=0,C=x.length;_<C;_++){const S={mode:l,attributes:h};if(this.serializeUserData(a,S),u.length>0&&(S.targets=u),a.index!==null){let L=this.getUID(a.index);(x[_].start!==void 0||x[_].count!==void 0)&&(L+=":"+x[_].start+":"+x[_].count),i.attributes.has(L)?S.indices=i.attributes.get(L):(S.indices=this.processAccessor(a.index,a,x[_].start,x[_].count),i.attributes.set(L,S.indices)),S.indices===null&&delete S.indices}const M=this.processMaterial(b[x[_].materialIndex]);M!==null&&(S.material=M),d.push(S)}y===!0&&a.setIndex(null),c.primitives=d,n.meshes||(n.meshes=[]),this._invokeAll(function(_){_.writeMesh&&_.writeMesh(e,c)});const v=n.meshes.push(c)-1;return i.meshes.set(o,v),v}detectMeshQuantization(e,t){if(this.extensionsUsed[GD])return;let i;switch(t.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}t.normalized&&(i+=" normalized");const n=e.split("_",1)[0];DY[n]&&DY[n].includes(i)&&(this.extensionsUsed[GD]=!0,this.extensionsRequired[GD]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const i=e.isOrthographicCamera,n={type:i?"orthographic":"perspective"};return i?n.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:Bi.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(n.name=e.type),t.cameras.push(n)-1}processAnimation(e,t){const i=this.json,n=this.nodeMap;i.animations||(i.animations=[]),e=JP.Utils.mergeMorphTargetTracks(e.clone(),t);const r=e.tracks,o=[],a=[];for(let l=0;l<r.length;++l){const c=r[l],h=di.parseTrackName(c.name);let d=di.findNode(t,h.nodeName);const u=FY[h.propertyName];if(h.objectName==="bones"&&(d.isSkinnedMesh===!0?d=d.skeleton.getBoneByName(h.objectIndex):d=void 0),!d||!u){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',c.name);continue}const f=1;let m=c.values.length/c.times.length;u===FY.morphTargetInfluences&&(m/=d.morphTargetInfluences.length);let g;c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(g="CUBICSPLINE",m/=3):c.getInterpolation()===hm?g="STEP":g="LINEAR",a.push({input:this.processAccessor(new dt(c.times,f)),output:this.processAccessor(new dt(c.values,m)),interpolation:g}),o.push({sampler:a.length-1,target:{node:n.get(d),path:u}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:a,channels:o}),i.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,n=t.nodes[i.get(e)],r=e.skeleton;if(r===void 0)return null;const o=e.skeleton.bones[0];if(o===void 0)return null;const a=[],l=new Float32Array(r.bones.length*16),c=new ce;for(let d=0;d<r.bones.length;++d)a.push(i.get(r.bones[d])),c.copy(r.boneInverses[d]),c.multiply(e.bindMatrix).toArray(l,d*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new dt(l,16)),joints:a,skeleton:i.get(o)}),n.skin=t.skins.length-1}processNode(e){const t={keep:!0};if(this._invokeAll(function(l){l.beforeWriteNode&&l.beforeWriteNode(e,t)}),t.keep!=!0)return null;const i=this.json,n=this.options,r=this.nodeMap;i.nodes||(i.nodes=[]);const o={};if(n.trs){const l=e.quaternion.toArray(),c=e.position.toArray(),h=e.scale.toArray();EC(l,[0,0,0,1])||(o.rotation=l),EC(c,[0,0,0])||(o.translation=c),EC(h,[1,1,1])||(o.scale=h)}else e.matrixAutoUpdate&&e.updateMatrix(),Pze(e.matrix)===!1&&(o.matrix=e.matrix.elements);if(e.name!==""&&(o.name=String(e.name)),this.serializeUserData(e,o),e.isMesh||e.isLine||e.isPoints){const l=this.processMesh(e);l!==null&&(o.mesh=l)}else e.isCamera&&(o.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const l=[];for(let c=0,h=e.children.length;c<h;c++){const d=e.children[c];if(d.visible||n.onlyVisible===!1){const u=this.processNode(d);u!==null&&l.push(u)}}l.length>0&&(o.children=l)}this._invokeAll(function(l){l.writeNode&&l.writeNode(e,o)});const a=i.nodes.push(o)-1;return r.set(e,a),a}processScene(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const n={};e.name!==""&&(n.name=e.name),t.scenes.push(n);const r=[];for(let o=0,a=e.children.length;o<a;o++){const l=e.children[o];if(l.visible||i.onlyVisible===!1){const c=this.processNode(l);c!==null&&r.push(c)}}r.length>0&&(n.nodes=r),this.serializeUserData(e,n)}processObjects(e){const t=new sr;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(n){n.beforeParse&&n.beforeParse(e)});const i=[];for(let n=0;n<e.length;n++)e[n]instanceof sr?this.processScene(e[n]):i.push(e[n]);i.length>0&&this.processObjects(i);for(let n=0;n<this.skins.length;++n)this.processSkin(this.skins[n]);for(let n=0;n<t.animations.length;++n)this.processAnimation(t.animations[n],e[0]);this._invokeAll(function(n){n.afterParse&&n.afterParse(e)})}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}class Nze{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const i=this.writer,n=i.json,r=i.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(1-e.penumbra)*e.angle,o.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(n.extensions=n.extensions||{},n.extensions[this.name]={lights:[]},r[this.name]=!0);const a=n.extensions[this.name].lights;a.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}class Dze{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class Fze{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const i=this.writer,n=i.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){const o={index:i.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(o,e.clearcoatMap),r.clearcoatTexture=o}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const o={index:i.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(o,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=o}if(e.clearcoatNormalMap){const o={index:i.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};e.clearcoatNormalScale.x!==1&&(o.scale=e.clearcoatNormalScale.x),i.applyTextureTransform(o,e.clearcoatNormalMap),r.clearcoatNormalTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Vze{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.dispersion===0)return;const n=this.writer.extensionsUsed,r={};r.dispersion=e.dispersion,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class zze{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const i=this.writer,n=i.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){const o={index:i.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(o,e.iridescenceMap),r.iridescenceTexture=o}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const o={index:i.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(o,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Uze{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,n=i.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){const o={index:i.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(o,e.transmissionMap),r.transmissionTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Xze{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,n=i.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){const o={index:i.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(o,e.thicknessMap),r.thicknessTexture=o}e.attenuationDistance!==1/0&&(r.attenuationDistance=e.attenuationDistance),r.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Oze{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const n=this.writer.extensionsUsed,r={};r.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Zze{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(Ize)&&!e.specularIntensityMap&&!e.specularColorMap)return;const i=this.writer,n=i.extensionsUsed,r={};if(e.specularIntensityMap){const o={index:i.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(o,e.specularIntensityMap),r.specularTexture=o}if(e.specularColorMap){const o={index:i.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(o,e.specularColorMap),r.specularColorTexture=o}r.specularFactor=e.specularIntensity,r.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Wze{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const i=this.writer,n=i.extensionsUsed,r={};if(e.sheenRoughnessMap){const o={index:i.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(o,e.sheenRoughnessMap),r.sheenRoughnessTexture=o}if(e.sheenColorMap){const o={index:i.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(o,e.sheenColorMap),r.sheenColorTexture=o}r.sheenRoughnessFactor=e.sheenRoughness,r.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Hze{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const i=this.writer,n=i.extensionsUsed,r={};if(e.anisotropyMap){const o={index:i.processTexture(e.anisotropyMap)};i.applyTextureTransform(o,e.anisotropyMap),r.anisotropyTexture=o}r.anisotropyStrength=e.anisotropy,r.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Qze{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const n=this.writer.extensionsUsed,r={};r.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Kze{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===1&&!e.bumpMap)return;const i=this.writer,n=i.extensionsUsed,r={};if(e.bumpMap){const o={index:i.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};i.applyTextureTransform(o,e.bumpMap),r.bumpTexture=o}r.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class Yze{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const i=this.writer,n=e,r=new Float32Array(n.count*3),o=new Float32Array(n.count*4),a=new Float32Array(n.count*3),l=new ce,c=new T,h=new Ve,d=new T;for(let f=0;f<n.count;f++)n.getMatrixAt(f,l),l.decompose(c,h,d),c.toArray(r,f*3),h.toArray(o,f*4),d.toArray(a,f*3);const u={TRANSLATION:i.processAccessor(new dt(r,3)),ROTATION:i.processAccessor(new dt(o,4)),SCALE:i.processAccessor(new dt(a,3))};n.instanceColor&&(u._COLOR_0=i.processAccessor(n.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:u},i.extensionsUsed[this.name]=!0,i.extensionsRequired[this.name]=!0}}JP.Utils={insertKeyframe:function(s,e){const i=s.getValueSize(),n=new s.TimeBufferType(s.times.length+1),r=new s.ValueBufferType(s.values.length+i),o=s.createInterpolant(new s.ValueBufferType(i));let a;if(s.times.length===0){n[0]=e;for(let l=0;l<i;l++)r[l]=0;a=0}else if(e<s.times[0]){if(Math.abs(s.times[0]-e)<.001)return 0;n[0]=e,n.set(s.times,1),r.set(o.evaluate(e),0),r.set(s.values,i),a=0}else if(e>s.times[s.times.length-1]){if(Math.abs(s.times[s.times.length-1]-e)<.001)return s.times.length-1;n[n.length-1]=e,n.set(s.times,0),r.set(s.values,0),r.set(o.evaluate(e),s.values.length),a=n.length-1}else for(let l=0;l<s.times.length;l++){if(Math.abs(s.times[l]-e)<.001)return l;if(s.times[l]<e&&s.times[l+1]>e){n.set(s.times.slice(0,l+1),0),n[l+1]=e,n.set(s.times.slice(l+1),l+2),r.set(s.values.slice(0,(l+1)*i),0),r.set(o.evaluate(e),(l+1)*i),r.set(s.values.slice((l+1)*i),(l+2)*i),a=l+1;break}}return s.times=n,s.values=r,a},mergeMorphTargetTracks:function(s,e){const t=[],i={},n=s.tracks;for(let r=0;r<n.length;++r){let o=n[r];const a=di.parseTrackName(o.name),l=di.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(Mp)}const c=l.morphTargetInfluences.length,h=l.morphTargetDictionary[a.propertyIndex];if(h===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let d;if(i[l.uuid]===void 0){d=o.clone();const f=new d.ValueBufferType(c*d.times.length);for(let m=0;m<d.times.length;m++)f[m*c+h]=d.values[m];d.name=(a.nodeName||"")+".morphTargetInfluences",d.values=f,i[l.uuid]=d,t.push(d);continue}const u=o.createInterpolant(new o.ValueBufferType(1));d=i[l.uuid];for(let f=0;f<d.times.length;f++)d.values[f*c+h]=u.evaluate(d.times[f]);for(let f=0;f<o.times.length;f++){const m=this.insertKeyframe(d,o.times[f]);d.values[m*c+h]=o.values[f]}}return s.tracks=t,s}};class Cae{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(e.constructor.name!=="InstancedMesh")return;const i=this.writer,n=i.extensionsUsed,r={};t.extensions=t.extensions||{},t.extensions[this.name]=r;let o=new ce;const a=new Array,l=new Array,c=new Array;for(let f=0;f<e.count;f++){e.getMatrixAt(f,o);let m=new T,g=new Ve,A=new T;o.decompose(m,g,A),a.push(m.x,m.y,m.z),l.push(g.x,g.y,g.z,g.w),c.push(A.x,A.y,A.z)}const h=new Float32Array(a),d=new Float32Array(l),u=new Float32Array(c);r.attributes={TRANSLATION:i.processAccessor(new dt(h,3)),ROTATION:i.processAccessor(new dt(d,4)),SCALE:i.processAccessor(new dt(u,3))},n[this.name]=!0}}var Jze=Object.defineProperty,jze=Object.getOwnPropertyDescriptor,wae=(s,e,t,i)=>{for(var n=i>1?void 0:i?jze(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Jze(e,t,n),n};const SE=ee("debuggltfexport");class gZ extends il{constructor(){super(...arguments);p(this,"sceneRoot")}}const bb=class extends ze{constructor(){super(...arguments);p(this,"binary",!0);p(this,"objects",[]);p(this,"ext")}async exportNow(e,t){SE&&console.log("Exporting objects as glTF",this.objects),e||(e="scene"),(!this.objects||this.objects.length<=0)&&(this.objects=[this.context.scene]);const i={binary:this.binary,pivot:bb.calculateCenter(this.objects),...t},n=await this.export(this.objects,i).catch(r=>(console.error(r),!1));return n===!1?!1:(this.binary?e.endsWith(".glb")||(e+=".glb"):e.endsWith(".gltf")||(e+=".gltf"),this.binary?bb.saveArrayBuffer(n,e):bb.saveJson(n,e),!0)}async export(e,t){if(!e||e.length<=0){console.warn("No objects set to export");return}const i=new JP;i.register(l=>new Cae(l)),eZ(i,this.context),bb.filterTopmostParent(e);const n={trs:!1,onlyVisible:!0,truncateDrawRange:!1,binary:!0,maxTextureSize:1/0,embedImages:!0,includeCustomExtensions:!0,animations:(t==null?void 0:t.animations)||bb.collectAnimations(e),...t},r=new ye;t!=null&&t.pivot&&r.position.sub(t.pivot),SE&&console.log("EXPORT",e),e.forEach(l=>{l&&(r.children.push(l),l.matrixAutoUpdate=!1,l.matrix.copy(l.matrixWorld),$.getComponentsInChildren(l,Es).forEach(c=>{$.isActiveInHierarchy(c.gameObject)&&c.setInstancingEnabled(!1)}))});const o=new h5(r);return t!=null&&t.needleComponents&&(this.ext=new lae),this.ext&&(this.ext.registerExport(i),this.ext.context=o),new Promise((l,c)=>{SE&&console.log("Starting glTF export.");try{i==null||i.parse(r,h=>{a(),l(h)},h=>{a(),c(h)},n)}catch(h){console.error(h),c(h)}finally{SE&&console.log("Finished glTF export.")}});function a(){e.forEach(l=>{l&&(l.matrixAutoUpdate=!0,$.getComponentsInChildren(l,Es).forEach(c=>{$.isActiveInHierarchy(c.gameObject)&&c.setInstancingEnabled(!1)}))})}}static saveArrayBuffer(e,t){this.save(new Blob([e],{type:"application/octet-stream"}),t)}static saveJson(e,t){this.save("data: text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),t)}static save(e,t){const i=document.createElement("a");i.style.display="none",document.body.appendChild(i),typeof e=="string"?i.href=e:i.href=URL.createObjectURL(e),i.download=t,i.click(),i.remove()}static collectAnimations(e,t){t=t||[];for(const i of e)i&&i.traverseVisible(n=>{n.animations&&n.animations.length>0&&t.push(...n.animations)});return t}static calculateCenter(e,t){const i=t||new T;return i.set(0,0,0),e.forEach(n=>{i.add($t(n))}),i.divideScalar(e.length),i}static filterTopmostParent(e){if(!(e.length<=0))for(let t=0;t<e.length;t++){let i=e[t];if(!i){e.splice(t,1),t--;continue}for(;i.parent;){if(e.includes(i.parent)){e.splice(t,1),t--;break}i=i.parent}}}};let DM=bb;wae([I()],DM.prototype,"binary",2);wae([I(ye)],DM.prototype,"objects",2);var qze=Object.defineProperty,$ze=Object.getOwnPropertyDescriptor,AZ=(s,e,t,i)=>{for(var n=i>1?void 0:i?$ze(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&qze(e,t,n),n};class Mv extends ze{constructor(){super(...arguments);p(this,"isGizmo",!1);p(this,"color0");p(this,"color1");p(this,"gridHelper");p(this,"size");p(this,"divisions");p(this,"offset")}onEnable(){if(this.isGizmo&&!hM)return;const t=this.size,i=this.divisions;this.gridHelper||(this.gridHelper=new SB(t,i,this.color0??new ge(.4,.4,.4),this.color1??new ge(.6,.6,.6)),this.offset!==void 0&&(this.gridHelper.position.y+=this.offset)),this.gridHelper&&this.gameObject.add(this.gridHelper)}onDisable(){this.gridHelper&&(this.gameObject.remove(this.gridHelper),this.gridHelper=null)}}AZ([I()],Mv.prototype,"isGizmo",2);AZ([I(ge)],Mv.prototype,"color0",2);AZ([I(ge)],Mv.prototype,"color1",2);var eUe=Object.defineProperty,tUe=Object.getOwnPropertyDescriptor,jP=(s,e,t,i)=>{for(var n=i>1?void 0:i?tUe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&eUe(e,t,n),n};const ff=ee("debuginputfield");var qy;const Ft=(qy=class extends ze{constructor(){super(...arguments);p(this,"textComponent");p(this,"placeholder");p(this,"onValueChanged");p(this,"onEndEdit");p(this,"inputEventFn");p(this,"_iosEventFn")}get text(){var e;return((e=this.textComponent)==null?void 0:e.text)??""}get isFocused(){return Ft.active===this}start(){ff&&console.log(this.name,this)}onEnable(){var e;Ft.htmlField||(Ft.htmlField=document.createElement("input"),Ft.htmlField.style.width="0px",Ft.htmlField.style.height="0px",Ft.htmlField.style.padding="0px",Ft.htmlField.style.border="none",Ft.htmlField.style.overflow="hidden",Ft.htmlField.style.caretColor="transparent",Ft.htmlField.style.outline="none",Ft.htmlField.classList.add("ar"),Ft.htmlField.onfocus=()=>Ft.htmlFieldFocused=!0,Ft.htmlField.onblur=()=>Ft.htmlFieldFocused=!1,document.body.append(Ft.htmlField)),this.inputEventFn||(this.inputEventFn=this.onInput.bind(this)),Ft.htmlField.addEventListener("keyup",this.inputEventFn),this.placeholder&&((e=this.textComponent)!=null&&e.text.length)&&$.setActive(this.placeholder.gameObject,!1),exports.DeviceUtilities.isiOS()&&(this._iosEventFn=this.processInputOniOS.bind(this),window.addEventListener("click",this._iosEventFn))}onDisable(){var e;(e=Ft.htmlField)==null||e.removeEventListener("keyup",this.inputEventFn),this.onDeselected(),this._iosEventFn&&window.removeEventListener("click",this._iosEventFn)}clear(){Ft.active===this&&Ft.htmlField?(Ft.htmlField.value="",this.setTextFromInputField()):(this.textComponent&&(this.textComponent.text=""),this.placeholder&&$.setActive(this.placeholder.gameObject,!0))}select(){this.onSelected()}deselect(){this.onDeselected()}onPointerClick(e){ff&&console.log("CLICK",e,Ft.active),Ft.activeTime=this.context.time.time,Ft.active!==this&&this.startCoroutine(this.activeLoop(),wn.LateUpdate),this.selectInputField()}*activeLoop(){for(this.onSelected();Ft.active===this&&!(this.context.input.getPointerClicked(0)&&this.context.time.time-Ft.activeTime>.2);)this.setTextFromInputField(),yield;this.onDeselected()}onSelected(){var e,t,i,n;if(Ft.active!==this&&(ff&&console.log("Select",this.name,this,Ft.htmlField,this.context.isInXR,this.context.arOverlayElement,(e=this.textComponent)==null?void 0:e.text,(t=Ft.htmlField)==null?void 0:t.value),(i=Ft.active)==null||i.onDeselected(),Ft.active=this,this.placeholder&&$.setActive(this.placeholder.gameObject,!1),Ft.htmlField)){if(Ft.htmlField.value=((n=this.textComponent)==null?void 0:n.text)||"",ff&&console.log("set input field value",Ft.htmlField.value),this.context.isInXR){const r=this.context.arOverlayElement;r&&r.append(Ft.htmlField)}this.selectInputField()}}onDeselected(){var e;Ft.active===this&&(Ft.active=null,ff&&console.log("Deselect",this.name,this),Ft.htmlField&&(Ft.htmlField.blur(),document.body.append(Ft.htmlField)),this.placeholder&&(!this.textComponent||this.textComponent.text.length<=0)&&$.setActive(this.placeholder.gameObject,!0),Ft.htmlField&&((e=this.onEndEdit)==null||e.invoke(Ft.htmlField.value)))}update(){var e;Ft.active===this&&((e=this.textComponent)==null||e.markDirty())}onInput(e){var t,i;if(Ft.active===this){if(ff&&console.log(e.code,e,(t=Ft.htmlField)==null?void 0:t.value,(i=this.textComponent)==null?void 0:i.text),e.code==="Escape"||e.code==="Enter"){this.onDeselected();return}Ft.htmlField&&(this.textComponent&&(this.setTextFromInputField(),this.placeholder&&$.setActive(this.placeholder.gameObject,this.textComponent.text.length<=0)),this.selectInputField())}}setTextFromInputField(){var e;if(this.textComponent&&Ft.htmlField){if(this.textComponent.text!==Ft.htmlField.value){ff&&console.log("VALUE CHANGED");const t=this.textComponent.text,i=Ft.htmlField.value;(e=this.onValueChanged)==null||e.invoke(i,t)}this.textComponent.text=Ft.htmlField.value}}selectInputField(){Ft.htmlField&&(ff&&console.log("Focus Inputfield",Ft.htmlFieldFocused),Ft.htmlField.setSelectionRange(Ft.htmlField.value.length,Ft.htmlField.value.length),exports.DeviceUtilities.isiOS()?Ft.htmlField.focus({preventScroll:!0}):setTimeout(()=>{var e;return(e=Ft.htmlField)==null?void 0:e.focus()},1))}processInputOniOS(){const e=this.context.physics.raycast();if(!e.length)return;const i=e[0].object,n=L5(i);((n==null?void 0:n.gameObject)===this.gameObject||(n==null?void 0:n.gameObject.parent)===this.gameObject)&&this.selectInputField()}},p(qy,"active",null),p(qy,"activeTime",-1),p(qy,"htmlField",null),p(qy,"htmlFieldFocused",!1),qy);let FA=Ft;jP([I(aa)],FA.prototype,"textComponent",2);jP([I(aa)],FA.prototype,"placeholder",2);jP([I(Tn)],FA.prototype,"onValueChanged",2);jP([I(Tn)],FA.prototype,"onEndEdit",2);var iUe=Object.defineProperty,nUe=Object.getOwnPropertyDescriptor,du=(s,e,t,i)=>{for(var n=i>1?void 0:i?nUe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&iUe(e,t,n),n};function ND(s){return s*Math.PI/180}const OY=300,mf=ee("debuglights");class fl extends ze{constructor(){super(...arguments);p(this,"type",0);p(this,"range",1);p(this,"spotAngle",1);p(this,"innerSpotAngle",1);p(this,"_color",new ge(16777215));p(this,"_shadowNearPlane",.1);p(this,"_shadowBias",0);p(this,"_shadowNormalBias",0);p(this,"_overrideShadowBiasSettings",!1);p(this,"_shadows",1);p(this,"lightmapBakeType",4);p(this,"_intensity",-1);p(this,"_shadowDistance");p(this,"shadowWidth");p(this,"shadowHeight");p(this,"_shadowResolution");p(this,"light");p(this,"_webXRStartedListener");p(this,"_webXREndedListener");p(this,"_webARRoot")}set color(t){this._color=t,this.light!==void 0&&(this.light.color=t)}get color(){return this.light?this.light.color:this._color}set shadowNearPlane(t){var i,n;if(t!==this._shadowNearPlane&&(this._shadowNearPlane=t,((n=(i=this.light)==null?void 0:i.shadow)==null?void 0:n.camera)!==void 0)){const r=this.light.shadow.camera;r.near=t}}get shadowNearPlane(){return this._shadowNearPlane}set shadowBias(t){var i,n;t!==this._shadowBias&&(this._shadowBias=t,((n=(i=this.light)==null?void 0:i.shadow)==null?void 0:n.bias)!==void 0&&(this.light.shadow.bias=t,this.light.shadow.needsUpdate=!0))}get shadowBias(){return this._shadowBias}set shadowNormalBias(t){var i,n;t!==this._shadowNormalBias&&(this._shadowNormalBias=t,((n=(i=this.light)==null?void 0:i.shadow)==null?void 0:n.normalBias)!==void 0&&(this.light.shadow.normalBias=t,this.light.shadow.needsUpdate=!0))}get shadowNormalBias(){return this._shadowNormalBias}set shadows(t){this._shadows=t,this.light&&(this.light.castShadow=t!==0,this.updateShadowSoftHard())}get shadows(){return this._shadows}set intensity(t){var i;if(this._intensity=t,this.light){let n=1;if(this.context.isInXR&&this._webARRoot){const r=(i=this._webARRoot)==null?void 0:i.arScale;typeof r=="number"&&r>0&&(n/=r)}this.light.intensity=t*n}mf&&console.log("Set light intensity to "+this._intensity,t,this)}get intensity(){return this._intensity}get shadowDistance(){const t=this.light;return t!=null&&t.shadow?t.shadow.camera.far:-1}set shadowDistance(t){this._shadowDistance=t;const i=this.light;if(i!=null&&i.shadow){const n=i.shadow.camera;n.far=t,n.updateProjectionMatrix()}}get shadowResolution(){const t=this.light;return t!=null&&t.shadow?t.shadow.mapSize.x:-1}set shadowResolution(t){if(t===this._shadowResolution)return;this._shadowResolution=t;const i=this.light;i!=null&&i.shadow&&(i.shadow.mapSize.set(t,t),i.shadow.needsUpdate=!0)}get isBaked(){return this.lightmapBakeType===2}get selfIsLight(){if(this.gameObject.isLight===!0)return!0;switch(this.gameObject.type){case"SpotLight":case"PointLight":case"DirectionalLight":return!0}return!1}getWorldPosition(t){return this.light?this.type===1?this.light.getWorldPosition(t).multiplyScalar(1):this.light.getWorldPosition(t):t}awake(){this.color=new ge(this.color??16777215),mf&&console.log(this.name,this)}onEnable(){mf&&console.log("ENABLE LIGHT",this.name),this.createLight(),!this.isBaked&&(this.light&&(this.light.visible=!0,this.light.intensity=this._intensity,mf&&console.log("Set light intensity to "+this.light.intensity,this.name),this.selfIsLight||this.light.parent!==this.gameObject&&this.gameObject.add(this.light)),this.type===1&&this.startCoroutine(this.updateMainLightRoutine(),wn.LateUpdate))}onDisable(){mf&&console.log("DISABLE LIGHT",this.name),this.light&&(this.selfIsLight?this.light.intensity=0:this.light.visible=!1)}onEnterXR(t){this._webARRoot=$.getComponentInParent(this.gameObject,Rp)??void 0}onLeaveXR(t){}createLight(){const t=this.selfIsLight;if(t&&!this.light)switch(this.light=this.gameObject,this.light.name=this.name,this._intensity=this.light.intensity,this.type){case 1:this.setDirectionalLight(this.light);break}else if(!this.light)switch(this.type){case 1:const i=new um(this.color,this.intensity*Math.PI);if(i.position.set(0,0,-OY*.5).applyQuaternion(this.gameObject.quaternion),this.gameObject.add(i.target),q0(i.target,0,0,0),this.light=i,this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),mf){const a=new i6(this.light,.2,this.color);this.context.scene.add(a)}break;case 0:const n=new pA(this.color,this.intensity*Math.PI,this.range,ND(this.spotAngle/2),1-ND(this.innerSpotAngle/2)/ND(this.spotAngle/2),2);n.position.set(0,0,0),n.rotation.set(0,0,0),this.light=n;const r=n.target;n.add(r),r.position.set(0,0,this.range),r.rotation.set(0,0,0);break;case 2:const o=new dm(this.color,this.intensity*Math.PI,this.range);this.light=o;break}if(this.light){if(this._intensity>=0?this.light.intensity=this._intensity:this._intensity=this.light.intensity,this.shadows!==0?this.light.castShadow=!0:this.light.castShadow=!1,this.light.shadow){this._shadowResolution!==void 0&&this._shadowResolution>4?(this.light.shadow.mapSize.width=this._shadowResolution,this.light.shadow.mapSize.height=this._shadowResolution):(this.light.shadow.mapSize.width=2048,this.light.shadow.mapSize.height=2048),mf&&console.log("Override shadow bias?",this._overrideShadowBiasSettings,this.shadowBias,this.shadowNormalBias),this.light.shadow.bias=this.shadowBias,this.light.shadow.normalBias=this.shadowNormalBias,this.updateShadowSoftHard();const i=this.light.shadow.camera;if(i.near=this.shadowNearPlane,this._shadowDistance!==void 0&&typeof this._shadowDistance=="number"?i.far=this._shadowDistance:i.far=OY*Math.abs(this.gameObject.scale.z),this.gameObject.scale.set(1,1,1),this.shadowWidth!==void 0)i.left=-this.shadowWidth/2,i.right=this.shadowWidth/2;else{const n=this.gameObject.scale.x;i.left*=n,i.right*=n}if(this.shadowHeight!==void 0)i.top=this.shadowHeight/2,i.bottom=-this.shadowHeight/2;else{const n=this.gameObject.scale.y;i.top*=n,i.bottom*=n}this.light.shadow.needsUpdate=!0,mf&&this.context.scene.add(new n6(i))}this.isBaked?this.light.removeFromParent():t||this.gameObject.add(this.light)}}*updateMainLightRoutine(){for(;;){this.type===1&&((!this.context.mainLight||this.intensity>this.context.mainLight.intensity)&&(this.context.mainLight=this),yield);break}}updateShadowSoftHard(){this.light&&this.light.shadow&&(this.shadows===2||(this.light.shadow.radius=1,this.light.shadow.blurSamples=1))}setDirectionalLight(t){t.add(t.target),t.target.position.set(0,0,-1)}}p(fl,"allowChangingRendererShadowMapType",!0);du([I()],fl.prototype,"type",2);du([I(ge)],fl.prototype,"color",1);du([I()],fl.prototype,"shadowNearPlane",1);du([I()],fl.prototype,"shadowBias",1);du([I()],fl.prototype,"shadowNormalBias",1);du([I()],fl.prototype,"shadows",1);du([I()],fl.prototype,"lightmapBakeType",2);du([I()],fl.prototype,"intensity",1);du([I()],fl.prototype,"shadowDistance",1);du([I()],fl.prototype,"shadowResolution",1);new T(0,0,0);var sUe=Object.defineProperty,rUe=Object.getOwnPropertyDescriptor,FM=(s,e,t,i)=>{for(var n=i>1?void 0:i?rUe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&sUe(e,t,n),n};const DD=ee("debuglods"),oUe=ee("nolods");class VA{constructor(){p(this,"screenRelativeTransitionHeight");p(this,"distance");p(this,"renderers")}}FM([I()],VA.prototype,"screenRelativeTransitionHeight",2);FM([I()],VA.prototype,"distance",2);FM([I(Es)],VA.prototype,"renderers",2);class aUe{constructor(e){p(this,"model");this.model=e}get renderers(){return this.model.renderers}}class VM extends ze{constructor(){super(...arguments);p(this,"fadeMode",0);p(this,"localReferencePoint");p(this,"lodCount",0);p(this,"size",0);p(this,"animateCrossFading",!1);p(this,"lodModels");p(this,"_lods",[]);p(this,"_settings",[]);p(this,"_lodsHandler");p(this,"_distanceFactor",1)}start(){if(DD&&console.log("LODGROUP",this.name,this.lodModels,this),!oUe&&!this._lodsHandler&&this.gameObject&&this.lodModels&&Array.isArray(this.lodModels)){const t=[];for(const n of this.lodModels){const r=new aUe(n);this._lods.push(r);for(const o of r.renderers)t.includes(o)||t.push(o)}this._lodsHandler=new Array;for(let n=0;n<t.length;n++){const r=new UU;this._lodsHandler.push(r),this.gameObject.add(r)}const i=new ye;i.name="Cull "+this.name;for(let n=0;n<t.length;n++){const r=t[n],o=this._lodsHandler[n],a=r.gameObject;DD&&console.log(n,a.name);for(const l of this._lods){const c=l.model.distance;let h=null;if(l.renderers.includes(r)?h=a:h=i,h.type==="Group"){console.warn(`LODGroup ${this.name}: Group or MultiMaterial object's are not supported as LOD object: ${h.name}`);continue}DD&&console.log("LEVEL",h.name,c),o.autoUpdate=!1,this.onAddLodLevel(o,h,l.model.distance)}}}}onAfterRender(){if(!this.gameObject||!this._lodsHandler)return;const t=this.context.mainCamera;if(t)for(const i of this._lodsHandler){i.update(t);const n=i.getCurrentLevel(),r=i.levels[n];i.layers.mask=r.object.layers.mask}}onAddLodLevel(t,i,n){if(i===this.gameObject){console.warn("LODGroup component must be on parent object and not mesh directly at the moment",i.name,i);return}t.addLevel(i,n*this._distanceFactor,.01);const r={lod:t,levelIndex:t.levels.length-1,distance:n};this._settings.push(r)}distanceFactor(t){if(t!==this._distanceFactor){this._distanceFactor=t;for(const i of this._settings){const n=i.lod.levels[i.levelIndex];n.distance=i.distance*t}}}}FM([I(T)],VM.prototype,"localReferencePoint",2);FM([I(VA)],VM.prototype,"lodModels",2);const lUe=ee("logstats");class yZ extends ze{onEnable(){console.log(this),lUe&&this.startCoroutine(this.run(),wn.OnAfterRender)}*run(){for(;this.enabled;){const e=this.context.renderer.info;console.log(e.memory,e.render,e.programs),yield}}}var cUe=Object.defineProperty,hUe=Object.getOwnPropertyDescriptor,qP=(s,e,t,i)=>{for(var n=i>1?void 0:i?hUe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&cUe(e,t,n),n},BF;const Sae=(BF=class extends ze{constructor(){super(...arguments);p(this,"target");p(this,"invertForward",!1);p(this,"keepUpDirection",!0);p(this,"copyTargetRotation",!1)}onBeforeRender(){let e=this.target;if(e||(e=this.context.mainCamera),!e)return;let t=this.copyTargetRotation;(this.context.isInVR||this.context.isInPassThrough)&&(t=!1),q1(this.gameObject,e,this.keepUpDirection,t),this.invertForward&&this.gameObject.quaternion.multiply(Sae.flipYQuat)}createBehaviours(e,t,i){if(t.uuid===this.gameObject.uuid){let n=t;if(this.keepUpDirection){const o=Co.createEmptyParent(t);n=o;const a=this.invertForward?-1:1;o.setMatrix(o.getMatrix().multiply(new ce().makeRotationZ(Math.PI/2*a))),t.setMatrix(t.getMatrix().multiply(new ce().makeRotationZ(-Math.PI/2*a)))}const r=new er("lookat "+this.name,Or.sceneStartTrigger(),zi.lookAtCameraAction(n,void 0,this.invertForward?Pb.back:Pb.forward,this.keepUpDirection?Pb.up:Pb.zero));e.addBehavior(r)}}},p(BF,"flipYQuat",new Ve().setFromAxisAngle(new T(0,1,0),Math.PI)),BF);let zA=Sae;qP([I(ye)],zA.prototype,"target",2);qP([I()],zA.prototype,"invertForward",2);qP([I()],zA.prototype,"keepUpDirection",2);qP([I()],zA.prototype,"copyTargetRotation",2);var dUe=Object.defineProperty,uUe=Object.getOwnPropertyDescriptor,pUe=(s,e,t,i)=>{for(var n=i>1?void 0:i?uUe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&dUe(e,t,n),n};const ME=ee("debugnestedgltf");class $P extends ze{constructor(){super(...arguments);p(this,"filePath");p(this,"loadAssetInParent",!0);p(this,"_isLoadingOrDoneLoading",!1)}listenToProgress(t){var i;(i=this.filePath)==null||i.beginListenDownload(t)}preload(){var t;(t=this.filePath)==null||t.preload()}async start(){var i,n,r,o,a;if(this._isLoadingOrDoneLoading)return;ME&&console.log(this,this.guid);const t=this.gameObject.parent;if(t){this._isLoadingOrDoneLoading=!0;const l=new Zh;l.idProvider=new So(this.hash(this.guid)),l.parent=this.loadAssetInParent!==!1?t:this.gameObject,this.gameObject.updateMatrix();const c=this.gameObject.matrix;ME&&console.log("Load nested:",((i=this.filePath)==null?void 0:i.url)??this.filePath,this.gameObject.position);const h=await((r=(n=this.filePath)==null?void 0:n.instantiate)==null?void 0:r.call(this.filePath,l));ME&&console.log("Nested loaded:",((o=this.filePath)==null?void 0:o.url)??this.filePath,h),h&&this.loadAssetInParent!==!1&&(h.matrixAutoUpdate=!1,h.matrix.identity(),h.applyMatrix4(c),h.matrixAutoUpdate=!0,h.layers.disableAll(),h.layers.set(this.layer),this.dispatchEvent(new CustomEvent("loaded",{detail:{instance:h,assetReference:this.filePath}}))),ME&&console.log("Nested loading done:",((a=this.filePath)==null?void 0:a.url)??this.filePath,h)}}onDestroy(){var t;(t=this.filePath)==null||t.unload()}hash(t){let i=0;for(let n=0;n<t.length;n++)i=t.charCodeAt(n)+((i<<5)-i);return i}}pUe([I(gi)],$P.prototype,"filePath",2);var fUe=Object.defineProperty,mUe=Object.getOwnPropertyDescriptor,bZ=(s,e,t,i)=>{for(var n=i>1?void 0:i?mUe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&fUe(e,t,n),n};const gUe=ee("debugnet"),zz=class extends ze{constructor(){super(...arguments);p(this,"url",null);p(this,"urlParameterName",null);p(this,"localhost",null)}awake(){gUe&&console.log(this),this.context.connection.registerProvider(this)}getWebsocketUrl(){let e=this.url?zz.GetUrl(this.url,this.localhost):null;if(this.urlParameterName){const r=ee(this.urlParameterName);r&&typeof r=="string"&&(e=r)}if(!e)return null;const i=new RegExp("(((https?)|(?<socket_prefix>wss?))://)?(www.)?(?<url>.+)","gm").exec(e);return i!=null&&i.groups?(i==null?void 0:i.groups.socket_prefix)?e:"wss://"+(i==null?void 0:i.groups.url):null}static GetUrl(e,t){let i=e;const n=zz.IsLocalNetwork()&&t;if(n&&(i=t),e!=null&&e.startsWith("/")){const r=n?i:window.location.origin;r!=null&&r.endsWith("/")&&e.startsWith("/")&&(e=e.substring(1)),i=r+e}return i}static IsLocalNetwork(e=window.location.hostname){return ka(e)}};let Iv=zz;bZ([I()],Iv.prototype,"url",2);bZ([I()],Iv.prototype,"urlParameterName",2);bZ([I()],Iv.prototype,"localhost",2);var AUe=Object.defineProperty,yUe=Object.getOwnPropertyDescriptor,eG=(s,e,t,i)=>{for(var n=i>1?void 0:i?yUe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&AUe(e,t,n),n};class UA extends ze{constructor(){super(...arguments);p(this,"referenceSpace");p(this,"from");p(this,"affectPosition",!1);p(this,"affectRotation",!1);p(this,"alignLookDirection",!1);p(this,"levelLookDirection",!1);p(this,"levelPosition",!1);p(this,"positionOffset",new T(0,0,0));p(this,"rotationOffset",new T(0,0,0));p(this,"offset",new T(0,0,0))}update(){if(!this.from)return;var t=$t(this.from),i=gn(this.from);this.offset.copy(this.positionOffset);const n=this.offset.length();if(this.referenceSpace&&this.offset.transformDirection(this.referenceSpace.matrixWorld).multiplyScalar(n),t.add(this.offset),this.levelPosition&&this.referenceSpace){const l=new js(this.gameObject.up,0),c=$t(this.referenceSpace);l.setFromNormalAndCoplanarPoint(this.gameObject.up,c);const h=new T(0,0,0);l.projectPoint(t,h),t.copy(h)}this.affectPosition&&_r(this.gameObject,t);const r=new Xi(this.rotationOffset.x,this.rotationOffset.y,this.rotationOffset.z),o=new Ve().setFromEuler(r);this.affectRotation&&Uc(this.gameObject,i.multiply(o));const a=new T;this.from.getWorldDirection(a).multiplyScalar(50),this.levelLookDirection&&(a.y=0),this.alignLookDirection&&this.gameObject.lookAt(a)}}eG([I($)],UA.prototype,"referenceSpace",2);eG([I($)],UA.prototype,"from",2);eG([I(T)],UA.prototype,"positionOffset",2);eG([I(T)],UA.prototype,"rotationOffset",2);var bUe=Object.defineProperty,xUe=Object.getOwnPropertyDescriptor,xZ=(s,e,t,i)=>{for(var n=i>1?void 0:i?xUe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&bUe(e,t,n),n};class Tv extends ze{constructor(){super(...arguments);p(this,"url");p(this,"mode",0);p(this,"clickable",!0)}async open(){if(!this.url){console.warn("OpenURL: URL is not set, can't open.",this);return}this._validateUrl();let t=this.url;switch(!t.startsWith("mailto:")&&t.includes("@")&&(t="mailto:"+t),Qe()&&is("Open URL: "+t),this.mode){case 0:exports.DeviceUtilities.isSafari(),globalThis.open(t,"_blank");break;case 1:exports.DeviceUtilities.isSafari()&&exports.DeviceUtilities.isiOS()?globalThis.open(t,"_top"):globalThis.open(t,"_self");break;case 2:exports.DeviceUtilities.isSafari()?globalThis.open(t,"_top"):globalThis.open(t,"_new");break}}start(){this.gameObject.getComponentInParent(nc)||this.gameObject.addComponent(nc)}onPointerEnter(t){!t.used&&this.clickable&&this.context.input.setCursorPointer()}onPointerExit(){this.clickable&&this.context.input.setCursorNormal()}onPointerClick(t){var i;this.clickable&&!t.used&&((i=this.url)!=null&&i.length)&&this.open()}_validateUrl(){this.url&&this.url.startsWith("www.")&&(Qe()&&console.warn("URL is not valid, adding https:// to the start of the URL",this.url),this.url="https://"+this.url)}}xZ([I()],Tv.prototype,"url",2);xZ([I()],Tv.prototype,"mode",2);xZ([I()],Tv.prototype,"clickable",2);const Yo=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let ZY=1234567;const Mae=Math.PI/180,Iae=180/Math.PI;function vUe(){const s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Yo[s&255]+Yo[s>>8&255]+Yo[s>>16&255]+Yo[s>>24&255]+"-"+Yo[e&255]+Yo[e>>8&255]+"-"+Yo[e>>16&15|64]+Yo[e>>24&255]+"-"+Yo[t&63|128]+Yo[t>>8&255]+"-"+Yo[t>>16&255]+Yo[t>>24&255]+Yo[i&255]+Yo[i>>8&255]+Yo[i>>16&255]+Yo[i>>24&255]).toLowerCase()}function yd(s,e,t){return Math.max(e,Math.min(t,s))}function Tae(s,e){return(s%e+e)%e}function _Ue(s,e,t,i,n){return i+(s-e)*(n-i)/(t-e)}function CUe(s,e,t){return s!==e?(t-s)/(e-s):0}function Eae(s,e,t){return(1-t)*s+t*e}function wUe(s,e,t,i){return Eae(s,e,1-Math.exp(-t*i))}function SUe(s,e=1){return e-Math.abs(Tae(s,e*2)-e)}function MUe(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*(3-2*s))}function IUe(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*s*(s*(s*6-15)+10))}function TUe(s,e){return s+Math.floor(Math.random()*(e-s+1))}function EUe(s,e){return s+Math.random()*(e-s)}function RUe(s){return s*(.5-Math.random())}function LUe(s){s!==void 0&&(ZY=s);let e=ZY+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function BUe(s){return s*Mae}function PUe(s){return s*Iae}function GUe(s){return(s&s-1)===0&&s!==0}function kUe(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function NUe(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function DUe(s,e,t,i,n){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),c=r((e+i)/2),h=o((e+i)/2),d=r((e-i)/2),u=o((e-i)/2),f=r((i-e)/2),m=o((i-e)/2);switch(n){case"XYX":s.set(a*h,l*d,l*u,a*c);break;case"YZY":s.set(l*u,a*h,l*d,a*c);break;case"ZXZ":s.set(l*d,l*u,a*h,a*c);break;case"XZX":s.set(a*h,l*m,l*f,a*c);break;case"YXY":s.set(l*f,a*h,l*m,a*c);break;case"ZYZ":s.set(l*m,l*f,a*h,a*c);break;default:console.warn("../math.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function FUe(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return s/4294967295;case Uint16Array:return s/65535;case Uint8Array:return s/255;case Int32Array:return Math.max(s/2147483647,-1);case Int16Array:return Math.max(s/32767,-1);case Int8Array:return Math.max(s/127,-1);default:throw new Error("Invalid component type.")}}function VUe(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return Math.round(s*4294967295);case Uint16Array:return Math.round(s*65535);case Uint8Array:return Math.round(s*255);case Int32Array:return Math.round(s*2147483647);case Int16Array:return Math.round(s*32767);case Int8Array:return Math.round(s*127);default:throw new Error("Invalid component type.")}}const Ev={DEG2RAD:Mae,RAD2DEG:Iae,generateUUID:vUe,clamp:yd,euclideanModulo:Tae,mapLinear:_Ue,inverseLerp:CUe,lerp:Eae,damp:wUe,pingpong:SUe,smoothstep:MUe,smootherstep:IUe,randInt:TUe,randFloat:EUe,randFloatSpread:RUe,seededRandom:LUe,degToRad:BUe,radToDeg:PUe,isPowerOfTwo:GUe,ceilPowerOfTwo:kUe,floorPowerOfTwo:NUe,setQuaternionFromProperEuler:DUe,normalize:VUe,denormalize:FUe};class Dn{constructor(e=0,t=0,i=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,o,a){let l=i[n+0],c=i[n+1],h=i[n+2],d=i[n+3];const u=r[o+0],f=r[o+1],m=r[o+2],g=r[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d;return}if(a===1){e[t+0]=u,e[t+1]=f,e[t+2]=m,e[t+3]=g;return}if(d!==g||l!==u||c!==f||h!==m){let A=1-a;const y=l*u+c*f+h*m+d*g,b=y>=0?1:-1,x=1-y*y;if(x>Number.EPSILON){const _=Math.sqrt(x),C=Math.atan2(_,y*b);A=Math.sin(A*C)/_,a=Math.sin(a*C)/_}const v=a*b;if(l=l*A+u*v,c=c*A+f*v,h=h*A+m*v,d=d*A+g*v,A===1-a){const _=1/Math.sqrt(l*l+c*c+h*h+d*d);l*=_,c*=_,h*=_,d*=_}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,n,r,o){const a=i[n],l=i[n+1],c=i[n+2],h=i[n+3],d=r[o],u=r[o+1],f=r[o+2],m=r[o+3];return e[t]=a*m+h*d+l*f-c*u,e[t+1]=l*m+h*u+c*d-a*f,e[t+2]=c*m+h*f+a*u-l*d,e[t+3]=h*m-a*d-l*u-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new Dn(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,n=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(n/2),d=a(r/2),u=l(i/2),f=l(n/2),m=l(r/2);switch(o){case"XYZ":this._x=u*h*d+c*f*m,this._y=c*f*d-u*h*m,this._z=c*h*m+u*f*d,this._w=c*h*d-u*f*m;break;case"YXZ":this._x=u*h*d+c*f*m,this._y=c*f*d-u*h*m,this._z=c*h*m-u*f*d,this._w=c*h*d+u*f*m;break;case"ZXY":this._x=u*h*d-c*f*m,this._y=c*f*d+u*h*m,this._z=c*h*m+u*f*d,this._w=c*h*d-u*f*m;break;case"ZYX":this._x=u*h*d-c*f*m,this._y=c*f*d+u*h*m,this._z=c*h*m-u*f*d,this._w=c*h*d+u*f*m;break;case"YZX":this._x=u*h*d+c*f*m,this._y=c*f*d+u*h*m,this._z=c*h*m-u*f*d,this._w=c*h*d-u*f*m;break;case"XZY":this._x=u*h*d-c*f*m,this._y=c*f*d-u*h*m,this._z=c*h*m+u*f*d,this._w=c*h*d+u*f*m;break;default:console.warn("../math.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],r=t[8],o=t[1],a=t[5],l=t[9],c=t[2],h=t[6],d=t[10],u=i+a+d;if(u>0){const f=.5/Math.sqrt(u+1);this._w=.25/f,this._x=(h-l)*f,this._y=(r-c)*f,this._z=(o-n)*f}else if(i>a&&i>d){const f=2*Math.sqrt(1+i-a-d);this._w=(h-l)/f,this._x=.25*f,this._y=(n+o)/f,this._z=(r+c)/f}else if(a>d){const f=2*Math.sqrt(1+a-i-d);this._w=(r-c)/f,this._x=(n+o)/f,this._y=.25*f,this._z=(l+h)/f}else{const f=2*Math.sqrt(1+d-i-a);this._w=(o-n)/f,this._x=(r+c)/f,this._y=(l+h)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(yd(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,r=e._z,o=e._w,a=t._x,l=t._y,c=t._z,h=t._w;return this._x=i*h+o*a+n*c-r*l,this._y=n*h+o*l+r*a-i*c,this._z=r*h+o*c+i*l-n*a,this._w=o*h-i*a-n*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,n=this._y,r=this._z,o=this._w;let a=o*e._w+i*e._x+n*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*i+t*this._x,this._y=f*n+t*this._y,this._z=f*r+t*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),d=Math.sin((1-t)*h)/c,u=Math.sin(t*h)/c;return this._w=o*d+this._w*u,this._x=i*d+this._x*u,this._y=n*d+this._y*u,this._z=r*d+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(n*Math.sin(e),n*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Pt{constructor(e=0,t=0,i=0){this.isVector3=!0,Pt.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new Pt(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(WY.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(WY.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*n-a*i),h=2*(a*t-r*n),d=2*(r*i-o*t);return this.x=t+l*c+o*d-a*h,this.y=i+l*h+a*c-r*d,this.z=n+l*d+r*h-o*c,this}transformDirection(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=n*l-r*a,this.y=r*o-i*l,this.z=i*a-n*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return FD.copy(this).projectOnVector(e),this.sub(FD)}reflect(e){return this.sub(FD.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(yd(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const FD=new Pt,WY=new Dn,IE=2e3,HY=2001;class Cp{constructor(e,t,i,n,r,o,a,l,c,h,d,u,f,m,g,A){this.isMatrix4=!0,Cp.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,n,r,o,a,l,c,h,d,u,f,m,g,A)}extractPosition(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)}multiplyToArray(e,t,i){return console.error("THREE.Matrix4: .multiplyToArray() has been removed."),this}setRotationFromQuaternion(e){return this.makeRotationFromQuaternion(e)}set(e,t,i,n,r,o,a,l,c,h,d,u,f,m,g,A){const y=this.elements;return y[0]=e,y[4]=t,y[8]=i,y[12]=n,y[1]=r,y[5]=o,y[9]=a,y[13]=l,y[2]=c,y[6]=h,y[10]=d,y[14]=u,y[3]=f,y[7]=m,y[11]=g,y[15]=A,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Cp().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/Vy.setFromMatrixColumn(e,0).length(),r=1/Vy.setFromMatrixColumn(e,1).length(),o=1/Vy.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(n),c=Math.sin(n),h=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){const u=o*h,f=o*d,m=a*h,g=a*d;t[0]=l*h,t[4]=-l*d,t[8]=c,t[1]=f+m*c,t[5]=u-g*c,t[9]=-a*l,t[2]=g-u*c,t[6]=m+f*c,t[10]=o*l}else if(e.order==="YXZ"){const u=l*h,f=l*d,m=c*h,g=c*d;t[0]=u+g*a,t[4]=m*a-f,t[8]=o*c,t[1]=o*d,t[5]=o*h,t[9]=-a,t[2]=f*a-m,t[6]=g+u*a,t[10]=o*l}else if(e.order==="ZXY"){const u=l*h,f=l*d,m=c*h,g=c*d;t[0]=u-g*a,t[4]=-o*d,t[8]=m+f*a,t[1]=f+m*a,t[5]=o*h,t[9]=g-u*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const u=o*h,f=o*d,m=a*h,g=a*d;t[0]=l*h,t[4]=m*c-f,t[8]=u*c+g,t[1]=l*d,t[5]=g*c+u,t[9]=f*c-m,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const u=o*l,f=o*c,m=a*l,g=a*c;t[0]=l*h,t[4]=g-u*d,t[8]=m*d+f,t[1]=d,t[5]=o*h,t[9]=-a*h,t[2]=-c*h,t[6]=f*d+m,t[10]=u-g*d}else if(e.order==="XZY"){const u=o*l,f=o*c,m=a*l,g=a*c;t[0]=l*h,t[4]=-d,t[8]=c*h,t[1]=u*d+g,t[5]=o*h,t[9]=f*d-m,t[2]=m*d-f,t[6]=a*h,t[10]=g*d+u}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(zUe,e,UUe)}lookAt(e,t,i){const n=this.elements;return _l.subVectors(e,t),_l.lengthSq()===0&&(_l.z=1),_l.normalize(),gf.crossVectors(i,_l),gf.lengthSq()===0&&(Math.abs(i.z)===1?_l.x+=1e-4:_l.z+=1e-4,_l.normalize(),gf.crossVectors(i,_l)),gf.normalize(),TE.crossVectors(_l,gf),n[0]=gf.x,n[4]=TE.x,n[8]=_l.x,n[1]=gf.y,n[5]=TE.y,n[9]=_l.y,n[2]=gf.z,n[6]=TE.z,n[10]=_l.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],h=i[1],d=i[5],u=i[9],f=i[13],m=i[2],g=i[6],A=i[10],y=i[14],b=i[3],x=i[7],v=i[11],_=i[15],C=n[0],S=n[4],M=n[8],L=n[12],w=n[1],E=n[5],B=n[9],P=n[13],k=n[2],X=n[6],F=n[10],H=n[14],W=n[3],se=n[7],de=n[11],be=n[15];return r[0]=o*C+a*w+l*k+c*W,r[4]=o*S+a*E+l*X+c*se,r[8]=o*M+a*B+l*F+c*de,r[12]=o*L+a*P+l*H+c*be,r[1]=h*C+d*w+u*k+f*W,r[5]=h*S+d*E+u*X+f*se,r[9]=h*M+d*B+u*F+f*de,r[13]=h*L+d*P+u*H+f*be,r[2]=m*C+g*w+A*k+y*W,r[6]=m*S+g*E+A*X+y*se,r[10]=m*M+g*B+A*F+y*de,r[14]=m*L+g*P+A*H+y*be,r[3]=b*C+x*w+v*k+_*W,r[7]=b*S+x*E+v*X+_*se,r[11]=b*M+x*B+v*F+_*de,r[15]=b*L+x*P+v*H+_*be,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],a=e[5],l=e[9],c=e[13],h=e[2],d=e[6],u=e[10],f=e[14],m=e[3],g=e[7],A=e[11],y=e[15];return m*(+r*l*d-n*c*d-r*a*u+i*c*u+n*a*f-i*l*f)+g*(+t*l*f-t*c*u+r*o*u-n*o*f+n*c*h-r*l*h)+A*(+t*c*d-t*a*f-r*o*d+i*o*f+r*a*h-i*c*h)+y*(-n*a*h-t*l*d+t*a*u+n*o*d-i*o*u+i*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],u=e[10],f=e[11],m=e[12],g=e[13],A=e[14],y=e[15],b=d*A*c-g*u*c+g*l*f-a*A*f-d*l*y+a*u*y,x=m*u*c-h*A*c-m*l*f+o*A*f+h*l*y-o*u*y,v=h*g*c-m*d*c+m*a*f-o*g*f-h*a*y+o*d*y,_=m*d*l-h*g*l-m*a*u+o*g*u+h*a*A-o*d*A,C=t*b+i*x+n*v+r*_;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/C;return e[0]=b*S,e[1]=(g*u*r-d*A*r-g*n*f+i*A*f+d*n*y-i*u*y)*S,e[2]=(a*A*r-g*l*r+g*n*c-i*A*c-a*n*y+i*l*y)*S,e[3]=(d*l*r-a*u*r-d*n*c+i*u*c+a*n*f-i*l*f)*S,e[4]=x*S,e[5]=(h*A*r-m*u*r+m*n*f-t*A*f-h*n*y+t*u*y)*S,e[6]=(m*l*r-o*A*r-m*n*c+t*A*c+o*n*y-t*l*y)*S,e[7]=(o*u*r-h*l*r+h*n*c-t*u*c-o*n*f+t*l*f)*S,e[8]=v*S,e[9]=(m*d*r-h*g*r-m*i*f+t*g*f+h*i*y-t*d*y)*S,e[10]=(o*g*r-m*a*r+m*i*c-t*g*c-o*i*y+t*a*y)*S,e[11]=(h*a*r-o*d*r-h*i*c+t*d*c+o*i*f-t*a*f)*S,e[12]=_*S,e[13]=(h*g*n-m*d*n+m*i*u-t*g*u-h*i*A+t*d*A)*S,e[14]=(m*a*n-o*g*n-m*i*l+t*g*l+o*i*A-t*a*A)*S,e[15]=(o*d*n-h*a*n+h*i*l-t*d*l-o*i*u+t*a*u)*S,this}scale(e){const t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,a=e.y,l=e.z,c=r*o,h=r*a;return this.set(c*o+i,c*a-n*l,c*l+n*a,0,c*a+n*l,h*a+i,h*l-n*o,0,c*l-n*a,h*l+n*o,r*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,o){return this.set(1,i,r,0,e,1,o,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,c=r+r,h=o+o,d=a+a,u=r*c,f=r*h,m=r*d,g=o*h,A=o*d,y=a*d,b=l*c,x=l*h,v=l*d,_=i.x,C=i.y,S=i.z;return n[0]=(1-(g+y))*_,n[1]=(f+v)*_,n[2]=(m-x)*_,n[3]=0,n[4]=(f-v)*C,n[5]=(1-(u+y))*C,n[6]=(A+b)*C,n[7]=0,n[8]=(m+x)*S,n[9]=(A-b)*S,n[10]=(1-(u+g))*S,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let r=Vy.set(n[0],n[1],n[2]).length();const o=Vy.set(n[4],n[5],n[6]).length(),a=Vy.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],uh.copy(this);const c=1/r,h=1/o,d=1/a;return uh.elements[0]*=c,uh.elements[1]*=c,uh.elements[2]*=c,uh.elements[4]*=h,uh.elements[5]*=h,uh.elements[6]*=h,uh.elements[8]*=d,uh.elements[9]*=d,uh.elements[10]*=d,t.setFromRotationMatrix(uh),i.x=r,i.y=o,i.z=a,this}makePerspective(e,t,i,n,r,o,a=IE){const l=this.elements,c=2*r/(t-e),h=2*r/(i-n),d=(t+e)/(t-e),u=(i+n)/(i-n);let f,m;if(a===IE)f=-(o+r)/(o-r),m=-2*o*r/(o-r);else if(a===HY)f=-o/(o-r),m=-o*r/(o-r);else throw new Error("Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=h,l[9]=u,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,n,r,o,a=IE){const l=this.elements,c=1/(t-e),h=1/(i-n),d=1/(o-r),u=(t+e)*c,f=(i+n)*h;let m,g;if(a===IE)m=(o+r)*d,g=-2*d;else if(a===HY)m=r*d,g=-1*d;else throw new Error("../math.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-u,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=g,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Vy=new Pt,uh=new Cp,zUe=new Pt(0,0,0),UUe=new Pt(1,1,1),gf=new Pt,TE=new Pt,_l=new Pt,QY=new Cp,KY=new Dn;class ES{constructor(e=0,t=0,i=0,n=ES.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new ES(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const n=e.elements,r=n[0],o=n[4],a=n[8],l=n[1],c=n[5],h=n[9],d=n[2],u=n[6],f=n[10];switch(t){case"XYZ":this._y=Math.asin(yd(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(u,c),this._z=0);break;case"YXZ":this._x=Math.asin(-yd(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(yd(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-yd(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(u,f),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(yd(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-yd(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(u,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,f),this._y=0);break;default:console.warn("../math.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return QY.makeRotationFromQuaternion(e),this.setFromRotationMatrix(QY,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return KY.setFromEuler(this),this.setFromQuaternion(KY,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(e){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ES.DEFAULT_ORDER="XYZ";class Px{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new Px(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(yd(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*n+e.x,this.y=r*n+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Px.isVector2=!0;class cl{constructor(e=0,t=0,i=0,n=1){cl.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new cl(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*n+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r;const l=e.elements,c=l[0],h=l[4],d=l[8],u=l[1],f=l[5],m=l[9],g=l[2],A=l[6],y=l[10];if(Math.abs(h-u)<.01&&Math.abs(d-g)<.01&&Math.abs(m-A)<.01){if(Math.abs(h+u)<.1&&Math.abs(d+g)<.1&&Math.abs(m+A)<.1&&Math.abs(c+f+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const x=(c+1)/2,v=(f+1)/2,_=(y+1)/2,C=(h+u)/4,S=(d+g)/4,M=(m+A)/4;return x>v&&x>_?x<.01?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(x),n=C/i,r=S/i):v>_?v<.01?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(v),i=C/n,r=M/n):_<.01?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(_),i=S/r,n=M/r),this.set(i,n,r,t),this}let b=Math.sqrt((A-m)*(A-m)+(d-g)*(d-g)+(u-h)*(u-h));return Math.abs(b)<.001&&(b=1),this.x=(A-m)/b,this.y=(d-g)/b,this.z=(u-h)/b,this.w=Math.acos((c+f+y-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class kd{constructor(e,t,i,n,r,o,a,l,c){kd.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,n,r,o,a,l,c)}set(e,t,i,n,r,o,a,l,c){const h=this.elements;return h[0]=e,h[1]=n,h[2]=a,h[3]=t,h[4]=r,h[5]=l,h[6]=i,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],h=i[4],d=i[7],u=i[2],f=i[5],m=i[8],g=n[0],A=n[3],y=n[6],b=n[1],x=n[4],v=n[7],_=n[2],C=n[5],S=n[8];return r[0]=o*g+a*b+l*_,r[3]=o*A+a*x+l*C,r[6]=o*y+a*v+l*S,r[1]=c*g+h*b+d*_,r[4]=c*A+h*x+d*C,r[7]=c*y+h*v+d*S,r[2]=u*g+f*b+m*_,r[5]=u*A+f*x+m*C,r[8]=u*y+f*v+m*S,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t*o*h-t*a*c-i*r*h+i*a*l+n*r*c-n*o*l}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=h*o-a*c,u=a*l-h*r,f=c*r-o*l,m=t*d+i*u+n*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/m;return e[0]=d*g,e[1]=(n*c-h*i)*g,e[2]=(a*i-n*o)*g,e[3]=u*g,e[4]=(h*t-n*l)*g,e[5]=(n*r-a*t)*g,e[6]=f*g,e[7]=(i*l-c*t)*g,e[8]=(o*t-i*r)*g,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-n*c,n*l,-n*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(VD.makeScale(e,t)),this}rotate(e){return this.premultiply(VD.makeRotation(-e)),this}translate(e,t){return this.premultiply(VD.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new kd().fromArray(this.elements)}}const VD=new kd;var Ra;(function(s){s[s.Random=0]="Random",s[s.Loop=1]="Loop",s[s.PingPong=2]="PingPong",s[s.Burst=3]="Burst"})(Ra||(Ra={}));function zM(s,e,t,i){let n;switch(Ra.Random===s?e=Math.random():Ra.Burst===s&&i.isBursting&&(e=i.burstParticleIndex/i.burstParticleCount),t>0?n=Math.floor(e/t)*t:n=e,s){case Ra.Loop:n=n%1;break;case Ra.PingPong:n=Math.abs(n%2-1);break}return n}class f0{constructor(e,t,i,n){this.p=[e,t,i,n]}genValue(e){const t=e*e,i=e*e*e,n=1-e,r=n*n,o=r*n;return this.p[0]*o+this.p[1]*r*e*3+this.p[2]*n*t*3+this.p[3]*i}derivativeCoefficients(e){const t=[];for(let i=e,n=i.length-1;n>0;n--){const r=[];for(let o=0;o<n;o++){const a=n*(i[o+1]-i[o]);r.push(a)}t.push(r),i=r}return t}getSlope(e){const t=this.derivativeCoefficients(this.p)[0],i=1-e,n=i*i,r=i*e*2,o=e*e;return n*t[0]+r*t[1]+o*t[2]}controlCurve(e,t){this.p[1]=e/3+this.p[0],this.p[2]=this.p[3]-t/3}hull(e){let t=this.p,i=[],n,r=0,o=0,a=0;const l=[];for(l[r++]=t[0],l[r++]=t[1],l[r++]=t[2],l[r++]=t[3];t.length>1;){for(i=[],o=0,a=t.length-1;o<a;o++)n=e*t[o]+(1-e)*t[o+1],l[r++]=n,i.push(n);t=i}return l}split(e){const t=this.hull(e);return{left:new f0(t[0],t[4],t[7],t[9]),right:new f0(t[9],t[8],t[6],t[3]),span:t}}clone(){return new f0(this.p[0],this.p[1],this.p[2],this.p[3])}toJSON(){return{p0:this.p[0],p1:this.p[1],p2:this.p[2],p3:this.p[3]}}static fromJSON(e){return new f0(e.p0,e.p1,e.p2,e.p3)}}const RS=s=>({r:s.x,g:s.y,b:s.z,a:s.w}),LS=s=>new cl(s.r,s.g,s.b,s.a),XUe=(s,e)=>{switch(e){case"Vector3":return new Pt(s.x,s.y,s.z);case"Vector4":return new cl(s.x,s.y,s.z,s.w);case"Color":return new Pt(s.r,s.g,s.b);case"Number":return s;default:return s}},OUe=(s,e)=>{switch(e){case"Vector3":return{x:s.x,y:s.y,z:s.z};case"Vector4":return{x:s.x,y:s.y,z:s.z,w:s.w};case"Color":return{r:s.x,g:s.y,b:s.z};case"Number":return s;default:return s}};class I2{constructor(e,t){this.a=e,this.b=t,this.type="value"}startGen(e){}genColor(e,t){const i=Math.random();return t.copy(this.a).lerp(this.b,i)}toJSON(){return{type:"RandomColor",a:RS(this.a),b:RS(this.b)}}static fromJSON(e){return new I2(LS(e.a),LS(e.b))}clone(){return new I2(this.a.clone(),this.b.clone())}}class Gx{constructor(e,t){this.a=e,this.b=t,this.indexCount=-1,this.type="value"}startGen(e){this.indexCount=e.length,e.push(Math.random())}genColor(e,t){return this.indexCount===-1&&this.startGen(e),t.copy(this.a).lerp(this.b,e[this.indexCount])}toJSON(){return{type:"ColorRange",a:RS(this.a),b:RS(this.b)}}static fromJSON(e){return new Gx(LS(e.a),LS(e.b))}clone(){return new Gx(this.a.clone(),this.b.clone())}}class Vf{constructor(e,t){this.subType=t,this.type="function",this.keys=e}findKey(e){let t=0,i=0,n=this.keys.length-1;for(;i+1<n;)if(t=Math.floor((i+n)/2),e<this.getStartX(t))n=t-1;else if(e>this.getEndX(t))i=t+1;else return t;for(let r=i;r<=n;r++)if(e>=this.getStartX(r)&&e<=this.getEndX(r))return r;return-1}getStartX(e){return this.keys[e][1]}getEndX(e){return e+1<this.keys.length?this.keys[e+1][1]:1}genValue(e,t){const i=this.findKey(t);return this.subType==="Number"?i===-1?this.keys[0][0]:i+1>=this.keys.length?this.keys[this.keys.length-1][0]:(this.keys[i+1][0]-this.keys[i][0])*((t-this.getStartX(i))/(this.getEndX(i)-this.getStartX(i)))+this.keys[i][0]:i===-1?e.copy(this.keys[0][0]):i+1>=this.keys.length?e.copy(this.keys[this.keys.length-1][0]):e.copy(this.keys[i][0]).lerp(this.keys[i+1][0],(t-this.getStartX(i))/(this.getEndX(i)-this.getStartX(i)))}toJSON(){return this.keys[0][0].constructor.name,{type:"CLinearFunction",subType:this.subType,keys:this.keys.map(([e,t])=>({value:OUe(e,this.subType),pos:t}))}}static fromJSON(e){return new Vf(e.keys.map(t=>[XUe(t.value,e.subType),t.pos]),e.subType)}clone(){return this.subType==="Number"?new Vf(this.keys.map(([e,t])=>[e,t]),this.subType):new Vf(this.keys.map(([e,t])=>[e.clone(),t]),this.subType)}}const EE=new Pt;class V0{constructor(e=[[new Pt(0,0,0),0],[new Pt(1,1,1),0]],t=[[1,0],[1,1]]){this.type="function",this.color=new Vf(e,"Color"),this.alpha=new Vf(t,"Number")}genColor(e,t,i){return this.color.genValue(EE,i),t.set(EE.x,EE.y,EE.z,this.alpha.genValue(1,i))}toJSON(){return{type:"Gradient",color:this.color.toJSON(),alpha:this.alpha.toJSON()}}static fromJSON(e){if(e.functions){const t=e.functions.map(i=>[Gx.fromJSON(i.function).a,i.start]);return e.functions.length>0&&t.push([Gx.fromJSON(e.functions[e.functions.length-1].function).b,1]),new V0(t.map(i=>[new Pt(i[0].x,i[0].y,i[0].z),i[1]]),t.map(i=>[i[0].w,i[1]]))}else{const t=new V0;return t.alpha=Vf.fromJSON(e.alpha),t.color=Vf.fromJSON(e.color),t}}clone(){const e=new V0;return e.alpha=this.alpha.clone(),e.color=this.color.clone(),e}startGen(e){}}const zD=new cl;class T2{constructor(e,t){this.indexCount=0,this.type="function",this.gradient1=e,this.gradient2=t}startGen(e){this.indexCount=e.length,e.push(Math.random())}genColor(e,t,i){return this.gradient1.genColor(e,t,i),this.gradient2.genColor(e,zD,i),e&&e[this.indexCount]!==void 0?t.lerp(zD,e[this.indexCount]):t.lerp(zD,Math.random()),t}toJSON(){return{type:"RandomColorBetweenGradient",gradient1:this.gradient1.toJSON(),gradient2:this.gradient2.toJSON()}}static fromJSON(e){return new T2(V0.fromJSON(e.gradient1),V0.fromJSON(e.gradient2))}clone(){return new T2(this.gradient1.clone(),this.gradient2.clone())}}class sA{constructor(e){this.color=e,this.type="value"}startGen(e){}genColor(e,t){return t.copy(this.color)}toJSON(){return{type:"ConstantColor",color:RS(this.color)}}static fromJSON(e){return new sA(LS(e.color))}clone(){return new sA(this.color.clone())}}function vZ(s){switch(s.type){case"ConstantColor":return sA.fromJSON(s);case"ColorRange":return Gx.fromJSON(s);case"RandomColor":return I2.fromJSON(s);case"Gradient":return V0.fromJSON(s);case"RandomColorBetweenGradient":return T2.fromJSON(s);default:return new sA(new cl(1,1,1,1))}}class nn{constructor(e){this.value=e,this.type="value"}startGen(e){}genValue(e){return this.value}toJSON(){return{type:"ConstantValue",value:this.value}}static fromJSON(e){return new nn(e.value)}clone(){return new nn(this.value)}}class rA{constructor(e,t){this.a=e,this.b=t,this.indexCount=-1,this.type="value"}startGen(e){this.indexCount=e.length,e.push(Math.random())}genValue(e){return this.indexCount===-1&&this.startGen(e),Ev.lerp(this.a,this.b,e[this.indexCount])}toJSON(){return{type:"IntervalValue",a:this.a,b:this.b}}static fromJSON(e){return new rA(e.a,e.b)}clone(){return new rA(this.a,this.b)}}class ZUe{constructor(){this.functions=new Array}findFunction(e){let t=0,i=0,n=this.functions.length-1;for(;i+1<n;)if(t=Math.floor((i+n)/2),e<this.getStartX(t))n=t-1;else if(e>this.getEndX(t))i=t+1;else return t;for(let r=i;r<=n;r++)if(e>=this.functions[r][1]&&e<=this.getEndX(r))return r;return-1}getStartX(e){return this.functions[e][1]}setStartX(e,t){e>0&&(this.functions[e][1]=t)}getEndX(e){return e+1<this.functions.length?this.functions[e+1][1]:1}setEndX(e,t){e+1<this.functions.length&&(this.functions[e+1][1]=t)}insertFunction(e,t){const i=this.findFunction(e);this.functions.splice(i+1,0,[t,e])}removeFunction(e){return this.functions.splice(e,1)[0][0]}getFunction(e){return this.functions[e][0]}setFunction(e,t){this.functions[e][0]=t}get numOfFunctions(){return this.functions.length}}class BS extends ZUe{constructor(e=[[new f0(0,1/3,1/3*2,1),0]]){super(),this.type="function",this.functions=e}genValue(e,t=0){const i=this.findFunction(t);return i===-1?0:this.functions[i][0].genValue((t-this.getStartX(i))/(this.getEndX(i)-this.getStartX(i)))}toSVG(e,t){if(t<1)return"";let i=["M",0,this.functions[0][0].p[0]].join(" ");for(let n=1/t;n<=1;n+=1/t)i=[i,"L",n*e,this.genValue(void 0,n)].join(" ");return i}toJSON(){return{type:"PiecewiseBezier",functions:this.functions.map(([e,t])=>({function:e.toJSON(),start:t}))}}static fromJSON(e){return new BS(e.functions.map(t=>[f0.fromJSON(t.function),t.start]))}clone(){return new BS(this.functions.map(([e,t])=>[e.clone(),t]))}startGen(e){}}function ki(s){switch(s.type){case"ConstantValue":return nn.fromJSON(s);case"IntervalValue":return rA.fromJSON(s);case"PiecewiseBezier":return BS.fromJSON(s);default:return new nn(0)}}class PS{constructor(){this.indexCount=0,this.type="rotation"}startGen(e){this.indexCount=e.length,e.push(new Dn);let t,i,n,r,o,a;do t=Math.random()*2-1,i=Math.random()*2-1,n=t*t+i*i;while(n>1);do r=Math.random()*2-1,o=Math.random()*2-1,a=r*r+o*o;while(a>1);const l=Math.sqrt((1-n)/a);e[this.indexCount].set(t,i,l*r,l*o)}genValue(e,t,i,n){return this.indexCount===-1&&this.startGen(e),t.copy(e[this.indexCount]),t}toJSON(){return{type:"RandomQuat"}}static fromJSON(e){return new PS}clone(){return new PS}}class GS{constructor(e,t){this.axis=e,this.angle=t,this.type="rotation"}startGen(e){this.angle.startGen(e)}genValue(e,t,i,n){return t.setFromAxisAngle(this.axis,this.angle.genValue(e,n)*i)}toJSON(){return{type:"AxisAngle",axis:{x:this.axis.x,y:this.axis.y,z:this.axis.z},angle:this.angle.toJSON()}}static fromJSON(e){return new GS(new Pt(e.axis.x,e.axis.y,e.axis.z),ki(e.angle))}clone(){return new GS(this.axis.clone(),this.angle.clone())}}class E2{constructor(e,t,i,n){this.angleX=e,this.angleY=t,this.angleZ=i,this.type="rotation",this.eular=new ES(0,0,0,n)}startGen(e){this.angleX.startGen(e),this.angleY.startGen(e),this.angleZ.startGen(e)}genValue(e,t,i,n){return this.eular.set(this.angleX.genValue(e,n)*i,this.angleY.genValue(e,n)*i,this.angleZ.genValue(e,n)*i),t.setFromEuler(this.eular)}toJSON(){return{type:"Euler",angleX:this.angleX.toJSON(),angleY:this.angleY.toJSON(),angleZ:this.angleZ.toJSON(),eulerOrder:this.eular.order}}static fromJSON(e){return new E2(ki(e.angleX),ki(e.angleY),ki(e.angleZ),e.eulerOrder)}clone(){return new E2(this.angleX,this.angleY,this.angleZ,this.eular.order)}}function Rae(s){switch(s.type){case"AxisAngle":return GS.fromJSON(s);case"Euler":return E2.fromJSON(s);case"RandomQuat":return PS.fromJSON(s);default:return new PS}}class oA{constructor(e,t,i){this.x=e,this.y=t,this.z=i,this.type="vec3function"}startGen(e){this.x.startGen(e),this.y.startGen(e),this.z.startGen(e)}genValue(e,t,i){return t.set(this.x.genValue(e,i),this.y.genValue(e,i),this.z.genValue(e,i))}toJSON(){return{type:"Vector3Function",x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}static fromJSON(e){return new oA(ki(e.x),ki(e.y),ki(e.z))}clone(){return new oA(this.x,this.y,this.z)}}function WUe(s){switch(s.type){case"Vector3Function":return oA.fromJSON(s);default:return new oA(new nn(0),new nn(0),new nn(0))}}function R2(s){switch(s.type){case"ConstantValue":case"IntervalValue":case"PiecewiseBezier":return ki(s);case"AxisAngle":case"RandomQuat":case"Euler":return Rae(s);case"Vector3Function":return WUe(s);default:return new nn(0)}}class kS{constructor(e={}){var t,i,n,r,o,a,l;this.type="cone",this.currentValue=0,this.radius=(t=e.radius)!==null&&t!==void 0?t:10,this.arc=(i=e.arc)!==null&&i!==void 0?i:2*Math.PI,this.thickness=(n=e.thickness)!==null&&n!==void 0?n:1,this.angle=(r=e.angle)!==null&&r!==void 0?r:Math.PI/6,this.mode=(o=e.mode)!==null&&o!==void 0?o:Ra.Random,this.spread=(a=e.spread)!==null&&a!==void 0?a:0,this.speed=(l=e.speed)!==null&&l!==void 0?l:new nn(1),this.memory=[]}update(e,t){Ra.Random!=this.mode&&(this.currentValue+=this.speed.genValue(this.memory,e.emissionState.time/e.duration)*t)}initialize(e,t){const i=zM(this.mode,this.currentValue,this.spread,t),n=Ev.lerp(1-this.thickness,1,Math.random()),r=i*this.arc,o=Math.sqrt(n),a=Math.sin(r),l=Math.cos(r);e.position.x=o*l,e.position.y=o*a,e.position.z=0;const c=this.angle*o;e.velocity.set(0,0,Math.cos(c)).addScaledVector(e.position,Math.sin(c)).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius)}toJSON(){return{type:"cone",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new kS({radius:e.radius,arc:e.arc,thickness:e.thickness,angle:e.angle,mode:e.mode,speed:e.speed?ki(e.speed):void 0,spread:e.spread})}clone(){return new kS({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class NS{constructor(e={}){var t,i,n,r,o,a;this.type="circle",this.currentValue=0,this.radius=(t=e.radius)!==null&&t!==void 0?t:10,this.arc=(i=e.arc)!==null&&i!==void 0?i:2*Math.PI,this.thickness=(n=e.thickness)!==null&&n!==void 0?n:1,this.mode=(r=e.mode)!==null&&r!==void 0?r:Ra.Random,this.spread=(o=e.spread)!==null&&o!==void 0?o:0,this.speed=(a=e.speed)!==null&&a!==void 0?a:new nn(1),this.memory=[]}update(e,t){this.currentValue+=this.speed.genValue(this.memory,e.emissionState.time/e.duration)*t}initialize(e,t){const i=zM(this.mode,this.currentValue,this.spread,t),n=Ev.lerp(1-this.thickness,1,Math.random()),r=i*this.arc;e.position.x=Math.cos(r),e.position.y=Math.sin(r),e.position.z=0,e.velocity.copy(e.position).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius*n)}toJSON(){return{type:"circle",radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new NS({radius:e.radius,arc:e.arc,thickness:e.thickness,mode:e.mode,speed:e.speed?ki(e.speed):void 0,spread:e.spread})}clone(){return new NS({radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class DS{constructor(e={}){var t,i,n,r,o,a,l;this.type="donut",this.currentValue=0,this.radius=(t=e.radius)!==null&&t!==void 0?t:10,this.arc=(i=e.arc)!==null&&i!==void 0?i:2*Math.PI,this.thickness=(n=e.thickness)!==null&&n!==void 0?n:1,this.donutRadius=(r=e.donutRadius)!==null&&r!==void 0?r:this.radius*.2,this.mode=(o=e.mode)!==null&&o!==void 0?o:Ra.Random,this.spread=(a=e.spread)!==null&&a!==void 0?a:0,this.speed=(l=e.speed)!==null&&l!==void 0?l:new nn(1),this.memory=[]}update(e,t){Ra.Random!=this.mode&&(this.currentValue+=this.speed.genValue(this.memory,e.emissionState.time/e.duration)*t)}initialize(e,t){const i=zM(this.mode,this.currentValue,this.spread,t),n=Math.random(),r=Ev.lerp(1-this.thickness,1,Math.random()),o=i*this.arc,a=n*Math.PI*2,l=Math.sin(o),c=Math.cos(o);e.position.x=this.radius*c,e.position.y=this.radius*l,e.position.z=0,e.velocity.z=this.donutRadius*r*Math.sin(a),e.velocity.x=this.donutRadius*r*Math.cos(a)*c,e.velocity.y=this.donutRadius*r*Math.cos(a)*l,e.position.add(e.velocity),e.velocity.normalize().multiplyScalar(e.startSpeed)}toJSON(){return{type:"donut",radius:this.radius,arc:this.arc,thickness:this.thickness,donutRadius:this.donutRadius,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new DS({radius:e.radius,arc:e.arc,thickness:e.thickness,donutRadius:e.donutRadius,mode:e.mode,speed:e.speed?ki(e.speed):void 0,spread:e.spread})}clone(){return new DS({radius:this.radius,arc:this.arc,thickness:this.thickness,donutRadius:this.donutRadius,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class FS{constructor(){this.type="point"}update(e,t){}initialize(e){const t=Math.random(),i=Math.random(),n=t*Math.PI*2,r=Math.acos(2*i-1),o=Math.cbrt(Math.random()),a=Math.sin(n),l=Math.cos(n),c=Math.sin(r),h=Math.cos(r);e.velocity.x=o*c*l,e.velocity.y=o*c*a,e.velocity.z=o*h,e.velocity.multiplyScalar(e.startSpeed),e.position.setScalar(0)}toJSON(){return{type:"point"}}static fromJSON(e){return new FS}clone(){return new FS}}class kx{constructor(e={}){var t,i,n,r,o,a;this.type="sphere",this.currentValue=0,this.radius=(t=e.radius)!==null&&t!==void 0?t:10,this.arc=(i=e.arc)!==null&&i!==void 0?i:2*Math.PI,this.thickness=(n=e.thickness)!==null&&n!==void 0?n:1,this.mode=(r=e.mode)!==null&&r!==void 0?r:Ra.Random,this.spread=(o=e.spread)!==null&&o!==void 0?o:0,this.speed=(a=e.speed)!==null&&a!==void 0?a:new nn(1),this.memory=[]}update(e,t){Ra.Random!=this.mode&&(this.currentValue+=this.speed.genValue(this.memory,e.emissionState.time/e.duration)*t)}initialize(e,t){const i=zM(this.mode,this.currentValue,this.spread,t),n=Math.random(),r=Ev.lerp(1-this.thickness,1,Math.random()),o=i*this.arc,a=Math.acos(2*n-1),l=Math.sin(o),c=Math.cos(o),h=Math.sin(a),d=Math.cos(a);e.position.x=h*c,e.position.y=h*l,e.position.z=d,e.velocity.copy(e.position).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius*r)}toJSON(){return{type:"sphere",radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new kx({radius:e.radius,arc:e.arc,thickness:e.thickness,mode:e.mode,speed:e.speed?ki(e.speed):void 0,spread:e.spread})}clone(){return new kx({radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class VS{constructor(e={}){var t,i,n,r,o,a;this.type="sphere",this.currentValue=0,this.radius=(t=e.radius)!==null&&t!==void 0?t:10,this.arc=(i=e.arc)!==null&&i!==void 0?i:2*Math.PI,this.thickness=(n=e.thickness)!==null&&n!==void 0?n:1,this.mode=(r=e.mode)!==null&&r!==void 0?r:Ra.Random,this.spread=(o=e.spread)!==null&&o!==void 0?o:0,this.speed=(a=e.speed)!==null&&a!==void 0?a:new nn(1),this.memory=[]}update(e,t){Ra.Random!=this.mode&&(this.currentValue+=this.speed.genValue(this.memory,e.emissionState.time/e.duration)*t)}initialize(e,t){const i=zM(this.mode,this.currentValue,this.spread,t),n=Math.random(),r=Ev.lerp(1-this.thickness,1,Math.random()),o=i*this.arc,a=Math.acos(n),l=Math.sin(o),c=Math.cos(o),h=Math.sin(a),d=Math.cos(a);e.position.x=h*c,e.position.y=h*l,e.position.z=d,e.velocity.copy(e.position).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius*r)}toJSON(){return{type:"hemisphere",radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new VS({radius:e.radius,arc:e.arc,thickness:e.thickness,mode:e.mode,speed:e.speed?ki(e.speed):void 0,spread:e.spread})}clone(){return new VS({radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class zS{constructor(e={}){var t,i,n,r;this.type="grid",this.width=(t=e.width)!==null&&t!==void 0?t:1,this.height=(i=e.height)!==null&&i!==void 0?i:1,this.column=(n=e.column)!==null&&n!==void 0?n:10,this.row=(r=e.row)!==null&&r!==void 0?r:10}initialize(e){const t=Math.floor(Math.random()*this.row),i=Math.floor(Math.random()*this.column);e.position.x=i*this.width/this.column-this.width/2,e.position.y=t*this.height/this.row-this.height/2,e.position.z=0,e.velocity.set(0,0,e.startSpeed)}toJSON(){return{type:"grid",width:this.width,height:this.height,column:this.column,row:this.row}}static fromJSON(e){return new zS(e)}clone(){return new zS({width:this.width,height:this.height,column:this.column,row:this.row})}update(e,t){}}const Uz={circle:{type:"circle",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc"]]],constructor:NS,loadJSON:NS.fromJSON},cone:{type:"cone",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["angle",["radian"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc"]]],constructor:kS,loadJSON:kS.fromJSON},donut:{type:"donut",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["donutRadius",["number"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc"]]],constructor:DS,loadJSON:DS.fromJSON},point:{type:"point",params:[],constructor:FS,loadJSON:FS.fromJSON},sphere:{type:"sphere",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["angle",["radian"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc"]]],constructor:kx,loadJSON:kx.fromJSON},hemisphere:{type:"hemisphere",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["angle",["radian"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc"]]],constructor:VS,loadJSON:VS.fromJSON},grid:{type:"grid",params:[["width",["number"]],["height",["number"]],["rows",["number"]],["column",["number"]]],constructor:zS,loadJSON:zS.fromJSON}};function HUe(s,e){return Uz[s.type].loadJSON(s,e)}class US{constructor(e){this.color=e,this.type="ColorOverLife"}initialize(e){this.color.startGen(e.memory)}update(e,t){this.color.genColor(e.memory,e.color,e.age/e.life),e.color.x*=e.startColor.x,e.color.y*=e.startColor.y,e.color.z*=e.startColor.z,e.color.w*=e.startColor.w}frameUpdate(e){}toJSON(){return{type:this.type,color:this.color.toJSON()}}static fromJSON(e){return new US(vZ(e.color))}clone(){return new US(this.color.clone())}reset(){}}class XS{constructor(e){this.angularVelocity=e,this.type="RotationOverLife"}initialize(e){typeof e.rotation=="number"&&this.angularVelocity.startGen(e.memory)}update(e,t){typeof e.rotation=="number"&&(e.rotation+=t*this.angularVelocity.genValue(e.memory,e.age/e.life))}toJSON(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON()}}static fromJSON(e){return new XS(ki(e.angularVelocity))}frameUpdate(e){}clone(){return new XS(this.angularVelocity.clone())}reset(){}}class OS{constructor(e){this.angularVelocity=e,this.type="Rotation3DOverLife",this.tempQuat=new Dn,this.tempQuat2=new Dn}initialize(e){e.rotation instanceof Dn&&(e.angularVelocity=new Dn,this.angularVelocity.startGen(e.memory))}update(e,t){e.rotation instanceof Dn&&(this.angularVelocity.genValue(e.memory,this.tempQuat,t,e.age/e.life),e.rotation.multiply(this.tempQuat))}toJSON(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON()}}static fromJSON(e){return new OS(Rae(e.angularVelocity))}frameUpdate(e){}clone(){return new OS(this.angularVelocity.clone())}reset(){}}class ZS{initialize(e,t){this.ps=t,this.x.startGen(e.memory),this.y.startGen(e.memory),this.z.startGen(e.memory)}constructor(e,t,i){this.x=e,this.y=t,this.z=i,this.type="ForceOverLife",this._temp=new Pt,this._tempScale=new Pt,this._tempQ=new Dn}update(e,t){this._temp.set(this.x.genValue(e.memory,e.age/e.life),this.y.genValue(e.memory,e.age/e.life),this.z.genValue(e.memory,e.age/e.life)),this.ps.worldSpace?e.velocity.addScaledVector(this._temp,t):(this._temp.multiply(this._tempScale).applyQuaternion(this._tempQ),e.velocity.addScaledVector(this._temp,t))}toJSON(){return{type:this.type,x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}static fromJSON(e){return new ZS(ki(e.x),ki(e.y),ki(e.z))}frameUpdate(e){if(this.ps&&!this.ps.worldSpace){const t=this._temp,i=this._tempQ,n=this._tempScale;this.ps.emitter.matrixWorld.decompose(t,i,n),i.invert(),n.set(1/n.x,1/n.y,1/n.z)}}clone(){return new ZS(this.x.clone(),this.y.clone(),this.z.clone())}reset(){}}class WS{initialize(e){this.size.startGen(e.memory)}constructor(e){this.size=e,this.type="SizeOverLife"}update(e){this.size instanceof oA?this.size.genValue(e.memory,e.size,e.age/e.life).multiply(e.startSize):e.size.copy(e.startSize).multiplyScalar(this.size.genValue(e.memory,e.age/e.life))}toJSON(){return{type:this.type,size:this.size.toJSON()}}static fromJSON(e){return new WS(R2(e.size))}frameUpdate(e){}clone(){return new WS(this.size.clone())}reset(){}}class HS{initialize(e){this.speed.startGen(e.memory)}constructor(e){this.speed=e,this.type="SpeedOverLife"}update(e){e.speedModifier=this.speed.genValue(e.memory,e.age/e.life)}toJSON(){return{type:this.type,speed:this.speed.toJSON()}}static fromJSON(e){return new HS(ki(e.speed))}frameUpdate(e){}clone(){return new HS(this.speed.clone())}reset(){}}class QS{constructor(e){this.frame=e,this.type="FrameOverLife"}initialize(e){this.frame.startGen(e.memory)}update(e,t){this.frame instanceof BS&&(e.uvTile=this.frame.genValue(e.memory,e.age/e.life))}frameUpdate(e){}toJSON(){return{type:this.type,frame:this.frame.toJSON()}}static fromJSON(e){return new QS(ki(e.frame))}clone(){return new QS(this.frame.clone())}reset(){}}new Pt(0,0,1);class KS{constructor(e,t=new Pt(0,1,0)){this.orbitSpeed=e,this.axis=t,this.type="OrbitOverLife",this.temp=new Pt,this.rotation=new Dn}initialize(e){this.orbitSpeed.startGen(e.memory)}update(e,t){this.temp.copy(e.position).projectOnVector(this.axis),this.rotation.setFromAxisAngle(this.axis,this.orbitSpeed.genValue(e.memory,e.age/e.life)*t),e.position.sub(this.temp),e.position.applyQuaternion(this.rotation),e.position.add(this.temp)}frameUpdate(e){}toJSON(){return{type:this.type,orbitSpeed:this.orbitSpeed.toJSON(),axis:[this.axis.x,this.axis.y,this.axis.z]}}static fromJSON(e){return new KS(ki(e.orbitSpeed),e.axis?new Pt(e.axis[0],e.axis[1],e.axis[2]):void 0)}clone(){return new KS(this.orbitSpeed.clone())}reset(){}}class UD{constructor(e){this.data=e,this.next=null,this.prev=null}hasPrev(){return this.prev!==null}hasNext(){return this.next!==null}}class QUe{constructor(){this.length=0,this.head=this.tail=null}isEmpty(){return this.head===null}clear(){this.length=0,this.head=this.tail=null}front(){return this.head===null?null:this.head.data}back(){return this.tail===null?null:this.tail.data}dequeue(){if(this.head){const e=this.head.data;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}}pop(){if(this.tail){const e=this.tail.data;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}}queue(e){const t=new UD(e);this.tail||(this.tail=t),this.head&&(this.head.prev=t,t.next=this.head),this.head=t,this.length++}push(e){const t=new UD(e);this.head||(this.head=t),this.tail&&(this.tail.next=t,t.prev=this.tail),this.tail=t,this.length++}insertBefore(e,t){const i=new UD(t);i.next=e,i.prev=e.prev,i.prev!==null&&(i.prev.next=i),i.next.prev=i,e==this.head&&(this.head=i),this.length++}remove(e){if(this.head===null||this.tail===null)return;let t=this.head;for(e===this.head.data&&(this.head=this.head.next),e===this.tail.data&&(this.tail=this.tail.prev);t.next!==null&&t.data!==e;)t=t.next;t.data===e&&(t.prev!==null&&(t.prev.next=t.next),t.next!==null&&(t.next.prev=t.prev),this.length--)}*values(){let e=this.head;for(;e!==null;)yield e.data,e=e.next}}class KUe{constructor(){this.startSpeed=0,this.startColor=new cl,this.startSize=new Pt(1,1,1),this.position=new Pt,this.velocity=new Pt,this.age=0,this.life=1,this.size=new Pt(1,1,1),this.speedModifier=1,this.rotation=0,this.color=new cl,this.uvTile=0,this.memory=[]}get died(){return this.age>=this.life}reset(){this.memory.length=0}}class YUe{constructor(e,t,i){this.position=e,this.size=t,this.color=i}}class YS{constructor(){this.startSpeed=0,this.startColor=new cl,this.startSize=new Pt(1,1,1),this.position=new Pt,this.velocity=new Pt,this.age=0,this.life=1,this.size=new Pt(1,1,1),this.length=100,this.speedModifier=1,this.color=new cl,this.previous=new QUe,this.uvTile=0,this.memory=[]}update(){for(this.age<=this.life?this.previous.push(new YUe(this.position.clone(),this.size.x,this.color.clone())):this.previous.length>0&&this.previous.dequeue();this.previous.length>this.length;)this.previous.dequeue()}get died(){return this.age>=this.life}reset(){this.memory.length=0,this.previous.clear()}}class JS{initialize(e){this.width.startGen(e.memory)}constructor(e){this.width=e,this.type="WidthOverLength"}update(e){if(e instanceof YS){const t=e.previous.values();for(let i=0;i<e.previous.length;i++){const n=t.next();n.value.size=this.width.genValue(e.memory,(e.previous.length-i)/e.length)}}}frameUpdate(e){}toJSON(){return{type:this.type,width:this.width.toJSON()}}static fromJSON(e){return new JS(ki(e.width))}clone(){return new JS(this.width.clone())}reset(){}}class jS{constructor(e,t){this.direction=e,this.magnitude=t,this.type="ApplyForce",this.memory={data:[],dataCount:0},this.magnitudeValue=this.magnitude.genValue(this.memory)}initialize(e){}update(e,t){e.velocity.addScaledVector(this.direction,this.magnitudeValue*t)}frameUpdate(e){this.magnitudeValue=this.magnitude.genValue(this.memory)}toJSON(){return{type:this.type,direction:[this.direction.x,this.direction.y,this.direction.z],magnitude:this.magnitude.toJSON()}}static fromJSON(e){var t;return new jS(new Pt(e.direction[0],e.direction[1],e.direction[2]),ki((t=e.magnitude)!==null&&t!==void 0?t:e.force))}clone(){return new jS(this.direction.clone(),this.magnitude.clone())}reset(){}}class qS{constructor(e,t){this.center=e,this.magnitude=t,this.type="GravityForce",this.temp=new Pt}initialize(e){}update(e,t){this.temp.copy(this.center).sub(e.position).normalize(),e.velocity.addScaledVector(this.temp,this.magnitude/e.position.distanceToSquared(this.center)*t)}frameUpdate(e){}toJSON(){return{type:this.type,center:[this.center.x,this.center.y,this.center.z],magnitude:this.magnitude}}static fromJSON(e){return new qS(new Pt(e.center[0],e.center[1],e.center[2]),e.magnitude)}clone(){return new qS(this.center.clone(),this.magnitude)}reset(){}}new Pt(0,0,1);class $S{constructor(e){this.angle=e,this.type="ChangeEmitDirection",this._temp=new Pt,this._q=new Dn,this.memory={data:[],dataCount:0}}initialize(e){const t=e.velocity.length();t!=0&&(e.velocity.normalize(),e.velocity.x===0&&e.velocity.y===0?this._temp.set(0,e.velocity.z,0):this._temp.set(-e.velocity.y,e.velocity.x,0),this.angle.startGen(this.memory),this._q.setFromAxisAngle(this._temp.normalize(),this.angle.genValue(this.memory)),this._temp.copy(e.velocity),e.velocity.applyQuaternion(this._q),this._q.setFromAxisAngle(this._temp,Math.random()*Math.PI*2),e.velocity.applyQuaternion(this._q),e.velocity.setLength(t))}update(e,t){}frameUpdate(e){}toJSON(){return{type:this.type,angle:this.angle.toJSON()}}static fromJSON(e){return new $S(ki(e.angle))}clone(){return new $S(this.angle)}reset(){}}const JUe=new Pt(1,1,1),YY=new Pt(0,0,1);var kb;(function(s){s[s.Death=0]="Death",s[s.Birth=1]="Birth",s[s.Frame=2]="Frame"})(kb||(kb={}));class e1{constructor(e,t,i,n=kb.Frame,r=1){this.particleSystem=e,this.useVelocityAsBasis=t,this.subParticleSystem=i,this.mode=n,this.emitProbability=r,this.type="EmitSubParticleSystem",this.q_=new Dn,this.v_=new Pt,this.v2_=new Pt,this.subEmissions=new Array,this.subParticleSystem&&this.subParticleSystem.system&&(this.subParticleSystem.system.onlyUsedByOther=!0)}initialize(e){}update(e,t){this.mode===kb.Frame?this.emit(e,t):this.mode===kb.Birth&&e.age===0?this.emit(e,t):this.mode===kb.Death&&e.age+t>=e.life&&this.emit(e,t)}emit(e,t){if(!this.subParticleSystem||Math.random()>this.emitProbability)return;const i=new Cp;this.setMatrixFromParticle(i,e),this.subEmissions.push({burstParticleCount:0,burstParticleIndex:0,isBursting:!1,burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,matrix:i,travelDistance:0,particle:e})}frameUpdate(e){if(this.subParticleSystem)for(let t=0;t<this.subEmissions.length;t++)if(this.subEmissions[t].time>=this.subParticleSystem.system.duration)this.subEmissions[t]=this.subEmissions[this.subEmissions.length-1],this.subEmissions.length=this.subEmissions.length-1,t--;else{const i=this.subEmissions[t];i.particle&&i.particle.age<i.particle.life?this.setMatrixFromParticle(i.matrix,i.particle):i.particle=void 0,this.subParticleSystem.system.emit(e,i,i.matrix)}}toJSON(){return{type:this.type,subParticleSystem:this.subParticleSystem?this.subParticleSystem.uuid:"",useVelocityAsBasis:this.useVelocityAsBasis,mode:this.mode,emitProbability:this.emitProbability}}static fromJSON(e,t){return new e1(t,e.useVelocityAsBasis,e.subParticleSystem,e.mode,e.emitProbability)}clone(){return new e1(this.particleSystem,this.useVelocityAsBasis,this.subParticleSystem,this.mode,this.emitProbability)}reset(){}setMatrixFromParticle(e,t){let i;if(t.rotation===void 0||this.useVelocityAsBasis)if(t.velocity.x===0&&t.velocity.y===0&&(t.velocity.z===1||t.velocity.z===0))e.set(1,0,0,t.position.x,0,1,0,t.position.y,0,0,1,t.position.z,0,0,0,1);else{this.v_.copy(YY).cross(t.velocity),this.v2_.copy(t.velocity).cross(this.v_);const n=this.v_.length(),r=this.v2_.length();e.set(this.v_.x/n,this.v2_.x/r,t.velocity.x,t.position.x,this.v_.y/n,this.v2_.y/r,t.velocity.y,t.position.y,this.v_.z/n,this.v2_.z/r,t.velocity.z,t.position.z,0,0,0,1)}else t.rotation instanceof Dn?i=t.rotation:(this.q_.setFromAxisAngle(YY,t.rotation),i=this.q_),e.compose(t.position,i,JUe);this.particleSystem.worldSpace||e.multiplyMatrices(this.particleSystem.emitter.matrixWorld,e)}}const jUe=.5*(Math.sqrt(3)-1),k_=(3-Math.sqrt(3))/6,qUe=1/3,sd=1/6,$Ue=(Math.sqrt(5)-1)/4,so=(5-Math.sqrt(5))/20,Lr=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Ks=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class Lae{constructor(e=Math.random){const t=typeof e=="function"?e:tXe(e);this.p=eXe(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let i=0;i<512;i++)this.perm[i]=this.p[i&255],this.permMod12[i]=this.perm[i]%12}noise2D(e,t){const i=this.permMod12,n=this.perm;let r=0,o=0,a=0;const l=(e+t)*jUe,c=Math.floor(e+l),h=Math.floor(t+l),d=(c+h)*k_,u=c-d,f=h-d,m=e-u,g=t-f;let A,y;m>g?(A=1,y=0):(A=0,y=1);const b=m-A+k_,x=g-y+k_,v=m-1+2*k_,_=g-1+2*k_,C=c&255,S=h&255;let M=.5-m*m-g*g;if(M>=0){const E=i[C+n[S]]*3;M*=M,r=M*M*(Lr[E]*m+Lr[E+1]*g)}let L=.5-b*b-x*x;if(L>=0){const E=i[C+A+n[S+y]]*3;L*=L,o=L*L*(Lr[E]*b+Lr[E+1]*x)}let w=.5-v*v-_*_;if(w>=0){const E=i[C+1+n[S+1]]*3;w*=w,a=w*w*(Lr[E]*v+Lr[E+1]*_)}return 70*(r+o+a)}noise3D(e,t,i){const n=this.permMod12,r=this.perm;let o,a,l,c;const h=(e+t+i)*qUe,d=Math.floor(e+h),u=Math.floor(t+h),f=Math.floor(i+h),m=(d+u+f)*sd,g=d-m,A=u-m,y=f-m,b=e-g,x=t-A,v=i-y;let _,C,S,M,L,w;b>=x?x>=v?(_=1,C=0,S=0,M=1,L=1,w=0):b>=v?(_=1,C=0,S=0,M=1,L=0,w=1):(_=0,C=0,S=1,M=1,L=0,w=1):x<v?(_=0,C=0,S=1,M=0,L=1,w=1):b<v?(_=0,C=1,S=0,M=0,L=1,w=1):(_=0,C=1,S=0,M=1,L=1,w=0);const E=b-_+sd,B=x-C+sd,P=v-S+sd,k=b-M+2*sd,X=x-L+2*sd,F=v-w+2*sd,H=b-1+3*sd,W=x-1+3*sd,se=v-1+3*sd,de=d&255,be=u&255,Pe=f&255;let Oe=.6-b*b-x*x-v*v;if(Oe<0)o=0;else{const Le=n[de+r[be+r[Pe]]]*3;Oe*=Oe,o=Oe*Oe*(Lr[Le]*b+Lr[Le+1]*x+Lr[Le+2]*v)}let ae=.6-E*E-B*B-P*P;if(ae<0)a=0;else{const Le=n[de+_+r[be+C+r[Pe+S]]]*3;ae*=ae,a=ae*ae*(Lr[Le]*E+Lr[Le+1]*B+Lr[Le+2]*P)}let Ae=.6-k*k-X*X-F*F;if(Ae<0)l=0;else{const Le=n[de+M+r[be+L+r[Pe+w]]]*3;Ae*=Ae,l=Ae*Ae*(Lr[Le]*k+Lr[Le+1]*X+Lr[Le+2]*F)}let Se=.6-H*H-W*W-se*se;if(Se<0)c=0;else{const Le=n[de+1+r[be+1+r[Pe+1]]]*3;Se*=Se,c=Se*Se*(Lr[Le]*H+Lr[Le+1]*W+Lr[Le+2]*se)}return 32*(o+a+l+c)}noise4D(e,t,i,n){const r=this.perm;let o,a,l,c,h;const d=(e+t+i+n)*$Ue,u=Math.floor(e+d),f=Math.floor(t+d),m=Math.floor(i+d),g=Math.floor(n+d),A=(u+f+m+g)*so,y=u-A,b=f-A,x=m-A,v=g-A,_=e-y,C=t-b,S=i-x,M=n-v;let L=0,w=0,E=0,B=0;_>C?L++:w++,_>S?L++:E++,_>M?L++:B++,C>S?w++:E++,C>M?w++:B++,S>M?E++:B++;const P=L>=3?1:0,k=w>=3?1:0,X=E>=3?1:0,F=B>=3?1:0,H=L>=2?1:0,W=w>=2?1:0,se=E>=2?1:0,de=B>=2?1:0,be=L>=1?1:0,Pe=w>=1?1:0,Oe=E>=1?1:0,ae=B>=1?1:0,Ae=_-P+so,Se=C-k+so,Le=S-X+so,st=M-F+so,ot=_-H+2*so,Ct=C-W+2*so,zt=S-se+2*so,ke=M-de+2*so,Z=_-be+3*so,Ke=C-Pe+3*so,je=S-Oe+3*so,We=M-ae+3*so,nt=_-1+4*so,Tt=C-1+4*so,mt=S-1+4*so,O=M-1+4*so,D=u&255,he=f&255,Ee=m&255,Ne=g&255;let Re=.6-_*_-C*C-S*S-M*M;if(Re<0)o=0;else{const Ge=r[D+r[he+r[Ee+r[Ne]]]]%32*4;Re*=Re,o=Re*Re*(Ks[Ge]*_+Ks[Ge+1]*C+Ks[Ge+2]*S+Ks[Ge+3]*M)}let yt=.6-Ae*Ae-Se*Se-Le*Le-st*st;if(yt<0)a=0;else{const Ge=r[D+P+r[he+k+r[Ee+X+r[Ne+F]]]]%32*4;yt*=yt,a=yt*yt*(Ks[Ge]*Ae+Ks[Ge+1]*Se+Ks[Ge+2]*Le+Ks[Ge+3]*st)}let et=.6-ot*ot-Ct*Ct-zt*zt-ke*ke;if(et<0)l=0;else{const Ge=r[D+H+r[he+W+r[Ee+se+r[Ne+de]]]]%32*4;et*=et,l=et*et*(Ks[Ge]*ot+Ks[Ge+1]*Ct+Ks[Ge+2]*zt+Ks[Ge+3]*ke)}let ct=.6-Z*Z-Ke*Ke-je*je-We*We;if(ct<0)c=0;else{const Ge=r[D+be+r[he+Pe+r[Ee+Oe+r[Ne+ae]]]]%32*4;ct*=ct,c=ct*ct*(Ks[Ge]*Z+Ks[Ge+1]*Ke+Ks[Ge+2]*je+Ks[Ge+3]*We)}let Jt=.6-nt*nt-Tt*Tt-mt*mt-O*O;if(Jt<0)h=0;else{const Ge=r[D+1+r[he+1+r[Ee+1+r[Ne+1]]]]%32*4;Jt*=Jt,h=Jt*Jt*(Ks[Ge]*nt+Ks[Ge+1]*Tt+Ks[Ge+2]*mt+Ks[Ge+3]*O)}return 27*(o+a+l+c+h)}}function eXe(s){const e=new Uint8Array(256);for(let t=0;t<256;t++)e[t]=t;for(let t=0;t<255;t++){const i=t+~~(s()*(256-t)),n=e[t];e[t]=e[i],e[i]=n}return e}function tXe(s){let e=0,t=0,i=0,n=1;const r=iXe();return e=r(" "),t=r(" "),i=r(" "),e-=r(s),e<0&&(e+=1),t-=r(s),t<0&&(t+=1),i-=r(s),i<0&&(i+=1),function(){const o=2091639*e+n*23283064365386963e-26;return e=t,t=i,i=o-(n=o|0)}}function iXe(){let s=4022871197;return function(e){e=e.toString();for(let t=0;t<e.length;t++){s+=e.charCodeAt(t);let i=.02519603282416938*s;s=i>>>0,i-=s,i*=s,s=i>>>0,i-=s,s+=i*4294967296}return(s>>>0)*23283064365386963e-26}}class t1{constructor(e,t,i,n){this.scale=e,this.octaves=t,this.velocityMultiplier=i,this.timeScale=n,this.type="TurbulenceField",this.generator=new Lae,this.timeOffset=new Pt,this.temp=new Pt,this.temp2=new Pt,this.timeOffset.x=Math.random()/this.scale.x*this.timeScale.x,this.timeOffset.y=Math.random()/this.scale.y*this.timeScale.y,this.timeOffset.z=Math.random()/this.scale.z*this.timeScale.z}initialize(e){}update(e,t){const i=e.position.x/this.scale.x,n=e.position.y/this.scale.y,r=e.position.z/this.scale.z;this.temp.set(0,0,0);let o=1;for(let a=0;a<this.octaves;a++)this.temp2.set(this.generator.noise4D(i*o,n*o,r*o,this.timeOffset.x*o)/o,this.generator.noise4D(i*o,n*o,r*o,this.timeOffset.y*o)/o,this.generator.noise4D(i*o,n*o,r*o,this.timeOffset.z*o)/o),this.temp.add(this.temp2),o*=2;this.temp.multiply(this.velocityMultiplier),e.velocity.addScaledVector(this.temp,t)}toJSON(){return{type:this.type,scale:[this.scale.x,this.scale.y,this.scale.z],octaves:this.octaves,velocityMultiplier:[this.velocityMultiplier.x,this.velocityMultiplier.y,this.velocityMultiplier.z],timeScale:[this.timeScale.x,this.timeScale.y,this.timeScale.z]}}frameUpdate(e){this.timeOffset.x+=e*this.timeScale.x,this.timeOffset.y+=e*this.timeScale.y,this.timeOffset.z+=e*this.timeScale.z}static fromJSON(e){return new t1(new Pt(e.scale[0],e.scale[1],e.scale[2]),e.octaves,new Pt(e.velocityMultiplier[0],e.velocityMultiplier[1],e.velocityMultiplier[2]),new Pt(e.timeScale[0],e.timeScale[1],e.timeScale[2]))}clone(){return new t1(this.scale.clone(),this.octaves,this.velocityMultiplier.clone(),this.timeScale.clone())}reset(){}}function RE(s,e){return Math.floor(Math.random()*(e-s))+s}const rd=[],XD=new Pt,OD=new Dn;class i1{constructor(e,t,i=new nn(1),n=new nn(0)){if(this.frequency=e,this.power=t,this.positionAmount=i,this.rotationAmount=n,this.type="Noise",this.duration=0,rd.length===0)for(let r=0;r<100;r++)rd.push(new Lae)}initialize(e){e.lastPosNoise=new Pt,typeof e.rotation=="number"?e.lastRotNoise=0:e.lastRotNoise=new Dn,e.generatorIndex=[RE(0,100),RE(0,100),RE(0,100),RE(0,100)],this.positionAmount.startGen(e.memory),this.rotationAmount.startGen(e.memory),this.frequency.startGen(e.memory),this.power.startGen(e.memory)}update(e,t){let i=this.frequency.genValue(e.memory,e.age/e.life),n=this.power.genValue(e.memory,e.age/e.life),r=this.positionAmount.genValue(e.memory,e.age/e.life),o=this.rotationAmount.genValue(e.memory,e.age/e.life);r>0&&e.lastPosNoise!==void 0&&(e.position.sub(e.lastPosNoise),XD.set(rd[e.generatorIndex[0]].noise2D(0,e.age*i)*n*r,rd[e.generatorIndex[1]].noise2D(0,e.age*i)*n*r,rd[e.generatorIndex[2]].noise2D(0,e.age*i)*n*r),e.position.add(XD),e.lastPosNoise.copy(XD)),o>0&&e.lastRotNoise!==void 0&&(typeof e.rotation=="number"?(e.rotation-=e.lastRotNoise,e.rotation+=rd[e.generatorIndex[3]].noise2D(0,e.age*i)*Math.PI*n*o):(e.lastRotNoise.invert(),e.rotation.multiply(e.lastRotNoise),OD.set(rd[e.generatorIndex[0]].noise2D(0,e.age*i)*n*o,rd[e.generatorIndex[1]].noise2D(0,e.age*i)*n*o,rd[e.generatorIndex[2]].noise2D(0,e.age*i)*n*o,rd[e.generatorIndex[3]].noise2D(0,e.age*i)*n*o).normalize(),e.rotation.multiply(OD),e.lastRotNoise.copy(OD)))}toJSON(){return{type:this.type,frequency:this.frequency.toJSON(),power:this.power.toJSON(),positionAmount:this.positionAmount.toJSON(),rotationAmount:this.rotationAmount.toJSON()}}frameUpdate(e){this.duration+=e}static fromJSON(e){return new i1(ki(e.frequency),ki(e.power),ki(e.positionAmount),ki(e.rotationAmount))}clone(){return new i1(this.frequency.clone(),this.power.clone(),this.positionAmount.clone(),this.rotationAmount.clone())}reset(){}}class n1{constructor(e,t){this.color=e,this.speedRange=t,this.type="ColorBySpeed"}initialize(e){this.color.startGen(e.memory)}update(e,t){const i=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.color.genColor(e.memory,e.color,i),e.color.x*=e.startColor.x,e.color.y*=e.startColor.y,e.color.z*=e.startColor.z,e.color.w*=e.startColor.w}frameUpdate(e){}toJSON(){return{type:this.type,color:this.color.toJSON(),speedRange:this.speedRange.toJSON()}}static fromJSON(e){return new n1(vZ(e.color),rA.fromJSON(e.speedRange))}clone(){return new n1(this.color.clone(),this.speedRange.clone())}reset(){}}class s1{initialize(e){this.size.startGen(e.memory)}constructor(e,t){this.size=e,this.speedRange=t,this.type="SizeBySpeed"}update(e){const t=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.size instanceof oA?this.size.genValue(e.memory,e.size,t).multiply(e.startSize):e.size.copy(e.startSize).multiplyScalar(this.size.genValue(e.memory,t))}toJSON(){return{type:this.type,size:this.size.toJSON(),speedRange:this.speedRange.toJSON()}}static fromJSON(e){return new s1(R2(e.size),rA.fromJSON(e.speedRange))}frameUpdate(e){}clone(){return new s1(this.size.clone(),this.speedRange.clone())}reset(){}}class r1{constructor(e,t){this.angularVelocity=e,this.speedRange=t,this.type="RotationBySpeed",this.tempQuat=new Dn}initialize(e){typeof e.rotation=="number"&&this.angularVelocity.startGen(e.memory)}update(e,t){if(typeof e.rotation=="number"){const i=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);e.rotation+=t*this.angularVelocity.genValue(e.memory,i)}}toJSON(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),speedRange:this.speedRange.toJSON()}}static fromJSON(e){return new r1(ki(e.angularVelocity),rA.fromJSON(e.speedRange))}frameUpdate(e){}clone(){return new r1(this.angularVelocity.clone(),this.speedRange.clone())}reset(){}}class o1{initialize(e){this.speed.startGen(e.memory)}constructor(e,t){this.speed=e,this.dampen=t,this.type="LimitSpeedOverLife"}update(e,t){let i=e.velocity.length(),n=this.speed.genValue(e.memory,e.age/e.life);if(i>n){const r=(i-n)/i;e.velocity.multiplyScalar(1-r*this.dampen*t*20)}}toJSON(){return{type:this.type,speed:this.speed.toJSON(),dampen:this.dampen}}static fromJSON(e){return new o1(ki(e.speed),e.dampen)}frameUpdate(e){}clone(){return new o1(this.speed.clone(),this.dampen)}reset(){}}const Xz={ApplyForce:{type:"ApplyForce",constructor:jS,params:[["direction",["vec3"]],["magnitude",["value"]]],loadJSON:jS.fromJSON},Noise:{type:"Noise",constructor:i1,params:[["frequency",["value"]],["power",["value"]],["positionAmount",["value"]],["rotationAmount",["value"]]],loadJSON:i1.fromJSON},TurbulenceField:{type:"TurbulenceField",constructor:t1,params:[["scale",["vec3"]],["octaves",["number"]],["velocityMultiplier",["vec3"]],["timeScale",["vec3"]]],loadJSON:t1.fromJSON},GravityForce:{type:"GravityForce",constructor:qS,params:[["center",["vec3"]],["magnitude",["number"]]],loadJSON:qS.fromJSON},ColorOverLife:{type:"ColorOverLife",constructor:US,params:[["color",["colorFunc"]]],loadJSON:US.fromJSON},RotationOverLife:{type:"RotationOverLife",constructor:XS,params:[["angularVelocity",["value","valueFunc"]]],loadJSON:XS.fromJSON},Rotation3DOverLife:{type:"Rotation3DOverLife",constructor:OS,params:[["angularVelocity",["rotationFunc"]]],loadJSON:OS.fromJSON},SizeOverLife:{type:"SizeOverLife",constructor:WS,params:[["size",["value","valueFunc","vec3Func"]]],loadJSON:WS.fromJSON},ColorBySpeed:{type:"ColorBySpeed",constructor:n1,params:[["color",["colorFunc"]],["speedRange",["range"]]],loadJSON:n1.fromJSON},RotationBySpeed:{type:"RotationBySpeed",constructor:r1,params:[["angularVelocity",["value","valueFunc"]],["speedRange",["range"]]],loadJSON:r1.fromJSON},SizeBySpeed:{type:"SizeBySpeed",constructor:s1,params:[["size",["value","valueFunc","vec3Func"]],["speedRange",["range"]]],loadJSON:s1.fromJSON},SpeedOverLife:{type:"SpeedOverLife",constructor:HS,params:[["speed",["value","valueFunc"]]],loadJSON:HS.fromJSON},FrameOverLife:{type:"FrameOverLife",constructor:QS,params:[["frame",["value","valueFunc"]]],loadJSON:QS.fromJSON},ForceOverLife:{type:"ForceOverLife",constructor:ZS,params:[["x",["value","valueFunc"]],["y",["value","valueFunc"]],["z",["value","valueFunc"]]],loadJSON:ZS.fromJSON},OrbitOverLife:{type:"OrbitOverLife",constructor:KS,params:[["orbitSpeed",["value","valueFunc"]],["axis",["vec3"]]],loadJSON:KS.fromJSON},WidthOverLength:{type:"WidthOverLength",constructor:JS,params:[["width",["value","valueFunc"]]],loadJSON:JS.fromJSON},ChangeEmitDirection:{type:"ChangeEmitDirection",constructor:$S,params:[["angle",["value"]]],loadJSON:$S.fromJSON},EmitSubParticleSystem:{type:"EmitSubParticleSystem",constructor:e1,params:[["particleSystem",["self"]],["useVelocityAsBasis",["boolean"]],["subParticleSystem",["particleSystem"]],["mode",["number"]],["emitProbability",["number"]]],loadJSON:e1.fromJSON},LimitSpeedOverLife:{type:"LimitSpeedOverLife",constructor:o1,params:[["speed",["value","valueFunc"]],["dampen",["number"]]],loadJSON:o1.fromJSON}};function nXe(s,e){return Xz[s.type].loadJSON(s,e)}const sXe=[];function rXe(s){if(!sXe.find(t=>t.id===s.id)){s.initialize();for(const t of s.emitterShapes)Uz[t.type]||(Uz[t.type]=t);for(const t of s.behaviors)Xz[t.type]||(Xz[t.type]=t)}}var oXe=`
#ifdef SOFT_PARTICLES

    /* #ifdef LOGDEPTH
    float distSample = linearize_depth_log(sampleDepth, near, far);
    #else
    float distSample = ortho ? linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far);
    #endif */

    vec2 p2 = projPosition.xy / projPosition.w;
    
    p2 = 0.5 * p2 + 0.5;

    float readDepth = texture2D(depthTexture, p2.xy).r;
    float viewDepth = linearize_depth(readDepth);

    float softParticlesFade = saturate(SOFT_INV_FADE_DISTANCE * ((viewDepth - SOFT_NEAR_FADE) - linearDepth));
    
    gl_FragColor *= softParticlesFade;

    //gl_FragColor = vec4(softParticlesFade , 0, 0, 1);
#endif
`,aXe=`
#ifdef SOFT_PARTICLES

    uniform sampler2D depthTexture;
    uniform vec4 projParams;
    uniform vec2 softParams;

    varying vec4 projPosition;
    varying float linearDepth;

    #define SOFT_NEAR_FADE softParams.x
    #define SOFT_INV_FADE_DISTANCE softParams.y

    #define zNear projParams.x
    #define zFar projParams.y

    float linearize_depth(float d)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }

#endif
`,lXe=`
#ifdef SOFT_PARTICLES
    varying vec4 projPosition;
    varying float linearDepth;
#endif
`,cXe=`
#ifdef SOFT_PARTICLES
    projPosition = gl_Position;
    linearDepth = -mvPosition.z;
#endif
`,hXe=`
#ifdef USE_MAP
    vec4 texelColor = texture2D( map, vUv);
    #ifdef TILE_BLEND
        texelColor = mix( texelColor, texture2D( map, vUvNext ), vUvBlend );
    #endif
    diffuseColor *= texelColor;
#endif
`,dXe=`
#if defined( USE_UV ) || defined( USE_ANISOTROPY )

	varying vec2 vUv;
#ifdef TILE_BLEND
    varying vec2 vUvNext;
    varying float vUvBlend;
#endif

#endif
#ifdef USE_MAP

	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#ifdef TILE_BLEND
    varying vec2 vMapUvNext;
#endif

#endif
#ifdef USE_ALPHAMAP

	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;

#endif
#ifdef USE_LIGHTMAP

	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;

#endif
#ifdef USE_AOMAP

	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;

#endif
#ifdef USE_BUMPMAP

	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;

#endif
#ifdef USE_NORMALMAP

	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;

#endif
#ifdef USE_DISPLACEMENTMAP

	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;

#endif
#ifdef USE_EMISSIVEMAP

	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;

#endif
#ifdef USE_METALNESSMAP

	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;

#endif
#ifdef USE_ROUGHNESSMAP

	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;

#endif
#ifdef USE_ANISOTROPYMAP

	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;

#endif
#ifdef USE_CLEARCOATMAP

	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;

#endif
#ifdef USE_SHEEN_COLORMAP

	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;

#endif
#ifdef USE_IRIDESCENCEMAP

	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;

#endif
#ifdef USE_SPECULARMAP

	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;

#endif
#ifdef USE_SPECULAR_COLORMAP

	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;

#endif
#ifdef USE_TRANSMISSIONMAP

	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;

#endif
#ifdef USE_THICKNESSMAP

	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;

#endif
`,uXe=`
#ifdef UV_TILE
    attribute float uvTile;
    uniform vec2 tileCount;
    
    mat3 makeTileTransform(float uvTile) {
        float col = mod(uvTile, tileCount.x);
        float row = (tileCount.y - floor(uvTile / tileCount.x) - 1.0);
        
        return mat3(
          1.0 / tileCount.x, 0.0, 0.0,
          0.0, 1.0 / tileCount.y, 0.0, 
          col / tileCount.x, row / tileCount.y, 1.0);
    }
#else
    mat3 makeTileTransform(float uvTile) {
        return mat3(1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0);
    }
#endif

#if defined( USE_UV ) || defined( USE_ANISOTROPY )

	varying vec2 vUv;
#ifdef TILE_BLEND
    varying vec2 vUvNext;
    varying float vUvBlend;
#endif

#endif
#ifdef USE_MAP

	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#ifdef TILE_BLEND
    varying vec2 vMapUvNext;
#endif

#endif
#ifdef USE_ALPHAMAP

	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;

#endif
#ifdef USE_LIGHTMAP

	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;

#endif
#ifdef USE_AOMAP

	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;

#endif
#ifdef USE_BUMPMAP

	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;

#endif
#ifdef USE_NORMALMAP

	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;

#endif
#ifdef USE_DISPLACEMENTMAP

	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;

#endif
#ifdef USE_EMISSIVEMAP

	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;

#endif
#ifdef USE_METALNESSMAP

	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;

#endif
#ifdef USE_ROUGHNESSMAP

	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;

#endif
#ifdef USE_ANISOTROPYMAP

	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;

#endif
#ifdef USE_CLEARCOATMAP

	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;

#endif
#ifdef USE_SHEEN_COLORMAP

	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;

#endif
#ifdef USE_IRIDESCENCEMAP

	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;

#endif
#ifdef USE_SPECULARMAP

	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;

#endif
#ifdef USE_SPECULAR_COLORMAP

	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;

#endif
#ifdef USE_TRANSMISSIONMAP

	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;

#endif
#ifdef USE_THICKNESSMAP

	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;

#endif
`,pXe=`
#ifdef UV_TILE
    mat3 tileTransform = makeTileTransform(floor(uvTile));
    #ifdef TILE_BLEND
        mat3 nextTileTransform = makeTileTransform(ceil(uvTile));
        vUvBlend = fract(uvTile);
    #endif
#else
    mat3 tileTransform = makeTileTransform(0.0);
#endif

#if defined( USE_UV ) || defined( USE_ANISOTROPY )

vUv = (tileTransform *vec3( uv, 1 )).xy;
#if defined( TILE_BLEND ) && defined( UV_TILE )
    vUvNext = (nextTileTransform *vec3( uv, 1 )).xy;
#endif

#endif
#ifdef USE_MAP

vMapUv = ( tileTransform * (mapTransform * vec3( MAP_UV, 1 ) )).xy;
#if defined( TILE_BLEND ) && defined( UV_TILE )
    vMapUvNext = (nextTileTransform * (mapTransform * vec3( MAP_UV, 1 ))).xy;
#endif

#endif
#ifdef USE_ALPHAMAP

vAlphaMapUv = ( tileTransform * (alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) )).xy;
    
#endif
#ifdef USE_LIGHTMAP

vLightMapUv = ( tileTransform * (lightMapTransform * vec3( LIGHTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_AOMAP

vAoMapUv = ( tileTransform * (aoMapTransform * vec3( AOMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_BUMPMAP

vBumpMapUv = ( tileTransform * (bumpMapTransform * vec3( BUMPMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_NORMALMAP

vNormalMapUv = ( tileTransform * (normalMapTransform * vec3( NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_DISPLACEMENTMAP

vDisplacementMapUv = ( tileTransform * (displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_EMISSIVEMAP

vEmissiveMapUv = ( tileTransform * (emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_METALNESSMAP

vMetalnessMapUv = ( tileTransform * (metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ROUGHNESSMAP

vRoughnessMapUv = ( tileTransform * (roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ANISOTROPYMAP

vAnisotropyMapUv = ( tileTransform * (anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOATMAP

vClearcoatMapUv = ( tileTransform * (clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

vClearcoatNormalMapUv = ( tileTransform * (clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

vClearcoatRoughnessMapUv = ( tileTransform * (clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCEMAP

vIridescenceMapUv = ( tileTransform * (iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

vIridescenceThicknessMapUv = ( tileTransform * (iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_COLORMAP

vSheenColorMapUv = ( tileTransform * (sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

vSheenRoughnessMapUv = ( tileTransform * (sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULARMAP

vSpecularMapUv = ( tileTransform * (specularMapTransform * vec3( SPECULARMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_COLORMAP

vSpecularColorMapUv = ( tileTransform * (specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

vSpecularIntensityMapUv = ( tileTransform * (specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_TRANSMISSIONMAP

vTransmissionMapUv = ( tileTransform * transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_THICKNESSMAP

vThicknessMapUv = ( tileTransform * thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) )).xy;

#endif

`;const Af=Ut;function fXe(){Af.tile_pars_vertex=uXe,Af.tile_vertex=pXe,Af.tile_pars_fragment=dXe,Af.tile_fragment=hXe,Af.soft_pars_vertex=lXe,Af.soft_vertex=cXe,Af.soft_pars_fragment=aXe,Af.soft_fragment=oXe}class mXe extends ye{constructor(e){super(),this.type="ParticleEmitter",this.system=e}clone(){const e=this.system.clone();return e.emitter.copy(this,!0),e.emitter}dispose(){}extractFromCache(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}toJSON(e,t={}){const i=this.children;this.children=this.children.filter(r=>r.type!=="ParticleSystemPreview");const n=super.toJSON(e);return this.children=i,this.system!==null&&(n.object.ps=this.system.toJSON(e,t)),n}}var gt;(function(s){s[s.BillBoard=0]="BillBoard",s[s.StretchedBillBoard=1]="StretchedBillBoard",s[s.Mesh=2]="Mesh",s[s.Trail=3]="Trail",s[s.HorizontalBillBoard=4]="HorizontalBillBoard",s[s.VerticalBillBoard=5]="VerticalBillBoard"})(gt||(gt={}));class Bae extends fe{constructor(e){super(),this.type="VFXBatch",this.maxParticles=1e3,this.systems=new Set;const t=new ta;t.mask=e.layers.mask;const i=e.material.clone();i.defines={},Object.assign(i.defines,e.material.defines),this.settings={instancingGeometry:e.instancingGeometry,renderMode:e.renderMode,renderOrder:e.renderOrder,material:i,uTileCount:e.uTileCount,vTileCount:e.vTileCount,blendTiles:e.blendTiles,softParticles:e.softParticles,softNearFade:e.softNearFade,softFarFade:e.softFarFade,layers:t},this.frustumCulled=!1,this.renderOrder=this.settings.renderOrder}addSystem(e){this.systems.add(e)}removeSystem(e){this.systems.delete(e)}applyDepthTexture(e){const t=this.material.uniforms.depthTexture;t&&t.value!==e&&(t.value=e,this.material.needsUpdate=!0)}}const gXe=new Pt(0,0,1),ZD=new Dn,AXe=new Pt,yXe=new Pt;new Pt;const JY=60,bXe=new Rs(1,1,1,1);let xXe=class Oz{set time(e){this.emissionState.time=e}get time(){return this.emissionState.time}get layers(){return this.rendererSettings.layers}get texture(){return this.rendererSettings.material.map}set texture(e){this.rendererSettings.material.map=e,this.neededToUpdateRender=!0}get material(){return this.rendererSettings.material}set material(e){this.rendererSettings.material=e,this.neededToUpdateRender=!0}get uTileCount(){return this.rendererSettings.uTileCount}set uTileCount(e){this.rendererSettings.uTileCount=e,this.neededToUpdateRender=!0}get vTileCount(){return this.rendererSettings.vTileCount}set vTileCount(e){this.rendererSettings.vTileCount=e,this.neededToUpdateRender=!0}get blendTiles(){return this.rendererSettings.blendTiles}set blendTiles(e){this.rendererSettings.blendTiles=e,this.neededToUpdateRender=!0}get softParticles(){return this.rendererSettings.softParticles}set softParticles(e){this.rendererSettings.softParticles=e,this.neededToUpdateRender=!0}get softNearFade(){return this.rendererSettings.softNearFade}set softNearFade(e){this.rendererSettings.softNearFade=e,this.neededToUpdateRender=!0}get softFarFade(){return this.rendererSettings.softFarFade}set softFarFade(e){this.rendererSettings.softFarFade=e,this.neededToUpdateRender=!0}get instancingGeometry(){return this.rendererSettings.instancingGeometry}set instancingGeometry(e){this.restart(),this.particles.length=0,this.rendererSettings.instancingGeometry=e,this.neededToUpdateRender=!0}get renderMode(){return this.rendererSettings.renderMode}set renderMode(e){if((this.rendererSettings.renderMode!=gt.Trail&&e===gt.Trail||this.rendererSettings.renderMode==gt.Trail&&e!==gt.Trail)&&(this.restart(),this.particles.length=0),this.rendererSettings.renderMode!==e)switch(e){case gt.Trail:this.rendererEmitterSettings={startLength:new nn(30),followLocalOrigin:!1};break;case gt.Mesh:this.rendererEmitterSettings={geometry:new Rs(1,1)},this.startRotation=new GS(new Pt(0,1,0),new nn(0));break;case gt.StretchedBillBoard:this.rendererEmitterSettings={speedFactor:0,lengthFactor:2},this.rendererSettings.renderMode===gt.Mesh&&(this.startRotation=new nn(0));break;case gt.BillBoard:case gt.VerticalBillBoard:case gt.HorizontalBillBoard:this.rendererEmitterSettings={},this.rendererSettings.renderMode===gt.Mesh&&(this.startRotation=new nn(0));break}this.rendererSettings.renderMode=e,this.neededToUpdateRender=!0}get renderOrder(){return this.rendererSettings.renderOrder}set renderOrder(e){this.rendererSettings.renderOrder=e,this.neededToUpdateRender=!0}get blending(){return this.rendererSettings.material.blending}set blending(e){this.rendererSettings.material.blending=e,this.neededToUpdateRender=!0}constructor(e){var t,i,n,r,o,a,l,c,h,d,u,f,m,g,A,y,b,x,v,_,C,S,M,L,w,E;if(this.temp=new Pt,this.travelDistance=0,this.normalMatrix=new kd,this.memory=[],this.listeners={},this.firstTimeUpdate=!0,this.autoDestroy=e.autoDestroy===void 0?!1:e.autoDestroy,this.duration=(t=e.duration)!==null&&t!==void 0?t:1,this.looping=e.looping===void 0?!0:e.looping,this.prewarm=e.prewarm===void 0?!1:e.prewarm,this.startLife=(i=e.startLife)!==null&&i!==void 0?i:new nn(5),this.startSpeed=(n=e.startSpeed)!==null&&n!==void 0?n:new nn(0),this.startRotation=(r=e.startRotation)!==null&&r!==void 0?r:new nn(0),this.startSize=(o=e.startSize)!==null&&o!==void 0?o:new nn(1),this.startColor=(a=e.startColor)!==null&&a!==void 0?a:new sA(new cl(1,1,1,1)),this.emissionOverTime=(l=e.emissionOverTime)!==null&&l!==void 0?l:new nn(10),this.emissionOverDistance=(c=e.emissionOverDistance)!==null&&c!==void 0?c:new nn(0),this.emissionBursts=(h=e.emissionBursts)!==null&&h!==void 0?h:[],this.onlyUsedByOther=(d=e.onlyUsedByOther)!==null&&d!==void 0?d:!1,this.emitterShape=(u=e.shape)!==null&&u!==void 0?u:new kx,this.behaviors=(f=e.behaviors)!==null&&f!==void 0?f:new Array,this.worldSpace=(m=e.worldSpace)!==null&&m!==void 0?m:!1,this.rendererEmitterSettings=(g=e.rendererEmitterSettings)!==null&&g!==void 0?g:{},e.renderMode===gt.StretchedBillBoard){const B=this.rendererEmitterSettings;e.speedFactor!==void 0&&(B.speedFactor=e.speedFactor),B.speedFactor=(A=B.speedFactor)!==null&&A!==void 0?A:0,B.lengthFactor=(y=B.lengthFactor)!==null&&y!==void 0?y:0}this.rendererSettings={instancingGeometry:(b=e.instancingGeometry)!==null&&b!==void 0?b:bXe,renderMode:(x=e.renderMode)!==null&&x!==void 0?x:gt.BillBoard,renderOrder:(v=e.renderOrder)!==null&&v!==void 0?v:0,material:e.material,uTileCount:(_=e.uTileCount)!==null&&_!==void 0?_:1,vTileCount:(C=e.vTileCount)!==null&&C!==void 0?C:1,blendTiles:(S=e.blendTiles)!==null&&S!==void 0?S:!1,softParticles:(M=e.softParticles)!==null&&M!==void 0?M:!1,softNearFade:(L=e.softNearFade)!==null&&L!==void 0?L:0,softFarFade:(w=e.softFarFade)!==null&&w!==void 0?w:0,layers:(E=e.layers)!==null&&E!==void 0?E:new ta},this.neededToUpdateRender=!0,this.particles=new Array,this.startTileIndex=e.startTileIndex||new nn(0),this.emitter=new mXe(this),this.paused=!1,this.particleNum=0,this.emissionState={isBursting:!1,burstParticleIndex:0,burstParticleCount:0,burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,travelDistance:0},this.emissionBursts.forEach(B=>B.count.startGen(this.memory)),this.emissionOverDistance.startGen(this.memory),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}pause(){this.paused=!0}play(){this.paused=!1}stop(){this.restart(),this.pause()}spawn(e,t,i){ZD.setFromRotationMatrix(i);const n=AXe,r=ZD,o=yXe;i.decompose(n,r,o);for(let a=0;a<e;a++){for(t.burstParticleIndex=a,this.particleNum++;this.particles.length<this.particleNum;)this.rendererSettings.renderMode===gt.Trail?this.particles.push(new YS):this.particles.push(new KUe);const l=this.particles[this.particleNum-1];if(l.reset(),l.speedModifier=1,this.startColor.startGen(l.memory),this.startColor.genColor(l.memory,l.startColor,this.emissionState.time),l.color.copy(l.startColor),this.startSpeed.startGen(l.memory),l.startSpeed=this.startSpeed.genValue(l.memory,t.time/this.duration),this.startLife.startGen(l.memory),l.life=this.startLife.genValue(l.memory,t.time/this.duration),l.age=0,this.startSize.startGen(l.memory),this.startSize.type==="vec3function")this.startSize.genValue(l.memory,l.startSize,t.time/this.duration);else{const c=this.startSize.genValue(l.memory,t.time/this.duration);l.startSize.set(c,c,c)}if(this.startTileIndex.startGen(l.memory),l.uvTile=this.startTileIndex.genValue(l.memory),l.size.copy(l.startSize),this.rendererSettings.renderMode===gt.Mesh||this.rendererSettings.renderMode===gt.BillBoard||this.rendererSettings.renderMode===gt.VerticalBillBoard||this.rendererSettings.renderMode===gt.HorizontalBillBoard||this.rendererSettings.renderMode===gt.StretchedBillBoard){const c=l;this.startRotation.startGen(l.memory),this.rendererSettings.renderMode===gt.Mesh?(c.rotation instanceof Dn||(c.rotation=new Dn),this.startRotation.type==="rotation"?this.startRotation.genValue(l.memory,c.rotation,1,t.time/this.duration):c.rotation.setFromAxisAngle(gXe,this.startRotation.genValue(c.memory,t.time/this.duration))):this.startRotation.type==="rotation"?c.rotation=0:c.rotation=this.startRotation.genValue(c.memory,t.time/this.duration)}else if(this.rendererSettings.renderMode===gt.Trail){const c=l;this.rendererEmitterSettings.startLength.startGen(c.memory),c.length=this.rendererEmitterSettings.startLength.genValue(c.memory,t.time/this.duration)}if(this.emitterShape.initialize(l,t),this.rendererSettings.renderMode===gt.Trail&&this.rendererEmitterSettings.followLocalOrigin){const c=l;c.localPosition=new Pt().copy(c.position)}this.worldSpace?(l.position.applyMatrix4(i),l.startSize.multiply(o).abs(),l.size.copy(l.startSize),l.velocity.multiply(o).applyMatrix3(this.normalMatrix),l.rotation&&l.rotation instanceof Dn&&l.rotation.multiplyQuaternions(ZD,l.rotation)):this.onlyUsedByOther&&(l.parentMatrix=i);for(let c=0;c<this.behaviors.length;c++)this.behaviors[c].initialize(l,this)}}endEmit(){this.emitEnded=!0,this.autoDestroy&&(this.markForDestroy=!0),this.fire({type:"emitEnd",particleSystem:this})}dispose(){this._renderer&&this._renderer.deleteSystem(this),this.emitter.dispose(),this.emitter.parent&&this.emitter.parent.remove(this.emitter),this.fire({type:"destroy",particleSystem:this})}restart(){this.memory.length=0,this.paused=!1,this.particleNum=0,this.emissionState.isBursting=!1,this.emissionState.burstIndex=0,this.emissionState.burstWaveIndex=0,this.emissionState.time=0,this.emissionState.waitEmiting=0,this.behaviors.forEach(e=>{e.reset()}),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1,this.emissionBursts.forEach(e=>e.count.startGen(this.memory)),this.emissionOverDistance.startGen(this.memory)}update(e){if(this.paused)return;let t=this.emitter;for(;t.parent;)t=t.parent;if(t.type!=="Scene"){this.dispose();return}if(this.firstTimeUpdate&&(this.firstTimeUpdate=!1,this.emitter.updateWorldMatrix(!0,!1)),this.emitEnded&&this.particleNum===0){this.markForDestroy&&this.emitter.parent&&this.dispose();return}if(this.looping&&this.prewarm&&!this.prewarmed){this.prewarmed=!0;for(let i=0;i<this.duration*JY;i++)this.update(1/JY)}e>.1&&(e=.1),this.neededToUpdateRender&&(this._renderer&&this._renderer.updateSystem(this),this.neededToUpdateRender=!1),this.onlyUsedByOther||this.emit(e,this.emissionState,this.emitter.matrixWorld),this.emitterShape.update(this,e);for(let i=0;i<this.behaviors.length;i++){this.behaviors[i].frameUpdate(e);for(let n=0;n<this.particleNum;n++)this.particles[n].died||this.behaviors[i].update(this.particles[n],e)}for(let i=0;i<this.particleNum;i++)this.rendererEmitterSettings.followLocalOrigin&&this.particles[i].localPosition?(this.particles[i].position.copy(this.particles[i].localPosition),this.particles[i].parentMatrix?this.particles[i].position.applyMatrix4(this.particles[i].parentMatrix):this.particles[i].position.applyMatrix4(this.emitter.matrixWorld)):this.particles[i].position.addScaledVector(this.particles[i].velocity,e*this.particles[i].speedModifier),this.particles[i].age+=e;if(this.rendererSettings.renderMode===gt.Trail)for(let i=0;i<this.particleNum;i++)this.particles[i].update();for(let i=0;i<this.particleNum;i++){const n=this.particles[i];n.died&&(!(n instanceof YS)||n.previous.length===0)&&(this.particles[i]=this.particles[this.particleNum-1],this.particles[this.particleNum-1]=n,this.particleNum--,i--,this.fire({type:"particleDied",particleSystem:this,particle:n}))}}emit(e,t,i){t.time>this.duration&&(this.looping?(t.time-=this.duration,t.burstIndex=0,this.behaviors.forEach(r=>{r.reset()})):!this.emitEnded&&!this.onlyUsedByOther&&this.endEmit()),this.normalMatrix.getNormalMatrix(i);const n=Math.ceil(t.waitEmiting);for(this.spawn(n,t,i),t.waitEmiting-=n;t.burstIndex<this.emissionBursts.length&&this.emissionBursts[t.burstIndex].time<=t.time;){if(Math.random()<this.emissionBursts[t.burstIndex].probability){const r=this.emissionBursts[t.burstIndex].count.genValue(this.memory,this.time);t.isBursting=!0,t.burstParticleCount=r,this.spawn(r,t,i),t.isBursting=!1}t.burstIndex++}if(!this.emitEnded&&(t.waitEmiting+=e*this.emissionOverTime.genValue(this.memory,t.time/this.duration),t.previousWorldPos!=null)){this.temp.set(i.elements[12],i.elements[13],i.elements[14]),t.travelDistance+=t.previousWorldPos.distanceTo(this.temp);const r=this.emissionOverDistance.genValue(this.memory,t.time/this.duration);if(t.travelDistance*r>0){const o=Math.floor(t.travelDistance*r);t.travelDistance-=o/r,t.waitEmiting+=o}}t.previousWorldPos===void 0&&(t.previousWorldPos=new Pt),t.previousWorldPos.set(i.elements[12],i.elements[13],i.elements[14]),t.time+=e}toJSON(e,t={}){var i;if((e===void 0||typeof e=="string")&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}}),e.materials[this.rendererSettings.material.uuid]=this.rendererSettings.material.toJSON(e),t.useUrlForImage&&((i=this.texture)===null||i===void 0?void 0:i.source)!==void 0){const a=this.texture.source;e.images[a.uuid]={uuid:a.uuid,url:this.texture.image.url}}let r;this.renderMode===gt.Trail?r={startLength:this.rendererEmitterSettings.startLength.toJSON(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===gt.Mesh?r={}:this.renderMode===gt.StretchedBillBoard?r={speedFactor:this.rendererEmitterSettings.speedFactor,lengthFactor:this.rendererEmitterSettings.lengthFactor}:r={};const o=this.rendererSettings.instancingGeometry;return e.geometries&&!e.geometries[o.uuid]&&(e.geometries[o.uuid]=o.toJSON()),{version:"3.0",autoDestroy:this.autoDestroy,looping:this.looping,prewarm:this.prewarm,duration:this.duration,shape:this.emitterShape.toJSON(),startLife:this.startLife.toJSON(),startSpeed:this.startSpeed.toJSON(),startRotation:this.startRotation.toJSON(),startSize:this.startSize.toJSON(),startColor:this.startColor.toJSON(),emissionOverTime:this.emissionOverTime.toJSON(),emissionOverDistance:this.emissionOverDistance.toJSON(),emissionBursts:this.emissionBursts.map(a=>({time:a.time,count:a.count.toJSON(),probability:a.probability,interval:a.interval,cycle:a.cycle})),onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry.uuid,renderOrder:this.renderOrder,renderMode:this.renderMode,rendererEmitterSettings:r,material:this.rendererSettings.material.uuid,layers:this.layers.mask,startTileIndex:this.startTileIndex.toJSON(),uTileCount:this.uTileCount,vTileCount:this.vTileCount,blendTiles:this.blendTiles,softParticles:this.rendererSettings.softParticles,softFarFade:this.rendererSettings.softFarFade,softNearFade:this.rendererSettings.softNearFade,behaviors:this.behaviors.map(a=>a.toJSON()),worldSpace:this.worldSpace}}static fromJSON(e,t,i){var n,r;const o=HUe(e.shape,t);let a;if(e.renderMode===gt.Trail){const h=e.rendererEmitterSettings;a={startLength:h.startLength!=null?ki(h.startLength):new nn(30),followLocalOrigin:h.followLocalOrigin}}else e.renderMode===gt.Mesh?a={}:e.renderMode===gt.StretchedBillBoard?(a=e.rendererEmitterSettings,e.speedFactor!=null&&(a.speedFactor=e.speedFactor)):a={};const l=new ta;e.layers&&(l.mask=e.layers);const c=new Oz({autoDestroy:e.autoDestroy,looping:e.looping,prewarm:e.prewarm,duration:e.duration,shape:o,startLife:ki(e.startLife),startSpeed:ki(e.startSpeed),startRotation:R2(e.startRotation),startSize:R2(e.startSize),startColor:vZ(e.startColor),emissionOverTime:ki(e.emissionOverTime),emissionOverDistance:ki(e.emissionOverDistance),emissionBursts:(n=e.emissionBursts)===null||n===void 0?void 0:n.map(h=>{var d,u,f;return{time:h.time,count:typeof h.count=="number"?new nn(h.count):ki(h.count),probability:(d=h.probability)!==null&&d!==void 0?d:1,interval:(u=h.interval)!==null&&u!==void 0?u:.1,cycle:(f=h.cycle)!==null&&f!==void 0?f:1}}),onlyUsedByOther:e.onlyUsedByOther,instancingGeometry:t.geometries[e.instancingGeometry],renderMode:e.renderMode,rendererEmitterSettings:a,renderOrder:e.renderOrder,layers:l,material:e.material?t.materials[e.material]:e.texture?new ii({map:t.textures[e.texture],transparent:(r=e.transparent)!==null&&r!==void 0?r:!0,blending:e.blending,side:Zi}):new ii({color:16777215,transparent:!0,blending:sm,side:Zi}),startTileIndex:typeof e.startTileIndex=="number"?new nn(e.startTileIndex):ki(e.startTileIndex),uTileCount:e.uTileCount,vTileCount:e.vTileCount,blendTiles:e.blendTiles,softParticles:e.softParticles,softFarFade:e.softFarFade,softNearFade:e.softNearFade,behaviors:[],worldSpace:e.worldSpace});return c.behaviors=e.behaviors.map(h=>{const d=nXe(h,c);return d.type==="EmitSubParticleSystem"&&(i[h.subParticleSystem]=d),d}),c}addBehavior(e){this.behaviors.push(e)}getRendererSettings(){return this.rendererSettings}addEventListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}removeAllEventListeners(e){this.listeners[e]&&(this.listeners[e]=[])}removeEventListener(e,t){if(this.listeners[e]){const i=this.listeners[e].indexOf(t);i!==-1&&this.listeners[e].splice(i,1)}}fire(e){this.listeners[e.type]&&this.listeners[e.type].forEach(t=>t(e))}clone(){const e=[];for(const r of this.emissionBursts){const o={};Object.assign(o,r),e.push(o)}const t=[];for(const r of this.behaviors)t.push(r.clone());let i;this.renderMode===gt.Trail?i={startLength:this.rendererEmitterSettings.startLength.clone(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===gt.StretchedBillBoard?i={lengthFactor:this.rendererEmitterSettings.lengthFactor,speedFactor:this.rendererEmitterSettings.speedFactor}:i={};const n=new ta;return n.mask=this.layers.mask,new Oz({autoDestroy:this.autoDestroy,looping:this.looping,duration:this.duration,shape:this.emitterShape.clone(),startLife:this.startLife.clone(),startSpeed:this.startSpeed.clone(),startRotation:this.startRotation.clone(),startSize:this.startSize.clone(),startColor:this.startColor.clone(),emissionOverTime:this.emissionOverTime.clone(),emissionOverDistance:this.emissionOverDistance.clone(),emissionBursts:e,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry,renderMode:this.renderMode,renderOrder:this.renderOrder,rendererEmitterSettings:i,material:this.rendererSettings.material,startTileIndex:this.startTileIndex,uTileCount:this.uTileCount,vTileCount:this.vTileCount,blendTiles:this.blendTiles,softParticles:this.softParticles,softFarFade:this.softFarFade,softNearFade:this.softNearFade,behaviors:t,worldSpace:this.worldSpace,layers:n})}};var WD=`

#include <common>
#include <color_pars_fragment>
#include <map_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <alphatest_pars_fragment>

#include <tile_pars_fragment>
#include <soft_pars_fragment>

void main() {

    #include <clipping_planes_fragment>
    
    vec3 outgoingLight = vec3( 0.0 );
    vec4 diffuseColor = vColor;
    
    #include <logdepthbuf_fragment>
    
    #include <tile_fragment>
    #include <alphatest_fragment>

    outgoingLight = diffuseColor.rgb;
    
    #ifdef USE_COLOR_AS_ALPHA
    gl_FragColor = vec4( outgoingLight, diffuseColor.r );
    #else
    gl_FragColor = vec4( outgoingLight, diffuseColor.a );
    #endif
    
    #include <soft_fragment>
    #include <tonemapping_fragment>
}
`,_Z=`
#define STANDARD

#ifdef PHYSICAL
#define IOR
#define USE_SPECULAR
#endif

uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;

#ifdef IOR
uniform float ior;
#endif

#ifdef USE_SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;

#ifdef USE_SPECULAR_COLORMAP
uniform sampler2D specularColorMap;
#endif

#ifdef USE_SPECULAR_INTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#endif

#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif

#ifdef USE_DISPERSION
uniform float dispersion;
#endif

#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif

#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;

#ifdef USE_SHEEN_COLORMAP
uniform sampler2D sheenColorMap;
#endif

#ifdef USE_SHEEN_ROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif

#ifdef USE_ANISOTROPY
uniform vec2 anisotropyVector;

#ifdef USE_ANISOTROPYMAP
uniform sampler2D anisotropyMap;
#endif
#endif

varying vec3 vViewPosition;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

vec4 diffuseColor = vec4( diffuse, opacity );
#include <clipping_planes_fragment>

ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveRadiance = emissive;

#include <logdepthbuf_fragment>
#include <map_fragment>
#include <color_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <alphahash_fragment>
#include <roughnessmap_fragment>
#include <metalnessmap_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <clearcoat_normal_fragment_begin>
#include <clearcoat_normal_fragment_maps>
#include <emissivemap_fragment>

// accumulation
#include <lights_physical_fragment>
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>

// modulation
#include <aomap_fragment>

vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;

#include <transmission_fragment>

vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;

#ifdef USE_SHEEN

// Sheen energy compensation approximation calculation can be found at the end of
// https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );

outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;

#endif

#ifdef USE_CLEARCOAT

float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );

vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );

outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;

#endif

#include <opaque_fragment>
#include <tonemapping_fragment>
#include <colorspace_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,vXe=`
#include <common>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

#include <tile_pars_vertex>
#include <soft_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute vec3 size;

void main() {
	
    vec2 alignedPosition = position.xy * size.xy;
    
    vec2 rotatedPosition;
    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
#ifdef HORIZONTAL
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.x += rotatedPosition.x;
    mvPosition.z -= rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
#elif defined(VERTICAL)
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.y += rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
    mvPosition.x += rotatedPosition.x;
#else
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    mvPosition.xy += rotatedPosition;
#endif

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>

	#include <clipping_planes_vertex>

	#include <tile_vertex>
	#include <soft_vertex>
}
`,_Xe=`
#include <common>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <tile_pars_vertex>
#include <soft_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute vec3 size;
// attribute vec4 color;

void main() {

    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size.x, sy = size.y, sz = size.z;
    
    mat4 matrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);
    
    vec4 mvPosition = modelViewMatrix * (matrix * vec4( position, 1.0 ));

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
    #include <tile_vertex>
    #include <soft_vertex>
}
`,CZ=`
#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>

attribute vec3 offset;
attribute vec4 rotation;
attribute vec3 size;
#include <tile_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

    #include <tile_vertex>
    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size.x, sy = size.y, sz = size.z;

    mat4 particleMatrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);

#include <color_vertex>
#include <morphinstance_vertex>
#include <morphcolor_vertex>
#include <batching_vertex>

#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>

	// replace defaultnormal_vertex
	vec3 transformedNormal = objectNormal;
    mat3 m = mat3( particleMatrix );
    transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
    transformedNormal = m * transformedNormal;
    transformedNormal = normalMatrix * transformedNormal;
    #ifdef FLIP_SIDED
        transformedNormal = - transformedNormal;
    #endif
    #ifdef USE_TANGENT
        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
        #ifdef FLIP_SIDED
        transformedTangent = - transformedTangent;
        #endif
    #endif

	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>

	// replace include <project_vertex>
  vec4 mvPosition = vec4( transformed, 1.0 );
  mvPosition = modelViewMatrix * (particleMatrix * mvPosition);
	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
	vViewPosition = - mvPosition.xyz;
	
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
    vWorldPosition = worldPosition.xyz;
#endif
}
`,CXe=`
#include <common>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

#include <tile_pars_vertex>
#include <soft_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute vec3 size;
attribute vec4 velocity;

uniform float speedFactor;

void main() {
    float lengthFactor = velocity.w;
    float avgSize = (size.x + size.y) * 0.5;
#ifdef USE_SKEW
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    vec3 viewVelocity = normalMatrix * velocity.xyz;

    vec3 scaledPos = vec3(position.xy * size.xy, position.z);
    float vlength = length(viewVelocity);
    vec3 projVelocity =  dot(scaledPos, viewVelocity) * viewVelocity / vlength;
    mvPosition.xyz += scaledPos + projVelocity * (speedFactor / avgSize + lengthFactor / vlength);
#else
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    vec3 viewVelocity = normalMatrix * velocity.xyz;
    float vlength = length(viewVelocity); 
    mvPosition.xyz += position.y * normalize(cross(mvPosition.xyz, viewVelocity)) * avgSize; // switch the cross to  match unity implementation
    mvPosition.xyz -= (position.x + 0.5) * viewVelocity * (1.0 + lengthFactor / vlength) * avgSize; // minus position.x to match unity implementation
#endif
	vColor = color;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <tile_vertex>
	#include <soft_vertex>
}
`;function Zz(s){return s===0?"uv":`uv${s}`}class wXe extends Us{constructor(e){super(e)}onBeforeCompile(e,t){super.onBeforeCompile(e,t),e.vertexShader=CZ,e.fragmentShader=_Z}}class SXe extends To{constructor(e){super(e)}onBeforeCompile(e,t){super.onBeforeCompile(e,t),e.vertexShader=CZ,e.fragmentShader=_Z}}new Pt(0,0,1);class MXe extends Bae{constructor(e){super(e),this.vector_=new Pt,this.vector2_=new Pt,this.vector3_=new Pt,this.quaternion_=new Dn,this.quaternion2_=new Dn,this.quaternion3_=new Dn,this.rotationMat_=new kd,this.rotationMat2_=new kd,this.maxParticles=1e3,this.setupBuffers(),this.rebuildMaterial()}buildExpandableBuffers(){this.offsetBuffer=new $o(new Float32Array(this.maxParticles*3),3),this.offsetBuffer.setUsage(Vs),this.geometry.setAttribute("offset",this.offsetBuffer),this.colorBuffer=new $o(new Float32Array(this.maxParticles*4),4),this.colorBuffer.setUsage(Vs),this.geometry.setAttribute("color",this.colorBuffer),this.settings.renderMode===gt.Mesh?(this.rotationBuffer=new $o(new Float32Array(this.maxParticles*4),4),this.rotationBuffer.setUsage(Vs),this.geometry.setAttribute("rotation",this.rotationBuffer)):(this.settings.renderMode===gt.BillBoard||this.settings.renderMode===gt.HorizontalBillBoard||this.settings.renderMode===gt.VerticalBillBoard||this.settings.renderMode===gt.StretchedBillBoard)&&(this.rotationBuffer=new $o(new Float32Array(this.maxParticles),1),this.rotationBuffer.setUsage(Vs),this.geometry.setAttribute("rotation",this.rotationBuffer)),this.sizeBuffer=new $o(new Float32Array(this.maxParticles*3),3),this.sizeBuffer.setUsage(Vs),this.geometry.setAttribute("size",this.sizeBuffer),this.uvTileBuffer=new $o(new Float32Array(this.maxParticles),1),this.uvTileBuffer.setUsage(Vs),this.geometry.setAttribute("uvTile",this.uvTileBuffer),this.settings.renderMode===gt.StretchedBillBoard&&(this.velocityBuffer=new $o(new Float32Array(this.maxParticles*4),4),this.velocityBuffer.setUsage(Vs),this.geometry.setAttribute("velocity",this.velocityBuffer))}setupBuffers(){this.geometry&&this.geometry.dispose(),this.geometry=new _B,this.geometry.setIndex(this.settings.instancingGeometry.getIndex()),this.settings.instancingGeometry.hasAttribute("normal")&&this.geometry.setAttribute("normal",this.settings.instancingGeometry.getAttribute("normal")),this.geometry.setAttribute("position",this.settings.instancingGeometry.getAttribute("position")),this.geometry.setAttribute("uv",this.settings.instancingGeometry.getAttribute("uv")),this.buildExpandableBuffers()}expandBuffers(e){for(;e>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}rebuildMaterial(){this.layers.mask=this.settings.layers.mask;const e={},t={};this.settings.material.type!=="MeshStandardMaterial"&&this.settings.material.type!=="MeshPhysicalMaterial"&&(e.map=new Te(this.settings.material.map)),this.settings.material.alphaTest&&(t.USE_ALPHATEST="",e.alphaTest=new Te(this.settings.material.alphaTest)),t.USE_UV="";const i=this.settings.uTileCount,n=this.settings.vTileCount;(i>1||n>1)&&(t.UV_TILE="",e.tileCount=new Te(new Px(i,n))),this.settings.material.defines&&this.settings.material.defines.USE_COLOR_AS_ALPHA!==void 0&&(t.USE_COLOR_AS_ALPHA=""),this.settings.material.normalMap&&(t.USE_NORMALMAP="",t.NORMALMAP_UV=Zz(this.settings.material.normalMap.channel),e.normalMapTransform=new Te(new kd().copy(this.settings.material.normalMap.matrix))),this.settings.material.map&&(t.USE_MAP="",this.settings.blendTiles&&(t.TILE_BLEND=""),t.MAP_UV=Zz(this.settings.material.map.channel),e.mapTransform=new Te(new kd().copy(this.settings.material.map.matrix))),t.USE_COLOR_ALPHA="";let r;if(this.settings.softParticles){t.SOFT_PARTICLES="";const a=this.settings.softNearFade,l=1/(this.settings.softFarFade-this.settings.softNearFade);e.softParams=new Te(new Px(a,l)),e.depthTexture=new Te(null);const c=e.projParams=new Te(new cl);r=(h,d,u)=>{c.value.set(u.near,u.far,0,0)}}let o=!1;if(this.settings.renderMode===gt.BillBoard||this.settings.renderMode===gt.VerticalBillBoard||this.settings.renderMode===gt.HorizontalBillBoard||this.settings.renderMode===gt.Mesh){let a,l;this.settings.renderMode===gt.Mesh?this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"?(t.USE_COLOR="",a=CZ,l=_Z,o=!0):(a=_Xe,l=WD):(a=vXe,l=WD),this.settings.renderMode===gt.VerticalBillBoard?t.VERTICAL="":this.settings.renderMode===gt.HorizontalBillBoard&&(t.HORIZONTAL="");let c=!1;this.settings.renderMode===gt.Mesh&&(this.settings.material.type==="MeshStandardMaterial"?(this.material=new wXe({}),this.material.copy(this.settings.material),this.material.uniforms=e,this.material.defines=t,c=!0):this.settings.material.type==="MeshPhysicalMaterial"&&(this.material=new SXe({}),this.material.copy(this.settings.material),this.material.uniforms=e,this.material.defines=t,c=!0)),c||(this.material=new Ht({uniforms:e,defines:t,vertexShader:a,fragmentShader:l,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,blendDst:this.settings.material.blendDst,blendSrc:this.settings.material.blendSrc,blendEquation:this.settings.material.blendEquation,premultipliedAlpha:this.settings.material.premultipliedAlpha,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,depthTest:this.settings.material.depthTest,lights:o}))}else if(this.settings.renderMode===gt.StretchedBillBoard)e.speedFactor=new Te(1),this.material=new Ht({uniforms:e,defines:t,vertexShader:CXe,fragmentShader:WD,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,blendDst:this.settings.material.blendDst,blendSrc:this.settings.material.blendSrc,blendEquation:this.settings.material.blendEquation,premultipliedAlpha:this.settings.material.premultipliedAlpha,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,depthTest:this.settings.material.depthTest});else throw new Error("render mode unavailable");this.material&&r&&(this.material.onBeforeRender=r)}update(){let e=0,t=0;this.systems.forEach(i=>{t+=i.particleNum}),t>this.maxParticles&&this.expandBuffers(t),this.systems.forEach(i=>{i.emitter.updateMatrixWorld&&(i.emitter.updateWorldMatrix(!0,!1),i.emitter.updateMatrixWorld(!0));const n=i.particles,r=i.particleNum,o=this.quaternion2_,a=this.vector2_,l=this.vector3_;i.emitter.matrixWorld.decompose(a,o,l),this.rotationMat_.setFromMatrix4(i.emitter.matrixWorld);for(let c=0;c<r;c++,e++){const h=n[c];if(this.settings.renderMode===gt.Mesh){let u;if(i.worldSpace)u=h.rotation;else{let f;h.parentMatrix?f=this.quaternion3_.setFromRotationMatrix(h.parentMatrix):f=o,u=this.quaternion_,u.copy(f).multiply(h.rotation)}this.rotationBuffer.setXYZW(e,u.x,u.y,u.z,u.w)}else(this.settings.renderMode===gt.StretchedBillBoard||this.settings.renderMode===gt.VerticalBillBoard||this.settings.renderMode===gt.HorizontalBillBoard||this.settings.renderMode===gt.BillBoard)&&this.rotationBuffer.setX(e,h.rotation);let d;if(i.worldSpace?d=h.position:(d=this.vector_,h.parentMatrix?d.copy(h.position).applyMatrix4(h.parentMatrix):d.copy(h.position).applyMatrix4(i.emitter.matrixWorld)),this.offsetBuffer.setXYZ(e,d.x,d.y,d.z),this.colorBuffer.setXYZW(e,h.color.x,h.color.y,h.color.z,h.color.w),i.worldSpace?this.sizeBuffer.setXYZ(e,h.size.x,h.size.y,h.size.z):h.parentMatrix?this.sizeBuffer.setXYZ(e,h.size.x,h.size.y,h.size.z):this.sizeBuffer.setXYZ(e,h.size.x*Math.abs(l.x),h.size.y*Math.abs(l.y),h.size.z*Math.abs(l.z)),this.uvTileBuffer.setX(e,h.uvTile),this.settings.renderMode===gt.StretchedBillBoard&&this.velocityBuffer){let u=i.rendererEmitterSettings.speedFactor;u===0&&(u=.001);const f=i.rendererEmitterSettings.lengthFactor;let m;i.worldSpace?m=h.velocity:(m=this.vector_,h.parentMatrix?(this.rotationMat2_.setFromMatrix4(h.parentMatrix),m.copy(h.velocity).applyMatrix3(this.rotationMat2_)):m.copy(h.velocity).applyMatrix3(this.rotationMat_)),this.velocityBuffer.setXYZW(e,m.x*u,m.y*u,m.z*u,f)}}}),this.geometry.instanceCount=e,e>0&&(this.offsetBuffer.clearUpdateRanges(),this.offsetBuffer.addUpdateRange(0,e*3),this.offsetBuffer.needsUpdate=!0,this.sizeBuffer.clearUpdateRanges(),this.sizeBuffer.addUpdateRange(0,e*3),this.sizeBuffer.needsUpdate=!0,this.colorBuffer.clearUpdateRanges(),this.colorBuffer.addUpdateRange(0,e*4),this.colorBuffer.needsUpdate=!0,this.uvTileBuffer.clearUpdateRanges(),this.uvTileBuffer.addUpdateRange(0,e),this.uvTileBuffer.needsUpdate=!0,this.settings.renderMode===gt.StretchedBillBoard&&this.velocityBuffer&&(this.velocityBuffer.clearUpdateRanges(),this.velocityBuffer.addUpdateRange(0,e*4),this.velocityBuffer.needsUpdate=!0),this.settings.renderMode===gt.Mesh?(this.rotationBuffer.clearUpdateRanges(),this.rotationBuffer.addUpdateRange(0,e*4),this.rotationBuffer.needsUpdate=!0):(this.settings.renderMode===gt.StretchedBillBoard||this.settings.renderMode===gt.HorizontalBillBoard||this.settings.renderMode===gt.VerticalBillBoard||this.settings.renderMode===gt.BillBoard)&&(this.rotationBuffer.clearUpdateRanges(),this.rotationBuffer.addUpdateRange(0,e),this.rotationBuffer.needsUpdate=!0))}dispose(){this.geometry.dispose()}}var IXe=`

#include <common>
#include <tile_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

uniform sampler2D alphaMap;
uniform float useAlphaMap;
uniform float visibility;
uniform float alphaTest;

varying vec4 vColor;
    
void main() {
    #include <clipping_planes_fragment>
    #include <logdepthbuf_fragment>

    vec4 diffuseColor = vColor;
    
    #ifdef USE_MAP
    #include <tile_fragment>
    #ifndef USE_COLOR_AS_ALPHA
    #endif
    #endif
    if( useAlphaMap == 1. ) diffuseColor.a *= texture2D( alphaMap, vUv).a;
    if( diffuseColor.a < alphaTest ) discard;
    gl_FragColor = diffuseColor;

    #include <fog_fragment>
    #include <tonemapping_fragment>
}`,TXe=`
#include <common>
#include <tile_pars_vertex>
#include <color_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <fog_pars_vertex>

attribute vec3 previous;
attribute vec3 next;
attribute float side;
attribute float width;

uniform vec2 resolution;
uniform float lineWidth;
uniform float sizeAttenuation;
    
vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
}
    
void main() {

    #include <tile_vertex>
    
    float aspect = resolution.x / resolution.y;

    vColor = color;

    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4( position, 1.0 );
    vec4 prevPos = m * vec4( previous, 1.0 );
    vec4 nextPos = m * vec4( next, 1.0 );

    vec2 currentP = fix( finalPosition, aspect );
    vec2 prevP = fix( prevPos, aspect );
    vec2 nextP = fix( nextPos, aspect );

    float w = lineWidth * width;

    vec2 dir;
    if( nextP == currentP ) dir = normalize( currentP - prevP );
    else if( prevP == currentP ) dir = normalize( nextP - currentP );
    else {
        vec2 dir1 = normalize( currentP - prevP );
        vec2 dir2 = normalize( nextP - currentP );
        dir = normalize( dir1 + dir2 );

        vec2 perp = vec2( -dir1.y, dir1.x );
        vec2 miter = vec2( -dir.y, dir.x );
        //w = clamp( w / dot( miter, perp ), 0., 4., * lineWidth * width );

    }

    //vec2 normal = ( cross( vec3( dir, 0. ) vec3( 0., 0., 1. ) ) ).xy;
    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );
    normal.xy *= .5 * w;
    normal *= projectionMatrix;
    if( sizeAttenuation == 0. ) {
        normal.xy *= finalPosition.w;
        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;
    }

    finalPosition.xy += normal.xy * side;

    gl_Position = finalPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    
	#include <fog_vertex>
}`;new Pt(0,0,1);class EXe extends Bae{constructor(e){super(e),this.vector_=new Pt,this.vector2_=new Pt,this.vector3_=new Pt,this.quaternion_=new Dn,this.maxParticles=1e4,this.setupBuffers(),this.rebuildMaterial()}setupBuffers(){this.geometry&&this.geometry.dispose(),this.geometry=new It,this.indexBuffer=new dt(new Uint32Array(this.maxParticles*6),1),this.indexBuffer.setUsage(Vs),this.geometry.setIndex(this.indexBuffer),this.positionBuffer=new dt(new Float32Array(this.maxParticles*6),3),this.positionBuffer.setUsage(Vs),this.geometry.setAttribute("position",this.positionBuffer),this.previousBuffer=new dt(new Float32Array(this.maxParticles*6),3),this.previousBuffer.setUsage(Vs),this.geometry.setAttribute("previous",this.previousBuffer),this.nextBuffer=new dt(new Float32Array(this.maxParticles*6),3),this.nextBuffer.setUsage(Vs),this.geometry.setAttribute("next",this.nextBuffer),this.widthBuffer=new dt(new Float32Array(this.maxParticles*2),1),this.widthBuffer.setUsage(Vs),this.geometry.setAttribute("width",this.widthBuffer),this.sideBuffer=new dt(new Float32Array(this.maxParticles*2),1),this.sideBuffer.setUsage(Vs),this.geometry.setAttribute("side",this.sideBuffer),this.uvBuffer=new dt(new Float32Array(this.maxParticles*4),2),this.uvBuffer.setUsage(Vs),this.geometry.setAttribute("uv",this.uvBuffer),this.colorBuffer=new dt(new Float32Array(this.maxParticles*8),4),this.colorBuffer.setUsage(Vs),this.geometry.setAttribute("color",this.colorBuffer)}expandBuffers(e){for(;e>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}rebuildMaterial(){this.layers.mask=this.settings.layers.mask;const e={lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},resolution:{value:new Px(1,1)},sizeAttenuation:{value:1},visibility:{value:1},alphaTest:{value:0}},t={};if(t.USE_UV="",t.USE_COLOR_ALPHA="",this.settings.material.map&&(t.USE_MAP="",t.MAP_UV=Zz(this.settings.material.map.channel),e.map=new Te(this.settings.material.map),e.mapTransform=new Te(new kd().copy(this.settings.material.map.matrix))),this.settings.material.defines&&this.settings.material.defines.USE_COLOR_AS_ALPHA!==void 0&&(t.USE_COLOR_AS_ALPHA=""),this.settings.renderMode===gt.Trail)this.material=new Ht({uniforms:e,defines:t,vertexShader:TXe,fragmentShader:IXe,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,side:this.settings.material.side,blending:this.settings.material.blending||sm,blendDst:this.settings.material.blendDst,blendSrc:this.settings.material.blendSrc,blendEquation:this.settings.material.blendEquation,premultipliedAlpha:this.settings.material.premultipliedAlpha});else throw new Error("render mode unavailable")}update(){let e=0,t=0,i=0;this.systems.forEach(n=>{for(let r=0;r<n.particleNum;r++)i+=n.particles[r].previous.length*2}),i>this.maxParticles&&this.expandBuffers(i),this.systems.forEach(n=>{n.emitter.updateMatrixWorld&&(n.emitter.updateWorldMatrix(!0,!1),n.emitter.updateMatrixWorld(!0));const r=this.quaternion_,o=this.vector2_,a=this.vector3_;n.emitter.matrixWorld.decompose(o,r,a);const l=n.particles,c=n.particleNum,h=this.settings.uTileCount,d=this.settings.vTileCount,u=1/h,f=1/d;for(let m=0;m<c;m++){const g=l[m],A=g.uvTile%d,y=Math.floor(g.uvTile/d+.001),b=g.previous.values();let x=b.next(),v=x.value,_=v;x.done||(x=b.next());let C;x.value!==void 0?C=x.value:C=_;for(let S=0;S<g.previous.length;S++,e+=2){if(this.positionBuffer.setXYZ(e,_.position.x,_.position.y,_.position.z),this.positionBuffer.setXYZ(e+1,_.position.x,_.position.y,_.position.z),n.worldSpace?(this.positionBuffer.setXYZ(e,_.position.x,_.position.y,_.position.z),this.positionBuffer.setXYZ(e+1,_.position.x,_.position.y,_.position.z)):(g.parentMatrix?this.vector_.copy(_.position).applyMatrix4(g.parentMatrix):this.vector_.copy(_.position).applyMatrix4(n.emitter.matrixWorld),this.positionBuffer.setXYZ(e,this.vector_.x,this.vector_.y,this.vector_.z),this.positionBuffer.setXYZ(e+1,this.vector_.x,this.vector_.y,this.vector_.z)),n.worldSpace?(this.previousBuffer.setXYZ(e,v.position.x,v.position.y,v.position.z),this.previousBuffer.setXYZ(e+1,v.position.x,v.position.y,v.position.z)):(g.parentMatrix?this.vector_.copy(v.position).applyMatrix4(g.parentMatrix):this.vector_.copy(v.position).applyMatrix4(n.emitter.matrixWorld),this.previousBuffer.setXYZ(e,this.vector_.x,this.vector_.y,this.vector_.z),this.previousBuffer.setXYZ(e+1,this.vector_.x,this.vector_.y,this.vector_.z)),n.worldSpace?(this.nextBuffer.setXYZ(e,C.position.x,C.position.y,C.position.z),this.nextBuffer.setXYZ(e+1,C.position.x,C.position.y,C.position.z)):(g.parentMatrix?this.vector_.copy(C.position).applyMatrix4(g.parentMatrix):this.vector_.copy(C.position).applyMatrix4(n.emitter.matrixWorld),this.nextBuffer.setXYZ(e,this.vector_.x,this.vector_.y,this.vector_.z),this.nextBuffer.setXYZ(e+1,this.vector_.x,this.vector_.y,this.vector_.z)),this.sideBuffer.setX(e,-1),this.sideBuffer.setX(e+1,1),n.worldSpace)this.widthBuffer.setX(e,_.size),this.widthBuffer.setX(e+1,_.size);else if(g.parentMatrix)this.widthBuffer.setX(e,_.size),this.widthBuffer.setX(e+1,_.size);else{const M=(Math.abs(a.x)+Math.abs(a.y)+Math.abs(a.z))/3;this.widthBuffer.setX(e,_.size*M),this.widthBuffer.setX(e+1,_.size*M)}this.uvBuffer.setXY(e,(S/g.previous.length+A)*u,(d-y-1)*f),this.uvBuffer.setXY(e+1,(S/g.previous.length+A)*u,(d-y)*f),this.colorBuffer.setXYZW(e,_.color.x,_.color.y,_.color.z,_.color.w),this.colorBuffer.setXYZW(e+1,_.color.x,_.color.y,_.color.z,_.color.w),S+1<g.previous.length&&(this.indexBuffer.setX(t*3,e),this.indexBuffer.setX(t*3+1,e+1),this.indexBuffer.setX(t*3+2,e+2),t++,this.indexBuffer.setX(t*3,e+2),this.indexBuffer.setX(t*3+1,e+1),this.indexBuffer.setX(t*3+2,e+3),t++),v=_,_=C,x.done||(x=b.next(),x.value!==void 0&&(C=x.value))}}}),this.positionBuffer.clearUpdateRanges(),this.positionBuffer.addUpdateRange(0,e*3),this.positionBuffer.needsUpdate=!0,this.previousBuffer.clearUpdateRanges(),this.previousBuffer.addUpdateRange(0,e*3),this.previousBuffer.needsUpdate=!0,this.nextBuffer.clearUpdateRanges(),this.nextBuffer.addUpdateRange(0,e*3),this.nextBuffer.needsUpdate=!0,this.sideBuffer.clearUpdateRanges(),this.sideBuffer.addUpdateRange(0,e),this.sideBuffer.needsUpdate=!0,this.widthBuffer.clearUpdateRanges(),this.widthBuffer.addUpdateRange(0,e),this.widthBuffer.needsUpdate=!0,this.uvBuffer.clearUpdateRanges(),this.uvBuffer.addUpdateRange(0,e*2),this.uvBuffer.needsUpdate=!0,this.colorBuffer.clearUpdateRanges(),this.colorBuffer.addUpdateRange(0,e*4),this.colorBuffer.needsUpdate=!0,this.indexBuffer.clearUpdateRanges(),this.indexBuffer.addUpdateRange(0,t*3),this.indexBuffer.needsUpdate=!0,this.geometry.setDrawRange(0,t*3)}dispose(){this.geometry.dispose()}}class a1{get geometry(){return this._geometry}set geometry(e){if(this._geometry=e,e===void 0||typeof e=="string")return;const t=new $s;this._triangleIndexToArea.length=0;let i=0;if(!e.getIndex())return;const n=e.getIndex().array,r=n.length/3;this._triangleIndexToArea.push(0);for(let o=0;o<r;o++)t.setFromAttributeAndIndices(e.getAttribute("position"),n[o*3],n[o*3+1],n[o*3+2]),i+=t.getArea(),this._triangleIndexToArea.push(i);e.userData.triangleIndexToArea=this._triangleIndexToArea}constructor(e){this.type="mesh_surface",this._triangleIndexToArea=[],this._tempA=new T,this._tempB=new T,this._tempC=new T,e&&(this.geometry=e)}initialize(e){const t=this._geometry;if(!t||t.getIndex()===null){e.position.set(0,0,0),e.velocity.set(0,0,1).multiplyScalar(e.startSpeed);return}const i=this._triangleIndexToArea.length-1;let n=0,r=i;const o=Math.random()*this._triangleIndexToArea[i];for(;n+1<r;){const f=Math.floor((n+r)/2);o<this._triangleIndexToArea[f]?r=f:n=f}let a=Math.random(),l=Math.random();a+l>1&&(a=1-a,l=1-l);const c=t.getIndex().array[n*3],h=t.getIndex().array[n*3+1],d=t.getIndex().array[n*3+2],u=t.getAttribute("position");this._tempA.fromBufferAttribute(u,c),this._tempB.fromBufferAttribute(u,h),this._tempC.fromBufferAttribute(u,d),this._tempB.sub(this._tempA),this._tempC.sub(this._tempA),this._tempA.addScaledVector(this._tempB,a).addScaledVector(this._tempC,l),e.position.copy(this._tempA),this._tempA.copy(this._tempB).cross(this._tempC).normalize(),e.velocity.copy(this._tempA).normalize().multiplyScalar(e.startSpeed)}toJSON(){return{type:"mesh_surface",mesh:this._geometry?this._geometry.uuid:""}}static fromJSON(e,t){return new a1(t.geometries[e.geometry])}clone(){return new a1(this._geometry)}update(e,t){}}rXe({id:"three.quarks",initialize:()=>{},emitterShapes:[{type:"mesh_surface",params:[["geometry",["geometry"]]],constructor:a1,loadJSON:a1.fromJSON}],behaviors:[]});class wZ extends ye{constructor(){super(),this.batches=[],this.systemToBatchIndex=new Map,this.type="BatchedRenderer",this.depthTexture=null}static equals(e,t){return e.material.side===t.material.side&&e.material.blending===t.material.blending&&e.material.blendSrc===t.material.blendSrc&&e.material.blendDst===t.material.blendDst&&e.material.blendEquation===t.material.blendEquation&&e.material.premultipliedAlpha===t.material.premultipliedAlpha&&e.material.transparent===t.material.transparent&&e.material.depthTest===t.material.depthTest&&e.material.type===t.material.type&&e.material.alphaTest===t.material.alphaTest&&e.material.map===t.material.map&&e.renderMode===t.renderMode&&e.blendTiles===t.blendTiles&&e.softParticles===t.softParticles&&e.softFarFade===t.softFarFade&&e.softNearFade===t.softNearFade&&e.uTileCount===t.uTileCount&&e.vTileCount===t.vTileCount&&e.instancingGeometry===t.instancingGeometry&&e.renderOrder===t.renderOrder&&e.layers.mask===t.layers.mask}addSystem(e){e._renderer=this;const t=e.getRendererSettings();for(let n=0;n<this.batches.length;n++)if(wZ.equals(this.batches[n].settings,t)){this.batches[n].addSystem(e),this.systemToBatchIndex.set(e,n);return}let i;switch(t.renderMode){case gt.Trail:i=new EXe(t);break;case gt.Mesh:case gt.BillBoard:case gt.VerticalBillBoard:case gt.HorizontalBillBoard:case gt.StretchedBillBoard:i=new MXe(t);break}this.depthTexture&&i.applyDepthTexture(this.depthTexture),i.addSystem(e),this.batches.push(i),this.systemToBatchIndex.set(e,this.batches.length-1),this.add(i)}deleteSystem(e){const t=this.systemToBatchIndex.get(e);t!=null&&(this.batches[t].removeSystem(e),this.systemToBatchIndex.delete(e))}setDepthTexture(e){this.depthTexture=e;for(const t of this.batches)t.applyDepthTexture(e)}updateSystem(e){this.deleteSystem(e),this.addSystem(e)}update(e){this.systemToBatchIndex.forEach((t,i)=>{i.update(e)});for(let t=0;t<this.batches.length;t++)this.batches[t].update()}}const RXe=wZ;fXe();console.log("%c Particle system powered by three.quarks. https://quarks.art/","font-size: 14px; font-weight: bold;");var LXe=Object.defineProperty,BXe=Object.getOwnPropertyDescriptor,ys=(s,e,t,i)=>{for(var n=i>1?void 0:i?BXe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&LXe(e,t,n),n};const RC=ee("debugparticles"),PXe=ee("noprogressive"),GXe=ee("debugprogressive");var Wz=(s=>(s[s.Birth=0]="Birth",s[s.Collision=1]="Collision",s[s.Death=2]="Death",s[s.Trigger=3]="Trigger",s[s.Manual=4]="Manual",s))(Wz||{});class Jc extends ze{constructor(){super(...arguments);p(this,"renderMode");p(this,"particleMaterial");p(this,"trailMaterial");p(this,"particleMesh");p(this,"maxParticleSize");p(this,"minParticleSize");p(this,"velocityScale");p(this,"cameraVelocityScale");p(this,"lengthScale")}start(){if(this.maxParticleSize!==.5&&this.minParticleSize!==0&&Qe()){const t=`ParticleSystem "${this.name}" has non-default min/max particle size. This may not render correctly. Please set min size to 0 and the max size to 0.5 and use the "StartSize" setting instead`;console.warn(t)}}get transparent(){var i;return((i=this.particleMaterial)==null?void 0:i.transparent)??!1}getMaterial(t=!1){let i=t===!0&&this.trailMaterial?this.trailMaterial:this.particleMaterial;return i&&t&&i.side===us&&(i=i.clone(),i.side=vn,t?this.trailMaterial=i:this.particleMaterial=i),i&&!PXe&&i._didRequestTextureLOD===void 0&&(i._didRequestTextureLOD=0,GXe&&console.log("Load material LOD",i.name),Ni.assignTextureLOD(i,0)),i}getMesh(t){let i=null;if(!i&&(this.particleMesh instanceof fe&&(i=this.particleMesh.geometry),i===null)){i=new Rs(1,1);const r=i.attributes.uv;for(let o=0;o<r.count;o++)r.setX(o,1-r.getX(o))}return new fe(i,this.getMaterial())}}ys([I()],Jc.prototype,"renderMode",2);ys([I(Yt)],Jc.prototype,"particleMaterial",2);ys([I(Yt)],Jc.prototype,"trailMaterial",2);ys([I()],Jc.prototype,"maxParticleSize",2);ys([I()],Jc.prototype,"minParticleSize",2);ys([I()],Jc.prototype,"velocityScale",2);ys([I()],Jc.prototype,"cameraVelocityScale",2);ys([I()],Jc.prototype,"lengthScale",2);class LE{constructor(e,t=1){p(this,"_curve");p(this,"_factor");p(this,"type","function");this._curve=e,this._factor=t}startGen(e){}genValue(e,t){return this._curve.evaluate(t,Math.random())*this._factor}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class SZ{constructor(e){p(this,"type","value");p(this,"system");this.system=e}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}startGen(e){}}class kXe extends SZ{genValue(){return this.system.textureSheetAnimation.getStartIndex()}}class NXe extends SZ{constructor(){super(...arguments);p(this,"_lastPosition",new T);p(this,"_lastDistance",0)}update(){const t=$t(this.system.gameObject);this._lastDistance=this._lastPosition.distanceTo(t),this._lastPosition.copy(t)}genValue(){if(!this.system.isPlaying||!this.system.emission.enabled||this.system.currentParticles>=this.system.maxParticles)return 0;let t=this.system.emission.rateOverTime.evaluate(this.system.time/this.system.duration,Math.random());if(this.system.deltaTime>0){const r=this.system.emission.rateOverDistance.evaluate(this.system.time/this.system.duration,Math.random());let a=this._lastDistance/this.system.deltaTime*r;Number.isFinite(a)||(a=0),t+=a}const i=this.system.emission.getBurst();i>0&&(t+=i/this.system.deltaTime);const n=this.system.maxParticles-this.system.currentParticles;return lt.clamp(t,0,n/this.system.deltaTime)}}class DXe extends SZ{genValue(){return this.system.isPlaying,0}}class $m{constructor(e){p(this,"system");p(this,"type");this.type=Object.getPrototypeOf(this).constructor.name||"ParticleSystemBaseBehaviour",e&&(this.system=e)}get context(){return this.system.context}initialize(e){}update(e,t){}frameUpdate(e){}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}reset(){}}class FXe extends $m{constructor(){super(...arguments);p(this,"type","NeedleTextureSheet")}update(t,i){const n=this.system.textureSheetAnimation;if(n.enabled){const r=t.age/t.life,o=n.evaluate(r);o!==void 0&&(t.uvTile=o)}}}const jY=Symbol("particleRotation");class VXe extends $m{constructor(){super(...arguments);p(this,"type","NeedleRotation")}initialize(t){t[jY]=Math.random()}update(t,i){if(t.rotation===void 0)return;const n=t.age/t.life;if(typeof t.rotation=="number"&&(this.system.rotationOverLifetime.enabled?t.rotation+=this.system.rotationOverLifetime.evaluate(n,t[jY])*i:this.system.renderer.renderMode===qu.Billboard&&(t.rotation=Math.PI),this.system.rotationBySpeed.enabled)){const r=t.velocity.length();t.rotation+=this.system.rotationBySpeed.evaluate(n,r)*i}}}const qY=Symbol("sizeLerpFactor"),zXe=new T;class UXe extends $m{constructor(){super(...arguments);p(this,"type","NeedleSize");p(this,"_minSize",0);p(this,"_maxSize",1)}initialize(t){t[qY]=Math.random(),this._minSize=this.system.renderer.minParticleSize,this._maxSize=this.system.renderer.maxParticleSize}update(t,i){const n=t.age/t.life;let r=1;this.system.sizeOverLifetime.enabled&&(r*=this.system.sizeOverLifetime.evaluate(n,void 0,t[qY]).x);let o=1;this.system.renderer.renderMode!==qu.Mesh&&(o=this.system.worldScale.x/this.system.cameraScale);const a=St(t.startSize).multiplyScalar(r*o);if(t.size.set(a.x,a.y,a.z),this.system.localspace){const l=Pae(this.system,zXe);t.size.x*=l.x,t.size.y*=l.y,t.size.z*=l.z}}}const Nb=Symbol("particleLife"),HD=Symbol("trailLifetime"),$Y=Symbol("trailStartLength"),QD=Symbol("trailWidthRandom");class XXe extends $m{constructor(){super(...arguments);p(this,"type","NeedleTrail")}initialize(t){t instanceof YS&&(t[Nb]=t.life,this.system.trails.enabled&&this.system.trails.dieWithParticles===!1&&(t[HD]=this.system.trails.lifetime.evaluate(Math.random(),Math.random()),t.life+=t[HD]),t[$Y]=t.length,t[QD]=Math.random())}update(t){var i;if((i=this.system.trails)!=null&&i.enabled&&t instanceof YS){const n=t,r=t.age/t[Nb],o=t.previous.values(),a=t.previous.length;for(let l=0;l<a;l++){const h=o.next().value,d=1-l/(a-1),u=t.size;if(u.x<=0&&!this.system.trails.sizeAffectsWidth){const f=20*this.system.trails.widthOverTrail.evaluate(.5,n[QD]);u.x=f,u.y=f,u.z=f}h.size=this.system.trails.getWidth(u.x,r,d,n[QD]),h.color.copy(t.color),this.system.trails.getColor(h.color,r,d)}if(t.age>t[Nb]){t.velocity.set(0,0,0);const l=(t.age-t[Nb])/t[HD];n.length=lt.lerp(t[$Y],0,l)}}}}const BE=Symbol("startVelocity"),eJ=Symbol("gravityModifier"),KD=Symbol("gravitySpeed"),PE=Symbol("velocity lerp factor"),Hz=new T;class OXe extends $m{constructor(){super(...arguments);p(this,"type","NeedleVelocity");p(this,"_gravityDirection",new T)}initialize(t){var o,a;const i=this.system.main.simulationSpeed;t.startSpeed=this.system.main.startSpeed.evaluate(Math.random(),Math.random());const n=this.system.shape.getDirection(t,t.position);t.velocity.x=n.x*t.startSpeed,t.velocity.y=n.y*t.startSpeed,t.velocity.z=n.z*t.startSpeed,(o=this.system.inheritVelocity)!=null&&o.enabled&&this.system.inheritVelocity.applyInitial(t.velocity),t[BE]?t[BE].copy(t.velocity):t[BE]=t.velocity.clone();const r=this.system.main.gravityModifier.evaluate(Math.random(),Math.random());t[eJ]=r*i,t[KD]=r*i*.5,t[PE]=Math.random(),(a=this.system.velocityOverLifetime)==null||a.init(t),this._gravityDirection.set(0,-1,0),this.system.main.simulationSpace===MS.Local&&this._gravityDirection.applyQuaternion(this.system.worldQuaternionInverted).normalize()}update(t,i){var u;const n=t[BE],r=t[eJ];if(r!==0){const f=r*t[KD];Hz.copy(this._gravityDirection).multiplyScalar(f),t[KD]+=i*.05,n.add(Hz)}t.velocity.copy(n);const o=t.age/t.life;(u=this.system.inheritVelocity)!=null&&u.enabled&&this.system.inheritVelocity.applyCurrent(t.velocity,o,t[PE]);const a=this.system.noise;a.enabled&&a.apply(0,t.position,t.velocity,i,t.age,t.life);const l=this.system.sizeBySpeed;l!=null&&l.enabled&&(t.size=l.evaluate(t.velocity,o,t[PE],t.size));const c=this.system.colorBySpeed;c!=null&&c.enabled&&c.evaluate(t.velocity,t[PE],t.color);const h=this.system.velocityOverLifetime;h.enabled&&h.apply(t,0,t.position,t.velocity,i,t.age,t.life);const d=this.system.limitVelocityOverLifetime;if(d.enabled&&d.apply(t.position,n,t.velocity,t.size,o,i,1),this.system.worldspace){const f=this.system.worldScale;t.velocity.x*=f.x,t.velocity.y*=f.y,t.velocity.z*=f.z}}}const tJ=Symbol("colorLerpFactor"),iJ=new hn(1,1,1,1),Bg=new hn(1,1,1,1);class ZXe extends $m{constructor(){super(...arguments);p(this,"type","NeedleColor")}initialize(t){}_init(t){const i=this.system.renderer.particleMaterial;Bg.copy(this.system.main.startColor.evaluate(Math.random())),i!=null&&i.color&&(iJ.copy(i.color),Bg.multiply(iJ)),Bg.convertLinearToSRGB(),t.startColor.set(Bg.r,Bg.g,Bg.b,Bg.alpha),t.color.copy(t.startColor),t[tJ]=Math.random()}update(t,i){if(t.age===0&&this._init(t),this.system.colorOverLifetime.enabled){const n=t.age/t.life,r=this.system.colorOverLifetime.color.evaluate(n,t[tJ]);t.color.set(r.r,r.g,r.b,"alpha"in r?r.alpha:1).multiply(t.startColor)}else t.color.copy(t.startColor)}}class WXe{constructor(e){p(this,"system");p(this,"emission");p(this,"autoDestroy");p(this,"startLength");p(this,"emissionBursts");p(this,"onlyUsedByOther");p(this,"behaviors",[]);p(this,"rendererEmitterSettings",{startLength:new nn(220),followLocalOrigin:!1});p(this,"flatWhiteTexture");p(this,"clonedTexture",{original:void 0,clone:void 0});this.system=e,this.emission=new NXe(this.system)}get anim(){return this.system.textureSheetAnimation}get prewarm(){return!1}get material(){return this.system.renderer.getMaterial(this.system.trails.enabled)}get layers(){return this.system.gameObject.layers}update(){this.emission.update()}get looping(){return this.system.main.loop}get duration(){return this.system.duration}get shape(){return this.system.shape}get startLife(){return new LE(this.system.main.startLifetime)}get startSpeed(){return new LE(this.system.main.startSpeed)}get startRotation(){return new LE(this.system.main.startRotation)}get startSize(){return new LE(this.system.main.startSize)}get startColor(){return new sA(new cl(1,1,1,1))}get emissionOverTime(){return this.emission}get emissionOverDistance(){return new DXe(this.system)}get instancingGeometry(){return this.system.renderer.getMesh(this.system.renderer.renderMode).geometry}get renderMode(){if(this.system.trails.enabled===!0)return gt.Trail;switch(this.system.renderer.renderMode){case qu.Billboard:return gt.BillBoard;case qu.Stretch:return gt.StretchedBillBoard;case qu.HorizontalBillboard:return gt.HorizontalBillBoard;case qu.VerticalBillboard:return gt.VerticalBillBoard;case qu.Mesh:return gt.Mesh}return gt.BillBoard}get speedFactor(){var t;let e=this.system.main.simulationSpeed;return((t=this.system.renderer)==null?void 0:t.renderMode)===qu.Stretch&&(e*=this.system.renderer.velocityScale??1),e}get texture(){const e=this.material;if(e&&e.map){const t=e.map;if(this.clonedTexture.original!==t||!this.clonedTexture.clone){const i=t.clone();i.premultiplyAlpha=!1,i.colorSpace=Ji,this.clonedTexture.original=t,this.clonedTexture.clone=i}return this.clonedTexture.clone}return this.flatWhiteTexture||(this.flatWhiteTexture=A5(new hn(1,1,1,1),1)),this.flatWhiteTexture}get startTileIndex(){return new kXe(this.system)}get uTileCount(){var e;return this.anim.enabled?(e=this.anim)==null?void 0:e.numTilesX:void 0}get vTileCount(){var e;return this.anim.enabled?(e=this.anim)==null?void 0:e.numTilesY:void 0}get renderOrder(){return 1}get blending(){var e;return((e=this.system.renderer.particleMaterial)==null?void 0:e.blending)??fp}get transparent(){return this.system.renderer.transparent}get worldSpace(){return this.system.main.simulationSpace===MS.World}}class HXe{constructor(){p(this,"burstParticleIndex",0);p(this,"burstParticleCount",0);p(this,"isBursting",!1);p(this,"travelDistance",0);p(this,"previousWorldPos");p(this,"burstIndex",0);p(this,"burstWaveIndex",0);p(this,"time",0);p(this,"waitEmiting",0)}}const HR=class extends ze{constructor(){super(...arguments);p(this,"_state");p(this,"colorOverLifetime");p(this,"main");p(this,"emission");p(this,"sizeOverLifetime");p(this,"shape");p(this,"noise");p(this,"trails");p(this,"velocityOverLifetime");p(this,"limitVelocityOverLifetime");p(this,"inheritVelocity");p(this,"colorBySpeed");p(this,"textureSheetAnimation");p(this,"rotationOverLifetime");p(this,"rotationBySpeed");p(this,"sizeBySpeed");p(this,"_cameraScale",1);p(this,"__worldQuaternion",new Ve);p(this,"_worldQuaternionInverted",new Ve);p(this,"_worldScale",new T);p(this,"_worldPositionFrame",-1);p(this,"_worldPos",new T);p(this,"_renderer");p(this,"_batchSystem");p(this,"_particleSystem");p(this,"_interface");p(this,"_container");p(this,"_time",0);p(this,"_isPlaying",!0);p(this,"_isUsedAsSubsystem",!1);p(this,"_didPreWarm",!1);p(this,"_bursts");p(this,"_subEmitterSystems");p(this,"_lastBatchesCount",-1);p(this,"lastMaterialVersion",-1)}play(e=!1){var t;e&&$.foreachComponent(this.gameObject,i=>{i instanceof HR&&i!==this&&i.play(!1)},!0),this._isPlaying=!0,this._particleSystem&&(this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1),(t=this.emission)==null||t.reset()}pause(e=!0){e&&$.foreachComponent(this.gameObject,t=>{t instanceof HR&&t!==this&&t.pause(!1)},!0),this._isPlaying=!1}stop(e=!0,t=!1){e&&$.foreachComponent(this.gameObject,i=>{i instanceof HR&&i!==this&&i.stop(!1,t)},!0),this._isPlaying=!1,this._time=0,t&&this.reset()}reset(){var e;this._time=0,this._particleSystem&&(this._particleSystem.particleNum=0,this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1,(e=this.emission)==null||e.reset())}emit(e){if(this._particleSystem){this.onUpdate(),e=Math.min(e,this.maxParticles-this.currentParticles),this._state||(this._state=new HXe),this._state.waitEmiting=e,this._state.time=0;const t=this._particleSystem.emitEnded;this._particleSystem.emitEnded=!1,this._particleSystem.emit(this.deltaTime,this._state,this._particleSystem.emitter.matrixWorld),this._particleSystem.emitEnded=t}}get playOnAwake(){return this.main.playOnAwake}set playOnAwake(e){this.main.playOnAwake=e}get renderer(){return this._renderer}get isPlaying(){return this._isPlaying}get currentParticles(){var e;return((e=this._particleSystem)==null?void 0:e.particleNum)??0}get maxParticles(){return this.main.maxParticles}get time(){return this._time}get duration(){return this.main.duration}get deltaTime(){return this.context.time.deltaTime*this.main.simulationSpeed}get scale(){return this.gameObject.scale.x}get cameraScale(){return this._cameraScale}get container(){return this._container}get worldspace(){return this.main.simulationSpace===MS.World}get localspace(){return this.main.simulationSpace===MS.Local}get worldQuaternion(){return this.__worldQuaternion}get worldQuaternionInverted(){return this._worldQuaternionInverted}get worldScale(){return this._worldScale}get worldPos(){return this._worldPositionFrame!==this.context.time.frame&&(this._worldPositionFrame=this.context.time.frame,$t(this.gameObject,this._worldPos)),this._worldPos}get matrixWorld(){return this._container.matrixWorld}get isSubsystem(){return this._isUsedAsSubsystem}addBehaviour(e){return this._particleSystem?(e instanceof $m&&(e.system=this),Qe()&&console.log("add behaviour",e),this._particleSystem.addBehavior(e),!0):!1}removeBehaviour(e){if(!this._particleSystem)return!1;const t=this._particleSystem.behaviors,i=t.indexOf(e);return i!==-1&&t.splice(i,1),!0}removeAllBehaviours(){return this._particleSystem?(this._particleSystem.behaviors.length=0,!0):!1}get behaviours(){return this._particleSystem?this._particleSystem.behaviors:null}get particleSystem(){return this._particleSystem??null}set bursts(e){for(let t=0;t<e.length;t++){const i=e[t];if(!(i instanceof IS)){const n=new IS;Lx(n,i),e[t]=n}}this._bursts=e}set subEmitterSystems(e){for(let t=0;t<e.length;t++){const i=e[t];if(!(i instanceof l1)){const n=new l1;Lx(n,i),e[t]=n}}RC&&e.length>0&&console.log("SubEmitters: ",e,this),this._subEmitterSystems=e}onAfterDeserialize(e){if(this._subEmitterSystems&&Array.isArray(this._subEmitterSystems))for(const t of this._subEmitterSystems)t._deserialize(this.context,this.gameObject)}awake(){if(this._worldPositionFrame=-1,this._renderer=this.gameObject.getComponent(Jc),!this.main)throw new Error("Not Supported: ParticleSystem needs a serialized MainModule. Creating new particle systems at runtime is currently not supported.");this._container=new ye,this._container.matrixAutoUpdate=!1,this.context.scene.add(this._container),this._batchSystem=new RXe,this._batchSystem.name=this.gameObject.name,this._container.add(this._batchSystem),this._interface=new WXe(this),this._particleSystem=new xXe(this._interface),this._particleSystem.addBehavior(new UXe(this)),this._particleSystem.addBehavior(new ZXe(this)),this._particleSystem.addBehavior(new FXe(this)),this._particleSystem.addBehavior(new VXe(this)),this._particleSystem.addBehavior(new OXe(this)),this._particleSystem.addBehavior(new XXe(this)),this._batchSystem.addSystem(this._particleSystem);const e=this._particleSystem.emitter;this.context.scene.add(e),this.inheritVelocity.system&&this.inheritVelocity.system!==this&&(this.inheritVelocity=this.inheritVelocity.clone()),this.inheritVelocity.awake(this),RC&&(console.log(this),this.gameObject.add(new al(1)))}start(){this.addSubParticleSystems(),this.updateLayers(),this.renderer.particleMesh instanceof fe&&this._interface.renderMode==gt.Mesh&&Ni.assignMeshLOD(this.renderer.particleMesh,0).then(e=>{e&&this.particleSystem&&this._interface.renderMode==gt.Mesh&&(this.particleSystem.instancingGeometry=e)})}onDestroy(){var e,t,i,n;(e=this._container)==null||e.removeFromParent(),(t=this._batchSystem)==null||t.removeFromParent(),(i=this._particleSystem)==null||i.emitter.removeFromParent(),(n=this._particleSystem)==null||n.dispose()}onEnable(){this.main&&(this.inheritVelocity&&(this.inheritVelocity.system=this),this._batchSystem&&(this._batchSystem.visible=!0),this.playOnAwake&&this.play(),this._isPlaying=this.playOnAwake)}onDisable(){this._batchSystem&&(this._batchSystem.visible=!1)}onBeforeRender(){var e;this.main&&(this._didPreWarm===!1&&((e=this.main)==null?void 0:e.prewarm)===!0&&(this._didPreWarm=!0,this.preWarm()),this.onUpdate(),this.onSimulate(this.deltaTime))}preWarm(){var c;if(!((c=this.emission)!=null&&c.enabled)||this.emission.rateOverTime.getMax()<=0)return;const t=1/60,i=this.main.duration,n=this.main.startLifetime.getMax(),r=1e3,o=Math.min(Math.max(i,n)/Math.max(.01,this.main.simulationSpeed),r),a=Math.ceil(o/t),l=Date.now();RC&&console.log(`Particles ${this.name} - Prewarm for ${a} frames (${o} sec). Duration: ${i}, Lifetime: ${n}`);for(let h=0;h<a&&!(this.currentParticles>=this.maxParticles);h++){const d=Date.now()-l;if(d>2e3){console.warn(`Particles ${this.name} - Prewarm took too long. Aborting: ${d}`);break}this.onUpdate(),this.onSimulate(t)}}onSimulate(e){if(this._batchSystem){let t=this.context.time.frameCount%60===0;this._lastBatchesCount!==this._batchSystem.batches.length&&(this._lastBatchesCount=this._batchSystem.batches.length,t=!0),t&&this.updateLayers(),this._batchSystem.update(e)}this._time+=e,this._time>this.duration&&(this._time=0)}updateLayers(){if(this._batchSystem)for(let e=0;e<this._batchSystem.batches.length;e++){const t=this._batchSystem.batches[e];t.layers.disableAll();const i=this.layer;t.layers.mask=1<<i}}onUpdate(){var r,o;const e=this.renderer.getMaterial(this.trails.enabled);if(e&&e.version!=this.lastMaterialVersion&&this._particleSystem&&(this.lastMaterialVersion=e.version,this._particleSystem.texture=this._interface.texture),this._bursts&&(this.emission.bursts=this._bursts,delete this._bursts),!this._isPlaying)return;const t=this.context.mainCamera;if(t){const a=kn(t);this._cameraScale=a.x}const i=!this.worldspace,n=this.gameObject;if(gn(n,this.__worldQuaternion),this._worldQuaternionInverted.copy(this.__worldQuaternion).invert(),kn(this.gameObject,this._worldScale),i&&this._container&&((r=this.gameObject)!=null&&r.parent)){const a=Pae(this,Hz);this._container.matrix.makeScale(a.x,a.y,a.z),this._container.matrix.makeRotationFromQuaternion(this.__worldQuaternion),this._container.matrix.setPosition(this.worldPos),this._container.matrix.scale(this.gameObject.scale)}this.emission.system=this,this._interface.update(),this.shape.onUpdate(this,this.context,this.main.simulationSpace,this.gameObject),this.noise.update(this.context),(o=this.inheritVelocity)==null||o.update(this.context),this.velocityOverLifetime.update(this)}addSubParticleSystems(){var e;if(this._subEmitterSystems&&this._particleSystem)for(const t of this._subEmitterSystems){t.particleSystem&&(t.particleSystem.__internalAwake?t.particleSystem.__internalAwake():Qe()&&console.warn("SubParticleSystem serialization issue(?)",t.particleSystem,t));const i=(e=t.particleSystem)==null?void 0:e._particleSystem;if(i){t.particleSystem._isUsedAsSubsystem=!0;const n=new tG(this,this._particleSystem,t.particleSystem,i);n.emitterType=t.type,n.emitterProbability=t.emitProbability,this._particleSystem.addBehavior(n)}else RC&&console.warn("Could not add SubParticleSystem",t,this)}}};let rr=HR;ys([I(PM)],rr.prototype,"colorOverLifetime",2);ys([I(No)],rr.prototype,"main",2);ys([I(lu)],rr.prototype,"emission",2);ys([I(Ym)],rr.prototype,"sizeOverLifetime",2);ys([I(gs)],rr.prototype,"shape",2);ys([I(un)],rr.prototype,"noise",2);ys([I(os)],rr.prototype,"trails",2);ys([I(As)],rr.prototype,"velocityOverLifetime",2);ys([I(cr)],rr.prototype,"limitVelocityOverLifetime",2);ys([I(Jm)],rr.prototype,"inheritVelocity",2);ys([I(GA)],rr.prototype,"colorBySpeed",2);ys([I(Do)],rr.prototype,"textureSheetAnimation",2);ys([I(Yc)],rr.prototype,"rotationOverLifetime",2);ys([I(lc)],rr.prototype,"rotationBySpeed",2);ys([I(Ua)],rr.prototype,"sizeBySpeed",2);class l1{constructor(){p(this,"particleSystem");p(this,"emitProbability",1);p(this,"properties");p(this,"type")}_deserialize(e,t){const i=this.particleSystem;if(i instanceof rr)return;let n="";i&&typeof i.guid=="string"&&(n=i.guid,this.particleSystem=$.findByGuid(n,t)),RC&&!(this.particleSystem instanceof rr)&&console.warn("Could not find particle system for sub emitter",n,t,this)}}function Pae(s,e){if(e.set(1,1,1),s.gameObject.parent&&s.localspace)switch(s.main.scalingMode){case Fz.Local:e=kn(s.gameObject.parent,e),e.x=1/e.x,e.y=1/e.y,e.z=1/e.z;break;default:if(!s.unsupported_scaling_mode){s.unsupported_scaling_mode=!0;const t="ParticleSystem scale mode "+Fz[s.main.scalingMode]+" is not supported";Qe()&&An(t),console.warn(t,s.name,s)}e=kn(s.gameObject,e);break}return e}new T(1,1,1);new T(0,0,1);class tG{constructor(e,t,i,n){p(this,"type","NeedleParticleSubEmitter");p(this,"emitterType");p(this,"emitterProbability");p(this,"q_",new Ve);p(this,"v_",new T);p(this,"v2_",new T);p(this,"_emitterMatrix",new Cp);p(this,"_circularBuffer");this.system=e,this.particleSystem=t,this.subSystem=i,this.subParticleSystem=n,this.subParticleSystem&&this.subParticleSystem&&(this.subParticleSystem.onlyUsedByOther=!0);const r=1e3;this._circularBuffer=new $l(()=>new Cp,r)}clone(){throw new Error("Method not implemented.")}initialize(e){e.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this._emitterMatrix.copy(this.subSystem.matrixWorld).invert().premultiply(this.system.matrixWorld),this._emitterMatrix.setPosition(0,0,0),this.emitterType===Wz.Birth&&this.run(e)}update(e,t){this.run(e)}frameUpdate(e){}toJSON(){}reset(){}run(e){if(this.subSystem.currentParticles>=this.subSystem.main.maxParticles||!this.subParticleSystem||!e.emissionState||this.emitterProbability&&Math.random()>this.emitterProbability)return;const t=this.system.deltaTime;if(this.emitterType===Wz.Death){let n=e.life;if(e[Nb]!==void 0&&(n=e[Nb]),!(e.age+t*1.2>=n))return;const o=this.subSystem.main.maxParticles-this.subSystem.currentParticles;e.emissionState.waitEmiting=o}const i=new Cp;i.set(1,0,0,e.position.x,0,1,0,e.position.y,0,0,1,e.position.z,0,0,0,1),this.particleSystem.worldSpace||i.multiplyMatrices(this._emitterMatrix,i),this.subParticleSystem.emit(t,e.emissionState,i)}}var QXe=Object.defineProperty,KXe=Object.getOwnPropertyDescriptor,YXe=(s,e,t,i)=>{for(var n=i>1?void 0:i?KXe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&QXe(e,t,n),n};class UM extends jr{constructor(){super(...arguments);p(this,"granularity",new rt(10))}get typeName(){return"PixelationEffect"}onCreateEffect(){const t=new Kie;return this.granularity.onValueChanged=i=>{t.granularity=i},t}}YXe([I(rt)],UM.prototype,"granularity",2);Kc("PixelationEffect",UM);class Nx extends ze{constructor(){super(...arguments);p(this,"_didAssignPlayerColor",!1);p(this,"tryAssignColor",()=>{const t=$.getComponentInParent(this.gameObject,Xl);if(t&&t.owner)return this._didAssignPlayerColor=!0,this.assignUserColor(t.owner),!0;const i=$.getComponentInParent(this.gameObject,br);return i!=null&&i.connectionId?(this._didAssignPlayerColor=!0,this.assignUserColor(i.connectionId),!0):!1})}onEnable(){this.context.connection.beginListen(ri.JoinedRoom,this.tryAssignColor),this._didAssignPlayerColor||this.startCoroutine(this.waitForConnection())}onDisable(){this.context.connection.stopListen(ri.JoinedRoom,this.tryAssignColor)}*waitForConnection(){for(;!this.destroyed&&this.activeAndEnabled&&(yield Ure(.2),!this.tryAssignColor()););}assignUserColor(t){const i=Nx.hashCode(t),n=Nx.colorFromHashCode(i);if(this.gameObject.type==="Mesh"){const r=this.gameObject;this.assignColor(n,t,r)}else if(this.gameObject.children)for(const r of this.gameObject.children){const o=r;o.material&&o.material.color&&this.assignColor(n,t,o)}}assignColor(t,i,n){let r=n.material;r&&(r._playerMaterial!==i&&(r=r.clone(),r._playerMaterial=i,n.material=r),r.color=t)}static hashCode(t){var i=0,n,r;if(t.length===0)return i;for(n=0;n<t.length;n++)r=t.charCodeAt(n),i=(i<<5)-i+r,i|=0;return i}static colorFromHashCode(t){const i=(t&16711680)>>16,n=(t&65280)>>8,r=t&255;return new ge(i/255,n/255,r/255)}}const XM=new It;XM.setAttribute("position",new dt(new Float32Array([-1,-1,3,-1,-1,3]),2));XM.setAttribute("uv",new dt(new Float32Array([0,0,2,0,0,2]),2));XM.boundingSphere=new Vn;XM.computeBoundingSphere=function(){};const JXe=new zh;class Pg{constructor(e){this._mesh=new fe(XM,e),this._mesh.frustumCulled=!1}render(e){e.render(this._mesh,JXe)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}}const jXe={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new ce},viewMat:{value:new ce},projViewMat:{value:new ce},projectionMatrixInv:{value:new ce},viewMatrixInv:{value:new ce},cameraPos:{value:new T},resolution:{value:new Q},biasAdjustment:{value:new Q},time:{value:0},samples:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1},frame:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform highp sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform vec2 biasAdjustment;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform float frame;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      /*return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);*/
       #ifdef ORTHO

       return linearize_depth_ortho(d, nearZ, farZ);

        #else
        return linearize_depth(linDepth, nearZ, farZ);
        #endif
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        #ifndef ORTHO
          return getWorldPosLog(vec3(coord, depth));
        #endif
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

mat3 makeRotationZ(float theta) {
	float c = cos(theta);
	float s = sin(theta);
	return mat3(c, - s, 0,
			s,  c, 0,
			0,  0, 1);
  }

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec2 harmoniousNumbers = vec2(
        1.618033988749895,
        1.324717957244746
      );
      noise.rg += harmoniousNumbers * frame;
      noise.rg = fract(noise.rg);
        vec3 helperVec = vec3(0.0, 1.0, 0.0);
        if (dot(helperVec, normal) > 0.99) {
          helperVec = vec3(1.0, 0.0, 0.0);
        }
        vec3 tangent = normalize(cross(helperVec, normal));
        vec3 bitangent = cross(normal, tangent);
        mediump mat3 tbn = mat3(tangent, bitangent, normal) *  makeRotationZ( noise.r * 3.1415962 * 2.0) ;

      mediump float occluded = 0.0;
      mediump float totalWeight = 0.0;
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : radiusToUse * distanceFalloff * 0.2;
      float bias = (min(
        0.1,
        distanceFalloffToUse * 0.1
      ) / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      bias = biasAdjustment.x + biasAdjustment.y * bias;
      mediump float offsetMove = noise.g;
      mediump float offsetMoveInv = 1.0 / FSAMPLES;
      float farTimesNear = far * near;
      float farMinusNear = far - near;
      
      for(int i = 0; i < SAMPLES; i++) {
        mediump vec3 sampleDirection = tbn * samples[i];

        float moveAmt = fract(offsetMove);
        offsetMove += offsetMoveInv;
        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        
        if (all(greaterThan(offset.xyz * (1.0 - offset.xyz), vec3(0.0)))) {
          float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;

          /*#ifdef LOGDEPTH
          float distSample = linearize_depth_log(sampleDepth, near, far);
      #else
          #ifdef ORTHO
              float distSample = near + farMinusNear * sampleDepth;
          #else
              float distSample = (farTimesNear) / (far - sampleDepth * farMinusNear);
          #endif
      #endif*/
      #ifdef ORTHO
          float distSample = near + sampleDepth * farMinusNear;
      #else
          #ifdef LOGDEPTH
              float distSample = linearize_depth_log(sampleDepth, near, far);
          #else
              float distSample = (farTimesNear) / (far - sampleDepth * farMinusNear);
          #endif
      #endif
      
      #ifdef ORTHO
          float distWorld = near + offset.z * farMinusNear;
      #else
          float distWorld = (farTimesNear) / (far - offset.z * farMinusNear);
      #endif
          
          mediump float rangeCheck = smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
          vec2 diff = gl_FragCoord.xy - floor(offset.xy * resolution);
          occluded += rangeCheck * float(distSample != distWorld) * float(sampleDepth != depth) * step(distSample + bias, distWorld) * step(
            1.0,
            dot(diff, diff)
          );
          
          totalWeight ++;
        }
      }
      float occ = clamp(1.0 - occluded / (totalWeight == 0.0 ? 1.0 : totalWeight), 0.0, 1.0);
      gl_FragColor = vec4(occ, 0.5 + 0.5 * normal);
}`},qXe={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},transparencyDWFalse:{value:null},transparencyDWTrue:{value:null},transparencyDWTrueDepth:{value:null},transparencyAware:{value:!1},projMat:{value:new ce},viewMat:{value:new ce},projectionMatrixInv:{value:new ce},viewMatrixInv:{value:new ce},cameraPos:{value:new T},resolution:{value:new Q},color:{value:new T(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1},fog:{value:!1},fogExp:{value:!1},fogDensity:{value:0},fogNear:{value:1/0},fogFar:{value:1/0},colorMultiply:{value:!0},aoTones:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform highp sampler2D downsampledDepth;
    uniform highp sampler2D transparencyDWFalse;
    uniform highp sampler2D transparencyDWTrue;
    uniform highp sampler2D transparencyDWTrueDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform float aoTones;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform bool fog;
    uniform bool fogExp;
    uniform bool colorMultiply;
    uniform bool transparencyAware;
    uniform float fogDensity;
    uniform float fogNear;
    uniform float fogFar;
    uniform float radius;
    uniform float distanceFalloff;
    uniform vec3 cameraPos;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          #ifndef ORTHO
            return getWorldPosLog(vec3(coord, depth));
          #endif
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        #ifdef HALFRES 
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.gba * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

        #ifdef LOGDEPTH
        texel.r = clamp(texel.r, 0.0, 1.0);
        if (texel.r == 0.0) {
          texel.r = 1.0;
        }
        #endif
     
        float finalAo = pow(texel.r, intensity);
        if (aoTones > 0.0) {
            finalAo = ceil(finalAo * aoTones) / aoTones;
        }
        float fogFactor;
        float fogDepth = distance(
            cameraPos,
            getWorldPos(depth, vUv)
        );
        if (fog) {
            if (fogExp) {
                fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
            } else {
                fogFactor = smoothstep( fogNear, fogFar, fogDepth );
            }
        }
        if (transparencyAware) {
            float transparencyDWOff = texture2D(transparencyDWFalse, vUv).a;
            float transparencyDWOn = texture2D(transparencyDWTrue, vUv).a;
            float adjustmentFactorOff = transparencyDWOff;
            float adjustmentFactorOn = (1.0 - transparencyDWOn) * (
                texture2D(transparencyDWTrueDepth, vUv).r == texture2D(sceneDepth, vUv).r ? 1.0 : 0.0
            );
            float adjustmentFactor = max(adjustmentFactorOff, adjustmentFactorOn);
            finalAo = mix(finalAo, 1.0, adjustmentFactor);
        }
        finalAo = mix(finalAo, 1.0, fogFactor);
        vec3 aoApplied = color * mix(vec3(1.0), sceneTexel.rgb, float(colorMultiply));
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = sRGBTransferOETF(gl_FragColor);
        }
    }
    `},$Xe={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new ce},viewMat:{value:new ce},projectionMatrixInv:{value:new ce},viewMatrixInv:{value:new ce},cameraPos:{value:new T},resolution:{value:new Q},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
      #ifndef ORTHO
          return getWorldPosLog(vec3(coord, depth));
      #endif
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.r;
        float baseOcc = data.r;
        vec3 normal = data.gba * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        if (d == 1.0) {
          gl_FragColor = data;
          return;
        }
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
        radiusToUse * distanceFalloff
    : radiusToUse * distanceFalloff * 0.2;

        float invDistance = (1.0 / distanceFalloffToUse);
        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.r;
            vec3 normalSample = dataSample.gba * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
            float rangeCheck = float(dSample != 1.0) * exp(-1.0 * tangentPlaneDist * invDistance ) * max(dot(normal, normalSample), 0.0);
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        if (count > 0.0) {
          occlusion /= count;
        }
        #ifdef LOGDEPTH
          occlusion = clamp(occlusion, 0.0, 1.0);
          if (occlusion == 0.0) {
            occlusion = 1.0;
          }
        #endif
        gl_FragColor = vec4(occlusion, 0.5 + 0.5 * normal);
    }
    `},e3e={uniforms:{sceneDepth:{value:null},resolution:{value:new Q},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new ce},projectionMatrixInv:{value:new ce},logDepth:{value:!1},ortho:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform highp sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform bool ortho;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth && !ortho) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        highp vec2[4] uvSamples;
        uvSamples[0] = uv;
        uvSamples[1] = uv + vec2(pixelSize.x, 0.0);
        uvSamples[2] = uv + vec2(0.0, pixelSize.y);
        uvSamples[3] = uv + pixelSize;
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[4] samples;
        samples[0] = depth00;
        samples[1] = depth10;
        samples[2] = depth01;
        samples[3] = depth11;
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
    }`};var Gae="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";const t3e=(()=>parseInt(La.replace(/\D+/g,"")))(),i3e=t3e>=162?class extends ci{constructor(s=1,e=1,t=1,i={}){super(s,e,{...i,count:t}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}:class extends ci{constructor(s=1,e=1,t=1,i={}){super(s,e,i),this.isWebGLMultipleRenderTargets=!0;const n=this.texture;this.texture=[];for(let r=0;r<t;r++)this.texture[r]=n.clone(),this.texture[r].isRenderTargetTexture=!0}setSize(s,e,t=1){if(this.width!==s||this.height!==e||this.depth!==t){this.width=s,this.height=e,this.depth=t;for(let i=0,n=this.texture.length;i<n;i++)this.texture[i].image.width=s,this.texture[i].image.height=e,this.texture[i].image.depth=t;this.dispose()}this.viewport.set(0,0,s,e),this.scissor.set(0,0,s,e)}copy(s){this.dispose(),this.width=s.width,this.height=s.height,this.depth=s.depth,this.scissor.copy(s.scissor),this.scissorTest=s.scissorTest,this.viewport.copy(s.viewport),this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,s.depthTexture!==null&&(this.depthTexture=s.depthTexture.clone()),this.texture.length=0;for(let e=0,t=s.texture.length;e<t;e++)this.texture[e]=s.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}},n3e=Uint8Array.from(atob(Gae),s=>s.charCodeAt(0));function kae(s,e,t){if(e.getQueryParameter(s,e.QUERY_RESULT_AVAILABLE)){const r=e.getQueryParameter(s,e.QUERY_RESULT)/1e6;t.lastTime=t.lastTime===0?r:t.timeRollingAverage*t.lastTime+(1-t.timeRollingAverage)*r}else setTimeout(()=>{kae(s,e,t)},1)}class Nae extends Jr{constructor(e,t,i=512,n=512){super(),this.width=i,this.height=n,this.clear=!0,this.camera=t,this.scene=e,this.autosetGamma=!0,this.configuration=new Proxy({aoSamples:16,aoRadius:5,aoTones:0,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,biasOffset:0,biasMultiplier:0,color:new ge(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0,colorMultiply:!0,transparencyAware:!1,accumulate:!1},{set:(r,o,a)=>{const l=r[o];return r[o]=a,a.equals?a.equals(l)||this.firstFrame():l!==a&&this.firstFrame(),o==="aoSamples"&&l!==a&&this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),o==="denoiseSamples"&&l!==a&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),o==="halfRes"&&l!==a&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.setSize(this.width,this.height)),o==="depthAwareUpsampling"&&l!==a&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),o==="gammaCorrection"&&(this.autosetGamma=!1),o==="transparencyAware"&&l!==a&&(this.autoDetectTransparency=!1,this.configureTransparencyTarget()),!0}}),this.samples=[],this.samplesDenoise=[],this.autoDetectTransparency=!0,this.frames=0,this.lastViewMatrix=new ce,this.lastProjectionMatrix=new ce,this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.detectTransparency(),this.configureTransparencyTarget(),this.copyQuad=new Pg(new Ht({uniforms:{tDiffuse:{value:null}},depthWrite:!1,vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }
            `,fragmentShader:`
            uniform sampler2D tDiffuse;
            varying vec2 vUv;
            void main() {
                gl_FragColor = texture2D(tDiffuse, vUv);
            }
            `})),this.writeTargetInternal=new ci(this.width,this.height,{minFilter:Ot,magFilter:Ot,depthBuffer:!1,format:bi}),this.readTargetInternal=new ci(this.width,this.height,{minFilter:Ot,magFilter:Ot,depthBuffer:!1,format:bi}),this.outputTargetInternal=new ci(this.width,this.height,{minFilter:Ot,magFilter:Ot,depthBuffer:!1}),this.accumulationRenderTarget=new ci(this.width,this.height,{minFilter:Ot,magFilter:Ot,depthBuffer:!1,format:bi,type:Wi,stencilBuffer:!1,depthBuffer:!1,alpha:!0}),this.accumulationQuad=new Pg(new Ht({uniforms:{frame:{value:0},tDiffuse:{value:null}},transparent:!0,opacity:1,vertexShader:`
             varying vec2 vUv;
             void main() {
                 vUv = uv;
                 gl_Position = vec4(position, 1);
             }`,fragmentShader:`
             uniform sampler2D tDiffuse;
             uniform float frame;
                varying vec2 vUv;
                void main() {
                    vec4 color = texture2D(tDiffuse, vUv);
                    gl_FragColor = vec4(color.rgb, 1.0 / (frame + 1.0));
                }
                `})),this.bluenoise=new ir(n3e,128,128),this.bluenoise.colorSpace=Fr,this.bluenoise.wrapS=Mo,this.bluenoise.wrapT=Mo,this.bluenoise.minFilter=qt,this.bluenoise.magFilter=qt,this.bluenoise.needsUpdate=!0,this.lastTime=0,this.timeRollingAverage=.99,this.needsDepthTexture=!0,this.needsSwap=!0,this._r=new Q,this._c=new ge}configureHalfResTargets(){this.firstFrame(),this.configuration.halfRes?(this.depthDownsampleTarget=new i3e(this.width/2,this.height/2,2),this.depthDownsampleTarget.textures[0].format=Vl,this.depthDownsampleTarget.textures[0].type=$i,this.depthDownsampleTarget.textures[0].minFilter=qt,this.depthDownsampleTarget.textures[0].magFilter=qt,this.depthDownsampleTarget.textures[0].depthBuffer=!1,this.depthDownsampleTarget.textures[1].format=bi,this.depthDownsampleTarget.textures[1].type=Wi,this.depthDownsampleTarget.textures[1].minFilter=qt,this.depthDownsampleTarget.textures[1].magFilter=qt,this.depthDownsampleTarget.textures[1].depthBuffer=!1,this.depthDownsampleQuad=new Pg(new Ht(e3e))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}detectTransparency(){if(this.autoDetectTransparency){let e=!1;this.scene.traverse(t=>{t.material&&t.material.transparent&&(e=!0)}),e&&(this.configuration.transparencyAware=!0)}}configureTransparencyTarget(){this.configuration.transparencyAware?(this.transparencyRenderTargetDWFalse=new ci(this.width,this.height,{minFilter:Ot,magFilter:qt,type:Wi,format:bi}),this.transparencyRenderTargetDWTrue=new ci(this.width,this.height,{minFilter:Ot,magFilter:qt,type:Wi,format:bi}),this.transparencyRenderTargetDWTrue.depthTexture=new Bp(this.width,this.height,Wr),this.depthCopyPass=new Pg(new Ht({uniforms:{depthTexture:{value:this.depthTexture}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }`,fragmentShader:`
            uniform sampler2D depthTexture;
            varying vec2 vUv;
            void main() {
               gl_FragDepth = texture2D(depthTexture, vUv).r + 0.00001;
               gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
            }
            `}))):(this.transparencyRenderTargetDWFalse&&(this.transparencyRenderTargetDWFalse.dispose(),this.transparencyRenderTargetDWFalse=null),this.transparencyRenderTargetDWTrue&&(this.transparencyRenderTargetDWTrue.dispose(),this.transparencyRenderTargetDWTrue=null),this.depthCopyPass&&(this.depthCopyPass.dispose(),this.depthCopyPass=null))}renderTransparency(e){const t=this.scene.background,i=e.getClearColor(new ge),n=e.getClearAlpha(),r=new Map,o=e.autoClearDepth;this.scene.traverse(a=>{r.set(a,a.visible)}),this.scene.background=null,e.autoClearDepth=!1,e.setClearColor(new ge(0,0,0),0),this.depthCopyPass.material.uniforms.depthTexture.value=this.depthTexture,e.setRenderTarget(this.transparencyRenderTargetDWFalse),this.scene.traverse(a=>{a.material&&(a.visible=r.get(a)&&(a.material.transparent&&!a.material.depthWrite&&!a.userData.treatAsOpaque||!!a.userData.cannotReceiveAO))}),e.clear(!0,!0,!0),this.depthCopyPass.render(e),e.render(this.scene,this.camera),e.setRenderTarget(this.transparencyRenderTargetDWTrue),this.scene.traverse(a=>{a.material&&(a.visible=r.get(a)&&a.material.transparent&&a.material.depthWrite&&!a.userData.treatAsOpaque)}),e.clear(!0,!0,!0),this.depthCopyPass.render(e),e.render(this.scene,this.camera),this.scene.traverse(a=>{a.visible=r.get(a)}),e.setClearColor(i,n),this.scene.background=t,e.autoClearDepth=o}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera)}configureAOPass(e=!1,t=!1){this.firstFrame(),this.samples=this.generateHemisphereSamples(this.configuration.aoSamples);const i={...jXe};i.fragmentShader=i.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),e&&(i.fragmentShader=`#define LOGDEPTH
`+i.fragmentShader),t&&(i.fragmentShader=`#define ORTHO
`+i.fragmentShader),this.configuration.halfRes&&(i.fragmentShader=`#define HALFRES
`+i.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new Ht(i)):this.effectShaderQuad=new Pg(new Ht(i))}configureDenoisePass(e=!1,t=!1){this.firstFrame(),this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);const i={...$Xe};i.fragmentShader=i.fragmentShader.replace("16",this.configuration.denoiseSamples),e&&(i.fragmentShader=`#define LOGDEPTH
`+i.fragmentShader),t&&(i.fragmentShader=`#define ORTHO
`+i.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new Ht(i)):this.poissonBlurQuad=new Pg(new Ht(i))}configureEffectCompositer(e=!1,t=!1){this.firstFrame();const i={...qXe};e&&(i.fragmentShader=`#define LOGDEPTH
`+i.fragmentShader),t&&(i.fragmentShader=`#define ORTHO
`+i.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(i.fragmentShader=`#define HALFRES
`+i.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new Ht(i)):this.effectCompositerQuad=new Pg(new Ht(i))}generateHemisphereSamples(e){const t=[];for(let i=0;i<e;i++){const n=2.399963*i,r=Math.sqrt(i+.5)/Math.sqrt(e),o=r*Math.cos(n),a=r*Math.sin(n),l=Math.sqrt(1-(o*o+a*a));t.push(new T(o,a,l))}return t}generateDenoiseSamples(e,t){const i=2*Math.PI*t/e,n=1/e,r=n,o=[];let a=n,l=0;for(let c=0;c<e;c++)o.push(new Q(Math.cos(l),Math.sin(l)).multiplyScalar(Math.pow(a,.75))),a+=r,l+=i;return o}setSize(e,t){this.firstFrame(),this.width=e,this.height=t;const i=this.configuration.halfRes?.5:1;this.writeTargetInternal.setSize(e*i,t*i),this.readTargetInternal.setSize(e*i,t*i),this.accumulationRenderTarget.setSize(e*i,t*i),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(e*i,t*i),this.configuration.transparencyAware&&(this.transparencyRenderTargetDWFalse.setSize(e,t),this.transparencyRenderTargetDWTrue.setSize(e,t)),this.outputTargetInternal.setSize(e,t)}setDepthTexture(e){this.depthTexture=e}firstFrame(){this.needsFrame=!0}render(e,t,i){const n=e.xr.enabled;e.xr.enabled=!1,e.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=e.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer,this.camera.isOrthographicCamera)),this.detectTransparency(),(t.texture.type!==this.outputTargetInternal.texture.type||t.texture.format!==this.outputTargetInternal.texture.format)&&(this.outputTargetInternal.texture.type=t.texture.type,this.outputTargetInternal.texture.format=t.texture.format,this.outputTargetInternal.texture.needsUpdate=!0),this.camera.updateMatrixWorld(),this.lastViewMatrix.equals(this.camera.matrixWorldInverse)&&this.lastProjectionMatrix.equals(this.camera.projectionMatrix)&&this.configuration.accumulate&&!this.needsFrame?this.frame++:(this.configuration.accumulate&&(e.setRenderTarget(this.accumulationRenderTarget),e.clear(!0,!0,!0)),this.frame=0,this.needsFrame=!1),this.lastViewMatrix.copy(this.camera.matrixWorldInverse),this.lastProjectionMatrix.copy(this.camera.projectionMatrix);let r,o,a;this.debugMode&&(r=e.getContext(),o=r.getExtension("EXT_disjoint_timer_query_webgl2"),o===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),this.debugMode&&(a=r.createQuery(),r.beginQuery(o.TIME_ELAPSED_EXT,a)),this.configuration.transparencyAware&&this.renderTransparency(e),this._r.set(this.width,this.height);let l=this.configuration.aoRadius;if(this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(l*=.5),this.frame<1024/this.configuration.aoSamples){this.configuration.halfRes&&(e.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.depthDownsampleQuad.render(e)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=t.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new T),this.effectShaderQuad.material.uniforms.biasAdjustment.value=new Q(this.configuration.biasOffset,this.configuration.biasMultiplier),this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=l,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectShaderQuad.material.uniforms.frame.value=this.frame,e.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(e);for(let h=0;h<this.configuration.denoiseIterations;h++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new T),this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=l,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=h,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(e);e.setRenderTarget(this.accumulationRenderTarget);const c=e.autoClear;e.autoClear=!1,this.accumulationQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.accumulationQuad.material.uniforms.frame.value=this.frame,this.accumulationQuad.render(e),e.autoClear=c}this.configuration.transparencyAware&&(this.effectCompositerQuad.material.uniforms.transparencyDWFalse.value=this.transparencyRenderTargetDWFalse.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrue.value=this.transparencyRenderTargetDWTrue.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrueDepth.value=this.transparencyRenderTargetDWTrue.depthTexture,this.effectCompositerQuad.material.uniforms.transparencyAware.value=!0),this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=t.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.effectCompositerQuad.material.uniforms.aoTones.value=this.configuration.aoTones,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=l,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.autosetGamma?this.renderToScreen:this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.accumulationRenderTarget.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),this.effectCompositerQuad.material.uniforms.colorMultiply.value=this.configuration.colorMultiply,this.effectCompositerQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new T),this.effectCompositerQuad.material.uniforms.fog.value=!!this.scene.fog,this.scene.fog&&(this.scene.fog.isFog?(this.effectCompositerQuad.material.uniforms.fogExp.value=!1,this.effectCompositerQuad.material.uniforms.fogNear.value=this.scene.fog.near,this.effectCompositerQuad.material.uniforms.fogFar.value=this.scene.fog.far):this.scene.fog.isFogExp2?(this.effectCompositerQuad.material.uniforms.fogExp.value=!0,this.effectCompositerQuad.material.uniforms.fogDensity.value=this.scene.fog.density):console.error(`Unsupported fog type ${this.scene.fog.constructor.name} in SSAOPass.`)),e.setRenderTarget(this.outputTargetInternal),this.effectCompositerQuad.render(e),e.setRenderTarget(this.renderToScreen?null:i),this.copyQuad.material.uniforms.tDiffuse.value=this.outputTargetInternal.texture,this.copyQuad.render(e),this.debugMode&&(r.endQuery(o.TIME_ELAPSED_EXT),kae(a,r,this)),e.xr.enabled=n}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(e){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(e)}setQualityMode(e){e==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):e==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):e==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}}Uint8Array.from(atob(Gae),s=>s.charCodeAt(0));var s3e=Object.defineProperty,r3e=Object.getOwnPropertyDescriptor,Dae=(s,e,t,i)=>{for(var n=i>1?void 0:i?r3e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&s3e(e,t,n),n};class OM extends jr{constructor(){super(...arguments);p(this,"_effect")}get typeName(){return"Sharpening"}onCreateEffect(){return this.effect}get effect(){return this._effect??(this._effect=new Fae),this._effect}set amount(t){this.effect.uniforms.get("amount").value=t}get amount(){return this.effect.uniforms.get("amount").value}set radius(t){this.effect.uniforms.get("radius").value=t}get radius(){return this.effect.uniforms.get("radius").value}}Dae([I()],OM.prototype,"amount",1);Dae([I()],OM.prototype,"radius",1);const o3e=`
  void mainSupport() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,a3e=`
uniform sampler2D tDiffuse;
uniform float amount;
uniform float radius;

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
    float tx = 1.0 / resolution.x;
    float ty = 1.0 / resolution.y;
    vec2 texelSize = vec2(tx, ty);

    vec4 blurred = vec4(0.0);
    float total = 0.0;

    for (float x = -radius; x <= radius; x++) {
        for (float y = -radius; y <= radius; y++) {
            vec2 offset = vec2(x, y) * texelSize;
            vec4 diffuse = texture2D(tDiffuse, uv + offset);
            float weight = exp(-length(offset) * amount);
            blurred += diffuse * weight;
            total += weight;
        }
    }

    if (total > 0.0) {
        blurred /= total;
    }

    // Calculate the sharpened color using inputColor
    vec4 sharp = inputColor + clamp(inputColor - blurred, 0.0, 1.0) * amount;
    // Keep original alpha
    sharp.a = inputColor.a;

    // Ensure the sharp color does not go below 0 or above 1
    // This means: sharpening must happen AFTER tonemapping.
    sharp = clamp(sharp, 0.0, 1.0);

    outputColor = sharp;
}

`;class Fae extends Na{constructor(){super("Sharpening",a3e,{vertexShader:o3e,blendFunction:ai.NORMAL,uniforms:new Map([["amount",new Te(1)],["radius",new Te(1)]])})}}const Gg=ee("debugpost"),YD=Symbol("needle:postprocessing-handler"),JD=Symbol("needle:previous-autoclear-state");class iG{constructor(e){p(this,"_composer",null);p(this,"_lastVolumeComponents");p(this,"_effects",[]);p(this,"_isActive",!1);p(this,"context");this.context=e}get isActive(){return this._isActive}get composer(){return this._composer}apply(e){this._isActive=!0,this.onApply(this.context,e)}unapply(){var i;if(Gg&&console.log("Unapplying postprocessing effects"),this._isActive=!1,this._lastVolumeComponents){for(const n of this._lastVolumeComponents)n.unapply();this._lastVolumeComponents.length=0}const e=this.context;e[YD]===this&&delete e[YD],e.composer===this._composer&&((i=e.composer)==null||i.dispose(),e.composer=null),typeof e.renderer[JD]=="boolean"&&(e.renderer.autoClear=e.renderer[JD])}dispose(){this.unapply();for(const e of this._effects)e.dispose();this._effects.length=0,this._composer=null}onApply(e,t){if(!t)return;e[YD]=this,Gg&&console.log("Apply Postprocessing Effects",t),this._lastVolumeComponents=[...t],this._effects.length=0;const i={handler:this,components:this._lastVolumeComponents};for(let n=0;n<this._lastVolumeComponents.length;n++){const r=this._lastVolumeComponents[n];if(r.context=e,r.apply){if(r.active){if(!e.mainCameraComponent){console.error("No camera in scene found or available yet - can not create postprocessing effects");return}const o=r.apply(i);if(!o)continue;Array.isArray(o)?this._effects.push(...o):this._effects.push(o)}}else r.active&&An("Volume component is not a VolumeComponent: "+r.__type)}if(this.context.renderer.toneMapping!=Zr&&!this._effects.find(n=>n instanceof JL)){const n=new JL;this._effects.push(n)}this.applyEffects(e)}applyEffects(e){const t=this._effects;if(t.length<=0)return;const i=e.mainCameraComponent,n=e.renderer,r=e.scene,o=i.threeCamera;n[JD]=n.autoClear;const a=n.capabilities.maxSamples;this._composer||(this._composer=new wO(n,{frameBufferType:Wi,stencilBuffer:!0,multisampling:Math.min(exports.DeviceUtilities.isMobileDevice()?4:8,a)})),e.composer&&e.composer!==this._composer&&console.warn("There's already an active EffectComposer in your scene: replacing it with a new one. This might cause unexpected behaviour. Make sure to only use one PostprocessingManager/Volume in your scene."),e.composer=this._composer;const l=e.composer;l.setMainCamera(o),l.setRenderer(n),l.setMainScene(r);for(const h of l.passes)h.dispose();l.removeAllPasses();const c=new iP(r,o);c.name="Render To Screen",c.mainScene=r,l.addPass(c);try{this.orderEffects();const h=[];for(const d of t)if(d instanceof Na)h.push(d);else if(d instanceof Jr){const u=new tQ(o,...h);u.mainScene=r,u.name=h.map(f=>f.constructor.name).join(", "),u.enabled=!0,h.length=0,l.addPass(d)}if(h.length>0){const d=new tQ(o,...h);d.name=h.map(u=>u.name).join(" "),d.mainScene=r,d.enabled=!0,l.addPass(d)}}catch(h){console.error("Error while applying postprocessing effects",h),l.removeAllPasses()}Gg&&console.log("PostProcessing Passes",t,"->",l.passes)}orderEffects(){var t;Gg&&console.log("Before ordering effects",[...this._effects]);const e=this._effects;e.sort((i,n)=>{const r=Qz.findIndex(a=>i.constructor.name.endsWith(a.name)),o=Qz.findIndex(a=>n.constructor.name.endsWith(a.name));return r<0?(Gg&&console.warn("Unknown effect found: ",i.constructor.name),-1):o<0?(Gg&&console.warn("Unknown effect found: ",n.constructor.name),1):r<0?1:o<0?-1:r-o}),Gg&&console.log("After ordering effects",[...this._effects]);for(let i=0;i<e.length;i++){const n=e[i];if(((t=n==null?void 0:n.configuration)==null?void 0:t.gammaCorrection)!==void 0){const r=i===e.length-1;n.configuration.gammaCorrection=r}}}}const Qz=[ene,TO,Jie,jie,Nae,qie,Hie,Oie,MO,Yie,$ie,Kie,JL,Qie,Xie,Fae];class l3e{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:n,msg:r,transfer:o}=this.queue.shift();this.workersResolve[e]=n,this.workers[e].postMessage(r,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(i=>{const n=this._getIdleWorker();n!==-1?(this._initWorker(n),this.workerStatus|=1<<n,this.workersResolve[n]=i,this.workers[n].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const c3e=0,nJ=2,h3e=1,sJ=2,d3e=0,u3e=1,p3e=10,f3e=0,Vae=9,zae=15,Uae=16,Xae=22,Oae=37,Zae=43,Wae=76,Hae=83,Qae=97,Kae=100,Yae=103,Jae=109,jae=165,qae=166,$ae=1000066e3;class m3e{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class N_{constructor(e,t,i,n){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=n,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){t===void 0&&(t=0);const i=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==t&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,n)}}const ga=[171,75,84,88,32,50,48,187,13,10,26,10];function rJ(s){return new TextDecoder().decode(s)}function g3e(s){const e=new Uint8Array(s.buffer,s.byteOffset,ga.length);if(e[0]!==ga[0]||e[1]!==ga[1]||e[2]!==ga[2]||e[3]!==ga[3]||e[4]!==ga[4]||e[5]!==ga[5]||e[6]!==ga[6]||e[7]!==ga[7]||e[8]!==ga[8]||e[9]!==ga[9]||e[10]!==ga[10]||e[11]!==ga[11])throw new Error("Missing KTX 2.0 identifier.");const t=new m3e,i=17*Uint32Array.BYTES_PER_ELEMENT,n=new N_(s,ga.length,i,!0);t.vkFormat=n._nextUint32(),t.typeSize=n._nextUint32(),t.pixelWidth=n._nextUint32(),t.pixelHeight=n._nextUint32(),t.pixelDepth=n._nextUint32(),t.layerCount=n._nextUint32(),t.faceCount=n._nextUint32();const r=n._nextUint32();t.supercompressionScheme=n._nextUint32();const o=n._nextUint32(),a=n._nextUint32(),l=n._nextUint32(),c=n._nextUint32(),h=n._nextUint64(),d=n._nextUint64(),u=new N_(s,ga.length+i,3*r*8,!0);for(let H=0;H<r;H++)t.levels.push({levelData:new Uint8Array(s.buffer,s.byteOffset+u._nextUint64(),u._nextUint64()),uncompressedByteLength:u._nextUint64()});const f=new N_(s,o,a,!0),m={vendorId:f._skip(4)._nextUint16(),descriptorType:f._nextUint16(),versionNumber:f._nextUint16(),descriptorBlockSize:f._nextUint16(),colorModel:f._nextUint8(),colorPrimaries:f._nextUint8(),transferFunction:f._nextUint8(),flags:f._nextUint8(),texelBlockDimension:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],bytesPlane:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],samples:[]},g=(m.descriptorBlockSize/4-6)/4;for(let H=0;H<g;H++){const W={bitOffset:f._nextUint16(),bitLength:f._nextUint8(),channelType:f._nextUint8(),samplePosition:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&W.channelType?(W.sampleLower=f._nextInt32(),W.sampleUpper=f._nextInt32()):(W.sampleLower=f._nextUint32(),W.sampleUpper=f._nextUint32()),m.samples[H]=W}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(m);const A=new N_(s,l,c,!0);for(;A._offset<c;){const H=A._nextUint32(),W=A._scan(H),se=rJ(W);if(t.keyValue[se]=A._nextUint8Array(H-W.byteLength-1),se.match(/^ktx/i)){const de=rJ(t.keyValue[se]);t.keyValue[se]=de.substring(0,de.lastIndexOf("\0"))}A._skip(H%4?4-H%4:0)}if(d<=0)return t;const y=new N_(s,h,d,!0),b=y._nextUint16(),x=y._nextUint16(),v=y._nextUint32(),_=y._nextUint32(),C=y._nextUint32(),S=y._nextUint32(),M=[];for(let H=0;H<r;H++)M.push({imageFlags:y._nextUint32(),rgbSliceByteOffset:y._nextUint32(),rgbSliceByteLength:y._nextUint32(),alphaSliceByteOffset:y._nextUint32(),alphaSliceByteLength:y._nextUint32()});const L=h+y._offset,w=L+v,E=w+_,B=E+C,P=new Uint8Array(s.buffer,s.byteOffset+L,v),k=new Uint8Array(s.buffer,s.byteOffset+w,_),X=new Uint8Array(s.buffer,s.byteOffset+E,C),F=new Uint8Array(s.buffer,s.byteOffset+B,S);return t.globalData={endpointCount:b,selectorCount:x,imageDescs:M,endpointsData:P,selectorsData:k,tablesData:X,extendedData:F},t}let jD,Xu,Kz;const qD={env:{emscripten_notify_memory_growth:function(s){Kz=new Uint8Array(Xu.exports.memory.buffer)}}};class A3e{init(){return jD||(jD=typeof fetch<"u"?fetch("data:application/wasm;base64,"+oJ).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,qD)).then(this._init):WebAssembly.instantiate(Buffer.from(oJ,"base64"),qD).then(this._init),jD)}_init(e){Xu=e.instance,qD.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Xu)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,n=Xu.exports.malloc(i);Kz.set(e,n),t=t||Number(Xu.exports.ZSTD_findDecompressedSize(n,i));const r=Xu.exports.malloc(t),o=Xu.exports.ZSTD_decompress(r,t,n,i),a=Kz.slice(r,r+o);return Xu.exports.free(n),Xu.exports.free(r),a}}const oJ="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",$D=new WeakMap;let eF=0,tF;class Nd extends ps{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new l3e,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new Is(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),i=new Is(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const n=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,n]).then(([r,o])=>{const a=Nd.BasisWorker.toString(),l=["/* constants */","let _EngineFormat = "+JSON.stringify(Nd.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Nd.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Nd.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const c=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return c.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),c})}),eF>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),eF++}return this.transcoderPending}load(e,t,i,n){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new Is(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(e,o=>{this.parse(o,t,n)},i,n)}parse(e,t,i){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if($D.has(e))return $D.get(e).promise.then(t).catch(i);this._createTexture(e).then(n=>t?t(n):null).catch(i)}_createTextureFrom(e,t){const{faces:i,width:n,height:r,format:o,type:a,error:l,dfdFlags:c}=e;if(a==="error")return Promise.reject(l);let h;if(t.faceCount===6)h=new WU(i,o,Pi);else{const d=i[0].mipmaps;h=t.layerCount>1?new B8(d,n,r,t.layerCount,o,Pi):new Fd(d,n,r,o,Pi)}return h.minFilter=i[0].mipmaps.length===1?Ot:xr,h.magFilter=Ot,h.generateMipmaps=!1,h.needsUpdate=!0,h.colorSpace=ele(t),h.premultiplyAlpha=!!(c&h3e),h}async _createTexture(e,t={}){const i=g3e(new Uint8Array(e));if(i.vkFormat!==f3e)return b3e(i);const n=t,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:n},[e])).then(o=>this._createTextureFrom(o.data,i));return $D.set(e,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),eF--,this}}Nd.BasisFormat={ETC1S:0,UASTC_4x4:1};Nd.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};Nd.EngineFormat={RGBAFormat:bi,RGBA_ASTC_4x4_Format:dx,RGBA_BPTC_Format:Zb,RGBA_ETC2_EAC_Format:Bw,RGBA_PVRTC_4BPPV1_Format:Ew,RGBA_S3TC_DXT5_Format:Ob,RGB_ETC1_Format:Rw,RGB_ETC2_Format:Lw,RGB_PVRTC_4BPPV1_Format:Tw,RGBA_S3TC_DXT1_Format:Xb};Nd.BasisWorker=function(){let s,e,t;const i=_EngineFormat,n=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",function(m){const g=m.data;switch(g.type){case"init":s=g.config,o(g.transcoderBinary);break;case"transcode":e.then(()=>{try{const{faces:A,buffers:y,width:b,height:x,hasAlpha:v,format:_,dfdFlags:C}=a(g.buffer);self.postMessage({type:"transcode",id:g.id,faces:A,width:b,height:x,hasAlpha:v,format:_,dfdFlags:C},y)}catch(A){console.error(A),self.postMessage({type:"error",id:g.id,error:A.message})}});break}});function o(m){e=new Promise(g=>{t={wasmBinary:m,onRuntimeInitialized:g},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(m){const g=new t.KTX2File(new Uint8Array(m));function A(){g.close(),g.delete()}if(!g.isValid())throw A(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const y=g.isUASTC()?r.UASTC_4x4:r.ETC1S,b=g.getWidth(),x=g.getHeight(),v=g.getLayers()||1,_=g.getLevels(),C=g.getFaces(),S=g.getHasAlpha(),M=g.getDFDFlags(),{transcoderFormat:L,engineFormat:w}=d(y,b,x,S);if(!b||!x||!_)throw A(),new Error("THREE.KTX2Loader:	Invalid texture");if(!g.startTranscoding())throw A(),new Error("THREE.KTX2Loader: .startTranscoding failed");const E=[],B=[];for(let P=0;P<C;P++){const k=[];for(let X=0;X<_;X++){const F=[];let H,W;for(let de=0;de<v;de++){const be=g.getImageLevelInfo(X,de,P);P===0&&X===0&&de===0&&(be.origWidth%4!==0||be.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),_>1?(H=be.origWidth,W=be.origHeight):(H=be.width,W=be.height);const Pe=new Uint8Array(g.getImageTranscodedSizeInBytes(X,de,0,L));if(!g.transcodeImage(Pe,X,de,P,L,0,-1,-1))throw A(),new Error("THREE.KTX2Loader: .transcodeImage failed.");F.push(Pe)}const se=f(F);k.push({data:se,width:H,height:W}),B.push(se.buffer)}E.push({mipmaps:k,width:b,height:x,format:w})}return A(),{faces:E,buffers:B,width:b,height:x,hasAlpha:S,format:w,dfdFlags:M}}const l=[{if:"astcSupported",basisFormat:[r.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[i.RGBA_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],c=l.sort(function(m,g){return m.priorityETC1S-g.priorityETC1S}),h=l.sort(function(m,g){return m.priorityUASTC-g.priorityUASTC});function d(m,g,A,y){let b,x;const v=m===r.ETC1S?c:h;for(let _=0;_<v.length;_++){const C=v[_];if(s[C.if]&&C.basisFormat.includes(m)&&!(y&&C.transcoderFormat.length<2)&&!(C.needsPowerOfTwo&&!(u(g)&&u(A))))return b=C.transcoderFormat[y?1:0],x=C.engineFormat[y?1:0],{transcoderFormat:b,engineFormat:x}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),b=n.RGBA32,x=i.RGBAFormat,{transcoderFormat:b,engineFormat:x}}function u(m){return m<=2?!0:(m&m-1)===0&&m!==0}function f(m){if(m.length===1)return m[0];let g=0;for(let b=0;b<m.length;b++){const x=m[b];g+=x.byteLength}const A=new Uint8Array(g);let y=0;for(let b=0;b<m.length;b++){const x=m[b];A.set(x,y),y+=x.byteLength}return A}};const y3e=new Set([bi,Pc,Vl]),iF={[Jae]:bi,[Qae]:bi,[Oae]:bi,[Zae]:bi,[Yae]:Pc,[Hae]:Pc,[Uae]:Pc,[Xae]:Pc,[Kae]:Vl,[Wae]:Vl,[zae]:Vl,[Vae]:Vl,[$ae]:dx,[qae]:ux,[jae]:ux},nF={[Jae]:$i,[Qae]:Wi,[Oae]:Pi,[Zae]:Pi,[Yae]:$i,[Hae]:Wi,[Uae]:Pi,[Xae]:Pi,[Kae]:$i,[Wae]:Wi,[zae]:Pi,[Vae]:Pi,[$ae]:Wi,[qae]:Pi,[jae]:Pi};async function b3e(s){const{vkFormat:e}=s;if(iF[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let t;s.supercompressionScheme===nJ&&(tF||(tF=new Promise(async r=>{const o=new A3e;await o.init(),r(o)})),t=await tF);const i=[];for(let r=0;r<s.levels.length;r++){const o=Math.max(1,s.pixelWidth>>r),a=Math.max(1,s.pixelHeight>>r),l=s.pixelDepth?Math.max(1,s.pixelDepth>>r):0,c=s.levels[r];let h;if(s.supercompressionScheme===c3e)h=c.levelData;else if(s.supercompressionScheme===nJ)h=t.decode(c.levelData,c.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let d;nF[e]===$i?d=new Float32Array(h.buffer,h.byteOffset,h.byteLength/Float32Array.BYTES_PER_ELEMENT):nF[e]===Wi?d=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT):d=h,i.push({data:d,width:o,height:a,depth:l})}let n;if(y3e.has(iF[e]))n=s.pixelDepth===0?new ir(i[0].data,s.pixelWidth,s.pixelHeight):new q2(i[0].data,s.pixelWidth,s.pixelHeight,s.pixelDepth);else{if(s.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");n=new Fd(i,s.pixelWidth,s.pixelHeight)}return n.mipmaps=i,n.type=nF[e],n.format=iF[e],n.colorSpace=ele(s),n.needsUpdate=!0,Promise.resolve(n)}function ele(s){const e=s.dataFormatDescriptor[0];return e.colorPrimaries===u3e?e.transferFunction===sJ?ft:Ji:e.colorPrimaries===p3e?e.transferFunction===sJ?y1:Ox:(e.colorPrimaries===d3e||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),Fr)}async function MZ(s){const{NeedleEngineHTMLElement:e}=await Promise.resolve().then(()=>o5e);e.observedAttributes.includes(s)||e.observedAttributes.push(s)}var x3e=Object.defineProperty,v3e=Object.getOwnPropertyDescriptor,ZM=(s,e,t,i)=>{for(var n=i>1?void 0:i?v3e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&x3e(e,t,n),n};const Rc=ee("debugskybox");MZ("skybox-image");MZ("environment-image");function aJ(s,e,t,i,n){const r=new tu;r.allowDrop=!1,r.allowNetworking=!1,r.background=t,r.environment=i,$.addComponent(s.scene,r);const o=a=>{typeof a=="string"&&(Rc&&console.log(n,"CHANGED TO",a),r.setSkybox(a))};return wte(s.domElement,n,o),r.addEventListener("destroy",()=>{Rc&&console.log("Destroyed attribute remote skybox",n),Ste(s.domElement,n,o)}),r.setSkybox(e)}Oi.addContextCreatedCallback(s=>{var r;const e=s.context,t=e.domElement.getAttribute("skybox-image")||e.domElement.getAttribute("background-image"),i=e.domElement.getAttribute("environment-image"),n=new Array;if(t){Rc&&console.log("Creating remote skybox to load "+t),((r=e.mainCameraComponent)==null?void 0:r.clearFlags)!==$f.Skybox&&console.warn('"skybox-image"/"background-image" attribute has no effect: camera clearflags are not set to "Skybox"');const o=aJ(e,t,!0,!1,"skybox-image");n.push(o)}if(i){Rc&&console.log("Creating remote environment to load "+i);const o=aJ(e,i,!1,!0,"environment-image");n.push(o)}return n.length>0?YB(n):Promise.resolve()});function tle(){return globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES||(globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES=new Array),globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES}function lJ(s){const t=tle().find(i=>i.src===s);return t?(Rc&&console.log("Skybox: Found previously loaded texture for "+s),t.texture):null}async function _3e(s){const e=await s;n5(e,!0),Rn(e)}function C3e(s,e){const t=tle();for(;t.length>5;){const i=t.shift();i&&_3e(i.texture)}e.then(i=>n5(i,!1)),t.push({src:s,texture:e})}class tu extends ze{constructor(){super(...arguments);p(this,"url");p(this,"allowDrop",!0);p(this,"background",!0);p(this,"environment",!0);p(this,"allowNetworking",!0);p(this,"_loader");p(this,"_prevUrl");p(this,"_prevLoadedEnvironment");p(this,"_prevEnvironment",null);p(this,"_prevBackground",null);p(this,"validTextureTypes",[".ktx2",".hdr",".exr",".jpg",".jpeg",".png"]);p(this,"onDragOverEvent",t=>{if(this.allowDrop&&t.dataTransfer)for(const i of t.dataTransfer.types)(i==="text/uri-list"||i==="Files")&&t.preventDefault()});p(this,"onDrop",t=>{var i,n,r,o;if(this.allowDrop&&t.dataTransfer){for(const a of t.dataTransfer.types)if(Rc&&console.log(a),a==="text/uri-list"){const l=t.dataTransfer.getData(a);Rc&&console.log(a,l);let c=(n=(i=new RegExp(/polyhaven.com\/asset_img\/.+?\/(?<name>.+)\.png/).exec(l))==null?void 0:i.groups)==null?void 0:n.name;if(c||(c=(o=(r=new RegExp(/polyhaven\.com\/a\/(?<name>.+)/).exec(l))==null?void 0:r.groups)==null?void 0:o.name),Rc&&console.log(c),c){const h="https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/"+c+"_1k.exr";console.log(`[Remote Skybox] Setting skybox from url: ${h}`),t.preventDefault(),this.setSkybox(h);break}else if(this.isValidTextureType(l)){console.log("[Remote Skybox] Setting skybox from url: "+l),t.preventDefault(),this.setSkybox(l);break}else{console.warn(`[RemoteSkybox] Unknown url ${l}. If you want to load a skybox from a url, make sure it is a valid image url. Url must end with${this.validTextureTypes.join(", ")}.`);const h=new CustomEvent("dropped-unknown-url",{detail:{sender:this,event:t,url:l,apply:d=>{t.preventDefault(),this.setSkybox(d)}}});this.dispatchEvent(h)}}else if(a=="Files"){const l=t.dataTransfer.files.item(0);if(Rc&&console.log(a,l),!l)continue;if(!this.isValidTextureType(l.name)){console.warn(`[RemoteSkybox]: File "${l.name}" is not supported. Supported files are ${this.validTextureTypes.join(", ")}`);return}if(lJ(l.name)===null){const c=new Blob([l]),h=URL.createObjectURL(c);t.preventDefault(),this.setSkybox(h,l.name)}else t.preventDefault(),this.setSkybox(l.name);break}}})}onEnable(){this.setSkybox(this.url),this.registerDropEvents()}onDisable(){var t;this.context.scene.environment===this._prevLoadedEnvironment&&(this.context.scene.environment=this._prevEnvironment,Cn.backgroundShouldBeTransparent(this.context)||(this.context.scene.background=this._prevBackground),this._prevLoadedEnvironment=void 0),this.unregisterDropEvents(),(t=this.context.mainCameraComponent)==null||t.applyClearFlags()}urlChangedSyncField(){this.allowNetworking&&this.url&&this.isRemoteTexture(this.url)&&this.setSkybox(this.url)}async setSkybox(t,i){var o;if(!this.activeAndEnabled||(t=w3e(t,this.environment,this.background),!t))return!1;if(i??(i=t),this.isValidTextureType(i)||console.warn("Potentially invalid skybox url",i,"on",this.name),Rc&&console.log("Set remote skybox url: "+t),this._prevUrl===t&&this._prevLoadedEnvironment)return this.applySkybox(),!0;(o=this._prevLoadedEnvironment)==null||o.dispose(),this._prevLoadedEnvironment=void 0,this._prevUrl=t;const n=await this.loadTexture(t,i);if(!n||!this.enabled)return!1;this.url=t;const r=t.lastIndexOf("/");return n.name=t.substring(r>=0?r+1:0),this._loader instanceof Mh&&(n.colorSpace=ft),this._prevLoadedEnvironment=n,this.applySkybox(),!0}async loadTexture(t,i){var h,d,u,f,m;if(!t)return Promise.resolve(null);i??(i=t);const n=lJ(i);if(n){const g=await n;if(((d=(h=g.source)==null?void 0:h.data)==null?void 0:d.length)>0||(m=(f=(u=g.source)==null?void 0:u.data)==null?void 0:f.data)!=null&&m.length)return g}const r=i.endsWith(".exr"),o=i.endsWith(".hdr"),a=i.endsWith(".ktx2");if(r)this._loader instanceof bS||(this._loader=new bS);else if(o)this._loader instanceof u2||(this._loader=new u2);else if(a){if(!(this._loader instanceof Nd)){const{ktx2Loader:g}=cP(this.context.renderer);this._loader=g}}else this._loader instanceof Mh||(this._loader=new Mh);Rc&&console.log("Loading skybox: "+t);const l=this._loader.loadAsync(t);return C3e(i,l),await l}applySkybox(){var i;const t=this._prevLoadedEnvironment;t&&(t instanceof hA||t instanceof WU||(t.mapping=am,t.needsUpdate=!0),this.context.scene.background!==t&&(this._prevBackground=this.context.scene.background),this.context.scene.environment!==t&&(this._prevEnvironment=this.context.scene.environment),Rc&&console.log("Set remote skybox",this.url,!Cn.backgroundShouldBeTransparent(this.context)),this.environment&&(this.context.scene.environment=t),this.background&&!Cn.backgroundShouldBeTransparent(this.context)&&(this.context.scene.background=t),((i=this.context.mainCameraComponent)==null?void 0:i.backgroundBlurriness)!==void 0&&(this.context.scene.backgroundBlurriness=this.context.mainCameraComponent.backgroundBlurriness))}isRemoteTexture(t){return t.startsWith("http://")||t.startsWith("https://")}isValidTextureType(t){for(const i of this.validTextureTypes)if(t.endsWith(i))return!0;return!1}registerDropEvents(){this.unregisterDropEvents(),this.context.domElement.addEventListener("dragover",this.onDragOverEvent),this.context.domElement.addEventListener("drop",this.onDrop)}unregisterDropEvents(){this.context.domElement.removeEventListener("dragover",this.onDragOverEvent),this.context.domElement.removeEventListener("drop",this.onDrop)}}ZM([G5(tu.prototype.urlChangedSyncField),I(URL)],tu.prototype,"url",2);ZM([I()],tu.prototype,"allowDrop",2);ZM([I()],tu.prototype,"background",2);ZM([I()],tu.prototype,"environment",2);ZM([I()],tu.prototype,"allowNetworking",2);function w3e(s,e,t){const i=e&&!t;switch(s==null?void 0:s.toLowerCase()){case"studio":return i?"https://cdn.needle.tools/static/skybox/modelviewer-Neutral-small.hdr":"https://cdn.needle.tools/static/skybox/modelviewer-Neutral.hdr";case"blurred-skybox":return i?"https://cdn.needle.tools/static/skybox/blurred-skybox-small.exr":"https://cdn.needle.tools/static/skybox/blurred-skybox.exr";case"quicklook-ar":return i?"https://cdn.needle.tools/static/skybox/QuickLook-ARMode-small.exr":"https://cdn.needle.tools/static/skybox/QuickLook-ARMode.exr";case"quicklook":return i?"https://cdn.needle.tools/static/skybox/QuickLook-ObjectMode-small.exr":"https://cdn.needle.tools/static/skybox/QuickLook-ObjectMode.exr"}return s===void 0?null:s}var S3e=Object.defineProperty,M3e=Object.getOwnPropertyDescriptor,la=(s,e,t,i)=>{for(var n=i>1?void 0:i?M3e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&S3e(e,t,n),n};const Ja=ee("debugsceneswitcher"),I3e=ee("sceneswitcher:clearscene"),QR="scene";MZ(QR);const yf=Promise.resolve(!1);class Ir extends ze{constructor(){super(...arguments);p(this,"autoLoadFirstScene",!0);p(this,"scenes",[]);p(this,"loadingScene");p(this,"queryParameterName","scene");p(this,"useSceneName",!0);p(this,"clamp",!0);p(this,"useHistory",!0);p(this,"useKeyboard",!0);p(this,"useSwipe",!0);p(this,"useSceneLighting",!0);p(this,"useSceneBackground",!0);p(this,"preloadNext",1);p(this,"preloadPrevious",1);p(this,"preloadConcurrent",2);p(this,"createMenuButtons",!1);p(this,"sceneLoaded",new Tn);p(this,"_currentIndex",-1);p(this,"_currentScene");p(this,"_engineElementOverserver");p(this,"_preloadScheduler");p(this,"_menuButtons");p(this,"onPopState",async t=>{if(!this.useHistory)return;const i=this.useHistory;try{this.useHistory=!1;let n=!1;if(this.queryParameterName&&(n=await this.tryLoadFromQueryParam()),!n){const r=t==null?void 0:t.state;if(r&&r.startsWith(this.guid)){const o=r.substr(this.guid.length+2);Ja&&console.log("PopState",o),await this.trySelectSceneFromValue(o)}}}finally{this.useHistory=i}});p(this,"normalizedSwipeThresholdX",.1);p(this,"_didSwipe",!1);p(this,"onInputPointerMove",t=>{if(this.useSwipe&&!this._didSwipe&&t.button===0&&t.pointerType==="touch"&&this.context.input.getPointerPressedCount()===1){const i=this.context.input.getPointerPositionDelta(t.button);if(i){const n=i.x/this.context.domWidth;n>=this.normalizedSwipeThresholdX?(this._didSwipe=!0,this.selectPrev()):n<=-this.normalizedSwipeThresholdX&&(this._didSwipe=!0,this.selectNext())}}});p(this,"onInputPointerUp",t=>{t.button===0&&(this._didSwipe=!1)});p(this,"onInputKeyDown",t=>{if(!this.useKeyboard||!this.scenes)return;const i=t.key.toLowerCase();if(!i)return;const n=parseInt(i)-1;if(n>=0){this.trySelectSceneFromValue(n);return}switch(i){case"arrowright":case"d":this.selectNext();break;case"arrowleft":case"a":this.selectPrev();break}});p(this,"__lastSwitchScene");p(this,"__lastSwitchScenePromise");p(this,"_currentlyLoadingScene");p(this,"_lastLoadingScene");p(this,"_loadingScenePromise");p(this,"_isCurrentlyLoading",!1);p(this,"_currentLoadingProgress")}get currentIndex(){return this._currentIndex}get currentLoadingProgress(){return this._currentLoadingProgress}get currentlyLoadingScene(){return this._currentlyLoadingScene}get currentlyLoadedScene(){return this._currentScene}awake(){this.scenes===void 0&&(this.scenes=[]);for(const t of this.scenes)t&&!t.hasUrl&&t.asset instanceof ye&&t.asset.removeFromParent();Ja&&console.log("SceneSwitcher",this)}async onEnable(){if(globalThis.addEventListener("popstate",this.onPopState),this.context.input.addEventListener(es.KeyDown,this.onInputKeyDown),this.context.input.addEventListener(es.PointerMove,this.onInputPointerMove),this.context.input.addEventListener(es.PointerUp,this.onInputPointerUp),this._engineElementOverserver||(this._engineElementOverserver=new MutationObserver(t=>{for(const i of t)if(i.type==="attributes"&&i.attributeName===QR){const n=this.context.domElement.getAttribute(QR);n!==null&&this.trySelectSceneFromValue(n)}})),this._engineElementOverserver.observe(this.context.domElement,{attributes:!0}),this._preloadScheduler||(this._preloadScheduler=new T3e(this)),this._preloadScheduler.maxLoadAhead=this.preloadNext,this._preloadScheduler.maxLoadBehind=this.preloadPrevious,this._preloadScheduler.maxConcurrent=this.preloadConcurrent,this._preloadScheduler.begin(),this.autoLoadFirstScene&&this._currentIndex===-1&&!await this.tryLoadFromQueryParam()){const t=this.context.domElement.getAttribute(QR);try{(t===null||!await this.trySelectSceneFromValue(t))&&this._currentIndex===-1&&this.select(0)}finally{}}this.createMenuButtons&&(this._menuButtons??(this._menuButtons=[]),this._menuButtons.push(this.context.menu.appendChild({label:"Previous",icon:"arrow_back_ios",onClick:()=>this.selectPrev(),priority:-1005,class:"row2"})),this._menuButtons.push(this.context.menu.appendChild({label:"Next",icon:"arrow_forward_ios",iconSide:"right",onClick:()=>this.selectNext(),priority:-1e3,class:"row2"})))}onDisable(){var t;if(globalThis.removeEventListener("popstate",this.onPopState),this.context.input.removeEventListener(es.KeyDown,this.onInputKeyDown),this.context.input.removeEventListener(es.PointerMove,this.onInputPointerMove),this.context.input.removeEventListener(es.PointerUp,this.onInputPointerUp),(t=this._preloadScheduler)==null||t.stop(),this._menuButtons){for(const i of this._menuButtons)i.remove();this._menuButtons=void 0}}addScene(t){if(typeof t=="string"){let i=this.context.addressables.findAssetReference(t);return i||(i=new gi(t),this.context.addressables.registerAssetReference(i)),this.scenes.push(i),i}return this.scenes.push(t),t}selectNext(){return this.select(this._currentIndex+1)}selectPrev(){return this.select(this._currentIndex-1)}select(t){var n,r,o;if(Ja&&console.log("select",t),typeof t=="object"&&console.warn('Switching to "'+t+'" might not work. Please either use an index or a AssetReference (not a scene reference)'),typeof t=="string"){const a=(n=this.scenes)==null?void 0:n.find(l=>l.url===t);if(!a){const l=gi.getOrCreate(this.sourceId??"",t,this.context);return this.switchScene(l)}if(a)t=(r=this.scenes)==null?void 0:r.indexOf(a);else return yf}if(!((o=this.scenes)!=null&&o.length))return yf;if(t<0){if(this.clamp)return yf;t=this.scenes.length-1}else if(t>=this.scenes.length){if(this.clamp)return yf;t=0}const i=this.scenes[t];return this.switchScene(i)}unload(){return this.__lastSwitchScene=void 0,this.__lastSwitchScenePromise=void 0,this.__unloadCurrentScene()}async reload(){if(this.__lastSwitchScene){const t=this.__lastSwitchScene;return this.__lastSwitchScene=void 0,this.switchScene(t)}return!1}async switchScene(t){if(!(t instanceof gi)){const n=typeof t;return n==="string"?this.select(t):n==="number"?this.select(t):(console.warn("SceneSwitcher: Can't switch to scene",t,"of type",n),!1)}return t.url===this.sourceId?(console.warn("SceneSwitcher: can't load own scene - prevent recursive loading",this.sourceId),!1):this.__lastSwitchScene===t&&this.__lastSwitchScenePromise?this.__lastSwitchScenePromise:(this.__lastSwitchScene=t,this.__lastSwitchScenePromise=this.__internalSwitchScene(t),await this.__lastSwitchScenePromise)}async __unloadCurrentScene(){const t=this._currentScene;if(this._currentScene=void 0,t){Ja&&console.log("UNLOAD",t.url,"HasURL?: "+t.hasUrl);const i=this.tryGetSceneEventListener(t.asset);if(i!=null&&i.sceneClosing){const n=i.sceneClosing();n instanceof Promise&&await n}t.hasUrl?t.unload():t.asset instanceof ye&&t.asset.removeFromParent()}}async __internalSwitchScene(t){var n,r,o,a;await this.__unloadCurrentScene();const i=this._currentIndex=((n=this.scenes)==null?void 0:n.indexOf(t))??-1;try{this._currentlyLoadingScene=t,this._currentLoadingProgress=new ProgressEvent("progress",{loaded:0,total:1});const l=new CustomEvent("loadscene-start",{detail:{scene:t,switcher:this,index:i}});this.dispatchEvent(l),await this.onStartLoading(),await t.loadAssetAsync((h,d)=>{this._currentLoadingProgress=d,this.dispatchEvent(d)}).catch(console.error),await this.onEndLoading();const c=new CustomEvent("loadscene-finished",{detail:{scene:t,switcher:this,index:i}});if(this.dispatchEvent(c),this._currentLoadingProgress=void 0,this._currentlyLoadingScene=void 0,c.defaultPrevented)return Ja&&console.warn("Adding loaded scene prevented:",t,c),!1;if(!t.asset)return Ja&&console.warn("Failed loading scene:",t),!1;if(this._currentIndex===i){if(Ja&&console.log("ADD",t.url),this._currentScene=t,I3e){const u=((r=this.context.mainCameraComponent)==null?void 0:r.gameObject)||this.context.mainCamera;u==null||u.removeFromParent();const f=this.gameObject.removeFromParent();ic(this.context.scene,!0,!0),this.context.scene=new sr,this.context.scene.add(f),u&&this.context.scene.add(u)}if($.add(t.asset,this.gameObject),this.useSceneLighting&&this.context.sceneLighting.enable(t),this.useSceneBackground){const u=this.context.lightmaps.tryGetSkybox(t.url);u?(u.mapping=wo,this.context.scene.background=u):Ja&&console.warn("SceneSwitcher: Can't find skybox for scene "+t.url)}if(this.useHistory&&i>=0){let u=i.toString();if(this.useSceneName&&(u=cJ(t.url)),(o=this.queryParameterName)!=null&&o.length)eS(this.queryParameterName,u,this.useHistory);else{const f=history.state,m=this.guid+"::"+i;f!==m&&history.pushState(m,"unused",location.href)}}const h=this.tryGetSceneEventListener(t.asset);if(h!=null&&h.sceneOpened){const u=h.sceneOpened(this);u instanceof Promise&&await u}const d=new CustomEvent("scene-opened",{detail:{scene:t,switcher:this,index:i}});return this.dispatchEvent(d),(a=this.sceneLoaded)==null||a.invoke(this),!0}}catch(l){console.error(l)}return!1}preload(t){if(t>=0&&t<this.scenes.length){const i=this.scenes[t];if(i instanceof gi)return i.preload()}return yf}tryLoadFromQueryParam(){var i;if(!((i=this.queryParameterName)!=null&&i.length))return yf;const t=ee(this.queryParameterName);return typeof t=="boolean"?yf:this.trySelectSceneFromValue(t)}trySelectSceneFromValue(t){if(typeof t=="string"){const i=parseInt(t);if(i>=0&&i<this.scenes.length)return this.select(i);{const n=t.toLowerCase();for(let r=0;r<this.scenes.length;r++){const o=this.scenes[r];if(o&&cJ(o.url).toLowerCase().includes(n))return this.select(r)}}}else if(typeof t=="number"&&t>=0&&t<this.scenes.length)return this.select(t);return ka()&&console.warn('Can not find scene: "'+t+'"',this),yf}async onStartLoading(){var t,i;if(this._isCurrentlyLoading=!0,this.loadingScene&&(this._lastLoadingScene!==this.loadingScene&&(this._loadingScenePromise=void 0),this._lastLoadingScene=this.loadingScene,this._loadingScenePromise||(this._loadingScenePromise=(t=this.loadingScene)==null?void 0:t.loadAssetAsync()),await this._loadingScenePromise,this._isCurrentlyLoading&&((i=this.loadingScene)!=null&&i.asset))){Ja&&console.log("Add loading scene",this.loadingScene.url,this.loadingScene.asset);const n=this.loadingScene.asset;$.add(n,this.gameObject);const r=this.tryGetSceneEventListener(n);if(r!=null&&r.sceneOpened){const o=r.sceneOpened(this);o instanceof Promise&&await o}}if(this._isCurrentlyLoading){const n=this.tryGetSceneEventListener(this.gameObject);if(n&&n.sceneOpened){const r=n.sceneOpened(this);r instanceof Promise&&await r}}}async onEndLoading(){var t;if(this._isCurrentlyLoading=!1,(t=this.loadingScene)!=null&&t.asset){Ja&&console.log("Remove loading scene",this.loadingScene.url);const i=this.loadingScene.asset,n=this.tryGetSceneEventListener(i);if(typeof(n==null?void 0:n.sceneClosing)=="function"){const r=n.sceneClosing();r instanceof Promise&&await r}$.remove(i)}if(!this._isCurrentlyLoading){const i=this.tryGetSceneEventListener(this.gameObject);if(i&&i.sceneClosing){const n=i.sceneClosing();n instanceof Promise&&await n}}}tryGetSceneEventListener(t,i=0){if(!t)return null;const n=$.foreachComponent(t,r=>{const o=r;if(o.sceneClosing||o.sceneOpened)return o});if(i===0&&!n&&t.children.length)for(const r of t.children){const o=this.tryGetSceneEventListener(r,i+1);if(o)return o}return n||null}}la([I()],Ir.prototype,"autoLoadFirstScene",2);la([I(gi)],Ir.prototype,"scenes",2);la([I(gi)],Ir.prototype,"loadingScene",2);la([I()],Ir.prototype,"queryParameterName",2);la([I()],Ir.prototype,"useSceneName",2);la([I()],Ir.prototype,"clamp",2);la([I()],Ir.prototype,"useHistory",2);la([I()],Ir.prototype,"useKeyboard",2);la([I()],Ir.prototype,"useSwipe",2);la([I()],Ir.prototype,"useSceneLighting",2);la([I()],Ir.prototype,"useSceneBackground",2);la([I()],Ir.prototype,"preloadNext",2);la([I()],Ir.prototype,"preloadPrevious",2);la([I()],Ir.prototype,"preloadConcurrent",2);la([I()],Ir.prototype,"createMenuButtons",2);la([I(Tn)],Ir.prototype,"sceneLoaded",2);function cJ(s){const e=s.split("/").pop(),t=e==null?void 0:e.split(".").shift();return t!=null&&t.length?t:s}class T3e{constructor(e,t=1,i=1,n=2){p(this,"maxLoadAhead");p(this,"maxLoadBehind");p(this,"maxConcurrent");p(this,"_isRunning",!1);p(this,"_switcher");p(this,"_loadTasks",[]);p(this,"_maxConcurrentLoads",1);this._switcher=e,this.maxLoadAhead=t,this.maxLoadBehind=i,this.maxConcurrent=n}begin(){if(this._isRunning)return;Ja&&console.log("Preload begin"),this._isRunning=!0;let e=-1,t,i;const n=this._switcher.scenes,r=setInterval(()=>{if(this.allLoaded()&&(Ja&&console.log("All scenes loaded"),this.stop()),!this._isRunning){clearInterval(r);return}if(this.canLoadNewScene()===!1)return;e!==this._switcher.currentIndex&&(e=this._switcher.currentIndex,i=0,t=0);const o=i%2===0;o&&(t+=1),i+=1;const a=o?this.maxLoadAhead:this.maxLoadBehind;if(t>a)return;const l=o?e+t:e-t;if(l<0||l<0||l>=n.length)return;const c=n[l];new E3e(l,c,this._loadTasks)},200)}stop(){this._isRunning=!1}canLoadNewScene(){return this._loadTasks.length<this._maxConcurrentLoads}allLoaded(){if(this._switcher.scenes){for(const e of this._switcher.scenes)if((e==null?void 0:e.isLoaded())===!1)return!1}return!0}}class E3e{constructor(e,t,i){p(this,"index");p(this,"asset");p(this,"tasks");this.index=e,this.asset=t,this.tasks=i,i.push(this),this.awaitLoading()}async awaitLoading(){this.asset&&!this.asset.isLoaded()&&(Ja&&console.log("Preload start: "+this.asset.url,this.index),await this.asset.preload(),Ja&&console.log("Preload finished: "+this.asset.url,this.index));const e=this.tasks.indexOf(this);e>=0&&this.tasks.splice(e,1)}}function R3e(){return new Promise((s,e)=>{const i=()=>{i!=null&&(document.removeEventListener("pointerdown",i),document.removeEventListener("click",i),document.removeEventListener("dragstart",i),document.removeEventListener("touchstart",i),s())};document.addEventListener("pointerdown",i),document.addEventListener("click",i),document.addEventListener("dragstart",i),document.addEventListener("touchstart",i)})}async function L3e(s){await R3e(),s()}var B3e=Object.defineProperty,P3e=Object.getOwnPropertyDescriptor,cc=(s,e,t,i)=>{for(var n=i>1?void 0:i?P3e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&B3e(e,t,n),n};const Br=ee("debugvideo");var ile=(s=>(s[s.None=0]="None",s[s.AdjustHeight=1]="AdjustHeight",s[s.AdjustWidth=2]="AdjustWidth",s))(ile||{}),nle=(s=>(s[s.VideoClip=0]="VideoClip",s[s.Url=1]="Url",s))(nle||{}),sle=(s=>(s[s.CameraFarPlane=0]="CameraFarPlane",s[s.CameraNearPlane=1]="CameraNearPlane",s[s.RenderTexture=2]="RenderTexture",s[s.MaterialOverride=3]="MaterialOverride",s))(sle||{});class Sr extends ze{constructor(){super();p(this,"playOnAwake",!0);p(this,"aspectMode",0);p(this,"clip",null);p(this,"source",1);p(this,"_url",null);p(this,"renderMode");p(this,"targetMaterialProperty");p(this,"targetMaterialRenderer");p(this,"targetTexture");p(this,"time",0);p(this,"_playbackSpeed",1);p(this,"_isLooping",!1);p(this,"_muted",!1);p(this,"_audioOutputMode",2);p(this,"playInBackground",!0);p(this,"_crossOrigin","anonymous");p(this,"_videoElement",null);p(this,"_videoTexture",null);p(this,"_videoMaterial",null);p(this,"_isPlaying",!1);p(this,"wasPlaying",!1);p(this,"visibilityChanged",t=>{switch(document.visibilityState){case"hidden":this.playInBackground||(this.wasPlaying=this._isPlaying,this.pause());break;case"visible":this.wasPlaying&&!this._isPlaying&&this.play();break}});p(this,"_receivedInput",!1);p(this,"_overlay",null);p(this,"_targetObjects");p(this,"_updateAspectRoutineId",-1);p(this,"_hls");p(this,"onHlsAvailable",()=>{var t;Br&&console.log("HLS: available",this.clip),!(!this.shouldUseM3U||!this.url)&&(this._hls||(this._hls=new Hls),this.videoElement.autoplay=!0,this._hls.loadSource(this.url),this._hls.attachMedia(this.videoElement),(t=this._videoElement)==null||t.play(),Br&&console.log("HLS: loaded",this.clip))});L3e(()=>{this._receivedInput=!0,this.updateVideoElementSettings()}),this._targetObjects=[],ee("videoscreenspace")&&window.addEventListener("keydown",t=>{t.key==="f"&&(this.screenspace=!this.screenspace)})}get url(){return this._url}set url(t){const n=this._url!==t;this.__didAwake?n&&this.setClipURL(t??""):this._url=t}get playbackSpeed(){var t;return((t=this._videoElement)==null?void 0:t.playbackRate)??this._playbackSpeed}set playbackSpeed(t){this._playbackSpeed=t,this._videoElement&&(this._videoElement.playbackRate=t)}get isLooping(){var t;return((t=this._videoElement)==null?void 0:t.loop)??this._isLooping}set isLooping(t){this._isLooping=t,this._videoElement&&(this._videoElement.loop=t)}get currentTime(){var t;return((t=this._videoElement)==null?void 0:t.currentTime)??this.time}set currentTime(t){this._videoElement?this._videoElement.currentTime=t:this.time=t}get isPlaying(){const t=this._videoElement;if(t){if(t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>t.HAVE_CURRENT_DATA)return!0;if(t.srcObject&&t.srcObject.active)return!0}return!1}get crossOrigin(){var t;return((t=this._videoElement)==null?void 0:t.crossOrigin)??this._crossOrigin}set crossOrigin(t){this._crossOrigin=t,this._videoElement&&(t!==null?this._videoElement.setAttribute("crossorigin",t):this._videoElement.removeAttribute("crossorigin"))}get videoMaterial(){return!this._videoMaterial&&!this.create(!1)?null:this._videoMaterial}get videoTexture(){return!this._videoTexture&&!this.create(!1)?null:this._videoTexture}get videoElement(){return!this._videoElement&&!this.create(!1)?null:this._videoElement}requestPictureInPicture(){return this._videoElement?this._videoElement.requestPictureInPicture():null}get muted(){var t;return((t=this._videoElement)==null?void 0:t.muted)??this._muted}set muted(t){this._muted=t,this._videoElement&&(this._videoElement.muted=t)}get currentVideo(){return this.clip}set audioOutputMode(t){t!==this._audioOutputMode&&(t===1&&Qe()&&console.warn("VideoAudioOutputMode.AudioSource is not yet implemented"),this._audioOutputMode=t,this.updateVideoElementSettings())}get audioOutputMode(){return this._audioOutputMode}preloadVideo(){Br&&console.log("Video Preload: "+this.name,this.clip),this.create(!1)}preload(){this.preloadVideo()}setVideo(t){this.clip=t,this.source=0,this._videoElement?(this._videoElement.srcObject=t,this._isPlaying&&this.play(),this.updateAspect()):this.create(this.playOnAwake)}setClipURL(t){this._url!==t&&(this._url=t,this.source=1,Br&&console.log("set url",t),this._videoElement?t.endsWith(".m3u8")||t.includes(".m3u")?this.ensureM3UCanBePlayed():(this._videoElement.src=t,this._isPlaying&&(this.stop(),this.play())):this.create(this.playOnAwake))}onEnable(){var t,i;Br&&console.log("VideoPlayer.onEnable",nle[this.source],this.clip,this.url,this),window.addEventListener("visibilitychange",this.visibilityChanged),this.playOnAwake===!0?this.create(!0):this.preloadVideo(),this.screenspace?(t=this._overlay)==null||t.start():(i=this._overlay)==null||i.stop()}onDisable(){var t;window.removeEventListener("visibilitychange",this.visibilityChanged),(t=this._overlay)==null||t.stop(),this.pause()}onDestroy(){var t;this._videoElement&&((t=this.videoElement)==null||t.remove(),this._videoElement=null),this._videoTexture&&(this._videoTexture.dispose(),this._videoTexture=null)}play(){var t,i;if(this._videoElement||this.create(!1),!this._videoElement){Br&&console.warn("Can not play: no video element found",this);return}if(!(this._isPlaying&&!((t=this._videoElement)!=null&&t.ended)&&!((i=this._videoElement)!=null&&i.paused))){if(this._isPlaying=!0,this._receivedInput||(this._videoElement.muted=!0),this.handleBeginPlaying(!1),this.shouldUseM3U){this.ensureM3UCanBePlayed();return}Br&&console.log("Video Play()",this.clip,this._videoElement,this.time),this._videoElement.currentTime=this.time,this._videoElement.play().catch(n=>{var r;console.log(n),Br&&console.error("Error playing video",n,"CODE="+n.code,(r=this.videoElement)==null?void 0:r.src,this),setTimeout(()=>{this._isPlaying&&!this.destroyed&&this.activeAndEnabled&&this.play()},1e3)}),Br&&console.log("play",this._videoElement,this.time)}}stop(){this._isPlaying=!1,this.time=0,this._videoElement&&(this._videoElement.currentTime=0,this._videoElement.pause(),Br&&console.log("STOP",this))}pause(){var t,i;this.time=((t=this._videoElement)==null?void 0:t.currentTime)??0,this._isPlaying=!1,(i=this._videoElement)==null||i.pause(),Br&&console.log("PAUSE",this,this.currentTime)}create(t){let i;switch(this.source){case 0:i=this.clip;break;case 1:i=this.url,!(i!=null&&i.length)&&typeof this.clip=="string"&&(i=this.clip);break}return i?(this._videoElement||(Br&&console.warn("Create VideoElement",this),this._videoElement=this.createVideoElement(),this.context.domElement.shadowRoot.prepend(this._videoElement),this.updateVideoElementStyles()),typeof i=="string"?(Br&&console.log("Set Video src",i),this._videoElement.src=i):(Br&&console.log("Set Video srcObject",i),this._videoElement.srcObject=i),this._videoTexture||(this._videoTexture=new L8(this._videoElement)),this._videoTexture.flipY=!1,this._videoTexture.colorSpace=ft,t&&this.handleBeginPlaying(t),Br&&console.log("Video: handle playing done...",i,t),!0):(Br&&console.warn("No video source set",this),!1)}updateAspect(){this.aspectMode!==0&&this.startCoroutine(this.updateAspectImpl())}get screenspace(){var t;return((t=this._overlay)==null?void 0:t.enabled)??!1}set screenspace(t){var i;if(t){if(!this._videoTexture)return;this._overlay||(this._overlay=new G3e(this.context)),this._overlay.add(this._videoTexture)}else(i=this._overlay)==null||i.remove(this._videoTexture);this._overlay&&(this._overlay.enabled=t)}createVideoElement(){const t=document.createElement("video");return this._crossOrigin&&t.setAttribute("crossorigin",this._crossOrigin),Br&&console.log("created video element",t),t}handleBeginPlaying(t){var r,o;if(!this.activeAndEnabled||!this._videoElement)return;this._targetObjects.length=0;let i=this.gameObject;switch(this.renderMode){case 3:i=(r=this.targetMaterialRenderer)==null?void 0:r.gameObject,i||(i=(o=$.getComponent(this.gameObject,Es))==null?void 0:o.gameObject);break;case 2:console.error("VideoPlayer renderTexture not implemented yet. Please use material override instead");return}if(!i){console.error("Missing target for video material renderer",this.name,sle[this.renderMode],this);return}const n=i.material;if(n){this._targetObjects.push(i),n!==this._videoMaterial&&(this._videoMaterial=n.clone(),i.material=this._videoMaterial);const a="map",l=this._videoMaterial;if(!this.targetMaterialProperty)l[a]=this._videoTexture;else switch(this.targetMaterialProperty){default:l[a]=this._videoTexture;break}}else{console.warn("Can not play video, no material found, this might be a multimaterial case which is not supported yet");return}this.updateVideoElementSettings(),this.updateVideoElementStyles(),t&&(this.shouldUseM3U&&this.ensureM3UCanBePlayed(),this.play())}updateVideoElementSettings(){if(!this._videoElement)return;this._videoElement.loop=this._isLooping,this._videoElement.currentTime=this.currentTime,this._videoElement.playbackRate=this._playbackSpeed,this._videoElement.playsInline=!0;let t=!this._receivedInput||this.audioOutputMode===0;!t&&this._muted&&(t=!0),this._videoElement.muted=t,this.playOnAwake&&(this._videoElement.autoplay=!0)}updateVideoElementStyles(){this._videoElement&&(this._videoElement.style.userSelect="none",this._videoElement.style.visibility="hidden",this._videoElement.style.display="none",this.updateAspect())}*updateAspectImpl(){const t=++this._updateAspectRoutineId,i=void 0,n=this.clip;for(;t===this._updateAspectRoutineId&&this.aspectMode!==0&&this.clip&&n===this.clip&&this._isPlaying;){if(!n||typeof n=="string")return;let r;for(const o of n.getVideoTracks()){const a=o.getSettings();if(a&&a.width&&a.height){r=a.width/a.height;break}else r=this.context.renderer.domElement.clientWidth/this.context.renderer.domElement.clientHeight}if(r===void 0){for(let o=0;o<10;o++)yield;if(!this.isPlaying)break;continue}if(i===r){yield;continue}for(const o of this._targetObjects){let a=1;if(o.parent){const l=kn(o.parent);a=l.x/l.y}switch(this.aspectMode){case 1:o.scale.y=1/r*o.scale.x*a;break;case 2:o.scale.x=r*o.scale.y*a;break}}for(let o=0;o<3;o++)yield}}get shouldUseM3U(){return this.url!=null&&(this.url.endsWith(".m3u8")||this.url.endsWith(".m3u"))&&this.source===1}ensureM3UCanBePlayed(){if(!this.shouldUseM3U)return;let t=document.head.querySelector("script[data-hls_library]");t?globalThis.Hls?this.onHlsAvailable():t.addEventListener("load",this.onHlsAvailable):(Br&&console.log("HLS: load script"),t=document.createElement("script"),t.dataset.hls_library="hls.js",t.src="https://cdn.jsdelivr.net/npm/hls.js@1",t.addEventListener("load",this.onHlsAvailable),document.head.append(t))}}cc([I()],Sr.prototype,"playOnAwake",2);cc([I()],Sr.prototype,"aspectMode",2);cc([I(URL)],Sr.prototype,"clip",2);cc([I()],Sr.prototype,"source",2);cc([I(URL)],Sr.prototype,"url",1);cc([I()],Sr.prototype,"renderMode",2);cc([I()],Sr.prototype,"targetMaterialProperty",2);cc([I(Es)],Sr.prototype,"targetMaterialRenderer",2);cc([I(si)],Sr.prototype,"targetTexture",2);cc([I()],Sr.prototype,"time",2);cc([I()],Sr.prototype,"playbackSpeed",1);cc([I()],Sr.prototype,"isLooping",1);cc([I()],Sr.prototype,"audioOutputMode",1);class G3e{constructor(e){p(this,"context");p(this,"_videos",[]);p(this,"_screenspaceModeQuad");p(this,"_isInScreenspaceMode",!1);p(this,"_input");this.context=e,this._input=new k3e(this)}get enabled(){return this._isInScreenspaceMode}set enabled(e){e?this.start():this.stop()}add(e){this._videos.indexOf(e)===-1&&this._videos.push(e)}remove(e){if(!e)return;const t=this._videos.indexOf(e);t>=0&&this._videos.splice(t,1)}start(){var n;if(this._isInScreenspaceMode||this._videos.length<0)return;const e=this._videos[this._videos.length-1];if(!e)return;if(this._isInScreenspaceMode=!0,!this._screenspaceModeQuad){if(this._screenspaceModeQuad=zm.createPrimitive($0.Quad,{material:new N3e(e)}),!this._screenspaceModeQuad)return;this._screenspaceModeQuad.geometry.scale(2,2,2)}const t=this._screenspaceModeQuad;this.context.scene.add(t),this.updateScreenspaceMaterialUniforms();const i=t.material;i==null||i.reset(),(n=this._input)==null||n.enable(i)}stop(){var e;this._isInScreenspaceMode=!1,this._screenspaceModeQuad&&((e=this._input)==null||e.disable(),this._screenspaceModeQuad.removeFromParent())}updateScreenspaceMaterialUniforms(){var t;const e=(t=this._screenspaceModeQuad)==null?void 0:t.material;e&&(e.screenAspect=this.context.domElement.clientWidth/this.context.domElement.clientHeight)}}class k3e{constructor(e){p(this,"_onResizeScreenFn");p(this,"_onKeyUpFn");p(this,"_onMouseWheelFn");p(this,"context");p(this,"overlay");p(this,"_material");p(this,"_isPinching",!1);p(this,"_lastPinch",0);this.overlay=e,this.context=e.context}enable(e){this._material=e,window.addEventListener("resize",this._onResizeScreenFn=()=>{this.overlay.updateScreenspaceMaterialUniforms()}),window.addEventListener("keyup",this._onKeyUpFn=n=>{n.key==="Escape"&&this.overlay.stop()}),window.addEventListener("wheel",this._onMouseWheelFn=n=>{this.overlay.enabled&&(e.zoom+=n.deltaY*5e-4,n.preventDefault())},{passive:!1});const t=new Q;window.addEventListener("mousemove",n=>{if(this.overlay.enabled&&this.context.input.getPointerPressed(0)){const r=new Q(n.movementX,n.movementY);r.x/=this.context.domElement.clientWidth,r.y/=this.context.domElement.clientHeight,t.set(r.x,r.y),t.multiplyScalar(e.zoom/-this.context.time.deltaTime*.01),e.offset=e.offset.add(t)}}),window.addEventListener("pointermove",n=>{this.overlay.enabled&&this.context.input.getPointerPressed(0)&&this.context.input.getTouchesPressedCount()===1&&(t.set(n.movementX,n.movementY),t.multiplyScalar(e.zoom*-this.context.time.deltaTime*.05),e.offset=e.offset.add(t))});let i=0;window.addEventListener("touchstart",n=>{if(n.touches.length<2){this.context.time.time-i<.3&&this.overlay.stop(),i=this.context.time.time;return}this._isPinching=!0,this._lastPinch=0}),window.addEventListener("touchmove",n=>{if(!this._isPinching||!this._material)return;const r=n.touches[0],o=n.touches[1],a=r.clientX-o.clientX,l=r.clientY-o.clientY,c=Math.sqrt(a*a+l*l);if(this._lastPinch!==0){const h=c-this._lastPinch;this._material.zoom-=h*.004}this._lastPinch=c}),window.addEventListener("touchend",()=>{this._isPinching=!1})}disable(){this._onResizeScreenFn&&(window.removeEventListener("resize",this._onResizeScreenFn),this._onResizeScreenFn=void 0),this._onKeyUpFn&&(window.removeEventListener("keyup",this._onKeyUpFn),this._onKeyUpFn=void 0),this._onMouseWheelFn&&(window.removeEventListener("wheel",this._onMouseWheelFn),this._onMouseWheelFn=void 0)}}class N3e extends Ht{constructor(t){super();p(this,"_offset",new Q);this.uniforms={map:{value:t},screenAspect:{value:1},offsetScale:{value:new Je(0,0,1,1)}},this.vertexShader=`
        uniform sampler2D map;
        uniform float screenAspect;
        uniform vec4 offsetScale;
        varying vec2 vUv;

        void main() {

            gl_Position = vec4( position , 1.0 );
            vUv = uv;
            vUv.y = 1. - vUv.y;

            // fit into screen
            ivec2 res = textureSize(map, 0);
            float videoAspect = float(res.x) / float(res.y);
            float aspect = videoAspect / screenAspect;
            if(aspect >= 1.0) 
            {
                vUv.y = vUv.y * aspect;
                float offset = (1. - aspect) * .5;
                vUv.y = vUv.y + offset;
            }
            else
            {
                vUv.x = vUv.x / aspect;
                float offset = (1. - 1. / aspect) * .5;
                vUv.x = vUv.x + offset;
            }

            vUv.x -= .5;
            vUv.y -= .5;

            vUv.x *= offsetScale.z;
            vUv.y *= offsetScale.z;
            vUv.x += offsetScale.x;
            vUv.y += offsetScale.y;

            vUv.x += .5;
            vUv.y += .5;
        }

        `,this.fragmentShader=`
        uniform sampler2D map;
        varying vec2 vUv;
        void main() {
            if(vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.)
                gl_FragColor = vec4(0., 0., 0., 1.);
            else
            {
                vec4 texcolor = texture2D(map, vUv);
                texcolor = LinearTosRGB(texcolor);
                gl_FragColor = texcolor;
            }
        }
        `}set screenAspect(t){this.uniforms.screenAspect.value=t,this.needsUpdate=!0}set offset(t){const i=this.uniforms.offsetScale.value;i.x=t.x,i.y=t.y,this.uniforms.offsetScale.value=i,this.needsUpdate=!0}get offset(){const t=this.uniforms.offsetScale.value;return this._offset.set(t.x,t.y),this._offset}set zoom(t){const i=this.uniforms.offsetScale.value;t<.001&&(t=.001),i.z=t,this.needsUpdate=!0}get zoom(){return this.uniforms.offsetScale.value.z}reset(){this.offset=this.offset.set(0,0),this.zoom=1,this.needsUpdate=!0}}var D3e=Object.defineProperty,F3e=Object.getOwnPropertyDescriptor,WM=(s,e,t,i)=>{for(var n=i>1?void 0:i?F3e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&D3e(e,t,n),n};const ro=ee("debugscreensharing");var rle=(s=>(s[s.Screen=0]="Screen",s[s.Camera=1]="Camera",s[s.Canvas=2]="Canvas",s[s.Microphone=3]="Microphone",s))(rle||{});class eg extends ze{constructor(){super(...arguments);p(this,"allowStartOnClick",!0);p(this,"autoConnect",!1);p(this,"_videoPlayer");p(this,"_audioSource");p(this,"device","Screen");p(this,"deviceName");p(this,"deviceFilter");p(this,"_net");p(this,"_requestOpen",!1);p(this,"_currentStream",null);p(this,"_currentMode",0);p(this,"onJoinedRoom",async()=>{await Nh(1e3),this.autoConnect&&!this.isSending&&!this.isReceiving&&this.context.connection.isInRoom&&this.share()});p(this,"_activeShareRequest",null);p(this,"onReceiveStream",t=>{var i;((i=t.stream)==null?void 0:i.active)===!0&&this.setStream(t.stream,2)});p(this,"onCallEnded",t=>{ro&&console.log("CALL ENDED",this.isReceiving,this==null?void 0:this.screenspace),this.isReceiving&&(this.screenspace=!1)})}onPointerEnter(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorPointer()}onPointerExit(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorNormal()}onPointerClick(t){var i;if(this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&!(t&&t.pointerId!==0)){if(this.isReceiving&&((i=this.videoPlayer)!=null&&i.isPlaying)){this.videoPlayer&&(this.videoPlayer.screenspace=!this.videoPlayer.screenspace);return}if(this.isSending){this.close();return}this.share()}}set videoPlayer(t){this._videoPlayer&&(this.isSending||this.isReceiving)&&this._videoPlayer.stop(),this._videoPlayer=t,this._videoPlayer&&this._currentStream&&(this.isSending||this.isReceiving)&&this._videoPlayer.setVideo(this._currentStream)}get videoPlayer(){return this._videoPlayer}get screenspace(){var t;return((t=this.videoPlayer)==null?void 0:t.screenspace)??!1}set screenspace(t){this.videoPlayer&&(this.videoPlayer.screenspace=t)}get currentScream(){return this._currentStream}get currentMode(){return this._currentMode}get isSending(){var t;return((t=this._currentStream)==null?void 0:t.active)&&this._currentMode===1}get isReceiving(){if(this._currentMode===2){if(!this._currentStream||this._currentStream.active===!1)return!1;const t=this._currentStream.getTracks();for(const i of t)if(i.readyState==="live")return!0}return!1}get requiresVideoPlayer(){return this.device!=="Microphone"}awake(){typeof this.device=="number"&&(this.device=rle[this.device]),ro&&console.log("Screensharing",this.name,this),fs.registerWaitForAllowAudio(()=>{this._videoPlayer&&this._currentStream&&this._currentMode===2&&(this._videoPlayer.playInBackground=!0,this._videoPlayer.setVideo(this._currentStream))}),this._net=new wM(this)}onEnable(){var t,i,n;(t=this._net)==null||t.enable(),(i=this._net)==null||i.addEventListener(Bd.StreamReceived,this.onReceiveStream),(n=this._net)==null||n.addEventListener(Bd.StreamEnded,this.onCallEnded),this.context.connection.beginListen(ri.JoinedRoom,this.onJoinedRoom),this.autoConnect&&Nh(1e3).then(()=>(this.enabled&&this.autoConnect&&!this.isReceiving&&!this.isSending&&this.context.connection.isInRoom&&this.share(),0))}onDisable(){var t,i,n;(t=this._net)==null||t.removeEventListener(Bd.StreamReceived,this.onReceiveStream),(i=this._net)==null||i.removeEventListener(Bd.StreamEnded,this.onCallEnded),this.context.connection.stopListen(ri.JoinedRoom,this.onJoinedRoom),(n=this._net)==null||n.disable(),this.close()}_ensureVideoPlayer(){const t=new Sr;t.aspectMode=ile.AdjustWidth,$.addComponent(this.gameObject,t),this._videoPlayer=t}async share(t){return this._activeShareRequest?this._activeShareRequest:(this._activeShareRequest=this.internalShare(t),this._activeShareRequest.then(()=>this._activeShareRequest=null))}async internalShare(t){if(this.context.connection.isInRoom===!1){console.warn("Can not start screensharing: requires network connection"),Qe()&&An("Can not start screensharing: requires network connection. Add a SyncedRoom component or join a room first.");return}if(t!=null&&t.device&&(this.device=t.device),!this.videoPlayer&&this.requiresVideoPlayer&&(this._videoPlayer||(this._videoPlayer=$.getComponent(this.gameObject,Sr)??void 0),this.videoPlayer||this._ensureVideoPlayer(),!this.videoPlayer)){console.warn("Can not share video without a videoPlayer assigned");return}this._requestOpen=!0;try{const i=(t==null?void 0:t.constraints)??{echoCancellation:!0,autoGainControl:!1},n={video:i,audio:i},r=n.video;switch(r!==void 0&&typeof r!="boolean"&&(r.width||(r.width={max:1920}),r.height||(r.height={max:1920}),r.aspectRatio||(r.aspectRatio={ideal:1.7777777778}),r.frameRate||(r.frameRate={ideal:24}),r.facingMode||(r.facingMode={ideal:"user"})),this.device){case"Camera":this.tryShareUserCamera(n,t);break;case"Screen":{if(!navigator.mediaDevices.getDisplayMedia){console.error("No getDisplayMedia support");return}const l=await navigator.mediaDevices.getDisplayMedia(n);this._requestOpen?this.setStream(l,1):Pd(l)}break;case"Canvas":const o=0,a=this.context.renderer.domElement.captureStream(o);this.setStream(a,1);break;case"Microphone":{if(!navigator.mediaDevices.getUserMedia){console.error("No getDisplayMedia support");return}n.video=!1;const l=await navigator.mediaDevices.getUserMedia(n);this._requestOpen?this.setStream(l,1):Pd(l)}break;default:console.error("Can not start screen sharing: Unknown device type",this.device)}}catch(i){if(i.name==="NotAllowedError"){console.log("Selection cancelled"),this._requestOpen=!1;return}console.error("Error opening video",i)}}close(){var t;this._requestOpen=!1,this._currentStream&&(ro&&console.warn("Close current stream / disposing resources, stream was active?",this._currentStream.active),(t=this._net)==null||t.stopSendingStream(this._currentStream),Pd(this._currentStream),this._currentMode=0,this._currentStream=null)}setStream(t,i){var o,a,l;if(t===this._currentStream||(this.close(),!t))return;this._currentStream=t,this._requestOpen=!0,this._currentMode=i;const n=this.device!=="Microphone",r=i===1;n?(this._videoPlayer||this._ensureVideoPlayer(),this._videoPlayer?this._videoPlayer.setVideo(t):console.error("No video player assigned for video stream")):(this._audioSource||(this._audioSource=new fs,this._audioSource.spatialBlend=0,this._audioSource.volume=1,this.gameObject.addComponent(this._audioSource)),r||(ro&&console.log("PLAY",t.getAudioTracks()),this._audioSource.volume=1,(o=this._audioSource)==null||o.play(t))),r&&((a=this._net)==null||a.startSendingStream(t)),r&&(this._videoPlayer&&(this._videoPlayer.muted=!0),(l=this._audioSource)==null||l.stop());for(const c of t.getTracks())c.addEventListener("ended",()=>{ro&&console.log("Track ended",c),this.close()}),ro&&c.kind==="video"&&console.log(r?"Video →":"Video ←",c.getSettings())}async tryShareUserCamera(t,i){const n=(await navigator.mediaDevices.enumerateDevices()).filter(o=>o.kind==="videoinput");ro&&console.log(`Request camera. These are your kind:videoinput devices:
`,n);let r=!1;for(const o of n)try{if(!this._requestOpen){ro&&console.log("Camera selection cancelled");break}if(o.kind!=="videoinput"){ro&&console.log("Skipping non-video device",o);continue}const a=o.deviceId;if((i==null?void 0:i.deviceId)!=null||(i==null?void 0:i.deviceFilter)!=null){if((i==null?void 0:i.deviceId)!==void 0&&a!==i.deviceId){ro&&console.log("Skipping device due to options.deviceId: "+o.label+"; "+o.deviceId);continue}if(i!=null&&i.deviceFilter&&i.deviceFilter(o)===!1){ro&&console.log("Skipping device due to options.deviceFilter: "+o.label+"; "+o.deviceId);continue}}else if(this.deviceFilter)if(this.deviceFilter(o)===!1){ro&&console.log("Skipping device due to ScreenShare.deviceFilter: "+o.label+"; "+o.deviceId);continue}else ro&&console.log("Selected device by filter",o);else if(this.deviceName){const h=o.label.toLowerCase(),d=this.deviceName.toLowerCase(),u=h.includes(d),f=o.deviceId===this.deviceName;if(!u&&!f){ro&&console.log("Skipping device due to ScreenShare.deviceName: "+o.label+"; "+o.deviceId);continue}else ro&&console.log("Selected device by name",o)}t.video!==!1&&((typeof t.video>"u"||typeof t.video=="boolean")&&(t.video={}),t.video.deviceId=a),r=!0;const c=await navigator.mediaDevices.getUserMedia(t).catch(h=>(console.error("Failed to get user media",h),null));if(c===null)continue;this._requestOpen?(this.setStream(c,1),ro&&console.log("Selected camera",o)):(Pd(c),ro&&console.log("Camera selection cancelled"));break}catch(a){if(a.message==="Failed to allocate videosource"||a.message==="Could not start video source"){An("Failed to start video: Try another camera (Code "+a.code+")"),console.warn(a);continue}else console.error("Failed to get user media",a.message,a.code,a)}!r&&Qe()&&(An("No camera found for sharing. Please connect a camera (see console for more information)"),console.warn("No camera found for sharing. Please connect a camera",n,this.deviceName,"Using deviceFilter? "+this.deviceFilter!=null,"Using options? "+i!=null,"Using deviceName? "+this.deviceName!=null,"Using options.deviceId? "+(i==null?void 0:i.deviceId)!=null,"Using options.deviceFilter? "+(i==null?void 0:i.deviceFilter)!=null))}}WM([I()],eg.prototype,"allowStartOnClick",2);WM([I()],eg.prototype,"autoConnect",2);WM([I(Sr)],eg.prototype,"videoPlayer",1);WM([I()],eg.prototype,"device",2);WM([I()],eg.prototype,"deviceName",2);var V3e=Object.defineProperty,z3e=Object.getOwnPropertyDescriptor,HM=(s,e,t,i)=>{for(var n=i>1?void 0:i?z3e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&V3e(e,t,n),n};class Up extends jr{constructor(){super(...arguments);p(this,"intensity",new rt(2));p(this,"falloff",new rt(1));p(this,"samples",new rt(9));p(this,"color",new rt(new ge(0,0,0)));p(this,"luminanceInfluence",new rt(.7));p(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusion"}onBeforeRender(){if(this._ssao&&this.context.mainCamera instanceof Xt){const t=this.context.mainCamera.far-this.context.mainCamera.near;this._ssao.ssaoMaterial.worldDistanceFalloff=t*.01,this._ssao.ssaoMaterial.worldDistanceThreshold=this.context.mainCamera.far}}onCreateEffect(){const t=this.context.mainCamera,i=new ene(this.context.scene,t),n=new TO({normalBuffer:i.texture,resolutionScale:.5}),r=this._ssao=new jie(t,i.texture,{normalDepthBuffer:n.texture,worldDistanceThreshold:1,worldDistanceFalloff:1,worldProximityThreshold:.1,worldProximityFalloff:2,intensity:1,blendFunction:ai.MULTIPLY,luminanceInfluence:.5});this.intensity.onValueChanged=a=>{r.intensity=a},this.falloff.onValueChanged=a=>{r.ssaoMaterial.radius=a*.1},this.samples.onValueChanged=a=>{r.ssaoMaterial.samples=a},this.color.onValueChanged=a=>{r.color||(r.color=new ge),r.color.copy(a)},this.luminanceInfluence.onValueChanged=a=>{r.luminanceInfluence=a};const o=new Array;return o.push(i),o.push(n),o.push(r),o}}HM([I(rt)],Up.prototype,"intensity",2);HM([I(rt)],Up.prototype,"falloff",2);HM([I(rt)],Up.prototype,"samples",2);HM([I(rt)],Up.prototype,"color",2);HM([I(rt)],Up.prototype,"luminanceInfluence",2);Kc("ScreenSpaceAmbientOcclusion",Up);var U3e=Object.defineProperty,X3e=Object.getOwnPropertyDescriptor,XA=(s,e,t,i)=>{for(var n=i>1?void 0:i?X3e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&U3e(e,t,n),n},Yz=(s=>(s[s.Performance=0]="Performance",s[s.Low=1]="Low",s[s.Medium=2]="Medium",s[s.High=3]="High",s[s.Ultra=4]="Ultra",s))(Yz||{});class Kh extends jr{constructor(){super(...arguments);p(this,"gammaCorrection",!0);p(this,"aoRadius",new rt(1));p(this,"falloff",new rt(1));p(this,"intensity",new rt(1));p(this,"color",new rt(new ge(0,0,0)));p(this,"screenspaceRadius",!1);p(this,"quality",2);p(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusionN8"}onValidate(){this._ssao&&(this._ssao.setQualityMode(Yz[this.quality]),this._ssao.configuration.gammaCorrection=this.gammaCorrection,this._ssao.configuration.screenSpaceRadius=this.screenspaceRadius)}onCreateEffect(){const t=this.context.mainCamera,i=this._ssao=new Nae(this.context.scene,t,this.context.domWidth,this.context.domHeight),n=Yz[this.quality];i.setQualityMode(n),i.configuration.gammaCorrection=this.gammaCorrection,i.configuration.screenSpaceRadius=this.screenspaceRadius,this.intensity.onValueChanged=o=>{i.configuration.intensity=o},this.falloff.onValueChanged=o=>{i.configuration.distanceFalloff=o},this.aoRadius.onValueChanged=o=>{i.configuration.aoRadius=o},this.color.onValueChanged=o=>{i.color||(i.color=new ge),i.configuration.color.copy(o)};const r=new Array;return r.push(i),r}}XA([ko(),I()],Kh.prototype,"gammaCorrection",2);XA([I(rt)],Kh.prototype,"aoRadius",2);XA([I(rt)],Kh.prototype,"falloff",2);XA([I(rt)],Kh.prototype,"intensity",2);XA([I(rt)],Kh.prototype,"color",2);XA([ko(),I()],Kh.prototype,"screenspaceRadius",2);XA([ko(),I()],Kh.prototype,"quality",2);Kc("ScreenSpaceAmbientOcclusionN8",Kh);var O3e=Object.defineProperty,Z3e=Object.getOwnPropertyDescriptor,ole=(s,e,t,i)=>{for(var n=i>1?void 0:i?Z3e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&O3e(e,t,n),n};class QM extends ze{constructor(){super(...arguments);p(this,"mode",0);p(this,"shadowColor",new hn(0,0,0,1));p(this,"targetMesh")}start(){if(this.gameObject instanceof fe)this.gameObject instanceof fe&&this.gameObject.material&&(this.gameObject.material=this.gameObject.material.clone(),this.targetMesh=this.gameObject,this.targetMesh.receiveShadow=!0);else{const t=zm.createPrimitive($0.Quad,{name:"ShadowCatcher",material:new Us({color:10066329,roughness:1,metalness:0,transparent:!0})});t.receiveShadow=!0,t.geometry.rotateX(-Math.PI/2),this.gameObject.add(t),this.targetMesh=t}if(!this.targetMesh){console.warn("ShadowCatcher: no mesh to apply shadow catching to. Groups are currently not supported.");return}switch(this.targetMesh.layers.set(2),this.mode){case 0:this.applyShadowMaterial();break;case 1:this.applyLightBlendMaterial();break;case 2:this.applyOccluderMaterial();break}}applyLightBlendMaterial(){if(!this.targetMesh)return;const t=this.targetMesh.material;t.blending=sm,this.applyMaterialOptions(t),t.onBeforeCompile=i=>{i.fragmentShader=i.fragmentShader.replace("vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;",`vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
            // diffuse-only lighting with overdrive to somewhat compensate
            // for the loss of indirect lighting and to make it more visible.
            vec3 direct = (reflectedLight.directDiffuse + reflectedLight.directSpecular) * 6.6;
            float max = max(direct.r, max(direct.g, direct.b));
            
            // early out - we're simply returning direct lighting and some alpha based on it so it can 
            // be blended onto the scene.
            gl_FragColor = vec4(direct, max);
            return;
            `)},t.userData.isLightBlendMaterial=!0}applyShadowMaterial(){if(this.targetMesh)if(this.targetMesh.material.type!=="ShadowMaterial"){const t=new M1;t.color=this.shadowColor,t.opacity=this.shadowColor.alpha,this.applyMaterialOptions(t),this.targetMesh.material=t,t.userData.isShadowCatcherMaterial=!0}else{const t=this.targetMesh.material;t.color=this.shadowColor,t.opacity=this.shadowColor.alpha,this.applyMaterialOptions(t),t.userData.isShadowCatcherMaterial=!0}}applyOccluderMaterial(){if(this.targetMesh){let t=this.targetMesh.material;if(!t){const i=new ii;this.targetMesh.material=i,t=i}t.depthWrite=!0,t.stencilWrite=!0,t.colorWrite=!1,this.gameObject.renderOrder=-100}}applyMaterialOptions(t){t&&(t.depthWrite=!1,t.stencilWrite=!1)}}ole([I()],QM.prototype,"mode",2);ole([I(hn)],QM.prototype,"shadowColor",2);var W3e=Object.defineProperty,H3e=Object.getOwnPropertyDescriptor,nG=(s,e,t,i)=>{for(var n=i>1?void 0:i?H3e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&W3e(e,t,n),n},PF;const ale=(PF=class extends ze{constructor(){super(...arguments);p(this,"target",null);p(this,"followFactor",.1);p(this,"rotateFactor",.1);p(this,"positionAxes",Gb.All);p(this,"flipForward",!1);p(this,"_firstUpdate",!0)}onBeforeRender(){this.updateNow(!1)}updateNow(e){if(!(!this.target||this.target===this.gameObject)){if(this.followFactor>0){const t=$t(this.target),i=this._firstUpdate||e?1:lt.clamp01(this.context.time.deltaTime*this.followFactor),n=this.worldPosition;this.positionAxes&Gb.X&&(n.x=lt.lerp(n.x,t.x,i)),this.positionAxes&Gb.Y&&(n.y=lt.lerp(n.y,t.y,i)),this.positionAxes&Gb.Z&&(n.z=lt.lerp(n.z,t.z,i)),this.worldPosition=n}if(this.rotateFactor>0){const t=gn(this.target);this.flipForward&&t.premultiply(ale._invertForward);const i=this._firstUpdate||e?1:lt.clamp01(this.context.time.deltaTime*this.rotateFactor);this.worldQuaternion=this.worldQuaternion.slerp(t,i)}this._firstUpdate=!1}}},p(PF,"_invertForward",new Ve().setFromAxisAngle(new T(0,1,0),Math.PI)),PF);let tg=ale;nG([I(ye)],tg.prototype,"target",2);nG([I()],tg.prototype,"followFactor",2);nG([I()],tg.prototype,"rotateFactor",2);nG([I()],tg.prototype,"positionAxes",2);class Q3e extends fe{constructor(e){const t=new K3e(e),i=new Rs(t.image.width*.001,t.image.height*.001),n=new ii({map:t,toneMapped:!1,transparent:!0});super(i,n);function r(o){n.map.dispatchDOMEvent(o)}this.addEventListener("mousedown",r),this.addEventListener("mousemove",r),this.addEventListener("mouseup",r),this.addEventListener("click",r),this.dispose=function(){i.dispose(),n.dispose(),n.map.dispose(),Jz.delete(e),this.removeEventListener("mousedown",r),this.removeEventListener("mousemove",r),this.removeEventListener("mouseup",r),this.removeEventListener("click",r)}}}class K3e extends HU{constructor(e){super(hJ(e)),this.dom=e,this.anisotropy=16,this.colorSpace=ft,this.minFilter=Ot,this.magFilter=Ot;const t=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),i={attributes:!0,childList:!0,subtree:!0,characterData:!0};t.observe(e,i),this.observer=t}dispatchDOMEvent(e){e.data&&Y3e(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=hJ(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const Jz=new WeakMap;function hJ(s){const e=document.createRange(),t=new ge;function i(u){const f=[];let m=!1;function g(){if(m&&(m=!1,u.restore()),f.length===0)return;let A=-1/0,y=-1/0,b=1/0,x=1/0;for(let v=0;v<f.length;v++){const _=f[v];A=Math.max(A,_.x),y=Math.max(y,_.y),b=Math.min(b,_.x+_.width),x=Math.min(x,_.y+_.height)}u.save(),u.beginPath(),u.rect(A,y,b-A,x-y),u.clip(),m=!0}return{add:function(A){f.push(A),g()},remove:function(){f.pop(),g()}}}function n(u,f,m,g){g!==""&&(u.textTransform==="uppercase"&&(g=g.toUpperCase()),h.font=u.fontWeight+" "+u.fontSize+" "+u.fontFamily,h.textBaseline="top",h.fillStyle=u.color,h.fillText(g,f,m+parseFloat(u.fontSize)*.1))}function r(u,f,m,g,A){m<2*A&&(A=m/2),g<2*A&&(A=g/2),h.beginPath(),h.moveTo(u+A,f),h.arcTo(u+m,f,u+m,f+g,A),h.arcTo(u+m,f+g,u,f+g,A),h.arcTo(u,f+g,u,f,A),h.arcTo(u,f,u+m,f,A),h.closePath()}function o(u,f,m,g,A,y){const b=u[f+"Width"],x=u[f+"Style"],v=u[f+"Color"];b!=="0px"&&x!=="none"&&v!=="transparent"&&v!=="rgba(0, 0, 0, 0)"&&(h.strokeStyle=v,h.lineWidth=parseFloat(b),h.beginPath(),h.moveTo(m,g),h.lineTo(m+A,g+y),h.stroke())}function a(u,f){if(u.nodeType===Node.COMMENT_NODE||u.nodeName==="SCRIPT"||u.style&&u.style.display==="none")return;let m=0,g=0,A=0,y=0;if(u.nodeType===Node.TEXT_NODE){e.selectNode(u);const x=e.getBoundingClientRect();m=x.left-l.left-.5,g=x.top-l.top-.5,A=x.width,y=x.height,n(f,m,g,u.nodeValue.trim())}else if(u instanceof HTMLCanvasElement){const x=u.getBoundingClientRect();m=x.left-l.left-.5,g=x.top-l.top-.5,h.save();const v=window.devicePixelRatio;h.scale(1/v,1/v),h.drawImage(u,m,g),h.restore()}else if(u instanceof HTMLImageElement){const x=u.getBoundingClientRect();m=x.left-l.left-.5,g=x.top-l.top-.5,A=x.width,y=x.height,h.drawImage(u,m,g,A,y)}else{const x=u.getBoundingClientRect();m=x.left-l.left-.5,g=x.top-l.top-.5,A=x.width,y=x.height,f=window.getComputedStyle(u),r(m,g,A,y,parseFloat(f.borderRadius));const v=f.backgroundColor;v!=="transparent"&&v!=="rgba(0, 0, 0, 0)"&&(h.fillStyle=v,h.fill());const _=["borderTop","borderLeft","borderBottom","borderRight"];let C=!0,S=null;for(const M of _){if(S!==null&&(C=f[M+"Width"]===f[S+"Width"]&&f[M+"Color"]===f[S+"Color"]&&f[M+"Style"]===f[S+"Style"]),C===!1)break;S=M}if(C===!0){const M=parseFloat(f.borderTopWidth);f.borderTopWidth!=="0px"&&f.borderTopStyle!=="none"&&f.borderTopColor!=="transparent"&&f.borderTopColor!=="rgba(0, 0, 0, 0)"&&(h.strokeStyle=f.borderTopColor,h.lineWidth=M,h.stroke())}else o(f,"borderTop",m,g,A,0),o(f,"borderLeft",m,g,0,y),o(f,"borderBottom",m,g+y,A,0),o(f,"borderRight",m+A,g,0,y);if(u instanceof HTMLInputElement){let M=f.accentColor;(M===void 0||M==="auto")&&(M=f.color),t.set(M);const w=Math.sqrt(.299*t.r**2+.587*t.g**2+.114*t.b**2)<.5?"white":"#111111";if(u.type==="radio"&&(r(m,g,A,y,y),h.fillStyle="white",h.strokeStyle=M,h.lineWidth=1,h.fill(),h.stroke(),u.checked&&(r(m+2,g+2,A-4,y-4,y),h.fillStyle=M,h.strokeStyle=w,h.lineWidth=2,h.fill(),h.stroke())),u.type==="checkbox"&&(r(m,g,A,y,2),h.fillStyle=u.checked?M:"white",h.strokeStyle=u.checked?w:M,h.lineWidth=1,h.stroke(),h.fill(),u.checked)){const E=h.textAlign;h.textAlign="center";const B={color:w,fontFamily:f.fontFamily,fontSize:y+"px",fontWeight:"bold"};n(B,m+A/2,g,"✔"),h.textAlign=E}if(u.type==="range"){const[E,B,P]=["min","max","value"].map(X=>parseFloat(u[X])),k=(P-E)/(B-E)*(A-y);r(m,g+y/4,A,y/2,y/4),h.fillStyle=w,h.strokeStyle=M,h.lineWidth=1,h.fill(),h.stroke(),r(m,g+y/4,k+y/2,y/2,y/4),h.fillStyle=M,h.fill(),r(m+k,g,y,y,y/2),h.fillStyle=M,h.fill()}(u.type==="color"||u.type==="text"||u.type==="number")&&(d.add({x:m,y:g,width:A,height:y}),n(f,m+parseInt(f.paddingLeft),g+parseInt(f.paddingTop),u.value),d.remove())}}const b=f.overflow==="auto"||f.overflow==="hidden";b&&d.add({x:m,y:g,width:A,height:y});for(let x=0;x<u.childNodes.length;x++)a(u.childNodes[x],f);b&&d.remove()}const l=s.getBoundingClientRect();let c=Jz.get(s);c===void 0&&(c=document.createElement("canvas"),c.width=l.width,c.height=l.height,Jz.set(s,c));const h=c.getContext("2d"),d=new i(h);return h.clearRect(0,0,c.width,c.height),a(s),c}function Y3e(s,e,t,i){const n={clientX:t*s.offsetWidth+s.offsetLeft,clientY:i*s.offsetHeight+s.offsetTop,view:s.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(e,n));const r=s.getBoundingClientRect();t=t*r.width+r.left,i=i*r.height+r.top;function o(a){if(a.nodeType!==Node.TEXT_NODE&&a.nodeType!==Node.COMMENT_NODE){const l=a.getBoundingClientRect();if(t>l.left&&t<l.right&&i>l.top&&i<l.bottom&&(a.dispatchEvent(new MouseEvent(e,n)),a instanceof HTMLInputElement&&a.type==="range"&&(e==="mousedown"||e==="click"))){const[c,h]=["min","max"].map(m=>parseFloat(a[m])),d=l.width,f=(t-l.x)/d;a.value=c+(h-c)*f,a.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let c=0;c<a.childNodes.length;c++)o(a.childNodes[c])}}o(s)}const KR=new Q,zy={type:"",data:KR},dJ=new Em;class J3e extends Ms{listenToPointerEvents(e,t){const i=this,n=new Em,r=e.domElement;function o(a){a.stopPropagation();const l=e.domElement.getBoundingClientRect();KR.x=(a.clientX-l.left)/l.width*2-1,KR.y=-(a.clientY-l.top)/l.height*2+1,n.setFromCamera(KR,t);const c=n.intersectObjects(i.children,!1);if(c.length>0){const h=c[0],d=h.object,u=h.uv;zy.type=a.type,zy.data.set(u.x,1-u.y),d.dispatchEvent(zy)}}r.addEventListener("pointerdown",o),r.addEventListener("pointerup",o),r.addEventListener("pointermove",o),r.addEventListener("mousedown",o),r.addEventListener("mouseup",o),r.addEventListener("mousemove",o),r.addEventListener("click",o)}listenToXRControllerEvents(e){const t=this,i={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"};function n(r){const o=r.target;dJ.setFromXRController(o);const a=dJ.intersectObjects(t.children,!1);if(a.length>0){const l=a[0],c=l.object,h=l.uv;zy.type=i[r.type],zy.data.set(h.x,1-h.y),c.dispatchEvent(zy)}}e.addEventListener("move",n),e.addEventListener("select",n),e.addEventListener("selectstart",n),e.addEventListener("selectend",n)}}var j3e=Object.defineProperty,q3e=Object.getOwnPropertyDescriptor,lle=(s,e,t,i)=>{for(var n=i>1?void 0:i?q3e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&j3e(e,t,n),n};class KM extends ze{constructor(){super(...arguments);p(this,"id",null);p(this,"keepAspect",!1);p(this,"_object",null)}onEnable(){if(this._object){this.gameObject.add(this._object);return}if(!this.id||!this.context.mainCamera)return;const t=document.getElementById(this.id);if(!t){console.warn('Could not find element with id "'+this.id+'"');return}t.style.display="block",t.style.visibility="hidden";const i=new J3e;i.listenToPointerEvents(this.context.renderer,this.context.mainCamera),this.gameObject.add(i);const n=new Q3e(t);i.add(n),n.visible=!1;const r=n.material;r.transparent=!0,setTimeout(()=>{n.visible=!0;const o=$1(this.gameObject).clone();eM(this.gameObject,0,0,0),this.gameObject.updateMatrixWorld();const a=new oi;a.setFromObject(i),this.setWorldRotation(o.x,o.y,o.z);const l=a.max.x-a.min.x,c=a.max.y-a.min.y;if(this.keepAspect){const d=l/c;l>c?n.scale.set(1/l,1/c/d,1):n.scale.set(1/l*d,1/c,1)}else n.scale.set(1/l,1/c,1);const h=this.gameObject.scale;n.scale.multiply(h)},1)}onDisable(){var t;(t=this._object)==null||t.removeFromParent()}}lle([I()],KM.prototype,"id",2);lle([I()],KM.prototype,"keepAspect",2);var $3e=Object.defineProperty,eOe=Object.getOwnPropertyDescriptor,YM=(s,e,t,i)=>{for(var n=i>1?void 0:i?eOe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&$3e(e,t,n),n};const pw=ee("debugspatialtrigger"),uJ=new ta,pJ=new ta;function tOe(s,e){return uJ.mask=s,pJ.mask=e,uJ.test(pJ)}class Hd extends ze{constructor(){super(...arguments);p(this,"triggerMask",0);p(this,"onEnter");p(this,"onStay");p(this,"onExit");p(this,"currentIntersected",[]);p(this,"lastIntersected",[])}start(){pw&&console.log(this.name,this.triggerMask,this)}update(){this.currentIntersected.length=0;for(const t of JM.triggers)tOe(t.triggerMask,this.triggerMask)&&t.test(this.gameObject)&&this.currentIntersected.push(t);for(let t=this.lastIntersected.length-1;t>=0;t--){const i=this.lastIntersected[t];this.currentIntersected.indexOf(i)<0&&(this.onExitTrigger(i),this.lastIntersected.splice(t,1))}for(const t of this.currentIntersected)this.lastIntersected.indexOf(t)<0&&this.onEnterTrigger(t),this.onStayTrigger(t);this.lastIntersected.length=0,this.lastIntersected.push(...this.currentIntersected)}onEnterTrigger(t){var i;pw&&console.log("ENTER TRIGGER",this.name,t.name,this,t),t.raiseOnEnterEvent(this),(i=this.onEnter)==null||i.invoke(this,t)}onExitTrigger(t){var i;pw&&console.log("EXIT TRIGGER",this.name,t.name,this,t),t.raiseOnExitEvent(this),(i=this.onExit)==null||i.invoke(this,t)}onStayTrigger(t){var i;t.raiseOnStayEvent(this),(i=this.onStay)==null||i.invoke(this,t)}}YM([I()],Hd.prototype,"triggerMask",2);YM([I(Tn)],Hd.prototype,"onEnter",2);YM([I(Tn)],Hd.prototype,"onStay",2);YM([I(Tn)],Hd.prototype,"onExit",2);var GF;const YR=(GF=class extends ze{constructor(){super(...arguments);p(this,"triggerMask");p(this,"boxHelper")}start(){pw&&console.log(this.name,this.triggerMask,this)}onEnable(){var e;YR.triggers.push(this),this.boxHelper||(this.boxHelper=$.addComponent(this.gameObject,il),(e=this.boxHelper)==null||e.showHelper(null,pw))}onDisable(){YR.triggers.splice(YR.triggers.indexOf(this),1)}test(e){return this.boxHelper?this.boxHelper.isInBox(e)??!1:!1}raiseOnEnterEvent(e){$.foreachComponent(this.gameObject,t=>{t!==e&&t instanceof Hd&&t.onEnterTrigger(this)},!1)}raiseOnStayEvent(e){$.foreachComponent(this.gameObject,t=>{t!==e&&t instanceof Hd&&t.onStayTrigger(this)},!1)}raiseOnExitEvent(e){$.foreachComponent(this.gameObject,t=>{t!==e&&t instanceof Hd&&t.onExitTrigger(this)},!1)}},p(GF,"triggers",[]),GF);let JM=YR;YM([I()],JM.prototype,"triggerMask",2);var iOe=Object.defineProperty,nOe=Object.getOwnPropertyDescriptor,sOe=(s,e,t,i)=>{for(var n=i>1?void 0:i?nOe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&iOe(e,t,n),n};const Fl=ee("debugspectator");class sG extends ze{constructor(){super(...arguments);p(this,"cam",null);p(this,"useKeys",!0);p(this,"_mode",0);p(this,"orbit",null);p(this,"_handler");p(this,"eventSub_WebXRRequestStartEvent",null);p(this,"eventSub_WebXRStartEvent",null);p(this,"eventSub_WebXREndEvent",null);p(this,"_debug");p(this,"_networking")}get mode(){return this._mode}set mode(t){this._mode=t}get isSpectating(){var t;return((t=this._handler)==null?void 0:t.currentTarget)!==void 0}isSpectatingUser(t){var i;return((i=this.target)==null?void 0:i.userId)===t}isFollowedBy(t){var i;return(i=this.followers)==null?void 0:i.includes(t)}get followers(){return this._networking.followers}stopSpectating(){if(this.context.isInXR){this.followSelf();return}this.target=void 0}get localId(){return this.context.connection.connectionId??"local"}set target(t){var i;if(this._handler){const n=(i=this._handler.currentTarget)==null?void 0:i.userId,r=this.context.players.getPlayerView(this.localId);t===void 0||this.context.isInXR===!1&&(r==null?void 0:r.currentObject)===t.currentObject?this._handler.currentTarget!==void 0&&(this._handler.disable(),$.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),this._networking.onSpectatedObjectChanged(t,n)):this._handler.currentTarget!==t&&(this._handler.set(t),$.setActive(this.gameObject,!0),this.orbit&&(this.orbit.enabled=!1),this._networking.onSpectatedObjectChanged(t,n))}}get target(){var t;return(t=this._handler)==null?void 0:t.currentTarget}requestAllFollowMe(){this._networking.onRequestFollowMe()}get isSpectatingSelf(){var t,i;return this.isSpectating&&((t=this.target)==null?void 0:t.currentObject)===((i=this.context.players.getPlayerView(this.localId))==null?void 0:i.currentObject)}awake(){if(this._debug=new aOe(this.context,this),this._networking=new hOe(this.context,this),this._networking.awake(),$.setActive(this.gameObject,!1),this.cam=$.getComponent(this.gameObject,Cn),!this.cam){console.warn("SpectatorCamera: Spectator camera needs camera component on the same object.",this);return}!this._handler&&this.cam&&(this._handler=new rOe(this.context,this.cam,this)),this.orbit=$.getComponent(this.context.mainCamera,on)}onDestroy(){var t,i;this.stopSpectating(),(t=this._handler)==null||t.destroy(),(i=this._networking)==null||i.destroy()}isSupportedPlatform(){const t=window.navigator.userAgent,i=/Windows|MacOS/.test(t),n=/Windows NT/.test(t)&&/Edg/.test(t)&&!/Win64/.test(t);return i&&!n}onBeforeXR(t){this.isSupportedPlatform()&&$.setActive(this.gameObject,!0)}onEnterXR(t){this.isSupportedPlatform()&&(Fl&&console.log(this.context.mainCamera),this.context.mainCamera&&this.followSelf())}onLeaveXR(t){var i,n;this.context.removeCamera(this.cam),$.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),(i=this._handler)==null||i.set(void 0),(n=this._handler)==null||n.disable(),this.isSpectatingSelf&&this.stopSpectating()}followSelf(){this.target=this.context.players.getPlayerView(this.context.connection.connectionId),this.target||(this.context.players.setPlayerView(this.localId,this.context.mainCamera,Kf.Headset),this.target=this.context.players.getPlayerView(this.localId)),Fl&&console.log("Follow self",this.target)}onAfterRender(){var h,d,u;if(!this.cam)return;const t=this.context.renderer,i=t.xr.enabled;if(!t.xr.isPresenting&&!((h=this._handler)!=null&&h.currentTarget))return;(d=this._handler)==null||d.update(this._mode);const n=t.getRenderTarget();let r=null;const o=t.state;if(!n){if(!t.state.bindFramebuffer||!o.bindXRFramebuffer)return;r=t._framebuffer,o.bindXRFramebuffer(null)}this.setAvatarFlagsBeforeRender();const a=this.context.mainCameraComponent;if(a){const f=a.backgroundColor;f&&t.setClearColor(f,f.alpha),this.cam.backgroundColor=f,this.cam.clearFlags=a.clearFlags,this.cam.nearClipPlane=a.nearClipPlane,this.cam.farClipPlane=a.farClipPlane}else t.setClearColor(new ge(1,1,1));t.setRenderTarget(null),t.xr.enabled=!1;const l=(u=this.cam)==null?void 0:u.threeCamera;this.context.updateAspect(l);const c=t.xr.isPresenting;t.xr.isPresenting=!1,t.setSize(this.context.domWidth,this.context.domHeight),t.render(this.context.scene,l),t.xr.isPresenting=c,t.xr.enabled=i,n?t.setRenderTarget(n):o.bindXRFramebuffer&&o.bindXRFramebuffer(r),this.resetAvatarFlags()}setAvatarFlagsBeforeRender(){const t=this._mode===0;for(const i of br.instances)if(i.avatar&&"isLocalAvatar"in i.avatar&&"flags"in i.avatar){let n=wd.All;this.isSpectatingSelf&&(n=t&&i.avatar.isLocalAvatar?wd.FirstPerson:wd.ThirdPerson);const r=i.avatar.flags;if(!r)continue;for(const o of r)o.UpdateVisible(n)}}resetAvatarFlags(){var t;for(const i of br.instances)if(i.avatar&&"flags"in i.avatar){const n=i.avatar.flags;if(!n)continue;for(const r of n)"isLocalAvatar"in i.avatar&&((t=i.avatar)!=null&&t.isLocalAvatar)?r.UpdateVisible(wd.FirstPerson):r.UpdateVisible(wd.ThirdPerson)}}}sOe([I()],sG.prototype,"useKeys",2);class rOe{constructor(e,t,i){p(this,"context");p(this,"cam");p(this,"spectator");p(this,"follow");p(this,"target");p(this,"view");p(this,"currentObject");this.context=e,this.cam=t,this.spectator=i}get currentTarget(){return this.view}set(e){const t=e==null?void 0:e.currentObject;if(!t){this.spectator.stopSpectating();return}t!==this.currentObject&&(this.currentObject=t,this.view=e,this.follow||(this.follow=$.addComponent(this.cam.gameObject,tg)),this.target||(this.target=new ye),t.add(this.target),this.follow.enabled=!0,this.follow.target=this.target,Fl&&console.log("FOLLOW",t),this.context.isInXR?this.context.removeCamera(this.cam):this.context.setCurrentCamera(this.cam))}disable(){Fl&&console.log("STOP FOLLOW",this.currentObject),this.view=void 0,this.currentObject=void 0,this.context.removeCamera(this.cam),this.follow&&(this.follow.enabled=!1)}destroy(){var e;(e=this.target)==null||e.removeFromParent(),this.follow&&$.destroy(this.follow)}update(e){var n,r,o,a,l,c;if(((n=this.currentTarget)==null?void 0:n.isConnected)===!1||((r=this.currentTarget)==null?void 0:r.removed)===!0){Fl&&console.log("Target disconnected or timeout",this.currentTarget),this.spectator.stopSpectating();return}this.currentTarget&&((o=this.currentTarget)==null?void 0:o.currentObject)!==this.currentObject&&(Fl&&console.log("Target changed",this.currentObject,"to",this.currentTarget.currentObject),this.set(this.currentTarget));const t=this.context.mainCamera;if(t){const h=this.cam.threeCamera;(h.near!==t.near||h.far!==t.far)&&(h.near=t.near,h.far=t.far,h.updateProjectionMatrix())}const i=(a=this.follow)==null?void 0:a.target;if(!(!i||!this.follow)){switch(e){case 0:((l=this.view)==null?void 0:l.viewDevice)!==Kf.Browser?(this.follow.followFactor=5,this.follow.rotateFactor=5):(this.follow.followFactor=50,this.follow.rotateFactor=50),i.position.set(0,0,0);break;case 1:this.follow.followFactor=3,this.follow.rotateFactor=2,i.position.set(0,.5,1.5);break}this.follow.flipForward=!1,((c=this.view)==null?void 0:c.viewDevice)!==Kf.Browser?i.quaternion.copy(oOe):i.quaternion.identity()}}}const oOe=new Ve().setFromAxisAngle(new T(0,1,0),Math.PI);class aOe{constructor(e,t){p(this,"context");p(this,"spectator");this.context=e,this.spectator=t,console.log("[Spectator Camera] Click other avatars or cameras to follow them. Press ESC to exit spectator mode."),this.context.domElement.addEventListener("keydown",n=>{if(!this.spectator.useKeys)return;n.key==="Escape"&&this.spectator.stopSpectating()});let i=0;this.context.input.addEventListener(es.PointerDown,n=>{i=this.context.time.time}),this.context.input.addEventListener(es.PointerUp,n=>{const r=this.context.time.time-i;r>1?this.spectator.stopSpectating():this.context.input.getPointerClicked(0)&&r<.3&&this.trySelectObject()})}trySelectObject(){const e=new qd;e.setMask(16777215);const t=this.context.physics.raycast(e);if(Fl&&console.log(...t),t!=null&&t.length)for(const i of t){if(i.distance<.2)continue;const n=i.object,r=$.getComponentInParent(n,br),o=r==null?void 0:r.connectionId;if(o){const a=this.context.players.getPlayerView(o);this.spectator.target=a,Fl&&console.log("spectate",o,r);break}}}}class lOe{constructor(e,t,i){p(this,"guid");p(this,"dontSave",!0);p(this,"targetUserId");p(this,"stoppedFollowing");this.guid=e,this.targetUserId=t,this.stoppedFollowing=i}}class cOe{constructor(e,t){p(this,"guid");p(this,"userId");this.guid=e.guid,this.userId=t}}class hOe{constructor(e,t){p(this,"followers",[]);p(this,"context");p(this,"spectator");p(this,"_followerEventMethod");p(this,"_requestFollowMethod");p(this,"_joinedRoomMethod");p(this,"_lastRequestFollowUser");p(this,"_enforceFollowInterval");this.context=e,this.spectator=t,this._followerEventMethod=this.onFollowerEvent.bind(this),this._requestFollowMethod=this.onRequestFollowEvent.bind(this),this._joinedRoomMethod=this.onUserJoinedRoom.bind(this)}awake(){this.context.connection.beginListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.beginListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.beginListen(ri.JoinedRoom,this._joinedRoomMethod),this.context.domElement.addEventListener("keydown",e=>{this.spectator.useKeys&&(e.key==="f"?this.onRequestFollowMe():e.key==="Escape"&&this.onRequestFollowMe(!0))})}destroy(){this.context.connection.stopListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.stopListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.stopListen(ri.JoinedRoom,this._joinedRoomMethod)}onSpectatedObjectChanged(e,t){if(Fl&&console.log(this.context.connection.connectionId,"onSpectatedObjectChanged",e,t),this.context.connection.connectionId){const i=(e==null?void 0:e.userId)===void 0,n=i?t:e==null?void 0:e.userId,r=new lOe(this.context.connection.connectionId,n,i);this.context.connection.send("spectator-follower-changed",r)}}onRequestFollowMe(e=!1){if(Fl&&console.log("Request follow",this.context.connection.connectionId),this.context.connection.connectionId){this.spectator.stopSpectating();const t=e?void 0:this.context.connection.connectionId,i=new cOe(this.spectator,t);this.context.connection.send("spectator-request-follow",i)}}onUserJoinedRoom(){ee("followme")&&this.onRequestFollowMe()}onFollowerEvent(e){const t=e.targetUserId,i=e.guid;if(Fl&&console.log(e),t===this.context.connection.connectionId)if(e.stoppedFollowing){const n=this.followers.indexOf(i);n!==-1&&(this.followers.splice(n,1),this.removeDisconnectedFollowers(),console.log(i,"unfollows you",this.followers.length))}else this.followers.includes(i)||(this.followers.push(i),this.removeDisconnectedFollowers(),console.log(i,"follows you",this.followers.length))}removeDisconnectedFollowers(){for(let e=this.followers.length-1;e>=0;e--){const t=this.followers[e];this.context.connection.userIsInRoom(t)===!1&&this.followers.splice(e,1)}}onRequestFollowEvent(e){if(this._lastRequestFollowUser=e,e.userId===this.context.connection.connectionId)this.spectator.stopSpectating();else if(e.userId===void 0)this.spectator.stopSpectating();else{const t=this.context.players.getPlayerView(e.userId);if(t)this.spectator.target=t;else return Fl&&console.warn("Could not find view",e.userId),this.enforceFollow(),!1}return!0}enforceFollow(){this._enforceFollowInterval||(this._enforceFollowInterval=setInterval(()=>{this._lastRequestFollowUser===void 0||this._lastRequestFollowUser.userId&&this.spectator.isFollowedBy(this._lastRequestFollowUser.userId)?(clearInterval(this._enforceFollowInterval),this._enforceFollowInterval=void 0):(Fl&&console.log("REQUEST FOLLOW AGAIN",this._lastRequestFollowUser.userId),this.onRequestFollowEvent(this._lastRequestFollowUser))},1e3))}}class bd{constructor(){p(this,"bb",null);p(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSyncedCameraModel(e,t){return(t||new bd).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedCameraModel(e,t){return e.setPosition(e.position()+WO),(t||new bd).__init(e.readInt32(e.position())+e.position(),e)}userId(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}guid(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}dontSave(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}pos(e){const t=this.bb.__offset(this.bb_pos,10);return t?(e||new B0).__init(this.bb_pos+t,this.bb):null}rot(e){const t=this.bb.__offset(this.bb_pos,12);return t?(e||new B0).__init(this.bb_pos+t,this.bb):null}static startSyncedCameraModel(e){e.startObject(5)}static addUserId(e,t){e.addFieldOffset(0,t,0)}static addGuid(e,t){e.addFieldOffset(1,t,0)}static addDontSave(e,t){e.addFieldInt8(2,+t,0)}static addPos(e,t){e.addFieldStruct(3,t,0)}static addRot(e,t){e.addFieldStruct(4,t,0)}static endSyncedCameraModel(e){return e.endObject()}static finishSyncedCameraModelBuffer(e,t){e.finish(t)}static finishSizePrefixedSyncedCameraModelBuffer(e,t){e.finish(t,void 0,!0)}}var dOe=Object.defineProperty,uOe=Object.getOwnPropertyDescriptor,pOe=(s,e,t,i)=>{for(var n=i>1?void 0:i?uOe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&dOe(e,t,n),n};const L2="SCAM";QO(L2,bd.getRootAsSyncedCameraModel);const Cl=new oM;class fOe{constructor(e,t){p(this,"userId");p(this,"guid");this.guid=t,this.userId=e}send(e,t){if(e){Cl.clear();const i=Cl.createString(this.guid),n=Cl.createString(this.userId);bd.startSyncedCameraModel(Cl),bd.addGuid(Cl,i),bd.addUserId(Cl,n);const r=$t(e),o=$1(e);bd.addPos(Cl,B0.createVec3(Cl,r.x,r.y,r.z)),bd.addRot(Cl,B0.createVec3(Cl,o.x,o.y,o.z));const a=bd.endSyncedCameraModel(Cl);Cl.finish(a,L2),t.sendBinary(Cl.asUint8Array())}}}var kF;const jz=(kF=class extends ze{constructor(){super(...arguments);p(this,"cameraPrefab",null);p(this,"_lastWorldPosition");p(this,"_lastWorldQuaternion");p(this,"_model",null);p(this,"_needsUpdate",!0);p(this,"_lastUpdateTime",0);p(this,"remoteCams",{});p(this,"userToCamMap",{});p(this,"_camTimeoutInSeconds",10);p(this,"_receiveCallback",null)}getCameraObject(e){const t=this.userToCamMap[e];return t?this.remoteCams[t].obj:null}async awake(){this._lastWorldPosition=this.worldPosition.clone(),this._lastWorldQuaternion=this.worldQuaternion.clone(),this.cameraPrefab&&("uri"in this.cameraPrefab&&(this.cameraPrefab=await this.cameraPrefab.instantiate(this.gameObject)),this.cameraPrefab&&"isObject3D"in this.cameraPrefab&&(this.cameraPrefab.visible=!1))}onEnable(){this._receiveCallback=this.context.connection.beginListenBinary(L2,this.onReceivedRemoteCameraInfoBin.bind(this))}onDisable(){this.context.connection.stopListenBinary(L2,this._receiveCallback)}update(){for(const n in this.remoteCams){const r=this.remoteCams[n],o=this.context.time.realtimeSinceStartup-r.lastUpdate;if(!r||o>this._camTimeoutInSeconds){Qe()&&console.log("Remote cam timeout",n),r!=null&&r.obj&&$.destroy(r.obj),delete this.remoteCams[n],r&&delete this.userToCamMap[r.userId],jz.instances.push(r),this.context.players.removePlayerView(r.userId,Kf.Browser);continue}}if(this.context.isInXR)return;const e=this.context.mainCamera;if(e===null){this.enabled=!1;return}if(!this.context.connection.isConnected||this.context.connection.connectionId===null)return;this._model===null&&(this._model=new fOe(this.context.connection.connectionId,this.context.connection.connectionId+"_camera"));const t=$t(e),i=gn(e);(t.distanceTo(this._lastWorldPosition)>.001||i.angleTo(this._lastWorldQuaternion)>.01)&&(this._needsUpdate=!0),this._lastWorldPosition.copy(t),this._lastWorldQuaternion.copy(i),!((!this._needsUpdate||this.context.time.frameCount%2!==0)&&!(this.context.time.realtimeSinceStartup-this._lastUpdateTime>this._camTimeoutInSeconds*.5))&&(this._lastUpdateTime=this.context.time.realtimeSinceStartup,this._needsUpdate=!1,this._model.send(e,this.context.connection),this.context.isInXR||this.context.players.setPlayerView(this.context.connection.connectionId,e,Kf.Browser))}onReceivedRemoteCameraInfoBin(e){const t=e.guid();if(!t)return;const i=e.userId();if(!i||!this.context.connection.userIsInRoom(i)||!this.cameraPrefab)return;let n=this.remoteCams[t];if(!n)if("isObject3D"in this.cameraPrefab){const l=new Zh;l.context=this.context;const c=$.instantiate(this.cameraPrefab,l);n=this.remoteCams[t]={obj:c,lastUpdate:this.context.time.realtimeSinceStartup,userId:i},n.obj.visible=!0,this.gameObject.add(c),this.userToCamMap[i]=t,jz.instances.push(n);const h=$.getOrAddComponent(c,br);h.connectionId=i,h.avatar=c}else return;const r=n.obj;this.context.players.setPlayerView(i,r,Kf.Browser),n.lastUpdate=this.context.time.realtimeSinceStartup,Vc.markDirty(r);const o=e.pos();o&&q0(r,o.x(),o.y(),o.z());const a=e.rot();a&&eM(r,a.x(),a.y(),a.z())}},p(kF,"instances",[]),kF);let rG=jz;pOe([I([ye,gi])],rG.prototype,"cameraPrefab",2);var mOe=Object.defineProperty,gOe=Object.getOwnPropertyDescriptor,ig=(s,e,t,i)=>{for(var n=i>1?void 0:i?gOe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&mOe(e,t,n),n};const sF="view",rF=ee("debugsyncedroom");class Yh extends ze{constructor(){super(...arguments);p(this,"roomName","");p(this,"urlParameterName","room");p(this,"joinRandomRoom");p(this,"requireRoomParameter",!1);p(this,"autoRejoin",!0);p(this,"createJoinButton",!0);p(this,"createViewOnlyButton",!1);p(this,"_lastJoinedRoom");p(this,"_roomPrefix","");p(this,"_lastPingTime",0);p(this,"_lastRoomTime",-1);p(this,"_userWantsToBeInARoom",!1);p(this,"_roomButton");p(this,"_roomButtonIconJoin");p(this,"_roomButtonIconLeave");p(this,"updateRoomButtonState",()=>{var t,i;this._roomButton&&(this.context.connection.isInRoom?(this._roomButton.title="Leave the networked room",this._roomButton.textContent="Leave Room",(t=this._roomButtonIconJoin)==null||t.remove(),this._roomButton.prepend(this._roomButtonIconLeave)):(this._roomButton.title="Create or join a networked room",this._roomButton.textContent="Join Room",(i=this._roomButtonIconLeave)==null||i.remove(),this._roomButton.prepend(this._roomButtonIconJoin)))});p(this,"_viewOnlyButton");p(this,"onCreateViewOnlyButton",()=>{if(!this._viewOnlyButton){const t=document.createElement("button");this._viewOnlyButton=t,t.classList.add("view-only-button"),t.setAttribute("priority","90"),t.onclick=()=>{var n;const i=this.getViewOnlyUrl();i!=null&&i.length?navigator.canShare({url:i})?(n=navigator.share({url:i}))==null||n.catch(r=>{console.warn(r)}):(navigator.clipboard.writeText(i),is("View only URL copied to clipboard")):An("Could not create view only URL")},t.title="Copy the view only URL: A page accessed by the view only URL can not be modified by visiting users.",t.textContent="Share View URL",t.prepend(bo("visibility"))}this.context.menu.appendChild(this._viewOnlyButton)})}get currentRoomName(){const t=ee(sF);return t||ee(this.urlParameterName)}set roomPrefix(t){this._roomPrefix=t}get roomPrefix(){return this._roomPrefix}awake(){var t;this.joinRandomRoom===void 0&&((t=this.roomName)==null?void 0:t.length)<=0&&(this.joinRandomRoom=!0),rF&&console.log(`SyncedRoom roomName:${this.roomName}, urlParamName:${this.urlParameterName}, joinRandomRoom:${this.joinRandomRoom}`)}onEnable(){const t=ee(sF);if(t&&typeof t=="string"&&t.length>0){console.log("Join as viewer"),this.context.connection.joinRoom(t,!0);return}if(this.tryJoinRoom(),this.createJoinButton){const i=this.createRoomButton();this.context.menu.appendChild(i)}this.createViewOnlyButton&&this.onEnableViewOnlyButton()}onDisable(){var t;(t=this._roomButton)==null||t.remove(),this.onDisableViewOnlyButton(),this.roomName&&this.roomName.length>0&&this.context.connection.leaveRoom(this.roomName)}onDestroy(){this.destroyRoomButton()}tryJoinRandomRoom(){this.setRandomRoomUrlParameter(),this.tryJoinRoom()}tryJoinRoom(t=0){var n;t===void 0&&(t=0);let i=!1;if(((n=this.urlParameterName)==null?void 0:n.length)>0){const r=ee(this.urlParameterName);if(r&&(typeof r=="string"||typeof r=="number")){i=!0;const o=_te(r.toString());this.roomName=o}else if(this.joinRandomRoom&&(console.log("No room name found in url, generating random one"),this.setRandomRoomUrlParameter(),t<1))return this.tryJoinRoom(t+1)}else this.joinRandomRoom&&(this.roomName===null||this.roomName===void 0||this.roomName.length<=0)&&(this.roomName=this.generateRoomName());return this.requireRoomParameter&&!i?((rF||Qe())&&console.warn('[SyncedRoom] Missing required room parameter "'+this.urlParameterName+`" in url - will not connect.
To allow joining a room without a query parameter you can set "requireRoomParameter" to false.`),!1):(this.context.connection.isConnected||this.context.connection.connect(),this._lastJoinedRoom=this.roomName,this._roomPrefix&&(this.roomName=this._roomPrefix+this.roomName),this.roomName.length<=0?(console.warn(`[SyncedRoom] Room name is not set so we can not join a networked room.
Please choose one of the following options to fix this:
A) Set a room name in the SyncedRoom component
B) Set a room name in the URL parameter "?`+this.urlParameterName+`=my_room"
C) Set "joinRandomRoom" to true`),!1):(rF&&console.log("Join "+this.roomName),this._userWantsToBeInARoom=!0,this.context.connection.joinRoom(this.roomName),!0))}update(){this.context.connection.isConnected&&(this.context.time.time-this._lastPingTime>3&&(this._lastPingTime=this.context.time.time,this.context.connection.sendPing()),this.context.connection.isInRoom&&(this._lastRoomTime=this.context.time.time)),this._lastRoomTime>0&&this.context.time.time-this._lastRoomTime>.3&&(this._lastRoomTime=-1,this.autoRejoin?this._userWantsToBeInARoom&&(console.log("Disconnected from networking backend - attempt reconnecting now"),this.tryJoinRoom()):Qe()&&console.warn("You are not connected to a room anymore (possibly because the tab was inactive for too long and the server kicked you?)"))}getViewOnlyUrl(){if(this.context.connection.isConnected&&this.context.connection.currentRoomViewId){const t=window.location.search,i=new URLSearchParams(t);return i.has(this.urlParameterName)&&i.delete(this.urlParameterName),i.set(sF,this.context.connection.currentRoomViewId),window.location.origin+window.location.pathname+"?"+i.toString()}return null}setRandomRoomUrlParameter(){const t=K1(),i=this.generateRoomName();ee(this.urlParameterName)?t.set(this.urlParameterName,i):t.append(this.urlParameterName,i),z3(i,t)}generateRoomName(){let t="";for(let i=0;i<6;i++)t+=Math.floor(Math.random()*10).toFixed(0);return t}createRoomButton(){if(this._roomButton)return this._roomButton;const t=document.createElement("button");return this._roomButton=t,t.classList.add("create-room-button"),t.setAttribute("priority","90"),t.onclick=()=>{if(this.context.connection.isInRoom)this.urlParameterName&&eS(this.urlParameterName,null),this.context.connection.leaveRoom(),this._userWantsToBeInARoom=!1;else{if(this.urlParameterName){const i=ee(this.urlParameterName);(!i||i===!0)&&(this._lastJoinedRoom?eS(this.urlParameterName,this._lastJoinedRoom):this.setRandomRoomUrlParameter())}this.tryJoinRoom()}},this._roomButtonIconJoin=bo("group"),this._roomButtonIconLeave=bo("group_off"),this.updateRoomButtonState(),this.context.connection.beginListen(ri.JoinedRoom,this.updateRoomButtonState),this.context.connection.beginListen(ri.LeftRoom,this.updateRoomButtonState),t}destroyRoomButton(){this.context.connection.stopListen(ri.JoinedRoom,this.updateRoomButtonState),this.context.connection.stopListen(ri.LeftRoom,this.updateRoomButtonState)}onEnableViewOnlyButton(){this.context.connection.isConnected?this.onCreateViewOnlyButton():(this.context.connection.stopListen(ri.JoinedRoom,this.onCreateViewOnlyButton),this.context.connection.beginListen(ri.JoinedRoom,this.onCreateViewOnlyButton))}onDisableViewOnlyButton(){var t;this.context.connection.stopListen(ri.JoinedRoom,this.onCreateViewOnlyButton),(t=this._viewOnlyButton)==null||t.remove()}}ig([I()],Yh.prototype,"roomName",2);ig([I()],Yh.prototype,"urlParameterName",2);ig([I()],Yh.prototype,"joinRandomRoom",2);ig([I()],Yh.prototype,"requireRoomParameter",2);ig([I()],Yh.prototype,"autoRejoin",2);ig([I()],Yh.prototype,"createJoinButton",2);ig([I()],Yh.prototype,"createViewOnlyButton",2);ig([I()],Yh.prototype,"roomPrefix",1);function AOe(){const s=ee("testwindowcount")||0;s&&s>0&&yOe(s)}function yOe(s){if(ee("testwindow"))return null;const e=new URL(window.location.href);AV(e.searchParams,RDe,1),AV(e.searchParams,"testwindow",1);const t=e.toString(),i=[];window.onbeforeunload=()=>{for(const l of i)l.close()};const n=.05,r=128;let o=0,a=0;for(let l=0;l<s;l++){o*r+r*.01>=window.innerWidth&&(a+=1,o=0);const c=o*(r*(1+n))+window.screenLeft,h=a*(r*(1+n))+window.screenTop+90+60*a;o+=1;const d=window.open(t,"test window "+l,`popup=yes width=${r} height=${r} top=${h} left=${c}`);if(!d){console.warn("Failed to open window");continue}i.push(d),d.onload=()=>{d.onbeforeunload=()=>{for(let u=0;u<i.length;u++){const f=i[u];f!==d&&f.close()}i.length=0}}}return i}class IZ extends ze{awake(){AOe()}}class TZ extends ze{constructor(){super(...arguments);p(this,"transformsPerFrame",10);p(this,"interval",0);p(this,"useFlatbuffers",!0);p(this,"builder",null);p(this,"models",null)}awake(){if(this.useFlatbuffers)this.context.connection.beginListenBinary(vS,t=>{});else{this.models=[];for(let t=0;t<this.transformsPerFrame;t++)this.models.push(new cle(this.context.connection.connectionId+"_simulatedTransform_"+t,this))}}update(){if(this.context.connection.isConnected){if(this.useFlatbuffers){if(!this.context.connection.connectionId||this.context.time.frameCount%this.interval!==0)return;this.builder===null&&(this.builder=new oM(1024));const t=this.builder;for(let i=0;i<this.transformsPerFrame;i++){t.clear();const n=Poe(this.context.connection.connectionId,this);this.context.connection.sendBinary(n)}}else if(this.models)for(let t=0;t<this.models.length;t++){const i=this.models[t];i.dontSave=!0,i.update(this,null),this.context.connection.send("TestSimulateUserData-"+t,i)}}}}class cle{constructor(e,t){p(this,"guid");p(this,"fast",!1);p(this,"position");p(this,"rotation");p(this,"velocity");p(this,"dontSave");this.guid=e,this.position={x:0,y:0,z:0},this.rotation={x:0,y:0,z:0,w:0},this.update(t,null)}isValid(){return this.fast!==void 0||this.position!==void 0||this.rotation!==void 0||this.velocity!==void 0}update(e,t){const i=e.worldPosition;this.position.x=i.x,this.position.y=i.y,this.position.z=i.z;const n=e.worldQuaternion;if(this.rotation.x=n.x,this.rotation.y=n.y,this.rotation.z=n.z,this.rotation.w=n.w,this.fast=!1,t){const r=t.getVelocity();this.velocity===void 0&&(this.velocity={x:0,y:0,z:0}),this.velocity.x=r.x,this.velocity.y=r.y,this.velocity.z=r.z}}}p(cle,"temp",new T);var bOe=Object.defineProperty,xOe=Object.getOwnPropertyDescriptor,Rv=(s,e,t,i)=>{for(var n=i>1?void 0:i?xOe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&bOe(e,t,n),n};class uu extends jr{constructor(){super(...arguments);p(this,"offset",new rt(0));p(this,"rotation",new rt(0));p(this,"focusArea",new rt(.4));p(this,"feather",new rt(.3));p(this,"kernelSize",new rt(Xd.MEDIUM));p(this,"resolutionScale",new rt(1/window.devicePixelRatio))}get typeName(){return"TiltShiftEffect"}init(){this.offset.defaultValue=0,this.rotation.defaultValue=0,this.focusArea.defaultValue=.4,this.feather.defaultValue=.3,this.kernelSize.defaultValue=Xd.MEDIUM,this.resolutionScale.defaultValue=1/window.devicePixelRatio}onCreateEffect(){const t=new qie({kernelSize:Xd.VERY_LARGE,offset:this.offset.value,rotation:this.rotation.value,focusArea:this.focusArea.value,feather:this.feather.value});return this.offset.onValueChanged=i=>t.offset=i,this.rotation.onValueChanged=i=>t.rotation=i,this.focusArea.onValueChanged=i=>t.focusArea=i,this.feather.onValueChanged=i=>t.feather=i,this.kernelSize.onValueChanged=i=>t.blurPass.kernelSize=i,this.resolutionScale.onValueChanged=i=>t.resolution.scale=i/window.devicePixelRatio,t}}Rv([I(rt)],uu.prototype,"offset",2);Rv([I(rt)],uu.prototype,"rotation",2);Rv([I(rt)],uu.prototype,"focusArea",2);Rv([I(rt)],uu.prototype,"feather",2);Rv([I(rt)],uu.prototype,"kernelSize",2);Rv([I(rt)],uu.prototype,"resolutionScale",2);Kc("TiltShiftEffect",uu);var vOe=Object.defineProperty,_Oe=Object.getOwnPropertyDescriptor,oG=(s,e,t,i)=>{for(var n=i>1?void 0:i?_Oe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&vOe(e,t,n),n};class OA extends ze{constructor(){super(...arguments);p(this,"isGizmo",!1);p(this,"translationSnap",1);p(this,"rotationSnapAngle",15);p(this,"scaleSnap",.25);p(this,"control");p(this,"orbit");p(this,"onControlChangedEvent",t=>{const i=this.orbit;if(i&&(i.enabled=!t.value),t.value){const n=$.getComponentInParent(this.gameObject,$d);n&&n.requestOwnership()}});p(this,"windowKeyDownListener",t=>{if(this.enabled&&this.control)switch(t.keyCode){case 81:this.control.setSpace(this.control.space==="local"?"world":"local");break;case 16:this.enableSnapping();break;case 87:this.control.setMode("translate");break;case 69:this.control.setMode("rotate");break;case 82:this.control.setMode("scale");break;case 187:case 107:this.control.setSize(this.control.size+.1);break;case 189:case 109:this.control.setSize(Math.max(this.control.size-.1,.1));break;case 88:this.control.showX=!this.control.showX;break;case 89:this.control.showY=!this.control.showY;break;case 90:this.control.showZ=!this.control.showZ;break;case 32:this.control.enabled=!this.control.enabled;break}});p(this,"windowKeyUpListener",t=>{if(this.enabled)switch(t.keyCode){case 16:this.disableSnapping();break}})}onEnable(){var t;if(!(this.isGizmo&&!hM)&&this.context.mainCamera&&(this.control||(this.control=new fPe(this.context.mainCamera,this.context.renderer.domElement),this.control.enabled=!0,this.control.getRaycaster().layers.set(2),this.control.size=1,("_root"in this.control?this.control._root:this.control).traverse(n=>{const r=n;if(r.layers.set(2),r){const o=r.material;o&&(o.opacity=.3)}}),this.orbit=$.getComponentInParent(this.context.mainCamera,on)??void 0),this.control)){const i=this.control.getHelper();this.context.scene.add(i),this.control.attach(this.gameObject),(t=this.control)==null||t.addEventListener("dragging-changed",this.onControlChangedEvent),window.addEventListener("keydown",this.windowKeyDownListener),window.addEventListener("keyup",this.windowKeyUpListener)}}onDisable(){var t,i,n;(i=(t=this.control)==null?void 0:t.getHelper())==null||i.removeFromParent(),(n=this.control)==null||n.removeEventListener("dragging-changed",this.onControlChangedEvent),window.removeEventListener("keydown",this.windowKeyDownListener),window.removeEventListener("keyup",this.windowKeyUpListener)}enableSnapping(){this.control&&(this.control.setTranslationSnap(this.translationSnap),this.control.setRotationSnap(Bi.degToRad(this.rotationSnapAngle)),this.control.setScaleSnap(this.scaleSnap))}disableSnapping(){this.control&&(this.control.setTranslationSnap(null),this.control.setRotationSnap(null),this.control.setScaleSnap(null))}}oG([I()],OA.prototype,"isGizmo",2);oG([I()],OA.prototype,"translationSnap",2);oG([I()],OA.prototype,"rotationSnapAngle",2);oG([I()],OA.prototype,"scaleSnap",2);var COe=Object.defineProperty,wOe=Object.getOwnPropertyDescriptor,EZ=(s,e,t,i)=>{for(var n=i>1?void 0:i?wOe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&COe(e,t,n),n};class ZA extends jr{constructor(){super(...arguments);p(this,"color",new rt({r:0,g:0,b:0,a:1}));p(this,"intensity",new rt(0));p(this,"center",new rt({x:.5,y:.5}))}get typeName(){return"Vignette"}init(){this.color.defaultValue={r:0,g:0,b:0,a:1},this.intensity.defaultValue=0,this.center.defaultValue={x:.5,y:.5}}onCreateEffect(){const t=new $ie;return this.intensity.onValueChanged=i=>{t.offset=i,this.updateDarkness(t)},this.color.onValueChanged=i=>{this.updateDarkness(t)},t}updateDarkness(t){const i=this.intensity.value;t.darkness=i}}EZ([I(rt)],ZA.prototype,"color",2);EZ([I(rt)],ZA.prototype,"intensity",2);EZ([I(rt)],ZA.prototype,"center",2);Kc("Vignette",ZA);var SOe=Object.defineProperty,MOe=Object.getOwnPropertyDescriptor,IOe=(s,e,t,i)=>{for(var n=i>1?void 0:i?MOe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&SOe(e,t,n),n};const GE=ee("debugpost");class Lv extends ze{constructor(){super(...arguments);p(this,"sharedProfile");p(this,"_postprocessing");p(this,"_activeEffects",[]);p(this,"_effects",[]);p(this,"_lastApplyTime");p(this,"_rapidApplyCount",0);p(this,"_isDirty",!1);p(this,"_modificationQueue");p(this,"_recreateId",-1)}get isPostProcessingManager(){return!0}get effects(){return this._activeEffects}addEffect(t){let i=t;return i instanceof Na&&(i=new TS(i)),this._effects.includes(i)||(this._effects.push(i),this._isDirty=!0),t}removeEffect(t){var n,r,o,a;let i=-1;if(t instanceof Na?i=this._effects.findIndex(l=>l instanceof TS&&l.effect===t):i=this._effects.indexOf(t),i!==-1)return this._effects.splice(i,1),this._isDirty=!0,t;if(t instanceof jr){const l=(r=(n=this.sharedProfile)==null?void 0:n.components)==null?void 0:r.indexOf(t);l!==void 0&&l!==-1&&(this._isDirty=!0,(a=(o=this.sharedProfile)==null?void 0:o.components)==null||a.splice(l,1))}return t}markDirty(){this._isDirty=!0}awake(){var t;GE&&(console.log("PostprocessingManager Awake",this),console.log("Press P to toggle post processing"),window.addEventListener("keydown",i=>{i.key==="p"&&(this.enabled=!this.enabled,is("Toggle PostProcessing "+this.name+": Enabled="+this.enabled),this.markDirty())})),(t=this.sharedProfile)==null||t.init()}onEnable(){this._isDirty=!0}onDisable(){var t;(t=this._postprocessing)==null||t.unapply(),this._isDirty=!1}onBeforeRender(){var t;if(!this.context.isInXR){if(this.context.composer&&!(this.context.composer instanceof wO)){GE&&console.warn("PostProcessing: The current composer is not an EffectComposer - this is not supported");return}if(this.context.mainCamera&&this._isDirty&&this.apply(),this.context.composer&&((t=this._postprocessing)==null?void 0:t.composer)===this.context.composer&&(this.context.renderer.getContext().isContextLost()&&this.context.renderer.forceContextRestore(),this.context.composer.getRenderer()!==this.context.renderer&&this.context.composer.setRenderer(this.context.renderer),this.context.composer.setMainScene(this.context.scene),this.context.mainCamera)){const i=this.context.composer.passes;for(const n of i)if(n.mainCamera&&n.mainCamera!==this.context.mainCamera){this.context.composer.setMainCamera(this.context.mainCamera);break}}}}onDestroy(){var t;(t=this._postprocessing)==null||t.dispose()}apply(){var t;if(GE&&console.log("Apply PostProcessing "+this.name),Qe()&&(this._lastApplyTime!==void 0&&Date.now()-this._lastApplyTime<100&&(this._rapidApplyCount++,this._rapidApplyCount===5&&console.warn("Detected rapid post processing modifications - this might be a bug",this)),this._lastApplyTime=Date.now()),this._isDirty=!1,this.unapply(),this._activeEffects.length=0,(t=this.sharedProfile)!=null&&t.components){const i=this.sharedProfile.components;for(const n of i)n.active&&!this._activeEffects.includes(n)&&this._activeEffects.push(n)}for(const i of this._effects)i.active&&!this._activeEffects.includes(i)&&this._activeEffects.push(i);GE&&console.log("Apply PostProcessing",this._activeEffects),this._activeEffects.length>0&&(this._postprocessing||(this._postprocessing=new iG(this.context)),this._postprocessing.apply(this._activeEffects),this._applyPostQueue())}unapply(){var t;(t=this._postprocessing)==null||t.unapply()}_applyPostQueue(){if(this._modificationQueue){for(const t of this._modificationQueue.values())this.onEditorModification(t);this._modificationQueue.clear()}}onEditorModification(t){var i,n;if(t.propertyName.startsWith("postprocessing.")){if(!this._postprocessing)return this._modificationQueue||(this._modificationQueue=new Map),this._modificationQueue.set(t.propertyName,t),!0;if(!((i=this._activeEffects)!=null&&i.length))return;const r=t.propertyName.split(".");if(r.length===3||r.length===4){const o=r[1],a=r[2];for(const l of this._activeEffects)if(((n=l.typeName)==null?void 0:n.toLowerCase())===o.toLowerCase()){if(a==="active"){l.active=t.value,this.scheduleRecreate();return}if(!kE.has(o)){const c=new Array;kE.set(o,c);const h=Object.keys(l);for(const d of h)l[d]instanceof rt&&c.push(d)}if(kE.has(o)){const c=a.toLowerCase(),h=kE.get(o);for(const d of h)if(d.toLowerCase()===c){const u=l[d];u instanceof rt&&(r.length===4&&r[3]==="active"?(u.overrideState=t.value,this.scheduleRecreate()):u&&u.value!==void 0&&(u.value=t.value));return}}console.warn("Unknown modification",a);return}}return!0}return!1}scheduleRecreate(){const t=++this._recreateId;setTimeout(()=>{t===this._recreateId&&(this.onDisable(),this.onEnable())},200)}}IOe([av(_M)],Lv.prototype,"sharedProfile",2);const kE=new Map;HNe(Lv);function hle(s,e){const t=s.xr.getFrame();if(!t)return console.warn("No XRFrame available"),!1;const i=t.session.enabledFeatures;if(i&&!i.some(r=>r==="camera-access"))return console.error(`No camera feed available - please request the 'camera-access' feature before starting WebXR or add the ARCameraBackground component to your scene.

Example to request camera-access in global scope:
NeedleXRSession.onSessionRequestStart(evt => {
    evt.init.optionalFeatures = evt.init.optionalFeatures || [];
    evt.init.optionalFeatures.push('camera-access');
});
`),Qe()&&tM("No camera feed available - please request the 'camera-access' feature before starting WebXR or add the ARCameraBackground component to your scene"),!1;const n=t.getViewerPose(s.xr.getReferenceSpace());if(n)for(const r of n.views)if("camera"in r&&r.camera){let o=s.xr.getBinding();if(o||(o=new XRWebGLBinding(t.session,s.getContext())),o){let a=null;if("getCameraImage"in o){TOe(s,e);const l=s.properties.get(e);if(l)return a=o.getCameraImage(r.camera),l.__webglTexture=a,!0;console.warn("No texture properties found for target texture")}}else console.error(r.camera,s.xr)}else console.error("NO CAMERA IN VIEW");else console.error(s.xr.getReferenceSpace(),t);return!1}const fJ=new WeakMap;function TOe(s,e){const t=fJ.get(e)||new WeakSet;if(t.has(s))return;t.add(s),fJ.set(e,t),console.debug("Initialize texture for camera feed");const i=new ii,n=new Rs,r=new sr;r.add(new fe(n,i));const o=new Xt;i.map=e,s.render(r,o)}function EOe(s,e,t,i="image/webp",n){return RZ({context:s,width:e,height:t,mimeType:i,camera:n})}function RZ(s){var _,C;s||(s={});const{transparent:e=!1}=s;let{mimeType:t,context:i,width:n,height:r,camera:o}=s;if(!i&&(i=Oi.Current,!i))return console.error("Can not save screenshot: No needle-engine context found or provided."),null;if(!o&&(o=i.mainCamera,!o))return console.error("No camera found"),null;const a=i.renderer,l=a.xr.enabled;if(l&&i.currentFrameEvent!=wn.EarlyUpdate)return console.warn("Screenshot: defer to access XR frame"),new Promise(M=>{Gp(L=>{const w=RZ(s);M(w)},wn.EarlyUpdate,{once:!0})});const c=a.domElement,h=c.width,d=c.height;n||(n=h),r||(r=d);const u=n,f=r,m=window.devicePixelRatio||1;n/=m,r/=m,a.xr.isPresenting&&a.xr.getFrame();const g=a.xr.enabled;a.xr.enabled=!1,a.xr.isPresenting=!1,c.style.width=`${n}px`,c.style.height=`${r}px`;const A=a.getRenderTarget(),y=a.getClearColor(new ge),b=a.getClearAlpha(),x=i.scene.background,v="aspect"in o?o.aspect:null;try{const S=s.render_events!==!1,M=new Array;S&&(sv(i.scene,Es,M),M.forEach(P=>{var k;if(P==null||P.onBeforeRender(),P.isInstancingActive&&P.instances)for(let X=0;X<((k=P.instances)==null?void 0:k.length);X++){const F=P.instances[X];sp(F.object,!0)}})),e&&(i.scene.background=null,a.setClearColor(0,0)),s.background&&(i.scene.background=null,a.setClearColor(s.background),s.background instanceof hn&&a.setClearAlpha(s.background.a)),e&&a.setClearAlpha(0),a.setSize(n,r,!1),"cam"in o&&(o=o.threeCamera),o instanceof Xt&&(o.aspect=n/r,o.updateProjectionMatrix());const L="type"in s&&s.type==="texture";let w=null;L&&(w=new ci(n,r,{wrapS:Sp,wrapT:Sp,format:1023}),a.setRenderTarget(w));let E=c;if(l?(w&&console.error('Taking XR screenshots with { type: "texture" } is currently not supported.'),E=exports.InternalScreenshotUtils.compositeWithCameraImage({width:u,height:f,scene:i.scene,camera:o,renderer:a})):i.renderNow(o||null),o instanceof Xt&&v!=null&&(o.aspect=v,o.updateProjectionMatrix()),S&&M.forEach(P=>P.onAfterRender()),!t&&"download_filename"in s&&s.download_filename)switch((_=s.download_filename.split(".").pop())==null?void 0:_.toLowerCase()){case"png":t="image/png";break;case"jpg":case"jpeg":t="image/jpeg";break;case"webp":t="image/webp";break}if(e&&s.trim===!0){const P=ROe(E);P&&(E=P)}if("type"in s){if(s.type==="texture")return w?(s.target&&(s.target.image=w==null?void 0:w.texture.image,s.target.needsUpdate=!0),w.texture.offset.set(0,-1),w.texture.needsUpdate=!0,w.texture):(console.error("No target texture found"),null);if(s.type==="blob")return new Promise((k,X)=>{E.toBlob(F=>{k(F)},t)});if(s.type==="share")return new Promise((k,X)=>{E.toBlob(F=>{if(F&&"share"in navigator){let H="file_type"in s&&s.file_type||t;t||(H="image/png");const W=(H==null?void 0:H.split("/")[1])||"png",se=new File([F],"filename"in s?s.filename||`screenshot.${W}`:`screenshot.${W}`,{type:H});return navigator.share({title:"title"in s?s.title:void 0,text:"text"in s?s.text:void 0,url:"url"in s?s.url:void 0,files:[se]}).catch(de=>{console.warn("User cancelled share",de.message)}).finally(()=>{k({blob:F,shared:!0})})}return{blob:F,shared:!1}},t)})}const B=E.toDataURL(t);if("download_filename"in s&&s.download_filename){let P=s.download_filename;const k=(C=P.split(".").pop())==null?void 0:C.toLowerCase();P=`${P}-${Date.now()}.${k}`,dle(B,P)}return B}finally{a.setRenderTarget(A),i.scene.background=x,a.setSize(h,d,!1),a.setClearColor(y,b),v!=null&&o instanceof Xt&&(o.aspect=v,o.updateProjectionMatrix()),a.xr.enabled=g,a.xr.isPresenting=l,l||i.updateSize(!0)}return null}function ROe(s){if(!("document"in globalThis))return null;const e=document.createElement("canvas");e.width=s.width,e.height=s.height;const t=e.getContext("2d");if(!t)return null;t.drawImage(s,0,0);const i=e.width,n=e.height,o=t.getImageData(0,0,i,n).data;let a=n,l=i,c=0,h=0;for(let g=0;g<n;g++)for(let A=0;A<i;A++){const y=(g*i+A)*4;o[y+3]!==0&&(A<l&&(l=A),A>h&&(h=A),g<a&&(a=g),g>c&&(c=g))}const d=h-l+1,u=c-a+1,f=document.createElement("canvas"),m=f.getContext("2d");return m?(f.width=d,f.height=u,m.drawImage(e,l,a,d,u,0,0,d,u),f):null}let D_=null;function dle(s,e){if(s){if(!s.startsWith("data:image")){console.error("Can not save image: Data url is not an image",s);return}D_||(D_=document.createElement("a")),D_.href=s,D_.download=e,D_.click()}}exports.InternalScreenshotUtils=void 0;(s=>{let e=null,t=null,i=null,n=null,r=null;function o(c){const{renderer:h,width:d,height:u}=c,f=h.xr.enabled,m=h.getRenderTarget(),g=h.autoClear,A=d,y=u,b=d/u;(!i||i.width!==A||i.height!==y)&&(i??(i=new ci(A,y,{colorSpace:ft})),i.width=A,i.height=y,i.samples=4,i.texture.repeat.y=-1,i.texture.offset.y=1),(!r||r.width!==A||r.height!==y)&&(r=document.createElement("canvas"),r.width=A,r.height=y,r.style.position="fixed",r.style.top="0px",r.style.right="0px",r.style.width="300px",r.style.height=`${300/b}px`,r.style.zIndex="1000",r.style.pointerEvents="none",r.style.opacity="1.0",r.style.willChange="contents"),e||(e=l({defines:{DECODE_VIDEO_TEXTURE:!0}})),t||(t=l()),n||(n=new si),h.xr.updateCamera(c.camera),h.xr.enabled=!1,h.autoClear=!1,h.clear(),h.setSize(A,y),h.setRenderTarget(i),hle(c.renderer,n)||console.error("Could not update texture from XR frame");const v=$.findObjectOfType(jM);return v?v.setTexture(n):(e.setTexture(n),h.render(e,c.camera)),h.clearDepth(),h.setSize(A,y),h.render(c.scene,c.camera),h.setRenderTarget(null),t.setTexture(i.texture),h.render(t,c.camera),r.getContext("2d",{alpha:!1}).drawImage(h.domElement,0,0,r.width,r.height),h.setRenderTarget(m),h.xr.enabled=f,h.autoClear=g,r}s.compositeWithCameraImage=o;const a=`
uniform sampler2D t2D;
varying vec2 vUv;

void main() {

    vec4 texColor = texture2D( t2D, vUv );

    #ifdef DECODE_VIDEO_TEXTURE

        // inline sRGB decode (TODO: Remove this code when https://crbug.com/1256340 is solved)
        texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );

    #endif

    gl_FragColor = texColor;
    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`;function l(c){const h=(c==null?void 0:c.material)||new Ht({name:"BackgroundMaterial",uniforms:Zx.clone(Wn.background.uniforms),vertexShader:Wn.background.vertexShader,fragmentShader:a,defines:c==null?void 0:c.defines,side:us,depthTest:!1,depthWrite:!1,fog:!1});Object.defineProperty(h,"map",{get:function(){return this.threeTexture}});const d=new fe(new Rs(2,2),h);return d.geometry.deleteAttribute("normal"),d.renderOrder=-1e6,d.setTexture=function(u){h.uniforms.t2D.value=u},d}s.makeFullscreenPlane=l})(exports.InternalScreenshotUtils||(exports.InternalScreenshotUtils={}));var LOe=Object.defineProperty,BOe=Object.getOwnPropertyDescriptor,POe=(s,e,t,i)=>{for(var n=i>1?void 0:i?BOe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&LOe(e,t,n),n};const mJ=ee("debugarcamera");class jM extends ze{constructor(){super(...arguments);p(this,"backgroundTint",new hn(1,1,1,1));p(this,"backgroundPlane");p(this,"threeTexture");p(this,"forceTextureInitialization",function(){const t=new ii,i=new Rs,n=new sr;n.add(new fe(i,t));const r=new Xt;return function(a,l){t.map=l,a.render(n,r),mJ&&console.warn("Force texture initialization")}}());p(this,"preRender",()=>{if(!this||!this.gameObject)return;if(this.context.renderer.xr.getFrame()){if(!this.threeTexture&&this.context.renderer&&(this.threeTexture=new si,this.forceTextureInitialization(this.context.renderer,this.threeTexture)),this.backgroundPlane===void 0){const n=this.backgroundTint;this.backgroundPlane=exports.InternalScreenshotUtils.makeFullscreenPlane({material:new Ht({name:"BackgroundMaterial",uniforms:{...Zx.clone(Wn.background.uniforms),tint:{value:new Je(n.r,n.g,n.b,n.a)}},vertexShader:Wn.background.vertexShader,fragmentShader:GOe,side:Zi,depthTest:!1,depthWrite:!1,fog:!1})})}this.backgroundPlane.parent!==this.scene&&this.scene.add(this.backgroundPlane),this.backgroundPlane.material instanceof Ht&&this.backgroundPlane.material.uniforms.tint.value.set(this.backgroundTint.r,this.backgroundTint.g,this.backgroundTint.b,this.backgroundTint.a),this.updateFromFrame()}})}onBeforeXR(t,i){t==="immersive-ar"&&(i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.push("camera-access"),mJ&&console.warn("Requesting camera-access"))}onEnterXR(t){t.xr.mode==="immersive-ar"&&(this.backgroundPlane&&(this.context.scene.add(this.backgroundPlane),this.backgroundPlane.visible=!1),this.backgroundPlane&&this.context.scene.add(this.backgroundPlane),this.context.pre_render_callbacks.push(this.preRender))}onLeaveXR(t){this.backgroundPlane&&this.backgroundPlane.removeFromParent();const i=this.context.pre_render_callbacks.indexOf(this.preRender);i>=0&&this.context.pre_render_callbacks.splice(i,1)}get background(){return this.backgroundPlane}onBeforeRender(t){this.updateFromFrame()}updateFromFrame(){var t;this.threeTexture&&((t=this.context.xr)==null?void 0:t.mode)==="immersive-ar"&&(hle(this.context.renderer,this.threeTexture),this.setTexture(this.threeTexture))}setTexture(t){this.backgroundPlane&&(this.threeTexture=t,this.backgroundPlane.setTexture(this.threeTexture),this.backgroundPlane.visible=!0)}}POe([I(hn)],jM.prototype,"backgroundTint",2);const GOe=`
uniform sampler2D t2D;
uniform vec4 tint;

varying vec2 vUv;

void main() {

    vec4 texColor = texture2D( t2D, vUv );
    texColor.w = 1.0;

    // inline sRGB decode
    texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );

    gl_FragColor = texColor * tint;

    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`;var kOe=Object.defineProperty,NOe=Object.getOwnPropertyDescriptor,WA=(s,e,t,i)=>{for(var n=i>1?void 0:i?NOe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&kOe(e,t,n),n};const gJ=ee("debugimagetracking"),O2=class{constructor(e,t,i,n,r,o){p(this,"measuredSize");p(this,"state");p(this,"_position");p(this,"_rotation");p(this,"_trackingComponent");p(this,"_trackedImage");p(this,"_bitmap");p(this,"_pose");this._trackingComponent=e,this._trackedImage=t,this._bitmap=i,this.measuredSize=n,this.state=r,this._pose=o}get url(){return this._trackedImage.image??""}get widthInMeters(){return this._trackedImage.widthInMeters??void 0}get bitmap(){return this._bitmap}get model(){return this._trackedImage}getPosition(e){return this.ensureTransformData(),e.copy(this._position),e}getQuaternion(e){return this.ensureTransformData(),e.copy(this._rotation),e}applyToObject(e,t=void 0){this.ensureTransformData();const i=e.position.distanceToSquared(this._position)/.05+e.quaternion.angleTo(this._rotation)/.05;t&&(t*=Math.max(1,i)),t===void 0||t>=1?(e.position.copy(this._position),e.quaternion.copy(this._rotation)):(t=Math.max(0,Math.min(1,t)),e.position.lerp(this._position,t),e.quaternion.slerp(this._rotation,t))}ensureTransformData(){if(!this._position){this._position=O2._positionBuffer.get(),this._rotation=O2._rotationBuffer.get();const e=this._pose.transform,t=Vt.active.convertSpace(e);this._position.copy(t==null?void 0:t.position),this._rotation.copy(t==null?void 0:t.quaternion)}}};let zf=O2;p(zf,"_positionBuffer",new $l(()=>new T,20)),p(zf,"_rotationBuffer",new $l(()=>new Ve,20));class pu{constructor(){p(this,"image");p(this,"widthInMeters",.25);p(this,"object");p(this,"createObjectInstance",!1);p(this,"imageDoesNotMove",!1);p(this,"hideWhenTrackingIsLost",!0)}}WA([I(URL)],pu.prototype,"image",2);WA([I()],pu.prototype,"widthInMeters",2);WA([I(gi)],pu.prototype,"object",2);WA([I()],pu.prototype,"createObjectInstance",2);WA([I()],pu.prototype,"imageDoesNotMove",2);WA([I()],pu.prototype,"hideWhenTrackingIsLost",2);class DOe{constructor(e,t,i){p(this,"filename");p(this,"widthInMeters");p(this,"imageData");this.filename=e,this.imageData=t,this.widthInMeters=i}get extensionName(){return"image-tracking"}onAfterHierarchy(e,t){t.beginBlock('def Preliminary_ReferenceImage "AnchoringReferenceImage"'),t.appendLine("uniform asset image = @image_tracking/"+this.filename+"@"),t.appendLine("uniform double physicalWidth = "+(this.widthInMeters*100).toFixed(8)),t.closeBlock()}onBeforeBuildDocument(e){const t=$.findObjectOfType(Dx);!t||!t.trackedImages||t.trackedImages.length>1&&(Qe()&&An("USDZ: Only one tracked image is supported."),console.warn("USDZ: Only one tracked image is supported."))}onAfterSerialize(e){e.files["image_tracking/"+this.filename]=this.imageData}onExportObject(e,t,i){var r;const n=$.findObjectOfType(Dx);if(!(!n||!n.trackedImages)){for(const o of n.trackedImages)if(((r=o.object)==null?void 0:r.asset)===e){const a=$.findObjectOfType(ds);if(!a)continue;const{scale:l,target:c}=a.getARScaleAndTarget();let h=e;const d=new ce;if(e!==c)for(;h.parent&&h.parent!==c;)h=h.parent,d.premultiply(h.matrix);const u=d.clone().invert();t.setMatrix(u.scale(new T(l,l,l)));break}}}}var NF;const LC=(NF=class extends ze{constructor(){super(...arguments);p(this,"trackedImages");p(this,"smooth",!0);p(this,"trackedImageIndexMap",new Map);p(this,"imageToObjectMap",new Map);p(this,"currentImages",[]);p(this,"onImageTrackingUpdate",e=>{const t=Vt.active;if(t)for(const i of e){const n=i.model,r=i.state==="tracked";if(!n.object)continue;let o=this.imageToObjectMap.get(n);if(o===void 0)o={object:null,frames:0,lastTrackingTime:Date.now()},this.imageToObjectMap.set(n,o),n.object.loadAssetAsync().then(a=>{if(n.createObjectInstance&&a&&(a=$.instantiate(a)),a){o.object=a;for(const l of a.getComponentsInChildren(Es))l.setInstancingEnabled(!1);t.rig?(t.rig.gameObject.add(a),i.applyToObject(a),a.activeSelf||$.setActive(a,!0)):console.warn("XRImageTracking: missing XRRig")}});else{if(o.frames++,r&&(o.lastTrackingTime=Date.now()),n.imageDoesNotMove&&o.frames>10||!o.object)continue;t.rig&&(t.rig.gameObject.add(o.object),i.applyToObject(o.object,this.smooth?this.context.time.deltaTimeUnscaled*3:void 0),o.object.activeSelf||$.setActive(o.object,!0))}}})}awake(){if(gJ&&console.log(this),!!this.trackedImages){for(const e of this.trackedImages)if(e.image&&!LC._imageElements.has(e.image)){const t=e.image;LC._imageElements.set(t,null);const i=document.createElement("img");i.src=t,i.addEventListener("load",async()=>{const n=await createImageBitmap(i);LC._imageElements.set(t,n);const r=await _oe(n);if(r){const a=await(await r.convertToBlob({type:"image/png"})).arrayBuffer(),l=$.findObjectOfType(ds);l&&this.trackedImages&&(l.extensions.push(new DOe("marker.png",new Uint8Array(a),this.trackedImages[0].widthInMeters)),l.anchoringType="image")}})}}}onBeforeXR(e,t){var i;if(this.trackedImages){t.optionalFeatures=t.optionalFeatures||[],t.optionalFeatures.includes("image-tracking")||t.optionalFeatures.push("image-tracking"),t.trackedImages=[];for(const n of this.trackedImages)if((i=n.image)!=null&&i.length&&n.widthInMeters>0){const r=LC._imageElements.get(n.image);r&&(this.trackedImageIndexMap.set(t.trackedImages.length,n),t.trackedImages.push({image:r,widthInMeters:n.widthInMeters}))}}}onEnterXR(e){var t;if(this.trackedImages){for(const i of this.trackedImages)if((t=i.object)!=null&&t.asset){const n=i.object.asset;n.userData||(n.userData={});const r={visible:n.visible,parent:n.parent,matrix:n.matrix.clone()};n.userData["image-tracking"]=r}}for(const i of this.imageToObjectMap.values())i.frames=0}onLeaveXR(e){var t,i;if(this.trackedImages){for(const n of this.trackedImages)if((t=n.object)!=null&&t.asset){const r=n.object.asset;if(r.userData){const o=r.userData["image-tracking"];o&&(r.visible=o.visible,(i=o.parent)==null||i.add(r),r.matrix.copy(o.matrix),r.matrix.decompose(r.position,r.quaternion,r.scale)),delete r.userData["image-tracking"]}}}}onUpdateXR(e){var n;this.currentImages.length=0;const t=e.xr.frame;if(!t)return;if("getImageTrackingResults"in t){if(((n=e.xr.session.enabledFeatures)==null?void 0:n.includes("image-tracking"))===!1)return;if(t.session&&typeof t.getImageTrackingResults=="function"){const r=t.getImageTrackingResults();if(r.length>0){const o=this.context.renderer.xr.getReferenceSpace();if(o){for(const a of r){const l=a.trackingState,c=a.index,h=this.trackedImageIndexMap.get(c);if(h){const d=t.getPose(a.imageSpace,o),u=new zf(this,h,a.image,a.measuredSize,l,d);this.currentImages.push(u)}else gJ&&console.warn("No tracked image for index",c)}if(this.currentImages.length>0)try{this.dispatchEvent(new CustomEvent("image-tracking",{detail:this.currentImages})),this.onImageTrackingUpdate(this.currentImages)}catch(a){console.error(a)}}}}}else{const r=`Image tracking is currently not supported on this device. On Chrome for Android, you can enable the <a target="_blank" href="#" onclick="() => console.log('I')">chrome://flags/#webxr-incubations</a> flag.`;this.didPrintWarning||(this.didPrintWarning=!0,console.log(r)),An(r);return}const i=1e3;for(const[r,o]of this.imageToObjectMap){if(!o.object||!r||r.hideWhenTrackingIsLost===!1)continue;let a=!1;for(const l of this.currentImages)if(l.model===r){const c=Date.now()-o.lastTrackingTime;if(r.imageDoesNotMove||l.state==="tracked"||c<=i){a=!0;break}}a||$.setActive(o.object,!1)}}},p(NF,"_imageElements",new Map),NF);let Dx=LC;WA([I(pu)],Dx.prototype,"trackedImages",2);const F_=new T,V_=new T,AJ=new ei;class FOe extends sa{constructor(e,t=1,i=16711680){const n=new It,r=e.geometry.attributes.normal.count,o=new ut(r*2*3,3);n.setAttribute("position",o),super(n,new _n({color:i,toneMapped:!1})),this.object=e,this.size=t,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0),AJ.getNormalMatrix(this.object.matrixWorld);const e=this.object.matrixWorld,t=this.geometry.attributes.position,i=this.object.geometry;if(i){const n=i.attributes.position,r=i.attributes.normal;let o=0;for(let a=0,l=n.count;a<l;a++)F_.fromBufferAttribute(n,a).applyMatrix4(e),V_.fromBufferAttribute(r,a),V_.applyMatrix3(AJ).normalize().multiplyScalar(this.size).add(F_),t.setXYZ(o,F_.x,F_.y,F_.z),o=o+1,t.setXYZ(o,V_.x,V_.y,V_.z),o=o+1}t.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}var VOe=Object.defineProperty,zOe=Object.getOwnPropertyDescriptor,Bv=(s,e,t,i)=>{for(var n=i>1?void 0:i?zOe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&VOe(e,t,n),n};const kg=ee("debugplanetracking");class Xp extends ze{constructor(){super(...arguments);p(this,"dataTemplate");p(this,"occluder",!0);p(this,"initiateRoomCaptureIfNoData",!0);p(this,"usePlaneData",!0);p(this,"useMeshData",!0);p(this,"runInVR",!0);p(this,"bounds",new oi);p(this,"center",new T);p(this,"labelOffset",new T);p(this,"_dataId",1);p(this,"_allPlanes",new Map);p(this,"_allMeshes",new Map);p(this,"firstTimeNoPlanesDetected",-100);p(this,"makeOccluder",(t,i,n=!1)=>{if(i){if(i instanceof Array){for(const r of i)this.makeOccluder(t,r,n);return}!n&&!i.name.toLowerCase().includes("occlu")||(i.colorWrite=!1,i.depthTest=!0,i.depthWrite=!0,i.transparent=!1,i.polygonOffset=!0,i.polygonOffsetFactor=1,i.polygonOffsetUnits=.1,t.renderOrder=-1e3)}});p(this,"_flipForwardMatrix",new ce().makeRotationY(Math.PI));p(this,"_verticesCache",new Map)}get trackedPlanes(){return this._allPlanes.values()}get trackedMeshes(){return this._allMeshes.values()}onBeforeXR(t,i){t==="immersive-vr"&&!this.runInVR||(i.optionalFeatures=i.optionalFeatures||[],this.usePlaneData&&!i.optionalFeatures.includes("plane-detection")&&i.optionalFeatures.push("plane-detection"),this.useMeshData&&!i.optionalFeatures.includes("mesh-detection")&&i.optionalFeatures.push("mesh-detection"))}onEnterXR(t){for(const i of this._allPlanes.keys())this.removeData(i,this._allPlanes);for(const i of this._allMeshes.keys())this.removeData(i,this._allMeshes)}onLeaveXR(t){for(const i of this._allPlanes.keys())this.removeData(i,this._allPlanes);for(const i of this._allMeshes.keys())this.removeData(i,this._allMeshes)}onUpdateXR(t){if(!this.runInVR&&t.xr.isVR)return;const i=t.xr.rig;if(!i){console.warn("No XR rig found, cannot parent tracked planes to it");return}const n=t.xr.frame;if(!this.context.renderer.xr.getReferenceSpace())return;const a=n.detectedPlanes,l=n.detectedMeshes,c=a!==void 0&&a.size>0,h=l!==void 0&&l.size>0;if(this.initiateRoomCaptureIfNoData&&(!c&&!h&&this.firstTimeNoPlanesDetected<-10&&(this.firstTimeNoPlanesDetected=Date.now()),(c||h)&&(this.firstTimeNoPlanesDetected=-1),this.firstTimeNoPlanesDetected>0&&Date.now()-this.firstTimeNoPlanesDetected>2500&&"initiateRoomCapture"in n.session&&(n.session.initiateRoomCapture(),this.firstTimeNoPlanesDetected=-1)),a!==void 0&&this.processFrameData(t.xr,i.gameObject,n,a,this._allPlanes),l!==void 0&&this.processFrameData(t.xr,i.gameObject,n,l,this._allMeshes),kg){const d=this.context.mainCameraComponent.gameObject.worldPosition;for(const u of this._allPlanes.values())!u.mesh||!u.mesh.visible||(this.bounds.makeEmpty(),u.mesh.traverse(f=>{f instanceof fe&&this.bounds.expandByObject(f)}),this.bounds.getCenter(this.center),this.labelOffset.copy(d).sub(this.center).normalize().multiplyScalar(.1),Mt.DrawLabel(this.center.add(this.labelOffset),(u.xrData.semanticLabel||"plane").toUpperCase()+`
`+u.xrData.lastChangedTime.toFixed(2),.02))}}removeData(t,i){const n=i.get(t);if(!n)return;i.delete(t),kg&&console.log("Plane no longer tracked, id="+n.id),n.mesh&&(n.mesh.removeFromParent(),n.mesh.traverse(o=>{const a=o.userData.normalsHelper;a?(a.dispose(),a.removeFromParent()):kg&&console.warn("No normals helper found for mesh",n.mesh)}),ic(n.mesh,!0,!0));const r=new CustomEvent("plane-tracking",{detail:{type:"plane-removed",context:n}});this.dispatchEvent(r)}processFrameData(t,i,n,r,o){const l=this.context.renderer.xr.getReferenceSpace();if(l){for(const c of o.keys())r.has(c)||this.removeData(c,o);for(const c of r){const h="planeSpace"in c?c.planeSpace:"meshSpace"in c?c.meshSpace:void 0;if(!h)continue;const d=n.getPose(h,l);let u;if(o.has(c)){const f=o.get(c);if(u=f.mesh,f.timestamp<c.lastChangedTime){if(f.timestamp=c.lastChangedTime,f.mesh){const g=this.createGeometry(c);if(f.mesh instanceof fe)f.mesh.geometry.dispose(),f.mesh.geometry=g,this.makeOccluder(f.mesh,f.mesh.material);else if(f.mesh instanceof Ms)for(const A of f.mesh.children)A instanceof fe&&(A.geometry.dispose(),A.geometry=g,this.makeOccluder(A,A.material));if(f.collider){const A=f.mesh;f.collider.sharedMesh=A,f.collider.convex=this.checkIfContextShouldBeConvex(A,f.xrData),f.collider.onDisable(),f.collider.onEnable()}kg&&(console.log("Plane updated, id="+f.id,f),f.mesh.traverse(A=>{if(!(A instanceof fe))return;const y=A.userData.normalsHelper;y&&y.update()}))}const m=new CustomEvent("plane-tracking",{detail:{type:"plane-updated",context:f}});this.dispatchEvent(m)}}else{if(!this.dataTemplate){const f=new fe;kg?f.material=new I1:this.occluder?(f.material=new ii,this.makeOccluder(f,f.material,!0)):f.material=new ii({wireframe:!0,opacity:.5,transparent:!0,color:3355443}),this.dataTemplate=new gi("","",f)}if(!this.dataTemplate.asset)this.dataTemplate.loadAssetAsync();else{const f=$.instantiate(this.dataTemplate.asset);if(f.name="xr-tracked-plane",u=f,xO(f,!1),f instanceof fe)Rn(f.geometry),f.geometry=this.createGeometry(c),this.makeOccluder(f,f.material,this.occluder);else if(f instanceof Ms)for(const A of f.children)A instanceof fe&&(Rn(A.geometry),A.geometry=this.createGeometry(c),this.makeOccluder(A,A.material,this.occluder));const m=f.getComponent(TA);if(m){const A=f;m.sharedMesh=A,m.convex=this.checkIfContextShouldBeConvex(A,c),m.onDisable(),m.onEnable()}f.matrixAutoUpdate=!1,f.matrixWorldNeedsUpdate=!0,i.add(f);const g={id:this._dataId++,xrData:c,timestamp:c.lastChangedTime,mesh:f,collider:m};o.set(c,g),kg&&console.log("New plane detected, id="+g.id,g,{hasCollider:!!m,isGroup:f instanceof Ms});try{const A=new CustomEvent("plane-tracking",{detail:{type:"plane-added",context:g}});this.dispatchEvent(A)}catch(A){console.error(A)}}}u&&(d?(u.visible=!0,u.matrix.fromArray(d.transform.matrix),u.matrix.premultiply(this._flipForwardMatrix)):u.visible=!1,kg&&u.traverse(f=>{if(f instanceof fe)if(f.userData.normalsHelper)f.userData.normalsHelper.update();else{const m=new FOe(f,.05,255);m.layers.disableAll(),m.layers.set(2),this.context.scene.add(m),f.userData.normalsHelper=m}}))}}}checkIfContextShouldBeConvex(t,i){if(!t)return!0;if(t){const n=new oi;n.expandByObject(t);const r=new T;n.getSize(r);let o=!0;return r.x>2&&r.y>2&&r.z>1.5&&(o=!1),o&&"semanticLabel"in i&&i.semanticLabel==="wall"&&(o=!0),o}return!0}createGeometry(t){return"polygon"in t?this.createPlaneGeometry(t.polygon):"vertices"in t&&"indices"in t?this.createMeshGeometry(t.vertices,t.indices):new It}createMeshGeometry(t,i){const n=t.toString()+"_"+i.toString();if(this._verticesCache.has(n))return this._verticesCache.get(n);const r=new It;r.setIndex(new dt(i,1)),r.setAttribute("position",new dt(t,3));const o=Array();for(let a=0;a<t.length;a+=3)o.push(t[a],t[a+2]);return r.setAttribute("uv",new dt(t,3)),r.computeVertexNormals(),this._verticesCache.set(n,r),r}createPlaneGeometry(t){const i=new It,n=[],r=[];t.forEach(f=>{n.push(f.x,f.y,f.z),r.push(f.x,f.z)});const o=new T(n[0],n[1],n[2]),a=new T(n[3],n[4],n[5]),l=new T(n[6],n[7],n[8]),c=new T,h=new T;c.subVectors(a,o),h.subVectors(l,o),c.cross(h),c.normalize();const d=[];for(let f=0;f<n.length/3;f++)d.push(c.x,c.y,c.z);const u=[];for(let f=2;f<t.length;++f)u.push(0,f-1,f);return i.setAttribute("position",new dt(new Float32Array(n),3)),i.setAttribute("uv",new dt(new Float32Array(r),2)),i.setAttribute("normal",new dt(new Float32Array(d),3)),i.setIndex(u),i.computeBoundingBox(),i.computeBoundingSphere(),i}}Bv([I(gi)],Xp.prototype,"dataTemplate",2);Bv([I()],Xp.prototype,"occluder",2);Bv([I()],Xp.prototype,"initiateRoomCaptureIfNoData",2);Bv([I()],Xp.prototype,"usePlaneData",2);Bv([I()],Xp.prototype,"useMeshData",2);Bv([I()],Xp.prototype,"runInVR",2);var UOe=Object.defineProperty,XOe=Object.getOwnPropertyDescriptor,Pv=(s,e,t,i)=>{for(var n=i>1?void 0:i?XOe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&UOe(e,t,n),n};class Op extends ze{constructor(){super(...arguments);p(this,"side","none");p(this,"controller",!0);p(this,"hands",!1);p(this,"controlVisibility",!0);p(this,"useGripSpace",!1);p(this,"resetTransformAfterXRSession",!0);p(this,"_startPosition",new T);p(this,"_startRotation",new Ve);p(this,"_startScale",new T)}get activeAndEnabled(){return!0}onEnterXR(t){this._startPosition.copy(this.gameObject.position),this._startRotation.copy(this.gameObject.quaternion),this._startScale.copy(this.gameObject.scale)}onUpdateXR(t){const i=t.xr.getController(this.side);if(i){if(i.hand&&!this.hands){this.controlVisibility&&(this.gameObject.visible=!1);return}else if(!this.controller){this.controlVisibility&&(this.gameObject.visible=!1);return}this.controlVisibility&&(this.gameObject.visible=!0),this.useGripSpace||i.targetRayMode==="transient-pointer"?(this.gameObject.worldPosition=i.gripWorldPosition,this.gameObject.worldQuaternion=i.gripWorldQuaternion,this.gameObject.worldScale=St(i.xr.rigScale,i.xr.rigScale,i.xr.rigScale).multiply(this._startScale)):(this.gameObject.worldPosition=i.rayWorldPosition,this.gameObject.worldQuaternion=i.rayWorldQuaternion,this.gameObject.worldScale=St(i.xr.rigScale,i.xr.rigScale,i.xr.rigScale).multiply(this._startScale))}}onLeaveXR(t){this.resetTransformAfterXRSession&&(this.gameObject.position.copy(this._startPosition),this.gameObject.quaternion.copy(this._startRotation),this.gameObject.scale.copy(this._startScale))}}Pv([I()],Op.prototype,"side",2);Pv([I()],Op.prototype,"controller",2);Pv([I()],Op.prototype,"hands",2);Pv([I()],Op.prototype,"controlVisibility",2);Pv([I()],Op.prototype,"useGripSpace",2);Pv([I()],Op.prototype,"resetTransformAfterXRSession",2);var OOe=Object.defineProperty,ZOe=Object.getOwnPropertyDescriptor,WOe=(s,e,t,i)=>{for(var n=i>1?void 0:i?ZOe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&OOe(e,t,n),n};const yJ=ee("debugwebxr");class aG extends ze{constructor(){super(...arguments);p(this,"priority",0);p(this,"_startScale")}get isActive(){return this.activeAndEnabled&&this.gameObject.visible}setAsActiveXRRig(){var t;(t=Vt.active)==null||t.setRigActive(this)}awake(){if(yJ){const t=new ye;t.position.y+=.5,this.gameObject.add(t);const i=t.addNewComponent(EA);i&&(i.isGizmo=!1);const n=new al(.5);this.gameObject.add(n)}}isXRRig(){return!0}supportsXR(t){return!0}onEnterXR(t){this._startScale=this.gameObject.scale.clone(),t.xr.addRig(this),yJ&&console.log("WebXR: add Rig",this.name,this.priority)}onLeaveXR(t){t.xr.removeRig(this),this._startScale&&this.gameObject&&this.gameObject.scale.copy(this._startScale)}}WOe([I()],aG.prototype,"priority",2);class LZ{}const HOe=Object.freeze(Object.defineProperty({__proto__:null,ActionBuilder:zi,ActionCollection:S5,ActionModel:_a,AlignmentConstraint:mM,Animation:na,AnimationCurve:wA,AnimationExtension:gM,AnimationTrackHandler:LP,Animator:Ro,AnimatorController:Jl,Antialiasing:CM,AudioExtension:Xm,AudioListener:em,AudioSource:fs,AudioTrackHandler:P0,Avatar:bm,AvatarBlink_Simple:MA,AvatarEyeLook_Rotation:uv,AvatarLoader:z5,AvatarMarker:br,AvatarModel:kP,Avatar_Brain_LookAt:wS,Avatar_MouthShapes:SM,Avatar_MustacheShake:F5,Avatar_POI:Wd,AxesHelper:pv,BaseUIComponent:Xc,BasicIKConstraint:X5,BehaviorExtension:NP,BehaviorModel:er,BloomEffect:IA,BoxCollider:mv,BoxGizmo:EA,BoxHelperComponent:il,Button:kp,CallInfo:Cd,Camera:Cn,CameraTargetReachedEvent:_S,Canvas:Lo,CanvasGroup:xm,CapsuleCollider:Ep,ChangeMaterialOnClick:yv,ChangeTransformOnClick:LA,CharacterController:PA,CharacterControllerInput:Dp,ChromaticAberration:LM,Collider:ul,ColorAdjustments:Qm,ColorBySpeedModule:GA,ColorOverLifetimeModule:PM,ContactShadows:Hh,ControlTrackHandler:BP,CustomBranding:qm,Deletable:oZ,DeleteBox:F0,DepthOfField:Qh,DeviceFlag:HP,DocumentExtension:aZ,DragControls:sl,DropListener:zp,DropListenerAddedEvent:QP,Duplicatable:DA,EffectWrapper:TS,EmissionModule:lu,EmphasizeOnClick:bv,EventList:Tn,EventListEvent:IP,EventSystem:nl,EventTrigger:YP,FieldWithDefault:iZ,FixedJoint:pZ,FlyControls:fZ,Fog:Sv,GltfExport:DM,GltfExportBox:gZ,Gradient:Km,Graphic:RA,GraphicRaycaster:TP,GridHelper:Mv,GridLayoutGroup:J5,GroundProjectedEnv:ou,GroupActionModel:up,HideOnStart:q5,HingeJoint:NM,HorizontalLayoutGroup:Y5,Image:Av,InheritVelocityModule:Jm,InputField:FA,InstanceHandle:k0,InstancingHandler:tm,Interactable:rZ,Keyframe:Ea,LODGroup:VM,LODModel:VA,Light:fl,LimitVelocityOverLifetimeModule:cr,LogStats:yZ,LookAt:zA,LookAtConstraint:SA,MainModule:No,MaskableGraphic:IM,MeshCollider:TA,MeshRenderer:BM,MinMaxCurve:Gt,MinMaxGradient:za,NeedleMenu:hu,NestedGltf:$P,Networking:Iv,NoiseModule:un,ObjectRaycaster:nc,OffsetConstraint:UA,OpenURL:Tv,OrbitControls:on,Outline:gv,Padding:Wm,ParticleBurst:IS,ParticleSubEmitter:tG,ParticleSystem:rr,ParticleSystemRenderer:Jc,PhysicsExtension:OP,PixelationEffect:UM,PlayAnimationOnClick:iA,PlayAudioOnClick:vm,PlayableDirector:ym,PlayerColor:Nx,PointerEventData:lv,PostProcessingHandler:iG,PreliminaryAction:xv,PreliminaryTrigger:EM,RawImage:FP,Rect:H5,RectTransform:oa,ReflectionProbe:vv,RegisteredAnimationInfo:pp,RemoteSkybox:tu,Renderer:Es,RendererLightmap:SS,Rigidbody:en,RotationBySpeedModule:lc,RotationOverLifetimeModule:Yc,SceneSwitcher:Ir,ScreenCapture:eg,ScreenSpaceAmbientOcclusion:Up,ScreenSpaceAmbientOcclusionN8:Kh,SetActiveOnClick:BA,ShadowCatcher:QM,ShapeModule:gs,SharpeningEffect:OM,SignalAsset:xM,SignalReceiver:hv,SignalReceiverEvent:cv,SignalTrackHandler:CS,Size:W5,SizeBySpeedModule:Ua,SizeOverLifetimeModule:Ym,SkinnedMeshRenderer:nZ,SmoothFollow:tg,SpatialGrabRaycaster:qf,SpatialHtml:KM,SpatialTrigger:JM,SpatialTriggerReceiver:Hd,SpectatorCamera:sG,SphereCollider:fv,Sprite:cu,SpriteData:_p,SpriteRenderer:pl,SpriteSheet:Cm,SubEmitterSystem:l1,SyncedCamera:rG,SyncedRoom:Yh,SyncedTransform:$d,TapGestureTrigger:$5,TeleportTarget:XP,TestRunner:IZ,TestSimulateUserData:TZ,Text:aa,TextBuilder:ZP,TextExtension:GM,TextureSheetAnimationModule:Do,TiltShiftEffect:uu,ToneMappingEffect:_m,TrailModule:os,TransformData:On,TransformGizmo:OA,TriggerBuilder:Or,TriggerModel:Zd,UIRaycastUtils:EP,UIRootComponent:yM,USDZExporter:ds,USDZText:Ff,USDZUIExtension:WP,UsageMarker:kM,VariantAction:w5,VelocityOverLifetimeModule:As,VerticalLayoutGroup:K5,VideoPlayer:Sr,Vignette:ZA,VisibilityAction:RM,Voip:Om,Volume:Lv,VolumeParameter:rt,VolumeProfile:_M,WebARCameraBackground:jM,WebARSessionRoot:Rp,WebXR:Ls,WebXRImageTracking:Dx,WebXRImageTrackingModel:pu,WebXRPlaneTracking:Xp,WebXRTrackedImage:zf,XRControllerFollow:Op,XRControllerModel:eu,XRControllerMovement:sc,XRFlag:Dl,XRRig:aG,XRState:xo,__Ignore:LZ},Symbol.toStringTag,{value:"Module"}));class QOe extends ze{constructor(){super(...arguments);p(this,"toggleKey","KeyP")}update(){this.context.input.isKeyDown(this.toggleKey)&&this.context.domElement.classList.toggle("presentation-mode")}}Y.add("__Ignore",LZ);Y.add("ActionBuilder",zi);Y.add("ActionCollection",S5);Y.add("ActionModel",_a);Y.add("AlignmentConstraint",mM);Y.add("Animation",na);Y.add("AnimationCurve",wA);Y.add("AnimationExtension",gM);Y.add("AnimationTrackHandler",LP);Y.add("Animator",Ro);Y.add("AnimatorController",Jl);Y.add("Antialiasing",CM);Y.add("AudioExtension",Xm);Y.add("AudioListener",em);Y.add("AudioSource",fs);Y.add("AudioTrackHandler",P0);Y.add("Avatar",bm);Y.add("Avatar_Brain_LookAt",wS);Y.add("Avatar_MouthShapes",SM);Y.add("Avatar_MustacheShake",F5);Y.add("Avatar_POI",Wd);Y.add("AvatarBlink_Simple",MA);Y.add("AvatarEyeLook_Rotation",uv);Y.add("AvatarLoader",z5);Y.add("AvatarMarker",br);Y.add("AvatarModel",kP);Y.add("AxesHelper",pv);Y.add("BaseUIComponent",Xc);Y.add("BasicIKConstraint",X5);Y.add("BehaviorExtension",NP);Y.add("BehaviorModel",er);Y.add("BloomEffect",IA);Y.add("BoxCollider",mv);Y.add("BoxGizmo",EA);Y.add("BoxHelperComponent",il);Y.add("Button",kp);Y.add("CallInfo",Cd);Y.add("Camera",Cn);Y.add("CameraTargetReachedEvent",_S);Y.add("Canvas",Lo);Y.add("CanvasGroup",xm);Y.add("CapsuleCollider",Ep);Y.add("ChangeMaterialOnClick",yv);Y.add("ChangeTransformOnClick",LA);Y.add("CharacterController",PA);Y.add("CharacterControllerInput",Dp);Y.add("ChromaticAberration",LM);Y.add("Collider",ul);Y.add("ColorAdjustments",Qm);Y.add("ColorBySpeedModule",GA);Y.add("ColorOverLifetimeModule",PM);Y.add("ContactShadows",Hh);Y.add("ControlTrackHandler",BP);Y.add("CustomBranding",qm);Y.add("Deletable",oZ);Y.add("DeleteBox",F0);Y.add("DepthOfField",Qh);Y.add("DeviceFlag",HP);Y.add("DocumentExtension",aZ);Y.add("DragControls",sl);Y.add("DropListener",zp);Y.add("DropListenerAddedEvent",QP);Y.add("Duplicatable",DA);Y.add("EffectWrapper",TS);Y.add("EmissionModule",lu);Y.add("EmphasizeOnClick",bv);Y.add("EventList",Tn);Y.add("EventListEvent",IP);Y.add("EventSystem",nl);Y.add("EventTrigger",YP);Y.add("FieldWithDefault",iZ);Y.add("FixedJoint",pZ);Y.add("FlyControls",fZ);Y.add("Fog",Sv);Y.add("GltfExport",DM);Y.add("GltfExportBox",gZ);Y.add("Gradient",Km);Y.add("Graphic",RA);Y.add("GraphicRaycaster",TP);Y.add("GridHelper",Mv);Y.add("GridLayoutGroup",J5);Y.add("GroundProjectedEnv",ou);Y.add("GroupActionModel",up);Y.add("HideOnStart",q5);Y.add("HingeJoint",NM);Y.add("HorizontalLayoutGroup",Y5);Y.add("Image",Av);Y.add("InheritVelocityModule",Jm);Y.add("InputField",FA);Y.add("InstanceHandle",k0);Y.add("InstancingHandler",tm);Y.add("Interactable",rZ);Y.add("Keyframe",Ea);Y.add("Light",fl);Y.add("LimitVelocityOverLifetimeModule",cr);Y.add("LODGroup",VM);Y.add("LODModel",VA);Y.add("LogStats",yZ);Y.add("LookAt",zA);Y.add("LookAtConstraint",SA);Y.add("MainModule",No);Y.add("MaskableGraphic",IM);Y.add("MeshCollider",TA);Y.add("MeshRenderer",BM);Y.add("MinMaxCurve",Gt);Y.add("MinMaxGradient",za);Y.add("NeedleMenu",hu);Y.add("NestedGltf",$P);Y.add("Networking",Iv);Y.add("NoiseModule",un);Y.add("ObjectRaycaster",nc);Y.add("OffsetConstraint",UA);Y.add("OpenURL",Tv);Y.add("OrbitControls",on);Y.add("Outline",gv);Y.add("Padding",Wm);Y.add("ParticleBurst",IS);Y.add("ParticleSubEmitter",tG);Y.add("ParticleSystem",rr);Y.add("ParticleSystemRenderer",Jc);Y.add("PhysicsExtension",OP);Y.add("PixelationEffect",UM);Y.add("PlayableDirector",ym);Y.add("PlayAnimationOnClick",iA);Y.add("PlayAudioOnClick",vm);Y.add("PlayerColor",Nx);Y.add("PlayerState",Xl);Y.add("PlayerSync",dv);Y.add("PointerEventData",lv);Y.add("PostProcessingHandler",iG);Y.add("PreliminaryAction",xv);Y.add("PreliminaryTrigger",EM);Y.add("PresentationMode",QOe);Y.add("RawImage",FP);Y.add("Rect",H5);Y.add("RectTransform",oa);Y.add("ReflectionProbe",vv);Y.add("RegisteredAnimationInfo",pp);Y.add("RemoteSkybox",tu);Y.add("Renderer",Es);Y.add("RendererLightmap",SS);Y.add("Rigidbody",en);Y.add("RotationBySpeedModule",lc);Y.add("RotationOverLifetimeModule",Yc);Y.add("SceneSwitcher",Ir);Y.add("ScreenCapture",eg);Y.add("ScreenSpaceAmbientOcclusion",Up);Y.add("ScreenSpaceAmbientOcclusionN8",Kh);Y.add("SetActiveOnClick",BA);Y.add("ShadowCatcher",QM);Y.add("ShapeModule",gs);Y.add("SharpeningEffect",OM);Y.add("SignalAsset",xM);Y.add("SignalReceiver",hv);Y.add("SignalReceiverEvent",cv);Y.add("SignalTrackHandler",CS);Y.add("Size",W5);Y.add("SizeBySpeedModule",Ua);Y.add("SizeOverLifetimeModule",Ym);Y.add("SkinnedMeshRenderer",nZ);Y.add("SmoothFollow",tg);Y.add("SpatialGrabRaycaster",qf);Y.add("SpatialHtml",KM);Y.add("SpatialTrigger",JM);Y.add("SpatialTriggerReceiver",Hd);Y.add("SpectatorCamera",sG);Y.add("SphereCollider",fv);Y.add("Sprite",cu);Y.add("SpriteData",_p);Y.add("SpriteRenderer",pl);Y.add("SpriteSheet",Cm);Y.add("SubEmitterSystem",l1);Y.add("SyncedCamera",rG);Y.add("SyncedRoom",Yh);Y.add("SyncedTransform",$d);Y.add("TapGestureTrigger",$5);Y.add("TeleportTarget",XP);Y.add("TestRunner",IZ);Y.add("TestSimulateUserData",TZ);Y.add("Text",aa);Y.add("TextBuilder",ZP);Y.add("TextExtension",GM);Y.add("TextureSheetAnimationModule",Do);Y.add("TiltShiftEffect",uu);Y.add("ToneMappingEffect",_m);Y.add("TrailModule",os);Y.add("TransformData",On);Y.add("TransformGizmo",OA);Y.add("TriggerBuilder",Or);Y.add("TriggerModel",Zd);Y.add("UIRaycastUtils",EP);Y.add("UIRootComponent",yM);Y.add("UsageMarker",kM);Y.add("USDZExporter",ds);Y.add("USDZText",Ff);Y.add("USDZUIExtension",WP);Y.add("VariantAction",w5);Y.add("VelocityOverLifetimeModule",As);Y.add("VerticalLayoutGroup",K5);Y.add("VideoPlayer",Sr);Y.add("Vignette",ZA);Y.add("VisibilityAction",RM);Y.add("Voip",Om);Y.add("Volume",Lv);Y.add("VolumeParameter",rt);Y.add("VolumeProfile",_M);Y.add("WebARCameraBackground",jM);Y.add("WebARSessionRoot",Rp);Y.add("WebXR",Ls);Y.add("WebXRImageTracking",Dx);Y.add("WebXRImageTrackingModel",pu);Y.add("WebXRPlaneTracking",Xp);Y.add("WebXRTrackedImage",zf);Y.add("XRControllerFollow",Op);Y.add("XRControllerModel",eu);Y.add("XRControllerMovement",sc);Y.add("XRFlag",Dl);Y.add("XRRig",aG);Y.add("XRState",xo);const fw=Ur,KOe=ee("debugtypestore");KOe&&console.log(Y);function YOe(s,e){const i=yre(s,e);return i!==void 0?i:null}const JOe=new sPe,oF=Symbol("deserialize-queue");async function jOe(s,e,t,i=null,n){if(!t){console.debug("Can not create component instances: gltf is null");return}let r=i;typeof r=="number"&&(r=new So(i));const o=e.indexOf("?");e=o===-1?e:e.substring(0,o);const a=new h5(t.scene);a.gltfId=e,a.context=s,a.gltf=t,a.nodeToObject=n==null?void 0:n.nodeToObjectMap,a.implementationInformation=JOe;let l=s[oF];if(l||(l=s[oF]=[]),t.scenes)for(const c of t.scenes)await eU(a,c,l);if(t.children)for(const c of t.children)await eU(a,c,l);s.new_scripts_pre_setup_callbacks.push(()=>{const c=s[oF];if(c){for(const h of c)qOe(h,a);c.length=0}if(r){const h={},d=[];$z(t,r,h,d);for(const u of t.scenes)$z(u,r,h,d);for(const u of d)u.resolveGuids(h)}})}const qz=Symbol("original-component-name"),Uy=new Map;function $z(s,e,t,i){if(e===null||!s)return;const n=s.guid,r=s.guid;r!=null&&r.length&&(Uy.has(r)||(fw&&console.log('Creating InstanceIdProvider with key "'+r+'" for object '+s.name),Uy.set(r,new So(r))));const o=r&&Uy.get(r)||e;if(s.guid=o.generateUUID(),n&&n!=="invalid"&&(t[n]=s.guid),s&&s.userData&&s.userData.components)for(const a of s.userData.components){if(a===null)continue;const l=a.guid;l?Uy.has(l)||(fw&&console.log('Creating InstanceIdProvider with key "'+l+'" for component '+a[qz]),Uy.set(l,new So(l))):fw&&console.warn("Can not create IdProvider: component "+a[qz]+" has no guid",a.guid);const c=Uy.get(l)||e,h=a.guid;a.guid=c.generateUUID(),h&&h!=="invalid"&&(t[h]=a.guid),a.resolveGuids&&i.push(a)}if(s.children)for(const a of s.children)$z(a,e,t,i)}const z_=[];async function eU(s,e,t,i){if(!e)return;const n=e.userData;if(n){const r=n.builtin_components;if(r&&r.length>0)for(const o of r)try{if(o===null)continue;const a=Y.get(o.name);if(a!=null){const l=new a;l.sourceId=s.gltfId,Lx(l,o,s.implementationInformation),l.context=s.context,"guid"in o&&(l[JC]=o.guid),l[qz]=o.name,R0(e,l,!1),t.push({instance:l,compData:o,obj:e}),l.isCamera&&s.context&&s.context.mainCamera===null&&l.tag==="MainCamera"&&s.context.setCurrentCamera(l)}else fw&&console.debug("unknown component: "+o.name),z_.includes(o.name)||z_.push(o.name)}catch(a){console.error(o.name+" - "+a.message,a)}if(z_.length>0){const o=z_.join(", ");console.warn("unknown components: "+o),z_.length=0,ka()&&is(`<strong>Unknown components in scene</strong>:

${o}

This could mean you forgot to add a npmdef to your ExportInfo
<a href="https://engine.needle.tools/docs/project_structure.html#creating-and-installing-a-npmdef" target="_blank">documentation</a>`,zl.Warn)}}if(e.children)for(const r of e.children)await eU(s,r,t)}function qOe(s,e){const{instance:t,compData:i,obj:n}=s;e.object=n,e.target=t,l2(t,i,e),fw&&console.debug("add "+i.name,i,t)}const B2=ee("debugfileformat");async function ule(s,e=!0){var i;if(e){const n=s,r=new URL(n,globalThis.location.origin);let o=null;const a=r.searchParams.get("filetype");switch(a&&(o=a.toUpperCase()),o!=null&&o.length||(o=(i=r.pathname.split(".").pop())==null?void 0:i.toUpperCase()),B2&&console.debug("Use file extension to determine type: "+o),o){case"GLTF":return"gltf";case"VRM":return"vrm";case"GLB":return"glb";case"FBX":return"fbx";case"USD":return"usd";case"USDA":return"usda";case"USDZ":return"usdz";case"OBJ":return"obj"}}const t=await fetch(s,{method:"GET",headers:{range:"bytes=0-32"}}).catch(n=>null);if(t!=null&&t.ok){const n=await t.arrayBuffer(),r=ple(n,t);return B2&&console.log("Determined file type from header: "+r),r}return"unknown"}function ple(s,e){if(s.byteLength<4)return"unknown";const t=new Uint8Array(s);if(B2&&console.warn(`Trying to determine file type from binary data
`,'"'+new TextDecoder().decode(s)+`"
`,t),t[0]==103&&t[1]==108&&t[2]==84&&t[3]==70)return console.debug("GLTF detected"),"glb";if(t[0]==80&&t[1]==75&&t[2]==3&&t[3]==4)return console.debug("USDZ detected"),"usdz";if(t[0]==80&&t[1]==88&&t[2]==82&&t[3]==45&&t[4]==85&&t[5]==83&&t[6]==68&&t[7]==67)return console.debug("Binary USD detected"),"usd";if(t[0]==35&&t[1]==117&&t[2]==115&&t[3]==100&&t[4]==97)return console.debug("ASCII USD detected"),"usda";if(t[0]==75&&t[1]==97&&t[2]==121&&t[3]==100&&t[4]==97&&t[5]==114&&t[6]==97&&t[7]==32)return console.debug("Binary FBX detected"),"fbx";if(t[0]==59&&t[1]==32&&t[2]==70&&t[3]==66&&t[4]==88&&t[5]==32)return console.debug("ASCII FBX detected"),"fbx";if(t[0]==35&&t[1]==32&&t[2]==66&&t[3]==108&&t[4]==101&&t[5]==110&&t[6]==100&&t[7]==101&&t[8]==114&&t[9]==32)return console.debug("OBJ detected"),"obj";if(t[0]==35&&t[1]==32&&t[2]==65&&t[3]==108&&t[4]==105&&t[5]==97&&t[6]==115&&t[7]==32&&t[8]==79&&t[9]==66&&t[10]==74)return console.debug("OBJ detected"),"obj";if(e.headers.has("content-type")){const i=e.headers.get("content-type");switch(console.debug("Content-Type: "+i),i){case"model/gltf+json":return"gltf";case"model/gltf-binary":return"glb";case"model/vrm":return"vrm";case"model/vnd.usdz+zip":return"usdz";case"model/vnd.usd+zip":return"usd";case"model/vnd.usda+zip":return"usda";case"model/fbx":return"fbx";case"model/obj":return"obj"}}if(t[0]==118&&t[1]==32||t[0]==102&&t[1]==32)return console.debug("OBJ detected (the file has no header and starts with vertex or face)"),"obj";if(t[0]==35&&t[1]==32&&t[2]==70&&t[3]==105&&t[4]==108&&t[5]==101&&t[6]==32&&t[7]==101&&t[8]==120&&t[9]==112&&t[10]==111&&t[11]==114&&t[12]==116&&t[13]==101&&t[14]==100&&t[15]==32&&t[16]==98&&t[17]==121&&t[18]==32&&t[19]==90&&t[20]==66&&t[21]==114&&t[22]==117&&t[23]==115&&t[24]==104)return console.debug("OBJ detected (exported by ZBrush)"),"obj";if(t[0]==109&&t[1]==116&&t[2]==108&&t[3]==108&&t[4]==105&&t[5]==98)return console.debug("OBJ detected (mtllib)"),"obj";if(Qe()||B2){const i=new TextDecoder().decode(s.slice(0,16));console.debug('Could not determine file type from binary data: "'+i+'..."',t)}else console.debug("Could not determine file type from binary data",t);return"unknown"}class BZ{createBuiltinComponents(e,t,i,n,r){return jOe(e,t,i,n,r)}writeBuiltinComponentData(e,t){return YOe(e,t)}parseSync(e,t,i,n){return yle(e,t,i,n)}loadSync(e,t,i,n,r){return GZ(e,t,i,n,r)}}V3(BZ);const fle=ee("printGltf")||ee("printgltf"),mle=ee("downloadgltf"),$Oe=ee("debugfileformat");var gle=(s=>(s[s.BeforeLoad=0]="BeforeLoad",s[s.AfterLoaded=1]="AfterLoaded",s[s.FinishedSetup=10]="FinishedSetup",s))(gle||{});class z0{constructor(e,t,i,n){p(this,"context");p(this,"loader");p(this,"path");p(this,"gltf");this.context=e,this.path=t,this.loader=i,this.gltf=n}}const im={};function e5e(s,e){im[s]=im[s]||[],im[s].push(e)}function t5e(s,e){if(im[s]){const t=im[s].indexOf(e);t>=0&&im[s].splice(t,1)}}function ox(s,e){if(im[s])for(const t of im[s])t(e)}async function Ale(s,e,t,i,n){fle&&console.warn("glTF",e,t),e.includes("?")&&(e=e.split("?")[0]),await kh().createBuiltinComponents(s,e,t,i,n)}async function PZ(s,e){const t=await ule(s)||"unknown";switch($Oe&&console.debug("Determined file type: "+t+" for url",s),t){case"unknown":{console.warn("Unknown file type. Assuming glTF:",s);const i=new Tp;return await C2(i,e,s),i}case"fbx":return new coe;case"obj":return new v5;case"usd":case"usda":case"usdz":return console.warn(t.toUpperCase()+" files are not supported."),null;default:console.warn("Unknown file type:",t);case"gltf":case"glb":case"vrm":{const i=new Tp;return await C2(i,e,s),i}}}async function yle(s,e,t,i){typeof t!="string"&&(console.warn("Parse gltf binary without path, this might lead to errors in resolving extensions. Please provide the source path of the gltf/glb file",t,typeof t),t=""),fle&&console.log("Parse glTF",t);const n=await PZ(t,s);if(!n)return;if(n instanceof v5){typeof e!="string"&&(e=new TextDecoder().decode(e));const a=n.parse(e);return{animations:a.animations,scene:a,scenes:[a]}}if(!(n instanceof Tp)){const a=n.parse(e,t);return vle(n,a),{animations:a.animations,scene:a,scenes:[a]}}const o=zP(n);return new Promise((a,l)=>{try{let c=t.split("?")[0].trimEnd();if(c.endsWith(".glb")||c.endsWith(".gltf")){const d=c.split("/");d.pop(),c=d.join("/"),c.endsWith("/")||(c+="/")}n.resourcePath=c,wP(n,s),ox(0,new z0(s,t,n));const h=s.mainCamera;n.parse(e,"",async d=>{tZ(t,d,s),ox(1,new z0(s,t,n,d)),await Ale(s,t,d,i,o),await ble(d.scene,s,h),ox(10,new z0(s,t,n,d)),a(d),mle&&xle(e)},d=>{console.error('Loading asset at "'+t+`" failed
`,d),a(void 0)})}catch(c){console.error(c),l(c)}})}async function GZ(s,e,t,i,n){i5e(e);const r=await PZ(e,s);if(!r)return;if(!(r instanceof Tp)){const a=await r.loadAsync(e,n);return vle(r,a),{animations:a.animations,scene:a,scenes:[a]}}const o=zP(r);return new Promise((a,l)=>{try{wP(r,s),ox(0,new z0(s,e,r));const c=s.mainCamera;r.load(e,async h=>{tZ(e,h,s),ox(1,new z0(s,e,r,h)),await Ale(s,t,h,i,o),await ble(h.scene,s,c),ox(10,new z0(s,e,r,h)),a(h),mle&&xle(e)},h=>{n==null||n.call(r,h)},h=>{console.error('Loading asset at "'+e+`" failed
`,h),a(void 0)})}catch(c){console.error(c),l(c)}})}async function ble(s,e,t){t||(t=e.mainCamera);try{t?await e.renderer.compileAsync(s,t,e.scene).catch(i=>{console.warn(i.message)}):BBe(s,e)}catch(i){console.warn((i==null?void 0:i.message)||i)}}function i5e(s){if(new URL(s,window.location.href).href.startsWith("file://")){const t=`Hi - it looks like you are trying to load a local file which will not work. You need to use a webserver to serve your files.
Please refer to the documentation on <a href="https://fwd.needle.tools/needle-engine/docs/local-server">https://docs.needle.tools</a> or ask for help in our <a href="https://discord.needle.tools">discord community</a>`;is(t),console.warn(t)}}function xle(s){if(typeof s=="string"){const e=document.createElement("a");e.href=s,e.download=s.split("/").pop(),e.click()}else{const e=new Blob([s],{type:"application/octet-stream"}),t=window.URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download="download.glb",i.click()}}function vle(s,e){if(e!=null&&e.isObject3D){const t=e;(s instanceof coe||s instanceof v5)&&t.traverse(i=>{const n=i;n!=null&&n.isMesh&&vO(n,n.material)})}}V3(BZ);const _s=ee("debugwebcomponent"),bJ="needle-engine",_le="vr",Cle="desktop",n5e=[aoe,_le,Cle],U_="ar-session-active",X_="desktop-session-active",s5e=["public-key","version","hash","src","camera-controls","loadstart","progress","loadfinished","dracoDecoderPath","dracoDecoderType","ktx2DecoderPath","tone-mapping","tone-mapping-exposure","background-blurriness","background-color"];class kZ extends HTMLElement{constructor(){super();p(this,"_context");p(this,"_overlay_ar");p(this,"_loadingProgress01",0);p(this,"_loadingView");p(this,"_previousSrc",null);p(this,"_didFullyLoad",!1);p(this,"_loadId",0);p(this,"_abortController",null);p(this,"_lastSourceFiles",null);p(this,"_createContextPromise",null);p(this,"onXRSessionStarted",()=>{var i;const t=this.context.xrSessionMode;t==="immersive-ar"?this.onEnterAR(this.context.xrSession):t==="immersive-vr"&&this.onEnterVR(this.context.xrSession),(i=this.context.xrSession)==null||i.addEventListener("end",()=>{this.dispatchEvent(new CustomEvent("xr-session-ended",{detail:{session:this.context.xrSession,context:this._context,sessionMode:t}})),t==="immersive-ar"?this.onExitAR(this.context.xrSession):t==="immersive-vr"&&this.onExitVR(this.context.xrSession)})});p(this,"onReady",()=>{var t;return(t=this._loadingView)==null?void 0:t.onLoadingFinished()});p(this,"onError",()=>{var t;return(t=this._loadingView)==null?void 0:t.setMessage("Loading failed!")});p(this,"_previouslyRegisteredMap",new Map);this._overlay_ar=new RGe,this.addEventListener("ready",this.onReady),soe(),this.attachShadow({mode:"open"});const t=document.createElement("template");t.innerHTML=`<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

    :host {
        position: absolute;
        display: block;
        width: max(600px, 100%);
        height: max(300px, 100%);
        touch-action: none;

        -webkit-tap-highlight-color: transparent;
    }

    @media (max-width: 600px) {
        :host {
            width: 100%;
        }
    }
    @media (max-height: 300px) {
        :host {
            height: 100%;
        }
    }

    :host > div.canvas-wrapper {
        width: 100%;
        height: 100%;
    }

    :host canvas {   
        position: absolute;
        user-select: none;
        -webkit-user-select: none;

        /** allow touch panning but no pinch zoom **/
        /** but this doesnt work yet: 
         * touch-action: pan-x, pan-y;
         **/
        
        -webkit-touch-callout: none;
        -webkit-user-drag: none;
        -webkit-user-modify: none;
    }
    :host .content {
        position: absolute;
        top: 0;
        width: 100%;
        height: 100%;
        visibility: visible;
        z-index: 500; /* < must be less than the webxr buttons element */
        pointer-events: none;
    }
    :host .overlay-content {
        position: absolute;
        user-select: auto;
        pointer-events: all;
    }
    :host slot[name="quit-ar"]:hover {
        cursor: pointer;
    }
    :host .quit-ar-button {
        position: absolute;
        // top: env(titlebar-area-y); /** this doesnt work **/
        top: 60px; /** camera access needs a bit more space **/
        right: 20px;
        z-index: 9999;
    }
</style>
<div class="canvas-wrapper"> <!-- this wrapper is necessary for WebXR https://github.com/meta-quest/immersive-web-emulator/issues/55 -->
    <canvas></canvas>
</div>
<div class="content">
    <slot class="overlay-content"></slot>
</div>
`,this.shadowRoot&&this.shadowRoot.appendChild(t.content.cloneNode(!0)),this._context=new Wt({domElement:this}),this.addEventListener("error",this.onError)}static get observedAttributes(){return s5e}get loadingProgress01(){return this._loadingProgress01}get loadingFinished(){return this.loadingProgress01>.999}get cameraControls(){const t=this.getAttribute("camera-controls");return t==null?null:!(t===null||t==="False"||t==="false"||t==="0"||t==="none")}getContext(){return new Promise((t,i)=>{if(this._context&&this.loadingFinished)t(this._context);else{const n=()=>{this.removeEventListener("loadfinished",n),this._context&&this.loadingFinished&&t(this._context)};this.addEventListener("loadfinished",n)}})}get context(){return this._context}async connectedCallback(){if(_s&&console.log("<needle-engine> connected"),this.setPublicKey(),this.setVersion(),this.addEventListener("xr-session-started",this.onXRSessionStarted),this.onSetupDesktop(),!this.getAttribute("src")){const i=globalThis["needle:codegen_files"];_s&&console.log('src is null, trying to load from globalThis["needle:codegen_files"]',i),i&&(_s&&console.log('globalThis["needle:codegen_files"]',i),this.setAttribute("src",i))}_s&&console.log("src",this.getAttribute("src"));const t=this._loadId;setTimeout(()=>{this.isConnected!==!1&&t===this._loadId&&this.onLoad()},1)}disconnectedCallback(){var n;this.removeEventListener("xr-session-started",this.onXRSessionStarted),this._didFullyLoad=!1;const t=this.getAttribute("keep-alive"),i=t==null||(t==null?void 0:t.length)>0&&t!=="true"&&t!=="1";_s&&console.warn('<needle-engine> disconnected, keep-alive: "'+t+'"',typeof t,"Dispose=",i),i?(_s&&console.warn("<needle-engine> dispose"),(n=this._context)==null||n.dispose(),this._context=null,this._lastSourceFiles=null,this._loadId+=1):_s&&console.warn("<needle-engine> is not disposed because keep-alive is set")}attributeChangedCallback(t,i,n){switch(_s&&console.log("attributeChangedCallback",t,i,n),t){case"src":_s&&console.warn(`<needle-engine src>
changed from "`,i,'" to "',n,'"'),this.onLoad();break;case"hash":this._context&&(this._context.hash=n);break;case"loadstart":case"progress":case"loadfinished":typeof n=="string"&&n.length>0&&(_s&&console.log(t+" attribute changed",n),this.registerEventFromAttribute(t,n));break;case"dracoDecoderPath":_s&&console.log("dracoDecoderPath",n),XK(n);break;case"dracoDecoderType":n==="wasm"||n==="js"?(_s&&console.log("dracoDecoderType",n),OK(n)):console.error("Invalid dracoDecoderType",n,"expected js or wasm");break;case"ktx2DecoderPath":_s&&console.log("ktx2DecoderPath",n),ZK(n);break;case"tone-mapping":{this.applyAttributes();break}case"tone-mapping-exposure":{this.applyAttributes();break}case"background-blurriness":{const r=parseFloat(n);r!=null&&this._context&&(this._context.scene.backgroundBlurriness=r);break}case"background-color":{this.applyAttributes();break}case"public-key":{n!=YC&&this.setPublicKey();break}case"version":{n!=Eh&&this.setVersion();break}}}async onLoad(){var g,A;if(!this.isConnected)return;if(this._context||(_s&&console.warn("Create new context"),this._context=new Wt({domElement:this})),!this._context){console.error("Needle Engine: Context not initialized");return}const t=this.getSourceFiles();if(!this.checkIfSourceHasChanged(t,this._lastSourceFiles))return;this._abortController&&(_s&&console.warn("Abort previous loading process"),this._abortController.abort(),this._abortController=null),this._lastSourceFiles=t;const i=++this._loadId;if((t==null||t.length<=0)&&(_s&&console.warn("Clear scene",t),this._context.clear(),i!==this._loadId))return;const n=this.getAttribute("alias");this.classList.add("loading");const r=Bh();this.ensureLoadStartIsRegistered();let o=this.dispatchEvent(new CustomEvent("loadstart",{detail:{context:this._context,alias:n},cancelable:!0}));if(r){const y=this.getAttribute("hide-loading-overlay");y!=null&&y!=="0"&&(o=!1)}o===!1&&!r&&(Qe()||(o=!0),console.warn("Needle Engine: You need a commercial license to override the default loading view. Visit https://needle.tools/pricing"),Qe()&&An('You need a <a target="_blank" href="https://needle.tools/pricing">commercial license</a> to override the default loading view. This will not work in production.')),!this._loadingView&&o&&(this._loadingView=new cw(this)),o&&(this._didFullyLoad!==!0?(g=this._loadingView)==null||g.onLoadingBegin("begin load"):setTimeout(()=>{this._loadingView&&this._loadingProgress01<.3&&this._loadId===i&&this._loadingView.onLoadingBegin("begin load")},300)),_s&&console.warn(`--------------
Needle Engine: Begin loading `+i+`
`,t),this.onBeforeBeginLoading();const a=[],l={context:this._context,name:"",progress:{},index:0,count:t.length,totalProgress01:this._loadingProgress01},c=new CustomEvent("progress",{detail:l}),h=new Array,d=new AbortController;this._abortController=d;const u={files:t,abortSignal:d.signal,onLoadingProgress:y=>{var x;if(d.signal.aborted)return;const b=y.index;!h[b]&&y.name&&(h[b]=r5e(y.name)),y.name=h[b],o&&((x=this._loadingView)==null||x.onLoadingUpdate(y)),l.name=y.name,l.progress=y.progress,this._loadingProgress01=b5(y),l.totalProgress01=this._loadingProgress01,this.dispatchEvent(c)},onLoadingFinished:(y,b,x)=>{d.signal.aborted||x&&a.push({src:b,file:x})}},f=this.getAttribute("hash");f!=null&&(this._context.hash=f),this._context.alias=n,this._createContextPromise=this._context.create(u);const m=await this._createContextPromise;if(this.applyAttributes(),_s&&console.warn(`--------------
Needle Engine: finished loading `+i+`
`,t,`Aborted? ${d.signal.aborted}`),d.signal.aborted){console.log("Loading finished but aborted...");return}if(this._loadId!==i){console.log("Load id changed during loading process");return}this._loadingProgress01=1,o&&m&&((A=this._loadingView)==null||A.onLoadingUpdate(1,"creating scene")),this._didFullyLoad=!0,this.classList.remove("loading"),this.classList.add("loading-finished"),this.dispatchEvent(new CustomEvent("loadfinished",{detail:{context:this._context,src:n,loadedFiles:a}}))}applyAttributes(){if(this._context.renderer){const n=this.getAttribute("tonemapping")||this.getAttribute("tone-mapping");switch(n==null?void 0:n.toLowerCase()){case"none":this._context.renderer.toneMapping=Zr;break;case"linear":this._context.renderer.toneMapping=aA;break;case"neutral":this._context.renderer.toneMapping=om;break;case"agx":this._context.renderer.toneMapping=lA;break;default:n!=null&&console.warn("Invalid tone-mapping attribute: "+n)}const r=this.getAttribute("tone-mapping-exposure");if(r!=null){const o=parseFloat(r);isNaN(o)||(this._context.renderer.toneMappingExposure=o)}}const t=this.getAttribute("background-blurriness");if(t!=null){const n=parseFloat(t);n!==void 0&&this._context&&(this._context.scene.backgroundBlurriness=n)}const i=this.getAttribute("background-color");if(this._context&&typeof i=="string"&&i.length>0){const n=this._context.scene.background;n instanceof ge?n.set(i):this._context.scene.background=new ge(i)}}internalSetLoadingMessage(t){var i;(i=this._loadingView)==null||i.setMessage(t)}getSourceFiles(){const t=this.getAttribute("src");if(!t)return[];let i;Array.isArray(t)?i=t:t.startsWith("[")&&t.endsWith("]")?i=JSON.parse(t):t.includes(",")?i=t.split(","):i=[t];for(let n=i.length-1;n>=0;n--){const r=i[n];(r==="null"||r==="undefined"||(r==null?void 0:r.length)<=0)&&i.splice(n,1)}return i}checkIfSourceHasChanged(t,i){if((t==null?void 0:t.length)!==(i==null?void 0:i.length)||t==null&&i!==null||t!==null&&i==null)return!0;if(t!==null&&i!==null){for(let n=0;n<(t==null?void 0:t.length);n++)if(t[n]!==i[n])return!0}return!1}ensureLoadStartIsRegistered(){const t=this.getAttribute("loadstart");t&&this.registerEventFromAttribute("loadstart",t)}registerEventFromAttribute(t,i){const n=this._previouslyRegisteredMap.get(t);if(n&&(this._previouslyRegisteredMap.delete(t),this.removeEventListener(t,n)),typeof i=="string"&&i.length>0)try{const r=(0,eval)(i);typeof r=="function"&&(this._previouslyRegisteredMap.set(t,r),this.addEventListener(t,o=>r==null?void 0:r.call(globalThis,this._context,o)))}catch(r){console.error("Error registering event "+t+'="'+i+`" failed with the following error:
`,r)}}setPublicKey(){YC.length>0&&this.setAttribute("public-key",YC)}setVersion(){Eh.length>0&&this.setAttribute("version",Eh)}getAROverlayContainer(){return this._overlay_ar.createOverlayContainer(this)}getVROverlayContainer(){for(let t=0;t<this.children.length;t++){const i=this.children[t];if(i.classList.contains("vr"))return i}return null}onEnterAR(t){var n;this.onSetupAR();const i=this.getAROverlayContainer();this._overlay_ar.onBegin(this._context,i,t),this.dispatchEvent(new CustomEvent("enter-ar",{detail:{session:t,context:this._context,htmlContainer:(n=this._overlay_ar)==null?void 0:n.ARContainer}}))}onExitAR(t){var i;this._overlay_ar.onEnd(this._context),this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-ar",{detail:{session:t,context:this._context,htmlContainer:(i=this._overlay_ar)==null?void 0:i.ARContainer}}))}onEnterVR(t){this.onSetupVR(),this.dispatchEvent(new CustomEvent("enter-vr",{detail:{session:t,context:this._context}}))}onExitVR(t){this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-vr",{detail:{session:t,context:this._context}}))}onSetupAR(){this.classList.add(U_),this.classList.remove(X_);const t=this.getAROverlayContainer();_s&&console.warn("onSetupAR:",t),t&&(t.classList.add(U_),t.classList.remove(X_)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,aoe))}onSetupVR(){this.classList.remove(U_),this.classList.remove(X_),this.foreachHtmlElement(t=>this.setupElementsForMode(t,_le))}onSetupDesktop(){this.classList.remove(U_),this.classList.add(X_);const t=this.getAROverlayContainer();t&&(t.classList.remove(U_),t.classList.add(X_)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,Cle))}setupElementsForMode(t,i,n=null){var o,a;if(t===((a=(o=this._context)==null?void 0:o.renderer)==null?void 0:a.domElement)||t.id==="VRButton"||t.id==="ARButton")return;if(t.classList.contains(i))t.style.visibility="visible",t.style.display==="none"&&(t.style.display="block");else for(const l of n5e)t.classList.contains(l)&&(t.style.visibility="hidden",t.style.display="none")}foreachHtmlElement(t){for(let i=0;i<this.children.length;i++){const n=this.children[i];n.style&&t(n)}}onBeforeBeginLoading(){const t=this.getAttribute("dracoDecoderPath");t&&(_s&&console.log("using custom draco decoder path",t),XK(t));const i=this.getAttribute("dracoDecoderType");i&&(_s&&console.log("using custom draco decoder type",i),OK(i));const n=this.getAttribute("ktx2DecoderPath");n&&(_s&&console.log("using custom ktx2 decoder path",n),ZK(n))}}typeof window<"u"&&!window.customElements.get(bJ)&&window.customElements.define(bJ,kZ);function r5e(s){if(s.startsWith("blob:"))return"blob";const e=s.split("/");let t=e[e.length-1];const i=t.indexOf("?");i>0&&(t=t.substring(0,i));const n=t.indexOf("=");n>0&&(t=t.substring(n));const r=t.split(".").pop(),a=r?["glb","gltf","usdz","usd","fbx","obj","mtl"].indexOf(r.toLowerCase()):-1;if(r&&a>=0&&(t=t.substring(0,t.length-r.length-1)),t=decodeURIComponent(t),t.length>3){let l="",c=!1;const h=["(",")","[","]","{","}",":",";",",",".","!","?"];for(let d=0;d<t.length;d++){let u=t[d];(u==="_"||u==="-")&&(u=" "),!(u===" "&&l.length<=0||h.includes(u)||(l.length===0&&(u=u.toUpperCase()),c&&u===" "))&&(c&&(u=u.toUpperCase()),c=!1,l+=u,u===" "&&(c=!0))}return Qe()&&t!==l&&console.debug('Generated display name: "'+t+'" → "'+l+'"'),l.trim()}return Qe()&&console.debug("Loading: use default name",t),t}const o5e=Object.freeze(Object.defineProperty({__proto__:null,NeedleEngineHTMLElement:kZ},Symbol.toStringTag,{value:"Module"}));function a5e(){Lh.registerWaitForInteraction(()=>{const s=CB.getContext();s.addEventListener("statechange",()=>{setTimeout(()=>{const e=s.state;(e==="suspended"||e==="interrupted")&&s.resume().then(()=>{console.log("AudioContext resumed successfully")}).catch(t=>{console.log("Failed to resume AudioContext: "+t)})},500)})})}setTimeout(a5e,1e3);const JR=ee("debughotreload");let c1=!1;const mw=new Map;function l5e(){return c1}function c5e(s){var i;if(c1)return;const t=s.constructor.name;mw.has(t)?(i=mw.get(t))==null||i.push(s):mw.set(t,[s])}function h5e(s){if(c1)return;const t=s.constructor.name,i=mw.get(t);if(!i)return;const n=i.indexOf(s);n!==-1&&i.splice(n,1)}let xJ=!1;function d5e(){if(JR||xJ)return;xJ=!0;const s=console.error;console.error=(...e)=>{if(e.length){const t=e[0];if(typeof t=="string"&&t.includes("[hmr] Failed to reload ")){console.log("[Needle Engine] Hot reloading failed"),window.location.reload();return}}s.apply(console,e)}}function u5e(s){JR&&console.log("[HMR] Apply changes",s,Object.keys(s)),d5e();for(const e of Object.keys(s))try{c1=!0;const t=Y.get(e);if(!t){JR&&console.log("[HMR] Type not found: "+e);continue}const i=s[e],n=mw.get(i.name);let r="[Needle Engine] Updating type: "+e;const o=(n==null?void 0:n.length)??-1;o>0?r+=" x"+o:r+=" - no instances",console.log(r);const a=Object.getOwnPropertyNames(t.prototype),l=Object.getOwnPropertyDescriptors(i.prototype);for(const c in l)l[c].writable&&(t.prototype[c]=s[e].prototype[c]);for(const c of a)l[c]||delete t.prototype[c];if(n){const c=new i,h=Object.getOwnPropertyDescriptors(c);for(const d of n){const u=d,f=u.isComponent===!0,m=f?u.activeAndEnabled:!0,g=f?u.context:void 0;try{if(f&&g&&np(u,g),f&&m&&(u.enabled=!1),d.onBeforeHotReloadFields&&d.onBeforeHotReloadFields()===!1)continue;for(const A in h)if(h[A].writable){if(d[A]===void 0)d[A]=c[A];else if(typeof d[A]=="function"&&!d[A].prototype){const b=d[A],x=b.name,v="bound ";if(x===v)continue;const _=b.name.substring(v.length),C=i.prototype[_];C&&(d[A]=C.bind(d))}}d.onAfterHotReloadFields&&d.onAfterHotReloadFields()}finally{f&&g&&r5(u,g),f&&m&&(u.enabled=!0)}}}}catch(t){if(JR)console.error(t);else return!1}finally{c1=!1,Ed(zl.Log,"Script changes applied (HMR)")}return!0}let Ie;const h1=new Array(128).fill(void 0);h1.push(void 0,null,!0,!1);h1.length;let NE=null;function vJ(){return NE!==null&&NE.byteLength!==0||(NE=new Int32Array(Ie.memory.buffer)),NE}const p5e=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&p5e.decode();function Bt(s,e){if(!(s instanceof e))throw new Error(`expected instance of ${e.name}`);return s.ptr}let DE=null;function f5e(){return DE!==null&&DE.byteLength!==0||(DE=new Float32Array(Ie.memory.buffer)),DE}let gw=128;function _J(s){if(gw==1)throw new Error("out of js stack");return h1[--gw]=s,gw}let FE=null;function m5e(){return FE!==null&&FE.byteLength!==0||(FE=new Uint32Array(Ie.memory.buffer)),FE}let Il=0;function Ng(s,e){const t=e(4*s.length,4)>>>0;return f5e().set(s,t/4),Il=s.length,t}function VE(s,e){const t=e(4*s.length,4)>>>0;return m5e().set(s,t/4),Il=s.length,t}const oo=Object.freeze({Ball:0,0:"Ball",Cuboid:1,1:"Cuboid",Capsule:2,2:"Capsule",Segment:3,3:"Segment",Polyline:4,4:"Polyline",Triangle:5,5:"Triangle",TriMesh:6,6:"TriMesh",HeightField:7,7:"HeightField",Compound:8,8:"Compound",ConvexPolyhedron:9,9:"ConvexPolyhedron",Cylinder:10,10:"Cylinder",Cone:11,11:"Cone",RoundCuboid:12,12:"RoundCuboid",RoundTriangle:13,13:"RoundTriangle",RoundCylinder:14,14:"RoundCylinder",RoundCone:15,15:"RoundCone",RoundConvexPolyhedron:16,16:"RoundConvexPolyhedron",HalfSpace:17,17:"HalfSpace"});typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawbroadphase_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawccdsolver_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawcharactercollision_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawcolliderset_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawcollidershapecasthit_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawcontactforceevent_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawcontactmanifold_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawcontactpair_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawdebugrenderpipeline_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawdeserializedworld_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawdynamicraycastvehiclecontroller_free(s>>>0));const g5e=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(s=>Ie.__wbg_raweventqueue_free(s>>>0));class A5e{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,g5e.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_raweventqueue_free(e)}constructor(e){const t=Ie.raweventqueue_new(e);return this.__wbg_ptr=t>>>0,this}drainCollisionEvents(e){try{Ie.raweventqueue_drainCollisionEvents(this.__wbg_ptr,_J(e))}finally{h1[gw++]=void 0}}drainContactForceEvents(e){try{Ie.raweventqueue_drainContactForceEvents(this.__wbg_ptr,_J(e))}finally{h1[gw++]=void 0}}clear(){Ie.raweventqueue_clear(this.__wbg_ptr)}}const CJ=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(s=>Ie.__wbg_rawgenericjoint_free(s>>>0));class qo{static __wrap(e){e>>>=0;const t=Object.create(qo.prototype);return t.__wbg_ptr=e,CJ.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,CJ.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_rawgenericjoint_free(e)}static generic(e,t,i,n){Bt(e,_t),Bt(t,_t),Bt(i,_t);const r=Ie.rawgenericjoint_generic(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n);return r===0?void 0:qo.__wrap(r)}static spring(e,t,i,n,r){Bt(n,_t),Bt(r,_t);const o=Ie.rawgenericjoint_spring(e,t,i,n.__wbg_ptr,r.__wbg_ptr);return qo.__wrap(o)}static rope(e,t,i){Bt(t,_t),Bt(i,_t);const n=Ie.rawgenericjoint_rope(e,t.__wbg_ptr,i.__wbg_ptr);return qo.__wrap(n)}static spherical(e,t){Bt(e,_t),Bt(t,_t);const i=Ie.rawgenericjoint_spherical(e.__wbg_ptr,t.__wbg_ptr);return qo.__wrap(i)}static prismatic(e,t,i,n,r,o){Bt(e,_t),Bt(t,_t),Bt(i,_t);const a=Ie.rawgenericjoint_prismatic(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n,r,o);return a===0?void 0:qo.__wrap(a)}static fixed(e,t,i,n){Bt(e,_t),Bt(t,mo),Bt(i,_t),Bt(n,mo);const r=Ie.rawgenericjoint_fixed(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr);return qo.__wrap(r)}static revolute(e,t,i){Bt(e,_t),Bt(t,_t),Bt(i,_t);const n=Ie.rawgenericjoint_revolute(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr);return n===0?void 0:qo.__wrap(n)}}typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawimpulsejointset_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawintegrationparameters_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawislandmanager_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawkinematiccharactercontroller_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawmultibodyjointset_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawnarrowphase_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawphysicspipeline_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawpointcolliderprojection_free(s>>>0));const wJ=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(s=>Ie.__wbg_rawpointprojection_free(s>>>0));class NZ{static __wrap(e){e>>>=0;const t=Object.create(NZ.prototype);return t.__wbg_ptr=e,wJ.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,wJ.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_rawpointprojection_free(e)}point(){const e=Ie.rawpointprojection_point(this.__wbg_ptr);return _t.__wrap(e)}isInside(){return Ie.rawpointprojection_isInside(this.__wbg_ptr)!==0}}typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawquerypipeline_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawraycolliderhit_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawraycolliderintersection_free(s>>>0));const SJ=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(s=>Ie.__wbg_rawrayintersection_free(s>>>0));class DZ{static __wrap(e){e>>>=0;const t=Object.create(DZ.prototype);return t.__wbg_ptr=e,SJ.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,SJ.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_rawrayintersection_free(e)}normal(){const e=Ie.rawcollidershapecasthit_witness1(this.__wbg_ptr);return _t.__wrap(e)}time_of_impact(){return Ie.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}featureType(){return Ie.rawpointcolliderprojection_featureType(this.__wbg_ptr)}featureId(){try{const i=Ie.__wbindgen_add_to_stack_pointer(-16);Ie.rawpointcolliderprojection_featureId(i,this.__wbg_ptr);var e=vJ()[i/4+0],t=vJ()[i/4+1];return e===0?void 0:t>>>0}finally{Ie.__wbindgen_add_to_stack_pointer(16)}}}typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawrigidbodyset_free(s>>>0));const MJ=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(s=>Ie.__wbg_rawrotation_free(s>>>0));class mo{static __wrap(e){e>>>=0;const t=Object.create(mo.prototype);return t.__wbg_ptr=e,MJ.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,MJ.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_rawrotation_free(e)}constructor(e,t,i,n){const r=Ie.rawrotation_new(e,t,i,n);return this.__wbg_ptr=r>>>0,this}static identity(){const e=Ie.rawrotation_identity();return mo.__wrap(e)}get x(){return Ie.rawrotation_x(this.__wbg_ptr)}get y(){return Ie.rawintegrationparameters_dt(this.__wbg_ptr)}get z(){return Ie.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}get w(){return Ie.rawrotation_w(this.__wbg_ptr)}}typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawsdpmatrix3_free(s>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(s=>Ie.__wbg_rawserializationpipeline_free(s>>>0));const IJ=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(s=>Ie.__wbg_rawshape_free(s>>>0));class ui{static __wrap(e){e>>>=0;const t=Object.create(ui.prototype);return t.__wbg_ptr=e,IJ.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,IJ.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_rawshape_free(e)}static cuboid(e,t,i){const n=Ie.rawshape_cuboid(e,t,i);return ui.__wrap(n)}static roundCuboid(e,t,i,n){const r=Ie.rawshape_roundCuboid(e,t,i,n);return ui.__wrap(r)}static ball(e){const t=Ie.rawshape_ball(e);return ui.__wrap(t)}static halfspace(e){Bt(e,_t);const t=Ie.rawshape_halfspace(e.__wbg_ptr);return ui.__wrap(t)}static capsule(e,t){const i=Ie.rawshape_capsule(e,t);return ui.__wrap(i)}static cylinder(e,t){const i=Ie.rawshape_cylinder(e,t);return ui.__wrap(i)}static roundCylinder(e,t,i){const n=Ie.rawshape_roundCylinder(e,t,i);return ui.__wrap(n)}static cone(e,t){const i=Ie.rawshape_cone(e,t);return ui.__wrap(i)}static roundCone(e,t,i){const n=Ie.rawshape_roundCone(e,t,i);return ui.__wrap(n)}static polyline(e,t){const i=Ng(e,Ie.__wbindgen_malloc),n=Il,r=VE(t,Ie.__wbindgen_malloc),o=Il,a=Ie.rawshape_polyline(i,n,r,o);return ui.__wrap(a)}static trimesh(e,t,i){const n=Ng(e,Ie.__wbindgen_malloc),r=Il,o=VE(t,Ie.__wbindgen_malloc),a=Il,l=Ie.rawshape_trimesh(n,r,o,a,i);return ui.__wrap(l)}static heightfield(e,t,i,n,r){const o=Ng(i,Ie.__wbindgen_malloc),a=Il;Bt(n,_t);const l=Ie.rawshape_heightfield(e,t,o,a,n.__wbg_ptr,r);return ui.__wrap(l)}static segment(e,t){Bt(e,_t),Bt(t,_t);const i=Ie.rawshape_segment(e.__wbg_ptr,t.__wbg_ptr);return ui.__wrap(i)}static triangle(e,t,i){Bt(e,_t),Bt(t,_t),Bt(i,_t);const n=Ie.rawshape_triangle(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr);return ui.__wrap(n)}static roundTriangle(e,t,i,n){Bt(e,_t),Bt(t,_t),Bt(i,_t);const r=Ie.rawshape_roundTriangle(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n);return ui.__wrap(r)}static convexHull(e){const t=Ng(e,Ie.__wbindgen_malloc),i=Il,n=Ie.rawshape_convexHull(t,i);return n===0?void 0:ui.__wrap(n)}static roundConvexHull(e,t){const i=Ng(e,Ie.__wbindgen_malloc),n=Il,r=Ie.rawshape_roundConvexHull(i,n,t);return r===0?void 0:ui.__wrap(r)}static convexMesh(e,t){const i=Ng(e,Ie.__wbindgen_malloc),n=Il,r=VE(t,Ie.__wbindgen_malloc),o=Il,a=Ie.rawshape_convexMesh(i,n,r,o);return a===0?void 0:ui.__wrap(a)}static roundConvexMesh(e,t,i){const n=Ng(e,Ie.__wbindgen_malloc),r=Il,o=VE(t,Ie.__wbindgen_malloc),a=Il,l=Ie.rawshape_roundConvexMesh(n,r,o,a,i);return l===0?void 0:ui.__wrap(l)}castShape(e,t,i,n,r,o,a,l,c,h){Bt(e,_t),Bt(t,mo),Bt(i,_t),Bt(n,ui),Bt(r,_t),Bt(o,mo),Bt(a,_t);const d=Ie.rawshape_castShape(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r.__wbg_ptr,o.__wbg_ptr,a.__wbg_ptr,l,c,h);return d===0?void 0:FZ.__wrap(d)}intersectsShape(e,t,i,n,r){return Bt(e,_t),Bt(t,mo),Bt(i,ui),Bt(n,_t),Bt(r,mo),Ie.rawshape_intersectsShape(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r.__wbg_ptr)!==0}contactShape(e,t,i,n,r,o){Bt(e,_t),Bt(t,mo),Bt(i,ui),Bt(n,_t),Bt(r,mo);const a=Ie.rawshape_contactShape(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r.__wbg_ptr,o);return a===0?void 0:VZ.__wrap(a)}containsPoint(e,t,i){return Bt(e,_t),Bt(t,mo),Bt(i,_t),Ie.rawshape_containsPoint(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr)!==0}projectPoint(e,t,i,n){Bt(e,_t),Bt(t,mo),Bt(i,_t);const r=Ie.rawshape_projectPoint(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n);return NZ.__wrap(r)}intersectsRay(e,t,i,n,r){return Bt(e,_t),Bt(t,mo),Bt(i,_t),Bt(n,_t),Ie.rawshape_intersectsRay(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r)!==0}castRay(e,t,i,n,r,o){return Bt(e,_t),Bt(t,mo),Bt(i,_t),Bt(n,_t),Ie.rawshape_castRay(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r,o)}castRayAndGetNormal(e,t,i,n,r,o){Bt(e,_t),Bt(t,mo),Bt(i,_t),Bt(n,_t);const a=Ie.rawshape_castRayAndGetNormal(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r,o);return a===0?void 0:DZ.__wrap(a)}}const TJ=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(s=>Ie.__wbg_rawshapecasthit_free(s>>>0));class FZ{static __wrap(e){e>>>=0;const t=Object.create(FZ.prototype);return t.__wbg_ptr=e,TJ.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,TJ.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_rawshapecasthit_free(e)}time_of_impact(){return Ie.rawrotation_x(this.__wbg_ptr)}witness1(){const e=Ie.rawshapecasthit_witness1(this.__wbg_ptr);return _t.__wrap(e)}witness2(){const e=Ie.rawcontactforceevent_total_force(this.__wbg_ptr);return _t.__wrap(e)}normal1(){const e=Ie.rawshapecasthit_normal1(this.__wbg_ptr);return _t.__wrap(e)}normal2(){const e=Ie.rawshapecasthit_normal2(this.__wbg_ptr);return _t.__wrap(e)}}const EJ=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(s=>Ie.__wbg_rawshapecontact_free(s>>>0));class VZ{static __wrap(e){e>>>=0;const t=Object.create(VZ.prototype);return t.__wbg_ptr=e,EJ.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,EJ.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_rawshapecontact_free(e)}distance(){return Ie.rawkinematiccharactercontroller_maxSlopeClimbAngle(this.__wbg_ptr)}point1(){const e=Ie.rawpointprojection_point(this.__wbg_ptr);return _t.__wrap(e)}point2(){const e=Ie.rawcollidershapecasthit_witness1(this.__wbg_ptr);return _t.__wrap(e)}normal1(){const e=Ie.rawcollidershapecasthit_witness2(this.__wbg_ptr);return _t.__wrap(e)}normal2(){const e=Ie.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return _t.__wrap(e)}}const RJ=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(s=>Ie.__wbg_rawvector_free(s>>>0));class _t{static __wrap(e){e>>>=0;const t=Object.create(_t.prototype);return t.__wbg_ptr=e,RJ.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,RJ.unregister(this),e}free(){const e=this.__destroy_into_raw();Ie.__wbg_rawvector_free(e)}static zero(){const e=Ie.rawvector_zero();return _t.__wrap(e)}constructor(e,t,i){const n=Ie.rawvector_new(e,t,i);return this.__wbg_ptr=n>>>0,this}get x(){return Ie.rawrotation_x(this.__wbg_ptr)}set x(e){Ie.rawvector_set_x(this.__wbg_ptr,e)}get y(){return Ie.rawintegrationparameters_dt(this.__wbg_ptr)}set y(e){Ie.rawintegrationparameters_set_dt(this.__wbg_ptr,e)}get z(){return Ie.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}set z(e){Ie.rawvector_set_z(this.__wbg_ptr,e)}xyz(){const e=Ie.rawvector_xyz(this.__wbg_ptr);return _t.__wrap(e)}yxz(){const e=Ie.rawvector_yxz(this.__wbg_ptr);return _t.__wrap(e)}zxy(){const e=Ie.rawvector_zxy(this.__wbg_ptr);return _t.__wrap(e)}xzy(){const e=Ie.rawvector_xzy(this.__wbg_ptr);return _t.__wrap(e)}yzx(){const e=Ie.rawvector_yzx(this.__wbg_ptr);return _t.__wrap(e)}zyx(){const e=Ie.rawvector_zyx(this.__wbg_ptr);return _t.__wrap(e)}}class y5e{constructor(e,t,i){this.x=e,this.y=t,this.z=i}}class Fe{static new(e,t,i){return new y5e(e,t,i)}static intoRaw(e){return new _t(e.x,e.y,e.z)}static zeros(){return Fe.new(0,0,0)}static fromRaw(e){if(!e)return null;let t=Fe.new(e.x,e.y,e.z);return e.free(),t}static copy(e,t){e.x=t.x,e.y=t.y,e.z=t.z}}class LJ{constructor(e,t,i,n){this.x=e,this.y=t,this.z=i,this.w=n}}class Bn{static identity(){return new LJ(0,0,0,1)}static fromRaw(e){if(!e)return null;let t=new LJ(e.x,e.y,e.z,e.w);return e.free(),t}static intoRaw(e){return new mo(e.x,e.y,e.z,e.w)}static copy(e,t){e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w}}class b5e{constructor(e){this.elements=e}get m11(){return this.elements[0]}get m12(){return this.elements[1]}get m21(){return this.m12}get m13(){return this.elements[2]}get m31(){return this.m13}get m22(){return this.elements[3]}get m23(){return this.elements[4]}get m32(){return this.m23}get m33(){return this.elements[5]}}class BJ{static fromRaw(e){const t=new b5e(e.elements());return e.free(),t}}var Aw,Jo,PJ,GJ,Ys,tU,Zs,kJ,NJ,DJ,P2,iU,FJ,G2,Db;(function(s){s[s.Dynamic=0]="Dynamic",s[s.Fixed=1]="Fixed",s[s.KinematicPositionBased=2]="KinematicPositionBased",s[s.KinematicVelocityBased=3]="KinematicVelocityBased"})(Aw||(Aw={}));class VJ{constructor(e,t,i){this.rawSet=e,this.colliderSet=t,this.handle=i}finalizeDeserialization(e){this.colliderSet=e}isValid(){return this.rawSet.contains(this.handle)}lockTranslations(e,t){return this.rawSet.rbLockTranslations(this.handle,e,t)}lockRotations(e,t){return this.rawSet.rbLockRotations(this.handle,e,t)}setEnabledTranslations(e,t,i,n){return this.rawSet.rbSetEnabledTranslations(this.handle,e,t,i,n)}restrictTranslations(e,t,i,n){this.setEnabledTranslations(e,t,i,n)}setEnabledRotations(e,t,i,n){return this.rawSet.rbSetEnabledRotations(this.handle,e,t,i,n)}restrictRotations(e,t,i,n){this.setEnabledRotations(e,t,i,n)}dominanceGroup(){return this.rawSet.rbDominanceGroup(this.handle)}setDominanceGroup(e){this.rawSet.rbSetDominanceGroup(this.handle,e)}additionalSolverIterations(){return this.rawSet.rbAdditionalSolverIterations(this.handle)}setAdditionalSolverIterations(e){this.rawSet.rbSetAdditionalSolverIterations(this.handle,e)}enableCcd(e){this.rawSet.rbEnableCcd(this.handle,e)}setSoftCcdPrediction(e){this.rawSet.rbSetSoftCcdPrediction(this.handle,e)}softCcdPrediction(){return this.rawSet.rbSoftCcdPrediction(this.handle)}translation(){let e=this.rawSet.rbTranslation(this.handle);return Fe.fromRaw(e)}rotation(){let e=this.rawSet.rbRotation(this.handle);return Bn.fromRaw(e)}nextTranslation(){let e=this.rawSet.rbNextTranslation(this.handle);return Fe.fromRaw(e)}nextRotation(){let e=this.rawSet.rbNextRotation(this.handle);return Bn.fromRaw(e)}setTranslation(e,t){this.rawSet.rbSetTranslation(this.handle,e.x,e.y,e.z,t)}setLinvel(e,t){let i=Fe.intoRaw(e);this.rawSet.rbSetLinvel(this.handle,i,t),i.free()}gravityScale(){return this.rawSet.rbGravityScale(this.handle)}setGravityScale(e,t){this.rawSet.rbSetGravityScale(this.handle,e,t)}setRotation(e,t){this.rawSet.rbSetRotation(this.handle,e.x,e.y,e.z,e.w,t)}setAngvel(e,t){let i=Fe.intoRaw(e);this.rawSet.rbSetAngvel(this.handle,i,t),i.free()}setNextKinematicTranslation(e){this.rawSet.rbSetNextKinematicTranslation(this.handle,e.x,e.y,e.z)}setNextKinematicRotation(e){this.rawSet.rbSetNextKinematicRotation(this.handle,e.x,e.y,e.z,e.w)}linvel(){return Fe.fromRaw(this.rawSet.rbLinvel(this.handle))}angvel(){return Fe.fromRaw(this.rawSet.rbAngvel(this.handle))}mass(){return this.rawSet.rbMass(this.handle)}effectiveInvMass(){return Fe.fromRaw(this.rawSet.rbEffectiveInvMass(this.handle))}invMass(){return this.rawSet.rbInvMass(this.handle)}localCom(){return Fe.fromRaw(this.rawSet.rbLocalCom(this.handle))}worldCom(){return Fe.fromRaw(this.rawSet.rbWorldCom(this.handle))}invPrincipalInertiaSqrt(){return Fe.fromRaw(this.rawSet.rbInvPrincipalInertiaSqrt(this.handle))}principalInertia(){return Fe.fromRaw(this.rawSet.rbPrincipalInertia(this.handle))}principalInertiaLocalFrame(){return Bn.fromRaw(this.rawSet.rbPrincipalInertiaLocalFrame(this.handle))}effectiveWorldInvInertiaSqrt(){return BJ.fromRaw(this.rawSet.rbEffectiveWorldInvInertiaSqrt(this.handle))}effectiveAngularInertia(){return BJ.fromRaw(this.rawSet.rbEffectiveAngularInertia(this.handle))}sleep(){this.rawSet.rbSleep(this.handle)}wakeUp(){this.rawSet.rbWakeUp(this.handle)}isCcdEnabled(){return this.rawSet.rbIsCcdEnabled(this.handle)}numColliders(){return this.rawSet.rbNumColliders(this.handle)}collider(e){return this.colliderSet.get(this.rawSet.rbCollider(this.handle,e))}setEnabled(e){this.rawSet.rbSetEnabled(this.handle,e)}isEnabled(){return this.rawSet.rbIsEnabled(this.handle)}bodyType(){return this.rawSet.rbBodyType(this.handle)}setBodyType(e,t){return this.rawSet.rbSetBodyType(this.handle,e,t)}isSleeping(){return this.rawSet.rbIsSleeping(this.handle)}isMoving(){return this.rawSet.rbIsMoving(this.handle)}isFixed(){return this.rawSet.rbIsFixed(this.handle)}isKinematic(){return this.rawSet.rbIsKinematic(this.handle)}isDynamic(){return this.rawSet.rbIsDynamic(this.handle)}linearDamping(){return this.rawSet.rbLinearDamping(this.handle)}angularDamping(){return this.rawSet.rbAngularDamping(this.handle)}setLinearDamping(e){this.rawSet.rbSetLinearDamping(this.handle,e)}recomputeMassPropertiesFromColliders(){this.rawSet.rbRecomputeMassPropertiesFromColliders(this.handle,this.colliderSet.raw)}setAdditionalMass(e,t){this.rawSet.rbSetAdditionalMass(this.handle,e,t)}setAdditionalMassProperties(e,t,i,n,r){let o=Fe.intoRaw(t),a=Fe.intoRaw(i),l=Bn.intoRaw(n);this.rawSet.rbSetAdditionalMassProperties(this.handle,e,o,a,l,r),o.free(),a.free(),l.free()}setAngularDamping(e){this.rawSet.rbSetAngularDamping(this.handle,e)}resetForces(e){this.rawSet.rbResetForces(this.handle,e)}resetTorques(e){this.rawSet.rbResetTorques(this.handle,e)}addForce(e,t){const i=Fe.intoRaw(e);this.rawSet.rbAddForce(this.handle,i,t),i.free()}applyImpulse(e,t){const i=Fe.intoRaw(e);this.rawSet.rbApplyImpulse(this.handle,i,t),i.free()}addTorque(e,t){const i=Fe.intoRaw(e);this.rawSet.rbAddTorque(this.handle,i,t),i.free()}applyTorqueImpulse(e,t){const i=Fe.intoRaw(e);this.rawSet.rbApplyTorqueImpulse(this.handle,i,t),i.free()}addForceAtPoint(e,t,i){const n=Fe.intoRaw(e),r=Fe.intoRaw(t);this.rawSet.rbAddForceAtPoint(this.handle,n,r,i),n.free(),r.free()}applyImpulseAtPoint(e,t,i){const n=Fe.intoRaw(e),r=Fe.intoRaw(t);this.rawSet.rbApplyImpulseAtPoint(this.handle,n,r,i),n.free(),r.free()}userForce(){return Fe.fromRaw(this.rawSet.rbUserForce(this.handle))}userTorque(){return Fe.fromRaw(this.rawSet.rbUserTorque(this.handle))}}(function(s){s[s.Revolute=0]="Revolute",s[s.Fixed=1]="Fixed",s[s.Prismatic=2]="Prismatic",s[s.Rope=3]="Rope",s[s.Spring=4]="Spring",s[s.Spherical=5]="Spherical",s[s.Generic=6]="Generic"})(Jo||(Jo={})),function(s){s[s.AccelerationBased=0]="AccelerationBased",s[s.ForceBased=1]="ForceBased"}(PJ||(PJ={})),function(s){s[s.LinX=1]="LinX",s[s.LinY=2]="LinY",s[s.LinZ=4]="LinZ",s[s.AngX=8]="AngX",s[s.AngY=16]="AngY",s[s.AngZ=32]="AngZ"}(GJ||(GJ={}));class Ku{constructor(){}static fixed(e,t,i,n){let r=new Ku;return r.anchor1=e,r.anchor2=i,r.frame1=t,r.frame2=n,r.jointType=Jo.Fixed,r}static spring(e,t,i,n,r){let o=new Ku;return o.anchor1=n,o.anchor2=r,o.length=e,o.stiffness=t,o.damping=i,o.jointType=Jo.Spring,o}static rope(e,t,i){let n=new Ku;return n.anchor1=t,n.anchor2=i,n.length=e,n.jointType=Jo.Rope,n}static generic(e,t,i,n){let r=new Ku;return r.anchor1=e,r.anchor2=t,r.axis=i,r.axesMask=n,r.jointType=Jo.Generic,r}static spherical(e,t){let i=new Ku;return i.anchor1=e,i.anchor2=t,i.jointType=Jo.Spherical,i}static prismatic(e,t,i){let n=new Ku;return n.anchor1=e,n.anchor2=t,n.axis=i,n.jointType=Jo.Prismatic,n}static revolute(e,t,i){let n=new Ku;return n.anchor1=e,n.anchor2=t,n.axis=i,n.jointType=Jo.Revolute,n}intoRaw(){let e,t,i=Fe.intoRaw(this.anchor1),n=Fe.intoRaw(this.anchor2),r=!1,o=0,a=0;switch(this.jointType){case Jo.Fixed:let l=Bn.intoRaw(this.frame1),c=Bn.intoRaw(this.frame2);t=qo.fixed(i,l,n,c),l.free(),c.free();break;case Jo.Spring:t=qo.spring(this.length,this.stiffness,this.damping,i,n);break;case Jo.Rope:t=qo.rope(this.length,i,n);break;case Jo.Prismatic:e=Fe.intoRaw(this.axis),this.limitsEnabled&&(r=!0,o=this.limits[0],a=this.limits[1]),t=qo.prismatic(i,n,e,r,o,a),e.free();break;case Jo.Generic:e=Fe.intoRaw(this.axis);let h=this.axesMask;t=qo.generic(i,n,e,h);break;case Jo.Spherical:t=qo.spherical(i,n);break;case Jo.Revolute:e=Fe.intoRaw(this.axis),t=qo.revolute(i,n,e),e.free()}return i.free(),n.free(),t}}(function(s){s[s.Average=0]="Average",s[s.Min=1]="Min",s[s.Multiply=2]="Multiply",s[s.Max=3]="Max"})(Ys||(Ys={}));class d1{constructor(e,t,i,n,r){this.distance=e,this.point1=t,this.point2=i,this.normal1=n,this.normal2=r}static fromRaw(e){if(!e)return null;const t=new d1(e.distance(),Fe.fromRaw(e.point1()),Fe.fromRaw(e.point2()),Fe.fromRaw(e.normal1()),Fe.fromRaw(e.normal2()));return e.free(),t}}(function(s){s[s.Vertex=0]="Vertex",s[s.Edge=1]="Edge",s[s.Face=2]="Face",s[s.Unknown=3]="Unknown"})(tU||(tU={}));class lG{constructor(e,t){this.point=e,this.isInside=t}static fromRaw(e){if(!e)return null;const t=new lG(Fe.fromRaw(e.point()),e.isInside());return e.free(),t}}class x5e{constructor(e,t){this.origin=e,this.dir=t}pointAt(e){return{x:this.origin.x+this.dir.x*e,y:this.origin.y+this.dir.y*e,z:this.origin.z+this.dir.z*e}}}class cG{constructor(e,t,i,n){this.featureType=tU.Unknown,this.featureId=void 0,this.timeOfImpact=e,this.normal=t,n!==void 0&&(this.featureId=n),i!==void 0&&(this.featureType=i)}static fromRaw(e){if(!e)return null;const t=new cG(e.time_of_impact(),Fe.fromRaw(e.normal()),e.featureType(),e.featureId());return e.free(),t}}class qM{constructor(e,t,i,n,r){this.time_of_impact=e,this.witness1=t,this.witness2=i,this.normal1=n,this.normal2=r}static fromRaw(e,t){if(!t)return null;const i=new qM(t.time_of_impact(),Fe.fromRaw(t.witness1()),Fe.fromRaw(t.witness2()),Fe.fromRaw(t.normal1()),Fe.fromRaw(t.normal2()));return t.free(),i}}class zZ extends qM{constructor(e,t,i,n,r,o){super(t,i,n,r,o),this.collider=e}static fromRaw(e,t){if(!t)return null;const i=new zZ(e.get(t.colliderHandle()),t.time_of_impact(),Fe.fromRaw(t.witness1()),Fe.fromRaw(t.witness2()),Fe.fromRaw(t.normal1()),Fe.fromRaw(t.normal2()));return t.free(),i}}class eo{static fromRaw(e,t){const i=e.coShapeType(t);let n,r,o,a,l,c,h;switch(i){case oo.Ball:return new UZ(e.coRadius(t));case oo.Cuboid:return n=e.coHalfExtents(t),new wle(n.x,n.y,n.z);case oo.RoundCuboid:return n=e.coHalfExtents(t),r=e.coRoundRadius(t),new Sle(n.x,n.y,n.z,r);case oo.Capsule:return l=e.coHalfHeight(t),c=e.coRadius(t),new Mle(l,c);case oo.Segment:return o=e.coVertices(t),new Ile(Fe.new(o[0],o[1],o[2]),Fe.new(o[3],o[4],o[5]));case oo.Polyline:return o=e.coVertices(t),a=e.coIndices(t),new Rle(o,a);case oo.Triangle:return o=e.coVertices(t),new Tle(Fe.new(o[0],o[1],o[2]),Fe.new(o[3],o[4],o[5]),Fe.new(o[6],o[7],o[8]));case oo.RoundTriangle:return o=e.coVertices(t),r=e.coRoundRadius(t),new Ele(Fe.new(o[0],o[1],o[2]),Fe.new(o[3],o[4],o[5]),Fe.new(o[6],o[7],o[8]),r);case oo.HalfSpace:return h=Fe.fromRaw(e.coHalfspaceNormal(t)),new v5e(h);case oo.TriMesh:o=e.coVertices(t),a=e.coIndices(t);const d=e.coTriMeshFlags(t);return new Lle(o,a,d);case oo.HeightField:const u=e.coHeightfieldScale(t),f=e.coHeightfieldHeights(t),m=e.coHeightfieldNRows(t),g=e.coHeightfieldNCols(t),A=e.coHeightFieldFlags(t);return new Ble(m,g,f,u,A);case oo.ConvexPolyhedron:return o=e.coVertices(t),a=e.coIndices(t),new nU(o,a);case oo.RoundConvexPolyhedron:return o=e.coVertices(t),a=e.coIndices(t),r=e.coRoundRadius(t),new sU(o,a,r);case oo.Cylinder:return l=e.coHalfHeight(t),c=e.coRadius(t),new Ple(l,c);case oo.RoundCylinder:return l=e.coHalfHeight(t),c=e.coRadius(t),r=e.coRoundRadius(t),new Gle(l,c,r);case oo.Cone:return l=e.coHalfHeight(t),c=e.coRadius(t),new kle(l,c);case oo.RoundCone:return l=e.coHalfHeight(t),c=e.coRadius(t),r=e.coRoundRadius(t),new Nle(l,c,r);default:throw new Error("unknown shape type: "+i)}}castShape(e,t,i,n,r,o,a,l,c,h){let d=Fe.intoRaw(e),u=Bn.intoRaw(t),f=Fe.intoRaw(i),m=Fe.intoRaw(r),g=Bn.intoRaw(o),A=Fe.intoRaw(a),y=this.intoRaw(),b=n.intoRaw(),x=qM.fromRaw(null,y.castShape(d,u,f,b,m,g,A,l,c,h));return d.free(),u.free(),f.free(),m.free(),g.free(),A.free(),y.free(),b.free(),x}intersectsShape(e,t,i,n,r){let o=Fe.intoRaw(e),a=Bn.intoRaw(t),l=Fe.intoRaw(n),c=Bn.intoRaw(r),h=this.intoRaw(),d=i.intoRaw(),u=h.intersectsShape(o,a,d,l,c);return o.free(),a.free(),l.free(),c.free(),h.free(),d.free(),u}contactShape(e,t,i,n,r,o){let a=Fe.intoRaw(e),l=Bn.intoRaw(t),c=Fe.intoRaw(n),h=Bn.intoRaw(r),d=this.intoRaw(),u=i.intoRaw(),f=d1.fromRaw(d.contactShape(a,l,u,c,h,o));return a.free(),l.free(),c.free(),h.free(),d.free(),u.free(),f}containsPoint(e,t,i){let n=Fe.intoRaw(e),r=Bn.intoRaw(t),o=Fe.intoRaw(i),a=this.intoRaw(),l=a.containsPoint(n,r,o);return n.free(),r.free(),o.free(),a.free(),l}projectPoint(e,t,i,n){let r=Fe.intoRaw(e),o=Bn.intoRaw(t),a=Fe.intoRaw(i),l=this.intoRaw(),c=lG.fromRaw(l.projectPoint(r,o,a,n));return r.free(),o.free(),a.free(),l.free(),c}intersectsRay(e,t,i,n){let r=Fe.intoRaw(t),o=Bn.intoRaw(i),a=Fe.intoRaw(e.origin),l=Fe.intoRaw(e.dir),c=this.intoRaw(),h=c.intersectsRay(r,o,a,l,n);return r.free(),o.free(),a.free(),l.free(),c.free(),h}castRay(e,t,i,n,r){let o=Fe.intoRaw(t),a=Bn.intoRaw(i),l=Fe.intoRaw(e.origin),c=Fe.intoRaw(e.dir),h=this.intoRaw(),d=h.castRay(o,a,l,c,n,r);return o.free(),a.free(),l.free(),c.free(),h.free(),d}castRayAndGetNormal(e,t,i,n,r){let o=Fe.intoRaw(t),a=Bn.intoRaw(i),l=Fe.intoRaw(e.origin),c=Fe.intoRaw(e.dir),h=this.intoRaw(),d=cG.fromRaw(h.castRayAndGetNormal(o,a,l,c,n,r));return o.free(),a.free(),l.free(),c.free(),h.free(),d}}(function(s){s[s.Ball=0]="Ball",s[s.Cuboid=1]="Cuboid",s[s.Capsule=2]="Capsule",s[s.Segment=3]="Segment",s[s.Polyline=4]="Polyline",s[s.Triangle=5]="Triangle",s[s.TriMesh=6]="TriMesh",s[s.HeightField=7]="HeightField",s[s.ConvexPolyhedron=9]="ConvexPolyhedron",s[s.Cylinder=10]="Cylinder",s[s.Cone=11]="Cone",s[s.RoundCuboid=12]="RoundCuboid",s[s.RoundTriangle=13]="RoundTriangle",s[s.RoundCylinder=14]="RoundCylinder",s[s.RoundCone=15]="RoundCone",s[s.RoundConvexPolyhedron=16]="RoundConvexPolyhedron",s[s.HalfSpace=17]="HalfSpace"})(Zs||(Zs={})),function(s){s[s.FIX_INTERNAL_EDGES=1]="FIX_INTERNAL_EDGES"}(kJ||(kJ={})),function(s){s[s.DELETE_BAD_TOPOLOGY_TRIANGLES=4]="DELETE_BAD_TOPOLOGY_TRIANGLES",s[s.ORIENTED=8]="ORIENTED",s[s.MERGE_DUPLICATE_VERTICES=16]="MERGE_DUPLICATE_VERTICES",s[s.DELETE_DEGENERATE_TRIANGLES=32]="DELETE_DEGENERATE_TRIANGLES",s[s.DELETE_DUPLICATE_TRIANGLES=64]="DELETE_DUPLICATE_TRIANGLES",s[s.FIX_INTERNAL_EDGES=152]="FIX_INTERNAL_EDGES"}(NJ||(NJ={}));class UZ extends eo{constructor(e){super(),this.type=Zs.Ball,this.radius=e}intoRaw(){return ui.ball(this.radius)}}class v5e extends eo{constructor(e){super(),this.type=Zs.HalfSpace,this.normal=e}intoRaw(){let e=Fe.intoRaw(this.normal),t=ui.halfspace(e);return e.free(),t}}class wle extends eo{constructor(e,t,i){super(),this.type=Zs.Cuboid,this.halfExtents=Fe.new(e,t,i)}intoRaw(){return ui.cuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z)}}class Sle extends eo{constructor(e,t,i,n){super(),this.type=Zs.RoundCuboid,this.halfExtents=Fe.new(e,t,i),this.borderRadius=n}intoRaw(){return ui.roundCuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z,this.borderRadius)}}class Mle extends eo{constructor(e,t){super(),this.type=Zs.Capsule,this.halfHeight=e,this.radius=t}intoRaw(){return ui.capsule(this.halfHeight,this.radius)}}class Ile extends eo{constructor(e,t){super(),this.type=Zs.Segment,this.a=e,this.b=t}intoRaw(){let e=Fe.intoRaw(this.a),t=Fe.intoRaw(this.b),i=ui.segment(e,t);return e.free(),t.free(),i}}class Tle extends eo{constructor(e,t,i){super(),this.type=Zs.Triangle,this.a=e,this.b=t,this.c=i}intoRaw(){let e=Fe.intoRaw(this.a),t=Fe.intoRaw(this.b),i=Fe.intoRaw(this.c),n=ui.triangle(e,t,i);return e.free(),t.free(),i.free(),n}}class Ele extends eo{constructor(e,t,i,n){super(),this.type=Zs.RoundTriangle,this.a=e,this.b=t,this.c=i,this.borderRadius=n}intoRaw(){let e=Fe.intoRaw(this.a),t=Fe.intoRaw(this.b),i=Fe.intoRaw(this.c),n=ui.roundTriangle(e,t,i,this.borderRadius);return e.free(),t.free(),i.free(),n}}class Rle extends eo{constructor(e,t){super(),this.type=Zs.Polyline,this.vertices=e,this.indices=t??new Uint32Array(0)}intoRaw(){return ui.polyline(this.vertices,this.indices)}}class Lle extends eo{constructor(e,t,i){super(),this.type=Zs.TriMesh,this.vertices=e,this.indices=t,this.flags=i}intoRaw(){return ui.trimesh(this.vertices,this.indices,this.flags)}}class nU extends eo{constructor(e,t){super(),this.type=Zs.ConvexPolyhedron,this.vertices=e,this.indices=t}intoRaw(){return this.indices?ui.convexMesh(this.vertices,this.indices):ui.convexHull(this.vertices)}}class sU extends eo{constructor(e,t,i){super(),this.type=Zs.RoundConvexPolyhedron,this.vertices=e,this.indices=t,this.borderRadius=i}intoRaw(){return this.indices?ui.roundConvexMesh(this.vertices,this.indices,this.borderRadius):ui.roundConvexHull(this.vertices,this.borderRadius)}}class Ble extends eo{constructor(e,t,i,n,r){super(),this.type=Zs.HeightField,this.nrows=e,this.ncols=t,this.heights=i,this.scale=n,this.flags=r}intoRaw(){let e=Fe.intoRaw(this.scale),t=ui.heightfield(this.nrows,this.ncols,this.heights,e,this.flags);return e.free(),t}}class Ple extends eo{constructor(e,t){super(),this.type=Zs.Cylinder,this.halfHeight=e,this.radius=t}intoRaw(){return ui.cylinder(this.halfHeight,this.radius)}}class Gle extends eo{constructor(e,t,i){super(),this.type=Zs.RoundCylinder,this.borderRadius=i,this.halfHeight=e,this.radius=t}intoRaw(){return ui.roundCylinder(this.halfHeight,this.radius,this.borderRadius)}}class kle extends eo{constructor(e,t){super(),this.type=Zs.Cone,this.halfHeight=e,this.radius=t}intoRaw(){return ui.cone(this.halfHeight,this.radius)}}class Nle extends eo{constructor(e,t,i){super(),this.type=Zs.RoundCone,this.halfHeight=e,this.radius=t,this.borderRadius=i}intoRaw(){return ui.roundCone(this.halfHeight,this.radius,this.borderRadius)}}(function(s){s[s.EXCLUDE_FIXED=1]="EXCLUDE_FIXED",s[s.EXCLUDE_KINEMATIC=2]="EXCLUDE_KINEMATIC",s[s.EXCLUDE_DYNAMIC=4]="EXCLUDE_DYNAMIC",s[s.EXCLUDE_SENSORS=8]="EXCLUDE_SENSORS",s[s.EXCLUDE_SOLIDS=16]="EXCLUDE_SOLIDS",s[s.ONLY_DYNAMIC=3]="ONLY_DYNAMIC",s[s.ONLY_KINEMATIC=5]="ONLY_KINEMATIC",s[s.ONLY_FIXED=6]="ONLY_FIXED"})(DJ||(DJ={}));(function(s){s[s.NONE=0]="NONE",s[s.COLLISION_EVENTS=1]="COLLISION_EVENTS",s[s.CONTACT_FORCE_EVENTS=2]="CONTACT_FORCE_EVENTS"})(P2||(P2={}));class _5e{free(){this.raw&&this.raw.free(),this.raw=void 0}collider1(){return this.raw.collider1()}collider2(){return this.raw.collider2()}totalForce(){return Fe.fromRaw(this.raw.total_force())}totalForceMagnitude(){return this.raw.total_force_magnitude()}maxForceDirection(){return Fe.fromRaw(this.raw.max_force_direction())}maxForceMagnitude(){return this.raw.max_force_magnitude()}}class C5e{constructor(e,t){this.raw=t||new A5e(e)}free(){this.raw&&this.raw.free(),this.raw=void 0}drainCollisionEvents(e){this.raw.drainCollisionEvents(e)}drainContactForceEvents(e){let t=new _5e;this.raw.drainContactForceEvents(i=>{t.raw=i,e(t),t.free()})}clear(){this.raw.clear()}}(function(s){s[s.NONE=0]="NONE",s[s.FILTER_CONTACT_PAIRS=1]="FILTER_CONTACT_PAIRS",s[s.FILTER_INTERSECTION_PAIRS=2]="FILTER_INTERSECTION_PAIRS"})(iU||(iU={})),function(s){s[s.EMPTY=0]="EMPTY",s[s.COMPUTE_IMPULSE=1]="COMPUTE_IMPULSE"}(FJ||(FJ={})),function(s){s[s.DYNAMIC_DYNAMIC=1]="DYNAMIC_DYNAMIC",s[s.DYNAMIC_KINEMATIC=12]="DYNAMIC_KINEMATIC",s[s.DYNAMIC_FIXED=2]="DYNAMIC_FIXED",s[s.KINEMATIC_KINEMATIC=52224]="KINEMATIC_KINEMATIC",s[s.KINEMATIC_FIXED=8704]="KINEMATIC_FIXED",s[s.FIXED_FIXED=32]="FIXED_FIXED",s[s.DEFAULT=15]="DEFAULT",s[s.ALL=60943]="ALL"}(G2||(G2={}));class zJ{constructor(e,t,i,n){this.colliderSet=e,this.handle=t,this._parent=i,this._shape=n}finalizeDeserialization(e){this.handle!=null&&(this._parent=e.get(this.colliderSet.raw.coParent(this.handle)))}ensureShapeIsCached(){this._shape||(this._shape=eo.fromRaw(this.colliderSet.raw,this.handle))}get shape(){return this.ensureShapeIsCached(),this._shape}isValid(){return this.colliderSet.raw.contains(this.handle)}translation(){return Fe.fromRaw(this.colliderSet.raw.coTranslation(this.handle))}rotation(){return Bn.fromRaw(this.colliderSet.raw.coRotation(this.handle))}isSensor(){return this.colliderSet.raw.coIsSensor(this.handle)}setSensor(e){this.colliderSet.raw.coSetSensor(this.handle,e)}setShape(e){let t=e.intoRaw();this.colliderSet.raw.coSetShape(this.handle,t),t.free(),this._shape=e}setEnabled(e){this.colliderSet.raw.coSetEnabled(this.handle,e)}isEnabled(){return this.colliderSet.raw.coIsEnabled(this.handle)}setRestitution(e){this.colliderSet.raw.coSetRestitution(this.handle,e)}setFriction(e){this.colliderSet.raw.coSetFriction(this.handle,e)}frictionCombineRule(){return this.colliderSet.raw.coFrictionCombineRule(this.handle)}setFrictionCombineRule(e){this.colliderSet.raw.coSetFrictionCombineRule(this.handle,e)}restitutionCombineRule(){return this.colliderSet.raw.coRestitutionCombineRule(this.handle)}setRestitutionCombineRule(e){this.colliderSet.raw.coSetRestitutionCombineRule(this.handle,e)}setCollisionGroups(e){this.colliderSet.raw.coSetCollisionGroups(this.handle,e)}setSolverGroups(e){this.colliderSet.raw.coSetSolverGroups(this.handle,e)}contactSkin(){return this.colliderSet.raw.coContactSkin(this.handle)}setContactSkin(e){return this.colliderSet.raw.coSetContactSkin(this.handle,e)}activeHooks(){return this.colliderSet.raw.coActiveHooks(this.handle)}setActiveHooks(e){this.colliderSet.raw.coSetActiveHooks(this.handle,e)}activeEvents(){return this.colliderSet.raw.coActiveEvents(this.handle)}setActiveEvents(e){this.colliderSet.raw.coSetActiveEvents(this.handle,e)}activeCollisionTypes(){return this.colliderSet.raw.coActiveCollisionTypes(this.handle)}setContactForceEventThreshold(e){return this.colliderSet.raw.coSetContactForceEventThreshold(this.handle,e)}contactForceEventThreshold(){return this.colliderSet.raw.coContactForceEventThreshold(this.handle)}setActiveCollisionTypes(e){this.colliderSet.raw.coSetActiveCollisionTypes(this.handle,e)}setDensity(e){this.colliderSet.raw.coSetDensity(this.handle,e)}setMass(e){this.colliderSet.raw.coSetMass(this.handle,e)}setMassProperties(e,t,i,n){let r=Fe.intoRaw(t),o=Fe.intoRaw(i),a=Bn.intoRaw(n);this.colliderSet.raw.coSetMassProperties(this.handle,e,r,o,a),r.free(),o.free(),a.free()}setTranslation(e){this.colliderSet.raw.coSetTranslation(this.handle,e.x,e.y,e.z)}setTranslationWrtParent(e){this.colliderSet.raw.coSetTranslationWrtParent(this.handle,e.x,e.y,e.z)}setRotation(e){this.colliderSet.raw.coSetRotation(this.handle,e.x,e.y,e.z,e.w)}setRotationWrtParent(e){this.colliderSet.raw.coSetRotationWrtParent(this.handle,e.x,e.y,e.z,e.w)}shapeType(){return this.colliderSet.raw.coShapeType(this.handle)}halfExtents(){return Fe.fromRaw(this.colliderSet.raw.coHalfExtents(this.handle))}setHalfExtents(e){const t=Fe.intoRaw(e);this.colliderSet.raw.coSetHalfExtents(this.handle,t)}radius(){return this.colliderSet.raw.coRadius(this.handle)}setRadius(e){this.colliderSet.raw.coSetRadius(this.handle,e)}roundRadius(){return this.colliderSet.raw.coRoundRadius(this.handle)}setRoundRadius(e){this.colliderSet.raw.coSetRoundRadius(this.handle,e)}halfHeight(){return this.colliderSet.raw.coHalfHeight(this.handle)}setHalfHeight(e){this.colliderSet.raw.coSetHalfHeight(this.handle,e)}vertices(){return this.colliderSet.raw.coVertices(this.handle)}indices(){return this.colliderSet.raw.coIndices(this.handle)}heightfieldHeights(){return this.colliderSet.raw.coHeightfieldHeights(this.handle)}heightfieldScale(){let e=this.colliderSet.raw.coHeightfieldScale(this.handle);return Fe.fromRaw(e)}heightfieldNRows(){return this.colliderSet.raw.coHeightfieldNRows(this.handle)}heightfieldNCols(){return this.colliderSet.raw.coHeightfieldNCols(this.handle)}parent(){return this._parent}friction(){return this.colliderSet.raw.coFriction(this.handle)}restitution(){return this.colliderSet.raw.coRestitution(this.handle)}density(){return this.colliderSet.raw.coDensity(this.handle)}mass(){return this.colliderSet.raw.coMass(this.handle)}volume(){return this.colliderSet.raw.coVolume(this.handle)}collisionGroups(){return this.colliderSet.raw.coCollisionGroups(this.handle)}solverGroups(){return this.colliderSet.raw.coSolverGroups(this.handle)}containsPoint(e){let t=Fe.intoRaw(e),i=this.colliderSet.raw.coContainsPoint(this.handle,t);return t.free(),i}projectPoint(e,t){let i=Fe.intoRaw(e),n=lG.fromRaw(this.colliderSet.raw.coProjectPoint(this.handle,i,t));return i.free(),n}intersectsRay(e,t){let i=Fe.intoRaw(e.origin),n=Fe.intoRaw(e.dir),r=this.colliderSet.raw.coIntersectsRay(this.handle,i,n,t);return i.free(),n.free(),r}castShape(e,t,i,n,r,o,a,l){let c=Fe.intoRaw(e),h=Fe.intoRaw(i),d=Bn.intoRaw(n),u=Fe.intoRaw(r),f=t.intoRaw(),m=qM.fromRaw(this.colliderSet,this.colliderSet.raw.coCastShape(this.handle,c,f,h,d,u,o,a,l));return c.free(),h.free(),d.free(),u.free(),f.free(),m}castCollider(e,t,i,n,r,o){let a=Fe.intoRaw(e),l=Fe.intoRaw(i),c=zZ.fromRaw(this.colliderSet,this.colliderSet.raw.coCastCollider(this.handle,a,t.handle,l,n,r,o));return a.free(),l.free(),c}intersectsShape(e,t,i){let n=Fe.intoRaw(t),r=Bn.intoRaw(i),o=e.intoRaw(),a=this.colliderSet.raw.coIntersectsShape(this.handle,o,n,r);return n.free(),r.free(),o.free(),a}contactShape(e,t,i,n){let r=Fe.intoRaw(t),o=Bn.intoRaw(i),a=e.intoRaw(),l=d1.fromRaw(this.colliderSet.raw.coContactShape(this.handle,a,r,o,n));return r.free(),o.free(),a.free(),l}contactCollider(e,t){return d1.fromRaw(this.colliderSet.raw.coContactCollider(this.handle,e.handle,t))}castRay(e,t,i){let n=Fe.intoRaw(e.origin),r=Fe.intoRaw(e.dir),o=this.colliderSet.raw.coCastRay(this.handle,n,r,t,i);return n.free(),r.free(),o}castRayAndGetNormal(e,t,i){let n=Fe.intoRaw(e.origin),r=Fe.intoRaw(e.dir),o=cG.fromRaw(this.colliderSet.raw.coCastRayAndGetNormal(this.handle,n,r,t,i));return n.free(),r.free(),o}}(function(s){s[s.Density=0]="Density",s[s.Mass=1]="Mass",s[s.MassProps=2]="MassProps"})(Db||(Db={}));class $n{constructor(e){this.enabled=!0,this.shape=e,this.massPropsMode=Db.Density,this.density=1,this.friction=.5,this.restitution=0,this.rotation=Bn.identity(),this.translation=Fe.zeros(),this.isSensor=!1,this.collisionGroups=4294967295,this.solverGroups=4294967295,this.frictionCombineRule=Ys.Average,this.restitutionCombineRule=Ys.Average,this.activeCollisionTypes=G2.DEFAULT,this.activeEvents=P2.NONE,this.activeHooks=iU.NONE,this.mass=0,this.centerOfMass=Fe.zeros(),this.contactForceEventThreshold=0,this.contactSkin=0,this.principalAngularInertia=Fe.zeros(),this.angularInertiaLocalFrame=Bn.identity()}static ball(e){const t=new UZ(e);return new $n(t)}static capsule(e,t){const i=new Mle(e,t);return new $n(i)}static segment(e,t){const i=new Ile(e,t);return new $n(i)}static triangle(e,t,i){const n=new Tle(e,t,i);return new $n(n)}static roundTriangle(e,t,i,n){const r=new Ele(e,t,i,n);return new $n(r)}static polyline(e,t){const i=new Rle(e,t);return new $n(i)}static trimesh(e,t,i){const n=new Lle(e,t,i);return new $n(n)}static cuboid(e,t,i){const n=new wle(e,t,i);return new $n(n)}static roundCuboid(e,t,i,n){const r=new Sle(e,t,i,n);return new $n(r)}static heightfield(e,t,i,n,r){const o=new Ble(e,t,i,n,r);return new $n(o)}static cylinder(e,t){const i=new Ple(e,t);return new $n(i)}static roundCylinder(e,t,i){const n=new Gle(e,t,i);return new $n(n)}static cone(e,t){const i=new kle(e,t);return new $n(i)}static roundCone(e,t,i){const n=new Nle(e,t,i);return new $n(n)}static convexHull(e){const t=new nU(e,null);return new $n(t)}static convexMesh(e,t){const i=new nU(e,t);return new $n(i)}static roundConvexHull(e,t){const i=new sU(e,null,t);return new $n(i)}static roundConvexMesh(e,t,i){const n=new sU(e,t,i);return new $n(n)}setTranslation(e,t,i){if(typeof e!="number"||typeof t!="number"||typeof i!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:e,y:t,z:i},this}setRotation(e){return Bn.copy(this.rotation,e),this}setSensor(e){return this.isSensor=e,this}setEnabled(e){return this.enabled=e,this}setContactSkin(e){return this.contactSkin=e,this}setDensity(e){return this.massPropsMode=Db.Density,this.density=e,this}setMass(e){return this.massPropsMode=Db.Mass,this.mass=e,this}setMassProperties(e,t,i,n){return this.massPropsMode=Db.MassProps,this.mass=e,Fe.copy(this.centerOfMass,t),Fe.copy(this.principalAngularInertia,i),Bn.copy(this.angularInertiaLocalFrame,n),this}setRestitution(e){return this.restitution=e,this}setFriction(e){return this.friction=e,this}setFrictionCombineRule(e){return this.frictionCombineRule=e,this}setRestitutionCombineRule(e){return this.restitutionCombineRule=e,this}setCollisionGroups(e){return this.collisionGroups=e,this}setSolverGroups(e){return this.solverGroups=e,this}setActiveHooks(e){return this.activeHooks=e,this}setActiveEvents(e){return this.activeEvents=e,this}setActiveCollisionTypes(e){return this.activeCollisionTypes=e,this}setContactForceEventThreshold(e){return this.contactForceEventThreshold=e,this}}for(var AQe={byteLength:function(s){var e=UJ(s),t=e[0],i=e[1];return 3*(t+i)/4-i},toByteArray:function(s){var e,t,i=UJ(s),n=i[0],r=i[1],o=new w5e(function(c,h,d){return 3*(h+d)/4-d}(0,n,r)),a=0,l=r>0?n-4:n;for(t=0;t<l;t+=4)e=bc[s.charCodeAt(t)]<<18|bc[s.charCodeAt(t+1)]<<12|bc[s.charCodeAt(t+2)]<<6|bc[s.charCodeAt(t+3)],o[a++]=e>>16&255,o[a++]=e>>8&255,o[a++]=255&e;return r===2&&(e=bc[s.charCodeAt(t)]<<2|bc[s.charCodeAt(t+1)]>>4,o[a++]=255&e),r===1&&(e=bc[s.charCodeAt(t)]<<10|bc[s.charCodeAt(t+1)]<<4|bc[s.charCodeAt(t+2)]>>2,o[a++]=e>>8&255,o[a++]=255&e),o},fromByteArray:function(s){for(var e,t=s.length,i=t%3,n=[],r=16383,o=0,a=t-i;o<a;o+=r)n.push(M5e(s,o,o+r>a?a:o+r));return i===1?(e=s[t-1],n.push(xd[e>>2]+xd[e<<4&63]+"==")):i===2&&(e=(s[t-2]<<8)+s[t-1],n.push(xd[e>>10]+xd[e>>4&63]+xd[e<<2&63]+"=")),n.join("")}},xd=[],bc=[],w5e=typeof Uint8Array<"u"?Uint8Array:Array,aF="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Xy=0,S5e=aF.length;Xy<S5e;++Xy)xd[Xy]=aF[Xy],bc[aF.charCodeAt(Xy)]=Xy;function UJ(s){var e=s.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=s.indexOf("=");return t===-1&&(t=e),[t,t===e?0:4-t%4]}function M5e(s,e,t){for(var i,n,r=[],o=e;o<t;o+=3)i=(s[o]<<16&16711680)+(s[o+1]<<8&65280)+(255&s[o+2]),r.push(xd[(n=i)>>18&63]+xd[n>>12&63]+xd[n>>6&63]+xd[63&n]);return r.join("")}bc["-".charCodeAt(0)]=62,bc["_".charCodeAt(0)]=63;const ho=ee("debugphysics"),lF=ee("debugcolliderplacement"),cF=ee("debugcollisions"),I5e=ee("showcolliders"),hF=ee("debugraycasts"),Qa=Symbol("needle component"),Aa=Symbol("physics body"),XJ=Symbol("rigidbody");let Dg;globalThis.false=globalThis.false!==void 0?globalThis.false:!0;ho&&console.log("Use Rapier",!1,globalThis.false);const Sw=class{constructor(){p(this,"debugRenderColliders",!1);p(this,"debugRenderRaycasts",!1);p(this,"context");p(this,"_initializePromise");p(this,"_isInitialized",!1);p(this,"rapierRay",new x5e({x:0,y:0,z:0},{x:0,y:0,z:1}));p(this,"raycastVectorsBuffer",new $l(()=>new T,10));p(this,"rapierSphere",null);p(this,"rapierColliderArray",[]);p(this,"rapierIdentityRotation",{x:0,y:0,z:0,w:1});p(this,"rapierForwardVector",{x:0,y:0,z:1});p(this,"enabled",!1);p(this,"_tempPosition",new T);p(this,"_tempQuaternion",new Ve);p(this,"_tempScale",new T);p(this,"_tempMatrix",new ce);p(this,"_isUpdatingPhysicsWorld",!1);p(this,"_world");p(this,"_hasCreatedWorld",!1);p(this,"eventQueue");p(this,"collisionHandler");p(this,"objects",[]);p(this,"bodies",[]);p(this,"_meshCache",new Map);p(this,"_gravity",{x:0,y:-9.81,z:0});p(this,"lines");p(this,"_tempCenterPos",new T);p(this,"_tempCenterVec",new T);p(this,"_tempCenterQuaternion",new Ve)}removeBody(e){var i,n,r;if(!e)return;this.validate();const t=e[Aa];if(e[Aa]=null,t&&this.world){const o=this.objects.findIndex(a=>a===e);if(o>=0){const a=this.bodies[o];if(this.bodies.splice(o,1),this.objects.splice(o,1),a instanceof zJ){const l=a;(i=this.world)==null||i.removeCollider(l,!0);const c=l.parent();c&&c.numColliders()<=0&&(c[Qa]||(n=this.world)==null||n.removeRigidBody(c))}else a instanceof VJ&&(a.numColliders()<=0?(r=this.world)==null||r.removeRigidBody(a):Qe()&&(a.did_log_removing||setTimeout(()=>{a.numColliders()>0&&(a.did_log_removing=!0,console.warn("RapierPhysics: removing rigidbody with colliders from the physics world is not possible right now, please remove the colliders first"))},1)))}}}updateBody(e,t,i){if(this.validate(),!!this.enabled&&!(e.destroyed||!e.gameObject)&&!(!t&&!i))if(e.isCollider===!0)console.warn("TODO: implement updating collider position");else{const n=e,r=n[Aa];r&&this.syncPhysicsBody(n.gameObject,r,t,i)}}updateProperties(e){if(this.validate(),e.isCollider){const t=e,i=t[Aa];i&&(this.internalUpdateColliderProperties(t,i),t.sharedMaterial&&this.updatePhysicsMaterial(t))}else{const t=e,i=this.internal_getRigidbody(t);i&&this.internalUpdateRigidbodyProperties(t,i)}}addForce(e,t,i){this.validate();const n=this.internal_getRigidbody(e);n?n.addForce(t,i):console.warn("Rigidbody doesn't exist: can not apply force (does your object with the Rigidbody have a collider?)")}addImpulse(e,t,i){this.validate();const n=this.internal_getRigidbody(e);n?n.applyImpulse(t,i):console.warn("Rigidbody doesn't exist: can not apply impulse (does your object with the Rigidbody have a collider?)")}getLinearVelocity(e){this.validate();const t=this.internal_getRigidbody(e);return t?t.linvel():null}getAngularVelocity(e){this.validate();const t=this.internal_getRigidbody(e);return t?t.angvel():null}resetForces(e,t){this.validate();const i=this.internal_getRigidbody(e);i==null||i.resetForces(t)}resetTorques(e,t){this.validate();const i=this.internal_getRigidbody(e);i==null||i.resetTorques(t)}applyImpulse(e,t,i){this.validate();const n=this.internal_getRigidbody(e);n?n.applyImpulse(t,i):console.warn("Rigidbody doesn't exist: can not apply impulse (does your object with the Rigidbody have a collider?)")}wakeup(e){this.validate();const t=this.internal_getRigidbody(e);t?t.wakeUp():console.warn("Rigidbody doesn't exist: can not wake up (does your object with the Rigidbody have a collider?)")}isSleeping(e){this.validate();const t=this.internal_getRigidbody(e);return t==null?void 0:t.isSleeping()}setAngularVelocity(e,t,i){this.validate();const n=this.internal_getRigidbody(e);n?n.setAngvel(t,i):console.warn("Rigidbody doesn't exist: can not set angular velocity (does your object with the Rigidbody have a collider?)")}setLinearVelocity(e,t,i){this.validate();const n=this.internal_getRigidbody(e);n?n.setLinvel(t,i):console.warn("Rigidbody doesn't exist: can not set linear velocity (does your object with the Rigidbody have a collider?)")}async initialize(e){return this.context=e,this._initializePromise||(this._initializePromise=this.internalInitialization()),this._initializePromise}async internalInitialization(){return ho&&console.log("Initialize rapier physics engine"),"env"in{url:typeof document>"u"?require("url").pathToFileURL(__filename).href:Ju&&Ju.tagName.toUpperCase()==="SCRIPT"&&Ju.src||new URL("dist/needle-engine.light.umd.cjs",document.baseURI).href}&&{}.VITE_NEEDLE_USE_RAPIER==="false"&&ho&&console.log("Rapier disabled"),!1}validate(){this._isInitialized||ho&&(this._lastWarnTime=this._lastWarnTime??0,Date.now()-this._lastWarnTime>1e3&&(this._lastWarnTime=Date.now(),console.warn("Physics engine is not initialized")))}raycast(e,t,i){var l;let n=i==null?void 0:i.maxDistance,r=i==null?void 0:i.solid;n===void 0&&(n=1/0),r===void 0&&(r=!0);const o=this.getPhysicsRay(this.rapierRay,e,t);if(!o)return null;(this.debugRenderRaycasts||hF)&&Mt.DrawRay(o.origin,o.dir,255,1);const a=(l=this.world)==null?void 0:l.castRay(o,n,r,i==null?void 0:i.queryFilterFlags,i==null?void 0:i.filterGroups,void 0,void 0,c=>{const h=c[Qa];return i!=null&&i.filterPredicate?i.filterPredicate(h):(i==null?void 0:i.useIgnoreRaycastLayer)!==!1?!(h!=null&&h.gameObject.layers.isEnabled(2)):!0});if(a){const c=o.pointAt(a.timeOfImpact),h=this.raycastVectorsBuffer.get();return h.set(c.x,c.y,c.z),{point:h,collider:a.collider[Qa]}}return null}raycastAndGetNormal(e,t,i){var l;let n=i==null?void 0:i.maxDistance,r=i==null?void 0:i.solid;n===void 0&&(n=1/0),r===void 0&&(r=!0);const o=this.getPhysicsRay(this.rapierRay,e,t);if(!o)return null;(this.debugRenderRaycasts||hF)&&Mt.DrawRay(o.origin,o.dir,255,1);const a=(l=this.world)==null?void 0:l.castRayAndGetNormal(o,n,r,i==null?void 0:i.queryFilterFlags,i==null?void 0:i.filterGroups,void 0,void 0,c=>{const h=c[Qa];return i!=null&&i.filterPredicate?i.filterPredicate(h):(i==null?void 0:i.useIgnoreRaycastLayer)!==!1?!(h!=null&&h.gameObject.layers.isEnabled(2)):!0});if(a){const c=o.pointAt(a.timeOfImpact),h=a.normal,d=this.raycastVectorsBuffer.get(),u=this.raycastVectorsBuffer.get();return d.set(c.x,c.y,c.z),u.set(h.x,h.y,h.z),{point:d,normal:u,collider:a.collider[Qa]}}return null}getPhysicsRay(e,t,i){var a,l,c;const n=(a=this.context)==null?void 0:a.mainCamera;if(t===void 0){const h=(l=this.context)==null?void 0:l.input.getPointerPosition(0);if(h)t=h;else return null}if(t.z===void 0){if(!n)return console.error("Can not perform raycast from 2d point - no main camera found"),null;const h=this.raycastVectorsBuffer.get();h.x=t.x,h.y=t.y,h.z=0,(h.x>1||h.y>1||h.y<-1||h.x<-1)&&(ho&&console.warn("Converting screenspace to raycast space",h),(c=this.context)==null||c.input.convertScreenspaceToRaycastSpace(h)),h.unproject(n),t=h}const r=t;e.origin.x=r.x,e.origin.y=r.y,e.origin.z=r.z;const o=this.raycastVectorsBuffer.get();if(i)o.set(i.x,i.y,i.z);else{if(!n)return console.error("Can not perform raycast - no camera found"),null;o.set(e.origin.x,e.origin.y,e.origin.z);const h=$t(n);o.sub(h)}return o.normalize(),e.dir.x=o.x,e.dir.y=o.y,e.dir.z=o.z,e}sphereOverlap(e,t){return this.rapierColliderArray.length=0,this.world?(this.rapierSphere||(this.rapierSphere=new UZ(t)),this.rapierSphere.radius=t,(this.debugRenderRaycasts||hF)&&Mt.DrawWireSphere(e,t,3359999,1),this.world.intersectionsWithShape(e,this.rapierIdentityRotation,this.rapierSphere,i=>{const n=i[Qa],r=new Hoe(n.gameObject,n);return this.rapierColliderArray.push(r),!0},void 0,void 0,void 0,void 0,i=>i.isSensor()?!1:i[Qa].gameObject.layers.isEnabled(2)==!1),this.rapierColliderArray):this.rapierColliderArray}get world(){return this._world}get isUpdating(){return this._isUpdatingPhysicsWorld}get gravity(){var e;return((e=this.world)==null?void 0:e.gravity)??this._gravity}set gravity(e){this.world?this.world.gravity=e:this._gravity=e}clearCaches(){var e,t,i,n;this._meshCache.clear(),(e=this.eventQueue)!=null&&e.raw&&((t=this.eventQueue)==null||t.free()),(i=this.world)!=null&&i.bodies&&((n=this.world)==null||n.free())}async addBoxCollider(e,t){if(this._isInitialized||await this.initialize(e.context),!e.activeAndEnabled)return;if(!this.enabled){ho&&console.warn("Physics are disabled");return}const i=e.gameObject,n=kn(i,this._tempPosition).multiply(t);n.multiplyScalar(.5),n.x<0&&(n.x=Math.abs(n.x)),n.y<0&&(n.y=Math.abs(n.y)),n.z<0&&(n.z=Math.abs(n.z)),n.x==0&&(n.x=1e-7),n.y==0&&(n.y=1e-7),n.z==0&&(n.z=1e-7);const r=$n.cuboid(n.x,n.y,n.z);this.createCollider(e,r)}async addSphereCollider(e){if(this._isInitialized||await this.initialize(e.context),!e.activeAndEnabled)return;if(!this.enabled){ho&&console.warn("Physics are disabled");return}const t=$n.ball(.5);this.createCollider(e,t),this.updateProperties(e)}async addCapsuleCollider(e,t,i){if(this._isInitialized||await this.initialize(e.context),!e.activeAndEnabled)return;if(!this.enabled){ho&&console.warn("Physics are disabled");return}const n=e.gameObject,r=kn(n,this._tempPosition);r.x=Math.abs(r.x),r.y=Math.abs(r.y);const o=i*r.x;t=Math.max(t,o*2);const a=lt.clamp(t*.5*r.y-i*r.x,0,Number.MAX_SAFE_INTEGER),l=$n.capsule(a,o);this.createCollider(e,l)}async addMeshCollider(e,t,i,n){var h,d,u;if(this._isInitialized||await this.initialize(e.context),!e.activeAndEnabled)return;if(!this.enabled){ho&&console.warn("Physics are disabled");return}let r=t.geometry;if(!r){ho&&console.warn("Missing mesh geometry",t.name);return}(d=(h=r.index)==null?void 0:h.array)!=null&&d.length||(console.warn(`Your MeshCollider is missing vertices or indices in the assined mesh "${t.name}". Consider providing an indexed geometry.`),r=E2e(r));let o=null;const a=r.getAttribute("position");if(a instanceof Ma){const f=a.count;o=new Float32Array(f*3);for(let m=0;m<f;m++){const g=a.getX(m),A=a.getY(m),y=a.getZ(m);o[m*3]=g,o[m*3+1]=A,o[m*3+2]=y}}else o=a.array;const l=(u=r.index)==null?void 0:u.array;if(Math.abs(n.x-1)>1e-4||Math.abs(n.y-1)>1e-4||Math.abs(n.z-1)>1e-4){const f=r.uuid+"_"+n.x+"_"+n.y+"_"+n.z+"_"+i;if(this._meshCache.has(f))ho&&console.warn("Use cached mesh collider"),o=this._meshCache.get(f);else{(ho||Qe())&&console.warn(`Your MeshCollider "${e.name}" is scaled: consider applying the scale to the collider mesh instead (${n.x}, ${n.y}, ${n.z})`);const m=new Float32Array(o.length);for(let g=0;g<o.length;g+=3)m[g]=o[g]*n.x,m[g+1]=o[g+1]*n.y,m[g+2]=o[g+2]*n.z;o=m,this._meshCache.set(f,m)}}const c=i?$n.convexHull(o):$n.trimesh(o,l);c&&this.createCollider(e,c)}updatePhysicsMaterial(e){if(!e)return;const t=e.sharedMaterial,i=e[Aa];if(i&&t){if(t.bounciness!==void 0&&i.setRestitution(t.bounciness),t.bounceCombine!==void 0)switch(t.bounceCombine){case Pr.Average:i.setRestitutionCombineRule(Ys.Average);break;case Pr.Maximum:i.setRestitutionCombineRule(Ys.Max);break;case Pr.Minimum:i.setRestitutionCombineRule(Ys.Min);break;case Pr.Multiply:i.setRestitutionCombineRule(Ys.Multiply);break}if(t.dynamicFriction!==void 0&&i.setFriction(t.dynamicFriction),t.frictionCombine!==void 0)switch(t.frictionCombine){case Pr.Average:i.setFrictionCombineRule(Ys.Average);break;case Pr.Maximum:i.setFrictionCombineRule(Ys.Max);break;case Pr.Minimum:i.setFrictionCombineRule(Ys.Min);break;case Pr.Multiply:i.setFrictionCombineRule(Ys.Multiply);break}}}getBody(e){return e?e[Aa]:null}getComponent(e){return e?e[Qa]:null}createCollider(e,t){var o;if(!this.world)throw new Error("Physics world not initialized");const i=this._tempMatrix;let n;e.attachedRigidbody?n=this.getRigidbody(e,this._tempMatrix):(ho&&console.log("Create collider without rigidbody",e.name),i.makeRotationFromQuaternion(gn(e.gameObject)),i.setPosition($t(e.gameObject))),i.decompose(this._tempPosition,this._tempQuaternion,this._tempScale),this.tryApplyCenter(e,this._tempPosition),t.setTranslation(this._tempPosition.x,this._tempPosition.y,this._tempPosition.z),t.setRotation(this._tempQuaternion),t.setSensor(e.isTrigger);const r=e.sharedMaterial;if(r){if(r.bounciness!==void 0&&t.setRestitution(r.bounciness),r.bounceCombine!==void 0)switch(r.bounceCombine){case Pr.Average:t.setRestitutionCombineRule(Ys.Average);break;case Pr.Maximum:t.setRestitutionCombineRule(Ys.Max);break;case Pr.Minimum:t.setRestitutionCombineRule(Ys.Min);break;case Pr.Multiply:t.setRestitutionCombineRule(Ys.Multiply);break}if(r.dynamicFriction!==void 0&&t.setFriction(r.dynamicFriction),r.frictionCombine!==void 0)switch(r.frictionCombine){case Pr.Average:t.setFrictionCombineRule(Ys.Average);break;case Pr.Maximum:t.setFrictionCombineRule(Ys.Max);break;case Pr.Minimum:t.setFrictionCombineRule(Ys.Min);break;case Pr.Multiply:t.setFrictionCombineRule(Ys.Multiply);break}}((o=e.attachedRigidbody)==null?void 0:o.autoMass)===!1&&(t.setDensity(1e-6),t.setMass(1e-6));try{const a=this.world.createCollider(t,n);return a[Qa]=e,e[Aa]=a,a.setActiveEvents(P2.COLLISION_EVENTS),a.setActiveCollisionTypes(G2.ALL),this.objects.push(e),this.bodies.push(a),this.updateColliderCollisionGroups(e),a}catch(a){return console.error('Error creating collider "'+e.name+`"
Error:`,a),null}}updateColliderCollisionGroups(e){const t=e[Aa],i=e.membership;let n=0;if(i==null)n=65535;else for(let a=0;a<i.length;a++){const l=i[a];l>31?console.error(`Rapier only supports 32 layers, layer ${l} is not supported`):n|=1<<Math.floor(l)}const r=e.filter;let o=0;if(r==null)o=65535;else for(let a=0;a<r.length;a++){const l=r[a];l>31?console.error(`Rapier only supports 32 layers, layer ${l} is not supported`):o|=1<<Math.floor(l)}t.setCollisionGroups(n<<16|o)}getRigidbody(e,t){if(!this.world)throw new Error("Physics world not initialized");let i=null;if(e.attachedRigidbody){const n=e.attachedRigidbody;if(i=n[Aa],!i){const r=n.isKinematic&&!lF;ho&&console.log("Create rigidbody",r);const o=r?Dg.RigidBodyDesc.kinematicPositionBased():Dg.RigidBodyDesc.dynamic(),a=$t(e.attachedRigidbody.gameObject);o.setTranslation(a.x,a.y,a.z),o.setRotation(gn(e.attachedRigidbody.gameObject)),o.centerOfMass=new Dg.Vector3(n.centerOfMass.x,n.centerOfMass.y,n.centerOfMass.z),i=this.world.createRigidBody(o),this.bodies.push(i),this.objects.push(n)}i[Qa]=n,n[Aa]=i,this.internalUpdateRigidbodyProperties(n,i),this.getRigidbodyRelativeMatrix(e.gameObject,n.gameObject,t),e[XJ]=i}else{const n=Dg.RigidBodyDesc.kinematicPositionBased(),r=$t(e.gameObject);n.setTranslation(r.x,r.y,r.z),n.setRotation(gn(e.gameObject)),i=this.world.createRigidBody(n),t.identity(),i[Qa]=null}return i}internal_getRigidbody(e){return e.isCollider===!0?e[XJ]:e[Aa]}internalUpdateColliderProperties(e,t){const i=t.shape;let n=!1;switch(i.type){case Zs.Ball:{const u=i,f=e,m=e.gameObject,g=kn(m,this._tempPosition),A=Math.abs(f.radius*g.x);n=u.radius!==A,u.radius=A,n&&t.setShape(u);break}case Zs.Cuboid:const r=i,o=e,a=e.gameObject,l=kn(a,this._tempPosition),c=o.size.x*.5*l.x,h=o.size.y*.5*l.y,d=o.size.z*.5*l.z;n=r.halfExtents.x!==c||r.halfExtents.y!==h||r.halfExtents.z!==d,r.halfExtents.x=c,r.halfExtents.y=h,r.halfExtents.z=d,n&&t.setShape(r);break}if(n){const r=e.attachedRigidbody;if(r!=null&&r.autoMass){const o=this.getBody(r);o==null||o.recomputeMassPropertiesFromColliders()}}this.updateColliderCollisionGroups(e),e.isTrigger!==t.isSensor()&&t.setSensor(e.isTrigger)}internalUpdateRigidbodyProperties(e,t){if(t.enableCcd(e.collisionDetectionMode!==MP.Discrete),t.setLinearDamping(e.drag),t.setAngularDamping(e.angularDrag),t.setGravityScale(e.useGravity?e.gravityScale:0,!0),e.dominanceGroup<=127&&e.dominanceGroup>=-127?t.setDominanceGroup(Math.floor(e.dominanceGroup)):t.setDominanceGroup(0),e.autoMass){t.setAdditionalMass(0,!1);for(let i=0;i<t.numColliders();i++)t.collider(i).setDensity(1);t.recomputeMassPropertiesFromColliders()}else{t.setAdditionalMass(e.mass,!1);for(let i=0;i<t.numColliders();i++)t.collider(i).setDensity(1e-7);t.recomputeMassPropertiesFromColliders()}t.setEnabledRotations(!e.lockRotationX,!e.lockRotationY,!e.lockRotationZ,!1),t.setEnabledTranslations(!e.lockPositionX,!e.lockPositionY,!e.lockPositionZ,!1),e.isKinematic?t.setBodyType(Dg.RigidBodyType.KinematicPositionBased,!1):t.setBodyType(Dg.RigidBodyType.Dynamic,!1)}step(e){if(this.world&&this.enabled){if(this._isUpdatingPhysicsWorld=!0,this.eventQueue||(this.eventQueue=new C5e(!1)),e===void 0||e<=0){this._isUpdatingPhysicsWorld=!1;return}else e!==void 0&&(this.world.timestep=lt.lerp(this.world.timestep,e,.8));try{this.world.step(this.eventQueue)}catch(t){console.warn("Error running physics step",t)}this._isUpdatingPhysicsWorld=!1}}postStep(){this.world&&this.enabled&&(this._isUpdatingPhysicsWorld=!0,this.syncObjects(),this._isUpdatingPhysicsWorld=!1,this.eventQueue&&!this.collisionHandler&&(this.collisionHandler=new T5e(this.world,this.eventQueue)),this.collisionHandler&&(this.collisionHandler.handleCollisionEvents(),this.collisionHandler.update()),this.updateDebugRendering(this.world))}updateDebugRendering(e){var t,i,n,r;if(ho||lF||I5e||this.debugRenderColliders===!0){if(!this.lines){const a=new _n({color:7855479,fog:!1}),l=new It;this.lines=new sa(l,a),this.lines.layers.disableAll(),this.lines.layers.enable(2)}this.lines.parent!==((t=this.context)==null?void 0:t.scene)&&((i=this.context)==null||i.scene.add(this.lines));const o=e.debugRender();this.lines.geometry.setAttribute("position",new dt(o.vertices,3)),this.lines.geometry.setAttribute("color",new dt(o.colors,4)),(this.context.time.frame%30===0||((n=this.lines.geometry.boundingSphere)==null?void 0:n.radius)===0)&&this.lines.geometry.computeBoundingSphere()}else this.lines&&((r=this.context)==null||r.scene.remove(this.lines))}syncObjects(){if(!lF)for(let e=0;e<this.bodies.length;e++){const t=this.objects[e],i=this.bodies[e],n=t;if((n==null?void 0:n.isCollider)===!0&&!n.attachedRigidbody){const l=i.parent();l?this.syncPhysicsBody(t.gameObject,l,!0,!0):this.syncPhysicsBody(t.gameObject,i,!0,!0);continue}const r=i.translation(),o=i.rotation();if(Number.isNaN(r.x)||Number.isNaN(o.x)){!n.__COLLIDER_NAN&&Qe()&&(console.warn("Collider has NaN values",n.name,n.gameObject,i),n.__COLLIDER_NAN=!0);continue}const a=t.center;if(a&&a.isVector3){this._tempQuaternion.set(o.x,o.y,o.z,o.w);const l=this._tempPosition.copy(a).applyQuaternion(this._tempQuaternion),c=kn(t.gameObject);l.multiply(c),r.x-=l.x,r.y-=l.y,r.z-=l.z}q0(t.gameObject,r.x,r.y,r.z),mO(t.gameObject,o.x,o.y,o.z,o.w)}}syncPhysicsBody(e,t,i,n){if(t instanceof VJ){const r=$t(e,this._tempPosition),o=gn(e,this._tempQuaternion);switch(t.bodyType()){case Aw.Fixed:case Aw.KinematicPositionBased:case Aw.KinematicVelocityBased:i&&t.setNextKinematicTranslation(r),n&&t.setNextKinematicRotation(o);break;default:i&&t.setTranslation(r,!1),n&&t.setRotation(o,!1);break}}else if(t instanceof zJ){e.matrixWorldNeedsUpdate&&e.updateWorldMatrix(!0,!1),e.matrixWorld.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const r=this._tempPosition,o=this._tempQuaternion,a=t[Qa];if(this.tryApplyCenter(a,r),i){const l=t.translation();(l.x!==r.x||l.y!==r.y||l.z!==r.z)&&t.setTranslation(r)}if(n){const l=t.rotation();(l.x!==o.x||l.y!==o.y||l.z!==o.z||l.w!==o.w)&&t.setRotation(o)}}}tryApplyCenter(e,t){const i=e.center;i&&e.gameObject&&(i.x!==0||i.y!==0||i.z!==0)&&(this._tempCenterPos.x=i.x,this._tempCenterPos.y=i.y,this._tempCenterPos.z=i.z,kn(e.gameObject,this._tempCenterVec),this._tempCenterPos.multiply(this._tempCenterVec),e.attachedRigidbody?this._tempCenterPos.applyQuaternion(e.gameObject.quaternion):(gn(e.gameObject,this._tempCenterQuaternion),this._tempCenterPos.applyQuaternion(this._tempCenterQuaternion)),t.x+=this._tempCenterPos.x,t.y+=this._tempCenterPos.y,t.z+=this._tempCenterPos.z)}getRigidbodyRelativeMatrix(e,t,i,n){if(n===void 0&&(n=Sw._matricesBuffer,n.length=0),e===t){const r=kn(e,this._tempPosition);i.makeScale(r.x,r.y,r.z);for(let o=n.length-1;o>=0;o--)i.multiply(n[o]);return i}return n.push(e.matrix),e.parent&&this.getRigidbodyRelativeMatrix(e.parent,t,i,n),i}addFixedJoint(e,t){if(!this.world){console.error("Physics world not initialized");return}const i=e[Aa],n=t[Aa];this.calculateJointRelativeMatrices(e.gameObject,t.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const r=Ku.fixed(Sw.centerConnectionPos,Sw.centerConnectionRot,this._tempPosition,this._tempQuaternion),o=this.world.createImpulseJoint(r,i,n,!0);ho&&console.log("ADD FIXED JOINT",o)}addHingeJoint(e,t,i,n){if(!this.world){console.error("Physics world not initialized");return}const r=e[Aa],o=t[Aa];this.calculateJointRelativeMatrices(e.gameObject,t.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const a=Dg.JointData.revolute(i,this._tempPosition,n),l=this.world.createImpulseJoint(a,r,o,!0);ho&&console.log("ADD HINGE JOINT",l)}calculateJointRelativeMatrices(e,t,i){e.updateWorldMatrix(!0,!1),t.updateWorldMatrix(!0,!1);const n=e.matrixWorld,r=t.matrixWorld;n.elements[0]=1,n.elements[5]=1,n.elements[10]=1,r.elements[0]=1,r.elements[5]=1,r.elements[10]=1,i.copy(r).premultiply(n.invert()).invert()}};let Kg=Sw;p(Kg,"_didLoadPhysicsEngine",!1),p(Kg,"_matricesBuffer",[]),p(Kg,"centerConnectionPos",{x:0,y:0,z:0}),p(Kg,"centerConnectionRot",{x:0,y:0,z:0,w:1});class T5e{constructor(e,t){p(this,"world");p(this,"eventQueue");p(this,"activeCollisions",[]);p(this,"activeCollisionsStay",[]);p(this,"activeTriggers",[]);this.world=e,this.eventQueue=t}handleCollisionEvents(){this.eventQueue&&this.world&&this.eventQueue.drainCollisionEvents((e,t,i)=>{const n=this.world.getCollider(e),r=this.world.getCollider(t);if(!n||!r)return;const o=n[Qa],a=r[Qa];cF&&console.log("EVT",o.name,a.name,i,n,r),o&&a&&(i?(this.onCollisionStarted(o,n,a,r),this.onCollisionStarted(a,r,o,n)):(this.onCollisionEnded(o,a),this.onCollisionEnded(a,o)))})}update(){this.onHandleCollisionStay()}onCollisionStarted(e,t,i,n){let r=null;if(e.isTrigger||i.isTrigger)tA(e.gameObject,o=>{o.onTriggerEnter&&!o.destroyed&&o.onTriggerEnter(i),this.activeTriggers.push({collider:e,component:o,otherCollider:i})});else{const o=e.gameObject;this.world.contactPair(t,n,(a,l)=>{tA(o,c=>{var d;if(c.destroyed)return;const h=c.onCollisionEnter||c.onCollisionStay||c.onCollisionExit;if(h||cF){if(!r){const u=[],f=a.normal();for(let m=0;m<a.numSolverContacts();m++){const g=a.solverContactPoint(m),A=a.contactImpulse(m);if(g){const y=a.contactDist(m),b=a.solverContactFriction(m),x=a.solverContactTangentVelocity(m),v=new Zoe(g,y,f,A,b,x);u.push(v),cF&&Mt.DrawDirection(g,f,16711680,3,!0)}}r=new Woe(o,i,u)}if(h){const u={collider:e,component:c,collision:r};this.activeCollisions.push(u),c.onCollisionStay&&this.activeCollisionsStay.push(u),(d=c.onCollisionEnter)==null||d.call(c,r)}}})})}}onHandleCollisionStay(){for(const e of this.activeCollisionsStay){const t=e.component;if(!t.destroyed&&t.activeAndEnabled&&t.onCollisionStay){if(e.collision.collider.destroyed)continue;const i=e.collision;t.onCollisionStay(i)}}for(const e of this.activeTriggers){const t=e.component;if(!t.destroyed&&t.activeAndEnabled&&t.onTriggerStay){const i=e.otherCollider;if(i.destroyed)continue;t.onTriggerStay(i)}}}onCollisionEnded(e,t){if(!(e.destroyed||t.destroyed)){for(let i=0;i<this.activeCollisions.length;i++){const n=this.activeCollisions[i],r=n.collider;if(r.destroyed||n.collision.collider.destroyed){this.activeCollisions.splice(i,1),i--;continue}if(r===e&&n.collision.collider===t){const o=n.component;if(this.activeCollisions.splice(i,1),i--,o.activeAndEnabled&&o.onCollisionExit){const a=n.collision;o.onCollisionExit(a)}}}for(let i=0;i<this.activeCollisionsStay.length;i++){const n=this.activeCollisionsStay[i],r=n.collider;if(r.destroyed||n.collision.collider.destroyed){this.activeCollisionsStay.splice(i,1),i--;continue}if(r===e&&n.collision.collider===t){const o=n.component;if(this.activeCollisionsStay.splice(i,1),i--,o.activeAndEnabled&&o.onCollisionExit){const a=n.collision;o.onCollisionExit(a)}}}for(let i=0;i<this.activeTriggers.length;i++){const n=this.activeTriggers[i],r=n.collider;if(r.destroyed||n.otherCollider.destroyed){this.activeTriggers.splice(i,1),i--;continue}if(r===e&&n.otherCollider===t){const o=n.component;if(this.activeTriggers.splice(i,1),i--,o.activeAndEnabled&&o.onTriggerExit){const a=n.otherCollider;o.onTriggerExit(a)}}}}}}class E5e{static async createComparisonScene(e){const{files:t}=e,n=await Promise.all(t.map(A=>new gi(A).loadAssetAsync())),r=new sr;let o=0;for(const A of n)if(A instanceof ye){A.position.y=o,r.add(A);const y=ec([A]);o+=y.getSize(new T).y,o+=.1}const a=new Xt(20);r.add(a);const l=e.environment||"https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/studio_small_09_1k.exr";if(l){let A=null;if(l.endsWith(".hdr")){const y=(await Promise.resolve().then(()=>$Pe)).RGBELoader;A=new y}else if(l.endsWith(".exr")){const y=(await Promise.resolve().then(()=>qPe)).EXRLoader;A=new y}if(A){const y=await A.loadAsync(l).catch(b=>(console.error(b),null));y&&(y.mapping=wo,y.needsUpdate=!0,r.background=y,r.environment=y,r.backgroundBlurriness=.75)}else console.warn("Unsupported environment map format",l)}const c=ec(r.children),h=c.getCenter(new T),d=c.getSize(new T),f=Math.max(d.x,d.y,d.z)/(2*Math.tan(Math.PI*a.fov/360));a.position.set(h.x,h.y,f),a.lookAt(h);const m=new Roe(a,e.domElement||document.body);m.target=h,m.update();const g=(e.domElement||document.body).getBoundingClientRect();return a.aspect=g.width/g.height,a.updateProjectionMatrix(),{scene:r,camera:a}}}let rU=0;function OJ(s){s?rU++:rU--}function R5e(){return rU>0}class Dle{constructor(e){p(this,"writer");this.writer=e}writeNode(e){}}class L5e extends Dle{beforeWriteNode(e,t){Mt.isGizmo(e)&&(t.keep=!1)}}class B5e extends Dle{beforeWriteTexture(e,t){e.isRenderTargetTexture&&(t.newTexture=A5(new hn(1,1,1,0)))}}const P5e={binary:!0,animations:!0};async function G5e(s){if(!s.context)throw new Error("No context provided to exportAsGLTF");s.scene||(s.scene=s.context.scene);const e={...P5e,...s},{context:t}=e,i=new JP;i.register(a=>new Cae(a)),i.register(a=>new L5e(a)),i.register(a=>new B5e(a)),eZ(i,e.context);const n={binary:e.binary,animations:N5e(t,e.scene,[])},r=new k5e;console.log("Exporting GLTF",n),r.onBeforeExport(e),OJ(!0);const o=await i.parseAsync(e.scene,n).catch(a=>(console.error(a),null));if(OJ(!1),r.onAfterExport(e),!o)throw new Error("Failed to export GLTF");if(e.downloadAs!=null){let a=null;if(o instanceof ArrayBuffer?a=new Blob([o],{type:"application/octet-stream"}):console.error("Can not download GLTF as a blob",o),a){const l=URL.createObjectURL(a),c=document.createElement("a");c.href=l;let h=e.downloadAs;!h.endsWith(".glb")&&!h.endsWith(".gltf")&&(h+=e.binary?".glb":".gltf"),c.download=h,c.click()}}return o}const ZJ=Symbol("needle:weight");class k5e{constructor(){p(this,"_undo",[])}onBeforeExport(e){e.context.animations.mixers.forEach(t=>{const i=Bx.tryGetActionsFromMixer(t);if(i)for(let n=0;n<i.length;n++){const r=i[n];r[ZJ]=r.weight,r.weight=0,this._undo.push(()=>{r.weight=r[ZJ]})}t.update(0)})}onAfterExport(e){this._undo.forEach(t=>t()),this._undo.length=0}}function N5e(s,e,t){s.animations.mixers.forEach(n=>{const r=Bx.tryGetActionsFromMixer(n);if(r)for(let o=0;o<r.length;o++){const l=r[o].getClip();t.push(l)}}),Array.isArray(e)||(e=[e]);for(const n of e)Bx.tryGetAnimationClipsFromObjectHierarchy(n,t);const i=new Set(t);return Array.from(i)}const WJ="needle-button",dF=Qe();var m0,g0,A0,xa,$u,ax,Z2,Fle,W2,Vle,m1;class XZ extends HTMLElement{constructor(){super();ml(this,Z2);ml(this,W2);ml(this,m0,void 0);ml(this,g0,void 0);ml(this,A0,void 0);ml(this,xa,void 0);ml(this,$u,void 0);ml(this,ax,void 0);ml(this,m1,t=>{dF&&console.log("Needle Button clicked"),!t.defaultPrevented&&Vi(this,xa)&&Vi(this,xa).click()});this.removeEventListener("click",Vi(this,m1)),this.addEventListener("click",Vi(this,m1))}attributeChangedCallback(t,i,n){ng(this,Z2,Fle).call(this)}}m0=new WeakMap,g0=new WeakMap,A0=new WeakMap,xa=new WeakMap,$u=new WeakMap,ax=new WeakMap,Z2=new WeakSet,Fle=function(){var i,n;if((i=Vi(this,xa))==null||i.remove(),this.getAttribute("ar")!=null)Vi(this,$u)??$c(this,$u,new vp),$c(this,xa,Vi(this,$u).createARButton());else if(this.getAttribute("vr")!=null)Vi(this,$u)??$c(this,$u,new vp),$c(this,xa,Vi(this,$u).createVRButton());else if(this.getAttribute("quicklook")!=null)Vi(this,$u)??$c(this,$u,new vp),$c(this,xa,Vi(this,$u).createQuicklookButton());else{dF?console.warn("No button type specified for <needle-button>. Use either ar, vr or quicklook attribute."):console.debug("No button type specified for <needle-button>. Use either ar, vr or quicklook attribute.");return}Vi(this,m0)??$c(this,m0,this.attachShadow({mode:"open"})),Vi(this,g0)??$c(this,g0,document.createElement("slot")),Vi(this,A0)??$c(this,A0,document.createElement("style")),Vi(this,A0).innerHTML=`
            button {
                all: initial;
                cursor: inherit;
                color: inherit;
                font-family: inherit;
                gap: inherit;
                white-space: nowrap;
            }
        `,this.getAttribute("unstyled")!=null||(Vi(this,A0).innerHTML+=`
            :host {
                display: inline-block;
                background: rgba(255, 255, 255, .8);
                backdrop-filter: blur(10px);
                width: fit-content;
                transition: background .2s;

                cursor: pointer;
                padding: 0.4rem .5rem;
                border-radius: 0.8rem;
                color: black;
                background: rgba(245, 245, 245, .8);
                outline: rgba(0,0,0,.05) 1px solid;
            }
            :host(:hover) {
                background: rgba(255, 255, 255, 1);
                transition: background .2s;
            }
            slot {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: .5rem;
            }
`),Vi(this,g0).innerHTML=Vi(this,xa).innerHTML,Vi(this,g0).style.cssText="display: flex; align-items: center; justify-content: center;",Vi(this,xa).innerHTML=Vi(this,g0).outerHTML,Vi(this,m0).innerHTML=Vi(this,xa).outerHTML,Vi(this,m0).prepend(Vi(this,A0)),m2(Mz,{element:Vi(this,m0)}),(n=Vi(this,ax))==null||n.disconnect(),Vi(this,ax)??$c(this,ax,new MutationObserver(()=>ng(this,W2,Vle).call(this))),Vi(this,ax).observe(Vi(this,xa),{attributes:!0}),dF&&console.log("Needle Button updated")},W2=new WeakSet,Vle=function(){Vi(this,xa)&&(Vi(this,xa).style.display==="none"?this.style.display="none":this.style.display==="none"&&(this.style.display=""))},m1=new WeakMap,p(XZ,"observedAttributes",["ar","vr","quicklook"]);typeof window<"u"&&!window.customElements.get(WJ)&&window.customElements.define(WJ,XZ);const k2=ee("debugmissingcamera");Oi.registerCallback(ji.MissingCamera,s=>{var a,l,c;k2&&console.warn("Creating missing camera");const e=s.context.scene,t=new Xt;t.name="Default Fallback Camera",e.add(t);const i=new Cn;i.sourceId=((l=(a=s.files)==null?void 0:a[0])==null?void 0:l.src)??"unknown",(c=s.context.domElement.getAttribute("skybox-image"))!=null&&c.length||0>0||s.context.lightmaps.tryGetSkybox(i.sourceId)?i.clearFlags=$f.Skybox:i.clearFlags=$f.SolidColor,i.backgroundColor=new hn(.5,.5,.5,1),i.fieldOfView=35,s.context.domElement.getAttribute("transparent")!=null&&(i.clearFlags=$f.Uninitialized),i.backgroundBlurriness=.2;const r=R0(t,i,!0);t.position.x=0,t.position.y=1,t.position.z=2;const o=s.context.domElement;return(o==null?void 0:o.cameraControls)!=!1&&zle(s.context,r),r});Oi.registerCallback(ji.ContextCreated,s=>{if(!s.context.mainCamera){k2&&console.log("Will not auto-fit because a default camera exists");return}const e=s.context.domElement;if((e==null?void 0:e.cameraControls)==!0){const t=Cie(s.context.mainCamera);if((t==null?void 0:t.isCameraController)==!0){k2&&console.log("Will not auto-fit because a camera controller exists");return}zle(s.context)}});function zle(s,e){e=e??s.mainCameraComponent;const t=e==null?void 0:e.gameObject;if(k2&&console.log("Creating default camera controls",e==null?void 0:e.name),t){const i=dM(t,on);i.sourceId=(e==null?void 0:e.sourceId)??"unknown";const n=s.domElement.getAttribute("auto-rotate");if(i.autoRotate=n!=null&&n!="0"&&(n==null?void 0:n.toLowerCase())!="false",i.autoRotateSpeed=.5,i.autoFit=!0,i.autoRotate&&n){const r=parseFloat(n);isNaN(r)||(i.autoRotateSpeed=r)}}else console.warn("Missing camera object, can not add orbit controls")}Oi.registerCallback(ji.ContextCreated,s=>{const e=s.context.domElement.getAttribute("autoplay");if(e!==void 0&&(e===""||e==="true"||e==="1")&&s.files)for(const t of s.files)$.foreachComponent(t.file.scene,n=>{if(n.enabled!==!1){if(n instanceof na&&n.playAutomatically||n instanceof Ro||n instanceof ym&&n.playOnAwake===!0)return!0;if(n instanceof na)return n.playAutomatically=!0,!0;if(n instanceof ym)return n.playOnAwake=!0,!0}},!0)!==!0&&Bx.assignAnimationsFromFile(t.file,{createAnimationComponent:(n,r)=>Yl(n,na)})});const HA={Context:Wt,glTF:{loadFromURL:GZ}};globalThis.Needle!==void 0&&console.warn("Needle Engine is already imported");globalThis.Needle=HA;function Ule(s){for(const e in s)HA[e]=s[e]}Ule(vke);Ule(HOe);HA.onStart=E5;HA.onUpdate=R5;HA.onBeforeRender=Loe;HA.NeedleXRSession=Vt;for(const s of Object.getOwnPropertyNames($))switch(s){case"prototype":case"constructor":case"length":case"name":continue;default:HA[s]=$[s];break}globalThis.THREE?console.warn("Threejs is already imported"):globalThis.THREE=S_e;class D5e{constructor(e){if(this._retries=0,!Number.isInteger(e)||e<0)throw new Error("Backoff must be a positive integer");this.backoff=e}get retries(){return this._retries}get current(){return this.backoff}next(){return this._retries++,this.backoff}reset(){this._retries=0}}class F5e{constructor(e,t){if(this._retries=0,!Number.isInteger(e)||e<0)throw new Error("Base must be a positive integer or zero");if(t!==void 0&&(!Number.isInteger(t)||t<0))throw new Error("ExpMax must be a undefined, a positive integer or zero");this.base=e,this.expMax=t,this.i=0}get retries(){return this._retries}get current(){return this.base*Math.pow(2,this.i)}next(){return this._retries++,this.i=this.expMax===void 0?this.i+1:Math.min(this.i+1,this.expMax),this.current}reset(){this._retries=0,this.i=0}}class V5e{constructor(e,t,i){if(this.i=0,this._retries=0,e<0)throw new Error("Initial must be a positive number or zero");if(t<0)throw new Error("Increment must be a positive number or zero");if(i!==void 0&&i<0)throw new Error("Max must be undefined, a positive number or zero");if(i!==void 0&&i<e)throw new Error("Max must be undefined or greater than or equal to initial");this.initial=e,this.increment=t,this.max=i}get retries(){return this._retries}get current(){return this.max===void 0?this.initial+this.increment*this.i:Math.min(this.initial+this.increment*this.i,this.max)}next(){return this._retries++,this.i++,this.current}reset(){this._retries=0,this.i=0}}class z5e{constructor(){this.elements=[]}add(e){this.elements.push(e)}clear(){this.elements.length=0}forEach(e){this.elements.forEach(e)}length(){return this.elements.length}isEmpty(){return this.elements.length===0}peek(){return this.elements[0]}read(){return this.elements.shift()}}class U5e{constructor(e){if(!Number.isInteger(e)||e<=0)throw new Error("Capacity must be a positive integer");this.elements=new Array(e+1),this.head=0,this.tail=0}add(e){this.elements[this.head]=e,this.head=(this.head+1)%this.elements.length,this.head===this.tail&&(this.tail=(this.tail+1)%this.elements.length)}clear(){this.head=0,this.tail=0}forEach(e){for(let t=this.tail;t!==this.head;t=(t+1)%this.elements.length)e(this.elements[t])}length(){return this.tail===this.head?0:this.tail<this.head?this.head-this.tail:this.elements.length-this.tail+this.head}isEmpty(){return this.head===this.tail}peek(){return this.isEmpty()?void 0:this.elements[this.tail]}read(){const e=this.peek();return e!==void 0&&(this.tail=(this.tail+1)%this.elements.length),e}}var yn;(function(s){s.open="open",s.close="close",s.error="error",s.message="message",s.retry="retry",s.reconnect="reconnect"})(yn||(yn={}));class Xle{constructor(e,t,i){var n,r,o,a,l,c,h,d,u,f,m,g,A,y,b;this._closedByUser=!1,this.handleOpenEvent=x=>this.handleEvent(yn.open,x),this.handleErrorEvent=x=>this.handleEvent(yn.error,x),this.handleCloseEvent=x=>this.handleEvent(yn.close,x),this.handleMessageEvent=x=>this.handleEvent(yn.message,x),this._url=e,this._protocols=t,this._options={buffer:i==null?void 0:i.buffer,retry:{maxRetries:(n=i==null?void 0:i.retry)===null||n===void 0?void 0:n.maxRetries,instantReconnect:(r=i==null?void 0:i.retry)===null||r===void 0?void 0:r.instantReconnect,backoff:(o=i==null?void 0:i.retry)===null||o===void 0?void 0:o.backoff},listeners:{open:[...(l=(a=i==null?void 0:i.listeners)===null||a===void 0?void 0:a.open)!==null&&l!==void 0?l:[]],close:[...(h=(c=i==null?void 0:i.listeners)===null||c===void 0?void 0:c.close)!==null&&h!==void 0?h:[]],error:[...(u=(d=i==null?void 0:i.listeners)===null||d===void 0?void 0:d.error)!==null&&u!==void 0?u:[]],message:[...(m=(f=i==null?void 0:i.listeners)===null||f===void 0?void 0:f.message)!==null&&m!==void 0?m:[]],retry:[...(A=(g=i==null?void 0:i.listeners)===null||g===void 0?void 0:g.retry)!==null&&A!==void 0?A:[]],reconnect:[...(b=(y=i==null?void 0:i.listeners)===null||y===void 0?void 0:y.reconnect)!==null&&b!==void 0?b:[]]}},this._underlyingWebsocket=this.tryConnect()}get url(){return this._url}get protocols(){return this._protocols}get buffer(){return this._options.buffer}get maxRetries(){return this._options.retry.maxRetries}get instantReconnect(){return this._options.retry.instantReconnect}get backoff(){return this._options.retry.backoff}get closedByUser(){return this._closedByUser}get lastConnection(){return this._lastConnection}get underlyingWebsocket(){return this._underlyingWebsocket}get readyState(){return this._underlyingWebsocket.readyState}get bufferedAmount(){return this._underlyingWebsocket.bufferedAmount}get extensions(){return this._underlyingWebsocket.extensions}get binaryType(){return this._underlyingWebsocket.binaryType}set binaryType(e){this._underlyingWebsocket.binaryType=e}send(e){this.closedByUser||(this._underlyingWebsocket.readyState===this._underlyingWebsocket.OPEN?this._underlyingWebsocket.send(e):this.buffer!==void 0&&this.buffer.add(e))}close(e,t){this.cancelScheduledConnectionRetry(),this._closedByUser=!0,this._underlyingWebsocket.close(e,t)}addEventListener(e,t,i){this._options.listeners[e].push({listener:t,options:i})}removeEventListener(e,t,i){const n=r=>r.listener!==t||r.options!==i;this._options.listeners[e]=this._options.listeners[e].filter(n)}tryConnect(){return this._underlyingWebsocket=new WebSocket(this.url,this.protocols),this._underlyingWebsocket.addEventListener(yn.open,this.handleOpenEvent),this._underlyingWebsocket.addEventListener(yn.close,this.handleCloseEvent),this._underlyingWebsocket.addEventListener(yn.error,this.handleErrorEvent),this._underlyingWebsocket.addEventListener(yn.message,this.handleMessageEvent),this._underlyingWebsocket}clearWebsocket(){this._underlyingWebsocket.removeEventListener(yn.open,this.handleOpenEvent),this._underlyingWebsocket.removeEventListener(yn.close,this.handleCloseEvent),this._underlyingWebsocket.removeEventListener(yn.error,this.handleErrorEvent),this._underlyingWebsocket.removeEventListener(yn.message,this.handleMessageEvent),this._underlyingWebsocket.close()}dispatchEvent(e,t){const i=this._options.listeners[e],n=[];i.forEach(({listener:r,options:o})=>{r(this,t),(o===void 0||o.once===void 0||!o.once)&&n.push({listener:r,options:o})}),this._options.listeners[e]=n}handleEvent(e,t){switch(e){case yn.close:this.dispatchEvent(e,t),this.scheduleConnectionRetryIfNeeded();break;case yn.open:if(this.backoff!==void 0&&this._lastConnection!==void 0){const i={retries:this.backoff.retries,lastConnection:new Date(this._lastConnection)},n=new CustomEvent(yn.reconnect,{detail:i});this.dispatchEvent(yn.reconnect,n),this.backoff.reset()}this._lastConnection=new Date,this.dispatchEvent(e,t),this.sendBufferedData();break;case yn.retry:this.dispatchEvent(e,t),this.clearWebsocket(),this.tryConnect();break;default:this.dispatchEvent(e,t);break}}sendBufferedData(){if(this.buffer!==void 0)for(let e=this.buffer.read();e!==void 0;e=this.buffer.read())this.send(e)}scheduleConnectionRetryIfNeeded(){if(this.closedByUser||this.backoff===void 0)return;const e=i=>{const n=new CustomEvent(yn.retry,{detail:i});this.handleEvent(yn.retry,n)},t={backoff:this._options.retry.instantReconnect===!0?0:this.backoff.next(),retries:this._options.retry.instantReconnect===!0?0:this.backoff.retries,lastConnection:this._lastConnection};(this._options.retry.maxRetries===void 0||t.retries<=this._options.retry.maxRetries)&&(this.retryTimeout=globalThis.setTimeout(()=>e(t),t.backoff))}cancelScheduledConnectionRetry(){globalThis.clearTimeout(this.retryTimeout)}}class X5e{constructor(e){this._url=e}get url(){return this._url}withProtocols(e){return this._protocols=e,this}get protocols(){return this._protocols}withMaxRetries(e){var t;return this._options=Object.assign(Object.assign({},this._options),{retry:Object.assign(Object.assign({},(t=this._options)===null||t===void 0?void 0:t.retry),{maxRetries:e})}),this}get maxRetries(){var e,t;return(t=(e=this._options)===null||e===void 0?void 0:e.retry)===null||t===void 0?void 0:t.maxRetries}withInstantReconnect(e){var t;return this._options=Object.assign(Object.assign({},this._options),{retry:Object.assign(Object.assign({},(t=this._options)===null||t===void 0?void 0:t.retry),{instantReconnect:e})}),this}get instantReconnect(){var e,t;return(t=(e=this._options)===null||e===void 0?void 0:e.retry)===null||t===void 0?void 0:t.instantReconnect}withBackoff(e){var t;return this._options=Object.assign(Object.assign({},this._options),{retry:Object.assign(Object.assign({},(t=this._options)===null||t===void 0?void 0:t.retry),{backoff:e})}),this}get backoff(){var e,t;return(t=(e=this._options)===null||e===void 0?void 0:e.retry)===null||t===void 0?void 0:t.backoff}withBuffer(e){return this._options=Object.assign(Object.assign({},this._options),{buffer:e}),this}get buffer(){var e;return(e=this._options)===null||e===void 0?void 0:e.buffer}onOpen(e,t){return this.addListener(yn.open,e,t),this}onClose(e,t){return this.addListener(yn.close,e,t),this}onError(e,t){return this.addListener(yn.error,e,t),this}onMessage(e,t){return this.addListener(yn.message,e,t),this}onRetry(e,t){return this.addListener(yn.retry,e,t),this}onReconnect(e,t){return this.addListener(yn.reconnect,e,t),this}build(){return new Xle(this._url,this._protocols,this._options)}addListener(e,t,i){var n,r,o,a,l,c,h,d,u,f,m,g,A,y,b,x,v,_,C,S,M;return this._options=Object.assign(Object.assign({},this._options),{listeners:{open:(o=(r=(n=this._options)===null||n===void 0?void 0:n.listeners)===null||r===void 0?void 0:r.open)!==null&&o!==void 0?o:[],close:(c=(l=(a=this._options)===null||a===void 0?void 0:a.listeners)===null||l===void 0?void 0:l.close)!==null&&c!==void 0?c:[],error:(u=(d=(h=this._options)===null||h===void 0?void 0:h.listeners)===null||d===void 0?void 0:d.error)!==null&&u!==void 0?u:[],message:(g=(m=(f=this._options)===null||f===void 0?void 0:f.listeners)===null||m===void 0?void 0:m.message)!==null&&g!==void 0?g:[],retry:(b=(y=(A=this._options)===null||A===void 0?void 0:A.listeners)===null||y===void 0?void 0:y.retry)!==null&&b!==void 0?b:[],reconnect:(_=(v=(x=this._options)===null||x===void 0?void 0:x.listeners)===null||v===void 0?void 0:v.reconnect)!==null&&_!==void 0?_:[],[e]:[...(M=(S=(C=this._options)===null||C===void 0?void 0:C.listeners)===null||S===void 0?void 0:S[e])!==null&&M!==void 0?M:[],{listener:t,options:i}]}}),this}}const O5e=Object.freeze(Object.defineProperty({__proto__:null,ArrayQueue:z5e,ConstantBackoff:D5e,ExponentialBackoff:F5e,LinearBackoff:V5e,RingQueue:U5e,Websocket:Xle,WebsocketBuilder:X5e,get WebsocketEvent(){return yn}},Symbol.toStringTag,{value:"Module"})),OZ=0,Ole=1,Zle=2,Z5e=0,W5e=1,oU=2,jR=1.25,aU=1,nm=6*4+4+4,hG=65535,H5e=Math.pow(2,-24),uF=Symbol("SKIP_GENERATION");function Wle(s){return s.index?s.index.count:s.attributes.position.count}function Gv(s){return Wle(s)/3}function Hle(s,e=ArrayBuffer){return s>65535?new Uint32Array(new e(4*s)):new Uint16Array(new e(2*s))}function Q5e(s,e){if(!s.index){const t=s.attributes.position.count,i=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=Hle(t,i);s.setIndex(new dt(n,1));for(let r=0;r<t;r++)n[r]=r}}function Qle(s,e){const t=Gv(s),i=e||s.drawRange,n=i.start/3,r=(i.start+i.count)/3,o=Math.max(0,n),a=Math.min(t,r)-o;return[{offset:Math.floor(o),count:Math.floor(a)}]}function Kle(s,e){if(!s.groups||!s.groups.length)return Qle(s,e);const t=[],i=new Set,n=e||s.drawRange,r=n.start/3,o=(n.start+n.count)/3;for(const l of s.groups){const c=l.start/3,h=(l.start+l.count)/3;i.add(Math.max(r,c)),i.add(Math.min(o,h))}const a=Array.from(i.values()).sort((l,c)=>l-c);for(let l=0;l<a.length-1;l++){const c=a[l],h=a[l+1];t.push({offset:Math.floor(c),count:Math.floor(h-c)})}return t}function K5e(s,e){const t=Gv(s),i=Kle(s,e).sort((o,a)=>o.offset-a.offset),n=i[i.length-1];n.count=Math.min(t-n.offset,n.count);let r=0;return i.forEach(({count:o})=>r+=o),t!==r}function pF(s,e,t,i,n){let r=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,h=-1/0,d=1/0,u=1/0,f=1/0,m=-1/0,g=-1/0,A=-1/0;for(let y=e*6,b=(e+t)*6;y<b;y+=6){const x=s[y+0],v=s[y+1],_=x-v,C=x+v;_<r&&(r=_),C>l&&(l=C),x<d&&(d=x),x>m&&(m=x);const S=s[y+2],M=s[y+3],L=S-M,w=S+M;L<o&&(o=L),w>c&&(c=w),S<u&&(u=S),S>g&&(g=S);const E=s[y+4],B=s[y+5],P=E-B,k=E+B;P<a&&(a=P),k>h&&(h=k),E<f&&(f=E),E>A&&(A=E)}i[0]=r,i[1]=o,i[2]=a,i[3]=l,i[4]=c,i[5]=h,n[0]=d,n[1]=u,n[2]=f,n[3]=m,n[4]=g,n[5]=A}function Y5e(s,e=null,t=null,i=null){const n=s.attributes.position,r=s.index?s.index.array:null,o=Gv(s),a=n.normalized;let l;e===null?(l=new Float32Array(o*6),t=0,i=o):(l=e,t=t||0,i=i||o);const c=n.array,h=n.offset||0;let d=3;n.isInterleavedBufferAttribute&&(d=n.data.stride);const u=["getX","getY","getZ"];for(let f=t;f<t+i;f++){const m=f*3,g=f*6;let A=m+0,y=m+1,b=m+2;r&&(A=r[A],y=r[y],b=r[b]),a||(A=A*d+h,y=y*d+h,b=b*d+h);for(let x=0;x<3;x++){let v,_,C;a?(v=n[u[x]](A),_=n[u[x]](y),C=n[u[x]](b)):(v=c[A+x],_=c[y+x],C=c[b+x]);let S=v;_<S&&(S=_),C<S&&(S=C);let M=v;_>M&&(M=_),C>M&&(M=C);const L=(M-S)/2,w=x*2;l[g+w+0]=S+L,l[g+w+1]=L+(Math.abs(S)+L)*H5e}}return l}function Pn(s,e,t){return t.min.x=e[s],t.min.y=e[s+1],t.min.z=e[s+2],t.max.x=e[s+3],t.max.y=e[s+4],t.max.z=e[s+5],t}function HJ(s){let e=-1,t=-1/0;for(let i=0;i<3;i++){const n=s[i+3]-s[i];n>t&&(t=n,e=i)}return e}function QJ(s,e){e.set(s)}function KJ(s,e,t){let i,n;for(let r=0;r<3;r++){const o=r+3;i=s[r],n=e[r],t[r]=i<n?i:n,i=s[o],n=e[o],t[o]=i>n?i:n}}function zE(s,e,t){for(let i=0;i<3;i++){const n=e[s+2*i],r=e[s+2*i+1],o=n-r,a=n+r;o<t[i]&&(t[i]=o),a>t[i+3]&&(t[i+3]=a)}}function O_(s){const e=s[3]-s[0],t=s[4]-s[1],i=s[5]-s[2];return 2*(e*t+t*i+i*e)}const Ou=32,J5e=(s,e)=>s.candidate-e.candidate,bf=new Array(Ou).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),UE=new Float32Array(6);function j5e(s,e,t,i,n,r){let o=-1,a=0;if(r===OZ)o=HJ(e),o!==-1&&(a=(e[o]+e[o+3])/2);else if(r===Ole)o=HJ(s),o!==-1&&(a=q5e(t,i,n,o));else if(r===Zle){const l=O_(s);let c=jR*n;const h=i*6,d=(i+n)*6;for(let u=0;u<3;u++){const f=e[u],A=(e[u+3]-f)/Ou;if(n<Ou/4){const y=[...bf];y.length=n;let b=0;for(let v=h;v<d;v+=6,b++){const _=y[b];_.candidate=t[v+2*u],_.count=0;const{bounds:C,leftCacheBounds:S,rightCacheBounds:M}=_;for(let L=0;L<3;L++)M[L]=1/0,M[L+3]=-1/0,S[L]=1/0,S[L+3]=-1/0,C[L]=1/0,C[L+3]=-1/0;zE(v,t,C)}y.sort(J5e);let x=n;for(let v=0;v<x;v++){const _=y[v];for(;v+1<x&&y[v+1].candidate===_.candidate;)y.splice(v+1,1),x--}for(let v=h;v<d;v+=6){const _=t[v+2*u];for(let C=0;C<x;C++){const S=y[C];_>=S.candidate?zE(v,t,S.rightCacheBounds):(zE(v,t,S.leftCacheBounds),S.count++)}}for(let v=0;v<x;v++){const _=y[v],C=_.count,S=n-_.count,M=_.leftCacheBounds,L=_.rightCacheBounds;let w=0;C!==0&&(w=O_(M)/l);let E=0;S!==0&&(E=O_(L)/l);const B=aU+jR*(w*C+E*S);B<c&&(o=u,c=B,a=_.candidate)}}else{for(let x=0;x<Ou;x++){const v=bf[x];v.count=0,v.candidate=f+A+x*A;const _=v.bounds;for(let C=0;C<3;C++)_[C]=1/0,_[C+3]=-1/0}for(let x=h;x<d;x+=6){let C=~~((t[x+2*u]-f)/A);C>=Ou&&(C=Ou-1);const S=bf[C];S.count++,zE(x,t,S.bounds)}const y=bf[Ou-1];QJ(y.bounds,y.rightCacheBounds);for(let x=Ou-2;x>=0;x--){const v=bf[x],_=bf[x+1];KJ(v.bounds,_.rightCacheBounds,v.rightCacheBounds)}let b=0;for(let x=0;x<Ou-1;x++){const v=bf[x],_=v.count,C=v.bounds,M=bf[x+1].rightCacheBounds;_!==0&&(b===0?QJ(C,UE):KJ(C,UE,UE)),b+=_;let L=0,w=0;b!==0&&(L=O_(UE)/l);const E=n-b;E!==0&&(w=O_(M)/l);const B=aU+jR*(L*b+w*E);B<c&&(o=u,c=B,a=v.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:o,pos:a}}function q5e(s,e,t,i){let n=0;for(let r=e,o=e+t;r<o;r++)n+=s[r*6+i*2];return n/t}class fF{constructor(){this.boundingData=new Float32Array(6)}}function $5e(s,e,t,i,n,r){let o=i,a=i+n-1;const l=r.pos,c=r.axis*2;for(;;){for(;o<=a&&t[o*6+c]<l;)o++;for(;o<=a&&t[a*6+c]>=l;)a--;if(o<a){for(let h=0;h<3;h++){let d=e[o*3+h];e[o*3+h]=e[a*3+h],e[a*3+h]=d}for(let h=0;h<6;h++){let d=t[o*6+h];t[o*6+h]=t[a*6+h],t[a*6+h]=d}o++,a--}else return o}}function eZe(s,e,t,i,n,r){let o=i,a=i+n-1;const l=r.pos,c=r.axis*2;for(;;){for(;o<=a&&t[o*6+c]<l;)o++;for(;o<=a&&t[a*6+c]>=l;)a--;if(o<a){let h=s[o];s[o]=s[a],s[a]=h;for(let d=0;d<6;d++){let u=t[o*6+d];t[o*6+d]=t[a*6+d],t[a*6+d]=u}o++,a--}else return o}}function Sa(s,e){return e[s+15]===65535}function rl(s,e){return e[s+6]}function Zl(s,e){return e[s+14]}function Nc(s){return s+8}function Wl(s,e){return e[s+6]}function ZZ(s,e){return e[s+7]}let Yle,BC,qR,Jle;const tZe=Math.pow(2,32);function lU(s){return"count"in s?1:1+lU(s.left)+lU(s.right)}function iZe(s,e,t){return Yle=new Float32Array(t),BC=new Uint32Array(t),qR=new Uint16Array(t),Jle=new Uint8Array(t),cU(s,e)}function cU(s,e){const t=s/4,i=s/2,n="count"in e,r=e.boundingData;for(let o=0;o<6;o++)Yle[t+o]=r[o];if(n)if(e.buffer){const o=e.buffer;Jle.set(new Uint8Array(o),s);for(let a=s,l=s+o.byteLength;a<l;a+=nm){const c=a/2;Sa(c,qR)||(BC[a/4+6]+=t)}return s+o.byteLength}else{const o=e.offset,a=e.count;return BC[t+6]=o,qR[i+14]=a,qR[i+15]=hG,s+nm}else{const o=e.left,a=e.right,l=e.splitAxis;let c;if(c=cU(s+nm,o),c/4>tZe)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return BC[t+6]=c/4,c=cU(c,a),BC[t+7]=l,c}}function nZe(s,e){const t=(s.index?s.index.count:s.attributes.position.count)/3,i=t>2**16,n=i?4:2,r=e?new SharedArrayBuffer(t*n):new ArrayBuffer(t*n),o=i?new Uint32Array(r):new Uint16Array(r);for(let a=0,l=o.length;a<l;a++)o[a]=a;return o}function sZe(s,e,t,i,n){const{maxDepth:r,verbose:o,maxLeafTris:a,strategy:l,onProgress:c,indirect:h}=n,d=s._indirectBuffer,u=s.geometry,f=u.index?u.index.array:null,m=h?eZe:$5e,g=Gv(u),A=new Float32Array(6);let y=!1;const b=new fF;return pF(e,t,i,b.boundingData,A),v(b,t,i,A),b;function x(_){c&&c(_/g)}function v(_,C,S,M=null,L=0){if(!y&&L>=r&&(y=!0,o&&(console.warn(`MeshBVH: Max depth of ${r} reached when generating BVH. Consider increasing maxDepth.`),console.warn(u))),S<=a||L>=r)return x(C+S),_.offset=C,_.count=S,_;const w=j5e(_.boundingData,M,e,C,S,l);if(w.axis===-1)return x(C+S),_.offset=C,_.count=S,_;const E=m(d,f,e,C,S,w);if(E===C||E===C+S)x(C+S),_.offset=C,_.count=S;else{_.splitAxis=w.axis;const B=new fF,P=C,k=E-C;_.left=B,pF(e,P,k,B.boundingData,A),v(B,P,k,A,L+1);const X=new fF,F=E,H=S-k;_.right=X,pF(e,F,H,X.boundingData,A),v(X,F,H,A,L+1)}return _}}function rZe(s,e){const t=s.geometry;e.indirect&&(s._indirectBuffer=nZe(t,e.useSharedArrayBuffer),K5e(t,e.range)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),s._indirectBuffer||Q5e(t,e);const i=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=Y5e(t),r=e.indirect?Qle(t,e.range):Kle(t,e.range);s._roots=r.map(o=>{const a=sZe(s,n,o.offset,o.count,e),l=lU(a),c=new i(nm*l);return iZe(0,a,c),c})}class Lp{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,n=-1/0;for(let r=0,o=e.length;r<o;r++){const l=e[r][t];i=l<i?l:i,n=l>n?l:n}this.min=i,this.max=n}setFromPoints(e,t){let i=1/0,n=-1/0;for(let r=0,o=t.length;r<o;r++){const a=t[r],l=e.dot(a);i=l<i?l:i,n=l>n?l:n}this.min=i,this.max=n}isSeparated(e){return this.min>e.max||e.min>this.max}}Lp.prototype.setFromBox=function(){const s=new T;return function(t,i){const n=i.min,r=i.max;let o=1/0,a=-1/0;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){s.x=n.x*l+r.x*(1-l),s.y=n.y*c+r.y*(1-c),s.z=n.z*h+r.z*(1-h);const d=t.dot(s);o=Math.min(d,o),a=Math.max(d,a)}this.min=o,this.max=a}}();const oZe=function(){const s=new T,e=new T,t=new T;return function(n,r,o){const a=n.start,l=s,c=r.start,h=e;t.subVectors(a,c),s.subVectors(n.end,n.start),e.subVectors(r.end,r.start);const d=t.dot(h),u=h.dot(l),f=h.dot(h),m=t.dot(l),A=l.dot(l)*f-u*u;let y,b;A!==0?y=(d*u-m*f)/A:y=0,b=(d+y*u)/f,o.x=y,o.y=b}}(),WZ=function(){const s=new Q,e=new T,t=new T;return function(n,r,o,a){oZe(n,r,s);let l=s.x,c=s.y;if(l>=0&&l<=1&&c>=0&&c<=1){n.at(l,o),r.at(c,a);return}else if(l>=0&&l<=1){c<0?r.at(0,a):r.at(1,a),n.closestPointToPoint(a,!0,o);return}else if(c>=0&&c<=1){l<0?n.at(0,o):n.at(1,o),r.closestPointToPoint(o,!0,a);return}else{let h;l<0?h=n.start:h=n.end;let d;c<0?d=r.start:d=r.end;const u=e,f=t;if(n.closestPointToPoint(d,!0,e),r.closestPointToPoint(h,!0,t),u.distanceToSquared(d)<=f.distanceToSquared(h)){o.copy(u),a.copy(d);return}else{o.copy(h),a.copy(f);return}}}}(),aZe=function(){const s=new T,e=new T,t=new js,i=new Fc;return function(r,o){const{radius:a,center:l}=r,{a:c,b:h,c:d}=o;if(i.start=c,i.end=h,i.closestPointToPoint(l,!0,s).distanceTo(l)<=a||(i.start=c,i.end=d,i.closestPointToPoint(l,!0,s).distanceTo(l)<=a)||(i.start=h,i.end=d,i.closestPointToPoint(l,!0,s).distanceTo(l)<=a))return!0;const g=o.getPlane(t);if(Math.abs(g.distanceToPoint(l))<=a){const y=g.projectPoint(l,e);if(o.containsPoint(y))return!0}return!1}}(),lZe=1e-15;function mF(s){return Math.abs(s)<lZe}class Oc extends $s{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new T),this.satBounds=new Array(4).fill().map(()=>new Lp),this.points=[this.a,this.b,this.c],this.sphere=new Vn,this.plane=new js,this.needsUpdate=!0}intersectsSphere(e){return aZe(e,this)}update(){const e=this.a,t=this.b,i=this.c,n=this.points,r=this.satAxes,o=this.satBounds,a=r[0],l=o[0];this.getNormal(a),l.setFromPoints(a,n);const c=r[1],h=o[1];c.subVectors(e,t),h.setFromPoints(c,n);const d=r[2],u=o[2];d.subVectors(t,i),u.setFromPoints(d,n);const f=r[3],m=o[3];f.subVectors(i,e),m.setFromPoints(f,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}}Oc.prototype.closestPointToSegment=function(){const s=new T,e=new T,t=new Fc;return function(n,r=null,o=null){const{start:a,end:l}=n,c=this.points;let h,d=1/0;for(let u=0;u<3;u++){const f=(u+1)%3;t.start.copy(c[u]),t.end.copy(c[f]),WZ(t,n,s,e),h=s.distanceToSquared(e),h<d&&(d=h,r&&r.copy(s),o&&o.copy(e))}return this.closestPointToPoint(a,s),h=a.distanceToSquared(s),h<d&&(d=h,r&&r.copy(s),o&&o.copy(a)),this.closestPointToPoint(l,s),h=l.distanceToSquared(s),h<d&&(d=h,r&&r.copy(s),o&&o.copy(l)),Math.sqrt(d)}}();Oc.prototype.intersectsTriangle=function(){const s=new Oc,e=new Array(3),t=new Array(3),i=new Lp,n=new Lp,r=new T,o=new T,a=new T,l=new T,c=new T,h=new Fc,d=new Fc,u=new Fc,f=new T;function m(g,A,y){const b=g.points;let x=0,v=-1;for(let _=0;_<3;_++){const{start:C,end:S}=h;C.copy(b[_]),S.copy(b[(_+1)%3]),h.delta(o);const M=mF(A.distanceToPoint(C));if(mF(A.normal.dot(o))&&M){y.copy(h),x=2;break}const L=A.intersectLine(h,f);if(!L&&M&&f.copy(C),(L||M)&&!mF(f.distanceTo(S))){if(x<=1)(x===1?y.start:y.end).copy(f),M&&(v=x);else if(x>=2){(v===1?y.start:y.end).copy(f),x=2;break}if(x++,x===2&&v===-1)break}}return x}return function(A,y=null,b=!1){this.needsUpdate&&this.update(),A.isExtendedTriangle?A.needsUpdate&&A.update():(s.copy(A),s.update(),A=s);const x=this.plane,v=A.plane;if(Math.abs(x.normal.dot(v.normal))>1-1e-10){const _=this.satBounds,C=this.satAxes;t[0]=A.a,t[1]=A.b,t[2]=A.c;for(let L=0;L<4;L++){const w=_[L],E=C[L];if(i.setFromPoints(E,t),w.isSeparated(i))return!1}const S=A.satBounds,M=A.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let L=0;L<4;L++){const w=S[L],E=M[L];if(i.setFromPoints(E,e),w.isSeparated(i))return!1}for(let L=0;L<4;L++){const w=C[L];for(let E=0;E<4;E++){const B=M[E];if(r.crossVectors(w,B),i.setFromPoints(r,e),n.setFromPoints(r,t),i.isSeparated(n))return!1}}return y&&(b||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),y.start.set(0,0,0),y.end.set(0,0,0)),!0}else{const _=m(this,v,d);if(_===1&&A.containsPoint(d.end))return y&&(y.start.copy(d.end),y.end.copy(d.end)),!0;if(_!==2)return!1;const C=m(A,x,u);if(C===1&&this.containsPoint(u.end))return y&&(y.start.copy(u.end),y.end.copy(u.end)),!0;if(C!==2)return!1;if(d.delta(a),u.delta(l),a.dot(l)<0){let P=u.start;u.start=u.end,u.end=P}const S=d.start.dot(a),M=d.end.dot(a),L=u.start.dot(a),w=u.end.dot(a),E=M<L,B=S<w;return S!==w&&L!==M&&E===B?!1:(y&&(c.subVectors(d.start,u.start),c.dot(a)>0?y.start.copy(d.start):y.start.copy(u.start),c.subVectors(d.end,u.end),c.dot(a)<0?y.end.copy(d.end):y.end.copy(u.end)),!0)}}}();Oc.prototype.distanceToPoint=function(){const s=new T;return function(t){return this.closestPointToPoint(t,s),t.distanceTo(s)}}();Oc.prototype.distanceToTriangle=function(){const s=new T,e=new T,t=["a","b","c"],i=new Fc,n=new Fc;return function(o,a=null,l=null){const c=a||l?i:null;if(this.intersectsTriangle(o,c))return(a||l)&&(a&&c.getCenter(a),l&&c.getCenter(l)),0;let h=1/0;for(let d=0;d<3;d++){let u;const f=t[d],m=o[f];this.closestPointToPoint(m,s),u=m.distanceToSquared(s),u<h&&(h=u,a&&a.copy(s),l&&l.copy(m));const g=this[f];o.closestPointToPoint(g,s),u=g.distanceToSquared(s),u<h&&(h=u,a&&a.copy(g),l&&l.copy(s))}for(let d=0;d<3;d++){const u=t[d],f=t[(d+1)%3];i.set(this[u],this[f]);for(let m=0;m<3;m++){const g=t[m],A=t[(m+1)%3];n.set(o[g],o[A]),WZ(i,n,s,e);const y=s.distanceToSquared(e);y<h&&(h=y,a&&a.copy(s),l&&l.copy(e))}}return Math.sqrt(h)}}();class ca{constructor(e,t,i){this.isOrientedBox=!0,this.min=new T,this.max=new T,this.matrix=new ce,this.invMatrix=new ce,this.points=new Array(8).fill().map(()=>new T),this.satAxes=new Array(3).fill().map(()=>new T),this.satBounds=new Array(3).fill().map(()=>new Lp),this.alignedSatBounds=new Array(3).fill().map(()=>new Lp),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}ca.prototype.update=function(){return function(){const e=this.matrix,t=this.min,i=this.max,n=this.points;for(let c=0;c<=1;c++)for(let h=0;h<=1;h++)for(let d=0;d<=1;d++){const u=1*c|2*h|4*d,f=n[u];f.x=c?i.x:t.x,f.y=h?i.y:t.y,f.z=d?i.z:t.z,f.applyMatrix4(e)}const r=this.satBounds,o=this.satAxes,a=n[0];for(let c=0;c<3;c++){const h=o[c],d=r[c],u=1<<c,f=n[u];h.subVectors(a,f),d.setFromPoints(h,n)}const l=this.alignedSatBounds;l[0].setFromPointsField(n,"x"),l[1].setFromPointsField(n,"y"),l[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();ca.prototype.intersectsBox=function(){const s=new Lp;return function(t){this.needsUpdate&&this.update();const i=t.min,n=t.max,r=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(s.min=i.x,s.max=n.x,a[0].isSeparated(s)||(s.min=i.y,s.max=n.y,a[1].isSeparated(s))||(s.min=i.z,s.max=n.z,a[2].isSeparated(s)))return!1;for(let l=0;l<3;l++){const c=o[l],h=r[l];if(s.setFromBox(c,t),h.isSeparated(s))return!1}return!0}}();ca.prototype.intersectsTriangle=function(){const s=new Oc,e=new Array(3),t=new Lp,i=new Lp,n=new T;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(s.copy(o),s.update(),o=s);const a=this.satBounds,l=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let u=0;u<3;u++){const f=a[u],m=l[u];if(t.setFromPoints(m,e),f.isSeparated(t))return!1}const c=o.satBounds,h=o.satAxes,d=this.points;for(let u=0;u<3;u++){const f=c[u],m=h[u];if(t.setFromPoints(m,d),f.isSeparated(t))return!1}for(let u=0;u<3;u++){const f=l[u];for(let m=0;m<4;m++){const g=h[m];if(n.crossVectors(f,g),t.setFromPoints(n,e),i.setFromPoints(n,d),t.isSeparated(i))return!1}}return!0}}();ca.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();ca.prototype.distanceToPoint=function(){const s=new T;return function(t){return this.closestPointToPoint(t,s),t.distanceTo(s)}}();ca.prototype.distanceToBox=function(){const s=["x","y","z"],e=new Array(12).fill().map(()=>new Fc),t=new Array(12).fill().map(()=>new Fc),i=new T,n=new T;return function(o,a=0,l=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(l||c)&&(o.getCenter(n),this.closestPointToPoint(n,i),o.closestPointToPoint(i,n),l&&l.copy(i),c&&c.copy(n)),0;const h=a*a,d=o.min,u=o.max,f=this.points;let m=1/0;for(let A=0;A<8;A++){const y=f[A];n.copy(y).clamp(d,u);const b=y.distanceToSquared(n);if(b<m&&(m=b,l&&l.copy(y),c&&c.copy(n),b<h))return Math.sqrt(b)}let g=0;for(let A=0;A<3;A++)for(let y=0;y<=1;y++)for(let b=0;b<=1;b++){const x=(A+1)%3,v=(A+2)%3,_=y<<x|b<<v,C=1<<A|y<<x|b<<v,S=f[_],M=f[C];e[g].set(S,M);const w=s[A],E=s[x],B=s[v],P=t[g],k=P.start,X=P.end;k[w]=d[w],k[E]=y?d[E]:u[E],k[B]=b?d[B]:u[E],X[w]=u[w],X[E]=y?d[E]:u[E],X[B]=b?d[B]:u[E],g++}for(let A=0;A<=1;A++)for(let y=0;y<=1;y++)for(let b=0;b<=1;b++){n.x=A?u.x:d.x,n.y=y?u.y:d.y,n.z=b?u.z:d.z,this.closestPointToPoint(n,i);const x=n.distanceToSquared(i);if(x<m&&(m=x,l&&l.copy(i),c&&c.copy(n),x<h))return Math.sqrt(x)}for(let A=0;A<12;A++){const y=e[A];for(let b=0;b<12;b++){const x=t[b];WZ(y,x,i,n);const v=i.distanceToSquared(n);if(v<m&&(m=v,l&&l.copy(i),c&&c.copy(n),v<h))return Math.sqrt(v)}}return Math.sqrt(m)}}();class HZ{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class cZe extends HZ{constructor(){super(()=>new Oc)}}const Dc=new cZe;class hZe{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=i=>{t&&e.push(t),t=i,this.float32Array=new Float32Array(i),this.uint16Array=new Uint16Array(i),this.uint32Array=new Uint32Array(i)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const Kn=new hZe;let Uf,Fb;const Oy=[],XE=new HZ(()=>new oi);function dZe(s,e,t,i,n,r){Uf=XE.getPrimitive(),Fb=XE.getPrimitive(),Oy.push(Uf,Fb),Kn.setBuffer(s._roots[e]);const o=hU(0,s.geometry,t,i,n,r);Kn.clearBuffer(),XE.releasePrimitive(Uf),XE.releasePrimitive(Fb),Oy.pop(),Oy.pop();const a=Oy.length;return a>0&&(Fb=Oy[a-1],Uf=Oy[a-2]),o}function hU(s,e,t,i,n=null,r=0,o=0){const{float32Array:a,uint16Array:l,uint32Array:c}=Kn;let h=s*2;if(Sa(h,l)){const u=rl(s,c),f=Zl(h,l);return Pn(s,a,Uf),i(u,f,!1,o,r+s,Uf)}else{let w=function(B){const{uint16Array:P,uint32Array:k}=Kn;let X=B*2;for(;!Sa(X,P);)B=Nc(B),X=B*2;return rl(B,k)},E=function(B){const{uint16Array:P,uint32Array:k}=Kn;let X=B*2;for(;!Sa(X,P);)B=Wl(B,k),X=B*2;return rl(B,k)+Zl(X,P)};const u=Nc(s),f=Wl(s,c);let m=u,g=f,A,y,b,x;if(n&&(b=Uf,x=Fb,Pn(m,a,b),Pn(g,a,x),A=n(b),y=n(x),y<A)){m=f,g=u;const B=A;A=y,y=B,b=x}b||(b=Uf,Pn(m,a,b));const v=Sa(m*2,l),_=t(b,v,A,o+1,r+m);let C;if(_===oU){const B=w(m),k=E(m)-B;C=i(B,k,!0,o+1,r+m,b)}else C=_&&hU(m,e,t,i,n,r,o+1);if(C)return!0;x=Fb,Pn(g,a,x);const S=Sa(g*2,l),M=t(x,S,y,o+1,r+g);let L;if(M===oU){const B=w(g),k=E(g)-B;L=i(B,k,!0,o+1,r+g,x)}else L=M&&hU(g,e,t,i,n,r,o+1);return!!L}}const Z_=new T,gF=new T;function uZe(s,e,t={},i=0,n=1/0){const r=i*i,o=n*n;let a=1/0,l=null;if(s.shapecast({boundsTraverseOrder:h=>(Z_.copy(e).clamp(h.min,h.max),Z_.distanceToSquared(e)),intersectsBounds:(h,d,u)=>u<a&&u<o,intersectsTriangle:(h,d)=>{h.closestPointToPoint(e,Z_);const u=e.distanceToSquared(Z_);return u<a&&(gF.copy(Z_),a=u,l=d),u<r}}),a===1/0)return null;const c=Math.sqrt(a);return t.point?t.point.copy(gF):t.point=gF.clone(),t.distance=c,t.faceIndex=l,t}const pZe=parseInt(La)>=169,Fg=new T,Vg=new T,zg=new T,OE=new Q,ZE=new Q,WE=new Q,YJ=new T,JJ=new T,jJ=new T,W_=new T;function fZe(s,e,t,i,n,r,o,a){let l;if(r===vn?l=s.intersectTriangle(i,t,e,!0,n):l=s.intersectTriangle(e,t,i,r!==Zi,n),l===null)return null;const c=s.origin.distanceTo(n);return c<o||c>a?null:{distance:c,point:n.clone()}}function mZe(s,e,t,i,n,r,o,a,l,c,h){Fg.fromBufferAttribute(e,r),Vg.fromBufferAttribute(e,o),zg.fromBufferAttribute(e,a);const d=fZe(s,Fg,Vg,zg,W_,l,c,h);if(d){const u=new T;$s.getBarycoord(W_,Fg,Vg,zg,u),i&&(OE.fromBufferAttribute(i,r),ZE.fromBufferAttribute(i,o),WE.fromBufferAttribute(i,a),d.uv=$s.getInterpolation(W_,Fg,Vg,zg,OE,ZE,WE,new Q)),n&&(OE.fromBufferAttribute(n,r),ZE.fromBufferAttribute(n,o),WE.fromBufferAttribute(n,a),d.uv1=$s.getInterpolation(W_,Fg,Vg,zg,OE,ZE,WE,new Q)),t&&(YJ.fromBufferAttribute(t,r),JJ.fromBufferAttribute(t,o),jJ.fromBufferAttribute(t,a),d.normal=$s.getInterpolation(W_,Fg,Vg,zg,YJ,JJ,jJ,new T),d.normal.dot(s.direction)>0&&d.normal.multiplyScalar(-1));const f={a:r,b:o,c:a,normal:new T,materialIndex:0};$s.getNormal(Fg,Vg,zg,f.normal),d.face=f,d.faceIndex=r,pZe&&(d.barycoord=u)}return d}function dG(s,e,t,i,n,r,o){const a=i*3;let l=a+0,c=a+1,h=a+2;const d=s.index;s.index&&(l=d.getX(l),c=d.getX(c),h=d.getX(h));const{position:u,normal:f,uv:m,uv1:g}=s.attributes,A=mZe(t,u,f,m,g,l,c,h,e,r,o);return A?(A.faceIndex=i,n&&n.push(A),A):null}function tr(s,e,t,i){const n=s.a,r=s.b,o=s.c;let a=e,l=e+1,c=e+2;t&&(a=t.getX(a),l=t.getX(l),c=t.getX(c)),n.x=i.getX(a),n.y=i.getY(a),n.z=i.getZ(a),r.x=i.getX(l),r.y=i.getY(l),r.z=i.getZ(l),o.x=i.getX(c),o.y=i.getY(c),o.z=i.getZ(c)}const H_=new T,Q_=new T,K_=new T,qJ=new Q,$J=new Q,ej=new Q;function gZe(s,e,t,i){const n=e.getIndex().array,r=e.getAttribute("position"),o=e.getAttribute("uv"),a=n[t*3],l=n[t*3+1],c=n[t*3+2];H_.fromBufferAttribute(r,a),Q_.fromBufferAttribute(r,l),K_.fromBufferAttribute(r,c);let h=0;const d=e.groups,u=t*3;for(let g=0,A=d.length;g<A;g++){const y=d[g],{start:b,count:x}=y;if(u>=b&&u<b+x){h=y.materialIndex;break}}const f=i&&i.barycoord?i.barycoord:new T;$s.getBarycoord(s,H_,Q_,K_,f);let m=null;return o&&(qJ.fromBufferAttribute(o,a),$J.fromBufferAttribute(o,l),ej.fromBufferAttribute(o,c),i&&i.uv?m=i.uv:m=new Q,$s.getInterpolation(s,H_,Q_,K_,qJ,$J,ej,m)),i?(i.face||(i.face={}),i.face.a=a,i.face.b=l,i.face.c=c,i.face.materialIndex=h,i.face.normal||(i.face.normal=new T),$s.getNormal(H_,Q_,K_,i.face.normal),m&&(i.uv=m),i.barycoord=f,i):{face:{a,b:l,c,materialIndex:h,normal:$s.getNormal(H_,Q_,K_,new T)},uv:m,barycoord:f}}function AZe(s,e,t,i,n,r,o,a){const{geometry:l,_indirectBuffer:c}=s;for(let h=i,d=i+n;h<d;h++)dG(l,e,t,h,r,o,a)}function yZe(s,e,t,i,n,r,o){const{geometry:a,_indirectBuffer:l}=s;let c=1/0,h=null;for(let d=i,u=i+n;d<u;d++){let f;f=dG(a,e,t,d,null,r,o),f&&f.distance<c&&(h=f,c=f.distance)}return h}function bZe(s,e,t,i,n,r,o){const{geometry:a}=t,{index:l}=a,c=a.attributes.position;for(let h=s,d=e+s;h<d;h++){let u;if(u=h,tr(o,u*3,l,c),o.needsUpdate=!0,i(o,u,n,r))return!0}return!1}function xZe(s,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=s.geometry,i=t.index?t.index.array:null,n=t.attributes.position;let r,o,a,l,c=0;const h=s._roots;for(let u=0,f=h.length;u<f;u++)r=h[u],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),d(0,c),c+=r.byteLength;function d(u,f,m=!1){const g=u*2;if(a[g+15]===hG){const y=o[u+6],b=a[g+14];let x=1/0,v=1/0,_=1/0,C=-1/0,S=-1/0,M=-1/0;for(let L=3*y,w=3*(y+b);L<w;L++){let E=i[L];const B=n.getX(E),P=n.getY(E),k=n.getZ(E);B<x&&(x=B),B>C&&(C=B),P<v&&(v=P),P>S&&(S=P),k<_&&(_=k),k>M&&(M=k)}return l[u+0]!==x||l[u+1]!==v||l[u+2]!==_||l[u+3]!==C||l[u+4]!==S||l[u+5]!==M?(l[u+0]=x,l[u+1]=v,l[u+2]=_,l[u+3]=C,l[u+4]=S,l[u+5]=M,!0):!1}else{const y=u+8,b=o[u+6],x=y+f,v=b+f;let _=m,C=!1,S=!1;e?_||(C=e.has(x),S=e.has(v),_=!C&&!S):(C=!0,S=!0);const M=_||C,L=_||S;let w=!1;M&&(w=d(y,f,_));let E=!1;L&&(E=d(b,f,_));const B=w||E;if(B)for(let P=0;P<3;P++){const k=y+P,X=b+P,F=l[k],H=l[k+3],W=l[X],se=l[X+3];l[u+P]=F<W?F:W,l[u+P+3]=H>se?H:se}return B}}}function wm(s,e,t,i,n){let r,o,a,l,c,h;const d=1/t.direction.x,u=1/t.direction.y,f=1/t.direction.z,m=t.origin.x,g=t.origin.y,A=t.origin.z;let y=e[s],b=e[s+3],x=e[s+1],v=e[s+3+1],_=e[s+2],C=e[s+3+2];return d>=0?(r=(y-m)*d,o=(b-m)*d):(r=(b-m)*d,o=(y-m)*d),u>=0?(a=(x-g)*u,l=(v-g)*u):(a=(v-g)*u,l=(x-g)*u),r>l||a>o||((a>r||isNaN(r))&&(r=a),(l<o||isNaN(o))&&(o=l),f>=0?(c=(_-A)*f,h=(C-A)*f):(c=(C-A)*f,h=(_-A)*f),r>h||c>o)?!1:((c>r||r!==r)&&(r=c),(h<o||o!==o)&&(o=h),r<=n&&o>=i)}function vZe(s,e,t,i,n,r,o,a){const{geometry:l,_indirectBuffer:c}=s;for(let h=i,d=i+n;h<d;h++){let u=c?c[h]:h;dG(l,e,t,u,r,o,a)}}function _Ze(s,e,t,i,n,r,o){const{geometry:a,_indirectBuffer:l}=s;let c=1/0,h=null;for(let d=i,u=i+n;d<u;d++){let f;f=dG(a,e,t,l?l[d]:d,null,r,o),f&&f.distance<c&&(h=f,c=f.distance)}return h}function CZe(s,e,t,i,n,r,o){const{geometry:a}=t,{index:l}=a,c=a.attributes.position;for(let h=s,d=e+s;h<d;h++){let u;if(u=t.resolveTriangleIndex(h),tr(o,u*3,l,c),o.needsUpdate=!0,i(o,u,n,r))return!0}return!1}function wZe(s,e,t,i,n,r,o){Kn.setBuffer(s._roots[e]),dU(0,s,t,i,n,r,o),Kn.clearBuffer()}function dU(s,e,t,i,n,r,o){const{float32Array:a,uint16Array:l,uint32Array:c}=Kn,h=s*2;if(Sa(h,l)){const u=rl(s,c),f=Zl(h,l);AZe(e,t,i,u,f,n,r,o)}else{const u=Nc(s);wm(u,a,i,r,o)&&dU(u,e,t,i,n,r,o);const f=Wl(s,c);wm(f,a,i,r,o)&&dU(f,e,t,i,n,r,o)}}const SZe=["x","y","z"];function MZe(s,e,t,i,n,r){Kn.setBuffer(s._roots[e]);const o=uU(0,s,t,i,n,r);return Kn.clearBuffer(),o}function uU(s,e,t,i,n,r){const{float32Array:o,uint16Array:a,uint32Array:l}=Kn;let c=s*2;if(Sa(c,a)){const d=rl(s,l),u=Zl(c,a);return yZe(e,t,i,d,u,n,r)}else{const d=ZZ(s,l),u=SZe[d],m=i.direction[u]>=0;let g,A;m?(g=Nc(s),A=Wl(s,l)):(g=Wl(s,l),A=Nc(s));const b=wm(g,o,i,n,r)?uU(g,e,t,i,n,r):null;if(b){const _=b.point[u];if(m?_<=o[A+d]:_>=o[A+d+3])return b}const v=wm(A,o,i,n,r)?uU(A,e,t,i,n,r):null;return b&&v?b.distance<=v.distance?b:v:b||v||null}}const HE=new oi,Zy=new Oc,Wy=new Oc,Y_=new ce,tj=new ca,QE=new ca;function IZe(s,e,t,i){Kn.setBuffer(s._roots[e]);const n=pU(0,s,t,i);return Kn.clearBuffer(),n}function pU(s,e,t,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=Kn;let l=s*2;if(n===null&&(t.boundingBox||t.computeBoundingBox(),tj.set(t.boundingBox.min,t.boundingBox.max,i),n=tj),Sa(l,o)){const h=e.geometry,d=h.index,u=h.attributes.position,f=t.index,m=t.attributes.position,g=rl(s,a),A=Zl(l,o);if(Y_.copy(i).invert(),t.boundsTree)return Pn(s,r,QE),QE.matrix.copy(Y_),QE.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:b=>QE.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(i),b.b.applyMatrix4(i),b.c.applyMatrix4(i),b.needsUpdate=!0;for(let x=g*3,v=(A+g)*3;x<v;x+=3)if(tr(Wy,x,d,u),Wy.needsUpdate=!0,b.intersectsTriangle(Wy))return!0;return!1}});for(let y=g*3,b=(A+g)*3;y<b;y+=3){tr(Zy,y,d,u),Zy.a.applyMatrix4(Y_),Zy.b.applyMatrix4(Y_),Zy.c.applyMatrix4(Y_),Zy.needsUpdate=!0;for(let x=0,v=f.count;x<v;x+=3)if(tr(Wy,x,f,m),Wy.needsUpdate=!0,Zy.intersectsTriangle(Wy))return!0}}else{const h=s+8,d=a[s+6];return Pn(h,r,HE),!!(n.intersectsBox(HE)&&pU(h,e,t,i,n)||(Pn(d,r,HE),n.intersectsBox(HE)&&pU(d,e,t,i,n)))}}const KE=new ce,AF=new ca,J_=new ca,TZe=new T,EZe=new T,RZe=new T,LZe=new T;function BZe(s,e,t,i={},n={},r=0,o=1/0){e.boundingBox||e.computeBoundingBox(),AF.set(e.boundingBox.min,e.boundingBox.max,t),AF.needsUpdate=!0;const a=s.geometry,l=a.attributes.position,c=a.index,h=e.attributes.position,d=e.index,u=Dc.getPrimitive(),f=Dc.getPrimitive();let m=TZe,g=EZe,A=null,y=null;n&&(A=RZe,y=LZe);let b=1/0,x=null,v=null;return KE.copy(t).invert(),J_.matrix.copy(KE),s.shapecast({boundsTraverseOrder:_=>AF.distanceToBox(_),intersectsBounds:(_,C,S)=>S<b&&S<o?(C&&(J_.min.copy(_.min),J_.max.copy(_.max),J_.needsUpdate=!0),!0):!1,intersectsRange:(_,C)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:M=>J_.distanceToBox(M),intersectsBounds:(M,L,w)=>w<b&&w<o,intersectsRange:(M,L)=>{for(let w=M,E=M+L;w<E;w++){tr(f,3*w,d,h),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let B=_,P=_+C;B<P;B++){tr(u,3*B,c,l),u.needsUpdate=!0;const k=u.distanceToTriangle(f,m,A);if(k<b&&(g.copy(m),y&&y.copy(A),b=k,x=B,v=w),k<r)return!0}}}});{const S=Gv(e);for(let M=0,L=S;M<L;M++){tr(f,3*M,d,h),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let w=_,E=_+C;w<E;w++){tr(u,3*w,c,l),u.needsUpdate=!0;const B=u.distanceToTriangle(f,m,A);if(B<b&&(g.copy(m),y&&y.copy(A),b=B,x=w,v=M),B<r)return!0}}}}}),Dc.releasePrimitive(u),Dc.releasePrimitive(f),b===1/0?null:(i.point?i.point.copy(g):i.point=g.clone(),i.distance=b,i.faceIndex=x,n&&(n.point?n.point.copy(y):n.point=y.clone(),n.point.applyMatrix4(KE),g.applyMatrix4(KE),n.distance=g.sub(n.point).length(),n.faceIndex=v),i)}function PZe(s,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=s.geometry,i=t.index?t.index.array:null,n=t.attributes.position;let r,o,a,l,c=0;const h=s._roots;for(let u=0,f=h.length;u<f;u++)r=h[u],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),d(0,c),c+=r.byteLength;function d(u,f,m=!1){const g=u*2;if(a[g+15]===hG){const y=o[u+6],b=a[g+14];let x=1/0,v=1/0,_=1/0,C=-1/0,S=-1/0,M=-1/0;for(let L=y,w=y+b;L<w;L++){const E=3*s.resolveTriangleIndex(L);for(let B=0;B<3;B++){let P=E+B;P=i?i[P]:P;const k=n.getX(P),X=n.getY(P),F=n.getZ(P);k<x&&(x=k),k>C&&(C=k),X<v&&(v=X),X>S&&(S=X),F<_&&(_=F),F>M&&(M=F)}}return l[u+0]!==x||l[u+1]!==v||l[u+2]!==_||l[u+3]!==C||l[u+4]!==S||l[u+5]!==M?(l[u+0]=x,l[u+1]=v,l[u+2]=_,l[u+3]=C,l[u+4]=S,l[u+5]=M,!0):!1}else{const y=u+8,b=o[u+6],x=y+f,v=b+f;let _=m,C=!1,S=!1;e?_||(C=e.has(x),S=e.has(v),_=!C&&!S):(C=!0,S=!0);const M=_||C,L=_||S;let w=!1;M&&(w=d(y,f,_));let E=!1;L&&(E=d(b,f,_));const B=w||E;if(B)for(let P=0;P<3;P++){const k=y+P,X=b+P,F=l[k],H=l[k+3],W=l[X],se=l[X+3];l[u+P]=F<W?F:W,l[u+P+3]=H>se?H:se}return B}}}function GZe(s,e,t,i,n,r,o){Kn.setBuffer(s._roots[e]),fU(0,s,t,i,n,r,o),Kn.clearBuffer()}function fU(s,e,t,i,n,r,o){const{float32Array:a,uint16Array:l,uint32Array:c}=Kn,h=s*2;if(Sa(h,l)){const u=rl(s,c),f=Zl(h,l);vZe(e,t,i,u,f,n,r,o)}else{const u=Nc(s);wm(u,a,i,r,o)&&fU(u,e,t,i,n,r,o);const f=Wl(s,c);wm(f,a,i,r,o)&&fU(f,e,t,i,n,r,o)}}const kZe=["x","y","z"];function NZe(s,e,t,i,n,r){Kn.setBuffer(s._roots[e]);const o=mU(0,s,t,i,n,r);return Kn.clearBuffer(),o}function mU(s,e,t,i,n,r){const{float32Array:o,uint16Array:a,uint32Array:l}=Kn;let c=s*2;if(Sa(c,a)){const d=rl(s,l),u=Zl(c,a);return _Ze(e,t,i,d,u,n,r)}else{const d=ZZ(s,l),u=kZe[d],m=i.direction[u]>=0;let g,A;m?(g=Nc(s),A=Wl(s,l)):(g=Wl(s,l),A=Nc(s));const b=wm(g,o,i,n,r)?mU(g,e,t,i,n,r):null;if(b){const _=b.point[u];if(m?_<=o[A+d]:_>=o[A+d+3])return b}const v=wm(A,o,i,n,r)?mU(A,e,t,i,n,r):null;return b&&v?b.distance<=v.distance?b:v:b||v||null}}const YE=new oi,Hy=new Oc,Qy=new Oc,j_=new ce,ij=new ca,JE=new ca;function DZe(s,e,t,i){Kn.setBuffer(s._roots[e]);const n=gU(0,s,t,i);return Kn.clearBuffer(),n}function gU(s,e,t,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=Kn;let l=s*2;if(n===null&&(t.boundingBox||t.computeBoundingBox(),ij.set(t.boundingBox.min,t.boundingBox.max,i),n=ij),Sa(l,o)){const h=e.geometry,d=h.index,u=h.attributes.position,f=t.index,m=t.attributes.position,g=rl(s,a),A=Zl(l,o);if(j_.copy(i).invert(),t.boundsTree)return Pn(s,r,JE),JE.matrix.copy(j_),JE.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:b=>JE.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(i),b.b.applyMatrix4(i),b.c.applyMatrix4(i),b.needsUpdate=!0;for(let x=g,v=A+g;x<v;x++)if(tr(Qy,3*e.resolveTriangleIndex(x),d,u),Qy.needsUpdate=!0,b.intersectsTriangle(Qy))return!0;return!1}});for(let y=g,b=A+g;y<b;y++){const x=e.resolveTriangleIndex(y);tr(Hy,3*x,d,u),Hy.a.applyMatrix4(j_),Hy.b.applyMatrix4(j_),Hy.c.applyMatrix4(j_),Hy.needsUpdate=!0;for(let v=0,_=f.count;v<_;v+=3)if(tr(Qy,v,f,m),Qy.needsUpdate=!0,Hy.intersectsTriangle(Qy))return!0}}else{const h=s+8,d=a[s+6];return Pn(h,r,YE),!!(n.intersectsBox(YE)&&gU(h,e,t,i,n)||(Pn(d,r,YE),n.intersectsBox(YE)&&gU(d,e,t,i,n)))}}const jE=new ce,yF=new ca,q_=new ca,FZe=new T,VZe=new T,zZe=new T,UZe=new T;function XZe(s,e,t,i={},n={},r=0,o=1/0){e.boundingBox||e.computeBoundingBox(),yF.set(e.boundingBox.min,e.boundingBox.max,t),yF.needsUpdate=!0;const a=s.geometry,l=a.attributes.position,c=a.index,h=e.attributes.position,d=e.index,u=Dc.getPrimitive(),f=Dc.getPrimitive();let m=FZe,g=VZe,A=null,y=null;n&&(A=zZe,y=UZe);let b=1/0,x=null,v=null;return jE.copy(t).invert(),q_.matrix.copy(jE),s.shapecast({boundsTraverseOrder:_=>yF.distanceToBox(_),intersectsBounds:(_,C,S)=>S<b&&S<o?(C&&(q_.min.copy(_.min),q_.max.copy(_.max),q_.needsUpdate=!0),!0):!1,intersectsRange:(_,C)=>{if(e.boundsTree){const S=e.boundsTree;return S.shapecast({boundsTraverseOrder:M=>q_.distanceToBox(M),intersectsBounds:(M,L,w)=>w<b&&w<o,intersectsRange:(M,L)=>{for(let w=M,E=M+L;w<E;w++){const B=S.resolveTriangleIndex(w);tr(f,3*B,d,h),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let P=_,k=_+C;P<k;P++){const X=s.resolveTriangleIndex(P);tr(u,3*X,c,l),u.needsUpdate=!0;const F=u.distanceToTriangle(f,m,A);if(F<b&&(g.copy(m),y&&y.copy(A),b=F,x=P,v=w),F<r)return!0}}}})}else{const S=Gv(e);for(let M=0,L=S;M<L;M++){tr(f,3*M,d,h),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let w=_,E=_+C;w<E;w++){const B=s.resolveTriangleIndex(w);tr(u,3*B,c,l),u.needsUpdate=!0;const P=u.distanceToTriangle(f,m,A);if(P<b&&(g.copy(m),y&&y.copy(A),b=P,x=w,v=M),P<r)return!0}}}}}),Dc.releasePrimitive(u),Dc.releasePrimitive(f),b===1/0?null:(i.point?i.point.copy(g):i.point=g.clone(),i.distance=b,i.faceIndex=x,n&&(n.point?n.point.copy(y):n.point=y.clone(),n.point.applyMatrix4(jE),g.applyMatrix4(jE),n.distance=g.sub(n.point).length(),n.faceIndex=v),i)}function jle(){return typeof SharedArrayBuffer<"u"}const yw=new Kn.constructor,N2=new Kn.constructor,Rf=new HZ(()=>new oi),Ky=new oi,Yy=new oi,bF=new oi,xF=new oi;let vF=!1;function OZe(s,e,t,i){if(vF)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");vF=!0;const n=s._roots,r=e._roots;let o,a=0,l=0;const c=new ce().copy(t).invert();for(let h=0,d=n.length;h<d;h++){yw.setBuffer(n[h]),l=0;const u=Rf.getPrimitive();Pn(0,yw.float32Array,u),u.applyMatrix4(c);for(let f=0,m=r.length;f<m&&(N2.setBuffer(r[f]),o=ph(0,0,t,c,i,a,l,0,0,u),N2.clearBuffer(),l+=r[f].length,!o);f++);if(Rf.releasePrimitive(u),yw.clearBuffer(),a+=n[h].length,o)break}return vF=!1,o}function ph(s,e,t,i,n,r=0,o=0,a=0,l=0,c=null,h=!1){let d,u;h?(d=N2,u=yw):(d=yw,u=N2);const f=d.float32Array,m=d.uint32Array,g=d.uint16Array,A=u.float32Array,y=u.uint32Array,b=u.uint16Array,x=s*2,v=e*2,_=Sa(x,g),C=Sa(v,b);let S=!1;if(C&&_)h?S=n(rl(e,y),Zl(e*2,b),rl(s,m),Zl(s*2,g),l,o+e,a,r+s):S=n(rl(s,m),Zl(s*2,g),rl(e,y),Zl(e*2,b),a,r+s,l,o+e);else if(C){const M=Rf.getPrimitive();Pn(e,A,M),M.applyMatrix4(t);const L=Nc(s),w=Wl(s,m);Pn(L,f,Ky),Pn(w,f,Yy);const E=M.intersectsBox(Ky),B=M.intersectsBox(Yy);S=E&&ph(e,L,i,t,n,o,r,l,a+1,M,!h)||B&&ph(e,w,i,t,n,o,r,l,a+1,M,!h),Rf.releasePrimitive(M)}else{const M=Nc(e),L=Wl(e,y);Pn(M,A,bF),Pn(L,A,xF);const w=c.intersectsBox(bF),E=c.intersectsBox(xF);if(w&&E)S=ph(s,M,t,i,n,r,o,a,l+1,c,h)||ph(s,L,t,i,n,r,o,a,l+1,c,h);else if(w)if(_)S=ph(s,M,t,i,n,r,o,a,l+1,c,h);else{const B=Rf.getPrimitive();B.copy(bF).applyMatrix4(t);const P=Nc(s),k=Wl(s,m);Pn(P,f,Ky),Pn(k,f,Yy);const X=B.intersectsBox(Ky),F=B.intersectsBox(Yy);S=X&&ph(M,P,i,t,n,o,r,l,a+1,B,!h)||F&&ph(M,k,i,t,n,o,r,l,a+1,B,!h),Rf.releasePrimitive(B)}else if(E)if(_)S=ph(s,L,t,i,n,r,o,a,l+1,c,h);else{const B=Rf.getPrimitive();B.copy(xF).applyMatrix4(t);const P=Nc(s),k=Wl(s,m);Pn(P,f,Ky),Pn(k,f,Yy);const X=B.intersectsBox(Ky),F=B.intersectsBox(Yy);S=X&&ph(L,P,i,t,n,o,r,l,a+1,B,!h)||F&&ph(L,k,i,t,n,o,r,l,a+1,B,!h),Rf.releasePrimitive(B)}}return S}const qE=new ca,nj=new oi,ZZe={strategy:OZ,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class Sm{static serialize(e,t={}){t={cloneBuffers:!0,...t};const i=e.geometry,n=e._roots,r=e._indirectBuffer,o=i.getIndex();let a;return t.cloneBuffers?a={roots:n.map(l=>l.slice()),index:o?o.array.slice():null,indirectBuffer:r?r.slice():null}:a={roots:n,index:o?o.array:null,indirectBuffer:r},a}static deserialize(e,t,i={}){i={setIndex:!0,indirect:!!e.indirectBuffer,...i};const{index:n,roots:r,indirectBuffer:o}=e,a=new Sm(t,{...i,[uF]:!0});if(a._roots=r,a._indirectBuffer=o||null,i.setIndex){const l=t.getIndex();if(l===null){const c=new dt(e.index,1,!1);t.setIndex(c)}else l.array!==n&&(l.array.set(n),l.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({...ZZe,[uF]:!1},t),t.useSharedArrayBuffer&&!jle())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[uF]||(rZe(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new oi))),this.resolveTriangleIndex=t.indirect?i=>this._indirectBuffer[i]:i=>i}refit(e=null){return(this.indirect?PZe:xZe)(this,e)}traverse(e,t=0){const i=this._roots[t],n=new Uint32Array(i),r=new Uint16Array(i);o(0);function o(a,l=0){const c=a*2,h=r[c+15]===hG;if(h){const d=n[a+6],u=r[c+14];e(l,h,new Float32Array(i,a*4,6),d,u)}else{const d=a+nm/4,u=n[a+6],f=n[a+7];e(l,h,new Float32Array(i,a*4,6),f)||(o(d,l+1),o(u,l+1))}}}raycast(e,t=us,i=0,n=1/0){const r=this._roots,o=this.geometry,a=[],l=t.isMaterial,c=Array.isArray(t),h=o.groups,d=l?t.side:t,u=this.indirect?GZe:wZe;for(let f=0,m=r.length;f<m;f++){const g=c?t[h[f].materialIndex].side:d,A=a.length;if(u(this,f,g,e,a,i,n),c){const y=h[f].materialIndex;for(let b=A,x=a.length;b<x;b++)a[b].face.materialIndex=y}}return a}raycastFirst(e,t=us,i=0,n=1/0){const r=this._roots,o=this.geometry,a=t.isMaterial,l=Array.isArray(t);let c=null;const h=o.groups,d=a?t.side:t,u=this.indirect?NZe:MZe;for(let f=0,m=r.length;f<m;f++){const g=l?t[h[f].materialIndex].side:d,A=u(this,f,g,e,i,n);A!=null&&(c==null||A.distance<c.distance)&&(c=A,l&&(A.face.materialIndex=h[f].materialIndex))}return c}intersectsGeometry(e,t){let i=!1;const n=this._roots,r=this.indirect?DZe:IZe;for(let o=0,a=n.length;o<a&&(i=r(this,o,e,t),!i);o++);return i}shapecast(e){const t=Dc.getPrimitive(),i=this.indirect?CZe:bZe;let{boundsTraverseOrder:n,intersectsBounds:r,intersectsRange:o,intersectsTriangle:a}=e;if(o&&a){const d=o;o=(u,f,m,g,A)=>d(u,f,m,g,A)?!0:i(u,f,this,a,m,g,t)}else o||(a?o=(d,u,f,m)=>i(d,u,this,a,f,m,t):o=(d,u,f)=>f);let l=!1,c=0;const h=this._roots;for(let d=0,u=h.length;d<u;d++){const f=h[d];if(l=dZe(this,d,r,o,n,c),l)break;c+=f.byteLength}return Dc.releasePrimitive(t),l}bvhcast(e,t,i){let{intersectsRanges:n,intersectsTriangles:r}=i;const o=Dc.getPrimitive(),a=this.geometry.index,l=this.geometry.attributes.position,c=this.indirect?m=>{const g=this.resolveTriangleIndex(m);tr(o,g*3,a,l)}:m=>{tr(o,m*3,a,l)},h=Dc.getPrimitive(),d=e.geometry.index,u=e.geometry.attributes.position,f=e.indirect?m=>{const g=e.resolveTriangleIndex(m);tr(h,g*3,d,u)}:m=>{tr(h,m*3,d,u)};if(r){const m=(g,A,y,b,x,v,_,C)=>{for(let S=y,M=y+b;S<M;S++){f(S),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let L=g,w=g+A;L<w;L++)if(c(L),o.needsUpdate=!0,r(o,h,L,S,x,v,_,C))return!0}return!1};if(n){const g=n;n=function(A,y,b,x,v,_,C,S){return g(A,y,b,x,v,_,C,S)?!0:m(A,y,b,x,v,_,C,S)}}else n=m}return OZe(this,e,t,n)}intersectsBox(e,t){return qE.set(e.min,e.max,t),qE.needsUpdate=!0,this.shapecast({intersectsBounds:i=>qE.intersectsBox(i),intersectsTriangle:i=>qE.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},n={},r=0,o=1/0){return(this.indirect?XZe:BZe)(this,e,t,i,n,r,o)}closestPointToPoint(e,t={},i=0,n=1/0){return uZe(this,e,t,i,n)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(i=>{Pn(0,new Float32Array(i),nj),e.union(nj)}),e}}const sj=new oi,rj=new ce;class WZe extends ye{get isMesh(){return!this.displayEdges}get isLineSegments(){return this.displayEdges}get isLine(){return this.displayEdges}getVertexPosition(...e){return fe.prototype.getVertexPosition.call(this,...e)}constructor(e,t,i=10,n=0){super(),this.material=t,this.geometry=new It,this.name="MeshBVHRootHelper",this.depth=i,this.displayParents=!1,this.bvh=e,this.displayEdges=!0,this._group=n}raycast(){}update(){const e=this.geometry,t=this.bvh,i=this._group;if(e.dispose(),this.visible=!1,t){const n=this.depth-1,r=this.displayParents;let o=0;t.traverse((u,f)=>{if(u>=n||f)return o++,!0;r&&o++},i);let a=0;const l=new Float32Array(8*3*o);t.traverse((u,f,m)=>{const g=u>=n||f;if(g||r){Pn(0,m,sj);const{min:A,max:y}=sj;for(let b=-1;b<=1;b+=2){const x=b<0?A.x:y.x;for(let v=-1;v<=1;v+=2){const _=v<0?A.y:y.y;for(let C=-1;C<=1;C+=2){const S=C<0?A.z:y.z;l[a+0]=x,l[a+1]=_,l[a+2]=S,a+=3}}}return g}},i);let c,h;this.displayEdges?h=new Uint8Array([0,4,1,5,2,6,3,7,0,2,1,3,4,6,5,7,0,1,2,3,4,5,6,7]):h=new Uint8Array([0,1,2,2,1,3,4,6,5,6,7,5,1,4,5,0,4,1,2,3,6,3,7,6,0,2,4,2,6,4,1,5,3,3,5,7]),l.length>65535?c=new Uint32Array(h.length*o):c=new Uint16Array(h.length*o);const d=h.length;for(let u=0;u<o;u++){const f=u*8,m=u*d;for(let g=0;g<d;g++)c[m+g]=f+h[g]}e.setIndex(new dt(c,1,!1)),e.setAttribute("position",new dt(l,3,!1)),this.visible=!0}}}class QZ extends Ms{get color(){return this.edgeMaterial.color}get opacity(){return this.edgeMaterial.opacity}set opacity(e){this.edgeMaterial.opacity=e,this.meshMaterial.opacity=e}constructor(e=null,t=null,i=10){e instanceof Sm&&(i=t||10,t=e,e=null),typeof t=="number"&&(i=t,t=null),super(),this.name="MeshBVHHelper",this.depth=i,this.mesh=e,this.bvh=t,this.displayParents=!1,this.displayEdges=!0,this.objectIndex=0,this._roots=[];const n=new _n({color:65416,transparent:!0,opacity:.3,depthWrite:!1}),r=new ii({color:65416,transparent:!0,opacity:.3,depthWrite:!1});r.color=n.color,this.edgeMaterial=n,this.meshMaterial=r,this.update()}update(){const e=this.mesh;let t=this.bvh||e.geometry.boundsTree||null;if(e.isBatchedMesh&&e.boundsTrees&&!t){const n=e._drawInfo[this.objectIndex];n&&(t=e.boundsTrees[n.geometryIndex]||t)}const i=t?t._roots.length:0;for(;this._roots.length>i;){const n=this._roots.pop();n.geometry.dispose(),this.remove(n)}for(let n=0;n<i;n++){const{depth:r,edgeMaterial:o,meshMaterial:a,displayParents:l,displayEdges:c}=this;if(n>=this._roots.length){const d=new WZe(t,o,r,n);this.add(d),this._roots.push(d)}const h=this._roots[n];h.bvh=t,h.depth=r,h.displayParents=l,h.displayEdges=c,h.material=c?o:a,h.update()}}updateMatrixWorld(...e){const t=this.mesh,i=this.parent;t!==null&&(t.updateWorldMatrix(!0,!1),i?this.matrix.copy(i.matrixWorld).invert().multiply(t.matrixWorld):this.matrix.copy(t.matrixWorld),(t.isInstancedMesh||t.isBatchedMesh)&&(t.getMatrixAt(this.objectIndex,rj),this.matrix.multiply(rj)),this.matrix.decompose(this.position,this.quaternion,this.scale)),super.updateMatrixWorld(...e)}copy(e){this.depth=e.depth,this.mesh=e.mesh,this.bvh=e.bvh,this.opacity=e.opacity,this.color.copy(e.color)}clone(){return new QZ(this.mesh,this.bvh,this.depth)}dispose(){this.edgeMaterial.dispose(),this.meshMaterial.dispose();const e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].geometry.dispose()}}const $_=new oi,oj=new oi,Jy=new T;function aj(s){switch(typeof s){case"number":return 8;case"string":return s.length*2;case"boolean":return 4;default:return 0}}function HZe(s){return/(Uint|Int|Float)(8|16|32)Array/.test(s.constructor.name)}function QZe(s,e){const t={nodeCount:0,leafNodeCount:0,depth:{min:1/0,max:-1/0},tris:{min:1/0,max:-1/0},splits:[0,0,0],surfaceAreaScore:0};return s.traverse((i,n,r,o,a)=>{const l=r[3]-r[0],c=r[1+3]-r[1],h=r[2+3]-r[2],d=2*(l*c+c*h+h*l);t.nodeCount++,n?(t.leafNodeCount++,t.depth.min=Math.min(i,t.depth.min),t.depth.max=Math.max(i,t.depth.max),t.tris.min=Math.min(a,t.tris.min),t.tris.max=Math.max(a,t.tris.max),t.surfaceAreaScore+=d*jR*a):(t.splits[o]++,t.surfaceAreaScore+=d*aU)},e),t.tris.min===1/0&&(t.tris.min=0,t.tris.max=0),t.depth.min===1/0&&(t.depth.min=0,t.depth.max=0),t}function KZe(s){return s._roots.map((e,t)=>QZe(s,t))}function YZe(s){const e=new Set,t=[s];let i=0;for(;t.length;){const n=t.pop();if(!e.has(n)){e.add(n);for(let r in n){if(!Object.hasOwn(n,r))continue;i+=aj(r);const o=n[r];o&&(typeof o=="object"||typeof o=="function")?HZe(o)||jle()&&o instanceof SharedArrayBuffer||o instanceof ArrayBuffer?i+=o.byteLength:t.push(o):i+=aj(o)}}}return i}function JZe(s){const e=s.geometry,t=[],i=e.index,n=e.getAttribute("position");let r=!0;return s.traverse((o,a,l,c,h)=>{const d={depth:o,isLeaf:a,boundingData:l,offset:c,count:h};t[o]=d,Pn(0,l,$_);const u=t[o-1];if(a)for(let f=c,m=c+h;f<m;f++){const g=s.resolveTriangleIndex(f);let A=3*g,y=3*g+1,b=3*g+2;i&&(A=i.getX(A),y=i.getX(y),b=i.getX(b));let x;Jy.fromBufferAttribute(n,A),x=$_.containsPoint(Jy),Jy.fromBufferAttribute(n,y),x=x&&$_.containsPoint(Jy),Jy.fromBufferAttribute(n,b),x=x&&$_.containsPoint(Jy),console.assert(x,"Leaf bounds does not fully contain triangle."),r=r&&x}if(u){Pn(0,l,oj);const f=oj.containsBox($_);console.assert(f,"Parent bounds does not fully contain child."),r=r&&f}}),r}function jZe(s){const e=[];return s.traverse((t,i,n,r,o)=>{const a={bounds:Pn(0,n,new oi)};i?(a.count=o,a.offset=r):(a.left=null,a.right=null),e[t]=a;const l=e[t-1];l&&(l.left===null?l.left=a:l.right=a)}),e[0]}function lj(s,e,t){return s===null?null:(s.point.applyMatrix4(e.matrixWorld),s.distance=s.point.distanceTo(t.ray.origin),s.object=e,s)}const qZe=parseInt(La)>=166,$E=new Fa,cj=new T,hj=new ce,$Ze=fe.prototype.raycast,eWe=Vw.prototype.raycast,dj=new T,ao=new fe,eR=[];function tWe(s,e){this.isBatchedMesh?iWe.call(this,s,e):nWe.call(this,s,e)}function iWe(s,e){if(this.boundsTrees){const t=this.boundsTrees,i=this._drawInfo||this._instanceInfo,n=this._drawRanges||this._geometryInfo,r=this.matrixWorld;ao.material=this.material,ao.geometry=this.geometry;const o=ao.geometry.boundsTree,a=ao.geometry.drawRange;ao.geometry.boundingSphere===null&&(ao.geometry.boundingSphere=new Vn);for(let l=0,c=i.length;l<c;l++){if(!this.getVisibleAt(l))continue;const h=i[l].geometryIndex;if(ao.geometry.boundsTree=t[h],this.getMatrixAt(l,ao.matrixWorld).premultiply(r),!ao.geometry.boundsTree){this.getBoundingBoxAt(h,ao.geometry.boundingBox),this.getBoundingSphereAt(h,ao.geometry.boundingSphere);const d=n[h];ao.geometry.setDrawRange(d.start,d.count)}ao.raycast(s,eR);for(let d=0,u=eR.length;d<u;d++){const f=eR[d];f.object=this,f.batchId=l,e.push(f)}eR.length=0}ao.geometry.boundsTree=o,ao.geometry.drawRange=a,ao.material=null,ao.geometry=null}else eWe.call(this,s,e)}function nWe(s,e){if(this.geometry.boundsTree){if(this.material===void 0)return;hj.copy(this.matrixWorld).invert(),$E.copy(s.ray).applyMatrix4(hj),dj.setFromMatrixScale(this.matrixWorld),cj.copy($E.direction).multiply(dj);const t=cj.length(),i=s.near/t,n=s.far/t,r=this.geometry.boundsTree;if(s.firstHitOnly===!0){const o=lj(r.raycastFirst($E,this.material,i,n),this,s);o&&e.push(o)}else{const o=r.raycast($E,this.material,i,n);for(let a=0,l=o.length;a<l;a++){const c=lj(o[a],this,s);c&&e.push(c)}}}else $Ze.call(this,s,e)}function sWe(s={}){return this.boundsTree=new Sm(this,s),this.boundsTree}function rWe(){this.boundsTree=null}function oWe(s=-1,e={}){if(!qZe)throw new Error("BatchedMesh: Three r166+ is required to compute bounds trees.");e.indirect&&console.warn('"Indirect" is set to false because it is not supported for BatchedMesh.'),e={...e,indirect:!1,range:null};const t=this._drawRanges||this._geometryInfo,i=this._geometryCount;this.boundsTrees||(this.boundsTrees=new Array(i).fill(null));const n=this.boundsTrees;for(;n.length<i;)n.push(null);if(s<0){for(let r=0;r<i;r++)e.range=t[r],n[r]=new Sm(this.geometry,e);return n}else return s<t.length&&(e.range=t[s],n[s]=new Sm(this.geometry,e)),n[s]||null}function aWe(s=-1){s<0?this.boundsTrees.fill(null):s<this.boundsTree.length&&(this.boundsTrees[s]=null)}function lWe(s){switch(s){case 1:return"R";case 2:return"RG";case 3:return"RGBA";case 4:return"RGBA"}throw new Error}function cWe(s){switch(s){case 1:return Vl;case 2:return Pc;case 3:return bi;case 4:return bi}}function uj(s){switch(s){case 1:return Ux;case 2:return Xx;case 3:return Z0;case 4:return Z0}}class uG extends ir{constructor(){super(),this.minFilter=qt,this.magFilter=qt,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){const t=this.overrideItemSize,i=e.itemSize,n=e.count;if(t!==null){if(i*n%t!==0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=t,e.count=n*i/t}const r=e.itemSize,o=e.count,a=e.normalized,l=e.array.constructor,c=l.BYTES_PER_ELEMENT;let h=this._forcedType,d=r;if(h===null)switch(l){case Float32Array:h=$i;break;case Uint8Array:case Uint16Array:case Uint32Array:h=Wr;break;case Int8Array:case Int16Array:case Int32Array:h=Dd;break}let u,f,m,g,A=lWe(r);switch(h){case $i:m=1,f=cWe(r),a&&c===1?(g=l,A+="8",l===Uint8Array?u=Pi:(u=Iw,A+="_SNORM")):(g=Float32Array,A+="32F",u=$i);break;case Dd:A+=c*8+"I",m=a?Math.pow(2,l.BYTES_PER_ELEMENT*8-1):1,f=uj(r),c===1?(g=Int8Array,u=Iw):c===2?(g=Int16Array,u=Q2):(g=Int32Array,u=Dd);break;case Wr:A+=c*8+"UI",m=a?Math.pow(2,l.BYTES_PER_ELEMENT*8-1):1,f=uj(r),c===1?(g=Uint8Array,u=Pi):c===2?(g=Uint16Array,u=O0):(g=Uint32Array,u=Wr);break}d===3&&(f===bi||f===Z0)&&(d=4);const y=Math.ceil(Math.sqrt(o))||1,b=d*y*y,x=new g(b),v=e.normalized;e.normalized=!1;for(let _=0;_<o;_++){const C=d*_;x[C]=e.getX(_)/m,r>=2&&(x[C+1]=e.getY(_)/m),r>=3&&(x[C+2]=e.getZ(_)/m,d===4&&(x[C+3]=1)),r>=4&&(x[C+3]=e.getW(_)/m)}e.normalized=v,this.internalFormat=A,this.format=f,this.type=u,this.image.width=y,this.image.height=y,this.image.data=x,this.needsUpdate=!0,this.dispose(),e.itemSize=i,e.count=n}}class qle extends uG{constructor(){super(),this._forcedType=Wr}}class hWe extends uG{constructor(){super(),this._forcedType=Dd}}class $le extends uG{constructor(){super(),this._forcedType=$i}}class dWe{constructor(){this.index=new qle,this.position=new $le,this.bvhBounds=new ir,this.bvhContents=new ir,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(e){const{geometry:t}=e;if(pWe(e,this.bvhBounds,this.bvhContents),this.position.updateFrom(t.attributes.position),e.indirect){const i=e._indirectBuffer;if(this._cachedIndexAttr===null||this._cachedIndexAttr.count!==i.length)if(t.index)this._cachedIndexAttr=t.index.clone();else{const n=Hle(Wle(t));this._cachedIndexAttr=new dt(n,1,!1)}uWe(t,i,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(t.index)}dispose(){const{index:e,position:t,bvhBounds:i,bvhContents:n}=this;e&&e.dispose(),t&&t.dispose(),i&&i.dispose(),n&&n.dispose()}}function uWe(s,e,t){const i=t.array,n=s.index?s.index.array:null;for(let r=0,o=e.length;r<o;r++){const a=3*r,l=3*e[r];for(let c=0;c<3;c++)i[a+c]=n?n[l+c]:l+c}}function pWe(s,e,t){const i=s._roots;if(i.length!==1)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");const n=i[0],r=new Uint16Array(n),o=new Uint32Array(n),a=new Float32Array(n),l=n.byteLength/nm,c=2*Math.ceil(Math.sqrt(l/2)),h=new Float32Array(4*c*c),d=Math.ceil(Math.sqrt(l)),u=new Uint32Array(2*d*d);for(let f=0;f<l;f++){const m=f*nm/4,g=m*2,A=m;for(let y=0;y<3;y++)h[8*f+0+y]=a[A+0+y],h[8*f+4+y]=a[A+3+y];if(Sa(g,r)){const y=Zl(g,r),b=rl(m,o),x=4294901760|y;u[f*2+0]=x,u[f*2+1]=b}else{const y=4*Wl(m,o)/nm,b=ZZ(m,o);u[f*2+0]=b,u[f*2+1]=y}}e.image.data=h,e.image.width=c,e.image.height=c,e.format=bi,e.type=$i,e.internalFormat="RGBA32F",e.minFilter=qt,e.magFilter=qt,e.generateMipmaps=!1,e.needsUpdate=!0,e.dispose(),t.image.data=u,t.image.width=d,t.image.height=d,t.format=Xx,t.type=Wr,t.internalFormat="RG32UI",t.minFilter=qt,t.magFilter=qt,t.generateMipmaps=!1,t.needsUpdate=!0,t.dispose()}const Ug=new T,Xg=new T,Og=new T,pj=new Je,tR=new T,_F=new T,fj=new Je,mj=new Je,iR=new ce,gj=new ce;function eC(s,e){if(!s&&!e)return;const t=s.count===e.count,i=s.normalized===e.normalized,n=s.array.constructor===e.array.constructor,r=s.itemSize===e.itemSize;if(!t||!i||!n||!r)throw new Error}function PC(s,e=null){const t=s.array.constructor,i=s.normalized,n=s.itemSize,r=e===null?s.count:e;return new dt(new t(n*r),n,i)}function ece(s,e,t=0){if(s.isInterleavedBufferAttribute){const i=s.itemSize;for(let n=0,r=s.count;n<r;n++){const o=n+t;e.setX(o,s.getX(n)),i>=2&&e.setY(o,s.getY(n)),i>=3&&e.setZ(o,s.getZ(n)),i>=4&&e.setW(o,s.getW(n))}}else{const i=e.array,n=i.constructor,r=i.BYTES_PER_ELEMENT*s.itemSize*t;new n(i.buffer,r,s.array.length).set(s.array)}}function fWe(s,e,t){const i=s.elements,n=e.elements;for(let r=0,o=n.length;r<o;r++)i[r]+=n[r]*t}function Aj(s,e,t){const i=s.skeleton,n=s.geometry,r=i.bones,o=i.boneInverses;fj.fromBufferAttribute(n.attributes.skinIndex,e),mj.fromBufferAttribute(n.attributes.skinWeight,e),iR.elements.fill(0);for(let a=0;a<4;a++){const l=mj.getComponent(a);if(l!==0){const c=fj.getComponent(a);gj.multiplyMatrices(r[c].matrixWorld,o[c]),fWe(iR,gj,l)}}return iR.multiply(s.bindMatrix).premultiply(s.bindMatrixInverse),t.transformDirection(iR),t}function CF(s,e,t,i,n){tR.set(0,0,0);for(let r=0,o=s.length;r<o;r++){const a=e[r],l=s[r];a!==0&&(_F.fromBufferAttribute(l,i),t?tR.addScaledVector(_F,a):tR.addScaledVector(_F.sub(n),a))}n.add(tR)}function mWe(s,e={useGroups:!1,updateIndex:!1,skipAttributes:[]},t=new It){const i=s[0].index!==null,{useGroups:n=!1,updateIndex:r=!1,skipAttributes:o=[]}=e,a=new Set(Object.keys(s[0].attributes)),l={};let c=0;t.clearGroups();for(let h=0;h<s.length;++h){const d=s[h];let u=0;if(i!==(d.index!==null))throw new Error("StaticGeometryGenerator: All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.");for(const f in d.attributes){if(!a.has(f))throw new Error('StaticGeometryGenerator: All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.');l[f]===void 0&&(l[f]=[]),l[f].push(d.attributes[f]),u++}if(u!==a.size)throw new Error("StaticGeometryGenerator: Make sure all geometries have the same number of attributes.");if(n){let f;if(i)f=d.index.count;else if(d.attributes.position!==void 0)f=d.attributes.position.count;else throw new Error("StaticGeometryGenerator: The geometry must have either an index or a position attribute");t.addGroup(c,f,h),c+=f}}if(i){let h=!1;if(!t.index){let d=0;for(let u=0;u<s.length;++u)d+=s[u].index.count;t.setIndex(new dt(new Uint32Array(d),1,!1)),h=!0}if(r||h){const d=t.index;let u=0,f=0;for(let m=0;m<s.length;++m){const g=s[m],A=g.index;if(o[m]!==!0)for(let y=0;y<A.count;++y)d.setX(u,A.getX(y)+f),u++;f+=g.attributes.position.count}}}for(const h in l){const d=l[h];if(!(h in t.attributes)){let m=0;for(const g in d)m+=d[g].count;t.setAttribute(h,PC(l[h][0],m))}const u=t.attributes[h];let f=0;for(let m=0,g=d.length;m<g;m++){const A=d[m];o[m]!==!0&&ece(A,u,f),f+=A.count}}return t}function gWe(s,e){if(s===null||e===null)return s===e;if(s.length!==e.length)return!1;for(let t=0,i=s.length;t<i;t++)if(s[t]!==e[t])return!1;return!0}function AWe(s){const{index:e,attributes:t}=s;if(e)for(let i=0,n=e.count;i<n;i+=3){const r=e.getX(i),o=e.getX(i+2);e.setX(i,o),e.setX(i+2,r)}else for(const i in t){const n=t[i],r=n.itemSize;for(let o=0,a=n.count;o<a;o+=3)for(let l=0;l<r;l++){const c=n.getComponent(o,l),h=n.getComponent(o+2,l);n.setComponent(o,l,h),n.setComponent(o+2,l,c)}}return s}class yWe{constructor(e){this.matrixWorld=new ce,this.geometryHash=null,this.boneMatrices=null,this.primitiveCount=-1,this.mesh=e,this.update()}update(){const e=this.mesh,t=e.geometry,i=e.skeleton,n=(t.index?t.index.count:t.attributes.position.count)/3;if(this.matrixWorld.copy(e.matrixWorld),this.geometryHash=t.attributes.position.version,this.primitiveCount=n,i){i.boneTexture||i.computeBoneTexture(),i.update();const r=i.boneMatrices;!this.boneMatrices||this.boneMatrices.length!==r.length?this.boneMatrices=r.slice():this.boneMatrices.set(r)}else this.boneMatrices=null}didChange(){const e=this.mesh,t=e.geometry,i=(t.index?t.index.count:t.attributes.position.count)/3;return!(this.matrixWorld.equals(e.matrixWorld)&&this.geometryHash===t.attributes.position.version&&gWe(e.skeleton&&e.skeleton.boneMatrices||null,this.boneMatrices)&&this.primitiveCount===i)}}class bWe{constructor(e){Array.isArray(e)||(e=[e]);const t=[];e.forEach(i=>{i.traverseVisible(n=>{n.isMesh&&t.push(n)})}),this.meshes=t,this.useGroups=!0,this.applyWorldTransforms=!0,this.attributes=["position","normal","color","tangent","uv","uv2"],this._intermediateGeometry=new Array(t.length).fill().map(()=>new It),this._diffMap=new WeakMap}getMaterials(){const e=[];return this.meshes.forEach(t=>{Array.isArray(t.material)?e.push(...t.material):e.push(t.material)}),e}generate(e=new It){let t=[];const{meshes:i,useGroups:n,_intermediateGeometry:r,_diffMap:o}=this;for(let a=0,l=i.length;a<l;a++){const c=i[a],h=r[a],d=o.get(c);!d||d.didChange(c)?(this._convertToStaticGeometry(c,h),t.push(!1),d?d.update():o.set(c,new yWe(c))):t.push(!0)}if(r.length===0){e.setIndex(null);const a=e.attributes;for(const l in a)e.deleteAttribute(l);for(const l in this.attributes)e.setAttribute(this.attributes[l],new dt(new Float32Array(0),4,!1))}else mWe(r,{useGroups:n,skipAttributes:t},e);for(const a in e.attributes)e.attributes[a].needsUpdate=!0;return e}_convertToStaticGeometry(e,t=new It){const i=e.geometry,n=this.applyWorldTransforms,r=this.attributes.includes("normal"),o=this.attributes.includes("tangent"),a=i.attributes,l=t.attributes;!t.index&&i.index&&(t.index=i.index.clone()),l.position||t.setAttribute("position",PC(a.position)),r&&!l.normal&&a.normal&&t.setAttribute("normal",PC(a.normal)),o&&!l.tangent&&a.tangent&&t.setAttribute("tangent",PC(a.tangent)),eC(i.index,t.index),eC(a.position,l.position),r&&eC(a.normal,l.normal),o&&eC(a.tangent,l.tangent);const c=a.position,h=r?a.normal:null,d=o?a.tangent:null,u=i.morphAttributes.position,f=i.morphAttributes.normal,m=i.morphAttributes.tangent,g=i.morphTargetsRelative,A=e.morphTargetInfluences,y=new ei;y.getNormalMatrix(e.matrixWorld),i.index&&t.index.array.set(i.index.array);for(let b=0,x=a.position.count;b<x;b++)Ug.fromBufferAttribute(c,b),h&&Xg.fromBufferAttribute(h,b),d&&(pj.fromBufferAttribute(d,b),Og.fromBufferAttribute(d,b)),A&&(u&&CF(u,A,g,b,Ug),f&&CF(f,A,g,b,Xg),m&&CF(m,A,g,b,Og)),e.isSkinnedMesh&&(e.applyBoneTransform(b,Ug),h&&Aj(e,b,Xg),d&&Aj(e,b,Og)),n&&Ug.applyMatrix4(e.matrixWorld),l.position.setXYZ(b,Ug.x,Ug.y,Ug.z),h&&(n&&Xg.applyNormalMatrix(y),l.normal.setXYZ(b,Xg.x,Xg.y,Xg.z)),d&&(n&&Og.transformDirection(e.matrixWorld),l.tangent.setXYZW(b,Og.x,Og.y,Og.z,pj.w));for(const b in this.attributes){const x=this.attributes[b];x==="position"||x==="tangent"||x==="normal"||!(x in a)||(l[x]||t.setAttribute(x,PC(a[x])),eC(a[x],l[x]),ece(a[x],l[x]))}return e.matrixWorld.determinant()<0&&AWe(t),t}}const tce=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,ice=`

float dot2( vec3 v ) {

	return dot( v, v );

}

// https://www.shadertoy.com/view/ttfGWl
vec3 closestPointToTriangle( vec3 p, vec3 v0, vec3 v1, vec3 v2, out vec3 barycoord ) {

    vec3 v10 = v1 - v0;
    vec3 v21 = v2 - v1;
    vec3 v02 = v0 - v2;

	vec3 p0 = p - v0;
	vec3 p1 = p - v1;
	vec3 p2 = p - v2;

    vec3 nor = cross( v10, v02 );

    // method 2, in barycentric space
    vec3  q = cross( nor, p0 );
    float d = 1.0 / dot2( nor );
    float u = d * dot( q, v02 );
    float v = d * dot( q, v10 );
    float w = 1.0 - u - v;

	if( u < 0.0 ) {

		w = clamp( dot( p2, v02 ) / dot2( v02 ), 0.0, 1.0 );
		u = 0.0;
		v = 1.0 - w;

	} else if( v < 0.0 ) {

		u = clamp( dot( p0, v10 ) / dot2( v10 ), 0.0, 1.0 );
		v = 0.0;
		w = 1.0 - u;

	} else if( w < 0.0 ) {

		v = clamp( dot( p1, v21 ) / dot2( v21 ), 0.0, 1.0 );
		w = 0.0;
		u = 1.0-v;

	}

	barycoord = vec3( u, v, w );
    return u * v1 + v * v2 + w * v0;

}

float distanceToTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// point and cut off range
	vec3 point, float closestDistanceSquared,

	// outputs
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord, inout float side, inout vec3 outPoint
) {

	bool found = false;
	vec3 localBarycoord;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		// get the closest point and barycoord
		vec3 closestPoint = closestPointToTriangle( point, a, b, c, localBarycoord );
		vec3 delta = point - closestPoint;
		float sqDist = dot2( delta );
		if ( sqDist < closestDistanceSquared ) {

			// set the output results
			closestDistanceSquared = sqDist;
			faceIndices = uvec4( indices.xyz, i );
			faceNormal = normalize( cross( a - b, b - c ) );
			barycoord = localBarycoord;
			outPoint = closestPoint;
			side = sign( dot( faceNormal, delta ) );

		}

	}

	return closestDistanceSquared;

}

float distanceSqToBounds( vec3 point, vec3 boundsMin, vec3 boundsMax ) {

	vec3 clampedPoint = clamp( point, boundsMin, boundsMax );
	vec3 delta = point - clampedPoint;
	return dot( delta, delta );

}

float distanceSqToBVHNodeBoundsPoint( vec3 point, sampler2D bvhBounds, uint currNodeIndex ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return distanceSqToBounds( point, boundsMin, boundsMax );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhClosestPointToPoint(		bvh,		point, faceIndices, faceNormal, barycoord, side, outPoint	)	_bvhClosestPointToPoint(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		point, faceIndices, faceNormal, barycoord, side, outPoint	)

float _bvhClosestPointToPoint(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// point to check
	vec3 point,

	// output variables
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout vec3 outPoint
 ) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float closestDistanceSquared = pow( 100000.0, 2.0 );
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance = distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, currNodeIndex );
		if ( boundsHitDistance > closestDistanceSquared ) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );
		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;
			closestDistanceSquared = distanceToTriangles(
				bvh_position, bvh_index, offset, count, point, closestDistanceSquared,

				// outputs
				faceIndices, faceNormal, barycoord, side, outPoint
			);

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;
			bool leftToRight = distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, leftIndex ) < distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, rightIndex );//rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;
			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return sqrt( closestDistanceSquared );

}
`,nce=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhIntersectFirstHit(		bvh,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)	_bvhIntersectFirstHit(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,sce=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,xWe=Object.freeze(Object.defineProperty({__proto__:null,bvh_distance_functions:ice,bvh_ray_functions:nce,bvh_struct_definitions:sce,common_functions:tce},Symbol.toStringTag,{value:"Module"})),vWe=sce,_We=ice,CWe=`
	${tce}
	${nce}
`,wWe=Object.freeze(Object.defineProperty({__proto__:null,AVERAGE:Ole,BVHShaderGLSL:xWe,CENTER:OZ,CONTAINED:oU,ExtendedTriangle:Oc,FloatVertexAttributeTexture:$le,INTERSECTED:W5e,IntVertexAttributeTexture:hWe,MeshBVH:Sm,MeshBVHHelper:QZ,MeshBVHUniformStruct:dWe,NOT_INTERSECTED:Z5e,OrientedBox:ca,SAH:Zle,StaticGeometryGenerator:bWe,UIntVertexAttributeTexture:qle,VertexAttributeTexture:uG,acceleratedRaycast:tWe,computeBatchedBoundsTree:oWe,computeBoundsTree:sWe,disposeBatchedBoundsTree:aWe,disposeBoundsTree:rWe,estimateMemoryInBytes:YZe,getBVHExtremes:KZe,getJSONStructure:jZe,getTriangleHitPointInfo:gZe,shaderDistanceFunction:_We,shaderIntersectFunction:CWe,shaderStructs:vWe,validateBounds:JZe},Symbol.toStringTag,{value:"Module"}));class SWe{constructor(e){this.name="WorkerBase",this.running=!1,this.worker=e,this.worker.onerror=t=>{throw t.message?new Error(`${this.name}: Could not create Web Worker with error "${t.message}"`):new Error(`${this.name}: Could not create Web Worker.`)}}runTask(){}generate(...e){if(this.running)throw new Error("GenerateMeshBVHWorker: Already running job.");if(this.worker===null)throw new Error("GenerateMeshBVHWorker: Worker has been disposed.");this.running=!0;const t=this.runTask(this.worker,...e);return t.finally(()=>{this.running=!1}),t}dispose(){this.worker.terminate(),this.worker=null}}const rce="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO3ZhciBBbj10eXBlb2YgZG9jdW1lbnQ8InUiP2RvY3VtZW50LmN1cnJlbnRTY3JpcHQ6bnVsbDsvKioKICogQGxpY2Vuc2UKICogQ29weXJpZ2h0IDIwMTAtMjAyNCBUaHJlZS5qcyBBdXRob3JzCiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKICovY29uc3QgWGU9IjE2OSIsVmk9MCxVaT0xLEVvPTIsTW49MCxraT0zMDAsQ289MzAxLEZvPTMwMixIaT0xZTMsX3M9MTAwMSxxaT0xMDAyLHpzPTEwMDMsJGk9MTAwNixHaT0xMDA4LFJvPTEwMDksQm89MTAxMyxXaT0xMDE0LElvPTEwMTUsdm89MTAxNixQbz0xMDIwLExvPTEwMjMsU249MTAyNixYaT0xMDI3LFlpPTAsT289MSxicz0iIiwkdD0ic3JnYiIsRXM9InNyZ2ItbGluZWFyIixEbz0iZGlzcGxheS1wMyIsWmk9ImRpc3BsYXktcDMtbGluZWFyIixfbj0ibGluZWFyIixKaT0ic3JnYiIsamk9InJlYzcwOSIsUWk9InAzIixDcz0zNTA0NCxZZT0yZTMsem49MjAwMTtjbGFzcyBaZXthZGRFdmVudExpc3RlbmVyKHQsZSl7dGhpcy5fbGlzdGVuZXJzPT09dm9pZCAwJiYodGhpcy5fbGlzdGVuZXJzPXt9KTtjb25zdCBzPXRoaXMuX2xpc3RlbmVycztzW3RdPT09dm9pZCAwJiYoc1t0XT1bXSksc1t0XS5pbmRleE9mKGUpPT09LTEmJnNbdF0ucHVzaChlKX1oYXNFdmVudExpc3RlbmVyKHQsZSl7aWYodGhpcy5fbGlzdGVuZXJzPT09dm9pZCAwKXJldHVybiExO2NvbnN0IHM9dGhpcy5fbGlzdGVuZXJzO3JldHVybiBzW3RdIT09dm9pZCAwJiZzW3RdLmluZGV4T2YoZSkhPT0tMX1yZW1vdmVFdmVudExpc3RlbmVyKHQsZSl7aWYodGhpcy5fbGlzdGVuZXJzPT09dm9pZCAwKXJldHVybjtjb25zdCBuPXRoaXMuX2xpc3RlbmVyc1t0XTtpZihuIT09dm9pZCAwKXtjb25zdCBpPW4uaW5kZXhPZihlKTtpIT09LTEmJm4uc3BsaWNlKGksMSl9fWRpc3BhdGNoRXZlbnQodCl7aWYodGhpcy5fbGlzdGVuZXJzPT09dm9pZCAwKXJldHVybjtjb25zdCBzPXRoaXMuX2xpc3RlbmVyc1t0LnR5cGVdO2lmKHMhPT12b2lkIDApe3QudGFyZ2V0PXRoaXM7Y29uc3Qgbj1zLnNsaWNlKDApO2ZvcihsZXQgaT0wLG89bi5sZW5ndGg7aTxvO2krKyluW2ldLmNhbGwodGhpcyx0KTt0LnRhcmdldD1udWxsfX19Y29uc3Qgb3Q9WyIwMCIsIjAxIiwiMDIiLCIwMyIsIjA0IiwiMDUiLCIwNiIsIjA3IiwiMDgiLCIwOSIsIjBhIiwiMGIiLCIwYyIsIjBkIiwiMGUiLCIwZiIsIjEwIiwiMTEiLCIxMiIsIjEzIiwiMTQiLCIxNSIsIjE2IiwiMTciLCIxOCIsIjE5IiwiMWEiLCIxYiIsIjFjIiwiMWQiLCIxZSIsIjFmIiwiMjAiLCIyMSIsIjIyIiwiMjMiLCIyNCIsIjI1IiwiMjYiLCIyNyIsIjI4IiwiMjkiLCIyYSIsIjJiIiwiMmMiLCIyZCIsIjJlIiwiMmYiLCIzMCIsIjMxIiwiMzIiLCIzMyIsIjM0IiwiMzUiLCIzNiIsIjM3IiwiMzgiLCIzOSIsIjNhIiwiM2IiLCIzYyIsIjNkIiwiM2UiLCIzZiIsIjQwIiwiNDEiLCI0MiIsIjQzIiwiNDQiLCI0NSIsIjQ2IiwiNDciLCI0OCIsIjQ5IiwiNGEiLCI0YiIsIjRjIiwiNGQiLCI0ZSIsIjRmIiwiNTAiLCI1MSIsIjUyIiwiNTMiLCI1NCIsIjU1IiwiNTYiLCI1NyIsIjU4IiwiNTkiLCI1YSIsIjViIiwiNWMiLCI1ZCIsIjVlIiwiNWYiLCI2MCIsIjYxIiwiNjIiLCI2MyIsIjY0IiwiNjUiLCI2NiIsIjY3IiwiNjgiLCI2OSIsIjZhIiwiNmIiLCI2YyIsIjZkIiwiNmUiLCI2ZiIsIjcwIiwiNzEiLCI3MiIsIjczIiwiNzQiLCI3NSIsIjc2IiwiNzciLCI3OCIsIjc5IiwiN2EiLCI3YiIsIjdjIiwiN2QiLCI3ZSIsIjdmIiwiODAiLCI4MSIsIjgyIiwiODMiLCI4NCIsIjg1IiwiODYiLCI4NyIsIjg4IiwiODkiLCI4YSIsIjhiIiwiOGMiLCI4ZCIsIjhlIiwiOGYiLCI5MCIsIjkxIiwiOTIiLCI5MyIsIjk0IiwiOTUiLCI5NiIsIjk3IiwiOTgiLCI5OSIsIjlhIiwiOWIiLCI5YyIsIjlkIiwiOWUiLCI5ZiIsImEwIiwiYTEiLCJhMiIsImEzIiwiYTQiLCJhNSIsImE2IiwiYTciLCJhOCIsImE5IiwiYWEiLCJhYiIsImFjIiwiYWQiLCJhZSIsImFmIiwiYjAiLCJiMSIsImIyIiwiYjMiLCJiNCIsImI1IiwiYjYiLCJiNyIsImI4IiwiYjkiLCJiYSIsImJiIiwiYmMiLCJiZCIsImJlIiwiYmYiLCJjMCIsImMxIiwiYzIiLCJjMyIsImM0IiwiYzUiLCJjNiIsImM3IiwiYzgiLCJjOSIsImNhIiwiY2IiLCJjYyIsImNkIiwiY2UiLCJjZiIsImQwIiwiZDEiLCJkMiIsImQzIiwiZDQiLCJkNSIsImQ2IiwiZDciLCJkOCIsImQ5IiwiZGEiLCJkYiIsImRjIiwiZGQiLCJkZSIsImRmIiwiZTAiLCJlMSIsImUyIiwiZTMiLCJlNCIsImU1IiwiZTYiLCJlNyIsImU4IiwiZTkiLCJlYSIsImViIiwiZWMiLCJlZCIsImVlIiwiZWYiLCJmMCIsImYxIiwiZjIiLCJmMyIsImY0IiwiZjUiLCJmNiIsImY3IiwiZjgiLCJmOSIsImZhIiwiZmIiLCJmYyIsImZkIiwiZmUiLCJmZiJdO2xldCBLaT0xMjM0NTY3O2NvbnN0IHRyPU1hdGguUEkvMTgwLGVyPTE4MC9NYXRoLlBJO2Z1bmN0aW9uIEt0KCl7Y29uc3Qgcj1NYXRoLnJhbmRvbSgpKjQyOTQ5NjcyOTV8MCx0PU1hdGgucmFuZG9tKCkqNDI5NDk2NzI5NXwwLGU9TWF0aC5yYW5kb20oKSo0Mjk0OTY3Mjk1fDAscz1NYXRoLnJhbmRvbSgpKjQyOTQ5NjcyOTV8MDtyZXR1cm4ob3RbciYyNTVdK290W3I+PjgmMjU1XStvdFtyPj4xNiYyNTVdK290W3I+PjI0JjI1NV0rIi0iK290W3QmMjU1XStvdFt0Pj44JjI1NV0rIi0iK290W3Q+PjE2JjE1fDY0XStvdFt0Pj4yNCYyNTVdKyItIitvdFtlJjYzfDEyOF0rb3RbZT4+OCYyNTVdKyItIitvdFtlPj4xNiYyNTVdK290W2U+PjI0JjI1NV0rb3RbcyYyNTVdK290W3M+PjgmMjU1XStvdFtzPj4xNiYyNTVdK290W3M+PjI0JjI1NV0pLnRvTG93ZXJDYXNlKCl9ZnVuY3Rpb24gYXQocix0LGUpe3JldHVybiBNYXRoLm1heCh0LE1hdGgubWluKGUscikpfWZ1bmN0aW9uIGJuKHIsdCl7cmV0dXJuKHIldCt0KSV0fWZ1bmN0aW9uIFZvKHIsdCxlLHMsbil7cmV0dXJuIHMrKHItdCkqKG4tcykvKGUtdCl9ZnVuY3Rpb24gVW8ocix0LGUpe3JldHVybiByIT09dD8oZS1yKS8odC1yKTowfWZ1bmN0aW9uIEplKHIsdCxlKXtyZXR1cm4oMS1lKSpyK2UqdH1mdW5jdGlvbiBrbyhyLHQsZSxzKXtyZXR1cm4gSmUocix0LDEtTWF0aC5leHAoLWUqcykpfWZ1bmN0aW9uIEhvKHIsdD0xKXtyZXR1cm4gdC1NYXRoLmFicyhibihyLHQqMiktdCl9ZnVuY3Rpb24gcW8ocix0LGUpe3JldHVybiByPD10PzA6cj49ZT8xOihyPShyLXQpLyhlLXQpLHIqciooMy0yKnIpKX1mdW5jdGlvbiAkbyhyLHQsZSl7cmV0dXJuIHI8PXQ/MDpyPj1lPzE6KHI9KHItdCkvKGUtdCkscipyKnIqKHIqKHIqNi0xNSkrMTApKX1mdW5jdGlvbiBHbyhyLHQpe3JldHVybiByK01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoodC1yKzEpKX1mdW5jdGlvbiBXbyhyLHQpe3JldHVybiByK01hdGgucmFuZG9tKCkqKHQtcil9ZnVuY3Rpb24gWG8ocil7cmV0dXJuIHIqKC41LU1hdGgucmFuZG9tKCkpfWZ1bmN0aW9uIFlvKHIpe3IhPT12b2lkIDAmJihLaT1yKTtsZXQgdD1LaSs9MTgzMTU2NTgxMztyZXR1cm4gdD1NYXRoLmltdWwodF50Pj4+MTUsdHwxKSx0Xj10K01hdGguaW11bCh0XnQ+Pj43LHR8NjEpLCgodF50Pj4+MTQpPj4+MCkvNDI5NDk2NzI5Nn1mdW5jdGlvbiBabyhyKXtyZXR1cm4gcip0cn1mdW5jdGlvbiBKbyhyKXtyZXR1cm4gciplcn1mdW5jdGlvbiBqbyhyKXtyZXR1cm4ociZyLTEpPT09MCYmciE9PTB9ZnVuY3Rpb24gUW8ocil7cmV0dXJuIE1hdGgucG93KDIsTWF0aC5jZWlsKE1hdGgubG9nKHIpL01hdGguTE4yKSl9ZnVuY3Rpb24gS28ocil7cmV0dXJuIE1hdGgucG93KDIsTWF0aC5mbG9vcihNYXRoLmxvZyhyKS9NYXRoLkxOMikpfWZ1bmN0aW9uIHRhKHIsdCxlLHMsbil7Y29uc3QgaT1NYXRoLmNvcyxvPU1hdGguc2luLGE9aShlLzIpLGM9byhlLzIpLHU9aSgodCtzKS8yKSxoPW8oKHQrcykvMiksbD1pKCh0LXMpLzIpLGQ9bygodC1zKS8yKSxmPWkoKHMtdCkvMikscD1vKChzLXQpLzIpO3N3aXRjaChuKXtjYXNlIlhZWCI6ci5zZXQoYSpoLGMqbCxjKmQsYSp1KTticmVhaztjYXNlIllaWSI6ci5zZXQoYypkLGEqaCxjKmwsYSp1KTticmVhaztjYXNlIlpYWiI6ci5zZXQoYypsLGMqZCxhKmgsYSp1KTticmVhaztjYXNlIlhaWCI6ci5zZXQoYSpoLGMqcCxjKmYsYSp1KTticmVhaztjYXNlIllYWSI6ci5zZXQoYypmLGEqaCxjKnAsYSp1KTticmVhaztjYXNlIlpZWiI6ci5zZXQoYypwLGMqZixhKmgsYSp1KTticmVhaztkZWZhdWx0OmNvbnNvbGUud2FybigiVEhSRUUuTWF0aFV0aWxzOiAuc2V0UXVhdGVybmlvbkZyb21Qcm9wZXJFdWxlcigpIGVuY291bnRlcmVkIGFuIHVua25vd24gb3JkZXI6ICIrbil9fWZ1bmN0aW9uIEV0KHIsdCl7c3dpdGNoKHQuY29uc3RydWN0b3Ipe2Nhc2UgRmxvYXQzMkFycmF5OnJldHVybiByO2Nhc2UgVWludDMyQXJyYXk6cmV0dXJuIHIvNDI5NDk2NzI5NTtjYXNlIFVpbnQxNkFycmF5OnJldHVybiByLzY1NTM1O2Nhc2UgVWludDhBcnJheTpyZXR1cm4gci8yNTU7Y2FzZSBJbnQzMkFycmF5OnJldHVybiBNYXRoLm1heChyLzIxNDc0ODM2NDcsLTEpO2Nhc2UgSW50MTZBcnJheTpyZXR1cm4gTWF0aC5tYXgoci8zMjc2NywtMSk7Y2FzZSBJbnQ4QXJyYXk6cmV0dXJuIE1hdGgubWF4KHIvMTI3LC0xKTtkZWZhdWx0OnRocm93IG5ldyBFcnJvcigiSW52YWxpZCBjb21wb25lbnQgdHlwZS4iKX19ZnVuY3Rpb24gJChyLHQpe3N3aXRjaCh0LmNvbnN0cnVjdG9yKXtjYXNlIEZsb2F0MzJBcnJheTpyZXR1cm4gcjtjYXNlIFVpbnQzMkFycmF5OnJldHVybiBNYXRoLnJvdW5kKHIqNDI5NDk2NzI5NSk7Y2FzZSBVaW50MTZBcnJheTpyZXR1cm4gTWF0aC5yb3VuZChyKjY1NTM1KTtjYXNlIFVpbnQ4QXJyYXk6cmV0dXJuIE1hdGgucm91bmQocioyNTUpO2Nhc2UgSW50MzJBcnJheTpyZXR1cm4gTWF0aC5yb3VuZChyKjIxNDc0ODM2NDcpO2Nhc2UgSW50MTZBcnJheTpyZXR1cm4gTWF0aC5yb3VuZChyKjMyNzY3KTtjYXNlIEludDhBcnJheTpyZXR1cm4gTWF0aC5yb3VuZChyKjEyNyk7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgY29tcG9uZW50IHR5cGUuIil9fWNvbnN0IGVhPXtERUcyUkFEOnRyLFJBRDJERUc6ZXIsZ2VuZXJhdGVVVUlEOkt0LGNsYW1wOmF0LGV1Y2xpZGVhbk1vZHVsbzpibixtYXBMaW5lYXI6Vm8saW52ZXJzZUxlcnA6VW8sbGVycDpKZSxkYW1wOmtvLHBpbmdwb25nOkhvLHNtb290aHN0ZXA6cW8sc21vb3RoZXJzdGVwOiRvLHJhbmRJbnQ6R28scmFuZEZsb2F0OldvLHJhbmRGbG9hdFNwcmVhZDpYbyxzZWVkZWRSYW5kb206WW8sZGVnVG9SYWQ6Wm8scmFkVG9EZWc6Sm8saXNQb3dlck9mVHdvOmpvLGNlaWxQb3dlck9mVHdvOlFvLGZsb29yUG93ZXJPZlR3bzpLbyxzZXRRdWF0ZXJuaW9uRnJvbVByb3BlckV1bGVyOnRhLG5vcm1hbGl6ZTokLGRlbm9ybWFsaXplOkV0fTtjbGFzcyBKe2NvbnN0cnVjdG9yKHQ9MCxlPTApe0oucHJvdG90eXBlLmlzVmVjdG9yMj0hMCx0aGlzLng9dCx0aGlzLnk9ZX1nZXQgd2lkdGgoKXtyZXR1cm4gdGhpcy54fXNldCB3aWR0aCh0KXt0aGlzLng9dH1nZXQgaGVpZ2h0KCl7cmV0dXJuIHRoaXMueX1zZXQgaGVpZ2h0KHQpe3RoaXMueT10fXNldCh0LGUpe3JldHVybiB0aGlzLng9dCx0aGlzLnk9ZSx0aGlzfXNldFNjYWxhcih0KXtyZXR1cm4gdGhpcy54PXQsdGhpcy55PXQsdGhpc31zZXRYKHQpe3JldHVybiB0aGlzLng9dCx0aGlzfXNldFkodCl7cmV0dXJuIHRoaXMueT10LHRoaXN9c2V0Q29tcG9uZW50KHQsZSl7c3dpdGNoKHQpe2Nhc2UgMDp0aGlzLng9ZTticmVhaztjYXNlIDE6dGhpcy55PWU7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoImluZGV4IGlzIG91dCBvZiByYW5nZTogIit0KX1yZXR1cm4gdGhpc31nZXRDb21wb25lbnQodCl7c3dpdGNoKHQpe2Nhc2UgMDpyZXR1cm4gdGhpcy54O2Nhc2UgMTpyZXR1cm4gdGhpcy55O2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICIrdCl9fWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMueCx0aGlzLnkpfWNvcHkodCl7cmV0dXJuIHRoaXMueD10LngsdGhpcy55PXQueSx0aGlzfWFkZCh0KXtyZXR1cm4gdGhpcy54Kz10LngsdGhpcy55Kz10LnksdGhpc31hZGRTY2FsYXIodCl7cmV0dXJuIHRoaXMueCs9dCx0aGlzLnkrPXQsdGhpc31hZGRWZWN0b3JzKHQsZSl7cmV0dXJuIHRoaXMueD10LngrZS54LHRoaXMueT10LnkrZS55LHRoaXN9YWRkU2NhbGVkVmVjdG9yKHQsZSl7cmV0dXJuIHRoaXMueCs9dC54KmUsdGhpcy55Kz10LnkqZSx0aGlzfXN1Yih0KXtyZXR1cm4gdGhpcy54LT10LngsdGhpcy55LT10LnksdGhpc31zdWJTY2FsYXIodCl7cmV0dXJuIHRoaXMueC09dCx0aGlzLnktPXQsdGhpc31zdWJWZWN0b3JzKHQsZSl7cmV0dXJuIHRoaXMueD10LngtZS54LHRoaXMueT10LnktZS55LHRoaXN9bXVsdGlwbHkodCl7cmV0dXJuIHRoaXMueCo9dC54LHRoaXMueSo9dC55LHRoaXN9bXVsdGlwbHlTY2FsYXIodCl7cmV0dXJuIHRoaXMueCo9dCx0aGlzLnkqPXQsdGhpc31kaXZpZGUodCl7cmV0dXJuIHRoaXMueC89dC54LHRoaXMueS89dC55LHRoaXN9ZGl2aWRlU2NhbGFyKHQpe3JldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKDEvdCl9YXBwbHlNYXRyaXgzKHQpe2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LG49dC5lbGVtZW50cztyZXR1cm4gdGhpcy54PW5bMF0qZStuWzNdKnMrbls2XSx0aGlzLnk9blsxXSplK25bNF0qcytuWzddLHRoaXN9bWluKHQpe3JldHVybiB0aGlzLng9TWF0aC5taW4odGhpcy54LHQueCksdGhpcy55PU1hdGgubWluKHRoaXMueSx0LnkpLHRoaXN9bWF4KHQpe3JldHVybiB0aGlzLng9TWF0aC5tYXgodGhpcy54LHQueCksdGhpcy55PU1hdGgubWF4KHRoaXMueSx0LnkpLHRoaXN9Y2xhbXAodCxlKXtyZXR1cm4gdGhpcy54PU1hdGgubWF4KHQueCxNYXRoLm1pbihlLngsdGhpcy54KSksdGhpcy55PU1hdGgubWF4KHQueSxNYXRoLm1pbihlLnksdGhpcy55KSksdGhpc31jbGFtcFNjYWxhcih0LGUpe3JldHVybiB0aGlzLng9TWF0aC5tYXgodCxNYXRoLm1pbihlLHRoaXMueCkpLHRoaXMueT1NYXRoLm1heCh0LE1hdGgubWluKGUsdGhpcy55KSksdGhpc31jbGFtcExlbmd0aCh0LGUpe2NvbnN0IHM9dGhpcy5sZW5ndGgoKTtyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIoc3x8MSkubXVsdGlwbHlTY2FsYXIoTWF0aC5tYXgodCxNYXRoLm1pbihlLHMpKSl9Zmxvb3IoKXtyZXR1cm4gdGhpcy54PU1hdGguZmxvb3IodGhpcy54KSx0aGlzLnk9TWF0aC5mbG9vcih0aGlzLnkpLHRoaXN9Y2VpbCgpe3JldHVybiB0aGlzLng9TWF0aC5jZWlsKHRoaXMueCksdGhpcy55PU1hdGguY2VpbCh0aGlzLnkpLHRoaXN9cm91bmQoKXtyZXR1cm4gdGhpcy54PU1hdGgucm91bmQodGhpcy54KSx0aGlzLnk9TWF0aC5yb3VuZCh0aGlzLnkpLHRoaXN9cm91bmRUb1plcm8oKXtyZXR1cm4gdGhpcy54PU1hdGgudHJ1bmModGhpcy54KSx0aGlzLnk9TWF0aC50cnVuYyh0aGlzLnkpLHRoaXN9bmVnYXRlKCl7cmV0dXJuIHRoaXMueD0tdGhpcy54LHRoaXMueT0tdGhpcy55LHRoaXN9ZG90KHQpe3JldHVybiB0aGlzLngqdC54K3RoaXMueSp0Lnl9Y3Jvc3ModCl7cmV0dXJuIHRoaXMueCp0LnktdGhpcy55KnQueH1sZW5ndGhTcSgpe3JldHVybiB0aGlzLngqdGhpcy54K3RoaXMueSp0aGlzLnl9bGVuZ3RoKCl7cmV0dXJuIE1hdGguc3FydCh0aGlzLngqdGhpcy54K3RoaXMueSp0aGlzLnkpfW1hbmhhdHRhbkxlbmd0aCgpe3JldHVybiBNYXRoLmFicyh0aGlzLngpK01hdGguYWJzKHRoaXMueSl9bm9ybWFsaXplKCl7cmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKHRoaXMubGVuZ3RoKCl8fDEpfWFuZ2xlKCl7cmV0dXJuIE1hdGguYXRhbjIoLXRoaXMueSwtdGhpcy54KStNYXRoLlBJfWFuZ2xlVG8odCl7Y29uc3QgZT1NYXRoLnNxcnQodGhpcy5sZW5ndGhTcSgpKnQubGVuZ3RoU3EoKSk7aWYoZT09PTApcmV0dXJuIE1hdGguUEkvMjtjb25zdCBzPXRoaXMuZG90KHQpL2U7cmV0dXJuIE1hdGguYWNvcyhhdChzLC0xLDEpKX1kaXN0YW5jZVRvKHQpe3JldHVybiBNYXRoLnNxcnQodGhpcy5kaXN0YW5jZVRvU3F1YXJlZCh0KSl9ZGlzdGFuY2VUb1NxdWFyZWQodCl7Y29uc3QgZT10aGlzLngtdC54LHM9dGhpcy55LXQueTtyZXR1cm4gZSplK3Mqc31tYW5oYXR0YW5EaXN0YW5jZVRvKHQpe3JldHVybiBNYXRoLmFicyh0aGlzLngtdC54KStNYXRoLmFicyh0aGlzLnktdC55KX1zZXRMZW5ndGgodCl7cmV0dXJuIHRoaXMubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIodCl9bGVycCh0LGUpe3JldHVybiB0aGlzLngrPSh0LngtdGhpcy54KSplLHRoaXMueSs9KHQueS10aGlzLnkpKmUsdGhpc31sZXJwVmVjdG9ycyh0LGUscyl7cmV0dXJuIHRoaXMueD10LngrKGUueC10LngpKnMsdGhpcy55PXQueSsoZS55LXQueSkqcyx0aGlzfWVxdWFscyh0KXtyZXR1cm4gdC54PT09dGhpcy54JiZ0Lnk9PT10aGlzLnl9ZnJvbUFycmF5KHQsZT0wKXtyZXR1cm4gdGhpcy54PXRbZV0sdGhpcy55PXRbZSsxXSx0aGlzfXRvQXJyYXkodD1bXSxlPTApe3JldHVybiB0W2VdPXRoaXMueCx0W2UrMV09dGhpcy55LHR9ZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LGUpe3JldHVybiB0aGlzLng9dC5nZXRYKGUpLHRoaXMueT10LmdldFkoZSksdGhpc31yb3RhdGVBcm91bmQodCxlKXtjb25zdCBzPU1hdGguY29zKGUpLG49TWF0aC5zaW4oZSksaT10aGlzLngtdC54LG89dGhpcy55LXQueTtyZXR1cm4gdGhpcy54PWkqcy1vKm4rdC54LHRoaXMueT1pKm4rbypzK3QueSx0aGlzfXJhbmRvbSgpe3JldHVybiB0aGlzLng9TWF0aC5yYW5kb20oKSx0aGlzLnk9TWF0aC5yYW5kb20oKSx0aGlzfSpbU3ltYm9sLml0ZXJhdG9yXSgpe3lpZWxkIHRoaXMueCx5aWVsZCB0aGlzLnl9fWNsYXNzIEN0e2NvbnN0cnVjdG9yKHQsZSxzLG4saSxvLGEsYyx1KXtDdC5wcm90b3R5cGUuaXNNYXRyaXgzPSEwLHRoaXMuZWxlbWVudHM9WzEsMCwwLDAsMSwwLDAsMCwxXSx0IT09dm9pZCAwJiZ0aGlzLnNldCh0LGUscyxuLGksbyxhLGMsdSl9c2V0KHQsZSxzLG4saSxvLGEsYyx1KXtjb25zdCBoPXRoaXMuZWxlbWVudHM7cmV0dXJuIGhbMF09dCxoWzFdPW4saFsyXT1hLGhbM109ZSxoWzRdPWksaFs1XT1jLGhbNl09cyxoWzddPW8saFs4XT11LHRoaXN9aWRlbnRpdHkoKXtyZXR1cm4gdGhpcy5zZXQoMSwwLDAsMCwxLDAsMCwwLDEpLHRoaXN9Y29weSh0KXtjb25zdCBlPXRoaXMuZWxlbWVudHMscz10LmVsZW1lbnRzO3JldHVybiBlWzBdPXNbMF0sZVsxXT1zWzFdLGVbMl09c1syXSxlWzNdPXNbM10sZVs0XT1zWzRdLGVbNV09c1s1XSxlWzZdPXNbNl0sZVs3XT1zWzddLGVbOF09c1s4XSx0aGlzfWV4dHJhY3RCYXNpcyh0LGUscyl7cmV0dXJuIHQuc2V0RnJvbU1hdHJpeDNDb2x1bW4odGhpcywwKSxlLnNldEZyb21NYXRyaXgzQ29sdW1uKHRoaXMsMSkscy5zZXRGcm9tTWF0cml4M0NvbHVtbih0aGlzLDIpLHRoaXN9c2V0RnJvbU1hdHJpeDQodCl7Y29uc3QgZT10LmVsZW1lbnRzO3JldHVybiB0aGlzLnNldChlWzBdLGVbNF0sZVs4XSxlWzFdLGVbNV0sZVs5XSxlWzJdLGVbNl0sZVsxMF0pLHRoaXN9bXVsdGlwbHkodCl7cmV0dXJuIHRoaXMubXVsdGlwbHlNYXRyaWNlcyh0aGlzLHQpfXByZW11bHRpcGx5KHQpe3JldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXModCx0aGlzKX1tdWx0aXBseU1hdHJpY2VzKHQsZSl7Y29uc3Qgcz10LmVsZW1lbnRzLG49ZS5lbGVtZW50cyxpPXRoaXMuZWxlbWVudHMsbz1zWzBdLGE9c1szXSxjPXNbNl0sdT1zWzFdLGg9c1s0XSxsPXNbN10sZD1zWzJdLGY9c1s1XSxwPXNbOF0sbT1uWzBdLGc9blszXSx5PW5bNl0sVD1uWzFdLHc9bls0XSxNPW5bN10sTj1uWzJdLF89bls1XSxTPW5bOF07cmV0dXJuIGlbMF09byptK2EqVCtjKk4saVszXT1vKmcrYSp3K2MqXyxpWzZdPW8qeSthKk0rYypTLGlbMV09dSptK2gqVCtsKk4saVs0XT11KmcraCp3K2wqXyxpWzddPXUqeStoKk0rbCpTLGlbMl09ZCptK2YqVCtwKk4saVs1XT1kKmcrZip3K3AqXyxpWzhdPWQqeStmKk0rcCpTLHRoaXN9bXVsdGlwbHlTY2FsYXIodCl7Y29uc3QgZT10aGlzLmVsZW1lbnRzO3JldHVybiBlWzBdKj10LGVbM10qPXQsZVs2XSo9dCxlWzFdKj10LGVbNF0qPXQsZVs3XSo9dCxlWzJdKj10LGVbNV0qPXQsZVs4XSo9dCx0aGlzfWRldGVybWluYW50KCl7Y29uc3QgdD10aGlzLmVsZW1lbnRzLGU9dFswXSxzPXRbMV0sbj10WzJdLGk9dFszXSxvPXRbNF0sYT10WzVdLGM9dFs2XSx1PXRbN10saD10WzhdO3JldHVybiBlKm8qaC1lKmEqdS1zKmkqaCtzKmEqYytuKmkqdS1uKm8qY31pbnZlcnQoKXtjb25zdCB0PXRoaXMuZWxlbWVudHMsZT10WzBdLHM9dFsxXSxuPXRbMl0saT10WzNdLG89dFs0XSxhPXRbNV0sYz10WzZdLHU9dFs3XSxoPXRbOF0sbD1oKm8tYSp1LGQ9YSpjLWgqaSxmPXUqaS1vKmMscD1lKmwrcypkK24qZjtpZihwPT09MClyZXR1cm4gdGhpcy5zZXQoMCwwLDAsMCwwLDAsMCwwLDApO2NvbnN0IG09MS9wO3JldHVybiB0WzBdPWwqbSx0WzFdPShuKnUtaCpzKSptLHRbMl09KGEqcy1uKm8pKm0sdFszXT1kKm0sdFs0XT0oaCplLW4qYykqbSx0WzVdPShuKmktYSplKSptLHRbNl09ZiptLHRbN109KHMqYy11KmUpKm0sdFs4XT0obyplLXMqaSkqbSx0aGlzfXRyYW5zcG9zZSgpe2xldCB0O2NvbnN0IGU9dGhpcy5lbGVtZW50cztyZXR1cm4gdD1lWzFdLGVbMV09ZVszXSxlWzNdPXQsdD1lWzJdLGVbMl09ZVs2XSxlWzZdPXQsdD1lWzVdLGVbNV09ZVs3XSxlWzddPXQsdGhpc31nZXROb3JtYWxNYXRyaXgodCl7cmV0dXJuIHRoaXMuc2V0RnJvbU1hdHJpeDQodCkuaW52ZXJ0KCkudHJhbnNwb3NlKCl9dHJhbnNwb3NlSW50b0FycmF5KHQpe2NvbnN0IGU9dGhpcy5lbGVtZW50cztyZXR1cm4gdFswXT1lWzBdLHRbMV09ZVszXSx0WzJdPWVbNl0sdFszXT1lWzFdLHRbNF09ZVs0XSx0WzVdPWVbN10sdFs2XT1lWzJdLHRbN109ZVs1XSx0WzhdPWVbOF0sdGhpc31zZXRVdlRyYW5zZm9ybSh0LGUscyxuLGksbyxhKXtjb25zdCBjPU1hdGguY29zKGkpLHU9TWF0aC5zaW4oaSk7cmV0dXJuIHRoaXMuc2V0KHMqYyxzKnUsLXMqKGMqbyt1KmEpK28rdCwtbip1LG4qYywtbiooLXUqbytjKmEpK2ErZSwwLDAsMSksdGhpc31zY2FsZSh0LGUpe3JldHVybiB0aGlzLnByZW11bHRpcGx5KEVuLm1ha2VTY2FsZSh0LGUpKSx0aGlzfXJvdGF0ZSh0KXtyZXR1cm4gdGhpcy5wcmVtdWx0aXBseShFbi5tYWtlUm90YXRpb24oLXQpKSx0aGlzfXRyYW5zbGF0ZSh0LGUpe3JldHVybiB0aGlzLnByZW11bHRpcGx5KEVuLm1ha2VUcmFuc2xhdGlvbih0LGUpKSx0aGlzfW1ha2VUcmFuc2xhdGlvbih0LGUpe3JldHVybiB0LmlzVmVjdG9yMj90aGlzLnNldCgxLDAsdC54LDAsMSx0LnksMCwwLDEpOnRoaXMuc2V0KDEsMCx0LDAsMSxlLDAsMCwxKSx0aGlzfW1ha2VSb3RhdGlvbih0KXtjb25zdCBlPU1hdGguY29zKHQpLHM9TWF0aC5zaW4odCk7cmV0dXJuIHRoaXMuc2V0KGUsLXMsMCxzLGUsMCwwLDAsMSksdGhpc31tYWtlU2NhbGUodCxlKXtyZXR1cm4gdGhpcy5zZXQodCwwLDAsMCxlLDAsMCwwLDEpLHRoaXN9ZXF1YWxzKHQpe2NvbnN0IGU9dGhpcy5lbGVtZW50cyxzPXQuZWxlbWVudHM7Zm9yKGxldCBuPTA7bjw5O24rKylpZihlW25dIT09c1tuXSlyZXR1cm4hMTtyZXR1cm4hMH1mcm9tQXJyYXkodCxlPTApe2ZvcihsZXQgcz0wO3M8OTtzKyspdGhpcy5lbGVtZW50c1tzXT10W3MrZV07cmV0dXJuIHRoaXN9dG9BcnJheSh0PVtdLGU9MCl7Y29uc3Qgcz10aGlzLmVsZW1lbnRzO3JldHVybiB0W2VdPXNbMF0sdFtlKzFdPXNbMV0sdFtlKzJdPXNbMl0sdFtlKzNdPXNbM10sdFtlKzRdPXNbNF0sdFtlKzVdPXNbNV0sdFtlKzZdPXNbNl0sdFtlKzddPXNbN10sdFtlKzhdPXNbOF0sdH1jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmZyb21BcnJheSh0aGlzLmVsZW1lbnRzKX19Y29uc3QgRW49bmV3IEN0O2Z1bmN0aW9uIHNhKHIpe2ZvcihsZXQgdD1yLmxlbmd0aC0xO3Q+PTA7LS10KWlmKHJbdF0+PTY1NTM1KXJldHVybiEwO3JldHVybiExfWZ1bmN0aW9uIHNyKHIpe3JldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiLHIpfWNvbnN0IG5yPW5ldyBDdCgpLnNldCguODIyNDYyMSwuMTc3NTM4LDAsLjAzMzE5NDEsLjk2NjgwNTgsMCwuMDE3MDgyNywuMDcyMzk3NCwuOTEwNTE5OSksaXI9bmV3IEN0KCkuc2V0KDEuMjI0OTQwMSwtLjIyNDk0MDQsMCwtLjA0MjA1NjksMS4wNDIwNTcxLDAsLS4wMTk2Mzc2LC0uMDc4NjM2MSwxLjA5ODI3MzUpLGplPXtbRXNdOnt0cmFuc2ZlcjpfbixwcmltYXJpZXM6amksbHVtaW5hbmNlQ29lZmZpY2llbnRzOlsuMjEyNiwuNzE1MiwuMDcyMl0sdG9SZWZlcmVuY2U6cj0+cixmcm9tUmVmZXJlbmNlOnI9PnJ9LFskdF06e3RyYW5zZmVyOkppLHByaW1hcmllczpqaSxsdW1pbmFuY2VDb2VmZmljaWVudHM6Wy4yMTI2LC43MTUyLC4wNzIyXSx0b1JlZmVyZW5jZTpyPT5yLmNvbnZlcnRTUkdCVG9MaW5lYXIoKSxmcm9tUmVmZXJlbmNlOnI9PnIuY29udmVydExpbmVhclRvU1JHQigpfSxbWmldOnt0cmFuc2ZlcjpfbixwcmltYXJpZXM6UWksbHVtaW5hbmNlQ29lZmZpY2llbnRzOlsuMjI4OSwuNjkxNywuMDc5M10sdG9SZWZlcmVuY2U6cj0+ci5hcHBseU1hdHJpeDMoaXIpLGZyb21SZWZlcmVuY2U6cj0+ci5hcHBseU1hdHJpeDMobnIpfSxbRG9dOnt0cmFuc2ZlcjpKaSxwcmltYXJpZXM6UWksbHVtaW5hbmNlQ29lZmZpY2llbnRzOlsuMjI4OSwuNjkxNywuMDc5M10sdG9SZWZlcmVuY2U6cj0+ci5jb252ZXJ0U1JHQlRvTGluZWFyKCkuYXBwbHlNYXRyaXgzKGlyKSxmcm9tUmVmZXJlbmNlOnI9PnIuYXBwbHlNYXRyaXgzKG5yKS5jb252ZXJ0TGluZWFyVG9TUkdCKCl9fSxuYT1uZXcgU2V0KFtFcyxaaV0pLG10PXtlbmFibGVkOiEwLF93b3JraW5nQ29sb3JTcGFjZTpFcyxnZXQgd29ya2luZ0NvbG9yU3BhY2UoKXtyZXR1cm4gdGhpcy5fd29ya2luZ0NvbG9yU3BhY2V9LHNldCB3b3JraW5nQ29sb3JTcGFjZShyKXtpZighbmEuaGFzKHIpKXRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgd29ya2luZyBjb2xvciBzcGFjZSwgIiR7cn0iLmApO3RoaXMuX3dvcmtpbmdDb2xvclNwYWNlPXJ9LGNvbnZlcnQ6ZnVuY3Rpb24ocix0LGUpe2lmKHRoaXMuZW5hYmxlZD09PSExfHx0PT09ZXx8IXR8fCFlKXJldHVybiByO2NvbnN0IHM9amVbdF0udG9SZWZlcmVuY2Usbj1qZVtlXS5mcm9tUmVmZXJlbmNlO3JldHVybiBuKHMocikpfSxmcm9tV29ya2luZ0NvbG9yU3BhY2U6ZnVuY3Rpb24ocix0KXtyZXR1cm4gdGhpcy5jb252ZXJ0KHIsdGhpcy5fd29ya2luZ0NvbG9yU3BhY2UsdCl9LHRvV29ya2luZ0NvbG9yU3BhY2U6ZnVuY3Rpb24ocix0KXtyZXR1cm4gdGhpcy5jb252ZXJ0KHIsdCx0aGlzLl93b3JraW5nQ29sb3JTcGFjZSl9LGdldFByaW1hcmllczpmdW5jdGlvbihyKXtyZXR1cm4gamVbcl0ucHJpbWFyaWVzfSxnZXRUcmFuc2ZlcjpmdW5jdGlvbihyKXtyZXR1cm4gcj09PWJzP19uOmplW3JdLnRyYW5zZmVyfSxnZXRMdW1pbmFuY2VDb2VmZmljaWVudHM6ZnVuY3Rpb24ocix0PXRoaXMuX3dvcmtpbmdDb2xvclNwYWNlKXtyZXR1cm4gci5mcm9tQXJyYXkoamVbdF0ubHVtaW5hbmNlQ29lZmZpY2llbnRzKX19O2Z1bmN0aW9uIHhlKHIpe3JldHVybiByPC4wNDA0NT9yKi4wNzczOTkzODA4Ok1hdGgucG93KHIqLjk0Nzg2NzI5ODYrLjA1MjEzMjcwMTQsMi40KX1mdW5jdGlvbiBDbihyKXtyZXR1cm4gcjwuMDAzMTMwOD9yKjEyLjkyOjEuMDU1Kk1hdGgucG93KHIsLjQxNjY2KS0uMDU1fWxldCBUZTtjbGFzcyBpYXtzdGF0aWMgZ2V0RGF0YVVSTCh0KXtpZigvXmRhdGE6L2kudGVzdCh0LnNyYyl8fHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudD4idSIpcmV0dXJuIHQuc3JjO2xldCBlO2lmKHQgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCllPXQ7ZWxzZXtUZT09PXZvaWQgMCYmKFRlPXNyKCJjYW52YXMiKSksVGUud2lkdGg9dC53aWR0aCxUZS5oZWlnaHQ9dC5oZWlnaHQ7Y29uc3Qgcz1UZS5nZXRDb250ZXh0KCIyZCIpO3QgaW5zdGFuY2VvZiBJbWFnZURhdGE/cy5wdXRJbWFnZURhdGEodCwwLDApOnMuZHJhd0ltYWdlKHQsMCwwLHQud2lkdGgsdC5oZWlnaHQpLGU9VGV9cmV0dXJuIGUud2lkdGg+MjA0OHx8ZS5oZWlnaHQ+MjA0OD8oY29uc29sZS53YXJuKCJUSFJFRS5JbWFnZVV0aWxzLmdldERhdGFVUkw6IEltYWdlIGNvbnZlcnRlZCB0byBqcGcgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMiLHQpLGUudG9EYXRhVVJMKCJpbWFnZS9qcGVnIiwuNikpOmUudG9EYXRhVVJMKCJpbWFnZS9wbmciKX1zdGF0aWMgc1JHQlRvTGluZWFyKHQpe2lmKHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50PCJ1IiYmdCBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnR8fHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudDwidSImJnQgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudHx8dHlwZW9mIEltYWdlQml0bWFwPCJ1IiYmdCBpbnN0YW5jZW9mIEltYWdlQml0bWFwKXtjb25zdCBlPXNyKCJjYW52YXMiKTtlLndpZHRoPXQud2lkdGgsZS5oZWlnaHQ9dC5oZWlnaHQ7Y29uc3Qgcz1lLmdldENvbnRleHQoIjJkIik7cy5kcmF3SW1hZ2UodCwwLDAsdC53aWR0aCx0LmhlaWdodCk7Y29uc3Qgbj1zLmdldEltYWdlRGF0YSgwLDAsdC53aWR0aCx0LmhlaWdodCksaT1uLmRhdGE7Zm9yKGxldCBvPTA7bzxpLmxlbmd0aDtvKyspaVtvXT14ZShpW29dLzI1NSkqMjU1O3JldHVybiBzLnB1dEltYWdlRGF0YShuLDAsMCksZX1lbHNlIGlmKHQuZGF0YSl7Y29uc3QgZT10LmRhdGEuc2xpY2UoMCk7Zm9yKGxldCBzPTA7czxlLmxlbmd0aDtzKyspZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXl8fGUgaW5zdGFuY2VvZiBVaW50OENsYW1wZWRBcnJheT9lW3NdPU1hdGguZmxvb3IoeGUoZVtzXS8yNTUpKjI1NSk6ZVtzXT14ZShlW3NdKTtyZXR1cm57ZGF0YTplLHdpZHRoOnQud2lkdGgsaGVpZ2h0OnQuaGVpZ2h0fX1lbHNlIHJldHVybiBjb25zb2xlLndhcm4oIlRIUkVFLkltYWdlVXRpbHMuc1JHQlRvTGluZWFyKCk6IFVuc3VwcG9ydGVkIGltYWdlIHR5cGUuIE5vIGNvbG9yIHNwYWNlIGNvbnZlcnNpb24gYXBwbGllZC4iKSx0fX1sZXQgcmE9MDtjbGFzcyBycntjb25zdHJ1Y3Rvcih0PW51bGwpe3RoaXMuaXNTb3VyY2U9ITAsT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsImlkIix7dmFsdWU6cmErK30pLHRoaXMudXVpZD1LdCgpLHRoaXMuZGF0YT10LHRoaXMuZGF0YVJlYWR5PSEwLHRoaXMudmVyc2lvbj0wfXNldCBuZWVkc1VwZGF0ZSh0KXt0PT09ITAmJnRoaXMudmVyc2lvbisrfXRvSlNPTih0KXtjb25zdCBlPXQ9PT12b2lkIDB8fHR5cGVvZiB0PT0ic3RyaW5nIjtpZighZSYmdC5pbWFnZXNbdGhpcy51dWlkXSE9PXZvaWQgMClyZXR1cm4gdC5pbWFnZXNbdGhpcy51dWlkXTtjb25zdCBzPXt1dWlkOnRoaXMudXVpZCx1cmw6IiJ9LG49dGhpcy5kYXRhO2lmKG4hPT1udWxsKXtsZXQgaTtpZihBcnJheS5pc0FycmF5KG4pKXtpPVtdO2ZvcihsZXQgbz0wLGE9bi5sZW5ndGg7bzxhO28rKyluW29dLmlzRGF0YVRleHR1cmU/aS5wdXNoKEZuKG5bb10uaW1hZ2UpKTppLnB1c2goRm4obltvXSkpfWVsc2UgaT1GbihuKTtzLnVybD1pfXJldHVybiBlfHwodC5pbWFnZXNbdGhpcy51dWlkXT1zKSxzfX1mdW5jdGlvbiBGbihyKXtyZXR1cm4gdHlwZW9mIEhUTUxJbWFnZUVsZW1lbnQ8InUiJiZyIGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudHx8dHlwZW9mIEhUTUxDYW52YXNFbGVtZW50PCJ1IiYmciBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50fHx0eXBlb2YgSW1hZ2VCaXRtYXA8InUiJiZyIGluc3RhbmNlb2YgSW1hZ2VCaXRtYXA/aWEuZ2V0RGF0YVVSTChyKTpyLmRhdGE/e2RhdGE6QXJyYXkuZnJvbShyLmRhdGEpLHdpZHRoOnIud2lkdGgsaGVpZ2h0OnIuaGVpZ2h0LHR5cGU6ci5kYXRhLmNvbnN0cnVjdG9yLm5hbWV9Oihjb25zb2xlLndhcm4oIlRIUkVFLlRleHR1cmU6IFVuYWJsZSB0byBzZXJpYWxpemUgVGV4dHVyZS4iKSx7fSl9bGV0IG9hPTA7Y2xhc3MgRHQgZXh0ZW5kcyBaZXtjb25zdHJ1Y3Rvcih0PUR0LkRFRkFVTFRfSU1BR0UsZT1EdC5ERUZBVUxUX01BUFBJTkcscz1fcyxuPV9zLGk9JGksbz1HaSxhPUxvLGM9Um8sdT1EdC5ERUZBVUxUX0FOSVNPVFJPUFksaD1icyl7c3VwZXIoKSx0aGlzLmlzVGV4dHVyZT0hMCxPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywiaWQiLHt2YWx1ZTpvYSsrfSksdGhpcy51dWlkPUt0KCksdGhpcy5uYW1lPSIiLHRoaXMuc291cmNlPW5ldyBycih0KSx0aGlzLm1pcG1hcHM9W10sdGhpcy5tYXBwaW5nPWUsdGhpcy5jaGFubmVsPTAsdGhpcy53cmFwUz1zLHRoaXMud3JhcFQ9bix0aGlzLm1hZ0ZpbHRlcj1pLHRoaXMubWluRmlsdGVyPW8sdGhpcy5hbmlzb3Ryb3B5PXUsdGhpcy5mb3JtYXQ9YSx0aGlzLmludGVybmFsRm9ybWF0PW51bGwsdGhpcy50eXBlPWMsdGhpcy5vZmZzZXQ9bmV3IEooMCwwKSx0aGlzLnJlcGVhdD1uZXcgSigxLDEpLHRoaXMuY2VudGVyPW5ldyBKKDAsMCksdGhpcy5yb3RhdGlvbj0wLHRoaXMubWF0cml4QXV0b1VwZGF0ZT0hMCx0aGlzLm1hdHJpeD1uZXcgQ3QsdGhpcy5nZW5lcmF0ZU1pcG1hcHM9ITAsdGhpcy5wcmVtdWx0aXBseUFscGhhPSExLHRoaXMuZmxpcFk9ITAsdGhpcy51bnBhY2tBbGlnbm1lbnQ9NCx0aGlzLmNvbG9yU3BhY2U9aCx0aGlzLnVzZXJEYXRhPXt9LHRoaXMudmVyc2lvbj0wLHRoaXMub25VcGRhdGU9bnVsbCx0aGlzLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZT0hMSx0aGlzLnBtcmVtVmVyc2lvbj0wfWdldCBpbWFnZSgpe3JldHVybiB0aGlzLnNvdXJjZS5kYXRhfXNldCBpbWFnZSh0PW51bGwpe3RoaXMuc291cmNlLmRhdGE9dH11cGRhdGVNYXRyaXgoKXt0aGlzLm1hdHJpeC5zZXRVdlRyYW5zZm9ybSh0aGlzLm9mZnNldC54LHRoaXMub2Zmc2V0LnksdGhpcy5yZXBlYXQueCx0aGlzLnJlcGVhdC55LHRoaXMucm90YXRpb24sdGhpcy5jZW50ZXIueCx0aGlzLmNlbnRlci55KX1jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkodGhpcyl9Y29weSh0KXtyZXR1cm4gdGhpcy5uYW1lPXQubmFtZSx0aGlzLnNvdXJjZT10LnNvdXJjZSx0aGlzLm1pcG1hcHM9dC5taXBtYXBzLnNsaWNlKDApLHRoaXMubWFwcGluZz10Lm1hcHBpbmcsdGhpcy5jaGFubmVsPXQuY2hhbm5lbCx0aGlzLndyYXBTPXQud3JhcFMsdGhpcy53cmFwVD10LndyYXBULHRoaXMubWFnRmlsdGVyPXQubWFnRmlsdGVyLHRoaXMubWluRmlsdGVyPXQubWluRmlsdGVyLHRoaXMuYW5pc290cm9weT10LmFuaXNvdHJvcHksdGhpcy5mb3JtYXQ9dC5mb3JtYXQsdGhpcy5pbnRlcm5hbEZvcm1hdD10LmludGVybmFsRm9ybWF0LHRoaXMudHlwZT10LnR5cGUsdGhpcy5vZmZzZXQuY29weSh0Lm9mZnNldCksdGhpcy5yZXBlYXQuY29weSh0LnJlcGVhdCksdGhpcy5jZW50ZXIuY29weSh0LmNlbnRlciksdGhpcy5yb3RhdGlvbj10LnJvdGF0aW9uLHRoaXMubWF0cml4QXV0b1VwZGF0ZT10Lm1hdHJpeEF1dG9VcGRhdGUsdGhpcy5tYXRyaXguY29weSh0Lm1hdHJpeCksdGhpcy5nZW5lcmF0ZU1pcG1hcHM9dC5nZW5lcmF0ZU1pcG1hcHMsdGhpcy5wcmVtdWx0aXBseUFscGhhPXQucHJlbXVsdGlwbHlBbHBoYSx0aGlzLmZsaXBZPXQuZmxpcFksdGhpcy51bnBhY2tBbGlnbm1lbnQ9dC51bnBhY2tBbGlnbm1lbnQsdGhpcy5jb2xvclNwYWNlPXQuY29sb3JTcGFjZSx0aGlzLnVzZXJEYXRhPUpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodC51c2VyRGF0YSkpLHRoaXMubmVlZHNVcGRhdGU9ITAsdGhpc310b0pTT04odCl7Y29uc3QgZT10PT09dm9pZCAwfHx0eXBlb2YgdD09InN0cmluZyI7aWYoIWUmJnQudGV4dHVyZXNbdGhpcy51dWlkXSE9PXZvaWQgMClyZXR1cm4gdC50ZXh0dXJlc1t0aGlzLnV1aWRdO2NvbnN0IHM9e21ldGFkYXRhOnt2ZXJzaW9uOjQuNix0eXBlOiJUZXh0dXJlIixnZW5lcmF0b3I6IlRleHR1cmUudG9KU09OIn0sdXVpZDp0aGlzLnV1aWQsbmFtZTp0aGlzLm5hbWUsaW1hZ2U6dGhpcy5zb3VyY2UudG9KU09OKHQpLnV1aWQsbWFwcGluZzp0aGlzLm1hcHBpbmcsY2hhbm5lbDp0aGlzLmNoYW5uZWwscmVwZWF0Olt0aGlzLnJlcGVhdC54LHRoaXMucmVwZWF0LnldLG9mZnNldDpbdGhpcy5vZmZzZXQueCx0aGlzLm9mZnNldC55XSxjZW50ZXI6W3RoaXMuY2VudGVyLngsdGhpcy5jZW50ZXIueV0scm90YXRpb246dGhpcy5yb3RhdGlvbix3cmFwOlt0aGlzLndyYXBTLHRoaXMud3JhcFRdLGZvcm1hdDp0aGlzLmZvcm1hdCxpbnRlcm5hbEZvcm1hdDp0aGlzLmludGVybmFsRm9ybWF0LHR5cGU6dGhpcy50eXBlLGNvbG9yU3BhY2U6dGhpcy5jb2xvclNwYWNlLG1pbkZpbHRlcjp0aGlzLm1pbkZpbHRlcixtYWdGaWx0ZXI6dGhpcy5tYWdGaWx0ZXIsYW5pc290cm9weTp0aGlzLmFuaXNvdHJvcHksZmxpcFk6dGhpcy5mbGlwWSxnZW5lcmF0ZU1pcG1hcHM6dGhpcy5nZW5lcmF0ZU1pcG1hcHMscHJlbXVsdGlwbHlBbHBoYTp0aGlzLnByZW11bHRpcGx5QWxwaGEsdW5wYWNrQWxpZ25tZW50OnRoaXMudW5wYWNrQWxpZ25tZW50fTtyZXR1cm4gT2JqZWN0LmtleXModGhpcy51c2VyRGF0YSkubGVuZ3RoPjAmJihzLnVzZXJEYXRhPXRoaXMudXNlckRhdGEpLGV8fCh0LnRleHR1cmVzW3RoaXMudXVpZF09cyksc31kaXNwb3NlKCl7dGhpcy5kaXNwYXRjaEV2ZW50KHt0eXBlOiJkaXNwb3NlIn0pfXRyYW5zZm9ybVV2KHQpe2lmKHRoaXMubWFwcGluZyE9PWtpKXJldHVybiB0O2lmKHQuYXBwbHlNYXRyaXgzKHRoaXMubWF0cml4KSx0Lng8MHx8dC54PjEpc3dpdGNoKHRoaXMud3JhcFMpe2Nhc2UgSGk6dC54PXQueC1NYXRoLmZsb29yKHQueCk7YnJlYWs7Y2FzZSBfczp0Lng9dC54PDA/MDoxO2JyZWFrO2Nhc2UgcWk6TWF0aC5hYnMoTWF0aC5mbG9vcih0LngpJTIpPT09MT90Lng9TWF0aC5jZWlsKHQueCktdC54OnQueD10LngtTWF0aC5mbG9vcih0LngpO2JyZWFrfWlmKHQueTwwfHx0Lnk+MSlzd2l0Y2godGhpcy53cmFwVCl7Y2FzZSBIaTp0Lnk9dC55LU1hdGguZmxvb3IodC55KTticmVhaztjYXNlIF9zOnQueT10Lnk8MD8wOjE7YnJlYWs7Y2FzZSBxaTpNYXRoLmFicyhNYXRoLmZsb29yKHQueSklMik9PT0xP3QueT1NYXRoLmNlaWwodC55KS10Lnk6dC55PXQueS1NYXRoLmZsb29yKHQueSk7YnJlYWt9cmV0dXJuIHRoaXMuZmxpcFkmJih0Lnk9MS10LnkpLHR9c2V0IG5lZWRzVXBkYXRlKHQpe3Q9PT0hMCYmKHRoaXMudmVyc2lvbisrLHRoaXMuc291cmNlLm5lZWRzVXBkYXRlPSEwKX1zZXQgbmVlZHNQTVJFTVVwZGF0ZSh0KXt0PT09ITAmJnRoaXMucG1yZW1WZXJzaW9uKyt9fUR0LkRFRkFVTFRfSU1BR0U9bnVsbCxEdC5ERUZBVUxUX01BUFBJTkc9a2ksRHQuREVGQVVMVF9BTklTT1RST1BZPTQ7Y2xhc3MgRnR7Y29uc3RydWN0b3IodD0wLGU9MCxzPTAsbj0xKXtGdC5wcm90b3R5cGUuaXNWZWN0b3I0PSEwLHRoaXMueD10LHRoaXMueT1lLHRoaXMuej1zLHRoaXMudz1ufWdldCB3aWR0aCgpe3JldHVybiB0aGlzLnp9c2V0IHdpZHRoKHQpe3RoaXMuej10fWdldCBoZWlnaHQoKXtyZXR1cm4gdGhpcy53fXNldCBoZWlnaHQodCl7dGhpcy53PXR9c2V0KHQsZSxzLG4pe3JldHVybiB0aGlzLng9dCx0aGlzLnk9ZSx0aGlzLno9cyx0aGlzLnc9bix0aGlzfXNldFNjYWxhcih0KXtyZXR1cm4gdGhpcy54PXQsdGhpcy55PXQsdGhpcy56PXQsdGhpcy53PXQsdGhpc31zZXRYKHQpe3JldHVybiB0aGlzLng9dCx0aGlzfXNldFkodCl7cmV0dXJuIHRoaXMueT10LHRoaXN9c2V0Wih0KXtyZXR1cm4gdGhpcy56PXQsdGhpc31zZXRXKHQpe3JldHVybiB0aGlzLnc9dCx0aGlzfXNldENvbXBvbmVudCh0LGUpe3N3aXRjaCh0KXtjYXNlIDA6dGhpcy54PWU7YnJlYWs7Y2FzZSAxOnRoaXMueT1lO2JyZWFrO2Nhc2UgMjp0aGlzLno9ZTticmVhaztjYXNlIDM6dGhpcy53PWU7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoImluZGV4IGlzIG91dCBvZiByYW5nZTogIit0KX1yZXR1cm4gdGhpc31nZXRDb21wb25lbnQodCl7c3dpdGNoKHQpe2Nhc2UgMDpyZXR1cm4gdGhpcy54O2Nhc2UgMTpyZXR1cm4gdGhpcy55O2Nhc2UgMjpyZXR1cm4gdGhpcy56O2Nhc2UgMzpyZXR1cm4gdGhpcy53O2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICIrdCl9fWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMueCx0aGlzLnksdGhpcy56LHRoaXMudyl9Y29weSh0KXtyZXR1cm4gdGhpcy54PXQueCx0aGlzLnk9dC55LHRoaXMuej10LnosdGhpcy53PXQudyE9PXZvaWQgMD90Lnc6MSx0aGlzfWFkZCh0KXtyZXR1cm4gdGhpcy54Kz10LngsdGhpcy55Kz10LnksdGhpcy56Kz10LnosdGhpcy53Kz10LncsdGhpc31hZGRTY2FsYXIodCl7cmV0dXJuIHRoaXMueCs9dCx0aGlzLnkrPXQsdGhpcy56Kz10LHRoaXMudys9dCx0aGlzfWFkZFZlY3RvcnModCxlKXtyZXR1cm4gdGhpcy54PXQueCtlLngsdGhpcy55PXQueStlLnksdGhpcy56PXQueitlLnosdGhpcy53PXQudytlLncsdGhpc31hZGRTY2FsZWRWZWN0b3IodCxlKXtyZXR1cm4gdGhpcy54Kz10LngqZSx0aGlzLnkrPXQueSplLHRoaXMueis9dC56KmUsdGhpcy53Kz10LncqZSx0aGlzfXN1Yih0KXtyZXR1cm4gdGhpcy54LT10LngsdGhpcy55LT10LnksdGhpcy56LT10LnosdGhpcy53LT10LncsdGhpc31zdWJTY2FsYXIodCl7cmV0dXJuIHRoaXMueC09dCx0aGlzLnktPXQsdGhpcy56LT10LHRoaXMudy09dCx0aGlzfXN1YlZlY3RvcnModCxlKXtyZXR1cm4gdGhpcy54PXQueC1lLngsdGhpcy55PXQueS1lLnksdGhpcy56PXQuei1lLnosdGhpcy53PXQudy1lLncsdGhpc31tdWx0aXBseSh0KXtyZXR1cm4gdGhpcy54Kj10LngsdGhpcy55Kj10LnksdGhpcy56Kj10LnosdGhpcy53Kj10LncsdGhpc31tdWx0aXBseVNjYWxhcih0KXtyZXR1cm4gdGhpcy54Kj10LHRoaXMueSo9dCx0aGlzLnoqPXQsdGhpcy53Kj10LHRoaXN9YXBwbHlNYXRyaXg0KHQpe2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LG49dGhpcy56LGk9dGhpcy53LG89dC5lbGVtZW50cztyZXR1cm4gdGhpcy54PW9bMF0qZStvWzRdKnMrb1s4XSpuK29bMTJdKmksdGhpcy55PW9bMV0qZStvWzVdKnMrb1s5XSpuK29bMTNdKmksdGhpcy56PW9bMl0qZStvWzZdKnMrb1sxMF0qbitvWzE0XSppLHRoaXMudz1vWzNdKmUrb1s3XSpzK29bMTFdKm4rb1sxNV0qaSx0aGlzfWRpdmlkZVNjYWxhcih0KXtyZXR1cm4gdGhpcy5tdWx0aXBseVNjYWxhcigxL3QpfXNldEF4aXNBbmdsZUZyb21RdWF0ZXJuaW9uKHQpe3RoaXMudz0yKk1hdGguYWNvcyh0LncpO2NvbnN0IGU9TWF0aC5zcXJ0KDEtdC53KnQudyk7cmV0dXJuIGU8MWUtND8odGhpcy54PTEsdGhpcy55PTAsdGhpcy56PTApOih0aGlzLng9dC54L2UsdGhpcy55PXQueS9lLHRoaXMuej10LnovZSksdGhpc31zZXRBeGlzQW5nbGVGcm9tUm90YXRpb25NYXRyaXgodCl7bGV0IGUscyxuLGk7Y29uc3QgYz10LmVsZW1lbnRzLHU9Y1swXSxoPWNbNF0sbD1jWzhdLGQ9Y1sxXSxmPWNbNV0scD1jWzldLG09Y1syXSxnPWNbNl0seT1jWzEwXTtpZihNYXRoLmFicyhoLWQpPC4wMSYmTWF0aC5hYnMobC1tKTwuMDEmJk1hdGguYWJzKHAtZyk8LjAxKXtpZihNYXRoLmFicyhoK2QpPC4xJiZNYXRoLmFicyhsK20pPC4xJiZNYXRoLmFicyhwK2cpPC4xJiZNYXRoLmFicyh1K2YreS0zKTwuMSlyZXR1cm4gdGhpcy5zZXQoMSwwLDAsMCksdGhpcztlPU1hdGguUEk7Y29uc3Qgdz0odSsxKS8yLE09KGYrMSkvMixOPSh5KzEpLzIsXz0oaCtkKS80LFM9KGwrbSkvNCxFPShwK2cpLzQ7cmV0dXJuIHc+TSYmdz5OP3c8LjAxPyhzPTAsbj0uNzA3MTA2NzgxLGk9LjcwNzEwNjc4MSk6KHM9TWF0aC5zcXJ0KHcpLG49Xy9zLGk9Uy9zKTpNPk4/TTwuMDE/KHM9LjcwNzEwNjc4MSxuPTAsaT0uNzA3MTA2NzgxKToobj1NYXRoLnNxcnQoTSkscz1fL24saT1FL24pOk48LjAxPyhzPS43MDcxMDY3ODEsbj0uNzA3MTA2NzgxLGk9MCk6KGk9TWF0aC5zcXJ0KE4pLHM9Uy9pLG49RS9pKSx0aGlzLnNldChzLG4saSxlKSx0aGlzfWxldCBUPU1hdGguc3FydCgoZy1wKSooZy1wKSsobC1tKSoobC1tKSsoZC1oKSooZC1oKSk7cmV0dXJuIE1hdGguYWJzKFQpPC4wMDEmJihUPTEpLHRoaXMueD0oZy1wKS9ULHRoaXMueT0obC1tKS9ULHRoaXMuej0oZC1oKS9ULHRoaXMudz1NYXRoLmFjb3MoKHUrZit5LTEpLzIpLHRoaXN9c2V0RnJvbU1hdHJpeFBvc2l0aW9uKHQpe2NvbnN0IGU9dC5lbGVtZW50cztyZXR1cm4gdGhpcy54PWVbMTJdLHRoaXMueT1lWzEzXSx0aGlzLno9ZVsxNF0sdGhpcy53PWVbMTVdLHRoaXN9bWluKHQpe3JldHVybiB0aGlzLng9TWF0aC5taW4odGhpcy54LHQueCksdGhpcy55PU1hdGgubWluKHRoaXMueSx0LnkpLHRoaXMuej1NYXRoLm1pbih0aGlzLnosdC56KSx0aGlzLnc9TWF0aC5taW4odGhpcy53LHQudyksdGhpc31tYXgodCl7cmV0dXJuIHRoaXMueD1NYXRoLm1heCh0aGlzLngsdC54KSx0aGlzLnk9TWF0aC5tYXgodGhpcy55LHQueSksdGhpcy56PU1hdGgubWF4KHRoaXMueix0LnopLHRoaXMudz1NYXRoLm1heCh0aGlzLncsdC53KSx0aGlzfWNsYW1wKHQsZSl7cmV0dXJuIHRoaXMueD1NYXRoLm1heCh0LngsTWF0aC5taW4oZS54LHRoaXMueCkpLHRoaXMueT1NYXRoLm1heCh0LnksTWF0aC5taW4oZS55LHRoaXMueSkpLHRoaXMuej1NYXRoLm1heCh0LnosTWF0aC5taW4oZS56LHRoaXMueikpLHRoaXMudz1NYXRoLm1heCh0LncsTWF0aC5taW4oZS53LHRoaXMudykpLHRoaXN9Y2xhbXBTY2FsYXIodCxlKXtyZXR1cm4gdGhpcy54PU1hdGgubWF4KHQsTWF0aC5taW4oZSx0aGlzLngpKSx0aGlzLnk9TWF0aC5tYXgodCxNYXRoLm1pbihlLHRoaXMueSkpLHRoaXMuej1NYXRoLm1heCh0LE1hdGgubWluKGUsdGhpcy56KSksdGhpcy53PU1hdGgubWF4KHQsTWF0aC5taW4oZSx0aGlzLncpKSx0aGlzfWNsYW1wTGVuZ3RoKHQsZSl7Y29uc3Qgcz10aGlzLmxlbmd0aCgpO3JldHVybiB0aGlzLmRpdmlkZVNjYWxhcihzfHwxKS5tdWx0aXBseVNjYWxhcihNYXRoLm1heCh0LE1hdGgubWluKGUscykpKX1mbG9vcigpe3JldHVybiB0aGlzLng9TWF0aC5mbG9vcih0aGlzLngpLHRoaXMueT1NYXRoLmZsb29yKHRoaXMueSksdGhpcy56PU1hdGguZmxvb3IodGhpcy56KSx0aGlzLnc9TWF0aC5mbG9vcih0aGlzLncpLHRoaXN9Y2VpbCgpe3JldHVybiB0aGlzLng9TWF0aC5jZWlsKHRoaXMueCksdGhpcy55PU1hdGguY2VpbCh0aGlzLnkpLHRoaXMuej1NYXRoLmNlaWwodGhpcy56KSx0aGlzLnc9TWF0aC5jZWlsKHRoaXMudyksdGhpc31yb3VuZCgpe3JldHVybiB0aGlzLng9TWF0aC5yb3VuZCh0aGlzLngpLHRoaXMueT1NYXRoLnJvdW5kKHRoaXMueSksdGhpcy56PU1hdGgucm91bmQodGhpcy56KSx0aGlzLnc9TWF0aC5yb3VuZCh0aGlzLncpLHRoaXN9cm91bmRUb1plcm8oKXtyZXR1cm4gdGhpcy54PU1hdGgudHJ1bmModGhpcy54KSx0aGlzLnk9TWF0aC50cnVuYyh0aGlzLnkpLHRoaXMuej1NYXRoLnRydW5jKHRoaXMueiksdGhpcy53PU1hdGgudHJ1bmModGhpcy53KSx0aGlzfW5lZ2F0ZSgpe3JldHVybiB0aGlzLng9LXRoaXMueCx0aGlzLnk9LXRoaXMueSx0aGlzLno9LXRoaXMueix0aGlzLnc9LXRoaXMudyx0aGlzfWRvdCh0KXtyZXR1cm4gdGhpcy54KnQueCt0aGlzLnkqdC55K3RoaXMueip0LnordGhpcy53KnQud31sZW5ndGhTcSgpe3JldHVybiB0aGlzLngqdGhpcy54K3RoaXMueSp0aGlzLnkrdGhpcy56KnRoaXMueit0aGlzLncqdGhpcy53fWxlbmd0aCgpe3JldHVybiBNYXRoLnNxcnQodGhpcy54KnRoaXMueCt0aGlzLnkqdGhpcy55K3RoaXMueip0aGlzLnordGhpcy53KnRoaXMudyl9bWFuaGF0dGFuTGVuZ3RoKCl7cmV0dXJuIE1hdGguYWJzKHRoaXMueCkrTWF0aC5hYnModGhpcy55KStNYXRoLmFicyh0aGlzLnopK01hdGguYWJzKHRoaXMudyl9bm9ybWFsaXplKCl7cmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKHRoaXMubGVuZ3RoKCl8fDEpfXNldExlbmd0aCh0KXtyZXR1cm4gdGhpcy5ub3JtYWxpemUoKS5tdWx0aXBseVNjYWxhcih0KX1sZXJwKHQsZSl7cmV0dXJuIHRoaXMueCs9KHQueC10aGlzLngpKmUsdGhpcy55Kz0odC55LXRoaXMueSkqZSx0aGlzLnorPSh0LnotdGhpcy56KSplLHRoaXMudys9KHQudy10aGlzLncpKmUsdGhpc31sZXJwVmVjdG9ycyh0LGUscyl7cmV0dXJuIHRoaXMueD10LngrKGUueC10LngpKnMsdGhpcy55PXQueSsoZS55LXQueSkqcyx0aGlzLno9dC56KyhlLnotdC56KSpzLHRoaXMudz10LncrKGUudy10LncpKnMsdGhpc31lcXVhbHModCl7cmV0dXJuIHQueD09PXRoaXMueCYmdC55PT09dGhpcy55JiZ0Lno9PT10aGlzLnomJnQudz09PXRoaXMud31mcm9tQXJyYXkodCxlPTApe3JldHVybiB0aGlzLng9dFtlXSx0aGlzLnk9dFtlKzFdLHRoaXMuej10W2UrMl0sdGhpcy53PXRbZSszXSx0aGlzfXRvQXJyYXkodD1bXSxlPTApe3JldHVybiB0W2VdPXRoaXMueCx0W2UrMV09dGhpcy55LHRbZSsyXT10aGlzLnosdFtlKzNdPXRoaXMudyx0fWZyb21CdWZmZXJBdHRyaWJ1dGUodCxlKXtyZXR1cm4gdGhpcy54PXQuZ2V0WChlKSx0aGlzLnk9dC5nZXRZKGUpLHRoaXMuej10LmdldFooZSksdGhpcy53PXQuZ2V0VyhlKSx0aGlzfXJhbmRvbSgpe3JldHVybiB0aGlzLng9TWF0aC5yYW5kb20oKSx0aGlzLnk9TWF0aC5yYW5kb20oKSx0aGlzLno9TWF0aC5yYW5kb20oKSx0aGlzLnc9TWF0aC5yYW5kb20oKSx0aGlzfSpbU3ltYm9sLml0ZXJhdG9yXSgpe3lpZWxkIHRoaXMueCx5aWVsZCB0aGlzLnkseWllbGQgdGhpcy56LHlpZWxkIHRoaXMud319Y2xhc3Mgb3IgZXh0ZW5kcyBaZXtjb25zdHJ1Y3Rvcih0PTEsZT0xLHM9e30pe3N1cGVyKCksdGhpcy5pc1JlbmRlclRhcmdldD0hMCx0aGlzLndpZHRoPXQsdGhpcy5oZWlnaHQ9ZSx0aGlzLmRlcHRoPTEsdGhpcy5zY2lzc29yPW5ldyBGdCgwLDAsdCxlKSx0aGlzLnNjaXNzb3JUZXN0PSExLHRoaXMudmlld3BvcnQ9bmV3IEZ0KDAsMCx0LGUpO2NvbnN0IG49e3dpZHRoOnQsaGVpZ2h0OmUsZGVwdGg6MX07cz1PYmplY3QuYXNzaWduKHtnZW5lcmF0ZU1pcG1hcHM6ITEsaW50ZXJuYWxGb3JtYXQ6bnVsbCxtaW5GaWx0ZXI6JGksZGVwdGhCdWZmZXI6ITAsc3RlbmNpbEJ1ZmZlcjohMSxyZXNvbHZlRGVwdGhCdWZmZXI6ITAscmVzb2x2ZVN0ZW5jaWxCdWZmZXI6ITAsZGVwdGhUZXh0dXJlOm51bGwsc2FtcGxlczowLGNvdW50OjF9LHMpO2NvbnN0IGk9bmV3IER0KG4scy5tYXBwaW5nLHMud3JhcFMscy53cmFwVCxzLm1hZ0ZpbHRlcixzLm1pbkZpbHRlcixzLmZvcm1hdCxzLnR5cGUscy5hbmlzb3Ryb3B5LHMuY29sb3JTcGFjZSk7aS5mbGlwWT0hMSxpLmdlbmVyYXRlTWlwbWFwcz1zLmdlbmVyYXRlTWlwbWFwcyxpLmludGVybmFsRm9ybWF0PXMuaW50ZXJuYWxGb3JtYXQsdGhpcy50ZXh0dXJlcz1bXTtjb25zdCBvPXMuY291bnQ7Zm9yKGxldCBhPTA7YTxvO2ErKyl0aGlzLnRleHR1cmVzW2FdPWkuY2xvbmUoKSx0aGlzLnRleHR1cmVzW2FdLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZT0hMDt0aGlzLmRlcHRoQnVmZmVyPXMuZGVwdGhCdWZmZXIsdGhpcy5zdGVuY2lsQnVmZmVyPXMuc3RlbmNpbEJ1ZmZlcix0aGlzLnJlc29sdmVEZXB0aEJ1ZmZlcj1zLnJlc29sdmVEZXB0aEJ1ZmZlcix0aGlzLnJlc29sdmVTdGVuY2lsQnVmZmVyPXMucmVzb2x2ZVN0ZW5jaWxCdWZmZXIsdGhpcy5kZXB0aFRleHR1cmU9cy5kZXB0aFRleHR1cmUsdGhpcy5zYW1wbGVzPXMuc2FtcGxlc31nZXQgdGV4dHVyZSgpe3JldHVybiB0aGlzLnRleHR1cmVzWzBdfXNldCB0ZXh0dXJlKHQpe3RoaXMudGV4dHVyZXNbMF09dH1zZXRTaXplKHQsZSxzPTEpe2lmKHRoaXMud2lkdGghPT10fHx0aGlzLmhlaWdodCE9PWV8fHRoaXMuZGVwdGghPT1zKXt0aGlzLndpZHRoPXQsdGhpcy5oZWlnaHQ9ZSx0aGlzLmRlcHRoPXM7Zm9yKGxldCBuPTAsaT10aGlzLnRleHR1cmVzLmxlbmd0aDtuPGk7bisrKXRoaXMudGV4dHVyZXNbbl0uaW1hZ2Uud2lkdGg9dCx0aGlzLnRleHR1cmVzW25dLmltYWdlLmhlaWdodD1lLHRoaXMudGV4dHVyZXNbbl0uaW1hZ2UuZGVwdGg9czt0aGlzLmRpc3Bvc2UoKX10aGlzLnZpZXdwb3J0LnNldCgwLDAsdCxlKSx0aGlzLnNjaXNzb3Iuc2V0KDAsMCx0LGUpfWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSh0aGlzKX1jb3B5KHQpe3RoaXMud2lkdGg9dC53aWR0aCx0aGlzLmhlaWdodD10LmhlaWdodCx0aGlzLmRlcHRoPXQuZGVwdGgsdGhpcy5zY2lzc29yLmNvcHkodC5zY2lzc29yKSx0aGlzLnNjaXNzb3JUZXN0PXQuc2Npc3NvclRlc3QsdGhpcy52aWV3cG9ydC5jb3B5KHQudmlld3BvcnQpLHRoaXMudGV4dHVyZXMubGVuZ3RoPTA7Zm9yKGxldCBzPTAsbj10LnRleHR1cmVzLmxlbmd0aDtzPG47cysrKXRoaXMudGV4dHVyZXNbc109dC50ZXh0dXJlc1tzXS5jbG9uZSgpLHRoaXMudGV4dHVyZXNbc10uaXNSZW5kZXJUYXJnZXRUZXh0dXJlPSEwO2NvbnN0IGU9T2JqZWN0LmFzc2lnbih7fSx0LnRleHR1cmUuaW1hZ2UpO3JldHVybiB0aGlzLnRleHR1cmUuc291cmNlPW5ldyBycihlKSx0aGlzLmRlcHRoQnVmZmVyPXQuZGVwdGhCdWZmZXIsdGhpcy5zdGVuY2lsQnVmZmVyPXQuc3RlbmNpbEJ1ZmZlcix0aGlzLnJlc29sdmVEZXB0aEJ1ZmZlcj10LnJlc29sdmVEZXB0aEJ1ZmZlcix0aGlzLnJlc29sdmVTdGVuY2lsQnVmZmVyPXQucmVzb2x2ZVN0ZW5jaWxCdWZmZXIsdC5kZXB0aFRleHR1cmUhPT1udWxsJiYodGhpcy5kZXB0aFRleHR1cmU9dC5kZXB0aFRleHR1cmUuY2xvbmUoKSksdGhpcy5zYW1wbGVzPXQuc2FtcGxlcyx0aGlzfWRpc3Bvc2UoKXt0aGlzLmRpc3BhdGNoRXZlbnQoe3R5cGU6ImRpc3Bvc2UifSl9fWNsYXNzIFFle2NvbnN0cnVjdG9yKHQ9MCxlPTAscz0wLG49MSl7dGhpcy5pc1F1YXRlcm5pb249ITAsdGhpcy5feD10LHRoaXMuX3k9ZSx0aGlzLl96PXMsdGhpcy5fdz1ufXN0YXRpYyBzbGVycEZsYXQodCxlLHMsbixpLG8sYSl7bGV0IGM9c1tuKzBdLHU9c1tuKzFdLGg9c1tuKzJdLGw9c1tuKzNdO2NvbnN0IGQ9aVtvKzBdLGY9aVtvKzFdLHA9aVtvKzJdLG09aVtvKzNdO2lmKGE9PT0wKXt0W2UrMF09Yyx0W2UrMV09dSx0W2UrMl09aCx0W2UrM109bDtyZXR1cm59aWYoYT09PTEpe3RbZSswXT1kLHRbZSsxXT1mLHRbZSsyXT1wLHRbZSszXT1tO3JldHVybn1pZihsIT09bXx8YyE9PWR8fHUhPT1mfHxoIT09cCl7bGV0IGc9MS1hO2NvbnN0IHk9YypkK3UqZitoKnArbCptLFQ9eT49MD8xOi0xLHc9MS15Knk7aWYodz5OdW1iZXIuRVBTSUxPTil7Y29uc3QgTj1NYXRoLnNxcnQodyksXz1NYXRoLmF0YW4yKE4seSpUKTtnPU1hdGguc2luKGcqXykvTixhPU1hdGguc2luKGEqXykvTn1jb25zdCBNPWEqVDtpZihjPWMqZytkKk0sdT11KmcrZipNLGg9aCpnK3AqTSxsPWwqZyttKk0sZz09PTEtYSl7Y29uc3QgTj0xL01hdGguc3FydChjKmMrdSp1K2gqaCtsKmwpO2MqPU4sdSo9TixoKj1OLGwqPU59fXRbZV09Yyx0W2UrMV09dSx0W2UrMl09aCx0W2UrM109bH1zdGF0aWMgbXVsdGlwbHlRdWF0ZXJuaW9uc0ZsYXQodCxlLHMsbixpLG8pe2NvbnN0IGE9c1tuXSxjPXNbbisxXSx1PXNbbisyXSxoPXNbbiszXSxsPWlbb10sZD1pW28rMV0sZj1pW28rMl0scD1pW28rM107cmV0dXJuIHRbZV09YSpwK2gqbCtjKmYtdSpkLHRbZSsxXT1jKnAraCpkK3UqbC1hKmYsdFtlKzJdPXUqcCtoKmYrYSpkLWMqbCx0W2UrM109aCpwLWEqbC1jKmQtdSpmLHR9Z2V0IHgoKXtyZXR1cm4gdGhpcy5feH1zZXQgeCh0KXt0aGlzLl94PXQsdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpfWdldCB5KCl7cmV0dXJuIHRoaXMuX3l9c2V0IHkodCl7dGhpcy5feT10LHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKX1nZXQgeigpe3JldHVybiB0aGlzLl96fXNldCB6KHQpe3RoaXMuX3o9dCx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCl9Z2V0IHcoKXtyZXR1cm4gdGhpcy5fd31zZXQgdyh0KXt0aGlzLl93PXQsdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpfXNldCh0LGUscyxuKXtyZXR1cm4gdGhpcy5feD10LHRoaXMuX3k9ZSx0aGlzLl96PXMsdGhpcy5fdz1uLHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMuX3gsdGhpcy5feSx0aGlzLl96LHRoaXMuX3cpfWNvcHkodCl7cmV0dXJuIHRoaXMuX3g9dC54LHRoaXMuX3k9dC55LHRoaXMuX3o9dC56LHRoaXMuX3c9dC53LHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfXNldEZyb21FdWxlcih0LGU9ITApe2NvbnN0IHM9dC5feCxuPXQuX3ksaT10Ll96LG89dC5fb3JkZXIsYT1NYXRoLmNvcyxjPU1hdGguc2luLHU9YShzLzIpLGg9YShuLzIpLGw9YShpLzIpLGQ9YyhzLzIpLGY9YyhuLzIpLHA9YyhpLzIpO3N3aXRjaChvKXtjYXNlIlhZWiI6dGhpcy5feD1kKmgqbCt1KmYqcCx0aGlzLl95PXUqZipsLWQqaCpwLHRoaXMuX3o9dSpoKnArZCpmKmwsdGhpcy5fdz11KmgqbC1kKmYqcDticmVhaztjYXNlIllYWiI6dGhpcy5feD1kKmgqbCt1KmYqcCx0aGlzLl95PXUqZipsLWQqaCpwLHRoaXMuX3o9dSpoKnAtZCpmKmwsdGhpcy5fdz11KmgqbCtkKmYqcDticmVhaztjYXNlIlpYWSI6dGhpcy5feD1kKmgqbC11KmYqcCx0aGlzLl95PXUqZipsK2QqaCpwLHRoaXMuX3o9dSpoKnArZCpmKmwsdGhpcy5fdz11KmgqbC1kKmYqcDticmVhaztjYXNlIlpZWCI6dGhpcy5feD1kKmgqbC11KmYqcCx0aGlzLl95PXUqZipsK2QqaCpwLHRoaXMuX3o9dSpoKnAtZCpmKmwsdGhpcy5fdz11KmgqbCtkKmYqcDticmVhaztjYXNlIllaWCI6dGhpcy5feD1kKmgqbCt1KmYqcCx0aGlzLl95PXUqZipsK2QqaCpwLHRoaXMuX3o9dSpoKnAtZCpmKmwsdGhpcy5fdz11KmgqbC1kKmYqcDticmVhaztjYXNlIlhaWSI6dGhpcy5feD1kKmgqbC11KmYqcCx0aGlzLl95PXUqZipsLWQqaCpwLHRoaXMuX3o9dSpoKnArZCpmKmwsdGhpcy5fdz11KmgqbCtkKmYqcDticmVhaztkZWZhdWx0OmNvbnNvbGUud2FybigiVEhSRUUuUXVhdGVybmlvbjogLnNldEZyb21FdWxlcigpIGVuY291bnRlcmVkIGFuIHVua25vd24gb3JkZXI6ICIrbyl9cmV0dXJuIGU9PT0hMCYmdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9c2V0RnJvbUF4aXNBbmdsZSh0LGUpe2NvbnN0IHM9ZS8yLG49TWF0aC5zaW4ocyk7cmV0dXJuIHRoaXMuX3g9dC54Km4sdGhpcy5feT10Lnkqbix0aGlzLl96PXQueipuLHRoaXMuX3c9TWF0aC5jb3MocyksdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9c2V0RnJvbVJvdGF0aW9uTWF0cml4KHQpe2NvbnN0IGU9dC5lbGVtZW50cyxzPWVbMF0sbj1lWzRdLGk9ZVs4XSxvPWVbMV0sYT1lWzVdLGM9ZVs5XSx1PWVbMl0saD1lWzZdLGw9ZVsxMF0sZD1zK2ErbDtpZihkPjApe2NvbnN0IGY9LjUvTWF0aC5zcXJ0KGQrMSk7dGhpcy5fdz0uMjUvZix0aGlzLl94PShoLWMpKmYsdGhpcy5feT0oaS11KSpmLHRoaXMuX3o9KG8tbikqZn1lbHNlIGlmKHM+YSYmcz5sKXtjb25zdCBmPTIqTWF0aC5zcXJ0KDErcy1hLWwpO3RoaXMuX3c9KGgtYykvZix0aGlzLl94PS4yNSpmLHRoaXMuX3k9KG4rbykvZix0aGlzLl96PShpK3UpL2Z9ZWxzZSBpZihhPmwpe2NvbnN0IGY9MipNYXRoLnNxcnQoMSthLXMtbCk7dGhpcy5fdz0oaS11KS9mLHRoaXMuX3g9KG4rbykvZix0aGlzLl95PS4yNSpmLHRoaXMuX3o9KGMraCkvZn1lbHNle2NvbnN0IGY9MipNYXRoLnNxcnQoMStsLXMtYSk7dGhpcy5fdz0oby1uKS9mLHRoaXMuX3g9KGkrdSkvZix0aGlzLl95PShjK2gpL2YsdGhpcy5fej0uMjUqZn1yZXR1cm4gdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9c2V0RnJvbVVuaXRWZWN0b3JzKHQsZSl7bGV0IHM9dC5kb3QoZSkrMTtyZXR1cm4gczxOdW1iZXIuRVBTSUxPTj8ocz0wLE1hdGguYWJzKHQueCk+TWF0aC5hYnModC56KT8odGhpcy5feD0tdC55LHRoaXMuX3k9dC54LHRoaXMuX3o9MCx0aGlzLl93PXMpOih0aGlzLl94PTAsdGhpcy5feT0tdC56LHRoaXMuX3o9dC55LHRoaXMuX3c9cykpOih0aGlzLl94PXQueSplLnotdC56KmUueSx0aGlzLl95PXQueiplLngtdC54KmUueix0aGlzLl96PXQueCplLnktdC55KmUueCx0aGlzLl93PXMpLHRoaXMubm9ybWFsaXplKCl9YW5nbGVUbyh0KXtyZXR1cm4gMipNYXRoLmFjb3MoTWF0aC5hYnMoYXQodGhpcy5kb3QodCksLTEsMSkpKX1yb3RhdGVUb3dhcmRzKHQsZSl7Y29uc3Qgcz10aGlzLmFuZ2xlVG8odCk7aWYocz09PTApcmV0dXJuIHRoaXM7Y29uc3Qgbj1NYXRoLm1pbigxLGUvcyk7cmV0dXJuIHRoaXMuc2xlcnAodCxuKSx0aGlzfWlkZW50aXR5KCl7cmV0dXJuIHRoaXMuc2V0KDAsMCwwLDEpfWludmVydCgpe3JldHVybiB0aGlzLmNvbmp1Z2F0ZSgpfWNvbmp1Z2F0ZSgpe3JldHVybiB0aGlzLl94Kj0tMSx0aGlzLl95Kj0tMSx0aGlzLl96Kj0tMSx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCksdGhpc31kb3QodCl7cmV0dXJuIHRoaXMuX3gqdC5feCt0aGlzLl95KnQuX3krdGhpcy5feip0Ll96K3RoaXMuX3cqdC5fd31sZW5ndGhTcSgpe3JldHVybiB0aGlzLl94KnRoaXMuX3grdGhpcy5feSp0aGlzLl95K3RoaXMuX3oqdGhpcy5feit0aGlzLl93KnRoaXMuX3d9bGVuZ3RoKCl7cmV0dXJuIE1hdGguc3FydCh0aGlzLl94KnRoaXMuX3grdGhpcy5feSp0aGlzLl95K3RoaXMuX3oqdGhpcy5feit0aGlzLl93KnRoaXMuX3cpfW5vcm1hbGl6ZSgpe2xldCB0PXRoaXMubGVuZ3RoKCk7cmV0dXJuIHQ9PT0wPyh0aGlzLl94PTAsdGhpcy5feT0wLHRoaXMuX3o9MCx0aGlzLl93PTEpOih0PTEvdCx0aGlzLl94PXRoaXMuX3gqdCx0aGlzLl95PXRoaXMuX3kqdCx0aGlzLl96PXRoaXMuX3oqdCx0aGlzLl93PXRoaXMuX3cqdCksdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9bXVsdGlwbHkodCl7cmV0dXJuIHRoaXMubXVsdGlwbHlRdWF0ZXJuaW9ucyh0aGlzLHQpfXByZW11bHRpcGx5KHQpe3JldHVybiB0aGlzLm11bHRpcGx5UXVhdGVybmlvbnModCx0aGlzKX1tdWx0aXBseVF1YXRlcm5pb25zKHQsZSl7Y29uc3Qgcz10Ll94LG49dC5feSxpPXQuX3osbz10Ll93LGE9ZS5feCxjPWUuX3ksdT1lLl96LGg9ZS5fdztyZXR1cm4gdGhpcy5feD1zKmgrbyphK24qdS1pKmMsdGhpcy5feT1uKmgrbypjK2kqYS1zKnUsdGhpcy5fej1pKmgrbyp1K3MqYy1uKmEsdGhpcy5fdz1vKmgtcyphLW4qYy1pKnUsdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9c2xlcnAodCxlKXtpZihlPT09MClyZXR1cm4gdGhpcztpZihlPT09MSlyZXR1cm4gdGhpcy5jb3B5KHQpO2NvbnN0IHM9dGhpcy5feCxuPXRoaXMuX3ksaT10aGlzLl96LG89dGhpcy5fdztsZXQgYT1vKnQuX3crcyp0Ll94K24qdC5feStpKnQuX3o7aWYoYTwwPyh0aGlzLl93PS10Ll93LHRoaXMuX3g9LXQuX3gsdGhpcy5feT0tdC5feSx0aGlzLl96PS10Ll96LGE9LWEpOnRoaXMuY29weSh0KSxhPj0xKXJldHVybiB0aGlzLl93PW8sdGhpcy5feD1zLHRoaXMuX3k9bix0aGlzLl96PWksdGhpcztjb25zdCBjPTEtYSphO2lmKGM8PU51bWJlci5FUFNJTE9OKXtjb25zdCBmPTEtZTtyZXR1cm4gdGhpcy5fdz1mKm8rZSp0aGlzLl93LHRoaXMuX3g9ZipzK2UqdGhpcy5feCx0aGlzLl95PWYqbitlKnRoaXMuX3ksdGhpcy5fej1mKmkrZSp0aGlzLl96LHRoaXMubm9ybWFsaXplKCksdGhpc31jb25zdCB1PU1hdGguc3FydChjKSxoPU1hdGguYXRhbjIodSxhKSxsPU1hdGguc2luKCgxLWUpKmgpL3UsZD1NYXRoLnNpbihlKmgpL3U7cmV0dXJuIHRoaXMuX3c9bypsK3RoaXMuX3cqZCx0aGlzLl94PXMqbCt0aGlzLl94KmQsdGhpcy5feT1uKmwrdGhpcy5feSpkLHRoaXMuX3o9aSpsK3RoaXMuX3oqZCx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCksdGhpc31zbGVycFF1YXRlcm5pb25zKHQsZSxzKXtyZXR1cm4gdGhpcy5jb3B5KHQpLnNsZXJwKGUscyl9cmFuZG9tKCl7Y29uc3QgdD0yKk1hdGguUEkqTWF0aC5yYW5kb20oKSxlPTIqTWF0aC5QSSpNYXRoLnJhbmRvbSgpLHM9TWF0aC5yYW5kb20oKSxuPU1hdGguc3FydCgxLXMpLGk9TWF0aC5zcXJ0KHMpO3JldHVybiB0aGlzLnNldChuKk1hdGguc2luKHQpLG4qTWF0aC5jb3ModCksaSpNYXRoLnNpbihlKSxpKk1hdGguY29zKGUpKX1lcXVhbHModCl7cmV0dXJuIHQuX3g9PT10aGlzLl94JiZ0Ll95PT09dGhpcy5feSYmdC5fej09PXRoaXMuX3omJnQuX3c9PT10aGlzLl93fWZyb21BcnJheSh0LGU9MCl7cmV0dXJuIHRoaXMuX3g9dFtlXSx0aGlzLl95PXRbZSsxXSx0aGlzLl96PXRbZSsyXSx0aGlzLl93PXRbZSszXSx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCksdGhpc310b0FycmF5KHQ9W10sZT0wKXtyZXR1cm4gdFtlXT10aGlzLl94LHRbZSsxXT10aGlzLl95LHRbZSsyXT10aGlzLl96LHRbZSszXT10aGlzLl93LHR9ZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LGUpe3JldHVybiB0aGlzLl94PXQuZ2V0WChlKSx0aGlzLl95PXQuZ2V0WShlKSx0aGlzLl96PXQuZ2V0WihlKSx0aGlzLl93PXQuZ2V0VyhlKSx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCksdGhpc310b0pTT04oKXtyZXR1cm4gdGhpcy50b0FycmF5KCl9X29uQ2hhbmdlKHQpe3JldHVybiB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrPXQsdGhpc31fb25DaGFuZ2VDYWxsYmFjaygpe30qW1N5bWJvbC5pdGVyYXRvcl0oKXt5aWVsZCB0aGlzLl94LHlpZWxkIHRoaXMuX3kseWllbGQgdGhpcy5feix5aWVsZCB0aGlzLl93fX1jbGFzcyBBe2NvbnN0cnVjdG9yKHQ9MCxlPTAscz0wKXtBLnByb3RvdHlwZS5pc1ZlY3RvcjM9ITAsdGhpcy54PXQsdGhpcy55PWUsdGhpcy56PXN9c2V0KHQsZSxzKXtyZXR1cm4gcz09PXZvaWQgMCYmKHM9dGhpcy56KSx0aGlzLng9dCx0aGlzLnk9ZSx0aGlzLno9cyx0aGlzfXNldFNjYWxhcih0KXtyZXR1cm4gdGhpcy54PXQsdGhpcy55PXQsdGhpcy56PXQsdGhpc31zZXRYKHQpe3JldHVybiB0aGlzLng9dCx0aGlzfXNldFkodCl7cmV0dXJuIHRoaXMueT10LHRoaXN9c2V0Wih0KXtyZXR1cm4gdGhpcy56PXQsdGhpc31zZXRDb21wb25lbnQodCxlKXtzd2l0Y2godCl7Y2FzZSAwOnRoaXMueD1lO2JyZWFrO2Nhc2UgMTp0aGlzLnk9ZTticmVhaztjYXNlIDI6dGhpcy56PWU7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoImluZGV4IGlzIG91dCBvZiByYW5nZTogIit0KX1yZXR1cm4gdGhpc31nZXRDb21wb25lbnQodCl7c3dpdGNoKHQpe2Nhc2UgMDpyZXR1cm4gdGhpcy54O2Nhc2UgMTpyZXR1cm4gdGhpcy55O2Nhc2UgMjpyZXR1cm4gdGhpcy56O2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICIrdCl9fWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMueCx0aGlzLnksdGhpcy56KX1jb3B5KHQpe3JldHVybiB0aGlzLng9dC54LHRoaXMueT10LnksdGhpcy56PXQueix0aGlzfWFkZCh0KXtyZXR1cm4gdGhpcy54Kz10LngsdGhpcy55Kz10LnksdGhpcy56Kz10LnosdGhpc31hZGRTY2FsYXIodCl7cmV0dXJuIHRoaXMueCs9dCx0aGlzLnkrPXQsdGhpcy56Kz10LHRoaXN9YWRkVmVjdG9ycyh0LGUpe3JldHVybiB0aGlzLng9dC54K2UueCx0aGlzLnk9dC55K2UueSx0aGlzLno9dC56K2Uueix0aGlzfWFkZFNjYWxlZFZlY3Rvcih0LGUpe3JldHVybiB0aGlzLngrPXQueCplLHRoaXMueSs9dC55KmUsdGhpcy56Kz10LnoqZSx0aGlzfXN1Yih0KXtyZXR1cm4gdGhpcy54LT10LngsdGhpcy55LT10LnksdGhpcy56LT10LnosdGhpc31zdWJTY2FsYXIodCl7cmV0dXJuIHRoaXMueC09dCx0aGlzLnktPXQsdGhpcy56LT10LHRoaXN9c3ViVmVjdG9ycyh0LGUpe3JldHVybiB0aGlzLng9dC54LWUueCx0aGlzLnk9dC55LWUueSx0aGlzLno9dC56LWUueix0aGlzfW11bHRpcGx5KHQpe3JldHVybiB0aGlzLngqPXQueCx0aGlzLnkqPXQueSx0aGlzLnoqPXQueix0aGlzfW11bHRpcGx5U2NhbGFyKHQpe3JldHVybiB0aGlzLngqPXQsdGhpcy55Kj10LHRoaXMueio9dCx0aGlzfW11bHRpcGx5VmVjdG9ycyh0LGUpe3JldHVybiB0aGlzLng9dC54KmUueCx0aGlzLnk9dC55KmUueSx0aGlzLno9dC56KmUueix0aGlzfWFwcGx5RXVsZXIodCl7cmV0dXJuIHRoaXMuYXBwbHlRdWF0ZXJuaW9uKGFyLnNldEZyb21FdWxlcih0KSl9YXBwbHlBeGlzQW5nbGUodCxlKXtyZXR1cm4gdGhpcy5hcHBseVF1YXRlcm5pb24oYXIuc2V0RnJvbUF4aXNBbmdsZSh0LGUpKX1hcHBseU1hdHJpeDModCl7Y29uc3QgZT10aGlzLngscz10aGlzLnksbj10aGlzLnosaT10LmVsZW1lbnRzO3JldHVybiB0aGlzLng9aVswXSplK2lbM10qcytpWzZdKm4sdGhpcy55PWlbMV0qZStpWzRdKnMraVs3XSpuLHRoaXMuej1pWzJdKmUraVs1XSpzK2lbOF0qbix0aGlzfWFwcGx5Tm9ybWFsTWF0cml4KHQpe3JldHVybiB0aGlzLmFwcGx5TWF0cml4Myh0KS5ub3JtYWxpemUoKX1hcHBseU1hdHJpeDQodCl7Y29uc3QgZT10aGlzLngscz10aGlzLnksbj10aGlzLnosaT10LmVsZW1lbnRzLG89MS8oaVszXSplK2lbN10qcytpWzExXSpuK2lbMTVdKTtyZXR1cm4gdGhpcy54PShpWzBdKmUraVs0XSpzK2lbOF0qbitpWzEyXSkqbyx0aGlzLnk9KGlbMV0qZStpWzVdKnMraVs5XSpuK2lbMTNdKSpvLHRoaXMuej0oaVsyXSplK2lbNl0qcytpWzEwXSpuK2lbMTRdKSpvLHRoaXN9YXBwbHlRdWF0ZXJuaW9uKHQpe2NvbnN0IGU9dGhpcy54LHM9dGhpcy55LG49dGhpcy56LGk9dC54LG89dC55LGE9dC56LGM9dC53LHU9MioobypuLWEqcyksaD0yKihhKmUtaSpuKSxsPTIqKGkqcy1vKmUpO3JldHVybiB0aGlzLng9ZStjKnUrbypsLWEqaCx0aGlzLnk9cytjKmgrYSp1LWkqbCx0aGlzLno9bitjKmwraSpoLW8qdSx0aGlzfXByb2plY3QodCl7cmV0dXJuIHRoaXMuYXBwbHlNYXRyaXg0KHQubWF0cml4V29ybGRJbnZlcnNlKS5hcHBseU1hdHJpeDQodC5wcm9qZWN0aW9uTWF0cml4KX11bnByb2plY3QodCl7cmV0dXJuIHRoaXMuYXBwbHlNYXRyaXg0KHQucHJvamVjdGlvbk1hdHJpeEludmVyc2UpLmFwcGx5TWF0cml4NCh0Lm1hdHJpeFdvcmxkKX10cmFuc2Zvcm1EaXJlY3Rpb24odCl7Y29uc3QgZT10aGlzLngscz10aGlzLnksbj10aGlzLnosaT10LmVsZW1lbnRzO3JldHVybiB0aGlzLng9aVswXSplK2lbNF0qcytpWzhdKm4sdGhpcy55PWlbMV0qZStpWzVdKnMraVs5XSpuLHRoaXMuej1pWzJdKmUraVs2XSpzK2lbMTBdKm4sdGhpcy5ub3JtYWxpemUoKX1kaXZpZGUodCl7cmV0dXJuIHRoaXMueC89dC54LHRoaXMueS89dC55LHRoaXMuei89dC56LHRoaXN9ZGl2aWRlU2NhbGFyKHQpe3JldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKDEvdCl9bWluKHQpe3JldHVybiB0aGlzLng9TWF0aC5taW4odGhpcy54LHQueCksdGhpcy55PU1hdGgubWluKHRoaXMueSx0LnkpLHRoaXMuej1NYXRoLm1pbih0aGlzLnosdC56KSx0aGlzfW1heCh0KXtyZXR1cm4gdGhpcy54PU1hdGgubWF4KHRoaXMueCx0LngpLHRoaXMueT1NYXRoLm1heCh0aGlzLnksdC55KSx0aGlzLno9TWF0aC5tYXgodGhpcy56LHQueiksdGhpc31jbGFtcCh0LGUpe3JldHVybiB0aGlzLng9TWF0aC5tYXgodC54LE1hdGgubWluKGUueCx0aGlzLngpKSx0aGlzLnk9TWF0aC5tYXgodC55LE1hdGgubWluKGUueSx0aGlzLnkpKSx0aGlzLno9TWF0aC5tYXgodC56LE1hdGgubWluKGUueix0aGlzLnopKSx0aGlzfWNsYW1wU2NhbGFyKHQsZSl7cmV0dXJuIHRoaXMueD1NYXRoLm1heCh0LE1hdGgubWluKGUsdGhpcy54KSksdGhpcy55PU1hdGgubWF4KHQsTWF0aC5taW4oZSx0aGlzLnkpKSx0aGlzLno9TWF0aC5tYXgodCxNYXRoLm1pbihlLHRoaXMueikpLHRoaXN9Y2xhbXBMZW5ndGgodCxlKXtjb25zdCBzPXRoaXMubGVuZ3RoKCk7cmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKHN8fDEpLm11bHRpcGx5U2NhbGFyKE1hdGgubWF4KHQsTWF0aC5taW4oZSxzKSkpfWZsb29yKCl7cmV0dXJuIHRoaXMueD1NYXRoLmZsb29yKHRoaXMueCksdGhpcy55PU1hdGguZmxvb3IodGhpcy55KSx0aGlzLno9TWF0aC5mbG9vcih0aGlzLnopLHRoaXN9Y2VpbCgpe3JldHVybiB0aGlzLng9TWF0aC5jZWlsKHRoaXMueCksdGhpcy55PU1hdGguY2VpbCh0aGlzLnkpLHRoaXMuej1NYXRoLmNlaWwodGhpcy56KSx0aGlzfXJvdW5kKCl7cmV0dXJuIHRoaXMueD1NYXRoLnJvdW5kKHRoaXMueCksdGhpcy55PU1hdGgucm91bmQodGhpcy55KSx0aGlzLno9TWF0aC5yb3VuZCh0aGlzLnopLHRoaXN9cm91bmRUb1plcm8oKXtyZXR1cm4gdGhpcy54PU1hdGgudHJ1bmModGhpcy54KSx0aGlzLnk9TWF0aC50cnVuYyh0aGlzLnkpLHRoaXMuej1NYXRoLnRydW5jKHRoaXMueiksdGhpc31uZWdhdGUoKXtyZXR1cm4gdGhpcy54PS10aGlzLngsdGhpcy55PS10aGlzLnksdGhpcy56PS10aGlzLnosdGhpc31kb3QodCl7cmV0dXJuIHRoaXMueCp0LngrdGhpcy55KnQueSt0aGlzLnoqdC56fWxlbmd0aFNxKCl7cmV0dXJuIHRoaXMueCp0aGlzLngrdGhpcy55KnRoaXMueSt0aGlzLnoqdGhpcy56fWxlbmd0aCgpe3JldHVybiBNYXRoLnNxcnQodGhpcy54KnRoaXMueCt0aGlzLnkqdGhpcy55K3RoaXMueip0aGlzLnopfW1hbmhhdHRhbkxlbmd0aCgpe3JldHVybiBNYXRoLmFicyh0aGlzLngpK01hdGguYWJzKHRoaXMueSkrTWF0aC5hYnModGhpcy56KX1ub3JtYWxpemUoKXtyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIodGhpcy5sZW5ndGgoKXx8MSl9c2V0TGVuZ3RoKHQpe3JldHVybiB0aGlzLm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKHQpfWxlcnAodCxlKXtyZXR1cm4gdGhpcy54Kz0odC54LXRoaXMueCkqZSx0aGlzLnkrPSh0LnktdGhpcy55KSplLHRoaXMueis9KHQuei10aGlzLnopKmUsdGhpc31sZXJwVmVjdG9ycyh0LGUscyl7cmV0dXJuIHRoaXMueD10LngrKGUueC10LngpKnMsdGhpcy55PXQueSsoZS55LXQueSkqcyx0aGlzLno9dC56KyhlLnotdC56KSpzLHRoaXN9Y3Jvc3ModCl7cmV0dXJuIHRoaXMuY3Jvc3NWZWN0b3JzKHRoaXMsdCl9Y3Jvc3NWZWN0b3JzKHQsZSl7Y29uc3Qgcz10Lngsbj10LnksaT10Lnosbz1lLngsYT1lLnksYz1lLno7cmV0dXJuIHRoaXMueD1uKmMtaSphLHRoaXMueT1pKm8tcypjLHRoaXMuej1zKmEtbipvLHRoaXN9cHJvamVjdE9uVmVjdG9yKHQpe2NvbnN0IGU9dC5sZW5ndGhTcSgpO2lmKGU9PT0wKXJldHVybiB0aGlzLnNldCgwLDAsMCk7Y29uc3Qgcz10LmRvdCh0aGlzKS9lO3JldHVybiB0aGlzLmNvcHkodCkubXVsdGlwbHlTY2FsYXIocyl9cHJvamVjdE9uUGxhbmUodCl7cmV0dXJuIFJuLmNvcHkodGhpcykucHJvamVjdE9uVmVjdG9yKHQpLHRoaXMuc3ViKFJuKX1yZWZsZWN0KHQpe3JldHVybiB0aGlzLnN1YihSbi5jb3B5KHQpLm11bHRpcGx5U2NhbGFyKDIqdGhpcy5kb3QodCkpKX1hbmdsZVRvKHQpe2NvbnN0IGU9TWF0aC5zcXJ0KHRoaXMubGVuZ3RoU3EoKSp0Lmxlbmd0aFNxKCkpO2lmKGU9PT0wKXJldHVybiBNYXRoLlBJLzI7Y29uc3Qgcz10aGlzLmRvdCh0KS9lO3JldHVybiBNYXRoLmFjb3MoYXQocywtMSwxKSl9ZGlzdGFuY2VUbyh0KXtyZXR1cm4gTWF0aC5zcXJ0KHRoaXMuZGlzdGFuY2VUb1NxdWFyZWQodCkpfWRpc3RhbmNlVG9TcXVhcmVkKHQpe2NvbnN0IGU9dGhpcy54LXQueCxzPXRoaXMueS10Lnksbj10aGlzLnotdC56O3JldHVybiBlKmUrcypzK24qbn1tYW5oYXR0YW5EaXN0YW5jZVRvKHQpe3JldHVybiBNYXRoLmFicyh0aGlzLngtdC54KStNYXRoLmFicyh0aGlzLnktdC55KStNYXRoLmFicyh0aGlzLnotdC56KX1zZXRGcm9tU3BoZXJpY2FsKHQpe3JldHVybiB0aGlzLnNldEZyb21TcGhlcmljYWxDb29yZHModC5yYWRpdXMsdC5waGksdC50aGV0YSl9c2V0RnJvbVNwaGVyaWNhbENvb3Jkcyh0LGUscyl7Y29uc3Qgbj1NYXRoLnNpbihlKSp0O3JldHVybiB0aGlzLng9bipNYXRoLnNpbihzKSx0aGlzLnk9TWF0aC5jb3MoZSkqdCx0aGlzLno9bipNYXRoLmNvcyhzKSx0aGlzfXNldEZyb21DeWxpbmRyaWNhbCh0KXtyZXR1cm4gdGhpcy5zZXRGcm9tQ3lsaW5kcmljYWxDb29yZHModC5yYWRpdXMsdC50aGV0YSx0LnkpfXNldEZyb21DeWxpbmRyaWNhbENvb3Jkcyh0LGUscyl7cmV0dXJuIHRoaXMueD10Kk1hdGguc2luKGUpLHRoaXMueT1zLHRoaXMuej10Kk1hdGguY29zKGUpLHRoaXN9c2V0RnJvbU1hdHJpeFBvc2l0aW9uKHQpe2NvbnN0IGU9dC5lbGVtZW50cztyZXR1cm4gdGhpcy54PWVbMTJdLHRoaXMueT1lWzEzXSx0aGlzLno9ZVsxNF0sdGhpc31zZXRGcm9tTWF0cml4U2NhbGUodCl7Y29uc3QgZT10aGlzLnNldEZyb21NYXRyaXhDb2x1bW4odCwwKS5sZW5ndGgoKSxzPXRoaXMuc2V0RnJvbU1hdHJpeENvbHVtbih0LDEpLmxlbmd0aCgpLG49dGhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKHQsMikubGVuZ3RoKCk7cmV0dXJuIHRoaXMueD1lLHRoaXMueT1zLHRoaXMuej1uLHRoaXN9c2V0RnJvbU1hdHJpeENvbHVtbih0LGUpe3JldHVybiB0aGlzLmZyb21BcnJheSh0LmVsZW1lbnRzLGUqNCl9c2V0RnJvbU1hdHJpeDNDb2x1bW4odCxlKXtyZXR1cm4gdGhpcy5mcm9tQXJyYXkodC5lbGVtZW50cyxlKjMpfXNldEZyb21FdWxlcih0KXtyZXR1cm4gdGhpcy54PXQuX3gsdGhpcy55PXQuX3ksdGhpcy56PXQuX3osdGhpc31zZXRGcm9tQ29sb3IodCl7cmV0dXJuIHRoaXMueD10LnIsdGhpcy55PXQuZyx0aGlzLno9dC5iLHRoaXN9ZXF1YWxzKHQpe3JldHVybiB0Lng9PT10aGlzLngmJnQueT09PXRoaXMueSYmdC56PT09dGhpcy56fWZyb21BcnJheSh0LGU9MCl7cmV0dXJuIHRoaXMueD10W2VdLHRoaXMueT10W2UrMV0sdGhpcy56PXRbZSsyXSx0aGlzfXRvQXJyYXkodD1bXSxlPTApe3JldHVybiB0W2VdPXRoaXMueCx0W2UrMV09dGhpcy55LHRbZSsyXT10aGlzLnosdH1mcm9tQnVmZmVyQXR0cmlidXRlKHQsZSl7cmV0dXJuIHRoaXMueD10LmdldFgoZSksdGhpcy55PXQuZ2V0WShlKSx0aGlzLno9dC5nZXRaKGUpLHRoaXN9cmFuZG9tKCl7cmV0dXJuIHRoaXMueD1NYXRoLnJhbmRvbSgpLHRoaXMueT1NYXRoLnJhbmRvbSgpLHRoaXMuej1NYXRoLnJhbmRvbSgpLHRoaXN9cmFuZG9tRGlyZWN0aW9uKCl7Y29uc3QgdD1NYXRoLnJhbmRvbSgpKk1hdGguUEkqMixlPU1hdGgucmFuZG9tKCkqMi0xLHM9TWF0aC5zcXJ0KDEtZSplKTtyZXR1cm4gdGhpcy54PXMqTWF0aC5jb3ModCksdGhpcy55PWUsdGhpcy56PXMqTWF0aC5zaW4odCksdGhpc30qW1N5bWJvbC5pdGVyYXRvcl0oKXt5aWVsZCB0aGlzLngseWllbGQgdGhpcy55LHlpZWxkIHRoaXMuen19Y29uc3QgUm49bmV3IEEsYXI9bmV3IFFlO2NsYXNzIGh0e2NvbnN0cnVjdG9yKHQ9bmV3IEEoMS8wLDEvMCwxLzApLGU9bmV3IEEoLTEvMCwtMS8wLC0xLzApKXt0aGlzLmlzQm94Mz0hMCx0aGlzLm1pbj10LHRoaXMubWF4PWV9c2V0KHQsZSl7cmV0dXJuIHRoaXMubWluLmNvcHkodCksdGhpcy5tYXguY29weShlKSx0aGlzfXNldEZyb21BcnJheSh0KXt0aGlzLm1ha2VFbXB0eSgpO2ZvcihsZXQgZT0wLHM9dC5sZW5ndGg7ZTxzO2UrPTMpdGhpcy5leHBhbmRCeVBvaW50KFJ0LmZyb21BcnJheSh0LGUpKTtyZXR1cm4gdGhpc31zZXRGcm9tQnVmZmVyQXR0cmlidXRlKHQpe3RoaXMubWFrZUVtcHR5KCk7Zm9yKGxldCBlPTAscz10LmNvdW50O2U8cztlKyspdGhpcy5leHBhbmRCeVBvaW50KFJ0LmZyb21CdWZmZXJBdHRyaWJ1dGUodCxlKSk7cmV0dXJuIHRoaXN9c2V0RnJvbVBvaW50cyh0KXt0aGlzLm1ha2VFbXB0eSgpO2ZvcihsZXQgZT0wLHM9dC5sZW5ndGg7ZTxzO2UrKyl0aGlzLmV4cGFuZEJ5UG9pbnQodFtlXSk7cmV0dXJuIHRoaXN9c2V0RnJvbUNlbnRlckFuZFNpemUodCxlKXtjb25zdCBzPVJ0LmNvcHkoZSkubXVsdGlwbHlTY2FsYXIoLjUpO3JldHVybiB0aGlzLm1pbi5jb3B5KHQpLnN1YihzKSx0aGlzLm1heC5jb3B5KHQpLmFkZChzKSx0aGlzfXNldEZyb21PYmplY3QodCxlPSExKXtyZXR1cm4gdGhpcy5tYWtlRW1wdHkoKSx0aGlzLmV4cGFuZEJ5T2JqZWN0KHQsZSl9Y2xvbmUoKXtyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KHRoaXMpfWNvcHkodCl7cmV0dXJuIHRoaXMubWluLmNvcHkodC5taW4pLHRoaXMubWF4LmNvcHkodC5tYXgpLHRoaXN9bWFrZUVtcHR5KCl7cmV0dXJuIHRoaXMubWluLng9dGhpcy5taW4ueT10aGlzLm1pbi56PTEvMCx0aGlzLm1heC54PXRoaXMubWF4Lnk9dGhpcy5tYXguej0tMS8wLHRoaXN9aXNFbXB0eSgpe3JldHVybiB0aGlzLm1heC54PHRoaXMubWluLnh8fHRoaXMubWF4Lnk8dGhpcy5taW4ueXx8dGhpcy5tYXguejx0aGlzLm1pbi56fWdldENlbnRlcih0KXtyZXR1cm4gdGhpcy5pc0VtcHR5KCk/dC5zZXQoMCwwLDApOnQuYWRkVmVjdG9ycyh0aGlzLm1pbix0aGlzLm1heCkubXVsdGlwbHlTY2FsYXIoLjUpfWdldFNpemUodCl7cmV0dXJuIHRoaXMuaXNFbXB0eSgpP3Quc2V0KDAsMCwwKTp0LnN1YlZlY3RvcnModGhpcy5tYXgsdGhpcy5taW4pfWV4cGFuZEJ5UG9pbnQodCl7cmV0dXJuIHRoaXMubWluLm1pbih0KSx0aGlzLm1heC5tYXgodCksdGhpc31leHBhbmRCeVZlY3Rvcih0KXtyZXR1cm4gdGhpcy5taW4uc3ViKHQpLHRoaXMubWF4LmFkZCh0KSx0aGlzfWV4cGFuZEJ5U2NhbGFyKHQpe3JldHVybiB0aGlzLm1pbi5hZGRTY2FsYXIoLXQpLHRoaXMubWF4LmFkZFNjYWxhcih0KSx0aGlzfWV4cGFuZEJ5T2JqZWN0KHQsZT0hMSl7dC51cGRhdGVXb3JsZE1hdHJpeCghMSwhMSk7Y29uc3Qgcz10Lmdlb21ldHJ5O2lmKHMhPT12b2lkIDApe2NvbnN0IGk9cy5nZXRBdHRyaWJ1dGUoInBvc2l0aW9uIik7aWYoZT09PSEwJiZpIT09dm9pZCAwJiZ0LmlzSW5zdGFuY2VkTWVzaCE9PSEwKWZvcihsZXQgbz0wLGE9aS5jb3VudDtvPGE7bysrKXQuaXNNZXNoPT09ITA/dC5nZXRWZXJ0ZXhQb3NpdGlvbihvLFJ0KTpSdC5mcm9tQnVmZmVyQXR0cmlidXRlKGksbyksUnQuYXBwbHlNYXRyaXg0KHQubWF0cml4V29ybGQpLHRoaXMuZXhwYW5kQnlQb2ludChSdCk7ZWxzZSB0LmJvdW5kaW5nQm94IT09dm9pZCAwPyh0LmJvdW5kaW5nQm94PT09bnVsbCYmdC5jb21wdXRlQm91bmRpbmdCb3goKSxGcy5jb3B5KHQuYm91bmRpbmdCb3gpKToocy5ib3VuZGluZ0JveD09PW51bGwmJnMuY29tcHV0ZUJvdW5kaW5nQm94KCksRnMuY29weShzLmJvdW5kaW5nQm94KSksRnMuYXBwbHlNYXRyaXg0KHQubWF0cml4V29ybGQpLHRoaXMudW5pb24oRnMpfWNvbnN0IG49dC5jaGlsZHJlbjtmb3IobGV0IGk9MCxvPW4ubGVuZ3RoO2k8bztpKyspdGhpcy5leHBhbmRCeU9iamVjdChuW2ldLGUpO3JldHVybiB0aGlzfWNvbnRhaW5zUG9pbnQodCl7cmV0dXJuIHQueD49dGhpcy5taW4ueCYmdC54PD10aGlzLm1heC54JiZ0Lnk+PXRoaXMubWluLnkmJnQueTw9dGhpcy5tYXgueSYmdC56Pj10aGlzLm1pbi56JiZ0Lno8PXRoaXMubWF4Lnp9Y29udGFpbnNCb3godCl7cmV0dXJuIHRoaXMubWluLng8PXQubWluLngmJnQubWF4Lng8PXRoaXMubWF4LngmJnRoaXMubWluLnk8PXQubWluLnkmJnQubWF4Lnk8PXRoaXMubWF4LnkmJnRoaXMubWluLno8PXQubWluLnomJnQubWF4Lno8PXRoaXMubWF4Lnp9Z2V0UGFyYW1ldGVyKHQsZSl7cmV0dXJuIGUuc2V0KCh0LngtdGhpcy5taW4ueCkvKHRoaXMubWF4LngtdGhpcy5taW4ueCksKHQueS10aGlzLm1pbi55KS8odGhpcy5tYXgueS10aGlzLm1pbi55KSwodC56LXRoaXMubWluLnopLyh0aGlzLm1heC56LXRoaXMubWluLnopKX1pbnRlcnNlY3RzQm94KHQpe3JldHVybiB0Lm1heC54Pj10aGlzLm1pbi54JiZ0Lm1pbi54PD10aGlzLm1heC54JiZ0Lm1heC55Pj10aGlzLm1pbi55JiZ0Lm1pbi55PD10aGlzLm1heC55JiZ0Lm1heC56Pj10aGlzLm1pbi56JiZ0Lm1pbi56PD10aGlzLm1heC56fWludGVyc2VjdHNTcGhlcmUodCl7cmV0dXJuIHRoaXMuY2xhbXBQb2ludCh0LmNlbnRlcixSdCksUnQuZGlzdGFuY2VUb1NxdWFyZWQodC5jZW50ZXIpPD10LnJhZGl1cyp0LnJhZGl1c31pbnRlcnNlY3RzUGxhbmUodCl7bGV0IGUscztyZXR1cm4gdC5ub3JtYWwueD4wPyhlPXQubm9ybWFsLngqdGhpcy5taW4ueCxzPXQubm9ybWFsLngqdGhpcy5tYXgueCk6KGU9dC5ub3JtYWwueCp0aGlzLm1heC54LHM9dC5ub3JtYWwueCp0aGlzLm1pbi54KSx0Lm5vcm1hbC55PjA/KGUrPXQubm9ybWFsLnkqdGhpcy5taW4ueSxzKz10Lm5vcm1hbC55KnRoaXMubWF4LnkpOihlKz10Lm5vcm1hbC55KnRoaXMubWF4Lnkscys9dC5ub3JtYWwueSp0aGlzLm1pbi55KSx0Lm5vcm1hbC56PjA/KGUrPXQubm9ybWFsLnoqdGhpcy5taW4ueixzKz10Lm5vcm1hbC56KnRoaXMubWF4LnopOihlKz10Lm5vcm1hbC56KnRoaXMubWF4Lnoscys9dC5ub3JtYWwueip0aGlzLm1pbi56KSxlPD0tdC5jb25zdGFudCYmcz49LXQuY29uc3RhbnR9aW50ZXJzZWN0c1RyaWFuZ2xlKHQpe2lmKHRoaXMuaXNFbXB0eSgpKXJldHVybiExO3RoaXMuZ2V0Q2VudGVyKEtlKSxScy5zdWJWZWN0b3JzKHRoaXMubWF4LEtlKSxOZS5zdWJWZWN0b3JzKHQuYSxLZSksd2Uuc3ViVmVjdG9ycyh0LmIsS2UpLEFlLnN1YlZlY3RvcnModC5jLEtlKSx0ZS5zdWJWZWN0b3JzKHdlLE5lKSxlZS5zdWJWZWN0b3JzKEFlLHdlKSx1ZS5zdWJWZWN0b3JzKE5lLEFlKTtsZXQgZT1bMCwtdGUueix0ZS55LDAsLWVlLnosZWUueSwwLC11ZS56LHVlLnksdGUueiwwLC10ZS54LGVlLnosMCwtZWUueCx1ZS56LDAsLXVlLngsLXRlLnksdGUueCwwLC1lZS55LGVlLngsMCwtdWUueSx1ZS54LDBdO3JldHVybiFCbihlLE5lLHdlLEFlLFJzKXx8KGU9WzEsMCwwLDAsMSwwLDAsMCwxXSwhQm4oZSxOZSx3ZSxBZSxScykpPyExOihCcy5jcm9zc1ZlY3RvcnModGUsZWUpLGU9W0JzLngsQnMueSxCcy56XSxCbihlLE5lLHdlLEFlLFJzKSl9Y2xhbXBQb2ludCh0LGUpe3JldHVybiBlLmNvcHkodCkuY2xhbXAodGhpcy5taW4sdGhpcy5tYXgpfWRpc3RhbmNlVG9Qb2ludCh0KXtyZXR1cm4gdGhpcy5jbGFtcFBvaW50KHQsUnQpLmRpc3RhbmNlVG8odCl9Z2V0Qm91bmRpbmdTcGhlcmUodCl7cmV0dXJuIHRoaXMuaXNFbXB0eSgpP3QubWFrZUVtcHR5KCk6KHRoaXMuZ2V0Q2VudGVyKHQuY2VudGVyKSx0LnJhZGl1cz10aGlzLmdldFNpemUoUnQpLmxlbmd0aCgpKi41KSx0fWludGVyc2VjdCh0KXtyZXR1cm4gdGhpcy5taW4ubWF4KHQubWluKSx0aGlzLm1heC5taW4odC5tYXgpLHRoaXMuaXNFbXB0eSgpJiZ0aGlzLm1ha2VFbXB0eSgpLHRoaXN9dW5pb24odCl7cmV0dXJuIHRoaXMubWluLm1pbih0Lm1pbiksdGhpcy5tYXgubWF4KHQubWF4KSx0aGlzfWFwcGx5TWF0cml4NCh0KXtyZXR1cm4gdGhpcy5pc0VtcHR5KCk/dGhpczooR3RbMF0uc2V0KHRoaXMubWluLngsdGhpcy5taW4ueSx0aGlzLm1pbi56KS5hcHBseU1hdHJpeDQodCksR3RbMV0uc2V0KHRoaXMubWluLngsdGhpcy5taW4ueSx0aGlzLm1heC56KS5hcHBseU1hdHJpeDQodCksR3RbMl0uc2V0KHRoaXMubWluLngsdGhpcy5tYXgueSx0aGlzLm1pbi56KS5hcHBseU1hdHJpeDQodCksR3RbM10uc2V0KHRoaXMubWluLngsdGhpcy5tYXgueSx0aGlzLm1heC56KS5hcHBseU1hdHJpeDQodCksR3RbNF0uc2V0KHRoaXMubWF4LngsdGhpcy5taW4ueSx0aGlzLm1pbi56KS5hcHBseU1hdHJpeDQodCksR3RbNV0uc2V0KHRoaXMubWF4LngsdGhpcy5taW4ueSx0aGlzLm1heC56KS5hcHBseU1hdHJpeDQodCksR3RbNl0uc2V0KHRoaXMubWF4LngsdGhpcy5tYXgueSx0aGlzLm1pbi56KS5hcHBseU1hdHJpeDQodCksR3RbN10uc2V0KHRoaXMubWF4LngsdGhpcy5tYXgueSx0aGlzLm1heC56KS5hcHBseU1hdHJpeDQodCksdGhpcy5zZXRGcm9tUG9pbnRzKEd0KSx0aGlzKX10cmFuc2xhdGUodCl7cmV0dXJuIHRoaXMubWluLmFkZCh0KSx0aGlzLm1heC5hZGQodCksdGhpc31lcXVhbHModCl7cmV0dXJuIHQubWluLmVxdWFscyh0aGlzLm1pbikmJnQubWF4LmVxdWFscyh0aGlzLm1heCl9fWNvbnN0IEd0PVtuZXcgQSxuZXcgQSxuZXcgQSxuZXcgQSxuZXcgQSxuZXcgQSxuZXcgQSxuZXcgQV0sUnQ9bmV3IEEsRnM9bmV3IGh0LE5lPW5ldyBBLHdlPW5ldyBBLEFlPW5ldyBBLHRlPW5ldyBBLGVlPW5ldyBBLHVlPW5ldyBBLEtlPW5ldyBBLFJzPW5ldyBBLEJzPW5ldyBBLGxlPW5ldyBBO2Z1bmN0aW9uIEJuKHIsdCxlLHMsbil7Zm9yKGxldCBpPTAsbz1yLmxlbmd0aC0zO2k8PW87aSs9Myl7bGUuZnJvbUFycmF5KHIsaSk7Y29uc3QgYT1uLngqTWF0aC5hYnMobGUueCkrbi55Kk1hdGguYWJzKGxlLnkpK24ueipNYXRoLmFicyhsZS56KSxjPXQuZG90KGxlKSx1PWUuZG90KGxlKSxoPXMuZG90KGxlKTtpZihNYXRoLm1heCgtTWF0aC5tYXgoYyx1LGgpLE1hdGgubWluKGMsdSxoKSk+YSlyZXR1cm4hMX1yZXR1cm4hMH1jb25zdCBhYT1uZXcgaHQsdHM9bmV3IEEsSW49bmV3IEE7Y2xhc3MgY3J7Y29uc3RydWN0b3IodD1uZXcgQSxlPS0xKXt0aGlzLmlzU3BoZXJlPSEwLHRoaXMuY2VudGVyPXQsdGhpcy5yYWRpdXM9ZX1zZXQodCxlKXtyZXR1cm4gdGhpcy5jZW50ZXIuY29weSh0KSx0aGlzLnJhZGl1cz1lLHRoaXN9c2V0RnJvbVBvaW50cyh0LGUpe2NvbnN0IHM9dGhpcy5jZW50ZXI7ZSE9PXZvaWQgMD9zLmNvcHkoZSk6YWEuc2V0RnJvbVBvaW50cyh0KS5nZXRDZW50ZXIocyk7bGV0IG49MDtmb3IobGV0IGk9MCxvPXQubGVuZ3RoO2k8bztpKyspbj1NYXRoLm1heChuLHMuZGlzdGFuY2VUb1NxdWFyZWQodFtpXSkpO3JldHVybiB0aGlzLnJhZGl1cz1NYXRoLnNxcnQobiksdGhpc31jb3B5KHQpe3JldHVybiB0aGlzLmNlbnRlci5jb3B5KHQuY2VudGVyKSx0aGlzLnJhZGl1cz10LnJhZGl1cyx0aGlzfWlzRW1wdHkoKXtyZXR1cm4gdGhpcy5yYWRpdXM8MH1tYWtlRW1wdHkoKXtyZXR1cm4gdGhpcy5jZW50ZXIuc2V0KDAsMCwwKSx0aGlzLnJhZGl1cz0tMSx0aGlzfWNvbnRhaW5zUG9pbnQodCl7cmV0dXJuIHQuZGlzdGFuY2VUb1NxdWFyZWQodGhpcy5jZW50ZXIpPD10aGlzLnJhZGl1cyp0aGlzLnJhZGl1c31kaXN0YW5jZVRvUG9pbnQodCl7cmV0dXJuIHQuZGlzdGFuY2VUbyh0aGlzLmNlbnRlciktdGhpcy5yYWRpdXN9aW50ZXJzZWN0c1NwaGVyZSh0KXtjb25zdCBlPXRoaXMucmFkaXVzK3QucmFkaXVzO3JldHVybiB0LmNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCh0aGlzLmNlbnRlcik8PWUqZX1pbnRlcnNlY3RzQm94KHQpe3JldHVybiB0LmludGVyc2VjdHNTcGhlcmUodGhpcyl9aW50ZXJzZWN0c1BsYW5lKHQpe3JldHVybiBNYXRoLmFicyh0LmRpc3RhbmNlVG9Qb2ludCh0aGlzLmNlbnRlcikpPD10aGlzLnJhZGl1c31jbGFtcFBvaW50KHQsZSl7Y29uc3Qgcz10aGlzLmNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCh0KTtyZXR1cm4gZS5jb3B5KHQpLHM+dGhpcy5yYWRpdXMqdGhpcy5yYWRpdXMmJihlLnN1Yih0aGlzLmNlbnRlcikubm9ybWFsaXplKCksZS5tdWx0aXBseVNjYWxhcih0aGlzLnJhZGl1cykuYWRkKHRoaXMuY2VudGVyKSksZX1nZXRCb3VuZGluZ0JveCh0KXtyZXR1cm4gdGhpcy5pc0VtcHR5KCk/KHQubWFrZUVtcHR5KCksdCk6KHQuc2V0KHRoaXMuY2VudGVyLHRoaXMuY2VudGVyKSx0LmV4cGFuZEJ5U2NhbGFyKHRoaXMucmFkaXVzKSx0KX1hcHBseU1hdHJpeDQodCl7cmV0dXJuIHRoaXMuY2VudGVyLmFwcGx5TWF0cml4NCh0KSx0aGlzLnJhZGl1cz10aGlzLnJhZGl1cyp0LmdldE1heFNjYWxlT25BeGlzKCksdGhpc310cmFuc2xhdGUodCl7cmV0dXJuIHRoaXMuY2VudGVyLmFkZCh0KSx0aGlzfWV4cGFuZEJ5UG9pbnQodCl7aWYodGhpcy5pc0VtcHR5KCkpcmV0dXJuIHRoaXMuY2VudGVyLmNvcHkodCksdGhpcy5yYWRpdXM9MCx0aGlzO3RzLnN1YlZlY3RvcnModCx0aGlzLmNlbnRlcik7Y29uc3QgZT10cy5sZW5ndGhTcSgpO2lmKGU+dGhpcy5yYWRpdXMqdGhpcy5yYWRpdXMpe2NvbnN0IHM9TWF0aC5zcXJ0KGUpLG49KHMtdGhpcy5yYWRpdXMpKi41O3RoaXMuY2VudGVyLmFkZFNjYWxlZFZlY3Rvcih0cyxuL3MpLHRoaXMucmFkaXVzKz1ufXJldHVybiB0aGlzfXVuaW9uKHQpe3JldHVybiB0LmlzRW1wdHkoKT90aGlzOnRoaXMuaXNFbXB0eSgpPyh0aGlzLmNvcHkodCksdGhpcyk6KHRoaXMuY2VudGVyLmVxdWFscyh0LmNlbnRlcik9PT0hMD90aGlzLnJhZGl1cz1NYXRoLm1heCh0aGlzLnJhZGl1cyx0LnJhZGl1cyk6KEluLnN1YlZlY3RvcnModC5jZW50ZXIsdGhpcy5jZW50ZXIpLnNldExlbmd0aCh0LnJhZGl1cyksdGhpcy5leHBhbmRCeVBvaW50KHRzLmNvcHkodC5jZW50ZXIpLmFkZChJbikpLHRoaXMuZXhwYW5kQnlQb2ludCh0cy5jb3B5KHQuY2VudGVyKS5zdWIoSW4pKSksdGhpcyl9ZXF1YWxzKHQpe3JldHVybiB0LmNlbnRlci5lcXVhbHModGhpcy5jZW50ZXIpJiZ0LnJhZGl1cz09PXRoaXMucmFkaXVzfWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSh0aGlzKX19Y2xhc3MgbnR7Y29uc3RydWN0b3IodCxlLHMsbixpLG8sYSxjLHUsaCxsLGQsZixwLG0sZyl7bnQucHJvdG90eXBlLmlzTWF0cml4ND0hMCx0aGlzLmVsZW1lbnRzPVsxLDAsMCwwLDAsMSwwLDAsMCwwLDEsMCwwLDAsMCwxXSx0IT09dm9pZCAwJiZ0aGlzLnNldCh0LGUscyxuLGksbyxhLGMsdSxoLGwsZCxmLHAsbSxnKX1zZXQodCxlLHMsbixpLG8sYSxjLHUsaCxsLGQsZixwLG0sZyl7Y29uc3QgeT10aGlzLmVsZW1lbnRzO3JldHVybiB5WzBdPXQseVs0XT1lLHlbOF09cyx5WzEyXT1uLHlbMV09aSx5WzVdPW8seVs5XT1hLHlbMTNdPWMseVsyXT11LHlbNl09aCx5WzEwXT1sLHlbMTRdPWQseVszXT1mLHlbN109cCx5WzExXT1tLHlbMTVdPWcsdGhpc31pZGVudGl0eSgpe3JldHVybiB0aGlzLnNldCgxLDAsMCwwLDAsMSwwLDAsMCwwLDEsMCwwLDAsMCwxKSx0aGlzfWNsb25lKCl7cmV0dXJuIG5ldyBudCgpLmZyb21BcnJheSh0aGlzLmVsZW1lbnRzKX1jb3B5KHQpe2NvbnN0IGU9dGhpcy5lbGVtZW50cyxzPXQuZWxlbWVudHM7cmV0dXJuIGVbMF09c1swXSxlWzFdPXNbMV0sZVsyXT1zWzJdLGVbM109c1szXSxlWzRdPXNbNF0sZVs1XT1zWzVdLGVbNl09c1s2XSxlWzddPXNbN10sZVs4XT1zWzhdLGVbOV09c1s5XSxlWzEwXT1zWzEwXSxlWzExXT1zWzExXSxlWzEyXT1zWzEyXSxlWzEzXT1zWzEzXSxlWzE0XT1zWzE0XSxlWzE1XT1zWzE1XSx0aGlzfWNvcHlQb3NpdGlvbih0KXtjb25zdCBlPXRoaXMuZWxlbWVudHMscz10LmVsZW1lbnRzO3JldHVybiBlWzEyXT1zWzEyXSxlWzEzXT1zWzEzXSxlWzE0XT1zWzE0XSx0aGlzfXNldEZyb21NYXRyaXgzKHQpe2NvbnN0IGU9dC5lbGVtZW50cztyZXR1cm4gdGhpcy5zZXQoZVswXSxlWzNdLGVbNl0sMCxlWzFdLGVbNF0sZVs3XSwwLGVbMl0sZVs1XSxlWzhdLDAsMCwwLDAsMSksdGhpc31leHRyYWN0QmFzaXModCxlLHMpe3JldHVybiB0LnNldEZyb21NYXRyaXhDb2x1bW4odGhpcywwKSxlLnNldEZyb21NYXRyaXhDb2x1bW4odGhpcywxKSxzLnNldEZyb21NYXRyaXhDb2x1bW4odGhpcywyKSx0aGlzfW1ha2VCYXNpcyh0LGUscyl7cmV0dXJuIHRoaXMuc2V0KHQueCxlLngscy54LDAsdC55LGUueSxzLnksMCx0LnosZS56LHMueiwwLDAsMCwwLDEpLHRoaXN9ZXh0cmFjdFJvdGF0aW9uKHQpe2NvbnN0IGU9dGhpcy5lbGVtZW50cyxzPXQuZWxlbWVudHMsbj0xL01lLnNldEZyb21NYXRyaXhDb2x1bW4odCwwKS5sZW5ndGgoKSxpPTEvTWUuc2V0RnJvbU1hdHJpeENvbHVtbih0LDEpLmxlbmd0aCgpLG89MS9NZS5zZXRGcm9tTWF0cml4Q29sdW1uKHQsMikubGVuZ3RoKCk7cmV0dXJuIGVbMF09c1swXSpuLGVbMV09c1sxXSpuLGVbMl09c1syXSpuLGVbM109MCxlWzRdPXNbNF0qaSxlWzVdPXNbNV0qaSxlWzZdPXNbNl0qaSxlWzddPTAsZVs4XT1zWzhdKm8sZVs5XT1zWzldKm8sZVsxMF09c1sxMF0qbyxlWzExXT0wLGVbMTJdPTAsZVsxM109MCxlWzE0XT0wLGVbMTVdPTEsdGhpc31tYWtlUm90YXRpb25Gcm9tRXVsZXIodCl7Y29uc3QgZT10aGlzLmVsZW1lbnRzLHM9dC54LG49dC55LGk9dC56LG89TWF0aC5jb3MocyksYT1NYXRoLnNpbihzKSxjPU1hdGguY29zKG4pLHU9TWF0aC5zaW4obiksaD1NYXRoLmNvcyhpKSxsPU1hdGguc2luKGkpO2lmKHQub3JkZXI9PT0iWFlaIil7Y29uc3QgZD1vKmgsZj1vKmwscD1hKmgsbT1hKmw7ZVswXT1jKmgsZVs0XT0tYypsLGVbOF09dSxlWzFdPWYrcCp1LGVbNV09ZC1tKnUsZVs5XT0tYSpjLGVbMl09bS1kKnUsZVs2XT1wK2YqdSxlWzEwXT1vKmN9ZWxzZSBpZih0Lm9yZGVyPT09IllYWiIpe2NvbnN0IGQ9YypoLGY9YypsLHA9dSpoLG09dSpsO2VbMF09ZCttKmEsZVs0XT1wKmEtZixlWzhdPW8qdSxlWzFdPW8qbCxlWzVdPW8qaCxlWzldPS1hLGVbMl09ZiphLXAsZVs2XT1tK2QqYSxlWzEwXT1vKmN9ZWxzZSBpZih0Lm9yZGVyPT09IlpYWSIpe2NvbnN0IGQ9YypoLGY9YypsLHA9dSpoLG09dSpsO2VbMF09ZC1tKmEsZVs0XT0tbypsLGVbOF09cCtmKmEsZVsxXT1mK3AqYSxlWzVdPW8qaCxlWzldPW0tZCphLGVbMl09LW8qdSxlWzZdPWEsZVsxMF09bypjfWVsc2UgaWYodC5vcmRlcj09PSJaWVgiKXtjb25zdCBkPW8qaCxmPW8qbCxwPWEqaCxtPWEqbDtlWzBdPWMqaCxlWzRdPXAqdS1mLGVbOF09ZCp1K20sZVsxXT1jKmwsZVs1XT1tKnUrZCxlWzldPWYqdS1wLGVbMl09LXUsZVs2XT1hKmMsZVsxMF09bypjfWVsc2UgaWYodC5vcmRlcj09PSJZWlgiKXtjb25zdCBkPW8qYyxmPW8qdSxwPWEqYyxtPWEqdTtlWzBdPWMqaCxlWzRdPW0tZCpsLGVbOF09cCpsK2YsZVsxXT1sLGVbNV09bypoLGVbOV09LWEqaCxlWzJdPS11KmgsZVs2XT1mKmwrcCxlWzEwXT1kLW0qbH1lbHNlIGlmKHQub3JkZXI9PT0iWFpZIil7Y29uc3QgZD1vKmMsZj1vKnUscD1hKmMsbT1hKnU7ZVswXT1jKmgsZVs0XT0tbCxlWzhdPXUqaCxlWzFdPWQqbCttLGVbNV09bypoLGVbOV09ZipsLXAsZVsyXT1wKmwtZixlWzZdPWEqaCxlWzEwXT1tKmwrZH1yZXR1cm4gZVszXT0wLGVbN109MCxlWzExXT0wLGVbMTJdPTAsZVsxM109MCxlWzE0XT0wLGVbMTVdPTEsdGhpc31tYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbih0KXtyZXR1cm4gdGhpcy5jb21wb3NlKGNhLHQsaGEpfWxvb2tBdCh0LGUscyl7Y29uc3Qgbj10aGlzLmVsZW1lbnRzO3JldHVybiB5dC5zdWJWZWN0b3JzKHQsZSkseXQubGVuZ3RoU3EoKT09PTAmJih5dC56PTEpLHl0Lm5vcm1hbGl6ZSgpLHNlLmNyb3NzVmVjdG9ycyhzLHl0KSxzZS5sZW5ndGhTcSgpPT09MCYmKE1hdGguYWJzKHMueik9PT0xP3l0LngrPTFlLTQ6eXQueis9MWUtNCx5dC5ub3JtYWxpemUoKSxzZS5jcm9zc1ZlY3RvcnMocyx5dCkpLHNlLm5vcm1hbGl6ZSgpLElzLmNyb3NzVmVjdG9ycyh5dCxzZSksblswXT1zZS54LG5bNF09SXMueCxuWzhdPXl0LngsblsxXT1zZS55LG5bNV09SXMueSxuWzldPXl0LnksblsyXT1zZS56LG5bNl09SXMueixuWzEwXT15dC56LHRoaXN9bXVsdGlwbHkodCl7cmV0dXJuIHRoaXMubXVsdGlwbHlNYXRyaWNlcyh0aGlzLHQpfXByZW11bHRpcGx5KHQpe3JldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXModCx0aGlzKX1tdWx0aXBseU1hdHJpY2VzKHQsZSl7Y29uc3Qgcz10LmVsZW1lbnRzLG49ZS5lbGVtZW50cyxpPXRoaXMuZWxlbWVudHMsbz1zWzBdLGE9c1s0XSxjPXNbOF0sdT1zWzEyXSxoPXNbMV0sbD1zWzVdLGQ9c1s5XSxmPXNbMTNdLHA9c1syXSxtPXNbNl0sZz1zWzEwXSx5PXNbMTRdLFQ9c1szXSx3PXNbN10sTT1zWzExXSxOPXNbMTVdLF89blswXSxTPW5bNF0sRT1uWzhdLEY9blsxMl0sUj1uWzFdLEk9bls1XSxCPW5bOV0sUD1uWzEzXSxMPW5bMl0sVj1uWzZdLEc9blsxMF0sTnQ9blsxNF0sSHQ9blszXSxxdD1uWzddLE5uPW5bMTFdLHduPW5bMTVdO3JldHVybiBpWzBdPW8qXythKlIrYypMK3UqSHQsaVs0XT1vKlMrYSpJK2MqVit1KnF0LGlbOF09bypFK2EqQitjKkcrdSpObixpWzEyXT1vKkYrYSpQK2MqTnQrdSp3bixpWzFdPWgqXytsKlIrZCpMK2YqSHQsaVs1XT1oKlMrbCpJK2QqVitmKnF0LGlbOV09aCpFK2wqQitkKkcrZipObixpWzEzXT1oKkYrbCpQK2QqTnQrZip3bixpWzJdPXAqXyttKlIrZypMK3kqSHQsaVs2XT1wKlMrbSpJK2cqVit5KnF0LGlbMTBdPXAqRSttKkIrZypHK3kqTm4saVsxNF09cCpGK20qUCtnKk50K3kqd24saVszXT1UKl8rdypSK00qTCtOKkh0LGlbN109VCpTK3cqSStNKlYrTipxdCxpWzExXT1UKkUrdypCK00qRytOKk5uLGlbMTVdPVQqRit3KlArTSpOdCtOKnduLHRoaXN9bXVsdGlwbHlTY2FsYXIodCl7Y29uc3QgZT10aGlzLmVsZW1lbnRzO3JldHVybiBlWzBdKj10LGVbNF0qPXQsZVs4XSo9dCxlWzEyXSo9dCxlWzFdKj10LGVbNV0qPXQsZVs5XSo9dCxlWzEzXSo9dCxlWzJdKj10LGVbNl0qPXQsZVsxMF0qPXQsZVsxNF0qPXQsZVszXSo9dCxlWzddKj10LGVbMTFdKj10LGVbMTVdKj10LHRoaXN9ZGV0ZXJtaW5hbnQoKXtjb25zdCB0PXRoaXMuZWxlbWVudHMsZT10WzBdLHM9dFs0XSxuPXRbOF0saT10WzEyXSxvPXRbMV0sYT10WzVdLGM9dFs5XSx1PXRbMTNdLGg9dFsyXSxsPXRbNl0sZD10WzEwXSxmPXRbMTRdLHA9dFszXSxtPXRbN10sZz10WzExXSx5PXRbMTVdO3JldHVybiBwKigraSpjKmwtbip1KmwtaSphKmQrcyp1KmQrbiphKmYtcypjKmYpK20qKCtlKmMqZi1lKnUqZCtpKm8qZC1uKm8qZituKnUqaC1pKmMqaCkrZyooK2UqdSpsLWUqYSpmLWkqbypsK3MqbypmK2kqYSpoLXMqdSpoKSt5KigtbiphKmgtZSpjKmwrZSphKmQrbipvKmwtcypvKmQrcypjKmgpfXRyYW5zcG9zZSgpe2NvbnN0IHQ9dGhpcy5lbGVtZW50cztsZXQgZTtyZXR1cm4gZT10WzFdLHRbMV09dFs0XSx0WzRdPWUsZT10WzJdLHRbMl09dFs4XSx0WzhdPWUsZT10WzZdLHRbNl09dFs5XSx0WzldPWUsZT10WzNdLHRbM109dFsxMl0sdFsxMl09ZSxlPXRbN10sdFs3XT10WzEzXSx0WzEzXT1lLGU9dFsxMV0sdFsxMV09dFsxNF0sdFsxNF09ZSx0aGlzfXNldFBvc2l0aW9uKHQsZSxzKXtjb25zdCBuPXRoaXMuZWxlbWVudHM7cmV0dXJuIHQuaXNWZWN0b3IzPyhuWzEyXT10LngsblsxM109dC55LG5bMTRdPXQueik6KG5bMTJdPXQsblsxM109ZSxuWzE0XT1zKSx0aGlzfWludmVydCgpe2NvbnN0IHQ9dGhpcy5lbGVtZW50cyxlPXRbMF0scz10WzFdLG49dFsyXSxpPXRbM10sbz10WzRdLGE9dFs1XSxjPXRbNl0sdT10WzddLGg9dFs4XSxsPXRbOV0sZD10WzEwXSxmPXRbMTFdLHA9dFsxMl0sbT10WzEzXSxnPXRbMTRdLHk9dFsxNV0sVD1sKmcqdS1tKmQqdSttKmMqZi1hKmcqZi1sKmMqeSthKmQqeSx3PXAqZCp1LWgqZyp1LXAqYypmK28qZypmK2gqYyp5LW8qZCp5LE09aCptKnUtcCpsKnUrcCphKmYtbyptKmYtaCphKnkrbypsKnksTj1wKmwqYy1oKm0qYy1wKmEqZCtvKm0qZCtoKmEqZy1vKmwqZyxfPWUqVCtzKncrbipNK2kqTjtpZihfPT09MClyZXR1cm4gdGhpcy5zZXQoMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCk7Y29uc3QgUz0xL187cmV0dXJuIHRbMF09VCpTLHRbMV09KG0qZCppLWwqZyppLW0qbipmK3MqZypmK2wqbip5LXMqZCp5KSpTLHRbMl09KGEqZyppLW0qYyppK20qbip1LXMqZyp1LWEqbip5K3MqYyp5KSpTLHRbM109KGwqYyppLWEqZCppLWwqbip1K3MqZCp1K2EqbipmLXMqYypmKSpTLHRbNF09dypTLHRbNV09KGgqZyppLXAqZCppK3AqbipmLWUqZypmLWgqbip5K2UqZCp5KSpTLHRbNl09KHAqYyppLW8qZyppLXAqbip1K2UqZyp1K28qbip5LWUqYyp5KSpTLHRbN109KG8qZCppLWgqYyppK2gqbip1LWUqZCp1LW8qbipmK2UqYypmKSpTLHRbOF09TSpTLHRbOV09KHAqbCppLWgqbSppLXAqcypmK2UqbSpmK2gqcyp5LWUqbCp5KSpTLHRbMTBdPShvKm0qaS1wKmEqaStwKnMqdS1lKm0qdS1vKnMqeStlKmEqeSkqUyx0WzExXT0oaCphKmktbypsKmktaCpzKnUrZSpsKnUrbypzKmYtZSphKmYpKlMsdFsxMl09TipTLHRbMTNdPShoKm0qbi1wKmwqbitwKnMqZC1lKm0qZC1oKnMqZytlKmwqZykqUyx0WzE0XT0ocCphKm4tbyptKm4tcCpzKmMrZSptKmMrbypzKmctZSphKmcpKlMsdFsxNV09KG8qbCpuLWgqYSpuK2gqcypjLWUqbCpjLW8qcypkK2UqYSpkKSpTLHRoaXN9c2NhbGUodCl7Y29uc3QgZT10aGlzLmVsZW1lbnRzLHM9dC54LG49dC55LGk9dC56O3JldHVybiBlWzBdKj1zLGVbNF0qPW4sZVs4XSo9aSxlWzFdKj1zLGVbNV0qPW4sZVs5XSo9aSxlWzJdKj1zLGVbNl0qPW4sZVsxMF0qPWksZVszXSo9cyxlWzddKj1uLGVbMTFdKj1pLHRoaXN9Z2V0TWF4U2NhbGVPbkF4aXMoKXtjb25zdCB0PXRoaXMuZWxlbWVudHMsZT10WzBdKnRbMF0rdFsxXSp0WzFdK3RbMl0qdFsyXSxzPXRbNF0qdFs0XSt0WzVdKnRbNV0rdFs2XSp0WzZdLG49dFs4XSp0WzhdK3RbOV0qdFs5XSt0WzEwXSp0WzEwXTtyZXR1cm4gTWF0aC5zcXJ0KE1hdGgubWF4KGUscyxuKSl9bWFrZVRyYW5zbGF0aW9uKHQsZSxzKXtyZXR1cm4gdC5pc1ZlY3RvcjM/dGhpcy5zZXQoMSwwLDAsdC54LDAsMSwwLHQueSwwLDAsMSx0LnosMCwwLDAsMSk6dGhpcy5zZXQoMSwwLDAsdCwwLDEsMCxlLDAsMCwxLHMsMCwwLDAsMSksdGhpc31tYWtlUm90YXRpb25YKHQpe2NvbnN0IGU9TWF0aC5jb3ModCkscz1NYXRoLnNpbih0KTtyZXR1cm4gdGhpcy5zZXQoMSwwLDAsMCwwLGUsLXMsMCwwLHMsZSwwLDAsMCwwLDEpLHRoaXN9bWFrZVJvdGF0aW9uWSh0KXtjb25zdCBlPU1hdGguY29zKHQpLHM9TWF0aC5zaW4odCk7cmV0dXJuIHRoaXMuc2V0KGUsMCxzLDAsMCwxLDAsMCwtcywwLGUsMCwwLDAsMCwxKSx0aGlzfW1ha2VSb3RhdGlvbloodCl7Y29uc3QgZT1NYXRoLmNvcyh0KSxzPU1hdGguc2luKHQpO3JldHVybiB0aGlzLnNldChlLC1zLDAsMCxzLGUsMCwwLDAsMCwxLDAsMCwwLDAsMSksdGhpc31tYWtlUm90YXRpb25BeGlzKHQsZSl7Y29uc3Qgcz1NYXRoLmNvcyhlKSxuPU1hdGguc2luKGUpLGk9MS1zLG89dC54LGE9dC55LGM9dC56LHU9aSpvLGg9aSphO3JldHVybiB0aGlzLnNldCh1Km8rcyx1KmEtbipjLHUqYytuKmEsMCx1KmErbipjLGgqYStzLGgqYy1uKm8sMCx1KmMtbiphLGgqYytuKm8saSpjKmMrcywwLDAsMCwwLDEpLHRoaXN9bWFrZVNjYWxlKHQsZSxzKXtyZXR1cm4gdGhpcy5zZXQodCwwLDAsMCwwLGUsMCwwLDAsMCxzLDAsMCwwLDAsMSksdGhpc31tYWtlU2hlYXIodCxlLHMsbixpLG8pe3JldHVybiB0aGlzLnNldCgxLHMsaSwwLHQsMSxvLDAsZSxuLDEsMCwwLDAsMCwxKSx0aGlzfWNvbXBvc2UodCxlLHMpe2NvbnN0IG49dGhpcy5lbGVtZW50cyxpPWUuX3gsbz1lLl95LGE9ZS5feixjPWUuX3csdT1pK2ksaD1vK28sbD1hK2EsZD1pKnUsZj1pKmgscD1pKmwsbT1vKmgsZz1vKmwseT1hKmwsVD1jKnUsdz1jKmgsTT1jKmwsTj1zLngsXz1zLnksUz1zLno7cmV0dXJuIG5bMF09KDEtKG0reSkpKk4sblsxXT0oZitNKSpOLG5bMl09KHAtdykqTixuWzNdPTAsbls0XT0oZi1NKSpfLG5bNV09KDEtKGQreSkpKl8sbls2XT0oZytUKSpfLG5bN109MCxuWzhdPShwK3cpKlMsbls5XT0oZy1UKSpTLG5bMTBdPSgxLShkK20pKSpTLG5bMTFdPTAsblsxMl09dC54LG5bMTNdPXQueSxuWzE0XT10LnosblsxNV09MSx0aGlzfWRlY29tcG9zZSh0LGUscyl7Y29uc3Qgbj10aGlzLmVsZW1lbnRzO2xldCBpPU1lLnNldChuWzBdLG5bMV0sblsyXSkubGVuZ3RoKCk7Y29uc3Qgbz1NZS5zZXQobls0XSxuWzVdLG5bNl0pLmxlbmd0aCgpLGE9TWUuc2V0KG5bOF0sbls5XSxuWzEwXSkubGVuZ3RoKCk7dGhpcy5kZXRlcm1pbmFudCgpPDAmJihpPS1pKSx0Lng9blsxMl0sdC55PW5bMTNdLHQuej1uWzE0XSxCdC5jb3B5KHRoaXMpO2NvbnN0IHU9MS9pLGg9MS9vLGw9MS9hO3JldHVybiBCdC5lbGVtZW50c1swXSo9dSxCdC5lbGVtZW50c1sxXSo9dSxCdC5lbGVtZW50c1syXSo9dSxCdC5lbGVtZW50c1s0XSo9aCxCdC5lbGVtZW50c1s1XSo9aCxCdC5lbGVtZW50c1s2XSo9aCxCdC5lbGVtZW50c1s4XSo9bCxCdC5lbGVtZW50c1s5XSo9bCxCdC5lbGVtZW50c1sxMF0qPWwsZS5zZXRGcm9tUm90YXRpb25NYXRyaXgoQnQpLHMueD1pLHMueT1vLHMuej1hLHRoaXN9bWFrZVBlcnNwZWN0aXZlKHQsZSxzLG4saSxvLGE9WWUpe2NvbnN0IGM9dGhpcy5lbGVtZW50cyx1PTIqaS8oZS10KSxoPTIqaS8ocy1uKSxsPShlK3QpLyhlLXQpLGQ9KHMrbikvKHMtbik7bGV0IGYscDtpZihhPT09WWUpZj0tKG8raSkvKG8taSkscD0tMipvKmkvKG8taSk7ZWxzZSBpZihhPT09em4pZj0tby8oby1pKSxwPS1vKmkvKG8taSk7ZWxzZSB0aHJvdyBuZXcgRXJyb3IoIlRIUkVFLk1hdHJpeDQubWFrZVBlcnNwZWN0aXZlKCk6IEludmFsaWQgY29vcmRpbmF0ZSBzeXN0ZW06ICIrYSk7cmV0dXJuIGNbMF09dSxjWzRdPTAsY1s4XT1sLGNbMTJdPTAsY1sxXT0wLGNbNV09aCxjWzldPWQsY1sxM109MCxjWzJdPTAsY1s2XT0wLGNbMTBdPWYsY1sxNF09cCxjWzNdPTAsY1s3XT0wLGNbMTFdPS0xLGNbMTVdPTAsdGhpc31tYWtlT3J0aG9ncmFwaGljKHQsZSxzLG4saSxvLGE9WWUpe2NvbnN0IGM9dGhpcy5lbGVtZW50cyx1PTEvKGUtdCksaD0xLyhzLW4pLGw9MS8oby1pKSxkPShlK3QpKnUsZj0ocytuKSpoO2xldCBwLG07aWYoYT09PVllKXA9KG8raSkqbCxtPS0yKmw7ZWxzZSBpZihhPT09em4pcD1pKmwsbT0tMSpsO2Vsc2UgdGhyb3cgbmV3IEVycm9yKCJUSFJFRS5NYXRyaXg0Lm1ha2VPcnRob2dyYXBoaWMoKTogSW52YWxpZCBjb29yZGluYXRlIHN5c3RlbTogIithKTtyZXR1cm4gY1swXT0yKnUsY1s0XT0wLGNbOF09MCxjWzEyXT0tZCxjWzFdPTAsY1s1XT0yKmgsY1s5XT0wLGNbMTNdPS1mLGNbMl09MCxjWzZdPTAsY1sxMF09bSxjWzE0XT0tcCxjWzNdPTAsY1s3XT0wLGNbMTFdPTAsY1sxNV09MSx0aGlzfWVxdWFscyh0KXtjb25zdCBlPXRoaXMuZWxlbWVudHMscz10LmVsZW1lbnRzO2ZvcihsZXQgbj0wO248MTY7bisrKWlmKGVbbl0hPT1zW25dKXJldHVybiExO3JldHVybiEwfWZyb21BcnJheSh0LGU9MCl7Zm9yKGxldCBzPTA7czwxNjtzKyspdGhpcy5lbGVtZW50c1tzXT10W3MrZV07cmV0dXJuIHRoaXN9dG9BcnJheSh0PVtdLGU9MCl7Y29uc3Qgcz10aGlzLmVsZW1lbnRzO3JldHVybiB0W2VdPXNbMF0sdFtlKzFdPXNbMV0sdFtlKzJdPXNbMl0sdFtlKzNdPXNbM10sdFtlKzRdPXNbNF0sdFtlKzVdPXNbNV0sdFtlKzZdPXNbNl0sdFtlKzddPXNbN10sdFtlKzhdPXNbOF0sdFtlKzldPXNbOV0sdFtlKzEwXT1zWzEwXSx0W2UrMTFdPXNbMTFdLHRbZSsxMl09c1sxMl0sdFtlKzEzXT1zWzEzXSx0W2UrMTRdPXNbMTRdLHRbZSsxNV09c1sxNV0sdH19Y29uc3QgTWU9bmV3IEEsQnQ9bmV3IG50LGNhPW5ldyBBKDAsMCwwKSxoYT1uZXcgQSgxLDEsMSksc2U9bmV3IEEsSXM9bmV3IEEseXQ9bmV3IEEsaHI9bmV3IG50LHVyPW5ldyBRZTtjbGFzcyB2c3tjb25zdHJ1Y3Rvcih0PTAsZT0wLHM9MCxuPXZzLkRFRkFVTFRfT1JERVIpe3RoaXMuaXNFdWxlcj0hMCx0aGlzLl94PXQsdGhpcy5feT1lLHRoaXMuX3o9cyx0aGlzLl9vcmRlcj1ufWdldCB4KCl7cmV0dXJuIHRoaXMuX3h9c2V0IHgodCl7dGhpcy5feD10LHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKX1nZXQgeSgpe3JldHVybiB0aGlzLl95fXNldCB5KHQpe3RoaXMuX3k9dCx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCl9Z2V0IHooKXtyZXR1cm4gdGhpcy5fen1zZXQgeih0KXt0aGlzLl96PXQsdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpfWdldCBvcmRlcigpe3JldHVybiB0aGlzLl9vcmRlcn1zZXQgb3JkZXIodCl7dGhpcy5fb3JkZXI9dCx0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCl9c2V0KHQsZSxzLG49dGhpcy5fb3JkZXIpe3JldHVybiB0aGlzLl94PXQsdGhpcy5feT1lLHRoaXMuX3o9cyx0aGlzLl9vcmRlcj1uLHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMuX3gsdGhpcy5feSx0aGlzLl96LHRoaXMuX29yZGVyKX1jb3B5KHQpe3JldHVybiB0aGlzLl94PXQuX3gsdGhpcy5feT10Ll95LHRoaXMuX3o9dC5feix0aGlzLl9vcmRlcj10Ll9vcmRlcix0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCksdGhpc31zZXRGcm9tUm90YXRpb25NYXRyaXgodCxlPXRoaXMuX29yZGVyLHM9ITApe2NvbnN0IG49dC5lbGVtZW50cyxpPW5bMF0sbz1uWzRdLGE9bls4XSxjPW5bMV0sdT1uWzVdLGg9bls5XSxsPW5bMl0sZD1uWzZdLGY9blsxMF07c3dpdGNoKGUpe2Nhc2UiWFlaIjp0aGlzLl95PU1hdGguYXNpbihhdChhLC0xLDEpKSxNYXRoLmFicyhhKTwuOTk5OTk5OT8odGhpcy5feD1NYXRoLmF0YW4yKC1oLGYpLHRoaXMuX3o9TWF0aC5hdGFuMigtbyxpKSk6KHRoaXMuX3g9TWF0aC5hdGFuMihkLHUpLHRoaXMuX3o9MCk7YnJlYWs7Y2FzZSJZWFoiOnRoaXMuX3g9TWF0aC5hc2luKC1hdChoLC0xLDEpKSxNYXRoLmFicyhoKTwuOTk5OTk5OT8odGhpcy5feT1NYXRoLmF0YW4yKGEsZiksdGhpcy5fej1NYXRoLmF0YW4yKGMsdSkpOih0aGlzLl95PU1hdGguYXRhbjIoLWwsaSksdGhpcy5fej0wKTticmVhaztjYXNlIlpYWSI6dGhpcy5feD1NYXRoLmFzaW4oYXQoZCwtMSwxKSksTWF0aC5hYnMoZCk8Ljk5OTk5OTk/KHRoaXMuX3k9TWF0aC5hdGFuMigtbCxmKSx0aGlzLl96PU1hdGguYXRhbjIoLW8sdSkpOih0aGlzLl95PTAsdGhpcy5fej1NYXRoLmF0YW4yKGMsaSkpO2JyZWFrO2Nhc2UiWllYIjp0aGlzLl95PU1hdGguYXNpbigtYXQobCwtMSwxKSksTWF0aC5hYnMobCk8Ljk5OTk5OTk/KHRoaXMuX3g9TWF0aC5hdGFuMihkLGYpLHRoaXMuX3o9TWF0aC5hdGFuMihjLGkpKToodGhpcy5feD0wLHRoaXMuX3o9TWF0aC5hdGFuMigtbyx1KSk7YnJlYWs7Y2FzZSJZWlgiOnRoaXMuX3o9TWF0aC5hc2luKGF0KGMsLTEsMSkpLE1hdGguYWJzKGMpPC45OTk5OTk5Pyh0aGlzLl94PU1hdGguYXRhbjIoLWgsdSksdGhpcy5feT1NYXRoLmF0YW4yKC1sLGkpKToodGhpcy5feD0wLHRoaXMuX3k9TWF0aC5hdGFuMihhLGYpKTticmVhaztjYXNlIlhaWSI6dGhpcy5fej1NYXRoLmFzaW4oLWF0KG8sLTEsMSkpLE1hdGguYWJzKG8pPC45OTk5OTk5Pyh0aGlzLl94PU1hdGguYXRhbjIoZCx1KSx0aGlzLl95PU1hdGguYXRhbjIoYSxpKSk6KHRoaXMuX3g9TWF0aC5hdGFuMigtaCxmKSx0aGlzLl95PTApO2JyZWFrO2RlZmF1bHQ6Y29uc29sZS53YXJuKCJUSFJFRS5FdWxlcjogLnNldEZyb21Sb3RhdGlvbk1hdHJpeCgpIGVuY291bnRlcmVkIGFuIHVua25vd24gb3JkZXI6ICIrZSl9cmV0dXJuIHRoaXMuX29yZGVyPWUscz09PSEwJiZ0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCksdGhpc31zZXRGcm9tUXVhdGVybmlvbih0LGUscyl7cmV0dXJuIGhyLm1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKHQpLHRoaXMuc2V0RnJvbVJvdGF0aW9uTWF0cml4KGhyLGUscyl9c2V0RnJvbVZlY3RvcjModCxlPXRoaXMuX29yZGVyKXtyZXR1cm4gdGhpcy5zZXQodC54LHQueSx0LnosZSl9cmVvcmRlcih0KXtyZXR1cm4gdXIuc2V0RnJvbUV1bGVyKHRoaXMpLHRoaXMuc2V0RnJvbVF1YXRlcm5pb24odXIsdCl9ZXF1YWxzKHQpe3JldHVybiB0Ll94PT09dGhpcy5feCYmdC5feT09PXRoaXMuX3kmJnQuX3o9PT10aGlzLl96JiZ0Ll9vcmRlcj09PXRoaXMuX29yZGVyfWZyb21BcnJheSh0KXtyZXR1cm4gdGhpcy5feD10WzBdLHRoaXMuX3k9dFsxXSx0aGlzLl96PXRbMl0sdFszXSE9PXZvaWQgMCYmKHRoaXMuX29yZGVyPXRbM10pLHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfXRvQXJyYXkodD1bXSxlPTApe3JldHVybiB0W2VdPXRoaXMuX3gsdFtlKzFdPXRoaXMuX3ksdFtlKzJdPXRoaXMuX3osdFtlKzNdPXRoaXMuX29yZGVyLHR9X29uQ2hhbmdlKHQpe3JldHVybiB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrPXQsdGhpc31fb25DaGFuZ2VDYWxsYmFjaygpe30qW1N5bWJvbC5pdGVyYXRvcl0oKXt5aWVsZCB0aGlzLl94LHlpZWxkIHRoaXMuX3kseWllbGQgdGhpcy5feix5aWVsZCB0aGlzLl9vcmRlcn19dnMuREVGQVVMVF9PUkRFUj0iWFlaIjtjbGFzcyB1YXtjb25zdHJ1Y3Rvcigpe3RoaXMubWFzaz0xfXNldCh0KXt0aGlzLm1hc2s9KDE8PHR8MCk+Pj4wfWVuYWJsZSh0KXt0aGlzLm1hc2t8PTE8PHR8MH1lbmFibGVBbGwoKXt0aGlzLm1hc2s9LTF9dG9nZ2xlKHQpe3RoaXMubWFza149MTw8dHwwfWRpc2FibGUodCl7dGhpcy5tYXNrJj1+KDE8PHR8MCl9ZGlzYWJsZUFsbCgpe3RoaXMubWFzaz0wfXRlc3QodCl7cmV0dXJuKHRoaXMubWFzayZ0Lm1hc2spIT09MH1pc0VuYWJsZWQodCl7cmV0dXJuKHRoaXMubWFzayYoMTw8dHwwKSkhPT0wfX1sZXQgbGE9MDtjb25zdCBscj1uZXcgQSxTZT1uZXcgUWUsV3Q9bmV3IG50LFBzPW5ldyBBLGVzPW5ldyBBLGRhPW5ldyBBLGZhPW5ldyBRZSxkcj1uZXcgQSgxLDAsMCksZnI9bmV3IEEoMCwxLDApLHByPW5ldyBBKDAsMCwxKSxtcj17dHlwZToiYWRkZWQifSxwYT17dHlwZToicmVtb3ZlZCJ9LF9lPXt0eXBlOiJjaGlsZGFkZGVkIixjaGlsZDpudWxsfSx2bj17dHlwZToiY2hpbGRyZW1vdmVkIixjaGlsZDpudWxsfTtjbGFzcyBuZSBleHRlbmRzIFple2NvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLmlzT2JqZWN0M0Q9ITAsT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsImlkIix7dmFsdWU6bGErK30pLHRoaXMudXVpZD1LdCgpLHRoaXMubmFtZT0iIix0aGlzLnR5cGU9Ik9iamVjdDNEIix0aGlzLnBhcmVudD1udWxsLHRoaXMuY2hpbGRyZW49W10sdGhpcy51cD1uZS5ERUZBVUxUX1VQLmNsb25lKCk7Y29uc3QgdD1uZXcgQSxlPW5ldyB2cyxzPW5ldyBRZSxuPW5ldyBBKDEsMSwxKTtmdW5jdGlvbiBpKCl7cy5zZXRGcm9tRXVsZXIoZSwhMSl9ZnVuY3Rpb24gbygpe2Uuc2V0RnJvbVF1YXRlcm5pb24ocyx2b2lkIDAsITEpfWUuX29uQ2hhbmdlKGkpLHMuX29uQ2hhbmdlKG8pLE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMse3Bvc2l0aW9uOntjb25maWd1cmFibGU6ITAsZW51bWVyYWJsZTohMCx2YWx1ZTp0fSxyb3RhdGlvbjp7Y29uZmlndXJhYmxlOiEwLGVudW1lcmFibGU6ITAsdmFsdWU6ZX0scXVhdGVybmlvbjp7Y29uZmlndXJhYmxlOiEwLGVudW1lcmFibGU6ITAsdmFsdWU6c30sc2NhbGU6e2NvbmZpZ3VyYWJsZTohMCxlbnVtZXJhYmxlOiEwLHZhbHVlOm59LG1vZGVsVmlld01hdHJpeDp7dmFsdWU6bmV3IG50fSxub3JtYWxNYXRyaXg6e3ZhbHVlOm5ldyBDdH19KSx0aGlzLm1hdHJpeD1uZXcgbnQsdGhpcy5tYXRyaXhXb3JsZD1uZXcgbnQsdGhpcy5tYXRyaXhBdXRvVXBkYXRlPW5lLkRFRkFVTFRfTUFUUklYX0FVVE9fVVBEQVRFLHRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlPW5lLkRFRkFVTFRfTUFUUklYX1dPUkxEX0FVVE9fVVBEQVRFLHRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZT0hMSx0aGlzLmxheWVycz1uZXcgdWEsdGhpcy52aXNpYmxlPSEwLHRoaXMuY2FzdFNoYWRvdz0hMSx0aGlzLnJlY2VpdmVTaGFkb3c9ITEsdGhpcy5mcnVzdHVtQ3VsbGVkPSEwLHRoaXMucmVuZGVyT3JkZXI9MCx0aGlzLmFuaW1hdGlvbnM9W10sdGhpcy51c2VyRGF0YT17fX1vbkJlZm9yZVNoYWRvdygpe31vbkFmdGVyU2hhZG93KCl7fW9uQmVmb3JlUmVuZGVyKCl7fW9uQWZ0ZXJSZW5kZXIoKXt9YXBwbHlNYXRyaXg0KHQpe3RoaXMubWF0cml4QXV0b1VwZGF0ZSYmdGhpcy51cGRhdGVNYXRyaXgoKSx0aGlzLm1hdHJpeC5wcmVtdWx0aXBseSh0KSx0aGlzLm1hdHJpeC5kZWNvbXBvc2UodGhpcy5wb3NpdGlvbix0aGlzLnF1YXRlcm5pb24sdGhpcy5zY2FsZSl9YXBwbHlRdWF0ZXJuaW9uKHQpe3JldHVybiB0aGlzLnF1YXRlcm5pb24ucHJlbXVsdGlwbHkodCksdGhpc31zZXRSb3RhdGlvbkZyb21BeGlzQW5nbGUodCxlKXt0aGlzLnF1YXRlcm5pb24uc2V0RnJvbUF4aXNBbmdsZSh0LGUpfXNldFJvdGF0aW9uRnJvbUV1bGVyKHQpe3RoaXMucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIodCwhMCl9c2V0Um90YXRpb25Gcm9tTWF0cml4KHQpe3RoaXMucXVhdGVybmlvbi5zZXRGcm9tUm90YXRpb25NYXRyaXgodCl9c2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0KXt0aGlzLnF1YXRlcm5pb24uY29weSh0KX1yb3RhdGVPbkF4aXModCxlKXtyZXR1cm4gU2Uuc2V0RnJvbUF4aXNBbmdsZSh0LGUpLHRoaXMucXVhdGVybmlvbi5tdWx0aXBseShTZSksdGhpc31yb3RhdGVPbldvcmxkQXhpcyh0LGUpe3JldHVybiBTZS5zZXRGcm9tQXhpc0FuZ2xlKHQsZSksdGhpcy5xdWF0ZXJuaW9uLnByZW11bHRpcGx5KFNlKSx0aGlzfXJvdGF0ZVgodCl7cmV0dXJuIHRoaXMucm90YXRlT25BeGlzKGRyLHQpfXJvdGF0ZVkodCl7cmV0dXJuIHRoaXMucm90YXRlT25BeGlzKGZyLHQpfXJvdGF0ZVoodCl7cmV0dXJuIHRoaXMucm90YXRlT25BeGlzKHByLHQpfXRyYW5zbGF0ZU9uQXhpcyh0LGUpe3JldHVybiBsci5jb3B5KHQpLmFwcGx5UXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pLHRoaXMucG9zaXRpb24uYWRkKGxyLm11bHRpcGx5U2NhbGFyKGUpKSx0aGlzfXRyYW5zbGF0ZVgodCl7cmV0dXJuIHRoaXMudHJhbnNsYXRlT25BeGlzKGRyLHQpfXRyYW5zbGF0ZVkodCl7cmV0dXJuIHRoaXMudHJhbnNsYXRlT25BeGlzKGZyLHQpfXRyYW5zbGF0ZVoodCl7cmV0dXJuIHRoaXMudHJhbnNsYXRlT25BeGlzKHByLHQpfWxvY2FsVG9Xb3JsZCh0KXtyZXR1cm4gdGhpcy51cGRhdGVXb3JsZE1hdHJpeCghMCwhMSksdC5hcHBseU1hdHJpeDQodGhpcy5tYXRyaXhXb3JsZCl9d29ybGRUb0xvY2FsKHQpe3JldHVybiB0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCEwLCExKSx0LmFwcGx5TWF0cml4NChXdC5jb3B5KHRoaXMubWF0cml4V29ybGQpLmludmVydCgpKX1sb29rQXQodCxlLHMpe3QuaXNWZWN0b3IzP1BzLmNvcHkodCk6UHMuc2V0KHQsZSxzKTtjb25zdCBuPXRoaXMucGFyZW50O3RoaXMudXBkYXRlV29ybGRNYXRyaXgoITAsITEpLGVzLnNldEZyb21NYXRyaXhQb3NpdGlvbih0aGlzLm1hdHJpeFdvcmxkKSx0aGlzLmlzQ2FtZXJhfHx0aGlzLmlzTGlnaHQ/V3QubG9va0F0KGVzLFBzLHRoaXMudXApOld0Lmxvb2tBdChQcyxlcyx0aGlzLnVwKSx0aGlzLnF1YXRlcm5pb24uc2V0RnJvbVJvdGF0aW9uTWF0cml4KFd0KSxuJiYoV3QuZXh0cmFjdFJvdGF0aW9uKG4ubWF0cml4V29ybGQpLFNlLnNldEZyb21Sb3RhdGlvbk1hdHJpeChXdCksdGhpcy5xdWF0ZXJuaW9uLnByZW11bHRpcGx5KFNlLmludmVydCgpKSl9YWRkKHQpe2lmKGFyZ3VtZW50cy5sZW5ndGg+MSl7Zm9yKGxldCBlPTA7ZTxhcmd1bWVudHMubGVuZ3RoO2UrKyl0aGlzLmFkZChhcmd1bWVudHNbZV0pO3JldHVybiB0aGlzfXJldHVybiB0PT09dGhpcz8oY29uc29sZS5lcnJvcigiVEhSRUUuT2JqZWN0M0QuYWRkOiBvYmplY3QgY2FuJ3QgYmUgYWRkZWQgYXMgYSBjaGlsZCBvZiBpdHNlbGYuIix0KSx0aGlzKToodCYmdC5pc09iamVjdDNEPyh0LnJlbW92ZUZyb21QYXJlbnQoKSx0LnBhcmVudD10aGlzLHRoaXMuY2hpbGRyZW4ucHVzaCh0KSx0LmRpc3BhdGNoRXZlbnQobXIpLF9lLmNoaWxkPXQsdGhpcy5kaXNwYXRjaEV2ZW50KF9lKSxfZS5jaGlsZD1udWxsKTpjb25zb2xlLmVycm9yKCJUSFJFRS5PYmplY3QzRC5hZGQ6IG9iamVjdCBub3QgYW4gaW5zdGFuY2Ugb2YgVEhSRUUuT2JqZWN0M0QuIix0KSx0aGlzKX1yZW1vdmUodCl7aWYoYXJndW1lbnRzLmxlbmd0aD4xKXtmb3IobGV0IHM9MDtzPGFyZ3VtZW50cy5sZW5ndGg7cysrKXRoaXMucmVtb3ZlKGFyZ3VtZW50c1tzXSk7cmV0dXJuIHRoaXN9Y29uc3QgZT10aGlzLmNoaWxkcmVuLmluZGV4T2YodCk7cmV0dXJuIGUhPT0tMSYmKHQucGFyZW50PW51bGwsdGhpcy5jaGlsZHJlbi5zcGxpY2UoZSwxKSx0LmRpc3BhdGNoRXZlbnQocGEpLHZuLmNoaWxkPXQsdGhpcy5kaXNwYXRjaEV2ZW50KHZuKSx2bi5jaGlsZD1udWxsKSx0aGlzfXJlbW92ZUZyb21QYXJlbnQoKXtjb25zdCB0PXRoaXMucGFyZW50O3JldHVybiB0IT09bnVsbCYmdC5yZW1vdmUodGhpcyksdGhpc31jbGVhcigpe3JldHVybiB0aGlzLnJlbW92ZSguLi50aGlzLmNoaWxkcmVuKX1hdHRhY2godCl7cmV0dXJuIHRoaXMudXBkYXRlV29ybGRNYXRyaXgoITAsITEpLFd0LmNvcHkodGhpcy5tYXRyaXhXb3JsZCkuaW52ZXJ0KCksdC5wYXJlbnQhPT1udWxsJiYodC5wYXJlbnQudXBkYXRlV29ybGRNYXRyaXgoITAsITEpLFd0Lm11bHRpcGx5KHQucGFyZW50Lm1hdHJpeFdvcmxkKSksdC5hcHBseU1hdHJpeDQoV3QpLHQucmVtb3ZlRnJvbVBhcmVudCgpLHQucGFyZW50PXRoaXMsdGhpcy5jaGlsZHJlbi5wdXNoKHQpLHQudXBkYXRlV29ybGRNYXRyaXgoITEsITApLHQuZGlzcGF0Y2hFdmVudChtciksX2UuY2hpbGQ9dCx0aGlzLmRpc3BhdGNoRXZlbnQoX2UpLF9lLmNoaWxkPW51bGwsdGhpc31nZXRPYmplY3RCeUlkKHQpe3JldHVybiB0aGlzLmdldE9iamVjdEJ5UHJvcGVydHkoImlkIix0KX1nZXRPYmplY3RCeU5hbWUodCl7cmV0dXJuIHRoaXMuZ2V0T2JqZWN0QnlQcm9wZXJ0eSgibmFtZSIsdCl9Z2V0T2JqZWN0QnlQcm9wZXJ0eSh0LGUpe2lmKHRoaXNbdF09PT1lKXJldHVybiB0aGlzO2ZvcihsZXQgcz0wLG49dGhpcy5jaGlsZHJlbi5sZW5ndGg7czxuO3MrKyl7Y29uc3Qgbz10aGlzLmNoaWxkcmVuW3NdLmdldE9iamVjdEJ5UHJvcGVydHkodCxlKTtpZihvIT09dm9pZCAwKXJldHVybiBvfX1nZXRPYmplY3RzQnlQcm9wZXJ0eSh0LGUscz1bXSl7dGhpc1t0XT09PWUmJnMucHVzaCh0aGlzKTtjb25zdCBuPXRoaXMuY2hpbGRyZW47Zm9yKGxldCBpPTAsbz1uLmxlbmd0aDtpPG87aSsrKW5baV0uZ2V0T2JqZWN0c0J5UHJvcGVydHkodCxlLHMpO3JldHVybiBzfWdldFdvcmxkUG9zaXRpb24odCl7cmV0dXJuIHRoaXMudXBkYXRlV29ybGRNYXRyaXgoITAsITEpLHQuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKHRoaXMubWF0cml4V29ybGQpfWdldFdvcmxkUXVhdGVybmlvbih0KXtyZXR1cm4gdGhpcy51cGRhdGVXb3JsZE1hdHJpeCghMCwhMSksdGhpcy5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoZXMsdCxkYSksdH1nZXRXb3JsZFNjYWxlKHQpe3JldHVybiB0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCEwLCExKSx0aGlzLm1hdHJpeFdvcmxkLmRlY29tcG9zZShlcyxmYSx0KSx0fWdldFdvcmxkRGlyZWN0aW9uKHQpe3RoaXMudXBkYXRlV29ybGRNYXRyaXgoITAsITEpO2NvbnN0IGU9dGhpcy5tYXRyaXhXb3JsZC5lbGVtZW50cztyZXR1cm4gdC5zZXQoZVs4XSxlWzldLGVbMTBdKS5ub3JtYWxpemUoKX1yYXljYXN0KCl7fXRyYXZlcnNlKHQpe3QodGhpcyk7Y29uc3QgZT10aGlzLmNoaWxkcmVuO2ZvcihsZXQgcz0wLG49ZS5sZW5ndGg7czxuO3MrKyllW3NdLnRyYXZlcnNlKHQpfXRyYXZlcnNlVmlzaWJsZSh0KXtpZih0aGlzLnZpc2libGU9PT0hMSlyZXR1cm47dCh0aGlzKTtjb25zdCBlPXRoaXMuY2hpbGRyZW47Zm9yKGxldCBzPTAsbj1lLmxlbmd0aDtzPG47cysrKWVbc10udHJhdmVyc2VWaXNpYmxlKHQpfXRyYXZlcnNlQW5jZXN0b3JzKHQpe2NvbnN0IGU9dGhpcy5wYXJlbnQ7ZSE9PW51bGwmJih0KGUpLGUudHJhdmVyc2VBbmNlc3RvcnModCkpfXVwZGF0ZU1hdHJpeCgpe3RoaXMubWF0cml4LmNvbXBvc2UodGhpcy5wb3NpdGlvbix0aGlzLnF1YXRlcm5pb24sdGhpcy5zY2FsZSksdGhpcy5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlPSEwfXVwZGF0ZU1hdHJpeFdvcmxkKHQpe3RoaXMubWF0cml4QXV0b1VwZGF0ZSYmdGhpcy51cGRhdGVNYXRyaXgoKSwodGhpcy5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlfHx0KSYmKHRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlPT09ITAmJih0aGlzLnBhcmVudD09PW51bGw/dGhpcy5tYXRyaXhXb3JsZC5jb3B5KHRoaXMubWF0cml4KTp0aGlzLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXModGhpcy5wYXJlbnQubWF0cml4V29ybGQsdGhpcy5tYXRyaXgpKSx0aGlzLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGU9ITEsdD0hMCk7Y29uc3QgZT10aGlzLmNoaWxkcmVuO2ZvcihsZXQgcz0wLG49ZS5sZW5ndGg7czxuO3MrKyllW3NdLnVwZGF0ZU1hdHJpeFdvcmxkKHQpfXVwZGF0ZVdvcmxkTWF0cml4KHQsZSl7Y29uc3Qgcz10aGlzLnBhcmVudDtpZih0PT09ITAmJnMhPT1udWxsJiZzLnVwZGF0ZVdvcmxkTWF0cml4KCEwLCExKSx0aGlzLm1hdHJpeEF1dG9VcGRhdGUmJnRoaXMudXBkYXRlTWF0cml4KCksdGhpcy5tYXRyaXhXb3JsZEF1dG9VcGRhdGU9PT0hMCYmKHRoaXMucGFyZW50PT09bnVsbD90aGlzLm1hdHJpeFdvcmxkLmNvcHkodGhpcy5tYXRyaXgpOnRoaXMubWF0cml4V29ybGQubXVsdGlwbHlNYXRyaWNlcyh0aGlzLnBhcmVudC5tYXRyaXhXb3JsZCx0aGlzLm1hdHJpeCkpLGU9PT0hMCl7Y29uc3Qgbj10aGlzLmNoaWxkcmVuO2ZvcihsZXQgaT0wLG89bi5sZW5ndGg7aTxvO2krKyluW2ldLnVwZGF0ZVdvcmxkTWF0cml4KCExLCEwKX19dG9KU09OKHQpe2NvbnN0IGU9dD09PXZvaWQgMHx8dHlwZW9mIHQ9PSJzdHJpbmciLHM9e307ZSYmKHQ9e2dlb21ldHJpZXM6e30sbWF0ZXJpYWxzOnt9LHRleHR1cmVzOnt9LGltYWdlczp7fSxzaGFwZXM6e30sc2tlbGV0b25zOnt9LGFuaW1hdGlvbnM6e30sbm9kZXM6e319LHMubWV0YWRhdGE9e3ZlcnNpb246NC42LHR5cGU6Ik9iamVjdCIsZ2VuZXJhdG9yOiJPYmplY3QzRC50b0pTT04ifSk7Y29uc3Qgbj17fTtuLnV1aWQ9dGhpcy51dWlkLG4udHlwZT10aGlzLnR5cGUsdGhpcy5uYW1lIT09IiImJihuLm5hbWU9dGhpcy5uYW1lKSx0aGlzLmNhc3RTaGFkb3c9PT0hMCYmKG4uY2FzdFNoYWRvdz0hMCksdGhpcy5yZWNlaXZlU2hhZG93PT09ITAmJihuLnJlY2VpdmVTaGFkb3c9ITApLHRoaXMudmlzaWJsZT09PSExJiYobi52aXNpYmxlPSExKSx0aGlzLmZydXN0dW1DdWxsZWQ9PT0hMSYmKG4uZnJ1c3R1bUN1bGxlZD0hMSksdGhpcy5yZW5kZXJPcmRlciE9PTAmJihuLnJlbmRlck9yZGVyPXRoaXMucmVuZGVyT3JkZXIpLE9iamVjdC5rZXlzKHRoaXMudXNlckRhdGEpLmxlbmd0aD4wJiYobi51c2VyRGF0YT10aGlzLnVzZXJEYXRhKSxuLmxheWVycz10aGlzLmxheWVycy5tYXNrLG4ubWF0cml4PXRoaXMubWF0cml4LnRvQXJyYXkoKSxuLnVwPXRoaXMudXAudG9BcnJheSgpLHRoaXMubWF0cml4QXV0b1VwZGF0ZT09PSExJiYobi5tYXRyaXhBdXRvVXBkYXRlPSExKSx0aGlzLmlzSW5zdGFuY2VkTWVzaCYmKG4udHlwZT0iSW5zdGFuY2VkTWVzaCIsbi5jb3VudD10aGlzLmNvdW50LG4uaW5zdGFuY2VNYXRyaXg9dGhpcy5pbnN0YW5jZU1hdHJpeC50b0pTT04oKSx0aGlzLmluc3RhbmNlQ29sb3IhPT1udWxsJiYobi5pbnN0YW5jZUNvbG9yPXRoaXMuaW5zdGFuY2VDb2xvci50b0pTT04oKSkpLHRoaXMuaXNCYXRjaGVkTWVzaCYmKG4udHlwZT0iQmF0Y2hlZE1lc2giLG4ucGVyT2JqZWN0RnJ1c3R1bUN1bGxlZD10aGlzLnBlck9iamVjdEZydXN0dW1DdWxsZWQsbi5zb3J0T2JqZWN0cz10aGlzLnNvcnRPYmplY3RzLG4uZHJhd1Jhbmdlcz10aGlzLl9kcmF3UmFuZ2VzLG4ucmVzZXJ2ZWRSYW5nZXM9dGhpcy5fcmVzZXJ2ZWRSYW5nZXMsbi52aXNpYmlsaXR5PXRoaXMuX3Zpc2liaWxpdHksbi5hY3RpdmU9dGhpcy5fYWN0aXZlLG4uYm91bmRzPXRoaXMuX2JvdW5kcy5tYXAoYT0+KHtib3hJbml0aWFsaXplZDphLmJveEluaXRpYWxpemVkLGJveE1pbjphLmJveC5taW4udG9BcnJheSgpLGJveE1heDphLmJveC5tYXgudG9BcnJheSgpLHNwaGVyZUluaXRpYWxpemVkOmEuc3BoZXJlSW5pdGlhbGl6ZWQsc3BoZXJlUmFkaXVzOmEuc3BoZXJlLnJhZGl1cyxzcGhlcmVDZW50ZXI6YS5zcGhlcmUuY2VudGVyLnRvQXJyYXkoKX0pKSxuLm1heEluc3RhbmNlQ291bnQ9dGhpcy5fbWF4SW5zdGFuY2VDb3VudCxuLm1heFZlcnRleENvdW50PXRoaXMuX21heFZlcnRleENvdW50LG4ubWF4SW5kZXhDb3VudD10aGlzLl9tYXhJbmRleENvdW50LG4uZ2VvbWV0cnlJbml0aWFsaXplZD10aGlzLl9nZW9tZXRyeUluaXRpYWxpemVkLG4uZ2VvbWV0cnlDb3VudD10aGlzLl9nZW9tZXRyeUNvdW50LG4ubWF0cmljZXNUZXh0dXJlPXRoaXMuX21hdHJpY2VzVGV4dHVyZS50b0pTT04odCksdGhpcy5fY29sb3JzVGV4dHVyZSE9PW51bGwmJihuLmNvbG9yc1RleHR1cmU9dGhpcy5fY29sb3JzVGV4dHVyZS50b0pTT04odCkpLHRoaXMuYm91bmRpbmdTcGhlcmUhPT1udWxsJiYobi5ib3VuZGluZ1NwaGVyZT17Y2VudGVyOm4uYm91bmRpbmdTcGhlcmUuY2VudGVyLnRvQXJyYXkoKSxyYWRpdXM6bi5ib3VuZGluZ1NwaGVyZS5yYWRpdXN9KSx0aGlzLmJvdW5kaW5nQm94IT09bnVsbCYmKG4uYm91bmRpbmdCb3g9e21pbjpuLmJvdW5kaW5nQm94Lm1pbi50b0FycmF5KCksbWF4Om4uYm91bmRpbmdCb3gubWF4LnRvQXJyYXkoKX0pKTtmdW5jdGlvbiBpKGEsYyl7cmV0dXJuIGFbYy51dWlkXT09PXZvaWQgMCYmKGFbYy51dWlkXT1jLnRvSlNPTih0KSksYy51dWlkfWlmKHRoaXMuaXNTY2VuZSl0aGlzLmJhY2tncm91bmQmJih0aGlzLmJhY2tncm91bmQuaXNDb2xvcj9uLmJhY2tncm91bmQ9dGhpcy5iYWNrZ3JvdW5kLnRvSlNPTigpOnRoaXMuYmFja2dyb3VuZC5pc1RleHR1cmUmJihuLmJhY2tncm91bmQ9dGhpcy5iYWNrZ3JvdW5kLnRvSlNPTih0KS51dWlkKSksdGhpcy5lbnZpcm9ubWVudCYmdGhpcy5lbnZpcm9ubWVudC5pc1RleHR1cmUmJnRoaXMuZW52aXJvbm1lbnQuaXNSZW5kZXJUYXJnZXRUZXh0dXJlIT09ITAmJihuLmVudmlyb25tZW50PXRoaXMuZW52aXJvbm1lbnQudG9KU09OKHQpLnV1aWQpO2Vsc2UgaWYodGhpcy5pc01lc2h8fHRoaXMuaXNMaW5lfHx0aGlzLmlzUG9pbnRzKXtuLmdlb21ldHJ5PWkodC5nZW9tZXRyaWVzLHRoaXMuZ2VvbWV0cnkpO2NvbnN0IGE9dGhpcy5nZW9tZXRyeS5wYXJhbWV0ZXJzO2lmKGEhPT12b2lkIDAmJmEuc2hhcGVzIT09dm9pZCAwKXtjb25zdCBjPWEuc2hhcGVzO2lmKEFycmF5LmlzQXJyYXkoYykpZm9yKGxldCB1PTAsaD1jLmxlbmd0aDt1PGg7dSsrKXtjb25zdCBsPWNbdV07aSh0LnNoYXBlcyxsKX1lbHNlIGkodC5zaGFwZXMsYyl9fWlmKHRoaXMuaXNTa2lubmVkTWVzaCYmKG4uYmluZE1vZGU9dGhpcy5iaW5kTW9kZSxuLmJpbmRNYXRyaXg9dGhpcy5iaW5kTWF0cml4LnRvQXJyYXkoKSx0aGlzLnNrZWxldG9uIT09dm9pZCAwJiYoaSh0LnNrZWxldG9ucyx0aGlzLnNrZWxldG9uKSxuLnNrZWxldG9uPXRoaXMuc2tlbGV0b24udXVpZCkpLHRoaXMubWF0ZXJpYWwhPT12b2lkIDApaWYoQXJyYXkuaXNBcnJheSh0aGlzLm1hdGVyaWFsKSl7Y29uc3QgYT1bXTtmb3IobGV0IGM9MCx1PXRoaXMubWF0ZXJpYWwubGVuZ3RoO2M8dTtjKyspYS5wdXNoKGkodC5tYXRlcmlhbHMsdGhpcy5tYXRlcmlhbFtjXSkpO24ubWF0ZXJpYWw9YX1lbHNlIG4ubWF0ZXJpYWw9aSh0Lm1hdGVyaWFscyx0aGlzLm1hdGVyaWFsKTtpZih0aGlzLmNoaWxkcmVuLmxlbmd0aD4wKXtuLmNoaWxkcmVuPVtdO2ZvcihsZXQgYT0wO2E8dGhpcy5jaGlsZHJlbi5sZW5ndGg7YSsrKW4uY2hpbGRyZW4ucHVzaCh0aGlzLmNoaWxkcmVuW2FdLnRvSlNPTih0KS5vYmplY3QpfWlmKHRoaXMuYW5pbWF0aW9ucy5sZW5ndGg+MCl7bi5hbmltYXRpb25zPVtdO2ZvcihsZXQgYT0wO2E8dGhpcy5hbmltYXRpb25zLmxlbmd0aDthKyspe2NvbnN0IGM9dGhpcy5hbmltYXRpb25zW2FdO24uYW5pbWF0aW9ucy5wdXNoKGkodC5hbmltYXRpb25zLGMpKX19aWYoZSl7Y29uc3QgYT1vKHQuZ2VvbWV0cmllcyksYz1vKHQubWF0ZXJpYWxzKSx1PW8odC50ZXh0dXJlcyksaD1vKHQuaW1hZ2VzKSxsPW8odC5zaGFwZXMpLGQ9byh0LnNrZWxldG9ucyksZj1vKHQuYW5pbWF0aW9ucykscD1vKHQubm9kZXMpO2EubGVuZ3RoPjAmJihzLmdlb21ldHJpZXM9YSksYy5sZW5ndGg+MCYmKHMubWF0ZXJpYWxzPWMpLHUubGVuZ3RoPjAmJihzLnRleHR1cmVzPXUpLGgubGVuZ3RoPjAmJihzLmltYWdlcz1oKSxsLmxlbmd0aD4wJiYocy5zaGFwZXM9bCksZC5sZW5ndGg+MCYmKHMuc2tlbGV0b25zPWQpLGYubGVuZ3RoPjAmJihzLmFuaW1hdGlvbnM9ZikscC5sZW5ndGg+MCYmKHMubm9kZXM9cCl9cmV0dXJuIHMub2JqZWN0PW4scztmdW5jdGlvbiBvKGEpe2NvbnN0IGM9W107Zm9yKGNvbnN0IHUgaW4gYSl7Y29uc3QgaD1hW3VdO2RlbGV0ZSBoLm1ldGFkYXRhLGMucHVzaChoKX1yZXR1cm4gY319Y2xvbmUodCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSh0aGlzLHQpfWNvcHkodCxlPSEwKXtpZih0aGlzLm5hbWU9dC5uYW1lLHRoaXMudXAuY29weSh0LnVwKSx0aGlzLnBvc2l0aW9uLmNvcHkodC5wb3NpdGlvbiksdGhpcy5yb3RhdGlvbi5vcmRlcj10LnJvdGF0aW9uLm9yZGVyLHRoaXMucXVhdGVybmlvbi5jb3B5KHQucXVhdGVybmlvbiksdGhpcy5zY2FsZS5jb3B5KHQuc2NhbGUpLHRoaXMubWF0cml4LmNvcHkodC5tYXRyaXgpLHRoaXMubWF0cml4V29ybGQuY29weSh0Lm1hdHJpeFdvcmxkKSx0aGlzLm1hdHJpeEF1dG9VcGRhdGU9dC5tYXRyaXhBdXRvVXBkYXRlLHRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlPXQubWF0cml4V29ybGRBdXRvVXBkYXRlLHRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZT10Lm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUsdGhpcy5sYXllcnMubWFzaz10LmxheWVycy5tYXNrLHRoaXMudmlzaWJsZT10LnZpc2libGUsdGhpcy5jYXN0U2hhZG93PXQuY2FzdFNoYWRvdyx0aGlzLnJlY2VpdmVTaGFkb3c9dC5yZWNlaXZlU2hhZG93LHRoaXMuZnJ1c3R1bUN1bGxlZD10LmZydXN0dW1DdWxsZWQsdGhpcy5yZW5kZXJPcmRlcj10LnJlbmRlck9yZGVyLHRoaXMuYW5pbWF0aW9ucz10LmFuaW1hdGlvbnMuc2xpY2UoKSx0aGlzLnVzZXJEYXRhPUpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodC51c2VyRGF0YSkpLGU9PT0hMClmb3IobGV0IHM9MDtzPHQuY2hpbGRyZW4ubGVuZ3RoO3MrKyl7Y29uc3Qgbj10LmNoaWxkcmVuW3NdO3RoaXMuYWRkKG4uY2xvbmUoKSl9cmV0dXJuIHRoaXN9fW5lLkRFRkFVTFRfVVA9bmV3IEEoMCwxLDApLG5lLkRFRkFVTFRfTUFUUklYX0FVVE9fVVBEQVRFPSEwLG5lLkRFRkFVTFRfTUFUUklYX1dPUkxEX0FVVE9fVVBEQVRFPSEwO2NvbnN0IEl0PW5ldyBBLFh0PW5ldyBBLFBuPW5ldyBBLFl0PW5ldyBBLHplPW5ldyBBLGJlPW5ldyBBLHlyPW5ldyBBLExuPW5ldyBBLE9uPW5ldyBBLERuPW5ldyBBLFZuPW5ldyBGdCxVbj1uZXcgRnQsa249bmV3IEZ0O2NsYXNzIHd0e2NvbnN0cnVjdG9yKHQ9bmV3IEEsZT1uZXcgQSxzPW5ldyBBKXt0aGlzLmE9dCx0aGlzLmI9ZSx0aGlzLmM9c31zdGF0aWMgZ2V0Tm9ybWFsKHQsZSxzLG4pe24uc3ViVmVjdG9ycyhzLGUpLEl0LnN1YlZlY3RvcnModCxlKSxuLmNyb3NzKEl0KTtjb25zdCBpPW4ubGVuZ3RoU3EoKTtyZXR1cm4gaT4wP24ubXVsdGlwbHlTY2FsYXIoMS9NYXRoLnNxcnQoaSkpOm4uc2V0KDAsMCwwKX1zdGF0aWMgZ2V0QmFyeWNvb3JkKHQsZSxzLG4saSl7SXQuc3ViVmVjdG9ycyhuLGUpLFh0LnN1YlZlY3RvcnMocyxlKSxQbi5zdWJWZWN0b3JzKHQsZSk7Y29uc3Qgbz1JdC5kb3QoSXQpLGE9SXQuZG90KFh0KSxjPUl0LmRvdChQbiksdT1YdC5kb3QoWHQpLGg9WHQuZG90KFBuKSxsPW8qdS1hKmE7aWYobD09PTApcmV0dXJuIGkuc2V0KDAsMCwwKSxudWxsO2NvbnN0IGQ9MS9sLGY9KHUqYy1hKmgpKmQscD0obypoLWEqYykqZDtyZXR1cm4gaS5zZXQoMS1mLXAscCxmKX1zdGF0aWMgY29udGFpbnNQb2ludCh0LGUscyxuKXtyZXR1cm4gdGhpcy5nZXRCYXJ5Y29vcmQodCxlLHMsbixZdCk9PT1udWxsPyExOll0Lng+PTAmJll0Lnk+PTAmJll0LngrWXQueTw9MX1zdGF0aWMgZ2V0SW50ZXJwb2xhdGlvbih0LGUscyxuLGksbyxhLGMpe3JldHVybiB0aGlzLmdldEJhcnljb29yZCh0LGUscyxuLFl0KT09PW51bGw/KGMueD0wLGMueT0wLCJ6ImluIGMmJihjLno9MCksInciaW4gYyYmKGMudz0wKSxudWxsKTooYy5zZXRTY2FsYXIoMCksYy5hZGRTY2FsZWRWZWN0b3IoaSxZdC54KSxjLmFkZFNjYWxlZFZlY3RvcihvLFl0LnkpLGMuYWRkU2NhbGVkVmVjdG9yKGEsWXQueiksYyl9c3RhdGljIGdldEludGVycG9sYXRlZEF0dHJpYnV0ZSh0LGUscyxuLGksbyl7cmV0dXJuIFZuLnNldFNjYWxhcigwKSxVbi5zZXRTY2FsYXIoMCksa24uc2V0U2NhbGFyKDApLFZuLmZyb21CdWZmZXJBdHRyaWJ1dGUodCxlKSxVbi5mcm9tQnVmZmVyQXR0cmlidXRlKHQscyksa24uZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LG4pLG8uc2V0U2NhbGFyKDApLG8uYWRkU2NhbGVkVmVjdG9yKFZuLGkueCksby5hZGRTY2FsZWRWZWN0b3IoVW4saS55KSxvLmFkZFNjYWxlZFZlY3RvcihrbixpLnopLG99c3RhdGljIGlzRnJvbnRGYWNpbmcodCxlLHMsbil7cmV0dXJuIEl0LnN1YlZlY3RvcnMocyxlKSxYdC5zdWJWZWN0b3JzKHQsZSksSXQuY3Jvc3MoWHQpLmRvdChuKTwwfXNldCh0LGUscyl7cmV0dXJuIHRoaXMuYS5jb3B5KHQpLHRoaXMuYi5jb3B5KGUpLHRoaXMuYy5jb3B5KHMpLHRoaXN9c2V0RnJvbVBvaW50c0FuZEluZGljZXModCxlLHMsbil7cmV0dXJuIHRoaXMuYS5jb3B5KHRbZV0pLHRoaXMuYi5jb3B5KHRbc10pLHRoaXMuYy5jb3B5KHRbbl0pLHRoaXN9c2V0RnJvbUF0dHJpYnV0ZUFuZEluZGljZXModCxlLHMsbil7cmV0dXJuIHRoaXMuYS5mcm9tQnVmZmVyQXR0cmlidXRlKHQsZSksdGhpcy5iLmZyb21CdWZmZXJBdHRyaWJ1dGUodCxzKSx0aGlzLmMuZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LG4pLHRoaXN9Y2xvbmUoKXtyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KHRoaXMpfWNvcHkodCl7cmV0dXJuIHRoaXMuYS5jb3B5KHQuYSksdGhpcy5iLmNvcHkodC5iKSx0aGlzLmMuY29weSh0LmMpLHRoaXN9Z2V0QXJlYSgpe3JldHVybiBJdC5zdWJWZWN0b3JzKHRoaXMuYyx0aGlzLmIpLFh0LnN1YlZlY3RvcnModGhpcy5hLHRoaXMuYiksSXQuY3Jvc3MoWHQpLmxlbmd0aCgpKi41fWdldE1pZHBvaW50KHQpe3JldHVybiB0LmFkZFZlY3RvcnModGhpcy5hLHRoaXMuYikuYWRkKHRoaXMuYykubXVsdGlwbHlTY2FsYXIoMS8zKX1nZXROb3JtYWwodCl7cmV0dXJuIHd0LmdldE5vcm1hbCh0aGlzLmEsdGhpcy5iLHRoaXMuYyx0KX1nZXRQbGFuZSh0KXtyZXR1cm4gdC5zZXRGcm9tQ29wbGFuYXJQb2ludHModGhpcy5hLHRoaXMuYix0aGlzLmMpfWdldEJhcnljb29yZCh0LGUpe3JldHVybiB3dC5nZXRCYXJ5Y29vcmQodCx0aGlzLmEsdGhpcy5iLHRoaXMuYyxlKX1nZXRJbnRlcnBvbGF0aW9uKHQsZSxzLG4saSl7cmV0dXJuIHd0LmdldEludGVycG9sYXRpb24odCx0aGlzLmEsdGhpcy5iLHRoaXMuYyxlLHMsbixpKX1jb250YWluc1BvaW50KHQpe3JldHVybiB3dC5jb250YWluc1BvaW50KHQsdGhpcy5hLHRoaXMuYix0aGlzLmMpfWlzRnJvbnRGYWNpbmcodCl7cmV0dXJuIHd0LmlzRnJvbnRGYWNpbmcodGhpcy5hLHRoaXMuYix0aGlzLmMsdCl9aW50ZXJzZWN0c0JveCh0KXtyZXR1cm4gdC5pbnRlcnNlY3RzVHJpYW5nbGUodGhpcyl9Y2xvc2VzdFBvaW50VG9Qb2ludCh0LGUpe2NvbnN0IHM9dGhpcy5hLG49dGhpcy5iLGk9dGhpcy5jO2xldCBvLGE7emUuc3ViVmVjdG9ycyhuLHMpLGJlLnN1YlZlY3RvcnMoaSxzKSxMbi5zdWJWZWN0b3JzKHQscyk7Y29uc3QgYz16ZS5kb3QoTG4pLHU9YmUuZG90KExuKTtpZihjPD0wJiZ1PD0wKXJldHVybiBlLmNvcHkocyk7T24uc3ViVmVjdG9ycyh0LG4pO2NvbnN0IGg9emUuZG90KE9uKSxsPWJlLmRvdChPbik7aWYoaD49MCYmbDw9aClyZXR1cm4gZS5jb3B5KG4pO2NvbnN0IGQ9YypsLWgqdTtpZihkPD0wJiZjPj0wJiZoPD0wKXJldHVybiBvPWMvKGMtaCksZS5jb3B5KHMpLmFkZFNjYWxlZFZlY3Rvcih6ZSxvKTtEbi5zdWJWZWN0b3JzKHQsaSk7Y29uc3QgZj16ZS5kb3QoRG4pLHA9YmUuZG90KERuKTtpZihwPj0wJiZmPD1wKXJldHVybiBlLmNvcHkoaSk7Y29uc3QgbT1mKnUtYypwO2lmKG08PTAmJnU+PTAmJnA8PTApcmV0dXJuIGE9dS8odS1wKSxlLmNvcHkocykuYWRkU2NhbGVkVmVjdG9yKGJlLGEpO2NvbnN0IGc9aCpwLWYqbDtpZihnPD0wJiZsLWg+PTAmJmYtcD49MClyZXR1cm4geXIuc3ViVmVjdG9ycyhpLG4pLGE9KGwtaCkvKGwtaCsoZi1wKSksZS5jb3B5KG4pLmFkZFNjYWxlZFZlY3Rvcih5cixhKTtjb25zdCB5PTEvKGcrbStkKTtyZXR1cm4gbz1tKnksYT1kKnksZS5jb3B5KHMpLmFkZFNjYWxlZFZlY3Rvcih6ZSxvKS5hZGRTY2FsZWRWZWN0b3IoYmUsYSl9ZXF1YWxzKHQpe3JldHVybiB0LmEuZXF1YWxzKHRoaXMuYSkmJnQuYi5lcXVhbHModGhpcy5iKSYmdC5jLmVxdWFscyh0aGlzLmMpfX1jb25zdCBncj17YWxpY2VibHVlOjE1NzkyMzgzLGFudGlxdWV3aGl0ZToxNjQ0NDM3NSxhcXVhOjY1NTM1LGFxdWFtYXJpbmU6ODM4ODU2NCxhenVyZToxNTc5NDE3NSxiZWlnZToxNjExOTI2MCxiaXNxdWU6MTY3NzAyNDQsYmxhY2s6MCxibGFuY2hlZGFsbW9uZDoxNjc3MjA0NSxibHVlOjI1NSxibHVldmlvbGV0OjkwNTUyMDIsYnJvd246MTA4MjQyMzQsYnVybHl3b29kOjE0NTk2MjMxLGNhZGV0Ymx1ZTo2MjY2NTI4LGNoYXJ0cmV1c2U6ODM4ODM1MixjaG9jb2xhdGU6MTM3ODk0NzAsY29yYWw6MTY3NDQyNzIsY29ybmZsb3dlcmJsdWU6NjU5MTk4MSxjb3Juc2lsazoxNjc3NTM4OCxjcmltc29uOjE0NDIzMTAwLGN5YW46NjU1MzUsZGFya2JsdWU6MTM5LGRhcmtjeWFuOjM1NzIzLGRhcmtnb2xkZW5yb2Q6MTIwOTI5MzksZGFya2dyYXk6MTExMTkwMTcsZGFya2dyZWVuOjI1NjAwLGRhcmtncmV5OjExMTE5MDE3LGRhcmtraGFraToxMjQzMzI1OSxkYXJrbWFnZW50YTo5MTA5NjQzLGRhcmtvbGl2ZWdyZWVuOjU1OTc5OTksZGFya29yYW5nZToxNjc0NzUyMCxkYXJrb3JjaGlkOjEwMDQwMDEyLGRhcmtyZWQ6OTEwOTUwNCxkYXJrc2FsbW9uOjE1MzA4NDEwLGRhcmtzZWFncmVlbjo5NDE5OTE5LGRhcmtzbGF0ZWJsdWU6NDczNDM0NyxkYXJrc2xhdGVncmF5OjMxMDA0OTUsZGFya3NsYXRlZ3JleTozMTAwNDk1LGRhcmt0dXJxdW9pc2U6NTI5NDUsZGFya3Zpb2xldDo5Njk5NTM5LGRlZXBwaW5rOjE2NzE2OTQ3LGRlZXBza3libHVlOjQ5MTUxLGRpbWdyYXk6NjkwODI2NSxkaW1ncmV5OjY5MDgyNjUsZG9kZ2VyYmx1ZToyMDAzMTk5LGZpcmVicmljazoxMTY3NDE0NixmbG9yYWx3aGl0ZToxNjc3NTkyMCxmb3Jlc3RncmVlbjoyMjYzODQyLGZ1Y2hzaWE6MTY3MTE5MzUsZ2FpbnNib3JvOjE0NDc0NDYwLGdob3N0d2hpdGU6MTYzMTY2NzEsZ29sZDoxNjc2NjcyMCxnb2xkZW5yb2Q6MTQzMjkxMjAsZ3JheTo4NDIxNTA0LGdyZWVuOjMyNzY4LGdyZWVueWVsbG93OjExNDAzMDU1LGdyZXk6ODQyMTUwNCxob25leWRldzoxNTc5NDE2MCxob3RwaW5rOjE2NzM4NzQwLGluZGlhbnJlZDoxMzQ1ODUyNCxpbmRpZ286NDkxNTMzMCxpdm9yeToxNjc3NzIwMCxraGFraToxNTc4NzY2MCxsYXZlbmRlcjoxNTEzMjQxMCxsYXZlbmRlcmJsdXNoOjE2NzczMzY1LGxhd25ncmVlbjo4MTkwOTc2LGxlbW9uY2hpZmZvbjoxNjc3NTg4NSxsaWdodGJsdWU6MTEzOTMyNTQsbGlnaHRjb3JhbDoxNTc2MTUzNixsaWdodGN5YW46MTQ3NDU1OTksbGlnaHRnb2xkZW5yb2R5ZWxsb3c6MTY0NDgyMTAsbGlnaHRncmF5OjEzODgyMzIzLGxpZ2h0Z3JlZW46OTQ5ODI1NixsaWdodGdyZXk6MTM4ODIzMjMsbGlnaHRwaW5rOjE2NzU4NDY1LGxpZ2h0c2FsbW9uOjE2NzUyNzYyLGxpZ2h0c2VhZ3JlZW46MjE0Mjg5MCxsaWdodHNreWJsdWU6ODkwMDM0NixsaWdodHNsYXRlZ3JheTo3ODMzNzUzLGxpZ2h0c2xhdGVncmV5Ojc4MzM3NTMsbGlnaHRzdGVlbGJsdWU6MTE1ODQ3MzQsbGlnaHR5ZWxsb3c6MTY3NzcxODQsbGltZTo2NTI4MCxsaW1lZ3JlZW46MzMyOTMzMCxsaW5lbjoxNjQ0NTY3MCxtYWdlbnRhOjE2NzExOTM1LG1hcm9vbjo4Mzg4NjA4LG1lZGl1bWFxdWFtYXJpbmU6NjczNzMyMixtZWRpdW1ibHVlOjIwNSxtZWRpdW1vcmNoaWQ6MTIyMTE2NjcsbWVkaXVtcHVycGxlOjk2NjI2ODMsbWVkaXVtc2VhZ3JlZW46Mzk3ODA5NyxtZWRpdW1zbGF0ZWJsdWU6ODA4Nzc5MCxtZWRpdW1zcHJpbmdncmVlbjo2NDE1NCxtZWRpdW10dXJxdW9pc2U6NDc3MjMwMCxtZWRpdW12aW9sZXRyZWQ6MTMwNDcxNzMsbWlkbmlnaHRibHVlOjE2NDQ5MTIsbWludGNyZWFtOjE2MTIxODUwLG1pc3R5cm9zZToxNjc3MDI3Myxtb2NjYXNpbjoxNjc3MDIyOSxuYXZham93aGl0ZToxNjc2ODY4NSxuYXZ5OjEyOCxvbGRsYWNlOjE2NjQzNTU4LG9saXZlOjg0MjEzNzYsb2xpdmVkcmFiOjcwNDg3Mzksb3JhbmdlOjE2NzUzOTIwLG9yYW5nZXJlZDoxNjcyOTM0NCxvcmNoaWQ6MTQzMTU3MzQscGFsZWdvbGRlbnJvZDoxNTY1NzEzMCxwYWxlZ3JlZW46MTAwMjU4ODAscGFsZXR1cnF1b2lzZToxMTUyOTk2NixwYWxldmlvbGV0cmVkOjE0MzgxMjAzLHBhcGF5YXdoaXA6MTY3NzMwNzcscGVhY2hwdWZmOjE2NzY3NjczLHBlcnU6MTM0Njg5OTEscGluazoxNjc2MTAzNSxwbHVtOjE0NTI0NjM3LHBvd2RlcmJsdWU6MTE1OTE5MTAscHVycGxlOjgzODg3MzYscmViZWNjYXB1cnBsZTo2Njk3ODgxLHJlZDoxNjcxMTY4MCxyb3N5YnJvd246MTIzNTc1MTkscm95YWxibHVlOjQyODY5NDUsc2FkZGxlYnJvd246OTEyNzE4NyxzYWxtb246MTY0MTY4ODIsc2FuZHlicm93bjoxNjAzMjg2NCxzZWFncmVlbjozMDUwMzI3LHNlYXNoZWxsOjE2Nzc0NjM4LHNpZW5uYToxMDUwNjc5NyxzaWx2ZXI6MTI2MzIyNTYsc2t5Ymx1ZTo4OTAwMzMxLHNsYXRlYmx1ZTo2OTcwMDYxLHNsYXRlZ3JheTo3MzcyOTQ0LHNsYXRlZ3JleTo3MzcyOTQ0LHNub3c6MTY3NzU5MzAsc3ByaW5nZ3JlZW46NjU0MDcsc3RlZWxibHVlOjQ2MjA5ODAsdGFuOjEzODA4NzgwLHRlYWw6MzI4OTYsdGhpc3RsZToxNDIwNDg4OCx0b21hdG86MTY3MzcwOTUsdHVycXVvaXNlOjQyNTE4NTYsdmlvbGV0OjE1NjMxMDg2LHdoZWF0OjE2MTEzMzMxLHdoaXRlOjE2Nzc3MjE1LHdoaXRlc21va2U6MTYxMTkyODUseWVsbG93OjE2Nzc2OTYwLHllbGxvd2dyZWVuOjEwMTQ1MDc0fSxpZT17aDowLHM6MCxsOjB9LExzPXtoOjAsczowLGw6MH07ZnVuY3Rpb24gSG4ocix0LGUpe3JldHVybiBlPDAmJihlKz0xKSxlPjEmJihlLT0xKSxlPDEvNj9yKyh0LXIpKjYqZTplPDEvMj90OmU8Mi8zP3IrKHQtcikqNiooMi8zLWUpOnJ9Y2xhc3MgcW57Y29uc3RydWN0b3IodCxlLHMpe3JldHVybiB0aGlzLmlzQ29sb3I9ITAsdGhpcy5yPTEsdGhpcy5nPTEsdGhpcy5iPTEsdGhpcy5zZXQodCxlLHMpfXNldCh0LGUscyl7aWYoZT09PXZvaWQgMCYmcz09PXZvaWQgMCl7Y29uc3Qgbj10O24mJm4uaXNDb2xvcj90aGlzLmNvcHkobik6dHlwZW9mIG49PSJudW1iZXIiP3RoaXMuc2V0SGV4KG4pOnR5cGVvZiBuPT0ic3RyaW5nIiYmdGhpcy5zZXRTdHlsZShuKX1lbHNlIHRoaXMuc2V0UkdCKHQsZSxzKTtyZXR1cm4gdGhpc31zZXRTY2FsYXIodCl7cmV0dXJuIHRoaXMucj10LHRoaXMuZz10LHRoaXMuYj10LHRoaXN9c2V0SGV4KHQsZT0kdCl7cmV0dXJuIHQ9TWF0aC5mbG9vcih0KSx0aGlzLnI9KHQ+PjE2JjI1NSkvMjU1LHRoaXMuZz0odD4+OCYyNTUpLzI1NSx0aGlzLmI9KHQmMjU1KS8yNTUsbXQudG9Xb3JraW5nQ29sb3JTcGFjZSh0aGlzLGUpLHRoaXN9c2V0UkdCKHQsZSxzLG49bXQud29ya2luZ0NvbG9yU3BhY2Upe3JldHVybiB0aGlzLnI9dCx0aGlzLmc9ZSx0aGlzLmI9cyxtdC50b1dvcmtpbmdDb2xvclNwYWNlKHRoaXMsbiksdGhpc31zZXRIU0wodCxlLHMsbj1tdC53b3JraW5nQ29sb3JTcGFjZSl7aWYodD1ibih0LDEpLGU9YXQoZSwwLDEpLHM9YXQocywwLDEpLGU9PT0wKXRoaXMucj10aGlzLmc9dGhpcy5iPXM7ZWxzZXtjb25zdCBpPXM8PS41P3MqKDErZSk6cytlLXMqZSxvPTIqcy1pO3RoaXMucj1IbihvLGksdCsxLzMpLHRoaXMuZz1IbihvLGksdCksdGhpcy5iPUhuKG8saSx0LTEvMyl9cmV0dXJuIG10LnRvV29ya2luZ0NvbG9yU3BhY2UodGhpcyxuKSx0aGlzfXNldFN0eWxlKHQsZT0kdCl7ZnVuY3Rpb24gcyhpKXtpIT09dm9pZCAwJiZwYXJzZUZsb2F0KGkpPDEmJmNvbnNvbGUud2FybigiVEhSRUUuQ29sb3I6IEFscGhhIGNvbXBvbmVudCBvZiAiK3QrIiB3aWxsIGJlIGlnbm9yZWQuIil9bGV0IG47aWYobj0vXihcdyspXCgoW15cKV0qKVwpLy5leGVjKHQpKXtsZXQgaTtjb25zdCBvPW5bMV0sYT1uWzJdO3N3aXRjaChvKXtjYXNlInJnYiI6Y2FzZSJyZ2JhIjppZihpPS9eXHMqKFxkKylccyosXHMqKFxkKylccyosXHMqKFxkKylccyooPzosXHMqKFxkKlwuP1xkKylccyopPyQvLmV4ZWMoYSkpcmV0dXJuIHMoaVs0XSksdGhpcy5zZXRSR0IoTWF0aC5taW4oMjU1LHBhcnNlSW50KGlbMV0sMTApKS8yNTUsTWF0aC5taW4oMjU1LHBhcnNlSW50KGlbMl0sMTApKS8yNTUsTWF0aC5taW4oMjU1LHBhcnNlSW50KGlbM10sMTApKS8yNTUsZSk7aWYoaT0vXlxzKihcZCspXCVccyosXHMqKFxkKylcJVxzKixccyooXGQrKVwlXHMqKD86LFxzKihcZCpcLj9cZCspXHMqKT8kLy5leGVjKGEpKXJldHVybiBzKGlbNF0pLHRoaXMuc2V0UkdCKE1hdGgubWluKDEwMCxwYXJzZUludChpWzFdLDEwKSkvMTAwLE1hdGgubWluKDEwMCxwYXJzZUludChpWzJdLDEwKSkvMTAwLE1hdGgubWluKDEwMCxwYXJzZUludChpWzNdLDEwKSkvMTAwLGUpO2JyZWFrO2Nhc2UiaHNsIjpjYXNlImhzbGEiOmlmKGk9L15ccyooXGQqXC4/XGQrKVxzKixccyooXGQqXC4/XGQrKVwlXHMqLFxzKihcZCpcLj9cZCspXCVccyooPzosXHMqKFxkKlwuP1xkKylccyopPyQvLmV4ZWMoYSkpcmV0dXJuIHMoaVs0XSksdGhpcy5zZXRIU0wocGFyc2VGbG9hdChpWzFdKS8zNjAscGFyc2VGbG9hdChpWzJdKS8xMDAscGFyc2VGbG9hdChpWzNdKS8xMDAsZSk7YnJlYWs7ZGVmYXVsdDpjb25zb2xlLndhcm4oIlRIUkVFLkNvbG9yOiBVbmtub3duIGNvbG9yIG1vZGVsICIrdCl9fWVsc2UgaWYobj0vXlwjKFtBLUZhLWZcZF0rKSQvLmV4ZWModCkpe2NvbnN0IGk9blsxXSxvPWkubGVuZ3RoO2lmKG89PT0zKXJldHVybiB0aGlzLnNldFJHQihwYXJzZUludChpLmNoYXJBdCgwKSwxNikvMTUscGFyc2VJbnQoaS5jaGFyQXQoMSksMTYpLzE1LHBhcnNlSW50KGkuY2hhckF0KDIpLDE2KS8xNSxlKTtpZihvPT09NilyZXR1cm4gdGhpcy5zZXRIZXgocGFyc2VJbnQoaSwxNiksZSk7Y29uc29sZS53YXJuKCJUSFJFRS5Db2xvcjogSW52YWxpZCBoZXggY29sb3IgIit0KX1lbHNlIGlmKHQmJnQubGVuZ3RoPjApcmV0dXJuIHRoaXMuc2V0Q29sb3JOYW1lKHQsZSk7cmV0dXJuIHRoaXN9c2V0Q29sb3JOYW1lKHQsZT0kdCl7Y29uc3Qgcz1nclt0LnRvTG93ZXJDYXNlKCldO3JldHVybiBzIT09dm9pZCAwP3RoaXMuc2V0SGV4KHMsZSk6Y29uc29sZS53YXJuKCJUSFJFRS5Db2xvcjogVW5rbm93biBjb2xvciAiK3QpLHRoaXN9Y2xvbmUoKXtyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcy5yLHRoaXMuZyx0aGlzLmIpfWNvcHkodCl7cmV0dXJuIHRoaXMucj10LnIsdGhpcy5nPXQuZyx0aGlzLmI9dC5iLHRoaXN9Y29weVNSR0JUb0xpbmVhcih0KXtyZXR1cm4gdGhpcy5yPXhlKHQuciksdGhpcy5nPXhlKHQuZyksdGhpcy5iPXhlKHQuYiksdGhpc31jb3B5TGluZWFyVG9TUkdCKHQpe3JldHVybiB0aGlzLnI9Q24odC5yKSx0aGlzLmc9Q24odC5nKSx0aGlzLmI9Q24odC5iKSx0aGlzfWNvbnZlcnRTUkdCVG9MaW5lYXIoKXtyZXR1cm4gdGhpcy5jb3B5U1JHQlRvTGluZWFyKHRoaXMpLHRoaXN9Y29udmVydExpbmVhclRvU1JHQigpe3JldHVybiB0aGlzLmNvcHlMaW5lYXJUb1NSR0IodGhpcyksdGhpc31nZXRIZXgodD0kdCl7cmV0dXJuIG10LmZyb21Xb3JraW5nQ29sb3JTcGFjZShjdC5jb3B5KHRoaXMpLHQpLE1hdGgucm91bmQoYXQoY3QucioyNTUsMCwyNTUpKSo2NTUzNitNYXRoLnJvdW5kKGF0KGN0LmcqMjU1LDAsMjU1KSkqMjU2K01hdGgucm91bmQoYXQoY3QuYioyNTUsMCwyNTUpKX1nZXRIZXhTdHJpbmcodD0kdCl7cmV0dXJuKCIwMDAwMDAiK3RoaXMuZ2V0SGV4KHQpLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTYpfWdldEhTTCh0LGU9bXQud29ya2luZ0NvbG9yU3BhY2Upe210LmZyb21Xb3JraW5nQ29sb3JTcGFjZShjdC5jb3B5KHRoaXMpLGUpO2NvbnN0IHM9Y3QucixuPWN0LmcsaT1jdC5iLG89TWF0aC5tYXgocyxuLGkpLGE9TWF0aC5taW4ocyxuLGkpO2xldCBjLHU7Y29uc3QgaD0oYStvKS8yO2lmKGE9PT1vKWM9MCx1PTA7ZWxzZXtjb25zdCBsPW8tYTtzd2l0Y2godT1oPD0uNT9sLyhvK2EpOmwvKDItby1hKSxvKXtjYXNlIHM6Yz0obi1pKS9sKyhuPGk/NjowKTticmVhaztjYXNlIG46Yz0oaS1zKS9sKzI7YnJlYWs7Y2FzZSBpOmM9KHMtbikvbCs0O2JyZWFrfWMvPTZ9cmV0dXJuIHQuaD1jLHQucz11LHQubD1oLHR9Z2V0UkdCKHQsZT1tdC53b3JraW5nQ29sb3JTcGFjZSl7cmV0dXJuIG10LmZyb21Xb3JraW5nQ29sb3JTcGFjZShjdC5jb3B5KHRoaXMpLGUpLHQucj1jdC5yLHQuZz1jdC5nLHQuYj1jdC5iLHR9Z2V0U3R5bGUodD0kdCl7bXQuZnJvbVdvcmtpbmdDb2xvclNwYWNlKGN0LmNvcHkodGhpcyksdCk7Y29uc3QgZT1jdC5yLHM9Y3QuZyxuPWN0LmI7cmV0dXJuIHQhPT0kdD9gY29sb3IoJHt0fSAke2UudG9GaXhlZCgzKX0gJHtzLnRvRml4ZWQoMyl9ICR7bi50b0ZpeGVkKDMpfSlgOmByZ2IoJHtNYXRoLnJvdW5kKGUqMjU1KX0sJHtNYXRoLnJvdW5kKHMqMjU1KX0sJHtNYXRoLnJvdW5kKG4qMjU1KX0pYH1vZmZzZXRIU0wodCxlLHMpe3JldHVybiB0aGlzLmdldEhTTChpZSksdGhpcy5zZXRIU0woaWUuaCt0LGllLnMrZSxpZS5sK3MpfWFkZCh0KXtyZXR1cm4gdGhpcy5yKz10LnIsdGhpcy5nKz10LmcsdGhpcy5iKz10LmIsdGhpc31hZGRDb2xvcnModCxlKXtyZXR1cm4gdGhpcy5yPXQucitlLnIsdGhpcy5nPXQuZytlLmcsdGhpcy5iPXQuYitlLmIsdGhpc31hZGRTY2FsYXIodCl7cmV0dXJuIHRoaXMucis9dCx0aGlzLmcrPXQsdGhpcy5iKz10LHRoaXN9c3ViKHQpe3JldHVybiB0aGlzLnI9TWF0aC5tYXgoMCx0aGlzLnItdC5yKSx0aGlzLmc9TWF0aC5tYXgoMCx0aGlzLmctdC5nKSx0aGlzLmI9TWF0aC5tYXgoMCx0aGlzLmItdC5iKSx0aGlzfW11bHRpcGx5KHQpe3JldHVybiB0aGlzLnIqPXQucix0aGlzLmcqPXQuZyx0aGlzLmIqPXQuYix0aGlzfW11bHRpcGx5U2NhbGFyKHQpe3JldHVybiB0aGlzLnIqPXQsdGhpcy5nKj10LHRoaXMuYio9dCx0aGlzfWxlcnAodCxlKXtyZXR1cm4gdGhpcy5yKz0odC5yLXRoaXMucikqZSx0aGlzLmcrPSh0LmctdGhpcy5nKSplLHRoaXMuYis9KHQuYi10aGlzLmIpKmUsdGhpc31sZXJwQ29sb3JzKHQsZSxzKXtyZXR1cm4gdGhpcy5yPXQucisoZS5yLXQucikqcyx0aGlzLmc9dC5nKyhlLmctdC5nKSpzLHRoaXMuYj10LmIrKGUuYi10LmIpKnMsdGhpc31sZXJwSFNMKHQsZSl7dGhpcy5nZXRIU0woaWUpLHQuZ2V0SFNMKExzKTtjb25zdCBzPUplKGllLmgsTHMuaCxlKSxuPUplKGllLnMsTHMucyxlKSxpPUplKGllLmwsTHMubCxlKTtyZXR1cm4gdGhpcy5zZXRIU0wocyxuLGkpLHRoaXN9c2V0RnJvbVZlY3RvcjModCl7cmV0dXJuIHRoaXMucj10LngsdGhpcy5nPXQueSx0aGlzLmI9dC56LHRoaXN9YXBwbHlNYXRyaXgzKHQpe2NvbnN0IGU9dGhpcy5yLHM9dGhpcy5nLG49dGhpcy5iLGk9dC5lbGVtZW50cztyZXR1cm4gdGhpcy5yPWlbMF0qZStpWzNdKnMraVs2XSpuLHRoaXMuZz1pWzFdKmUraVs0XSpzK2lbN10qbix0aGlzLmI9aVsyXSplK2lbNV0qcytpWzhdKm4sdGhpc31lcXVhbHModCl7cmV0dXJuIHQucj09PXRoaXMuciYmdC5nPT09dGhpcy5nJiZ0LmI9PT10aGlzLmJ9ZnJvbUFycmF5KHQsZT0wKXtyZXR1cm4gdGhpcy5yPXRbZV0sdGhpcy5nPXRbZSsxXSx0aGlzLmI9dFtlKzJdLHRoaXN9dG9BcnJheSh0PVtdLGU9MCl7cmV0dXJuIHRbZV09dGhpcy5yLHRbZSsxXT10aGlzLmcsdFtlKzJdPXRoaXMuYix0fWZyb21CdWZmZXJBdHRyaWJ1dGUodCxlKXtyZXR1cm4gdGhpcy5yPXQuZ2V0WChlKSx0aGlzLmc9dC5nZXRZKGUpLHRoaXMuYj10LmdldFooZSksdGhpc310b0pTT04oKXtyZXR1cm4gdGhpcy5nZXRIZXgoKX0qW1N5bWJvbC5pdGVyYXRvcl0oKXt5aWVsZCB0aGlzLnIseWllbGQgdGhpcy5nLHlpZWxkIHRoaXMuYn19Y29uc3QgY3Q9bmV3IHFuO3FuLk5BTUVTPWdyO2NvbnN0IGo9bmV3IEEsT3M9bmV3IEo7Y2xhc3MgdnR7Y29uc3RydWN0b3IodCxlLHM9ITEpe2lmKEFycmF5LmlzQXJyYXkodCkpdGhyb3cgbmV3IFR5cGVFcnJvcigiVEhSRUUuQnVmZmVyQXR0cmlidXRlOiBhcnJheSBzaG91bGQgYmUgYSBUeXBlZCBBcnJheS4iKTt0aGlzLmlzQnVmZmVyQXR0cmlidXRlPSEwLHRoaXMubmFtZT0iIix0aGlzLmFycmF5PXQsdGhpcy5pdGVtU2l6ZT1lLHRoaXMuY291bnQ9dCE9PXZvaWQgMD90Lmxlbmd0aC9lOjAsdGhpcy5ub3JtYWxpemVkPXMsdGhpcy51c2FnZT1Dcyx0aGlzLnVwZGF0ZVJhbmdlcz1bXSx0aGlzLmdwdVR5cGU9SW8sdGhpcy52ZXJzaW9uPTB9b25VcGxvYWRDYWxsYmFjaygpe31zZXQgbmVlZHNVcGRhdGUodCl7dD09PSEwJiZ0aGlzLnZlcnNpb24rK31zZXRVc2FnZSh0KXtyZXR1cm4gdGhpcy51c2FnZT10LHRoaXN9YWRkVXBkYXRlUmFuZ2UodCxlKXt0aGlzLnVwZGF0ZVJhbmdlcy5wdXNoKHtzdGFydDp0LGNvdW50OmV9KX1jbGVhclVwZGF0ZVJhbmdlcygpe3RoaXMudXBkYXRlUmFuZ2VzLmxlbmd0aD0wfWNvcHkodCl7cmV0dXJuIHRoaXMubmFtZT10Lm5hbWUsdGhpcy5hcnJheT1uZXcgdC5hcnJheS5jb25zdHJ1Y3Rvcih0LmFycmF5KSx0aGlzLml0ZW1TaXplPXQuaXRlbVNpemUsdGhpcy5jb3VudD10LmNvdW50LHRoaXMubm9ybWFsaXplZD10Lm5vcm1hbGl6ZWQsdGhpcy51c2FnZT10LnVzYWdlLHRoaXMuZ3B1VHlwZT10LmdwdVR5cGUsdGhpc31jb3B5QXQodCxlLHMpe3QqPXRoaXMuaXRlbVNpemUscyo9ZS5pdGVtU2l6ZTtmb3IobGV0IG49MCxpPXRoaXMuaXRlbVNpemU7bjxpO24rKyl0aGlzLmFycmF5W3Qrbl09ZS5hcnJheVtzK25dO3JldHVybiB0aGlzfWNvcHlBcnJheSh0KXtyZXR1cm4gdGhpcy5hcnJheS5zZXQodCksdGhpc31hcHBseU1hdHJpeDModCl7aWYodGhpcy5pdGVtU2l6ZT09PTIpZm9yKGxldCBlPTAscz10aGlzLmNvdW50O2U8cztlKyspT3MuZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0aGlzLGUpLE9zLmFwcGx5TWF0cml4Myh0KSx0aGlzLnNldFhZKGUsT3MueCxPcy55KTtlbHNlIGlmKHRoaXMuaXRlbVNpemU9PT0zKWZvcihsZXQgZT0wLHM9dGhpcy5jb3VudDtlPHM7ZSsrKWouZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0aGlzLGUpLGouYXBwbHlNYXRyaXgzKHQpLHRoaXMuc2V0WFlaKGUsai54LGoueSxqLnopO3JldHVybiB0aGlzfWFwcGx5TWF0cml4NCh0KXtmb3IobGV0IGU9MCxzPXRoaXMuY291bnQ7ZTxzO2UrKylqLmZyb21CdWZmZXJBdHRyaWJ1dGUodGhpcyxlKSxqLmFwcGx5TWF0cml4NCh0KSx0aGlzLnNldFhZWihlLGoueCxqLnksai56KTtyZXR1cm4gdGhpc31hcHBseU5vcm1hbE1hdHJpeCh0KXtmb3IobGV0IGU9MCxzPXRoaXMuY291bnQ7ZTxzO2UrKylqLmZyb21CdWZmZXJBdHRyaWJ1dGUodGhpcyxlKSxqLmFwcGx5Tm9ybWFsTWF0cml4KHQpLHRoaXMuc2V0WFlaKGUsai54LGoueSxqLnopO3JldHVybiB0aGlzfXRyYW5zZm9ybURpcmVjdGlvbih0KXtmb3IobGV0IGU9MCxzPXRoaXMuY291bnQ7ZTxzO2UrKylqLmZyb21CdWZmZXJBdHRyaWJ1dGUodGhpcyxlKSxqLnRyYW5zZm9ybURpcmVjdGlvbih0KSx0aGlzLnNldFhZWihlLGoueCxqLnksai56KTtyZXR1cm4gdGhpc31zZXQodCxlPTApe3JldHVybiB0aGlzLmFycmF5LnNldCh0LGUpLHRoaXN9Z2V0Q29tcG9uZW50KHQsZSl7bGV0IHM9dGhpcy5hcnJheVt0KnRoaXMuaXRlbVNpemUrZV07cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKHM9RXQocyx0aGlzLmFycmF5KSksc31zZXRDb21wb25lbnQodCxlLHMpe3JldHVybiB0aGlzLm5vcm1hbGl6ZWQmJihzPSQocyx0aGlzLmFycmF5KSksdGhpcy5hcnJheVt0KnRoaXMuaXRlbVNpemUrZV09cyx0aGlzfWdldFgodCl7bGV0IGU9dGhpcy5hcnJheVt0KnRoaXMuaXRlbVNpemVdO3JldHVybiB0aGlzLm5vcm1hbGl6ZWQmJihlPUV0KGUsdGhpcy5hcnJheSkpLGV9c2V0WCh0LGUpe3JldHVybiB0aGlzLm5vcm1hbGl6ZWQmJihlPSQoZSx0aGlzLmFycmF5KSksdGhpcy5hcnJheVt0KnRoaXMuaXRlbVNpemVdPWUsdGhpc31nZXRZKHQpe2xldCBlPXRoaXMuYXJyYXlbdCp0aGlzLml0ZW1TaXplKzFdO3JldHVybiB0aGlzLm5vcm1hbGl6ZWQmJihlPUV0KGUsdGhpcy5hcnJheSkpLGV9c2V0WSh0LGUpe3JldHVybiB0aGlzLm5vcm1hbGl6ZWQmJihlPSQoZSx0aGlzLmFycmF5KSksdGhpcy5hcnJheVt0KnRoaXMuaXRlbVNpemUrMV09ZSx0aGlzfWdldFoodCl7bGV0IGU9dGhpcy5hcnJheVt0KnRoaXMuaXRlbVNpemUrMl07cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGU9RXQoZSx0aGlzLmFycmF5KSksZX1zZXRaKHQsZSl7cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGU9JChlLHRoaXMuYXJyYXkpKSx0aGlzLmFycmF5W3QqdGhpcy5pdGVtU2l6ZSsyXT1lLHRoaXN9Z2V0Vyh0KXtsZXQgZT10aGlzLmFycmF5W3QqdGhpcy5pdGVtU2l6ZSszXTtyZXR1cm4gdGhpcy5ub3JtYWxpemVkJiYoZT1FdChlLHRoaXMuYXJyYXkpKSxlfXNldFcodCxlKXtyZXR1cm4gdGhpcy5ub3JtYWxpemVkJiYoZT0kKGUsdGhpcy5hcnJheSkpLHRoaXMuYXJyYXlbdCp0aGlzLml0ZW1TaXplKzNdPWUsdGhpc31zZXRYWSh0LGUscyl7cmV0dXJuIHQqPXRoaXMuaXRlbVNpemUsdGhpcy5ub3JtYWxpemVkJiYoZT0kKGUsdGhpcy5hcnJheSkscz0kKHMsdGhpcy5hcnJheSkpLHRoaXMuYXJyYXlbdCswXT1lLHRoaXMuYXJyYXlbdCsxXT1zLHRoaXN9c2V0WFlaKHQsZSxzLG4pe3JldHVybiB0Kj10aGlzLml0ZW1TaXplLHRoaXMubm9ybWFsaXplZCYmKGU9JChlLHRoaXMuYXJyYXkpLHM9JChzLHRoaXMuYXJyYXkpLG49JChuLHRoaXMuYXJyYXkpKSx0aGlzLmFycmF5W3QrMF09ZSx0aGlzLmFycmF5W3QrMV09cyx0aGlzLmFycmF5W3QrMl09bix0aGlzfXNldFhZWlcodCxlLHMsbixpKXtyZXR1cm4gdCo9dGhpcy5pdGVtU2l6ZSx0aGlzLm5vcm1hbGl6ZWQmJihlPSQoZSx0aGlzLmFycmF5KSxzPSQocyx0aGlzLmFycmF5KSxuPSQobix0aGlzLmFycmF5KSxpPSQoaSx0aGlzLmFycmF5KSksdGhpcy5hcnJheVt0KzBdPWUsdGhpcy5hcnJheVt0KzFdPXMsdGhpcy5hcnJheVt0KzJdPW4sdGhpcy5hcnJheVt0KzNdPWksdGhpc31vblVwbG9hZCh0KXtyZXR1cm4gdGhpcy5vblVwbG9hZENhbGxiYWNrPXQsdGhpc31jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLmFycmF5LHRoaXMuaXRlbVNpemUpLmNvcHkodGhpcyl9dG9KU09OKCl7Y29uc3QgdD17aXRlbVNpemU6dGhpcy5pdGVtU2l6ZSx0eXBlOnRoaXMuYXJyYXkuY29uc3RydWN0b3IubmFtZSxhcnJheTpBcnJheS5mcm9tKHRoaXMuYXJyYXkpLG5vcm1hbGl6ZWQ6dGhpcy5ub3JtYWxpemVkfTtyZXR1cm4gdGhpcy5uYW1lIT09IiImJih0Lm5hbWU9dGhpcy5uYW1lKSx0aGlzLnVzYWdlIT09Q3MmJih0LnVzYWdlPXRoaXMudXNhZ2UpLHR9fWNsYXNzIG1hIGV4dGVuZHMgdnR7Y29uc3RydWN0b3IodCxlLHMpe3N1cGVyKG5ldyBVaW50MTZBcnJheSh0KSxlLHMpfX1jbGFzcyB5YSBleHRlbmRzIHZ0e2NvbnN0cnVjdG9yKHQsZSxzKXtzdXBlcihuZXcgVWludDMyQXJyYXkodCksZSxzKX19Y2xhc3MgZ2EgZXh0ZW5kcyB2dHtjb25zdHJ1Y3Rvcih0LGUscyl7c3VwZXIobmV3IEZsb2F0MzJBcnJheSh0KSxlLHMpfX1sZXQgeGE9MDtjb25zdCBBdD1uZXcgbnQsJG49bmV3IG5lLEVlPW5ldyBBLGd0PW5ldyBodCxzcz1uZXcgaHQsaXQ9bmV3IEE7Y2xhc3MgR24gZXh0ZW5kcyBaZXtjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5pc0J1ZmZlckdlb21ldHJ5PSEwLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCJpZCIse3ZhbHVlOnhhKyt9KSx0aGlzLnV1aWQ9S3QoKSx0aGlzLm5hbWU9IiIsdGhpcy50eXBlPSJCdWZmZXJHZW9tZXRyeSIsdGhpcy5pbmRleD1udWxsLHRoaXMuYXR0cmlidXRlcz17fSx0aGlzLm1vcnBoQXR0cmlidXRlcz17fSx0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlPSExLHRoaXMuZ3JvdXBzPVtdLHRoaXMuYm91bmRpbmdCb3g9bnVsbCx0aGlzLmJvdW5kaW5nU3BoZXJlPW51bGwsdGhpcy5kcmF3UmFuZ2U9e3N0YXJ0OjAsY291bnQ6MS8wfSx0aGlzLnVzZXJEYXRhPXt9fWdldEluZGV4KCl7cmV0dXJuIHRoaXMuaW5kZXh9c2V0SW5kZXgodCl7cmV0dXJuIEFycmF5LmlzQXJyYXkodCk/dGhpcy5pbmRleD1uZXcoc2EodCk/eWE6bWEpKHQsMSk6dGhpcy5pbmRleD10LHRoaXN9Z2V0QXR0cmlidXRlKHQpe3JldHVybiB0aGlzLmF0dHJpYnV0ZXNbdF19c2V0QXR0cmlidXRlKHQsZSl7cmV0dXJuIHRoaXMuYXR0cmlidXRlc1t0XT1lLHRoaXN9ZGVsZXRlQXR0cmlidXRlKHQpe3JldHVybiBkZWxldGUgdGhpcy5hdHRyaWJ1dGVzW3RdLHRoaXN9aGFzQXR0cmlidXRlKHQpe3JldHVybiB0aGlzLmF0dHJpYnV0ZXNbdF0hPT12b2lkIDB9YWRkR3JvdXAodCxlLHM9MCl7dGhpcy5ncm91cHMucHVzaCh7c3RhcnQ6dCxjb3VudDplLG1hdGVyaWFsSW5kZXg6c30pfWNsZWFyR3JvdXBzKCl7dGhpcy5ncm91cHM9W119c2V0RHJhd1JhbmdlKHQsZSl7dGhpcy5kcmF3UmFuZ2Uuc3RhcnQ9dCx0aGlzLmRyYXdSYW5nZS5jb3VudD1lfWFwcGx5TWF0cml4NCh0KXtjb25zdCBlPXRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbjtlIT09dm9pZCAwJiYoZS5hcHBseU1hdHJpeDQodCksZS5uZWVkc1VwZGF0ZT0hMCk7Y29uc3Qgcz10aGlzLmF0dHJpYnV0ZXMubm9ybWFsO2lmKHMhPT12b2lkIDApe2NvbnN0IGk9bmV3IEN0KCkuZ2V0Tm9ybWFsTWF0cml4KHQpO3MuYXBwbHlOb3JtYWxNYXRyaXgoaSkscy5uZWVkc1VwZGF0ZT0hMH1jb25zdCBuPXRoaXMuYXR0cmlidXRlcy50YW5nZW50O3JldHVybiBuIT09dm9pZCAwJiYobi50cmFuc2Zvcm1EaXJlY3Rpb24odCksbi5uZWVkc1VwZGF0ZT0hMCksdGhpcy5ib3VuZGluZ0JveCE9PW51bGwmJnRoaXMuY29tcHV0ZUJvdW5kaW5nQm94KCksdGhpcy5ib3VuZGluZ1NwaGVyZSE9PW51bGwmJnRoaXMuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCksdGhpc31hcHBseVF1YXRlcm5pb24odCl7cmV0dXJuIEF0Lm1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKHQpLHRoaXMuYXBwbHlNYXRyaXg0KEF0KSx0aGlzfXJvdGF0ZVgodCl7cmV0dXJuIEF0Lm1ha2VSb3RhdGlvblgodCksdGhpcy5hcHBseU1hdHJpeDQoQXQpLHRoaXN9cm90YXRlWSh0KXtyZXR1cm4gQXQubWFrZVJvdGF0aW9uWSh0KSx0aGlzLmFwcGx5TWF0cml4NChBdCksdGhpc31yb3RhdGVaKHQpe3JldHVybiBBdC5tYWtlUm90YXRpb25aKHQpLHRoaXMuYXBwbHlNYXRyaXg0KEF0KSx0aGlzfXRyYW5zbGF0ZSh0LGUscyl7cmV0dXJuIEF0Lm1ha2VUcmFuc2xhdGlvbih0LGUscyksdGhpcy5hcHBseU1hdHJpeDQoQXQpLHRoaXN9c2NhbGUodCxlLHMpe3JldHVybiBBdC5tYWtlU2NhbGUodCxlLHMpLHRoaXMuYXBwbHlNYXRyaXg0KEF0KSx0aGlzfWxvb2tBdCh0KXtyZXR1cm4gJG4ubG9va0F0KHQpLCRuLnVwZGF0ZU1hdHJpeCgpLHRoaXMuYXBwbHlNYXRyaXg0KCRuLm1hdHJpeCksdGhpc31jZW50ZXIoKXtyZXR1cm4gdGhpcy5jb21wdXRlQm91bmRpbmdCb3goKSx0aGlzLmJvdW5kaW5nQm94LmdldENlbnRlcihFZSkubmVnYXRlKCksdGhpcy50cmFuc2xhdGUoRWUueCxFZS55LEVlLnopLHRoaXN9c2V0RnJvbVBvaW50cyh0KXtjb25zdCBlPVtdO2ZvcihsZXQgcz0wLG49dC5sZW5ndGg7czxuO3MrKyl7Y29uc3QgaT10W3NdO2UucHVzaChpLngsaS55LGkuenx8MCl9cmV0dXJuIHRoaXMuc2V0QXR0cmlidXRlKCJwb3NpdGlvbiIsbmV3IGdhKGUsMykpLHRoaXN9Y29tcHV0ZUJvdW5kaW5nQm94KCl7dGhpcy5ib3VuZGluZ0JveD09PW51bGwmJih0aGlzLmJvdW5kaW5nQm94PW5ldyBodCk7Y29uc3QgdD10aGlzLmF0dHJpYnV0ZXMucG9zaXRpb24sZT10aGlzLm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbjtpZih0JiZ0LmlzR0xCdWZmZXJBdHRyaWJ1dGUpe2NvbnNvbGUuZXJyb3IoIlRIUkVFLkJ1ZmZlckdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ0JveCgpOiBHTEJ1ZmZlckF0dHJpYnV0ZSByZXF1aXJlcyBhIG1hbnVhbCBib3VuZGluZyBib3guIix0aGlzKSx0aGlzLmJvdW5kaW5nQm94LnNldChuZXcgQSgtMS8wLC0xLzAsLTEvMCksbmV3IEEoMS8wLDEvMCwxLzApKTtyZXR1cm59aWYodCE9PXZvaWQgMCl7aWYodGhpcy5ib3VuZGluZ0JveC5zZXRGcm9tQnVmZmVyQXR0cmlidXRlKHQpLGUpZm9yKGxldCBzPTAsbj1lLmxlbmd0aDtzPG47cysrKXtjb25zdCBpPWVbc107Z3Quc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZShpKSx0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlPyhpdC5hZGRWZWN0b3JzKHRoaXMuYm91bmRpbmdCb3gubWluLGd0Lm1pbiksdGhpcy5ib3VuZGluZ0JveC5leHBhbmRCeVBvaW50KGl0KSxpdC5hZGRWZWN0b3JzKHRoaXMuYm91bmRpbmdCb3gubWF4LGd0Lm1heCksdGhpcy5ib3VuZGluZ0JveC5leHBhbmRCeVBvaW50KGl0KSk6KHRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludChndC5taW4pLHRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludChndC5tYXgpKX19ZWxzZSB0aGlzLmJvdW5kaW5nQm94Lm1ha2VFbXB0eSgpOyhpc05hTih0aGlzLmJvdW5kaW5nQm94Lm1pbi54KXx8aXNOYU4odGhpcy5ib3VuZGluZ0JveC5taW4ueSl8fGlzTmFOKHRoaXMuYm91bmRpbmdCb3gubWluLnopKSYmY29uc29sZS5lcnJvcignVEhSRUUuQnVmZmVyR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nQm94KCk6IENvbXB1dGVkIG1pbi9tYXggaGF2ZSBOYU4gdmFsdWVzLiBUaGUgInBvc2l0aW9uIiBhdHRyaWJ1dGUgaXMgbGlrZWx5IHRvIGhhdmUgTmFOIHZhbHVlcy4nLHRoaXMpfWNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpe3RoaXMuYm91bmRpbmdTcGhlcmU9PT1udWxsJiYodGhpcy5ib3VuZGluZ1NwaGVyZT1uZXcgY3IpO2NvbnN0IHQ9dGhpcy5hdHRyaWJ1dGVzLnBvc2l0aW9uLGU9dGhpcy5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb247aWYodCYmdC5pc0dMQnVmZmVyQXR0cmlidXRlKXtjb25zb2xlLmVycm9yKCJUSFJFRS5CdWZmZXJHZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTogR0xCdWZmZXJBdHRyaWJ1dGUgcmVxdWlyZXMgYSBtYW51YWwgYm91bmRpbmcgc3BoZXJlLiIsdGhpcyksdGhpcy5ib3VuZGluZ1NwaGVyZS5zZXQobmV3IEEsMS8wKTtyZXR1cm59aWYodCl7Y29uc3Qgcz10aGlzLmJvdW5kaW5nU3BoZXJlLmNlbnRlcjtpZihndC5zZXRGcm9tQnVmZmVyQXR0cmlidXRlKHQpLGUpZm9yKGxldCBpPTAsbz1lLmxlbmd0aDtpPG87aSsrKXtjb25zdCBhPWVbaV07c3Muc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZShhKSx0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlPyhpdC5hZGRWZWN0b3JzKGd0Lm1pbixzcy5taW4pLGd0LmV4cGFuZEJ5UG9pbnQoaXQpLGl0LmFkZFZlY3RvcnMoZ3QubWF4LHNzLm1heCksZ3QuZXhwYW5kQnlQb2ludChpdCkpOihndC5leHBhbmRCeVBvaW50KHNzLm1pbiksZ3QuZXhwYW5kQnlQb2ludChzcy5tYXgpKX1ndC5nZXRDZW50ZXIocyk7bGV0IG49MDtmb3IobGV0IGk9MCxvPXQuY291bnQ7aTxvO2krKylpdC5mcm9tQnVmZmVyQXR0cmlidXRlKHQsaSksbj1NYXRoLm1heChuLHMuZGlzdGFuY2VUb1NxdWFyZWQoaXQpKTtpZihlKWZvcihsZXQgaT0wLG89ZS5sZW5ndGg7aTxvO2krKyl7Y29uc3QgYT1lW2ldLGM9dGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZTtmb3IobGV0IHU9MCxoPWEuY291bnQ7dTxoO3UrKylpdC5mcm9tQnVmZmVyQXR0cmlidXRlKGEsdSksYyYmKEVlLmZyb21CdWZmZXJBdHRyaWJ1dGUodCx1KSxpdC5hZGQoRWUpKSxuPU1hdGgubWF4KG4scy5kaXN0YW5jZVRvU3F1YXJlZChpdCkpfXRoaXMuYm91bmRpbmdTcGhlcmUucmFkaXVzPU1hdGguc3FydChuKSxpc05hTih0aGlzLmJvdW5kaW5nU3BoZXJlLnJhZGl1cykmJmNvbnNvbGUuZXJyb3IoJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOiBDb21wdXRlZCByYWRpdXMgaXMgTmFOLiBUaGUgInBvc2l0aW9uIiBhdHRyaWJ1dGUgaXMgbGlrZWx5IHRvIGhhdmUgTmFOIHZhbHVlcy4nLHRoaXMpfX1jb21wdXRlVGFuZ2VudHMoKXtjb25zdCB0PXRoaXMuaW5kZXgsZT10aGlzLmF0dHJpYnV0ZXM7aWYodD09PW51bGx8fGUucG9zaXRpb249PT12b2lkIDB8fGUubm9ybWFsPT09dm9pZCAwfHxlLnV2PT09dm9pZCAwKXtjb25zb2xlLmVycm9yKCJUSFJFRS5CdWZmZXJHZW9tZXRyeTogLmNvbXB1dGVUYW5nZW50cygpIGZhaWxlZC4gTWlzc2luZyByZXF1aXJlZCBhdHRyaWJ1dGVzIChpbmRleCwgcG9zaXRpb24sIG5vcm1hbCBvciB1dikiKTtyZXR1cm59Y29uc3Qgcz1lLnBvc2l0aW9uLG49ZS5ub3JtYWwsaT1lLnV2O3RoaXMuaGFzQXR0cmlidXRlKCJ0YW5nZW50Iik9PT0hMSYmdGhpcy5zZXRBdHRyaWJ1dGUoInRhbmdlbnQiLG5ldyB2dChuZXcgRmxvYXQzMkFycmF5KDQqcy5jb3VudCksNCkpO2NvbnN0IG89dGhpcy5nZXRBdHRyaWJ1dGUoInRhbmdlbnQiKSxhPVtdLGM9W107Zm9yKGxldCBFPTA7RTxzLmNvdW50O0UrKylhW0VdPW5ldyBBLGNbRV09bmV3IEE7Y29uc3QgdT1uZXcgQSxoPW5ldyBBLGw9bmV3IEEsZD1uZXcgSixmPW5ldyBKLHA9bmV3IEosbT1uZXcgQSxnPW5ldyBBO2Z1bmN0aW9uIHkoRSxGLFIpe3UuZnJvbUJ1ZmZlckF0dHJpYnV0ZShzLEUpLGguZnJvbUJ1ZmZlckF0dHJpYnV0ZShzLEYpLGwuZnJvbUJ1ZmZlckF0dHJpYnV0ZShzLFIpLGQuZnJvbUJ1ZmZlckF0dHJpYnV0ZShpLEUpLGYuZnJvbUJ1ZmZlckF0dHJpYnV0ZShpLEYpLHAuZnJvbUJ1ZmZlckF0dHJpYnV0ZShpLFIpLGguc3ViKHUpLGwuc3ViKHUpLGYuc3ViKGQpLHAuc3ViKGQpO2NvbnN0IEk9MS8oZi54KnAueS1wLngqZi55KTtpc0Zpbml0ZShJKSYmKG0uY29weShoKS5tdWx0aXBseVNjYWxhcihwLnkpLmFkZFNjYWxlZFZlY3RvcihsLC1mLnkpLm11bHRpcGx5U2NhbGFyKEkpLGcuY29weShsKS5tdWx0aXBseVNjYWxhcihmLngpLmFkZFNjYWxlZFZlY3RvcihoLC1wLngpLm11bHRpcGx5U2NhbGFyKEkpLGFbRV0uYWRkKG0pLGFbRl0uYWRkKG0pLGFbUl0uYWRkKG0pLGNbRV0uYWRkKGcpLGNbRl0uYWRkKGcpLGNbUl0uYWRkKGcpKX1sZXQgVD10aGlzLmdyb3VwcztULmxlbmd0aD09PTAmJihUPVt7c3RhcnQ6MCxjb3VudDp0LmNvdW50fV0pO2ZvcihsZXQgRT0wLEY9VC5sZW5ndGg7RTxGOysrRSl7Y29uc3QgUj1UW0VdLEk9Ui5zdGFydCxCPVIuY291bnQ7Zm9yKGxldCBQPUksTD1JK0I7UDxMO1ArPTMpeSh0LmdldFgoUCswKSx0LmdldFgoUCsxKSx0LmdldFgoUCsyKSl9Y29uc3Qgdz1uZXcgQSxNPW5ldyBBLE49bmV3IEEsXz1uZXcgQTtmdW5jdGlvbiBTKEUpe04uZnJvbUJ1ZmZlckF0dHJpYnV0ZShuLEUpLF8uY29weShOKTtjb25zdCBGPWFbRV07dy5jb3B5KEYpLHcuc3ViKE4ubXVsdGlwbHlTY2FsYXIoTi5kb3QoRikpKS5ub3JtYWxpemUoKSxNLmNyb3NzVmVjdG9ycyhfLEYpO2NvbnN0IEk9TS5kb3QoY1tFXSk8MD8tMToxO28uc2V0WFlaVyhFLHcueCx3Lnksdy56LEkpfWZvcihsZXQgRT0wLEY9VC5sZW5ndGg7RTxGOysrRSl7Y29uc3QgUj1UW0VdLEk9Ui5zdGFydCxCPVIuY291bnQ7Zm9yKGxldCBQPUksTD1JK0I7UDxMO1ArPTMpUyh0LmdldFgoUCswKSksUyh0LmdldFgoUCsxKSksUyh0LmdldFgoUCsyKSl9fWNvbXB1dGVWZXJ0ZXhOb3JtYWxzKCl7Y29uc3QgdD10aGlzLmluZGV4LGU9dGhpcy5nZXRBdHRyaWJ1dGUoInBvc2l0aW9uIik7aWYoZSE9PXZvaWQgMCl7bGV0IHM9dGhpcy5nZXRBdHRyaWJ1dGUoIm5vcm1hbCIpO2lmKHM9PT12b2lkIDApcz1uZXcgdnQobmV3IEZsb2F0MzJBcnJheShlLmNvdW50KjMpLDMpLHRoaXMuc2V0QXR0cmlidXRlKCJub3JtYWwiLHMpO2Vsc2UgZm9yKGxldCBkPTAsZj1zLmNvdW50O2Q8ZjtkKyspcy5zZXRYWVooZCwwLDAsMCk7Y29uc3Qgbj1uZXcgQSxpPW5ldyBBLG89bmV3IEEsYT1uZXcgQSxjPW5ldyBBLHU9bmV3IEEsaD1uZXcgQSxsPW5ldyBBO2lmKHQpZm9yKGxldCBkPTAsZj10LmNvdW50O2Q8ZjtkKz0zKXtjb25zdCBwPXQuZ2V0WChkKzApLG09dC5nZXRYKGQrMSksZz10LmdldFgoZCsyKTtuLmZyb21CdWZmZXJBdHRyaWJ1dGUoZSxwKSxpLmZyb21CdWZmZXJBdHRyaWJ1dGUoZSxtKSxvLmZyb21CdWZmZXJBdHRyaWJ1dGUoZSxnKSxoLnN1YlZlY3RvcnMobyxpKSxsLnN1YlZlY3RvcnMobixpKSxoLmNyb3NzKGwpLGEuZnJvbUJ1ZmZlckF0dHJpYnV0ZShzLHApLGMuZnJvbUJ1ZmZlckF0dHJpYnV0ZShzLG0pLHUuZnJvbUJ1ZmZlckF0dHJpYnV0ZShzLGcpLGEuYWRkKGgpLGMuYWRkKGgpLHUuYWRkKGgpLHMuc2V0WFlaKHAsYS54LGEueSxhLnopLHMuc2V0WFlaKG0sYy54LGMueSxjLnopLHMuc2V0WFlaKGcsdS54LHUueSx1LnopfWVsc2UgZm9yKGxldCBkPTAsZj1lLmNvdW50O2Q8ZjtkKz0zKW4uZnJvbUJ1ZmZlckF0dHJpYnV0ZShlLGQrMCksaS5mcm9tQnVmZmVyQXR0cmlidXRlKGUsZCsxKSxvLmZyb21CdWZmZXJBdHRyaWJ1dGUoZSxkKzIpLGguc3ViVmVjdG9ycyhvLGkpLGwuc3ViVmVjdG9ycyhuLGkpLGguY3Jvc3MobCkscy5zZXRYWVooZCswLGgueCxoLnksaC56KSxzLnNldFhZWihkKzEsaC54LGgueSxoLnopLHMuc2V0WFlaKGQrMixoLngsaC55LGgueik7dGhpcy5ub3JtYWxpemVOb3JtYWxzKCkscy5uZWVkc1VwZGF0ZT0hMH19bm9ybWFsaXplTm9ybWFscygpe2NvbnN0IHQ9dGhpcy5hdHRyaWJ1dGVzLm5vcm1hbDtmb3IobGV0IGU9MCxzPXQuY291bnQ7ZTxzO2UrKylpdC5mcm9tQnVmZmVyQXR0cmlidXRlKHQsZSksaXQubm9ybWFsaXplKCksdC5zZXRYWVooZSxpdC54LGl0LnksaXQueil9dG9Ob25JbmRleGVkKCl7ZnVuY3Rpb24gdChhLGMpe2NvbnN0IHU9YS5hcnJheSxoPWEuaXRlbVNpemUsbD1hLm5vcm1hbGl6ZWQsZD1uZXcgdS5jb25zdHJ1Y3RvcihjLmxlbmd0aCpoKTtsZXQgZj0wLHA9MDtmb3IobGV0IG09MCxnPWMubGVuZ3RoO208ZzttKyspe2EuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZT9mPWNbbV0qYS5kYXRhLnN0cmlkZSthLm9mZnNldDpmPWNbbV0qaDtmb3IobGV0IHk9MDt5PGg7eSsrKWRbcCsrXT11W2YrK119cmV0dXJuIG5ldyB2dChkLGgsbCl9aWYodGhpcy5pbmRleD09PW51bGwpcmV0dXJuIGNvbnNvbGUud2FybigiVEhSRUUuQnVmZmVyR2VvbWV0cnkudG9Ob25JbmRleGVkKCk6IEJ1ZmZlckdlb21ldHJ5IGlzIGFscmVhZHkgbm9uLWluZGV4ZWQuIiksdGhpcztjb25zdCBlPW5ldyBHbixzPXRoaXMuaW5kZXguYXJyYXksbj10aGlzLmF0dHJpYnV0ZXM7Zm9yKGNvbnN0IGEgaW4gbil7Y29uc3QgYz1uW2FdLHU9dChjLHMpO2Uuc2V0QXR0cmlidXRlKGEsdSl9Y29uc3QgaT10aGlzLm1vcnBoQXR0cmlidXRlcztmb3IoY29uc3QgYSBpbiBpKXtjb25zdCBjPVtdLHU9aVthXTtmb3IobGV0IGg9MCxsPXUubGVuZ3RoO2g8bDtoKyspe2NvbnN0IGQ9dVtoXSxmPXQoZCxzKTtjLnB1c2goZil9ZS5tb3JwaEF0dHJpYnV0ZXNbYV09Y31lLm1vcnBoVGFyZ2V0c1JlbGF0aXZlPXRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU7Y29uc3Qgbz10aGlzLmdyb3Vwcztmb3IobGV0IGE9MCxjPW8ubGVuZ3RoO2E8YzthKyspe2NvbnN0IHU9b1thXTtlLmFkZEdyb3VwKHUuc3RhcnQsdS5jb3VudCx1Lm1hdGVyaWFsSW5kZXgpfXJldHVybiBlfXRvSlNPTigpe2NvbnN0IHQ9e21ldGFkYXRhOnt2ZXJzaW9uOjQuNix0eXBlOiJCdWZmZXJHZW9tZXRyeSIsZ2VuZXJhdG9yOiJCdWZmZXJHZW9tZXRyeS50b0pTT04ifX07aWYodC51dWlkPXRoaXMudXVpZCx0LnR5cGU9dGhpcy50eXBlLHRoaXMubmFtZSE9PSIiJiYodC5uYW1lPXRoaXMubmFtZSksT2JqZWN0LmtleXModGhpcy51c2VyRGF0YSkubGVuZ3RoPjAmJih0LnVzZXJEYXRhPXRoaXMudXNlckRhdGEpLHRoaXMucGFyYW1ldGVycyE9PXZvaWQgMCl7Y29uc3QgYz10aGlzLnBhcmFtZXRlcnM7Zm9yKGNvbnN0IHUgaW4gYyljW3VdIT09dm9pZCAwJiYodFt1XT1jW3VdKTtyZXR1cm4gdH10LmRhdGE9e2F0dHJpYnV0ZXM6e319O2NvbnN0IGU9dGhpcy5pbmRleDtlIT09bnVsbCYmKHQuZGF0YS5pbmRleD17dHlwZTplLmFycmF5LmNvbnN0cnVjdG9yLm5hbWUsYXJyYXk6QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZS5hcnJheSl9KTtjb25zdCBzPXRoaXMuYXR0cmlidXRlcztmb3IoY29uc3QgYyBpbiBzKXtjb25zdCB1PXNbY107dC5kYXRhLmF0dHJpYnV0ZXNbY109dS50b0pTT04odC5kYXRhKX1jb25zdCBuPXt9O2xldCBpPSExO2Zvcihjb25zdCBjIGluIHRoaXMubW9ycGhBdHRyaWJ1dGVzKXtjb25zdCB1PXRoaXMubW9ycGhBdHRyaWJ1dGVzW2NdLGg9W107Zm9yKGxldCBsPTAsZD11Lmxlbmd0aDtsPGQ7bCsrKXtjb25zdCBmPXVbbF07aC5wdXNoKGYudG9KU09OKHQuZGF0YSkpfWgubGVuZ3RoPjAmJihuW2NdPWgsaT0hMCl9aSYmKHQuZGF0YS5tb3JwaEF0dHJpYnV0ZXM9bix0LmRhdGEubW9ycGhUYXJnZXRzUmVsYXRpdmU9dGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZSk7Y29uc3Qgbz10aGlzLmdyb3VwcztvLmxlbmd0aD4wJiYodC5kYXRhLmdyb3Vwcz1KU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG8pKSk7Y29uc3QgYT10aGlzLmJvdW5kaW5nU3BoZXJlO3JldHVybiBhIT09bnVsbCYmKHQuZGF0YS5ib3VuZGluZ1NwaGVyZT17Y2VudGVyOmEuY2VudGVyLnRvQXJyYXkoKSxyYWRpdXM6YS5yYWRpdXN9KSx0fWNsb25lKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSh0aGlzKX1jb3B5KHQpe3RoaXMuaW5kZXg9bnVsbCx0aGlzLmF0dHJpYnV0ZXM9e30sdGhpcy5tb3JwaEF0dHJpYnV0ZXM9e30sdGhpcy5ncm91cHM9W10sdGhpcy5ib3VuZGluZ0JveD1udWxsLHRoaXMuYm91bmRpbmdTcGhlcmU9bnVsbDtjb25zdCBlPXt9O3RoaXMubmFtZT10Lm5hbWU7Y29uc3Qgcz10LmluZGV4O3MhPT1udWxsJiZ0aGlzLnNldEluZGV4KHMuY2xvbmUoZSkpO2NvbnN0IG49dC5hdHRyaWJ1dGVzO2Zvcihjb25zdCB1IGluIG4pe2NvbnN0IGg9blt1XTt0aGlzLnNldEF0dHJpYnV0ZSh1LGguY2xvbmUoZSkpfWNvbnN0IGk9dC5tb3JwaEF0dHJpYnV0ZXM7Zm9yKGNvbnN0IHUgaW4gaSl7Y29uc3QgaD1bXSxsPWlbdV07Zm9yKGxldCBkPTAsZj1sLmxlbmd0aDtkPGY7ZCsrKWgucHVzaChsW2RdLmNsb25lKGUpKTt0aGlzLm1vcnBoQXR0cmlidXRlc1t1XT1ofXRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU9dC5tb3JwaFRhcmdldHNSZWxhdGl2ZTtjb25zdCBvPXQuZ3JvdXBzO2ZvcihsZXQgdT0wLGg9by5sZW5ndGg7dTxoO3UrKyl7Y29uc3QgbD1vW3VdO3RoaXMuYWRkR3JvdXAobC5zdGFydCxsLmNvdW50LGwubWF0ZXJpYWxJbmRleCl9Y29uc3QgYT10LmJvdW5kaW5nQm94O2EhPT1udWxsJiYodGhpcy5ib3VuZGluZ0JveD1hLmNsb25lKCkpO2NvbnN0IGM9dC5ib3VuZGluZ1NwaGVyZTtyZXR1cm4gYyE9PW51bGwmJih0aGlzLmJvdW5kaW5nU3BoZXJlPWMuY2xvbmUoKSksdGhpcy5kcmF3UmFuZ2Uuc3RhcnQ9dC5kcmF3UmFuZ2Uuc3RhcnQsdGhpcy5kcmF3UmFuZ2UuY291bnQ9dC5kcmF3UmFuZ2UuY291bnQsdGhpcy51c2VyRGF0YT10LnVzZXJEYXRhLHRoaXN9ZGlzcG9zZSgpe3RoaXMuZGlzcGF0Y2hFdmVudCh7dHlwZToiZGlzcG9zZSJ9KX19Y29uc3QgV249bmV3IEEsVGE9bmV3IEEsTmE9bmV3IEN0O2NsYXNzIFhue2NvbnN0cnVjdG9yKHQ9bmV3IEEoMSwwLDApLGU9MCl7dGhpcy5pc1BsYW5lPSEwLHRoaXMubm9ybWFsPXQsdGhpcy5jb25zdGFudD1lfXNldCh0LGUpe3JldHVybiB0aGlzLm5vcm1hbC5jb3B5KHQpLHRoaXMuY29uc3RhbnQ9ZSx0aGlzfXNldENvbXBvbmVudHModCxlLHMsbil7cmV0dXJuIHRoaXMubm9ybWFsLnNldCh0LGUscyksdGhpcy5jb25zdGFudD1uLHRoaXN9c2V0RnJvbU5vcm1hbEFuZENvcGxhbmFyUG9pbnQodCxlKXtyZXR1cm4gdGhpcy5ub3JtYWwuY29weSh0KSx0aGlzLmNvbnN0YW50PS1lLmRvdCh0aGlzLm5vcm1hbCksdGhpc31zZXRGcm9tQ29wbGFuYXJQb2ludHModCxlLHMpe2NvbnN0IG49V24uc3ViVmVjdG9ycyhzLGUpLmNyb3NzKFRhLnN1YlZlY3RvcnModCxlKSkubm9ybWFsaXplKCk7cmV0dXJuIHRoaXMuc2V0RnJvbU5vcm1hbEFuZENvcGxhbmFyUG9pbnQobix0KSx0aGlzfWNvcHkodCl7cmV0dXJuIHRoaXMubm9ybWFsLmNvcHkodC5ub3JtYWwpLHRoaXMuY29uc3RhbnQ9dC5jb25zdGFudCx0aGlzfW5vcm1hbGl6ZSgpe2NvbnN0IHQ9MS90aGlzLm5vcm1hbC5sZW5ndGgoKTtyZXR1cm4gdGhpcy5ub3JtYWwubXVsdGlwbHlTY2FsYXIodCksdGhpcy5jb25zdGFudCo9dCx0aGlzfW5lZ2F0ZSgpe3JldHVybiB0aGlzLmNvbnN0YW50Kj0tMSx0aGlzLm5vcm1hbC5uZWdhdGUoKSx0aGlzfWRpc3RhbmNlVG9Qb2ludCh0KXtyZXR1cm4gdGhpcy5ub3JtYWwuZG90KHQpK3RoaXMuY29uc3RhbnR9ZGlzdGFuY2VUb1NwaGVyZSh0KXtyZXR1cm4gdGhpcy5kaXN0YW5jZVRvUG9pbnQodC5jZW50ZXIpLXQucmFkaXVzfXByb2plY3RQb2ludCh0LGUpe3JldHVybiBlLmNvcHkodCkuYWRkU2NhbGVkVmVjdG9yKHRoaXMubm9ybWFsLC10aGlzLmRpc3RhbmNlVG9Qb2ludCh0KSl9aW50ZXJzZWN0TGluZSh0LGUpe2NvbnN0IHM9dC5kZWx0YShXbiksbj10aGlzLm5vcm1hbC5kb3Qocyk7aWYobj09PTApcmV0dXJuIHRoaXMuZGlzdGFuY2VUb1BvaW50KHQuc3RhcnQpPT09MD9lLmNvcHkodC5zdGFydCk6bnVsbDtjb25zdCBpPS0odC5zdGFydC5kb3QodGhpcy5ub3JtYWwpK3RoaXMuY29uc3RhbnQpL247cmV0dXJuIGk8MHx8aT4xP251bGw6ZS5jb3B5KHQuc3RhcnQpLmFkZFNjYWxlZFZlY3RvcihzLGkpfWludGVyc2VjdHNMaW5lKHQpe2NvbnN0IGU9dGhpcy5kaXN0YW5jZVRvUG9pbnQodC5zdGFydCkscz10aGlzLmRpc3RhbmNlVG9Qb2ludCh0LmVuZCk7cmV0dXJuIGU8MCYmcz4wfHxzPDAmJmU+MH1pbnRlcnNlY3RzQm94KHQpe3JldHVybiB0LmludGVyc2VjdHNQbGFuZSh0aGlzKX1pbnRlcnNlY3RzU3BoZXJlKHQpe3JldHVybiB0LmludGVyc2VjdHNQbGFuZSh0aGlzKX1jb3BsYW5hclBvaW50KHQpe3JldHVybiB0LmNvcHkodGhpcy5ub3JtYWwpLm11bHRpcGx5U2NhbGFyKC10aGlzLmNvbnN0YW50KX1hcHBseU1hdHJpeDQodCxlKXtjb25zdCBzPWV8fE5hLmdldE5vcm1hbE1hdHJpeCh0KSxuPXRoaXMuY29wbGFuYXJQb2ludChXbikuYXBwbHlNYXRyaXg0KHQpLGk9dGhpcy5ub3JtYWwuYXBwbHlNYXRyaXgzKHMpLm5vcm1hbGl6ZSgpO3JldHVybiB0aGlzLmNvbnN0YW50PS1uLmRvdChpKSx0aGlzfXRyYW5zbGF0ZSh0KXtyZXR1cm4gdGhpcy5jb25zdGFudC09dC5kb3QodGhpcy5ub3JtYWwpLHRoaXN9ZXF1YWxzKHQpe3JldHVybiB0Lm5vcm1hbC5lcXVhbHModGhpcy5ub3JtYWwpJiZ0LmNvbnN0YW50PT09dGhpcy5jb25zdGFudH1jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkodGhpcyl9fWNsYXNzIHhyIGV4dGVuZHMgRHR7Y29uc3RydWN0b3IodCxlLHMsbixpLG8sYSxjLHUsaD1Tbil7aWYoaCE9PVNuJiZoIT09WGkpdGhyb3cgbmV3IEVycm9yKCJEZXB0aFRleHR1cmUgZm9ybWF0IG11c3QgYmUgZWl0aGVyIFRIUkVFLkRlcHRoRm9ybWF0IG9yIFRIUkVFLkRlcHRoU3RlbmNpbEZvcm1hdCIpO3M9PT12b2lkIDAmJmg9PT1TbiYmKHM9V2kpLHM9PT12b2lkIDAmJmg9PT1YaSYmKHM9UG8pLHN1cGVyKG51bGwsbixpLG8sYSxjLGgscyx1KSx0aGlzLmlzRGVwdGhUZXh0dXJlPSEwLHRoaXMuaW1hZ2U9e3dpZHRoOnQsaGVpZ2h0OmV9LHRoaXMubWFnRmlsdGVyPWEhPT12b2lkIDA/YTp6cyx0aGlzLm1pbkZpbHRlcj1jIT09dm9pZCAwP2M6enMsdGhpcy5mbGlwWT0hMSx0aGlzLmdlbmVyYXRlTWlwbWFwcz0hMSx0aGlzLmNvbXBhcmVGdW5jdGlvbj1udWxsfWNvcHkodCl7cmV0dXJuIHN1cGVyLmNvcHkodCksdGhpcy5jb21wYXJlRnVuY3Rpb249dC5jb21wYXJlRnVuY3Rpb24sdGhpc310b0pTT04odCl7Y29uc3QgZT1zdXBlci50b0pTT04odCk7cmV0dXJuIHRoaXMuY29tcGFyZUZ1bmN0aW9uIT09bnVsbCYmKGUuY29tcGFyZUZ1bmN0aW9uPXRoaXMuY29tcGFyZUZ1bmN0aW9uKSxlfX1jbGFzcyB3YXtjb25zdHJ1Y3Rvcih0LGUpe3RoaXMuaXNJbnRlcmxlYXZlZEJ1ZmZlcj0hMCx0aGlzLmFycmF5PXQsdGhpcy5zdHJpZGU9ZSx0aGlzLmNvdW50PXQhPT12b2lkIDA/dC5sZW5ndGgvZTowLHRoaXMudXNhZ2U9Q3MsdGhpcy51cGRhdGVSYW5nZXM9W10sdGhpcy52ZXJzaW9uPTAsdGhpcy51dWlkPUt0KCl9b25VcGxvYWRDYWxsYmFjaygpe31zZXQgbmVlZHNVcGRhdGUodCl7dD09PSEwJiZ0aGlzLnZlcnNpb24rK31zZXRVc2FnZSh0KXtyZXR1cm4gdGhpcy51c2FnZT10LHRoaXN9YWRkVXBkYXRlUmFuZ2UodCxlKXt0aGlzLnVwZGF0ZVJhbmdlcy5wdXNoKHtzdGFydDp0LGNvdW50OmV9KX1jbGVhclVwZGF0ZVJhbmdlcygpe3RoaXMudXBkYXRlUmFuZ2VzLmxlbmd0aD0wfWNvcHkodCl7cmV0dXJuIHRoaXMuYXJyYXk9bmV3IHQuYXJyYXkuY29uc3RydWN0b3IodC5hcnJheSksdGhpcy5jb3VudD10LmNvdW50LHRoaXMuc3RyaWRlPXQuc3RyaWRlLHRoaXMudXNhZ2U9dC51c2FnZSx0aGlzfWNvcHlBdCh0LGUscyl7dCo9dGhpcy5zdHJpZGUscyo9ZS5zdHJpZGU7Zm9yKGxldCBuPTAsaT10aGlzLnN0cmlkZTtuPGk7bisrKXRoaXMuYXJyYXlbdCtuXT1lLmFycmF5W3Mrbl07cmV0dXJuIHRoaXN9c2V0KHQsZT0wKXtyZXR1cm4gdGhpcy5hcnJheS5zZXQodCxlKSx0aGlzfWNsb25lKHQpe3QuYXJyYXlCdWZmZXJzPT09dm9pZCAwJiYodC5hcnJheUJ1ZmZlcnM9e30pLHRoaXMuYXJyYXkuYnVmZmVyLl91dWlkPT09dm9pZCAwJiYodGhpcy5hcnJheS5idWZmZXIuX3V1aWQ9S3QoKSksdC5hcnJheUJ1ZmZlcnNbdGhpcy5hcnJheS5idWZmZXIuX3V1aWRdPT09dm9pZCAwJiYodC5hcnJheUJ1ZmZlcnNbdGhpcy5hcnJheS5idWZmZXIuX3V1aWRdPXRoaXMuYXJyYXkuc2xpY2UoMCkuYnVmZmVyKTtjb25zdCBlPW5ldyB0aGlzLmFycmF5LmNvbnN0cnVjdG9yKHQuYXJyYXlCdWZmZXJzW3RoaXMuYXJyYXkuYnVmZmVyLl91dWlkXSkscz1uZXcgdGhpcy5jb25zdHJ1Y3RvcihlLHRoaXMuc3RyaWRlKTtyZXR1cm4gcy5zZXRVc2FnZSh0aGlzLnVzYWdlKSxzfW9uVXBsb2FkKHQpe3JldHVybiB0aGlzLm9uVXBsb2FkQ2FsbGJhY2s9dCx0aGlzfXRvSlNPTih0KXtyZXR1cm4gdC5hcnJheUJ1ZmZlcnM9PT12b2lkIDAmJih0LmFycmF5QnVmZmVycz17fSksdGhpcy5hcnJheS5idWZmZXIuX3V1aWQ9PT12b2lkIDAmJih0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZD1LdCgpKSx0LmFycmF5QnVmZmVyc1t0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZF09PT12b2lkIDAmJih0LmFycmF5QnVmZmVyc1t0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZF09QXJyYXkuZnJvbShuZXcgVWludDMyQXJyYXkodGhpcy5hcnJheS5idWZmZXIpKSkse3V1aWQ6dGhpcy51dWlkLGJ1ZmZlcjp0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZCx0eXBlOnRoaXMuYXJyYXkuY29uc3RydWN0b3IubmFtZSxzdHJpZGU6dGhpcy5zdHJpZGV9fX1jb25zdCB1dD1uZXcgQTtjbGFzcyBZbntjb25zdHJ1Y3Rvcih0LGUscyxuPSExKXt0aGlzLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGU9ITAsdGhpcy5uYW1lPSIiLHRoaXMuZGF0YT10LHRoaXMuaXRlbVNpemU9ZSx0aGlzLm9mZnNldD1zLHRoaXMubm9ybWFsaXplZD1ufWdldCBjb3VudCgpe3JldHVybiB0aGlzLmRhdGEuY291bnR9Z2V0IGFycmF5KCl7cmV0dXJuIHRoaXMuZGF0YS5hcnJheX1zZXQgbmVlZHNVcGRhdGUodCl7dGhpcy5kYXRhLm5lZWRzVXBkYXRlPXR9YXBwbHlNYXRyaXg0KHQpe2ZvcihsZXQgZT0wLHM9dGhpcy5kYXRhLmNvdW50O2U8cztlKyspdXQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0aGlzLGUpLHV0LmFwcGx5TWF0cml4NCh0KSx0aGlzLnNldFhZWihlLHV0LngsdXQueSx1dC56KTtyZXR1cm4gdGhpc31hcHBseU5vcm1hbE1hdHJpeCh0KXtmb3IobGV0IGU9MCxzPXRoaXMuY291bnQ7ZTxzO2UrKyl1dC5mcm9tQnVmZmVyQXR0cmlidXRlKHRoaXMsZSksdXQuYXBwbHlOb3JtYWxNYXRyaXgodCksdGhpcy5zZXRYWVooZSx1dC54LHV0LnksdXQueik7cmV0dXJuIHRoaXN9dHJhbnNmb3JtRGlyZWN0aW9uKHQpe2ZvcihsZXQgZT0wLHM9dGhpcy5jb3VudDtlPHM7ZSsrKXV0LmZyb21CdWZmZXJBdHRyaWJ1dGUodGhpcyxlKSx1dC50cmFuc2Zvcm1EaXJlY3Rpb24odCksdGhpcy5zZXRYWVooZSx1dC54LHV0LnksdXQueik7cmV0dXJuIHRoaXN9Z2V0Q29tcG9uZW50KHQsZSl7bGV0IHM9dGhpcy5hcnJheVt0KnRoaXMuZGF0YS5zdHJpZGUrdGhpcy5vZmZzZXQrZV07cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKHM9RXQocyx0aGlzLmFycmF5KSksc31zZXRDb21wb25lbnQodCxlLHMpe3JldHVybiB0aGlzLm5vcm1hbGl6ZWQmJihzPSQocyx0aGlzLmFycmF5KSksdGhpcy5kYXRhLmFycmF5W3QqdGhpcy5kYXRhLnN0cmlkZSt0aGlzLm9mZnNldCtlXT1zLHRoaXN9c2V0WCh0LGUpe3JldHVybiB0aGlzLm5vcm1hbGl6ZWQmJihlPSQoZSx0aGlzLmFycmF5KSksdGhpcy5kYXRhLmFycmF5W3QqdGhpcy5kYXRhLnN0cmlkZSt0aGlzLm9mZnNldF09ZSx0aGlzfXNldFkodCxlKXtyZXR1cm4gdGhpcy5ub3JtYWxpemVkJiYoZT0kKGUsdGhpcy5hcnJheSkpLHRoaXMuZGF0YS5hcnJheVt0KnRoaXMuZGF0YS5zdHJpZGUrdGhpcy5vZmZzZXQrMV09ZSx0aGlzfXNldFoodCxlKXtyZXR1cm4gdGhpcy5ub3JtYWxpemVkJiYoZT0kKGUsdGhpcy5hcnJheSkpLHRoaXMuZGF0YS5hcnJheVt0KnRoaXMuZGF0YS5zdHJpZGUrdGhpcy5vZmZzZXQrMl09ZSx0aGlzfXNldFcodCxlKXtyZXR1cm4gdGhpcy5ub3JtYWxpemVkJiYoZT0kKGUsdGhpcy5hcnJheSkpLHRoaXMuZGF0YS5hcnJheVt0KnRoaXMuZGF0YS5zdHJpZGUrdGhpcy5vZmZzZXQrM109ZSx0aGlzfWdldFgodCl7bGV0IGU9dGhpcy5kYXRhLmFycmF5W3QqdGhpcy5kYXRhLnN0cmlkZSt0aGlzLm9mZnNldF07cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGU9RXQoZSx0aGlzLmFycmF5KSksZX1nZXRZKHQpe2xldCBlPXRoaXMuZGF0YS5hcnJheVt0KnRoaXMuZGF0YS5zdHJpZGUrdGhpcy5vZmZzZXQrMV07cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGU9RXQoZSx0aGlzLmFycmF5KSksZX1nZXRaKHQpe2xldCBlPXRoaXMuZGF0YS5hcnJheVt0KnRoaXMuZGF0YS5zdHJpZGUrdGhpcy5vZmZzZXQrMl07cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGU9RXQoZSx0aGlzLmFycmF5KSksZX1nZXRXKHQpe2xldCBlPXRoaXMuZGF0YS5hcnJheVt0KnRoaXMuZGF0YS5zdHJpZGUrdGhpcy5vZmZzZXQrM107cmV0dXJuIHRoaXMubm9ybWFsaXplZCYmKGU9RXQoZSx0aGlzLmFycmF5KSksZX1zZXRYWSh0LGUscyl7cmV0dXJuIHQ9dCp0aGlzLmRhdGEuc3RyaWRlK3RoaXMub2Zmc2V0LHRoaXMubm9ybWFsaXplZCYmKGU9JChlLHRoaXMuYXJyYXkpLHM9JChzLHRoaXMuYXJyYXkpKSx0aGlzLmRhdGEuYXJyYXlbdCswXT1lLHRoaXMuZGF0YS5hcnJheVt0KzFdPXMsdGhpc31zZXRYWVoodCxlLHMsbil7cmV0dXJuIHQ9dCp0aGlzLmRhdGEuc3RyaWRlK3RoaXMub2Zmc2V0LHRoaXMubm9ybWFsaXplZCYmKGU9JChlLHRoaXMuYXJyYXkpLHM9JChzLHRoaXMuYXJyYXkpLG49JChuLHRoaXMuYXJyYXkpKSx0aGlzLmRhdGEuYXJyYXlbdCswXT1lLHRoaXMuZGF0YS5hcnJheVt0KzFdPXMsdGhpcy5kYXRhLmFycmF5W3QrMl09bix0aGlzfXNldFhZWlcodCxlLHMsbixpKXtyZXR1cm4gdD10KnRoaXMuZGF0YS5zdHJpZGUrdGhpcy5vZmZzZXQsdGhpcy5ub3JtYWxpemVkJiYoZT0kKGUsdGhpcy5hcnJheSkscz0kKHMsdGhpcy5hcnJheSksbj0kKG4sdGhpcy5hcnJheSksaT0kKGksdGhpcy5hcnJheSkpLHRoaXMuZGF0YS5hcnJheVt0KzBdPWUsdGhpcy5kYXRhLmFycmF5W3QrMV09cyx0aGlzLmRhdGEuYXJyYXlbdCsyXT1uLHRoaXMuZGF0YS5hcnJheVt0KzNdPWksdGhpc31jbG9uZSh0KXtpZih0PT09dm9pZCAwKXtjb25zb2xlLmxvZygiVEhSRUUuSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUuY2xvbmUoKTogQ2xvbmluZyBhbiBpbnRlcmxlYXZlZCBidWZmZXIgYXR0cmlidXRlIHdpbGwgZGUtaW50ZXJsZWF2ZSBidWZmZXIgZGF0YS4iKTtjb25zdCBlPVtdO2ZvcihsZXQgcz0wO3M8dGhpcy5jb3VudDtzKyspe2NvbnN0IG49cyp0aGlzLmRhdGEuc3RyaWRlK3RoaXMub2Zmc2V0O2ZvcihsZXQgaT0wO2k8dGhpcy5pdGVtU2l6ZTtpKyspZS5wdXNoKHRoaXMuZGF0YS5hcnJheVtuK2ldKX1yZXR1cm4gbmV3IHZ0KG5ldyB0aGlzLmFycmF5LmNvbnN0cnVjdG9yKGUpLHRoaXMuaXRlbVNpemUsdGhpcy5ub3JtYWxpemVkKX1lbHNlIHJldHVybiB0LmludGVybGVhdmVkQnVmZmVycz09PXZvaWQgMCYmKHQuaW50ZXJsZWF2ZWRCdWZmZXJzPXt9KSx0LmludGVybGVhdmVkQnVmZmVyc1t0aGlzLmRhdGEudXVpZF09PT12b2lkIDAmJih0LmludGVybGVhdmVkQnVmZmVyc1t0aGlzLmRhdGEudXVpZF09dGhpcy5kYXRhLmNsb25lKHQpKSxuZXcgWW4odC5pbnRlcmxlYXZlZEJ1ZmZlcnNbdGhpcy5kYXRhLnV1aWRdLHRoaXMuaXRlbVNpemUsdGhpcy5vZmZzZXQsdGhpcy5ub3JtYWxpemVkKX10b0pTT04odCl7aWYodD09PXZvaWQgMCl7Y29uc29sZS5sb2coIlRIUkVFLkludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlLnRvSlNPTigpOiBTZXJpYWxpemluZyBhbiBpbnRlcmxlYXZlZCBidWZmZXIgYXR0cmlidXRlIHdpbGwgZGUtaW50ZXJsZWF2ZSBidWZmZXIgZGF0YS4iKTtjb25zdCBlPVtdO2ZvcihsZXQgcz0wO3M8dGhpcy5jb3VudDtzKyspe2NvbnN0IG49cyp0aGlzLmRhdGEuc3RyaWRlK3RoaXMub2Zmc2V0O2ZvcihsZXQgaT0wO2k8dGhpcy5pdGVtU2l6ZTtpKyspZS5wdXNoKHRoaXMuZGF0YS5hcnJheVtuK2ldKX1yZXR1cm57aXRlbVNpemU6dGhpcy5pdGVtU2l6ZSx0eXBlOnRoaXMuYXJyYXkuY29uc3RydWN0b3IubmFtZSxhcnJheTplLG5vcm1hbGl6ZWQ6dGhpcy5ub3JtYWxpemVkfX1lbHNlIHJldHVybiB0LmludGVybGVhdmVkQnVmZmVycz09PXZvaWQgMCYmKHQuaW50ZXJsZWF2ZWRCdWZmZXJzPXt9KSx0LmludGVybGVhdmVkQnVmZmVyc1t0aGlzLmRhdGEudXVpZF09PT12b2lkIDAmJih0LmludGVybGVhdmVkQnVmZmVyc1t0aGlzLmRhdGEudXVpZF09dGhpcy5kYXRhLnRvSlNPTih0KSkse2lzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGU6ITAsaXRlbVNpemU6dGhpcy5pdGVtU2l6ZSxkYXRhOnRoaXMuZGF0YS51dWlkLG9mZnNldDp0aGlzLm9mZnNldCxub3JtYWxpemVkOnRoaXMubm9ybWFsaXplZH19fWNsYXNzIEFhIGV4dGVuZHMgRHR7Y29uc3RydWN0b3IodCxlKXtzdXBlcih7d2lkdGg6dCxoZWlnaHQ6ZX0pLHRoaXMuaXNGcmFtZWJ1ZmZlclRleHR1cmU9ITAsdGhpcy5tYWdGaWx0ZXI9enMsdGhpcy5taW5GaWx0ZXI9enMsdGhpcy5nZW5lcmF0ZU1pcG1hcHM9ITEsdGhpcy5uZWVkc1VwZGF0ZT0hMH19Y29uc3QgVHI9bmV3IEEsRHM9bmV3IEE7Y2xhc3MgWnR7Y29uc3RydWN0b3IodD1uZXcgQSxlPW5ldyBBKXt0aGlzLnN0YXJ0PXQsdGhpcy5lbmQ9ZX1zZXQodCxlKXtyZXR1cm4gdGhpcy5zdGFydC5jb3B5KHQpLHRoaXMuZW5kLmNvcHkoZSksdGhpc31jb3B5KHQpe3JldHVybiB0aGlzLnN0YXJ0LmNvcHkodC5zdGFydCksdGhpcy5lbmQuY29weSh0LmVuZCksdGhpc31nZXRDZW50ZXIodCl7cmV0dXJuIHQuYWRkVmVjdG9ycyh0aGlzLnN0YXJ0LHRoaXMuZW5kKS5tdWx0aXBseVNjYWxhciguNSl9ZGVsdGEodCl7cmV0dXJuIHQuc3ViVmVjdG9ycyh0aGlzLmVuZCx0aGlzLnN0YXJ0KX1kaXN0YW5jZVNxKCl7cmV0dXJuIHRoaXMuc3RhcnQuZGlzdGFuY2VUb1NxdWFyZWQodGhpcy5lbmQpfWRpc3RhbmNlKCl7cmV0dXJuIHRoaXMuc3RhcnQuZGlzdGFuY2VUbyh0aGlzLmVuZCl9YXQodCxlKXtyZXR1cm4gdGhpcy5kZWx0YShlKS5tdWx0aXBseVNjYWxhcih0KS5hZGQodGhpcy5zdGFydCl9Y2xvc2VzdFBvaW50VG9Qb2ludFBhcmFtZXRlcih0LGUpe1RyLnN1YlZlY3RvcnModCx0aGlzLnN0YXJ0KSxEcy5zdWJWZWN0b3JzKHRoaXMuZW5kLHRoaXMuc3RhcnQpO2NvbnN0IHM9RHMuZG90KERzKTtsZXQgaT1Ecy5kb3QoVHIpL3M7cmV0dXJuIGUmJihpPWF0KGksMCwxKSksaX1jbG9zZXN0UG9pbnRUb1BvaW50KHQsZSxzKXtjb25zdCBuPXRoaXMuY2xvc2VzdFBvaW50VG9Qb2ludFBhcmFtZXRlcih0LGUpO3JldHVybiB0aGlzLmRlbHRhKHMpLm11bHRpcGx5U2NhbGFyKG4pLmFkZCh0aGlzLnN0YXJ0KX1hcHBseU1hdHJpeDQodCl7cmV0dXJuIHRoaXMuc3RhcnQuYXBwbHlNYXRyaXg0KHQpLHRoaXMuZW5kLmFwcGx5TWF0cml4NCh0KSx0aGlzfWVxdWFscyh0KXtyZXR1cm4gdC5zdGFydC5lcXVhbHModGhpcy5zdGFydCkmJnQuZW5kLmVxdWFscyh0aGlzLmVuZCl9Y2xvbmUoKXtyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KHRoaXMpfX1mdW5jdGlvbiBabihyLHQ9MCl7bGV0IGU9MzczNTkyODU1OV50LHM9MTEwMzU0Nzk5MV50O2lmKHIgaW5zdGFuY2VvZiBBcnJheSlmb3IobGV0IG49MCxpO248ci5sZW5ndGg7bisrKWk9cltuXSxlPU1hdGguaW11bChlXmksMjY1NDQzNTc2MSkscz1NYXRoLmltdWwoc15pLDE1OTczMzQ2NzcpO2Vsc2UgZm9yKGxldCBuPTAsaTtuPHIubGVuZ3RoO24rKylpPXIuY2hhckNvZGVBdChuKSxlPU1hdGguaW11bChlXmksMjY1NDQzNTc2MSkscz1NYXRoLmltdWwoc15pLDE1OTczMzQ2NzcpO3JldHVybiBlPU1hdGguaW11bChlXmU+Pj4xNiwyMjQ2ODIyNTA3KSxlXj1NYXRoLmltdWwoc15zPj4+MTMsMzI2NjQ4OTkwOSkscz1NYXRoLmltdWwoc15zPj4+MTYsMjI0NjgyMjUwNyksc149TWF0aC5pbXVsKGVeZT4+PjEzLDMyNjY0ODk5MDkpLDQyOTQ5NjcyOTYqKDIwOTcxNTEmcykrKGU+Pj4wKX1jb25zdCBNYT0oLi4ucik9PlpuKHIpO2Z1bmN0aW9uIFNhKHIsdD0hMSl7Y29uc3QgZT1bXTtyLmlzTm9kZT09PSEwJiYoZS5wdXNoKHIuaWQpLHI9ci5nZXRTZWxmKCkpO2Zvcihjb25zdHtwcm9wZXJ0eTpzLGNoaWxkTm9kZTpufW9mIEpuKHIpKWUucHVzaChlLFpuKHMuc2xpY2UoMCwtNCkpLG4uZ2V0Q2FjaGVLZXkodCkpO3JldHVybiBabihlKX1mdW5jdGlvbipKbihyLHQ9ITEpe2Zvcihjb25zdCBlIGluIHIpe2lmKGUuc3RhcnRzV2l0aCgiXyIpPT09ITApY29udGludWU7Y29uc3Qgcz1yW2VdO2lmKEFycmF5LmlzQXJyYXkocyk9PT0hMClmb3IobGV0IG49MDtuPHMubGVuZ3RoO24rKyl7Y29uc3QgaT1zW25dO2kmJihpLmlzTm9kZT09PSEwfHx0JiZ0eXBlb2YgaS50b0pTT049PSJmdW5jdGlvbiIpJiYoeWllbGR7cHJvcGVydHk6ZSxpbmRleDpuLGNoaWxkTm9kZTppfSl9ZWxzZSBpZihzJiZzLmlzTm9kZT09PSEwKXlpZWxke3Byb3BlcnR5OmUsY2hpbGROb2RlOnN9O2Vsc2UgaWYodHlwZW9mIHM9PSJvYmplY3QiKWZvcihjb25zdCBuIGluIHMpe2NvbnN0IGk9c1tuXTtpJiYoaS5pc05vZGU9PT0hMHx8dCYmdHlwZW9mIGkudG9KU09OPT0iZnVuY3Rpb24iKSYmKHlpZWxke3Byb3BlcnR5OmUsaW5kZXg6bixjaGlsZE5vZGU6aX0pfX19ZnVuY3Rpb24gVnMocil7aWYocj09bnVsbClyZXR1cm4gbnVsbDtjb25zdCB0PXR5cGVvZiByO3JldHVybiByLmlzTm9kZT09PSEwPyJub2RlIjp0PT09Im51bWJlciI/ImZsb2F0Ijp0PT09ImJvb2xlYW4iPyJib29sIjp0PT09InN0cmluZyI/InN0cmluZyI6dD09PSJmdW5jdGlvbiI/InNoYWRlciI6ci5pc1ZlY3RvcjI9PT0hMD8idmVjMiI6ci5pc1ZlY3RvcjM9PT0hMD8idmVjMyI6ci5pc1ZlY3RvcjQ9PT0hMD8idmVjNCI6ci5pc01hdHJpeDM9PT0hMD8ibWF0MyI6ci5pc01hdHJpeDQ9PT0hMD8ibWF0NCI6ci5pc0NvbG9yPT09ITA/ImNvbG9yIjpyIGluc3RhbmNlb2YgQXJyYXlCdWZmZXI/IkFycmF5QnVmZmVyIjpudWxsfWZ1bmN0aW9uIE5yKHIsLi4udCl7Y29uc3QgZT1yP3Iuc2xpY2UoLTQpOnZvaWQgMDtyZXR1cm4gdC5sZW5ndGg9PT0xJiYoZT09PSJ2ZWMyIj90PVt0WzBdLHRbMF1dOmU9PT0idmVjMyI/dD1bdFswXSx0WzBdLHRbMF1dOmU9PT0idmVjNCImJih0PVt0WzBdLHRbMF0sdFswXSx0WzBdXSkpLHI9PT0iY29sb3IiP25ldyBxbiguLi50KTplPT09InZlYzIiP25ldyBKKC4uLnQpOmU9PT0idmVjMyI/bmV3IEEoLi4udCk6ZT09PSJ2ZWM0Ij9uZXcgRnQoLi4udCk6ZT09PSJtYXQzIj9uZXcgQ3QoLi4udCk6ZT09PSJtYXQ0Ij9uZXcgbnQoLi4udCk6cj09PSJib29sIj90WzBdfHwhMTpyPT09ImZsb2F0Inx8cj09PSJpbnQifHxyPT09InVpbnQiP3RbMF18fDA6cj09PSJzdHJpbmciP3RbMF18fCIiOnI9PT0iQXJyYXlCdWZmZXIiP3phKHRbMF0pOm51bGx9ZnVuY3Rpb24gX2Eocil7bGV0IHQ9IiI7Y29uc3QgZT1uZXcgVWludDhBcnJheShyKTtmb3IobGV0IHM9MDtzPGUubGVuZ3RoO3MrKyl0Kz1TdHJpbmcuZnJvbUNoYXJDb2RlKGVbc10pO3JldHVybiBidG9hKHQpfWZ1bmN0aW9uIHphKHIpe3JldHVybiBVaW50OEFycmF5LmZyb20oYXRvYihyKSx0PT50LmNoYXJDb2RlQXQoMCkpLmJ1ZmZlcn1jb25zdCB3cj17VkVSVEVYOiJ2ZXJ0ZXgiLEZSQUdNRU5UOiJmcmFnbWVudCJ9LFE9e05PTkU6Im5vbmUiLEZSQU1FOiJmcmFtZSIsUkVOREVSOiJyZW5kZXIiLE9CSkVDVDoib2JqZWN0In0sbnM9WyJ4IiwieSIsInoiLCJ3Il07bGV0IGJhPTA7Y2xhc3MgVSBleHRlbmRzIFple3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJOb2RlIn1jb25zdHJ1Y3Rvcih0PW51bGwpe3N1cGVyKCksdGhpcy5ub2RlVHlwZT10LHRoaXMudXBkYXRlVHlwZT1RLk5PTkUsdGhpcy51cGRhdGVCZWZvcmVUeXBlPVEuTk9ORSx0aGlzLnVwZGF0ZUFmdGVyVHlwZT1RLk5PTkUsdGhpcy51dWlkPWVhLmdlbmVyYXRlVVVJRCgpLHRoaXMudmVyc2lvbj0wLHRoaXMuX2NhY2hlS2V5PW51bGwsdGhpcy5fY2FjaGVLZXlWZXJzaW9uPTAsdGhpcy5nbG9iYWw9ITEsdGhpcy5pc05vZGU9ITAsT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsImlkIix7dmFsdWU6YmErK30pfXNldCBuZWVkc1VwZGF0ZSh0KXt0PT09ITAmJnRoaXMudmVyc2lvbisrfWdldCB0eXBlKCl7cmV0dXJuIHRoaXMuY29uc3RydWN0b3IudHlwZX1vblVwZGF0ZSh0LGUpe3JldHVybiB0aGlzLnVwZGF0ZVR5cGU9ZSx0aGlzLnVwZGF0ZT10LmJpbmQodGhpcy5nZXRTZWxmKCkpLHRoaXN9b25GcmFtZVVwZGF0ZSh0KXtyZXR1cm4gdGhpcy5vblVwZGF0ZSh0LFEuRlJBTUUpfW9uUmVuZGVyVXBkYXRlKHQpe3JldHVybiB0aGlzLm9uVXBkYXRlKHQsUS5SRU5ERVIpfW9uT2JqZWN0VXBkYXRlKHQpe3JldHVybiB0aGlzLm9uVXBkYXRlKHQsUS5PQkpFQ1QpfW9uUmVmZXJlbmNlKHQpe3JldHVybiB0aGlzLnVwZGF0ZVJlZmVyZW5jZT10LmJpbmQodGhpcy5nZXRTZWxmKCkpLHRoaXN9Z2V0U2VsZigpe3JldHVybiB0aGlzLnNlbGZ8fHRoaXN9dXBkYXRlUmVmZXJlbmNlKCl7cmV0dXJuIHRoaXN9aXNHbG9iYWwoKXtyZXR1cm4gdGhpcy5nbG9iYWx9KmdldENoaWxkcmVuKCl7Zm9yKGNvbnN0e2NoaWxkTm9kZTp0fW9mIEpuKHRoaXMpKXlpZWxkIHR9ZGlzcG9zZSgpe3RoaXMuZGlzcGF0Y2hFdmVudCh7dHlwZToiZGlzcG9zZSJ9KX10cmF2ZXJzZSh0KXt0KHRoaXMpO2Zvcihjb25zdCBlIG9mIHRoaXMuZ2V0Q2hpbGRyZW4oKSllLnRyYXZlcnNlKHQpfWdldENhY2hlS2V5KHQ9ITEpe3JldHVybiB0PXR8fHRoaXMudmVyc2lvbiE9PXRoaXMuX2NhY2hlS2V5VmVyc2lvbiwodD09PSEwfHx0aGlzLl9jYWNoZUtleT09PW51bGwpJiYodGhpcy5fY2FjaGVLZXk9U2EodGhpcyx0KSx0aGlzLl9jYWNoZUtleVZlcnNpb249dGhpcy52ZXJzaW9uKSx0aGlzLl9jYWNoZUtleX1nZXRTY29wZSgpe3JldHVybiB0aGlzfWdldEhhc2goKXtyZXR1cm4gdGhpcy51dWlkfWdldFVwZGF0ZVR5cGUoKXtyZXR1cm4gdGhpcy51cGRhdGVUeXBlfWdldFVwZGF0ZUJlZm9yZVR5cGUoKXtyZXR1cm4gdGhpcy51cGRhdGVCZWZvcmVUeXBlfWdldFVwZGF0ZUFmdGVyVHlwZSgpe3JldHVybiB0aGlzLnVwZGF0ZUFmdGVyVHlwZX1nZXRFbGVtZW50VHlwZSh0KXtjb25zdCBlPXRoaXMuZ2V0Tm9kZVR5cGUodCk7cmV0dXJuIHQuZ2V0RWxlbWVudFR5cGUoZSl9Z2V0Tm9kZVR5cGUodCl7Y29uc3QgZT10LmdldE5vZGVQcm9wZXJ0aWVzKHRoaXMpO3JldHVybiBlLm91dHB1dE5vZGU/ZS5vdXRwdXROb2RlLmdldE5vZGVUeXBlKHQpOnRoaXMubm9kZVR5cGV9Z2V0U2hhcmVkKHQpe2NvbnN0IGU9dGhpcy5nZXRIYXNoKHQpO3JldHVybiB0LmdldE5vZGVGcm9tSGFzaChlKXx8dGhpc31zZXR1cCh0KXtjb25zdCBlPXQuZ2V0Tm9kZVByb3BlcnRpZXModGhpcyk7bGV0IHM9MDtmb3IoY29uc3QgbiBvZiB0aGlzLmdldENoaWxkcmVuKCkpZVsibm9kZSIrcysrXT1uO3JldHVybiBudWxsfWFuYWx5emUodCl7aWYodC5pbmNyZWFzZVVzYWdlKHRoaXMpPT09MSl7Y29uc3Qgcz10LmdldE5vZGVQcm9wZXJ0aWVzKHRoaXMpO2Zvcihjb25zdCBuIG9mIE9iamVjdC52YWx1ZXMocykpbiYmbi5pc05vZGU9PT0hMCYmbi5idWlsZCh0KX19Z2VuZXJhdGUodCxlKXtjb25zdHtvdXRwdXROb2RlOnN9PXQuZ2V0Tm9kZVByb3BlcnRpZXModGhpcyk7aWYocyYmcy5pc05vZGU9PT0hMClyZXR1cm4gcy5idWlsZCh0LGUpfXVwZGF0ZUJlZm9yZSgpe2NvbnNvbGUud2FybigiQWJzdHJhY3QgZnVuY3Rpb24uIil9dXBkYXRlQWZ0ZXIoKXtjb25zb2xlLndhcm4oIkFic3RyYWN0IGZ1bmN0aW9uLiIpfXVwZGF0ZSgpe2NvbnNvbGUud2FybigiQWJzdHJhY3QgZnVuY3Rpb24uIil9YnVpbGQodCxlPW51bGwpe2NvbnN0IHM9dGhpcy5nZXRTaGFyZWQodCk7aWYodGhpcyE9PXMpcmV0dXJuIHMuYnVpbGQodCxlKTt0LmFkZE5vZGUodGhpcyksdC5hZGRDaGFpbih0aGlzKTtsZXQgbj1udWxsO2NvbnN0IGk9dC5nZXRCdWlsZFN0YWdlKCk7aWYoaT09PSJzZXR1cCIpe3RoaXMudXBkYXRlUmVmZXJlbmNlKHQpO2NvbnN0IG89dC5nZXROb2RlUHJvcGVydGllcyh0aGlzKTtpZihvLmluaXRpYWxpemVkIT09ITApe2NvbnN0IGE9dC5zdGFjay5ub2Rlcy5sZW5ndGg7by5pbml0aWFsaXplZD0hMCxvLm91dHB1dE5vZGU9dGhpcy5zZXR1cCh0KSxvLm91dHB1dE5vZGUhPT1udWxsJiZ0LnN0YWNrLm5vZGVzLmxlbmd0aDtmb3IoY29uc3QgYyBvZiBPYmplY3QudmFsdWVzKG8pKWMmJmMuaXNOb2RlPT09ITAmJmMuYnVpbGQodCl9fWVsc2UgaWYoaT09PSJhbmFseXplIil0aGlzLmFuYWx5emUodCk7ZWxzZSBpZihpPT09ImdlbmVyYXRlIilpZih0aGlzLmdlbmVyYXRlLmxlbmd0aD09PTEpe2NvbnN0IGE9dGhpcy5nZXROb2RlVHlwZSh0KSxjPXQuZ2V0RGF0YUZyb21Ob2RlKHRoaXMpO249Yy5zbmlwcGV0LG49PT12b2lkIDA/KG49dGhpcy5nZW5lcmF0ZSh0KXx8IiIsYy5zbmlwcGV0PW4pOmMuZmxvd0NvZGVzIT09dm9pZCAwJiZ0LmNvbnRleHQubm9kZUJsb2NrIT09dm9pZCAwJiZ0LmFkZEZsb3dDb2RlSGllcmFyY2h5KHRoaXMsdC5jb250ZXh0Lm5vZGVCbG9jayksbj10LmZvcm1hdChuLGEsZSl9ZWxzZSBuPXRoaXMuZ2VuZXJhdGUodCxlKXx8IiI7cmV0dXJuIHQucmVtb3ZlQ2hhaW4odGhpcyksbn1nZXRTZXJpYWxpemVDaGlsZHJlbigpe3JldHVybiBKbih0aGlzKX1zZXJpYWxpemUodCl7Y29uc3QgZT10aGlzLmdldFNlcmlhbGl6ZUNoaWxkcmVuKCkscz17fTtmb3IoY29uc3R7cHJvcGVydHk6bixpbmRleDppLGNoaWxkTm9kZTpvfW9mIGUpaSE9PXZvaWQgMD8oc1tuXT09PXZvaWQgMCYmKHNbbl09TnVtYmVyLmlzSW50ZWdlcihpKT9bXTp7fSksc1tuXVtpXT1vLnRvSlNPTih0Lm1ldGEpLnV1aWQpOnNbbl09by50b0pTT04odC5tZXRhKS51dWlkO09iamVjdC5rZXlzKHMpLmxlbmd0aD4wJiYodC5pbnB1dE5vZGVzPXMpfWRlc2VyaWFsaXplKHQpe2lmKHQuaW5wdXROb2RlcyE9PXZvaWQgMCl7Y29uc3QgZT10Lm1ldGEubm9kZXM7Zm9yKGNvbnN0IHMgaW4gdC5pbnB1dE5vZGVzKWlmKEFycmF5LmlzQXJyYXkodC5pbnB1dE5vZGVzW3NdKSl7Y29uc3Qgbj1bXTtmb3IoY29uc3QgaSBvZiB0LmlucHV0Tm9kZXNbc10pbi5wdXNoKGVbaV0pO3RoaXNbc109bn1lbHNlIGlmKHR5cGVvZiB0LmlucHV0Tm9kZXNbc109PSJvYmplY3QiKXtjb25zdCBuPXt9O2Zvcihjb25zdCBpIGluIHQuaW5wdXROb2Rlc1tzXSl7Y29uc3Qgbz10LmlucHV0Tm9kZXNbc11baV07bltpXT1lW29dfXRoaXNbc109bn1lbHNle2NvbnN0IG49dC5pbnB1dE5vZGVzW3NdO3RoaXNbc109ZVtuXX19fXRvSlNPTih0KXtjb25zdHt1dWlkOmUsdHlwZTpzfT10aGlzLG49dD09PXZvaWQgMHx8dHlwZW9mIHQ9PSJzdHJpbmciO24mJih0PXt0ZXh0dXJlczp7fSxpbWFnZXM6e30sbm9kZXM6e319KTtsZXQgaT10Lm5vZGVzW2VdO2k9PT12b2lkIDAmJihpPXt1dWlkOmUsdHlwZTpzLG1ldGE6dCxtZXRhZGF0YTp7dmVyc2lvbjo0LjYsdHlwZToiTm9kZSIsZ2VuZXJhdG9yOiJOb2RlLnRvSlNPTiJ9fSxuIT09ITAmJih0Lm5vZGVzW2kudXVpZF09aSksdGhpcy5zZXJpYWxpemUoaSksZGVsZXRlIGkubWV0YSk7ZnVuY3Rpb24gbyhhKXtjb25zdCBjPVtdO2Zvcihjb25zdCB1IGluIGEpe2NvbnN0IGg9YVt1XTtkZWxldGUgaC5tZXRhZGF0YSxjLnB1c2goaCl9cmV0dXJuIGN9aWYobil7Y29uc3QgYT1vKHQudGV4dHVyZXMpLGM9byh0LmltYWdlcyksdT1vKHQubm9kZXMpO2EubGVuZ3RoPjAmJihpLnRleHR1cmVzPWEpLGMubGVuZ3RoPjAmJihpLmltYWdlcz1jKSx1Lmxlbmd0aD4wJiYoaS5ub2Rlcz11KX1yZXR1cm4gaX19Y2xhc3MgaXMgZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJBcnJheUVsZW1lbnROb2RlIn1jb25zdHJ1Y3Rvcih0LGUpe3N1cGVyKCksdGhpcy5ub2RlPXQsdGhpcy5pbmRleE5vZGU9ZSx0aGlzLmlzQXJyYXlFbGVtZW50Tm9kZT0hMH1nZXROb2RlVHlwZSh0KXtyZXR1cm4gdGhpcy5ub2RlLmdldEVsZW1lbnRUeXBlKHQpfWdlbmVyYXRlKHQpe2NvbnN0IGU9dGhpcy5ub2RlLmJ1aWxkKHQpLHM9dGhpcy5pbmRleE5vZGUuYnVpbGQodCwidWludCIpO3JldHVybmAke2V9WyAke3N9IF1gfX1jbGFzcyBBciBleHRlbmRzIFV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIkNvbnZlcnROb2RlIn1jb25zdHJ1Y3Rvcih0LGUpe3N1cGVyKCksdGhpcy5ub2RlPXQsdGhpcy5jb252ZXJ0VG89ZX1nZXROb2RlVHlwZSh0KXtjb25zdCBlPXRoaXMubm9kZS5nZXROb2RlVHlwZSh0KTtsZXQgcz1udWxsO2Zvcihjb25zdCBuIG9mIHRoaXMuY29udmVydFRvLnNwbGl0KCJ8IikpKHM9PT1udWxsfHx0LmdldFR5cGVMZW5ndGgoZSk9PT10LmdldFR5cGVMZW5ndGgobikpJiYocz1uKTtyZXR1cm4gc31zZXJpYWxpemUodCl7c3VwZXIuc2VyaWFsaXplKHQpLHQuY29udmVydFRvPXRoaXMuY29udmVydFRvfWRlc2VyaWFsaXplKHQpe3N1cGVyLmRlc2VyaWFsaXplKHQpLHRoaXMuY29udmVydFRvPXQuY29udmVydFRvfWdlbmVyYXRlKHQsZSl7Y29uc3Qgcz10aGlzLm5vZGUsbj10aGlzLmdldE5vZGVUeXBlKHQpLGk9cy5idWlsZCh0LG4pO3JldHVybiB0LmZvcm1hdChpLG4sZSl9fWNsYXNzIGR0IGV4dGVuZHMgVXtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iVGVtcE5vZGUifWNvbnN0cnVjdG9yKHQpe3N1cGVyKHQpLHRoaXMuaXNUZW1wTm9kZT0hMH1oYXNEZXBlbmRlbmNpZXModCl7cmV0dXJuIHQuZ2V0RGF0YUZyb21Ob2RlKHRoaXMpLnVzYWdlQ291bnQ+MX1idWlsZCh0LGUpe2lmKHQuZ2V0QnVpbGRTdGFnZSgpPT09ImdlbmVyYXRlIil7Y29uc3Qgbj10LmdldFZlY3RvclR5cGUodGhpcy5nZXROb2RlVHlwZSh0LGUpKSxpPXQuZ2V0RGF0YUZyb21Ob2RlKHRoaXMpO2lmKGkucHJvcGVydHlOYW1lIT09dm9pZCAwKXJldHVybiB0LmZvcm1hdChpLnByb3BlcnR5TmFtZSxuLGUpO2lmKG4hPT0idm9pZCImJmUhPT0idm9pZCImJnRoaXMuaGFzRGVwZW5kZW5jaWVzKHQpKXtjb25zdCBvPXN1cGVyLmJ1aWxkKHQsbiksYT10LmdldFZhckZyb21Ob2RlKHRoaXMsbnVsbCxuKSxjPXQuZ2V0UHJvcGVydHlOYW1lKGEpO3JldHVybiB0LmFkZExpbmVGbG93Q29kZShgJHtjfSA9ICR7b31gLHRoaXMpLGkuc25pcHBldD1vLGkucHJvcGVydHlOYW1lPWMsdC5mb3JtYXQoaS5wcm9wZXJ0eU5hbWUsbixlKX19cmV0dXJuIHN1cGVyLmJ1aWxkKHQsZSl9fWNsYXNzIEVhIGV4dGVuZHMgZHR7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIkpvaW5Ob2RlIn1jb25zdHJ1Y3Rvcih0PVtdLGU9bnVsbCl7c3VwZXIoZSksdGhpcy5ub2Rlcz10fWdldE5vZGVUeXBlKHQpe3JldHVybiB0aGlzLm5vZGVUeXBlIT09bnVsbD90LmdldFZlY3RvclR5cGUodGhpcy5ub2RlVHlwZSk6dC5nZXRUeXBlRnJvbUxlbmd0aCh0aGlzLm5vZGVzLnJlZHVjZSgoZSxzKT0+ZSt0LmdldFR5cGVMZW5ndGgocy5nZXROb2RlVHlwZSh0KSksMCkpfWdlbmVyYXRlKHQsZSl7Y29uc3Qgcz10aGlzLmdldE5vZGVUeXBlKHQpLG49dGhpcy5ub2RlcyxpPXQuZ2V0Q29tcG9uZW50VHlwZShzKSxvPVtdO2Zvcihjb25zdCBjIG9mIG4pe2xldCB1PWMuYnVpbGQodCk7Y29uc3QgaD10LmdldENvbXBvbmVudFR5cGUoYy5nZXROb2RlVHlwZSh0KSk7aCE9PWkmJih1PXQuZm9ybWF0KHUsaCxpKSksby5wdXNoKHUpfWNvbnN0IGE9YCR7dC5nZXRUeXBlKHMpfSggJHtvLmpvaW4oIiwgIil9IClgO3JldHVybiB0LmZvcm1hdChhLHMsZSl9fWNvbnN0IENhPW5zLmpvaW4oIiIpO2NsYXNzIE1yIGV4dGVuZHMgVXtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iU3BsaXROb2RlIn1jb25zdHJ1Y3Rvcih0LGU9IngiKXtzdXBlcigpLHRoaXMubm9kZT10LHRoaXMuY29tcG9uZW50cz1lLHRoaXMuaXNTcGxpdE5vZGU9ITB9Z2V0VmVjdG9yTGVuZ3RoKCl7bGV0IHQ9dGhpcy5jb21wb25lbnRzLmxlbmd0aDtmb3IoY29uc3QgZSBvZiB0aGlzLmNvbXBvbmVudHMpdD1NYXRoLm1heChucy5pbmRleE9mKGUpKzEsdCk7cmV0dXJuIHR9Z2V0Q29tcG9uZW50VHlwZSh0KXtyZXR1cm4gdC5nZXRDb21wb25lbnRUeXBlKHRoaXMubm9kZS5nZXROb2RlVHlwZSh0KSl9Z2V0Tm9kZVR5cGUodCl7cmV0dXJuIHQuZ2V0VHlwZUZyb21MZW5ndGgodGhpcy5jb21wb25lbnRzLmxlbmd0aCx0aGlzLmdldENvbXBvbmVudFR5cGUodCkpfWdlbmVyYXRlKHQsZSl7Y29uc3Qgcz10aGlzLm5vZGUsbj10LmdldFR5cGVMZW5ndGgocy5nZXROb2RlVHlwZSh0KSk7bGV0IGk9bnVsbDtpZihuPjEpe2xldCBvPW51bGw7dGhpcy5nZXRWZWN0b3JMZW5ndGgoKT49biYmKG89dC5nZXRUeXBlRnJvbUxlbmd0aCh0aGlzLmdldFZlY3Rvckxlbmd0aCgpLHRoaXMuZ2V0Q29tcG9uZW50VHlwZSh0KSkpO2NvbnN0IGM9cy5idWlsZCh0LG8pO3RoaXMuY29tcG9uZW50cy5sZW5ndGg9PT1uJiZ0aGlzLmNvbXBvbmVudHM9PT1DYS5zbGljZSgwLHRoaXMuY29tcG9uZW50cy5sZW5ndGgpP2k9dC5mb3JtYXQoYyxvLGUpOmk9dC5mb3JtYXQoYCR7Y30uJHt0aGlzLmNvbXBvbmVudHN9YCx0aGlzLmdldE5vZGVUeXBlKHQpLGUpfWVsc2UgaT1zLmJ1aWxkKHQsZSk7cmV0dXJuIGl9c2VyaWFsaXplKHQpe3N1cGVyLnNlcmlhbGl6ZSh0KSx0LmNvbXBvbmVudHM9dGhpcy5jb21wb25lbnRzfWRlc2VyaWFsaXplKHQpe3N1cGVyLmRlc2VyaWFsaXplKHQpLHRoaXMuY29tcG9uZW50cz10LmNvbXBvbmVudHN9fWNsYXNzIEZhIGV4dGVuZHMgZHR7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIlNldE5vZGUifWNvbnN0cnVjdG9yKHQsZSxzKXtzdXBlcigpLHRoaXMuc291cmNlTm9kZT10LHRoaXMuY29tcG9uZW50cz1lLHRoaXMudGFyZ2V0Tm9kZT1zfWdldE5vZGVUeXBlKHQpe3JldHVybiB0aGlzLnNvdXJjZU5vZGUuZ2V0Tm9kZVR5cGUodCl9Z2VuZXJhdGUodCl7Y29uc3R7c291cmNlTm9kZTplLGNvbXBvbmVudHM6cyx0YXJnZXROb2RlOm59PXRoaXMsaT10aGlzLmdldE5vZGVUeXBlKHQpLG89dC5nZXRUeXBlRnJvbUxlbmd0aChzLmxlbmd0aCxuLmdldE5vZGVUeXBlKHQpKSxhPW4uYnVpbGQodCxvKSxjPWUuYnVpbGQodCxpKSx1PXQuZ2V0VHlwZUxlbmd0aChpKSxoPVtdO2ZvcihsZXQgbD0wO2w8dTtsKyspe2NvbnN0IGQ9bnNbbF07ZD09PXNbMF0/KGgucHVzaChhKSxsKz1zLmxlbmd0aC0xKTpoLnB1c2goYysiLiIrZCl9cmV0dXJuYCR7dC5nZXRUeXBlKGkpfSggJHtoLmpvaW4oIiwgIil9IClgfX1jbGFzcyBSYSBleHRlbmRzIGR0e3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJGbGlwTm9kZSJ9Y29uc3RydWN0b3IodCxlKXtzdXBlcigpLHRoaXMuc291cmNlTm9kZT10LHRoaXMuY29tcG9uZW50cz1lfWdldE5vZGVUeXBlKHQpe3JldHVybiB0aGlzLnNvdXJjZU5vZGUuZ2V0Tm9kZVR5cGUodCl9Z2VuZXJhdGUodCl7Y29uc3R7Y29tcG9uZW50czplLHNvdXJjZU5vZGU6c309dGhpcyxuPXRoaXMuZ2V0Tm9kZVR5cGUodCksaT1zLmJ1aWxkKHQpLG89dC5nZXRWYXJGcm9tTm9kZSh0aGlzKSxhPXQuZ2V0UHJvcGVydHlOYW1lKG8pO3QuYWRkTGluZUZsb3dDb2RlKGErIiA9ICIraSx0aGlzKTtjb25zdCBjPXQuZ2V0VHlwZUxlbmd0aChuKSx1PVtdO2xldCBoPTA7Zm9yKGxldCBsPTA7bDxjO2wrKyl7Y29uc3QgZD1uc1tsXTtkPT09ZVtoXT8odS5wdXNoKCIxLjAgLSAiKyhhKyIuIitkKSksaCsrKTp1LnB1c2goYSsiLiIrZCl9cmV0dXJuYCR7dC5nZXRUeXBlKG4pfSggJHt1LmpvaW4oIiwgIil9IClgfX1jbGFzcyBqbiBleHRlbmRzIFV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIklucHV0Tm9kZSJ9Y29uc3RydWN0b3IodCxlPW51bGwpe3N1cGVyKGUpLHRoaXMuaXNJbnB1dE5vZGU9ITAsdGhpcy52YWx1ZT10LHRoaXMucHJlY2lzaW9uPW51bGx9Z2V0Tm9kZVR5cGUoKXtyZXR1cm4gdGhpcy5ub2RlVHlwZT09PW51bGw/VnModGhpcy52YWx1ZSk6dGhpcy5ub2RlVHlwZX1nZXRJbnB1dFR5cGUodCl7cmV0dXJuIHRoaXMuZ2V0Tm9kZVR5cGUodCl9c2V0UHJlY2lzaW9uKHQpe3JldHVybiB0aGlzLnByZWNpc2lvbj10LHRoaXN9c2VyaWFsaXplKHQpe3N1cGVyLnNlcmlhbGl6ZSh0KSx0LnZhbHVlPXRoaXMudmFsdWUsdGhpcy52YWx1ZSYmdGhpcy52YWx1ZS50b0FycmF5JiYodC52YWx1ZT10aGlzLnZhbHVlLnRvQXJyYXkoKSksdC52YWx1ZVR5cGU9VnModGhpcy52YWx1ZSksdC5ub2RlVHlwZT10aGlzLm5vZGVUeXBlLHQudmFsdWVUeXBlPT09IkFycmF5QnVmZmVyIiYmKHQudmFsdWU9X2EodC52YWx1ZSkpLHQucHJlY2lzaW9uPXRoaXMucHJlY2lzaW9ufWRlc2VyaWFsaXplKHQpe3N1cGVyLmRlc2VyaWFsaXplKHQpLHRoaXMubm9kZVR5cGU9dC5ub2RlVHlwZSx0aGlzLnZhbHVlPUFycmF5LmlzQXJyYXkodC52YWx1ZSk/TnIodC52YWx1ZVR5cGUsLi4udC52YWx1ZSk6dC52YWx1ZSx0aGlzLnByZWNpc2lvbj10LnByZWNpc2lvbnx8bnVsbCx0aGlzLnZhbHVlJiZ0aGlzLnZhbHVlLmZyb21BcnJheSYmKHRoaXMudmFsdWU9dGhpcy52YWx1ZS5mcm9tQXJyYXkodC52YWx1ZSkpfWdlbmVyYXRlKCl7Y29uc29sZS53YXJuKCJBYnN0cmFjdCBmdW5jdGlvbi4iKX19Y2xhc3MgSnQgZXh0ZW5kcyBqbntzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iQ29uc3ROb2RlIn1jb25zdHJ1Y3Rvcih0LGU9bnVsbCl7c3VwZXIodCxlKSx0aGlzLmlzQ29uc3ROb2RlPSEwfWdlbmVyYXRlQ29uc3QodCl7cmV0dXJuIHQuZ2VuZXJhdGVDb25zdCh0aGlzLmdldE5vZGVUeXBlKHQpLHRoaXMudmFsdWUpfWdlbmVyYXRlKHQsZSl7Y29uc3Qgcz10aGlzLmdldE5vZGVUeXBlKHQpO3JldHVybiB0LmZvcm1hdCh0aGlzLmdlbmVyYXRlQ29uc3QodCkscyxlKX19bGV0IFNyPW51bGw7Y29uc3QgQ2U9bmV3IE1hcDtmdW5jdGlvbiBiKHIsdCl7aWYoQ2UuaGFzKHIpKXtjb25zb2xlLndhcm4oYFJlZGVmaW5pdGlvbiBvZiBtZXRob2QgY2hhaW5pbmcgJHtyfWApO3JldHVybn1pZih0eXBlb2YgdCE9ImZ1bmN0aW9uIil0aHJvdyBuZXcgRXJyb3IoYE5vZGUgZWxlbWVudCAke3J9IGlzIG5vdCBhIGZ1bmN0aW9uYCk7Q2Uuc2V0KHIsdCl9Y29uc3QgX3I9cj0+ci5yZXBsYWNlKC9yfHMvZywieCIpLnJlcGxhY2UoL2d8dC9nLCJ5IikucmVwbGFjZSgvYnxwL2csInoiKS5yZXBsYWNlKC9hfHEvZywidyIpLHpyPXI9Pl9yKHIpLnNwbGl0KCIiKS5zb3J0KCkuam9pbigiIiksYnI9e3NldHVwKHIsdCl7Y29uc3QgZT10LnNoaWZ0KCk7cmV0dXJuIHIoSHMoZSksLi4udCl9LGdldChyLHQsZSl7aWYodHlwZW9mIHQ9PSJzdHJpbmciJiZyW3RdPT09dm9pZCAwKXtpZihyLmlzU3RhY2tOb2RlIT09ITAmJnQ9PT0iYXNzaWduIilyZXR1cm4oLi4ucyk9PihTci5hc3NpZ24oZSwuLi5zKSxlKTtpZihDZS5oYXModCkpe2NvbnN0IHM9Q2UuZ2V0KHQpO3JldHVybiByLmlzU3RhY2tOb2RlPyguLi5uKT0+ZS5hZGQocyguLi5uKSk6KC4uLm4pPT5zKGUsLi4ubil9ZWxzZXtpZih0PT09InNlbGYiKXJldHVybiByO2lmKHQuZW5kc1dpdGgoIkFzc2lnbiIpJiZDZS5oYXModC5zbGljZSgwLHQubGVuZ3RoLTYpKSl7Y29uc3Qgcz1DZS5nZXQodC5zbGljZSgwLHQubGVuZ3RoLTYpKTtyZXR1cm4gci5pc1N0YWNrTm9kZT8oLi4ubik9PmUuYXNzaWduKG5bMF0scyguLi5uKSk6KC4uLm4pPT5lLmFzc2lnbihzKGUsLi4ubikpfWVsc2V7aWYoL15beHl6d3JnYmFzdHBxXXsxLDR9JC8udGVzdCh0KT09PSEwKXJldHVybiB0PV9yKHQpLHYobmV3IE1yKGUsdCkpO2lmKC9ec2V0W1hZWldSR0JBU1RQUV17MSw0fSQvLnRlc3QodCk9PT0hMClyZXR1cm4gdD16cih0LnNsaWNlKDMpLnRvTG93ZXJDYXNlKCkpLHM9PnYobmV3IEZhKHIsdCxzKSk7aWYoL15mbGlwW1hZWldSR0JBU1RQUV17MSw0fSQvLnRlc3QodCk9PT0hMClyZXR1cm4gdD16cih0LnNsaWNlKDQpLnRvTG93ZXJDYXNlKCkpLCgpPT52KG5ldyBSYSh2KHIpLHQpKTtpZih0PT09IndpZHRoInx8dD09PSJoZWlnaHQifHx0PT09ImRlcHRoIilyZXR1cm4gdD09PSJ3aWR0aCI/dD0ieCI6dD09PSJoZWlnaHQiP3Q9InkiOnQ9PT0iZGVwdGgiJiYodD0ieiIpLHYobmV3IE1yKHIsdCkpO2lmKC9eXGQrJC8udGVzdCh0KT09PSEwKXJldHVybiB2KG5ldyBpcyhlLG5ldyBKdChOdW1iZXIodCksInVpbnQiKSkpfX19cmV0dXJuIFJlZmxlY3QuZ2V0KHIsdCxlKX0sc2V0KHIsdCxlLHMpe3JldHVybiB0eXBlb2YgdD09InN0cmluZyImJnJbdF09PT12b2lkIDAmJigvXlt4eXp3cmdiYXN0cHFdezEsNH0kLy50ZXN0KHQpPT09ITB8fHQ9PT0id2lkdGgifHx0PT09ImhlaWdodCJ8fHQ9PT0iZGVwdGgifHwvXlxkKyQvLnRlc3QodCk9PT0hMCk/KHNbdF0uYXNzaWduKGUpLCEwKTpSZWZsZWN0LnNldChyLHQsZSxzKX19LFFuPW5ldyBXZWFrTWFwLEVyPW5ldyBXZWFrTWFwLEJhPWZ1bmN0aW9uKHIsdD1udWxsKXtjb25zdCBlPVZzKHIpO2lmKGU9PT0ibm9kZSIpe2xldCBzPVFuLmdldChyKTtyZXR1cm4gcz09PXZvaWQgMCYmKHM9bmV3IFByb3h5KHIsYnIpLFFuLnNldChyLHMpLFFuLnNldChzLHMpKSxzfWVsc2V7aWYodD09PW51bGwmJihlPT09ImZsb2F0Inx8ZT09PSJib29sZWFuIil8fGUmJmUhPT0ic2hhZGVyIiYmZSE9PSJzdHJpbmciKXJldHVybiB2KHNpKHIsdCkpO2lmKGU9PT0ic2hhZGVyIilyZXR1cm4gdHQocil9cmV0dXJuIHJ9LElhPWZ1bmN0aW9uKHIsdD1udWxsKXtmb3IoY29uc3QgZSBpbiByKXJbZV09dihyW2VdLHQpO3JldHVybiByfSx2YT1mdW5jdGlvbihyLHQ9bnVsbCl7Y29uc3QgZT1yLmxlbmd0aDtmb3IobGV0IHM9MDtzPGU7cysrKXJbc109dihyW3NdLHQpO3JldHVybiByfSxQYT1mdW5jdGlvbihyLHQ9bnVsbCxlPW51bGwscz1udWxsKXtjb25zdCBuPWk9PnYocyE9PW51bGw/T2JqZWN0LmFzc2lnbihpLHMpOmkpO3JldHVybiB0PT09bnVsbD8oLi4uaSk9Pm4obmV3IHIoLi4uRmUoaSkpKTplIT09bnVsbD8oZT12KGUpLCguLi5pKT0+bihuZXcgcih0LC4uLkZlKGkpLGUpKSk6KC4uLmkpPT5uKG5ldyByKHQsLi4uRmUoaSkpKX0sTGE9ZnVuY3Rpb24ociwuLi50KXtyZXR1cm4gdihuZXcgciguLi5GZSh0KSkpfTtjbGFzcyBPYSBleHRlbmRzIFV7Y29uc3RydWN0b3IodCxlKXtzdXBlcigpLHRoaXMuc2hhZGVyTm9kZT10LHRoaXMuaW5wdXROb2Rlcz1lfWdldE5vZGVUeXBlKHQpe3JldHVybiB0aGlzLnNoYWRlck5vZGUubm9kZVR5cGV8fHRoaXMuZ2V0T3V0cHV0Tm9kZSh0KS5nZXROb2RlVHlwZSh0KX1jYWxsKHQpe2NvbnN0e3NoYWRlck5vZGU6ZSxpbnB1dE5vZGVzOnN9PXRoaXMsbj10LmdldE5vZGVQcm9wZXJ0aWVzKGUpO2lmKG4ub25jZU91dHB1dClyZXR1cm4gbi5vbmNlT3V0cHV0O2xldCBpPW51bGw7aWYoZS5sYXlvdXQpe2xldCBvPUVyLmdldCh0LmNvbnN0cnVjdG9yKTtvPT09dm9pZCAwJiYobz1uZXcgV2Vha01hcCxFci5zZXQodC5jb25zdHJ1Y3RvcixvKSk7bGV0IGE9by5nZXQoZSk7YT09PXZvaWQgMCYmKGE9dih0LmJ1aWxkRnVuY3Rpb25Ob2RlKGUpKSxvLnNldChlLGEpKSx0LmN1cnJlbnRGdW5jdGlvbk5vZGUhPT1udWxsJiZ0LmN1cnJlbnRGdW5jdGlvbk5vZGUuaW5jbHVkZXMucHVzaChhKSxpPXYoYS5jYWxsKHMpKX1lbHNle2NvbnN0IG89ZS5qc0Z1bmMsYT1zIT09bnVsbD9vKHMsdCk6byh0KTtpPXYoYSl9cmV0dXJuIGUub25jZSYmKG4ub25jZU91dHB1dD1pKSxpfWdldE91dHB1dE5vZGUodCl7Y29uc3QgZT10LmdldE5vZGVQcm9wZXJ0aWVzKHRoaXMpO3JldHVybiBlLm91dHB1dE5vZGU9PT1udWxsJiYoZS5vdXRwdXROb2RlPXRoaXMuc2V0dXBPdXRwdXQodCkpLGUub3V0cHV0Tm9kZX1zZXR1cCh0KXtyZXR1cm4gdGhpcy5nZXRPdXRwdXROb2RlKHQpfXNldHVwT3V0cHV0KHQpe3JldHVybiB0LmFkZFN0YWNrKCksdC5zdGFjay5vdXRwdXROb2RlPXRoaXMuY2FsbCh0KSx0LnJlbW92ZVN0YWNrKCl9Z2VuZXJhdGUodCxlKXtyZXR1cm4gdGhpcy5nZXRPdXRwdXROb2RlKHQpLmJ1aWxkKHQsZSl9fWNsYXNzIERhIGV4dGVuZHMgVXtjb25zdHJ1Y3Rvcih0LGUpe3N1cGVyKGUpLHRoaXMuanNGdW5jPXQsdGhpcy5sYXlvdXQ9bnVsbCx0aGlzLmdsb2JhbD0hMCx0aGlzLm9uY2U9ITF9c2V0TGF5b3V0KHQpe3JldHVybiB0aGlzLmxheW91dD10LHRoaXN9Y2FsbCh0PW51bGwpe3JldHVybiBIcyh0KSx2KG5ldyBPYSh0aGlzLHQpKX1zZXR1cCgpe3JldHVybiB0aGlzLmNhbGwoKX19Y29uc3QgVmE9WyExLCEwXSxVYT1bMCwxLDIsM10sa2E9Wy0xLC0yXSxDcj1bLjUsMS41LDEvMywxZS02LDFlNixNYXRoLlBJLE1hdGguUEkqMiwxL01hdGguUEksMi9NYXRoLlBJLDEvKE1hdGguUEkqMiksTWF0aC5QSS8yXSxLbj1uZXcgTWFwO2Zvcihjb25zdCByIG9mIFZhKUtuLnNldChyLG5ldyBKdChyKSk7Y29uc3QgdGk9bmV3IE1hcDtmb3IoY29uc3QgciBvZiBVYSl0aS5zZXQocixuZXcgSnQociwidWludCIpKTtjb25zdCBlaT1uZXcgTWFwKFsuLi50aV0ubWFwKHI9Pm5ldyBKdChyLnZhbHVlLCJpbnQiKSkpO2Zvcihjb25zdCByIG9mIGthKWVpLnNldChyLG5ldyBKdChyLCJpbnQiKSk7Y29uc3QgVXM9bmV3IE1hcChbLi4uZWldLm1hcChyPT5uZXcgSnQoci52YWx1ZSkpKTtmb3IoY29uc3QgciBvZiBDcilVcy5zZXQocixuZXcgSnQocikpO2Zvcihjb25zdCByIG9mIENyKVVzLnNldCgtcixuZXcgSnQoLXIpKTtjb25zdCBrcz17Ym9vbDpLbix1aW50OnRpLGludHM6ZWksZmxvYXQ6VXN9LEZyPW5ldyBNYXAoWy4uLktuLC4uLlVzXSksc2k9KHIsdCk9PkZyLmhhcyhyKT9Gci5nZXQocik6ci5pc05vZGU9PT0hMD9yOm5ldyBKdChyLHQpLEhhPXI9Pnt0cnl7cmV0dXJuIHIuZ2V0Tm9kZVR5cGUoKX1jYXRjaHtyZXR1cm59fSxLPWZ1bmN0aW9uKHIsdD1udWxsKXtyZXR1cm4oLi4uZSk9PntpZigoZS5sZW5ndGg9PT0wfHwhWyJib29sIiwiZmxvYXQiLCJpbnQiLCJ1aW50Il0uaW5jbHVkZXMocikmJmUuZXZlcnkobj0+dHlwZW9mIG4hPSJvYmplY3QiKSkmJihlPVtOcihyLC4uLmUpXSksZS5sZW5ndGg9PT0xJiZ0IT09bnVsbCYmdC5oYXMoZVswXSkpcmV0dXJuIHYodC5nZXQoZVswXSkpO2lmKGUubGVuZ3RoPT09MSl7Y29uc3Qgbj1zaShlWzBdLHIpO3JldHVybiBIYShuKT09PXI/dihuKTp2KG5ldyBBcihuLHIpKX1jb25zdCBzPWUubWFwKG49PnNpKG4pKTtyZXR1cm4gdihuZXcgRWEocyxyKSl9fSxxYT1yPT5yIT1udWxsP3Iubm9kZVR5cGV8fHIuY29udmVydFRvfHwodHlwZW9mIHI9PSJzdHJpbmciP3I6bnVsbCk6bnVsbDtmdW5jdGlvbiAkYShyLHQpe3JldHVybiBuZXcgUHJveHkobmV3IERhKHIsdCksYnIpfWNvbnN0IHY9KHIsdD1udWxsKT0+QmEocix0KSxIcz0ocix0PW51bGwpPT5uZXcgSWEocix0KSxGZT0ocix0PW51bGwpPT5uZXcgdmEocix0KSxDPSguLi5yKT0+bmV3IFBhKC4uLnIpLE89KC4uLnIpPT5uZXcgTGEoLi4uciksdHQ9KHIsdCk9Pntjb25zdCBlPW5ldyAkYShyLHQpLHM9KC4uLm4pPT57bGV0IGk7cmV0dXJuIEhzKG4pLG5bMF0mJm5bMF0uaXNOb2RlP2k9Wy4uLm5dOmk9blswXSxlLmNhbGwoaSl9O3JldHVybiBzLnNoYWRlck5vZGU9ZSxzLnNldExheW91dD1uPT4oZS5zZXRMYXlvdXQobikscykscy5vbmNlPSgpPT4oZS5vbmNlPSEwLHMpLHN9O2IoInRvR2xvYmFsIixyPT4oci5nbG9iYWw9ITAscikpO2NvbnN0IG5pPSguLi5yKT0+U3IuSWYoLi4ucik7ZnVuY3Rpb24gR2Eocil7cmV0dXJuIHJ9YigiYXBwZW5kIixHYSk7Y29uc3QgV2E9bmV3IEsoImNvbG9yIikscT1uZXcgSygiZmxvYXQiLGtzLmZsb2F0KSxSZT1uZXcgSygiaW50Iixrcy5pbnRzKSxYYT1uZXcgSygidWludCIsa3MudWludCksWWE9bmV3IEsoImJvb2wiLGtzLmJvb2wpLEQ9bmV3IEsoInZlYzIiKSxaYT1uZXcgSygiaXZlYzIiKSxKYT1uZXcgSygidXZlYzIiKSxqYT1uZXcgSygiYnZlYzIiKSxrPW5ldyBLKCJ2ZWMzIiksUWE9bmV3IEsoIml2ZWMzIiksS2E9bmV3IEsoInV2ZWMzIiksdGM9bmV3IEsoImJ2ZWMzIiksQmU9bmV3IEsoInZlYzQiKSxlYz1uZXcgSygiaXZlYzQiKSxzYz1uZXcgSygidXZlYzQiKSxuYz1uZXcgSygiYnZlYzQiKSxScj1uZXcgSygibWF0MiIpLHFzPW5ldyBLKCJtYXQzIiksaWM9bmV3IEsoIm1hdDQiKTtiKCJ0b0NvbG9yIixXYSksYigidG9GbG9hdCIscSksYigidG9JbnQiLFJlKSxiKCJ0b1VpbnQiLFhhKSxiKCJ0b0Jvb2wiLFlhKSxiKCJ0b1ZlYzIiLEQpLGIoInRvSVZlYzIiLFphKSxiKCJ0b1VWZWMyIixKYSksYigidG9CVmVjMiIsamEpLGIoInRvVmVjMyIsayksYigidG9JVmVjMyIsUWEpLGIoInRvVVZlYzMiLEthKSxiKCJ0b0JWZWMzIix0YyksYigidG9WZWM0IixCZSksYigidG9JVmVjNCIsZWMpLGIoInRvVVZlYzQiLHNjKSxiKCJ0b0JWZWM0IixuYyksYigidG9NYXQyIixSciksYigidG9NYXQzIixxcyksYigidG9NYXQ0IixpYyk7Y29uc3QgcmM9Qyhpcyksb2M9KHIsdCk9PnYobmV3IEFyKHYociksdCkpO2IoImVsZW1lbnQiLHJjKSxiKCJjb252ZXJ0IixvYyk7Y2xhc3MgQnIgZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJVbmlmb3JtR3JvdXBOb2RlIn1jb25zdHJ1Y3Rvcih0LGU9ITEscz0xKXtzdXBlcigic3RyaW5nIiksdGhpcy5uYW1lPXQsdGhpcy52ZXJzaW9uPTAsdGhpcy5zaGFyZWQ9ZSx0aGlzLm9yZGVyPXMsdGhpcy5pc1VuaWZvcm1Hcm91cD0hMH1zZXQgbmVlZHNVcGRhdGUodCl7dD09PSEwJiZ0aGlzLnZlcnNpb24rK31zZXJpYWxpemUodCl7c3VwZXIuc2VyaWFsaXplKHQpLHQubmFtZT10aGlzLm5hbWUsdC52ZXJzaW9uPXRoaXMudmVyc2lvbix0LnNoYXJlZD10aGlzLnNoYXJlZH1kZXNlcmlhbGl6ZSh0KXtzdXBlci5kZXNlcmlhbGl6ZSh0KSx0aGlzLm5hbWU9dC5uYW1lLHRoaXMudmVyc2lvbj10LnZlcnNpb24sdGhpcy5zaGFyZWQ9dC5zaGFyZWR9fWNvbnN0IGFjPXI9Pm5ldyBCcihyKSxkZT0oKHIsdD0wKT0+bmV3IEJyKHIsITAsdCkpKCJyZW5kZXIiKSxjYz1hYygib2JqZWN0Iik7Y2xhc3MgSWUgZXh0ZW5kcyBqbntzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iVW5pZm9ybU5vZGUifWNvbnN0cnVjdG9yKHQsZT1udWxsKXtzdXBlcih0LGUpLHRoaXMuaXNVbmlmb3JtTm9kZT0hMCx0aGlzLm5hbWU9IiIsdGhpcy5ncm91cE5vZGU9Y2N9bGFiZWwodCl7cmV0dXJuIHRoaXMubmFtZT10LHRoaXN9c2V0R3JvdXAodCl7cmV0dXJuIHRoaXMuZ3JvdXBOb2RlPXQsdGhpc31nZXRHcm91cCgpe3JldHVybiB0aGlzLmdyb3VwTm9kZX1nZXRVbmlmb3JtSGFzaCh0KXtyZXR1cm4gdGhpcy5nZXRIYXNoKHQpfW9uVXBkYXRlKHQsZSl7Y29uc3Qgcz10aGlzLmdldFNlbGYoKTtyZXR1cm4gdD10LmJpbmQocyksc3VwZXIub25VcGRhdGUobj0+e2NvbnN0IGk9dChuLHMpO2khPT12b2lkIDAmJih0aGlzLnZhbHVlPWkpfSxlKX1nZW5lcmF0ZSh0LGUpe2NvbnN0IHM9dGhpcy5nZXROb2RlVHlwZSh0KSxuPXRoaXMuZ2V0VW5pZm9ybUhhc2godCk7bGV0IGk9dC5nZXROb2RlRnJvbUhhc2gobik7aT09PXZvaWQgMCYmKHQuc2V0SGFzaE5vZGUodGhpcyxuKSxpPXRoaXMpO2NvbnN0IG89aS5nZXRJbnB1dFR5cGUodCksYT10LmdldFVuaWZvcm1Gcm9tTm9kZShpLG8sdC5zaGFkZXJTdGFnZSx0aGlzLm5hbWV8fHQuY29udGV4dC5sYWJlbCksYz10LmdldFByb3BlcnR5TmFtZShhKTtyZXR1cm4gdC5jb250ZXh0LmxhYmVsIT09dm9pZCAwJiZkZWxldGUgdC5jb250ZXh0LmxhYmVsLHQuZm9ybWF0KGMscyxlKX19Y29uc3QgeHQ9KHIsdCk9Pntjb25zdCBlPXFhKHR8fHIpLHM9ciYmci5pc05vZGU9PT0hMD9yLm5vZGUmJnIubm9kZS52YWx1ZXx8ci52YWx1ZTpyO3JldHVybiB2KG5ldyBJZShzLGUpKX07Y2xhc3MgSXIgZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJQcm9wZXJ0eU5vZGUifWNvbnN0cnVjdG9yKHQsZT1udWxsLHM9ITEpe3N1cGVyKHQpLHRoaXMubmFtZT1lLHRoaXMudmFyeWluZz1zLHRoaXMuaXNQcm9wZXJ0eU5vZGU9ITB9Z2V0SGFzaCh0KXtyZXR1cm4gdGhpcy5uYW1lfHxzdXBlci5nZXRIYXNoKHQpfWlzR2xvYmFsKCl7cmV0dXJuITB9Z2VuZXJhdGUodCl7bGV0IGU7cmV0dXJuIHRoaXMudmFyeWluZz09PSEwPyhlPXQuZ2V0VmFyeWluZ0Zyb21Ob2RlKHRoaXMsdGhpcy5uYW1lKSxlLm5lZWRzSW50ZXJwb2xhdGlvbj0hMCk6ZT10LmdldFZhckZyb21Ob2RlKHRoaXMsdGhpcy5uYW1lKSx0LmdldFByb3BlcnR5TmFtZShlKX19Y29uc3QgdmU9KHIsdCk9PnYobmV3IElyKHIsdCkpLHZyPU8oSXIsInZlYzQiLCJEaWZmdXNlQ29sb3IiKTtjbGFzcyBoYyBleHRlbmRzIGR0e3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJBc3NpZ25Ob2RlIn1jb25zdHJ1Y3Rvcih0LGUpe3N1cGVyKCksdGhpcy50YXJnZXROb2RlPXQsdGhpcy5zb3VyY2VOb2RlPWV9aGFzRGVwZW5kZW5jaWVzKCl7cmV0dXJuITF9Z2V0Tm9kZVR5cGUodCxlKXtyZXR1cm4gZSE9PSJ2b2lkIj90aGlzLnRhcmdldE5vZGUuZ2V0Tm9kZVR5cGUodCk6InZvaWQifW5lZWRzU3BsaXRBc3NpZ24odCl7Y29uc3R7dGFyZ2V0Tm9kZTplfT10aGlzO2lmKHQuaXNBdmFpbGFibGUoInN3aXp6bGVBc3NpZ24iKT09PSExJiZlLmlzU3BsaXROb2RlJiZlLmNvbXBvbmVudHMubGVuZ3RoPjEpe2NvbnN0IHM9dC5nZXRUeXBlTGVuZ3RoKGUubm9kZS5nZXROb2RlVHlwZSh0KSk7cmV0dXJuIG5zLmpvaW4oIiIpLnNsaWNlKDAscykhPT1lLmNvbXBvbmVudHN9cmV0dXJuITF9Z2VuZXJhdGUodCxlKXtjb25zdHt0YXJnZXROb2RlOnMsc291cmNlTm9kZTpufT10aGlzLGk9dGhpcy5uZWVkc1NwbGl0QXNzaWduKHQpLG89cy5nZXROb2RlVHlwZSh0KSxhPXMuY29udGV4dCh7YXNzaWduOiEwfSkuYnVpbGQodCksYz1uLmJ1aWxkKHQsbyksdT1uLmdldE5vZGVUeXBlKHQpLGg9dC5nZXREYXRhRnJvbU5vZGUodGhpcyk7bGV0IGw7aWYoaC5pbml0aWFsaXplZD09PSEwKWUhPT0idm9pZCImJihsPWEpO2Vsc2UgaWYoaSl7Y29uc3QgZD10LmdldFZhckZyb21Ob2RlKHRoaXMsbnVsbCxvKSxmPXQuZ2V0UHJvcGVydHlOYW1lKGQpO3QuYWRkTGluZUZsb3dDb2RlKGAke2Z9ID0gJHtjfWAsdGhpcyk7Y29uc3QgcD1zLm5vZGUuY29udGV4dCh7YXNzaWduOiEwfSkuYnVpbGQodCk7Zm9yKGxldCBtPTA7bTxzLmNvbXBvbmVudHMubGVuZ3RoO20rKyl7Y29uc3QgZz1zLmNvbXBvbmVudHNbbV07dC5hZGRMaW5lRmxvd0NvZGUoYCR7cH0uJHtnfSA9ICR7Zn1bICR7bX0gXWAsdGhpcyl9ZSE9PSJ2b2lkIiYmKGw9YSl9ZWxzZSBsPWAke2F9ID0gJHtjfWAsKGU9PT0idm9pZCJ8fHU9PT0idm9pZCIpJiYodC5hZGRMaW5lRmxvd0NvZGUobCx0aGlzKSxlIT09InZvaWQiJiYobD1hKSk7cmV0dXJuIGguaW5pdGlhbGl6ZWQ9ITAsdC5mb3JtYXQobCxvLGUpfX1iKCJhc3NpZ24iLEMoaGMpKTtjbGFzcyB1YyBleHRlbmRzIGR0e3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJGdW5jdGlvbkNhbGxOb2RlIn1jb25zdHJ1Y3Rvcih0PW51bGwsZT17fSl7c3VwZXIoKSx0aGlzLmZ1bmN0aW9uTm9kZT10LHRoaXMucGFyYW1ldGVycz1lfXNldFBhcmFtZXRlcnModCl7cmV0dXJuIHRoaXMucGFyYW1ldGVycz10LHRoaXN9Z2V0UGFyYW1ldGVycygpe3JldHVybiB0aGlzLnBhcmFtZXRlcnN9Z2V0Tm9kZVR5cGUodCl7cmV0dXJuIHRoaXMuZnVuY3Rpb25Ob2RlLmdldE5vZGVUeXBlKHQpfWdlbmVyYXRlKHQpe2NvbnN0IGU9W10scz10aGlzLmZ1bmN0aW9uTm9kZSxuPXMuZ2V0SW5wdXRzKHQpLGk9dGhpcy5wYXJhbWV0ZXJzO2lmKEFycmF5LmlzQXJyYXkoaSkpZm9yKGxldCBhPTA7YTxpLmxlbmd0aDthKyspe2NvbnN0IGM9blthXSx1PWlbYV07ZS5wdXNoKHUuYnVpbGQodCxjLnR5cGUpKX1lbHNlIGZvcihjb25zdCBhIG9mIG4pe2NvbnN0IGM9aVthLm5hbWVdO2lmKGMhPT12b2lkIDApZS5wdXNoKGMuYnVpbGQodCxhLnR5cGUpKTtlbHNlIHRocm93IG5ldyBFcnJvcihgRnVuY3Rpb25DYWxsTm9kZTogSW5wdXQgJyR7YS5uYW1lfScgbm90IGZvdW5kIGluIEZ1bmN0aW9uTm9kZS5gKX1yZXR1cm5gJHtzLmJ1aWxkKHQsInByb3BlcnR5Iil9KCAke2Uuam9pbigiLCAiKX0gKWB9fWIoImNhbGwiLChyLC4uLnQpPT4odD10Lmxlbmd0aD4xfHx0WzBdJiZ0WzBdLmlzTm9kZT09PSEwP0ZlKHQpOkhzKHRbMF0pLHYobmV3IHVjKHYociksdCkpKSk7Y2xhc3MgWSBleHRlbmRzIGR0e3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJPcGVyYXRvck5vZGUifWNvbnN0cnVjdG9yKHQsZSxzLC4uLm4pe2lmKHN1cGVyKCksbi5sZW5ndGg+MCl7bGV0IGk9bmV3IFkodCxlLHMpO2ZvcihsZXQgbz0wO288bi5sZW5ndGgtMTtvKyspaT1uZXcgWSh0LGksbltvXSk7ZT1pLHM9bltuLmxlbmd0aC0xXX10aGlzLm9wPXQsdGhpcy5hTm9kZT1lLHRoaXMuYk5vZGU9c31nZXROb2RlVHlwZSh0LGUpe2NvbnN0IHM9dGhpcy5vcCxuPXRoaXMuYU5vZGUsaT10aGlzLmJOb2RlLG89bi5nZXROb2RlVHlwZSh0KSxhPXR5cGVvZiBpPCJ1Ij9pLmdldE5vZGVUeXBlKHQpOm51bGw7aWYobz09PSJ2b2lkInx8YT09PSJ2b2lkIilyZXR1cm4idm9pZCI7aWYocz09PSIlIilyZXR1cm4gbztpZihzPT09In4ifHxzPT09IiYifHxzPT09InwifHxzPT09Il4ifHxzPT09Ij4+Inx8cz09PSI8PCIpcmV0dXJuIHQuZ2V0SW50ZWdlclR5cGUobyk7aWYocz09PSIhInx8cz09PSI9PSJ8fHM9PT0iJiYifHxzPT09Inx8Inx8cz09PSJeXiIpcmV0dXJuImJvb2wiO2lmKHM9PT0iPCJ8fHM9PT0iPiJ8fHM9PT0iPD0ifHxzPT09Ij49Iil7Y29uc3QgYz1lP3QuZ2V0VHlwZUxlbmd0aChlKTpNYXRoLm1heCh0LmdldFR5cGVMZW5ndGgobyksdC5nZXRUeXBlTGVuZ3RoKGEpKTtyZXR1cm4gYz4xP2BidmVjJHtjfWA6ImJvb2wifWVsc2UgcmV0dXJuIG89PT0iZmxvYXQiJiZ0LmlzTWF0cml4KGEpP2E6dC5pc01hdHJpeChvKSYmdC5pc1ZlY3RvcihhKT90LmdldFZlY3RvckZyb21NYXRyaXgobyk6dC5pc1ZlY3RvcihvKSYmdC5pc01hdHJpeChhKT90LmdldFZlY3RvckZyb21NYXRyaXgoYSk6dC5nZXRUeXBlTGVuZ3RoKGEpPnQuZ2V0VHlwZUxlbmd0aChvKT9hOm99Z2VuZXJhdGUodCxlKXtjb25zdCBzPXRoaXMub3Asbj10aGlzLmFOb2RlLGk9dGhpcy5iTm9kZSxvPXRoaXMuZ2V0Tm9kZVR5cGUodCxlKTtsZXQgYT1udWxsLGM9bnVsbDtvIT09InZvaWQiPyhhPW4uZ2V0Tm9kZVR5cGUodCksYz10eXBlb2YgaTwidSI/aS5nZXROb2RlVHlwZSh0KTpudWxsLHM9PT0iPCJ8fHM9PT0iPiJ8fHM9PT0iPD0ifHxzPT09Ij49Inx8cz09PSI9PSI/dC5pc1ZlY3RvcihhKT9jPWE6YSE9PWMmJihhPWM9ImZsb2F0Iik6cz09PSI+PiJ8fHM9PT0iPDwiPyhhPW8sYz10LmNoYW5nZUNvbXBvbmVudFR5cGUoYywidWludCIpKTp0LmlzTWF0cml4KGEpJiZ0LmlzVmVjdG9yKGMpP2M9dC5nZXRWZWN0b3JGcm9tTWF0cml4KGEpOnQuaXNWZWN0b3IoYSkmJnQuaXNNYXRyaXgoYyk/YT10LmdldFZlY3RvckZyb21NYXRyaXgoYyk6YT1jPW8pOmE9Yz1vO2NvbnN0IHU9bi5idWlsZCh0LGEpLGg9dHlwZW9mIGk8InUiP2kuYnVpbGQodCxjKTpudWxsLGw9dC5nZXRUeXBlTGVuZ3RoKGUpLGQ9dC5nZXRGdW5jdGlvbk9wZXJhdG9yKHMpO2lmKGUhPT0idm9pZCIpcmV0dXJuIHM9PT0iPCImJmw+MT90LnVzZUNvbXBhcmlzb25NZXRob2Q/dC5mb3JtYXQoYCR7dC5nZXRNZXRob2QoImxlc3NUaGFuIixlKX0oICR7dX0sICR7aH0gKWAsbyxlKTp0LmZvcm1hdChgKCAke3V9IDwgJHtofSApYCxvLGUpOnM9PT0iPD0iJiZsPjE/dC51c2VDb21wYXJpc29uTWV0aG9kP3QuZm9ybWF0KGAke3QuZ2V0TWV0aG9kKCJsZXNzVGhhbkVxdWFsIixlKX0oICR7dX0sICR7aH0gKWAsbyxlKTp0LmZvcm1hdChgKCAke3V9IDw9ICR7aH0gKWAsbyxlKTpzPT09Ij4iJiZsPjE/dC51c2VDb21wYXJpc29uTWV0aG9kP3QuZm9ybWF0KGAke3QuZ2V0TWV0aG9kKCJncmVhdGVyVGhhbiIsZSl9KCAke3V9LCAke2h9IClgLG8sZSk6dC5mb3JtYXQoYCggJHt1fSA+ICR7aH0gKWAsbyxlKTpzPT09Ij49IiYmbD4xP3QudXNlQ29tcGFyaXNvbk1ldGhvZD90LmZvcm1hdChgJHt0LmdldE1ldGhvZCgiZ3JlYXRlclRoYW5FcXVhbCIsZSl9KCAke3V9LCAke2h9IClgLG8sZSk6dC5mb3JtYXQoYCggJHt1fSA+PSAke2h9IClgLG8sZSk6cz09PSIhInx8cz09PSJ+Ij90LmZvcm1hdChgKCR7c30ke3V9KWAsYSxlKTpkP3QuZm9ybWF0KGAke2R9KCAke3V9LCAke2h9IClgLG8sZSk6dC5mb3JtYXQoYCggJHt1fSAke3N9ICR7aH0gKWAsbyxlKTtpZihhIT09InZvaWQiKXJldHVybiBkP3QuZm9ybWF0KGAke2R9KCAke3V9LCAke2h9IClgLG8sZSk6dC5mb3JtYXQoYCR7dX0gJHtzfSAke2h9YCxvLGUpfXNlcmlhbGl6ZSh0KXtzdXBlci5zZXJpYWxpemUodCksdC5vcD10aGlzLm9wfWRlc2VyaWFsaXplKHQpe3N1cGVyLmRlc2VyaWFsaXplKHQpLHRoaXMub3A9dC5vcH19Y29uc3QgZmU9QyhZLCIrIiksJHM9QyhZLCItIiksR3M9QyhZLCIqIiksUHI9QyhZLCIvIiksTHI9QyhZLCIlIiksbGM9QyhZLCI9PSIpLGRjPUMoWSwiIT0iKSxmYz1DKFksIjwiKSxwYz1DKFksIj4iKSxtYz1DKFksIjw9IikseWM9QyhZLCI+PSIpLGdjPUMoWSwiJiYiKSx4Yz1DKFksInx8IiksVGM9QyhZLCIhIiksTmM9QyhZLCJeXiIpLHdjPUMoWSwiJiIpLEFjPUMoWSwifiIpLE1jPUMoWSwifCIpLFNjPUMoWSwiXiIpLF9jPUMoWSwiPDwiKSx6Yz1DKFksIj4+Iik7YigiYWRkIixmZSksYigic3ViIiwkcyksYigibXVsIixHcyksYigiZGl2IixQciksYigibW9kSW50IixMciksYigiZXF1YWwiLGxjKSxiKCJub3RFcXVhbCIsZGMpLGIoImxlc3NUaGFuIixmYyksYigiZ3JlYXRlclRoYW4iLHBjKSxiKCJsZXNzVGhhbkVxdWFsIixtYyksYigiZ3JlYXRlclRoYW5FcXVhbCIseWMpLGIoImFuZCIsZ2MpLGIoIm9yIix4YyksYigibm90IixUYyksYigieG9yIixOYyksYigiYml0QW5kIix3YyksYigiYml0Tm90IixBYyksYigiYml0T3IiLE1jKSxiKCJiaXRYb3IiLFNjKSxiKCJzaGlmdExlZnQiLF9jKSxiKCJzaGlmdFJpZ2h0Iix6YyksYigicmVtYWluZGVyIiwoLi4ucik9Pihjb25zb2xlLndhcm4oIlRTTC5PcGVyYXRvck5vZGU6IC5yZW1haW5kZXIoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5tb2RJbnQoKS4iKSxMciguLi5yKSkpO2NsYXNzIHggZXh0ZW5kcyBkdHtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iTWF0aE5vZGUifWNvbnN0cnVjdG9yKHQsZSxzPW51bGwsbj1udWxsKXtzdXBlcigpLHRoaXMubWV0aG9kPXQsdGhpcy5hTm9kZT1lLHRoaXMuYk5vZGU9cyx0aGlzLmNOb2RlPW59Z2V0SW5wdXRUeXBlKHQpe2NvbnN0IGU9dGhpcy5hTm9kZS5nZXROb2RlVHlwZSh0KSxzPXRoaXMuYk5vZGU/dGhpcy5iTm9kZS5nZXROb2RlVHlwZSh0KTpudWxsLG49dGhpcy5jTm9kZT90aGlzLmNOb2RlLmdldE5vZGVUeXBlKHQpOm51bGwsaT10LmlzTWF0cml4KGUpPzA6dC5nZXRUeXBlTGVuZ3RoKGUpLG89dC5pc01hdHJpeChzKT8wOnQuZ2V0VHlwZUxlbmd0aChzKSxhPXQuaXNNYXRyaXgobik/MDp0LmdldFR5cGVMZW5ndGgobik7cmV0dXJuIGk+byYmaT5hP2U6bz5hP3M6YT5pP246ZX1nZXROb2RlVHlwZSh0KXtjb25zdCBlPXRoaXMubWV0aG9kO3JldHVybiBlPT09eC5MRU5HVEh8fGU9PT14LkRJU1RBTkNFfHxlPT09eC5ET1Q/ImZsb2F0IjplPT09eC5DUk9TUz8idmVjMyI6ZT09PXguQUxMPyJib29sIjplPT09eC5FUVVBTFM/dC5jaGFuZ2VDb21wb25lbnRUeXBlKHRoaXMuYU5vZGUuZ2V0Tm9kZVR5cGUodCksImJvb2wiKTplPT09eC5NT0Q/dGhpcy5hTm9kZS5nZXROb2RlVHlwZSh0KTp0aGlzLmdldElucHV0VHlwZSh0KX1nZW5lcmF0ZSh0LGUpe2NvbnN0IHM9dGhpcy5tZXRob2Qsbj10aGlzLmdldE5vZGVUeXBlKHQpLGk9dGhpcy5nZXRJbnB1dFR5cGUodCksbz10aGlzLmFOb2RlLGE9dGhpcy5iTm9kZSxjPXRoaXMuY05vZGUsdT10LnJlbmRlcmVyLmlzV2ViR0xSZW5kZXJlcj09PSEwO2lmKHM9PT14LlRSQU5TRk9STV9ESVJFQ1RJT04pe2xldCBoPW8sbD1hO3QuaXNNYXRyaXgoaC5nZXROb2RlVHlwZSh0KSk/bD1CZShrKGwpLDApOmg9QmUoayhoKSwwKTtjb25zdCBkPUdzKGgsbCkueHl6O3JldHVybiBPcihkKS5idWlsZCh0LGUpfWVsc2V7aWYocz09PXguTkVHQVRFKXJldHVybiB0LmZvcm1hdCgiKCAtICIrby5idWlsZCh0LGkpKyIgKSIsbixlKTtpZihzPT09eC5PTkVfTUlOVVMpcmV0dXJuICRzKDEsbykuYnVpbGQodCxlKTtpZihzPT09eC5SRUNJUFJPQ0FMKXJldHVybiBQcigxLG8pLmJ1aWxkKHQsZSk7aWYocz09PXguRElGRkVSRU5DRSlyZXR1cm4gb2koJHMobyxhKSkuYnVpbGQodCxlKTt7Y29uc3QgaD1bXTtyZXR1cm4gcz09PXguQ1JPU1N8fHM9PT14Lk1PRD9oLnB1c2goby5idWlsZCh0LG4pLGEuYnVpbGQodCxuKSk6dSYmcz09PXguU1RFUD9oLnB1c2goby5idWlsZCh0LHQuZ2V0VHlwZUxlbmd0aChvLmdldE5vZGVUeXBlKHQpKT09PTE/ImZsb2F0IjppKSxhLmJ1aWxkKHQsaSkpOnUmJihzPT09eC5NSU58fHM9PT14Lk1BWCl8fHM9PT14Lk1PRD9oLnB1c2goby5idWlsZCh0LGkpLGEuYnVpbGQodCx0LmdldFR5cGVMZW5ndGgoYS5nZXROb2RlVHlwZSh0KSk9PT0xPyJmbG9hdCI6aSkpOnM9PT14LlJFRlJBQ1Q/aC5wdXNoKG8uYnVpbGQodCxpKSxhLmJ1aWxkKHQsaSksYy5idWlsZCh0LCJmbG9hdCIpKTpzPT09eC5NSVg/aC5wdXNoKG8uYnVpbGQodCxpKSxhLmJ1aWxkKHQsaSksYy5idWlsZCh0LHQuZ2V0VHlwZUxlbmd0aChjLmdldE5vZGVUeXBlKHQpKT09PTE/ImZsb2F0IjppKSk6KGgucHVzaChvLmJ1aWxkKHQsaSkpLGEhPT1udWxsJiZoLnB1c2goYS5idWlsZCh0LGkpKSxjIT09bnVsbCYmaC5wdXNoKGMuYnVpbGQodCxpKSkpLHQuZm9ybWF0KGAke3QuZ2V0TWV0aG9kKHMsbil9KCAke2guam9pbigiLCAiKX0gKWAsbixlKX19fXNlcmlhbGl6ZSh0KXtzdXBlci5zZXJpYWxpemUodCksdC5tZXRob2Q9dGhpcy5tZXRob2R9ZGVzZXJpYWxpemUodCl7c3VwZXIuZGVzZXJpYWxpemUodCksdGhpcy5tZXRob2Q9dC5tZXRob2R9fXguQUxMPSJhbGwiLHguQU5ZPSJhbnkiLHguRVFVQUxTPSJlcXVhbHMiLHguUkFESUFOUz0icmFkaWFucyIseC5ERUdSRUVTPSJkZWdyZWVzIix4LkVYUD0iZXhwIix4LkVYUDI9ImV4cDIiLHguTE9HPSJsb2ciLHguTE9HMj0ibG9nMiIseC5TUVJUPSJzcXJ0Iix4LklOVkVSU0VfU1FSVD0iaW52ZXJzZXNxcnQiLHguRkxPT1I9ImZsb29yIix4LkNFSUw9ImNlaWwiLHguTk9STUFMSVpFPSJub3JtYWxpemUiLHguRlJBQ1Q9ImZyYWN0Iix4LlNJTj0ic2luIix4LkNPUz0iY29zIix4LlRBTj0idGFuIix4LkFTSU49ImFzaW4iLHguQUNPUz0iYWNvcyIseC5BVEFOPSJhdGFuIix4LkFCUz0iYWJzIix4LlNJR049InNpZ24iLHguTEVOR1RIPSJsZW5ndGgiLHguTkVHQVRFPSJuZWdhdGUiLHguT05FX01JTlVTPSJvbmVNaW51cyIseC5ERkRYPSJkRmR4Iix4LkRGRFk9ImRGZHkiLHguUk9VTkQ9InJvdW5kIix4LlJFQ0lQUk9DQUw9InJlY2lwcm9jYWwiLHguVFJVTkM9InRydW5jIix4LkZXSURUSD0iZndpZHRoIix4LkJJVENBU1Q9ImJpdGNhc3QiLHguVFJBTlNQT1NFPSJ0cmFuc3Bvc2UiLHguQVRBTjI9ImF0YW4yIix4Lk1JTj0ibWluIix4Lk1BWD0ibWF4Iix4Lk1PRD0ibW9kIix4LlNURVA9InN0ZXAiLHguUkVGTEVDVD0icmVmbGVjdCIseC5ESVNUQU5DRT0iZGlzdGFuY2UiLHguRElGRkVSRU5DRT0iZGlmZmVyZW5jZSIseC5ET1Q9ImRvdCIseC5DUk9TUz0iY3Jvc3MiLHguUE9XPSJwb3ciLHguVFJBTlNGT1JNX0RJUkVDVElPTj0idHJhbnNmb3JtRGlyZWN0aW9uIix4Lk1JWD0ibWl4Iix4LkNMQU1QPSJjbGFtcCIseC5SRUZSQUNUPSJyZWZyYWN0Iix4LlNNT09USFNURVA9InNtb290aHN0ZXAiLHguRkFDRUZPUldBUkQ9ImZhY2Vmb3J3YXJkIjtjb25zdCBiYz1xKE1hdGguUEkpLEVjPUMoeCx4LkFMTCksQ2M9Qyh4LHguQU5ZKSxGYz1DKHgseC5FUVVBTFMpLFJjPUMoeCx4LlJBRElBTlMpLEJjPUMoeCx4LkRFR1JFRVMpLEljPUMoeCx4LkVYUCksdmM9Qyh4LHguRVhQMiksUGM9Qyh4LHguTE9HKSxMYz1DKHgseC5MT0cyKSxpaT1DKHgseC5TUVJUKSxPYz1DKHgseC5JTlZFUlNFX1NRUlQpLERjPUMoeCx4LkZMT09SKSxWYz1DKHgseC5DRUlMKSxPcj1DKHgseC5OT1JNQUxJWkUpLHJpPUMoeCx4LkZSQUNUKSxEcj1DKHgseC5TSU4pLFVjPUMoeCx4LkNPUyksa2M9Qyh4LHguVEFOKSxIYz1DKHgseC5BU0lOKSxxYz1DKHgseC5BQ09TKSwkYz1DKHgseC5BVEFOKSxvaT1DKHgseC5BQlMpLFZyPUMoeCx4LlNJR04pLEdjPUMoeCx4LkxFTkdUSCksV2M9Qyh4LHguTkVHQVRFKSxYYz1DKHgseC5PTkVfTUlOVVMpLFljPUMoeCx4LkRGRFgpLFpjPUMoeCx4LkRGRFkpLEpjPUMoeCx4LlJPVU5EKSxqYz1DKHgseC5SRUNJUFJPQ0FMKSxRYz1DKHgseC5UUlVOQyksS2M9Qyh4LHguRldJRFRIKTt4LkJJVENBU1Q7Y29uc3QgdGg9Qyh4LHguVFJBTlNQT1NFKSxlaD1DKHgseC5BVEFOMiksc2g9Qyh4LHguTUlOKSxhaT1DKHgseC5NQVgpLFVyPUMoeCx4Lk1PRCksa3I9Qyh4LHguU1RFUCksbmg9Qyh4LHguUkVGTEVDVCksaWg9Qyh4LHguRElTVEFOQ0UpLHJoPUMoeCx4LkRJRkZFUkVOQ0UpLGNpPUMoeCx4LkRPVCksb2g9Qyh4LHguQ1JPU1MpLEhyPUMoeCx4LlBPVyksYWg9Qyh4LHguUE9XLDIpLGNoPUMoeCx4LlBPVywzKSxoaD1DKHgseC5QT1csNCksdWg9Qyh4LHguVFJBTlNGT1JNX0RJUkVDVElPTiksbGg9cj0+R3MoVnIociksSHIob2kociksMS8zKSksZGg9cj0+Y2kocixyKSxyZT1DKHgseC5NSVgpLFdzPShyLHQ9MCxlPTEpPT52KG5ldyB4KHguQ0xBTVAsdihyKSx2KHQpLHYoZSkpKSxmaD1yPT5XcyhyKSxwaD1DKHgseC5SRUZSQUNUKSxoaT1DKHgseC5TTU9PVEhTVEVQKSxtaD1DKHgseC5GQUNFRk9SV0FSRCkseWg9dHQoKFtyXSk9Pntjb25zdCBzPTQzNzU4LjU0NTMsbj1jaShyLnh5LEQoMTIuOTg5OCw3OC4yMzMpKSxpPVVyKG4sYmMpO3JldHVybiByaShEcihpKS5tdWwocykpfSksZ2g9KHIsdCxlKT0+cmUodCxlLHIpLHhoPShyLHQsZSk9PmhpKHQsZSxyKTtiKCJhbGwiLEVjKSxiKCJhbnkiLENjKSxiKCJlcXVhbHMiLEZjKSxiKCJyYWRpYW5zIixSYyksYigiZGVncmVlcyIsQmMpLGIoImV4cCIsSWMpLGIoImV4cDIiLHZjKSxiKCJsb2ciLFBjKSxiKCJsb2cyIixMYyksYigic3FydCIsaWkpLGIoImludmVyc2VTcXJ0IixPYyksYigiZmxvb3IiLERjKSxiKCJjZWlsIixWYyksYigibm9ybWFsaXplIixPciksYigiZnJhY3QiLHJpKSxiKCJzaW4iLERyKSxiKCJjb3MiLFVjKSxiKCJ0YW4iLGtjKSxiKCJhc2luIixIYyksYigiYWNvcyIscWMpLGIoImF0YW4iLCRjKSxiKCJhYnMiLG9pKSxiKCJzaWduIixWciksYigibGVuZ3RoIixHYyksYigibGVuZ3RoU3EiLGRoKSxiKCJuZWdhdGUiLFdjKSxiKCJvbmVNaW51cyIsWGMpLGIoImRGZHgiLFljKSxiKCJkRmR5IixaYyksYigicm91bmQiLEpjKSxiKCJyZWNpcHJvY2FsIixqYyksYigidHJ1bmMiLFFjKSxiKCJmd2lkdGgiLEtjKSxiKCJhdGFuMiIsZWgpLGIoIm1pbiIsc2gpLGIoIm1heCIsYWkpLGIoIm1vZCIsVXIpLGIoInN0ZXAiLGtyKSxiKCJyZWZsZWN0IixuaCksYigiZGlzdGFuY2UiLGloKSxiKCJkb3QiLGNpKSxiKCJjcm9zcyIsb2gpLGIoInBvdyIsSHIpLGIoInBvdzIiLGFoKSxiKCJwb3czIixjaCksYigicG93NCIsaGgpLGIoInRyYW5zZm9ybURpcmVjdGlvbiIsdWgpLGIoIm1peCIsZ2gpLGIoImNsYW1wIixXcyksYigicmVmcmFjdCIscGgpLGIoInNtb290aHN0ZXAiLHhoKSxiKCJmYWNlRm9yd2FyZCIsbWgpLGIoImRpZmZlcmVuY2UiLHJoKSxiKCJzYXR1cmF0ZSIsZmgpLGIoImNicnQiLGxoKSxiKCJ0cmFuc3Bvc2UiLHRoKSxiKCJyYW5kIix5aCk7Y2xhc3MgVGggZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJDb25kaXRpb25hbE5vZGUifWNvbnN0cnVjdG9yKHQsZSxzPW51bGwpe3N1cGVyKCksdGhpcy5jb25kTm9kZT10LHRoaXMuaWZOb2RlPWUsdGhpcy5lbHNlTm9kZT1zfWdldE5vZGVUeXBlKHQpe2NvbnN0IGU9dGhpcy5pZk5vZGUuZ2V0Tm9kZVR5cGUodCk7aWYodGhpcy5lbHNlTm9kZSE9PW51bGwpe2NvbnN0IHM9dGhpcy5lbHNlTm9kZS5nZXROb2RlVHlwZSh0KTtpZih0LmdldFR5cGVMZW5ndGgocyk+dC5nZXRUeXBlTGVuZ3RoKGUpKXJldHVybiBzfXJldHVybiBlfXNldHVwKHQpe2NvbnN0IGU9dGhpcy5jb25kTm9kZS5jYWNoZSgpLHM9dGhpcy5pZk5vZGUuY2FjaGUoKSxuPXRoaXMuZWxzZU5vZGU/dGhpcy5lbHNlTm9kZS5jYWNoZSgpOm51bGwsaT10LmNvbnRleHQubm9kZUJsb2NrO3QuZ2V0RGF0YUZyb21Ob2RlKHMpLnBhcmVudE5vZGVCbG9jaz1pLG4hPT1udWxsJiYodC5nZXREYXRhRnJvbU5vZGUobikucGFyZW50Tm9kZUJsb2NrPWkpO2NvbnN0IG89dC5nZXROb2RlUHJvcGVydGllcyh0aGlzKTtvLmNvbmROb2RlPWUsby5pZk5vZGU9cy5jb250ZXh0KHtub2RlQmxvY2s6c30pLG8uZWxzZU5vZGU9bj9uLmNvbnRleHQoe25vZGVCbG9jazpufSk6bnVsbH1nZW5lcmF0ZSh0LGUpe2NvbnN0IHM9dGhpcy5nZXROb2RlVHlwZSh0KSxuPXQuZ2V0RGF0YUZyb21Ob2RlKHRoaXMpO2lmKG4ubm9kZVByb3BlcnR5IT09dm9pZCAwKXJldHVybiBuLm5vZGVQcm9wZXJ0eTtjb25zdHtjb25kTm9kZTppLGlmTm9kZTpvLGVsc2VOb2RlOmF9PXQuZ2V0Tm9kZVByb3BlcnRpZXModGhpcyksYz1lIT09InZvaWQiLHU9Yz92ZShzKS5idWlsZCh0KToiIjtuLm5vZGVQcm9wZXJ0eT11O2NvbnN0IGg9aS5idWlsZCh0LCJib29sIik7dC5hZGRGbG93Q29kZShgCiR7dC50YWJ9aWYgKCAke2h9ICkgewoKYCkuYWRkRmxvd1RhYigpO2xldCBsPW8uYnVpbGQodCxzKTtpZihsJiYoYz9sPXUrIiA9ICIrbCsiOyI6bD0icmV0dXJuICIrbCsiOyIpLHQucmVtb3ZlRmxvd1RhYigpLmFkZEZsb3dDb2RlKHQudGFiKyIJIitsK2AKCmArdC50YWIrIn0iKSxhIT09bnVsbCl7dC5hZGRGbG93Q29kZShgIGVsc2UgewoKYCkuYWRkRmxvd1RhYigpO2xldCBkPWEuYnVpbGQodCxzKTtkJiYoYz9kPXUrIiA9ICIrZCsiOyI6ZD0icmV0dXJuICIrZCsiOyIpLHQucmVtb3ZlRmxvd1RhYigpLmFkZEZsb3dDb2RlKHQudGFiKyIJIitkK2AKCmArdC50YWIrYH0KCmApfWVsc2UgdC5hZGRGbG93Q29kZShgCgpgKTtyZXR1cm4gdC5mb3JtYXQodSxzLGUpfX1jb25zdCB1aT1DKFRoKTtiKCJzZWxlY3QiLHVpKSxiKCJjb25kIiwoLi4ucik9Pihjb25zb2xlLndhcm4oIlRTTC5Db25kaXRpb25hbE5vZGU6IGNvbmQoKSBoYXMgYmVlbiByZW5hbWVkIHRvIHNlbGVjdCgpLiIpLHVpKC4uLnIpKSk7Y2xhc3MgTmggZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJDb250ZXh0Tm9kZSJ9Y29uc3RydWN0b3IodCxlPXt9KXtzdXBlcigpLHRoaXMuaXNDb250ZXh0Tm9kZT0hMCx0aGlzLm5vZGU9dCx0aGlzLnZhbHVlPWV9Z2V0U2NvcGUoKXtyZXR1cm4gdGhpcy5ub2RlLmdldFNjb3BlKCl9Z2V0Tm9kZVR5cGUodCl7cmV0dXJuIHRoaXMubm9kZS5nZXROb2RlVHlwZSh0KX1hbmFseXplKHQpe3RoaXMubm9kZS5idWlsZCh0KX1zZXR1cCh0KXtjb25zdCBlPXQuZ2V0Q29udGV4dCgpO3Quc2V0Q29udGV4dCh7Li4udC5jb250ZXh0LC4uLnRoaXMudmFsdWV9KTtjb25zdCBzPXRoaXMubm9kZS5idWlsZCh0KTtyZXR1cm4gdC5zZXRDb250ZXh0KGUpLHN9Z2VuZXJhdGUodCxlKXtjb25zdCBzPXQuZ2V0Q29udGV4dCgpO3Quc2V0Q29udGV4dCh7Li4udC5jb250ZXh0LC4uLnRoaXMudmFsdWV9KTtjb25zdCBuPXRoaXMubm9kZS5idWlsZCh0LGUpO3JldHVybiB0LnNldENvbnRleHQocyksbn19Y29uc3QgcXI9QyhOaCksd2g9KHIsdCk9PnFyKHIse2xhYmVsOnR9KTtiKCJjb250ZXh0IixxciksYigibGFiZWwiLHdoKTtjbGFzcyBBaCBleHRlbmRzIFV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIlZhck5vZGUifWNvbnN0cnVjdG9yKHQsZT1udWxsKXtzdXBlcigpLHRoaXMubm9kZT10LHRoaXMubmFtZT1lLHRoaXMuZ2xvYmFsPSEwLHRoaXMuaXNWYXJOb2RlPSEwfWdldEhhc2godCl7cmV0dXJuIHRoaXMubmFtZXx8c3VwZXIuZ2V0SGFzaCh0KX1nZXROb2RlVHlwZSh0KXtyZXR1cm4gdGhpcy5ub2RlLmdldE5vZGVUeXBlKHQpfWdlbmVyYXRlKHQpe2NvbnN0e25vZGU6ZSxuYW1lOnN9PXRoaXMsbj10LmdldFZhckZyb21Ob2RlKHRoaXMscyx0LmdldFZlY3RvclR5cGUodGhpcy5nZXROb2RlVHlwZSh0KSkpLGk9dC5nZXRQcm9wZXJ0eU5hbWUobiksbz1lLmJ1aWxkKHQsbi50eXBlKTtyZXR1cm4gdC5hZGRMaW5lRmxvd0NvZGUoYCR7aX0gPSAke299YCx0aGlzKSxpfX1jb25zdCAkcj1DKEFoKTtiKCJ0ZW1wIiwkciksYigidG9WYXIiLCguLi5yKT0+JHIoLi4ucikuYXBwZW5kKCkpO2NsYXNzIE1oIGV4dGVuZHMgVXtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iVmFyeWluZ05vZGUifWNvbnN0cnVjdG9yKHQsZT1udWxsKXtzdXBlcigpLHRoaXMubm9kZT10LHRoaXMubmFtZT1lLHRoaXMuaXNWYXJ5aW5nTm9kZT0hMH1pc0dsb2JhbCgpe3JldHVybiEwfWdldEhhc2godCl7cmV0dXJuIHRoaXMubmFtZXx8c3VwZXIuZ2V0SGFzaCh0KX1nZXROb2RlVHlwZSh0KXtyZXR1cm4gdGhpcy5ub2RlLmdldE5vZGVUeXBlKHQpfXNldHVwVmFyeWluZyh0KXtjb25zdCBlPXQuZ2V0Tm9kZVByb3BlcnRpZXModGhpcyk7bGV0IHM9ZS52YXJ5aW5nO2lmKHM9PT12b2lkIDApe2NvbnN0IG49dGhpcy5uYW1lLGk9dGhpcy5nZXROb2RlVHlwZSh0KTtlLnZhcnlpbmc9cz10LmdldFZhcnlpbmdGcm9tTm9kZSh0aGlzLG4saSksZS5ub2RlPXRoaXMubm9kZX1yZXR1cm4gcy5uZWVkc0ludGVycG9sYXRpb258fChzLm5lZWRzSW50ZXJwb2xhdGlvbj10LnNoYWRlclN0YWdlPT09ImZyYWdtZW50Iiksc31zZXR1cCh0KXt0aGlzLnNldHVwVmFyeWluZyh0KX1hbmFseXplKHQpe3JldHVybiB0aGlzLnNldHVwVmFyeWluZyh0KSx0aGlzLm5vZGUuYW5hbHl6ZSh0KX1nZW5lcmF0ZSh0KXtjb25zdCBlPXQuZ2V0Tm9kZVByb3BlcnRpZXModGhpcykscz10aGlzLnNldHVwVmFyeWluZyh0KTtpZihlLnByb3BlcnR5TmFtZT09PXZvaWQgMCl7Y29uc3Qgbj10aGlzLmdldE5vZGVUeXBlKHQpLGk9dC5nZXRQcm9wZXJ0eU5hbWUocyx3ci5WRVJURVgpO3QuZmxvd05vZGVGcm9tU2hhZGVyU3RhZ2Uod3IuVkVSVEVYLHRoaXMubm9kZSxuLGkpLGUucHJvcGVydHlOYW1lPWl9cmV0dXJuIHQuZ2V0UHJvcGVydHlOYW1lKHMpfX1jb25zdCBQZT1DKE1oKTtiKCJ2YXJ5aW5nIixQZSk7Y29uc3QgcnM9IldvcmtpbmdDb2xvclNwYWNlIixsaT0iT3V0cHV0Q29sb3JTcGFjZSI7ZnVuY3Rpb24gR3Iocil7bGV0IHQ9bnVsbDtyZXR1cm4gcj09PUVzP3Q9IkxpbmVhciI6cj09PSR0JiYodD0ic1JHQiIpLHR9ZnVuY3Rpb24gU2gocix0KXtyZXR1cm4gR3IocikrIlRvIitHcih0KX1jbGFzcyBYcyBleHRlbmRzIGR0e3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJDb2xvclNwYWNlTm9kZSJ9Y29uc3RydWN0b3IodCxlLHMpe3N1cGVyKCJ2ZWM0IiksdGhpcy5jb2xvck5vZGU9dCx0aGlzLnNvdXJjZT1lLHRoaXMudGFyZ2V0PXN9Z2V0Q29sb3JTcGFjZSh0LGUpe3JldHVybiBlPT09cnM/bXQud29ya2luZ0NvbG9yU3BhY2U6ZT09PWxpP3QuY29udGV4dC5vdXRwdXRDb2xvclNwYWNlfHx0LnJlbmRlcmVyLm91dHB1dENvbG9yU3BhY2U6ZX1zZXR1cCh0KXtjb25zdHtyZW5kZXJlcjplfT10LHtjb2xvck5vZGU6c309dGhpcyxuPXRoaXMuZ2V0Q29sb3JTcGFjZSh0LHRoaXMuc291cmNlKSxpPXRoaXMuZ2V0Q29sb3JTcGFjZSh0LHRoaXMudGFyZ2V0KTtpZihuPT09aSlyZXR1cm4gcztjb25zdCBvPVNoKG4saSk7bGV0IGE9bnVsbDtjb25zdCBjPWUubm9kZXMubGlicmFyeS5nZXRDb2xvclNwYWNlRnVuY3Rpb24obyk7cmV0dXJuIGMhPT1udWxsP2E9QmUoYyhzLnJnYikscy5hKTooY29uc29sZS5lcnJvcigiQ29sb3JTcGFjZU5vZGU6IFVuc3VwcG9ydGVkIENvbG9yIFNwYWNlIGNvbmZpZ3VyYXRpb24uIixvKSxhPXMpLGF9fWNvbnN0IF9oPXI9PnYobmV3IFhzKHYocikscnMsbGkpKSx6aD1yPT52KG5ldyBYcyh2KHIpLGxpLHJzKSksYmg9KHIsdCk9PnYobmV3IFhzKHYocikscnMsdCkpLFdyPShyLHQpPT52KG5ldyBYcyh2KHIpLHQscnMpKTtiKCJ0b091dHB1dENvbG9yU3BhY2UiLF9oKSxiKCJ0b1dvcmtpbmdDb2xvclNwYWNlIix6aCksYigid29ya2luZ1RvQ29sb3JTcGFjZSIsYmgpLGIoImNvbG9yU3BhY2VUb1dvcmtpbmciLFdyKTtsZXQgRWg9Y2xhc3MgZXh0ZW5kcyBpc3tzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iUmVmZXJlbmNlRWxlbWVudE5vZGUifWNvbnN0cnVjdG9yKHQsZSl7c3VwZXIodCxlKSx0aGlzLnJlZmVyZW5jZU5vZGU9dCx0aGlzLmlzUmVmZXJlbmNlRWxlbWVudE5vZGU9ITB9Z2V0Tm9kZVR5cGUoKXtyZXR1cm4gdGhpcy5yZWZlcmVuY2VOb2RlLnVuaWZvcm1UeXBlfWdlbmVyYXRlKHQpe2NvbnN0IGU9c3VwZXIuZ2VuZXJhdGUodCkscz10aGlzLnJlZmVyZW5jZU5vZGUuZ2V0Tm9kZVR5cGUoKSxuPXRoaXMuZ2V0Tm9kZVR5cGUoKTtyZXR1cm4gdC5mb3JtYXQoZSxzLG4pfX07Y2xhc3MgQ2ggZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJSZWZlcmVuY2VCYXNlTm9kZSJ9Y29uc3RydWN0b3IodCxlLHM9bnVsbCxuPW51bGwpe3N1cGVyKCksdGhpcy5wcm9wZXJ0eT10LHRoaXMudW5pZm9ybVR5cGU9ZSx0aGlzLm9iamVjdD1zLHRoaXMuY291bnQ9bix0aGlzLnByb3BlcnRpZXM9dC5zcGxpdCgiLiIpLHRoaXMucmVmZXJlbmNlPXMsdGhpcy5ub2RlPW51bGwsdGhpcy5ncm91cD1udWxsLHRoaXMudXBkYXRlVHlwZT1RLk9CSkVDVH1zZXRHcm91cCh0KXtyZXR1cm4gdGhpcy5ncm91cD10LHRoaXN9ZWxlbWVudCh0KXtyZXR1cm4gdihuZXcgRWgodGhpcyx2KHQpKSl9c2V0Tm9kZVR5cGUodCl7Y29uc3QgZT14dChudWxsLHQpLmdldFNlbGYoKTt0aGlzLmdyb3VwIT09bnVsbCYmZS5zZXRHcm91cCh0aGlzLmdyb3VwKSx0aGlzLm5vZGU9ZX1nZXROb2RlVHlwZSh0KXtyZXR1cm4gdGhpcy5ub2RlPT09bnVsbCYmKHRoaXMudXBkYXRlUmVmZXJlbmNlKHQpLHRoaXMudXBkYXRlVmFsdWUoKSksdGhpcy5ub2RlLmdldE5vZGVUeXBlKHQpfWdldFZhbHVlRnJvbVJlZmVyZW5jZSh0PXRoaXMucmVmZXJlbmNlKXtjb25zdHtwcm9wZXJ0aWVzOmV9PXRoaXM7bGV0IHM9dFtlWzBdXTtmb3IobGV0IG49MTtuPGUubGVuZ3RoO24rKylzPXNbZVtuXV07cmV0dXJuIHN9dXBkYXRlUmVmZXJlbmNlKHQpe3JldHVybiB0aGlzLnJlZmVyZW5jZT10aGlzLm9iamVjdCE9PW51bGw/dGhpcy5vYmplY3Q6dC5vYmplY3QsdGhpcy5yZWZlcmVuY2V9c2V0dXAoKXtyZXR1cm4gdGhpcy51cGRhdGVWYWx1ZSgpLHRoaXMubm9kZX11cGRhdGUoKXt0aGlzLnVwZGF0ZVZhbHVlKCl9dXBkYXRlVmFsdWUoKXt0aGlzLm5vZGU9PT1udWxsJiZ0aGlzLnNldE5vZGVUeXBlKHRoaXMudW5pZm9ybVR5cGUpO2NvbnN0IHQ9dGhpcy5nZXRWYWx1ZUZyb21SZWZlcmVuY2UoKTtBcnJheS5pc0FycmF5KHQpP3RoaXMubm9kZS5hcnJheT10OnRoaXMubm9kZS52YWx1ZT10fX1jbGFzcyBGaCBleHRlbmRzIENoe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJSZW5kZXJlclJlZmVyZW5jZU5vZGUifWNvbnN0cnVjdG9yKHQsZSxzPW51bGwpe3N1cGVyKHQsZSxzKSx0aGlzLnJlbmRlcmVyPXMsdGhpcy5zZXRHcm91cChkZSl9dXBkYXRlUmVmZXJlbmNlKHQpe3JldHVybiB0aGlzLnJlZmVyZW5jZT10aGlzLnJlbmRlcmVyIT09bnVsbD90aGlzLnJlbmRlcmVyOnQucmVuZGVyZXIsdGhpcy5yZWZlcmVuY2V9fWNvbnN0IFJoPShyLHQsZSk9PnYobmV3IEZoKHIsdCxlKSk7Y2xhc3MgQmggZXh0ZW5kcyBkdHtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iVG9uZU1hcHBpbmdOb2RlIn1jb25zdHJ1Y3Rvcih0LGU9dmgscz1udWxsKXtzdXBlcigidmVjMyIpLHRoaXMudG9uZU1hcHBpbmc9dCx0aGlzLmV4cG9zdXJlTm9kZT1lLHRoaXMuY29sb3JOb2RlPXN9Z2V0Q2FjaGVLZXkoKXtyZXR1cm4gTWEoc3VwZXIuZ2V0Q2FjaGVLZXkoKSx0aGlzLnRvbmVNYXBwaW5nKX1zZXR1cCh0KXtjb25zdCBlPXRoaXMuY29sb3JOb2RlfHx0LmNvbnRleHQuY29sb3Iscz10aGlzLnRvbmVNYXBwaW5nO2lmKHM9PT1NbilyZXR1cm4gZTtsZXQgbj1udWxsO2NvbnN0IGk9dC5yZW5kZXJlci5ub2Rlcy5saWJyYXJ5LmdldFRvbmVNYXBwaW5nRnVuY3Rpb24ocyk7cmV0dXJuIGkhPT1udWxsP249QmUoaShlLnJnYix0aGlzLmV4cG9zdXJlTm9kZSksZS5hKTooY29uc29sZS5lcnJvcigiVG9uZU1hcHBpbmdOb2RlOiBVbnN1cHBvcnRlZCBUb25lIE1hcHBpbmcgY29uZmlndXJhdGlvbi4iLHMpLG49ZSksbn19Y29uc3QgSWg9KHIsdCxlKT0+dihuZXcgQmgocix2KHQpLHYoZSkpKSx2aD1SaCgidG9uZU1hcHBpbmdFeHBvc3VyZSIsImZsb2F0Iik7YigidG9uZU1hcHBpbmciLChyLHQsZSk9PkloKHQsZSxyKSk7Y2xhc3MgUGggZXh0ZW5kcyBqbntzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iQnVmZmVyQXR0cmlidXRlTm9kZSJ9Y29uc3RydWN0b3IodCxlPW51bGwscz0wLG49MCl7c3VwZXIodCxlKSx0aGlzLmlzQnVmZmVyTm9kZT0hMCx0aGlzLmJ1ZmZlclR5cGU9ZSx0aGlzLmJ1ZmZlclN0cmlkZT1zLHRoaXMuYnVmZmVyT2Zmc2V0PW4sdGhpcy51c2FnZT1Dcyx0aGlzLmluc3RhbmNlZD0hMSx0aGlzLmF0dHJpYnV0ZT1udWxsLHRoaXMuZ2xvYmFsPSEwLHQmJnQuaXNCdWZmZXJBdHRyaWJ1dGU9PT0hMCYmKHRoaXMuYXR0cmlidXRlPXQsdGhpcy51c2FnZT10LnVzYWdlLHRoaXMuaW5zdGFuY2VkPXQuaXNJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGUpfWdldEhhc2godCl7aWYodGhpcy5idWZmZXJTdHJpZGU9PT0wJiZ0aGlzLmJ1ZmZlck9mZnNldD09PTApe2xldCBlPXQuZ2xvYmFsQ2FjaGUuZ2V0RGF0YSh0aGlzLnZhbHVlKTtyZXR1cm4gZT09PXZvaWQgMCYmKGU9e25vZGU6dGhpc30sdC5nbG9iYWxDYWNoZS5zZXREYXRhKHRoaXMudmFsdWUsZSkpLGUubm9kZS51dWlkfXJldHVybiB0aGlzLnV1aWR9Z2V0Tm9kZVR5cGUodCl7cmV0dXJuIHRoaXMuYnVmZmVyVHlwZT09PW51bGwmJih0aGlzLmJ1ZmZlclR5cGU9dC5nZXRUeXBlRnJvbUF0dHJpYnV0ZSh0aGlzLmF0dHJpYnV0ZSkpLHRoaXMuYnVmZmVyVHlwZX1zZXR1cCh0KXtpZih0aGlzLmF0dHJpYnV0ZSE9PW51bGwpcmV0dXJuO2NvbnN0IGU9dGhpcy5nZXROb2RlVHlwZSh0KSxzPXRoaXMudmFsdWUsbj10LmdldFR5cGVMZW5ndGgoZSksaT10aGlzLmJ1ZmZlclN0cmlkZXx8bixvPXRoaXMuYnVmZmVyT2Zmc2V0LGE9cy5pc0ludGVybGVhdmVkQnVmZmVyPT09ITA/czpuZXcgd2EocyxpKSxjPW5ldyBZbihhLG4sbyk7YS5zZXRVc2FnZSh0aGlzLnVzYWdlKSx0aGlzLmF0dHJpYnV0ZT1jLHRoaXMuYXR0cmlidXRlLmlzSW5zdGFuY2VkQnVmZmVyQXR0cmlidXRlPXRoaXMuaW5zdGFuY2VkfWdlbmVyYXRlKHQpe2NvbnN0IGU9dGhpcy5nZXROb2RlVHlwZSh0KSxzPXQuZ2V0QnVmZmVyQXR0cmlidXRlRnJvbU5vZGUodGhpcyxlKSxuPXQuZ2V0UHJvcGVydHlOYW1lKHMpO2xldCBpPW51bGw7cmV0dXJuIHQuc2hhZGVyU3RhZ2U9PT0idmVydGV4Inx8dC5zaGFkZXJTdGFnZT09PSJjb21wdXRlIj8odGhpcy5uYW1lPW4saT1uKTppPVBlKHRoaXMpLmJ1aWxkKHQsZSksaX1nZXRJbnB1dFR5cGUoKXtyZXR1cm4iYnVmZmVyQXR0cmlidXRlIn1zZXRVc2FnZSh0KXtyZXR1cm4gdGhpcy51c2FnZT10LHRoaXMuYXR0cmlidXRlJiZ0aGlzLmF0dHJpYnV0ZS5pc0J1ZmZlckF0dHJpYnV0ZT09PSEwJiYodGhpcy5hdHRyaWJ1dGUudXNhZ2U9dCksdGhpc31zZXRJbnN0YW5jZWQodCl7cmV0dXJuIHRoaXMuaW5zdGFuY2VkPXQsdGhpc319Y29uc3QgTGg9KHIsdCxlLHMpPT52KG5ldyBQaChyLHQsZSxzKSk7YigidG9BdHRyaWJ1dGUiLHI9PkxoKHIudmFsdWUpKTtjbGFzcyBPaCBleHRlbmRzIFV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIkNvbXB1dGVOb2RlIn1jb25zdHJ1Y3Rvcih0LGUscz1bNjRdKXtzdXBlcigidm9pZCIpLHRoaXMuaXNDb21wdXRlTm9kZT0hMCx0aGlzLmNvbXB1dGVOb2RlPXQsdGhpcy5jb3VudD1lLHRoaXMud29ya2dyb3VwU2l6ZT1zLHRoaXMuZGlzcGF0Y2hDb3VudD0wLHRoaXMudmVyc2lvbj0xLHRoaXMudXBkYXRlQmVmb3JlVHlwZT1RLk9CSkVDVCx0aGlzLnVwZGF0ZURpc3BhdGNoQ291bnQoKX1kaXNwb3NlKCl7dGhpcy5kaXNwYXRjaEV2ZW50KHt0eXBlOiJkaXNwb3NlIn0pfXNldCBuZWVkc1VwZGF0ZSh0KXt0PT09ITAmJnRoaXMudmVyc2lvbisrfXVwZGF0ZURpc3BhdGNoQ291bnQoKXtjb25zdHtjb3VudDp0LHdvcmtncm91cFNpemU6ZX09dGhpcztsZXQgcz1lWzBdO2ZvcihsZXQgbj0xO248ZS5sZW5ndGg7bisrKXMqPWVbbl07dGhpcy5kaXNwYXRjaENvdW50PU1hdGguY2VpbCh0L3MpfW9uSW5pdCgpe311cGRhdGVCZWZvcmUoe3JlbmRlcmVyOnR9KXt0LmNvbXB1dGUodGhpcyl9Z2VuZXJhdGUodCl7Y29uc3R7c2hhZGVyU3RhZ2U6ZX09dDtpZihlPT09ImNvbXB1dGUiKXtjb25zdCBzPXRoaXMuY29tcHV0ZU5vZGUuYnVpbGQodCwidm9pZCIpO3MhPT0iIiYmdC5hZGRMaW5lRmxvd0NvZGUocyx0aGlzKX19fWIoImNvbXB1dGUiLChyLHQsZSk9PnYobmV3IE9oKHYociksdCxlKSkpO2NsYXNzIERoIGV4dGVuZHMgVXtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iQ2FjaGVOb2RlIn1jb25zdHJ1Y3Rvcih0LGU9ITApe3N1cGVyKCksdGhpcy5ub2RlPXQsdGhpcy5wYXJlbnQ9ZSx0aGlzLmlzQ2FjaGVOb2RlPSEwfWdldE5vZGVUeXBlKHQpe3JldHVybiB0aGlzLm5vZGUuZ2V0Tm9kZVR5cGUodCl9YnVpbGQodCwuLi5lKXtjb25zdCBzPXQuZ2V0Q2FjaGUoKSxuPXQuZ2V0Q2FjaGVGcm9tTm9kZSh0aGlzLHRoaXMucGFyZW50KTt0LnNldENhY2hlKG4pO2NvbnN0IGk9dGhpcy5ub2RlLmJ1aWxkKHQsLi4uZSk7cmV0dXJuIHQuc2V0Q2FjaGUocyksaX19YigiY2FjaGUiLChyLC4uLnQpPT52KG5ldyBEaCh2KHIpLC4uLnQpKSk7Y2xhc3MgVmggZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJCeXBhc3NOb2RlIn1jb25zdHJ1Y3Rvcih0LGUpe3N1cGVyKCksdGhpcy5pc0J5cGFzc05vZGU9ITAsdGhpcy5vdXRwdXROb2RlPXQsdGhpcy5jYWxsTm9kZT1lfWdldE5vZGVUeXBlKHQpe3JldHVybiB0aGlzLm91dHB1dE5vZGUuZ2V0Tm9kZVR5cGUodCl9Z2VuZXJhdGUodCl7Y29uc3QgZT10aGlzLmNhbGxOb2RlLmJ1aWxkKHQsInZvaWQiKTtyZXR1cm4gZSE9PSIiJiZ0LmFkZExpbmVGbG93Q29kZShlLHRoaXMpLHRoaXMub3V0cHV0Tm9kZS5idWlsZCh0KX19YigiYnlwYXNzIixDKFZoKSk7Y2xhc3MgWHIgZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJSZW1hcE5vZGUifWNvbnN0cnVjdG9yKHQsZSxzLG49cSgwKSxpPXEoMSkpe3N1cGVyKCksdGhpcy5ub2RlPXQsdGhpcy5pbkxvd05vZGU9ZSx0aGlzLmluSGlnaE5vZGU9cyx0aGlzLm91dExvd05vZGU9bix0aGlzLm91dEhpZ2hOb2RlPWksdGhpcy5kb0NsYW1wPSEwfXNldHVwKCl7Y29uc3R7bm9kZTp0LGluTG93Tm9kZTplLGluSGlnaE5vZGU6cyxvdXRMb3dOb2RlOm4sb3V0SGlnaE5vZGU6aSxkb0NsYW1wOm99PXRoaXM7bGV0IGE9dC5zdWIoZSkuZGl2KHMuc3ViKGUpKTtyZXR1cm4gbz09PSEwJiYoYT1hLmNsYW1wKCkpLGEubXVsKGkuc3ViKG4pKS5hZGQobil9fWNvbnN0IFVoPUMoWHIsbnVsbCxudWxsLHtkb0NsYW1wOiExfSksa2g9QyhYcik7YigicmVtYXAiLFVoKSxiKCJyZW1hcENsYW1wIixraCk7Y2xhc3MgSGggZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJFeHByZXNzaW9uTm9kZSJ9Y29uc3RydWN0b3IodD0iIixlPSJ2b2lkIil7c3VwZXIoZSksdGhpcy5zbmlwcGV0PXR9Z2VuZXJhdGUodCxlKXtjb25zdCBzPXRoaXMuZ2V0Tm9kZVR5cGUodCksbj10aGlzLnNuaXBwZXQ7aWYocz09PSJ2b2lkIil0LmFkZExpbmVGbG93Q29kZShuLHRoaXMpO2Vsc2UgcmV0dXJuIHQuZm9ybWF0KGAoICR7bn0gKWAscyxlKX19Y29uc3QgWXM9QyhIaCk7YigiZGlzY2FyZCIscj0+KHI/dWkocixZcygiZGlzY2FyZCIpKTpZcygiZGlzY2FyZCIpKS5hcHBlbmQoKSk7Y2xhc3MgcWggZXh0ZW5kcyBkdHtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iUmVuZGVyT3V0cHV0Tm9kZSJ9Y29uc3RydWN0b3IodCxlLHMpe3N1cGVyKCJ2ZWM0IiksdGhpcy5jb2xvck5vZGU9dCx0aGlzLnRvbmVNYXBwaW5nPWUsdGhpcy5vdXRwdXRDb2xvclNwYWNlPXMsdGhpcy5pc1JlbmRlck91dHB1dD0hMH1zZXR1cCh7Y29udGV4dDp0fSl7bGV0IGU9dGhpcy5jb2xvck5vZGV8fHQuY29sb3I7Y29uc3Qgcz0odGhpcy50b25lTWFwcGluZyE9PW51bGw/dGhpcy50b25lTWFwcGluZzp0LnRvbmVNYXBwaW5nKXx8TW4sbj0odGhpcy5vdXRwdXRDb2xvclNwYWNlIT09bnVsbD90aGlzLm91dHB1dENvbG9yU3BhY2U6dC5vdXRwdXRDb2xvclNwYWNlKXx8YnM7cmV0dXJuIHMhPT1NbiYmKGU9ZS50b25lTWFwcGluZyhzKSksbiE9PWJzJiZuIT09bXQud29ya2luZ0NvbG9yU3BhY2UmJihlPWUud29ya2luZ1RvQ29sb3JTcGFjZShuKSksZX19YigicmVuZGVyT3V0cHV0Iiwocix0PW51bGwsZT1udWxsKT0+dihuZXcgcWgodihyKSx0LGUpKSk7Y2xhc3MgJGggZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJBdHRyaWJ1dGVOb2RlIn1jb25zdHJ1Y3Rvcih0LGU9bnVsbCl7c3VwZXIoZSksdGhpcy5nbG9iYWw9ITAsdGhpcy5fYXR0cmlidXRlTmFtZT10fWdldEhhc2godCl7cmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlTmFtZSh0KX1nZXROb2RlVHlwZSh0KXtsZXQgZT10aGlzLm5vZGVUeXBlO2lmKGU9PT1udWxsKXtjb25zdCBzPXRoaXMuZ2V0QXR0cmlidXRlTmFtZSh0KTtpZih0Lmhhc0dlb21ldHJ5QXR0cmlidXRlKHMpKXtjb25zdCBuPXQuZ2VvbWV0cnkuZ2V0QXR0cmlidXRlKHMpO2U9dC5nZXRUeXBlRnJvbUF0dHJpYnV0ZShuKX1lbHNlIGU9ImZsb2F0In1yZXR1cm4gZX1zZXRBdHRyaWJ1dGVOYW1lKHQpe3JldHVybiB0aGlzLl9hdHRyaWJ1dGVOYW1lPXQsdGhpc31nZXRBdHRyaWJ1dGVOYW1lKCl7cmV0dXJuIHRoaXMuX2F0dHJpYnV0ZU5hbWV9Z2VuZXJhdGUodCl7Y29uc3QgZT10aGlzLmdldEF0dHJpYnV0ZU5hbWUodCkscz10aGlzLmdldE5vZGVUeXBlKHQpO2lmKHQuaGFzR2VvbWV0cnlBdHRyaWJ1dGUoZSk9PT0hMCl7Y29uc3QgaT10Lmdlb21ldHJ5LmdldEF0dHJpYnV0ZShlKSxvPXQuZ2V0VHlwZUZyb21BdHRyaWJ1dGUoaSksYT10LmdldEF0dHJpYnV0ZShlLG8pO3JldHVybiB0LnNoYWRlclN0YWdlPT09InZlcnRleCI/dC5mb3JtYXQoYS5uYW1lLG8scyk6UGUodGhpcykuYnVpbGQodCxzKX1lbHNlIHJldHVybiBjb25zb2xlLndhcm4oYEF0dHJpYnV0ZU5vZGU6IFZlcnRleCBhdHRyaWJ1dGUgIiR7ZX0iIG5vdCBmb3VuZCBvbiBnZW9tZXRyeS5gKSx0LmdlbmVyYXRlQ29uc3Qocyl9c2VyaWFsaXplKHQpe3N1cGVyLnNlcmlhbGl6ZSh0KSx0Lmdsb2JhbD10aGlzLmdsb2JhbCx0Ll9hdHRyaWJ1dGVOYW1lPXRoaXMuX2F0dHJpYnV0ZU5hbWV9ZGVzZXJpYWxpemUodCl7c3VwZXIuZGVzZXJpYWxpemUodCksdGhpcy5nbG9iYWw9dC5nbG9iYWwsdGhpcy5fYXR0cmlidXRlTmFtZT10Ll9hdHRyaWJ1dGVOYW1lfX1jb25zdCBvcz0ocix0KT0+dihuZXcgJGgocix0KSksWnM9cj0+b3MoInV2Iisocj4wP3I6IiIpLCJ2ZWMyIik7Y2xhc3MgR2ggZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJUZXh0dXJlU2l6ZU5vZGUifWNvbnN0cnVjdG9yKHQsZT1udWxsKXtzdXBlcigidXZlYzIiKSx0aGlzLmlzVGV4dHVyZVNpemVOb2RlPSEwLHRoaXMudGV4dHVyZU5vZGU9dCx0aGlzLmxldmVsTm9kZT1lfWdlbmVyYXRlKHQsZSl7Y29uc3Qgcz10aGlzLnRleHR1cmVOb2RlLmJ1aWxkKHQsInByb3BlcnR5Iiksbj10aGlzLmxldmVsTm9kZT09PW51bGw/IjAiOnRoaXMubGV2ZWxOb2RlLmJ1aWxkKHQsImludCIpO3JldHVybiB0LmZvcm1hdChgJHt0LmdldE1ldGhvZCgidGV4dHVyZURpbWVuc2lvbnMiKX0oICR7c30sICR7bn0gKWAsdGhpcy5nZXROb2RlVHlwZSh0KSxlKX19Y29uc3QgWXI9QyhHaCk7Y2xhc3MgV2ggZXh0ZW5kcyBJZXtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iTWF4TWlwTGV2ZWxOb2RlIn1jb25zdHJ1Y3Rvcih0KXtzdXBlcigwKSx0aGlzLl90ZXh0dXJlTm9kZT10LHRoaXMudXBkYXRlVHlwZT1RLkZSQU1FfWdldCB0ZXh0dXJlTm9kZSgpe3JldHVybiB0aGlzLl90ZXh0dXJlTm9kZX1nZXQgdGV4dHVyZSgpe3JldHVybiB0aGlzLl90ZXh0dXJlTm9kZS52YWx1ZX11cGRhdGUoKXtjb25zdCB0PXRoaXMudGV4dHVyZSxlPXQuaW1hZ2VzLHM9ZSYmZS5sZW5ndGg+MD9lWzBdJiZlWzBdLmltYWdlfHxlWzBdOnQuaW1hZ2U7aWYocyYmcy53aWR0aCE9PXZvaWQgMCl7Y29uc3R7d2lkdGg6bixoZWlnaHQ6aX09czt0aGlzLnZhbHVlPU1hdGgubG9nMihNYXRoLm1heChuLGkpKX19fWNvbnN0IFhoPUMoV2gpO2NsYXNzIEpzIGV4dGVuZHMgSWV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIlRleHR1cmVOb2RlIn1jb25zdHJ1Y3Rvcih0LGU9bnVsbCxzPW51bGwsbj1udWxsKXtzdXBlcih0KSx0aGlzLmlzVGV4dHVyZU5vZGU9ITAsdGhpcy51dk5vZGU9ZSx0aGlzLmxldmVsTm9kZT1zLHRoaXMuYmlhc05vZGU9bix0aGlzLmNvbXBhcmVOb2RlPW51bGwsdGhpcy5kZXB0aE5vZGU9bnVsbCx0aGlzLmdyYWROb2RlPW51bGwsdGhpcy5zYW1wbGVyPSEwLHRoaXMudXBkYXRlTWF0cml4PSExLHRoaXMudXBkYXRlVHlwZT1RLk5PTkUsdGhpcy5yZWZlcmVuY2VOb2RlPW51bGwsdGhpcy5fdmFsdWU9dCx0aGlzLl9tYXRyaXhVbmlmb3JtPW51bGwsdGhpcy5zZXRVcGRhdGVNYXRyaXgoZT09PW51bGwpfXNldCB2YWx1ZSh0KXt0aGlzLnJlZmVyZW5jZU5vZGU/dGhpcy5yZWZlcmVuY2VOb2RlLnZhbHVlPXQ6dGhpcy5fdmFsdWU9dH1nZXQgdmFsdWUoKXtyZXR1cm4gdGhpcy5yZWZlcmVuY2VOb2RlP3RoaXMucmVmZXJlbmNlTm9kZS52YWx1ZTp0aGlzLl92YWx1ZX1nZXRVbmlmb3JtSGFzaCgpe3JldHVybiB0aGlzLnZhbHVlLnV1aWR9Z2V0Tm9kZVR5cGUoKXtyZXR1cm4gdGhpcy52YWx1ZS5pc0RlcHRoVGV4dHVyZT09PSEwPyJmbG9hdCI6dGhpcy52YWx1ZS50eXBlPT09V2k/InV2ZWM0Ijp0aGlzLnZhbHVlLnR5cGU9PT1Cbz8iaXZlYzQiOiJ2ZWM0In1nZXRJbnB1dFR5cGUoKXtyZXR1cm4idGV4dHVyZSJ9Z2V0RGVmYXVsdFVWKCl7cmV0dXJuIFpzKHRoaXMudmFsdWUuY2hhbm5lbCl9dXBkYXRlUmVmZXJlbmNlKCl7cmV0dXJuIHRoaXMudmFsdWV9Z2V0VHJhbnNmb3JtZWRVVih0KXtyZXR1cm4gdGhpcy5fbWF0cml4VW5pZm9ybT09PW51bGwmJih0aGlzLl9tYXRyaXhVbmlmb3JtPXh0KHRoaXMudmFsdWUubWF0cml4KSksdGhpcy5fbWF0cml4VW5pZm9ybS5tdWwoayh0LDEpKS54eX1zZXRVcGRhdGVNYXRyaXgodCl7cmV0dXJuIHRoaXMudXBkYXRlTWF0cml4PXQsdGhpcy51cGRhdGVUeXBlPXQ/US5GUkFNRTpRLk5PTkUsdGhpc31zZXR1cFVWKHQsZSl7Y29uc3Qgcz10aGlzLnZhbHVlO3JldHVybiB0LmlzRmxpcFkoKSYmKHMuaXNSZW5kZXJUYXJnZXRUZXh0dXJlPT09ITB8fHMuaXNGcmFtZWJ1ZmZlclRleHR1cmU9PT0hMHx8cy5pc0RlcHRoVGV4dHVyZT09PSEwKSYmKHRoaXMuc2FtcGxlcj9lPWUuZmxpcFkoKTplPWUuc2V0WShSZShZcih0aGlzLHRoaXMubGV2ZWxOb2RlKS55KS5zdWIoZS55KS5zdWIoMSkpKSxlfXNldHVwKHQpe2NvbnN0IGU9dC5nZXROb2RlUHJvcGVydGllcyh0aGlzKTtlLnJlZmVyZW5jZU5vZGU9dGhpcy5yZWZlcmVuY2VOb2RlO2xldCBzPXRoaXMudXZOb2RlOyhzPT09bnVsbHx8dC5jb250ZXh0LmZvcmNlVVZDb250ZXh0PT09ITApJiZ0LmNvbnRleHQuZ2V0VVYmJihzPXQuY29udGV4dC5nZXRVVih0aGlzKSksc3x8KHM9dGhpcy5nZXREZWZhdWx0VVYoKSksdGhpcy51cGRhdGVNYXRyaXg9PT0hMCYmKHM9dGhpcy5nZXRUcmFuc2Zvcm1lZFVWKHMpKSxzPXRoaXMuc2V0dXBVVih0LHMpO2xldCBuPXRoaXMubGV2ZWxOb2RlO249PT1udWxsJiZ0LmNvbnRleHQuZ2V0VGV4dHVyZUxldmVsJiYobj10LmNvbnRleHQuZ2V0VGV4dHVyZUxldmVsKHRoaXMpKSxlLnV2Tm9kZT1zLGUubGV2ZWxOb2RlPW4sZS5iaWFzTm9kZT10aGlzLmJpYXNOb2RlLGUuY29tcGFyZU5vZGU9dGhpcy5jb21wYXJlTm9kZSxlLmdyYWROb2RlPXRoaXMuZ3JhZE5vZGUsZS5kZXB0aE5vZGU9dGhpcy5kZXB0aE5vZGV9Z2VuZXJhdGVVVih0LGUpe3JldHVybiBlLmJ1aWxkKHQsdGhpcy5zYW1wbGVyPT09ITA/InZlYzIiOiJpdmVjMiIpfWdlbmVyYXRlU25pcHBldCh0LGUscyxuLGksbyxhLGMpe2NvbnN0IHU9dGhpcy52YWx1ZTtsZXQgaDtyZXR1cm4gbj9oPXQuZ2VuZXJhdGVUZXh0dXJlTGV2ZWwodSxlLHMsbixvKTppP2g9dC5nZW5lcmF0ZVRleHR1cmVCaWFzKHUsZSxzLGksbyk6Yz9oPXQuZ2VuZXJhdGVUZXh0dXJlR3JhZCh1LGUscyxjLG8pOmE/aD10LmdlbmVyYXRlVGV4dHVyZUNvbXBhcmUodSxlLHMsYSxvKTp0aGlzLnNhbXBsZXI9PT0hMT9oPXQuZ2VuZXJhdGVUZXh0dXJlTG9hZCh1LGUscyxvKTpoPXQuZ2VuZXJhdGVUZXh0dXJlKHUsZSxzLG8pLGh9Z2VuZXJhdGUodCxlKXtjb25zdCBzPXQuZ2V0Tm9kZVByb3BlcnRpZXModGhpcyksbj10aGlzLnZhbHVlO2lmKCFufHxuLmlzVGV4dHVyZSE9PSEwKXRocm93IG5ldyBFcnJvcigiVGV4dHVyZU5vZGU6IE5lZWQgYSB0aHJlZS5qcyB0ZXh0dXJlLiIpO2NvbnN0IGk9c3VwZXIuZ2VuZXJhdGUodCwicHJvcGVydHkiKTtpZihlPT09InNhbXBsZXIiKXJldHVybiBpKyJfc2FtcGxlciI7aWYodC5pc1JlZmVyZW5jZShlKSlyZXR1cm4gaTt7Y29uc3Qgbz10LmdldERhdGFGcm9tTm9kZSh0aGlzKTtsZXQgYT1vLnByb3BlcnR5TmFtZTtpZihhPT09dm9pZCAwKXtjb25zdHt1dk5vZGU6aCxsZXZlbE5vZGU6bCxiaWFzTm9kZTpkLGNvbXBhcmVOb2RlOmYsZGVwdGhOb2RlOnAsZ3JhZE5vZGU6bX09cyxnPXRoaXMuZ2VuZXJhdGVVVih0LGgpLHk9bD9sLmJ1aWxkKHQsImZsb2F0Iik6bnVsbCxUPWQ/ZC5idWlsZCh0LCJmbG9hdCIpOm51bGwsdz1wP3AuYnVpbGQodCwiaW50Iik6bnVsbCxNPWY/Zi5idWlsZCh0LCJmbG9hdCIpOm51bGwsTj1tP1ttWzBdLmJ1aWxkKHQsInZlYzIiKSxtWzFdLmJ1aWxkKHQsInZlYzIiKV06bnVsbCxfPXQuZ2V0VmFyRnJvbU5vZGUodGhpcyk7YT10LmdldFByb3BlcnR5TmFtZShfKTtjb25zdCBTPXRoaXMuZ2VuZXJhdGVTbmlwcGV0KHQsaSxnLHksVCx3LE0sTik7dC5hZGRMaW5lRmxvd0NvZGUoYCR7YX0gPSAke1N9YCx0aGlzKSxvLnNuaXBwZXQ9UyxvLnByb3BlcnR5TmFtZT1hfWxldCBjPWE7Y29uc3QgdT10aGlzLmdldE5vZGVUeXBlKHQpO3JldHVybiB0Lm5lZWRzVG9Xb3JraW5nQ29sb3JTcGFjZShuKSYmKGM9V3IoWXMoYyx1KSxuLmNvbG9yU3BhY2UpLnNldHVwKHQpLmJ1aWxkKHQsdSkpLHQuZm9ybWF0KGMsdSxlKX19c2V0U2FtcGxlcih0KXtyZXR1cm4gdGhpcy5zYW1wbGVyPXQsdGhpc31nZXRTYW1wbGVyKCl7cmV0dXJuIHRoaXMuc2FtcGxlcn11dih0KXtjb25zdCBlPXRoaXMuY2xvbmUoKTtyZXR1cm4gZS51dk5vZGU9dih0KSxlLnJlZmVyZW5jZU5vZGU9dGhpcy5nZXRTZWxmKCksdihlKX1ibHVyKHQpe2NvbnN0IGU9dGhpcy5jbG9uZSgpO3JldHVybiBlLmJpYXNOb2RlPXYodCkubXVsKFhoKGUpKSxlLnJlZmVyZW5jZU5vZGU9dGhpcy5nZXRTZWxmKCksdihlKX1sZXZlbCh0KXtjb25zdCBlPXRoaXMuY2xvbmUoKTtyZXR1cm4gZS5sZXZlbE5vZGU9dih0KSxlLnJlZmVyZW5jZU5vZGU9dGhpcy5nZXRTZWxmKCksdihlKX1zaXplKHQpe3JldHVybiBZcih0aGlzLHQpfWJpYXModCl7Y29uc3QgZT10aGlzLmNsb25lKCk7cmV0dXJuIGUuYmlhc05vZGU9dih0KSxlLnJlZmVyZW5jZU5vZGU9dGhpcy5nZXRTZWxmKCksdihlKX1jb21wYXJlKHQpe2NvbnN0IGU9dGhpcy5jbG9uZSgpO3JldHVybiBlLmNvbXBhcmVOb2RlPXYodCksZS5yZWZlcmVuY2VOb2RlPXRoaXMuZ2V0U2VsZigpLHYoZSl9Z3JhZCh0LGUpe2NvbnN0IHM9dGhpcy5jbG9uZSgpO3JldHVybiBzLmdyYWROb2RlPVt2KHQpLHYoZSldLHMucmVmZXJlbmNlTm9kZT10aGlzLmdldFNlbGYoKSx2KHMpfWRlcHRoKHQpe2NvbnN0IGU9dGhpcy5jbG9uZSgpO3JldHVybiBlLmRlcHRoTm9kZT12KHQpLGUucmVmZXJlbmNlTm9kZT10aGlzLmdldFNlbGYoKSx2KGUpfXNlcmlhbGl6ZSh0KXtzdXBlci5zZXJpYWxpemUodCksdC52YWx1ZT10aGlzLnZhbHVlLnRvSlNPTih0Lm1ldGEpLnV1aWQsdC5zYW1wbGVyPXRoaXMuc2FtcGxlcix0LnVwZGF0ZU1hdHJpeD10aGlzLnVwZGF0ZU1hdHJpeCx0LnVwZGF0ZVR5cGU9dGhpcy51cGRhdGVUeXBlfWRlc2VyaWFsaXplKHQpe3N1cGVyLmRlc2VyaWFsaXplKHQpLHRoaXMudmFsdWU9dC5tZXRhLnRleHR1cmVzW3QudmFsdWVdLHRoaXMuc2FtcGxlcj10LnNhbXBsZXIsdGhpcy51cGRhdGVNYXRyaXg9dC51cGRhdGVNYXRyaXgsdGhpcy51cGRhdGVUeXBlPXQudXBkYXRlVHlwZX11cGRhdGUoKXtjb25zdCB0PXRoaXMudmFsdWUsZT10aGlzLl9tYXRyaXhVbmlmb3JtO2UhPT1udWxsJiYoZS52YWx1ZT10Lm1hdHJpeCksdC5tYXRyaXhBdXRvVXBkYXRlPT09ITAmJnQudXBkYXRlTWF0cml4KCl9Y2xvbmUoKXtjb25zdCB0PW5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMudmFsdWUsdGhpcy51dk5vZGUsdGhpcy5sZXZlbE5vZGUsdGhpcy5iaWFzTm9kZSk7cmV0dXJuIHQuc2FtcGxlcj10aGlzLnNhbXBsZXIsdH19Y29uc3QgYXM9QyhKcyksY3M9eHQoImZsb2F0IikubGFiZWwoImNhbWVyYU5lYXIiKS5zZXRHcm91cChkZSkub25SZW5kZXJVcGRhdGUoKHtjYW1lcmE6cn0pPT5yLm5lYXIpLGhzPXh0KCJmbG9hdCIpLmxhYmVsKCJjYW1lcmFGYXIiKS5zZXRHcm91cChkZSkub25SZW5kZXJVcGRhdGUoKHtjYW1lcmE6cn0pPT5yLmZhciksanM9eHQoIm1hdDQiKS5sYWJlbCgiY2FtZXJhVmlld01hdHJpeCIpLnNldEdyb3VwKGRlKS5vblJlbmRlclVwZGF0ZSgoe2NhbWVyYTpyfSk9PnIubWF0cml4V29ybGRJbnZlcnNlKTtjbGFzcyBIIGV4dGVuZHMgVXtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iT2JqZWN0M0ROb2RlIn1jb25zdHJ1Y3Rvcih0LGU9bnVsbCl7c3VwZXIoKSx0aGlzLnNjb3BlPXQsdGhpcy5vYmplY3QzZD1lLHRoaXMudXBkYXRlVHlwZT1RLk9CSkVDVCx0aGlzLl91bmlmb3JtTm9kZT1uZXcgSWUobnVsbCl9Z2V0Tm9kZVR5cGUoKXtjb25zdCB0PXRoaXMuc2NvcGU7aWYodD09PUguV09STERfTUFUUklYKXJldHVybiJtYXQ0IjtpZih0PT09SC5QT1NJVElPTnx8dD09PUguVklFV19QT1NJVElPTnx8dD09PUguRElSRUNUSU9OfHx0PT09SC5TQ0FMRSlyZXR1cm4idmVjMyJ9dXBkYXRlKHQpe2NvbnN0IGU9dGhpcy5vYmplY3QzZCxzPXRoaXMuX3VuaWZvcm1Ob2RlLG49dGhpcy5zY29wZTtpZihuPT09SC5XT1JMRF9NQVRSSVgpcy52YWx1ZT1lLm1hdHJpeFdvcmxkO2Vsc2UgaWYobj09PUguUE9TSVRJT04pcy52YWx1ZT1zLnZhbHVlfHxuZXcgQSxzLnZhbHVlLnNldEZyb21NYXRyaXhQb3NpdGlvbihlLm1hdHJpeFdvcmxkKTtlbHNlIGlmKG49PT1ILlNDQUxFKXMudmFsdWU9cy52YWx1ZXx8bmV3IEEscy52YWx1ZS5zZXRGcm9tTWF0cml4U2NhbGUoZS5tYXRyaXhXb3JsZCk7ZWxzZSBpZihuPT09SC5ESVJFQ1RJT04pcy52YWx1ZT1zLnZhbHVlfHxuZXcgQSxlLmdldFdvcmxkRGlyZWN0aW9uKHMudmFsdWUpO2Vsc2UgaWYobj09PUguVklFV19QT1NJVElPTil7Y29uc3QgaT10LmNhbWVyYTtzLnZhbHVlPXMudmFsdWV8fG5ldyBBLHMudmFsdWUuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKGUubWF0cml4V29ybGQpLHMudmFsdWUuYXBwbHlNYXRyaXg0KGkubWF0cml4V29ybGRJbnZlcnNlKX19Z2VuZXJhdGUodCl7Y29uc3QgZT10aGlzLnNjb3BlO3JldHVybiBlPT09SC5XT1JMRF9NQVRSSVg/dGhpcy5fdW5pZm9ybU5vZGUubm9kZVR5cGU9Im1hdDQiOihlPT09SC5QT1NJVElPTnx8ZT09PUguVklFV19QT1NJVElPTnx8ZT09PUguRElSRUNUSU9OfHxlPT09SC5TQ0FMRSkmJih0aGlzLl91bmlmb3JtTm9kZS5ub2RlVHlwZT0idmVjMyIpLHRoaXMuX3VuaWZvcm1Ob2RlLmJ1aWxkKHQpfXNlcmlhbGl6ZSh0KXtzdXBlci5zZXJpYWxpemUodCksdC5zY29wZT10aGlzLnNjb3BlfWRlc2VyaWFsaXplKHQpe3N1cGVyLmRlc2VyaWFsaXplKHQpLHRoaXMuc2NvcGU9dC5zY29wZX19SC5XT1JMRF9NQVRSSVg9IndvcmxkTWF0cml4IixILlBPU0lUSU9OPSJwb3NpdGlvbiIsSC5TQ0FMRT0ic2NhbGUiLEguVklFV19QT1NJVElPTj0idmlld1Bvc2l0aW9uIixILkRJUkVDVElPTj0iZGlyZWN0aW9uIixILkRJUkVDVElPTixILldPUkxEX01BVFJJWCxILlBPU0lUSU9OLEguU0NBTEUsSC5WSUVXX1BPU0lUSU9OO2NsYXNzIFZ0IGV4dGVuZHMgSHtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iTW9kZWxOb2RlIn1jb25zdHJ1Y3Rvcih0KXtzdXBlcih0KX11cGRhdGUodCl7dGhpcy5vYmplY3QzZD10Lm9iamVjdCxzdXBlci51cGRhdGUodCl9fVZ0LkRJUkVDVElPTjtjb25zdCBZaD1PKFZ0LFZ0LldPUkxEX01BVFJJWCk7VnQuUE9TSVRJT04sVnQuU0NBTEUsVnQuVklFV19QT1NJVElPTjtjb25zdCBaaD14dChuZXcgQ3QpLm9uT2JqZWN0VXBkYXRlKCh7b2JqZWN0OnJ9LHQpPT50LnZhbHVlLmdldE5vcm1hbE1hdHJpeChyLm1hdHJpeFdvcmxkKSksWnI9anMubXVsKFloKS50b1ZhcigibW9kZWxWaWV3TWF0cml4XzIiKSxKaD1vcygicG9zaXRpb24iLCJ2ZWMzIikudmFyeWluZygicG9zaXRpb25Mb2NhbCIpLE10PVpyLm11bChKaCkueHl6LnZhcnlpbmcoInZfcG9zaXRpb25WaWV3IiksSnI9TXQubmVnYXRlKCkudmFyeWluZygidl9wb3NpdGlvblZpZXdEaXJlY3Rpb24iKS5ub3JtYWxpemUoKS50b1ZhcigicG9zaXRpb25WaWV3RGlyZWN0aW9uIik7Y2xhc3MgamggZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJGcm9udEZhY2luZ05vZGUifWNvbnN0cnVjdG9yKCl7c3VwZXIoImJvb2wiKSx0aGlzLmlzRnJvbnRGYWNpbmdOb2RlPSEwfWdlbmVyYXRlKHQpe2NvbnN0e3JlbmRlcmVyOmUsbWF0ZXJpYWw6c309dDtyZXR1cm4gZS5jb29yZGluYXRlU3lzdGVtPT09WWUmJnMuc2lkZT09PVVpPyJmYWxzZSI6dC5nZXRGcm9udEZhY2luZygpfX1jb25zdCBkaT1xKE8oamgpKS5tdWwoMikuc3ViKDEpLFFoPW9zKCJub3JtYWwiLCJ2ZWMzIiksS2g9dHQocj0+ci5nZW9tZXRyeS5oYXNBdHRyaWJ1dGUoIm5vcm1hbCIpPT09ITE/KGNvbnNvbGUud2FybignVFNMLk5vcm1hbE5vZGU6IFZlcnRleCBhdHRyaWJ1dGUgIm5vcm1hbCIgbm90IGZvdW5kIG9uIGdlb21ldHJ5LicpLGsoMCwxLDApKTpRaCwidmVjMyIpLm9uY2UoKSgpLnRvVmFyKCJub3JtYWxMb2NhbCIpLHR1PU10LmRGZHgoKS5jcm9zcyhNdC5kRmR5KCkpLm5vcm1hbGl6ZSgpLnRvVmFyKCJub3JtYWxGbGF0IiksTGU9dHQocj0+e2xldCB0O3JldHVybiByLm1hdGVyaWFsLmZsYXRTaGFkaW5nPT09ITA/dD10dTp0PVBlKFFyKEtoKSwidl9ub3JtYWxWaWV3Iikubm9ybWFsaXplKCksdH0sInZlYzMiKS5vbmNlKCkoKS50b1Zhcigibm9ybWFsVmlldyIpLGpyPXR0KHI9PnIuY29udGV4dC5zZXR1cE5vcm1hbCgpLCJ2ZWMzIikub25jZSgpKCkubXVsKGRpKS50b1ZhcigidHJhbnNmb3JtZWROb3JtYWxWaWV3IiksUXI9dHQoKFtyXSx0KT0+e2NvbnN0IGU9dC5yZW5kZXJlci5ub2Rlcy5tb2RlbE5vcm1hbFZpZXdNYXRyaXg7aWYoZSE9PW51bGwpcmV0dXJuIGUudHJhbnNmb3JtRGlyZWN0aW9uKHIpO2NvbnN0IHM9WmgubXVsKHIpO3JldHVybiBqcy50cmFuc2Zvcm1EaXJlY3Rpb24ocyl9KSxldT14dCgwKS5vblJlZmVyZW5jZSgoe21hdGVyaWFsOnJ9KT0+cikub25SZW5kZXJVcGRhdGUoKHttYXRlcmlhbDpyfSk9PnIucmVmcmFjdGlvblJhdGlvKSxzdT1Kci5uZWdhdGUoKS5yZWZsZWN0KGpyKSxudT1Kci5uZWdhdGUoKS5yZWZyYWN0KGpyLGV1KSxpdT1zdS50cmFuc2Zvcm1EaXJlY3Rpb24oanMpLnRvVmFyKCJyZWZsZWN0VmVjdG9yIikscnU9bnUudHJhbnNmb3JtRGlyZWN0aW9uKGpzKS50b1ZhcigicmVmbGVjdFZlY3RvciIpO2NsYXNzIG91IGV4dGVuZHMgSnN7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIkN1YmVUZXh0dXJlTm9kZSJ9Y29uc3RydWN0b3IodCxlPW51bGwscz1udWxsLG49bnVsbCl7c3VwZXIodCxlLHMsbiksdGhpcy5pc0N1YmVUZXh0dXJlTm9kZT0hMH1nZXRJbnB1dFR5cGUoKXtyZXR1cm4iY3ViZVRleHR1cmUifWdldERlZmF1bHRVVigpe2NvbnN0IHQ9dGhpcy52YWx1ZTtyZXR1cm4gdC5tYXBwaW5nPT09Q28/aXU6dC5tYXBwaW5nPT09Rm8/cnU6KGNvbnNvbGUuZXJyb3IoJ1RIUkVFLkN1YmVUZXh0dXJlTm9kZTogTWFwcGluZyAiJXMiIG5vdCBzdXBwb3J0ZWQuJyx0Lm1hcHBpbmcpLGsoMCwwLDApKX1zZXRVcGRhdGVNYXRyaXgoKXt9c2V0dXBVVih0LGUpe2NvbnN0IHM9dGhpcy52YWx1ZTtyZXR1cm4gdC5yZW5kZXJlci5jb29yZGluYXRlU3lzdGVtPT09em58fCFzLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZT9rKGUueC5uZWdhdGUoKSxlLnl6KTplfWdlbmVyYXRlVVYodCxlKXtyZXR1cm4gZS5idWlsZCh0LCJ2ZWMzIil9fWNvbnN0IGF1PUMob3UpO2NsYXNzIEtyIGV4dGVuZHMgSWV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIkJ1ZmZlck5vZGUifWNvbnN0cnVjdG9yKHQsZSxzPTApe3N1cGVyKHQsZSksdGhpcy5pc0J1ZmZlck5vZGU9ITAsdGhpcy5idWZmZXJUeXBlPWUsdGhpcy5idWZmZXJDb3VudD1zfWdldEVsZW1lbnRUeXBlKHQpe3JldHVybiB0aGlzLmdldE5vZGVUeXBlKHQpfWdldElucHV0VHlwZSgpe3JldHVybiJidWZmZXIifX1jb25zdCBjdT0ocix0LGUpPT52KG5ldyBLcihyLHQsZSkpO2NsYXNzIGh1IGV4dGVuZHMgaXN7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIlVuaWZvcm1BcnJheUVsZW1lbnROb2RlIn1jb25zdHJ1Y3Rvcih0LGUpe3N1cGVyKHQsZSksdGhpcy5pc0FycmF5QnVmZmVyRWxlbWVudE5vZGU9ITB9Z2VuZXJhdGUodCl7Y29uc3QgZT1zdXBlci5nZW5lcmF0ZSh0KSxzPXRoaXMuZ2V0Tm9kZVR5cGUoKTtyZXR1cm4gdC5mb3JtYXQoZSwidmVjNCIscyl9fWNsYXNzIHV1IGV4dGVuZHMgS3J7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIlVuaWZvcm1BcnJheU5vZGUifWNvbnN0cnVjdG9yKHQsZT1udWxsKXtzdXBlcihudWxsLCJ2ZWM0IiksdGhpcy5hcnJheT10LHRoaXMuZWxlbWVudFR5cGU9ZSx0aGlzLl9lbGVtZW50VHlwZT1udWxsLHRoaXMuX2VsZW1lbnRMZW5ndGg9MCx0aGlzLnVwZGF0ZVR5cGU9US5SRU5ERVIsdGhpcy5pc0FycmF5QnVmZmVyTm9kZT0hMH1nZXRFbGVtZW50VHlwZSgpe3JldHVybiB0aGlzLmVsZW1lbnRUeXBlfHx0aGlzLl9lbGVtZW50VHlwZX1nZXRFbGVtZW50TGVuZ3RoKCl7cmV0dXJuIHRoaXMuX2VsZW1lbnRMZW5ndGh9dXBkYXRlKCl7Y29uc3R7YXJyYXk6dCx2YWx1ZTplfT10aGlzLHM9dGhpcy5nZXRFbGVtZW50TGVuZ3RoKCksbj10aGlzLmdldEVsZW1lbnRUeXBlKCk7aWYocz09PTEpZm9yKGxldCBpPTA7aTx0Lmxlbmd0aDtpKyspe2NvbnN0IG89aSo0O2Vbb109dFtpXX1lbHNlIGlmKG49PT0iY29sb3IiKWZvcihsZXQgaT0wO2k8dC5sZW5ndGg7aSsrKXtjb25zdCBvPWkqNCxhPXRbaV07ZVtvXT1hLnIsZVtvKzFdPWEuZyxlW28rMl09YS5ifHwwfWVsc2UgZm9yKGxldCBpPTA7aTx0Lmxlbmd0aDtpKyspe2NvbnN0IG89aSo0LGE9dFtpXTtlW29dPWEueCxlW28rMV09YS55LGVbbysyXT1hLnp8fDAsZVtvKzNdPWEud3x8MH19c2V0dXAodCl7Y29uc3QgZT10aGlzLmFycmF5Lmxlbmd0aDt0aGlzLl9lbGVtZW50VHlwZT10aGlzLmVsZW1lbnRUeXBlPT09bnVsbD9Wcyh0aGlzLmFycmF5WzBdKTp0aGlzLmVsZW1lbnRUeXBlLHRoaXMuX2VsZW1lbnRMZW5ndGg9dC5nZXRUeXBlTGVuZ3RoKHRoaXMuX2VsZW1lbnRUeXBlKTtsZXQgcz1GbG9hdDMyQXJyYXk7cmV0dXJuIHRoaXMuX2VsZW1lbnRUeXBlLmNoYXJBdCgwKT09PSJpIj9zPUludDMyQXJyYXk6dGhpcy5fZWxlbWVudFR5cGUuY2hhckF0KDApPT09InUiJiYocz1VaW50MzJBcnJheSksdGhpcy52YWx1ZT1uZXcgcyhlKjQpLHRoaXMuYnVmZmVyQ291bnQ9ZSx0aGlzLmJ1ZmZlclR5cGU9dC5jaGFuZ2VDb21wb25lbnRUeXBlKCJ2ZWM0Iix0LmdldENvbXBvbmVudFR5cGUodGhpcy5fZWxlbWVudFR5cGUpKSxzdXBlci5zZXR1cCh0KX1lbGVtZW50KHQpe3JldHVybiB2KG5ldyBodSh0aGlzLHYodCkpKX19Y29uc3QgZmk9KHIsdCk9PnYobmV3IHV1KHIsdCkpO2NsYXNzIGx1IGV4dGVuZHMgaXN7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIlJlZmVyZW5jZUVsZW1lbnROb2RlIn1jb25zdHJ1Y3Rvcih0LGUpe3N1cGVyKHQsZSksdGhpcy5yZWZlcmVuY2VOb2RlPXQsdGhpcy5pc1JlZmVyZW5jZUVsZW1lbnROb2RlPSEwfWdldE5vZGVUeXBlKCl7cmV0dXJuIHRoaXMucmVmZXJlbmNlTm9kZS51bmlmb3JtVHlwZX1nZW5lcmF0ZSh0KXtjb25zdCBlPXN1cGVyLmdlbmVyYXRlKHQpLHM9dGhpcy5yZWZlcmVuY2VOb2RlLmdldE5vZGVUeXBlKCksbj10aGlzLmdldE5vZGVUeXBlKCk7cmV0dXJuIHQuZm9ybWF0KGUscyxuKX19Y2xhc3MgdG8gZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJSZWZlcmVuY2VOb2RlIn1jb25zdHJ1Y3Rvcih0LGUscz1udWxsLG49bnVsbCl7c3VwZXIoKSx0aGlzLnByb3BlcnR5PXQsdGhpcy51bmlmb3JtVHlwZT1lLHRoaXMub2JqZWN0PXMsdGhpcy5jb3VudD1uLHRoaXMucHJvcGVydGllcz10LnNwbGl0KCIuIiksdGhpcy5yZWZlcmVuY2U9cyx0aGlzLm5vZGU9bnVsbCx0aGlzLmdyb3VwPW51bGwsdGhpcy5uYW1lPW51bGwsdGhpcy51cGRhdGVUeXBlPVEuT0JKRUNUfWVsZW1lbnQodCl7cmV0dXJuIHYobmV3IGx1KHRoaXMsdih0KSkpfXNldEdyb3VwKHQpe3JldHVybiB0aGlzLmdyb3VwPXQsdGhpc31sYWJlbCh0KXtyZXR1cm4gdGhpcy5uYW1lPXQsdGhpc31zZXROb2RlVHlwZSh0KXtsZXQgZT1udWxsO3RoaXMuY291bnQhPT1udWxsP2U9Y3UobnVsbCx0LHRoaXMuY291bnQpOkFycmF5LmlzQXJyYXkodGhpcy5nZXRWYWx1ZUZyb21SZWZlcmVuY2UoKSk/ZT1maShudWxsLHQpOnQ9PT0idGV4dHVyZSI/ZT1hcyhudWxsKTp0PT09ImN1YmVUZXh0dXJlIj9lPWF1KG51bGwpOmU9eHQobnVsbCx0KSx0aGlzLmdyb3VwIT09bnVsbCYmZS5zZXRHcm91cCh0aGlzLmdyb3VwKSx0aGlzLm5hbWUhPT1udWxsJiZlLmxhYmVsKHRoaXMubmFtZSksdGhpcy5ub2RlPWUuZ2V0U2VsZigpfWdldE5vZGVUeXBlKHQpe3JldHVybiB0aGlzLm5vZGU9PT1udWxsJiYodGhpcy51cGRhdGVSZWZlcmVuY2UodCksdGhpcy51cGRhdGVWYWx1ZSgpKSx0aGlzLm5vZGUuZ2V0Tm9kZVR5cGUodCl9Z2V0VmFsdWVGcm9tUmVmZXJlbmNlKHQ9dGhpcy5yZWZlcmVuY2Upe2NvbnN0e3Byb3BlcnRpZXM6ZX09dGhpcztsZXQgcz10W2VbMF1dO2ZvcihsZXQgbj0xO248ZS5sZW5ndGg7bisrKXM9c1tlW25dXTtyZXR1cm4gc311cGRhdGVSZWZlcmVuY2UodCl7cmV0dXJuIHRoaXMucmVmZXJlbmNlPXRoaXMub2JqZWN0IT09bnVsbD90aGlzLm9iamVjdDp0Lm9iamVjdCx0aGlzLnJlZmVyZW5jZX1zZXR1cCgpe3JldHVybiB0aGlzLnVwZGF0ZVZhbHVlKCksdGhpcy5ub2RlfXVwZGF0ZSgpe3RoaXMudXBkYXRlVmFsdWUoKX11cGRhdGVWYWx1ZSgpe3RoaXMubm9kZT09PW51bGwmJnRoaXMuc2V0Tm9kZVR5cGUodGhpcy51bmlmb3JtVHlwZSk7Y29uc3QgdD10aGlzLmdldFZhbHVlRnJvbVJlZmVyZW5jZSgpO0FycmF5LmlzQXJyYXkodCk/dGhpcy5ub2RlLmFycmF5PXQ6dGhpcy5ub2RlLnZhbHVlPXR9fWNvbnN0IHBlPShyLHQsZSk9PnYobmV3IHRvKHIsdCxlKSk7Y2xhc3MgZHUgZXh0ZW5kcyB0b3tzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iTWF0ZXJpYWxSZWZlcmVuY2VOb2RlIn1jb25zdHJ1Y3Rvcih0LGUscz1udWxsKXtzdXBlcih0LGUscyksdGhpcy5tYXRlcmlhbD1zLHRoaXMuaXNNYXRlcmlhbFJlZmVyZW5jZU5vZGU9ITB9dXBkYXRlUmVmZXJlbmNlKHQpe3JldHVybiB0aGlzLnJlZmVyZW5jZT10aGlzLm1hdGVyaWFsIT09bnVsbD90aGlzLm1hdGVyaWFsOnQubWF0ZXJpYWwsdGhpcy5yZWZlcmVuY2V9fWNvbnN0IGZ1PShyLHQsZSk9PnYobmV3IGR1KHIsdCxlKSksZW89dHQocj0+KHIuZ2VvbWV0cnkuaGFzQXR0cmlidXRlKCJ0YW5nZW50Iik9PT0hMSYmci5nZW9tZXRyeS5jb21wdXRlVGFuZ2VudHMoKSxvcygidGFuZ2VudCIsInZlYzQiKSkpKCkscHU9ZW8ueHl6LnRvVmFyKCJ0YW5nZW50TG9jYWwiKSxzbz1aci5tdWwoQmUocHUsMCkpLnh5ei52YXJ5aW5nKCJ2X3RhbmdlbnRWaWV3Iikubm9ybWFsaXplKCkudG9WYXIoInRhbmdlbnRWaWV3IiksbXU9cXMoc28sUGUoKHI9PnIubXVsKGVvLncpLnh5eikoTGUuY3Jvc3Moc28pKSwidl9iaXRhbmdlbnRWaWV3Iikubm9ybWFsaXplKCkudG9WYXIoImJpdGFuZ2VudFZpZXciKSxMZSkseXU9dHQocj0+e2NvbnN0e2V5ZV9wb3M6dCxzdXJmX25vcm06ZSxtYXBOOnMsdXY6bn09cixpPXQuZEZkeCgpLG89dC5kRmR5KCksYT1uLmRGZHgoKSxjPW4uZEZkeSgpLHU9ZSxoPW8uY3Jvc3ModSksbD11LmNyb3NzKGkpLGQ9aC5tdWwoYS54KS5hZGQobC5tdWwoYy54KSksZj1oLm11bChhLnkpLmFkZChsLm11bChjLnkpKSxwPWQuZG90KGQpLm1heChmLmRvdChmKSksbT1kaS5tdWwocC5pbnZlcnNlU3FydCgpKTtyZXR1cm4gZmUoZC5tdWwocy54LG0pLGYubXVsKHMueSxtKSx1Lm11bChzLnopKS5ub3JtYWxpemUoKX0pO2NsYXNzIGd1IGV4dGVuZHMgZHR7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIk5vcm1hbE1hcE5vZGUifWNvbnN0cnVjdG9yKHQsZT1udWxsKXtzdXBlcigidmVjMyIpLHRoaXMubm9kZT10LHRoaXMuc2NhbGVOb2RlPWUsdGhpcy5ub3JtYWxNYXBUeXBlPVlpfXNldHVwKHQpe2NvbnN0e25vcm1hbE1hcFR5cGU6ZSxzY2FsZU5vZGU6c309dGhpcztsZXQgbj10aGlzLm5vZGUubXVsKDIpLnN1YigxKTtzIT09bnVsbCYmKG49ayhuLnh5Lm11bChzKSxuLnopKTtsZXQgaT1udWxsO3JldHVybiBlPT09T28/aT1RcihuKTplPT09WWkmJih0Lmhhc0dlb21ldHJ5QXR0cmlidXRlKCJ0YW5nZW50Iik9PT0hMD9pPW11Lm11bChuKS5ub3JtYWxpemUoKTppPXl1KHtleWVfcG9zOk10LHN1cmZfbm9ybTpMZSxtYXBOOm4sdXY6WnMoKX0pKSxpfX1jb25zdCBubz1DKGd1KSx4dT10dCgoe3RleHR1cmVOb2RlOnIsYnVtcFNjYWxlOnR9KT0+e2NvbnN0IGU9bj0+ci5jYWNoZSgpLmNvbnRleHQoe2dldFVWOmk9Pm4oaS51dk5vZGV8fFpzKCkpLGZvcmNlVVZDb250ZXh0OiEwfSkscz1xKGUobj0+bikpO3JldHVybiBEKHEoZShuPT5uLmFkZChuLmRGZHgoKSkpKS5zdWIocykscShlKG49Pm4uYWRkKG4uZEZkeSgpKSkpLnN1YihzKSkubXVsKHQpfSksVHU9dHQocj0+e2NvbnN0e3N1cmZfcG9zOnQsc3VyZl9ub3JtOmUsZEhkeHk6c309cixuPXQuZEZkeCgpLm5vcm1hbGl6ZSgpLGk9dC5kRmR5KCkubm9ybWFsaXplKCksbz1lLGE9aS5jcm9zcyhvKSxjPW8uY3Jvc3MobiksdT1uLmRvdChhKS5tdWwoZGkpLGg9dS5zaWduKCkubXVsKHMueC5tdWwoYSkuYWRkKHMueS5tdWwoYykpKTtyZXR1cm4gdS5hYnMoKS5tdWwoZSkuc3ViKGgpLm5vcm1hbGl6ZSgpfSk7Y2xhc3MgTnUgZXh0ZW5kcyBkdHtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iQnVtcE1hcE5vZGUifWNvbnN0cnVjdG9yKHQsZT1udWxsKXtzdXBlcigidmVjMyIpLHRoaXMudGV4dHVyZU5vZGU9dCx0aGlzLnNjYWxlTm9kZT1lfXNldHVwKCl7Y29uc3QgdD10aGlzLnNjYWxlTm9kZSE9PW51bGw/dGhpcy5zY2FsZU5vZGU6MSxlPXh1KHt0ZXh0dXJlTm9kZTp0aGlzLnRleHR1cmVOb2RlLGJ1bXBTY2FsZTp0fSk7cmV0dXJuIFR1KHtzdXJmX3BvczpNdCxzdXJmX25vcm06TGUsZEhkeHk6ZX0pfX1jb25zdCB3dT1DKE51KSxpbz1uZXcgTWFwO2NsYXNzIHogZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJNYXRlcmlhbE5vZGUifWNvbnN0cnVjdG9yKHQpe3N1cGVyKCksdGhpcy5zY29wZT10fWdldENhY2hlKHQsZSl7bGV0IHM9aW8uZ2V0KHQpO3JldHVybiBzPT09dm9pZCAwJiYocz1mdSh0LGUpLGlvLnNldCh0LHMpKSxzfWdldEZsb2F0KHQpe3JldHVybiB0aGlzLmdldENhY2hlKHQsImZsb2F0Iil9Z2V0Q29sb3IodCl7cmV0dXJuIHRoaXMuZ2V0Q2FjaGUodCwiY29sb3IiKX1nZXRUZXh0dXJlKHQpe3JldHVybiB0aGlzLmdldENhY2hlKHQ9PT0ibWFwIj8ibWFwIjp0KyJNYXAiLCJ0ZXh0dXJlIil9c2V0dXAodCl7Y29uc3QgZT10LmNvbnRleHQubWF0ZXJpYWwscz10aGlzLnNjb3BlO2xldCBuPW51bGw7aWYocz09PXouQ09MT1Ipe2NvbnN0IGk9ZS5jb2xvciE9PXZvaWQgMD90aGlzLmdldENvbG9yKHMpOmsoKTtlLm1hcCYmZS5tYXAuaXNUZXh0dXJlPT09ITA/bj1pLm11bCh0aGlzLmdldFRleHR1cmUoIm1hcCIpKTpuPWl9ZWxzZSBpZihzPT09ei5PUEFDSVRZKXtjb25zdCBpPXRoaXMuZ2V0RmxvYXQocyk7ZS5hbHBoYU1hcCYmZS5hbHBoYU1hcC5pc1RleHR1cmU9PT0hMD9uPWkubXVsKHRoaXMuZ2V0VGV4dHVyZSgiYWxwaGEiKSk6bj1pfWVsc2UgaWYocz09PXouU1BFQ1VMQVJfU1RSRU5HVEgpZS5zcGVjdWxhck1hcCYmZS5zcGVjdWxhck1hcC5pc1RleHR1cmU9PT0hMD9uPXRoaXMuZ2V0VGV4dHVyZSgic3BlY3VsYXIiKS5yOm49cSgxKTtlbHNlIGlmKHM9PT16LlNQRUNVTEFSX0lOVEVOU0lUWSl7Y29uc3QgaT10aGlzLmdldEZsb2F0KHMpO2Uuc3BlY3VsYXJNYXA/bj1pLm11bCh0aGlzLmdldFRleHR1cmUocykuYSk6bj1pfWVsc2UgaWYocz09PXouU1BFQ1VMQVJfQ09MT1Ipe2NvbnN0IGk9dGhpcy5nZXRDb2xvcihzKTtlLnNwZWN1bGFyQ29sb3JNYXAmJmUuc3BlY3VsYXJDb2xvck1hcC5pc1RleHR1cmU9PT0hMD9uPWkubXVsKHRoaXMuZ2V0VGV4dHVyZShzKS5yZ2IpOm49aX1lbHNlIGlmKHM9PT16LlJPVUdITkVTUyl7Y29uc3QgaT10aGlzLmdldEZsb2F0KHMpO2Uucm91Z2huZXNzTWFwJiZlLnJvdWdobmVzc01hcC5pc1RleHR1cmU9PT0hMD9uPWkubXVsKHRoaXMuZ2V0VGV4dHVyZShzKS5nKTpuPWl9ZWxzZSBpZihzPT09ei5NRVRBTE5FU1Mpe2NvbnN0IGk9dGhpcy5nZXRGbG9hdChzKTtlLm1ldGFsbmVzc01hcCYmZS5tZXRhbG5lc3NNYXAuaXNUZXh0dXJlPT09ITA/bj1pLm11bCh0aGlzLmdldFRleHR1cmUocykuYik6bj1pfWVsc2UgaWYocz09PXouRU1JU1NJVkUpe2NvbnN0IGk9dGhpcy5nZXRGbG9hdCgiZW1pc3NpdmVJbnRlbnNpdHkiKSxvPXRoaXMuZ2V0Q29sb3IocykubXVsKGkpO2UuZW1pc3NpdmVNYXAmJmUuZW1pc3NpdmVNYXAuaXNUZXh0dXJlPT09ITA/bj1vLm11bCh0aGlzLmdldFRleHR1cmUocykpOm49b31lbHNlIGlmKHM9PT16Lk5PUk1BTCllLm5vcm1hbE1hcD8obj1ubyh0aGlzLmdldFRleHR1cmUoIm5vcm1hbCIpLHRoaXMuZ2V0Q2FjaGUoIm5vcm1hbFNjYWxlIiwidmVjMiIpKSxuLm5vcm1hbE1hcFR5cGU9ZS5ub3JtYWxNYXBUeXBlKTplLmJ1bXBNYXA/bj13dSh0aGlzLmdldFRleHR1cmUoImJ1bXAiKS5yLHRoaXMuZ2V0RmxvYXQoImJ1bXBTY2FsZSIpKTpuPUxlO2Vsc2UgaWYocz09PXouQ0xFQVJDT0FUKXtjb25zdCBpPXRoaXMuZ2V0RmxvYXQocyk7ZS5jbGVhcmNvYXRNYXAmJmUuY2xlYXJjb2F0TWFwLmlzVGV4dHVyZT09PSEwP249aS5tdWwodGhpcy5nZXRUZXh0dXJlKHMpLnIpOm49aX1lbHNlIGlmKHM9PT16LkNMRUFSQ09BVF9ST1VHSE5FU1Mpe2NvbnN0IGk9dGhpcy5nZXRGbG9hdChzKTtlLmNsZWFyY29hdFJvdWdobmVzc01hcCYmZS5jbGVhcmNvYXRSb3VnaG5lc3NNYXAuaXNUZXh0dXJlPT09ITA/bj1pLm11bCh0aGlzLmdldFRleHR1cmUocykucik6bj1pfWVsc2UgaWYocz09PXouQ0xFQVJDT0FUX05PUk1BTCllLmNsZWFyY29hdE5vcm1hbE1hcD9uPW5vKHRoaXMuZ2V0VGV4dHVyZShzKSx0aGlzLmdldENhY2hlKHMrIlNjYWxlIiwidmVjMiIpKTpuPUxlO2Vsc2UgaWYocz09PXouU0hFRU4pe2NvbnN0IGk9dGhpcy5nZXRDb2xvcigic2hlZW5Db2xvciIpLm11bCh0aGlzLmdldEZsb2F0KCJzaGVlbiIpKTtlLnNoZWVuQ29sb3JNYXAmJmUuc2hlZW5Db2xvck1hcC5pc1RleHR1cmU9PT0hMD9uPWkubXVsKHRoaXMuZ2V0VGV4dHVyZSgic2hlZW5Db2xvciIpLnJnYik6bj1pfWVsc2UgaWYocz09PXouU0hFRU5fUk9VR0hORVNTKXtjb25zdCBpPXRoaXMuZ2V0RmxvYXQocyk7ZS5zaGVlblJvdWdobmVzc01hcCYmZS5zaGVlblJvdWdobmVzc01hcC5pc1RleHR1cmU9PT0hMD9uPWkubXVsKHRoaXMuZ2V0VGV4dHVyZShzKS5hKTpuPWksbj1uLmNsYW1wKC4wNywxKX1lbHNlIGlmKHM9PT16LkFOSVNPVFJPUFkpaWYoZS5hbmlzb3Ryb3B5TWFwJiZlLmFuaXNvdHJvcHlNYXAuaXNUZXh0dXJlPT09ITApe2NvbnN0IGk9dGhpcy5nZXRUZXh0dXJlKHMpO249UnIodXMueCx1cy55LHVzLnkubmVnYXRlKCksdXMueCkubXVsKGkucmcubXVsKDIpLnN1YihEKDEpKS5ub3JtYWxpemUoKS5tdWwoaS5iKSl9ZWxzZSBuPXVzO2Vsc2UgaWYocz09PXouSVJJREVTQ0VOQ0VfVEhJQ0tORVNTKXtjb25zdCBpPXBlKCIxIiwiZmxvYXQiLGUuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZSk7aWYoZS5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcCl7Y29uc3Qgbz1wZSgiMCIsImZsb2F0IixlLmlyaWRlc2NlbmNlVGhpY2tuZXNzUmFuZ2UpO249aS5zdWIobykubXVsKHRoaXMuZ2V0VGV4dHVyZShzKS5nKS5hZGQobyl9ZWxzZSBuPWl9ZWxzZSBpZihzPT09ei5UUkFOU01JU1NJT04pe2NvbnN0IGk9dGhpcy5nZXRGbG9hdChzKTtlLnRyYW5zbWlzc2lvbk1hcD9uPWkubXVsKHRoaXMuZ2V0VGV4dHVyZShzKS5yKTpuPWl9ZWxzZSBpZihzPT09ei5USElDS05FU1Mpe2NvbnN0IGk9dGhpcy5nZXRGbG9hdChzKTtlLnRoaWNrbmVzc01hcD9uPWkubXVsKHRoaXMuZ2V0VGV4dHVyZShzKS5nKTpuPWl9ZWxzZSBpZihzPT09ei5JT1Ipbj10aGlzLmdldEZsb2F0KHMpO2Vsc2UgaWYocz09PXouTElHSFRfTUFQKW49dGhpcy5nZXRUZXh0dXJlKHMpLnJnYi5tdWwodGhpcy5nZXRGbG9hdCgibGlnaHRNYXBJbnRlbnNpdHkiKSk7ZWxzZSBpZihzPT09ei5BT19NQVApbj10aGlzLmdldFRleHR1cmUocykuci5zdWIoMSkubXVsKHRoaXMuZ2V0RmxvYXQoImFvTWFwSW50ZW5zaXR5IikpLmFkZCgxKTtlbHNle2NvbnN0IGk9dGhpcy5nZXROb2RlVHlwZSh0KTtuPXRoaXMuZ2V0Q2FjaGUocyxpKX1yZXR1cm4gbn19ei5BTFBIQV9URVNUPSJhbHBoYVRlc3QiLHouQ09MT1I9ImNvbG9yIix6Lk9QQUNJVFk9Im9wYWNpdHkiLHouU0hJTklORVNTPSJzaGluaW5lc3MiLHouU1BFQ1VMQVI9InNwZWN1bGFyIix6LlNQRUNVTEFSX1NUUkVOR1RIPSJzcGVjdWxhclN0cmVuZ3RoIix6LlNQRUNVTEFSX0lOVEVOU0lUWT0ic3BlY3VsYXJJbnRlbnNpdHkiLHouU1BFQ1VMQVJfQ09MT1I9InNwZWN1bGFyQ29sb3IiLHouUkVGTEVDVElWSVRZPSJyZWZsZWN0aXZpdHkiLHouUk9VR0hORVNTPSJyb3VnaG5lc3MiLHouTUVUQUxORVNTPSJtZXRhbG5lc3MiLHouTk9STUFMPSJub3JtYWwiLHouQ0xFQVJDT0FUPSJjbGVhcmNvYXQiLHouQ0xFQVJDT0FUX1JPVUdITkVTUz0iY2xlYXJjb2F0Um91Z2huZXNzIix6LkNMRUFSQ09BVF9OT1JNQUw9ImNsZWFyY29hdE5vcm1hbCIsei5FTUlTU0lWRT0iZW1pc3NpdmUiLHouUk9UQVRJT049InJvdGF0aW9uIix6LlNIRUVOPSJzaGVlbiIsei5TSEVFTl9ST1VHSE5FU1M9InNoZWVuUm91Z2huZXNzIix6LkFOSVNPVFJPUFk9ImFuaXNvdHJvcHkiLHouSVJJREVTQ0VOQ0U9ImlyaWRlc2NlbmNlIix6LklSSURFU0NFTkNFX0lPUj0iaXJpZGVzY2VuY2VJT1IiLHouSVJJREVTQ0VOQ0VfVEhJQ0tORVNTPSJpcmlkZXNjZW5jZVRoaWNrbmVzcyIsei5JT1I9ImlvciIsei5UUkFOU01JU1NJT049InRyYW5zbWlzc2lvbiIsei5USElDS05FU1M9InRoaWNrbmVzcyIsei5BVFRFTlVBVElPTl9ESVNUQU5DRT0iYXR0ZW51YXRpb25EaXN0YW5jZSIsei5BVFRFTlVBVElPTl9DT0xPUj0iYXR0ZW51YXRpb25Db2xvciIsei5MSU5FX1NDQUxFPSJzY2FsZSIsei5MSU5FX0RBU0hfU0laRT0iZGFzaFNpemUiLHouTElORV9HQVBfU0laRT0iZ2FwU2l6ZSIsei5MSU5FX1dJRFRIPSJsaW5ld2lkdGgiLHouTElORV9EQVNIX09GRlNFVD0iZGFzaE9mZnNldCIsei5QT0lOVF9XSURUSD0icG9pbnRXaWR0aCIsei5ESVNQRVJTSU9OPSJkaXNwZXJzaW9uIix6LkxJR0hUX01BUD0ibGlnaHQiLHouQU9fTUFQPSJhbyIsei5BTFBIQV9URVNULHouQ09MT1Isei5TSElOSU5FU1Msei5FTUlTU0lWRSx6Lk9QQUNJVFksei5TUEVDVUxBUix6LlNQRUNVTEFSX0lOVEVOU0lUWSx6LlNQRUNVTEFSX0NPTE9SLHouU1BFQ1VMQVJfU1RSRU5HVEgsei5SRUZMRUNUSVZJVFksei5ST1VHSE5FU1Msei5NRVRBTE5FU1Msei5DTEVBUkNPQVQsei5DTEVBUkNPQVRfUk9VR0hORVNTLHouUk9UQVRJT04sei5TSEVFTix6LlNIRUVOX1JPVUdITkVTUyx6LkFOSVNPVFJPUFksei5JUklERVNDRU5DRSx6LklSSURFU0NFTkNFX0lPUix6LklSSURFU0NFTkNFX1RISUNLTkVTUyx6LlRSQU5TTUlTU0lPTix6LlRISUNLTkVTUyx6LklPUix6LkFUVEVOVUFUSU9OX0RJU1RBTkNFLHouQVRURU5VQVRJT05fQ09MT1Isei5MSU5FX1NDQUxFLHouTElORV9EQVNIX1NJWkUsei5MSU5FX0dBUF9TSVpFLHouTElORV9XSURUSCx6LkxJTkVfREFTSF9PRkZTRVQsei5QT0lOVF9XSURUSCx6LkRJU1BFUlNJT04sei5MSUdIVF9NQVAsei5BT19NQVA7Y29uc3QgdXM9eHQobmV3IEopLm9uUmVmZXJlbmNlKGZ1bmN0aW9uKHIpe3JldHVybiByLm1hdGVyaWFsfSkub25SZW5kZXJVcGRhdGUoZnVuY3Rpb24oe21hdGVyaWFsOnJ9KXt0aGlzLnZhbHVlLnNldChyLmFuaXNvdHJvcHkqTWF0aC5jb3Moci5hbmlzb3Ryb3B5Um90YXRpb24pLHIuYW5pc290cm9weSpNYXRoLnNpbihyLmFuaXNvdHJvcHlSb3RhdGlvbikpfSk7Y2xhc3MgVyBleHRlbmRzIFV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIkluZGV4Tm9kZSJ9Y29uc3RydWN0b3IodCl7c3VwZXIoInVpbnQiKSx0aGlzLnNjb3BlPXQsdGhpcy5pc0luc3RhbmNlSW5kZXhOb2RlPSEwfWdlbmVyYXRlKHQpe2NvbnN0IGU9dGhpcy5nZXROb2RlVHlwZSh0KSxzPXRoaXMuc2NvcGU7bGV0IG47aWYocz09PVcuVkVSVEVYKW49dC5nZXRWZXJ0ZXhJbmRleCgpO2Vsc2UgaWYocz09PVcuSU5TVEFOQ0Upbj10LmdldEluc3RhbmNlSW5kZXgoKTtlbHNlIGlmKHM9PT1XLkRSQVcpbj10LmdldERyYXdJbmRleCgpO2Vsc2UgaWYocz09PVcuSU5WT0NBVElPTl9MT0NBTCluPXQuZ2V0SW52b2NhdGlvbkxvY2FsSW5kZXgoKTtlbHNlIGlmKHM9PT1XLklOVk9DQVRJT05fU1VCR1JPVVApbj10LmdldEludm9jYXRpb25TdWJncm91cEluZGV4KCk7ZWxzZSBpZihzPT09Vy5TVUJHUk9VUCluPXQuZ2V0U3ViZ3JvdXBJbmRleCgpO2Vsc2UgdGhyb3cgbmV3IEVycm9yKCJUSFJFRS5JbmRleE5vZGU6IFVua25vd24gc2NvcGU6ICIrcyk7bGV0IGk7cmV0dXJuIHQuc2hhZGVyU3RhZ2U9PT0idmVydGV4Inx8dC5zaGFkZXJTdGFnZT09PSJjb21wdXRlIj9pPW46aT1QZSh0aGlzKS5idWlsZCh0LGUpLGl9fVcuVkVSVEVYPSJ2ZXJ0ZXgiLFcuSU5TVEFOQ0U9Imluc3RhbmNlIixXLlNVQkdST1VQPSJzdWJncm91cCIsVy5JTlZPQ0FUSU9OX0xPQ0FMPSJpbnZvY2F0aW9uTG9jYWwiLFcuSU5WT0NBVElPTl9TVUJHUk9VUD0iaW52b2NhdGlvblN1Ymdyb3VwIixXLkRSQVc9ImRyYXciLFcuVkVSVEVYLFcuSU5TVEFOQ0UsVy5TVUJHUk9VUCxXLklOVk9DQVRJT05fU1VCR1JPVVAsVy5JTlZPQ0FUSU9OX0xPQ0FMLFcuRFJBVztjbGFzcyBBdSBleHRlbmRzIFV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIkxvb3BOb2RlIn1jb25zdHJ1Y3Rvcih0PVtdKXtzdXBlcigpLHRoaXMucGFyYW1zPXR9Z2V0VmFyTmFtZSh0KXtyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSgiaSIuY2hhckNvZGVBdCgpK3QpfWdldFByb3BlcnRpZXModCl7Y29uc3QgZT10LmdldE5vZGVQcm9wZXJ0aWVzKHRoaXMpO2lmKGUuc3RhY2tOb2RlIT09dm9pZCAwKXJldHVybiBlO2NvbnN0IHM9e307Zm9yKGxldCBpPTAsbz10aGlzLnBhcmFtcy5sZW5ndGgtMTtpPG87aSsrKXtjb25zdCBhPXRoaXMucGFyYW1zW2ldLGM9YS5pc05vZGUhPT0hMCYmYS5uYW1lfHx0aGlzLmdldFZhck5hbWUoaSksdT1hLmlzTm9kZSE9PSEwJiZhLnR5cGV8fCJpbnQiO3NbY109WXMoYyx1KX1jb25zdCBuPXQuYWRkU3RhY2soKTtyZXR1cm4gZS5yZXR1cm5zTm9kZT10aGlzLnBhcmFtc1t0aGlzLnBhcmFtcy5sZW5ndGgtMV0ocyxuLHQpLGUuc3RhY2tOb2RlPW4sdC5yZW1vdmVTdGFjaygpLGV9Z2V0Tm9kZVR5cGUodCl7Y29uc3R7cmV0dXJuc05vZGU6ZX09dGhpcy5nZXRQcm9wZXJ0aWVzKHQpO3JldHVybiBlP2UuZ2V0Tm9kZVR5cGUodCk6InZvaWQifXNldHVwKHQpe3RoaXMuZ2V0UHJvcGVydGllcyh0KX1nZW5lcmF0ZSh0KXtjb25zdCBlPXRoaXMuZ2V0UHJvcGVydGllcyh0KSxzPXRoaXMucGFyYW1zLG49ZS5zdGFja05vZGU7Zm9yKGxldCBhPTAsYz1zLmxlbmd0aC0xO2E8YzthKyspe2NvbnN0IHU9c1thXTtsZXQgaD1udWxsLGw9bnVsbCxkPW51bGwsZj1udWxsLHA9bnVsbCxtPW51bGw7dS5pc05vZGU/KGY9ImludCIsZD10aGlzLmdldFZhck5hbWUoYSksaD0iMCIsbD11LmJ1aWxkKHQsZikscD0iPCIpOihmPXUudHlwZXx8ImludCIsZD11Lm5hbWV8fHRoaXMuZ2V0VmFyTmFtZShhKSxoPXUuc3RhcnQsbD11LmVuZCxwPXUuY29uZGl0aW9uLG09dS51cGRhdGUsdHlwZW9mIGg9PSJudW1iZXIiP2g9aC50b1N0cmluZygpOmgmJmguaXNOb2RlJiYoaD1oLmJ1aWxkKHQsZikpLHR5cGVvZiBsPT0ibnVtYmVyIj9sPWwudG9TdHJpbmcoKTpsJiZsLmlzTm9kZSYmKGw9bC5idWlsZCh0LGYpKSxoIT09dm9pZCAwJiZsPT09dm9pZCAwPyhoPWgrIiAtIDEiLGw9IjAiLHA9Ij49Iik6bCE9PXZvaWQgMCYmaD09PXZvaWQgMCYmKGg9IjAiLHA9IjwiKSxwPT09dm9pZCAwJiYoTnVtYmVyKGgpPk51bWJlcihsKT9wPSI+PSI6cD0iPCIpKTtjb25zdCBnPXtzdGFydDpoLGVuZDpsLGNvbmRpdGlvbjpwfSx5PWcuc3RhcnQsVD1nLmVuZDtsZXQgdz0iIixNPSIiLE49IiI7bXx8KGY9PT0iaW50Inx8Zj09PSJ1aW50Ij9wLmluY2x1ZGVzKCI8Iik/bT0iKysiOm09Ii0tIjpwLmluY2x1ZGVzKCI8Iik/bT0iKz0gMS4iOm09Ii09IDEuIiksdys9dC5nZXRWYXIoZixkKSsiID0gIit5LE0rPWQrIiAiK3ArIiAiK1QsTis9ZCsiICIrbTtjb25zdCBfPWBmb3IgKCAke3d9OyAke019OyAke059IClgO3QuYWRkRmxvd0NvZGUoKGE9PT0wP2AKYDoiIikrdC50YWIrXytgIHsKCmApLmFkZEZsb3dUYWIoKX1jb25zdCBpPW4uYnVpbGQodCwidm9pZCIpLG89ZS5yZXR1cm5zTm9kZT9lLnJldHVybnNOb2RlLmJ1aWxkKHQpOiIiO3QucmVtb3ZlRmxvd1RhYigpLmFkZEZsb3dDb2RlKGAKYCt0LnRhYitpKTtmb3IobGV0IGE9MCxjPXRoaXMucGFyYW1zLmxlbmd0aC0xO2E8YzthKyspdC5hZGRGbG93Q29kZSgoYT09PTA/IiI6dC50YWIpK2B9CgpgKS5yZW1vdmVGbG93VGFiKCk7cmV0dXJuIHQuYWRkRmxvd1RhYigpLG99fWNvbnN0IE9lPSguLi5yKT0+dihuZXcgQXUoRmUociwiaW50IikpKS5hcHBlbmQoKTtsZXQgbHMsZHM7Y2xhc3MgZXQgZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJTY3JlZW5Ob2RlIn1jb25zdHJ1Y3Rvcih0KXtzdXBlcigpLHRoaXMuc2NvcGU9dCx0aGlzLmlzVmlld3BvcnROb2RlPSEwfWdldE5vZGVUeXBlKCl7cmV0dXJuIHRoaXMuc2NvcGU9PT1ldC5WSUVXUE9SVD8idmVjNCI6InZlYzIifWdldFVwZGF0ZVR5cGUoKXtsZXQgdD1RLk5PTkU7cmV0dXJuKHRoaXMuc2NvcGU9PT1ldC5TSVpFfHx0aGlzLnNjb3BlPT09ZXQuVklFV1BPUlQpJiYodD1RLlJFTkRFUiksdGhpcy51cGRhdGVUeXBlPXQsdH11cGRhdGUoe3JlbmRlcmVyOnR9KXtjb25zdCBlPXQuZ2V0UmVuZGVyVGFyZ2V0KCk7dGhpcy5zY29wZT09PWV0LlZJRVdQT1JUP2UhPT1udWxsP2RzLmNvcHkoZS52aWV3cG9ydCk6KHQuZ2V0Vmlld3BvcnQoZHMpLGRzLm11bHRpcGx5U2NhbGFyKHQuZ2V0UGl4ZWxSYXRpbygpKSk6ZSE9PW51bGw/KGxzLndpZHRoPWUud2lkdGgsbHMuaGVpZ2h0PWUuaGVpZ2h0KTp0LmdldERyYXdpbmdCdWZmZXJTaXplKGxzKX1zZXR1cCgpe2NvbnN0IHQ9dGhpcy5zY29wZTtsZXQgZT1udWxsO3JldHVybiB0PT09ZXQuU0laRT9lPXh0KGxzfHwobHM9bmV3IEopKTp0PT09ZXQuVklFV1BPUlQ/ZT14dChkc3x8KGRzPW5ldyBGdCkpOmU9RChRcy5kaXYocm8pKSxlfWdlbmVyYXRlKHQpe2lmKHRoaXMuc2NvcGU9PT1ldC5DT09SRElOQVRFKXtsZXQgZT10LmdldEZyYWdDb29yZCgpO2lmKHQuaXNGbGlwWSgpKXtjb25zdCBzPXQuZ2V0Tm9kZVByb3BlcnRpZXMocm8pLm91dHB1dE5vZGUuYnVpbGQodCk7ZT1gJHt0LmdldFR5cGUoInZlYzIiKX0oICR7ZX0ueCwgJHtzfS55IC0gJHtlfS55IClgfXJldHVybiBlfXJldHVybiBzdXBlci5nZW5lcmF0ZSh0KX19ZXQuQ09PUkRJTkFURT0iY29vcmRpbmF0ZSIsZXQuVklFV1BPUlQ9InZpZXdwb3J0IixldC5TSVpFPSJzaXplIixldC5VVj0idXYiO2NvbnN0IHBpPU8oZXQsZXQuVVYpLHJvPU8oZXQsZXQuU0laRSksUXM9TyhldCxldC5DT09SRElOQVRFKSxvbz1PKGV0LGV0LlZJRVdQT1JUKTtvby56dyxvby54eTtjb25zdCBmcz1uZXcgSjtjbGFzcyBNdSBleHRlbmRzIEpze3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJWaWV3cG9ydFRleHR1cmVOb2RlIn1jb25zdHJ1Y3Rvcih0PXBpLGU9bnVsbCxzPW51bGwpe3M9PT1udWxsJiYocz1uZXcgQWEscy5taW5GaWx0ZXI9R2kpLHN1cGVyKHMsdCxlKSx0aGlzLmdlbmVyYXRlTWlwbWFwcz0hMSx0aGlzLmlzT3V0cHV0VGV4dHVyZU5vZGU9ITAsdGhpcy51cGRhdGVCZWZvcmVUeXBlPVEuRlJBTUV9dXBkYXRlQmVmb3JlKHQpe2NvbnN0IGU9dC5yZW5kZXJlcjtlLmdldERyYXdpbmdCdWZmZXJTaXplKGZzKTtjb25zdCBzPXRoaXMudmFsdWU7KHMuaW1hZ2Uud2lkdGghPT1mcy53aWR0aHx8cy5pbWFnZS5oZWlnaHQhPT1mcy5oZWlnaHQpJiYocy5pbWFnZS53aWR0aD1mcy53aWR0aCxzLmltYWdlLmhlaWdodD1mcy5oZWlnaHQscy5uZWVkc1VwZGF0ZT0hMCk7Y29uc3Qgbj1zLmdlbmVyYXRlTWlwbWFwcztzLmdlbmVyYXRlTWlwbWFwcz10aGlzLmdlbmVyYXRlTWlwbWFwcyxlLmNvcHlGcmFtZWJ1ZmZlclRvVGV4dHVyZShzKSxzLmdlbmVyYXRlTWlwbWFwcz1ufWNsb25lKCl7Y29uc3QgdD1uZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLnV2Tm9kZSx0aGlzLmxldmVsTm9kZSx0aGlzLnZhbHVlKTtyZXR1cm4gdC5nZW5lcmF0ZU1pcG1hcHM9dGhpcy5nZW5lcmF0ZU1pcG1hcHMsdH19bGV0IG1pPW51bGw7Y2xhc3MgU3UgZXh0ZW5kcyBNdXtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iVmlld3BvcnREZXB0aFRleHR1cmVOb2RlIn1jb25zdHJ1Y3Rvcih0PXBpLGU9bnVsbCl7bWk9PT1udWxsJiYobWk9bmV3IHhyKSxzdXBlcih0LGUsbWkpfX1jb25zdCBfdT1DKFN1KTtjbGFzcyBmdCBleHRlbmRzIFV7c3RhdGljIGdldCB0eXBlKCl7cmV0dXJuIlZpZXdwb3J0RGVwdGhOb2RlIn1jb25zdHJ1Y3Rvcih0LGU9bnVsbCl7c3VwZXIoImZsb2F0IiksdGhpcy5zY29wZT10LHRoaXMudmFsdWVOb2RlPWUsdGhpcy5pc1ZpZXdwb3J0RGVwdGhOb2RlPSEwfWdlbmVyYXRlKHQpe2NvbnN0e3Njb3BlOmV9PXRoaXM7cmV0dXJuIGU9PT1mdC5ERVBUSF9CQVNFP3QuZ2V0RnJhZ0RlcHRoKCk6c3VwZXIuZ2VuZXJhdGUodCl9c2V0dXAoe2NhbWVyYTp0fSl7Y29uc3R7c2NvcGU6ZX09dGhpcyxzPXRoaXMudmFsdWVOb2RlO2xldCBuPW51bGw7aWYoZT09PWZ0LkRFUFRIX0JBU0UpcyE9PW51bGwmJihuPWNvKCkuYXNzaWduKHMpKTtlbHNlIGlmKGU9PT1mdC5ERVBUSCl0LmlzUGVyc3BlY3RpdmVDYW1lcmE/bj16dShNdC56LGNzLGhzKTpuPUtzKE10LnosY3MsaHMpO2Vsc2UgaWYoZT09PWZ0LkxJTkVBUl9ERVBUSClpZihzIT09bnVsbClpZih0LmlzUGVyc3BlY3RpdmVDYW1lcmEpe2NvbnN0IGk9YW8ocyxjcyxocyk7bj1LcyhpLGNzLGhzKX1lbHNlIG49cztlbHNlIG49S3MoTXQueixjcyxocyk7cmV0dXJuIG59fWZ0LkRFUFRIX0JBU0U9ImRlcHRoQmFzZSIsZnQuREVQVEg9ImRlcHRoIixmdC5MSU5FQVJfREVQVEg9ImxpbmVhckRlcHRoIjtjb25zdCBLcz0ocix0LGUpPT5yLmFkZCh0KS5kaXYodC5zdWIoZSkpLHp1PShyLHQsZSk9PnQuYWRkKHIpLm11bChlKS5kaXYoZS5zdWIodCkubXVsKHIpKSxhbz0ocix0LGUpPT50Lm11bChlKS5kaXYoZS5zdWIodCkubXVsKHIpLnN1YihlKSksY289QyhmdCxmdC5ERVBUSF9CQVNFKSxidT1PKGZ0LGZ0LkRFUFRIKSxFdT1DKGZ0LGZ0LkxJTkVBUl9ERVBUSCk7X3UoKSxidS5hc3NpZ249cj0+Y28ocik7Y2xhc3MgcHMgZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJDbGlwcGluZ05vZGUifWNvbnN0cnVjdG9yKHQ9cHMuREVGQVVMVCl7c3VwZXIoKSx0aGlzLnNjb3BlPXR9c2V0dXAodCl7c3VwZXIuc2V0dXAodCk7Y29uc3QgZT10LmNsaXBwaW5nQ29udGV4dCx7bG9jYWxDbGlwSW50ZXJzZWN0aW9uOnMsbG9jYWxDbGlwcGluZ0NvdW50Om4sZ2xvYmFsQ2xpcHBpbmdDb3VudDppfT1lLG89aStuLGE9cz9vLW46bztyZXR1cm4gdGhpcy5zY29wZT09PXBzLkFMUEhBX1RPX0NPVkVSQUdFP3RoaXMuc2V0dXBBbHBoYVRvQ292ZXJhZ2UoZS5wbGFuZXMsbyxhKTp0aGlzLnNldHVwRGVmYXVsdChlLnBsYW5lcyxvLGEpfXNldHVwQWxwaGFUb0NvdmVyYWdlKHQsZSxzKXtyZXR1cm4gdHQoKCk9Pntjb25zdCBuPWZpKHQpLGk9dmUoImZsb2F0IiwiZGlzdGFuY2VUb1BsYW5lIiksbz12ZSgiZmxvYXQiLCJkaXN0YW5jZVRvR3JhZGllbnQiKSxhPXZlKCJmbG9hdCIsImNsaXBPcGFjaXR5Iik7YS5hc3NpZ24oMSk7bGV0IGM7aWYoT2Uocywoe2k6dX0pPT57Yz1uLmVsZW1lbnQodSksaS5hc3NpZ24oTXQuZG90KGMueHl6KS5uZWdhdGUoKS5hZGQoYy53KSksby5hc3NpZ24oaS5md2lkdGgoKS5kaXYoMikpLGEubXVsQXNzaWduKGhpKG8ubmVnYXRlKCksbyxpKSksYS5lcXVhbCgwKS5kaXNjYXJkKCl9KSxzPGUpe2NvbnN0IHU9dmUoImZsb2F0IiwidW5pb25jbGlwT3BhY2l0eSIpO3UuYXNzaWduKDEpLE9lKHtzdGFydDpzLGVuZDplfSwoe2k6aH0pPT57Yz1uLmVsZW1lbnQoaCksaS5hc3NpZ24oTXQuZG90KGMueHl6KS5uZWdhdGUoKS5hZGQoYy53KSksby5hc3NpZ24oaS5md2lkdGgoKS5kaXYoMikpLHUubXVsQXNzaWduKGhpKG8ubmVnYXRlKCksbyxpKS5vbmVNaW51cygpKX0pLGEubXVsQXNzaWduKHUub25lTWludXMoKSl9dnIuYS5tdWxBc3NpZ24oYSksdnIuYS5lcXVhbCgwKS5kaXNjYXJkKCl9KSgpfXNldHVwRGVmYXVsdCh0LGUscyl7cmV0dXJuIHR0KCgpPT57Y29uc3Qgbj1maSh0KTtsZXQgaTtpZihPZShzLCh7aTpvfSk9PntpPW4uZWxlbWVudChvKSxNdC5kb3QoaS54eXopLmdyZWF0ZXJUaGFuKGkudykuZGlzY2FyZCgpfSksczxlKXtjb25zdCBvPXZlKCJib29sIiwiY2xpcHBlZCIpO28uYXNzaWduKCEwKSxPZSh7c3RhcnQ6cyxlbmQ6ZX0sKHtpOmF9KT0+e2k9bi5lbGVtZW50KGEpLG8uYXNzaWduKE10LmRvdChpLnh5eikuZ3JlYXRlclRoYW4oaS53KS5hbmQobykpfSksby5kaXNjYXJkKCl9fSkoKX19cHMuQUxQSEFfVE9fQ09WRVJBR0U9ImFscGhhVG9Db3ZlcmFnZSIscHMuREVGQVVMVD0iZGVmYXVsdCIsayguMDQpLHEoMSk7Y29uc3QgQ3U9dHQoKFtyLHRdKT0+e2NvbnN0IGU9ci50b1ZhcigpO2UuYXNzaWduKEdzKDIsZSkuc3ViKDEpKTtjb25zdCBzPWsoZSwxKS50b1ZhcigpO3JldHVybiBuaSh0LmVxdWFsKDApLCgpPT57cy5hc3NpZ24ocy56eXgpfSkuRWxzZUlmKHQuZXF1YWwoMSksKCk9PntzLmFzc2lnbihzLnh6eSkscy54ei5tdWxBc3NpZ24oLTEpfSkuRWxzZUlmKHQuZXF1YWwoMiksKCk9PntzLngubXVsQXNzaWduKC0xKX0pLkVsc2VJZih0LmVxdWFsKDMpLCgpPT57cy5hc3NpZ24ocy56eXgpLHMueHoubXVsQXNzaWduKC0xKX0pLkVsc2VJZih0LmVxdWFsKDQpLCgpPT57cy5hc3NpZ24ocy54enkpLHMueHkubXVsQXNzaWduKC0xKX0pLkVsc2VJZih0LmVxdWFsKDUpLCgpPT57cy56Lm11bEFzc2lnbigtMSl9KSxzfSkuc2V0TGF5b3V0KHtuYW1lOiJnZXREaXJlY3Rpb24iLHR5cGU6InZlYzMiLGlucHV0czpbe25hbWU6InV2Iix0eXBlOiJ2ZWMyIn0se25hbWU6ImZhY2UiLHR5cGU6ImZsb2F0In1dfSk7dHQoKHt0ZXh0dXJlOnIsdXY6dH0pPT57Y29uc3Qgcz1rKCkudG9WYXIoKTtyZXR1cm4gbmkodC54Lmxlc3NUaGFuKDFlLTQpLCgpPT57cy5hc3NpZ24oaygxLDAsMCkpfSkuRWxzZUlmKHQueS5sZXNzVGhhbigxZS00KSwoKT0+e3MuYXNzaWduKGsoMCwxLDApKX0pLkVsc2VJZih0LnoubGVzc1RoYW4oMWUtNCksKCk9PntzLmFzc2lnbihrKDAsMCwxKSl9KS5FbHNlSWYodC54LmdyZWF0ZXJUaGFuKDEtMWUtNCksKCk9PntzLmFzc2lnbihrKC0xLDAsMCkpfSkuRWxzZUlmKHQueS5ncmVhdGVyVGhhbigxLTFlLTQpLCgpPT57cy5hc3NpZ24oaygwLC0xLDApKX0pLkVsc2VJZih0LnouZ3JlYXRlclRoYW4oMS0xZS00KSwoKT0+e3MuYXNzaWduKGsoMCwwLC0xKSl9KS5FbHNlKCgpPT57Y29uc3QgaT1yLnV2KHQuYWRkKGsoLS4wMSwwLDApKSkuci5zdWIoci51dih0LmFkZChrKC4wMSwwLDApKSkuciksbz1yLnV2KHQuYWRkKGsoMCwtLjAxLDApKSkuci5zdWIoci51dih0LmFkZChrKDAsLjAxLDApKSkuciksYT1yLnV2KHQuYWRkKGsoMCwwLC0uMDEpKSkuci5zdWIoci51dih0LmFkZChrKDAsMCwuMDEpKSkucik7cy5hc3NpZ24oayhpLG8sYSkpfSkscy5ub3JtYWxpemUoKX0pO2NvbnN0IHlpPUN1KFpzKCksb3MoImZhY2VJbmRleCIpKS5ub3JtYWxpemUoKTtrKHlpLngseWkueS5uZWdhdGUoKSx5aS56KTtjbGFzcyBQdCBleHRlbmRzIElle3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJUaW1lck5vZGUifWNvbnN0cnVjdG9yKHQ9UHQuTE9DQUwsZT0xLHM9MCl7c3VwZXIocyksdGhpcy5zY29wZT10LHRoaXMuc2NhbGU9ZSx0aGlzLnVwZGF0ZVR5cGU9US5GUkFNRX11cGRhdGUodCl7Y29uc3QgZT10aGlzLnNjb3BlLHM9dGhpcy5zY2FsZTtlPT09UHQuTE9DQUw/dGhpcy52YWx1ZSs9dC5kZWx0YVRpbWUqczplPT09UHQuREVMVEE/dGhpcy52YWx1ZT10LmRlbHRhVGltZSpzOmU9PT1QdC5GUkFNRT90aGlzLnZhbHVlPXQuZnJhbWVJZDp0aGlzLnZhbHVlPXQudGltZSpzfXNlcmlhbGl6ZSh0KXtzdXBlci5zZXJpYWxpemUodCksdC5zY29wZT10aGlzLnNjb3BlLHQuc2NhbGU9dGhpcy5zY2FsZX1kZXNlcmlhbGl6ZSh0KXtzdXBlci5kZXNlcmlhbGl6ZSh0KSx0aGlzLnNjb3BlPXQuc2NvcGUsdGhpcy5zY2FsZT10LnNjYWxlfX1QdC5MT0NBTD0ibG9jYWwiLFB0LkdMT0JBTD0iZ2xvYmFsIixQdC5ERUxUQT0iZGVsdGEiLFB0LkZSQU1FPSJmcmFtZSI7Y29uc3QgRnU9KHIsdD0wKT0+dihuZXcgUHQoUHQuTE9DQUwscix0KSk7Y2xhc3MgcnQgZXh0ZW5kcyBVe3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJPc2NOb2RlIn1jb25zdHJ1Y3Rvcih0PXJ0LlNJTkUsZT1GdSgpKXtzdXBlcigpLHRoaXMubWV0aG9kPXQsdGhpcy50aW1lTm9kZT1lfWdldE5vZGVUeXBlKHQpe3JldHVybiB0aGlzLnRpbWVOb2RlLmdldE5vZGVUeXBlKHQpfXNldHVwKCl7Y29uc3QgdD10aGlzLm1ldGhvZCxlPXYodGhpcy50aW1lTm9kZSk7bGV0IHM9bnVsbDtyZXR1cm4gdD09PXJ0LlNJTkU/cz1lLmFkZCguNzUpLm11bChNYXRoLlBJKjIpLnNpbigpLm11bCguNSkuYWRkKC41KTp0PT09cnQuU1FVQVJFP3M9ZS5mcmFjdCgpLnJvdW5kKCk6dD09PXJ0LlRSSUFOR0xFP3M9ZS5hZGQoLjUpLmZyYWN0KCkubXVsKDIpLnN1YigxKS5hYnMoKTp0PT09cnQuU0FXVE9PVEgmJihzPWUuZnJhY3QoKSksc31zZXJpYWxpemUodCl7c3VwZXIuc2VyaWFsaXplKHQpLHQubWV0aG9kPXRoaXMubWV0aG9kfWRlc2VyaWFsaXplKHQpe3N1cGVyLmRlc2VyaWFsaXplKHQpLHRoaXMubWV0aG9kPXQubWV0aG9kfX1ydC5TSU5FPSJzaW5lIixydC5TUVVBUkU9InNxdWFyZSIscnQuVFJJQU5HTEU9InRyaWFuZ2xlIixydC5TQVdUT09USD0ic2F3dG9vdGgiLHJ0LlNJTkUscnQuU1FVQVJFLHJ0LlRSSUFOR0xFLHJ0LlNBV1RPT1RILG5ldyBYbixuZXcgQSxuZXcgQSxuZXcgQSxuZXcgbnQsbmV3IEEoMCwwLC0xKSxuZXcgRnQsbmV3IEEsbmV3IEEsbmV3IEZ0LG5ldyBKLG5ldyBvcixwaS5mbGlwWCgpO2NsYXNzIFV0IGV4dGVuZHMgVXtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iU2NlbmVOb2RlIn1jb25zdHJ1Y3Rvcih0PVV0LkJBQ0tHUk9VTkRfQkxVUlJJTkVTUyxlPW51bGwpe3N1cGVyKCksdGhpcy5zY29wZT10LHRoaXMuc2NlbmU9ZX1zZXR1cCh0KXtjb25zdCBlPXRoaXMuc2NvcGUscz10aGlzLnNjZW5lIT09bnVsbD90aGlzLnNjZW5lOnQuc2NlbmU7bGV0IG47cmV0dXJuIGU9PT1VdC5CQUNLR1JPVU5EX0JMVVJSSU5FU1M/bj1wZSgiYmFja2dyb3VuZEJsdXJyaW5lc3MiLCJmbG9hdCIscyk6ZT09PVV0LkJBQ0tHUk9VTkRfSU5URU5TSVRZP249cGUoImJhY2tncm91bmRJbnRlbnNpdHkiLCJmbG9hdCIscyk6Y29uc29sZS5lcnJvcigiVEhSRUUuU2NlbmVOb2RlOiBVbmtub3duIHNjb3BlOiIsZSksbn19VXQuQkFDS0dST1VORF9CTFVSUklORVNTPSJiYWNrZ3JvdW5kQmx1cnJpbmVzcyIsVXQuQkFDS0dST1VORF9JTlRFTlNJVFk9ImJhY2tncm91bmRJbnRlbnNpdHkiLFV0LkJBQ0tHUk9VTkRfQkxVUlJJTkVTUyxVdC5CQUNLR1JPVU5EX0lOVEVOU0lUWTtjb25zdCBSdT1uZXcgSjtjbGFzcyBCdSBleHRlbmRzIEpze3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJQYXNzVGV4dHVyZU5vZGUifWNvbnN0cnVjdG9yKHQsZSl7c3VwZXIoZSksdGhpcy5wYXNzTm9kZT10LHRoaXMuc2V0VXBkYXRlTWF0cml4KCExKX1zZXR1cCh0KXtyZXR1cm4gdC5vYmplY3QuaXNRdWFkTWVzaCYmdGhpcy5wYXNzTm9kZS5idWlsZCh0KSxzdXBlci5zZXR1cCh0KX1jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLnBhc3NOb2RlLHRoaXMudmFsdWUpfX1jbGFzcyBobyBleHRlbmRzIEJ1e3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJQYXNzTXVsdGlwbGVUZXh0dXJlTm9kZSJ9Y29uc3RydWN0b3IodCxlLHM9ITEpe3N1cGVyKHQsbnVsbCksdGhpcy50ZXh0dXJlTmFtZT1lLHRoaXMucHJldmlvdXNUZXh0dXJlPXN9dXBkYXRlVGV4dHVyZSgpe3RoaXMudmFsdWU9dGhpcy5wcmV2aW91c1RleHR1cmU/dGhpcy5wYXNzTm9kZS5nZXRQcmV2aW91c1RleHR1cmUodGhpcy50ZXh0dXJlTmFtZSk6dGhpcy5wYXNzTm9kZS5nZXRUZXh0dXJlKHRoaXMudGV4dHVyZU5hbWUpfXNldHVwKHQpe3JldHVybiB0aGlzLnVwZGF0ZVRleHR1cmUoKSxzdXBlci5zZXR1cCh0KX1jbG9uZSgpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLnBhc3NOb2RlLHRoaXMudGV4dHVyZU5hbWUsdGhpcy5wcmV2aW91c1RleHR1cmUpfX1jbGFzcyB0biBleHRlbmRzIGR0e3N0YXRpYyBnZXQgdHlwZSgpe3JldHVybiJQYXNzTm9kZSJ9Y29uc3RydWN0b3IodCxlLHMsbj17fSl7c3VwZXIoInZlYzQiKSx0aGlzLnNjb3BlPXQsdGhpcy5zY2VuZT1lLHRoaXMuY2FtZXJhPXMsdGhpcy5vcHRpb25zPW4sdGhpcy5fcGl4ZWxSYXRpbz0xLHRoaXMuX3dpZHRoPTEsdGhpcy5faGVpZ2h0PTE7Y29uc3QgaT1uZXcgeHI7aS5pc1JlbmRlclRhcmdldFRleHR1cmU9ITAsaS5uYW1lPSJkZXB0aCI7Y29uc3Qgbz1uZXcgb3IodGhpcy5fd2lkdGgqdGhpcy5fcGl4ZWxSYXRpbyx0aGlzLl9oZWlnaHQqdGhpcy5fcGl4ZWxSYXRpbyx7dHlwZTp2bywuLi5ufSk7by50ZXh0dXJlLm5hbWU9Im91dHB1dCIsby5kZXB0aFRleHR1cmU9aSx0aGlzLnJlbmRlclRhcmdldD1vLHRoaXMudXBkYXRlQmVmb3JlVHlwZT1RLkZSQU1FLHRoaXMuX3RleHR1cmVzPXtvdXRwdXQ6by50ZXh0dXJlLGRlcHRoOml9LHRoaXMuX3RleHR1cmVOb2Rlcz17fSx0aGlzLl9saW5lYXJEZXB0aE5vZGVzPXt9LHRoaXMuX3ZpZXdaTm9kZXM9e30sdGhpcy5fcHJldmlvdXNUZXh0dXJlcz17fSx0aGlzLl9wcmV2aW91c1RleHR1cmVOb2Rlcz17fSx0aGlzLl9jYW1lcmFOZWFyPXh0KDApLHRoaXMuX2NhbWVyYUZhcj14dCgwKSx0aGlzLl9tcnQ9bnVsbCx0aGlzLmlzUGFzc05vZGU9ITB9c2V0TVJUKHQpe3JldHVybiB0aGlzLl9tcnQ9dCx0aGlzfWdldE1SVCgpe3JldHVybiB0aGlzLl9tcnR9aXNHbG9iYWwoKXtyZXR1cm4hMH1nZXRUZXh0dXJlKHQpe2xldCBlPXRoaXMuX3RleHR1cmVzW3RdO3JldHVybiBlPT09dm9pZCAwJiYoZT10aGlzLnJlbmRlclRhcmdldC50ZXh0dXJlLmNsb25lKCksZS5pc1JlbmRlclRhcmdldFRleHR1cmU9ITAsZS5uYW1lPXQsdGhpcy5fdGV4dHVyZXNbdF09ZSx0aGlzLnJlbmRlclRhcmdldC50ZXh0dXJlcy5wdXNoKGUpKSxlfWdldFByZXZpb3VzVGV4dHVyZSh0KXtsZXQgZT10aGlzLl9wcmV2aW91c1RleHR1cmVzW3RdO3JldHVybiBlPT09dm9pZCAwJiYoZT10aGlzLmdldFRleHR1cmUodCkuY2xvbmUoKSxlLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZT0hMCx0aGlzLl9wcmV2aW91c1RleHR1cmVzW3RdPWUpLGV9dG9nZ2xlVGV4dHVyZSh0KXtjb25zdCBlPXRoaXMuX3ByZXZpb3VzVGV4dHVyZXNbdF07aWYoZSE9PXZvaWQgMCl7Y29uc3Qgcz10aGlzLl90ZXh0dXJlc1t0XSxuPXRoaXMucmVuZGVyVGFyZ2V0LnRleHR1cmVzLmluZGV4T2Yocyk7dGhpcy5yZW5kZXJUYXJnZXQudGV4dHVyZXNbbl09ZSx0aGlzLl90ZXh0dXJlc1t0XT1lLHRoaXMuX3ByZXZpb3VzVGV4dHVyZXNbdF09cyx0aGlzLl90ZXh0dXJlTm9kZXNbdF0udXBkYXRlVGV4dHVyZSgpLHRoaXMuX3ByZXZpb3VzVGV4dHVyZU5vZGVzW3RdLnVwZGF0ZVRleHR1cmUoKX19Z2V0VGV4dHVyZU5vZGUodD0ib3V0cHV0Iil7bGV0IGU9dGhpcy5fdGV4dHVyZU5vZGVzW3RdO3JldHVybiBlPT09dm9pZCAwJiYodGhpcy5fdGV4dHVyZU5vZGVzW3RdPWU9dihuZXcgaG8odGhpcyx0KSksdGhpcy5fdGV4dHVyZU5vZGVzW3RdLnVwZGF0ZVRleHR1cmUoKSksZX1nZXRQcmV2aW91c1RleHR1cmVOb2RlKHQ9Im91dHB1dCIpe2xldCBlPXRoaXMuX3ByZXZpb3VzVGV4dHVyZU5vZGVzW3RdO3JldHVybiBlPT09dm9pZCAwJiYodGhpcy5fdGV4dHVyZU5vZGVzW3RdPT09dm9pZCAwJiZ0aGlzLmdldFRleHR1cmVOb2RlKHQpLHRoaXMuX3ByZXZpb3VzVGV4dHVyZU5vZGVzW3RdPWU9dihuZXcgaG8odGhpcyx0LCEwKSksdGhpcy5fcHJldmlvdXNUZXh0dXJlTm9kZXNbdF0udXBkYXRlVGV4dHVyZSgpKSxlfWdldFZpZXdaTm9kZSh0PSJkZXB0aCIpe2xldCBlPXRoaXMuX3ZpZXdaTm9kZXNbdF07aWYoZT09PXZvaWQgMCl7Y29uc3Qgcz10aGlzLl9jYW1lcmFOZWFyLG49dGhpcy5fY2FtZXJhRmFyO3RoaXMuX3ZpZXdaTm9kZXNbdF09ZT1hbyh0aGlzLmdldFRleHR1cmVOb2RlKHQpLHMsbil9cmV0dXJuIGV9Z2V0TGluZWFyRGVwdGhOb2RlKHQ9ImRlcHRoIil7bGV0IGU9dGhpcy5fbGluZWFyRGVwdGhOb2Rlc1t0XTtpZihlPT09dm9pZCAwKXtjb25zdCBzPXRoaXMuX2NhbWVyYU5lYXIsbj10aGlzLl9jYW1lcmFGYXIsaT10aGlzLmdldFZpZXdaTm9kZSh0KTt0aGlzLl9saW5lYXJEZXB0aE5vZGVzW3RdPWU9S3MoaSxzLG4pfXJldHVybiBlfXNldHVwKHtyZW5kZXJlcjp0fSl7cmV0dXJuIHRoaXMucmVuZGVyVGFyZ2V0LnNhbXBsZXM9dGhpcy5vcHRpb25zLnNhbXBsZXM9PT12b2lkIDA/dC5zYW1wbGVzOnRoaXMub3B0aW9ucy5zYW1wbGVzLHQuYmFja2VuZC5pc1dlYkdMQmFja2VuZD09PSEwJiYodGhpcy5yZW5kZXJUYXJnZXQuc2FtcGxlcz0wKSx0aGlzLnJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaXNNdWx0aXNhbXBsZVJlbmRlclRhcmdldFRleHR1cmU9dGhpcy5yZW5kZXJUYXJnZXQuc2FtcGxlcz4xLHRoaXMuc2NvcGU9PT10bi5DT0xPUj90aGlzLmdldFRleHR1cmVOb2RlKCk6dGhpcy5nZXRMaW5lYXJEZXB0aE5vZGUoKX11cGRhdGVCZWZvcmUodCl7Y29uc3R7cmVuZGVyZXI6ZX09dCx7c2NlbmU6cyxjYW1lcmE6bn09dGhpczt0aGlzLl9waXhlbFJhdGlvPWUuZ2V0UGl4ZWxSYXRpbygpO2NvbnN0IGk9ZS5nZXRTaXplKFJ1KTt0aGlzLnNldFNpemUoaS53aWR0aCxpLmhlaWdodCk7Y29uc3Qgbz1lLmdldFJlbmRlclRhcmdldCgpLGE9ZS5nZXRNUlQoKTt0aGlzLl9jYW1lcmFOZWFyLnZhbHVlPW4ubmVhcix0aGlzLl9jYW1lcmFGYXIudmFsdWU9bi5mYXI7Zm9yKGNvbnN0IGMgaW4gdGhpcy5fcHJldmlvdXNUZXh0dXJlcyl0aGlzLnRvZ2dsZVRleHR1cmUoYyk7ZS5zZXRSZW5kZXJUYXJnZXQodGhpcy5yZW5kZXJUYXJnZXQpLGUuc2V0TVJUKHRoaXMuX21ydCksZS5yZW5kZXIocyxuKSxlLnNldFJlbmRlclRhcmdldChvKSxlLnNldE1SVChhKX1zZXRTaXplKHQsZSl7dGhpcy5fd2lkdGg9dCx0aGlzLl9oZWlnaHQ9ZTtjb25zdCBzPXRoaXMuX3dpZHRoKnRoaXMuX3BpeGVsUmF0aW8sbj10aGlzLl9oZWlnaHQqdGhpcy5fcGl4ZWxSYXRpbzt0aGlzLnJlbmRlclRhcmdldC5zZXRTaXplKHMsbil9c2V0UGl4ZWxSYXRpbyh0KXt0aGlzLl9waXhlbFJhdGlvPXQsdGhpcy5zZXRTaXplKHRoaXMuX3dpZHRoLHRoaXMuX2hlaWdodCl9ZGlzcG9zZSgpe3RoaXMucmVuZGVyVGFyZ2V0LmRpc3Bvc2UoKX19dG4uQ09MT1I9ImNvbG9yIix0bi5ERVBUSD0iZGVwdGgiLHR0KCh7ZGVwdGhUZXh0dXJlOnIsc2hhZG93Q29vcmQ6dH0pPT5hcyhyLHQueHkpLmNvbXBhcmUodC56KSksdHQoKHtkZXB0aFRleHR1cmU6cixzaGFkb3dDb29yZDp0LHNoYWRvdzplfSk9Pntjb25zdCBzPShtLGcpPT5hcyhyLG0pLmNvbXBhcmUoZyksbj1wZSgibWFwU2l6ZSIsInZlYzIiLGUpLnNldEdyb3VwKGRlKSxpPXBlKCJyYWRpdXMiLCJmbG9hdCIsZSkuc2V0R3JvdXAoZGUpLG89RCgxKS5kaXYobiksYT1vLngubmVnYXRlKCkubXVsKGkpLGM9by55Lm5lZ2F0ZSgpLm11bChpKSx1PW8ueC5tdWwoaSksaD1vLnkubXVsKGkpLGw9YS5kaXYoMiksZD1jLmRpdigyKSxmPXUuZGl2KDIpLHA9aC5kaXYoMik7cmV0dXJuIGZlKHModC54eS5hZGQoRChhLGMpKSx0LnopLHModC54eS5hZGQoRCgwLGMpKSx0LnopLHModC54eS5hZGQoRCh1LGMpKSx0LnopLHModC54eS5hZGQoRChsLGQpKSx0LnopLHModC54eS5hZGQoRCgwLGQpKSx0LnopLHModC54eS5hZGQoRChmLGQpKSx0LnopLHModC54eS5hZGQoRChhLDApKSx0LnopLHModC54eS5hZGQoRChsLDApKSx0LnopLHModC54eSx0LnopLHModC54eS5hZGQoRChmLDApKSx0LnopLHModC54eS5hZGQoRCh1LDApKSx0LnopLHModC54eS5hZGQoRChsLHApKSx0LnopLHModC54eS5hZGQoRCgwLHApKSx0LnopLHModC54eS5hZGQoRChmLHApKSx0LnopLHModC54eS5hZGQoRChhLGgpKSx0LnopLHModC54eS5hZGQoRCgwLGgpKSx0LnopLHModC54eS5hZGQoRCh1LGgpKSx0LnopKS5tdWwoMS8xNyl9KSx0dCgoe2RlcHRoVGV4dHVyZTpyLHNoYWRvd0Nvb3JkOnQsc2hhZG93OmV9KT0+e2NvbnN0IHM9KGgsbCk9PmFzKHIsaCkuY29tcGFyZShsKSxuPXBlKCJtYXBTaXplIiwidmVjMiIsZSkuc2V0R3JvdXAoZGUpLGk9RCgxKS5kaXYobiksbz1pLngsYT1pLnksYz10Lnh5LHU9cmkoYy5tdWwobikuYWRkKC41KSk7cmV0dXJuIGMuc3ViQXNzaWduKHUubXVsKGkpKSxmZShzKGMsdC56KSxzKGMuYWRkKEQobywwKSksdC56KSxzKGMuYWRkKEQoMCxhKSksdC56KSxzKGMuYWRkKGkpLHQueikscmUocyhjLmFkZChEKG8ubmVnYXRlKCksMCkpLHQueikscyhjLmFkZChEKG8ubXVsKDIpLDApKSx0LnopLHUueCkscmUocyhjLmFkZChEKG8ubmVnYXRlKCksYSkpLHQueikscyhjLmFkZChEKG8ubXVsKDIpLGEpKSx0LnopLHUueCkscmUocyhjLmFkZChEKDAsYS5uZWdhdGUoKSkpLHQueikscyhjLmFkZChEKDAsYS5tdWwoMikpKSx0LnopLHUueSkscmUocyhjLmFkZChEKG8sYS5uZWdhdGUoKSkpLHQueikscyhjLmFkZChEKG8sYS5tdWwoMikpKSx0LnopLHUueSkscmUocmUocyhjLmFkZChEKG8ubmVnYXRlKCksYS5uZWdhdGUoKSkpLHQueikscyhjLmFkZChEKG8ubXVsKDIpLGEubmVnYXRlKCkpKSx0LnopLHUueCkscmUocyhjLmFkZChEKG8ubmVnYXRlKCksYS5tdWwoMikpKSx0LnopLHMoYy5hZGQoRChvLm11bCgyKSxhLm11bCgyKSkpLHQueiksdS54KSx1LnkpKS5tdWwoMS85KX0pLHR0KCh7ZGVwdGhUZXh0dXJlOnIsc2hhZG93Q29vcmQ6dH0pPT57Y29uc3QgZT1xKDEpLnRvVmFyKCkscz1hcyhyKS51dih0Lnh5KS5yZyxuPWtyKHQueixzLngpO3JldHVybiBuaShuLm5vdEVxdWFsKHEoMSkpLCgpPT57Y29uc3QgaT10Lnouc3ViKHMueCksbz1haSgwLHMueS5tdWwocy55KSk7bGV0IGE9by5kaXYoby5hZGQoaS5tdWwoaSkpKTthPVdzKCRzKGEsLjMpLmRpdiguOTUtLjMpKSxlLmFzc2lnbihXcyhhaShuLGEpKSl9KSxlfSksdHQoKHtzYW1wbGVzOnIscmFkaXVzOnQsc2l6ZTplLHNoYWRvd1Bhc3M6c30pPT57Y29uc3Qgbj1xKDApLnRvVmFyKCksaT1xKDApLnRvVmFyKCksbz1yLmxlc3NUaGFuRXF1YWwocSgxKSkuc2VsZWN0KHEoMCkscSgyKS5kaXYoci5zdWIoMSkpKSxhPXIubGVzc1RoYW5FcXVhbChxKDEpKS5zZWxlY3QocSgwKSxxKC0xKSk7T2Uoe3N0YXJ0OlJlKDApLGVuZDpSZShyKSx0eXBlOiJpbnQiLGNvbmRpdGlvbjoiPCJ9LCh7aTp1fSk9Pntjb25zdCBoPWEuYWRkKHEodSkubXVsKG8pKSxsPXMudXYoZmUoUXMueHksRCgwLGgpLm11bCh0KSkuZGl2KGUpKS54O24uYWRkQXNzaWduKGwpLGkuYWRkQXNzaWduKGwubXVsKGwpKX0pLG4uZGl2QXNzaWduKHIpLGkuZGl2QXNzaWduKHIpO2NvbnN0IGM9aWkoaS5zdWIobi5tdWwobikpKTtyZXR1cm4gRChuLGMpfSksdHQoKHtzYW1wbGVzOnIscmFkaXVzOnQsc2l6ZTplLHNoYWRvd1Bhc3M6c30pPT57Y29uc3Qgbj1xKDApLnRvVmFyKCksaT1xKDApLnRvVmFyKCksbz1yLmxlc3NUaGFuRXF1YWwocSgxKSkuc2VsZWN0KHEoMCkscSgyKS5kaXYoci5zdWIoMSkpKSxhPXIubGVzc1RoYW5FcXVhbChxKDEpKS5zZWxlY3QocSgwKSxxKC0xKSk7T2Uoe3N0YXJ0OlJlKDApLGVuZDpSZShyKSx0eXBlOiJpbnQiLGNvbmRpdGlvbjoiPCJ9LCh7aTp1fSk9Pntjb25zdCBoPWEuYWRkKHEodSkubXVsKG8pKSxsPXMudXYoZmUoUXMueHksRChoLDApLm11bCh0KSkuZGl2KGUpKTtuLmFkZEFzc2lnbihsLngpLGkuYWRkQXNzaWduKGZlKGwueS5tdWwobC55KSxsLngubXVsKGwueCkpKX0pLG4uZGl2QXNzaWduKHIpLGkuZGl2QXNzaWduKHIpO2NvbnN0IGM9aWkoaS5zdWIobi5tdWwobikpKTtyZXR1cm4gRChuLGMpfSksaygxLjY2MDUsLS4xMjQ2LC0uMDE4MiksaygtLjU4NzYsMS4xMzI5LC0uMTAwNiksaygtLjA3MjgsLS4wMDgzLDEuMTE4NyksayguNjI3NCwuMDY5MSwuMDE2NCksayguMzI5MywuOTE5NSwuMDg4KSxrKC4wNDMzLC4wMTEzLC44OTU2KTtjbGFzcyBJdSBleHRlbmRzIFV7Y29uc3RydWN0b3IodCl7c3VwZXIoKSx0aGlzLnNjb3BlPXR9Z2VuZXJhdGUodCl7Y29uc3R7c2NvcGU6ZX09dGhpcyx7cmVuZGVyZXI6c309dDtzLmJhY2tlbmQuaXNXZWJHTEJhY2tlbmQ9PT0hMD90LmFkZEZsb3dDb2RlKGAJLy8gJHtlfUJhcnJpZXIgCmApOnQuYWRkTGluZUZsb3dDb2RlKGAke2V9QmFycmllcigpYCx0aGlzKX19QyhJdSk7Y2xhc3Mga3QgZXh0ZW5kcyBkdHtzdGF0aWMgZ2V0IHR5cGUoKXtyZXR1cm4iQXRvbWljRnVuY3Rpb25Ob2RlIn1jb25zdHJ1Y3Rvcih0LGUscyxuPW51bGwpe3N1cGVyKCJ1aW50IiksdGhpcy5tZXRob2Q9dCx0aGlzLnBvaW50ZXJOb2RlPWUsdGhpcy52YWx1ZU5vZGU9cyx0aGlzLnN0b3JlTm9kZT1ufWdldElucHV0VHlwZSh0KXtyZXR1cm4gdGhpcy5wb2ludGVyTm9kZS5nZXROb2RlVHlwZSh0KX1nZXROb2RlVHlwZSh0KXtyZXR1cm4gdGhpcy5nZXRJbnB1dFR5cGUodCl9Z2VuZXJhdGUodCl7Y29uc3QgZT10aGlzLm1ldGhvZCxzPXRoaXMuZ2V0Tm9kZVR5cGUodCksbj10aGlzLmdldElucHV0VHlwZSh0KSxpPXRoaXMucG9pbnRlck5vZGUsbz10aGlzLnZhbHVlTm9kZSxhPVtdO2EucHVzaChgJiR7aS5idWlsZCh0LG4pfWApLGEucHVzaChvLmJ1aWxkKHQsbikpO2NvbnN0IGM9YCR7dC5nZXRNZXRob2QoZSxzKX0oICR7YS5qb2luKCIsICIpfSApYDtpZih0aGlzLnN0b3JlTm9kZSE9PW51bGwpe2NvbnN0IHU9dGhpcy5zdG9yZU5vZGUuYnVpbGQodCxuKTt0LmFkZExpbmVGbG93Q29kZShgJHt1fSA9ICR7Y31gLHRoaXMpfWVsc2UgdC5hZGRMaW5lRmxvd0NvZGUoYyx0aGlzKX19aWYoa3QuQVRPTUlDX0xPQUQ9ImF0b21pY0xvYWQiLGt0LkFUT01JQ19TVE9SRT0iYXRvbWljU3RvcmUiLGt0LkFUT01JQ19BREQ9ImF0b21pY0FkZCIsa3QuQVRPTUlDX1NVQj0iYXRvbWljU3ViIixrdC5BVE9NSUNfTUFYPSJhdG9taWNNYXgiLGt0LkFUT01JQ19NSU49ImF0b21pY01pbiIsa3QuQVRPTUlDX0FORD0iYXRvbWljQW5kIixrdC5BVE9NSUNfT1I9ImF0b21pY09yIixrdC5BVE9NSUNfWE9SPSJhdG9taWNYb3IiLEMoa3QpLHR5cGVvZiBfX1RIUkVFX0RFVlRPT0xTX188InUiJiZfX1RIUkVFX0RFVlRPT0xTX18uZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoInJlZ2lzdGVyIix7ZGV0YWlsOntyZXZpc2lvbjpYZX19KSksdHlwZW9mIHdpbmRvdzwidSIpe3RyeXtBbiYmQW4udGFnTmFtZS50b1VwcGVyQ2FzZSgpPT09IlNDUklQVCImJkFuLnNyY3x8bmV3IFVSTCgiYXNzZXRzL2dlbmVyYXRlTWVzaEJWSC53b3JrZXItYjc3ODg5MzkuanMiLGRvY3VtZW50LmJhc2VVUkkpLmhyZWYsd2luZG93Ll9fVEhSRUVfX0lNUE9SVFNfX3x8KHdpbmRvdy5fX1RIUkVFX19JTVBPUlRTX189W10pLHdpbmRvdy5fX1RIUkVFX19JTVBPUlRTX18ucHVzaCh7dXJsOnNlbGYubG9jYXRpb24uaHJlZixyZXZpc2lvbjpYZX0pfWNhdGNoe313aW5kb3cuX19USFJFRV9fPyhjb25zb2xlLndhcm4oIldBUk5JTkc6IE11bHRpcGxlIGluc3RhbmNlcyBvZiBUaHJlZS5qcyBiZWluZyBpbXBvcnRlZC4gRXhpc3Rpbmc6ICIrd2luZG93Ll9fVEhSRUVfXysiLCBuZXc6ICIrWGUpLGNvbnNvbGUud2Fybih3aW5kb3cuX19USFJFRV9fSU1QT1JUU19fKSk6d2luZG93Ll9fVEhSRUVfXz1YZX1jb25zdCB1bz0wLHZ1PTEsUHU9Mixsbz0yLGdpPTEuMjUsZm89MSxtcz02KjQrNCs0LGVuPTY1NTM1LEx1PU1hdGgucG93KDIsLTI0KSx4aT1TeW1ib2woIlNLSVBfR0VORVJBVElPTiIpO2Z1bmN0aW9uIE91KHIpe3JldHVybiByLmluZGV4P3IuaW5kZXguY291bnQ6ci5hdHRyaWJ1dGVzLnBvc2l0aW9uLmNvdW50fWZ1bmN0aW9uIERlKHIpe3JldHVybiBPdShyKS8zfWZ1bmN0aW9uIER1KHIsdD1BcnJheUJ1ZmZlcil7cmV0dXJuIHI+NjU1MzU/bmV3IFVpbnQzMkFycmF5KG5ldyB0KDQqcikpOm5ldyBVaW50MTZBcnJheShuZXcgdCgyKnIpKX1mdW5jdGlvbiBWdShyLHQpe2lmKCFyLmluZGV4KXtjb25zdCBlPXIuYXR0cmlidXRlcy5wb3NpdGlvbi5jb3VudCxzPXQudXNlU2hhcmVkQXJyYXlCdWZmZXI/U2hhcmVkQXJyYXlCdWZmZXI6QXJyYXlCdWZmZXIsbj1EdShlLHMpO3Iuc2V0SW5kZXgobmV3IHZ0KG4sMSkpO2ZvcihsZXQgaT0wO2k8ZTtpKyspbltpXT1pfX1mdW5jdGlvbiBwbyhyLHQpe2NvbnN0IGU9RGUocikscz10fHxyLmRyYXdSYW5nZSxuPXMuc3RhcnQvMyxpPShzLnN0YXJ0K3MuY291bnQpLzMsbz1NYXRoLm1heCgwLG4pLGE9TWF0aC5taW4oZSxpKS1vO3JldHVyblt7b2Zmc2V0Ok1hdGguZmxvb3IobyksY291bnQ6TWF0aC5mbG9vcihhKX1dfWZ1bmN0aW9uIG1vKHIsdCl7aWYoIXIuZ3JvdXBzfHwhci5ncm91cHMubGVuZ3RoKXJldHVybiBwbyhyLHQpO2NvbnN0IGU9W10scz1uZXcgU2V0LG49dHx8ci5kcmF3UmFuZ2UsaT1uLnN0YXJ0LzMsbz0obi5zdGFydCtuLmNvdW50KS8zO2Zvcihjb25zdCBjIG9mIHIuZ3JvdXBzKXtjb25zdCB1PWMuc3RhcnQvMyxoPShjLnN0YXJ0K2MuY291bnQpLzM7cy5hZGQoTWF0aC5tYXgoaSx1KSkscy5hZGQoTWF0aC5taW4obyxoKSl9Y29uc3QgYT1BcnJheS5mcm9tKHMudmFsdWVzKCkpLnNvcnQoKGMsdSk9PmMtdSk7Zm9yKGxldCBjPTA7YzxhLmxlbmd0aC0xO2MrKyl7Y29uc3QgdT1hW2NdLGg9YVtjKzFdO2UucHVzaCh7b2Zmc2V0Ok1hdGguZmxvb3IodSksY291bnQ6TWF0aC5mbG9vcihoLXUpfSl9cmV0dXJuIGV9ZnVuY3Rpb24gVXUocix0KXtjb25zdCBlPURlKHIpLHM9bW8ocix0KS5zb3J0KChvLGEpPT5vLm9mZnNldC1hLm9mZnNldCksbj1zW3MubGVuZ3RoLTFdO24uY291bnQ9TWF0aC5taW4oZS1uLm9mZnNldCxuLmNvdW50KTtsZXQgaT0wO3JldHVybiBzLmZvckVhY2goKHtjb3VudDpvfSk9PmkrPW8pLGUhPT1pfWZ1bmN0aW9uIFRpKHIsdCxlLHMsbil7bGV0IGk9MS8wLG89MS8wLGE9MS8wLGM9LTEvMCx1PS0xLzAsaD0tMS8wLGw9MS8wLGQ9MS8wLGY9MS8wLHA9LTEvMCxtPS0xLzAsZz0tMS8wO2ZvcihsZXQgeT10KjYsVD0odCtlKSo2O3k8VDt5Kz02KXtjb25zdCB3PXJbeSswXSxNPXJbeSsxXSxOPXctTSxfPXcrTTtOPGkmJihpPU4pLF8+YyYmKGM9XyksdzxsJiYobD13KSx3PnAmJihwPXcpO2NvbnN0IFM9clt5KzJdLEU9clt5KzNdLEY9Uy1FLFI9UytFO0Y8byYmKG89RiksUj51JiYodT1SKSxTPGQmJihkPVMpLFM+bSYmKG09Uyk7Y29uc3QgST1yW3krNF0sQj1yW3krNV0sUD1JLUIsTD1JK0I7UDxhJiYoYT1QKSxMPmgmJihoPUwpLEk8ZiYmKGY9SSksST5nJiYoZz1JKX1zWzBdPWksc1sxXT1vLHNbMl09YSxzWzNdPWMsc1s0XT11LHNbNV09aCxuWzBdPWwsblsxXT1kLG5bMl09ZixuWzNdPXAsbls0XT1tLG5bNV09Z31mdW5jdGlvbiBrdShyLHQ9bnVsbCxlPW51bGwscz1udWxsKXtjb25zdCBuPXIuYXR0cmlidXRlcy5wb3NpdGlvbixpPXIuaW5kZXg/ci5pbmRleC5hcnJheTpudWxsLG89RGUociksYT1uLm5vcm1hbGl6ZWQ7bGV0IGM7dD09PW51bGw/KGM9bmV3IEZsb2F0MzJBcnJheShvKjYpLGU9MCxzPW8pOihjPXQsZT1lfHwwLHM9c3x8byk7Y29uc3QgdT1uLmFycmF5LGg9bi5vZmZzZXR8fDA7bGV0IGw9MztuLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUmJihsPW4uZGF0YS5zdHJpZGUpO2NvbnN0IGQ9WyJnZXRYIiwiZ2V0WSIsImdldFoiXTtmb3IobGV0IGY9ZTtmPGUrcztmKyspe2NvbnN0IHA9ZiozLG09Zio2O2xldCBnPXArMCx5PXArMSxUPXArMjtpJiYoZz1pW2ddLHk9aVt5XSxUPWlbVF0pLGF8fChnPWcqbCtoLHk9eSpsK2gsVD1UKmwraCk7Zm9yKGxldCB3PTA7dzwzO3crKyl7bGV0IE0sTixfO2E/KE09bltkW3ddXShnKSxOPW5bZFt3XV0oeSksXz1uW2Rbd11dKFQpKTooTT11W2crd10sTj11W3krd10sXz11W1Qrd10pO2xldCBTPU07TjxTJiYoUz1OKSxfPFMmJihTPV8pO2xldCBFPU07Tj5FJiYoRT1OKSxfPkUmJihFPV8pO2NvbnN0IEY9KEUtUykvMixSPXcqMjtjW20rUiswXT1TK0YsY1ttK1IrMV09RisoTWF0aC5hYnMoUykrRikqTHV9fXJldHVybiBjfWZ1bmN0aW9uIFoocix0LGUpe3JldHVybiBlLm1pbi54PXRbcl0sZS5taW4ueT10W3IrMV0sZS5taW4uej10W3IrMl0sZS5tYXgueD10W3IrM10sZS5tYXgueT10W3IrNF0sZS5tYXguej10W3IrNV0sZX1mdW5jdGlvbiB5byhyKXtsZXQgdD0tMSxlPS0xLzA7Zm9yKGxldCBzPTA7czwzO3MrKyl7Y29uc3Qgbj1yW3MrM10tcltzXTtuPmUmJihlPW4sdD1zKX1yZXR1cm4gdH1mdW5jdGlvbiBnbyhyLHQpe3Quc2V0KHIpfWZ1bmN0aW9uIHhvKHIsdCxlKXtsZXQgcyxuO2ZvcihsZXQgaT0wO2k8MztpKyspe2NvbnN0IG89aSszO3M9cltpXSxuPXRbaV0sZVtpXT1zPG4/czpuLHM9cltvXSxuPXRbb10sZVtvXT1zPm4/czpufX1mdW5jdGlvbiBzbihyLHQsZSl7Zm9yKGxldCBzPTA7czwzO3MrKyl7Y29uc3Qgbj10W3IrMipzXSxpPXRbcisyKnMrMV0sbz1uLWksYT1uK2k7bzxlW3NdJiYoZVtzXT1vKSxhPmVbcyszXSYmKGVbcyszXT1hKX19ZnVuY3Rpb24geXMocil7Y29uc3QgdD1yWzNdLXJbMF0sZT1yWzRdLXJbMV0scz1yWzVdLXJbMl07cmV0dXJuIDIqKHQqZStlKnMrcyp0KX1jb25zdCBqdD0zMixIdT0ocix0KT0+ci5jYW5kaWRhdGUtdC5jYW5kaWRhdGUsb2U9bmV3IEFycmF5KGp0KS5maWxsKCkubWFwKCgpPT4oe2NvdW50OjAsYm91bmRzOm5ldyBGbG9hdDMyQXJyYXkoNikscmlnaHRDYWNoZUJvdW5kczpuZXcgRmxvYXQzMkFycmF5KDYpLGxlZnRDYWNoZUJvdW5kczpuZXcgRmxvYXQzMkFycmF5KDYpLGNhbmRpZGF0ZTowfSkpLG5uPW5ldyBGbG9hdDMyQXJyYXkoNik7ZnVuY3Rpb24gcXUocix0LGUscyxuLGkpe2xldCBvPS0xLGE9MDtpZihpPT09dW8pbz15byh0KSxvIT09LTEmJihhPSh0W29dK3RbbyszXSkvMik7ZWxzZSBpZihpPT09dnUpbz15byhyKSxvIT09LTEmJihhPSR1KGUscyxuLG8pKTtlbHNlIGlmKGk9PT1QdSl7Y29uc3QgYz15cyhyKTtsZXQgdT1naSpuO2NvbnN0IGg9cyo2LGw9KHMrbikqNjtmb3IobGV0IGQ9MDtkPDM7ZCsrKXtjb25zdCBmPXRbZF0sZz0odFtkKzNdLWYpL2p0O2lmKG48anQvNCl7Y29uc3QgeT1bLi4ub2VdO3kubGVuZ3RoPW47bGV0IFQ9MDtmb3IobGV0IE09aDtNPGw7TSs9NixUKyspe2NvbnN0IE49eVtUXTtOLmNhbmRpZGF0ZT1lW00rMipkXSxOLmNvdW50PTA7Y29uc3R7Ym91bmRzOl8sbGVmdENhY2hlQm91bmRzOlMscmlnaHRDYWNoZUJvdW5kczpFfT1OO2ZvcihsZXQgRj0wO0Y8MztGKyspRVtGXT0xLzAsRVtGKzNdPS0xLzAsU1tGXT0xLzAsU1tGKzNdPS0xLzAsX1tGXT0xLzAsX1tGKzNdPS0xLzA7c24oTSxlLF8pfXkuc29ydChIdSk7bGV0IHc9bjtmb3IobGV0IE09MDtNPHc7TSsrKXtjb25zdCBOPXlbTV07Zm9yKDtNKzE8dyYmeVtNKzFdLmNhbmRpZGF0ZT09PU4uY2FuZGlkYXRlOyl5LnNwbGljZShNKzEsMSksdy0tfWZvcihsZXQgTT1oO008bDtNKz02KXtjb25zdCBOPWVbTSsyKmRdO2ZvcihsZXQgXz0wO188dztfKyspe2NvbnN0IFM9eVtfXTtOPj1TLmNhbmRpZGF0ZT9zbihNLGUsUy5yaWdodENhY2hlQm91bmRzKTooc24oTSxlLFMubGVmdENhY2hlQm91bmRzKSxTLmNvdW50KyspfX1mb3IobGV0IE09MDtNPHc7TSsrKXtjb25zdCBOPXlbTV0sXz1OLmNvdW50LFM9bi1OLmNvdW50LEU9Ti5sZWZ0Q2FjaGVCb3VuZHMsRj1OLnJpZ2h0Q2FjaGVCb3VuZHM7bGV0IFI9MDtfIT09MCYmKFI9eXMoRSkvYyk7bGV0IEk9MDtTIT09MCYmKEk9eXMoRikvYyk7Y29uc3QgQj1mbytnaSooUipfK0kqUyk7Qjx1JiYobz1kLHU9QixhPU4uY2FuZGlkYXRlKX19ZWxzZXtmb3IobGV0IHc9MDt3PGp0O3crKyl7Y29uc3QgTT1vZVt3XTtNLmNvdW50PTAsTS5jYW5kaWRhdGU9ZitnK3cqZztjb25zdCBOPU0uYm91bmRzO2ZvcihsZXQgXz0wO188MztfKyspTltfXT0xLzAsTltfKzNdPS0xLzB9Zm9yKGxldCB3PWg7dzxsO3crPTYpe2xldCBfPX5+KChlW3crMipkXS1mKS9nKTtfPj1qdCYmKF89anQtMSk7Y29uc3QgUz1vZVtfXTtTLmNvdW50Kyssc24odyxlLFMuYm91bmRzKX1jb25zdCB5PW9lW2p0LTFdO2dvKHkuYm91bmRzLHkucmlnaHRDYWNoZUJvdW5kcyk7Zm9yKGxldCB3PWp0LTI7dz49MDt3LS0pe2NvbnN0IE09b2Vbd10sTj1vZVt3KzFdO3hvKE0uYm91bmRzLE4ucmlnaHRDYWNoZUJvdW5kcyxNLnJpZ2h0Q2FjaGVCb3VuZHMpfWxldCBUPTA7Zm9yKGxldCB3PTA7dzxqdC0xO3crKyl7Y29uc3QgTT1vZVt3XSxOPU0uY291bnQsXz1NLmJvdW5kcyxFPW9lW3crMV0ucmlnaHRDYWNoZUJvdW5kcztOIT09MCYmKFQ9PT0wP2dvKF8sbm4pOnhvKF8sbm4sbm4pKSxUKz1OO2xldCBGPTAsUj0wO1QhPT0wJiYoRj15cyhubikvYyk7Y29uc3QgST1uLVQ7SSE9PTAmJihSPXlzKEUpL2MpO2NvbnN0IEI9Zm8rZ2kqKEYqVCtSKkkpO0I8dSYmKG89ZCx1PUIsYT1NLmNhbmRpZGF0ZSl9fX19ZWxzZSBjb25zb2xlLndhcm4oYE1lc2hCVkg6IEludmFsaWQgYnVpbGQgc3RyYXRlZ3kgdmFsdWUgJHtpfSB1c2VkLmApO3JldHVybntheGlzOm8scG9zOmF9fWZ1bmN0aW9uICR1KHIsdCxlLHMpe2xldCBuPTA7Zm9yKGxldCBpPXQsbz10K2U7aTxvO2krKyluKz1yW2kqNitzKjJdO3JldHVybiBuL2V9Y2xhc3MgTml7Y29uc3RydWN0b3IoKXt0aGlzLmJvdW5kaW5nRGF0YT1uZXcgRmxvYXQzMkFycmF5KDYpfX1mdW5jdGlvbiBHdShyLHQsZSxzLG4saSl7bGV0IG89cyxhPXMrbi0xO2NvbnN0IGM9aS5wb3MsdT1pLmF4aXMqMjtmb3IoOzspe2Zvcig7bzw9YSYmZVtvKjYrdV08YzspbysrO2Zvcig7bzw9YSYmZVthKjYrdV0+PWM7KWEtLTtpZihvPGEpe2ZvcihsZXQgaD0wO2g8MztoKyspe2xldCBsPXRbbyozK2hdO3RbbyozK2hdPXRbYSozK2hdLHRbYSozK2hdPWx9Zm9yKGxldCBoPTA7aDw2O2grKyl7bGV0IGw9ZVtvKjYraF07ZVtvKjYraF09ZVthKjYraF0sZVthKjYraF09bH1vKyssYS0tfWVsc2UgcmV0dXJuIG99fWZ1bmN0aW9uIFd1KHIsdCxlLHMsbixpKXtsZXQgbz1zLGE9cytuLTE7Y29uc3QgYz1pLnBvcyx1PWkuYXhpcyoyO2Zvcig7Oyl7Zm9yKDtvPD1hJiZlW28qNit1XTxjOylvKys7Zm9yKDtvPD1hJiZlW2EqNit1XT49YzspYS0tO2lmKG88YSl7bGV0IGg9cltvXTtyW29dPXJbYV0sclthXT1oO2ZvcihsZXQgbD0wO2w8NjtsKyspe2xldCBkPWVbbyo2K2xdO2Vbbyo2K2xdPWVbYSo2K2xdLGVbYSo2K2xdPWR9bysrLGEtLX1lbHNlIHJldHVybiBvfX1mdW5jdGlvbiBwdChyLHQpe3JldHVybiB0W3IrMTVdPT09NjU1MzV9ZnVuY3Rpb24gVHQocix0KXtyZXR1cm4gdFtyKzZdfWZ1bmN0aW9uIFN0KHIsdCl7cmV0dXJuIHRbcisxNF19ZnVuY3Rpb24gX3Qocil7cmV0dXJuIHIrOH1mdW5jdGlvbiB6dChyLHQpe3JldHVybiB0W3IrNl19ZnVuY3Rpb24gVG8ocix0KXtyZXR1cm4gdFtyKzddfWZ1bmN0aW9uIGpsKHIpe3JldHVybiByfWxldCBObyxncyxybix3bztjb25zdCBYdT1NYXRoLnBvdygyLDMyKTtmdW5jdGlvbiB3aShyKXtyZXR1cm4iY291bnQiaW4gcj8xOjErd2koci5sZWZ0KSt3aShyLnJpZ2h0KX1mdW5jdGlvbiBZdShyLHQsZSl7cmV0dXJuIE5vPW5ldyBGbG9hdDMyQXJyYXkoZSksZ3M9bmV3IFVpbnQzMkFycmF5KGUpLHJuPW5ldyBVaW50MTZBcnJheShlKSx3bz1uZXcgVWludDhBcnJheShlKSxBaShyLHQpfWZ1bmN0aW9uIEFpKHIsdCl7Y29uc3QgZT1yLzQscz1yLzIsbj0iY291bnQiaW4gdCxpPXQuYm91bmRpbmdEYXRhO2ZvcihsZXQgbz0wO288NjtvKyspTm9bZStvXT1pW29dO2lmKG4paWYodC5idWZmZXIpe2NvbnN0IG89dC5idWZmZXI7d28uc2V0KG5ldyBVaW50OEFycmF5KG8pLHIpO2ZvcihsZXQgYT1yLGM9citvLmJ5dGVMZW5ndGg7YTxjO2ErPW1zKXtjb25zdCB1PWEvMjtwdCh1LHJuKXx8KGdzW2EvNCs2XSs9ZSl9cmV0dXJuIHIrby5ieXRlTGVuZ3RofWVsc2V7Y29uc3Qgbz10Lm9mZnNldCxhPXQuY291bnQ7cmV0dXJuIGdzW2UrNl09byxybltzKzE0XT1hLHJuW3MrMTVdPWVuLHIrbXN9ZWxzZXtjb25zdCBvPXQubGVmdCxhPXQucmlnaHQsYz10LnNwbGl0QXhpcztsZXQgdTtpZih1PUFpKHIrbXMsbyksdS80Plh1KXRocm93IG5ldyBFcnJvcigiTWVzaEJWSDogQ2Fubm90IHN0b3JlIGNoaWxkIHBvaW50ZXIgZ3JlYXRlciB0aGFuIDMyIGJpdHMuIik7cmV0dXJuIGdzW2UrNl09dS80LHU9QWkodSxhKSxnc1tlKzddPWMsdX19ZnVuY3Rpb24gWnUocix0KXtjb25zdCBlPShyLmluZGV4P3IuaW5kZXguY291bnQ6ci5hdHRyaWJ1dGVzLnBvc2l0aW9uLmNvdW50KS8zLHM9ZT4yKioxNixuPXM/NDoyLGk9dD9uZXcgU2hhcmVkQXJyYXlCdWZmZXIoZSpuKTpuZXcgQXJyYXlCdWZmZXIoZSpuKSxvPXM/bmV3IFVpbnQzMkFycmF5KGkpOm5ldyBVaW50MTZBcnJheShpKTtmb3IobGV0IGE9MCxjPW8ubGVuZ3RoO2E8YzthKyspb1thXT1hO3JldHVybiBvfWZ1bmN0aW9uIEp1KHIsdCxlLHMsbil7Y29uc3R7bWF4RGVwdGg6aSx2ZXJib3NlOm8sbWF4TGVhZlRyaXM6YSxzdHJhdGVneTpjLG9uUHJvZ3Jlc3M6dSxpbmRpcmVjdDpofT1uLGw9ci5faW5kaXJlY3RCdWZmZXIsZD1yLmdlb21ldHJ5LGY9ZC5pbmRleD9kLmluZGV4LmFycmF5Om51bGwscD1oP1d1Okd1LG09RGUoZCksZz1uZXcgRmxvYXQzMkFycmF5KDYpO2xldCB5PSExO2NvbnN0IFQ9bmV3IE5pO3JldHVybiBUaSh0LGUscyxULmJvdW5kaW5nRGF0YSxnKSxNKFQsZSxzLGcpLFQ7ZnVuY3Rpb24gdyhOKXt1JiZ1KE4vbSl9ZnVuY3Rpb24gTShOLF8sUyxFPW51bGwsRj0wKXtpZigheSYmRj49aSYmKHk9ITAsbyYmKGNvbnNvbGUud2FybihgTWVzaEJWSDogTWF4IGRlcHRoIG9mICR7aX0gcmVhY2hlZCB3aGVuIGdlbmVyYXRpbmcgQlZILiBDb25zaWRlciBpbmNyZWFzaW5nIG1heERlcHRoLmApLGNvbnNvbGUud2FybihkKSkpLFM8PWF8fEY+PWkpcmV0dXJuIHcoXytTKSxOLm9mZnNldD1fLE4uY291bnQ9UyxOO2NvbnN0IFI9cXUoTi5ib3VuZGluZ0RhdGEsRSx0LF8sUyxjKTtpZihSLmF4aXM9PT0tMSlyZXR1cm4gdyhfK1MpLE4ub2Zmc2V0PV8sTi5jb3VudD1TLE47Y29uc3QgST1wKGwsZix0LF8sUyxSKTtpZihJPT09X3x8ST09PV8rUyl3KF8rUyksTi5vZmZzZXQ9XyxOLmNvdW50PVM7ZWxzZXtOLnNwbGl0QXhpcz1SLmF4aXM7Y29uc3QgQj1uZXcgTmksUD1fLEw9SS1fO04ubGVmdD1CLFRpKHQsUCxMLEIuYm91bmRpbmdEYXRhLGcpLE0oQixQLEwsZyxGKzEpO2NvbnN0IFY9bmV3IE5pLEc9SSxOdD1TLUw7Ti5yaWdodD1WLFRpKHQsRyxOdCxWLmJvdW5kaW5nRGF0YSxnKSxNKFYsRyxOdCxnLEYrMSl9cmV0dXJuIE59fWZ1bmN0aW9uIGp1KHIsdCl7Y29uc3QgZT1yLmdlb21ldHJ5O3QuaW5kaXJlY3QmJihyLl9pbmRpcmVjdEJ1ZmZlcj1adShlLHQudXNlU2hhcmVkQXJyYXlCdWZmZXIpLFV1KGUsdC5yYW5nZSkmJiF0LnZlcmJvc2UmJmNvbnNvbGUud2FybignTWVzaEJWSDogUHJvdmlkZWQgZ2VvbWV0cnkgY29udGFpbnMgZ3JvdXBzIG9yIGEgcmFuZ2UgdGhhdCBkbyBub3QgZnVsbHkgc3BhbiB0aGUgdmVydGV4IGNvbnRlbnRzIHdoaWxlIHVzaW5nIHRoZSAiaW5kaXJlY3QiIG9wdGlvbi4gQlZIIG1heSBpbmNvcnJlY3RseSByZXBvcnQgaW50ZXJzZWN0aW9ucyBvbiB1bnJlbmRlcmVkIHBvcnRpb25zIG9mIHRoZSBnZW9tZXRyeS4nKSksci5faW5kaXJlY3RCdWZmZXJ8fFZ1KGUsdCk7Y29uc3Qgcz10LnVzZVNoYXJlZEFycmF5QnVmZmVyP1NoYXJlZEFycmF5QnVmZmVyOkFycmF5QnVmZmVyLG49a3UoZSksaT10LmluZGlyZWN0P3BvKGUsdC5yYW5nZSk6bW8oZSx0LnJhbmdlKTtyLl9yb290cz1pLm1hcChvPT57Y29uc3QgYT1KdShyLG4sby5vZmZzZXQsby5jb3VudCx0KSxjPXdpKGEpLHU9bmV3IHMobXMqYyk7cmV0dXJuIFl1KDAsYSx1KSx1fSl9Y2xhc3MgUXR7Y29uc3RydWN0b3IoKXt0aGlzLm1pbj0xLzAsdGhpcy5tYXg9LTEvMH1zZXRGcm9tUG9pbnRzRmllbGQodCxlKXtsZXQgcz0xLzAsbj0tMS8wO2ZvcihsZXQgaT0wLG89dC5sZW5ndGg7aTxvO2krKyl7Y29uc3QgYz10W2ldW2VdO3M9YzxzP2M6cyxuPWM+bj9jOm59dGhpcy5taW49cyx0aGlzLm1heD1ufXNldEZyb21Qb2ludHModCxlKXtsZXQgcz0xLzAsbj0tMS8wO2ZvcihsZXQgaT0wLG89ZS5sZW5ndGg7aTxvO2krKyl7Y29uc3QgYT1lW2ldLGM9dC5kb3QoYSk7cz1jPHM/YzpzLG49Yz5uP2M6bn10aGlzLm1pbj1zLHRoaXMubWF4PW59aXNTZXBhcmF0ZWQodCl7cmV0dXJuIHRoaXMubWluPnQubWF4fHx0Lm1pbj50aGlzLm1heH19UXQucHJvdG90eXBlLnNldEZyb21Cb3g9ZnVuY3Rpb24oKXtjb25zdCByPW5ldyBBO3JldHVybiBmdW5jdGlvbihlLHMpe2NvbnN0IG49cy5taW4saT1zLm1heDtsZXQgbz0xLzAsYT0tMS8wO2ZvcihsZXQgYz0wO2M8PTE7YysrKWZvcihsZXQgdT0wO3U8PTE7dSsrKWZvcihsZXQgaD0wO2g8PTE7aCsrKXtyLng9bi54KmMraS54KigxLWMpLHIueT1uLnkqdStpLnkqKDEtdSksci56PW4ueipoK2kueiooMS1oKTtjb25zdCBsPWUuZG90KHIpO289TWF0aC5taW4obCxvKSxhPU1hdGgubWF4KGwsYSl9dGhpcy5taW49byx0aGlzLm1heD1hfX0oKTtjb25zdCBRdT1mdW5jdGlvbigpe2NvbnN0IHI9bmV3IEEsdD1uZXcgQSxlPW5ldyBBO3JldHVybiBmdW5jdGlvbihuLGksbyl7Y29uc3QgYT1uLnN0YXJ0LGM9cix1PWkuc3RhcnQsaD10O2Uuc3ViVmVjdG9ycyhhLHUpLHIuc3ViVmVjdG9ycyhuLmVuZCxuLnN0YXJ0KSx0LnN1YlZlY3RvcnMoaS5lbmQsaS5zdGFydCk7Y29uc3QgbD1lLmRvdChoKSxkPWguZG90KGMpLGY9aC5kb3QoaCkscD1lLmRvdChjKSxnPWMuZG90KGMpKmYtZCpkO2xldCB5LFQ7ZyE9PTA/eT0obCpkLXAqZikvZzp5PTAsVD0obCt5KmQpL2Ysby54PXksby55PVR9fSgpLE1pPWZ1bmN0aW9uKCl7Y29uc3Qgcj1uZXcgSix0PW5ldyBBLGU9bmV3IEE7cmV0dXJuIGZ1bmN0aW9uKG4saSxvLGEpe1F1KG4saSxyKTtsZXQgYz1yLngsdT1yLnk7aWYoYz49MCYmYzw9MSYmdT49MCYmdTw9MSl7bi5hdChjLG8pLGkuYXQodSxhKTtyZXR1cm59ZWxzZSBpZihjPj0wJiZjPD0xKXt1PDA/aS5hdCgwLGEpOmkuYXQoMSxhKSxuLmNsb3Nlc3RQb2ludFRvUG9pbnQoYSwhMCxvKTtyZXR1cm59ZWxzZSBpZih1Pj0wJiZ1PD0xKXtjPDA/bi5hdCgwLG8pOm4uYXQoMSxvKSxpLmNsb3Nlc3RQb2ludFRvUG9pbnQobywhMCxhKTtyZXR1cm59ZWxzZXtsZXQgaDtjPDA/aD1uLnN0YXJ0Omg9bi5lbmQ7bGV0IGw7dTwwP2w9aS5zdGFydDpsPWkuZW5kO2NvbnN0IGQ9dCxmPWU7aWYobi5jbG9zZXN0UG9pbnRUb1BvaW50KGwsITAsdCksaS5jbG9zZXN0UG9pbnRUb1BvaW50KGgsITAsZSksZC5kaXN0YW5jZVRvU3F1YXJlZChsKTw9Zi5kaXN0YW5jZVRvU3F1YXJlZChoKSl7by5jb3B5KGQpLGEuY29weShsKTtyZXR1cm59ZWxzZXtvLmNvcHkoaCksYS5jb3B5KGYpO3JldHVybn19fX0oKSxLdT1mdW5jdGlvbigpe2NvbnN0IHI9bmV3IEEsdD1uZXcgQSxlPW5ldyBYbixzPW5ldyBadDtyZXR1cm4gZnVuY3Rpb24oaSxvKXtjb25zdHtyYWRpdXM6YSxjZW50ZXI6Y309aSx7YTp1LGI6aCxjOmx9PW87aWYocy5zdGFydD11LHMuZW5kPWgscy5jbG9zZXN0UG9pbnRUb1BvaW50KGMsITAscikuZGlzdGFuY2VUbyhjKTw9YXx8KHMuc3RhcnQ9dSxzLmVuZD1sLHMuY2xvc2VzdFBvaW50VG9Qb2ludChjLCEwLHIpLmRpc3RhbmNlVG8oYyk8PWEpfHwocy5zdGFydD1oLHMuZW5kPWwscy5jbG9zZXN0UG9pbnRUb1BvaW50KGMsITAscikuZGlzdGFuY2VUbyhjKTw9YSkpcmV0dXJuITA7Y29uc3QgbT1vLmdldFBsYW5lKGUpO2lmKE1hdGguYWJzKG0uZGlzdGFuY2VUb1BvaW50KGMpKTw9YSl7Y29uc3QgeT1tLnByb2plY3RQb2ludChjLHQpO2lmKG8uY29udGFpbnNQb2ludCh5KSlyZXR1cm4hMH1yZXR1cm4hMX19KCksdGw9MWUtMTU7ZnVuY3Rpb24gU2kocil7cmV0dXJuIE1hdGguYWJzKHIpPHRsfWNsYXNzIEx0IGV4dGVuZHMgd3R7Y29uc3RydWN0b3IoLi4udCl7c3VwZXIoLi4udCksdGhpcy5pc0V4dGVuZGVkVHJpYW5nbGU9ITAsdGhpcy5zYXRBeGVzPW5ldyBBcnJheSg0KS5maWxsKCkubWFwKCgpPT5uZXcgQSksdGhpcy5zYXRCb3VuZHM9bmV3IEFycmF5KDQpLmZpbGwoKS5tYXAoKCk9Pm5ldyBRdCksdGhpcy5wb2ludHM9W3RoaXMuYSx0aGlzLmIsdGhpcy5jXSx0aGlzLnNwaGVyZT1uZXcgY3IsdGhpcy5wbGFuZT1uZXcgWG4sdGhpcy5uZWVkc1VwZGF0ZT0hMH1pbnRlcnNlY3RzU3BoZXJlKHQpe3JldHVybiBLdSh0LHRoaXMpfXVwZGF0ZSgpe2NvbnN0IHQ9dGhpcy5hLGU9dGhpcy5iLHM9dGhpcy5jLG49dGhpcy5wb2ludHMsaT10aGlzLnNhdEF4ZXMsbz10aGlzLnNhdEJvdW5kcyxhPWlbMF0sYz1vWzBdO3RoaXMuZ2V0Tm9ybWFsKGEpLGMuc2V0RnJvbVBvaW50cyhhLG4pO2NvbnN0IHU9aVsxXSxoPW9bMV07dS5zdWJWZWN0b3JzKHQsZSksaC5zZXRGcm9tUG9pbnRzKHUsbik7Y29uc3QgbD1pWzJdLGQ9b1syXTtsLnN1YlZlY3RvcnMoZSxzKSxkLnNldEZyb21Qb2ludHMobCxuKTtjb25zdCBmPWlbM10scD1vWzNdO2Yuc3ViVmVjdG9ycyhzLHQpLHAuc2V0RnJvbVBvaW50cyhmLG4pLHRoaXMuc3BoZXJlLnNldEZyb21Qb2ludHModGhpcy5wb2ludHMpLHRoaXMucGxhbmUuc2V0RnJvbU5vcm1hbEFuZENvcGxhbmFyUG9pbnQoYSx0KSx0aGlzLm5lZWRzVXBkYXRlPSExfX1MdC5wcm90b3R5cGUuY2xvc2VzdFBvaW50VG9TZWdtZW50PWZ1bmN0aW9uKCl7Y29uc3Qgcj1uZXcgQSx0PW5ldyBBLGU9bmV3IFp0O3JldHVybiBmdW5jdGlvbihuLGk9bnVsbCxvPW51bGwpe2NvbnN0e3N0YXJ0OmEsZW5kOmN9PW4sdT10aGlzLnBvaW50cztsZXQgaCxsPTEvMDtmb3IobGV0IGQ9MDtkPDM7ZCsrKXtjb25zdCBmPShkKzEpJTM7ZS5zdGFydC5jb3B5KHVbZF0pLGUuZW5kLmNvcHkodVtmXSksTWkoZSxuLHIsdCksaD1yLmRpc3RhbmNlVG9TcXVhcmVkKHQpLGg8bCYmKGw9aCxpJiZpLmNvcHkociksbyYmby5jb3B5KHQpKX1yZXR1cm4gdGhpcy5jbG9zZXN0UG9pbnRUb1BvaW50KGEsciksaD1hLmRpc3RhbmNlVG9TcXVhcmVkKHIpLGg8bCYmKGw9aCxpJiZpLmNvcHkociksbyYmby5jb3B5KGEpKSx0aGlzLmNsb3Nlc3RQb2ludFRvUG9pbnQoYyxyKSxoPWMuZGlzdGFuY2VUb1NxdWFyZWQociksaDxsJiYobD1oLGkmJmkuY29weShyKSxvJiZvLmNvcHkoYykpLE1hdGguc3FydChsKX19KCksTHQucHJvdG90eXBlLmludGVyc2VjdHNUcmlhbmdsZT1mdW5jdGlvbigpe2NvbnN0IHI9bmV3IEx0LHQ9bmV3IEFycmF5KDMpLGU9bmV3IEFycmF5KDMpLHM9bmV3IFF0LG49bmV3IFF0LGk9bmV3IEEsbz1uZXcgQSxhPW5ldyBBLGM9bmV3IEEsdT1uZXcgQSxoPW5ldyBadCxsPW5ldyBadCxkPW5ldyBadCxmPW5ldyBBO2Z1bmN0aW9uIHAobSxnLHkpe2NvbnN0IFQ9bS5wb2ludHM7bGV0IHc9MCxNPS0xO2ZvcihsZXQgTj0wO048MztOKyspe2NvbnN0e3N0YXJ0Ol8sZW5kOlN9PWg7Xy5jb3B5KFRbTl0pLFMuY29weShUWyhOKzEpJTNdKSxoLmRlbHRhKG8pO2NvbnN0IEU9U2koZy5kaXN0YW5jZVRvUG9pbnQoXykpO2lmKFNpKGcubm9ybWFsLmRvdChvKSkmJkUpe3kuY29weShoKSx3PTI7YnJlYWt9Y29uc3QgRj1nLmludGVyc2VjdExpbmUoaCxmKTtpZighRiYmRSYmZi5jb3B5KF8pLChGfHxFKSYmIVNpKGYuZGlzdGFuY2VUbyhTKSkpe2lmKHc8PTEpKHc9PT0xP3kuc3RhcnQ6eS5lbmQpLmNvcHkoZiksRSYmKE09dyk7ZWxzZSBpZih3Pj0yKXsoTT09PTE/eS5zdGFydDp5LmVuZCkuY29weShmKSx3PTI7YnJlYWt9aWYodysrLHc9PT0yJiZNPT09LTEpYnJlYWt9fXJldHVybiB3fXJldHVybiBmdW5jdGlvbihnLHk9bnVsbCxUPSExKXt0aGlzLm5lZWRzVXBkYXRlJiZ0aGlzLnVwZGF0ZSgpLGcuaXNFeHRlbmRlZFRyaWFuZ2xlP2cubmVlZHNVcGRhdGUmJmcudXBkYXRlKCk6KHIuY29weShnKSxyLnVwZGF0ZSgpLGc9cik7Y29uc3Qgdz10aGlzLnBsYW5lLE09Zy5wbGFuZTtpZihNYXRoLmFicyh3Lm5vcm1hbC5kb3QoTS5ub3JtYWwpKT4xLTFlLTEwKXtjb25zdCBOPXRoaXMuc2F0Qm91bmRzLF89dGhpcy5zYXRBeGVzO2VbMF09Zy5hLGVbMV09Zy5iLGVbMl09Zy5jO2ZvcihsZXQgRj0wO0Y8NDtGKyspe2NvbnN0IFI9TltGXSxJPV9bRl07aWYocy5zZXRGcm9tUG9pbnRzKEksZSksUi5pc1NlcGFyYXRlZChzKSlyZXR1cm4hMX1jb25zdCBTPWcuc2F0Qm91bmRzLEU9Zy5zYXRBeGVzO3RbMF09dGhpcy5hLHRbMV09dGhpcy5iLHRbMl09dGhpcy5jO2ZvcihsZXQgRj0wO0Y8NDtGKyspe2NvbnN0IFI9U1tGXSxJPUVbRl07aWYocy5zZXRGcm9tUG9pbnRzKEksdCksUi5pc1NlcGFyYXRlZChzKSlyZXR1cm4hMX1mb3IobGV0IEY9MDtGPDQ7RisrKXtjb25zdCBSPV9bRl07Zm9yKGxldCBJPTA7STw0O0krKyl7Y29uc3QgQj1FW0ldO2lmKGkuY3Jvc3NWZWN0b3JzKFIsQikscy5zZXRGcm9tUG9pbnRzKGksdCksbi5zZXRGcm9tUG9pbnRzKGksZSkscy5pc1NlcGFyYXRlZChuKSlyZXR1cm4hMX19cmV0dXJuIHkmJihUfHxjb25zb2xlLndhcm4oIkV4dGVuZGVkVHJpYW5nbGUuaW50ZXJzZWN0c1RyaWFuZ2xlOiBUcmlhbmdsZXMgYXJlIGNvcGxhbmFyIHdoaWNoIGRvZXMgbm90IHN1cHBvcnQgYW4gb3V0cHV0IGVkZ2UuIFNldHRpbmcgZWRnZSB0byAwLCAwLCAwLiIpLHkuc3RhcnQuc2V0KDAsMCwwKSx5LmVuZC5zZXQoMCwwLDApKSwhMH1lbHNle2NvbnN0IE49cCh0aGlzLE0sbCk7aWYoTj09PTEmJmcuY29udGFpbnNQb2ludChsLmVuZCkpcmV0dXJuIHkmJih5LnN0YXJ0LmNvcHkobC5lbmQpLHkuZW5kLmNvcHkobC5lbmQpKSwhMDtpZihOIT09MilyZXR1cm4hMTtjb25zdCBfPXAoZyx3LGQpO2lmKF89PT0xJiZ0aGlzLmNvbnRhaW5zUG9pbnQoZC5lbmQpKXJldHVybiB5JiYoeS5zdGFydC5jb3B5KGQuZW5kKSx5LmVuZC5jb3B5KGQuZW5kKSksITA7aWYoXyE9PTIpcmV0dXJuITE7aWYobC5kZWx0YShhKSxkLmRlbHRhKGMpLGEuZG90KGMpPDApe2xldCBQPWQuc3RhcnQ7ZC5zdGFydD1kLmVuZCxkLmVuZD1QfWNvbnN0IFM9bC5zdGFydC5kb3QoYSksRT1sLmVuZC5kb3QoYSksRj1kLnN0YXJ0LmRvdChhKSxSPWQuZW5kLmRvdChhKSxJPUU8RixCPVM8UjtyZXR1cm4gUyE9PVImJkYhPT1FJiZJPT09Qj8hMTooeSYmKHUuc3ViVmVjdG9ycyhsLnN0YXJ0LGQuc3RhcnQpLHUuZG90KGEpPjA/eS5zdGFydC5jb3B5KGwuc3RhcnQpOnkuc3RhcnQuY29weShkLnN0YXJ0KSx1LnN1YlZlY3RvcnMobC5lbmQsZC5lbmQpLHUuZG90KGEpPDA/eS5lbmQuY29weShsLmVuZCk6eS5lbmQuY29weShkLmVuZCkpLCEwKX19fSgpLEx0LnByb3RvdHlwZS5kaXN0YW5jZVRvUG9pbnQ9ZnVuY3Rpb24oKXtjb25zdCByPW5ldyBBO3JldHVybiBmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5jbG9zZXN0UG9pbnRUb1BvaW50KGUsciksZS5kaXN0YW5jZVRvKHIpfX0oKSxMdC5wcm90b3R5cGUuZGlzdGFuY2VUb1RyaWFuZ2xlPWZ1bmN0aW9uKCl7Y29uc3Qgcj1uZXcgQSx0PW5ldyBBLGU9WyJhIiwiYiIsImMiXSxzPW5ldyBadCxuPW5ldyBadDtyZXR1cm4gZnVuY3Rpb24obyxhPW51bGwsYz1udWxsKXtjb25zdCB1PWF8fGM/czpudWxsO2lmKHRoaXMuaW50ZXJzZWN0c1RyaWFuZ2xlKG8sdSkpcmV0dXJuKGF8fGMpJiYoYSYmdS5nZXRDZW50ZXIoYSksYyYmdS5nZXRDZW50ZXIoYykpLDA7bGV0IGg9MS8wO2ZvcihsZXQgbD0wO2w8MztsKyspe2xldCBkO2NvbnN0IGY9ZVtsXSxwPW9bZl07dGhpcy5jbG9zZXN0UG9pbnRUb1BvaW50KHAsciksZD1wLmRpc3RhbmNlVG9TcXVhcmVkKHIpLGQ8aCYmKGg9ZCxhJiZhLmNvcHkociksYyYmYy5jb3B5KHApKTtjb25zdCBtPXRoaXNbZl07by5jbG9zZXN0UG9pbnRUb1BvaW50KG0sciksZD1tLmRpc3RhbmNlVG9TcXVhcmVkKHIpLGQ8aCYmKGg9ZCxhJiZhLmNvcHkobSksYyYmYy5jb3B5KHIpKX1mb3IobGV0IGw9MDtsPDM7bCsrKXtjb25zdCBkPWVbbF0sZj1lWyhsKzEpJTNdO3Muc2V0KHRoaXNbZF0sdGhpc1tmXSk7Zm9yKGxldCBwPTA7cDwzO3ArKyl7Y29uc3QgbT1lW3BdLGc9ZVsocCsxKSUzXTtuLnNldChvW21dLG9bZ10pLE1pKHMsbixyLHQpO2NvbnN0IHk9ci5kaXN0YW5jZVRvU3F1YXJlZCh0KTt5PGgmJihoPXksYSYmYS5jb3B5KHIpLGMmJmMuY29weSh0KSl9fXJldHVybiBNYXRoLnNxcnQoaCl9fSgpO2NsYXNzIGx0e2NvbnN0cnVjdG9yKHQsZSxzKXt0aGlzLmlzT3JpZW50ZWRCb3g9ITAsdGhpcy5taW49bmV3IEEsdGhpcy5tYXg9bmV3IEEsdGhpcy5tYXRyaXg9bmV3IG50LHRoaXMuaW52TWF0cml4PW5ldyBudCx0aGlzLnBvaW50cz1uZXcgQXJyYXkoOCkuZmlsbCgpLm1hcCgoKT0+bmV3IEEpLHRoaXMuc2F0QXhlcz1uZXcgQXJyYXkoMykuZmlsbCgpLm1hcCgoKT0+bmV3IEEpLHRoaXMuc2F0Qm91bmRzPW5ldyBBcnJheSgzKS5maWxsKCkubWFwKCgpPT5uZXcgUXQpLHRoaXMuYWxpZ25lZFNhdEJvdW5kcz1uZXcgQXJyYXkoMykuZmlsbCgpLm1hcCgoKT0+bmV3IFF0KSx0aGlzLm5lZWRzVXBkYXRlPSExLHQmJnRoaXMubWluLmNvcHkodCksZSYmdGhpcy5tYXguY29weShlKSxzJiZ0aGlzLm1hdHJpeC5jb3B5KHMpfXNldCh0LGUscyl7dGhpcy5taW4uY29weSh0KSx0aGlzLm1heC5jb3B5KGUpLHRoaXMubWF0cml4LmNvcHkocyksdGhpcy5uZWVkc1VwZGF0ZT0hMH1jb3B5KHQpe3RoaXMubWluLmNvcHkodC5taW4pLHRoaXMubWF4LmNvcHkodC5tYXgpLHRoaXMubWF0cml4LmNvcHkodC5tYXRyaXgpLHRoaXMubmVlZHNVcGRhdGU9ITB9fWx0LnByb3RvdHlwZS51cGRhdGU9ZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24oKXtjb25zdCB0PXRoaXMubWF0cml4LGU9dGhpcy5taW4scz10aGlzLm1heCxuPXRoaXMucG9pbnRzO2ZvcihsZXQgdT0wO3U8PTE7dSsrKWZvcihsZXQgaD0wO2g8PTE7aCsrKWZvcihsZXQgbD0wO2w8PTE7bCsrKXtjb25zdCBkPTEqdXwyKmh8NCpsLGY9bltkXTtmLng9dT9zLng6ZS54LGYueT1oP3MueTplLnksZi56PWw/cy56OmUueixmLmFwcGx5TWF0cml4NCh0KX1jb25zdCBpPXRoaXMuc2F0Qm91bmRzLG89dGhpcy5zYXRBeGVzLGE9blswXTtmb3IobGV0IHU9MDt1PDM7dSsrKXtjb25zdCBoPW9bdV0sbD1pW3VdLGQ9MTw8dSxmPW5bZF07aC5zdWJWZWN0b3JzKGEsZiksbC5zZXRGcm9tUG9pbnRzKGgsbil9Y29uc3QgYz10aGlzLmFsaWduZWRTYXRCb3VuZHM7Y1swXS5zZXRGcm9tUG9pbnRzRmllbGQobiwieCIpLGNbMV0uc2V0RnJvbVBvaW50c0ZpZWxkKG4sInkiKSxjWzJdLnNldEZyb21Qb2ludHNGaWVsZChuLCJ6IiksdGhpcy5pbnZNYXRyaXguY29weSh0aGlzLm1hdHJpeCkuaW52ZXJ0KCksdGhpcy5uZWVkc1VwZGF0ZT0hMX19KCksbHQucHJvdG90eXBlLmludGVyc2VjdHNCb3g9ZnVuY3Rpb24oKXtjb25zdCByPW5ldyBRdDtyZXR1cm4gZnVuY3Rpb24oZSl7dGhpcy5uZWVkc1VwZGF0ZSYmdGhpcy51cGRhdGUoKTtjb25zdCBzPWUubWluLG49ZS5tYXgsaT10aGlzLnNhdEJvdW5kcyxvPXRoaXMuc2F0QXhlcyxhPXRoaXMuYWxpZ25lZFNhdEJvdW5kcztpZihyLm1pbj1zLngsci5tYXg9bi54LGFbMF0uaXNTZXBhcmF0ZWQocil8fChyLm1pbj1zLnksci5tYXg9bi55LGFbMV0uaXNTZXBhcmF0ZWQocikpfHwoci5taW49cy56LHIubWF4PW4ueixhWzJdLmlzU2VwYXJhdGVkKHIpKSlyZXR1cm4hMTtmb3IobGV0IGM9MDtjPDM7YysrKXtjb25zdCB1PW9bY10saD1pW2NdO2lmKHIuc2V0RnJvbUJveCh1LGUpLGguaXNTZXBhcmF0ZWQocikpcmV0dXJuITF9cmV0dXJuITB9fSgpLGx0LnByb3RvdHlwZS5pbnRlcnNlY3RzVHJpYW5nbGU9ZnVuY3Rpb24oKXtjb25zdCByPW5ldyBMdCx0PW5ldyBBcnJheSgzKSxlPW5ldyBRdCxzPW5ldyBRdCxuPW5ldyBBO3JldHVybiBmdW5jdGlvbihvKXt0aGlzLm5lZWRzVXBkYXRlJiZ0aGlzLnVwZGF0ZSgpLG8uaXNFeHRlbmRlZFRyaWFuZ2xlP28ubmVlZHNVcGRhdGUmJm8udXBkYXRlKCk6KHIuY29weShvKSxyLnVwZGF0ZSgpLG89cik7Y29uc3QgYT10aGlzLnNhdEJvdW5kcyxjPXRoaXMuc2F0QXhlczt0WzBdPW8uYSx0WzFdPW8uYix0WzJdPW8uYztmb3IobGV0IGQ9MDtkPDM7ZCsrKXtjb25zdCBmPWFbZF0scD1jW2RdO2lmKGUuc2V0RnJvbVBvaW50cyhwLHQpLGYuaXNTZXBhcmF0ZWQoZSkpcmV0dXJuITF9Y29uc3QgdT1vLnNhdEJvdW5kcyxoPW8uc2F0QXhlcyxsPXRoaXMucG9pbnRzO2ZvcihsZXQgZD0wO2Q8MztkKyspe2NvbnN0IGY9dVtkXSxwPWhbZF07aWYoZS5zZXRGcm9tUG9pbnRzKHAsbCksZi5pc1NlcGFyYXRlZChlKSlyZXR1cm4hMX1mb3IobGV0IGQ9MDtkPDM7ZCsrKXtjb25zdCBmPWNbZF07Zm9yKGxldCBwPTA7cDw0O3ArKyl7Y29uc3QgbT1oW3BdO2lmKG4uY3Jvc3NWZWN0b3JzKGYsbSksZS5zZXRGcm9tUG9pbnRzKG4sdCkscy5zZXRGcm9tUG9pbnRzKG4sbCksZS5pc1NlcGFyYXRlZChzKSlyZXR1cm4hMX19cmV0dXJuITB9fSgpLGx0LnByb3RvdHlwZS5jbG9zZXN0UG9pbnRUb1BvaW50PWZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMubmVlZHNVcGRhdGUmJnRoaXMudXBkYXRlKCksZS5jb3B5KHQpLmFwcGx5TWF0cml4NCh0aGlzLmludk1hdHJpeCkuY2xhbXAodGhpcy5taW4sdGhpcy5tYXgpLmFwcGx5TWF0cml4NCh0aGlzLm1hdHJpeCksZX19KCksbHQucHJvdG90eXBlLmRpc3RhbmNlVG9Qb2ludD1mdW5jdGlvbigpe2NvbnN0IHI9bmV3IEE7cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmNsb3Nlc3RQb2ludFRvUG9pbnQoZSxyKSxlLmRpc3RhbmNlVG8ocil9fSgpLGx0LnByb3RvdHlwZS5kaXN0YW5jZVRvQm94PWZ1bmN0aW9uKCl7Y29uc3Qgcj1bIngiLCJ5IiwieiJdLHQ9bmV3IEFycmF5KDEyKS5maWxsKCkubWFwKCgpPT5uZXcgWnQpLGU9bmV3IEFycmF5KDEyKS5maWxsKCkubWFwKCgpPT5uZXcgWnQpLHM9bmV3IEEsbj1uZXcgQTtyZXR1cm4gZnVuY3Rpb24obyxhPTAsYz1udWxsLHU9bnVsbCl7aWYodGhpcy5uZWVkc1VwZGF0ZSYmdGhpcy51cGRhdGUoKSx0aGlzLmludGVyc2VjdHNCb3gobykpcmV0dXJuKGN8fHUpJiYoby5nZXRDZW50ZXIobiksdGhpcy5jbG9zZXN0UG9pbnRUb1BvaW50KG4scyksby5jbG9zZXN0UG9pbnRUb1BvaW50KHMsbiksYyYmYy5jb3B5KHMpLHUmJnUuY29weShuKSksMDtjb25zdCBoPWEqYSxsPW8ubWluLGQ9by5tYXgsZj10aGlzLnBvaW50cztsZXQgcD0xLzA7Zm9yKGxldCBnPTA7Zzw4O2crKyl7Y29uc3QgeT1mW2ddO24uY29weSh5KS5jbGFtcChsLGQpO2NvbnN0IFQ9eS5kaXN0YW5jZVRvU3F1YXJlZChuKTtpZihUPHAmJihwPVQsYyYmYy5jb3B5KHkpLHUmJnUuY29weShuKSxUPGgpKXJldHVybiBNYXRoLnNxcnQoVCl9bGV0IG09MDtmb3IobGV0IGc9MDtnPDM7ZysrKWZvcihsZXQgeT0wO3k8PTE7eSsrKWZvcihsZXQgVD0wO1Q8PTE7VCsrKXtjb25zdCB3PShnKzEpJTMsTT0oZysyKSUzLE49eTw8d3xUPDxNLF89MTw8Z3x5PDx3fFQ8PE0sUz1mW05dLEU9ZltfXTt0W21dLnNldChTLEUpO2NvbnN0IFI9cltnXSxJPXJbd10sQj1yW01dLFA9ZVttXSxMPVAuc3RhcnQsVj1QLmVuZDtMW1JdPWxbUl0sTFtJXT15P2xbSV06ZFtJXSxMW0JdPVQ/bFtCXTpkW0ldLFZbUl09ZFtSXSxWW0ldPXk/bFtJXTpkW0ldLFZbQl09VD9sW0JdOmRbSV0sbSsrfWZvcihsZXQgZz0wO2c8PTE7ZysrKWZvcihsZXQgeT0wO3k8PTE7eSsrKWZvcihsZXQgVD0wO1Q8PTE7VCsrKXtuLng9Zz9kLng6bC54LG4ueT15P2QueTpsLnksbi56PVQ/ZC56Omwueix0aGlzLmNsb3Nlc3RQb2ludFRvUG9pbnQobixzKTtjb25zdCB3PW4uZGlzdGFuY2VUb1NxdWFyZWQocyk7aWYodzxwJiYocD13LGMmJmMuY29weShzKSx1JiZ1LmNvcHkobiksdzxoKSlyZXR1cm4gTWF0aC5zcXJ0KHcpfWZvcihsZXQgZz0wO2c8MTI7ZysrKXtjb25zdCB5PXRbZ107Zm9yKGxldCBUPTA7VDwxMjtUKyspe2NvbnN0IHc9ZVtUXTtNaSh5LHcscyxuKTtjb25zdCBNPXMuZGlzdGFuY2VUb1NxdWFyZWQobik7aWYoTTxwJiYocD1NLGMmJmMuY29weShzKSx1JiZ1LmNvcHkobiksTTxoKSlyZXR1cm4gTWF0aC5zcXJ0KE0pfX1yZXR1cm4gTWF0aC5zcXJ0KHApfX0oKTtjbGFzcyBfaXtjb25zdHJ1Y3Rvcih0KXt0aGlzLl9nZXROZXdQcmltaXRpdmU9dCx0aGlzLl9wcmltaXRpdmVzPVtdfWdldFByaW1pdGl2ZSgpe2NvbnN0IHQ9dGhpcy5fcHJpbWl0aXZlcztyZXR1cm4gdC5sZW5ndGg9PT0wP3RoaXMuX2dldE5ld1ByaW1pdGl2ZSgpOnQucG9wKCl9cmVsZWFzZVByaW1pdGl2ZSh0KXt0aGlzLl9wcmltaXRpdmVzLnB1c2godCl9fWNsYXNzIGVsIGV4dGVuZHMgX2l7Y29uc3RydWN0b3IoKXtzdXBlcigoKT0+bmV3IEx0KX19Y29uc3QgYnQ9bmV3IGVsO2NsYXNzIHNse2NvbnN0cnVjdG9yKCl7dGhpcy5mbG9hdDMyQXJyYXk9bnVsbCx0aGlzLnVpbnQxNkFycmF5PW51bGwsdGhpcy51aW50MzJBcnJheT1udWxsO2NvbnN0IHQ9W107bGV0IGU9bnVsbDt0aGlzLnNldEJ1ZmZlcj1zPT57ZSYmdC5wdXNoKGUpLGU9cyx0aGlzLmZsb2F0MzJBcnJheT1uZXcgRmxvYXQzMkFycmF5KHMpLHRoaXMudWludDE2QXJyYXk9bmV3IFVpbnQxNkFycmF5KHMpLHRoaXMudWludDMyQXJyYXk9bmV3IFVpbnQzMkFycmF5KHMpfSx0aGlzLmNsZWFyQnVmZmVyPSgpPT57ZT1udWxsLHRoaXMuZmxvYXQzMkFycmF5PW51bGwsdGhpcy51aW50MTZBcnJheT1udWxsLHRoaXMudWludDMyQXJyYXk9bnVsbCx0Lmxlbmd0aCE9PTAmJnRoaXMuc2V0QnVmZmVyKHQucG9wKCkpfX19Y29uc3QgWD1uZXcgc2w7bGV0IGFlLFZlO2NvbnN0IFVlPVtdLG9uPW5ldyBfaSgoKT0+bmV3IGh0KTtmdW5jdGlvbiBubChyLHQsZSxzLG4saSl7YWU9b24uZ2V0UHJpbWl0aXZlKCksVmU9b24uZ2V0UHJpbWl0aXZlKCksVWUucHVzaChhZSxWZSksWC5zZXRCdWZmZXIoci5fcm9vdHNbdF0pO2NvbnN0IG89emkoMCxyLmdlb21ldHJ5LGUscyxuLGkpO1guY2xlYXJCdWZmZXIoKSxvbi5yZWxlYXNlUHJpbWl0aXZlKGFlKSxvbi5yZWxlYXNlUHJpbWl0aXZlKFZlKSxVZS5wb3AoKSxVZS5wb3AoKTtjb25zdCBhPVVlLmxlbmd0aDtyZXR1cm4gYT4wJiYoVmU9VWVbYS0xXSxhZT1VZVthLTJdKSxvfWZ1bmN0aW9uIHppKHIsdCxlLHMsbj1udWxsLGk9MCxvPTApe2NvbnN0e2Zsb2F0MzJBcnJheTphLHVpbnQxNkFycmF5OmMsdWludDMyQXJyYXk6dX09WDtsZXQgaD1yKjI7aWYocHQoaCxjKSl7Y29uc3QgZD1UdChyLHUpLGY9U3QoaCxjKTtyZXR1cm4gWihyLGEsYWUpLHMoZCxmLCExLG8saStyLGFlKX1lbHNle2xldCBSPWZ1bmN0aW9uKEIpe2NvbnN0e3VpbnQxNkFycmF5OlAsdWludDMyQXJyYXk6TH09WDtsZXQgVj1CKjI7Zm9yKDshcHQoVixQKTspQj1fdChCKSxWPUIqMjtyZXR1cm4gVHQoQixMKX0sST1mdW5jdGlvbihCKXtjb25zdHt1aW50MTZBcnJheTpQLHVpbnQzMkFycmF5Okx9PVg7bGV0IFY9QioyO2Zvcig7IXB0KFYsUCk7KUI9enQoQixMKSxWPUIqMjtyZXR1cm4gVHQoQixMKStTdChWLFApfTtjb25zdCBkPV90KHIpLGY9enQocix1KTtsZXQgcD1kLG09ZixnLHksVCx3O2lmKG4mJihUPWFlLHc9VmUsWihwLGEsVCksWihtLGEsdyksZz1uKFQpLHk9bih3KSx5PGcpKXtwPWYsbT1kO2NvbnN0IEI9ZztnPXkseT1CLFQ9d31UfHwoVD1hZSxaKHAsYSxUKSk7Y29uc3QgTT1wdChwKjIsYyksTj1lKFQsTSxnLG8rMSxpK3ApO2xldCBfO2lmKE49PT1sbyl7Y29uc3QgQj1SKHApLEw9SShwKS1CO189cyhCLEwsITAsbysxLGkrcCxUKX1lbHNlIF89TiYmemkocCx0LGUscyxuLGksbysxKTtpZihfKXJldHVybiEwO3c9VmUsWihtLGEsdyk7Y29uc3QgUz1wdChtKjIsYyksRT1lKHcsUyx5LG8rMSxpK20pO2xldCBGO2lmKEU9PT1sbyl7Y29uc3QgQj1SKG0pLEw9SShtKS1CO0Y9cyhCLEwsITAsbysxLGkrbSx3KX1lbHNlIEY9RSYmemkobSx0LGUscyxuLGksbysxKTtyZXR1cm4hIUZ9fWNvbnN0IHhzPW5ldyBBLGJpPW5ldyBBO2Z1bmN0aW9uIGlsKHIsdCxlPXt9LHM9MCxuPTEvMCl7Y29uc3QgaT1zKnMsbz1uKm47bGV0IGE9MS8wLGM9bnVsbDtpZihyLnNoYXBlY2FzdCh7Ym91bmRzVHJhdmVyc2VPcmRlcjpoPT4oeHMuY29weSh0KS5jbGFtcChoLm1pbixoLm1heCkseHMuZGlzdGFuY2VUb1NxdWFyZWQodCkpLGludGVyc2VjdHNCb3VuZHM6KGgsbCxkKT0+ZDxhJiZkPG8saW50ZXJzZWN0c1RyaWFuZ2xlOihoLGwpPT57aC5jbG9zZXN0UG9pbnRUb1BvaW50KHQseHMpO2NvbnN0IGQ9dC5kaXN0YW5jZVRvU3F1YXJlZCh4cyk7cmV0dXJuIGQ8YSYmKGJpLmNvcHkoeHMpLGE9ZCxjPWwpLGQ8aX19KSxhPT09MS8wKXJldHVybiBudWxsO2NvbnN0IHU9TWF0aC5zcXJ0KGEpO3JldHVybiBlLnBvaW50P2UucG9pbnQuY29weShiaSk6ZS5wb2ludD1iaS5jbG9uZSgpLGUuZGlzdGFuY2U9dSxlLmZhY2VJbmRleD1jLGV9Y29uc3Qgcmw9cGFyc2VJbnQoWGUpPj0xNjksbWU9bmV3IEEseWU9bmV3IEEsZ2U9bmV3IEEsYW49bmV3IEosY249bmV3IEosaG49bmV3IEosQW89bmV3IEEsTW89bmV3IEEsU289bmV3IEEsVHM9bmV3IEE7ZnVuY3Rpb24gb2wocix0LGUscyxuLGksbyxhKXtsZXQgYztpZihpPT09VWk/Yz1yLmludGVyc2VjdFRyaWFuZ2xlKHMsZSx0LCEwLG4pOmM9ci5pbnRlcnNlY3RUcmlhbmdsZSh0LGUscyxpIT09RW8sbiksYz09PW51bGwpcmV0dXJuIG51bGw7Y29uc3QgdT1yLm9yaWdpbi5kaXN0YW5jZVRvKG4pO3JldHVybiB1PG98fHU+YT9udWxsOntkaXN0YW5jZTp1LHBvaW50Om4uY2xvbmUoKX19ZnVuY3Rpb24gYWwocix0LGUscyxuLGksbyxhLGMsdSxoKXttZS5mcm9tQnVmZmVyQXR0cmlidXRlKHQsaSkseWUuZnJvbUJ1ZmZlckF0dHJpYnV0ZSh0LG8pLGdlLmZyb21CdWZmZXJBdHRyaWJ1dGUodCxhKTtjb25zdCBsPW9sKHIsbWUseWUsZ2UsVHMsYyx1LGgpO2lmKGwpe2NvbnN0IGQ9bmV3IEE7d3QuZ2V0QmFyeWNvb3JkKFRzLG1lLHllLGdlLGQpLHMmJihhbi5mcm9tQnVmZmVyQXR0cmlidXRlKHMsaSksY24uZnJvbUJ1ZmZlckF0dHJpYnV0ZShzLG8pLGhuLmZyb21CdWZmZXJBdHRyaWJ1dGUocyxhKSxsLnV2PXd0LmdldEludGVycG9sYXRpb24oVHMsbWUseWUsZ2UsYW4sY24saG4sbmV3IEopKSxuJiYoYW4uZnJvbUJ1ZmZlckF0dHJpYnV0ZShuLGkpLGNuLmZyb21CdWZmZXJBdHRyaWJ1dGUobixvKSxobi5mcm9tQnVmZmVyQXR0cmlidXRlKG4sYSksbC51djE9d3QuZ2V0SW50ZXJwb2xhdGlvbihUcyxtZSx5ZSxnZSxhbixjbixobixuZXcgSikpLGUmJihBby5mcm9tQnVmZmVyQXR0cmlidXRlKGUsaSksTW8uZnJvbUJ1ZmZlckF0dHJpYnV0ZShlLG8pLFNvLmZyb21CdWZmZXJBdHRyaWJ1dGUoZSxhKSxsLm5vcm1hbD13dC5nZXRJbnRlcnBvbGF0aW9uKFRzLG1lLHllLGdlLEFvLE1vLFNvLG5ldyBBKSxsLm5vcm1hbC5kb3Qoci5kaXJlY3Rpb24pPjAmJmwubm9ybWFsLm11bHRpcGx5U2NhbGFyKC0xKSk7Y29uc3QgZj17YTppLGI6byxjOmEsbm9ybWFsOm5ldyBBLG1hdGVyaWFsSW5kZXg6MH07d3QuZ2V0Tm9ybWFsKG1lLHllLGdlLGYubm9ybWFsKSxsLmZhY2U9ZixsLmZhY2VJbmRleD1pLHJsJiYobC5iYXJ5Y29vcmQ9ZCl9cmV0dXJuIGx9ZnVuY3Rpb24gdW4ocix0LGUscyxuLGksbyl7Y29uc3QgYT1zKjM7bGV0IGM9YSswLHU9YSsxLGg9YSsyO2NvbnN0IGw9ci5pbmRleDtyLmluZGV4JiYoYz1sLmdldFgoYyksdT1sLmdldFgodSksaD1sLmdldFgoaCkpO2NvbnN0e3Bvc2l0aW9uOmQsbm9ybWFsOmYsdXY6cCx1djE6bX09ci5hdHRyaWJ1dGVzLGc9YWwoZSxkLGYscCxtLGMsdSxoLHQsaSxvKTtyZXR1cm4gZz8oZy5mYWNlSW5kZXg9cyxuJiZuLnB1c2goZyksZyk6bnVsbH1mdW5jdGlvbiBzdChyLHQsZSxzKXtjb25zdCBuPXIuYSxpPXIuYixvPXIuYztsZXQgYT10LGM9dCsxLHU9dCsyO2UmJihhPWUuZ2V0WChhKSxjPWUuZ2V0WChjKSx1PWUuZ2V0WCh1KSksbi54PXMuZ2V0WChhKSxuLnk9cy5nZXRZKGEpLG4uej1zLmdldFooYSksaS54PXMuZ2V0WChjKSxpLnk9cy5nZXRZKGMpLGkuej1zLmdldFooYyksby54PXMuZ2V0WCh1KSxvLnk9cy5nZXRZKHUpLG8uej1zLmdldFoodSl9ZnVuY3Rpb24gY2wocix0LGUscyxuLGksbyxhKXtjb25zdHtnZW9tZXRyeTpjLF9pbmRpcmVjdEJ1ZmZlcjp1fT1yO2ZvcihsZXQgaD1zLGw9cytuO2g8bDtoKyspdW4oYyx0LGUsaCxpLG8sYSl9ZnVuY3Rpb24gaGwocix0LGUscyxuLGksbyl7Y29uc3R7Z2VvbWV0cnk6YSxfaW5kaXJlY3RCdWZmZXI6Y309cjtsZXQgdT0xLzAsaD1udWxsO2ZvcihsZXQgbD1zLGQ9cytuO2w8ZDtsKyspe2xldCBmO2Y9dW4oYSx0LGUsbCxudWxsLGksbyksZiYmZi5kaXN0YW5jZTx1JiYoaD1mLHU9Zi5kaXN0YW5jZSl9cmV0dXJuIGh9ZnVuY3Rpb24gdWwocix0LGUscyxuLGksbyl7Y29uc3R7Z2VvbWV0cnk6YX09ZSx7aW5kZXg6Y309YSx1PWEuYXR0cmlidXRlcy5wb3NpdGlvbjtmb3IobGV0IGg9cixsPXQrcjtoPGw7aCsrKXtsZXQgZDtpZihkPWgsc3QobyxkKjMsYyx1KSxvLm5lZWRzVXBkYXRlPSEwLHMobyxkLG4saSkpcmV0dXJuITB9cmV0dXJuITF9ZnVuY3Rpb24gbGwocix0PW51bGwpe3QmJkFycmF5LmlzQXJyYXkodCkmJih0PW5ldyBTZXQodCkpO2NvbnN0IGU9ci5nZW9tZXRyeSxzPWUuaW5kZXg/ZS5pbmRleC5hcnJheTpudWxsLG49ZS5hdHRyaWJ1dGVzLnBvc2l0aW9uO2xldCBpLG8sYSxjLHU9MDtjb25zdCBoPXIuX3Jvb3RzO2ZvcihsZXQgZD0wLGY9aC5sZW5ndGg7ZDxmO2QrKylpPWhbZF0sbz1uZXcgVWludDMyQXJyYXkoaSksYT1uZXcgVWludDE2QXJyYXkoaSksYz1uZXcgRmxvYXQzMkFycmF5KGkpLGwoMCx1KSx1Kz1pLmJ5dGVMZW5ndGg7ZnVuY3Rpb24gbChkLGYscD0hMSl7Y29uc3QgbT1kKjI7aWYoYVttKzE1XT09PWVuKXtjb25zdCB5PW9bZCs2XSxUPWFbbSsxNF07bGV0IHc9MS8wLE09MS8wLE49MS8wLF89LTEvMCxTPS0xLzAsRT0tMS8wO2ZvcihsZXQgRj0zKnksUj0zKih5K1QpO0Y8UjtGKyspe2xldCBJPXNbRl07Y29uc3QgQj1uLmdldFgoSSksUD1uLmdldFkoSSksTD1uLmdldFooSSk7Qjx3JiYodz1CKSxCPl8mJihfPUIpLFA8TSYmKE09UCksUD5TJiYoUz1QKSxMPE4mJihOPUwpLEw+RSYmKEU9TCl9cmV0dXJuIGNbZCswXSE9PXd8fGNbZCsxXSE9PU18fGNbZCsyXSE9PU58fGNbZCszXSE9PV98fGNbZCs0XSE9PVN8fGNbZCs1XSE9PUU/KGNbZCswXT13LGNbZCsxXT1NLGNbZCsyXT1OLGNbZCszXT1fLGNbZCs0XT1TLGNbZCs1XT1FLCEwKTohMX1lbHNle2NvbnN0IHk9ZCs4LFQ9b1tkKzZdLHc9eStmLE09VCtmO2xldCBOPXAsXz0hMSxTPSExO3Q/Tnx8KF89dC5oYXModyksUz10LmhhcyhNKSxOPSFfJiYhUyk6KF89ITAsUz0hMCk7Y29uc3QgRT1OfHxfLEY9Tnx8UztsZXQgUj0hMTtFJiYoUj1sKHksZixOKSk7bGV0IEk9ITE7RiYmKEk9bChULGYsTikpO2NvbnN0IEI9Unx8STtpZihCKWZvcihsZXQgUD0wO1A8MztQKyspe2NvbnN0IEw9eStQLFY9VCtQLEc9Y1tMXSxOdD1jW0wrM10sSHQ9Y1tWXSxxdD1jW1YrM107Y1tkK1BdPUc8SHQ/RzpIdCxjW2QrUCszXT1OdD5xdD9OdDpxdH1yZXR1cm4gQn19fWZ1bmN0aW9uIGNlKHIsdCxlLHMsbil7bGV0IGksbyxhLGMsdSxoO2NvbnN0IGw9MS9lLmRpcmVjdGlvbi54LGQ9MS9lLmRpcmVjdGlvbi55LGY9MS9lLmRpcmVjdGlvbi56LHA9ZS5vcmlnaW4ueCxtPWUub3JpZ2luLnksZz1lLm9yaWdpbi56O2xldCB5PXRbcl0sVD10W3IrM10sdz10W3IrMV0sTT10W3IrMysxXSxOPXRbcisyXSxfPXRbciszKzJdO3JldHVybiBsPj0wPyhpPSh5LXApKmwsbz0oVC1wKSpsKTooaT0oVC1wKSpsLG89KHktcCkqbCksZD49MD8oYT0ody1tKSpkLGM9KE0tbSkqZCk6KGE9KE0tbSkqZCxjPSh3LW0pKmQpLGk+Y3x8YT5vfHwoKGE+aXx8aXNOYU4oaSkpJiYoaT1hKSwoYzxvfHxpc05hTihvKSkmJihvPWMpLGY+PTA/KHU9KE4tZykqZixoPShfLWcpKmYpOih1PShfLWcpKmYsaD0oTi1nKSpmKSxpPmh8fHU+byk/ITE6KCh1Pml8fGkhPT1pKSYmKGk9dSksKGg8b3x8byE9PW8pJiYobz1oKSxpPD1uJiZvPj1zKX1mdW5jdGlvbiBkbChyLHQsZSxzLG4saSxvLGEpe2NvbnN0e2dlb21ldHJ5OmMsX2luZGlyZWN0QnVmZmVyOnV9PXI7Zm9yKGxldCBoPXMsbD1zK247aDxsO2grKyl7bGV0IGQ9dT91W2hdOmg7dW4oYyx0LGUsZCxpLG8sYSl9fWZ1bmN0aW9uIGZsKHIsdCxlLHMsbixpLG8pe2NvbnN0e2dlb21ldHJ5OmEsX2luZGlyZWN0QnVmZmVyOmN9PXI7bGV0IHU9MS8wLGg9bnVsbDtmb3IobGV0IGw9cyxkPXMrbjtsPGQ7bCsrKXtsZXQgZjtmPXVuKGEsdCxlLGM/Y1tsXTpsLG51bGwsaSxvKSxmJiZmLmRpc3RhbmNlPHUmJihoPWYsdT1mLmRpc3RhbmNlKX1yZXR1cm4gaH1mdW5jdGlvbiBwbChyLHQsZSxzLG4saSxvKXtjb25zdHtnZW9tZXRyeTphfT1lLHtpbmRleDpjfT1hLHU9YS5hdHRyaWJ1dGVzLnBvc2l0aW9uO2ZvcihsZXQgaD1yLGw9dCtyO2g8bDtoKyspe2xldCBkO2lmKGQ9ZS5yZXNvbHZlVHJpYW5nbGVJbmRleChoKSxzdChvLGQqMyxjLHUpLG8ubmVlZHNVcGRhdGU9ITAscyhvLGQsbixpKSlyZXR1cm4hMH1yZXR1cm4hMX1mdW5jdGlvbiBtbChyLHQsZSxzLG4saSxvKXtYLnNldEJ1ZmZlcihyLl9yb290c1t0XSksRWkoMCxyLGUscyxuLGksbyksWC5jbGVhckJ1ZmZlcigpfWZ1bmN0aW9uIEVpKHIsdCxlLHMsbixpLG8pe2NvbnN0e2Zsb2F0MzJBcnJheTphLHVpbnQxNkFycmF5OmMsdWludDMyQXJyYXk6dX09WCxoPXIqMjtpZihwdChoLGMpKXtjb25zdCBkPVR0KHIsdSksZj1TdChoLGMpO2NsKHQsZSxzLGQsZixuLGksbyl9ZWxzZXtjb25zdCBkPV90KHIpO2NlKGQsYSxzLGksbykmJkVpKGQsdCxlLHMsbixpLG8pO2NvbnN0IGY9enQocix1KTtjZShmLGEscyxpLG8pJiZFaShmLHQsZSxzLG4saSxvKX19Y29uc3QgeWw9WyJ4IiwieSIsInoiXTtmdW5jdGlvbiBnbChyLHQsZSxzLG4saSl7WC5zZXRCdWZmZXIoci5fcm9vdHNbdF0pO2NvbnN0IG89Q2koMCxyLGUscyxuLGkpO3JldHVybiBYLmNsZWFyQnVmZmVyKCksb31mdW5jdGlvbiBDaShyLHQsZSxzLG4saSl7Y29uc3R7ZmxvYXQzMkFycmF5Om8sdWludDE2QXJyYXk6YSx1aW50MzJBcnJheTpjfT1YO2xldCB1PXIqMjtpZihwdCh1LGEpKXtjb25zdCBsPVR0KHIsYyksZD1TdCh1LGEpO3JldHVybiBobCh0LGUscyxsLGQsbixpKX1lbHNle2NvbnN0IGw9VG8ocixjKSxkPXlsW2xdLHA9cy5kaXJlY3Rpb25bZF0+PTA7bGV0IG0sZztwPyhtPV90KHIpLGc9enQocixjKSk6KG09enQocixjKSxnPV90KHIpKTtjb25zdCBUPWNlKG0sbyxzLG4saSk/Q2kobSx0LGUscyxuLGkpOm51bGw7aWYoVCl7Y29uc3QgTj1ULnBvaW50W2RdO2lmKHA/Tjw9b1tnK2xdOk4+PW9bZytsKzNdKXJldHVybiBUfWNvbnN0IE09Y2UoZyxvLHMsbixpKT9DaShnLHQsZSxzLG4saSk6bnVsbDtyZXR1cm4gVCYmTT9ULmRpc3RhbmNlPD1NLmRpc3RhbmNlP1Q6TTpUfHxNfHxudWxsfX1jb25zdCBsbj1uZXcgaHQsa2U9bmV3IEx0LEhlPW5ldyBMdCxOcz1uZXcgbnQsX289bmV3IGx0LGRuPW5ldyBsdDtmdW5jdGlvbiB4bChyLHQsZSxzKXtYLnNldEJ1ZmZlcihyLl9yb290c1t0XSk7Y29uc3Qgbj1GaSgwLHIsZSxzKTtyZXR1cm4gWC5jbGVhckJ1ZmZlcigpLG59ZnVuY3Rpb24gRmkocix0LGUscyxuPW51bGwpe2NvbnN0e2Zsb2F0MzJBcnJheTppLHVpbnQxNkFycmF5Om8sdWludDMyQXJyYXk6YX09WDtsZXQgYz1yKjI7aWYobj09PW51bGwmJihlLmJvdW5kaW5nQm94fHxlLmNvbXB1dGVCb3VuZGluZ0JveCgpLF9vLnNldChlLmJvdW5kaW5nQm94Lm1pbixlLmJvdW5kaW5nQm94Lm1heCxzKSxuPV9vKSxwdChjLG8pKXtjb25zdCBoPXQuZ2VvbWV0cnksbD1oLmluZGV4LGQ9aC5hdHRyaWJ1dGVzLnBvc2l0aW9uLGY9ZS5pbmRleCxwPWUuYXR0cmlidXRlcy5wb3NpdGlvbixtPVR0KHIsYSksZz1TdChjLG8pO2lmKE5zLmNvcHkocykuaW52ZXJ0KCksZS5ib3VuZHNUcmVlKXJldHVybiBaKHIsaSxkbiksZG4ubWF0cml4LmNvcHkoTnMpLGRuLm5lZWRzVXBkYXRlPSEwLGUuYm91bmRzVHJlZS5zaGFwZWNhc3Qoe2ludGVyc2VjdHNCb3VuZHM6VD0+ZG4uaW50ZXJzZWN0c0JveChUKSxpbnRlcnNlY3RzVHJpYW5nbGU6VD0+e1QuYS5hcHBseU1hdHJpeDQocyksVC5iLmFwcGx5TWF0cml4NChzKSxULmMuYXBwbHlNYXRyaXg0KHMpLFQubmVlZHNVcGRhdGU9ITA7Zm9yKGxldCB3PW0qMyxNPShnK20pKjM7dzxNO3crPTMpaWYoc3QoSGUsdyxsLGQpLEhlLm5lZWRzVXBkYXRlPSEwLFQuaW50ZXJzZWN0c1RyaWFuZ2xlKEhlKSlyZXR1cm4hMDtyZXR1cm4hMX19KTtmb3IobGV0IHk9bSozLFQ9KGcrbSkqMzt5PFQ7eSs9Myl7c3Qoa2UseSxsLGQpLGtlLmEuYXBwbHlNYXRyaXg0KE5zKSxrZS5iLmFwcGx5TWF0cml4NChOcyksa2UuYy5hcHBseU1hdHJpeDQoTnMpLGtlLm5lZWRzVXBkYXRlPSEwO2ZvcihsZXQgdz0wLE09Zi5jb3VudDt3PE07dys9MylpZihzdChIZSx3LGYscCksSGUubmVlZHNVcGRhdGU9ITAsa2UuaW50ZXJzZWN0c1RyaWFuZ2xlKEhlKSlyZXR1cm4hMH19ZWxzZXtjb25zdCBoPXIrOCxsPWFbcis2XTtyZXR1cm4gWihoLGksbG4pLCEhKG4uaW50ZXJzZWN0c0JveChsbikmJkZpKGgsdCxlLHMsbil8fChaKGwsaSxsbiksbi5pbnRlcnNlY3RzQm94KGxuKSYmRmkobCx0LGUscyxuKSkpfX1jb25zdCBmbj1uZXcgbnQsUmk9bmV3IGx0LHdzPW5ldyBsdCxUbD1uZXcgQSxObD1uZXcgQSx3bD1uZXcgQSxBbD1uZXcgQTtmdW5jdGlvbiBNbChyLHQsZSxzPXt9LG49e30saT0wLG89MS8wKXt0LmJvdW5kaW5nQm94fHx0LmNvbXB1dGVCb3VuZGluZ0JveCgpLFJpLnNldCh0LmJvdW5kaW5nQm94Lm1pbix0LmJvdW5kaW5nQm94Lm1heCxlKSxSaS5uZWVkc1VwZGF0ZT0hMDtjb25zdCBhPXIuZ2VvbWV0cnksYz1hLmF0dHJpYnV0ZXMucG9zaXRpb24sdT1hLmluZGV4LGg9dC5hdHRyaWJ1dGVzLnBvc2l0aW9uLGw9dC5pbmRleCxkPWJ0LmdldFByaW1pdGl2ZSgpLGY9YnQuZ2V0UHJpbWl0aXZlKCk7bGV0IHA9VGwsbT1ObCxnPW51bGwseT1udWxsO24mJihnPXdsLHk9QWwpO2xldCBUPTEvMCx3PW51bGwsTT1udWxsO3JldHVybiBmbi5jb3B5KGUpLmludmVydCgpLHdzLm1hdHJpeC5jb3B5KGZuKSxyLnNoYXBlY2FzdCh7Ym91bmRzVHJhdmVyc2VPcmRlcjpOPT5SaS5kaXN0YW5jZVRvQm94KE4pLGludGVyc2VjdHNCb3VuZHM6KE4sXyxTKT0+UzxUJiZTPG8/KF8mJih3cy5taW4uY29weShOLm1pbiksd3MubWF4LmNvcHkoTi5tYXgpLHdzLm5lZWRzVXBkYXRlPSEwKSwhMCk6ITEsaW50ZXJzZWN0c1JhbmdlOihOLF8pPT57aWYodC5ib3VuZHNUcmVlKXJldHVybiB0LmJvdW5kc1RyZWUuc2hhcGVjYXN0KHtib3VuZHNUcmF2ZXJzZU9yZGVyOkU9PndzLmRpc3RhbmNlVG9Cb3goRSksaW50ZXJzZWN0c0JvdW5kczooRSxGLFIpPT5SPFQmJlI8byxpbnRlcnNlY3RzUmFuZ2U6KEUsRik9Pntmb3IobGV0IFI9RSxJPUUrRjtSPEk7UisrKXtzdChmLDMqUixsLGgpLGYuYS5hcHBseU1hdHJpeDQoZSksZi5iLmFwcGx5TWF0cml4NChlKSxmLmMuYXBwbHlNYXRyaXg0KGUpLGYubmVlZHNVcGRhdGU9ITA7Zm9yKGxldCBCPU4sUD1OK187QjxQO0IrKyl7c3QoZCwzKkIsdSxjKSxkLm5lZWRzVXBkYXRlPSEwO2NvbnN0IEw9ZC5kaXN0YW5jZVRvVHJpYW5nbGUoZixwLGcpO2lmKEw8VCYmKG0uY29weShwKSx5JiZ5LmNvcHkoZyksVD1MLHc9QixNPVIpLEw8aSlyZXR1cm4hMH19fX0pO3tjb25zdCBTPURlKHQpO2ZvcihsZXQgRT0wLEY9UztFPEY7RSsrKXtzdChmLDMqRSxsLGgpLGYuYS5hcHBseU1hdHJpeDQoZSksZi5iLmFwcGx5TWF0cml4NChlKSxmLmMuYXBwbHlNYXRyaXg0KGUpLGYubmVlZHNVcGRhdGU9ITA7Zm9yKGxldCBSPU4sST1OK187UjxJO1IrKyl7c3QoZCwzKlIsdSxjKSxkLm5lZWRzVXBkYXRlPSEwO2NvbnN0IEI9ZC5kaXN0YW5jZVRvVHJpYW5nbGUoZixwLGcpO2lmKEI8VCYmKG0uY29weShwKSx5JiZ5LmNvcHkoZyksVD1CLHc9UixNPUUpLEI8aSlyZXR1cm4hMH19fX19KSxidC5yZWxlYXNlUHJpbWl0aXZlKGQpLGJ0LnJlbGVhc2VQcmltaXRpdmUoZiksVD09PTEvMD9udWxsOihzLnBvaW50P3MucG9pbnQuY29weShtKTpzLnBvaW50PW0uY2xvbmUoKSxzLmRpc3RhbmNlPVQscy5mYWNlSW5kZXg9dyxuJiYobi5wb2ludD9uLnBvaW50LmNvcHkoeSk6bi5wb2ludD15LmNsb25lKCksbi5wb2ludC5hcHBseU1hdHJpeDQoZm4pLG0uYXBwbHlNYXRyaXg0KGZuKSxuLmRpc3RhbmNlPW0uc3ViKG4ucG9pbnQpLmxlbmd0aCgpLG4uZmFjZUluZGV4PU0pLHMpfWZ1bmN0aW9uIFNsKHIsdD1udWxsKXt0JiZBcnJheS5pc0FycmF5KHQpJiYodD1uZXcgU2V0KHQpKTtjb25zdCBlPXIuZ2VvbWV0cnkscz1lLmluZGV4P2UuaW5kZXguYXJyYXk6bnVsbCxuPWUuYXR0cmlidXRlcy5wb3NpdGlvbjtsZXQgaSxvLGEsYyx1PTA7Y29uc3QgaD1yLl9yb290cztmb3IobGV0IGQ9MCxmPWgubGVuZ3RoO2Q8ZjtkKyspaT1oW2RdLG89bmV3IFVpbnQzMkFycmF5KGkpLGE9bmV3IFVpbnQxNkFycmF5KGkpLGM9bmV3IEZsb2F0MzJBcnJheShpKSxsKDAsdSksdSs9aS5ieXRlTGVuZ3RoO2Z1bmN0aW9uIGwoZCxmLHA9ITEpe2NvbnN0IG09ZCoyO2lmKGFbbSsxNV09PT1lbil7Y29uc3QgeT1vW2QrNl0sVD1hW20rMTRdO2xldCB3PTEvMCxNPTEvMCxOPTEvMCxfPS0xLzAsUz0tMS8wLEU9LTEvMDtmb3IobGV0IEY9eSxSPXkrVDtGPFI7RisrKXtjb25zdCBJPTMqci5yZXNvbHZlVHJpYW5nbGVJbmRleChGKTtmb3IobGV0IEI9MDtCPDM7QisrKXtsZXQgUD1JK0I7UD1zP3NbUF06UDtjb25zdCBMPW4uZ2V0WChQKSxWPW4uZ2V0WShQKSxHPW4uZ2V0WihQKTtMPHcmJih3PUwpLEw+XyYmKF89TCksVjxNJiYoTT1WKSxWPlMmJihTPVYpLEc8TiYmKE49RyksRz5FJiYoRT1HKX19cmV0dXJuIGNbZCswXSE9PXd8fGNbZCsxXSE9PU18fGNbZCsyXSE9PU58fGNbZCszXSE9PV98fGNbZCs0XSE9PVN8fGNbZCs1XSE9PUU/KGNbZCswXT13LGNbZCsxXT1NLGNbZCsyXT1OLGNbZCszXT1fLGNbZCs0XT1TLGNbZCs1XT1FLCEwKTohMX1lbHNle2NvbnN0IHk9ZCs4LFQ9b1tkKzZdLHc9eStmLE09VCtmO2xldCBOPXAsXz0hMSxTPSExO3Q/Tnx8KF89dC5oYXModyksUz10LmhhcyhNKSxOPSFfJiYhUyk6KF89ITAsUz0hMCk7Y29uc3QgRT1OfHxfLEY9Tnx8UztsZXQgUj0hMTtFJiYoUj1sKHksZixOKSk7bGV0IEk9ITE7RiYmKEk9bChULGYsTikpO2NvbnN0IEI9Unx8STtpZihCKWZvcihsZXQgUD0wO1A8MztQKyspe2NvbnN0IEw9eStQLFY9VCtQLEc9Y1tMXSxOdD1jW0wrM10sSHQ9Y1tWXSxxdD1jW1YrM107Y1tkK1BdPUc8SHQ/RzpIdCxjW2QrUCszXT1OdD5xdD9OdDpxdH1yZXR1cm4gQn19fWZ1bmN0aW9uIF9sKHIsdCxlLHMsbixpLG8pe1guc2V0QnVmZmVyKHIuX3Jvb3RzW3RdKSxCaSgwLHIsZSxzLG4saSxvKSxYLmNsZWFyQnVmZmVyKCl9ZnVuY3Rpb24gQmkocix0LGUscyxuLGksbyl7Y29uc3R7ZmxvYXQzMkFycmF5OmEsdWludDE2QXJyYXk6Yyx1aW50MzJBcnJheTp1fT1YLGg9cioyO2lmKHB0KGgsYykpe2NvbnN0IGQ9VHQocix1KSxmPVN0KGgsYyk7ZGwodCxlLHMsZCxmLG4saSxvKX1lbHNle2NvbnN0IGQ9X3Qocik7Y2UoZCxhLHMsaSxvKSYmQmkoZCx0LGUscyxuLGksbyk7Y29uc3QgZj16dChyLHUpO2NlKGYsYSxzLGksbykmJkJpKGYsdCxlLHMsbixpLG8pfX1jb25zdCB6bD1bIngiLCJ5IiwieiJdO2Z1bmN0aW9uIGJsKHIsdCxlLHMsbixpKXtYLnNldEJ1ZmZlcihyLl9yb290c1t0XSk7Y29uc3Qgbz1JaSgwLHIsZSxzLG4saSk7cmV0dXJuIFguY2xlYXJCdWZmZXIoKSxvfWZ1bmN0aW9uIElpKHIsdCxlLHMsbixpKXtjb25zdHtmbG9hdDMyQXJyYXk6byx1aW50MTZBcnJheTphLHVpbnQzMkFycmF5OmN9PVg7bGV0IHU9cioyO2lmKHB0KHUsYSkpe2NvbnN0IGw9VHQocixjKSxkPVN0KHUsYSk7cmV0dXJuIGZsKHQsZSxzLGwsZCxuLGkpfWVsc2V7Y29uc3QgbD1UbyhyLGMpLGQ9emxbbF0scD1zLmRpcmVjdGlvbltkXT49MDtsZXQgbSxnO3A/KG09X3QociksZz16dChyLGMpKToobT16dChyLGMpLGc9X3QocikpO2NvbnN0IFQ9Y2UobSxvLHMsbixpKT9JaShtLHQsZSxzLG4saSk6bnVsbDtpZihUKXtjb25zdCBOPVQucG9pbnRbZF07aWYocD9OPD1vW2crbF06Tj49b1tnK2wrM10pcmV0dXJuIFR9Y29uc3QgTT1jZShnLG8scyxuLGkpP0lpKGcsdCxlLHMsbixpKTpudWxsO3JldHVybiBUJiZNP1QuZGlzdGFuY2U8PU0uZGlzdGFuY2U/VDpNOlR8fE18fG51bGx9fWNvbnN0IHBuPW5ldyBodCxxZT1uZXcgTHQsJGU9bmV3IEx0LEFzPW5ldyBudCx6bz1uZXcgbHQsbW49bmV3IGx0O2Z1bmN0aW9uIEVsKHIsdCxlLHMpe1guc2V0QnVmZmVyKHIuX3Jvb3RzW3RdKTtjb25zdCBuPXZpKDAscixlLHMpO3JldHVybiBYLmNsZWFyQnVmZmVyKCksbn1mdW5jdGlvbiB2aShyLHQsZSxzLG49bnVsbCl7Y29uc3R7ZmxvYXQzMkFycmF5OmksdWludDE2QXJyYXk6byx1aW50MzJBcnJheTphfT1YO2xldCBjPXIqMjtpZihuPT09bnVsbCYmKGUuYm91bmRpbmdCb3h8fGUuY29tcHV0ZUJvdW5kaW5nQm94KCksem8uc2V0KGUuYm91bmRpbmdCb3gubWluLGUuYm91bmRpbmdCb3gubWF4LHMpLG49em8pLHB0KGMsbykpe2NvbnN0IGg9dC5nZW9tZXRyeSxsPWguaW5kZXgsZD1oLmF0dHJpYnV0ZXMucG9zaXRpb24sZj1lLmluZGV4LHA9ZS5hdHRyaWJ1dGVzLnBvc2l0aW9uLG09VHQocixhKSxnPVN0KGMsbyk7aWYoQXMuY29weShzKS5pbnZlcnQoKSxlLmJvdW5kc1RyZWUpcmV0dXJuIFoocixpLG1uKSxtbi5tYXRyaXguY29weShBcyksbW4ubmVlZHNVcGRhdGU9ITAsZS5ib3VuZHNUcmVlLnNoYXBlY2FzdCh7aW50ZXJzZWN0c0JvdW5kczpUPT5tbi5pbnRlcnNlY3RzQm94KFQpLGludGVyc2VjdHNUcmlhbmdsZTpUPT57VC5hLmFwcGx5TWF0cml4NChzKSxULmIuYXBwbHlNYXRyaXg0KHMpLFQuYy5hcHBseU1hdHJpeDQocyksVC5uZWVkc1VwZGF0ZT0hMDtmb3IobGV0IHc9bSxNPWcrbTt3PE07dysrKWlmKHN0KCRlLDMqdC5yZXNvbHZlVHJpYW5nbGVJbmRleCh3KSxsLGQpLCRlLm5lZWRzVXBkYXRlPSEwLFQuaW50ZXJzZWN0c1RyaWFuZ2xlKCRlKSlyZXR1cm4hMDtyZXR1cm4hMX19KTtmb3IobGV0IHk9bSxUPWcrbTt5PFQ7eSsrKXtjb25zdCB3PXQucmVzb2x2ZVRyaWFuZ2xlSW5kZXgoeSk7c3QocWUsMyp3LGwsZCkscWUuYS5hcHBseU1hdHJpeDQoQXMpLHFlLmIuYXBwbHlNYXRyaXg0KEFzKSxxZS5jLmFwcGx5TWF0cml4NChBcykscWUubmVlZHNVcGRhdGU9ITA7Zm9yKGxldCBNPTAsTj1mLmNvdW50O008TjtNKz0zKWlmKHN0KCRlLE0sZixwKSwkZS5uZWVkc1VwZGF0ZT0hMCxxZS5pbnRlcnNlY3RzVHJpYW5nbGUoJGUpKXJldHVybiEwfX1lbHNle2NvbnN0IGg9cis4LGw9YVtyKzZdO3JldHVybiBaKGgsaSxwbiksISEobi5pbnRlcnNlY3RzQm94KHBuKSYmdmkoaCx0LGUscyxuKXx8KFoobCxpLHBuKSxuLmludGVyc2VjdHNCb3gocG4pJiZ2aShsLHQsZSxzLG4pKSl9fWNvbnN0IHluPW5ldyBudCxQaT1uZXcgbHQsTXM9bmV3IGx0LENsPW5ldyBBLEZsPW5ldyBBLFJsPW5ldyBBLEJsPW5ldyBBO2Z1bmN0aW9uIElsKHIsdCxlLHM9e30sbj17fSxpPTAsbz0xLzApe3QuYm91bmRpbmdCb3h8fHQuY29tcHV0ZUJvdW5kaW5nQm94KCksUGkuc2V0KHQuYm91bmRpbmdCb3gubWluLHQuYm91bmRpbmdCb3gubWF4LGUpLFBpLm5lZWRzVXBkYXRlPSEwO2NvbnN0IGE9ci5nZW9tZXRyeSxjPWEuYXR0cmlidXRlcy5wb3NpdGlvbix1PWEuaW5kZXgsaD10LmF0dHJpYnV0ZXMucG9zaXRpb24sbD10LmluZGV4LGQ9YnQuZ2V0UHJpbWl0aXZlKCksZj1idC5nZXRQcmltaXRpdmUoKTtsZXQgcD1DbCxtPUZsLGc9bnVsbCx5PW51bGw7biYmKGc9UmwseT1CbCk7bGV0IFQ9MS8wLHc9bnVsbCxNPW51bGw7cmV0dXJuIHluLmNvcHkoZSkuaW52ZXJ0KCksTXMubWF0cml4LmNvcHkoeW4pLHIuc2hhcGVjYXN0KHtib3VuZHNUcmF2ZXJzZU9yZGVyOk49PlBpLmRpc3RhbmNlVG9Cb3goTiksaW50ZXJzZWN0c0JvdW5kczooTixfLFMpPT5TPFQmJlM8bz8oXyYmKE1zLm1pbi5jb3B5KE4ubWluKSxNcy5tYXguY29weShOLm1heCksTXMubmVlZHNVcGRhdGU9ITApLCEwKTohMSxpbnRlcnNlY3RzUmFuZ2U6KE4sXyk9PntpZih0LmJvdW5kc1RyZWUpe2NvbnN0IFM9dC5ib3VuZHNUcmVlO3JldHVybiBTLnNoYXBlY2FzdCh7Ym91bmRzVHJhdmVyc2VPcmRlcjpFPT5Ncy5kaXN0YW5jZVRvQm94KEUpLGludGVyc2VjdHNCb3VuZHM6KEUsRixSKT0+UjxUJiZSPG8saW50ZXJzZWN0c1JhbmdlOihFLEYpPT57Zm9yKGxldCBSPUUsST1FK0Y7UjxJO1IrKyl7Y29uc3QgQj1TLnJlc29sdmVUcmlhbmdsZUluZGV4KFIpO3N0KGYsMypCLGwsaCksZi5hLmFwcGx5TWF0cml4NChlKSxmLmIuYXBwbHlNYXRyaXg0KGUpLGYuYy5hcHBseU1hdHJpeDQoZSksZi5uZWVkc1VwZGF0ZT0hMDtmb3IobGV0IFA9TixMPU4rXztQPEw7UCsrKXtjb25zdCBWPXIucmVzb2x2ZVRyaWFuZ2xlSW5kZXgoUCk7c3QoZCwzKlYsdSxjKSxkLm5lZWRzVXBkYXRlPSEwO2NvbnN0IEc9ZC5kaXN0YW5jZVRvVHJpYW5nbGUoZixwLGcpO2lmKEc8VCYmKG0uY29weShwKSx5JiZ5LmNvcHkoZyksVD1HLHc9UCxNPVIpLEc8aSlyZXR1cm4hMH19fX0pfWVsc2V7Y29uc3QgUz1EZSh0KTtmb3IobGV0IEU9MCxGPVM7RTxGO0UrKyl7c3QoZiwzKkUsbCxoKSxmLmEuYXBwbHlNYXRyaXg0KGUpLGYuYi5hcHBseU1hdHJpeDQoZSksZi5jLmFwcGx5TWF0cml4NChlKSxmLm5lZWRzVXBkYXRlPSEwO2ZvcihsZXQgUj1OLEk9TitfO1I8STtSKyspe2NvbnN0IEI9ci5yZXNvbHZlVHJpYW5nbGVJbmRleChSKTtzdChkLDMqQix1LGMpLGQubmVlZHNVcGRhdGU9ITA7Y29uc3QgUD1kLmRpc3RhbmNlVG9UcmlhbmdsZShmLHAsZyk7aWYoUDxUJiYobS5jb3B5KHApLHkmJnkuY29weShnKSxUPVAsdz1SLE09RSksUDxpKXJldHVybiEwfX19fX0pLGJ0LnJlbGVhc2VQcmltaXRpdmUoZCksYnQucmVsZWFzZVByaW1pdGl2ZShmKSxUPT09MS8wP251bGw6KHMucG9pbnQ/cy5wb2ludC5jb3B5KG0pOnMucG9pbnQ9bS5jbG9uZSgpLHMuZGlzdGFuY2U9VCxzLmZhY2VJbmRleD13LG4mJihuLnBvaW50P24ucG9pbnQuY29weSh5KTpuLnBvaW50PXkuY2xvbmUoKSxuLnBvaW50LmFwcGx5TWF0cml4NCh5biksbS5hcHBseU1hdHJpeDQoeW4pLG4uZGlzdGFuY2U9bS5zdWIobi5wb2ludCkubGVuZ3RoKCksbi5mYWNlSW5kZXg9TSkscyl9ZnVuY3Rpb24gdmwoKXtyZXR1cm4gdHlwZW9mIFNoYXJlZEFycmF5QnVmZmVyPCJ1In1jb25zdCBTcz1uZXcgWC5jb25zdHJ1Y3Rvcixnbj1uZXcgWC5jb25zdHJ1Y3RvcixoZT1uZXcgX2koKCk9Pm5ldyBodCksR2U9bmV3IGh0LFdlPW5ldyBodCxMaT1uZXcgaHQsT2k9bmV3IGh0O2xldCBEaT0hMTtmdW5jdGlvbiBQbChyLHQsZSxzKXtpZihEaSl0aHJvdyBuZXcgRXJyb3IoIk1lc2hCVkg6IFJlY3Vyc2l2ZSBjYWxscyB0byBidmhjYXN0IG5vdCBzdXBwb3J0ZWQuIik7RGk9ITA7Y29uc3Qgbj1yLl9yb290cyxpPXQuX3Jvb3RzO2xldCBvLGE9MCxjPTA7Y29uc3QgdT1uZXcgbnQoKS5jb3B5KGUpLmludmVydCgpO2ZvcihsZXQgaD0wLGw9bi5sZW5ndGg7aDxsO2grKyl7U3Muc2V0QnVmZmVyKG5baF0pLGM9MDtjb25zdCBkPWhlLmdldFByaW1pdGl2ZSgpO1ooMCxTcy5mbG9hdDMyQXJyYXksZCksZC5hcHBseU1hdHJpeDQodSk7Zm9yKGxldCBmPTAscD1pLmxlbmd0aDtmPHAmJihnbi5zZXRCdWZmZXIoaVtmXSksbz1PdCgwLDAsZSx1LHMsYSxjLDAsMCxkKSxnbi5jbGVhckJ1ZmZlcigpLGMrPWlbZl0ubGVuZ3RoLCFvKTtmKyspO2lmKGhlLnJlbGVhc2VQcmltaXRpdmUoZCksU3MuY2xlYXJCdWZmZXIoKSxhKz1uW2hdLmxlbmd0aCxvKWJyZWFrfXJldHVybiBEaT0hMSxvfWZ1bmN0aW9uIE90KHIsdCxlLHMsbixpPTAsbz0wLGE9MCxjPTAsdT1udWxsLGg9ITEpe2xldCBsLGQ7aD8obD1nbixkPVNzKToobD1TcyxkPWduKTtjb25zdCBmPWwuZmxvYXQzMkFycmF5LHA9bC51aW50MzJBcnJheSxtPWwudWludDE2QXJyYXksZz1kLmZsb2F0MzJBcnJheSx5PWQudWludDMyQXJyYXksVD1kLnVpbnQxNkFycmF5LHc9cioyLE09dCoyLE49cHQodyxtKSxfPXB0KE0sVCk7bGV0IFM9ITE7aWYoXyYmTiloP1M9bihUdCh0LHkpLFN0KHQqMixUKSxUdChyLHApLFN0KHIqMixtKSxjLG8rdCxhLGkrcik6Uz1uKFR0KHIscCksU3QocioyLG0pLFR0KHQseSksU3QodCoyLFQpLGEsaStyLGMsbyt0KTtlbHNlIGlmKF8pe2NvbnN0IEU9aGUuZ2V0UHJpbWl0aXZlKCk7Wih0LGcsRSksRS5hcHBseU1hdHJpeDQoZSk7Y29uc3QgRj1fdChyKSxSPXp0KHIscCk7WihGLGYsR2UpLFooUixmLFdlKTtjb25zdCBJPUUuaW50ZXJzZWN0c0JveChHZSksQj1FLmludGVyc2VjdHNCb3goV2UpO1M9SSYmT3QodCxGLHMsZSxuLG8saSxjLGErMSxFLCFoKXx8QiYmT3QodCxSLHMsZSxuLG8saSxjLGErMSxFLCFoKSxoZS5yZWxlYXNlUHJpbWl0aXZlKEUpfWVsc2V7Y29uc3QgRT1fdCh0KSxGPXp0KHQseSk7WihFLGcsTGkpLFooRixnLE9pKTtjb25zdCBSPXUuaW50ZXJzZWN0c0JveChMaSksST11LmludGVyc2VjdHNCb3goT2kpO2lmKFImJkkpUz1PdChyLEUsZSxzLG4saSxvLGEsYysxLHUsaCl8fE90KHIsRixlLHMsbixpLG8sYSxjKzEsdSxoKTtlbHNlIGlmKFIpaWYoTilTPU90KHIsRSxlLHMsbixpLG8sYSxjKzEsdSxoKTtlbHNle2NvbnN0IEI9aGUuZ2V0UHJpbWl0aXZlKCk7Qi5jb3B5KExpKS5hcHBseU1hdHJpeDQoZSk7Y29uc3QgUD1fdChyKSxMPXp0KHIscCk7WihQLGYsR2UpLFooTCxmLFdlKTtjb25zdCBWPUIuaW50ZXJzZWN0c0JveChHZSksRz1CLmludGVyc2VjdHNCb3goV2UpO1M9ViYmT3QoRSxQLHMsZSxuLG8saSxjLGErMSxCLCFoKXx8RyYmT3QoRSxMLHMsZSxuLG8saSxjLGErMSxCLCFoKSxoZS5yZWxlYXNlUHJpbWl0aXZlKEIpfWVsc2UgaWYoSSlpZihOKVM9T3QocixGLGUscyxuLGksbyxhLGMrMSx1LGgpO2Vsc2V7Y29uc3QgQj1oZS5nZXRQcmltaXRpdmUoKTtCLmNvcHkoT2kpLmFwcGx5TWF0cml4NChlKTtjb25zdCBQPV90KHIpLEw9enQocixwKTtaKFAsZixHZSksWihMLGYsV2UpO2NvbnN0IFY9Qi5pbnRlcnNlY3RzQm94KEdlKSxHPUIuaW50ZXJzZWN0c0JveChXZSk7Uz1WJiZPdChGLFAscyxlLG4sbyxpLGMsYSsxLEIsIWgpfHxHJiZPdChGLEwscyxlLG4sbyxpLGMsYSsxLEIsIWgpLGhlLnJlbGVhc2VQcmltaXRpdmUoQil9fXJldHVybiBTfWNvbnN0IHhuPW5ldyBsdCxibz1uZXcgaHQsTGw9e3N0cmF0ZWd5OnVvLG1heERlcHRoOjQwLG1heExlYWZUcmlzOjEwLHVzZVNoYXJlZEFycmF5QnVmZmVyOiExLHNldEJvdW5kaW5nQm94OiEwLG9uUHJvZ3Jlc3M6bnVsbCxpbmRpcmVjdDohMSx2ZXJib3NlOiEwLHJhbmdlOm51bGx9O2NsYXNzIFRue3N0YXRpYyBzZXJpYWxpemUodCxlPXt9KXtlPXtjbG9uZUJ1ZmZlcnM6ITAsLi4uZX07Y29uc3Qgcz10Lmdlb21ldHJ5LG49dC5fcm9vdHMsaT10Ll9pbmRpcmVjdEJ1ZmZlcixvPXMuZ2V0SW5kZXgoKTtsZXQgYTtyZXR1cm4gZS5jbG9uZUJ1ZmZlcnM/YT17cm9vdHM6bi5tYXAoYz0+Yy5zbGljZSgpKSxpbmRleDpvP28uYXJyYXkuc2xpY2UoKTpudWxsLGluZGlyZWN0QnVmZmVyOmk/aS5zbGljZSgpOm51bGx9OmE9e3Jvb3RzOm4saW5kZXg6bz9vLmFycmF5Om51bGwsaW5kaXJlY3RCdWZmZXI6aX0sYX1zdGF0aWMgZGVzZXJpYWxpemUodCxlLHM9e30pe3M9e3NldEluZGV4OiEwLGluZGlyZWN0OiEhdC5pbmRpcmVjdEJ1ZmZlciwuLi5zfTtjb25zdHtpbmRleDpuLHJvb3RzOmksaW5kaXJlY3RCdWZmZXI6b309dCxhPW5ldyBUbihlLHsuLi5zLFt4aV06ITB9KTtpZihhLl9yb290cz1pLGEuX2luZGlyZWN0QnVmZmVyPW98fG51bGwscy5zZXRJbmRleCl7Y29uc3QgYz1lLmdldEluZGV4KCk7aWYoYz09PW51bGwpe2NvbnN0IHU9bmV3IHZ0KHQuaW5kZXgsMSwhMSk7ZS5zZXRJbmRleCh1KX1lbHNlIGMuYXJyYXkhPT1uJiYoYy5hcnJheS5zZXQobiksYy5uZWVkc1VwZGF0ZT0hMCl9cmV0dXJuIGF9Z2V0IGluZGlyZWN0KCl7cmV0dXJuISF0aGlzLl9pbmRpcmVjdEJ1ZmZlcn1jb25zdHJ1Y3Rvcih0LGU9e30pe2lmKHQuaXNCdWZmZXJHZW9tZXRyeSl7aWYodC5pbmRleCYmdC5pbmRleC5pc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlKXRocm93IG5ldyBFcnJvcigiTWVzaEJWSDogSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgaXMgbm90IHN1cHBvcnRlZCBmb3IgdGhlIGluZGV4IGF0dHJpYnV0ZS4iKX1lbHNlIHRocm93IG5ldyBFcnJvcigiTWVzaEJWSDogT25seSBCdWZmZXJHZW9tZXRyaWVzIGFyZSBzdXBwb3J0ZWQuIik7aWYoZT1PYmplY3QuYXNzaWduKHsuLi5MbCxbeGldOiExfSxlKSxlLnVzZVNoYXJlZEFycmF5QnVmZmVyJiYhdmwoKSl0aHJvdyBuZXcgRXJyb3IoIk1lc2hCVkg6IFNoYXJlZEFycmF5QnVmZmVyIGlzIG5vdCBhdmFpbGFibGUuIik7dGhpcy5nZW9tZXRyeT10LHRoaXMuX3Jvb3RzPW51bGwsdGhpcy5faW5kaXJlY3RCdWZmZXI9bnVsbCxlW3hpXXx8KGp1KHRoaXMsZSksIXQuYm91bmRpbmdCb3gmJmUuc2V0Qm91bmRpbmdCb3gmJih0LmJvdW5kaW5nQm94PXRoaXMuZ2V0Qm91bmRpbmdCb3gobmV3IGh0KSkpLHRoaXMucmVzb2x2ZVRyaWFuZ2xlSW5kZXg9ZS5pbmRpcmVjdD9zPT50aGlzLl9pbmRpcmVjdEJ1ZmZlcltzXTpzPT5zfXJlZml0KHQ9bnVsbCl7cmV0dXJuKHRoaXMuaW5kaXJlY3Q/U2w6bGwpKHRoaXMsdCl9dHJhdmVyc2UodCxlPTApe2NvbnN0IHM9dGhpcy5fcm9vdHNbZV0sbj1uZXcgVWludDMyQXJyYXkocyksaT1uZXcgVWludDE2QXJyYXkocyk7bygwKTtmdW5jdGlvbiBvKGEsYz0wKXtjb25zdCB1PWEqMixoPWlbdSsxNV09PT1lbjtpZihoKXtjb25zdCBsPW5bYSs2XSxkPWlbdSsxNF07dChjLGgsbmV3IEZsb2F0MzJBcnJheShzLGEqNCw2KSxsLGQpfWVsc2V7Y29uc3QgbD1hK21zLzQsZD1uW2ErNl0sZj1uW2ErN107dChjLGgsbmV3IEZsb2F0MzJBcnJheShzLGEqNCw2KSxmKXx8KG8obCxjKzEpLG8oZCxjKzEpKX19fXJheWNhc3QodCxlPVZpLHM9MCxuPTEvMCl7Y29uc3QgaT10aGlzLl9yb290cyxvPXRoaXMuZ2VvbWV0cnksYT1bXSxjPWUuaXNNYXRlcmlhbCx1PUFycmF5LmlzQXJyYXkoZSksaD1vLmdyb3VwcyxsPWM/ZS5zaWRlOmUsZD10aGlzLmluZGlyZWN0P19sOm1sO2ZvcihsZXQgZj0wLHA9aS5sZW5ndGg7ZjxwO2YrKyl7Y29uc3QgbT11P2VbaFtmXS5tYXRlcmlhbEluZGV4XS5zaWRlOmwsZz1hLmxlbmd0aDtpZihkKHRoaXMsZixtLHQsYSxzLG4pLHUpe2NvbnN0IHk9aFtmXS5tYXRlcmlhbEluZGV4O2ZvcihsZXQgVD1nLHc9YS5sZW5ndGg7VDx3O1QrKylhW1RdLmZhY2UubWF0ZXJpYWxJbmRleD15fX1yZXR1cm4gYX1yYXljYXN0Rmlyc3QodCxlPVZpLHM9MCxuPTEvMCl7Y29uc3QgaT10aGlzLl9yb290cyxvPXRoaXMuZ2VvbWV0cnksYT1lLmlzTWF0ZXJpYWwsYz1BcnJheS5pc0FycmF5KGUpO2xldCB1PW51bGw7Y29uc3QgaD1vLmdyb3VwcyxsPWE/ZS5zaWRlOmUsZD10aGlzLmluZGlyZWN0P2JsOmdsO2ZvcihsZXQgZj0wLHA9aS5sZW5ndGg7ZjxwO2YrKyl7Y29uc3QgbT1jP2VbaFtmXS5tYXRlcmlhbEluZGV4XS5zaWRlOmwsZz1kKHRoaXMsZixtLHQscyxuKTtnIT1udWxsJiYodT09bnVsbHx8Zy5kaXN0YW5jZTx1LmRpc3RhbmNlKSYmKHU9ZyxjJiYoZy5mYWNlLm1hdGVyaWFsSW5kZXg9aFtmXS5tYXRlcmlhbEluZGV4KSl9cmV0dXJuIHV9aW50ZXJzZWN0c0dlb21ldHJ5KHQsZSl7bGV0IHM9ITE7Y29uc3Qgbj10aGlzLl9yb290cyxpPXRoaXMuaW5kaXJlY3Q/RWw6eGw7Zm9yKGxldCBvPTAsYT1uLmxlbmd0aDtvPGEmJihzPWkodGhpcyxvLHQsZSksIXMpO28rKyk7cmV0dXJuIHN9c2hhcGVjYXN0KHQpe2NvbnN0IGU9YnQuZ2V0UHJpbWl0aXZlKCkscz10aGlzLmluZGlyZWN0P3BsOnVsO2xldHtib3VuZHNUcmF2ZXJzZU9yZGVyOm4saW50ZXJzZWN0c0JvdW5kczppLGludGVyc2VjdHNSYW5nZTpvLGludGVyc2VjdHNUcmlhbmdsZTphfT10O2lmKG8mJmEpe2NvbnN0IGw9bztvPShkLGYscCxtLGcpPT5sKGQsZixwLG0sZyk/ITA6cyhkLGYsdGhpcyxhLHAsbSxlKX1lbHNlIG98fChhP289KGwsZCxmLHApPT5zKGwsZCx0aGlzLGEsZixwLGUpOm89KGwsZCxmKT0+Zik7bGV0IGM9ITEsdT0wO2NvbnN0IGg9dGhpcy5fcm9vdHM7Zm9yKGxldCBsPTAsZD1oLmxlbmd0aDtsPGQ7bCsrKXtjb25zdCBmPWhbbF07aWYoYz1ubCh0aGlzLGwsaSxvLG4sdSksYylicmVhazt1Kz1mLmJ5dGVMZW5ndGh9cmV0dXJuIGJ0LnJlbGVhc2VQcmltaXRpdmUoZSksY31idmhjYXN0KHQsZSxzKXtsZXR7aW50ZXJzZWN0c1JhbmdlczpuLGludGVyc2VjdHNUcmlhbmdsZXM6aX09cztjb25zdCBvPWJ0LmdldFByaW1pdGl2ZSgpLGE9dGhpcy5nZW9tZXRyeS5pbmRleCxjPXRoaXMuZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbix1PXRoaXMuaW5kaXJlY3Q/cD0+e2NvbnN0IG09dGhpcy5yZXNvbHZlVHJpYW5nbGVJbmRleChwKTtzdChvLG0qMyxhLGMpfTpwPT57c3QobyxwKjMsYSxjKX0saD1idC5nZXRQcmltaXRpdmUoKSxsPXQuZ2VvbWV0cnkuaW5kZXgsZD10Lmdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb24sZj10LmluZGlyZWN0P3A9Pntjb25zdCBtPXQucmVzb2x2ZVRyaWFuZ2xlSW5kZXgocCk7c3QoaCxtKjMsbCxkKX06cD0+e3N0KGgscCozLGwsZCl9O2lmKGkpe2NvbnN0IHA9KG0sZyx5LFQsdyxNLE4sXyk9Pntmb3IobGV0IFM9eSxFPXkrVDtTPEU7UysrKXtmKFMpLGguYS5hcHBseU1hdHJpeDQoZSksaC5iLmFwcGx5TWF0cml4NChlKSxoLmMuYXBwbHlNYXRyaXg0KGUpLGgubmVlZHNVcGRhdGU9ITA7Zm9yKGxldCBGPW0sUj1tK2c7RjxSO0YrKylpZih1KEYpLG8ubmVlZHNVcGRhdGU9ITAsaShvLGgsRixTLHcsTSxOLF8pKXJldHVybiEwfXJldHVybiExfTtpZihuKXtjb25zdCBtPW47bj1mdW5jdGlvbihnLHksVCx3LE0sTixfLFMpe3JldHVybiBtKGcseSxULHcsTSxOLF8sUyk/ITA6cChnLHksVCx3LE0sTixfLFMpfX1lbHNlIG49cH1yZXR1cm4gUGwodGhpcyx0LGUsbil9aW50ZXJzZWN0c0JveCh0LGUpe3JldHVybiB4bi5zZXQodC5taW4sdC5tYXgsZSkseG4ubmVlZHNVcGRhdGU9ITAsdGhpcy5zaGFwZWNhc3Qoe2ludGVyc2VjdHNCb3VuZHM6cz0+eG4uaW50ZXJzZWN0c0JveChzKSxpbnRlcnNlY3RzVHJpYW5nbGU6cz0+eG4uaW50ZXJzZWN0c1RyaWFuZ2xlKHMpfSl9aW50ZXJzZWN0c1NwaGVyZSh0KXtyZXR1cm4gdGhpcy5zaGFwZWNhc3Qoe2ludGVyc2VjdHNCb3VuZHM6ZT0+dC5pbnRlcnNlY3RzQm94KGUpLGludGVyc2VjdHNUcmlhbmdsZTplPT5lLmludGVyc2VjdHNTcGhlcmUodCl9KX1jbG9zZXN0UG9pbnRUb0dlb21ldHJ5KHQsZSxzPXt9LG49e30saT0wLG89MS8wKXtyZXR1cm4odGhpcy5pbmRpcmVjdD9JbDpNbCkodGhpcyx0LGUscyxuLGksbyl9Y2xvc2VzdFBvaW50VG9Qb2ludCh0LGU9e30scz0wLG49MS8wKXtyZXR1cm4gaWwodGhpcyx0LGUscyxuKX1nZXRCb3VuZGluZ0JveCh0KXtyZXR1cm4gdC5tYWtlRW1wdHkoKSx0aGlzLl9yb290cy5mb3JFYWNoKHM9PntaKDAsbmV3IEZsb2F0MzJBcnJheShzKSxibyksdC51bmlvbihibyl9KSx0fX1vbm1lc3NhZ2U9KHtkYXRhOnJ9KT0+e2xldCB0PXBlcmZvcm1hbmNlLm5vdygpO2Z1bmN0aW9uIGUobyl7bz1NYXRoLm1pbihvLDEpO2NvbnN0IGE9cGVyZm9ybWFuY2Uubm93KCk7YS10Pj0xMCYmbyE9PTEmJihwb3N0TWVzc2FnZSh7ZXJyb3I6bnVsbCxzZXJpYWxpemVkOm51bGwscG9zaXRpb246bnVsbCxwcm9ncmVzczpvfSksdD1hKX1jb25zdHtpbmRleDpzLHBvc2l0aW9uOm4sb3B0aW9uczppfT1yO3RyeXtjb25zdCBvPW5ldyBHbjtpZihvLnNldEF0dHJpYnV0ZSgicG9zaXRpb24iLG5ldyB2dChuLDMsITEpKSxzJiZvLnNldEluZGV4KG5ldyB2dChzLDEsITEpKSxpLmluY2x1ZGVkUHJvZ3Jlc3NDYWxsYmFjayYmKGkub25Qcm9ncmVzcz1lKSxpLmdyb3Vwcyl7Y29uc3QgaD1pLmdyb3Vwcztmb3IoY29uc3QgbCBpbiBoKXtjb25zdCBkPWhbbF07by5hZGRHcm91cChkLnN0YXJ0LGQuY291bnQsZC5tYXRlcmlhbEluZGV4KX19Y29uc3QgYT1uZXcgVG4obyxpKSxjPVRuLnNlcmlhbGl6ZShhLHtjb3B5SW5kZXhCdWZmZXI6ITF9KTtsZXQgdT1bbi5idWZmZXIsLi4uYy5yb290c107Yy5pbmRleCYmdS5wdXNoKGMuaW5kZXguYnVmZmVyKSx1PXUuZmlsdGVyKGg9PnR5cGVvZiBTaGFyZWRBcnJheUJ1ZmZlcj4idSJ8fCEoaCBpbnN0YW5jZW9mIFNoYXJlZEFycmF5QnVmZmVyKSksYS5faW5kaXJlY3RCdWZmZXImJnUucHVzaChjLmluZGlyZWN0QnVmZmVyLmJ1ZmZlcikscG9zdE1lc3NhZ2Uoe2Vycm9yOm51bGwsc2VyaWFsaXplZDpjLHBvc2l0aW9uOm4scHJvZ3Jlc3M6MX0sdSl9Y2F0Y2gobyl7cG9zdE1lc3NhZ2Uoe2Vycm9yOm8sc2VyaWFsaXplZDpudWxsLHBvc2l0aW9uOm51bGwscHJvZ3Jlc3M6MX0pfX19KSgpOwo=",yj=typeof window<"u"&&window.Blob&&new Blob([atob(rce)],{type:"text/javascript;charset=utf-8"});function MWe(){let s;try{if(s=yj&&(window.URL||window.webkitURL).createObjectURL(yj),!s)throw"";return new Worker(s)}catch{return new Worker("data:application/javascript;base64,"+rce)}finally{s&&(window.URL||window.webkitURL).revokeObjectURL(s)}}class IWe extends SWe{constructor(){super(new MWe),this.name="GenerateMeshBVHWorker"}runTask(e,t,i={}){return new Promise((n,r)=>{if(t.getAttribute("position").isInterleavedBufferAttribute||t.index&&t.index.isInterleavedBufferAttribute)throw new Error("GenerateMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.");e.onerror=c=>{r(new Error(`GenerateMeshBVHWorker: ${c.message}`))},e.onmessage=c=>{const{data:h}=c;if(h.error)r(new Error(h.error)),e.onmessage=null;else if(h.serialized){const{serialized:d,position:u}=h,f=Sm.deserialize(d,t,{setIndex:!1}),m=Object.assign({setBoundingBox:!0},i);if(t.attributes.position.array=u,d.index)if(t.index)t.index.array=d.index;else{const g=new dt(d.index,1,!1);t.setIndex(g)}m.setBoundingBox&&(t.boundingBox=f.getBoundingBox(new oi)),i.onProgress&&i.onProgress(h.progress),n(f),e.onmessage=null}else i.onProgress&&i.onProgress(h.progress)};const o=t.index?t.index.array:null,a=t.attributes.position.array,l=[a];o&&l.push(o),e.postMessage({index:o,position:a,options:{...i,onProgress:null,includedProgressCallback:!!i.onProgress,groups:[...t.groups]}},l.map(c=>c.buffer).filter(c=>typeof SharedArrayBuffer>"u"||!(c instanceof SharedArrayBuffer)))})}}const TWe=Object.freeze(Object.defineProperty({__proto__:null,GenerateMeshBVHWorker:IWe},Symbol.toStringTag,{value:"Module"})),mc={node:"node",material:"material",camera:"camera",light:"light"},Zg="KHR_animation_pointer",EWe={CUBICSPLINE:void 0,LINEAR:Mp,STEP:hm},bj=di.findNode;let xj=!1;class RWe{constructor(e){this.parser=e,this.name=Zg,this.animationPointerResolver=null}setAnimationPointerResolver(e){return this.animationPointerResolver=e,this}_patchPropertyBindingFindNode(){xj||(xj=!0,di.findNode=function(e,t){if(t.startsWith(".materials.")){const i=t.substring(11).substring(t.indexOf(".")),n=i.indexOf("."),r=n<0?i:i.substring(0,n);let o=null;return e.traverse(a=>{o!==null||a.type!=="Mesh"&&a.type!=="SkinnedMesh"||a.material&&(a.material.uuid===r||a.material.name===r)&&(o=a.material,o!==null&&(i.endsWith(".map")?o=o.map:i.endsWith(".emissiveMap")&&(o=o.emissiveMap)))}),o}else if(t.startsWith(".nodes.")||t.startsWith(".lights.")||t.startsWith(".cameras.")){const i=t.split(".");let n;for(let r=1;r<i.length;r++){const o=i[r];if(o.length==36)n=e.getObjectByProperty("uuid",o);else if(n&&n[o]){const l=Number.parseInt(o);let c=o;l>=0&&(c=l),n=n[c]}else{const l=e.getObjectByName(o);l&&(n=l)}}if(!n){const r=bj(e,i[2]);return r||console.warn(Zg+": Property binding not found",t,e,e.name,i),r}return n}return bj(e,t)})}loadAnimationTargetFromChannel(e){const t=e.target,i=t.node!==void 0?t.node:t.id;return this.parser.getDependency("node",i)}loadAnimationTargetFromChannelWithAnimationPointer(e){this._havePatchedPropertyBindings||this._patchPropertyBindingFindNode();const t=e.target,i=t.extensions&&t.extensions[Zg]&&t.path&&t.path==="pointer";if(!i)return null;let n,r=mc.node,o;if(i){const l=t.extensions[Zg];let c=l.pointer;if(!c){console.warn("Invalid path",l,t);return}if(c.startsWith("/materials/")?r=mc.material:c.startsWith("/extensions/KHR_lights_punctual/lights/")?r=mc.light:c.startsWith("/cameras/")&&(r=mc.camera),o=this._tryResolveTargetId(c,r),o===null||isNaN(o)){console.warn("Failed resolving animation node id: "+o,c);return}switch(r){case mc.material:const d=("/materials/"+o.toString()+"/").length,u=c.substring(0,d);switch(n=c.substring(d),n){case"pbrMetallicRoughness/baseColorFactor":n="color";break;case"pbrMetallicRoughness/roughnessFactor":n="roughness";break;case"pbrMetallicRoughness/metallicFactor":n="metalness";break;case"emissiveFactor":n="emissive";break;case"alphaCutoff":n="alphaTest";break;case"occlusionTexture/strength":n="aoMapIntensity";break;case"normalTexture/scale":n="normalScale";break;case"pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale":n="map/repeat";break;case"pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset":n="map/offset";break;case"emissiveTexture/extensions/KHR_texture_transform/scale":n="emissiveMap/repeat";break;case"emissiveTexture/extensions/KHR_texture_transform/offset":n="emissiveMap/offset";break;case"extensions/KHR_materials_emissive_strength/emissiveStrength":n="emissiveIntensity";break;case"extensions/KHR_materials_transmission/transmissionFactor":n="transmission";break;case"extensions/KHR_materials_ior/ior":n="ior";break;case"extensions/KHR_materials_volume/thicknessFactor":n="thickness";break;case"extensions/KHR_materials_volume/attenuationColor":n="attenuationColor";break;case"extensions/KHR_materials_volume/attenuationDistance":n="attenuationDistance";break;case"extensions/KHR_materials_iridescence/iridescenceFactor":n="iridescence";break;case"extensions/KHR_materials_iridescence/iridescenceIor":n="iridescenceIOR";break;case"extensions/KHR_materials_iridescence/iridescenceThicknessMinimum":n="iridescenceThicknessRange[0]";break;case"extensions/KHR_materials_iridescence/iridescenceThicknessMaximum":n="iridescenceThicknessRange[1]";break;case"extensions/KHR_materials_clearcoat/clearcoatFactor":n="clearcoat";break;case"extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor":n="clearcoatRoughness";break;case"extensions/KHR_materials_sheen/sheenColorFactor":n="sheenColor";break;case"extensions/KHR_materials_sheen/sheenRoughnessFactor":n="sheenRoughness";break;case"extensions/KHR_materials_specular/specularFactor":n="specularIntensity";break;case"extensions/KHR_materials_specular/specularColorFactor":n="specularColor";break}c=u+n;break;case mc.node:const f=("/nodes/"+o.toString()+"/").length,m=c.substring(0,f);switch(n=c.substring(f),n){case"translation":n="position";break;case"rotation":n="quaternion";break;case"scale":n="scale";break;case"weights":n="morphTargetInfluences";break}c=m+n;break;case mc.light:const g=("/extensions/KHR_lights_punctual/lights/"+o.toString()+"/").length;switch(n=c.substring(g),n){case"color":break;case"intensity":break;case"spot/innerConeAngle":n="penumbra";break;case"spot/outerConeAngle":n="angle";break;case"range":n="distance";break}c="/lights/"+o.toString()+"/"+n;break;case mc.camera:const A=("/cameras/"+o.toString()+"/").length,y=c.substring(0,A);switch(n=c.substring(A),n){case"perspective/yfov":n="fov";break;case"perspective/znear":case"orthographic/znear":n="near";break;case"perspective/zfar":case"orthographic/zfar":n="far";break;case"perspective/aspect":n="aspect";break;case"orthographic/xmag":n="zoom";break;case"orthographic/ymag":n="zoom";break}c=y+n;break}const h=this.animationPointerResolver;h&&h.resolvePath&&(c=h.resolvePath(c)),t.extensions[Zg].pointer=c}if(o===null||isNaN(o)){console.warn("Failed resolving animation node id: "+o,t);return}let a;return r===mc.node?a=this.parser.getDependency("node",o):r===mc.material?a=this.parser.getDependency("material",o):r===mc.light?a=this.parser.getDependency("light",o):r===mc.camera?a=this.parser.getDependency("camera",o):console.error("Unhandled type",r),a}createAnimationTracksWithAnimationPointer(e,t,i,n,r){if(!(r.extensions&&r.extensions[Zg]&&r.path&&r.path==="pointer"))return null;let a=r.extensions[Zg].pointer;if(!a)return null;const l=[];a=a.replaceAll("/",".");const c=a.split(".");var d=e.name!==void 0&&e.name!==null?e.name:e.uuid;if(c[2]=d,c[3]==="morphTargetInfluences"&&e.type==="Group"){for(const f of e.children)f instanceof ol&&f.morphTargetInfluences&&(c[3]=f.name,c[4]="morphTargetInfluences",u(this.parser));return l}u(this.parser);function u(f){a=c.join(".");let m;switch(i.itemSize){case 1:m=Ip;break;case 2:case 3:m=Yd;break;case 4:a.endsWith(".quaternion")?m=Kd:m=bB;break}const g=n.interpolation!==void 0?EWe[n.interpolation]:Mp;let A=f._getArrayFromAccessor(i);a.endsWith(".fov")&&(A=A.map(b=>b/Math.PI*180));const y=new m(a,t.array,A,g);if(g==="CUBICSPLINE"&&f._createCubicSplineTrackInterpolant(y),l.push(y),a&&i.itemSize===4&&a.startsWith(".materials.")&&a.endsWith(".color")){const b=new Float32Array(A.length/4);for(let v=0,_=A.length/4;v<_;v+=1)b[v]=A[v*4+3];const x=new m(a.replace(".color",".opacity"),t.array,b,g);g==="CUBICSPLINE"&&f._createCubicSplineTrackInterpolant(y),l.push(x)}}return l}_tryResolveTargetId(e,t){let i="";return t==="node"?i=e.substring(7):t==="material"?i=e.substring(11):t==="light"?i=e.substring(39):t==="camera"&&(i=e.substring(9)),i=i.substring(0,i.indexOf("/")),Number.parseInt(i)}loadAnimation(e){const t=this,i=this.parser.json,n=this.parser,r=i.animations[e],o=r.name?r.name:"animation_"+e,a=[],l=[],c=[],h=[],d=[];for(let u=0,f=r.channels.length;u<f;u++){const m=r.channels[u],g=r.samplers[m.sampler],A=m.target,y=r.parameters!==void 0?r.parameters[g.input]:g.input,b=r.parameters!==void 0?r.parameters[g.output]:g.output;let x=t.loadAnimationTargetFromChannelWithAnimationPointer(m);x||(x=t.loadAnimationTargetFromChannel(m)),a.push(x),l.push(n.getDependency("accessor",y)),c.push(n.getDependency("accessor",b)),h.push(g),d.push(A)}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h),Promise.all(d)]).then(function(u){const f=u[0],m=u[1],g=u[2],A=u[3],y=u[4],b=[];for(let x=0,v=f.length;x<v;x++){const _=f[x],C=m[x],S=g[x],M=A[x],L=y[x];if(_===void 0)continue;_.updateMatrix&&(_.updateMatrix(),_.matrixAutoUpdate=!0);let w=t.createAnimationTracksWithAnimationPointer(_,C,S,M,L);if(w||(w=n._createAnimationTracks(_,C,S,M,L)),w)for(let E=0;E<w.length;E++)b.push(w[E])}return new Ba(o,void 0,b)})}}const LWe=Object.freeze(Object.defineProperty({__proto__:null,GLTFAnimationPointerExtension:RWe},Symbol.toStringTag,{value:"Module"}));exports.$physicsKey=SDe;exports.ActionBuilder=zi;exports.ActionCollection=S5;exports.ActionModel=_a;exports.Addressables=Fre;exports.AlignmentConstraint=mM;exports.AmbientMode=sx;exports.Animation=na;exports.AnimationCurve=wA;exports.AnimationExtension=gM;exports.AnimationTrackHandler=LP;exports.AnimationUtils=Bx;exports.Animator=Ro;exports.AnimatorConditionMode=Ef;exports.AnimatorController=Jl;exports.AnimatorControllerParameterType=M5;exports.AnimatorStateInfo=_C;exports.Antialiasing=CM;exports.Application=Lh;exports.ApplicationEvents=c2;exports.AssetDatabase=jse;exports.AssetReference=gi;exports.AudioExtension=Xm;exports.AudioListener=em;exports.AudioSource=fs;exports.AudioTrackHandler=P0;exports.Avatar=bm;exports.AvatarBlink_Simple=MA;exports.AvatarEyeLook_Rotation=uv;exports.AvatarLoader=z5;exports.AvatarMarker=br;exports.AvatarModel=kP;exports.Avatar_Brain_LookAt=wS;exports.Avatar_MouthShapes=SM;exports.Avatar_MustacheShake=F5;exports.Avatar_POI=Wd;exports.Axes=Gb;exports.AxesHelper=pv;exports.BUILD_TIME=CO;exports.BaseUIComponent=Xc;exports.BasicIKConstraint=X5;exports.BehaviorExtension=NP;exports.BehaviorModel=er;exports.Behaviour=ze;exports.BloomEffect=IA;exports.BoxCollider=mv;exports.BoxGizmo=EA;exports.BoxHelperComponent=il;exports.Button=kp;exports.ButtonsFactory=wh;exports.CallDirection=Koe;exports.CallInfo=Cd;exports.Camera=Cn;exports.CameraTargetReachedEvent=_S;exports.Canvas=Lo;exports.CanvasGroup=xm;exports.CapsuleCollider=Ep;exports.ChangeMaterialOnClick=yv;exports.ChangeTransformOnClick=LA;exports.CharacterController=PA;exports.CharacterControllerInput=Dp;exports.ChromaticAberration=LM;exports.CircularBuffer=$l;exports.ClearFlags=$f;exports.ClipExtrapolation=hd;exports.Collider=ul;exports.Collision=Woe;exports.CollisionDetectionMode=MP;exports.ColorAdjustments=Qm;exports.ColorBySpeedModule=GA;exports.ColorOverLifetimeModule=PM;exports.Component=ze;exports.ComponentLifecycleEvents=lM;exports.ConnectionEvents=Xse;exports.ContactPoint=Zoe;exports.ContactShadows=Hh;exports.Context=Wt;exports.ContextArgs=xGe;exports.ContextEvent=ji;exports.ContextRegistry=Oi;exports.ControlTrackHandler=BP;exports.CustomBranding=qm;exports.CustomShader=Ml;exports.DefaultReflectionMode=f2;exports.Deletable=oZ;exports.DeleteBox=F0;exports.DepthOfField=Qh;exports.DeviceFlag=HP;exports.DocumentExtension=aZ;exports.DragControls=sl;exports.DragMode=lZ;exports.DropListener=zp;exports.DropListenerAddedEvent=QP;exports.Duplicatable=DA;exports.EffectWrapper=TS;exports.EmissionModule=lu;exports.EmphasizeOnClick=bv;exports.EngineLoadingView=cw;exports.EventList=Tn;exports.EventListEvent=IP;exports.EventSystem=nl;exports.EventTrigger=YP;exports.FieldWithDefault=iZ;exports.FileReference=nx;exports.FileReferenceSerializer=zre;exports.FileSpawnModel=rze;exports.File_Event=xae;exports.FixedJoint=pZ;exports.FlyControls=fZ;exports.Fog=Sv;exports.FrameEvent=wn;exports.GENERATOR=eP;exports.GameObject=$;exports.Gizmos=Mt;exports.GltfExport=DM;exports.GltfExportBox=gZ;exports.GltfLoadEvent=z0;exports.GltfLoadEventType=gle;exports.Gradient=Km;exports.Graphic=RA;exports.GraphicRaycaster=TP;exports.Graphics=Ec;exports.GridHelper=Mv;exports.GridLayoutGroup=J5;exports.GroundProjectedEnv=ou;exports.GroupActionModel=up;exports.HideFlags=Tre;exports.HideOnStart=q5;exports.HingeJoint=NM;exports.HorizontalLayoutGroup=Y5;exports.HostData=HBe;exports.Image=Av;exports.ImageReference=ix;exports.ImageReferenceSerializer=Vre;exports.InheritVelocityModule=Jm;exports.Input=Qne;exports.InputEventQueue=Nl;exports.InputEvents=es;exports.InputField=FA;exports.InstanceHandle=k0;exports.InstancingHandler=tm;exports.InstancingUtil=Vc;exports.InstantiateEvent=lre;exports.InstantiateIdProvider=So;exports.InstantiateOptions=Zh;exports.Interactable=rZ;exports.JoinedRoomResponse=_2e;exports.KeyEventArgs=RLe;exports.Keyframe=Ea;exports.LODGroup=VM;exports.LODModel=VA;exports.LeftRoomResponse=C2e;exports.Light=fl;exports.LightData=eoe;exports.LimitVelocityOverLifetimeModule=cr;exports.LoadingElementOptions=TGe;exports.LogStats=yZ;exports.LogType=zl;exports.LookAt=zA;exports.LookAtConstraint=SA;exports.MainModule=No;exports.MarkerType=B5;exports.MaskableGraphic=IM;exports.Mathf=lt;exports.MeshCollider=TA;exports.MeshRenderer=BM;exports.MinMaxCurve=Gt;exports.MinMaxGradient=za;exports.NEEDLE_progressive=Ni;exports.NEKeyboardEvent=cC;exports.NEPointerEvent=Wu;exports.NeedleButtonElement=XZ;exports.NeedleEngine=Oi;exports.NeedleEngineHTMLElement=kZ;exports.NeedleLoader=BZ;exports.NeedleMenu=hu;exports.NeedlePatchesKey=SR;exports.NeedleUSDZExporter=yoe;exports.NeedleXRController=ZO;exports.NeedleXRSession=Vt;exports.NeedleXRSync=Wse;exports.NeedleXRUtils=Jse;exports.NestedGltf=$P;exports.NetworkConnection=Zse;exports.NetworkedStreamEvents=Bd;exports.NetworkedStreams=wM;exports.Networking=Iv;exports.NewInstanceModel=hre;exports.NoiseModule=un;exports.ObjectRaycaster=nc;exports.ObjectUtils=zm;exports.OffsetConstraint=UA;exports.OneEuroFilter=CR;exports.OneEuroFilterXYZ=pO;exports.OpenURL=Tv;exports.OrbitControls=on;exports.Outline=gv;exports.OwnershipEvent=Ose;exports.OwnershipModel=$O;exports.PUBLIC_KEY=YC;exports.Padding=Wm;exports.ParticleBurst=IS;exports.ParticleSubEmitter=tG;exports.ParticleSystem=rr;exports.ParticleSystemBaseBehaviour=$m;exports.ParticleSystemRenderer=Jc;exports.ParticleSystemShapeType=w2;exports.PeerHandle=G0;exports.PeerNetworking=Use;exports.Physics=ex;exports.PhysicsExtension=OP;exports.PhysicsMaterialCombine=Pr;exports.PixelationEffect=UM;exports.PlayAnimationOnClick=iA;exports.PlayAudioOnClick=vm;exports.PlayableDirector=ym;exports.PlayerColor=Nx;exports.PlayerState=Xl;exports.PlayerStateEvent=Uoe;exports.PlayerSync=dv;exports.PlayerView=jre;exports.PlayerViewManager=qre;exports.PointerEventData=lv;exports.PointerType=dP;exports.PostProcessingEffect=jr;exports.PostProcessingHandler=iG;exports.PostProcessingManager=Lv;exports.PreliminaryAction=xv;exports.PreliminaryTrigger=EM;exports.PrimitiveType=$0;exports.Progress=Ci;exports.PromiseAllWithErrors=YB;exports.PromiseErrorResult=yV;exports.RGBAColor=hn;exports.RapierPhysics=Kg;exports.RawImage=FP;exports.RaycastOptions=qd;exports.Rect=H5;exports.RectTransform=oa;exports.ReflectionProbe=vv;exports.RegisteredAnimationInfo=pp;exports.RemoteSkybox=tu;exports.RenderTexture=jf;exports.RenderTextureSerializer=koe;exports.Renderer=Es;exports.RendererData=$re;exports.RendererLightmap=SS;exports.Rigidbody=en;exports.RigidbodyConstraints=Gs;exports.RoomEvents=ri;exports.RotationBySpeedModule=lc;exports.RotationOverLifetimeModule=Yc;exports.SceneLightSettings=v2;exports.SceneSwitcher=Ir;exports.ScreenCapture=eg;exports.ScreenSpaceAmbientOcclusion=Up;exports.ScreenSpaceAmbientOcclusionN8=Kh;exports.SendQueue=yh;exports.SerializationContext=h5;exports.SetActiveOnClick=BA;exports.ShadowCatcher=QM;exports.ShapeModule=gs;exports.SharpeningEffect=OM;exports.SignalAsset=xM;exports.SignalReceiver=hv;exports.SignalReceiverEvent=cv;exports.SignalTrackHandler=CS;exports.Size=W5;exports.SizeBySpeedModule=Ua;exports.SizeOverLifetimeModule=Ym;exports.SkinnedMeshRenderer=nZ;exports.SmoothFollow=tg;exports.SpatialGrabRaycaster=qf;exports.SpatialHtml=KM;exports.SpatialTrigger=JM;exports.SpatialTriggerReceiver=Hd;exports.SpectatorCamera=sG;exports.SphereCollider=fv;exports.SphereIntersection=i5;exports.SphereOverlapResult=Hoe;exports.Sprite=cu;exports.SpriteData=_p;exports.SpriteRenderer=pl;exports.SpriteSheet=Cm;exports.StateMachineBehaviour=Rke;exports.StreamEndedEvent=N5;exports.StreamReceivedEvent=Qoe;exports.SubEmitterSystem=l1;exports.SyncedCamera=rG;exports.SyncedRoom=Yh;exports.SyncedTransform=$d;exports.TapGestureTrigger=$5;exports.TeleportTarget=XP;exports.TestRunner=IZ;exports.TestSceneUtils=E5e;exports.TestSimulateUserData=TZ;exports.Text=aa;exports.TextBuilder=ZP;exports.TextExtension=GM;exports.TextureSheetAnimationModule=Do;exports.TiltShiftEffect=uu;exports.Time=toe;exports.ToneMappingEffect=_m;exports.TrackHandler=vM;exports.TrackType=Sl;exports.TrailModule=os;exports.TransformData=On;exports.TransformGizmo=OA;exports.TriggerBuilder=Or;exports.TriggerModel=Zd;exports.TypeStore=Y;exports.UIRaycastUtils=EP;exports.UIRootComponent=yM;exports.USDDocument=_5;exports.USDObject=Co;exports.USDWriter=Aoe;exports.USDZExporter=ds;exports.USDZText=Ff;exports.USDZUIExtension=WP;exports.UriSerializer=Noe;exports.UsageMarker=kM;exports.UserJoinedOrLeftRoomModel=w2e;exports.VERSION=Eh;exports.VariantAction=w5;exports.VelocityOverLifetimeModule=As;exports.VerticalLayoutGroup=K5;exports.VideoPlayer=Sr;exports.ViewDevice=Kf;exports.Vignette=ZA;exports.VisibilityAction=RM;exports.Voip=Om;exports.Volume=Lv;exports.VolumeParameter=rt;exports.VolumeProfile=_M;exports.WaitForFrames=PPe;exports.WaitForPromise=Xre;exports.WaitForSeconds=Ure;exports.Watch=Ap;exports.WebARCameraBackground=jM;exports.WebARSessionRoot=Rp;exports.WebXR=Ls;exports.WebXRButtonFactory=vp;exports.WebXRImageTracking=Dx;exports.WebXRImageTrackingModel=pu;exports.WebXRPlaneTracking=Xp;exports.WebXRTrackedImage=zf;exports.XRControllerFollow=Op;exports.XRControllerModel=eu;exports.XRControllerMovement=sc;exports.XRFlag=Dl;exports.XRRig=aG;exports.XRState=xo;exports.XRStateFlag=wd;exports.__Ignore=LZ;exports.__internalNotifyObjectDestroyed=ire;exports.activeInHierarchyFieldName=yp;exports.addAttributeChangeCallback=wte;exports.addComponent=Yl;exports.addCustomExtensionPlugin=HFe;exports.addGltfLoadEventListener=e5e;exports.addNewComponent=R0;exports.addPatch=nP;exports.apply=AP;exports.applyHMRChanges=u5e;exports.applyPrototypeExtensions=_re;exports.beginListenDestroy=cre;exports.beginListenInstantiate=ure;exports.binaryIdentifierCasts=HO;exports.build_scene_functions=bGe;exports.builtinComponentKeyName=qg;exports.calculateProgress01=b5;exports.clearBalloonMessages=Bte;exports.clearOverlayMessages=Bte;exports.colorSerializer=gNe;exports.compareAssociation=gre;exports.componentSerializer=OR;exports.copyTexture=Tie;exports.createLoader=PZ;exports.createMotion=Toe;exports.debugNet=Ha;exports.debugOwner=pC;exports.deepClone=Y1;exports.delay=Nh;exports.delayForFrames=QB;exports.deserializeObject=l2;exports.destroy=ic;exports.destroyComponentInstance=Sre;exports.disposeObjectResources=Rn;exports.disposeStream=Pd;exports.editorGuidKeyName=JC;exports.effectsOrder=Qz;exports.enableSpatialConsole=I0;exports.euler=yNe;exports.eventListSerializer=_Ne;exports.exportAsGLTF=G5e;exports.findByGuid=p5;exports.findObjectOfType=gP;exports.findObjectsOfType=Ire;exports.findResourceUsers=s5;exports.fitObjectIntoVolume=Rie;exports.foreachComponent=tA;exports.foreachComponentEnumerator=bP;exports.forward=U1e;exports.generateQRCode=Mte;exports.generateSeed=dre;exports.getBoundingBox=ec;exports.getCameraController=Cie;exports.getComponent=vA;exports.getComponentInChildren=pM;exports.getComponentInParent=AS;exports.getComponents=uM;exports.getComponentsInChildren=sv;exports.getComponentsInParent=mP;exports.getFormattedDate=poe;exports.getIconElement=bo;exports.getIconTexture=Sz;exports.getIp=H_e;exports.getIpAndLocation=Q_e;exports.getIpCloudflare=W_e;exports.getLoader=kh;exports.getOrAddComponent=dM;exports.getParam=ee;exports.getParentHierarchyPath=Z1e;exports.getPath=L_e;exports.getPeerOptions=y2e;exports.getPeerjsInstance=zse;exports.getResourceUserCount=MBe;exports.getTempColor=Mie;exports.getTempQuaternion=Ah;exports.getTempVector=St;exports.getUrlParams=K1;exports.getVisibleInCustomShadowRendering=Eie;exports.getWorldDirection=gO;exports.getWorldEuler=AO;exports.getWorldPosition=$t;exports.getWorldQuaternion=gn;exports.getWorldRotation=$1;exports.getWorldScale=kn;exports.hasCommercialLicense=Bh;exports.hasIndieLicense=y5;exports.hasPointerEventComponent=y2;exports.hasProLicense=Yf;exports.hideDebugConsole=Gie;exports.imageToCanvas=_oe;exports.instantiate=ov;exports.invokeAfterImportPluginHooks=tZ;exports.invokeXRSessionEnd=Wne;exports.invokeXRSessionStart=Zne;exports.isActiveInHierarchy=Ere;exports.isActiveSelf=rv;exports.isAndroidDevice=D_e;exports.isAnimationAction=Iie;exports.isComponent=Ooe;exports.isDebugMode=I_e;exports.isDesktop=P_e;exports.isDestroyed=eA;exports.isDevEnvironment=Qe;exports.isDisposed=wBe;exports.isExporting=R5e;exports.isHostedOnGlitch=yte;exports.isHotReloading=l5e;exports.isIPad=k_e;exports.isIconElement=noe;exports.isLocalNetwork=ka;exports.isMacOS=V_e;exports.isMobileDevice=G_e;exports.isMozillaXR=F_e;exports.isQuest=X_e;exports.isResourceTrackingEnabled=$se;exports.isSafari=U_e;exports.isUsingInstancing=yP;exports.isiOS=z_e;exports.isiPad=N_e;exports.loadSync=GZ;exports.logHierarchy=YL;exports.lookAtInverse=G1e;exports.lookAtObject=q1;exports.makeId=E_e;exports.makeIdFromRandomWords=vte;exports.makeNameSafeForUSD=Vh;exports.markAsInstancedRendered=Rre;exports.microphonePermissionsGranted=O_e;exports.nameof=M_e;exports.nameofFactory=bte;exports.objectSerializer=Goe;exports.offXRSessionEnd=_Le;exports.offXRSessionStart=vLe;exports.onAfterRender=rNe;exports.onBeforeRender=Loe;exports.onClear=nNe;exports.onDestroy=sNe;exports.onInitialized=iNe;exports.onStart=E5;exports.onUpdate=R5;exports.onXRSessionEnd=OO;exports.onXRSessionStart=hP;exports.parseSync=yle;exports.placeOnSurface=Lie;exports.postprocessFBXMaterials=vO;exports.prefix=aNe;exports.pushState=xte;exports.randomNumber=R_e;exports.registerBinaryType=QO;exports.registerComponent=_P;exports.registerComponentExtension=zP;exports.registerCustomEffectType=Kc;exports.registerExportExtensions=eZ;exports.registerExtensions=C2;exports.registerHotReloadType=c5e;exports.registerLoader=V3;exports.registerPrefabProvider=fre;exports.registerPrototypeExtensions=Cre;exports.registerType=jBe;exports.relativePathPrefix=Cte;exports.removeAttributeChangeCallback=Ste;exports.removeComponent=u5;exports.removeCustomImportExtensionType=QFe;exports.removeGltfLoadEventListener=t5e;exports.removePatch=pTe;exports.resolveUrl=km;exports.sanitizeString=_te;exports.saveImage=dle;exports.screenshot=EOe;exports.screenshot2=RZ;exports.sendDestroyed=o5;exports.serializable=I;exports.serializeObject=yre;exports.serializeable=av;exports.setActive=aw;exports.setAllowBalloonMessages=Rte;exports.setAllowOverlayMessages=j_e;exports.setAutoFitEnabled=MV;exports.setCameraController=wV;exports.setDestroyed=Bre;exports.setDevEnvironment=q1e;exports.setDisposable=n5;exports.setDontDestroy=hb;exports.setOrAddParamsToUrl=AV;exports.setParam=T_e;exports.setParamWithoutReload=eS;exports.setPeerOptions=b2e;exports.setResourceTrackingEnabled=CBe;exports.setState=z3;exports.setVisibleInCustomShadowRendering=xO;exports.setWorldEuler=yO;exports.setWorldPosition=_r;exports.setWorldPositionXYZ=q0;exports.setWorldQuaternion=Uc;exports.setWorldQuaternionXYZW=mO;exports.setWorldRotation=bO;exports.setWorldRotationXYZ=eM;exports.setWorldScale=wx;exports.showBalloonError=tM;exports.showBalloonMessage=is;exports.showBalloonWarning=An;exports.showDebugConsole=_O;exports.slerp=P1e;exports.syncDestroy=cM;exports.syncField=G5;exports.syncInstantiate=a5;exports.textureToCanvas=W1e;exports.tryCastBinary=Yne;exports.tryDetermineFileTypeFromBinary=ple;exports.tryDetermineFileTypeFromURL=ule;exports.tryFindObject=xx;exports.tryGetGuid=Jne;exports.unregisterHotReloadType=h5e;exports.unwatchWrite=U3;exports.useForAutoFit=wie;exports.validate=ko;exports.watchWrite=KB;
