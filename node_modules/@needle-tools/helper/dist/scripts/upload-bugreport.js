import commandLineArgs from "command-line-args";
import { uploadBugReport } from "../actions/upload-to-filestorage.js";
import { log } from "../utils/log.js";
import fetch from "node-fetch";
const optionDefinitions = [
    { name: 'url', type: String, multiple: false },
    { name: 'file', type: String, multiple: false },
    { name: 'source', type: String, multiple: false },
    { name: "user", type: String, multiple: false },
    { name: "description", type: String, multiple: false },
];
const options = commandLineArgs(optionDefinitions);
// LOCAL UPLOAD CMD:
// npm run tool:upload-bugreport -- --url "http://localhost:8080/api/v1/bugreport" --file "C:\path\to\file" --source cli --user "marcel@needle"
run();
async function run() {
    if (!options.file || options.file.length === 0) {
        console.error("No file specified. Use --file <file>");
        process.exit(1);
    }
    if (!options.url || options.url.length === 0) {
        const getUrl = await fetch("https://urls.needle.tools/bugreport-endpoint");
        options.url = await getUrl.text();
        log("Queried upload url: " + options.url);
        if (!options.url) {
            console.error("No url specified. Use --url <url>. This must be the server endpoint");
            process.exit(1);
        }
    }
    uploadBugReport(options.url, options.file, options.source, options.user, options.description);
}
