import find from "find-process";
export async function stopProcesses(pattern) {
    const res = await find("name", ".*");
    console.log(res.length, "processes found");
    const selfProcess = process.pid;
    console.log("Pattern: " + pattern);
    const regex = new RegExp(pattern, "gs");
    for (const proc of res) {
        try {
            if (selfProcess === proc.pid) {
                console.log("Skip self");
                continue;
            }
            else if (proc.cmd.includes("--pattern")) {
                console.log("Skip " + proc.cmd);
                continue;
            }
            else if (regex.test(proc.cmd)) {
                console.log("Kill " + proc.cmd);
                process.kill(proc.pid);
            }
            else {
                // console.log("Skip " + proc.name + ", " + proc.cmd)
            }
        }
        catch (e) {
            console.error("ERR: Could not kill process: " + proc.cmd);
        }
        // if (regex.test(proc.cmd)) {
        // }
    }
}
